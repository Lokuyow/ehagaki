(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const pO=!1;var qp=Array.isArray,a7=Array.prototype.indexOf,gS=Array.from,zg=Object.defineProperty,rc=Object.getOwnPropertyDescriptor,mO=Object.getOwnPropertyDescriptors,gO=Object.prototype,l7=Array.prototype,Vy=Object.getPrototypeOf,q_=Object.isExtensible;function nh(t){return typeof t=="function"}const Ut=()=>{};function yS(t){for(var e=0;e<t.length;e++)t[e]()}function c7(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}const as=2,bS=4,Wy=8,Cf=16,Xa=32,Ic=64,yO=128,As=256,Ug=512,ei=1024,Ns=2048,Pc=4096,Xs=8192,Uu=16384,wS=32768,Af=65536,K_=1<<17,u7=1<<18,If=1<<19,bO=1<<20,nx=1<<21,vS=1<<22,pu=1<<23,$o=Symbol("$state"),wO=Symbol("legacy props"),d7=Symbol(""),xS=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function f7(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function SS(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function h7(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function p7(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function m7(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function g7(t){throw new Error("https://svelte.dev/e/effect_orphan")}function y7(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function b7(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function w7(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function v7(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function x7(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const jy=1,qy=2,vO=4,S7=8,E7=16,k7=1,T7=4,_7=8,C7=16,A7=1,I7=2,dr=Symbol(),P7="http://www.w3.org/1999/xhtml",O7="http://www.w3.org/2000/svg",xO="@attach";function M7(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let N7=!1;function SO(t){return t===this.v}function ES(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function R7(t,e){return t!==e}function EO(t){return!ES(t,this.v)}let D7=!1;const L7=[];function B7(t,e=!1,n=!1){return yg(t,new Map,"",L7,null,n)}function yg(t,e,n,r,i=null,s=!1){if(typeof t=="object"&&t!==null){var o=e.get(t);if(o!==void 0)return o;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(qp(t)){var a=Array(t.length);e.set(t,a),i!==null&&e.set(i,a);for(var l=0;l<t.length;l+=1){var c=t[l];l in t&&(a[l]=yg(c,e,n,r,null,s))}return a}if(Vy(t)===gO){a={},e.set(t,a),i!==null&&e.set(i,a);for(var u in t)a[u]=yg(t[u],e,n,r,null,s);return a}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return yg(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let si=null;function Hg(t){si=t}function rx(t){return Ky().get(t)}function F7(t,e){return Ky().set(t,e),e}function $7(t){return Ky().has(t)}function z7(){return Ky()}function St(t,e=!1,n){si={p:si,c:null,e:null,s:t,x:null,l:null}}function Et(t){var e=si,n=e.e;if(n!==null){e.e=null;for(var r of n)UO(r)}return t!==void 0&&(e.x=t),si=e.p,t??{}}function kO(){return!0}function Ky(t){return si===null&&SS(),si.c??=new Map(U7(si)||void 0)}function U7(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}const H7=new WeakMap;function V7(t){var e=Zt;if(e===null)return Gt.f|=pu,t;if((e.f&wS)===0){if((e.f&yO)===0)throw!e.parent&&t instanceof Error&&TO(t),t;e.b.error(t)}else kS(t,e)}function kS(t,e){for(;e!==null;){if((e.f&yO)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t instanceof Error&&TO(t),t}function TO(t){const e=H7.get(t);e&&(zg(t,"message",{value:e.message}),zg(t,"stack",{value:e.stack}))}let dp=[],ix=[];function _O(){var t=dp;dp=[],yS(t)}function W7(){var t=ix;ix=[],yS(t)}function Kp(t){dp.length===0&&queueMicrotask(_O),dp.push(t)}function j7(){dp.length>0&&_O(),ix.length>0&&W7()}function CO(t){let e=0,n=Tu(0),r;return()=>{iU()&&(k(n),Zp(()=>(e===0&&(r=ls(()=>t(()=>Ao(n)))),e+=1,()=>{Kp(()=>{e-=1,e===0&&(r?.(),r=void 0,Ao(n))})})))}}function q7(){for(var t=Zt.b;t!==null&&!t.has_pending_snippet();)t=t.parent;return t===null&&f7(),t}function Gy(t){var e=as|Ns,n=Gt!==null&&(Gt.f&as)!==0?Gt:null;return Zt===null||n!==null&&(n.f&As)!==0?e|=As:Zt.f|=If,{ctx:si,deps:null,effects:null,equals:SO,f:e,fn:t,reactions:null,rv:0,v:dr,wv:0,parent:n??Zt,ac:null}}function K7(t,e){let n=Zt;n===null&&h7();var r=n.b,i=void 0,s=Tu(dr),o=null,a=!Gt;return lU(()=>{try{var l=t();o&&Promise.resolve(l).catch(()=>{})}catch(h){l=Promise.reject(h)}var c=()=>l;i=o?.then(c,c)??Promise.resolve(l),o=i;var u=Tn,d=r.pending;a&&(r.update_pending_count(1),d||u.increment());const f=(h,p=void 0)=>{o=null,d||u.activate(),p?p!==xS&&(s.f|=pu,fp(s,p)):((s.f&pu)!==0&&(s.f^=pu),fp(s,h)),a&&(r.update_pending_count(-1),d||u.decrement()),MO()};if(i.then(f,h=>f(null,h||"unknown")),u)return()=>{queueMicrotask(()=>u.neuter())}}),new Promise(l=>{function c(u){function d(){u===i?l(s):c(i)}u.then(d,d)}c(i)})}function ae(t){const e=Gy(t);return KO(e),e}function AO(t){const e=Gy(t);return e.equals=EO,e}function IO(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)vi(e[n])}}function G7(t){for(var e=t.parent;e!==null;){if((e.f&as)===0)return e;e=e.parent}return null}function TS(t){var e,n=Zt;yc(G7(t));try{IO(t),e=XO(t)}finally{yc(n)}return e}function PO(t){var e=TS(t);if(t.equals(e)||(t.v=e,t.wv=ZO()),!Hu){var n=(Kl||(t.f&As)!==0)&&t.deps!==null?Pc:ei;Ui(t,n)}}function OO(t,e,n){const r=Gy;if(e.length===0){n(t.map(r));return}var i=Tn,s=Zt,o=Z7(),a=q7();Promise.all(e.map(l=>K7(l))).then(l=>{i?.activate(),o();try{n([...t.map(r),...l])}catch(c){(s.f&Uu)===0&&kS(c,s)}i?.deactivate(),MO()}).catch(l=>{a.error(l)})}function Z7(){var t=Zt,e=Gt,n=si,r=Tn;return function(){yc(t),Vo(e),Hg(n),r?.activate()}}function MO(){yc(null),Vo(null),Hg(null)}const Vw=new Set;let Tn=null,bg=null,G_=new Set,Vg=[];function NO(){const t=Vg.shift();Vg.length>0&&queueMicrotask(NO),t()}let Eu=[],Zy=null,sx=!1,wg=!1;class ku{current=new Map;#e=new Map;#t=new Set;#n=0;#r=null;#i=!1;#o=[];#a=[];#s=[];#l=[];#u=[];#c=[];#d=[];skipped_effects=new Set;process(e){Eu=[],bg=null;for(const i of e)this.#h(i);if(this.#o.length===0&&this.#n===0){this.#p();var n=this.#s,r=this.#l;this.#s=[],this.#l=[],this.#u=[],bg=Tn,Tn=null,Z_(n),Z_(r),Tn===null?Tn=this:Vw.delete(this),this.#r?.resolve()}else this.#f(this.#s),this.#f(this.#l),this.#f(this.#u);for(const i of this.#o)Nd(i);for(const i of this.#a)Nd(i);this.#o=[],this.#a=[]}#h(e){e.f^=ei;for(var n=e.first;n!==null;){var r=n.f,i=(r&(Xa|Ic))!==0,s=i&&(r&ei)!==0,o=s||(r&Xs)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){if(i)n.f^=ei;else if((r&bS)!==0)this.#l.push(n);else if((r&ei)===0)if((r&vS)!==0){var a=n.b?.pending?this.#a:this.#o;a.push(n)}else eb(n)&&((n.f&Cf)!==0&&this.#u.push(n),Nd(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)n=c.next,c=c.parent}}#f(e){for(const n of e)((n.f&Ns)!==0?this.#c:this.#d).push(n),Ui(n,ei);e.length=0}capture(e,n){this.#e.has(e)||this.#e.set(e,n),this.current.set(e,e.v)}activate(){Tn=this}deactivate(){Tn=null,bg=null;for(const e of G_)if(G_.delete(e),e(),Tn!==null)break}neuter(){this.#i=!0}flush(){Eu.length>0?RO():this.#p(),Tn===this&&(this.#n===0&&Vw.delete(this),this.deactivate())}#p(){if(!this.#i)for(const e of this.#t)e();this.#t.clear()}increment(){this.#n+=1}decrement(){if(this.#n-=1,this.#n===0){for(const e of this.#c)Ui(e,Ns),Yd(e);for(const e of this.#d)Ui(e,Pc),Yd(e);this.#s=[],this.#l=[],this.flush()}else this.deactivate()}add_callback(e){this.#t.add(e)}settled(){return(this.#r??=c7()).promise}static ensure(){if(Tn===null){const e=Tn=new ku;Vw.add(Tn),wg||ku.enqueue(()=>{Tn===e&&e.flush()})}return Tn}static enqueue(e){Vg.length===0&&queueMicrotask(NO),Vg.unshift(e)}}function Q7(t){var e=wg;wg=!0;try{for(var n;;){if(j7(),Eu.length===0&&(Tn?.flush(),Eu.length===0))return Zy=null,n;RO()}}finally{wg=e}}function RO(){var t=Md;sx=!0;try{var e=0;for(J_(!0);Eu.length>0;){var n=ku.ensure();if(e++>1e3){var r,i;X7()}n.process(Eu),ic.clear()}}finally{sx=!1,J_(t),Zy=null}}function X7(){try{y7()}catch(t){kS(t,Zy)}}let Xc=null;function Z_(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(Uu|Xs))===0&&eb(r)&&(Xc=[],Nd(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?WO(r):r.fn=null),Xc?.length>0)){ic.clear();for(const i of Xc)Nd(i);Xc=[]}}Xc=null}}function Yd(t){for(var e=Zy=t;e.parent!==null;){e=e.parent;var n=e.f;if(sx&&e===Zt&&(n&Cf)!==0)return;if((n&(Ic|Xa))!==0){if((n&ei)===0)return;e.f^=ei}}Eu.push(e)}const ic=new Map;function Tu(t,e){var n={f:0,v:t,reactions:null,equals:SO,rv:0,wv:0};return n}function ge(t,e){const n=Tu(t);return KO(n),n}function DO(t,e=!1,n=!0){const r=Tu(t);return e||(r.equals=EO),r}function K(t,e,n=!1){Gt!==null&&(!Ks||(Gt.f&K_)!==0)&&kO()&&(Gt.f&(as|Cf|vS|K_))!==0&&!Ba?.includes(t)&&x7();let r=n?Nt(e):e;return fp(t,r)}function fp(t,e){if(!t.equals(e)){var n=t.v;Hu?ic.set(t,e):ic.set(t,n),t.v=e;var r=ku.ensure();r.capture(t,n),(t.f&as)!==0&&((t.f&Ns)!==0&&TS(t),Ui(t,(t.f&As)===0?ei:Pc)),t.wv=ZO(),LO(t,Ns),Zt!==null&&(Zt.f&ei)!==0&&(Zt.f&(Xa|Ic))===0&&(ys===null?dU([t]):ys.push(t))}return e}function Ao(t){K(t,t.v+1)}function LO(t,e){var n=t.reactions;if(n!==null)for(var r=n.length,i=0;i<r;i++){var s=n[i],o=s.f,a=(o&Ns)===0;a&&Ui(s,e),(o&as)!==0?LO(s,Pc):a&&((o&Cf)!==0&&Xc!==null&&Xc.push(s),Yd(s))}}function Nt(t){if(typeof t!="object"||t===null||$o in t)return t;const e=Vy(t);if(e!==gO&&e!==l7)return t;var n=new Map,r=qp(t),i=ge(0),s=Fa,o=a=>{if(Fa===s)return a();var l=Gt,c=Fa;Vo(null),tC(s);var u=a();return Vo(l),tC(c),u};return r&&n.set("length",ge(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&w7();var u=n.get(l);return u===void 0?u=o(()=>{var d=ge(c.value);return n.set(l,d),d}):K(u,c.value,!0),!0},deleteProperty(a,l){var c=n.get(l);if(c===void 0){if(l in a){const u=o(()=>ge(dr));n.set(l,u),Ao(i)}}else K(c,dr),Ao(i);return!0},get(a,l,c){if(l===$o)return t;var u=n.get(l),d=l in a;if(u===void 0&&(!d||rc(a,l)?.writable)&&(u=o(()=>{var h=Nt(d?a[l]:dr),p=ge(h);return p}),n.set(l,u)),u!==void 0){var f=k(u);return f===dr?void 0:f}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=k(u))}else if(c===void 0){var d=n.get(l),f=d?.v;if(d!==void 0&&f!==dr)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(a,l){if(l===$o)return!0;var c=n.get(l),u=c!==void 0&&c.v!==dr||Reflect.has(a,l);if(c!==void 0||Zt!==null&&(!u||rc(a,l)?.writable)){c===void 0&&(c=o(()=>{var f=u?Nt(a[l]):dr,h=ge(f);return h}),n.set(l,c));var d=k(c);if(d===dr)return!1}return u},set(a,l,c,u){var d=n.get(l),f=l in a;if(r&&l==="length")for(var h=c;h<d.v;h+=1){var p=n.get(h+"");p!==void 0?K(p,dr):h in a&&(p=o(()=>ge(dr)),n.set(h+"",p))}if(d===void 0)(!f||rc(a,l)?.writable)&&(d=o(()=>ge(void 0)),K(d,Nt(c)),n.set(l,d));else{f=d.v!==dr;var m=o(()=>Nt(c));K(d,m)}var g=Reflect.getOwnPropertyDescriptor(a,l);if(g?.set&&g.set.call(u,c),!f){if(r&&typeof l=="string"){var y=n.get("length"),b=Number(l);Number.isInteger(b)&&b>=y.v&&K(y,b+1)}Ao(i)}return!0},ownKeys(a){k(i);var l=Reflect.ownKeys(a).filter(d=>{var f=n.get(d);return f===void 0||f.v!==dr});for(var[c,u]of n)u.v!==dr&&!(c in a)&&l.push(c);return l},setPrototypeOf(){v7()}})}function Q_(t){try{if(t!==null&&typeof t=="object"&&$o in t)return t[$o]}catch{}return t}function Y7(t,e){return Object.is(Q_(t),Q_(e))}var X_,BO,FO,$O;function J7(){if(X_===void 0){X_=window,BO=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;FO=rc(e,"firstChild").get,$O=rc(e,"nextSibling").get,q_(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),q_(n)&&(n.__t=void 0)}}function Ya(t=""){return document.createTextNode(t)}function Wg(t){return FO.call(t)}function Qy(t){return $O.call(t)}function re(t,e){return Wg(t)}function Te(t,e){{var n=Wg(t);return n instanceof Comment&&n.data===""?Qy(n):n}}function ve(t,e=1,n=!1){let r=t;for(;e--;)r=Qy(r);return r}function eU(t){t.textContent=""}function Xy(){return!1}function tU(t,e){if(e){const n=document.body;t.autofocus=!0,Kp(()=>{document.activeElement===n&&t.focus()})}}let Y_=!1;function nU(){Y_||(Y_=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Yy(t){var e=Gt,n=Zt;Vo(null),yc(null);try{return t()}finally{Vo(e),yc(n)}}function _S(t,e,n,r=n){t.addEventListener(e,()=>Yy(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),nU()}function zO(t){Zt===null&&Gt===null&&g7(),Gt!==null&&(Gt.f&As)!==0&&Zt===null&&m7(),Hu&&p7()}function rU(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function so(t,e,n,r=!0){var i=Zt;i!==null&&(i.f&Xs)!==0&&(t|=Xs);var s={ctx:si,deps:null,nodes_start:null,nodes_end:null,f:t|Ns,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Nd(s),s.f|=wS}catch(l){throw vi(s),l}else e!==null&&Yd(s);if(r){var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes_start===null&&o.first===o.last&&(o.f&If)===0&&(o=o.first),o!==null&&(o.parent=i,i!==null&&rU(o,i),Gt!==null&&(Gt.f&as)!==0&&(t&Ic)===0)){var a=Gt;(a.effects??=[]).push(o)}}return s}function iU(){return Gt!==null&&!Ks}function CS(t){const e=so(Wy,null,!1);return Ui(e,ei),e.teardown=t,e}function Ge(t){zO();var e=Zt.f,n=!Gt&&(e&Xa)!==0&&(e&wS)===0;if(n){var r=si;(r.e??=[]).push(t)}else return UO(t)}function UO(t){return so(bS|bO,t,!1)}function sU(t){return zO(),so(Wy|bO,t,!0)}function oU(t){ku.ensure();const e=so(Ic|If,t,!0);return()=>{vi(e)}}function aU(t){ku.ensure();const e=so(Ic|If,t,!0);return(n={})=>new Promise(r=>{n.outro?Pf(e,()=>{vi(e),r(void 0)}):(vi(e),r(void 0))})}function Gp(t){return so(bS,t,!1)}function lU(t){return so(vS|If,t,!0)}function Zp(t,e=0){return so(Wy|e,t,!0)}function je(t,e=[],n=[]){OO(e,n,r=>{so(Wy,()=>t(...r.map(k)),!0)})}function Oc(t,e=0){var n=so(Cf|e,t,!0);return n}function Js(t,e=!0){return so(Xa|If,t,!0,e)}function HO(t){var e=t.teardown;if(e!==null){const n=Hu,r=Gt;eC(!0),Vo(null);try{e.call(null)}finally{eC(n),Vo(r)}}}function VO(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&Yy(()=>{i.abort(xS)});var r=n.next;(n.f&Ic)!==0?n.parent=null:vi(n,e),n=r}}function cU(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&Xa)===0&&vi(e),e=n}}function vi(t,e=!0){var n=!1;(e||(t.f&u7)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(uU(t.nodes_start,t.nodes_end),n=!0),VO(t,e&&!n),jg(t,0),Ui(t,Uu);var r=t.transitions;if(r!==null)for(const s of r)s.stop();HO(t);var i=t.parent;i!==null&&i.first!==null&&WO(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function uU(t,e){for(;t!==null;){var n=t===e?null:Qy(t);t.remove(),t=n}}function WO(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Pf(t,e){var n=[];AS(t,n,!0),jO(n,()=>{vi(t),e&&e()})}function jO(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var i of t)i.out(r)}else e()}function AS(t,e,n){if((t.f&Xs)===0){if(t.f^=Xs,t.transitions!==null)for(const o of t.transitions)(o.is_global||n)&&e.push(o);for(var r=t.first;r!==null;){var i=r.next,s=(r.f&Af)!==0||(r.f&Xa)!==0;AS(r,e,s?n:!1),r=i}}}function Jy(t){qO(t,!0)}function qO(t,e){if((t.f&Xs)!==0){t.f^=Xs,(t.f&ei)===0&&(Ui(t,Ns),Yd(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&Af)!==0||(n.f&Xa)!==0;qO(n,i?e:!1),n=r}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}let Md=!1;function J_(t){Md=t}let Hu=!1;function eC(t){Hu=t}let Gt=null,Ks=!1;function Vo(t){Gt=t}let Zt=null;function yc(t){Zt=t}let Ba=null;function KO(t){Gt!==null&&(Ba===null?Ba=[t]:Ba.push(t))}let yi=null,Yi=0,ys=null;function dU(t){ys=t}let GO=1,hp=0,Fa=hp;function tC(t){Fa=t}let Kl=!1;function ZO(){return++GO}function eb(t){var e=t.f;if((e&Ns)!==0)return!0;if((e&Pc)!==0){var n=t.deps,r=(e&As)!==0;if(n!==null){var i,s,o=(e&Ug)!==0,a=r&&Zt!==null&&!Kl,l=n.length;if((o||a)&&(Zt===null||(Zt.f&Uu)===0)){var c=t,u=c.parent;for(i=0;i<l;i++)s=n[i],(o||!s?.reactions?.includes(c))&&(s.reactions??=[]).push(c);o&&(c.f^=Ug),a&&u!==null&&(u.f&As)===0&&(c.f^=As)}for(i=0;i<l;i++)if(s=n[i],eb(s)&&PO(s),s.wv>t.wv)return!0}(!r||Zt!==null&&!Kl)&&Ui(t,ei)}return!1}function QO(t,e,n=!0){var r=t.reactions;if(r!==null&&!Ba?.includes(t))for(var i=0;i<r.length;i++){var s=r[i];(s.f&as)!==0?QO(s,e,!1):e===s&&(n?Ui(s,Ns):(s.f&ei)!==0&&Ui(s,Pc),Yd(s))}}function XO(t){var e=yi,n=Yi,r=ys,i=Gt,s=Kl,o=Ba,a=si,l=Ks,c=Fa,u=t.f;yi=null,Yi=0,ys=null,Kl=(u&As)!==0&&(Ks||!Md||Gt===null),Gt=(u&(Xa|Ic))===0?t:null,Ba=null,Hg(t.ctx),Ks=!1,Fa=++hp,t.ac!==null&&(Yy(()=>{t.ac.abort(xS)}),t.ac=null);try{t.f|=nx;var d=t.fn,f=d(),h=t.deps;if(yi!==null){var p;if(jg(t,Yi),h!==null&&Yi>0)for(h.length=Yi+yi.length,p=0;p<yi.length;p++)h[Yi+p]=yi[p];else t.deps=h=yi;if(!Kl||(u&as)!==0&&t.reactions!==null)for(p=Yi;p<h.length;p++)(h[p].reactions??=[]).push(t)}else h!==null&&Yi<h.length&&(jg(t,Yi),h.length=Yi);if(kO()&&ys!==null&&!Ks&&h!==null&&(t.f&(as|Pc|Ns))===0)for(p=0;p<ys.length;p++)QO(ys[p],t);return i!==null&&i!==t&&(hp++,ys!==null&&(r===null?r=ys:r.push(...ys))),(t.f&pu)!==0&&(t.f^=pu),f}catch(m){return V7(m)}finally{t.f^=nx,yi=e,Yi=n,ys=r,Gt=i,Kl=s,Ba=o,Hg(a),Ks=l,Fa=c}}function fU(t,e){let n=e.reactions;if(n!==null){var r=a7.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}n===null&&(e.f&as)!==0&&(yi===null||!yi.includes(e))&&(Ui(e,Pc),(e.f&(As|Ug))===0&&(e.f^=Ug),IO(e),jg(e,0))}function jg(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)fU(t,n[r])}function Nd(t){var e=t.f;if((e&Uu)===0){Ui(t,ei);var n=Zt,r=Md;Zt=t,Md=!0;try{(e&Cf)!==0?cU(t):VO(t),HO(t);var i=XO(t);t.teardown=typeof i=="function"?i:null,t.wv=GO;var s;pO&&D7&&(t.f&Ns)!==0&&t.deps}finally{Md=r,Zt=n}}}async function qa(){await Promise.resolve(),Q7()}function k(t){var e=t.f,n=(e&as)!==0;if(Gt!==null&&!Ks){var r=Zt!==null&&(Zt.f&Uu)!==0;if(!r&&!Ba?.includes(t)){var i=Gt.deps;if((Gt.f&nx)!==0)t.rv<hp&&(t.rv=hp,yi===null&&i!==null&&i[Yi]===t?Yi++:yi===null?yi=[t]:(!Kl||!yi.includes(t))&&yi.push(t));else{(Gt.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[Gt]:s.includes(Gt)||s.push(Gt)}}}else if(n&&t.deps===null&&t.effects===null){var o=t,a=o.parent;a!==null&&(a.f&As)===0&&(o.f^=As)}if(Hu){if(ic.has(t))return ic.get(t);if(n){o=t;var l=o.v;return((o.f&ei)===0&&o.reactions!==null||YO(o))&&(l=TS(o)),ic.set(o,l),l}}else n&&(o=t,eb(o)&&PO(o));if((t.f&pu)!==0)throw t.v;return t.v}function YO(t){if(t.v===dr)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(ic.has(e)||(e.f&as)!==0&&YO(e))return!0;return!1}function ls(t){var e=Ks;try{return Ks=!0,t()}finally{Ks=e}}const hU=-7169;function Ui(t,e){t.f=t.f&hU|e}function pU(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if($o in t)ox(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&$o in n&&ox(n)}}}function ox(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{ox(t[r],e)}catch{}const n=Vy(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=mO(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}function mU(){return Symbol(xO)}function gU(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const yU=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function bU(t){return yU.includes(t)}const wU={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function vU(t){return t=t.toLowerCase(),wU[t]??t}const xU=["touchstart","touchmove"];function SU(t){return xU.includes(t)}const JO=new Set,ax=new Set;function IS(t,e,n,r={}){function i(s){if(r.capture||Ah.call(e,s),!s.cancelBubble)return Yy(()=>n?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Kp(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function ni(t,e,n,r={}){var i=IS(e,t,n,r);return()=>{t.removeEventListener(e,i,r)}}function js(t,e,n,r,i){var s={capture:r,passive:i},o=IS(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&CS(()=>{e.removeEventListener(t,o,s)})}function Ti(t){for(var e=0;e<t.length;e++)JO.add(t[e]);for(var n of ax)n(t)}let nC=null;function Ah(t){var e=this,n=e.ownerDocument,r=t.type,i=t.composedPath?.()||[],s=i[0]||t.target;nC=t;var o=0,a=nC===t&&t.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=i.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=i[o]||t.target,s!==e){zg(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=Gt,d=Zt;Vo(null),yc(null);try{for(var f,h=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+r];if(m!=null&&(!s.disabled||t.target===s))if(qp(m)){var[g,...y]=m;g.apply(s,[t,...y])}else m.call(s,t)}catch(b){f?h.push(b):f=b}if(t.cancelBubble||p===e||p===null)break;s=p}if(f){for(let b of h)queueMicrotask(()=>{throw b});throw f}}finally{t.__root=e,delete t.currentTarget,Vo(u),yc(d)}}}function EU(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function pp(t,e){var n=Zt;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function _e(t,e){var n=(e&A7)!==0,r=(e&I7)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=EU(s?t:"<!>"+t),n||(i=Wg(i)));var o=r||BO?document.importNode(i,!0):i.cloneNode(!0);if(n){var a=Wg(o),l=o.lastChild;pp(a,l)}else pp(o,o);return o}}function on(t=""){{var e=Ya(t+"");return pp(e,e),e}}function Fe(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Ya();return t.append(e,n),pp(e,n),t}function X(t,e){t!==null&&t.before(e)}function Xo(){return(window.__svelte??={}).uid??=1,`c${window.__svelte.uid++}`}function Re(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function PS(t,e){return kU(t,e)}const nd=new Map;function kU(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:o=!0}){J7();var a=new Set,l=d=>{for(var f=0;f<d.length;f++){var h=d[f];if(!a.has(h)){a.add(h);var p=SU(h);e.addEventListener(h,Ah,{passive:p});var m=nd.get(h);m===void 0?(document.addEventListener(h,Ah,{passive:p}),nd.set(h,1)):nd.set(h,m+1)}}};l(gS(JO)),ax.add(l);var c=void 0,u=aU(()=>{var d=n??e.appendChild(Ya());return Js(()=>{if(s){St({});var f=si;f.c=s}i&&(r.$$events=i),c=t(d,r)||{},s&&Et()}),()=>{for(var f of a){e.removeEventListener(f,Ah);var h=nd.get(f);--h===0?(document.removeEventListener(f,Ah),nd.delete(f)):nd.set(f,h)}ax.delete(l),d!==n&&d.parentNode?.removeChild(d)}});return lx.set(c,u),c}let lx=new WeakMap;function e4(t,e){const n=lx.get(t);return n?(lx.delete(t),n(e)):Promise.resolve()}function $e(t,e,n=!1){var r=t,i=null,s=null,o=dr,a=n?Af:0,l=!1;const c=(h,p=!0)=>{l=!0,f(p,h)};var u=null;function d(){u!==null&&(u.lastChild.remove(),r.before(u),u=null);var h=o?i:s,p=o?s:i;h&&Jy(h),p&&Pf(p,()=>{o?s=null:i=null})}const f=(h,p)=>{if(o!==(o=h)){var m=Xy(),g=r;if(m&&(u=document.createDocumentFragment(),u.append(g=Ya())),o?i??=p&&Js(()=>p(g)):s??=p&&Js(()=>p(g)),m){var y=Tn,b=o?i:s,E=o?s:i;b&&y.skipped_effects.delete(b),E&&y.skipped_effects.add(E),y.add_callback(d)}else d()}};Oc(()=>{l=!1,e(c),l||f(null,null)},a)}function TU(t,e,n){var r=t,i=dr,s,o,a=null,l=R7;function c(){s&&Pf(s),a!==null&&(a.lastChild.remove(),r.before(a),a=null),s=o}Oc(()=>{if(l(i,i=e())){var u=r,d=Xy();d&&(a=document.createDocumentFragment(),a.append(u=Ya())),o=Js(()=>n(u)),d?Tn.add_callback(c):c()}})}function Gc(t,e){return e}function _U(t,e,n){for(var r=t.items,i=[],s=e.length,o=0;o<s;o++)AS(e[o].e,i,!0);var a=s>0&&i.length===0&&n!==null;if(a){var l=n.parentNode;eU(l),l.append(n),r.clear(),xo(t,e[0].prev,e[s-1].next)}jO(i,()=>{for(var c=0;c<s;c++){var u=e[c];a||(r.delete(u.k),xo(t,u.prev,u.next)),vi(u.e,!a)}})}function va(t,e,n,r,i,s=null){var o=t,a={flags:e,items:new Map,first:null},l=(e&vO)!==0;if(l){var c=t;o=c.appendChild(Ya())}var u=null,d=!1,f=new Map,h=AO(()=>{var y=n();return qp(y)?y:y==null?[]:gS(y)}),p,m;function g(){CU(m,p,a,f,o,i,e,r,n),s!==null&&(p.length===0?u?Jy(u):u=Js(()=>s(o)):u!==null&&Pf(u,()=>{u=null}))}Oc(()=>{m??=Zt,p=k(h);var y=p.length;if(!(d&&y===0)){d=y===0;var b,E,C,I;if(Xy()){var x=new Set,P=Tn;for(E=0;E<y;E+=1){C=p[E],I=r(C,E);var T=a.items.get(I)??f.get(I);T?(e&(jy|qy))!==0&&t4(T,C,E,e):(b=n4(null,a,null,null,C,I,E,i,e,n,!0),f.set(I,b)),x.add(I)}for(const[S,_]of a.items)x.has(S)||P.skipped_effects.add(_.e);P.add_callback(g)}else g();k(h)}})}function CU(t,e,n,r,i,s,o,a,l){var c=(o&S7)!==0,u=(o&(jy|qy))!==0,d=e.length,f=n.items,h=n.first,p=h,m,g=null,y,b=[],E=[],C,I,x,P;if(c)for(P=0;P<d;P+=1)C=e[P],I=a(C,P),x=f.get(I),x!==void 0&&(x.a?.measure(),(y??=new Set).add(x));for(P=0;P<d;P+=1){if(C=e[P],I=a(C,P),x=f.get(I),x===void 0){var T=r.get(I);if(T!==void 0){r.delete(I),f.set(I,T);var S=g?g.next:p;xo(n,g,T),xo(n,T,S),Ww(T,S,i),g=T}else{var _=p?p.e.nodes_start:i;g=n4(_,n,g,g===null?n.first:g.next,C,I,P,s,o,l)}f.set(I,g),b=[],E=[],p=g.next;continue}if(u&&t4(x,C,P,o),(x.e.f&Xs)!==0&&(Jy(x.e),c&&(x.a?.unfix(),(y??=new Set).delete(x))),x!==p){if(m!==void 0&&m.has(x)){if(b.length<E.length){var O=E[0],F;g=O.prev;var L=b[0],B=b[b.length-1];for(F=0;F<b.length;F+=1)Ww(b[F],O,i);for(F=0;F<E.length;F+=1)m.delete(E[F]);xo(n,L.prev,B.next),xo(n,g,L),xo(n,B,O),p=O,g=B,P-=1,b=[],E=[]}else m.delete(x),Ww(x,p,i),xo(n,x.prev,x.next),xo(n,x,g===null?n.first:g.next),xo(n,g,x),g=x;continue}for(b=[],E=[];p!==null&&p.k!==I;)(p.e.f&Xs)===0&&(m??=new Set).add(p),E.push(p),p=p.next;if(p===null)continue;x=p}b.push(x),g=x,p=x.next}if(p!==null||m!==void 0){for(var N=m===void 0?[]:gS(m);p!==null;)(p.e.f&Xs)===0&&N.push(p),p=p.next;var M=N.length;if(M>0){var R=(o&vO)!==0&&d===0?i:null;if(c){for(P=0;P<M;P+=1)N[P].a?.measure();for(P=0;P<M;P+=1)N[P].a?.fix()}_U(n,N,R)}}c&&Kp(()=>{if(y!==void 0)for(x of y)x.a?.apply()}),t.first=n.first&&n.first.e,t.last=g&&g.e;for(var H of r.values())vi(H.e);r.clear()}function t4(t,e,n,r){(r&jy)!==0&&fp(t.v,e),(r&qy)!==0?fp(t.i,n):t.i=n}function n4(t,e,n,r,i,s,o,a,l,c,u){var d=(l&jy)!==0,f=(l&E7)===0,h=d?f?DO(i,!1,!1):Tu(i):i,p=(l&qy)===0?o:Tu(o),m={i:p,v:h,k:s,a:null,e:null,prev:n,next:r};try{if(t===null){var g=document.createDocumentFragment();g.append(t=Ya())}return m.e=Js(()=>a(t,h,p,c),N7),m.e.prev=n&&n.e,m.e.next=r&&r.e,n===null?u||(e.first=m):(n.next=m,n.e.next=m.e),r!==null&&(r.prev=m,r.e.prev=m.e),m}finally{}}function Ww(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==null&&s!==r;){var o=Qy(s);i.before(s),s=o}}function xo(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function Tt(t,e,...n){var r=t,i=Ut,s;Oc(()=>{i!==(i=e())&&(s&&(vi(s),s=null),s=Js(()=>i(r,...n)))},Af)}function Dt(t,e,n){var r=t,i,s,o=null,a=null;function l(){s&&(Pf(s),s=null),o&&(o.lastChild.remove(),r.before(o),o=null),s=a,a=null}Oc(()=>{if(i!==(i=e())){var c=Xy();if(i){var u=r;c&&(o=document.createDocumentFragment(),o.append(u=Ya()),s&&Tn.skipped_effects.add(s)),a=Js(()=>n(u,i))}c?Tn.add_callback(l):l()}},Af)}function AU(t,e,n,r,i,s){var o,a,l=null,c=t,u;Oc(()=>{const d=e()||null;var f=d==="svg"?O7:null;d!==o&&(u&&(d===null?Pf(u,()=>{u=null,a=null}):d===a?Jy(u):vi(u)),d&&d!==a&&(u=Js(()=>{if(l=f?document.createElementNS(f,d):document.createElement(d),pp(l,l),r){var h=l.appendChild(Ya());r(l,h)}Zt.nodes_end=l,c.before(l)})),o=d,o&&(a=o))},Af)}function Fm(t,e,n){Gp(()=>{var r=ls(()=>e(t,n?.())||{});if(n&&r?.update){var i=!1,s={};Zp(()=>{var o=n();pU(o),i&&ES(s,o)&&(s=o,r.update(o))}),i=!0}if(r?.destroy)return()=>r.destroy()})}function IU(t,e){var n=void 0,r;Oc(()=>{n!==(n=e())&&(r&&(vi(r),r=null),n&&(r=Js(()=>{Gp(()=>n(t))})))})}function r4(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=r4(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function vg(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=r4(t))&&(r&&(r+=" "),r+=e);return r}function i4(t){return typeof t=="object"?vg(t):t??""}const rC=[...` 	
\r\fÂ \v\uFEFF`];function PU(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,o=0;(o=r.indexOf(i,o))>=0;){var a=o+s;(o===0||rC.includes(r[o-1]))&&(a===r.length||rC.includes(r[a]))?r=(o===0?"":r.substring(0,o))+r.substring(a+1):o=a}}return r===""?null:r}function iC(t,e=!1){var n=e?" !important;":";",r="";for(var i in t){var s=t[i];s!=null&&s!==""&&(r+=" "+i+": "+s+n)}return r}function jw(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function OU(t,e){if(e){var n="",r,i;if(Array.isArray(e)?(r=e[0],i=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,o=0,a=!1,l=[];r&&l.push(...Object.keys(r).map(jw)),i&&l.push(...Object.keys(i).map(jw));var c=0,u=-1;const m=t.length;for(var d=0;d<m;d++){var f=t[d];if(a?f==="/"&&t[d-1]==="*"&&(a=!1):s?s===f&&(s=!1):f==="/"&&t[d+1]==="*"?a=!0:f==='"'||f==="'"?s=f:f==="("?o++:f===")"&&o--,!a&&s===!1&&o===0){if(f===":"&&u===-1)u=d;else if(f===";"||d===m-1){if(u!==-1){var h=jw(t.substring(c,u).trim());if(!l.includes(h)){f!==";"&&d++;var p=t.substring(c,d).trim();n+=" "+p+";"}}c=d+1,u=-1}}}}return r&&(n+=iC(r)),i&&(n+=iC(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function eo(t,e,n,r,i,s){var o=t.__className;if(o!==n||o===void 0){var a=PU(n,r,s);a==null?t.removeAttribute("class"):e?t.className=a:t.setAttribute("class",a),t.__className=n}else if(s&&i!==s)for(var l in s){var c=!!s[l];(i==null||c!==!!i[l])&&t.classList.toggle(l,c)}return s}function qw(t,e={},n,r){for(var i in n){var s=n[i];e[i]!==s&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,s,r))}}function Oa(t,e,n,r){var i=t.__style;if(i!==e){var s=OU(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(qw(t,n?.[0],r[0]),qw(t,n?.[1],r[1],"important")):qw(t,n,r));return r}function qg(t,e,n=!1){if(t.multiple){if(e==null)return;if(!qp(e))return M7();for(var r of t.options)r.selected=e.includes(zh(r));return}for(r of t.options){var i=zh(r);if(Y7(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function s4(t){var e=new MutationObserver(()=>{qg(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),CS(()=>{e.disconnect()})}function MU(t,e,n=e){var r=!0;_S(t,"change",i=>{var s=i?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(s),zh);else{var a=t.querySelector(s)??t.querySelector("option:not([disabled])");o=a&&zh(a)}n(o)}),Gp(()=>{var i=e();if(qg(t,i,r),r&&i===void 0){var s=t.querySelector(":checked");s!==null&&(i=zh(s),n(i))}t.__value=i,r=!1}),s4(t)}function zh(t){return"__value"in t?t.__value:t.value}const rh=Symbol("class"),ih=Symbol("style"),o4=Symbol("is custom element"),a4=Symbol("is html");function l4(t,e){var n=tb(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function NU(t,e){var n=tb(t);n.checked!==(n.checked=e??void 0)&&(t.checked=e)}function RU(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function yn(t,e,n,r){var i=tb(t);i[e]!==(i[e]=n)&&(e==="loading"&&(t[d7]=n),n==null?t.removeAttribute(e):typeof n!="string"&&c4(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function DU(t,e,n,r,i=!1){var s=tb(t),o=s[o4],a=!s[a4],l=e||{},c=t.tagName==="OPTION";for(var u in e)u in n||(n[u]=null);n.class?n.class=i4(n.class):(r||n[rh])&&(n.class=null),n[ih]&&(n.style??=null);var d=c4(t);for(const b in n){let E=n[b];if(c&&b==="value"&&E==null){t.value=t.__value="",l[b]=E;continue}if(b==="class"){var f=t.namespaceURI==="http://www.w3.org/1999/xhtml";eo(t,f,E,r,e?.[rh],n[rh]),l[b]=E,l[rh]=n[rh];continue}if(b==="style"){Oa(t,E,e?.[ih],n[ih]),l[b]=E,l[ih]=n[ih];continue}var h=l[b];if(!(E===h&&!(E===void 0&&t.hasAttribute(b)))){l[b]=E;var p=b[0]+b[1];if(p!=="$$")if(p==="on"){const C={},I="$$"+b;let x=b.slice(2);var m=bU(x);if(gU(x)&&(x=x.slice(0,-7),C.capture=!0),!m&&h){if(E!=null)continue;t.removeEventListener(x,l[I],C),l[I]=null}if(E!=null)if(m)t[`__${x}`]=E,Ti([x]);else{let P=function(T){l[b].call(this,T)};l[I]=IS(x,t,P,C)}else m&&(t[`__${x}`]=void 0)}else if(b==="style")yn(t,b,E);else if(b==="autofocus")tU(t,!!E);else if(!o&&(b==="__value"||b==="value"&&E!=null))t.value=t.__value=E;else if(b==="selected"&&c)RU(t,E);else{var g=b;a||(g=vU(g));var y=g==="defaultValue"||g==="defaultChecked";if(E==null&&!o&&!y)if(s[b]=null,g==="value"||g==="checked"){let C=t;const I=e===void 0;if(g==="value"){let x=C.defaultValue;C.removeAttribute(g),C.defaultValue=x,C.value=C.__value=I?x:null}else{let x=C.defaultChecked;C.removeAttribute(g),C.defaultChecked=x,C.checked=I?x:!1}}else t.removeAttribute(b);else y||d.includes(g)&&(o||typeof E!="string")?(t[g]=E,g in s&&(s[g]=dr)):typeof E!="function"&&yn(t,g,E)}}}return l}function wr(t,e,n=[],r=[],i,s=!1){OO(n,r,o=>{var a=void 0,l={},c=t.nodeName==="SELECT",u=!1;if(Oc(()=>{var f=e(...o.map(k)),h=DU(t,a,f,i,s);u&&c&&"value"in f&&qg(t,f.value);for(let m of Object.getOwnPropertySymbols(l))f[m]||vi(l[m]);for(let m of Object.getOwnPropertySymbols(f)){var p=f[m];m.description===xO&&(!a||p!==a[m])&&(l[m]&&vi(l[m]),l[m]=Js(()=>IU(t,()=>p))),h[m]=p}a=h}),c){var d=t;Gp(()=>{qg(d,a.value,!0),s4(d)})}u=!0})}function tb(t){return t.__attributes??={[o4]:t.nodeName.includes("-"),[a4]:t.namespaceURI===P7}}var sC=new Map;function c4(t){var e=t.getAttribute("is")||t.nodeName,n=sC.get(e);if(n)return n;sC.set(e,n=[]);for(var r,i=t,s=Element.prototype;s!==i;){r=mO(i);for(var o in r)r[o].set&&n.push(o);i=Vy(i)}return n}function LU(t,e,n=e){var r=new WeakSet;_S(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=Kw(t)?Gw(s):s,n(s),Tn!==null&&r.add(Tn),await qa(),s!==(s=e())){var o=t.selectionStart,a=t.selectionEnd;t.value=s??"",a!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(a,t.value.length))}}),ls(e)==null&&t.value&&(n(Kw(t)?Gw(t.value):t.value),Tn!==null&&r.add(Tn)),Zp(()=>{var i=e();if(t===document.activeElement){var s=bg??Tn;if(r.has(s))return}Kw(t)&&i===Gw(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function BU(t,e,n=e){_S(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),ls(e)==null&&n(t.checked),Zp(()=>{var r=e();t.checked=!!r})}function Kw(t){var e=t.type;return e==="number"||e==="range"}function Gw(t){return t===""?null:+t}function oC(t,e){return t===e||t?.[$o]===e}function pr(t={},e,n,r){return Gp(()=>{var i,s;return Zp(()=>{i=s,s=[],ls(()=>{t!==n(...s)&&(e(t,...s),i&&oC(n(...i),t)&&e(null,...i))})}),()=>{Kp(()=>{s&&oC(n(...s),t)&&e(null,...s)})}}),t}function OS(t,e,n){if(t==null)return e(void 0),n&&n(void 0),Ut;const r=ls(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const rd=[];function u4(t,e){return{subscribe:Ts(t,e).subscribe}}function Ts(t,e=Ut){let n=null;const r=new Set;function i(a){if(ES(t,a)&&(t=a,n)){const l=!rd.length;for(const c of r)c[1](),rd.push(c,t);if(l){for(let c=0;c<rd.length;c+=2)rd[c][0](rd[c+1]);rd.length=0}}}function s(a){i(a(t))}function o(a,l=Ut){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,s)||Ut),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function $a(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return u4(n,(o,a)=>{let l=!1;const c=[];let u=0,d=Ut;const f=()=>{if(u)return;d();const p=e(r?c[0]:c,o,a);s?o(p):d=typeof p=="function"?p:Ut},h=i.map((p,m)=>OS(p,g=>{c[m]=g,u&=~(1<<m),l&&f()},()=>{u|=1<<m}));return l=!0,f(),function(){yS(h),d(),l=!1}})}function Ys(t){let e;return OS(t,n=>e=n)(),e}let $m=!1,cx=Symbol();function qn(t,e,n){const r=n[e]??={store:null,source:DO(void 0),unsubscribe:Ut};if(r.store!==t&&!(cx in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=Ut;else{var i=!0;r.unsubscribe=OS(t,s=>{i?r.source.v=s:K(r.source,s)}),i=!1}return t&&cx in n?Ys(t):k(r.source)}function oi(){const t={};function e(){CS(()=>{for(var n in t)t[n].unsubscribe();zg(t,cx,{enumerable:!1,value:!0})})}return[t,e]}function FU(t){var e=$m;try{return $m=!1,[t(),$m]}finally{$m=e}}const $U={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function _i(t,e,n){return new Proxy({props:t,exclude:e},$U)}const zU={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(nh(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let i=t.props[r];nh(i)&&(i=i());const s=rc(i,e);if(s&&s.set)return s.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(nh(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const i=rc(r,e);return i&&!i.configurable&&(i.configurable=!0),i}}},has(t,e){if(e===$o||e===wO)return!1;for(let n of t.props)if(nh(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(nh(n)&&(n=n()),!!n){for(const r in n)e.includes(r)||e.push(r);for(const r of Object.getOwnPropertySymbols(n))e.includes(r)||e.push(r)}return e}};function Kn(...t){return new Proxy({props:t},zU)}function le(t,e,n,r){var i=(n&_7)!==0,s=(n&C7)!==0,o=r,a=!0,l=()=>(a&&(a=!1,o=s?ls(r):r),o),c;if(i){var u=$o in t||wO in t;c=rc(t,e)?.set??(u&&e in t?b=>t[e]=b:void 0)}var d,f=!1;i?[d,f]=FU(()=>t[e]):d=t[e],d===void 0&&r!==void 0&&(d=l(),c&&(b7(),c(d)));var h;if(h=()=>{var b=t[e];return b===void 0?l():(a=!0,b)},(n&T7)===0)return h;if(c){var p=t.$$legacy;return(function(b,E){return arguments.length>0?((!E||p||f)&&c(E?h():b),b):h()})}var m=!1,g=((n&k7)!==0?Gy:AO)(()=>(m=!1,h()));i&&k(g);var y=Zt;return(function(b,E){if(arguments.length>0){const C=E?k(g):i?Nt(b):b;return K(g,C),m=!0,o!==void 0&&(o=C),b}return Hu&&m||(y.f&Uu)!==0?g.v:k(g)})}function us(t){si===null&&SS(),Ge(()=>{const e=ls(t);if(typeof e=="function")return e})}function _u(t){si===null&&SS(),us(()=>()=>ls(t))}const UU="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(UU);var HU=Object.defineProperty,VU=(t,e,n)=>e in t?HU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,at=(t,e,n)=>(VU(t,typeof e!="symbol"?e+"":e,n),n);let Qp=class extends Error{},aC=class extends Qp{constructor(e){super(`RxNostrWebSocketError: WebSocket was closed with code ${e} by relay.`),this.code=e,this.name="RxNostrWebSocketError"}},xg=class extends Qp{constructor(e){super(`RxNostrInvalidUsageError: ${e}`),this.name="RxNostrInvalidUsageError"}},Zw=class extends Qp{constructor(e){super(`RxNostrEnvironmentError: ${e}`),this.name="RxNostrEnvironmentError"}},d4=class extends Qp{constructor(){super("RxNostrLogicError: This is rx-nostr's internal bug. Please report to the author of the library."),this.name="RxNostrLogicError"}},ga=class extends Qp{constructor(){super("RxNostrAlreadyDisposedError: Attempted to access a disposed resource."),this.name="RxNostrAlreadyDisposedError"}};const Xp=(t,e)=>({...e,...t});function WU(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function Qw(t){throw t}function jU(t){return{async signEvent(e){var n,r;const i={...e,pubkey:e.pubkey??await((n=window?.nostr)==null?void 0:n.getPublicKey())??Qw(new Zw("window.nostr.getPublicKey() is not found")),tags:[...e.tags??[]],created_at:e.created_at??Math.floor(Date.now()/1e3)};return WU(i)?i:await((r=window?.nostr)==null?void 0:r.signEvent(i))??Qw(new Zw("window.nostr.signEvent() is not found"))},getPublicKey(){var e;return((e=window?.nostr)==null?void 0:e.getPublicKey())??Qw(new Zw("window.nostr.getPublicKey() is not found"))}}}const qU=t=>Xp(t,{signer:jU(),connectionStrategy:"lazy",retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},disconnectTimeout:1e4,eoseTimeout:30*1e3,okTimeout:30*1e3,authTimeout:30*1e3,skipVerify:!1,skipValidateFilterMatching:!1,skipExpirationCheck:!1,skipFetchNip11:!1});function KU(t){return"length"in t?t.map(lC):[lC(t)]}function lC(t){return{...t,since:t.since?cC(t.since):void 0,until:t.until?cC(t.until):void 0}}function cC(t){return typeof t=="number"?t:t()}async function GU(t){try{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws(s?):/,"http$1:"),await(await fetch(e.toString(),{headers:{Accept:"application/nostr+json"}})).json()}catch{return{}}}function uC(t,e){try{return t()}catch(n){return e instanceof Function?e(n):e}}function xa(t){let e="";try{e=t.trim();const n=new URL(e);n.hash="",n.pathname=uC(()=>decodeURI(n.pathname),n.pathname),n.pathname=n.pathname.replace(/\/$/,""),n.hostname=n.hostname.replace(/\.$/,""),n.searchParams.sort(),n.search=uC(()=>decodeURIComponent(n.search),n.search);let r=n.toString();return n.search||(r=r.replace(/\/$/,"")),r}catch{return e}}let Sg=class f4 extends Map{constructor(e){if(super(),!!e)for(const[n,r]of Object.entries(e))this.set(xa(n),r)}get(e){return super.get(xa(e))}getMany(e){const n=[];for(const r of new Set(e.map(xa))){const i=this.get(r);i!==void 0&&n.push(i)}return n}set(e,n){return super.set(xa(e),n)}has(e){return super.has(xa(e))}delete(e){return super.delete(xa(e))}toObject(){const e={};for(const[n,r]of this.entries())e[n]=r;return e}toKeys(){return[...super.keys()]}toValues(){return[...super.values()]}copy(){return new f4(this.toObject())}},Kg=class{static async getValue(e,n,r){if(!(r!=null&&r.skipCache)){const i=await this.cache.get(e);if(i)return n(i)}if(!(r!=null&&r.skipFetch)){const i=await this.fetch(e);if(i)return n(i)}return n(this.default)}static get(e){const n=this.cache.get(e);if(n&&!(n instanceof Promise))return n}static async fetch(e){const n=GU(e);return this.cache.set(e,n),n.then(r=>{this.cache.set(e,r)}),n}static async getOrFetch(e){return this.cache.get(e)??this.fetch(e)}static set(e,n){this.cache.set(e,n)}static getDefault(){return this.default}static setDefault(e){this.default=e}static forget(e){this.cache.delete(e)}static forgetAll(){this.cache.clear()}};at(Kg,"cache",new Sg),at(Kg,"default",{});/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */new Uint8Array(new Uint32Array([287454020]).buffer)[0];function ZU(t,e,n){return Array.isArray(e)?e.some(r=>dC(t,r)):dC(t,e)}function dC(t,e,n){const{sinceInclusive:r,untilInclusive:i}=Xp({},{sinceInclusive:!0,untilInclusive:!0});if(e.ids&&e.ids.every(s=>!t.id.startsWith(s))||e.kinds&&!e.kinds.includes(t.kind)||e.authors&&e.authors.every(s=>!t.pubkey.startsWith(s))||e.since&&(r&&!(e.since<=t.created_at)||!r&&!(e.since<t.created_at))||e.until&&(i&&!(t.created_at<=e.until)||!i&&!(t.created_at<e.until)))return!1;for(const[s,o]of Object.entries(e)){if(!s.startsWith("#")||!Array.isArray(o))continue;const a=s.slice(1);if(!t.tags.find(([l,c])=>a===l&&o.includes(c)))return!1}return!0}function QU(t,e){const n=t.tags.find(r=>r[0]==="expiration");if(!n)return!1;try{const r=Number(n[1]);return Number.isInteger(r)?r<=(e??Math.floor(Date.now()/1e3)):!1}catch{return!1}}var ux=function(t,e){return ux=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},ux(t,e)};function Ja(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ux(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function XU(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}function h4(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Jd(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ef(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function tf(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Rd(t){return this instanceof Rd?(this.v=t,this):new Rd(t)}function YU(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(h){return new Promise(function(p,m){s.push([f,h,p,m])>1||a(f,h)})})}function a(f,h){try{l(r[f](h))}catch(p){d(s[0][3],p)}}function l(f){f.value instanceof Rd?Promise.resolve(f.value.v).then(c,u):d(s[0][2],f)}function c(f){a("next",f)}function u(f){a("throw",f)}function d(f,h){f(h),s.shift(),s.length&&a(s[0][0],s[0][1])}}function JU(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Jd=="function"?Jd(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function tr(t){return typeof t=="function"}function nb(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Xw=nb(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Gg(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Yp=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Jd(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(m){e={error:m}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(tr(u))try{u()}catch(m){s=m instanceof Xw?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Jd(d),h=f.next();!h.done;h=f.next()){var p=h.value;try{fC(p)}catch(m){s=s??[],m instanceof Xw?s=tf(tf([],ef(s)),ef(m.errors)):s.push(m)}}}catch(m){r={error:m}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(s)throw new Xw(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)fC(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Gg(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Gg(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),p4=Yp.EMPTY;function m4(t){return t instanceof Yp||t&&"closed"in t&&tr(t.remove)&&tr(t.add)&&tr(t.unsubscribe)}function fC(t){tr(t)?t():t.unsubscribe()}var e9={Promise:void 0},t9={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,tf([t,e],ef(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function g4(t){t9.setTimeout(function(){throw t})}function dx(){}function Eg(t){t()}var MS=(function(t){Ja(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,m4(n)&&n.add(r)):r.destination=i9,r}return e.create=function(n,r,i){return new Zg(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Yp),n9=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){zm(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){zm(r)}else zm(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){zm(n)}},t})(),Zg=(function(t){Ja(e,t);function e(n,r,i){var s=t.call(this)||this,o;return tr(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new n9(o),s}return e})(MS);function zm(t){g4(t)}function r9(t){throw t}var i9={closed:!0,next:dx,error:r9,complete:dx},NS=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function el(t){return t}function s9(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return y4(t)}function y4(t){return t.length===0?el:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var qi=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=a9(e)?e:new Zg(e,n,r);return Eg(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=hC(n),new n(function(i,s){var o=new Zg({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[NS]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return y4(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=hC(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function hC(t){var e;return(e=t??e9.Promise)!==null&&e!==void 0?e:Promise}function o9(t){return t&&tr(t.next)&&tr(t.error)&&tr(t.complete)}function a9(t){return t&&t instanceof MS||o9(t)&&m4(t)}function l9(t){return tr(t?.lift)}function ai(t){return function(e){if(l9(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function zr(t,e,n,r,i){return new c9(t,e,n,r,i)}var c9=(function(t){Ja(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(MS),u9=nb(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Wn=(function(t){Ja(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new pC(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new u9},e.prototype.next=function(n){var r=this;Eg(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Jd(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;Eg(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Eg(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?p4:(this.currentObservers=null,a.push(n),new Yp(function(){r.currentObservers=null,Gg(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new qi;return n.source=this,n},e.create=function(n,r){return new pC(n,r)},e})(qi),pC=(function(t){Ja(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:p4},e})(Wn),d9=(function(t){Ja(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(Wn),f9={now:function(){return Date.now()}},h9=(function(t){Ja(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(Yp),fx={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=fx.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,tf([t,e],ef(n))):setInterval.apply(void 0,tf([t,e],ef(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},p9=(function(t){Ja(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),fx.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&fx.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Gg(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(h9),mC=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=f9.now,t})(),m9=(function(t){Ja(e,t);function e(n,r){r===void 0&&(r=mC.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(mC),b4=new m9(p9),g9=b4,Jp=new qi(function(t){return t.complete()});function y9(t){return t&&tr(t.schedule)}function RS(t){return t[t.length-1]}function b9(t){return tr(RS(t))?t.pop():void 0}function DS(t){return y9(RS(t))?t.pop():void 0}function w9(t,e){return typeof RS(t)=="number"?t.pop():e}var w4=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function v4(t){return tr(t?.then)}function x4(t){return tr(t[NS])}function S4(t){return Symbol.asyncIterator&&tr(t?.[Symbol.asyncIterator])}function E4(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function v9(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var k4=v9();function T4(t){return tr(t?.[k4])}function _4(t){return YU(this,arguments,function(){var e,n,r,i;return h4(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Rd(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,Rd(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Rd(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function C4(t){return tr(t?.getReader)}function Yo(t){if(t instanceof qi)return t;if(t!=null){if(x4(t))return x9(t);if(w4(t))return S9(t);if(v4(t))return E9(t);if(S4(t))return A4(t);if(T4(t))return k9(t);if(C4(t))return T9(t)}throw E4(t)}function x9(t){return new qi(function(e){var n=t[NS]();if(tr(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function S9(t){return new qi(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function E9(t){return new qi(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,g4)})}function k9(t){return new qi(function(e){var n,r;try{for(var i=Jd(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function A4(t){return new qi(function(e){_9(t,e).catch(function(n){return e.error(n)})})}function T9(t){return A4(_4(t))}function _9(t,e){var n,r,i,s;return XU(this,void 0,void 0,function(){var o,a;return h4(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=JU(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function zo(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function I4(t,e){return e===void 0&&(e=0),ai(function(n,r){n.subscribe(zr(r,function(i){return zo(r,t,function(){return r.next(i)},e)},function(){return zo(r,t,function(){return r.complete()},e)},function(i){return zo(r,t,function(){return r.error(i)},e)}))})}function P4(t,e){return e===void 0&&(e=0),ai(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function C9(t,e){return Yo(t).pipe(P4(e),I4(e))}function A9(t,e){return Yo(t).pipe(P4(e),I4(e))}function I9(t,e){return new qi(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function P9(t,e){return new qi(function(n){var r;return zo(n,e,function(){r=t[k4](),zo(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return tr(r?.return)&&r.return()}})}function O4(t,e){if(!t)throw new Error("Iterable cannot be null");return new qi(function(n){zo(n,e,function(){var r=t[Symbol.asyncIterator]();zo(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function O9(t,e){return O4(_4(t),e)}function M9(t,e){if(t!=null){if(x4(t))return C9(t,e);if(w4(t))return I9(t,e);if(v4(t))return A9(t,e);if(S4(t))return O4(t,e);if(T4(t))return P9(t,e);if(C4(t))return O9(t,e)}throw E4(t)}function em(t,e){return e?M9(t,e):Yo(t)}function M4(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=DS(t);return em(t,n)}var LS=nb(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function N4(t,e){return new Promise(function(n,r){var i=new Zg({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new LS)}});t.subscribe(i)})}function R4(t){return t instanceof Date&&!isNaN(t)}var D4=nb(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function L4(t,e){var n=R4(t)?{first:t}:typeof t=="number"?{each:t}:t,r=n.first,i=n.each,s=n.with,o=s===void 0?N9:s,a=n.scheduler,l=a===void 0?b4:a,c=n.meta,u=c===void 0?null:c;if(r==null&&i==null)throw new TypeError("No timeout provided.");return ai(function(d,f){var h,p,m=null,g=0,y=function(b){p=zo(f,l,function(){try{h.unsubscribe(),Yo(o({meta:u,lastValue:m,seen:g})).subscribe(f)}catch(E){f.error(E)}},b)};h=d.subscribe(zr(f,function(b){p?.unsubscribe(),g++,f.next(m=b),i>0&&y(i)},void 0,void 0,function(){p!=null&&p.closed||p==null||p.unsubscribe(),m=null})),!g&&y(r!=null?typeof r=="number"?r:+r-l.now():i)})}function N9(t){throw new D4(t)}function sc(t,e){return ai(function(n,r){var i=0;n.subscribe(zr(r,function(s){r.next(t.call(e,s,i++))}))})}var R9=Array.isArray;function D9(t,e){return R9(e)?t.apply(void 0,tf([],ef(e))):t(e)}function L9(t){return sc(function(e){return D9(t,e)})}var B9=Array.isArray,F9=Object.getPrototypeOf,$9=Object.prototype,z9=Object.keys;function U9(t){if(t.length===1){var e=t[0];if(B9(e))return{args:e,keys:null};if(H9(e)){var n=z9(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function H9(t){return t&&typeof t=="object"&&F9(t)===$9}function V9(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function W9(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=DS(t),r=b9(t),i=U9(t),s=i.args,o=i.keys;if(s.length===0)return em([],n);var a=new qi(j9(s,n,o?function(l){return V9(o,l)}:el));return r?a.pipe(L9(r)):a}function j9(t,e,n){return n===void 0&&(n=el),function(r){gC(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(u){gC(e,function(){var d=em(t[u],e),f=!1;d.subscribe(zr(r,function(h){s[u]=h,f||(f=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function gC(t,e,n){t?zo(n,t,e):e()}function q9(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,d=!1,f=function(){d&&!l.length&&!c&&e.complete()},h=function(m){return c<r?p(m):l.push(m)},p=function(m){c++;var g=!1;Yo(n(m,u++)).subscribe(zr(e,function(y){e.next(y)},function(){g=!0},void 0,function(){if(g)try{c--;for(var y=function(){var b=l.shift();o?zo(e,o,function(){return p(b)}):p(b)};l.length&&c<r;)y();f()}catch(b){e.error(b)}}))};return t.subscribe(zr(e,h,function(){d=!0,f()})),function(){}}function Qg(t,e,n){return n===void 0&&(n=1/0),tr(e)?Qg(function(r,i){return sc(function(s,o){return e(r,s,i,o)})(Yo(t(r,i)))},n):(typeof e=="number"&&(n=e),ai(function(r,i){return q9(r,i,t,n)}))}function B4(t){return t===void 0&&(t=1/0),Qg(el,t)}function yC(t,e,n){return t===void 0&&(t=0),n===void 0&&(n=g9),new qi(function(r){var i=R4(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){r.closed||(r.next(s++),r.complete())},i)})}function K9(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=DS(t),r=w9(t,1/0),i=t;return i.length?i.length===1?Yo(i[0]):B4(r)(em(i,n)):Jp}function Es(t,e){return ai(function(n,r){var i=0;n.subscribe(zr(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function F4(t){return ai(function(e,n){var r=null,i=!1,s;r=e.subscribe(zr(n,void 0,void 0,function(o){s=Yo(t(o,F4(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function G9(t){return ai(function(e,n){var r=!1;e.subscribe(zr(n,function(i){r=!0,n.next(i)},function(){r||n.next(t),n.complete()}))})}function Z9(t){return t<=0?function(){return Jp}:ai(function(e,n){var r=0;e.subscribe(zr(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function Q9(t,e){return e===void 0&&(e=el),t=t??X9,ai(function(n,r){var i,s=!0;n.subscribe(zr(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function X9(t,e){return t===e}function Y9(t){return t===void 0&&(t=J9),ai(function(e,n){var r=!1;e.subscribe(zr(n,function(i){r=!0,n.next(i)},function(){return r?n.complete():n.error(t())}))})}function J9(){return new LS}function Yw(t){return ai(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function hx(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?Es(function(i,s){return t(i,s,r)}):el,Z9(1),n?G9(e):Y9(function(){return new LS}))}}function eH(t,e){return ai(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(zr(r,function(l){i?.unsubscribe();var c=0,u=s++;Yo(t(l,u)).subscribe(i=zr(r,function(d){return r.next(e?e(l,d,u,c++):d)},function(){i=null,a()}))},function(){o=!0,a()}))})}function tH(){return eH(el)}function sh(t){return ai(function(e,n){Yo(t).subscribe(zr(n,function(){return n.complete()},dx)),!n.closed&&e.subscribe(n)})}function nH(t,e){return ai(function(n,r){var i=0;n.subscribe(zr(r,function(s){var o=t(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function Um(t,e,n){var r=tr(t)||e||n?{next:t,error:e,complete:n}:t;return r?ai(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(zr(s,function(l){var c;(c=r.next)===null||c===void 0||c.call(r,l),s.next(l)},function(){var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),s.complete()},function(l){var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),s.error(l)},function(){var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):el}function rH(t){return Qg((e,n)=>em(t(e,n)).pipe(Qg(r=>r?M4(e):Jp)))}function bC(t){return s9(L4(t),F4(e=>{if(e instanceof D4)return Jp;throw e}))}function Jw(t,e){const{not:n}=Xp(e,{not:!1});return Es(r=>iH(r.subId===t,n))}function iH(t,e){return!t&&e||t&&!e}let sH=class{constructor(e){at(this,"relay"),at(this,"config"),at(this,"authenticator"),at(this,"ongoings",new Set),at(this,"authResult$",new Wn),at(this,"disposed",!1),this.relay=e.relay,this.config=e.config,this.authenticator=e.authenticator;const n=this.relay.getOKObservable().subscribe(i=>{const{eventId:s,ok:o}=i;this.ongoings.has(s)&&(this.ongoings.delete(s),this.authResult$.next(o),o||(n.unsubscribe(),r.unsubscribe()))}),r=this.relay.getAUTHObservable().subscribe(({challenge:i})=>{this.challenge(i)})}getAuthResultObservable(){return this.authResult$.asObservable()}async challenge(e){try{const n=await this.signer.signEvent({kind:22242,content:"",tags:[["relay",this.relay.url],["challenge",e]]});this.ongoings.add(n.id),this.relay.send(["AUTH",n])}catch{}}get signer(){return this.authenticator.signer??this.config.signer}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.authResult$];for(const n of e)n.complete()}},$4=class extends d9{constructor(e){super(e??0)}increment(){this.next(this.getValue()+1)}decrement(){this.next(this.getValue()-1)}next(e){typeof e=="number"?super.next(e):super.next(e(this.getValue()))}},oH=class extends Wn{waitNext(){return N4(this.pipe(hx(null,void 0)))}},aH=class{constructor(e){at(this,"relay"),at(this,"authProxy"),at(this,"pubs",new Map),at(this,"authRequiredPubs",new Set),at(this,"count$",new $4(0)),at(this,"ok$",new Wn),at(this,"disposed",!1);var n;this.relay=e.relay,this.authProxy=e.authProxy,this.relay.getReconnectedObservable().subscribe(r=>{for(const[i,s]of r)i==="EVENT"&&this.pubs.has(s.id)&&this.sendEVENT(s)}),this.relay.getOKObservable().subscribe(async r=>{const{eventId:i,notice:s}=r;this.pubs.get(i)&&(this.authProxy&&s!=null&&s.startsWith("auth-required:")?(this.authRequiredPubs.add(i),this.ok$.next({...r,done:!1})):(this.ok$.next({...r,done:!0}),this.confirmOK(i)))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{if(r)for(const i of this.authRequiredPubs){const s=this.pubs.get(i);s&&this.sendEVENT(s)}else for(const i of this.authRequiredPubs)this.confirmOK(i);this.authRequiredPubs.clear()})}async publish(e){if(!this.disposed)return this.pubs.has(e.id)||(this.pubs.set(e.id,e),this.count$.increment()),this.sendEVENT(e)}confirmOK(e){this.disposed||this.pubs.has(e)||(this.pubs.delete(e),this.count$.decrement())}getOkAgainstEventObservable(){return this.ok$.asObservable()}getLogicalConnectionSizeObservable(){return this.count$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.count$,this.ok$];for(const n of e)n.complete()}sendEVENT(e){return this.relay.send(["EVENT",e])}};const wC={OPEN:1};let lH=class{constructor(e,n){at(this,"socket",null),at(this,"buffer",[]),at(this,"unsent",[]),at(this,"reconnected$",new Wn),at(this,"outgoing$",new Wn),at(this,"message$",new Wn),at(this,"error$",new Wn),at(this,"retryTimer",null),at(this,"sendAttempted$",new oH),at(this,"isFirstTry",!0),at(this,"maybeDown",!1),at(this,"disposed",!1),at(this,"state$",new Wn),at(this,"_state","initialized"),this.url=e,this.config=n,n.skipFetchNip11||Kg.getOrFetch(e),this.setState("initialized")}get state(){return this._state}setState(e){this._state=e,this.state$.next(e)}connectManually(){this.connect()}connect(e){if(this.state==="terminated")return;const n=typeof e=="number";(this.state==="initialized"||this.state==="dormant"||this.state==="error"||this.state==="rejected"||n)&&(this.socket=this.createSocket(e??0))}createSocket(e){const n=this.isFirstTry;this.isFirstTry=!1;let r=!1;const i=e>0,s=this.state==="error"||this.state==="rejected";i?this.setState("retrying"):this.setState("connecting");const o=async()=>{if(this.state==="terminated"){u?.close(fd.RX_NOSTR_DISPOSED);return}this.setState("connected"),r=!0,(i||s)&&(this.reconnected$.next(this.unsent),this.unsent=[]);try{for(const d of this.buffer)this.send(d)}catch(d){this.error$.next(d)}finally{this.buffer=[]}},a=({data:d})=>{if(this.state!=="terminated")try{this.message$.next(this.pack(JSON.parse(d)))}catch(f){this.error$.next(f)}},l=({code:d})=>{var f;if(u?.removeEventListener("open",o),u?.removeEventListener("message",a),u?.removeEventListener("close",l),this.socket===u&&(this.socket=null),this.state==="terminated"||d===fd.RX_NOSTR_DISPOSED){this.unsent=[],this.buffer=[];return}if(d===fd.RX_NOSTR_IDLE)this.setState("dormant"),this.buffer.length>0&&this.connect();else if(d===fd.DONT_RETRY)this.unsent=[],this.buffer=[],this.error$.next(new aC(d)),this.setState("rejected");else{n&&!r&&(this.maybeDown=!0),this.unsent.push(...this.buffer),this.buffer=[],this.error$.next(new aC(d));const h=e+1;this.config.retry.strategy!=="off"&&!(this.config.retry.polite&&this.maybeDown)&&h<=this.config.retry.maxCount?(this.setState("waiting-for-retrying"),(f=this.retryTimer)==null||f.unsubscribe(),this.retryTimer=cH(this.config.retry,h).subscribe(()=>{this.disposed||this.connect(h)})):this.setState("error")}},c=this.config.websocketCtor??globalThis.WebSocket;if(!c)throw new xg("WebSocket constructor is missing");const u=(()=>{try{return new c(this.url)}catch{return l({code:0}),null}})();return u?.addEventListener("open",o),u?.addEventListener("message",a),u?.addEventListener("close",l),u}pack(e){const n=e[0],r=this.url;switch(n){case"EVENT":return{from:r,type:n,message:e,subId:e[1],event:e[2]};case"EOSE":return{from:r,type:n,message:e,subId:e[1]};case"OK":return{from:r,type:n,message:e,eventId:e[1],ok:e[2],notice:e[3]};case"CLOSED":return{from:r,type:n,message:e,subId:e[1],notice:e[2]};case"NOTICE":return{from:r,type:n,message:e,notice:e[1]};case"AUTH":return{from:r,type:n,message:e,challenge:e[1]};case"COUNT":return{from:r,type:n,message:e,subId:e[1],count:e[2]};default:return{from:r,type:"unknown",message:e}}}disconnect(e){var n;((n=this.socket)==null?void 0:n.readyState)===wC.OPEN&&this.socket.close(e)}send(e){const n=this.sendAttempted$.waitNext();switch(this.state){case"terminated":case"rejected":return this.sendAttempted$.next(),n;case"initialized":case"connecting":case"dormant":return this.buffer.push(e),this.connect(),n;case"connected":{if(!this.socket)throw new d4;return this.socket.readyState===wC.OPEN?(this.outgoing$.next({to:this.url,message:e}),this.socket.send(JSON.stringify(e)),this.sendAttempted$.next(),n):(this.buffer.push(e),n)}case"waiting-for-retrying":case"retrying":case"error":return this.sendAttempted$.next(),this.unsent.push(e),n}}getEVENTObservable(){return this.message$.pipe(Es(e=>e.type==="EVENT"))}getEOSEObservable(){return this.message$.pipe(Es(e=>e.type==="EOSE"))}getCLOSEDObservable(){return this.message$.pipe(Es(e=>e.type==="CLOSED"))}getOKObservable(){return this.message$.pipe(Es(e=>e.type==="OK"))}getAUTHObservable(){return this.message$.pipe(Es(e=>e.type==="AUTH"))}getAllMessageObservable(){return this.message$.asObservable()}getOutgoingMessageObservable(){return this.outgoing$.asObservable()}getReconnectedObservable(){return this.reconnected$.asObservable()}getConnectionStateObservable(){return this.state$.pipe(Q9(),sc(e=>({from:this.url,state:e})))}getErrorObservable(){return this.error$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){var e,n;if(this.disposed)return;this.disposed=!0,this.setState("terminated"),(e=this.retryTimer)==null||e.unsubscribe(),(n=this.socket)==null||n.close(fd.RX_NOSTR_DISPOSED),this.socket=null;const r=[this.state$,this.outgoing$,this.message$,this.error$,this.reconnected$,this.sendAttempted$];for(const i of r)i.complete()}};function cH(t,e){switch(t.strategy){case"exponential":{const n=Math.max(t.initialDelay*2**(e-1)+(Math.random()-.5)*1e3,1e3);return yC(n)}case"immediately":return M4(0);case"linear":return yC(t.interval);case"off":return Jp}}const fd={DONT_RETRY:4e3,RX_NOSTR_IDLE:4537,RX_NOSTR_DISPOSED:4538};let uH=class{constructor(e){at(this,"relay"),at(this,"authProxy"),at(this,"config"),at(this,"subs",new Map),at(this,"authRequiredSubs",new Set),at(this,"fin$",new Wn),at(this,"disposed",!1),at(this,"queue");var n;this.relay=e.relay,this.authProxy=e.authProxy,this.config=e.config,this.queue=new dH(this.relay.url,this.config),this.queue.getActivationObservable().subscribe(r=>{for(const{req:i}of r)this.sendREQ(i)}),this.relay.getReconnectedObservable().subscribe(()=>{for(const{req:r}of this.queue.ongoings)this.sendREQ(r)}),this.relay.getEOSEObservable().subscribe(({subId:r})=>{var i;(i=this.subs.get(r))!=null&&i.autoclose&&this.unsubscribe(r)}),this.relay.getCLOSEDObservable().subscribe(async({subId:r,notice:i})=>{this.subs.get(r)&&(this.authProxy&&i!=null&&i.startsWith("auth-required:")?this.authRequiredSubs.add(r):this.fin(r))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{var i;if(r)for(const s of this.authRequiredSubs){const o=(i=this.subs.get(s))==null?void 0:i.req;o&&this.sendREQ(o)}else for(const s of this.authRequiredSubs)this.fin(s);this.authRequiredSubs.clear()})}subscribe(e,n){if(this.disposed)return;const r=e[1],i={subId:r,req:e,autoclose:n};this.subs.set(r,i),this.queue.enqueue(i)}unsubscribe(e){this.disposed||(this.subs.has(e)&&this.sendCLOSE(e),this.fin(e))}isOngoingOrQueued(e){return this.subs.has(e)}getEventObservable(){return this.relay.getEVENTObservable().pipe(Es(({subId:e,event:n})=>{var r;const i=(r=this.subs.get(e))==null?void 0:r.filters;return i?this.config.skipValidateFilterMatching||ZU(n,i):!1}))}getFinObservable(){return this.fin$.asObservable()}getLogicalConnectionSizeObservable(){return this.queue.getSizeObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.fin$];for(const n of e)n.complete();this.queue.dispose()}sendREQ([,e,...n]){const r=KU(n),i=this.subs.get(e);i&&(i.filters=r,this.relay.send(["REQ",e,...r]))}sendCLOSE(e){this.relay.send(["CLOSE",e])}fin(e){this.subs.delete(e),this.queue.drop(e),this.fin$.next({from:this.relay.url,subId:e})}},dH=class{constructor(e,n){at(this,"_queuings",[]),at(this,"_ongoings",[]),at(this,"activated$",new Wn),at(this,"count$",new $4),this.url=e,this.config=n}get queuings(){return this._queuings}set queuings(e){this._queuings=e}get ongoings(){return this._ongoings}set ongoings(e){this._ongoings=e}enqueue(e){this.queuings=[...this.queuings,e],this.count$.increment(),this.shift()}drop(e){const n=(a,l)=>{const c=a.length,u=a.filter(f=>f.subId!==l),d=c-u.length;return[u,d]},[r,i]=n(this.queuings,e),[s,o]=n(this.ongoings,e);this.queuings=r,this.ongoings=s,this.count$.next(a=>a-(i+o)),this.shift()}getActivationObservable(){return this.activated$.asObservable()}getSizeObservable(){return this.count$.asObservable()}dispose(){const e=[this.activated$,this.count$];for(const n of e)n.complete()}async shift(){const e=await this.capacity(),n=[...this.ongoings,...this.queuings],r=n.slice(0,e),i=n.slice(e),s=this.queuings.slice(0,e-this.ongoings.length);this.ongoings=r,this.queuings=i,s.length>0&&this.activated$.next(s)}async capacity(){return await Kg.getValue(this.url,e=>{var n;return(n=e.limitation)==null?void 0:n.max_subscriptions},{skipFetch:this.config.skipFetchNip11})??1/0}},fH=class{constructor(e,n){at(this,"relay"),at(this,"pubProxy"),at(this,"subProxy"),at(this,"defaultSubscriptionIds",new Set),at(this,"communicating",!1),at(this,"strategy","lazy"),at(this,"disconnectTimeout"),at(this,"disconnectTimer"),at(this,"isDefaultRelay",!1),at(this,"disposed",!1),at(this,"_url"),this._url=xa(e);const r=hH(e,n),i=new lH(this.url,n),s=r?new sH({relay:i,config:n,authenticator:r}):null,o=new aH({relay:i,authProxy:s}),a=new uH({relay:i,authProxy:s,config:n});this.relay=i,this.pubProxy=o,this.subProxy=a,this.disconnectTimeout=n.disconnectTimeout,W9([this.pubProxy.getLogicalConnectionSizeObservable(),this.subProxy.getLogicalConnectionSizeObservable()]).pipe(sc(([l,c])=>l+c)).subscribe(l=>{this.communicating=l>0,this.resetConnection()})}get url(){return this._url}setConnectionStrategy(e){this.disposed||(this.strategy=e,this.resetConnection())}resetConnection(){let e=this.strategy;switch(this.isDefaultRelay||(e="lazy"),e){case"lazy":{const n=()=>{this.communicating||this.relay.disconnect(fd.RX_NOSTR_IDLE)};this.disconnectTimeout>0?(this.disconnectTimeout&&(clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0),this.disconnectTimer=setTimeout(n,this.disconnectTimeout)):n();break}case"lazy-keep":break;case"aggressive":{(this.connectionState==="initialized"||this.connectionState==="dormant")&&this.relay.connectManually();break}}}markAsDefault(e){if(!this.disposed){if(this.isDefaultRelay=e,!this.isDefaultRelay){for(const n of this.defaultSubscriptionIds)this.subProxy.unsubscribe(n);this.defaultSubscriptionIds.clear()}this.resetConnection()}}async publish(e){if(!this.disposed)return this.pubProxy.publish(e)}confirmOK(e){this.disposed||this.pubProxy.confirmOK(e)}subscribe(e,n){if(this.disposed)return;const{mode:r,overwrite:i,autoclose:s}=Xp(n??{},{overwrite:!1,autoclose:!1,mode:"default"}),[,o]=e;r==="default"&&!this.isDefaultRelay||!i&&this.subProxy.isOngoingOrQueued(o)||(r==="default"&&this.defaultSubscriptionIds.add(o),this.subProxy.subscribe(e,s))}unsubscribe(e){this.disposed||(this.defaultSubscriptionIds.delete(e),this.subProxy.unsubscribe(e))}getEventObservable(){if(this.disposed)throw new ga;return this.subProxy.getEventObservable()}getFinObservable(){if(this.disposed)throw new ga;return this.subProxy.getFinObservable()}getOkAgainstEventObservable(){if(this.disposed)throw new ga;return this.pubProxy.getOkAgainstEventObservable()}getAllMessageObservable(){if(this.disposed)throw new ga;return this.relay.getAllMessageObservable()}getOutgoingMessageObservable(){if(this.disposed)throw new ga;return this.relay.getOutgoingMessageObservable()}getConnectionStateObservable(){if(this.disposed)throw new ga;return this.relay.getConnectionStateObservable()}get connectionState(){return this.relay.state}getErrorObservable(){if(this.disposed)throw new ga;return this.relay.getErrorObservable().pipe(sc(e=>({from:this.url,reason:e})))}connectManually(){this.relay.connectManually()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){this.disposed||(this.disposed=!0,this.disconnectTimer&&clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0,this.relay.dispose(),this.pubProxy.dispose(),this.subProxy.dispose())}};function hH(t,e){const n=e.authenticator;if(!n)return;const r=n instanceof Function?n(t):n;return r==="auto"?{}:r}function pH(t,e){return t.filter(n=>!e.includes(n))}function mH(t){const{rxReq:e,index:n}=t,{rxReqId:r,strategy:i}=e;return`${r}:${i==="backward"?n:0}`}function gH(t){const{rxReq:e,filters:n,index:r}=t;return["REQ",mH({rxReq:e,index:r}),...n]}function vC(t){if(Array.isArray(t)){const e=t.map(n=>{let r="",i=!1,s=!1;if(typeof n=="string")r=n,i=!0,s=!0;else if(Array.isArray(n)){const o=n[2];r=n[1],i=!o||o==="read",s=!o||o==="write"}else r=n.url,i=n.read,s=n.write;return{url:r,read:i,write:s}});return Object.fromEntries(e.map(n=>[n.url,n]))}else{const e=Object.entries(t).map(([n,r])=>({url:n,...r}));return Object.fromEntries(e.map(n=>[n.url,n]))}}function xC(t,e){const n=new Set;if(e!=null&&e.on){const r=e.on;if(!r.defaultReadRelays&&!r.defaultWriteRelays&&!r.relays)return;const i=t.getDefaultRelays();if(r.defaultReadRelays)for(const{url:s}of Object.values(i).filter(o=>o.read))n.add(s);if(r.defaultWriteRelays)for(const{url:s}of Object.values(i).filter(o=>o.write))n.add(s);if(r.relays)for(const s of r.relays)n.add(xa(s));return[...n]}else if(e!=null&&e.relays){for(const r of e.relays)n.add(xa(r));return[...n]}else return}function yH(t){return new bH(qU(t??{}))}let bH=class{constructor(e){at(this,"connections",new Sg),at(this,"defaultRelays",new Sg),at(this,"defaultSubscriptions",new Map),at(this,"event$",new Wn),at(this,"fin$",new Wn),at(this,"ok$",new Wn),at(this,"all$",new Wn),at(this,"error$",new Wn),at(this,"connectionState$",new Wn),at(this,"outgoing$",new Wn),at(this,"dispose$",new Wn),at(this,"disposed",!1),this.config=e}get defaultReadables(){const e=[];for(const{url:n,read:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}get defaultWritables(){const e=[];for(const{url:n,write:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}getDefaultRelays(){if(this.disposed)throw new ga;return this.defaultRelays.toObject()}getDefaultRelay(e){return this.defaultRelays.get(e)}setDefaultRelays(e){if(this.disposed)throw new ga;const n=new Sg(vC(e)),r=[];for(const{read:i,url:s}of n.values()){const o=this.ensureNostrConnection(s);o.setConnectionStrategy(this.config.connectionStrategy),i&&r.push(o)}this.updateDefaultSubscriptions(r),this.defaultRelays=n}ensureNostrConnection(e){let n=this.connections.get(e);return n||(n=new fH(e,this.config),this.attachNostrConnection(n),this.connections.set(e,n),n)}attachNostrConnection(e){e.getEventObservable().subscribe(this.event$),e.getFinObservable().subscribe(this.fin$),e.getOkAgainstEventObservable().subscribe(this.ok$),e.getAllMessageObservable().subscribe(this.all$),e.getConnectionStateObservable().subscribe(this.connectionState$),e.getErrorObservable().subscribe(this.error$),e.getOutgoingMessageObservable().subscribe(this.outgoing$)}updateDefaultSubscriptions(e){const n=pH(this.defaultReadables,e);for(const r of n)r.markAsDefault(!1);for(const r of e){r.markAsDefault(!0);for(const{req:i,autoclose:s}of this.defaultSubscriptions.values())r?.subscribe(i,{mode:"default",overwrite:!1,autoclose:s})}}addDefaultRelays(e){const n=vC(e);this.setDefaultRelays({...this.defaultRelays.toObject(),...n})}removeDefaultRelays(e){const n=this.defaultRelays.copy(),r=Array.isArray(e)?e:[e];for(const i of r)n.delete(i);this.setDefaultRelays(n.toObject())}getAllRelayStatus(){return Object.fromEntries(Array.from(this.connections.values()).map(e=>[e.url,{connection:e.connectionState}]))}getRelayStatus(e){const n=this.connections.get(e);if(n)return{connection:n.connectionState}}reconnect(e){const n=this.getDefaultRelay(e);if(!n)throw new xg(`The relay (${e}) is not a default relay. \`reconnect()\` can be used only for a readable default relay.`);if(!n.read)throw new xg(`The relay (${e}) is not readable. \`reconnect()\` can be used only for a readable default relay.`);const r=this.connections.get(e);if(!r)throw new d4;(r.connectionState==="error"||r.connectionState==="rejected")&&r.connectManually()}use(e,n){const r=xC(this,n),i=({filters:u,relays:d},f)=>{var h;const p=e.strategy==="backward"?d:void 0,m=gH({rxReq:e,filters:u,index:f});return{subId:m[1],req:m,targetConnections:((h=p??r)==null?void 0:h.map(g=>this.ensureNostrConnection(g)))??this.defaultReadables,mode:p===void 0&&r===void 0?"default":"temporary"}},s=({req:u,targetConnections:d,mode:f})=>{this.startSubscription({req:u,targetConnections:d,mode:f,overwrite:e.strategy==="forward",autoclose:e.strategy==="backward"})},o=({subId:u,targetConnections:d,mode:f})=>{this.teardownSubscription({subId:u,targetConnections:d,mode:f})},a=({req:u,targetConnections:d})=>e.strategy==="forward"?this.createForwardEventObservable({req:u}).pipe(sh(this.dispose$)):this.createBackwardEventObservable({req:u,targetConnections:d}).pipe(sh(this.dispose$)),l=e.getReqPacketObservable().pipe(Es(({filters:u})=>u.length>0),sc(i),sh(this.dispose$)),c=()=>rH(async({event:u})=>(this.config.skipVerify||await this.config.verifier(u))&&(this.config.skipExpirationCheck||!QU(u)));if(e.strategy==="forward"){let u;return l.pipe(Um(d=>{u=d}),Um(s),sc(a),Yw(()=>{u&&o(u)}),tH(),c())}else return l.pipe(Um(s),sc(u=>a(u).pipe(Yw(()=>{o(u)}))),B4(),c())}createForwardEventObservable(e){const{req:n}=e,r=n[1];return this.event$.pipe(Jw(r))}createBackwardEventObservable(e){const{req:n,targetConnections:r}=e,i=n[1],s=new Set,o=u=>u==="error"||u==="rejected"||u==="terminated",a=()=>r.every(({connectionState:u,url:d})=>o(u)||s.has(d)),l=this.fin$.pipe(Jw(i),Um(({from:u})=>{s.add(u)})),c=K9(l,this.connectionState$.asObservable()).pipe(Es(()=>a()),hx(null,void 0));return this.event$.pipe(sh(c),bC(this.config.eoseTimeout),Jw(i),Es(u=>!s.has(u.from)))}startSubscription(e){const{req:n,targetConnections:r,mode:i,overwrite:s,autoclose:o}=e,a=n[1];i==="default"&&this.defaultSubscriptions.set(a,{req:n,autoclose:o});for(const l of r)l.subscribe(n,{mode:i,overwrite:s,autoclose:o})}teardownSubscription(e){const{subId:n,targetConnections:r,mode:i}=e;i==="default"&&this.defaultSubscriptions.delete(n);for(const s of r)s.unsubscribe(n)}createAllEventObservable(){return this.event$.asObservable()}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.all$.asObservable()}createConnectionStateObservable(){return this.connectionState$.asObservable()}createOutgoingMessageObservable(){return this.outgoing$.asObservable()}send(e,n){const{signer:r,errorOnTimeout:i,completeOn:s}=Xp(n??{},{signer:this.config.signer,errorOnTimeout:!1,completeOn:"all-ok"}),o=xC(this,n),a=o===void 0?this.defaultWritables:o.map(h=>this.ensureNostrConnection(h)),l=new Wn,c=new Set;let u="";const d=()=>{l.closed||l.complete();for(const h of a)h.confirmOK(u)};r.signEvent(e).then(async h=>{l.closed||(u=h.id,this.ok$.pipe(Es(({eventId:p})=>p===h.id)).subscribe(l),await Promise.all(a.map(p=>p.publish(h))),s==="sent"&&l.complete())}).catch(h=>{throw d(),new xg(h instanceof Error?h.message:"Failed to sign the given event")});const f=(()=>{switch(s){case"sent":return el;case"all-ok":return nH(({from:h,done:p})=>(p&&c.add(h),c.size<a.length),!0);case"any-ok":return hx(h=>h.ok)}})();return l.pipe(f,sh(this.dispose$),i?L4(this.config.okTimeout):bC(this.config.okTimeout),Yw(d))}async cast(e,n){await N4(this.send(e,{...n,completeOn:"sent"}))}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;for(const n of this.connections.values())n.dispose();this.connections.clear();const e=[this.event$,this.ok$,this.fin$,this.all$,this.connectionState$,this.error$,this.outgoing$];for(const n of e)n.complete();this.dispose$.next(),this.dispose$.complete()}};const z4=t=>{const{strategy:e}=t,n=t.operators??[],r=t.rxReqId??wH(),i=t.subject??new Wn;return{strategy:e,rxReqId:r,getReqPacketObservable(){return i.pipe(...n)},pipe(...s){return z4({strategy:e,rxReqId:r,operators:[...n,...s],subject:i})},emit(s,o){i.next({filters:xH(s),...o??{}})},over(){i.complete()}}};function Xg(t){return z4({strategy:"backward",rxReqId:t})}function wH(){return`${Math.floor(Math.random()*1e6)}`}function vH(t){var e,n;const r={},i=s=>/^#[a-zA-Z]$/.test(s);for(const s of Object.keys(t)){if(s==="limit"&&(t[s]??-1)>=0){r[s]=t[s];continue}if(s==="since"||s==="until"){const o=t[s];if(typeof o!="number"||(o??-1)>=0){r[s]=o;continue}}if((i(s)||s==="ids"||s==="authors")&&t[s]!==void 0&&(((e=t[s])==null?void 0:e.length)??-1)>0){r[s]=t[s];continue}if(s==="kinds"&&t[s]!==void 0&&(((n=t[s])==null?void 0:n.length)??-1)>0){r[s]=t[s];continue}if(s==="search"&&t[s]!==void 0){r[s]=t[s];continue}}return typeof r.since!="number"||typeof r.until!="number"||r.since<=r.until?r:null}function xH(t){return(Array.isArray(t)?t:[t]).map(e=>vH(e)).filter(e=>e!==null)}function SC(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function SH(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function tm(t,...e){if(!SH(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function EH(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");SC(t.outputLen),SC(t.blockLen)}function Yg(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function kH(t,e){tm(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ev=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const tv=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),fo=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const TH=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Jg(t){tm(t);let e="";for(let n=0;n<t.length;n++)e+=TH[t[n]];return e}function _H(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function BS(t){return typeof t=="string"&&(t=_H(t)),tm(t),t}function CH(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];tm(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}let U4=class{clone(){return this._cloneInto()}};function AH(t){const e=r=>t().update(BS(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function H4(t=32){if(ev&&typeof ev.getRandomValues=="function")return ev.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function IH(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const PH=(t,e,n)=>t&e^~t&n,OH=(t,e,n)=>t&e^t&n^e&n;let MH=class extends U4{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=tv(this.buffer)}update(e){Yg(this);const{view:n,buffer:r,blockLen:i}=this;e=BS(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=tv(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Yg(this),kH(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;IH(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=tv(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const NH=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),xl=new Uint32Array(64);let RH=class extends MH{constructor(){super(64,32,8,!1),this.A=vl[0]|0,this.B=vl[1]|0,this.C=vl[2]|0,this.D=vl[3]|0,this.E=vl[4]|0,this.F=vl[5]|0,this.G=vl[6]|0,this.H=vl[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)xl[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=xl[d-15],h=xl[d-2],p=fo(f,7)^fo(f,18)^f>>>3,m=fo(h,17)^fo(h,19)^h>>>10;xl[d]=m+xl[d-7]+p+xl[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=fo(a,6)^fo(a,11)^fo(a,25),h=u+f+PH(a,l,c)+NH[d]+xl[d]|0,p=(fo(r,2)^fo(r,13)^fo(r,22))+OH(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){xl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const e0=AH(()=>new RH);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const V4=BigInt(0),rb=BigInt(1),DH=BigInt(2);function Cu(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function nm(t){if(!Cu(t))throw new Error("Uint8Array expected")}const LH=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function nf(t){nm(t);let e="";for(let n=0;n<t.length;n++)e+=LH[t[n]];return e}function W4(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function FS(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}const ca={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function EC(t){if(t>=ca._0&&t<=ca._9)return t-ca._0;if(t>=ca._A&&t<=ca._F)return t-(ca._A-10);if(t>=ca._a&&t<=ca._f)return t-(ca._a-10)}function rf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=EC(t.charCodeAt(s)),a=EC(t.charCodeAt(s+1));if(o===void 0||a===void 0){const l=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function Hi(t){return FS(nf(t))}function $S(t){return nm(t),FS(nf(Uint8Array.from(t).reverse()))}function bc(t,e){return rf(t.toString(16).padStart(e*2,"0"))}function zS(t,e){return bc(t,e).reverse()}function BH(t){return rf(W4(t))}function Zr(t,e,n){let r;if(typeof e=="string")try{r=rf(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Cu(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Au(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];nm(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}function FH(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function $H(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function zH(t){let e;for(e=0;t>V4;t>>=rb,e+=1);return e}function UH(t,e){return t>>BigInt(e)&rb}function HH(t,e,n){return t|(n?rb:V4)<<BigInt(e)}const US=t=>(DH<<BigInt(t-1))-rb,nv=t=>new Uint8Array(t),kC=t=>Uint8Array.from(t);function j4(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=nv(t),i=nv(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=nv())=>{i=a(kC([0]),u),r=a(),u.length!==0&&(i=a(kC([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){r=a();const f=r.slice();d.push(f),u+=r.length}return Au(...d)};return(u,d)=>{o(),l(u);let f;for(;!(f=d(c()));)l();return o(),f}}const VH={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Cu(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function rm(t,e,n={}){const r=(i,s,o)=>{const a=VH[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const WH=Object.freeze(Object.defineProperty({__proto__:null,abytes:nm,bitGet:UH,bitLen:zH,bitMask:US,bitSet:HH,bytesToHex:nf,bytesToNumberBE:Hi,bytesToNumberLE:$S,concatBytes:Au,createHmacDrbg:j4,ensureBytes:Zr,equalBytes:FH,hexToBytes:rf,hexToNumber:FS,isBytes:Cu,numberToBytesBE:bc,numberToBytesLE:zS,numberToHexUnpadded:W4,numberToVarBytesBE:BH,utf8ToBytes:$H,validateObject:rm},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const vr=BigInt(0),Jn=BigInt(1),Yc=BigInt(2),jH=BigInt(3),px=BigInt(4),TC=BigInt(5),_C=BigInt(8);BigInt(9);BigInt(16);function Nr(t,e){const n=t%e;return n>=vr?n:e+n}function qH(t,e,n){if(n<=vr||e<vr)throw new Error("Expected power/modulo > 0");if(n===Jn)return vr;let r=Jn;for(;e>vr;)e&Jn&&(r=r*t%n),t=t*t%n,e>>=Jn;return r}function fs(t,e,n){let r=t;for(;e-- >vr;)r*=r,r%=n;return r}function mx(t,e){if(t===vr||e<=vr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Nr(t,e),r=e,i=vr,s=Jn;for(;n!==vr;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==Jn)throw new Error("invert: does not exist");return Nr(i,e)}function KH(t){const e=(t-Jn)/Yc;let n,r,i;for(n=t-Jn,r=0;n%Yc===vr;n/=Yc,r++);for(i=Yc;i<t&&qH(i,e,t)!==t-Jn;i++);if(r===1){const o=(t+Jn)/px;return function(a,l){const c=a.pow(l,o);if(!a.eql(a.sqr(c),l))throw new Error("Cannot find square root");return c}}const s=(n+Jn)/Yc;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let l=r,c=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),d=o.pow(a,n);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let f=1;for(let p=o.sqr(d);f<l&&!o.eql(p,o.ONE);f++)p=o.sqr(p);const h=o.pow(c,Jn<<BigInt(l-f-1));c=o.sqr(h),u=o.mul(u,h),d=o.mul(d,c),l=f}return u}}function GH(t){if(t%px===jH){const e=(t+Jn)/px;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%_C===TC){const e=(t-TC)/_C;return function(n,r){const i=n.mul(r,Yc),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Yc),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return KH(t)}const ZH=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function QH(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=ZH.reduce((r,i)=>(r[i]="function",r),e);return rm(t,n)}function XH(t,e,n){if(n<vr)throw new Error("Expected power > 0");if(n===vr)return t.ONE;if(n===Jn)return e;let r=t.ONE,i=e;for(;n>vr;)n&Jn&&(r=t.mul(r,i)),i=t.sqr(i),n>>=Jn;return r}function YH(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function q4(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function JH(t,e,n=!1,r={}){if(t<=vr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=q4(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=GH(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:US(i),ZERO:vr,ONE:Jn,create:l=>Nr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return vr<=l&&l<t},is0:l=>l===vr,isOdd:l=>(l&Jn)===Jn,neg:l=>Nr(-l,t),eql:(l,c)=>l===c,sqr:l=>Nr(l*l,t),add:(l,c)=>Nr(l+c,t),sub:(l,c)=>Nr(l-c,t),mul:(l,c)=>Nr(l*c,t),pow:(l,c)=>XH(a,l,c),div:(l,c)=>Nr(l*mx(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>mx(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>YH(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?zS(l,s):bc(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?$S(l):Hi(l)}});return Object.freeze(a)}function K4(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function G4(t){const e=K4(t);return e+Math.ceil(e/2)}function eV(t,e,n=!1){const r=t.length,i=K4(e),s=G4(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Hi(t):$S(t),a=Nr(o,e-Jn)+Jn;return n?zS(a,i):bc(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const tV=BigInt(0),rv=BigInt(1);function nV(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>tV;)s&rv&&(o=o.add(a)),a=a.double(),s>>=rv;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let d=0;d<o;d++){u=c,l.push(u);for(let f=1;f<a;f++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const d=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const m=p*l;let g=Number(o&d);o>>=h,g>l&&(g-=f,o+=rv);const y=m,b=m+Math.abs(g)-1,E=p%2!==0,C=g<0;g===0?u=u.add(n(E,s[y])):c=c.add(n(C,s[b]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function Z4(t){return QH(t.Fp),rm(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...q4(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function rV(t){const e=Z4(t);rm(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:iV,hexToBytes:sV}=WH,nu={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=nu;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:iV(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=nu,n=typeof t=="string"?sV(t):t;nm(n);let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=nu._parseInt(n.subarray(2)),{d:o,l:a}=nu._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},_a=BigInt(0),bs=BigInt(1);BigInt(2);const CC=BigInt(3);BigInt(4);function oV(t){const e=rV(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return Au(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1),g=n.fromBytes(m.subarray(0,n.BYTES)),y=n.fromBytes(m.subarray(n.BYTES,2*n.BYTES));return{x:g,y}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&_a<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(Cu(p)&&(p=nf(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let E;try{E=typeof p=="bigint"?p:Hi(Zr("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(E=Nr(E,b)),a(E),E}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=E=>n.eql(E,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map(y=>y.pz));return m.map((y,b)=>y.toAffine(g[b])).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(Zr("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:E,py:C,pz:I}=m,x=n.eql(n.mul(g,I),n.mul(E,b)),P=n.eql(n.mul(y,I),n.mul(C,b));return x&&P}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,CC),{px:b,py:E,pz:C}=this;let I=n.ZERO,x=n.ZERO,P=n.ZERO,T=n.mul(b,b),S=n.mul(E,E),_=n.mul(C,C),O=n.mul(b,E);return O=n.add(O,O),P=n.mul(b,C),P=n.add(P,P),I=n.mul(m,P),x=n.mul(y,_),x=n.add(I,x),I=n.sub(S,x),x=n.add(S,x),x=n.mul(I,x),I=n.mul(O,I),P=n.mul(y,P),_=n.mul(m,_),O=n.sub(T,_),O=n.mul(m,O),O=n.add(O,P),P=n.add(T,T),T=n.add(P,T),T=n.add(T,_),T=n.mul(T,O),x=n.add(x,T),_=n.mul(E,C),_=n.add(_,_),T=n.mul(_,O),I=n.sub(I,T),P=n.mul(_,S),P=n.add(P,P),P=n.add(P,P),new d(I,x,P)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:E,py:C,pz:I}=m;let x=n.ZERO,P=n.ZERO,T=n.ZERO;const S=e.a,_=n.mul(e.b,CC);let O=n.mul(g,E),F=n.mul(y,C),L=n.mul(b,I),B=n.add(g,y),N=n.add(E,C);B=n.mul(B,N),N=n.add(O,F),B=n.sub(B,N),N=n.add(g,b);let M=n.add(E,I);return N=n.mul(N,M),M=n.add(O,L),N=n.sub(N,M),M=n.add(y,b),x=n.add(C,I),M=n.mul(M,x),x=n.add(F,L),M=n.sub(M,x),T=n.mul(S,N),x=n.mul(_,L),T=n.add(x,T),x=n.sub(F,T),T=n.add(F,T),P=n.mul(x,T),F=n.add(O,O),F=n.add(F,O),L=n.mul(S,L),N=n.mul(_,N),F=n.add(F,L),L=n.sub(O,L),L=n.mul(S,L),N=n.add(N,L),O=n.mul(F,N),P=n.add(P,O),O=n.mul(M,N),x=n.mul(B,x),x=n.sub(x,O),O=n.mul(B,F),T=n.mul(M,T),T=n.add(T,O),new d(x,P,T)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,g=>{const y=n.invertBatch(g.map(b=>b.pz));return g.map((b,E)=>b.toAffine(y[E])).map(d.fromAffine)})}multiplyUnsafe(m){const g=d.ZERO;if(m===_a)return g;if(a(m),m===bs)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:E,k2neg:C,k2:I}=y.splitScalar(m),x=g,P=g,T=this;for(;E>_a||I>_a;)E&bs&&(x=x.add(T)),I&bs&&(P=P.add(T)),T=T.double(),E>>=bs,I>>=bs;return b&&(x=x.negate()),C&&(P=P.negate()),P=new d(n.mul(P.px,y.beta),P.py,P.pz),x.add(P)}multiply(m){a(m);let g=m,y,b;const{endo:E}=e;if(E){const{k1neg:C,k1:I,k2neg:x,k2:P}=E.splitScalar(g);let{p:T,f:S}=this.wNAF(I),{p:_,f:O}=this.wNAF(P);T=h.constTimeNegate(C,T),_=h.constTimeNegate(x,_),_=new d(n.mul(_.px,E.beta),_.py,_.pz),y=T.add(_),b=S.add(O)}else{const{p:C,f:I}=this.wNAF(g);y=C,b=I}return d.normalizeZ([y,b])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,E=(I,x)=>x===_a||x===bs||!I.equals(b)?I.multiplyUnsafe(x):I.multiply(x),C=E(this,g).add(E(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,E=this.is0();m==null&&(m=E?n.ONE:n.inv(b));const C=n.mul(g,m),I=n.mul(y,m),x=n.mul(b,m);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:C,y:I}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===bs)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===bs?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return nf(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=nV(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function aV(t){const e=Z4(t);return rm(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function lV(t){const e=aV(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(N){return _a<N&&N<n.ORDER}function a(N){return Nr(N,r)}function l(N){return mx(N,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=oV({...e,toBytes(N,M,R){const H=M.toAffine(),z=n.toBytes(H.x),V=Au;return R?V(Uint8Array.from([M.hasEvenY()?2:3]),z):V(Uint8Array.from([4]),z,n.toBytes(H.y))},fromBytes(N){const M=N.length,R=N[0],H=N.subarray(1);if(M===i&&(R===2||R===3)){const z=Hi(H);if(!o(z))throw new Error("Point is not on curve");const V=d(z);let Q;try{Q=n.sqrt(V)}catch(ie){const ne=ie instanceof Error?": "+ie.message:"";throw new Error("Point is not on curve"+ne)}const Y=(Q&bs)===bs;return(R&1)===1!==Y&&(Q=n.neg(Q)),{x:z,y:Q}}else if(M===s&&R===4){const z=n.fromBytes(H.subarray(0,n.BYTES)),V=n.fromBytes(H.subarray(n.BYTES,2*n.BYTES));return{x:z,y:V}}else throw new Error(`Point of length ${M} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=N=>nf(bc(N,e.nByteLength));function p(N){const M=r>>bs;return N>M}function m(N){return p(N)?a(-N):N}const g=(N,M,R)=>Hi(N.slice(M,R));class y{constructor(M,R,H){this.r=M,this.s=R,this.recovery=H,this.assertValidity()}static fromCompact(M){const R=e.nByteLength;return M=Zr("compactSignature",M,R*2),new y(g(M,0,R),g(M,R,2*R))}static fromDER(M){const{r:R,s:H}=nu.toSig(Zr("DER",M));return new y(R,H)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(M){return new y(this.r,this.s,M)}recoverPublicKey(M){const{r:R,s:H,recovery:z}=this,V=P(Zr("msgHash",M));if(z==null||![0,1,2,3].includes(z))throw new Error("recovery id invalid");const Q=z===2||z===3?R+e.n:R;if(Q>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const Y=z&1?"03":"02",ie=c.fromHex(Y+h(Q)),ne=l(Q),J=a(-V*ne),ke=a(H*ne),ze=c.BASE.multiplyAndAddUnsafe(ie,J,ke);if(!ze)throw new Error("point at infinify");return ze.assertValidity(),ze}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return rf(this.toDERHex())}toDERHex(){return nu.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return rf(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const b={isValidPrivateKey(N){try{return u(N),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const N=G4(e.n);return eV(e.randomBytes(N),e.n)},precompute(N=8,M=c.BASE){return M._setWindowSize(N),M.multiply(BigInt(3)),M}};function E(N,M=!0){return c.fromPrivateKey(N).toRawBytes(M)}function C(N){const M=Cu(N),R=typeof N=="string",H=(M||R)&&N.length;return M?H===i||H===s:R?H===2*i||H===2*s:N instanceof c}function I(N,M,R=!0){if(C(N))throw new Error("first arg must be private key");if(!C(M))throw new Error("second arg must be public key");return c.fromHex(M).multiply(u(N)).toRawBytes(R)}const x=e.bits2int||function(N){const M=Hi(N),R=N.length*8-e.nBitLength;return R>0?M>>BigInt(R):M},P=e.bits2int_modN||function(N){return a(x(N))},T=US(e.nBitLength);function S(N){if(typeof N!="bigint")throw new Error("bigint expected");if(!(_a<=N&&N<T))throw new Error(`bigint expected < 2^${e.nBitLength}`);return bc(N,e.nByteLength)}function _(N,M,R=O){if(["recovered","canonical"].some(Ee=>Ee in R))throw new Error("sign() legacy options not supported");const{hash:H,randomBytes:z}=e;let{lowS:V,prehash:Q,extraEntropy:Y}=R;V==null&&(V=!0),N=Zr("msgHash",N),Q&&(N=Zr("prehashed msgHash",H(N)));const ie=P(N),ne=u(M),J=[S(ne),S(ie)];if(Y!=null&&Y!==!1){const Ee=Y===!0?z(n.BYTES):Y;J.push(Zr("extraEntropy",Ee))}const ke=Au(...J),ze=ie;function he(Ee){const Le=x(Ee);if(!f(Le))return;const pe=l(Le),xe=c.BASE.multiply(Le).toAffine(),Me=a(xe.x);if(Me===_a)return;const Ue=a(pe*a(ze+Me*ne));if(Ue===_a)return;let qe=(xe.x===Me?0:2)|Number(xe.y&bs),tt=Ue;return V&&p(Ue)&&(tt=m(Ue),qe^=1),new y(Me,tt,qe)}return{seed:ke,k2sig:he}}const O={lowS:e.lowS,prehash:!1},F={lowS:e.lowS,prehash:!1};function L(N,M,R=O){const{seed:H,k2sig:z}=_(N,M,R),V=e;return j4(V.hash.outputLen,V.nByteLength,V.hmac)(H,z)}c.BASE._setWindowSize(8);function B(N,M,R,H=F){var z;const V=N;if(M=Zr("msgHash",M),R=Zr("publicKey",R),"strict"in H)throw new Error("options.strict was renamed to lowS");const{lowS:Q,prehash:Y}=H;let ie,ne;try{if(typeof V=="string"||Cu(V))try{ie=y.fromDER(V)}catch(xe){if(!(xe instanceof nu.Err))throw xe;ie=y.fromCompact(V)}else if(typeof V=="object"&&typeof V.r=="bigint"&&typeof V.s=="bigint"){const{r:xe,s:Me}=V;ie=new y(xe,Me)}else throw new Error("PARSE");ne=c.fromHex(R)}catch(xe){if(xe.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Q&&ie.hasHighS())return!1;Y&&(M=e.hash(M));const{r:J,s:ke}=ie,ze=P(M),he=l(ke),Ee=a(ze*he),Le=a(J*he),pe=(z=c.BASE.multiplyAndAddUnsafe(ne,Ee,Le))==null?void 0:z.toAffine();return pe?a(pe.x)===J:!1}return{CURVE:e,getPublicKey:E,getSharedSecret:I,sign:L,verify:B,ProjectivePoint:c,Signature:y,utils:b}}let Q4=class extends U4{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,EH(e);const r=BS(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Yg(this),this.iHash.update(e),this}digestInto(e){Yg(this),tm(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const X4=(t,e,n)=>new Q4(t,e).update(n).digest();X4.create=(t,e)=>new Q4(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function cV(t){return{hash:t,hmac:(e,...n)=>X4(t,e,CH(...n)),randomBytes:H4}}function uV(t,e){const n=r=>lV({...t,...cV(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ib=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),t0=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Y4=BigInt(1),n0=BigInt(2),AC=(t,e)=>(t+e/n0)/e;function J4(t){const e=ib,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=fs(u,n,e)*u%e,f=fs(d,n,e)*u%e,h=fs(f,n0,e)*c%e,p=fs(h,i,e)*h%e,m=fs(p,s,e)*p%e,g=fs(m,a,e)*m%e,y=fs(g,l,e)*g%e,b=fs(y,a,e)*m%e,E=fs(b,n,e)*u%e,C=fs(E,o,e)*p%e,I=fs(C,r,e)*c%e,x=fs(I,n0,e);if(!gx.eql(gx.sqr(x),t))throw new Error("Cannot find square root");return x}const gx=JH(ib,void 0,void 0,{sqrt:J4}),HS=uV({a:BigInt(0),b:BigInt(7),Fp:gx,n:t0,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=t0,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Y4*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=AC(s*t,e),l=AC(-r*t,e);let c=Nr(t-a*n-l*i,e),u=Nr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},e0),sb=BigInt(0),eM=t=>typeof t=="bigint"&&sb<t&&t<ib,dV=t=>typeof t=="bigint"&&sb<t&&t<t0,IC={};function r0(t,...e){let n=IC[t];if(n===void 0){const r=e0(Uint8Array.from(t,i=>i.charCodeAt(0)));n=Au(r,r),IC[t]=n}return e0(Au(n,...e))}const VS=t=>t.toRawBytes(!0).slice(1),yx=t=>bc(t,32),iv=t=>Nr(t,ib),mp=t=>Nr(t,t0),WS=HS.ProjectivePoint,fV=(t,e,n)=>WS.BASE.multiplyAndAddUnsafe(t,e,n);function bx(t){let e=HS.utils.normPrivateKeyToScalar(t),n=WS.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:mp(-e),bytes:VS(n)}}function tM(t){if(!eM(t))throw new Error("bad x: need 0 < x < p");const e=iv(t*t),n=iv(e*t+BigInt(7));let r=J4(n);r%n0!==sb&&(r=iv(-r));const i=new WS(t,r,Y4);return i.assertValidity(),i}function nM(...t){return mp(Hi(r0("BIP0340/challenge",...t)))}function hV(t){return bx(t).bytes}function pV(t,e,n=H4(32)){const r=Zr("message",t),{bytes:i,scalar:s}=bx(e),o=Zr("auxRand",n,32),a=yx(s^Hi(r0("BIP0340/aux",o))),l=r0("BIP0340/nonce",a,i,r),c=mp(Hi(l));if(c===sb)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=bx(c),f=nM(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(yx(mp(d+f*s)),32),!rM(h,r,i))throw new Error("sign: Invalid signature produced");return h}function rM(t,e,n){const r=Zr("signature",t,64),i=Zr("message",e),s=Zr("publicKey",n,32);try{const o=tM(Hi(s)),a=Hi(r.subarray(0,32));if(!eM(a))return!1;const l=Hi(r.subarray(32,64));if(!dV(l))return!1;const c=nM(yx(a),VS(o),i),u=fV(o,l,mp(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const sv={getPublicKey:hV,sign:pV,verify:rM,utils:{randomPrivateKey:HS.utils.randomPrivateKey,lift_x:tM,pointToBytes:VS,numberToBytesBE:bc,bytesToNumberBE:Hi,taggedHash:r0,mod:Nr}};/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function mV(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function gV(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function yV(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function bV(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}const iM=(t,e)=>e?iM(e,t%e):t,i0=(t,e)=>t+(e-iM(t,e));function wx(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(i0(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${i0(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function wV(t,e=!1){if(i0(8,t)>32||i0(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!mV(n))throw new Error("radix2.encode input should be Uint8Array");return wx(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(wx(n,t,8,e))}}}function PC(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const vx=gV(yV("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),bV("")),OC=[996825010,642813549,513874426,1027748829,705979059];function oh(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<OC.length;r++)(e>>r&1)===1&&(n^=OC[r]);return n}function MC(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=oh(i)^o>>5}i=oh(i);for(let s=0;s<r;s++)i=oh(i)^t.charCodeAt(s)&31;for(let s of e)i=oh(i)^s;for(let s=0;s<6;s++)i=oh(i);return i^=n,vx.encode(wx([i%2**30],30,5,!1))}function vV(t){const n=wV(5),r=n.decode,i=n.encode,s=PC(r);function o(u,d,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof d}`);if(u.length===0)throw new TypeError(`Invalid prefix length ${u.length}`);const h=u.length+7+d.length;if(f!==!1&&h>f)throw new TypeError(`Length ${h} exceeds limit ${f}`);const p=u.toLowerCase(),m=MC(p,d,1);return`${p}1${vx.encode(d)}${m}`}function a(u,d=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||d!==!1&&u.length>d)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${d})`);const f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");const h=f.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=f.slice(0,h),m=f.slice(h+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const g=vx.decode(m).slice(0,-6),y=MC(p,g,1);if(!m.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:g}}const l=PC(a);function c(u){const{prefix:d,words:f}=a(u,!1);return{prefix:d,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const NC=vV(),xV=new TextEncoder;function SV(t){return Jg(e0(xV.encode(t)))}const jS={sign:(t,e)=>Jg(sv.sign(t,e)),verify:sv.verify,getPublicKey:t=>Jg(sv.getPublicKey(t))};function EV(t){return jS.getPublicKey(t)}function sM(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return SV(e)}function kV(t,e){return jS.sign(t,e)}function TV(t){try{return jS.verify(t.sig,sM(t),t.pubkey)}catch(e){return console.warn("The following error occurred during verify():",e),!1}}function _V(t){const{words:e}=NC.decode(t),n=new Uint8Array(NC.fromWords(e));return Jg(n)}function xx(t,e){const n=t.startsWith("nsec1")?_V(t):t,r=EV(n);return{async signEvent(i){const s={...i,pubkey:i.pubkey??r,tags:[...i.tags??[],...e?.tags??[]],created_at:i.created_at??Math.floor(Date.now()/1e3)};if(CV(s))return s;const o=s.id??sM(s),a=s.sig??kV(o,n);return{...s,id:o,sig:a}},async getPublicKey(){return r}}}function CV(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}const AV=async t=>TV(t),IV="modulepreload",PV=function(t){return"/ehagaki/"+t},RC={},ob=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=l(n.map(c=>{if(c=PV(c),c in RC)return;RC[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":IV,u||(f.as="script"),f.crossOrigin="",f.href=c,a&&f.setAttribute("nonce",a),document.head.appendChild(f),u)return new Promise((h,p)=>{f.addEventListener("load",h),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var DC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function OV(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ov,LC;function MV(){if(LC)return ov;LC=1;var t=function(b){return e(b)&&!n(b)};function e(y){return!!y&&typeof y=="object"}function n(y){var b=Object.prototype.toString.call(y);return b==="[object RegExp]"||b==="[object Date]"||s(y)}var r=typeof Symbol=="function"&&Symbol.for,i=r?Symbol.for("react.element"):60103;function s(y){return y.$$typeof===i}function o(y){return Array.isArray(y)?[]:{}}function a(y,b){return b.clone!==!1&&b.isMergeableObject(y)?m(o(y),y,b):y}function l(y,b,E){return y.concat(b).map(function(C){return a(C,E)})}function c(y,b){if(!b.customMerge)return m;var E=b.customMerge(y);return typeof E=="function"?E:m}function u(y){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(y).filter(function(b){return Object.propertyIsEnumerable.call(y,b)}):[]}function d(y){return Object.keys(y).concat(u(y))}function f(y,b){try{return b in y}catch{return!1}}function h(y,b){return f(y,b)&&!(Object.hasOwnProperty.call(y,b)&&Object.propertyIsEnumerable.call(y,b))}function p(y,b,E){var C={};return E.isMergeableObject(y)&&d(y).forEach(function(I){C[I]=a(y[I],E)}),d(b).forEach(function(I){h(y,I)||(f(y,I)&&E.isMergeableObject(b[I])?C[I]=c(I,E)(y[I],b[I],E):C[I]=a(b[I],E))}),C}function m(y,b,E){E=E||{},E.arrayMerge=E.arrayMerge||l,E.isMergeableObject=E.isMergeableObject||t,E.cloneUnlessOtherwiseSpecified=a;var C=Array.isArray(b),I=Array.isArray(y),x=C===I;return x?C?E.arrayMerge(y,b,E):p(y,b,E):a(b,E)}m.all=function(b,E){if(!Array.isArray(b))throw new Error("first argument should be an array");return b.reduce(function(C,I){return m(C,I,E)},{})};var g=m;return ov=g,ov}var NV=MV();const RV=OV(NV);var Sx=function(t,e){return Sx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Sx(t,e)};function ab(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Sx(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var sn=function(){return sn=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},sn.apply(this,arguments)};function DV(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function av(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function lv(t,e){var n=e&&e.cache?e.cache:HV,r=e&&e.serializer?e.serializer:zV,i=e&&e.strategy?e.strategy:FV;return i(t,{cache:n,serializer:r})}function LV(t){return t==null||typeof t=="number"||typeof t=="boolean"}function BV(t,e,n,r){var i=LV(r)?r:n(r),s=e.get(i);return typeof s>"u"&&(s=t.call(this,r),e.set(i,s)),s}function oM(t,e,n){var r=Array.prototype.slice.call(arguments,3),i=n(r),s=e.get(i);return typeof s>"u"&&(s=t.apply(this,r),e.set(i,s)),s}function aM(t,e,n,r,i){return n.bind(e,t,r,i)}function FV(t,e){var n=t.length===1?BV:oM;return aM(t,this,n,e.cache.create(),e.serializer)}function $V(t,e){return aM(t,this,oM,e.cache.create(),e.serializer)}var zV=function(){return JSON.stringify(arguments)},UV=(function(){function t(){this.cache=Object.create(null)}return t.prototype.get=function(e){return this.cache[e]},t.prototype.set=function(e,n){this.cache[e]=n},t})(),HV={create:function(){return new UV}},cv={variadic:$V},Wt;(function(t){t[t.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",t[t.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",t[t.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",t[t.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",t[t.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",t[t.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",t[t.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",t[t.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",t[t.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",t[t.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",t[t.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",t[t.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",t[t.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",t[t.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",t[t.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",t[t.INVALID_TAG=23]="INVALID_TAG",t[t.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",t[t.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",t[t.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(Wt||(Wt={}));var Dn;(function(t){t[t.literal=0]="literal",t[t.argument=1]="argument",t[t.number=2]="number",t[t.date=3]="date",t[t.time=4]="time",t[t.select=5]="select",t[t.plural=6]="plural",t[t.pound=7]="pound",t[t.tag=8]="tag"})(Dn||(Dn={}));var sf;(function(t){t[t.number=0]="number",t[t.dateTime=1]="dateTime"})(sf||(sf={}));function BC(t){return t.type===Dn.literal}function VV(t){return t.type===Dn.argument}function lM(t){return t.type===Dn.number}function cM(t){return t.type===Dn.date}function uM(t){return t.type===Dn.time}function dM(t){return t.type===Dn.select}function fM(t){return t.type===Dn.plural}function WV(t){return t.type===Dn.pound}function hM(t){return t.type===Dn.tag}function pM(t){return!!(t&&typeof t=="object"&&t.type===sf.number)}function Ex(t){return!!(t&&typeof t=="object"&&t.type===sf.dateTime)}var mM=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,jV=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function qV(t){var e={};return t.replace(jV,function(n){var r=n.length;switch(n[0]){case"G":e.era=r===4?"long":r===5?"narrow":"short";break;case"y":e.year=r===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":e.month=["numeric","2-digit","short","long","narrow"][r-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":e.day=["numeric","2-digit"][r-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":e.weekday=r===4?"long":r===5?"narrow":"short";break;case"e":if(r<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"c":if(r<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"a":e.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":e.hourCycle="h12",e.hour=["numeric","2-digit"][r-1];break;case"H":e.hourCycle="h23",e.hour=["numeric","2-digit"][r-1];break;case"K":e.hourCycle="h11",e.hour=["numeric","2-digit"][r-1];break;case"k":e.hourCycle="h24",e.hour=["numeric","2-digit"][r-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":e.minute=["numeric","2-digit"][r-1];break;case"s":e.second=["numeric","2-digit"][r-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":e.timeZoneName=r<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),e}var KV=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function GV(t){if(t.length===0)throw new Error("Number skeleton cannot be empty");for(var e=t.split(KV).filter(function(f){return f.length>0}),n=[],r=0,i=e;r<i.length;r++){var s=i[r],o=s.split("/");if(o.length===0)throw new Error("Invalid number skeleton");for(var a=o[0],l=o.slice(1),c=0,u=l;c<u.length;c++){var d=u[c];if(d.length===0)throw new Error("Invalid number skeleton")}n.push({stem:a,options:l})}return n}function ZV(t){return t.replace(/^(.*?)-/,"")}var FC=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,gM=/^(@+)?(\+|#+)?[rs]?$/g,QV=/(\*)(0+)|(#+)(0+)|(0+)/g,yM=/^(0+)$/;function $C(t){var e={};return t[t.length-1]==="r"?e.roundingPriority="morePrecision":t[t.length-1]==="s"&&(e.roundingPriority="lessPrecision"),t.replace(gM,function(n,r,i){return typeof i!="string"?(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length):i==="+"?e.minimumSignificantDigits=r.length:r[0]==="#"?e.maximumSignificantDigits=r.length:(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length+(typeof i=="string"?i.length:0)),""}),e}function bM(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function XV(t){var e;if(t[0]==="E"&&t[1]==="E"?(e={notation:"engineering"},t=t.slice(2)):t[0]==="E"&&(e={notation:"scientific"},t=t.slice(1)),e){var n=t.slice(0,2);if(n==="+!"?(e.signDisplay="always",t=t.slice(2)):n==="+?"&&(e.signDisplay="exceptZero",t=t.slice(2)),!yM.test(t))throw new Error("Malformed concise eng/scientific notation");e.minimumIntegerDigits=t.length}return e}function zC(t){var e={},n=bM(t);return n||e}function YV(t){for(var e={},n=0,r=t;n<r.length;n++){var i=r[n];switch(i.stem){case"percent":case"%":e.style="percent";continue;case"%x100":e.style="percent",e.scale=100;continue;case"currency":e.style="currency",e.currency=i.options[0];continue;case"group-off":case",_":e.useGrouping=!1;continue;case"precision-integer":case".":e.maximumFractionDigits=0;continue;case"measure-unit":case"unit":e.style="unit",e.unit=ZV(i.options[0]);continue;case"compact-short":case"K":e.notation="compact",e.compactDisplay="short";continue;case"compact-long":case"KK":e.notation="compact",e.compactDisplay="long";continue;case"scientific":e=sn(sn(sn({},e),{notation:"scientific"}),i.options.reduce(function(l,c){return sn(sn({},l),zC(c))},{}));continue;case"engineering":e=sn(sn(sn({},e),{notation:"engineering"}),i.options.reduce(function(l,c){return sn(sn({},l),zC(c))},{}));continue;case"notation-simple":e.notation="standard";continue;case"unit-width-narrow":e.currencyDisplay="narrowSymbol",e.unitDisplay="narrow";continue;case"unit-width-short":e.currencyDisplay="code",e.unitDisplay="short";continue;case"unit-width-full-name":e.currencyDisplay="name",e.unitDisplay="long";continue;case"unit-width-iso-code":e.currencyDisplay="symbol";continue;case"scale":e.scale=parseFloat(i.options[0]);continue;case"rounding-mode-floor":e.roundingMode="floor";continue;case"rounding-mode-ceiling":e.roundingMode="ceil";continue;case"rounding-mode-down":e.roundingMode="trunc";continue;case"rounding-mode-up":e.roundingMode="expand";continue;case"rounding-mode-half-even":e.roundingMode="halfEven";continue;case"rounding-mode-half-down":e.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":e.roundingMode="halfExpand";continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(QV,function(l,c,u,d,f,h){if(c)e.minimumIntegerDigits=u.length;else{if(d&&f)throw new Error("We currently do not support maximum integer digits");if(h)throw new Error("We currently do not support exact integer digits")}return""});continue}if(yM.test(i.stem)){e.minimumIntegerDigits=i.stem.length;continue}if(FC.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(FC,function(l,c,u,d,f,h){return u==="*"?e.minimumFractionDigits=c.length:d&&d[0]==="#"?e.maximumFractionDigits=d.length:f&&h?(e.minimumFractionDigits=f.length,e.maximumFractionDigits=f.length+h.length):(e.minimumFractionDigits=c.length,e.maximumFractionDigits=c.length),""});var s=i.options[0];s==="w"?e=sn(sn({},e),{trailingZeroDisplay:"stripIfInteger"}):s&&(e=sn(sn({},e),$C(s)));continue}if(gM.test(i.stem)){e=sn(sn({},e),$C(i.stem));continue}var o=bM(i.stem);o&&(e=sn(sn({},e),o));var a=XV(i.stem);a&&(e=sn(sn({},e),a))}return e}var Hm={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function JV(t,e){for(var n="",r=0;r<t.length;r++){var i=t.charAt(r);if(i==="j"){for(var s=0;r+1<t.length&&t.charAt(r+1)===i;)s++,r++;var o=1+(s&1),a=s<2?1:3+(s>>1),l="a",c=eW(e);for((c=="H"||c=="k")&&(a=0);a-- >0;)n+=l;for(;o-- >0;)n=c+n}else i==="J"?n+="H":n+=i}return n}function eW(t){var e=t.hourCycle;if(e===void 0&&t.hourCycles&&t.hourCycles.length&&(e=t.hourCycles[0]),e)switch(e){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var n=t.language,r;n!=="root"&&(r=t.maximize().region);var i=Hm[r||""]||Hm[n||""]||Hm["".concat(n,"-001")]||Hm["001"];return i[0]}var uv,tW=new RegExp("^".concat(mM.source,"*")),nW=new RegExp("".concat(mM.source,"*$"));function qt(t,e){return{start:t,end:e}}var rW=!!String.prototype.startsWith&&"_a".startsWith("a",1),iW=!!String.fromCodePoint,sW=!!Object.fromEntries,oW=!!String.prototype.codePointAt,aW=!!String.prototype.trimStart,lW=!!String.prototype.trimEnd,cW=!!Number.isSafeInteger,uW=cW?Number.isSafeInteger:function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<=9007199254740991},kx=!0;try{var dW=vM("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");kx=((uv=dW.exec("a"))===null||uv===void 0?void 0:uv[0])==="a"}catch{kx=!1}var UC=rW?function(e,n,r){return e.startsWith(n,r)}:function(e,n,r){return e.slice(r,r+n.length)===n},Tx=iW?String.fromCodePoint:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r="",i=e.length,s=0,o;i>s;){if(o=e[s++],o>1114111)throw RangeError(o+" is not a valid code point");r+=o<65536?String.fromCharCode(o):String.fromCharCode(((o-=65536)>>10)+55296,o%1024+56320)}return r},HC=sW?Object.fromEntries:function(e){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r],o=s[0],a=s[1];n[o]=a}return n},wM=oW?function(e,n){return e.codePointAt(n)}:function(e,n){var r=e.length;if(!(n<0||n>=r)){var i=e.charCodeAt(n),s;return i<55296||i>56319||n+1===r||(s=e.charCodeAt(n+1))<56320||s>57343?i:(i-55296<<10)+(s-56320)+65536}},fW=aW?function(e){return e.trimStart()}:function(e){return e.replace(tW,"")},hW=lW?function(e){return e.trimEnd()}:function(e){return e.replace(nW,"")};function vM(t,e){return new RegExp(t,e)}var _x;if(kx){var VC=vM("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");_x=function(e,n){var r;VC.lastIndex=n;var i=VC.exec(e);return(r=i[1])!==null&&r!==void 0?r:""}}else _x=function(e,n){for(var r=[];;){var i=wM(e,n);if(i===void 0||xM(i)||yW(i))break;r.push(i),n+=i>=65536?2:1}return Tx.apply(void 0,r)};var pW=(function(){function t(e,n){n===void 0&&(n={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!n.ignoreTag,this.locale=n.locale,this.requiresOtherClause=!!n.requiresOtherClause,this.shouldParseSkeletons=!!n.shouldParseSkeletons}return t.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},t.prototype.parseMessage=function(e,n,r){for(var i=[];!this.isEOF();){var s=this.char();if(s===123){var o=this.parseArgument(e,r);if(o.err)return o;i.push(o.val)}else{if(s===125&&e>0)break;if(s===35&&(n==="plural"||n==="selectordinal")){var a=this.clonePosition();this.bump(),i.push({type:Dn.pound,location:qt(a,this.clonePosition())})}else if(s===60&&!this.ignoreTag&&this.peek()===47){if(r)break;return this.error(Wt.UNMATCHED_CLOSING_TAG,qt(this.clonePosition(),this.clonePosition()))}else if(s===60&&!this.ignoreTag&&Cx(this.peek()||0)){var o=this.parseTag(e,n);if(o.err)return o;i.push(o.val)}else{var o=this.parseLiteral(e,n);if(o.err)return o;i.push(o.val)}}}return{val:i,err:null}},t.prototype.parseTag=function(e,n){var r=this.clonePosition();this.bump();var i=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:Dn.literal,value:"<".concat(i,"/>"),location:qt(r,this.clonePosition())},err:null};if(this.bumpIf(">")){var s=this.parseMessage(e+1,n,!0);if(s.err)return s;var o=s.val,a=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!Cx(this.char()))return this.error(Wt.INVALID_TAG,qt(a,this.clonePosition()));var l=this.clonePosition(),c=this.parseTagName();return i!==c?this.error(Wt.UNMATCHED_CLOSING_TAG,qt(l,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:Dn.tag,value:i,children:o,location:qt(r,this.clonePosition())},err:null}:this.error(Wt.INVALID_TAG,qt(a,this.clonePosition())))}else return this.error(Wt.UNCLOSED_TAG,qt(r,this.clonePosition()))}else return this.error(Wt.INVALID_TAG,qt(r,this.clonePosition()))},t.prototype.parseTagName=function(){var e=this.offset();for(this.bump();!this.isEOF()&&gW(this.char());)this.bump();return this.message.slice(e,this.offset())},t.prototype.parseLiteral=function(e,n){for(var r=this.clonePosition(),i="";;){var s=this.tryParseQuote(n);if(s){i+=s;continue}var o=this.tryParseUnquoted(e,n);if(o){i+=o;continue}var a=this.tryParseLeftAngleBracket();if(a){i+=a;continue}break}var l=qt(r,this.clonePosition());return{val:{type:Dn.literal,value:i,location:l},err:null}},t.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!mW(this.peek()||0))?(this.bump(),"<"):null},t.prototype.tryParseQuote=function(e){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(e==="plural"||e==="selectordinal")break;return null;default:return null}this.bump();var n=[this.char()];for(this.bump();!this.isEOF();){var r=this.char();if(r===39)if(this.peek()===39)n.push(39),this.bump();else{this.bump();break}else n.push(r);this.bump()}return Tx.apply(void 0,n)},t.prototype.tryParseUnquoted=function(e,n){if(this.isEOF())return null;var r=this.char();return r===60||r===123||r===35&&(n==="plural"||n==="selectordinal")||r===125&&e>0?null:(this.bump(),Tx(r))},t.prototype.parseArgument=function(e,n){var r=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(Wt.EXPECT_ARGUMENT_CLOSING_BRACE,qt(r,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(Wt.EMPTY_ARGUMENT,qt(r,this.clonePosition()));var i=this.parseIdentifierIfPossible().value;if(!i)return this.error(Wt.MALFORMED_ARGUMENT,qt(r,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(Wt.EXPECT_ARGUMENT_CLOSING_BRACE,qt(r,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:Dn.argument,value:i,location:qt(r,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(Wt.EXPECT_ARGUMENT_CLOSING_BRACE,qt(r,this.clonePosition())):this.parseArgumentOptions(e,n,i,r);default:return this.error(Wt.MALFORMED_ARGUMENT,qt(r,this.clonePosition()))}},t.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),n=this.offset(),r=_x(this.message,n),i=n+r.length;this.bumpTo(i);var s=this.clonePosition(),o=qt(e,s);return{value:r,location:o}},t.prototype.parseArgumentOptions=function(e,n,r,i){var s,o=this.clonePosition(),a=this.parseIdentifierIfPossible().value,l=this.clonePosition();switch(a){case"":return this.error(Wt.EXPECT_ARGUMENT_TYPE,qt(o,l));case"number":case"date":case"time":{this.bumpSpace();var c=null;if(this.bumpIf(",")){this.bumpSpace();var u=this.clonePosition(),d=this.parseSimpleArgStyleIfPossible();if(d.err)return d;var f=hW(d.val);if(f.length===0)return this.error(Wt.EXPECT_ARGUMENT_STYLE,qt(this.clonePosition(),this.clonePosition()));var h=qt(u,this.clonePosition());c={style:f,styleLocation:h}}var p=this.tryParseArgumentClose(i);if(p.err)return p;var m=qt(i,this.clonePosition());if(c&&UC(c?.style,"::",0)){var g=fW(c.style.slice(2));if(a==="number"){var d=this.parseNumberSkeletonFromString(g,c.styleLocation);return d.err?d:{val:{type:Dn.number,value:r,location:m,style:d.val},err:null}}else{if(g.length===0)return this.error(Wt.EXPECT_DATE_TIME_SKELETON,m);var y=g;this.locale&&(y=JV(g,this.locale));var f={type:sf.dateTime,pattern:y,location:c.styleLocation,parsedOptions:this.shouldParseSkeletons?qV(y):{}},b=a==="date"?Dn.date:Dn.time;return{val:{type:b,value:r,location:m,style:f},err:null}}}return{val:{type:a==="number"?Dn.number:a==="date"?Dn.date:Dn.time,value:r,location:m,style:(s=c?.style)!==null&&s!==void 0?s:null},err:null}}case"plural":case"selectordinal":case"select":{var E=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(Wt.EXPECT_SELECT_ARGUMENT_OPTIONS,qt(E,sn({},E)));this.bumpSpace();var C=this.parseIdentifierIfPossible(),I=0;if(a!=="select"&&C.value==="offset"){if(!this.bumpIf(":"))return this.error(Wt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,qt(this.clonePosition(),this.clonePosition()));this.bumpSpace();var d=this.tryParseDecimalInteger(Wt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Wt.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(d.err)return d;this.bumpSpace(),C=this.parseIdentifierIfPossible(),I=d.val}var x=this.tryParsePluralOrSelectOptions(e,a,n,C);if(x.err)return x;var p=this.tryParseArgumentClose(i);if(p.err)return p;var P=qt(i,this.clonePosition());return a==="select"?{val:{type:Dn.select,value:r,options:HC(x.val),location:P},err:null}:{val:{type:Dn.plural,value:r,options:HC(x.val),offset:I,pluralType:a==="plural"?"cardinal":"ordinal",location:P},err:null}}default:return this.error(Wt.INVALID_ARGUMENT_TYPE,qt(o,l))}},t.prototype.tryParseArgumentClose=function(e){return this.isEOF()||this.char()!==125?this.error(Wt.EXPECT_ARGUMENT_CLOSING_BRACE,qt(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},t.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,n=this.clonePosition();!this.isEOF();){var r=this.char();switch(r){case 39:{this.bump();var i=this.clonePosition();if(!this.bumpUntil("'"))return this.error(Wt.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,qt(i,this.clonePosition()));this.bump();break}case 123:{e+=1,this.bump();break}case 125:{if(e>0)e-=1;else return{val:this.message.slice(n.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(n.offset,this.offset()),err:null}},t.prototype.parseNumberSkeletonFromString=function(e,n){var r=[];try{r=GV(e)}catch{return this.error(Wt.INVALID_NUMBER_SKELETON,n)}return{val:{type:sf.number,tokens:r,location:n,parsedOptions:this.shouldParseSkeletons?YV(r):{}},err:null}},t.prototype.tryParsePluralOrSelectOptions=function(e,n,r,i){for(var s,o=!1,a=[],l=new Set,c=i.value,u=i.location;;){if(c.length===0){var d=this.clonePosition();if(n!=="select"&&this.bumpIf("=")){var f=this.tryParseDecimalInteger(Wt.EXPECT_PLURAL_ARGUMENT_SELECTOR,Wt.INVALID_PLURAL_ARGUMENT_SELECTOR);if(f.err)return f;u=qt(d,this.clonePosition()),c=this.message.slice(d.offset,this.offset())}else break}if(l.has(c))return this.error(n==="select"?Wt.DUPLICATE_SELECT_ARGUMENT_SELECTOR:Wt.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,u);c==="other"&&(o=!0),this.bumpSpace();var h=this.clonePosition();if(!this.bumpIf("{"))return this.error(n==="select"?Wt.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:Wt.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,qt(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,n,r);if(p.err)return p;var m=this.tryParseArgumentClose(h);if(m.err)return m;a.push([c,{value:p.val,location:qt(h,this.clonePosition())}]),l.add(c),this.bumpSpace(),s=this.parseIdentifierIfPossible(),c=s.value,u=s.location}return a.length===0?this.error(n==="select"?Wt.EXPECT_SELECT_ARGUMENT_SELECTOR:Wt.EXPECT_PLURAL_ARGUMENT_SELECTOR,qt(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!o?this.error(Wt.MISSING_OTHER_CLAUSE,qt(this.clonePosition(),this.clonePosition())):{val:a,err:null}},t.prototype.tryParseDecimalInteger=function(e,n){var r=1,i=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(r=-1);for(var s=!1,o=0;!this.isEOF();){var a=this.char();if(a>=48&&a<=57)s=!0,o=o*10+(a-48),this.bump();else break}var l=qt(i,this.clonePosition());return s?(o*=r,uW(o)?{val:o,err:null}:this.error(n,l)):this.error(e,l)},t.prototype.offset=function(){return this.position.offset},t.prototype.isEOF=function(){return this.offset()===this.message.length},t.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},t.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var n=wM(this.message,e);if(n===void 0)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return n},t.prototype.error=function(e,n){return{val:null,err:{kind:e,message:this.message,location:n}}},t.prototype.bump=function(){if(!this.isEOF()){var e=this.char();e===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},t.prototype.bumpIf=function(e){if(UC(this.message,e,this.offset())){for(var n=0;n<e.length;n++)this.bump();return!0}return!1},t.prototype.bumpUntil=function(e){var n=this.offset(),r=this.message.indexOf(e,n);return r>=0?(this.bumpTo(r),!0):(this.bumpTo(this.message.length),!1)},t.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var n=this.offset();if(n===e)break;if(n>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},t.prototype.bumpSpace=function(){for(;!this.isEOF()&&xM(this.char());)this.bump()},t.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),n=this.offset(),r=this.message.charCodeAt(n+(e>=65536?2:1));return r??null},t})();function Cx(t){return t>=97&&t<=122||t>=65&&t<=90}function mW(t){return Cx(t)||t===47}function gW(t){return t===45||t===46||t>=48&&t<=57||t===95||t>=97&&t<=122||t>=65&&t<=90||t==183||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}function xM(t){return t>=9&&t<=13||t===32||t===133||t>=8206&&t<=8207||t===8232||t===8233}function yW(t){return t>=33&&t<=35||t===36||t>=37&&t<=39||t===40||t===41||t===42||t===43||t===44||t===45||t>=46&&t<=47||t>=58&&t<=59||t>=60&&t<=62||t>=63&&t<=64||t===91||t===92||t===93||t===94||t===96||t===123||t===124||t===125||t===126||t===161||t>=162&&t<=165||t===166||t===167||t===169||t===171||t===172||t===174||t===176||t===177||t===182||t===187||t===191||t===215||t===247||t>=8208&&t<=8213||t>=8214&&t<=8215||t===8216||t===8217||t===8218||t>=8219&&t<=8220||t===8221||t===8222||t===8223||t>=8224&&t<=8231||t>=8240&&t<=8248||t===8249||t===8250||t>=8251&&t<=8254||t>=8257&&t<=8259||t===8260||t===8261||t===8262||t>=8263&&t<=8273||t===8274||t===8275||t>=8277&&t<=8286||t>=8592&&t<=8596||t>=8597&&t<=8601||t>=8602&&t<=8603||t>=8604&&t<=8607||t===8608||t>=8609&&t<=8610||t===8611||t>=8612&&t<=8613||t===8614||t>=8615&&t<=8621||t===8622||t>=8623&&t<=8653||t>=8654&&t<=8655||t>=8656&&t<=8657||t===8658||t===8659||t===8660||t>=8661&&t<=8691||t>=8692&&t<=8959||t>=8960&&t<=8967||t===8968||t===8969||t===8970||t===8971||t>=8972&&t<=8991||t>=8992&&t<=8993||t>=8994&&t<=9e3||t===9001||t===9002||t>=9003&&t<=9083||t===9084||t>=9085&&t<=9114||t>=9115&&t<=9139||t>=9140&&t<=9179||t>=9180&&t<=9185||t>=9186&&t<=9254||t>=9255&&t<=9279||t>=9280&&t<=9290||t>=9291&&t<=9311||t>=9472&&t<=9654||t===9655||t>=9656&&t<=9664||t===9665||t>=9666&&t<=9719||t>=9720&&t<=9727||t>=9728&&t<=9838||t===9839||t>=9840&&t<=10087||t===10088||t===10089||t===10090||t===10091||t===10092||t===10093||t===10094||t===10095||t===10096||t===10097||t===10098||t===10099||t===10100||t===10101||t>=10132&&t<=10175||t>=10176&&t<=10180||t===10181||t===10182||t>=10183&&t<=10213||t===10214||t===10215||t===10216||t===10217||t===10218||t===10219||t===10220||t===10221||t===10222||t===10223||t>=10224&&t<=10239||t>=10240&&t<=10495||t>=10496&&t<=10626||t===10627||t===10628||t===10629||t===10630||t===10631||t===10632||t===10633||t===10634||t===10635||t===10636||t===10637||t===10638||t===10639||t===10640||t===10641||t===10642||t===10643||t===10644||t===10645||t===10646||t===10647||t===10648||t>=10649&&t<=10711||t===10712||t===10713||t===10714||t===10715||t>=10716&&t<=10747||t===10748||t===10749||t>=10750&&t<=11007||t>=11008&&t<=11055||t>=11056&&t<=11076||t>=11077&&t<=11078||t>=11079&&t<=11084||t>=11085&&t<=11123||t>=11124&&t<=11125||t>=11126&&t<=11157||t===11158||t>=11159&&t<=11263||t>=11776&&t<=11777||t===11778||t===11779||t===11780||t===11781||t>=11782&&t<=11784||t===11785||t===11786||t===11787||t===11788||t===11789||t>=11790&&t<=11798||t===11799||t>=11800&&t<=11801||t===11802||t===11803||t===11804||t===11805||t>=11806&&t<=11807||t===11808||t===11809||t===11810||t===11811||t===11812||t===11813||t===11814||t===11815||t===11816||t===11817||t>=11818&&t<=11822||t===11823||t>=11824&&t<=11833||t>=11834&&t<=11835||t>=11836&&t<=11839||t===11840||t===11841||t===11842||t>=11843&&t<=11855||t>=11856&&t<=11857||t===11858||t>=11859&&t<=11903||t>=12289&&t<=12291||t===12296||t===12297||t===12298||t===12299||t===12300||t===12301||t===12302||t===12303||t===12304||t===12305||t>=12306&&t<=12307||t===12308||t===12309||t===12310||t===12311||t===12312||t===12313||t===12314||t===12315||t===12316||t===12317||t>=12318&&t<=12319||t===12320||t===12336||t===64830||t===64831||t>=65093&&t<=65094}function Ax(t){t.forEach(function(e){if(delete e.location,dM(e)||fM(e))for(var n in e.options)delete e.options[n].location,Ax(e.options[n].value);else lM(e)&&pM(e.style)||(cM(e)||uM(e))&&Ex(e.style)?delete e.style.location:hM(e)&&Ax(e.children)})}function bW(t,e){e===void 0&&(e={}),e=sn({shouldParseSkeletons:!0,requiresOtherClause:!0},e);var n=new pW(t,e).parse();if(n.err){var r=SyntaxError(Wt[n.err.kind]);throw r.location=n.err.location,r.originalMessage=n.err.message,r}return e?.captureLocation||Ax(n.val),n.val}var of;(function(t){t.MISSING_VALUE="MISSING_VALUE",t.INVALID_VALUE="INVALID_VALUE",t.MISSING_INTL_API="MISSING_INTL_API"})(of||(of={}));var lb=(function(t){ab(e,t);function e(n,r,i){var s=t.call(this,n)||this;return s.code=r,s.originalMessage=i,s}return e.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},e})(Error),WC=(function(t){ab(e,t);function e(n,r,i,s){return t.call(this,'Invalid values for "'.concat(n,'": "').concat(r,'". Options are "').concat(Object.keys(i).join('", "'),'"'),of.INVALID_VALUE,s)||this}return e})(lb),wW=(function(t){ab(e,t);function e(n,r,i){return t.call(this,'Value for "'.concat(n,'" must be of type ').concat(r),of.INVALID_VALUE,i)||this}return e})(lb),vW=(function(t){ab(e,t);function e(n,r){return t.call(this,'The intl string context variable "'.concat(n,'" was not provided to the string "').concat(r,'"'),of.MISSING_VALUE,r)||this}return e})(lb),gi;(function(t){t[t.literal=0]="literal",t[t.object=1]="object"})(gi||(gi={}));function xW(t){return t.length<2?t:t.reduce(function(e,n){var r=e[e.length-1];return!r||r.type!==gi.literal||n.type!==gi.literal?e.push(n):r.value+=n.value,e},[])}function SW(t){return typeof t=="function"}function kg(t,e,n,r,i,s,o){if(t.length===1&&BC(t[0]))return[{type:gi.literal,value:t[0].value}];for(var a=[],l=0,c=t;l<c.length;l++){var u=c[l];if(BC(u)){a.push({type:gi.literal,value:u.value});continue}if(WV(u)){typeof s=="number"&&a.push({type:gi.literal,value:n.getNumberFormat(e).format(s)});continue}var d=u.value;if(!(i&&d in i))throw new vW(d,o);var f=i[d];if(VV(u)){(!f||typeof f=="string"||typeof f=="number")&&(f=typeof f=="string"||typeof f=="number"?String(f):""),a.push({type:typeof f=="string"?gi.literal:gi.object,value:f});continue}if(cM(u)){var h=typeof u.style=="string"?r.date[u.style]:Ex(u.style)?u.style.parsedOptions:void 0;a.push({type:gi.literal,value:n.getDateTimeFormat(e,h).format(f)});continue}if(uM(u)){var h=typeof u.style=="string"?r.time[u.style]:Ex(u.style)?u.style.parsedOptions:r.time.medium;a.push({type:gi.literal,value:n.getDateTimeFormat(e,h).format(f)});continue}if(lM(u)){var h=typeof u.style=="string"?r.number[u.style]:pM(u.style)?u.style.parsedOptions:void 0;h&&h.scale&&(f=f*(h.scale||1)),a.push({type:gi.literal,value:n.getNumberFormat(e,h).format(f)});continue}if(hM(u)){var p=u.children,m=u.value,g=i[m];if(!SW(g))throw new wW(m,"function",o);var y=kg(p,e,n,r,i,s),b=g(y.map(function(I){return I.value}));Array.isArray(b)||(b=[b]),a.push.apply(a,b.map(function(I){return{type:typeof I=="string"?gi.literal:gi.object,value:I}}))}if(dM(u)){var E=u.options[f]||u.options.other;if(!E)throw new WC(u.value,f,Object.keys(u.options),o);a.push.apply(a,kg(E.value,e,n,r,i));continue}if(fM(u)){var E=u.options["=".concat(f)];if(!E){if(!Intl.PluralRules)throw new lb(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,of.MISSING_INTL_API,o);var C=n.getPluralRules(e,{type:u.pluralType}).select(f-(u.offset||0));E=u.options[C]||u.options.other}if(!E)throw new WC(u.value,f,Object.keys(u.options),o);a.push.apply(a,kg(E.value,e,n,r,i,f-(u.offset||0)));continue}}return xW(a)}function EW(t,e){return e?sn(sn(sn({},t||{}),e||{}),Object.keys(t).reduce(function(n,r){return n[r]=sn(sn({},t[r]),e[r]||{}),n},{})):t}function kW(t,e){return e?Object.keys(t).reduce(function(n,r){return n[r]=EW(t[r],e[r]),n},sn({},t)):t}function dv(t){return{create:function(){return{get:function(e){return t[e]},set:function(e,n){t[e]=n}}}}}function TW(t){return t===void 0&&(t={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:lv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.NumberFormat).bind.apply(e,av([void 0],n,!1)))},{cache:dv(t.number),strategy:cv.variadic}),getDateTimeFormat:lv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.DateTimeFormat).bind.apply(e,av([void 0],n,!1)))},{cache:dv(t.dateTime),strategy:cv.variadic}),getPluralRules:lv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.PluralRules).bind.apply(e,av([void 0],n,!1)))},{cache:dv(t.pluralRules),strategy:cv.variadic})}}var SM=(function(){function t(e,n,r,i){n===void 0&&(n=t.defaultLocale);var s=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(l){var c=s.formatToParts(l);if(c.length===1)return c[0].value;var u=c.reduce(function(d,f){return!d.length||f.type!==gi.literal||typeof d[d.length-1]!="string"?d.push(f.value):d[d.length-1]+=f.value,d},[]);return u.length<=1?u[0]||"":u},this.formatToParts=function(l){return kg(s.ast,s.locales,s.formatters,s.formats,l,void 0,s.message)},this.resolvedOptions=function(){var l;return{locale:((l=s.resolvedLocale)===null||l===void 0?void 0:l.toString())||Intl.NumberFormat.supportedLocalesOf(s.locales)[0]}},this.getAst=function(){return s.ast},this.locales=n,this.resolvedLocale=t.resolveLocale(n),typeof e=="string"){if(this.message=e,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var o=i||{};o.formatters;var a=DV(o,["formatters"]);this.ast=t.__parse(e,sn(sn({},a),{locale:this.resolvedLocale}))}else this.ast=e;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=kW(t.formats,r),this.formatters=i&&i.formatters||TW(this.formatterCache)}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.resolveLocale=function(e){if(!(typeof Intl.Locale>"u")){var n=Intl.NumberFormat.supportedLocalesOf(e);return n.length>0?new Intl.Locale(n[0]):new Intl.Locale(typeof e=="string"?e:e[0])}},t.__parse=bW,t.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t})();function _W(t,e){if(e==null)return;if(e in t)return t[e];const n=e.split(".");let r=t;for(let i=0;i<n.length;i++)if(typeof r=="object"){if(i>0){const s=n.slice(i,n.length).join(".");if(s in r){r=r[s];break}}r=r[n[i]]}else r=void 0;return r}const Gl={},CW=(t,e,n)=>n&&(e in Gl||(Gl[e]={}),t in Gl[e]||(Gl[e][t]=n),n),EM=(t,e)=>{if(e==null)return;if(e in Gl&&t in Gl[e])return Gl[e][t];const n=im(e);for(let r=0;r<n.length;r++){const i=n[r],s=IW(i,t);if(s)return CW(t,e,s)}};let qS;const Of=Ts({});function AW(t){return qS[t]||null}function KS(t){return t in qS}function IW(t,e){if(!KS(t))return null;const n=AW(t);return _W(n,e)}function PW(t){if(t==null)return;const e=im(t);for(let n=0;n<e.length;n++){const r=e[n];if(KS(r))return r}}function OW(t,...e){delete Gl[t],Of.update(n=>(n[t]=RV.all([n[t]||{},...e]),n))}$a([Of],([t])=>Object.keys(t));Of.subscribe(t=>qS=t);const Uh={};function MW(t){Uh[t]=new Set}function NW(t,e){Uh[t].delete(e),Uh[t].size===0&&delete Uh[t]}function Hh(t){return Uh[t]}function RW(t){return im(t).map(e=>{const n=Hh(e);return[e,n?[...n]:[]]}).filter(([,e])=>e.length>0)}function s0(t){return t==null?!1:im(t).some(e=>{var n;return(n=Hh(e))==null?void 0:n.size})}function DW(t,e){return Promise.all(e.map(r=>(NW(t,r),r().then(i=>i.default||i)))).then(r=>OW(t,...r))}const ah={};function GS(t){if(!s0(t))return t in ah?ah[t]:Promise.resolve();const e=RW(t);return ah[t]=Promise.all(e.map(([n,r])=>DW(n,r))).then(()=>{if(s0(t))return GS(t);delete ah[t]}),ah[t]}function kM(t,e){Hh(t)||MW(t);const n=Hh(t);Hh(t).has(e)||(KS(t)||Of.update(r=>(r[t]={},r)),n.add(e))}var jC=Object.getOwnPropertySymbols,LW=Object.prototype.hasOwnProperty,BW=Object.prototype.propertyIsEnumerable,FW=(t,e)=>{var n={};for(var r in t)LW.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&jC)for(var r of jC(t))e.indexOf(r)<0&&BW.call(t,r)&&(n[r]=t[r]);return n};const $W={number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};function zW({locale:t,id:e}){console.warn(`[svelte-i18n] The message "${e}" was not found in "${im(t).join('", "')}".${s0(tl())?`

Note: there are at least one loader still registered to this locale that wasn't executed.`:""}`)}const UW={fallbackLocale:null,loadingDelay:200,formats:$W,warnOnMissingMessages:!0,handleMissingMessage:void 0,ignoreTag:!0},Ih=UW;function Iu(){return Ih}function HW(t){const e=t,{formats:n}=e,r=FW(e,["formats"]);let i=t.fallbackLocale;if(t.initialLocale)try{SM.resolveLocale(t.initialLocale)&&(i=t.initialLocale)}catch{console.warn(`[svelte-i18n] The initial locale "${t.initialLocale}" is not a valid locale.`)}return r.warnOnMissingMessages&&(delete r.warnOnMissingMessages,r.handleMissingMessage==null?r.handleMissingMessage=zW:console.warn('[svelte-i18n] The "warnOnMissingMessages" option is deprecated. Please use the "handleMissingMessage" option instead.')),Object.assign(Ih,r,{initialLocale:i}),n&&("number"in n&&Object.assign(Ih.formats.number,n.number),"date"in n&&Object.assign(Ih.formats.date,n.date),"time"in n&&Object.assign(Ih.formats.time,n.time)),cs.set(i)}const fv=Ts(!1);var VW=Object.defineProperty,WW=Object.defineProperties,jW=Object.getOwnPropertyDescriptors,qC=Object.getOwnPropertySymbols,qW=Object.prototype.hasOwnProperty,KW=Object.prototype.propertyIsEnumerable,KC=(t,e,n)=>e in t?VW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,GW=(t,e)=>{for(var n in e||(e={}))qW.call(e,n)&&KC(t,n,e[n]);if(qC)for(var n of qC(e))KW.call(e,n)&&KC(t,n,e[n]);return t},ZW=(t,e)=>WW(t,jW(e));let Ix;const o0=Ts(null);function GC(t){return t.split("-").map((e,n,r)=>r.slice(0,n+1).join("-")).reverse()}function im(t,e=Iu().fallbackLocale){const n=GC(t);return e?[...new Set([...n,...GC(e)])]:n}function tl(){return Ix??void 0}o0.subscribe(t=>{Ix=t??void 0,typeof window<"u"&&t!=null&&document.documentElement.setAttribute("lang",t)});const QW=t=>{if(t&&PW(t)&&s0(t)){const{loadingDelay:e}=Iu();let n;return typeof window<"u"&&tl()!=null&&e?n=window.setTimeout(()=>fv.set(!0),e):fv.set(!0),GS(t).then(()=>{o0.set(t)}).finally(()=>{clearTimeout(n),fv.set(!1)})}return o0.set(t)},cs=ZW(GW({},o0),{set:QW}),XW=()=>typeof window>"u"?null:window.navigator.language||window.navigator.languages[0],cb=t=>{const e=Object.create(null);return r=>{const i=JSON.stringify(r);return i in e?e[i]:e[i]=t(r)}};var YW=Object.defineProperty,a0=Object.getOwnPropertySymbols,TM=Object.prototype.hasOwnProperty,_M=Object.prototype.propertyIsEnumerable,ZC=(t,e,n)=>e in t?YW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ZS=(t,e)=>{for(var n in e||(e={}))TM.call(e,n)&&ZC(t,n,e[n]);if(a0)for(var n of a0(e))_M.call(e,n)&&ZC(t,n,e[n]);return t},Mf=(t,e)=>{var n={};for(var r in t)TM.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&a0)for(var r of a0(t))e.indexOf(r)<0&&_M.call(t,r)&&(n[r]=t[r]);return n};const gp=(t,e)=>{const{formats:n}=Iu();if(t in n&&e in n[t])return n[t][e];throw new Error(`[svelte-i18n] Unknown "${e}" ${t} format.`)},JW=cb(t=>{var e=t,{locale:n,format:r}=e,i=Mf(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return r&&(i=gp("number",r)),new Intl.NumberFormat(n,i)}),ej=cb(t=>{var e=t,{locale:n,format:r}=e,i=Mf(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return r?i=gp("date",r):Object.keys(i).length===0&&(i=gp("date","short")),new Intl.DateTimeFormat(n,i)}),tj=cb(t=>{var e=t,{locale:n,format:r}=e,i=Mf(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return r?i=gp("time",r):Object.keys(i).length===0&&(i=gp("time","short")),new Intl.DateTimeFormat(n,i)}),nj=(t={})=>{var e=t,{locale:n=tl()}=e,r=Mf(e,["locale"]);return JW(ZS({locale:n},r))},rj=(t={})=>{var e=t,{locale:n=tl()}=e,r=Mf(e,["locale"]);return ej(ZS({locale:n},r))},ij=(t={})=>{var e=t,{locale:n=tl()}=e,r=Mf(e,["locale"]);return tj(ZS({locale:n},r))},sj=cb((t,e=tl())=>new SM(t,e,Iu().formats,{ignoreTag:Iu().ignoreTag})),oj=(t,e={})=>{var n,r,i,s;let o=e;typeof t=="object"&&(o=t,t=o.id);const{values:a,locale:l=tl(),default:c}=o;if(l==null)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let u=EM(t,l);if(!u)u=(s=(i=(r=(n=Iu()).handleMissingMessage)==null?void 0:r.call(n,{locale:l,id:t,defaultValue:c}))!=null?i:c)!=null?s:t;else if(typeof u!="string")return console.warn(`[svelte-i18n] Message with id "${t}" must be of type "string", found: "${typeof u}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),u;if(!a)return u;let d=u;try{d=sj(u,l).format(a)}catch(f){f instanceof Error&&console.warn(`[svelte-i18n] Message "${t}" has syntax error:`,f.message)}return d},aj=(t,e)=>ij(e).format(t),lj=(t,e)=>rj(e).format(t),cj=(t,e)=>nj(e).format(t),uj=(t,e=tl())=>EM(t,e),nr=$a([cs,Of],()=>oj);$a([cs],()=>aj);$a([cs],()=>lj);$a([cs],()=>cj);$a([cs,Of],()=>uj);function dj(t){return GS(tl()||Iu().initialLocale)}kM("ja",()=>ob(()=>import("./ja-Ssp3ABV6.js"),[]));kM("en",()=>ob(()=>import("./en-BYey4n9P.js"),[]));function fj(){const t=localStorage.getItem("locale"),e=XW();return t&&(t==="ja"||t==="en")?t:e&&e.startsWith("ja")?"ja":"en"}const CM=fj();HW({fallbackLocale:"ja",initialLocale:CM,loadingDelay:0});cs.set(CM);function hj(t){return typeof t=="function"}function sm(t){return t!==null&&typeof t=="object"}const pj=["string","number","bigint","boolean"];function Px(t){return t==null||pj.includes(typeof t)?!0:Array.isArray(t)?t.every(e=>Px(e)):typeof t=="object"?Object.getPrototypeOf(t)===Object.prototype:!1}const l0=Symbol("box"),AM=Symbol("is-writable");function Be(t,e){const n=ae(t);return e?{[l0]:!0,[AM]:!0,get current(){return k(n)},set current(r){e(r)}}:{[l0]:!0,get current(){return t()}}}function IM(t){return sm(t)&&l0 in t}function mj(t){return IM(t)?t:hj(t)?Be(t):_s(t)}function _s(t){let e=ge(Nt(t));return{[l0]:!0,[AM]:!0,get current(){return k(e)},set current(n){K(e,n,!0)}}}function PM(...t){return function(e){for(const n of t)if(n){if(e.defaultPrevented)return;typeof n=="function"?n.call(this,e):n.current?.call(this,e)}}}var QC=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,gj=/\n/g,yj=/^\s*/,bj=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,wj=/^:\s*/,vj=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,xj=/^[;\s]*/,Sj=/^\s+|\s+$/g,Ej=`
`,XC="/",YC="*",Jc="",kj="comment",Tj="declaration";function _j(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function i(p){var m=p.match(gj);m&&(n+=m.length);var g=p.lastIndexOf(Ej);r=~g?p.length-g:r+p.length}function s(){var p={line:n,column:r};return function(m){return m.position=new o(p),c(),m}}function o(p){this.start=p,this.end={line:n,column:r},this.source=e.source}o.prototype.content=t;function a(p){var m=new Error(e.source+":"+n+":"+r+": "+p);if(m.reason=p,m.filename=e.source,m.line=n,m.column=r,m.source=t,!e.silent)throw m}function l(p){var m=p.exec(t);if(m){var g=m[0];return i(g),t=t.slice(g.length),m}}function c(){l(yj)}function u(p){var m;for(p=p||[];m=d();)m!==!1&&p.push(m);return p}function d(){var p=s();if(!(XC!=t.charAt(0)||YC!=t.charAt(1))){for(var m=2;Jc!=t.charAt(m)&&(YC!=t.charAt(m)||XC!=t.charAt(m+1));)++m;if(m+=2,Jc===t.charAt(m-1))return a("End of comment missing");var g=t.slice(2,m-2);return r+=2,i(g),t=t.slice(m),r+=2,p({type:kj,comment:g})}}function f(){var p=s(),m=l(bj);if(m){if(d(),!l(wj))return a("property missing ':'");var g=l(vj),y=p({type:Tj,property:JC(m[0].replace(QC,Jc)),value:g?JC(g[0].replace(QC,Jc)):Jc});return l(xj),y}}function h(){var p=[];u(p);for(var m;m=f();)m!==!1&&(p.push(m),u(p));return p}return c(),h()}function JC(t){return t?t.replace(Sj,Jc):Jc}function Cj(t,e){let n=null;if(!t||typeof t!="string")return n;const r=_j(t),i=typeof e=="function";return r.forEach(s=>{if(s.type!=="declaration")return;const{property:o,value:a}=s;i?e(o,a,s):a&&(n=n||{},n[o]=a)}),n}const Aj=/\d/,Ij=["-","_","/","."];function Pj(t=""){if(!Aj.test(t))return t!==t.toLowerCase()}function Oj(t){const e=[];let n="",r,i;for(const s of t){const o=Ij.includes(s);if(o===!0){e.push(n),n="",r=void 0;continue}const a=Pj(s);if(i===!1){if(r===!1&&a===!0){e.push(n),n=s,r=a;continue}if(r===!0&&a===!1&&n.length>1){const l=n.at(-1);e.push(n.slice(0,Math.max(0,n.length-1))),n=l+s,r=a;continue}}n+=s,r=a,i=o}return e.push(n),e}function OM(t){return t?Oj(t).map(e=>Nj(e)).join(""):""}function Mj(t){return Rj(OM(t||""))}function Nj(t){return t?t[0].toUpperCase()+t.slice(1):""}function Rj(t){return t?t[0].toLowerCase()+t.slice(1):""}function Ph(t){if(!t)return{};const e={};function n(r,i){if(r.startsWith("-moz-")||r.startsWith("-webkit-")||r.startsWith("-ms-")||r.startsWith("-o-")){e[OM(r)]=i;return}if(r.startsWith("--")){e[r]=i;return}e[Mj(r)]=i}return Cj(t,n),e}function Dd(...t){return(...e)=>{for(const n of t)typeof n=="function"&&n(...e)}}function Dj(t,e){const n=RegExp(t,"g");return r=>{if(typeof r!="string")throw new TypeError(`expected an argument of type string, but got ${typeof r}`);return r.match(n)?r.replace(n,e):r}}const Lj=Dj(/[A-Z]/,t=>`-${t.toLowerCase()}`);function Bj(t){if(!t||typeof t!="object"||Array.isArray(t))throw new TypeError(`expected an argument of type object, but got ${typeof t}`);return Object.keys(t).map(e=>`${Lj(e)}: ${t[e]};`).join(`
`)}function MM(t={}){return Bj(t).replace(`
`," ")}const Fj=["onabort","onanimationcancel","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncompositionend","oncompositionstart","oncompositionupdate","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel"],$j=new Set(Fj);function zj(t){return $j.has(t)}function mr(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const r=t[n];if(r){for(const i of Object.keys(r)){const s=e[i],o=r[i],a=typeof s=="function",l=typeof o=="function";if(a&&zj(i)){const c=s,u=o;e[i]=PM(c,u)}else if(a&&l)e[i]=Dd(s,o);else if(i==="class"){const c=Px(s),u=Px(o);c&&u?e[i]=vg(s,o):c?e[i]=vg(s):u&&(e[i]=vg(o))}else if(i==="style"){const c=typeof s=="object",u=typeof o=="object",d=typeof s=="string",f=typeof o=="string";if(c&&u)e[i]={...s,...o};else if(c&&f){const h=Ph(o);e[i]={...s,...h}}else if(d&&u){const h=Ph(s);e[i]={...h,...o}}else if(d&&f){const h=Ph(s),p=Ph(o);e[i]={...h,...p}}else c?e[i]=s:u?e[i]=o:d?e[i]=s:f&&(e[i]=o)}else e[i]=o!==void 0?o:s}for(const i of Object.getOwnPropertySymbols(r)){const s=e[i],o=r[i];e[i]=o!==void 0?o:s}}}return typeof e.style=="object"&&(e.style=MM(e.style).replaceAll(`
`," ")),e.hidden===!1&&(e.hidden=void 0,delete e.hidden),e.disabled===!1&&(e.disabled=void 0,delete e.disabled),e}const NM=typeof window<"u"?window:void 0;function Uj(t){let e=t.activeElement;for(;e?.shadowRoot;){const n=e.shadowRoot.activeElement;if(n===e)break;e=n}return e}class RM extends Map{#e=new Map;#t=ge(0);#n=ge(0);#r=Fa||-1;constructor(e){if(super(),e){for(var[n,r]of e)super.set(n,r);this.#n.v=super.size}}#i(e){return Fa===this.#r?ge(e):Tu(e)}has(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#i(0),n.set(e,r);else return k(this.#t),!1}return k(r),!0}forEach(e,n){this.#o(),super.forEach(e,n)}get(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#i(0),n.set(e,r);else{k(this.#t);return}}return k(r),super.get(e)}set(e,n){var r=this.#e,i=r.get(e),s=super.get(e),o=super.set(e,n),a=this.#t;if(i===void 0)i=this.#i(0),r.set(e,i),K(this.#n,super.size),Ao(a);else if(s!==n){Ao(i);var l=a.reactions===null?null:new Set(a.reactions),c=l===null||!i.reactions?.every(u=>l.has(u));c&&Ao(a)}return o}delete(e){var n=this.#e,r=n.get(e),i=super.delete(e);return r!==void 0&&(n.delete(e),K(this.#n,super.size),K(r,-1),Ao(this.#t)),i}clear(){if(super.size!==0){super.clear();var e=this.#e;K(this.#n,0);for(var n of e.values())K(n,-1);Ao(this.#t),e.clear()}}#o(){k(this.#t);var e=this.#e;if(this.#n.v!==e.size){for(var n of super.keys())if(!e.has(n)){var r=this.#i(0);e.set(n,r)}}for([,r]of this.#e)k(r)}keys(){return k(this.#t),super.keys()}values(){return this.#o(),super.values()}entries(){return this.#o(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return k(this.#n),super.size}}class Hj{#e;#t;constructor(e={}){const{window:n=NM,document:r=n?.document}=e;n!==void 0&&(this.#e=r,this.#t=CO(i=>{const s=ni(n,"focusin",i),o=ni(n,"focusout",i);return()=>{s(),o()}}))}get current(){return this.#t?.(),this.#e?Uj(this.#e):null}}new Hj;function Vj(t){return typeof t=="function"}class Mc{#e;#t;constructor(e){this.#e=e,this.#t=Symbol(e)}get key(){return this.#t}exists(){return $7(this.#t)}get(){const e=rx(this.#t);if(e===void 0)throw new Error(`Context "${this.#e}" not found`);return e}getOr(e){const n=rx(this.#t);return n===void 0?e:n}set(e){return F7(this.#t,e)}}function Wj(t,e){switch(t){case"post":Ge(e);break;case"pre":sU(e);break}}function DM(t,e,n,r={}){const{lazy:i=!1}=r;let s=!i,o=Array.isArray(t)?[]:void 0;Wj(e,()=>{const a=Array.isArray(t)?t.map(c=>c()):t();if(!s){s=!0,o=a;return}const l=ls(()=>n(a,o));return o=a,l})}function Ur(t,e,n){DM(t,"post",e,n)}function jj(t,e,n){DM(t,"pre",e,n)}Ur.pre=jj;function eA(t){return Vj(t)?t():t}class qj{#e={width:0,height:0};#t=!1;#n;#r;#i;#o=ae(()=>(k(this.#s)?.(),this.getSize().width));#a=ae(()=>(k(this.#s)?.(),this.getSize().height));#s=ae(()=>{const e=eA(this.#r);if(e)return CO(n=>{if(!this.#i)return;const r=new this.#i.ResizeObserver(i=>{this.#t=!0;for(const s of i){const o=this.#n.box==="content-box"?s.contentBoxSize:s.borderBoxSize,a=Array.isArray(o)?o:[o];this.#e.width=a.reduce((l,c)=>Math.max(l,c.inlineSize),0),this.#e.height=a.reduce((l,c)=>Math.max(l,c.blockSize),0)}n()});return r.observe(e),()=>{this.#t=!1,r.disconnect()}})});constructor(e,n={box:"border-box"}){this.#i=n.window??NM,this.#n=n,this.#r=e,this.#e={width:0,height:0}}calculateSize(){const e=eA(this.#r);if(!e||!this.#i)return;const n=e.offsetWidth,r=e.offsetHeight;if(this.#n.box==="border-box")return{width:n,height:r};const i=this.#i.getComputedStyle(e),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),a=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth),l=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),c=n-s-a,u=r-o-l;return{width:c,height:u}}getSize(){return this.#t?this.#e:this.calculateSize()??this.#e}get current(){return k(this.#s)?.(),this.getSize()}get width(){return k(this.#o)}get height(){return k(this.#a)}}function Vu(t){Ge(()=>()=>{t()})}function Kj(t){Ge(()=>ls(()=>t()))}function Gj(t,e){return setTimeout(e,t)}function QS(t){qa().then(t)}const Zj=1,Qj=9,Xj=11;function Ox(t){return sm(t)&&t.nodeType===Zj&&typeof t.nodeName=="string"}function LM(t){return sm(t)&&t.nodeType===Qj}function Yj(t){return sm(t)&&t.constructor?.name==="VisualViewport"}function Jj(t){return sm(t)&&t.nodeType!==void 0}function BM(t){return Jj(t)&&t.nodeType===Xj&&"host"in t}function eq(t,e){if(!t||!e||!Ox(t)||!Ox(e))return!1;const n=e.getRootNode?.();if(t===e||t.contains(e))return!0;if(n&&BM(n)){let r=e;for(;r;){if(t===r)return!0;r=r.parentNode||r.host}}return!1}function FM(t){return LM(t)?t:Yj(t)?t.document:t?.ownerDocument??document}function XS(t){return BM(t)?XS(t.host):LM(t)?t.defaultView??window:Ox(t)?t.ownerDocument?.defaultView??window:window}function tq(t){let e=t.activeElement;for(;e?.shadowRoot;){const n=e.shadowRoot.activeElement;if(n===e)break;e=n}return e}class YS{element;#e=ae(()=>this.element.current?this.element.current.getRootNode()??document:document);get root(){return k(this.#e)}set root(e){K(this.#e,e)}constructor(e){typeof e=="function"?this.element=Be(e):this.element=e}getDocument=()=>FM(this.root);getWindow=()=>this.getDocument().defaultView??window;getActiveElement=()=>tq(this.root);isActiveElement=e=>e===this.getActiveElement();getElementById(e){return this.root.getElementById(e)}querySelector=e=>this.root?this.root.querySelector(e):null;querySelectorAll=e=>this.root?this.root.querySelectorAll(e):[];setTimeout=(e,n)=>this.getWindow().setTimeout(e,n);clearTimeout=e=>this.getWindow().clearTimeout(e)}function Is(t,e){return{[mU()]:n=>IM(t)?(t.current=n,ls(()=>e?.(n)),()=>{"isConnected"in n&&n.isConnected||(t.current=null,e?.(null))}):(t(n),ls(()=>e?.(n)),()=>{"isConnected"in n&&n.isConnected||(t(null),e?.(null))})}}function nq(t){return t?"true":"false"}function af(t){return t?"":void 0}function JS(t){return t?"open":"closed"}class rq{#e;#t;attrs;constructor(e){this.#e=e.getVariant?e.getVariant():null,this.#t=this.#e?`data-${this.#e}-`:`data-${e.component}-`,this.getAttr=this.getAttr.bind(this),this.selector=this.selector.bind(this),this.attrs=Object.fromEntries(e.parts.map(n=>[n,this.getAttr(n)]))}getAttr(e,n){return n?`data-${n}-${e}`:`${this.#t}${e}`}selector(e,n){return`[${this.getAttr(e,n)}]`}}function ub(t){const e=new rq(t);return{...e.attrs,selector:e.selector,getAttr:e.getAttr}}const $M="Enter",iq="Escape",zM=" ",UM=typeof document<"u",tA=sq();function sq(){return UM&&window?.navigator?.userAgent&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||window?.navigator?.maxTouchPoints>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function Mx(t){return t instanceof HTMLElement}function c0(t){return t instanceof Element}function oq(t){return t instanceof Element||t instanceof SVGElement}function aq(t){return t.matches(":focus-visible")}function lq(t){return t!==null}class cq{#e;#t=null;constructor(e){this.#e=e,Vu(()=>this.#n())}#n(){this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null)}run(e){this.#n();const n=this.#e.ref.current;if(n){if(typeof n.getAnimations!="function"){this.#r(e);return}this.#t=window.requestAnimationFrame(()=>{const r=n.getAnimations();if(r.length===0){this.#r(e);return}Promise.allSettled(r.map(i=>i.finished)).then(()=>{this.#r(e)})})}}#r(e){const n=()=>{e()};this.#e.afterTick?QS(n):n()}}class yp{#e;#t;#n;#r=ge(!1);constructor(e){this.#e=e,K(this.#r,e.open.current,!0),this.#t=e.enabled??!0,this.#n=new cq({ref:this.#e.ref,afterTick:this.#e.open}),Ur(()=>this.#e.open.current,n=>{n&&K(this.#r,!0),this.#t&&this.#n.run(()=>{n===this.#e.open.current&&(this.#e.open.current||K(this.#r,!1),this.#e.onComplete?.())})})}get shouldRender(){return k(this.#r)}}function bn(){}function nl(t,e){return`bits-${t}`}const uq=ub({component:"dialog",parts:["content","trigger","overlay","title","description","close","cancel","action"]}),Pu=new Mc("Dialog.Root | AlertDialog.Root");class eE{static create(e){const n=Pu.getOr(null);return Pu.set(new eE(e,n))}opts;#e=ge(null);get triggerNode(){return k(this.#e)}set triggerNode(e){K(this.#e,e,!0)}#t=ge(null);get contentNode(){return k(this.#t)}set contentNode(e){K(this.#t,e,!0)}#n=ge(null);get overlayNode(){return k(this.#n)}set overlayNode(e){K(this.#n,e,!0)}#r=ge(null);get descriptionNode(){return k(this.#r)}set descriptionNode(e){K(this.#r,e,!0)}#i=ge(void 0);get contentId(){return k(this.#i)}set contentId(e){K(this.#i,e,!0)}#o=ge(void 0);get titleId(){return k(this.#o)}set titleId(e){K(this.#o,e,!0)}#a=ge(void 0);get triggerId(){return k(this.#a)}set triggerId(e){K(this.#a,e,!0)}#s=ge(void 0);get descriptionId(){return k(this.#s)}set descriptionId(e){K(this.#s,e,!0)}#l=ge(null);get cancelNode(){return k(this.#l)}set cancelNode(e){K(this.#l,e,!0)}#u=ge(0);get nestedOpenCount(){return k(this.#u)}set nestedOpenCount(e){K(this.#u,e,!0)}depth;parent;contentPresence;overlayPresence;constructor(e,n){this.opts=e,this.parent=n,this.depth=n?n.depth+1:0,this.handleOpen=this.handleOpen.bind(this),this.handleClose=this.handleClose.bind(this),this.contentPresence=new yp({ref:Be(()=>this.contentNode),open:this.opts.open,enabled:!0,onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),this.overlayPresence=new yp({ref:Be(()=>this.overlayNode),open:this.opts.open,enabled:!0}),Ur(()=>this.opts.open.current,r=>{this.parent&&(r?this.parent.incrementNested():this.parent.decrementNested())},{lazy:!0}),Vu(()=>{this.opts.open.current&&this.parent?.decrementNested()})}handleOpen(){this.opts.open.current||(this.opts.open.current=!0)}handleClose(){this.opts.open.current&&(this.opts.open.current=!1)}getBitsAttr=e=>uq.getAttr(e,this.opts.variant.current);incrementNested(){this.nestedOpenCount++,this.parent?.incrementNested()}decrementNested(){this.nestedOpenCount!==0&&(this.nestedOpenCount--,this.parent?.decrementNested())}#c=ae(()=>({"data-state":JS(this.opts.open.current)}));get sharedProps(){return k(this.#c)}set sharedProps(e){K(this.#c,e)}}class tE{static create(e){return new tE(e,Pu.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Is(this.opts.ref),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onclick(e){this.opts.disabled.current||e.button>0||this.root.handleClose()}onkeydown(e){this.opts.disabled.current||(e.key===zM||e.key===$M)&&(e.preventDefault(),this.root.handleClose())}#e=ae(()=>({id:this.opts.id.current,[this.root.getBitsAttr(this.opts.variant.current)]:"",onclick:this.onclick,onkeydown:this.onkeydown,disabled:this.opts.disabled.current?!0:void 0,tabindex:0,...this.root.sharedProps,...this.attachment}));get props(){return k(this.#e)}set props(e){K(this.#e,e)}}class nE{static create(e){return new nE(e,Pu.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.root.titleId=this.opts.id.current,this.attachment=Is(this.opts.ref),Ur.pre(()=>this.opts.id.current,r=>{this.root.titleId=r})}#e=ae(()=>({id:this.opts.id.current,role:"heading","aria-level":this.opts.level.current,[this.root.getBitsAttr("title")]:"",...this.root.sharedProps,...this.attachment}));get props(){return k(this.#e)}set props(e){K(this.#e,e)}}class rE{static create(e){return new rE(e,Pu.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.root.descriptionId=this.opts.id.current,this.attachment=Is(this.opts.ref,r=>{this.root.descriptionNode=r}),Ur.pre(()=>this.opts.id.current,r=>{this.root.descriptionId=r})}#e=ae(()=>({id:this.opts.id.current,[this.root.getBitsAttr("description")]:"",...this.root.sharedProps,...this.attachment}));get props(){return k(this.#e)}set props(e){K(this.#e,e)}}class iE{static create(e){return new iE(e,Pu.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Is(this.opts.ref,r=>{this.root.contentNode=r,this.root.contentId=r?.id})}#e=ae(()=>({open:this.root.opts.open.current}));get snippetProps(){return k(this.#e)}set snippetProps(e){K(this.#e,e)}#t=ae(()=>({id:this.opts.id.current,role:this.root.opts.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-modal":"true","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.getBitsAttr("content")]:"",style:{pointerEvents:"auto",outline:this.root.opts.variant.current==="alert-dialog"?"none":void 0,"--bits-dialog-depth":this.root.depth,"--bits-dialog-nested-count":this.root.nestedOpenCount},tabindex:this.root.opts.variant.current==="alert-dialog"?-1:void 0,"data-nested-open":af(this.root.nestedOpenCount>0),"data-nested":af(this.root.parent!==null),...this.root.sharedProps,...this.attachment}));get props(){return k(this.#t)}set props(e){K(this.#t,e)}get shouldRender(){return this.root.contentPresence.shouldRender}}class sE{static create(e){return new sE(e,Pu.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Is(this.opts.ref,r=>this.root.overlayNode=r)}#e=ae(()=>({open:this.root.opts.open.current}));get snippetProps(){return k(this.#e)}set snippetProps(e){K(this.#e,e)}#t=ae(()=>({id:this.opts.id.current,[this.root.getBitsAttr("overlay")]:"",style:{pointerEvents:"auto","--bits-dialog-depth":this.root.depth,"--bits-dialog-nested-count":this.root.nestedOpenCount},"data-nested-open":af(this.root.nestedOpenCount>0),"data-nested":af(this.root.parent!==null),...this.root.sharedProps,...this.attachment}));get props(){return k(this.#t)}set props(e){K(this.#t,e)}get shouldRender(){return this.root.overlayPresence.shouldRender}}var dq=_e("<div><!></div>");function fq(t,e){const n=Xo();St(e,!0);let r=le(e,"id",19,()=>nl(n)),i=le(e,"ref",15,null),s=le(e,"level",3,2),o=_i(e,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const a=nE.create({id:Be(()=>r()),level:Be(()=>s()),ref:Be(()=>i(),h=>i(h))}),l=ae(()=>mr(o,a.props));var c=Fe(),u=Te(c);{var d=h=>{var p=Fe(),m=Te(p);Tt(m,()=>e.child,()=>({props:k(l)})),X(h,p)},f=h=>{var p=dq();wr(p,()=>({...k(l)}));var m=re(p);Tt(m,()=>e.children??Ut),X(h,p)};$e(u,h=>{e.child?h(d):h(f,!1)})}X(t,c),Et()}function hq(t,e){var n=Fe(),r=Te(n);TU(r,()=>e.children,i=>{var s=Fe(),o=Te(s);Tt(o,()=>e.children??Ut),X(i,s)}),X(t,n)}const pq=new Mc("BitsConfig");function mq(){const t=new gq(null,{});return pq.getOr(t).opts}class gq{opts;constructor(e,n){const r=yq(e,n);this.opts={defaultPortalTo:r(i=>i.defaultPortalTo),defaultLocale:r(i=>i.defaultLocale)}}}function yq(t,e){return n=>Be(()=>{const i=n(e)?.current;if(i!==void 0)return i;if(t!==null)return n(t.opts)?.current})}function bq(t,e){return n=>{const r=mq();return Be(()=>{const i=n();if(i!==void 0)return i;const s=t(r).current;return s!==void 0?s:e})}}const wq=bq(t=>t.defaultPortalTo,"body");function oc(t,e){St(e,!0);const n=wq(()=>e.to),r=z7();let i=ae(s);function s(){if(!UM||e.disabled)return null;let d=null;return typeof n.current=="string"?d=document.querySelector(n.current):d=n.current,d}let o;function a(){o&&(e4(o),o=null)}Ur([()=>k(i),()=>e.disabled],([d,f])=>{if(!d||f){a();return}return o=PS(hq,{target:d,props:{children:e.children},context:r}),()=>{a()}});var l=Fe(),c=Te(l);{var u=d=>{var f=Fe(),h=Te(f);Tt(h,()=>e.children??Ut),X(d,f)};$e(c,d=>{e.disabled&&d(u)})}X(t,l),Et()}function nA(t,e=500){let n=null;const r=(...i)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{t(...i)},e)};return r.destroy=()=>{n!==null&&(clearTimeout(n),n=null)},r}function HM(t,e){return t===e||t.contains(e)}function VM(t){return t?.ownerDocument??document}function vq(t,e){const{clientX:n,clientY:r}=t,i=e.getBoundingClientRect();return n<i.left||n>i.right||r<i.top||r>i.bottom}/*!
* tabbable 6.4.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var WM=["input:not([inert]):not([inert] *)","select:not([inert]):not([inert] *)","textarea:not([inert]):not([inert] *)","a[href]:not([inert]):not([inert] *)","button:not([inert]):not([inert] *)","[tabindex]:not(slot):not([inert]):not([inert] *)","audio[controls]:not([inert]):not([inert] *)","video[controls]:not([inert]):not([inert] *)",'[contenteditable]:not([contenteditable="false"]):not([inert]):not([inert] *)',"details>summary:first-of-type:not([inert]):not([inert] *)","details:not([inert]):not([inert] *)"],Nx=WM.join(","),jM=typeof Element>"u",lf=jM?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,u0=!jM&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},d0=function(e,n){var r;n===void 0&&(n=!0);var i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=i===""||i==="true",o=s||n&&e&&(typeof e.closest=="function"?e.closest("[inert]"):d0(e.parentNode));return o},xq=function(e){var n,r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return r===""||r==="true"},qM=function(e,n,r){if(d0(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(Nx));return n&&lf.call(e,Nx)&&i.unshift(e),i=i.filter(r),i},f0=function(e,n,r){for(var i=[],s=Array.from(e);s.length;){var o=s.shift();if(!d0(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=f0(l,!0,r);r.flatten?i.push.apply(i,c):i.push({scopeParent:o,candidates:c})}else{var u=lf.call(o,Nx);u&&r.filter(o)&&(n||!e.includes(o))&&i.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!d0(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var h=f0(d===!0?o.children:d.children,!0,r);r.flatten?i.push.apply(i,h):i.push({scopeParent:o,candidates:h})}else s.unshift.apply(s,o.children)}}return i},KM=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},GM=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||xq(e))&&!KM(e)?0:e.tabIndex},Sq=function(e,n){var r=GM(e);return r<0&&n&&!KM(e)?0:r},Eq=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},ZM=function(e){return e.tagName==="INPUT"},kq=function(e){return ZM(e)&&e.type==="hidden"},Tq=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return n},_q=function(e,n){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===n)return e[r]},Cq=function(e){if(!e.name)return!0;var n=e.form||u0(e),r=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=r(window.CSS.escape(e.name));else try{i=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=_q(i,e.form);return!s||s===e},Aq=function(e){return ZM(e)&&e.type==="radio"},Iq=function(e){return Aq(e)&&!Cq(e)},Pq=function(e){var n,r=e&&u0(e),i=(n=r)===null||n===void 0?void 0:n.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&i;){var c,u,d;r=u0(i),i=(c=r)===null||c===void 0?void 0:c.host,s=!!((u=i)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(i))}}return s},rA=function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height;return r===0&&i===0},Oq=function(e,n){var r=n.displayCheck,i=n.getShadowRoot;if(r==="full-native"&&"checkVisibility"in e){var s=e.checkVisibility({checkOpacity:!1,opacityProperty:!1,contentVisibilityAuto:!0,visibilityProperty:!0,checkVisibilityCSS:!0});return!s}if(getComputedStyle(e).visibility==="hidden")return!0;var o=lf.call(e,"details>summary:first-of-type"),a=o?e.parentElement:e;if(lf.call(a,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="full-native"||r==="legacy-full"){if(typeof i=="function"){for(var l=e;e;){var c=e.parentElement,u=u0(e);if(c&&!c.shadowRoot&&i(c)===!0)return rA(e);e.assignedSlot?e=e.assignedSlot:!c&&u!==e.ownerDocument?e=u.host:e=c}e=l}if(Pq(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return rA(e);return!1},Mq=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var i=n.children.item(r);if(i.tagName==="LEGEND")return lf.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},h0=function(e,n){return!(n.disabled||kq(n)||Oq(n,e)||Tq(n)||Mq(n))},iA=function(e,n){return!(Iq(n)||GM(n)<0||!h0(e,n))},Nq=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},QM=function(e){var n=[],r=[];return e.forEach(function(i,s){var o=!!i.scopeParent,a=o?i.scopeParent:i,l=Sq(a,o),c=o?QM(i.candidates):a;l===0?o?n.push.apply(n,c):n.push(a):r.push({documentOrder:s,tabIndex:l,item:i,isScope:o,content:c})}),r.sort(Eq).reduce(function(i,s){return s.isScope?i.push.apply(i,s.content):i.push(s.content),i},[]).concat(n)},Rq=function(e,n){n=n||{};var r;return n.getShadowRoot?r=f0([e],n.includeContainer,{filter:iA.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:Nq}):r=qM(e,n.includeContainer,iA.bind(null,n)),QM(r)},Dq=function(e,n){n=n||{};var r;return n.getShadowRoot?r=f0([e],n.includeContainer,{filter:h0.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):r=qM(e,n.includeContainer,h0.bind(null,n)),r},Lq=WM.concat("iframe:not([inert]):not([inert] *)").join(","),Bq=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return lf.call(e,Lq)===!1?!1:h0(n,e)};const Fq={afterMs:1e4,onChange:bn};function $q(t,e){const{afterMs:n,onChange:r,getWindow:i}={...Fq,...e};let s=null,o=ge(Nt(t));function a(){return i().setTimeout(()=>{K(o,t,!0),r?.(t)},n)}return Ge(()=>()=>{s&&i().clearTimeout(s)}),Be(()=>k(o),l=>{K(o,l,!0),r?.(l),s&&i().clearTimeout(s),s=a()})}class zq{#e;#t;#n;#r=ge(null);constructor(e){this.#e=e,this.#t=ae(()=>this.#e.enabled()),this.#n=$q(!1,{afterMs:e.transitTimeout??300,onChange:n=>{k(this.#t)&&this.#e.setIsPointerInTransit?.(n)},getWindow:()=>XS(this.#e.triggerNode())}),Ur([e.triggerNode,e.contentNode,e.enabled],([n,r,i])=>{if(!n||!r||!i)return;const s=a=>{this.#o(a,r)},o=a=>{this.#o(a,n)};return Dd(ni(n,"pointerleave",s),ni(r,"pointerleave",o))}),Ur(()=>k(this.#r),()=>{const n=i=>{if(!k(this.#r))return;const s=i.target;if(!c0(s))return;const o={x:i.clientX,y:i.clientY},a=e.triggerNode()?.contains(s)||e.contentNode()?.contains(s),l=!Wq(o,k(this.#r));a?this.#i():l&&(this.#i(),e.onPointerExit())},r=FM(e.triggerNode()??e.contentNode());if(r)return ni(r,"pointermove",n)})}#i(){K(this.#r,null),this.#n.current=!1}#o(e,n){const r=e.currentTarget;if(!Mx(r))return;const i={x:e.clientX,y:e.clientY},s=Uq(i,r.getBoundingClientRect()),o=Hq(i,s),a=Vq(n.getBoundingClientRect()),l=jq([...o,...a]);K(this.#r,l,!0),this.#n.current=!0}}function Uq(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),i=Math.abs(e.right-t.x),s=Math.abs(e.left-t.x);switch(Math.min(n,r,i,s)){case s:return"left";case i:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function Hq(t,e,n=5){const r=n*1.5;switch(e){case"top":return[{x:t.x-n,y:t.y+n},{x:t.x,y:t.y-r},{x:t.x+n,y:t.y+n}];case"bottom":return[{x:t.x-n,y:t.y-n},{x:t.x,y:t.y+r},{x:t.x+n,y:t.y-n}];case"left":return[{x:t.x+n,y:t.y-n},{x:t.x-r,y:t.y},{x:t.x+n,y:t.y+n}];case"right":return[{x:t.x-n,y:t.y-n},{x:t.x+r,y:t.y},{x:t.x-n,y:t.y+n}]}}function Vq(t){const{top:e,right:n,bottom:r,left:i}=t;return[{x:i,y:e},{x:n,y:e},{x:n,y:r},{x:i,y:r}]}function Wq(t,e){const{x:n,y:r}=t;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].x,l=e[s].y,c=e[o].x,u=e[o].y;l>r!=u>r&&n<(c-a)*(r-l)/(u-l)+a&&(i=!i)}return i}function jq(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),qq(e)}function qq(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const i=t[r];for(;e.length>=2;){const s=e[e.length-1],o=e[e.length-2];if((s.x-o.x)*(i.y-o.y)>=(s.y-o.y)*(i.x-o.x))e.pop();else break}e.push(i)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const i=t[r];for(;n.length>=2;){const s=n[n.length-1],o=n[n.length-2];if((s.x-o.x)*(i.y-o.y)>=(s.y-o.y)*(i.x-o.x))n.pop();else break}n.push(i)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}const Kq="data-context-menu-trigger",Gq="data-context-menu-content";ub({component:"menu",parts:["trigger","content","sub-trigger","item","group","group-heading","checkbox-group","checkbox-item","radio-group","radio-item","separator","sub-content","arrow"]});globalThis.bitsDismissableLayers??=new Map;class oE{static create(e){return new oE(e)}opts;#e;#t;#n={pointerdown:!1};#r=!1;#i=!1;#o=void 0;#a;#s=bn;constructor(e){this.opts=e,this.#t=e.interactOutsideBehavior,this.#e=e.onInteractOutside,this.#a=e.onFocusOutside,Ge(()=>{this.#o=VM(this.opts.ref.current)});let n=bn;const r=()=>{this.#m(),globalThis.bitsDismissableLayers.delete(this),this.#d.destroy(),n()};Ur([()=>this.opts.enabled.current,()=>this.opts.ref.current],()=>{if(!(!this.opts.enabled.current||!this.opts.ref.current))return Gj(1,()=>{this.opts.ref.current&&(globalThis.bitsDismissableLayers.set(this,this.#t),n(),n=this.#u())}),r}),Vu(()=>{this.#m.destroy(),globalThis.bitsDismissableLayers.delete(this),this.#d.destroy(),this.#s(),n()})}#l=e=>{e.defaultPrevented||this.opts.ref.current&&QS(()=>{!this.opts.ref.current||this.#g(e.target)||e.target&&!this.#i&&this.#a.current?.(e)})};#u(){return Dd(ni(this.#o,"pointerdown",Dd(this.#h,this.#p),{capture:!0}),ni(this.#o,"pointerdown",Dd(this.#f,this.#d)),ni(this.#o,"focusin",this.#l))}#c=e=>{let n=e;n.defaultPrevented&&(n=sA(e)),this.#e.current(e)};#d=nA(e=>{if(!this.opts.ref.current){this.#s();return}const n=this.opts.isValidEvent.current(e,this.opts.ref.current)||Xq(e,this.opts.ref.current);if(!this.#r||this.#y()||!n){this.#s();return}let r=e;if(r.defaultPrevented&&(r=sA(r)),this.#t.current!=="close"&&this.#t.current!=="defer-otherwise-close"){this.#s();return}e.pointerType==="touch"?(this.#s(),this.#s=ni(this.#o,"click",this.#c,{once:!0})):this.#e.current(r)},10);#h=e=>{this.#n[e.type]=!0};#f=e=>{this.#n[e.type]=!1};#p=()=>{this.opts.ref.current&&(this.#r=Qq(this.opts.ref.current))};#g=e=>this.opts.ref.current?HM(this.opts.ref.current,e):!1;#m=nA(()=>{for(const e in this.#n)this.#n[e]=!1;this.#r=!1},20);#y(){return Object.values(this.#n).some(Boolean)}#b=()=>{this.#i=!0};#w=()=>{this.#i=!1};props={onfocuscapture:this.#b,onblurcapture:this.#w}}function Zq(t=[...globalThis.bitsDismissableLayers]){return t.findLast(([e,{current:n}])=>n==="close"||n==="ignore")}function Qq(t){const e=[...globalThis.bitsDismissableLayers],n=Zq(e);if(n)return n[0].opts.ref.current===t;const[r]=e[0];return r.opts.ref.current===t}function Xq(t,e){const n=t.target;if(!oq(n))return!1;const r=!!n.closest(`[${Kq}]`);if("button"in t&&t.button>0&&!r)return!1;if("button"in t&&t.button===0&&r)return!0;const i=!!e.closest(`[${Gq}]`);return r&&i?!1:VM(n).documentElement.contains(n)&&!HM(e,n)&&vq(t,e)}function sA(t){const e=t.currentTarget,n=t.target;let r;t instanceof PointerEvent?r=new PointerEvent(t.type,t):r=new PointerEvent("pointerdown",t);let i=!1;return new Proxy(r,{get:(o,a)=>a==="currentTarget"?e:a==="target"?n:a==="preventDefault"?()=>{i=!0,typeof o.preventDefault=="function"&&o.preventDefault()}:a==="defaultPrevented"?i:a in o?o[a]:t[a]})}function XM(t,e){St(e,!0);let n=le(e,"interactOutsideBehavior",3,"close"),r=le(e,"onInteractOutside",3,bn),i=le(e,"onFocusOutside",3,bn),s=le(e,"isValidEvent",3,()=>!1);const o=oE.create({id:Be(()=>e.id),interactOutsideBehavior:Be(()=>n()),onInteractOutside:Be(()=>r()),enabled:Be(()=>e.enabled),onFocusOutside:Be(()=>i()),isValidEvent:Be(()=>s()),ref:e.ref});var a=Fe(),l=Te(a);Tt(l,()=>e.children??Ut,()=>({props:o.props})),X(t,a),Et()}globalThis.bitsEscapeLayers??=new Map;class aE{static create(e){return new aE(e)}opts;domContext;constructor(e){this.opts=e,this.domContext=new YS(this.opts.ref);let n=bn;Ur(()=>e.enabled.current,r=>(r&&(globalThis.bitsEscapeLayers.set(this,e.escapeKeydownBehavior),n=this.#e()),()=>{n(),globalThis.bitsEscapeLayers.delete(this)}))}#e=()=>ni(this.domContext.getDocument(),"keydown",this.#t,{passive:!1});#t=e=>{if(e.key!==iq||!Yq(this))return;const n=new KeyboardEvent(e.type,e);e.preventDefault();const r=this.opts.escapeKeydownBehavior.current;r!=="close"&&r!=="defer-otherwise-close"||this.opts.onEscapeKeydown.current(n)}}function Yq(t){const e=[...globalThis.bitsEscapeLayers],n=e.findLast(([i,{current:s}])=>s==="close"||s==="ignore");if(n)return n[0]===t;const[r]=e[0];return r===t}function YM(t,e){St(e,!0);let n=le(e,"escapeKeydownBehavior",3,"close"),r=le(e,"onEscapeKeydown",3,bn);aE.create({escapeKeydownBehavior:Be(()=>n()),onEscapeKeydown:Be(()=>r()),enabled:Be(()=>e.enabled),ref:e.ref});var i=Fe(),s=Te(i);Tt(s,()=>e.children??Ut),X(t,i),Et()}class lE{static instance;#e=_s([]);#t=new WeakMap;#n=new WeakMap;static getInstance(){return this.instance||(this.instance=new lE),this.instance}register(e){const n=this.getActive();n&&n!==e&&n.pause();const r=document.activeElement;r&&r!==document.body&&this.#n.set(e,r),this.#e.current=this.#e.current.filter(i=>i!==e),this.#e.current.unshift(e)}unregister(e){this.#e.current=this.#e.current.filter(r=>r!==e);const n=this.getActive();n&&n.resume()}getActive(){return this.#e.current[0]}setFocusMemory(e,n){this.#t.set(e,n)}getFocusMemory(e){return this.#t.get(e)}isActiveScope(e){return this.getActive()===e}setPreFocusMemory(e,n){this.#n.set(e,n)}getPreFocusMemory(e){return this.#n.get(e)}clearPreFocusMemory(e){this.#n.delete(e)}}class cE{#e=!1;#t=null;#n=lE.getInstance();#r=[];#i;constructor(e){this.#i=e}get paused(){return this.#e}pause(){this.#e=!0}resume(){this.#e=!1}#o(){for(const e of this.#r)e();this.#r=[]}mount(e){this.#t&&this.unmount(),this.#t=e,this.#n.register(this),this.#l(),this.#a()}unmount(){this.#t&&(this.#o(),this.#s(),this.#n.unregister(this),this.#n.clearPreFocusMemory(this),this.#t=null)}#a(){if(!this.#t)return;const e=new CustomEvent("focusScope.onOpenAutoFocus",{bubbles:!1,cancelable:!0});this.#i.onOpenAutoFocus.current(e),e.defaultPrevented||requestAnimationFrame(()=>{if(!this.#t)return;const n=this.#c();n?(n.focus(),this.#n.setFocusMemory(this,n)):this.#t.focus()})}#s(){const e=new CustomEvent("focusScope.onCloseAutoFocus",{bubbles:!1,cancelable:!0});if(this.#i.onCloseAutoFocus.current?.(e),!e.defaultPrevented){const n=this.#n.getPreFocusMemory(this);if(n&&document.contains(n))try{n.focus()}catch{document.body.focus()}}}#l(){if(!this.#t||!this.#i.trap.current)return;const e=this.#t,n=e.ownerDocument,r=o=>{if(this.#e||!this.#n.isActiveScope(this))return;const a=o.target;if(!a)return;if(e.contains(a))this.#n.setFocusMemory(this,a);else{const c=this.#n.getFocusMemory(this);if(c&&e.contains(c)&&Bq(c))o.preventDefault(),c.focus();else{const u=this.#c(),d=this.#d()[0];(u||d||e).focus()}}},i=o=>{if(!this.#i.loop||this.#e||o.key!=="Tab"||!this.#n.isActiveScope(this))return;const a=this.#u();if(a.length<2)return;const l=a[0],c=a[a.length-1];!o.shiftKey&&n.activeElement===c?(o.preventDefault(),l.focus()):o.shiftKey&&n.activeElement===l&&(o.preventDefault(),c.focus())};this.#r.push(ni(n,"focusin",r,{capture:!0}),ni(e,"keydown",i));const s=new MutationObserver(()=>{const o=this.#n.getFocusMemory(this);if(o&&!e.contains(o)){const a=this.#c(),l=this.#d()[0],c=a||l;c?(c.focus(),this.#n.setFocusMemory(this,c)):e.focus()}});s.observe(e,{childList:!0,subtree:!0}),this.#r.push(()=>s.disconnect())}#u(){return this.#t?Rq(this.#t,{includeContainer:!1,getShadowRoot:!0}):[]}#c(){return this.#u()[0]||null}#d(){return this.#t?Dq(this.#t,{includeContainer:!1,getShadowRoot:!0}):[]}static use(e){let n=null;return Ur([()=>e.ref.current,()=>e.enabled.current],([r,i])=>{r&&i?(n||(n=new cE(e)),n.mount(r)):n&&(n.unmount(),n=null)}),Vu(()=>{n?.unmount()}),{get props(){return{tabindex:-1}}}}}function JM(t,e){St(e,!0);let n=le(e,"enabled",3,!1),r=le(e,"trapFocus",3,!1),i=le(e,"loop",3,!1),s=le(e,"onCloseAutoFocus",3,bn),o=le(e,"onOpenAutoFocus",3,bn);const a=cE.use({enabled:Be(()=>n()),trap:Be(()=>r()),loop:i(),onCloseAutoFocus:Be(()=>s()),onOpenAutoFocus:Be(()=>o()),ref:e.ref});var l=Fe(),c=Te(l);Tt(c,()=>e.focusScope??Ut,()=>({props:a.props})),X(t,l),Et()}globalThis.bitsTextSelectionLayers??=new Map;class uE{static create(e){return new uE(e)}opts;domContext;#e=bn;constructor(e){this.opts=e,this.domContext=new YS(e.ref);let n=bn;Ur(()=>this.opts.enabled.current,r=>(r&&(globalThis.bitsTextSelectionLayers.set(this,this.opts.enabled),n(),n=this.#t()),()=>{n(),this.#r(),globalThis.bitsTextSelectionLayers.delete(this)}))}#t(){return Dd(ni(this.domContext.getDocument(),"pointerdown",this.#n),ni(this.domContext.getDocument(),"pointerup",PM(this.#r,this.opts.onPointerUp.current)))}#n=e=>{const n=this.opts.ref.current,r=e.target;!Mx(n)||!Mx(r)||!this.opts.enabled.current||!eK(this)||!eq(n,r)||(this.opts.onPointerDown.current(e),!e.defaultPrevented&&(this.#e=Jq(n,this.domContext.getDocument().body)))};#r=()=>{this.#e(),this.#e=bn}}const oA=t=>t.style.userSelect||t.style.webkitUserSelect;function Jq(t,e){const n=oA(e),r=oA(t);return Vm(e,"none"),Vm(t,"text"),()=>{Vm(e,n),Vm(t,r)}}function Vm(t,e){t.style.userSelect=e,t.style.webkitUserSelect=e}function eK(t){const e=[...globalThis.bitsTextSelectionLayers];if(!e.length)return!1;const n=e.at(-1);return n?n[0]===t:!1}function e8(t,e){St(e,!0);let n=le(e,"preventOverflowTextSelection",3,!0),r=le(e,"onPointerDown",3,bn),i=le(e,"onPointerUp",3,bn);uE.create({id:Be(()=>e.id),onPointerDown:Be(()=>r()),onPointerUp:Be(()=>i()),enabled:Be(()=>e.enabled&&n()),ref:e.ref});var s=Fe(),o=Te(s);Tt(o,()=>e.children??Ut),X(t,s),Et()}globalThis.bitsIdCounter??={current:0};function dE(t="bits"){return globalThis.bitsIdCounter.current++,`${t}-${globalThis.bitsIdCounter.current}`}class tK{#e;#t=0;#n=ge();#r;constructor(e){this.#e=e}#i(){this.#t-=1,this.#r&&this.#t<=0&&(this.#r(),K(this.#n,void 0),this.#r=void 0)}get(...e){return this.#t+=1,k(this.#n)===void 0&&(this.#r=oU(()=>{K(this.#n,this.#e(...e),!0)})),Ge(()=>()=>{this.#i()}),k(this.#n)}}const Tg=new RM;let Wm=ge(null),hv=null,lh=null,ch=!1;const aA=Be(()=>{for(const t of Tg.values())if(t)return!0;return!1});let pv=null;const nK=new tK(()=>{function t(){document.body.setAttribute("style",k(Wm)??""),document.body.style.removeProperty("--scrollbar-width"),tA&&hv?.(),K(Wm,null)}function e(){lh!==null&&(window.clearTimeout(lh),lh=null)}function n(i,s){e(),ch=!0,pv=Date.now();const o=pv,a=()=>{lh=null,pv===o&&(t8(Tg)?ch=!1:(ch=!1,s()))},l=i===null?24:i;lh=window.setTimeout(a,l)}function r(){k(Wm)===null&&Tg.size===0&&!ch&&K(Wm,document.body.getAttribute("style"),!0)}return Ur(()=>aA.current,()=>{if(!aA.current)return;r(),ch=!1;const i=getComputedStyle(document.body),s=window.innerWidth-document.documentElement.clientWidth,a={padding:Number.parseInt(i.paddingRight??"0",10)+s,margin:Number.parseInt(i.marginRight??"0",10)};s>0&&(document.body.style.paddingRight=`${a.padding}px`,document.body.style.marginRight=`${a.margin}px`,document.body.style.setProperty("--scrollbar-width",`${s}px`),document.body.style.overflow="hidden"),tA&&(hv=ni(document,"touchmove",l=>{l.target===document.documentElement&&(l.touches.length>1||l.preventDefault())},{passive:!1})),QS(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})}),Vu(()=>()=>{hv?.()}),{get lockMap(){return Tg},resetBodyStyle:t,scheduleCleanupIfNoNewLocks:n,cancelPendingCleanup:e,ensureInitialStyleCaptured:r}});class rK{#e=dE();#t;#n=()=>null;#r;locked;constructor(e,n=()=>null){this.#t=e,this.#n=n,this.#r=nK.get(),this.#r&&(this.#r.cancelPendingCleanup(),this.#r.ensureInitialStyleCaptured(),this.#r.lockMap.set(this.#e,this.#t??!1),this.locked=Be(()=>this.#r.lockMap.get(this.#e)??!1,r=>this.#r.lockMap.set(this.#e,r)),Vu(()=>{if(this.#r.lockMap.delete(this.#e),t8(this.#r.lockMap))return;const r=this.#n();this.#r.scheduleCleanupIfNoNewLocks(r,()=>{this.#r.resetBodyStyle()})}))}}function t8(t){for(const[e,n]of t)if(n)return!0;return!1}function p0(t,e){St(e,!0);let n=le(e,"preventScroll",3,!0),r=le(e,"restoreScrollDelay",3,null);n()&&new rK(n(),()=>r()),Et()}var iK=_e("<div><!></div>");function sK(t,e){const n=Xo();St(e,!0);let r=le(e,"id",19,()=>nl(n)),i=le(e,"forceMount",3,!1),s=le(e,"ref",15,null),o=_i(e,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const a=sE.create({id:Be(()=>r()),ref:Be(()=>s(),f=>s(f))}),l=ae(()=>mr(o,a.props));var c=Fe(),u=Te(c);{var d=f=>{var h=Fe(),p=Te(h);{var m=y=>{var b=Fe(),E=Te(b);{let C=ae(()=>({props:mr(k(l)),...a.snippetProps}));Tt(E,()=>e.child,()=>k(C))}X(y,b)},g=y=>{var b=iK();wr(b,C=>({...C}),[()=>mr(k(l))]);var E=re(b);Tt(E,()=>e.children??Ut,()=>a.snippetProps),X(y,b)};$e(p,y=>{e.child?y(m):y(g,!1)})}X(f,h)};$e(u,f=>{(a.shouldRender||i())&&f(d)})}X(t,c),Et()}var oK=_e("<div><!></div>");function aK(t,e){const n=Xo();St(e,!0);let r=le(e,"id",19,()=>nl(n)),i=le(e,"ref",15,null),s=_i(e,["$$slots","$$events","$$legacy","id","children","child","ref"]);const o=rE.create({id:Be(()=>r()),ref:Be(()=>i(),f=>i(f))}),a=ae(()=>mr(s,o.props));var l=Fe(),c=Te(l);{var u=f=>{var h=Fe(),p=Te(h);Tt(p,()=>e.child,()=>({props:k(a)})),X(f,h)},d=f=>{var h=oK();wr(h,()=>({...k(a)}));var p=re(h);Tt(p,()=>e.children??Ut),X(f,h)};$e(c,f=>{e.child?f(u):f(d,!1)})}X(t,l),Et()}const lK=["top","right","bottom","left"],wc=Math.min,ts=Math.max,m0=Math.round,jm=Math.floor,Uo=t=>({x:t,y:t}),cK={left:"right",right:"left",bottom:"top",top:"bottom"},uK={start:"end",end:"start"};function Rx(t,e,n){return ts(t,wc(e,n))}function Ka(t,e){return typeof t=="function"?t(e):t}function Ga(t){return t.split("-")[0]}function Nf(t){return t.split("-")[1]}function fE(t){return t==="x"?"y":"x"}function hE(t){return t==="y"?"height":"width"}const dK=new Set(["top","bottom"]);function No(t){return dK.has(Ga(t))?"y":"x"}function pE(t){return fE(No(t))}function fK(t,e,n){n===void 0&&(n=!1);const r=Nf(t),i=pE(t),s=hE(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=g0(o)),[o,g0(o)]}function hK(t){const e=g0(t);return[Dx(t),e,Dx(e)]}function Dx(t){return t.replace(/start|end/g,e=>uK[e])}const lA=["left","right"],cA=["right","left"],pK=["top","bottom"],mK=["bottom","top"];function gK(t,e,n){switch(t){case"top":case"bottom":return n?e?cA:lA:e?lA:cA;case"left":case"right":return e?pK:mK;default:return[]}}function yK(t,e,n,r){const i=Nf(t);let s=gK(Ga(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(Dx)))),s}function g0(t){return t.replace(/left|right|bottom|top/g,e=>cK[e])}function bK(t){return{top:0,right:0,bottom:0,left:0,...t}}function n8(t){return typeof t!="number"?bK(t):{top:t,right:t,bottom:t,left:t}}function y0(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}function uA(t,e,n){let{reference:r,floating:i}=t;const s=No(e),o=pE(e),a=hE(o),l=Ga(e),c=s==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,f=r[a]/2-i[a]/2;let h;switch(l){case"top":h={x:u,y:r.y-i.height};break;case"bottom":h={x:u,y:r.y+r.height};break;case"right":h={x:r.x+r.width,y:d};break;case"left":h={x:r.x-i.width,y:d};break;default:h={x:r.x,y:r.y}}switch(Nf(e)){case"start":h[o]-=f*(n&&c?-1:1);break;case"end":h[o]+=f*(n&&c?-1:1);break}return h}const wK=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:d}=uA(c,r,l),f=r,h={},p=0;for(let m=0;m<a.length;m++){const{name:g,fn:y}=a[m],{x:b,y:E,data:C,reset:I}=await y({x:u,y:d,initialPlacement:r,placement:f,strategy:i,middlewareData:h,rects:c,platform:o,elements:{reference:t,floating:e}});u=b??u,d=E??d,h={...h,[g]:{...h[g],...C}},I&&p<=50&&(p++,typeof I=="object"&&(I.placement&&(f=I.placement),I.rects&&(c=I.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):I.rects),{x:u,y:d}=uA(c,f,l)),m=-1)}return{x:u,y:d,placement:f,strategy:i,middlewareData:h}};async function bp(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=Ka(e,t),p=n8(h),g=a[f?d==="floating"?"reference":"floating":d],y=y0(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(g)))==null||n?g:g.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),b=d==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,E=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),C=await(s.isElement==null?void 0:s.isElement(E))?await(s.getScale==null?void 0:s.getScale(E))||{x:1,y:1}:{x:1,y:1},I=y0(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:E,strategy:l}):b);return{top:(y.top-I.top+p.top)/C.y,bottom:(I.bottom-y.bottom+p.bottom)/C.y,left:(y.left-I.left+p.left)/C.x,right:(I.right-y.right+p.right)/C.x}}const vK=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=Ka(t,e)||{};if(c==null)return{};const d=n8(u),f={x:n,y:r},h=pE(i),p=hE(h),m=await o.getDimensions(c),g=h==="y",y=g?"top":"left",b=g?"bottom":"right",E=g?"clientHeight":"clientWidth",C=s.reference[p]+s.reference[h]-f[h]-s.floating[p],I=f[h]-s.reference[h],x=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let P=x?x[E]:0;(!P||!await(o.isElement==null?void 0:o.isElement(x)))&&(P=a.floating[E]||s.floating[p]);const T=C/2-I/2,S=P/2-m[p]/2-1,_=wc(d[y],S),O=wc(d[b],S),F=_,L=P-m[p]-O,B=P/2-m[p]/2+T,N=Rx(F,B,L),M=!l.arrow&&Nf(i)!=null&&B!==N&&s.reference[p]/2-(B<F?_:O)-m[p]/2<0,R=M?B<F?B-F:B-L:0;return{[h]:f[h]+R,data:{[h]:N,centerOffset:B-N-R,...M&&{alignmentOffset:R}},reset:M}}}),xK=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...g}=Ka(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const y=Ga(i),b=No(a),E=Ga(a)===a,C=await(l.isRTL==null?void 0:l.isRTL(c.floating)),I=f||(E||!m?[g0(a)]:hK(a)),x=p!=="none";!f&&x&&I.push(...yK(a,m,p,C));const P=[a,...I],T=await bp(e,g),S=[];let _=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&S.push(T[y]),d){const B=fK(i,o,C);S.push(T[B[0]],T[B[1]])}if(_=[..._,{placement:i,overflows:S}],!S.every(B=>B<=0)){var O,F;const B=(((O=s.flip)==null?void 0:O.index)||0)+1,N=P[B];if(N&&(!(d==="alignment"?b!==No(N):!1)||_.every(H=>No(H.placement)===b?H.overflows[0]>0:!0)))return{data:{index:B,overflows:_},reset:{placement:N}};let M=(F=_.filter(R=>R.overflows[0]<=0).sort((R,H)=>R.overflows[1]-H.overflows[1])[0])==null?void 0:F.placement;if(!M)switch(h){case"bestFit":{var L;const R=(L=_.filter(H=>{if(x){const z=No(H.placement);return z===b||z==="y"}return!0}).map(H=>[H.placement,H.overflows.filter(z=>z>0).reduce((z,V)=>z+V,0)]).sort((H,z)=>H[1]-z[1])[0])==null?void 0:L[0];R&&(M=R);break}case"initialPlacement":M=a;break}if(i!==M)return{reset:{placement:M}}}return{}}}};function dA(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function fA(t){return lK.some(e=>t[e]>=0)}const SK=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=Ka(t,e);switch(r){case"referenceHidden":{const s=await bp(e,{...i,elementContext:"reference"}),o=dA(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:fA(o)}}}case"escaped":{const s=await bp(e,{...i,altBoundary:!0}),o=dA(s,n.floating);return{data:{escapedOffsets:o,escaped:fA(o)}}}default:return{}}}}},r8=new Set(["left","top"]);async function EK(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=Ga(n),a=Nf(n),l=No(n)==="y",c=r8.has(o)?-1:1,u=s&&l?-1:1,d=Ka(e,t);let{mainAxis:f,crossAxis:h,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof p=="number"&&(h=a==="end"?p*-1:p),l?{x:h*u,y:f*c}:{x:f*c,y:h*u}}const kK=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,l=await EK(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},TK=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:y,y:b}=g;return{x:y,y:b}}},...l}=Ka(t,e),c={x:n,y:r},u=await bp(e,l),d=No(Ga(i)),f=fE(d);let h=c[f],p=c[d];if(s){const g=f==="y"?"top":"left",y=f==="y"?"bottom":"right",b=h+u[g],E=h-u[y];h=Rx(b,h,E)}if(o){const g=d==="y"?"top":"left",y=d==="y"?"bottom":"right",b=p+u[g],E=p-u[y];p=Rx(b,p,E)}const m=a.fn({...e,[f]:h,[d]:p});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[f]:s,[d]:o}}}}}},_K=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=Ka(t,e),u={x:n,y:r},d=No(i),f=fE(d);let h=u[f],p=u[d];const m=Ka(a,e),g=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const E=f==="y"?"height":"width",C=s.reference[f]-s.floating[E]+g.mainAxis,I=s.reference[f]+s.reference[E]-g.mainAxis;h<C?h=C:h>I&&(h=I)}if(c){var y,b;const E=f==="y"?"width":"height",C=r8.has(Ga(i)),I=s.reference[d]-s.floating[E]+(C&&((y=o.offset)==null?void 0:y[d])||0)+(C?0:g.crossAxis),x=s.reference[d]+s.reference[E]+(C?0:((b=o.offset)==null?void 0:b[d])||0)-(C?g.crossAxis:0);p<I?p=I:p>x&&(p=x)}return{[f]:h,[d]:p}}}},CK=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:l=()=>{},...c}=Ka(t,e),u=await bp(e,c),d=Ga(i),f=Nf(i),h=No(i)==="y",{width:p,height:m}=s.floating;let g,y;d==="top"||d==="bottom"?(g=d,y=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(y=d,g=f==="end"?"top":"bottom");const b=m-u.top-u.bottom,E=p-u.left-u.right,C=wc(m-u[g],b),I=wc(p-u[y],E),x=!e.middlewareData.shift;let P=C,T=I;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(T=E),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(P=b),x&&!f){const _=ts(u.left,0),O=ts(u.right,0),F=ts(u.top,0),L=ts(u.bottom,0);h?T=p-2*(_!==0||O!==0?_+O:ts(u.left,u.right)):P=m-2*(F!==0||L!==0?F+L:ts(u.top,u.bottom))}await l({...e,availableWidth:T,availableHeight:P});const S=await o.getDimensions(a.floating);return p!==S.width||m!==S.height?{reset:{rects:!0}}:{}}}};function db(){return typeof window<"u"}function Rf(t){return i8(t)?(t.nodeName||"").toLowerCase():"#document"}function rs(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Jo(t){var e;return(e=(i8(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function i8(t){return db()?t instanceof Node||t instanceof rs(t).Node:!1}function to(t){return db()?t instanceof Element||t instanceof rs(t).Element:!1}function Wo(t){return db()?t instanceof HTMLElement||t instanceof rs(t).HTMLElement:!1}function hA(t){return!db()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof rs(t).ShadowRoot}const AK=new Set(["inline","contents"]);function om(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=no(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!AK.has(i)}const IK=new Set(["table","td","th"]);function PK(t){return IK.has(Rf(t))}const OK=[":popover-open",":modal"];function fb(t){return OK.some(e=>{try{return t.matches(e)}catch{return!1}})}const MK=["transform","translate","scale","rotate","perspective"],NK=["transform","translate","scale","rotate","perspective","filter"],RK=["paint","layout","strict","content"];function mE(t){const e=gE(),n=to(t)?no(t):t;return MK.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||NK.some(r=>(n.willChange||"").includes(r))||RK.some(r=>(n.contain||"").includes(r))}function DK(t){let e=vc(t);for(;Wo(e)&&!cf(e);){if(mE(e))return e;if(fb(e))return null;e=vc(e)}return null}function gE(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const LK=new Set(["html","body","#document"]);function cf(t){return LK.has(Rf(t))}function no(t){return rs(t).getComputedStyle(t)}function hb(t){return to(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function vc(t){if(Rf(t)==="html")return t;const e=t.assignedSlot||t.parentNode||hA(t)&&t.host||Jo(t);return hA(e)?e.host:e}function s8(t){const e=vc(t);return cf(e)?t.ownerDocument?t.ownerDocument.body:t.body:Wo(e)&&om(e)?e:s8(e)}function wp(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=s8(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=rs(i);if(s){const a=Lx(o);return e.concat(o,o.visualViewport||[],om(i)?i:[],a&&n?wp(a):[])}return e.concat(i,wp(i,[],n))}function Lx(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function o8(t){const e=no(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Wo(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=m0(n)!==s||m0(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function yE(t){return to(t)?t:t.contextElement}function Ld(t){const e=yE(t);if(!Wo(e))return Uo(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=o8(e);let o=(s?m0(n.width):n.width)/r,a=(s?m0(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const BK=Uo(0);function a8(t){const e=rs(t);return!gE()||!e.visualViewport?BK:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function FK(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==rs(t)?!1:e}function Ou(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=yE(t);let o=Uo(1);e&&(r?to(r)&&(o=Ld(r)):o=Ld(t));const a=FK(s,n,r)?a8(s):Uo(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(s){const f=rs(s),h=r&&to(r)?rs(r):r;let p=f,m=Lx(p);for(;m&&r&&h!==p;){const g=Ld(m),y=m.getBoundingClientRect(),b=no(m),E=y.left+(m.clientLeft+parseFloat(b.paddingLeft))*g.x,C=y.top+(m.clientTop+parseFloat(b.paddingTop))*g.y;l*=g.x,c*=g.y,u*=g.x,d*=g.y,l+=E,c+=C,p=rs(m),m=Lx(p)}}return y0({width:u,height:d,x:l,y:c})}function pb(t,e){const n=hb(t).scrollLeft;return e?e.left+n:Ou(Jo(t)).left+n}function l8(t,e){const n=t.getBoundingClientRect(),r=n.left+e.scrollLeft-pb(t,n),i=n.top+e.scrollTop;return{x:r,y:i}}function $K(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=Jo(r),a=e?fb(e.floating):!1;if(r===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=Uo(1);const u=Uo(0),d=Wo(r);if((d||!d&&!s)&&((Rf(r)!=="body"||om(o))&&(l=hb(r)),Wo(r))){const h=Ou(r);c=Ld(r),u.x=h.x+r.clientLeft,u.y=h.y+r.clientTop}const f=o&&!d&&!s?l8(o,l):Uo(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:n.y*c.y-l.scrollTop*c.y+u.y+f.y}}function zK(t){return Array.from(t.getClientRects())}function UK(t){const e=Jo(t),n=hb(t),r=t.ownerDocument.body,i=ts(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=ts(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+pb(t);const a=-n.scrollTop;return no(r).direction==="rtl"&&(o+=ts(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}const pA=25;function HK(t,e){const n=rs(t),r=Jo(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const u=gE();(!u||u&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}const c=pb(r);if(c<=0){const u=r.ownerDocument,d=u.body,f=getComputedStyle(d),h=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,p=Math.abs(r.clientWidth-d.clientWidth-h);p<=pA&&(s-=p)}else c<=pA&&(s+=c);return{width:s,height:o,x:a,y:l}}const VK=new Set(["absolute","fixed"]);function WK(t,e){const n=Ou(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=Wo(t)?Ld(t):Uo(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=i*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function mA(t,e,n){let r;if(e==="viewport")r=HK(t,n);else if(e==="document")r=UK(Jo(t));else if(to(e))r=WK(e,n);else{const i=a8(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return y0(r)}function c8(t,e){const n=vc(t);return n===e||!to(n)||cf(n)?!1:no(n).position==="fixed"||c8(n,e)}function jK(t,e){const n=e.get(t);if(n)return n;let r=wp(t,[],!1).filter(a=>to(a)&&Rf(a)!=="body"),i=null;const s=no(t).position==="fixed";let o=s?vc(t):t;for(;to(o)&&!cf(o);){const a=no(o),l=mE(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&VK.has(i.position)||om(o)&&!l&&c8(t,o))?r=r.filter(u=>u!==o):i=a,o=vc(o)}return e.set(t,r),r}function qK(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?fb(e)?[]:jK(e,this._c):[].concat(n),r],a=o[0],l=o.reduce((c,u)=>{const d=mA(e,u,i);return c.top=ts(d.top,c.top),c.right=wc(d.right,c.right),c.bottom=wc(d.bottom,c.bottom),c.left=ts(d.left,c.left),c},mA(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function KK(t){const{width:e,height:n}=o8(t);return{width:e,height:n}}function GK(t,e,n){const r=Wo(e),i=Jo(e),s=n==="fixed",o=Ou(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Uo(0);function c(){l.x=pb(i)}if(r||!r&&!s)if((Rf(e)!=="body"||om(i))&&(a=hb(e)),r){const h=Ou(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else i&&c();s&&!r&&i&&c();const u=i&&!r&&!s?l8(i,a):Uo(0),d=o.left+a.scrollLeft-l.x-u.x,f=o.top+a.scrollTop-l.y-u.y;return{x:d,y:f,width:o.width,height:o.height}}function mv(t){return no(t).position==="static"}function gA(t,e){if(!Wo(t)||no(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Jo(t)===n&&(n=n.ownerDocument.body),n}function u8(t,e){const n=rs(t);if(fb(t))return n;if(!Wo(t)){let i=vc(t);for(;i&&!cf(i);){if(to(i)&&!mv(i))return i;i=vc(i)}return n}let r=gA(t,e);for(;r&&PK(r)&&mv(r);)r=gA(r,e);return r&&cf(r)&&mv(r)&&!mE(r)?n:r||DK(t)||n}const ZK=async function(t){const e=this.getOffsetParent||u8,n=this.getDimensions,r=await n(t.floating);return{reference:GK(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function QK(t){return no(t).direction==="rtl"}const XK={convertOffsetParentRelativeRectToViewportRelativeRect:$K,getDocumentElement:Jo,getClippingRect:qK,getOffsetParent:u8,getElementRects:ZK,getClientRects:zK,getDimensions:KK,getScale:Ld,isElement:to,isRTL:QK};function d8(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function YK(t,e){let n=null,r;const i=Jo(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:h}=c;if(a||e(),!f||!h)return;const p=jm(d),m=jm(i.clientWidth-(u+f)),g=jm(i.clientHeight-(d+h)),y=jm(u),E={rootMargin:-p+"px "+-m+"px "+-g+"px "+-y+"px",threshold:ts(0,wc(1,l))||1};let C=!0;function I(x){const P=x[0].intersectionRatio;if(P!==l){if(!C)return o();P?o(!1,P):r=setTimeout(()=>{o(!1,1e-7)},1e3)}P===1&&!d8(c,t.getBoundingClientRect())&&o(),C=!1}try{n=new IntersectionObserver(I,{...E,root:i.ownerDocument})}catch{n=new IntersectionObserver(I,E)}n.observe(t)}return o(!0),s}function JK(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=yE(t),u=i||s?[...c?wp(c):[],...wp(e)]:[];u.forEach(y=>{i&&y.addEventListener("scroll",n,{passive:!0}),s&&y.addEventListener("resize",n)});const d=c&&a?YK(c,n):null;let f=-1,h=null;o&&(h=new ResizeObserver(y=>{let[b]=y;b&&b.target===c&&h&&(h.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var E;(E=h)==null||E.observe(e)})),n()}),c&&!l&&h.observe(c),h.observe(e));let p,m=l?Ou(t):null;l&&g();function g(){const y=Ou(t);m&&!d8(m,y)&&n(),m=y,p=requestAnimationFrame(g)}return n(),()=>{var y;u.forEach(b=>{i&&b.removeEventListener("scroll",n),s&&b.removeEventListener("resize",n)}),d?.(),(y=h)==null||y.disconnect(),h=null,l&&cancelAnimationFrame(p)}}const eG=kK,tG=TK,nG=xK,rG=CK,iG=SK,sG=vK,oG=_K,aG=(t,e,n)=>{const r=new Map,i={platform:XK,...n},s={...i.platform,_c:r};return wK(t,e,{...i,platform:s})};function Vc(t){return typeof t=="function"?t():t}function f8(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function yA(t,e){const n=f8(t);return Math.round(e*n)/n}function b0(t){return{[`--bits-${t}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${t}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${t}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${t}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${t}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function lG(t){const e=t.whileElementsMounted,n=ae(()=>Vc(t.open)??!0),r=ae(()=>Vc(t.middleware)),i=ae(()=>Vc(t.transform)??!0),s=ae(()=>Vc(t.placement)??"bottom"),o=ae(()=>Vc(t.strategy)??"absolute"),a=ae(()=>Vc(t.sideOffset)??0),l=ae(()=>Vc(t.alignOffset)??0),c=t.reference;let u=ge(0),d=ge(0);const f=_s(null);let h=ge(Nt(k(o))),p=ge(Nt(k(s))),m=ge(Nt({})),g=ge(!1);const y=ae(()=>{const P=f.current?yA(f.current,k(u)):k(u),T=f.current?yA(f.current,k(d)):k(d);return k(i)?{position:k(h),left:"0",top:"0",transform:`translate(${P}px, ${T}px)`,...f.current&&f8(f.current)>=1.5&&{willChange:"transform"}}:{position:k(h),left:`${P}px`,top:`${T}px`}});let b;function E(){c.current===null||f.current===null||aG(c.current,f.current,{middleware:k(r),placement:k(s),strategy:k(o)}).then(P=>{if(!k(n)&&k(u)!==0&&k(d)!==0){const T=Math.max(Math.abs(k(a)),Math.abs(k(l)),15);if(P.x<=T&&P.y<=T)return}K(u,P.x,!0),K(d,P.y,!0),K(h,P.strategy,!0),K(p,P.placement,!0),K(m,P.middlewareData,!0),K(g,!0)})}function C(){typeof b=="function"&&(b(),b=void 0)}function I(){if(C(),e===void 0){E();return}c.current===null||f.current===null||(b=e(c.current,f.current,E))}function x(){k(n)||K(g,!1)}return Ge(E),Ge(I),Ge(x),Ge(()=>C),{floating:f,reference:c,get strategy(){return k(h)},get placement(){return k(p)},get middlewareData(){return k(m)},get isPositioned(){return k(g)},get floatingStyles(){return k(y)},get update(){return E}}}const cG={top:"bottom",right:"left",bottom:"top",left:"right"},bE=new Mc("Floating.Root"),bA=new Mc("Floating.Content"),wE=new Mc("Floating.Root");class w0{static create(e=!1){return e?wE.set(new w0):bE.set(new w0)}anchorNode=_s(null);customAnchorNode=_s(null);triggerNode=_s(null);constructor(){Ge(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}class v0{static create(e,n=!1){return n?bA.set(new v0(e,wE.get())):bA.set(new v0(e,bE.get()))}opts;root;contentRef=_s(null);wrapperRef=_s(null);arrowRef=_s(null);contentAttachment=Is(this.contentRef);wrapperAttachment=Is(this.wrapperRef);arrowAttachment=Is(this.arrowRef);arrowId=_s(dE());#e=ae(()=>{if(typeof this.opts.style=="string")return Ph(this.opts.style);if(!this.opts.style)return{}});#t=void 0;#n=new qj(()=>this.arrowRef.current??void 0);#r=ae(()=>this.#n?.width??0);#i=ae(()=>this.#n?.height??0);#o=ae(()=>this.opts.side?.current+(this.opts.align.current!=="center"?`-${this.opts.align.current}`:""));#a=ae(()=>Array.isArray(this.opts.collisionBoundary.current)?this.opts.collisionBoundary.current:[this.opts.collisionBoundary.current]);#s=ae(()=>k(this.#a).length>0);get hasExplicitBoundaries(){return k(this.#s)}set hasExplicitBoundaries(e){K(this.#s,e)}#l=ae(()=>({padding:this.opts.collisionPadding.current,boundary:k(this.#a).filter(lq),altBoundary:this.hasExplicitBoundaries}));get detectOverflowOptions(){return k(this.#l)}set detectOverflowOptions(e){K(this.#l,e)}#u=ge(void 0);#c=ge(void 0);#d=ge(void 0);#h=ge(void 0);#f=ae(()=>[eG({mainAxis:this.opts.sideOffset.current+k(this.#i),alignmentAxis:this.opts.alignOffset.current}),this.opts.avoidCollisions.current&&tG({mainAxis:!0,crossAxis:!1,limiter:this.opts.sticky.current==="partial"?oG():void 0,...this.detectOverflowOptions}),this.opts.avoidCollisions.current&&nG({...this.detectOverflowOptions}),rG({...this.detectOverflowOptions,apply:({rects:e,availableWidth:n,availableHeight:r})=>{const{width:i,height:s}=e.reference;K(this.#u,n,!0),K(this.#c,r,!0),K(this.#d,i,!0),K(this.#h,s,!0)}}),this.arrowRef.current&&sG({element:this.arrowRef.current,padding:this.opts.arrowPadding.current}),uG({arrowWidth:k(this.#r),arrowHeight:k(this.#i)}),this.opts.hideWhenDetached.current&&iG({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean));get middleware(){return k(this.#f)}set middleware(e){K(this.#f,e)}floating;#p=ae(()=>dG(this.floating.placement));get placedSide(){return k(this.#p)}set placedSide(e){K(this.#p,e)}#g=ae(()=>fG(this.floating.placement));get placedAlign(){return k(this.#g)}set placedAlign(e){K(this.#g,e)}#m=ae(()=>this.floating.middlewareData.arrow?.x??0);get arrowX(){return k(this.#m)}set arrowX(e){K(this.#m,e)}#y=ae(()=>this.floating.middlewareData.arrow?.y??0);get arrowY(){return k(this.#y)}set arrowY(e){K(this.#y,e)}#b=ae(()=>this.floating.middlewareData.arrow?.centerOffset!==0);get cannotCenterArrow(){return k(this.#b)}set cannotCenterArrow(e){K(this.#b,e)}#w=ge();get contentZIndex(){return k(this.#w)}set contentZIndex(e){K(this.#w,e,!0)}#v=ae(()=>cG[this.placedSide]);get arrowBaseSide(){return k(this.#v)}set arrowBaseSide(e){K(this.#v,e)}#x=ae(()=>({id:this.opts.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${this.floating.middlewareData.transformOrigin?.x} ${this.floating.middlewareData.transformOrigin?.y}`,"--bits-floating-available-width":`${k(this.#u)}px`,"--bits-floating-available-height":`${k(this.#c)}px`,"--bits-floating-anchor-width":`${k(this.#d)}px`,"--bits-floating-anchor-height":`${k(this.#h)}px`,...this.floating.middlewareData.hide?.referenceHidden&&{visibility:"hidden","pointer-events":"none"},...k(this.#e)},dir:this.opts.dir.current,...this.wrapperAttachment}));get wrapperProps(){return k(this.#x)}set wrapperProps(e){K(this.#x,e)}#S=ae(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:MM({...k(this.#e)}),...this.contentAttachment}));get props(){return k(this.#S)}set props(e){K(this.#S,e)}#E=ae(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0}));get arrowStyle(){return k(this.#E)}set arrowStyle(e){K(this.#E,e)}constructor(e,n){this.opts=e,this.root=n,e.customAnchor&&(this.root.customAnchorNode.current=e.customAnchor.current),Ur(()=>e.customAnchor.current,r=>{this.root.customAnchorNode.current=r}),this.floating=lG({strategy:()=>this.opts.strategy.current,placement:()=>k(this.#o),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...r)=>JK(...r,{animationFrame:this.#t?.current==="always"}),open:()=>this.opts.enabled.current,sideOffset:()=>this.opts.sideOffset.current,alignOffset:()=>this.opts.alignOffset.current}),Ge(()=>{this.floating.isPositioned&&this.opts.onPlaced?.current()}),Ur(()=>this.contentRef.current,r=>{if(!r)return;const i=XS(r);this.contentZIndex=i.getComputedStyle(r).zIndex}),Ge(()=>{this.floating.floating.current=this.wrapperRef.current})}}class x0{static create(e,n=!1){return n?new x0(e,wE.get()):new x0(e,bE.get())}opts;root;constructor(e,n){this.opts=e,this.root=n,e.virtualEl&&e.virtualEl.current?n.triggerNode=mj(e.virtualEl.current):n.triggerNode=e.ref}}function uG(t){return{name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:i}=e,o=i.arrow?.centerOffset!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=vE(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(i.arrow?.x??0)+a/2,h=(i.arrow?.y??0)+l/2;let p="",m="";return c==="bottom"?(p=o?d:`${f}px`,m=`${-l}px`):c==="top"?(p=o?d:`${f}px`,m=`${r.floating.height+l}px`):c==="right"?(p=`${-l}px`,m=o?d:`${h}px`):c==="left"&&(p=`${r.floating.width+l}px`,m=o?d:`${h}px`),{data:{x:p,y:m}}}}}function vE(t){const[e,n="center"]=t.split("-");return[e,n]}function dG(t){return vE(t)[0]}function fG(t){return vE(t)[1]}function h8(t,e){St(e,!0);let n=le(e,"tooltip",3,!1);w0.create(n());var r=Fe(),i=Te(r);Tt(i,()=>e.children??Ut),X(t,r),Et()}function p8(t,e){St(e,!0);let n=le(e,"tooltip",3,!1);x0.create({id:Be(()=>e.id),virtualEl:Be(()=>e.virtualEl),ref:e.ref},n());var r=Fe(),i=Te(r);Tt(i,()=>e.children??Ut),X(t,r),Et()}function hG(t,e){St(e,!0);let n=le(e,"side",3,"bottom"),r=le(e,"sideOffset",3,0),i=le(e,"align",3,"center"),s=le(e,"alignOffset",3,0),o=le(e,"arrowPadding",3,0),a=le(e,"avoidCollisions",3,!0),l=le(e,"collisionBoundary",19,()=>[]),c=le(e,"collisionPadding",3,0),u=le(e,"hideWhenDetached",3,!1),d=le(e,"onPlaced",3,()=>{}),f=le(e,"sticky",3,"partial"),h=le(e,"updatePositionStrategy",3,"optimized"),p=le(e,"strategy",3,"fixed"),m=le(e,"dir",3,"ltr"),g=le(e,"style",19,()=>({})),y=le(e,"wrapperId",19,dE),b=le(e,"customAnchor",3,null),E=le(e,"tooltip",3,!1);const C=v0.create({side:Be(()=>n()),sideOffset:Be(()=>r()),align:Be(()=>i()),alignOffset:Be(()=>s()),id:Be(()=>e.id),arrowPadding:Be(()=>o()),avoidCollisions:Be(()=>a()),collisionBoundary:Be(()=>l()),collisionPadding:Be(()=>c()),hideWhenDetached:Be(()=>u()),onPlaced:Be(()=>d()),sticky:Be(()=>f()),updatePositionStrategy:Be(()=>h()),strategy:Be(()=>p()),dir:Be(()=>m()),style:Be(()=>g()),enabled:Be(()=>e.enabled),wrapperId:Be(()=>y()),customAnchor:Be(()=>b())},E()),I=ae(()=>mr(C.wrapperProps,{style:{pointerEvents:"auto"}}));var x=Fe(),P=Te(x);Tt(P,()=>e.content??Ut,()=>({props:C.props,wrapperProps:k(I)})),X(t,x),Et()}function pG(t,e){St(e,!0),us(()=>{e.onPlaced?.()});var n=Fe(),r=Te(n);Tt(r,()=>e.content??Ut,()=>({props:{},wrapperProps:{}})),X(t,n),Et()}function mG(t,e){let n=le(e,"isStatic",3,!1),r=_i(e,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var i=Fe(),s=Te(i);{var o=l=>{pG(l,{get content(){return e.content},get onPlaced(){return e.onPlaced}})},a=l=>{hG(l,Kn({get content(){return e.content},get onPlaced(){return e.onPlaced}},()=>r))};$e(s,l=>{n()?l(o):l(a,!1)})}X(t,i)}var gG=_e("<!> <!>",1);function m8(t,e){St(e,!0);let n=le(e,"interactOutsideBehavior",3,"close"),r=le(e,"trapFocus",3,!0),i=le(e,"isValidEvent",3,()=>!1),s=le(e,"customAnchor",3,null),o=le(e,"isStatic",3,!1),a=le(e,"tooltip",3,!1),l=_i(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled","ref","tooltip"]);mG(t,{get isStatic(){return o()},get id(){return e.id},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get enabled(){return e.enabled},get tooltip(){return a()},content:(u,d)=>{let f=()=>d?.().props,h=()=>d?.().wrapperProps;var p=gG(),m=Te(p);{var g=E=>{p0(E,{get preventScroll(){return e.preventScroll}})},y=E=>{var C=Fe(),I=Te(C);{var x=P=>{p0(P,{get preventScroll(){return e.preventScroll}})};$e(I,P=>{e.forceMount||P(x)},!0)}X(E,C)};$e(m,E=>{e.forceMount&&e.enabled?E(g):E(y,!1)})}var b=ve(m,2);JM(b,{get onOpenAutoFocus(){return e.onOpenAutoFocus},get onCloseAutoFocus(){return e.onCloseAutoFocus},get loop(){return e.loop},get enabled(){return e.enabled},get trapFocus(){return r()},get forceMount(){return e.forceMount},get ref(){return e.ref},focusScope:(C,I)=>{let x=()=>I?.().props;YM(C,{get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get enabled(){return e.enabled},get ref(){return e.ref},children:(P,T)=>{XM(P,{get id(){return e.id},get onInteractOutside(){return e.onInteractOutside},get onFocusOutside(){return e.onFocusOutside},get interactOutsideBehavior(){return n()},get isValidEvent(){return i()},get enabled(){return e.enabled},get ref(){return e.ref},children:(_,O)=>{let F=()=>O?.().props;e8(_,{get id(){return e.id},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get enabled(){return e.enabled},get ref(){return e.ref},children:(L,B)=>{var N=Fe(),M=Te(N);{let R=ae(()=>({props:mr(l,f(),F(),x(),{style:{pointerEvents:"auto"}}),wrapperProps:h()}));Tt(M,()=>e.popper??Ut,()=>k(R))}X(L,N)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),X(u,p)},$$slots:{content:!0}}),Et()}function g8(t,e){let n=le(e,"interactOutsideBehavior",3,"close"),r=le(e,"trapFocus",3,!0),i=le(e,"isValidEvent",3,()=>!1),s=le(e,"customAnchor",3,null),o=le(e,"isStatic",3,!1),a=_i(e,["$$slots","$$events","$$legacy","popper","open","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","ref","shouldRender"]);var l=Fe(),c=Te(l);{var u=d=>{m8(d,Kn({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get isStatic(){return o()},get enabled(){return e.open},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return n()},get loop(){return e.loop},get trapFocus(){return r()},get isValidEvent(){return i()},get onFocusOutside(){return e.onFocusOutside},forceMount:!1,get ref(){return e.ref}},()=>a))};$e(c,d=>{e.shouldRender&&d(u)})}X(t,l)}function y8(t,e){let n=le(e,"interactOutsideBehavior",3,"close"),r=le(e,"trapFocus",3,!0),i=le(e,"isValidEvent",3,()=>!1),s=le(e,"customAnchor",3,null),o=le(e,"isStatic",3,!1),a=_i(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);m8(t,Kn({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get isStatic(){return o()},get enabled(){return e.enabled},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return n()},get loop(){return e.loop},get trapFocus(){return r()},get isValidEvent(){return i()},get onFocusOutside(){return e.onFocusOutside}},()=>a,{forceMount:!0}))}const Bx=ub({component:"popover",parts:["root","trigger","content","close","overlay"]}),xE=new Mc("Popover.Root");class SE{static create(e){return xE.set(new SE(e))}opts;#e=ge(null);get contentNode(){return k(this.#e)}set contentNode(e){K(this.#e,e,!0)}contentPresence;#t=ge(null);get triggerNode(){return k(this.#t)}set triggerNode(e){K(this.#t,e,!0)}#n=ge(null);get overlayNode(){return k(this.#n)}set overlayNode(e){K(this.#n,e,!0)}overlayPresence;constructor(e){this.opts=e,this.contentPresence=new yp({ref:Be(()=>this.contentNode),open:this.opts.open,onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),this.overlayPresence=new yp({ref:Be(()=>this.overlayNode),open:this.opts.open})}toggleOpen(){this.opts.open.current=!this.opts.open.current}handleClose(){this.opts.open.current&&(this.opts.open.current=!1)}}class EE{static create(e){return new EE(e,xE.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Is(this.opts.ref,r=>this.root.triggerNode=r),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onclick(e){this.opts.disabled.current||e.button===0&&this.root.toggleOpen()}onkeydown(e){this.opts.disabled.current||(e.key===$M||e.key===zM)&&(e.preventDefault(),this.root.toggleOpen())}#e(){if(this.root.opts.open.current&&this.root.contentNode?.id)return this.root.contentNode?.id}#t=ae(()=>({id:this.opts.id.current,"aria-haspopup":"dialog","aria-expanded":nq(this.root.opts.open.current),"data-state":JS(this.root.opts.open.current),"aria-controls":this.#e(),[Bx.trigger]:"",disabled:this.opts.disabled.current,onkeydown:this.onkeydown,onclick:this.onclick,...this.attachment}));get props(){return k(this.#t)}set props(e){K(this.#t,e)}}class kE{static create(e){return new kE(e,xE.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Is(this.opts.ref,r=>this.root.contentNode=r)}onInteractOutside=e=>{if(this.opts.onInteractOutside.current(e),e.defaultPrevented||!c0(e.target))return;const n=e.target.closest(Bx.selector("trigger"));if(!(n&&n===this.root.triggerNode)){if(this.opts.customAnchor.current){if(c0(this.opts.customAnchor.current)){if(this.opts.customAnchor.current.contains(e.target))return}else if(typeof this.opts.customAnchor.current=="string"){const r=document.querySelector(this.opts.customAnchor.current);if(r&&r.contains(e.target))return}}this.root.handleClose()}};onEscapeKeydown=e=>{this.opts.onEscapeKeydown.current(e),!e.defaultPrevented&&this.root.handleClose()};get shouldRender(){return this.root.contentPresence.shouldRender}#e=ae(()=>({open:this.root.opts.open.current}));get snippetProps(){return k(this.#e)}set snippetProps(e){K(this.#e,e)}#t=ae(()=>({id:this.opts.id.current,tabindex:-1,"data-state":JS(this.root.opts.open.current),[Bx.content]:"",style:{pointerEvents:"auto"},...this.attachment}));get props(){return k(this.#t)}set props(e){K(this.#t,e)}popperProps={onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown}}var yG=_e("<div><div><!></div></div>"),bG=_e("<div><div><!></div></div>");function wG(t,e){const n=Xo();St(e,!0);let r=le(e,"ref",15,null),i=le(e,"id",19,()=>nl(n)),s=le(e,"forceMount",3,!1),o=le(e,"onCloseAutoFocus",3,bn),a=le(e,"onEscapeKeydown",3,bn),l=le(e,"onInteractOutside",3,bn),c=le(e,"trapFocus",3,!0),u=le(e,"preventScroll",3,!1),d=le(e,"customAnchor",3,null),f=_i(e,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","customAnchor"]);const h=kE.create({id:Be(()=>i()),ref:Be(()=>r(),E=>r(E)),onInteractOutside:Be(()=>l()),onEscapeKeydown:Be(()=>a()),customAnchor:Be(()=>d())}),p=ae(()=>mr(f,h.props));var m=Fe(),g=Te(m);{var y=E=>{y8(E,Kn(()=>k(p),()=>h.popperProps,{get ref(){return h.opts.ref},get enabled(){return h.root.opts.open.current},get id(){return i()},get trapFocus(){return c()},get preventScroll(){return u()},loop:!0,forceMount:!0,get customAnchor(){return d()},get onCloseAutoFocus(){return o()},get shouldRender(){return h.shouldRender},popper:(I,x)=>{let P=()=>x?.().props,T=()=>x?.().wrapperProps;const S=ae(()=>mr(P(),{style:b0("popover")}));var _=Fe(),O=Te(_);{var F=B=>{var N=Fe(),M=Te(N);{let R=ae(()=>({props:k(S),wrapperProps:T(),...h.snippetProps}));Tt(M,()=>e.child,()=>k(R))}X(B,N)},L=B=>{var N=yG();wr(N,()=>({...T()}));var M=re(N);wr(M,()=>({...k(S)}));var R=re(M);Tt(R,()=>e.children??Ut),X(B,N)};$e(O,B=>{e.child?B(F):B(L,!1)})}X(I,_)},$$slots:{popper:!0}}))},b=E=>{var C=Fe(),I=Te(C);{var x=P=>{g8(P,Kn(()=>k(p),()=>h.popperProps,{get ref(){return h.opts.ref},get open(){return h.root.opts.open.current},get id(){return i()},get trapFocus(){return c()},get preventScroll(){return u()},loop:!0,forceMount:!1,get customAnchor(){return d()},get onCloseAutoFocus(){return o()},get shouldRender(){return h.shouldRender},popper:(S,_)=>{let O=()=>_?.().props,F=()=>_?.().wrapperProps;const L=ae(()=>mr(O(),{style:b0("popover")}));var B=Fe(),N=Te(B);{var M=H=>{var z=Fe(),V=Te(z);{let Q=ae(()=>({props:k(L),wrapperProps:F(),...h.snippetProps}));Tt(V,()=>e.child,()=>k(Q))}X(H,z)},R=H=>{var z=bG();wr(z,()=>({...F()}));var V=re(z);wr(V,()=>({...k(L)}));var Q=re(V);Tt(Q,()=>e.children??Ut),X(H,z)};$e(N,H=>{e.child?H(M):H(R,!1)})}X(S,B)},$$slots:{popper:!0}}))};$e(I,P=>{s()||P(x)},!0)}X(E,C)};$e(g,E=>{s()?E(y):E(b,!1)})}X(t,m),Et()}var vG=_e("<button><!></button>");function xG(t,e){const n=Xo();St(e,!0);let r=le(e,"id",19,()=>nl(n)),i=le(e,"ref",15,null),s=le(e,"type",3,"button"),o=le(e,"disabled",3,!1),a=_i(e,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled"]);const l=EE.create({id:Be(()=>r()),ref:Be(()=>i(),u=>i(u)),disabled:Be(()=>!!o())}),c=ae(()=>mr(a,l.props,{type:s()}));p8(t,{get id(){return r()},get ref(){return l.opts.ref},children:(u,d)=>{var f=Fe(),h=Te(f);{var p=g=>{var y=Fe(),b=Te(y);Tt(b,()=>e.child,()=>({props:k(c)})),X(g,y)},m=g=>{var y=vG();wr(y,()=>({...k(c)}));var b=re(y);Tt(b,()=>e.children??Ut),X(g,y)};$e(h,g=>{e.child?g(p):g(m,!1)})}X(u,f)},$$slots:{default:!0}}),Et()}function SG(t,e){St(e,!0);let n=le(e,"open",15,!1),r=le(e,"onOpenChange",3,bn),i=le(e,"onOpenChangeComplete",3,bn);eE.create({variant:Be(()=>"dialog"),open:Be(()=>n(),a=>{n(a),r()(a)}),onOpenChangeComplete:Be(()=>i())});var s=Fe(),o=Te(s);Tt(o,()=>e.children??Ut),X(t,s),Et()}var EG=_e("<button><!></button>");function Df(t,e){const n=Xo();St(e,!0);let r=le(e,"id",19,()=>nl(n)),i=le(e,"ref",15,null),s=le(e,"disabled",3,!1),o=_i(e,["$$slots","$$events","$$legacy","children","child","id","ref","disabled"]);const a=tE.create({variant:Be(()=>"close"),id:Be(()=>r()),ref:Be(()=>i(),h=>i(h)),disabled:Be(()=>!!s())}),l=ae(()=>mr(o,a.props));var c=Fe(),u=Te(c);{var d=h=>{var p=Fe(),m=Te(p);Tt(m,()=>e.child,()=>({props:k(l)})),X(h,p)},f=h=>{var p=EG();wr(p,()=>({...k(l)}));var m=re(p);Tt(m,()=>e.children??Ut),X(h,p)};$e(u,h=>{e.child?h(d):h(f,!1)})}X(t,c),Et()}var kG=_e("<!> <!>",1),TG=_e("<!> <div><!></div>",1);function _G(t,e){const n=Xo();St(e,!0);let r=le(e,"id",19,()=>nl(n)),i=le(e,"ref",15,null),s=le(e,"forceMount",3,!1),o=le(e,"onCloseAutoFocus",3,bn),a=le(e,"onOpenAutoFocus",3,bn),l=le(e,"onEscapeKeydown",3,bn),c=le(e,"onInteractOutside",3,bn),u=le(e,"trapFocus",3,!0),d=le(e,"preventScroll",3,!0),f=le(e,"restoreScrollDelay",3,null),h=_i(e,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onOpenAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const p=iE.create({id:Be(()=>r()),ref:Be(()=>i(),E=>i(E))}),m=ae(()=>mr(h,p.props));var g=Fe(),y=Te(g);{var b=E=>{JM(E,{get ref(){return p.opts.ref},loop:!0,get trapFocus(){return u()},get enabled(){return p.root.opts.open.current},get onOpenAutoFocus(){return a()},get onCloseAutoFocus(){return o()},focusScope:(I,x)=>{let P=()=>x?.().props;YM(I,Kn(()=>k(m),{get enabled(){return p.root.opts.open.current},get ref(){return p.opts.ref},onEscapeKeydown:T=>{l()(T),!T.defaultPrevented&&p.root.handleClose()},children:(T,S)=>{XM(T,Kn(()=>k(m),{get ref(){return p.opts.ref},get enabled(){return p.root.opts.open.current},onInteractOutside:_=>{c()(_),!_.defaultPrevented&&p.root.handleClose()},children:(_,O)=>{e8(_,Kn(()=>k(m),{get ref(){return p.opts.ref},get enabled(){return p.root.opts.open.current},children:(F,L)=>{var B=Fe(),N=Te(B);{var M=H=>{var z=kG(),V=Te(z);{var Q=ie=>{p0(ie,{get preventScroll(){return d()},get restoreScrollDelay(){return f()}})};$e(V,ie=>{p.root.opts.open.current&&ie(Q)})}var Y=ve(V,2);{let ie=ae(()=>({props:mr(k(m),P()),...p.snippetProps}));Tt(Y,()=>e.child,()=>k(ie))}X(H,z)},R=H=>{var z=TG(),V=Te(z);p0(V,{get preventScroll(){return d()}});var Q=ve(V,2);wr(Q,ie=>({...ie}),[()=>mr(k(m),P())]);var Y=re(Q);Tt(Y,()=>e.children??Ut),X(H,z)};$e(N,H=>{e.child?H(M):H(R,!1)})}X(F,B)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}})};$e(y,E=>{(p.shouldRender||s())&&E(b)})}X(t,g),Et()}function CG(t,e){St(e,!0);let n=le(e,"open",15,!1),r=le(e,"onOpenChange",3,bn),i=le(e,"onOpenChangeComplete",3,bn);SE.create({open:Be(()=>n(),s=>{n(s),r()(s)}),onOpenChangeComplete:Be(()=>i())}),h8(t,{children:(s,o)=>{var a=Fe(),l=Te(a);Tt(l,()=>e.children??Ut),X(s,a)},$$slots:{default:!0}}),Et()}class Fx{#e;#t;#n=null;constructor(e,n){this.#t=e,this.#e=n,this.stop=this.stop.bind(this),this.start=this.start.bind(this),Vu(this.stop)}#r(){this.#n!==null&&(window.clearTimeout(this.#n),this.#n=null)}stop(){this.#r()}start(...e){this.#r(),this.#n=window.setTimeout(()=>{this.#n=null,this.#t(...e)},this.#e)}}const b8=ub({component:"tooltip",parts:["content","trigger"]}),w8=new Mc("Tooltip.Provider"),TE=new Mc("Tooltip.Root");class _E{static create(e){return w8.set(new _E(e))}opts;#e=ge(!0);get isOpenDelayed(){return k(this.#e)}set isOpenDelayed(e){K(this.#e,e,!0)}isPointerInTransit=_s(!1);#t;#n=ge(null);constructor(e){this.opts=e,this.#t=new Fx(()=>{this.isOpenDelayed=!0},this.opts.skipDelayDuration.current)}#r=()=>{this.opts.skipDelayDuration.current!==0&&this.#t.start()};#i=()=>{this.#t.stop()};onOpen=e=>{k(this.#n)&&k(this.#n)!==e&&k(this.#n).handleClose(),this.#i(),this.isOpenDelayed=!1,K(this.#n,e,!0)};onClose=e=>{k(this.#n)===e&&K(this.#n,null),this.#r()};isTooltipOpen=e=>k(this.#n)===e}class CE{static create(e){return TE.set(new CE(e,w8.get()))}opts;provider;#e=ae(()=>this.opts.delayDuration.current??this.provider.opts.delayDuration.current);get delayDuration(){return k(this.#e)}set delayDuration(e){K(this.#e,e)}#t=ae(()=>this.opts.disableHoverableContent.current??this.provider.opts.disableHoverableContent.current);get disableHoverableContent(){return k(this.#t)}set disableHoverableContent(e){K(this.#t,e)}#n=ae(()=>this.opts.disableCloseOnTriggerClick.current??this.provider.opts.disableCloseOnTriggerClick.current);get disableCloseOnTriggerClick(){return k(this.#n)}set disableCloseOnTriggerClick(e){K(this.#n,e)}#r=ae(()=>this.opts.disabled.current??this.provider.opts.disabled.current);get disabled(){return k(this.#r)}set disabled(e){K(this.#r,e)}#i=ae(()=>this.opts.ignoreNonKeyboardFocus.current??this.provider.opts.ignoreNonKeyboardFocus.current);get ignoreNonKeyboardFocus(){return k(this.#i)}set ignoreNonKeyboardFocus(e){K(this.#i,e)}#o=ge(null);get contentNode(){return k(this.#o)}set contentNode(e){K(this.#o,e,!0)}contentPresence;#a=ge(null);get triggerNode(){return k(this.#a)}set triggerNode(e){K(this.#a,e,!0)}#s=ge(!1);#l;#u=ae(()=>this.opts.open.current?k(this.#s)?"delayed-open":"instant-open":"closed");get stateAttr(){return k(this.#u)}set stateAttr(e){K(this.#u,e)}constructor(e,n){this.opts=e,this.provider=n,this.#l=new Fx(()=>{K(this.#s,!0),this.opts.open.current=!0},this.delayDuration??0),this.contentPresence=new yp({open:this.opts.open,ref:Be(()=>this.contentNode),onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),Ur(()=>this.delayDuration,()=>{this.delayDuration!==void 0&&(this.#l=new Fx(()=>{K(this.#s,!0),this.opts.open.current=!0},this.delayDuration))}),Ur(()=>this.opts.open.current,r=>{r?this.provider.onOpen(this):this.provider.onClose(this)},{lazy:!0})}handleOpen=()=>{this.#l.stop(),K(this.#s,!1),this.opts.open.current=!0};handleClose=()=>{this.#l.stop(),this.opts.open.current=!1};#c=()=>{this.#l.stop();const e=!this.provider.isOpenDelayed,n=this.delayDuration??0;e||n===0?(K(this.#s,n>0&&e,!0),this.opts.open.current=!0):this.#l.start()};onTriggerEnter=()=>{this.#c()};onTriggerLeave=()=>{this.disableHoverableContent?this.handleClose():this.#l.stop()}}class AE{static create(e){return new AE(e,TE.get())}opts;root;attachment;#e=_s(!1);#t=ge(!1);#n=ae(()=>this.opts.disabled.current||this.root.disabled);domContext;#r=null;constructor(e,n){this.opts=e,this.root=n,this.domContext=new YS(e.ref),this.attachment=Is(this.opts.ref,r=>this.root.triggerNode=r)}#i=()=>{this.#r!==null&&(clearTimeout(this.#r),this.#r=null)};handlePointerUp=()=>{this.#e.current=!1};#o=()=>{k(this.#n)||(this.#e.current=!1)};#a=()=>{k(this.#n)||(this.#e.current=!0,this.domContext.getDocument().addEventListener("pointerup",()=>{this.handlePointerUp()},{once:!0}))};#s=e=>{if(!k(this.#n)&&e.pointerType!=="touch"){if(this.root.provider.isPointerInTransit.current){this.#i(),this.#r=window.setTimeout(()=>{this.root.provider.isPointerInTransit.current&&(this.root.provider.isPointerInTransit.current=!1,this.root.onTriggerEnter(),K(this.#t,!0))},250);return}this.root.onTriggerEnter(),K(this.#t,!0)}};#l=e=>{k(this.#n)||e.pointerType!=="touch"&&(k(this.#t)||(this.#i(),this.root.provider.isPointerInTransit.current=!1,this.root.onTriggerEnter(),K(this.#t,!0)))};#u=()=>{k(this.#n)||(this.#i(),this.root.onTriggerLeave(),K(this.#t,!1))};#c=e=>{this.#e.current||k(this.#n)||this.root.ignoreNonKeyboardFocus&&!aq(e.currentTarget)||this.root.handleOpen()};#d=()=>{k(this.#n)||this.root.handleClose()};#h=()=>{this.root.disableCloseOnTriggerClick||k(this.#n)||this.root.handleClose()};#f=ae(()=>({id:this.opts.id.current,"aria-describedby":this.root.opts.open.current?this.root.contentNode?.id:void 0,"data-state":this.root.stateAttr,"data-disabled":af(k(this.#n)),"data-delay-duration":`${this.root.delayDuration}`,[b8.trigger]:"",tabindex:k(this.#n)?void 0:0,disabled:this.opts.disabled.current,onpointerup:this.#o,onpointerdown:this.#a,onpointerenter:this.#s,onpointermove:this.#l,onpointerleave:this.#u,onfocus:this.#c,onblur:this.#d,onclick:this.#h,...this.attachment}));get props(){return k(this.#f)}set props(e){K(this.#f,e)}}class IE{static create(e){return new IE(e,TE.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Is(this.opts.ref,r=>this.root.contentNode=r),new zq({triggerNode:()=>this.root.triggerNode,contentNode:()=>this.root.contentNode,enabled:()=>this.root.opts.open.current&&!this.root.disableHoverableContent,onPointerExit:()=>{this.root.provider.isTooltipOpen(this.root)&&this.root.handleClose()},setIsPointerInTransit:r=>{this.root.provider.isPointerInTransit.current=r},transitTimeout:this.root.provider.opts.skipDelayDuration.current}),Kj(()=>ni(window,"scroll",r=>{const i=r.target;i&&i.contains(this.root.triggerNode)&&this.root.handleClose()}))}onInteractOutside=e=>{if(c0(e.target)&&this.root.triggerNode?.contains(e.target)&&this.root.disableCloseOnTriggerClick){e.preventDefault();return}this.opts.onInteractOutside.current(e),!e.defaultPrevented&&this.root.handleClose()};onEscapeKeydown=e=>{this.opts.onEscapeKeydown.current?.(e),!e.defaultPrevented&&this.root.handleClose()};onOpenAutoFocus=e=>{e.preventDefault()};onCloseAutoFocus=e=>{e.preventDefault()};get shouldRender(){return this.root.contentPresence.shouldRender}#e=ae(()=>({open:this.root.opts.open.current}));get snippetProps(){return k(this.#e)}set snippetProps(e){K(this.#e,e)}#t=ae(()=>({id:this.opts.id.current,"data-state":this.root.stateAttr,"data-disabled":af(this.root.disabled),style:{pointerEvents:"auto",outline:"none"},[b8.content]:"",...this.attachment}));get props(){return k(this.#t)}set props(e){K(this.#t,e)}popperProps={onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown,onOpenAutoFocus:this.onOpenAutoFocus,onCloseAutoFocus:this.onCloseAutoFocus}}function Bd(t,e){St(e,!0);let n=le(e,"open",15,!1),r=le(e,"onOpenChange",3,bn),i=le(e,"onOpenChangeComplete",3,bn);CE.create({open:Be(()=>n(),s=>{n(s),r()(s)}),delayDuration:Be(()=>e.delayDuration),disableCloseOnTriggerClick:Be(()=>e.disableCloseOnTriggerClick),disableHoverableContent:Be(()=>e.disableHoverableContent),ignoreNonKeyboardFocus:Be(()=>e.ignoreNonKeyboardFocus),disabled:Be(()=>e.disabled),onOpenChangeComplete:Be(()=>i())}),h8(t,{tooltip:!0,children:(s,o)=>{var a=Fe(),l=Te(a);Tt(l,()=>e.children??Ut),X(s,a)},$$slots:{default:!0}}),Et()}var AG=_e("<div><div><!></div></div>"),IG=_e("<div><div><!></div></div>");function Fd(t,e){const n=Xo();St(e,!0);let r=le(e,"id",19,()=>nl(n)),i=le(e,"ref",15,null),s=le(e,"side",3,"top"),o=le(e,"sideOffset",3,0),a=le(e,"align",3,"center"),l=le(e,"avoidCollisions",3,!0),c=le(e,"arrowPadding",3,0),u=le(e,"sticky",3,"partial"),d=le(e,"hideWhenDetached",3,!1),f=le(e,"collisionPadding",3,0),h=le(e,"onInteractOutside",3,bn),p=le(e,"onEscapeKeydown",3,bn),m=le(e,"forceMount",3,!1),g=_i(e,["$$slots","$$events","$$legacy","children","child","id","ref","side","sideOffset","align","avoidCollisions","arrowPadding","sticky","strategy","hideWhenDetached","collisionPadding","onInteractOutside","onEscapeKeydown","forceMount"]);const y=IE.create({id:Be(()=>r()),ref:Be(()=>i(),T=>i(T)),onInteractOutside:Be(()=>h()),onEscapeKeydown:Be(()=>p())}),b=ae(()=>({side:s(),sideOffset:o(),align:a(),avoidCollisions:l(),arrowPadding:c(),sticky:u(),hideWhenDetached:d(),collisionPadding:f(),strategy:e.strategy})),E=ae(()=>mr(g,k(b),y.props));var C=Fe(),I=Te(C);{var x=T=>{y8(T,Kn(()=>k(E),()=>y.popperProps,{get enabled(){return y.root.opts.open.current},get id(){return r()},trapFocus:!1,loop:!1,preventScroll:!1,forceMount:!0,get ref(){return y.opts.ref},tooltip:!0,get shouldRender(){return y.shouldRender},popper:(_,O)=>{let F=()=>O?.().props,L=()=>O?.().wrapperProps;const B=ae(()=>mr(F(),{style:b0("tooltip")}));var N=Fe(),M=Te(N);{var R=z=>{var V=Fe(),Q=Te(V);{let Y=ae(()=>({props:k(B),wrapperProps:L(),...y.snippetProps}));Tt(Q,()=>e.child,()=>k(Y))}X(z,V)},H=z=>{var V=AG();wr(V,()=>({...L()}));var Q=re(V);wr(Q,()=>({...k(B)}));var Y=re(Q);Tt(Y,()=>e.children??Ut),X(z,V)};$e(M,z=>{e.child?z(R):z(H,!1)})}X(_,N)},$$slots:{popper:!0}}))},P=T=>{var S=Fe(),_=Te(S);{var O=F=>{g8(F,Kn(()=>k(E),()=>y.popperProps,{get open(){return y.root.opts.open.current},get id(){return r()},trapFocus:!1,loop:!1,preventScroll:!1,forceMount:!1,get ref(){return y.opts.ref},tooltip:!0,get shouldRender(){return y.shouldRender},popper:(B,N)=>{let M=()=>N?.().props,R=()=>N?.().wrapperProps;const H=ae(()=>mr(M(),{style:b0("tooltip")}));var z=Fe(),V=Te(z);{var Q=ie=>{var ne=Fe(),J=Te(ne);{let ke=ae(()=>({props:k(H),wrapperProps:R(),...y.snippetProps}));Tt(J,()=>e.child,()=>k(ke))}X(ie,ne)},Y=ie=>{var ne=IG();wr(ne,()=>({...R()}));var J=re(ne);wr(J,()=>({...k(H)}));var ke=re(J);Tt(ke,()=>e.children??Ut),X(ie,ne)};$e(V,ie=>{e.child?ie(Q):ie(Y,!1)})}X(B,z)},$$slots:{popper:!0}}))};$e(_,F=>{m()||F(O)},!0)}X(T,S)};$e(I,T=>{m()?T(x):T(P,!1)})}X(t,C),Et()}var PG=_e("<button><!></button>");function $d(t,e){const n=Xo();St(e,!0);let r=le(e,"id",19,()=>nl(n)),i=le(e,"disabled",3,!1),s=le(e,"type",3,"button"),o=le(e,"ref",15,null),a=_i(e,["$$slots","$$events","$$legacy","children","child","id","disabled","type","ref"]);const l=AE.create({id:Be(()=>r()),disabled:Be(()=>i()??!1),ref:Be(()=>o(),u=>o(u))}),c=ae(()=>mr(a,l.props,{type:s()}));p8(t,{get id(){return r()},get ref(){return l.opts.ref},tooltip:!0,children:(u,d)=>{var f=Fe(),h=Te(f);{var p=g=>{var y=Fe(),b=Te(y);Tt(b,()=>e.child,()=>({props:k(c)})),X(g,y)},m=g=>{var y=PG();wr(y,()=>({...k(c)}));var b=re(y);Tt(b,()=>e.children??Ut),X(g,y)};$e(h,g=>{e.child?g(p):g(m,!1)})}X(u,f)},$$slots:{default:!0}}),Et()}function OG(t,e){St(e,!0);let n=le(e,"delayDuration",3,700),r=le(e,"disableCloseOnTriggerClick",3,!1),i=le(e,"disableHoverableContent",3,!1),s=le(e,"disabled",3,!1),o=le(e,"ignoreNonKeyboardFocus",3,!1),a=le(e,"skipDelayDuration",3,300);_E.create({delayDuration:Be(()=>n()),disableCloseOnTriggerClick:Be(()=>r()),disableHoverableContent:Be(()=>i()),disabled:Be(()=>s()),ignoreNonKeyboardFocus:Be(()=>o()),skipDelayDuration:Be(()=>a())});var l=Fe(),c=Te(l);Tt(c,()=>e.children??Ut),X(t,l),Et()}function wA(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function v8(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function MG(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");wA(t.outputLen),wA(t.blockLen)}function S0(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function NG(t,e){v8(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const gv=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const x8=t=>t instanceof Uint8Array,yv=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),ho=(t,e)=>t<<32-e|t>>>e,RG=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!RG)throw new Error("Non little-endian hardware is not supported");function DG(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function PE(t){if(typeof t=="string"&&(t=DG(t)),!x8(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function LG(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!x8(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let S8=class{clone(){return this._cloneInto()}};function BG(t){const e=r=>t().update(PE(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function E8(t=32){if(gv&&typeof gv.getRandomValues=="function")return gv.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function FG(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}let $G=class extends S8{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=yv(this.buffer)}update(e){S0(this);const{view:n,buffer:r,blockLen:i}=this;e=PE(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=yv(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){S0(this),NG(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;FG(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=yv(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const zG=(t,e,n)=>t&e^~t&n,UG=(t,e,n)=>t&e^t&n^e&n,HG=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Sl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),El=new Uint32Array(64);let VG=class extends $G{constructor(){super(64,32,8,!1),this.A=Sl[0]|0,this.B=Sl[1]|0,this.C=Sl[2]|0,this.D=Sl[3]|0,this.E=Sl[4]|0,this.F=Sl[5]|0,this.G=Sl[6]|0,this.H=Sl[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)El[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=El[d-15],h=El[d-2],p=ho(f,7)^ho(f,18)^f>>>3,m=ho(h,17)^ho(h,19)^h>>>10;El[d]=m+El[d-7]+p+El[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=ho(a,6)^ho(a,11)^ho(a,25),h=u+f+zG(a,l,c)+HG[d]+El[d]|0,m=(ho(r,2)^ho(r,13)^ho(r,22))+UG(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){El.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const $x=BG(()=>new VG);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const k8=BigInt(0),mb=BigInt(1),WG=BigInt(2),gb=t=>t instanceof Uint8Array,jG=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function uf(t){if(!gb(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=jG[t[n]];return e}function T8(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function OE(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function df(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Vi(t){return OE(uf(t))}function ME(t){if(!gb(t))throw new Error("Uint8Array expected");return OE(uf(Uint8Array.from(t).reverse()))}function xc(t,e){return df(t.toString(16).padStart(e*2,"0"))}function NE(t,e){return xc(t,e).reverse()}function qG(t){return df(T8(t))}function Qr(t,e,n){let r;if(typeof e=="string")try{r=df(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(gb(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Mu(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!gb(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function KG(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function GG(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function ZG(t){let e;for(e=0;t>k8;t>>=mb,e+=1);return e}function QG(t,e){return t>>BigInt(e)&mb}const XG=(t,e,n)=>t|(n?mb:k8)<<BigInt(e),RE=t=>(WG<<BigInt(t-1))-mb,bv=t=>new Uint8Array(t),vA=t=>Uint8Array.from(t);function _8(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=bv(t),i=bv(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...d)=>n(i,r,...d),l=(d=bv())=>{i=a(vA([0]),d),r=a(),d.length!==0&&(i=a(vA([1]),d),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<e;){r=a();const h=r.slice();f.push(h),d+=r.length}return Mu(...f)};return(d,f)=>{o(),l(d);let h;for(;!(h=f(c()));)l();return o(),h}}const YG={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function am(t,e,n={}){const r=(i,s,o)=>{const a=YG[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const JG=Object.freeze(Object.defineProperty({__proto__:null,bitGet:QG,bitLen:ZG,bitMask:RE,bitSet:XG,bytesToHex:uf,bytesToNumberBE:Vi,bytesToNumberLE:ME,concatBytes:Mu,createHmacDrbg:_8,ensureBytes:Qr,equalBytes:KG,hexToBytes:df,hexToNumber:OE,numberToBytesBE:xc,numberToBytesLE:NE,numberToHexUnpadded:T8,numberToVarBytesBE:qG,utf8ToBytes:GG,validateObject:am},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xr=BigInt(0),er=BigInt(1),eu=BigInt(2),eZ=BigInt(3),zx=BigInt(4),xA=BigInt(5),SA=BigInt(8);BigInt(9);BigInt(16);function Rr(t,e){const n=t%e;return n>=xr?n:e+n}function tZ(t,e,n){if(n<=xr||e<xr)throw new Error("Expected power/modulo > 0");if(n===er)return xr;let r=er;for(;e>xr;)e&er&&(r=r*t%n),t=t*t%n,e>>=er;return r}function hs(t,e,n){let r=t;for(;e-- >xr;)r*=r,r%=n;return r}function Ux(t,e){if(t===xr||e<=xr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Rr(t,e),r=e,i=xr,s=er;for(;n!==xr;){const a=r/n,l=r%n,c=i-s*a;r=n,n=l,i=s,s=c}if(r!==er)throw new Error("invert: does not exist");return Rr(i,e)}function nZ(t){const e=(t-er)/eu;let n,r,i;for(n=t-er,r=0;n%eu===xr;n/=eu,r++);for(i=eu;i<t&&tZ(i,e,t)!==t-er;i++);if(r===1){const o=(t+er)/zx;return function(l,c){const u=l.pow(c,o);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+er)/eu;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=r,u=a.pow(a.mul(a.ONE,i),n),d=a.pow(l,s),f=a.pow(l,n);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let m=a.sqr(f);h<c&&!a.eql(m,a.ONE);h++)m=a.sqr(m);const p=a.pow(u,er<<BigInt(c-h-1));u=a.sqr(p),d=a.mul(d,p),f=a.mul(f,u),c=h}return d}}function rZ(t){if(t%zx===eZ){const e=(t+er)/zx;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%SA===xA){const e=(t-xA)/SA;return function(r,i){const s=r.mul(i,eu),o=r.pow(s,e),a=r.mul(i,o),l=r.mul(r.mul(a,eu),o),c=r.mul(a,r.sub(l,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return nZ(t)}const iZ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sZ(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=iZ.reduce((r,i)=>(r[i]="function",r),e);return am(t,n)}function oZ(t,e,n){if(n<xr)throw new Error("Expected power > 0");if(n===xr)return t.ONE;if(n===er)return e;let r=t.ONE,i=e;for(;n>xr;)n&er&&(r=t.mul(r,i)),i=t.sqr(i),n>>=er;return r}function aZ(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function C8(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function lZ(t,e,n=!1,r={}){if(t<=xr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=C8(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=rZ(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:RE(i),ZERO:xr,ONE:er,create:l=>Rr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return xr<=l&&l<t},is0:l=>l===xr,isOdd:l=>(l&er)===er,neg:l=>Rr(-l,t),eql:(l,c)=>l===c,sqr:l=>Rr(l*l,t),add:(l,c)=>Rr(l+c,t),sub:(l,c)=>Rr(l-c,t),mul:(l,c)=>Rr(l*c,t),pow:(l,c)=>oZ(a,l,c),div:(l,c)=>Rr(l*Ux(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>Ux(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>aZ(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?NE(l,s):xc(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?ME(l):Vi(l)}});return Object.freeze(a)}function A8(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function I8(t){const e=A8(t);return e+Math.ceil(e/2)}function cZ(t,e,n=!1){const r=t.length,i=A8(e),s=I8(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Vi(t):ME(t),a=Rr(o,e-er)+er;return n?NE(a,i):xc(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const uZ=BigInt(0),wv=BigInt(1);function dZ(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>uZ;)s&wv&&(o=o.add(a)),a=a.double(),s>>=wv;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let d=0;d<o;d++){u=c,l.push(u);for(let f=1;f<a;f++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const d=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const m=p*l;let g=Number(o&d);o>>=h,g>l&&(g-=f,o+=wv);const y=m,b=m+Math.abs(g)-1,E=p%2!==0,C=g<0;g===0?u=u.add(n(E,s[y])):c=c.add(n(C,s[b]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function P8(t){return sZ(t.Fp),am(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...C8(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function fZ(t){const e=P8(t);am(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:hZ,hexToBytes:pZ}=JG,ru={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=ru;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:hZ(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=ru,n=typeof t=="string"?pZ(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=ru._parseInt(n.subarray(2)),{d:o,l:a}=ru._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Ca=BigInt(0),ws=BigInt(1);BigInt(2);const EA=BigInt(3);BigInt(4);function mZ(t){const e=fZ(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return Mu(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1),g=n.fromBytes(m.subarray(0,n.BYTES)),y=n.fromBytes(m.subarray(n.BYTES,2*n.BYTES));return{x:g,y}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Ca<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=uf(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let E;try{E=typeof p=="bigint"?p:Vi(Qr("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(E=Rr(E,b)),a(E),E}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=E=>n.eql(E,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map(y=>y.pz));return m.map((y,b)=>y.toAffine(g[b])).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(Qr("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:E,py:C,pz:I}=m,x=n.eql(n.mul(g,I),n.mul(E,b)),P=n.eql(n.mul(y,I),n.mul(C,b));return x&&P}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,EA),{px:b,py:E,pz:C}=this;let I=n.ZERO,x=n.ZERO,P=n.ZERO,T=n.mul(b,b),S=n.mul(E,E),_=n.mul(C,C),O=n.mul(b,E);return O=n.add(O,O),P=n.mul(b,C),P=n.add(P,P),I=n.mul(m,P),x=n.mul(y,_),x=n.add(I,x),I=n.sub(S,x),x=n.add(S,x),x=n.mul(I,x),I=n.mul(O,I),P=n.mul(y,P),_=n.mul(m,_),O=n.sub(T,_),O=n.mul(m,O),O=n.add(O,P),P=n.add(T,T),T=n.add(P,T),T=n.add(T,_),T=n.mul(T,O),x=n.add(x,T),_=n.mul(E,C),_=n.add(_,_),T=n.mul(_,O),I=n.sub(I,T),P=n.mul(_,S),P=n.add(P,P),P=n.add(P,P),new d(I,x,P)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:E,py:C,pz:I}=m;let x=n.ZERO,P=n.ZERO,T=n.ZERO;const S=e.a,_=n.mul(e.b,EA);let O=n.mul(g,E),F=n.mul(y,C),L=n.mul(b,I),B=n.add(g,y),N=n.add(E,C);B=n.mul(B,N),N=n.add(O,F),B=n.sub(B,N),N=n.add(g,b);let M=n.add(E,I);return N=n.mul(N,M),M=n.add(O,L),N=n.sub(N,M),M=n.add(y,b),x=n.add(C,I),M=n.mul(M,x),x=n.add(F,L),M=n.sub(M,x),T=n.mul(S,N),x=n.mul(_,L),T=n.add(x,T),x=n.sub(F,T),T=n.add(F,T),P=n.mul(x,T),F=n.add(O,O),F=n.add(F,O),L=n.mul(S,L),N=n.mul(_,N),F=n.add(F,L),L=n.sub(O,L),L=n.mul(S,L),N=n.add(N,L),O=n.mul(F,N),P=n.add(P,O),O=n.mul(M,N),x=n.mul(B,x),x=n.sub(x,O),O=n.mul(B,F),T=n.mul(M,T),T=n.add(T,O),new d(x,P,T)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,g=>{const y=n.invertBatch(g.map(b=>b.pz));return g.map((b,E)=>b.toAffine(y[E])).map(d.fromAffine)})}multiplyUnsafe(m){const g=d.ZERO;if(m===Ca)return g;if(a(m),m===ws)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:E,k2neg:C,k2:I}=y.splitScalar(m),x=g,P=g,T=this;for(;E>Ca||I>Ca;)E&ws&&(x=x.add(T)),I&ws&&(P=P.add(T)),T=T.double(),E>>=ws,I>>=ws;return b&&(x=x.negate()),C&&(P=P.negate()),P=new d(n.mul(P.px,y.beta),P.py,P.pz),x.add(P)}multiply(m){a(m);let g=m,y,b;const{endo:E}=e;if(E){const{k1neg:C,k1:I,k2neg:x,k2:P}=E.splitScalar(g);let{p:T,f:S}=this.wNAF(I),{p:_,f:O}=this.wNAF(P);T=h.constTimeNegate(C,T),_=h.constTimeNegate(x,_),_=new d(n.mul(_.px,E.beta),_.py,_.pz),y=T.add(_),b=S.add(O)}else{const{p:C,f:I}=this.wNAF(g);y=C,b=I}return d.normalizeZ([y,b])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,E=(I,x)=>x===Ca||x===ws||!I.equals(b)?I.multiplyUnsafe(x):I.multiply(x),C=E(this,g).add(E(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,E=this.is0();m==null&&(m=E?n.ONE:n.inv(b));const C=n.mul(g,m),I=n.mul(y,m),x=n.mul(b,m);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:C,y:I}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===ws)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===ws?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return uf(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=dZ(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function gZ(t){const e=P8(t);return am(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function yZ(t){const e=gZ(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(N){return Ca<N&&N<n.ORDER}function a(N){return Rr(N,r)}function l(N){return Ux(N,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=mZ({...e,toBytes(N,M,R){const H=M.toAffine(),z=n.toBytes(H.x),V=Mu;return R?V(Uint8Array.from([M.hasEvenY()?2:3]),z):V(Uint8Array.from([4]),z,n.toBytes(H.y))},fromBytes(N){const M=N.length,R=N[0],H=N.subarray(1);if(M===i&&(R===2||R===3)){const z=Vi(H);if(!o(z))throw new Error("Point is not on curve");const V=d(z);let Q=n.sqrt(V);const Y=(Q&ws)===ws;return(R&1)===1!==Y&&(Q=n.neg(Q)),{x:z,y:Q}}else if(M===s&&R===4){const z=n.fromBytes(H.subarray(0,n.BYTES)),V=n.fromBytes(H.subarray(n.BYTES,2*n.BYTES));return{x:z,y:V}}else throw new Error(`Point of length ${M} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=N=>uf(xc(N,e.nByteLength));function p(N){const M=r>>ws;return N>M}function m(N){return p(N)?a(-N):N}const g=(N,M,R)=>Vi(N.slice(M,R));class y{constructor(M,R,H){this.r=M,this.s=R,this.recovery=H,this.assertValidity()}static fromCompact(M){const R=e.nByteLength;return M=Qr("compactSignature",M,R*2),new y(g(M,0,R),g(M,R,2*R))}static fromDER(M){const{r:R,s:H}=ru.toSig(Qr("DER",M));return new y(R,H)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(M){return new y(this.r,this.s,M)}recoverPublicKey(M){const{r:R,s:H,recovery:z}=this,V=P(Qr("msgHash",M));if(z==null||![0,1,2,3].includes(z))throw new Error("recovery id invalid");const Q=z===2||z===3?R+e.n:R;if(Q>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const Y=(z&1)===0?"02":"03",ie=c.fromHex(Y+h(Q)),ne=l(Q),J=a(-V*ne),ke=a(H*ne),ze=c.BASE.multiplyAndAddUnsafe(ie,J,ke);if(!ze)throw new Error("point at infinify");return ze.assertValidity(),ze}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return df(this.toDERHex())}toDERHex(){return ru.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return df(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const b={isValidPrivateKey(N){try{return u(N),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const N=I8(e.n);return cZ(e.randomBytes(N),e.n)},precompute(N=8,M=c.BASE){return M._setWindowSize(N),M.multiply(BigInt(3)),M}};function E(N,M=!0){return c.fromPrivateKey(N).toRawBytes(M)}function C(N){const M=N instanceof Uint8Array,R=typeof N=="string",H=(M||R)&&N.length;return M?H===i||H===s:R?H===2*i||H===2*s:N instanceof c}function I(N,M,R=!0){if(C(N))throw new Error("first arg must be private key");if(!C(M))throw new Error("second arg must be public key");return c.fromHex(M).multiply(u(N)).toRawBytes(R)}const x=e.bits2int||function(N){const M=Vi(N),R=N.length*8-e.nBitLength;return R>0?M>>BigInt(R):M},P=e.bits2int_modN||function(N){return a(x(N))},T=RE(e.nBitLength);function S(N){if(typeof N!="bigint")throw new Error("bigint expected");if(!(Ca<=N&&N<T))throw new Error(`bigint expected < 2^${e.nBitLength}`);return xc(N,e.nByteLength)}function _(N,M,R=O){if(["recovered","canonical"].some(Ee=>Ee in R))throw new Error("sign() legacy options not supported");const{hash:H,randomBytes:z}=e;let{lowS:V,prehash:Q,extraEntropy:Y}=R;V==null&&(V=!0),N=Qr("msgHash",N),Q&&(N=Qr("prehashed msgHash",H(N)));const ie=P(N),ne=u(M),J=[S(ne),S(ie)];if(Y!=null){const Ee=Y===!0?z(n.BYTES):Y;J.push(Qr("extraEntropy",Ee))}const ke=Mu(...J),ze=ie;function he(Ee){const Le=x(Ee);if(!f(Le))return;const pe=l(Le),xe=c.BASE.multiply(Le).toAffine(),Me=a(xe.x);if(Me===Ca)return;const Ue=a(pe*a(ze+Me*ne));if(Ue===Ca)return;let qe=(xe.x===Me?0:2)|Number(xe.y&ws),tt=Ue;return V&&p(Ue)&&(tt=m(Ue),qe^=1),new y(Me,tt,qe)}return{seed:ke,k2sig:he}}const O={lowS:e.lowS,prehash:!1},F={lowS:e.lowS,prehash:!1};function L(N,M,R=O){const{seed:H,k2sig:z}=_(N,M,R),V=e;return _8(V.hash.outputLen,V.nByteLength,V.hmac)(H,z)}c.BASE._setWindowSize(8);function B(N,M,R,H=F){const z=N;if(M=Qr("msgHash",M),R=Qr("publicKey",R),"strict"in H)throw new Error("options.strict was renamed to lowS");const{lowS:V,prehash:Q}=H;let Y,ie;try{if(typeof z=="string"||z instanceof Uint8Array)try{Y=y.fromDER(z)}catch(xe){if(!(xe instanceof ru.Err))throw xe;Y=y.fromCompact(z)}else if(typeof z=="object"&&typeof z.r=="bigint"&&typeof z.s=="bigint"){const{r:xe,s:Me}=z;Y=new y(xe,Me)}else throw new Error("PARSE");ie=c.fromHex(R)}catch(xe){if(xe.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(V&&Y.hasHighS())return!1;Q&&(M=e.hash(M));const{r:ne,s:J}=Y,ke=P(M),ze=l(J),he=a(ke*ze),Ee=a(ne*ze),Le=c.BASE.multiplyAndAddUnsafe(ie,he,Ee)?.toAffine();return Le?a(Le.x)===ne:!1}return{CURVE:e,getPublicKey:E,getSharedSecret:I,sign:L,verify:B,ProjectivePoint:c,Signature:y,utils:b}}let O8=class extends S8{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,MG(e);const r=PE(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return S0(this),this.iHash.update(e),this}digestInto(e){S0(this),v8(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const M8=(t,e,n)=>new O8(t,e).update(n).digest();M8.create=(t,e)=>new O8(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function bZ(t){return{hash:t,hmac:(e,...n)=>M8(t,e,LG(...n)),randomBytes:E8}}function wZ(t,e){const n=r=>yZ({...t,...bZ(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yb=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),E0=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),N8=BigInt(1),k0=BigInt(2),kA=(t,e)=>(t+e/k0)/e;function R8(t){const e=yb,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=hs(u,n,e)*u%e,f=hs(d,n,e)*u%e,h=hs(f,k0,e)*c%e,p=hs(h,i,e)*h%e,m=hs(p,s,e)*p%e,g=hs(m,a,e)*m%e,y=hs(g,l,e)*g%e,b=hs(y,a,e)*m%e,E=hs(b,n,e)*u%e,C=hs(E,o,e)*p%e,I=hs(C,r,e)*c%e,x=hs(I,k0,e);if(!Hx.eql(Hx.sqr(x),t))throw new Error("Cannot find square root");return x}const Hx=lZ(yb,void 0,void 0,{sqrt:R8}),Lf=wZ({a:BigInt(0),b:BigInt(7),Fp:Hx,n:E0,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=E0,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-N8*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=kA(s*t,e),l=kA(-r*t,e);let c=Rr(t-a*n-l*i,e),u=Rr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},$x),bb=BigInt(0),D8=t=>typeof t=="bigint"&&bb<t&&t<yb,vZ=t=>typeof t=="bigint"&&bb<t&&t<E0,TA={};function T0(t,...e){let n=TA[t];if(n===void 0){const r=$x(Uint8Array.from(t,i=>i.charCodeAt(0)));n=Mu(r,r),TA[t]=n}return $x(Mu(n,...e))}const DE=t=>t.toRawBytes(!0).slice(1),Vx=t=>xc(t,32),vv=t=>Rr(t,yb),vp=t=>Rr(t,E0),LE=Lf.ProjectivePoint,xZ=(t,e,n)=>LE.BASE.multiplyAndAddUnsafe(t,e,n);function Wx(t){let e=Lf.utils.normPrivateKeyToScalar(t),n=LE.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:vp(-e),bytes:DE(n)}}function L8(t){if(!D8(t))throw new Error("bad x: need 0 < x < p");const e=vv(t*t),n=vv(e*t+BigInt(7));let r=R8(n);r%k0!==bb&&(r=vv(-r));const i=new LE(t,r,N8);return i.assertValidity(),i}function B8(...t){return vp(Vi(T0("BIP0340/challenge",...t)))}function SZ(t){return Wx(t).bytes}function EZ(t,e,n=E8(32)){const r=Qr("message",t),{bytes:i,scalar:s}=Wx(e),o=Qr("auxRand",n,32),a=Vx(s^Vi(T0("BIP0340/aux",o))),l=T0("BIP0340/nonce",a,i,r),c=vp(Vi(l));if(c===bb)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=Wx(c),f=B8(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(Vx(vp(d+f*s)),32),!F8(h,r,i))throw new Error("sign: Invalid signature produced");return h}function F8(t,e,n){const r=Qr("signature",t,64),i=Qr("message",e),s=Qr("publicKey",n,32);try{const o=L8(Vi(s)),a=Vi(r.subarray(0,32));if(!D8(a))return!1;const l=Vi(r.subarray(32,64));if(!vZ(l))return!1;const c=B8(Vx(a),DE(o),i),u=xZ(o,l,vp(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const Io={getPublicKey:SZ,sign:EZ,verify:F8,utils:{randomPrivateKey:Lf.utils.randomPrivateKey,lift_x:L8,pointToBytes:DE,numberToBytesBE:xc,bytesToNumberBE:Vi,taggedHash:T0,mod:Rr}},xv=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const BE=t=>t instanceof Uint8Array,Sv=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),po=(t,e)=>t<<32-e|t>>>e,kZ=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!kZ)throw new Error("Non little-endian hardware is not supported");const TZ=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function or(t){if(!BE(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=TZ[t[n]];return e}function Nu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function _Z(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function xp(t){if(typeof t=="string"&&(t=_Z(t)),!BE(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function wb(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!BE(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class $8{clone(){return this._cloneInto()}}function z8(t){const e=r=>t().update(xp(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function U8(t=32){if(xv&&typeof xv.getRandomValues=="function")return xv.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function jx(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function CZ(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function H8(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function AZ(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");jx(t.outputLen),jx(t.blockLen)}function IZ(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function PZ(t,e){H8(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Ro={number:jx,bool:CZ,bytes:H8,hash:AZ,exists:IZ,output:PZ};function OZ(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}class MZ extends $8{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Sv(this.buffer)}update(e){Ro.exists(this);const{view:n,buffer:r,blockLen:i}=this;e=xp(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=Sv(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ro.exists(this),Ro.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;OZ(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Sv(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const NZ=(t,e,n)=>t&e^~t&n,RZ=(t,e,n)=>t&e^t&n^e&n,DZ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),kl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Tl=new Uint32Array(64);class V8 extends MZ{constructor(){super(64,32,8,!1),this.A=kl[0]|0,this.B=kl[1]|0,this.C=kl[2]|0,this.D=kl[3]|0,this.E=kl[4]|0,this.F=kl[5]|0,this.G=kl[6]|0,this.H=kl[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)Tl[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=Tl[d-15],h=Tl[d-2],p=po(f,7)^po(f,18)^f>>>3,m=po(h,17)^po(h,19)^h>>>10;Tl[d]=m+Tl[d-7]+p+Tl[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=po(a,6)^po(a,11)^po(a,25),h=u+f+NZ(a,l,c)+DZ[d]+Tl[d]|0,m=(po(r,2)^po(r,13)^po(r,22))+RZ(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Tl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class LZ extends V8{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Wu=z8(()=>new V8);z8(()=>new LZ);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Bf(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function rl(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce((i,s)=>i?e(i,s.encode):s.encode,void 0),r=t.reduce((i,s)=>i?e(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function il(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Bf(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function sl(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function vb(t,e="="){if(Bf(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function W8(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function _A(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach(o=>{if(Bf(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!==e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[l]?a=!1:r=l;else continue}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const j8=(t,e)=>e?j8(e,t%e):t,_0=(t,e)=>t+(e-j8(t,e));function qx(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(_0(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${_0(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(Bf(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function BZ(t){return Bf(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return _A(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(_A(e,t,2**8))}}}function Nc(t,e=!1){if(Bf(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(_0(8,t)>32||_0(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return qx(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(qx(n,t,8,e))}}}function CA(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const FZ=rl(Nc(4),il("0123456789ABCDEF"),sl("")),$Z=rl(Nc(5),il("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),vb(5),sl(""));rl(Nc(5),il("0123456789ABCDEFGHIJKLMNOPQRSTUV"),vb(5),sl(""));rl(Nc(5),il("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),sl(""),W8(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const jo=rl(Nc(6),il("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),vb(6),sl("")),zZ=rl(Nc(6),il("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),vb(6),sl("")),FE=t=>rl(BZ(58),il(t),sl("")),Kx=FE("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");FE("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");FE("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const AA=[0,2,3,5,6,7,9,10,11],UZ={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=Kx.encode(r).padStart(AA[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),i=AA.indexOf(r.length),s=Kx.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(e)}},Gx=rl(il("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),sl("")),IA=[996825010,642813549,513874426,1027748829,705979059];function uh(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<IA.length;r++)(e>>r&1)===1&&(n^=IA[r]);return n}function PA(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=uh(i)^o>>5}i=uh(i);for(let s=0;s<r;s++)i=uh(i)^t.charCodeAt(s)&31;for(let s of e)i=uh(i)^s;for(let s=0;s<6;s++)i=uh(i);return i^=n,Gx.encode(qx([i%2**30],30,5,!1))}function q8(t){const e=t==="bech32"?1:734539939,n=Nc(5),r=n.decode,i=n.encode,s=CA(r);function o(u,d,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof d}`);const h=u.length+7+d.length;if(f!==!1&&h>f)throw new TypeError(`Length ${h} exceeds limit ${f}`);return u=u.toLowerCase(),`${u}1${Gx.encode(d)}${PA(u,d,e)}`}function a(u,d=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||d!==!1&&u.length>d)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${d})`);const f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=f;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=u.slice(0,h),m=u.slice(h+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const g=Gx.decode(m).slice(0,-6),y=PA(p,g,e);if(!m.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:g}}const l=CA(a);function c(u){const{prefix:d,words:f}=a(u,!1);return{prefix:d,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const ff=q8("bech32");q8("bech32m");const HZ={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},VZ=rl(Nc(4),il("0123456789abcdef"),sl(""),W8(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),WZ={utf8:HZ,hex:VZ,base16:FZ,base32:$Z,base64:jo,base64url:zZ,base58:Kx,base58xmr:UZ};`${Object.keys(WZ).join(", ")}`;function Ev(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function OA(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function jZ(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Ma(t,...e){if(!jZ(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const ri=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),qZ=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!qZ)throw new Error("Non little-endian hardware is not supported");function KZ(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function GZ(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const ZZ=(t,e)=>(Object.assign(e,t),e),ac=16,QZ=283;function $E(t){return t<<1^QZ&-(t>>7)}function xd(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=$E(t);return n}const Zx=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=$E(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),XZ=Zx.map((t,e)=>Zx.indexOf(e)),YZ=t=>t<<24|t>>>8,kv=t=>t<<8|t>>>24;function K8(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((c,u)=>e(t[u])),r=n.map(kv),i=r.map(kv),s=i.map(kv),o=new Uint32Array(256*256),a=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const d=c*256+u;o[d]=n[c]^r[u],a[d]=i[c]^s[u],l[d]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const zE=K8(Zx,t=>xd(t,3)<<24|t<<16|t<<8|xd(t,2)),G8=K8(XZ,t=>xd(t,11)<<24|xd(t,13)<<16|xd(t,9)<<8|xd(t,14)),JZ=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=$E(n))t[e]=n;return t})();function Z8(t){Ma(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=zE,r=ri(t),i=r.length,s=a=>Do(n,a,a,a,a),o=new Uint32Array(e+28);o.set(r);for(let a=i;a<o.length;a++){let l=o[a-1];a%i===0?l=s(YZ(l))^JZ[a/i-1]:i>6&&a%i===4&&(l=s(l)),o[a]=o[a-i]^l}return o}function eQ(t){const e=Z8(t),n=e.slice(),r=e.length,{sbox2:i}=zE,{T0:s,T1:o,T2:a,T3:l}=G8;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],d=Do(i,u,u,u,u);n[c]=s[d&255]^o[d>>>8&255]^a[d>>>16&255]^l[d>>>24]}return n}function Zl(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function Do(t,e,n,r,i){return t[e&255|n&65280]|t[r>>>16&255|i>>>16&65280]<<16}function MA(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=zE;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const m=t[l++]^Zl(o,a,e,n,r,i),g=t[l++]^Zl(o,a,n,r,i,e),y=t[l++]^Zl(o,a,r,i,e,n),b=t[l++]^Zl(o,a,i,e,n,r);e=m,n=g,r=y,i=b}const u=t[l++]^Do(s,e,n,r,i),d=t[l++]^Do(s,n,r,i,e),f=t[l++]^Do(s,r,i,e,n),h=t[l++]^Do(s,i,e,n,r);return{s0:u,s1:d,s2:f,s3:h}}function tQ(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=G8;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const m=t[l++]^Zl(o,a,e,i,r,n),g=t[l++]^Zl(o,a,n,e,i,r),y=t[l++]^Zl(o,a,r,n,e,i),b=t[l++]^Zl(o,a,i,r,n,e);e=m,n=g,r=y,i=b}const u=t[l++]^Do(s,e,i,r,n),d=t[l++]^Do(s,n,e,i,r),f=t[l++]^Do(s,r,n,e,i),h=t[l++]^Do(s,i,r,n,e);return{s0:u,s1:d,s2:f,s3:h}}function Q8(t,e){if(!e)return new Uint8Array(t);if(Ma(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function nQ(t){if(Ma(t),t.length%ac!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${ac}`)}function rQ(t,e,n){let r=t.length;const i=r%ac;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=ri(t);if(e){let l=ac-i;l||(l=ac),r=r+l}const o=Q8(r,n),a=ri(o);return{b:s,o:a,out:o}}function iQ(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function sQ(t){const e=new Uint8Array(16),n=ri(e);e.set(t);const r=ac-t.length;for(let i=ac-r;i<ac;i++)e[i]=r;return n}const X8=ZZ({blockSize:16,nonceLength:16},function(e,n,r={}){Ma(e),Ma(n,16);const i=!r.disablePadding;return{encrypt:(s,o)=>{const a=Z8(e),{b:l,o:c,out:u}=rQ(s,i,o),d=ri(n);let f=d[0],h=d[1],p=d[2],m=d[3],g=0;for(;g+4<=l.length;)f^=l[g+0],h^=l[g+1],p^=l[g+2],m^=l[g+3],{s0:f,s1:h,s2:p,s3:m}=MA(a,f,h,p,m),c[g++]=f,c[g++]=h,c[g++]=p,c[g++]=m;if(i){const y=sQ(s.subarray(g*4));f^=y[0],h^=y[1],p^=y[2],m^=y[3],{s0:f,s1:h,s2:p,s3:m}=MA(a,f,h,p,m),c[g++]=f,c[g++]=h,c[g++]=p,c[g++]=m}return a.fill(0),u},decrypt:(s,o)=>{nQ(s);const a=eQ(e),l=ri(n),c=Q8(s.length,o),u=ri(s),d=ri(c);let f=l[0],h=l[1],p=l[2],m=l[3];for(let g=0;g+4<=u.length;){const y=f,b=h,E=p,C=m;f=u[g+0],h=u[g+1],p=u[g+2],m=u[g+3];const{s0:I,s1:x,s2:P,s3:T}=tQ(a,f,h,p,m);d[g++]=I^y,d[g++]=x^b,d[g++]=P^E,d[g++]=T^C}return a.fill(0),iQ(c,i)}}}),Y8=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),oQ=Y8("expand 16-byte k"),aQ=Y8("expand 32-byte k"),lQ=ri(oQ),J8=ri(aQ);J8.slice();function rn(t,e){return t<<e|t>>>32-e}function Qx(t){return t.byteOffset%4===0}const qm=64,cQ=16,eN=2**32-1,NA=new Uint32Array;function uQ(t,e,n,r,i,s,o,a){const l=i.length,c=new Uint8Array(qm),u=ri(c),d=Qx(i)&&Qx(s),f=d?ri(i):NA,h=d?ri(s):NA;for(let p=0;p<l;o++){if(t(e,n,r,u,o,a),o>=eN)throw new Error("arx: counter overflow");const m=Math.min(qm,l-p);if(d&&m===qm){const g=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let y=0,b;y<cQ;y++)b=g+y,h[b]=f[b]^u[y];p+=qm;continue}for(let g=0,y;g<m;g++)y=p+g,s[y]=i[y]^c[g];p+=m}}function dQ(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=KZ({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Ev(i),Ev(o),OA(s),OA(n),(a,l,c,u,d=0)=>{Ma(a),Ma(l),Ma(c);const f=c.length;if(u||(u=new Uint8Array(f)),Ma(u),Ev(d),d<0||d>=eN)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const h=[];let p=a.length,m,g;if(p===32)m=a.slice(),h.push(m),g=J8;else if(p===16&&n)m=new Uint8Array(32),m.set(a),m.set(a,16),g=lQ,h.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Qx(l)||(l=l.slice(),h.push(l));const y=ri(m);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,y,ri(l.subarray(0,16)),y),l=l.subarray(16)}const b=16-i;if(b!==l.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const C=new Uint8Array(12);C.set(l,s?0:12-l.length),l=C,h.push(l)}const E=ri(l);for(uQ(t,g,y,E,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function fQ(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],d=e[1],f=e[2],h=e[3],p=e[4],m=e[5],g=e[6],y=e[7],b=i,E=n[0],C=n[1],I=n[2],x=o,P=a,T=l,S=c,_=u,O=d,F=f,L=h,B=p,N=m,M=g,R=y,H=b,z=E,V=C,Q=I;for(let ie=0;ie<s;ie+=2)x=x+_|0,H=rn(H^x,16),B=B+H|0,_=rn(_^B,12),x=x+_|0,H=rn(H^x,8),B=B+H|0,_=rn(_^B,7),P=P+O|0,z=rn(z^P,16),N=N+z|0,O=rn(O^N,12),P=P+O|0,z=rn(z^P,8),N=N+z|0,O=rn(O^N,7),T=T+F|0,V=rn(V^T,16),M=M+V|0,F=rn(F^M,12),T=T+F|0,V=rn(V^T,8),M=M+V|0,F=rn(F^M,7),S=S+L|0,Q=rn(Q^S,16),R=R+Q|0,L=rn(L^R,12),S=S+L|0,Q=rn(Q^S,8),R=R+Q|0,L=rn(L^R,7),x=x+O|0,Q=rn(Q^x,16),M=M+Q|0,O=rn(O^M,12),x=x+O|0,Q=rn(Q^x,8),M=M+Q|0,O=rn(O^M,7),P=P+F|0,H=rn(H^P,16),R=R+H|0,F=rn(F^R,12),P=P+F|0,H=rn(H^P,8),R=R+H|0,F=rn(F^R,7),T=T+L|0,z=rn(z^T,16),B=B+z|0,L=rn(L^B,12),T=T+L|0,z=rn(z^T,8),B=B+z|0,L=rn(L^B,7),S=S+_|0,V=rn(V^S,16),N=N+V|0,_=rn(_^N,12),S=S+_|0,V=rn(V^S,8),N=N+V|0,_=rn(_^N,7);let Y=0;r[Y++]=o+x|0,r[Y++]=a+P|0,r[Y++]=l+T|0,r[Y++]=c+S|0,r[Y++]=u+_|0,r[Y++]=d+O|0,r[Y++]=f+F|0,r[Y++]=h+L|0,r[Y++]=p+B|0,r[Y++]=m+N|0,r[Y++]=g+M|0,r[Y++]=y+R|0,r[Y++]=b+H|0,r[Y++]=E+z|0,r[Y++]=C+V|0,r[Y++]=I+Q|0}const tN=dQ(fQ,{counterRight:!1,counterLength:4,allowShortKeys:!1});class nN extends $8{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Ro.hash(e);const r=xp(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Ro.exists(this),this.iHash.update(e),this}digestInto(e){Ro.exists(this),Ro.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const xb=(t,e,n)=>new nN(t,e).update(n).digest();xb.create=(t,e)=>new nN(t,e);function hQ(t,e,n){return Ro.hash(t),xb(t,xp(n),xp(e))}const Tv=new Uint8Array([0]),RA=new Uint8Array;function pQ(t,e,n,r=32){if(Ro.hash(t),Ro.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=RA);const s=new Uint8Array(i*t.outputLen),o=xb.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)Tv[0]=c+1,a.update(c===0?RA:l).update(n).update(Tv).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),Tv.fill(0),s.slice(0,r)}var mQ=Object.defineProperty,Bn=(t,e)=>{for(var n in e)mQ(t,n,{get:e[n],enumerable:!0})},id=Symbol("verified"),gQ=t=>t instanceof Object;function UE(t){if(!gQ(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var yQ={};Bn(yQ,{Queue:()=>xQ,QueueNode:()=>rN,binarySearch:()=>HE,bytesToHex:()=>or,hexToBytes:()=>Nu,insertEventIntoAscendingList:()=>vQ,insertEventIntoDescendingList:()=>wQ,normalizeURL:()=>bQ,utf8Decoder:()=>Na,utf8Encoder:()=>ro});var Na=new TextDecoder("utf-8"),ro=new TextEncoder;function bQ(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function wQ(t,e){const[n,r]=HE(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at);return r||t.splice(n,0,e),t}function vQ(t,e){const[n,r]=HE(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at);return r||t.splice(n,0,e),t}function HE(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var rN=class{value;next=null;prev=null;constructor(t){this.value=t}},xQ=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new rN(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},SQ=class{generateSecretKey(){return Io.utils.randomPrivateKey()}getPublicKey(e){return or(Io.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=or(Io.getPublicKey(n)),r.id=_g(r),r.sig=or(Io.sign(_g(r),n)),r[id]=!0,r}verifyEvent(e){if(typeof e[id]=="boolean")return e[id];const n=_g(e);if(n!==e.id)return e[id]=!1,!1;try{const r=Io.verify(e.sig,n,e.pubkey);return e[id]=r,r}catch{return e[id]=!1,!1}}};function EQ(t){if(!UE(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function _g(t){let e=Wu(ro.encode(EQ(t)));return or(e)}var Sb=new SQ,kQ=Sb.generateSecretKey,Eb=Sb.getPublicKey,ea=Sb.finalizeEvent,VE=Sb.verifyEvent,TQ={};Bn(TQ,{Application:()=>kX,BadgeAward:()=>NQ,BadgeDefinition:()=>yX,BlockedRelaysList:()=>tX,BookmarkList:()=>YQ,Bookmarksets:()=>pX,Calendar:()=>OX,CalendarEventRSVP:()=>MX,ChannelCreation:()=>cN,ChannelHideMessage:()=>fN,ChannelMessage:()=>dN,ChannelMetadata:()=>uN,ChannelMuteUser:()=>hN,ClassifiedListing:()=>CX,ClientAuth:()=>mN,CommunitiesList:()=>JQ,CommunityDefinition:()=>DX,CommunityPostApproval:()=>UQ,Contacts:()=>PQ,CreateOrUpdateProduct:()=>vX,CreateOrUpdateStall:()=>wX,Curationsets:()=>mX,Date:()=>IX,DirectMessageRelaysList:()=>sX,DraftClassifiedListing:()=>AX,DraftLong:()=>SX,Emojisets:()=>EX,EncryptedDirectMessage:()=>OQ,EventDeletion:()=>MQ,FileMetadata:()=>DQ,FileServerPreference:()=>oX,Followsets:()=>dX,GenericRepost:()=>GE,Genericlists:()=>fX,GiftWrap:()=>pN,HTTPAuth:()=>ZE,Handlerinformation:()=>RX,Handlerrecommendation:()=>NX,Highlights:()=>GQ,InterestsList:()=>rX,Interestsets:()=>bX,JobFeedback:()=>WQ,JobRequest:()=>HQ,JobResult:()=>VQ,Label:()=>zQ,LightningPubRPC:()=>lX,LiveChatMessage:()=>LQ,LiveEvent:()=>TX,LongFormArticle:()=>xX,Metadata:()=>AQ,Mutelist:()=>ZQ,NWCWalletInfo:()=>aX,NWCWalletRequest:()=>gN,NWCWalletResponse:()=>cX,NostrConnect:()=>uX,OpenTimestamps:()=>RQ,Pinlist:()=>QQ,PrivateDirectMessage:()=>lN,ProblemTracker:()=>BQ,ProfileBadges:()=>gX,PublicChatsList:()=>eX,Reaction:()=>KE,RecommendRelay:()=>IQ,RelayList:()=>XQ,Relaysets:()=>hX,Report:()=>FQ,Reporting:()=>$Q,Repost:()=>qE,Seal:()=>aN,SearchRelaysList:()=>nX,ShortTextNote:()=>oN,Time:()=>PX,UserEmojiList:()=>iX,UserStatuses:()=>_X,Zap:()=>KQ,ZapGoal:()=>jQ,ZapRequest:()=>qQ,classifyKind:()=>_Q,isAddressableKind:()=>jE,isEphemeralKind:()=>sN,isKind:()=>CQ,isRegularKind:()=>iN,isReplaceableKind:()=>WE});function iN(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function WE(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function sN(t){return 2e4<=t&&t<3e4}function jE(t){return 3e4<=t&&t<4e4}function _Q(t){return iN(t)?"regular":WE(t)?"replaceable":sN(t)?"ephemeral":jE(t)?"parameterized":"unknown"}function CQ(t,e){const n=e instanceof Array?e:[e];return UE(t)&&n.includes(t.kind)||!1}var AQ=0,oN=1,IQ=2,PQ=3,OQ=4,MQ=5,qE=6,KE=7,NQ=8,aN=13,lN=14,GE=16,cN=40,uN=41,dN=42,fN=43,hN=44,RQ=1040,pN=1059,DQ=1063,LQ=1311,BQ=1971,FQ=1984,$Q=1984,zQ=1985,UQ=4550,HQ=5999,VQ=6999,WQ=7e3,jQ=9041,qQ=9734,KQ=9735,GQ=9802,ZQ=1e4,QQ=10001,XQ=10002,YQ=10003,JQ=10004,eX=10005,tX=10006,nX=10007,rX=10015,iX=10030,sX=10050,oX=10096,aX=13194,lX=21e3,mN=22242,gN=23194,cX=23195,uX=24133,ZE=27235,dX=3e4,fX=30001,hX=30002,pX=30003,mX=30004,gX=30008,yX=30009,bX=30015,wX=30017,vX=30018,xX=30023,SX=30024,EX=30030,kX=30078,TX=30311,_X=30315,CX=30402,AX=30403,IX=31922,PX=31923,OX=31924,MX=31925,NX=31989,RX=31990,DX=34550,LX={};Bn(LX,{getHex64:()=>QE,getInt:()=>yN,getSubscriptionId:()=>BX,matchEventId:()=>FX,matchEventKind:()=>zX,matchEventPubkey:()=>$X});function QE(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function yN(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function BX(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function FX(t,e){return e===QE(t,"id")}function $X(t,e){return e===QE(t,"pubkey")}function zX(t,e){return e===yN(t,"kind")}var UX={};Bn(UX,{makeAuthEvent:()=>HX});function HX(t,e){return{kind:mN,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var VX;try{VX=WebSocket}catch{}var WX;try{WX=WebSocket}catch{}var Za={};Bn(Za,{BECH32_REGEX:()=>bN,Bech32MaxSize:()=>XE,NostrTypeGuard:()=>jX,decode:()=>kb,decodeNostrURI:()=>KX,encodeBytes:()=>_b,naddrEncode:()=>JX,neventEncode:()=>YX,noteEncode:()=>QX,nprofileEncode:()=>XX,npubEncode:()=>ZX,nsecEncode:()=>GX});var jX={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},XE=5e3,bN=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function qX(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function KX(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),kb(t)}catch{return{type:"invalid",data:null}}}function kb(t){let{prefix:e,words:n}=ff.decode(t,XE),r=new Uint8Array(ff.fromWords(n));switch(e){case"nprofile":{let i=_v(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:or(i[0][0]),relays:i[1]?i[1].map(s=>Na.decode(s)):[]}}}case"nevent":{let i=_v(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:or(i[0][0]),relays:i[1]?i[1].map(s=>Na.decode(s)):[],author:i[2]?.[0]?or(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(or(i[3][0]),16):void 0}}}case"naddr":{let i=_v(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Na.decode(i[0][0]),pubkey:or(i[2][0]),kind:parseInt(or(i[3][0]),16),relays:i[1]?i[1].map(s=>Na.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:or(r)};default:throw new Error(`unknown prefix ${e}`)}}function _v(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function GX(t){return _b("nsec",t)}function ZX(t){return _b("npub",Nu(t))}function QX(t){return _b("note",Nu(t))}function Tb(t,e){let n=ff.toWords(e);return ff.encode(t,n,XE)}function _b(t,e){return Tb(t,e)}function XX(t){let e=YE({0:[Nu(t.pubkey)],1:(t.relays||[]).map(n=>ro.encode(n))});return Tb("nprofile",e)}function YX(t){let e;t.kind!==void 0&&(e=qX(t.kind));let n=YE({0:[Nu(t.id)],1:(t.relays||[]).map(r=>ro.encode(r)),2:t.author?[Nu(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return Tb("nevent",n)}function JX(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=YE({0:[ro.encode(t.identifier)],1:(t.relays||[]).map(r=>ro.encode(r)),2:[Nu(t.pubkey)],3:[new Uint8Array(e)]});return Tb("naddr",n)}function YE(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)})}),wb(...e)}var eY={};Bn(eY,{decrypt:()=>tY,encrypt:()=>wN});function wN(t,e,n){const r=t instanceof Uint8Array?or(t):t,i=Lf.getSharedSecret(r,"02"+e),s=vN(i);let o=Uint8Array.from(U8(16)),a=ro.encode(n),l=X8(s,o).encrypt(a),c=jo.encode(new Uint8Array(l)),u=jo.encode(new Uint8Array(o.buffer));return`${c}?iv=${u}`}function tY(t,e,n){const r=t instanceof Uint8Array?or(t):t;let[i,s]=n.split("?iv="),o=Lf.getSharedSecret(r,"02"+e),a=vN(o),l=jo.decode(s),c=jo.decode(i),u=X8(a,l).decrypt(c);return Na.decode(u)}function vN(t){return t.slice(1,33)}var nY={};Bn(nY,{NIP05_REGEX:()=>JE,isNip05:()=>rY,isValid:()=>oY,queryProfile:()=>xN,searchDomain:()=>sY,useFetchImplementation:()=>iY});var JE=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,rY=t=>JE.test(t||""),Cb;try{Cb=fetch}catch{}function iY(t){Cb=t}async function sY(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Cb(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function xN(t){const e=t.match(JE);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Cb(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function oY(t,e){const n=await xN(e);return n?n.pubkey===t:!1}var aY={};Bn(aY,{parse:()=>lY});function lY(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,d={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=d;continue}if(c==="reply"){e.reply=d;continue}if(c==="mention"){e.mentions.push(d);continue}n?r=d:n=d,e.mentions.push(d);continue}if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),e.mentions.forEach(i=>{if(i.author){let s=e.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),e}var cY={};Bn(cY,{fetchRelayInformation:()=>dY,useFetchImplementation:()=>uY});var SN;try{SN=fetch}catch{}function uY(t){SN=t}async function dY(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var fY={};Bn(fY,{fastEventHash:()=>kN,getPow:()=>EN,minePow:()=>hY});function EN(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function hY(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=kN(r),EN(r.id)>=e)break}return r}function kN(t){return or(Wu(ro.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var pY={};Bn(pY,{unwrapEvent:()=>_Y,unwrapManyEvents:()=>CY,wrapEvent:()=>BN,wrapManyEvents:()=>TY});var mY={};Bn(mY,{createRumor:()=>NN,createSeal:()=>RN,createWrap:()=>DN,unwrapEvent:()=>ik,unwrapManyEvents:()=>LN,wrapEvent:()=>C0,wrapManyEvents:()=>EY});var gY={};Bn(gY,{decrypt:()=>rk,encrypt:()=>nk,getConversationKey:()=>ek,v2:()=>xY});var TN=1,_N=65535;function ek(t,e){const n=Lf.getSharedSecret(t,"02"+e).subarray(1,33);return hQ(Wu,n,"nip44-v2")}function CN(t,e){const n=pQ(Wu,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function tk(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function yY(t){if(!Number.isSafeInteger(t)||t<TN||t>_N)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function bY(t){const e=ro.encode(t),n=e.length,r=yY(n),i=new Uint8Array(tk(n)-n);return wb(r,e,i)}function wY(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<TN||e>_N||n.length!==e||t.length!==2+tk(e))throw new Error("invalid padding");return Na.decode(n)}function AN(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=wb(n,e);return xb(Wu,t,r)}function vY(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=jo.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function nk(t,e,n=U8(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=CN(e,n),o=bY(t),a=tN(r,i,o),l=AN(s,a,n);return jo.encode(wb(new Uint8Array([2]),n,a,l))}function rk(t,e){const{nonce:n,ciphertext:r,mac:i}=vY(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=CN(e,n),l=AN(a,r,n);if(!GZ(l,i))throw new Error("invalid MAC");const c=tN(s,o,r);return wY(c)}var xY={utils:{getConversationKey:ek,calcPaddedLen:tk},encrypt:nk,decrypt:rk},SY=2880*60,IN=()=>Math.round(Date.now()/1e3),PN=()=>Math.round(IN()-Math.random()*SY),ON=(t,e)=>ek(t,e),MN=(t,e,n)=>nk(JSON.stringify(t),ON(e,n)),DA=(t,e)=>JSON.parse(rk(t.content,ON(e,t.pubkey)));function NN(t,e){const n={created_at:IN(),content:"",tags:[],...t,pubkey:Eb(e)};return n.id=_g(n),n}function RN(t,e,n){return ea({kind:aN,content:MN(t,e,n),created_at:PN(),tags:[]},e)}function DN(t,e){const n=kQ();return ea({kind:pN,content:MN(t,n,e),created_at:PN(),tags:[["p",e]]},n)}function C0(t,e,n){const r=NN(t,e),i=RN(r,e,n);return DN(i,n)}function EY(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Eb(e),i=[C0(t,e,r)];return n.forEach(s=>{i.push(C0(t,e,s))}),i}function ik(t,e){const n=DA(t,e);return DA(n,e)}function LN(t,e){let n=[];return t.forEach(r=>{n.push(ik(r,e))}),n.sort((r,i)=>r.created_at-i.created_at),n}function kY(t,e,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:lN,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function BN(t,e,n,r,i){const s=kY(e,n,r,i);return C0(s,t,e.publicKey)}function TY(t,e,n,r,i){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Eb(t)},...e].map(o=>BN(t,o,n,r,i))}var _Y=ik,CY=LN,AY={};Bn(AY,{finishRepostEvent:()=>IY,getRepostedEvent:()=>PY,getRepostedEventPointer:()=>FN});function IY(t,e,n,r){let i;const s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===oN?i=qE:(i=GE,s.push(["k",String(e.kind)])),ea({kind:i,tags:s,content:t.content===""||e.tags?.find(o=>o[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function FN(t){if(![qE,GE].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function PY(t,{skipVerification:e}={}){const n=FN(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!VE(r)))return r}var OY={};Bn(OY,{NOSTR_URI_REGEX:()=>sk,parse:()=>NY,test:()=>MY});var sk=new RegExp(`nostr:(${bN.source})`);function MY(t){return typeof t=="string"&&new RegExp(`^${sk.source}$`).test(t)}function NY(t){const e=t.match(new RegExp(`^${sk.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:kb(e[1])}}var RY={};Bn(RY,{finishReactionEvent:()=>DY,getReactedEventPointer:()=>LY});function DY(t,e,n){const r=e.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return ea({...t,kind:KE,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function LY(t){if(t.kind!==KE)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var BY={};Bn(BY,{parse:()=>$Y});var FY=/\W/m,LA=/\W |\W$|$|,| /m;function*$Y(t){const e=t.length;let n=0,r=0;for(;r<e;){let i=t.indexOf(":",r);if(i===-1)break;if(t.substring(i-5,i)==="nostr"){const s=t.substring(i+60).match(FY),o=s?i+60+s.index:e;try{let a,{data:l,type:c}=kb(t.substring(i+1,o));switch(c){case"npub":a={pubkey:l};break;case"nsec":case"note":r=o+1;continue;default:a=l}n!==i-5&&(yield{type:"text",text:t.substring(n,i-5)}),yield{type:"reference",pointer:a},r=o,n=r;continue}catch{r=i+1;continue}}else if(t.substring(i-5,i)==="https"||t.substring(i-4,i)==="http"){const s=t.substring(i+4).match(LA),o=s?i+4+s.index:e,a=t[i-1]==="s"?5:4;try{let l=new URL(t.substring(i-a,o));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==i-a&&(yield{type:"text",text:t.substring(n,i-a)}),l.pathname.endsWith(".png")||l.pathname.endsWith(".jpg")||l.pathname.endsWith(".jpeg")||l.pathname.endsWith(".gif")||l.pathname.endsWith(".webp")){yield{type:"image",url:l.toString()},r=o,n=r;continue}if(l.pathname.endsWith(".mp4")||l.pathname.endsWith(".avi")||l.pathname.endsWith(".webm")||l.pathname.endsWith(".mkv")){yield{type:"video",url:l.toString()},r=o,n=r;continue}if(l.pathname.endsWith(".mp3")||l.pathname.endsWith(".aac")||l.pathname.endsWith(".ogg")||l.pathname.endsWith(".opus")){yield{type:"audio",url:l.toString()},r=o,n=r;continue}yield{type:"url",url:l.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else if(t.substring(i-3,i)==="wss"||t.substring(i-2,i)==="ws"){const s=t.substring(i+4).match(LA),o=s?i+4+s.index:e,a=t[i-1]==="s"?3:2;try{let l=new URL(t.substring(i-a,o));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==i-a&&(yield{type:"text",text:t.substring(n,i-a)}),yield{type:"relay",url:l.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else{r=i+1;continue}}n!==e&&(yield{type:"text",text:t.substring(n)})}var zY={};Bn(zY,{channelCreateEvent:()=>UY,channelHideMessageEvent:()=>WY,channelMessageEvent:()=>VY,channelMetadataEvent:()=>HY,channelMuteUserEvent:()=>jY});var UY=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return ea({kind:cN,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},HY=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return ea({kind:uN,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},VY=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),ea({kind:dN,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},WY=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return ea({kind:fN,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},jY=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return ea({kind:hN,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},qY={};Bn(qY,{EMOJI_SHORTCODE_REGEX:()=>$N,matchAll:()=>KY,regex:()=>ok,replaceAll:()=>GY});var $N=/:(\w+):/,ok=()=>new RegExp(`\\B${$N.source}\\B`,"g");function*KY(t){const e=t.matchAll(ok());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function GY(t,e){return t.replaceAll(ok(),(n,r)=>e({shortcode:n,name:r}))}var ZY={};Bn(ZY,{useFetchImplementation:()=>QY,validateGithub:()=>XY});var ak;try{ak=fetch}catch{}function QY(t){ak=t}async function XY(t,e,n){try{return await(await ak(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var YY={};Bn(YY,{makeNwcRequestEvent:()=>eJ,parseConnectionString:()=>JY});function JY(t){const{host:e,pathname:n,searchParams:r}=new URL(t),i=n||e,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function eJ(t,e,n){const i=wN(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:gN,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return ea(s,e)}var tJ={};Bn(tJ,{normalizeIdentifier:()=>nJ});function nJ(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var rJ={};Bn(rJ,{getSatoshisAmountFromBolt11:()=>cJ,getZapEndpoint:()=>sJ,makeZapReceipt:()=>lJ,makeZapRequest:()=>oJ,useFetchImplementation:()=>iJ,validateZapRequest:()=>aJ});var lk;try{lk=fetch}catch{}function iJ(t){lk=t}async function sJ(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=ff.decode(n,1e3),a=ff.fromWords(o);e=Na.decode(a)}else if(r){let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let s=await(await lk(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function oJ(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),WE(t.event.kind)){const n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(jE(t.event.kind)){let n=t.event.tags.find(([i,s])=>i==="d"&&s);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function aJ(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!UE(e))return"Zap request is not a valid Nostr event.";if(!VE(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function lJ({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}function cJ(t){if(t.length<50)return 0;t=t.substring(0,50);const e=t.lastIndexOf("1");if(e===-1)return 0;const n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const l=parseInt(r.substring(0,a));switch(i){case"m":return l*1e5;case"u":return l*100;case"n":return l/10;case"p":return l/1e4;default:return l*1e8}}var uJ={};Bn(uJ,{getToken:()=>dJ,hashPayload:()=>ck,unpackEventFromToken:()=>UN,validateEvent:()=>KN,validateEventKind:()=>VN,validateEventMethodTag:()=>jN,validateEventPayloadTag:()=>qN,validateEventTimestamp:()=>HN,validateEventUrlTag:()=>WN,validateToken:()=>fJ});var zN="Nostr ";async function dJ(t,e,n,r=!1,i){const s={kind:ZE,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",ck(i)]);const o=await n(s);return(r?zN:"")+jo.encode(ro.encode(JSON.stringify(o)))}async function fJ(t,e,n){const r=await UN(t).catch(s=>{throw s});return await KN(r,e,n).catch(s=>{throw s})}async function UN(t){if(!t)throw new Error("Missing token");t=t.replace(zN,"");const e=Na.decode(jo.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function HN(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function VN(t){return t.kind===ZE}function WN(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function jN(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function ck(t){const e=Wu(ro.encode(JSON.stringify(t)));return or(e)}function qN(t,e){const n=t.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=ck(e);return n.length>0&&n[1]===r}async function KN(t,e,n,r){if(!VE(t))throw new Error("Invalid nostr event, signature invalid");if(!VN(t))throw new Error("Invalid nostr event, kind invalid");if(!HN(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!WN(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!jN(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!qN(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function hJ(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t;let a,l,c;const u=async(f=!0)=>{await l,c?.()};async function d(){if("serviceWorker"in navigator){if(a=await ob(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-CwtvwXb3.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/ehagaki/sw.js",{scope:"/ehagaki/",type:"classic"})).catch(f=>{o?.(f)}),!a)return;c=()=>{a?.messageSkipWaiting()};{let f=!1;const h=()=>{f=!0,a?.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),n?.()};a.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"&&p.isExternal?h():!f&&r?.():p.isUpdate||r?.()}),a.addEventListener("waiting",h)}a.register({immediate:e}).then(f=>{s?s("/ehagaki/sw.js",f):i?.(f)}).catch(f=>{o?.(f)})}}return l=d(),u}function BA(t={}){const{immediate:e=!0,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t,a=Ts(!1),l=Ts(!1),c=hJ({immediate:e,onOfflineReady(){l.set(!0),r?.()},onNeedRefresh(){a.set(!0),n?.()},onRegistered:i,onRegisteredSW:s,onRegisterError:o});return{needRefresh:a,offlineReady:l,updateServiceWorker:c}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */function G(t){if(!t)throw new Error("Assertion failed.")}const uk=t=>{const e=(t%360+360)%360;if(e===0||e===90||e===180||e===270)return e;throw new Error(`Invalid rotation ${t}.`)},hr=t=>t&&t[t.length-1],hf=t=>t>=0&&t<2**32;class lr{constructor(e){this.bytes=e,this.pos=0}seekToByte(e){this.pos=8*e}readBit(){const e=Math.floor(this.pos/8),n=this.bytes[e]??0,r=7-(this.pos&7),i=(n&1<<r)>>r;return this.pos++,i}readBits(e){if(e===1)return this.readBit();let n=0;for(let r=0;r<e;r++)n<<=1,n|=this.readBit();return n}writeBits(e,n){const r=this.pos+e;for(let i=this.pos;i<r;i++){const s=Math.floor(i/8);let o=this.bytes[s];const a=7-(i&7);o&=~(1<<a),o|=(n&1<<r-i-1)>>r-i-1<<a,this.bytes[s]=o}this.pos=r}readAlignedByte(){if(this.pos%8!==0)throw new Error("Bitstream is not byte-aligned.");const e=this.pos/8,n=this.bytes[e]??0;return this.pos+=8,n}skipBits(e){this.pos+=e}getBitsLeft(){return this.bytes.length*8-this.pos}clone(){const e=new lr(this.bytes);return e.pos=this.pos,e}}const ct=t=>{let e=0;for(;t.readBits(1)===0&&e<32;)e++;if(e>=32)throw new Error("Invalid exponential-Golomb code.");return(1<<e)-1+t.readBits(e)},Vh=t=>{const e=ct(t);return(e&1)===0?-(e>>1):e+1>>1},Ho=t=>t.constructor===Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength),ti=t=>t.constructor===DataView?t:t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),Ps=new TextDecoder,Lo=new TextEncoder,dk=t=>Object.fromEntries(Object.entries(t).map(([e,n])=>[n,e])),lm={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},GN=dk(lm),cm={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pq:16,hlg:18},ZN=dk(cm),um={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},QN=dk(um),pJ=t=>!!t&&!!t.primaries&&!!t.transfer&&!!t.matrix&&t.fullRange!==void 0,Ab=t=>t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer||ArrayBuffer.isView(t);class Ff{constructor(){this.currentPromise=Promise.resolve()}async acquire(){let e;const n=new Promise(i=>{e=i}),r=this.currentPromise;return this.currentPromise=n,await r,e}}const FA=t=>[...t].map(e=>e.toString(16).padStart(2,"0")).join(""),$A=t=>(t=t>>1&1431655765|(t&1431655765)<<1,t=t>>2&858993459|(t&858993459)<<2,t=t>>4&252645135|(t&252645135)<<4,t=t>>8&16711935|(t&16711935)<<8,t=t>>16&65535|(t&65535)<<16,t>>>0),fk=(t,e,n)=>{let r=0,i=t.length-1,s=-1;for(;r<=i;){const o=r+i>>1,a=n(t[o]);a===e?(s=o,i=o-1):a<e?r=o+1:i=o-1}return s},Mn=(t,e,n)=>{let r=0,i=t.length-1,s=-1;for(;r<=i;){const o=r+(i-r+1)/2|0;n(t[o])<=e?(s=o,r=o+1):i=o-1}return s},zA=(t,e,n)=>{const r=Mn(t,n(e),n);t.splice(r+1,0,e)},Xr=()=>{let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}},XN=(t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n]))return t[n]},YN=(t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n]))return n;return-1},mJ=async function*(t){Symbol.iterator in t?yield*t[Symbol.iterator]():yield*t[Symbol.asyncIterator]()},gJ=t=>{if(!(Symbol.iterator in t)&&!(Symbol.asyncIterator in t))throw new TypeError("Argument must be an iterable or async iterable.")},Sc=t=>{throw new Error(`Unexpected value: ${t}`)},Ib=(t,e,n)=>{const r=t.getUint8(e),i=t.getUint8(e+1),s=t.getUint8(e+2);return n?r|i<<8|s<<16:r<<16|i<<8|s},yJ=(t,e,n)=>Ib(t,e,n)<<8>>8,JN=(t,e,n,r)=>{n=n>>>0,n=n&16777215,r?(t.setUint8(e,n&255),t.setUint8(e+1,n>>>8&255),t.setUint8(e+2,n>>>16&255)):(t.setUint8(e,n>>>16&255),t.setUint8(e+1,n>>>8&255),t.setUint8(e+2,n&255))},bJ=(t,e,n,r)=>{n=Or(n,-8388608,8388607),n<0&&(n=n+16777216&16777215),JN(t,e,n,r)},UA=(t,e)=>({async next(){const n=await t.next();return n.done?{value:void 0,done:!0}:{value:e(n.value),done:!1}},return(){return t.return()},throw(n){return t.throw(n)},[Symbol.asyncIterator](){return this}}),Or=(t,e,n)=>Math.max(e,Math.min(n,t)),Cs="und",A0=(t,e)=>{const n=10**e;return Math.round(t*n)/n},wJ=(t,e)=>Math.round(t/e)*e,vJ=t=>{let e=0;for(;t;)e++,t>>=1;return e},xJ=/^[a-z]{3}$/,Sp=t=>xJ.test(t),Ql=1e6*(1+Number.EPSILON),SJ=(t,e)=>{const n=t<0?-1:1;t=Math.abs(t);let r=0,i=1,s=1,o=0,a=t;for(;;){const l=Math.floor(a),c=l*s+r,u=l*o+i;if(u>e)return{numerator:n*s,denominator:o};if(r=s,i=o,s=c,o=u,a=1/(a-l),!isFinite(a))break}return{numerator:n*s,denominator:o}};class Pb{constructor(){this.currentPromise=Promise.resolve()}call(e){return this.currentPromise=this.currentPromise.then(e)}}let Cv=null;const Av=()=>{if(Cv!==null)return Cv;const t=!!(typeof navigator<"u"&&navigator.vendor?.match(/apple/i)&&!navigator.userAgent?.match(/crios/i)&&!navigator.userAgent?.match(/fxios/i)&&!navigator.userAgent?.match(/Opera|OPT\//));return Cv=t,t};let Iv=null;const Ep=()=>Iv!==null?Iv:Iv=typeof navigator<"u"&&navigator.userAgent?.includes("Firefox"),hd=(t,e)=>t!==-1?t:e,HA=(t,e,n,r)=>t<=r&&n<=e,eR=function*(t){for(const e in t){const n=t[e];n!==void 0&&(yield{key:e,value:n})}},EJ=t=>{const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},tR=()=>{Symbol.dispose??=Symbol("Symbol.dispose")},nR=t=>typeof t=="number"&&!Number.isNaN(t);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class zd{constructor(e,n){if(this.data=e,this.mimeType=n,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(typeof n!="string")throw new TypeError("mimeType must be a string.")}}class rR{constructor(e,n,r,i){if(this.data=e,this.mimeType=n,this.name=r,this.description=i,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(n!==void 0&&typeof n!="string")throw new TypeError("mimeType, when provided, must be a string.");if(r!==void 0&&typeof r!="string")throw new TypeError("name, when provided, must be a string.");if(i!==void 0&&typeof i!="string")throw new TypeError("description, when provided, must be a string.")}}const Xx=t=>{if(!t||typeof t!="object")throw new TypeError("tags must be an object.");if(t.title!==void 0&&typeof t.title!="string")throw new TypeError("tags.title, when provided, must be a string.");if(t.description!==void 0&&typeof t.description!="string")throw new TypeError("tags.description, when provided, must be a string.");if(t.artist!==void 0&&typeof t.artist!="string")throw new TypeError("tags.artist, when provided, must be a string.");if(t.album!==void 0&&typeof t.album!="string")throw new TypeError("tags.album, when provided, must be a string.");if(t.albumArtist!==void 0&&typeof t.albumArtist!="string")throw new TypeError("tags.albumArtist, when provided, must be a string.");if(t.trackNumber!==void 0&&(!Number.isInteger(t.trackNumber)||t.trackNumber<=0))throw new TypeError("tags.trackNumber, when provided, must be a positive integer.");if(t.tracksTotal!==void 0&&(!Number.isInteger(t.tracksTotal)||t.tracksTotal<=0))throw new TypeError("tags.tracksTotal, when provided, must be a positive integer.");if(t.discNumber!==void 0&&(!Number.isInteger(t.discNumber)||t.discNumber<=0))throw new TypeError("tags.discNumber, when provided, must be a positive integer.");if(t.discsTotal!==void 0&&(!Number.isInteger(t.discsTotal)||t.discsTotal<=0))throw new TypeError("tags.discsTotal, when provided, must be a positive integer.");if(t.genre!==void 0&&typeof t.genre!="string")throw new TypeError("tags.genre, when provided, must be a string.");if(t.date!==void 0&&(!(t.date instanceof Date)||Number.isNaN(t.date.getTime())))throw new TypeError("tags.date, when provided, must be a valid Date.");if(t.lyrics!==void 0&&typeof t.lyrics!="string")throw new TypeError("tags.lyrics, when provided, must be a string.");if(t.images!==void 0){if(!Array.isArray(t.images))throw new TypeError("tags.images, when provided, must be an array.");for(const e of t.images){if(!e||typeof e!="object")throw new TypeError("Each image in tags.images must be an object.");if(!(e.data instanceof Uint8Array))throw new TypeError("Each image.data must be a Uint8Array.");if(typeof e.mimeType!="string")throw new TypeError("Each image.mimeType must be a string.");if(!["coverFront","coverBack","unknown"].includes(e.kind))throw new TypeError("Each image.kind must be 'coverFront', 'coverBack', or 'unknown'.")}}if(t.comment!==void 0&&typeof t.comment!="string")throw new TypeError("tags.comment, when provided, must be a string.");if(t.raw!==void 0){if(!t.raw||typeof t.raw!="object")throw new TypeError("tags.raw, when provided, must be an object.");for(const e of Object.values(t.raw))if(e!==null&&typeof e!="string"&&!(e instanceof Uint8Array)&&!(e instanceof zd)&&!(e instanceof rR))throw new TypeError("Each value in tags.raw must be a string, Uint8Array, RichImageData, AttachedFile, or null.")}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const qo=["avc","hevc","vp9","av1","vp8"],xi=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],Wh=["aac","opus","mp3","vorbis","flac"],Ko=[...Wh,...xi],I0=["webvtt"],VA=[{maxMacroblocks:99,maxBitrate:64e3,level:10},{maxMacroblocks:396,maxBitrate:192e3,level:11},{maxMacroblocks:396,maxBitrate:384e3,level:12},{maxMacroblocks:396,maxBitrate:768e3,level:13},{maxMacroblocks:396,maxBitrate:2e6,level:20},{maxMacroblocks:792,maxBitrate:4e6,level:21},{maxMacroblocks:1620,maxBitrate:4e6,level:22},{maxMacroblocks:1620,maxBitrate:1e7,level:30},{maxMacroblocks:3600,maxBitrate:14e6,level:31},{maxMacroblocks:5120,maxBitrate:2e7,level:32},{maxMacroblocks:8192,maxBitrate:2e7,level:40},{maxMacroblocks:8192,maxBitrate:5e7,level:41},{maxMacroblocks:8704,maxBitrate:5e7,level:42},{maxMacroblocks:22080,maxBitrate:135e6,level:50},{maxMacroblocks:36864,maxBitrate:24e7,level:51},{maxMacroblocks:36864,maxBitrate:24e7,level:52},{maxMacroblocks:139264,maxBitrate:24e7,level:60},{maxMacroblocks:139264,maxBitrate:48e7,level:61},{maxMacroblocks:139264,maxBitrate:8e8,level:62}],WA=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:35651584,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:35651584,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:35651584,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:186}],Xl=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:35651584,maxBitrate:18e7,level:60},{maxPictureSize:35651584,maxBitrate:24e7,level:61},{maxPictureSize:35651584,maxBitrate:48e7,level:62}],jA=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:35651584,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:19}],qA=".01.01.01.01.00",KA=".0.110.01.01.01.0",kJ=(t,e,n,r)=>{if(t==="avc"){const s=Math.ceil(e/16)*Math.ceil(n/16),o=VA.find(d=>s<=d.maxMacroblocks&&r<=d.maxBitrate)??hr(VA),a=o?o.level:0,l="64".padStart(2,"0"),c="00",u=a.toString(16).padStart(2,"0");return`avc1.${l}${c}${u}`}else if(t==="hevc"){const a=e*n,l=WA.find(u=>a<=u.maxPictureSize&&r<=u.maxBitrate)??hr(WA);return`hev1.1.6.${l.tier}${l.level}.B0`}else{if(t==="vp8")return"vp8";if(t==="vp9"){const s=e*n;return`vp09.00.${(Xl.find(l=>s<=l.maxPictureSize&&r<=l.maxBitrate)??hr(Xl)).level.toString().padStart(2,"0")}.08`}else if(t==="av1"){const s=e*n,o=jA.find(c=>s<=c.maxPictureSize&&r<=c.maxBitrate)??hr(jA);return`av01.0.${o.level.toString().padStart(2,"0")}${o.tier}.08`}}throw new TypeError(`Unhandled codec '${t}'.`)},TJ=t=>{const e=t.split("."),i=(1<<7)+1,s=Number(e[1]),o=e[2],a=Number(o.slice(0,-1)),l=(s<<5)+a,c=o.slice(-1)==="H"?1:0,d=Number(e[3])===8?0:1,f=0,h=e[4]?Number(e[4]):0,p=e[5]?Number(e[5][0]):1,m=e[5]?Number(e[5][1]):1,g=e[5]?Number(e[5][2]):0,y=(c<<7)+(d<<6)+(f<<5)+(h<<4)+(p<<3)+(m<<2)+g;return[i,l,y,0]},iR=t=>{const{codec:e,codecDescription:n,colorSpace:r,avcCodecInfo:i,hevcCodecInfo:s,vp9CodecInfo:o,av1CodecInfo:a}=t;if(e==="avc"){if(i){const l=new Uint8Array([i.avcProfileIndication,i.profileCompatibility,i.avcLevelIndication]);return`avc1.${FA(l)}`}if(!n||n.byteLength<4)throw new TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return`avc1.${FA(n.subarray(1,4))}`}else if(e==="hevc"){let l,c,u,d,f,h;if(s)l=s.generalProfileSpace,c=s.generalProfileIdc,u=$A(s.generalProfileCompatibilityFlags),d=s.generalTierFlag,f=s.generalLevelIdc,h=[...s.generalConstraintIndicatorFlags];else{if(!n||n.byteLength<23)throw new TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");const m=ti(n),g=m.getUint8(1);l=g>>6&3,c=g&31,u=$A(m.getUint32(2)),d=g>>5&1,f=m.getUint8(12),h=[];for(let y=0;y<6;y++)h.push(m.getUint8(6+y))}let p="hev1.";for(p+=["","A","B","C"][l]+c,p+=".",p+=u.toString(16).toUpperCase(),p+=".",p+=d===0?"L":"H",p+=f;h.length>0&&h[h.length-1]===0;)h.pop();return h.length>0&&(p+=".",p+=h.map(m=>m.toString(16).toUpperCase()).join(".")),p}else{if(e==="vp8")return"vp8";if(e==="vp9"){if(!o){const y=t.width*t.height;let b=hr(Xl).level;for(const E of Xl)if(y<=E.maxPictureSize){b=E.level;break}return`vp09.00.${b.toString().padStart(2,"0")}.08`}const l=o.profile.toString().padStart(2,"0"),c=o.level.toString().padStart(2,"0"),u=o.bitDepth.toString().padStart(2,"0"),d=o.chromaSubsampling.toString().padStart(2,"0"),f=o.colourPrimaries.toString().padStart(2,"0"),h=o.transferCharacteristics.toString().padStart(2,"0"),p=o.matrixCoefficients.toString().padStart(2,"0"),m=o.videoFullRangeFlag.toString().padStart(2,"0");let g=`vp09.${l}.${c}.${u}.${d}`;return g+=`.${f}.${h}.${p}.${m}`,g.endsWith(qA)&&(g=g.slice(0,-qA.length)),g}else if(e==="av1"){if(!a){const E=t.width*t.height;let C=hr(Xl).level;for(const I of Xl)if(E<=I.maxPictureSize){C=I.level;break}return`av01.0.${C.toString().padStart(2,"0")}M.08`}const l=a.profile,c=a.level.toString().padStart(2,"0"),u=a.tier?"H":"M",d=a.bitDepth.toString().padStart(2,"0"),f=a.monochrome?"1":"0",h=100*a.chromaSubsamplingX+10*a.chromaSubsamplingY+1*(a.chromaSubsamplingX&&a.chromaSubsamplingY?a.chromaSamplePosition:0),p=r?.primaries?lm[r.primaries]:1,m=r?.transfer?cm[r.transfer]:1,g=r?.matrix?um[r.matrix]:1,y=r?.fullRange?1:0;let b=`av01.${l}.${c}${u}.${d}`;return b+=`.${f}.${h.toString().padStart(3,"0")}`,b+=`.${p.toString().padStart(2,"0")}`,b+=`.${m.toString().padStart(2,"0")}`,b+=`.${g.toString().padStart(2,"0")}`,b+=`.${y}`,b.endsWith(KA)&&(b=b.slice(0,-KA.length)),b}}throw new TypeError(`Unhandled codec '${e}'.`)},_J=(t,e,n)=>{if(t==="aac")return e>=2&&n<=24e3?"mp4a.40.29":n<=24e3?"mp4a.40.5":"mp4a.40.2";if(t==="mp3")return"mp3";if(t==="opus")return"opus";if(t==="vorbis")return"vorbis";if(t==="flac")return"flac";if(xi.includes(t))return t;throw new TypeError(`Unhandled codec '${t}'.`)},sR=t=>{const{codec:e,codecDescription:n,aacCodecInfo:r}=t;if(e==="aac"){if(!r)throw new TypeError("AAC codec info must be provided.");return r.isMpeg2?"mp4a.67":`mp4a.40.${aR(n).objectType}`}else{if(e==="mp3")return"mp3";if(e==="opus")return"opus";if(e==="vorbis")return"vorbis";if(e==="flac")return"flac";if(e&&xi.includes(e))return e}throw new TypeError(`Unhandled codec '${e}'.`)},P0=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],oR=[-1,1,2,3,4,5,6,8],aR=t=>{if(!t||t.byteLength<2)throw new TypeError("AAC description must be at least 2 bytes long.");const e=new lr(t);let n=e.readBits(5);n===31&&(n=32+e.readBits(6));const r=e.readBits(4);let i=null;r===15?i=e.readBits(24):r<P0.length&&(i=P0[r]);const s=e.readBits(4);let o=null;return s>=1&&s<=7&&(o=oR[s]),{objectType:n,frequencyIndex:r,sampleRate:i,channelConfiguration:s,numberOfChannels:o}},Ob=48e3,lR=/^pcm-([usf])(\d+)+(be)?$/,Rc=t=>{if(G(xi.includes(t)),t==="ulaw")return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if(t==="alaw")return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};const e=lR.exec(t);G(e);let n;e[1]==="u"?n="unsigned":e[1]==="s"?n="signed":n="float";const r=Number(e[2])/8,i=e[3]!=="be",s=t==="pcm-u8"?2**7:0;return{dataType:n,sampleSize:r,littleEndian:i,silentValue:s}},cR=t=>t.startsWith("avc1")||t.startsWith("avc3")?"avc":t.startsWith("hev1")||t.startsWith("hvc1")?"hevc":t==="vp8"?"vp8":t.startsWith("vp09")?"vp9":t.startsWith("av01")?"av1":t.startsWith("mp4a.40")||t==="mp4a.67"?"aac":t==="mp3"||t==="mp4a.69"||t==="mp4a.6B"||t==="mp4a.6b"?"mp3":t==="opus"?"opus":t==="vorbis"?"vorbis":t==="flac"?"flac":t==="ulaw"?"ulaw":t==="alaw"?"alaw":lR.test(t)?t:t==="webvtt"?"webvtt":null,CJ=t=>t==="avc"?{avc:{format:"avc"}}:t==="hevc"?{hevc:{format:"hevc"}}:{},AJ=t=>t==="aac"?{aac:{format:"aac"}}:t==="opus"?{opus:{format:"opus"}}:{},IJ=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],PJ=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,OJ=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,MJ=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,NJ=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,RJ=t=>{if(!t)throw new TypeError("Video chunk metadata must be provided.");if(typeof t!="object")throw new TypeError("Video chunk metadata must be an object.");if(!t.decoderConfig)throw new TypeError("Video chunk metadata must include a decoder configuration.");if(typeof t.decoderConfig!="object")throw new TypeError("Video chunk metadata decoder configuration must be an object.");if(typeof t.decoderConfig.codec!="string")throw new TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!IJ.some(e=>t.decoderConfig.codec.startsWith(e)))throw new TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(t.decoderConfig.codedWidth)||t.decoderConfig.codedWidth<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(t.decoderConfig.codedHeight)||t.decoderConfig.codedHeight<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(t.decoderConfig.description!==void 0&&!Ab(t.decoderConfig.description))throw new TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(t.decoderConfig.colorSpace!==void 0){const{colorSpace:e}=t.decoderConfig;if(typeof e!="object")throw new TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");const n=Object.keys(lm);if(e.primaries!=null&&!n.includes(e.primaries))throw new TypeError(`Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of ${n.join(", ")}.`);const r=Object.keys(cm);if(e.transfer!=null&&!r.includes(e.transfer))throw new TypeError(`Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of ${r.join(", ")}.`);const i=Object.keys(um);if(e.matrix!=null&&!i.includes(e.matrix))throw new TypeError(`Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of ${i.join(", ")}.`);if(e.fullRange!=null&&typeof e.fullRange!="boolean")throw new TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(t.decoderConfig.codec.startsWith("avc1")||t.decoderConfig.codec.startsWith("avc3")){if(!PJ.test(t.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(t.decoderConfig.codec.startsWith("hev1")||t.decoderConfig.codec.startsWith("hvc1")){if(!OJ.test(t.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(t.decoderConfig.codec.startsWith("vp8")){if(t.decoderConfig.codec!=="vp8")throw new TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(t.decoderConfig.codec.startsWith("vp09")){if(!MJ.test(t.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(t.decoderConfig.codec.startsWith("av01")&&!NJ.test(t.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},DJ=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],LJ=t=>{if(!t)throw new TypeError("Audio chunk metadata must be provided.");if(typeof t!="object")throw new TypeError("Audio chunk metadata must be an object.");if(!t.decoderConfig)throw new TypeError("Audio chunk metadata must include a decoder configuration.");if(typeof t.decoderConfig!="object")throw new TypeError("Audio chunk metadata decoder configuration must be an object.");if(typeof t.decoderConfig.codec!="string")throw new TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!DJ.some(e=>t.decoderConfig.codec.startsWith(e)))throw new TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(t.decoderConfig.sampleRate)||t.decoderConfig.sampleRate<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(t.decoderConfig.numberOfChannels)||t.decoderConfig.numberOfChannels<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(t.decoderConfig.description!==void 0&&!Ab(t.decoderConfig.description))throw new TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(t.decoderConfig.codec.startsWith("mp4a")&&t.decoderConfig.codec!=="mp4a.69"&&t.decoderConfig.codec!=="mp4a.6B"&&t.decoderConfig.codec!=="mp4a.6b"){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(t.decoderConfig.codec))throw new TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.");if(!t.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for AAC must include a description, which is expected to be an AudioSpecificConfig as specified in ISO 14496-3.")}else if(t.decoderConfig.codec.startsWith("mp3")||t.decoderConfig.codec.startsWith("mp4a")){if(t.decoderConfig.codec!=="mp3"&&t.decoderConfig.codec!=="mp4a.69"&&t.decoderConfig.codec!=="mp4a.6B"&&t.decoderConfig.codec!=="mp4a.6b")throw new TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(t.decoderConfig.codec.startsWith("opus")){if(t.decoderConfig.codec!=="opus")throw new TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(t.decoderConfig.description&&t.decoderConfig.description.byteLength<18)throw new TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(t.decoderConfig.codec.startsWith("vorbis")){if(t.decoderConfig.codec!=="vorbis")throw new TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!t.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(t.decoderConfig.codec.startsWith("flac")){if(t.decoderConfig.codec!=="flac")throw new TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');if(!t.decoderConfig.description||t.decoderConfig.description.byteLength<42)throw new TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((t.decoderConfig.codec.startsWith("pcm")||t.decoderConfig.codec.startsWith("ulaw")||t.decoderConfig.codec.startsWith("alaw"))&&!xi.includes(t.decoderConfig.codec))throw new TypeError(`Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM codecs (${xi.join(", ")}).`)},BJ=t=>{if(!t)throw new TypeError("Subtitle metadata must be provided.");if(typeof t!="object")throw new TypeError("Subtitle metadata must be an object.");if(!t.config)throw new TypeError("Subtitle metadata must include a config object.");if(typeof t.config!="object")throw new TypeError("Subtitle metadata config must be an object.");if(typeof t.config.description!="string")throw new TypeError("Subtitle metadata config description must be a string.")};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class FJ{constructor(e){this.mutex=new Ff,this.firstMediaStreamTimestamp=null,this.trackTimestampInfo=new WeakMap,this.output=e}onTrackClose(e){}validateAndNormalizeTimestamp(e,n,r){n+=e.source._timestampOffset;let i=this.trackTimestampInfo.get(e);if(!i){if(!r)throw new Error("First frame must be a key frame.");i={maxTimestamp:n,maxTimestampBeforeLastKeyFrame:n},this.trackTimestampInfo.set(e,i)}if(n<0)throw new Error(`Timestamps must be non-negative (got ${n}s).`);if(r&&(i.maxTimestampBeforeLastKeyFrame=i.maxTimestamp),n<i.maxTimestampBeforeLastKeyFrame)throw new Error(`Timestamps cannot be smaller than the highest timestamp of the previous GOP (a GOP begins with a key frame and ends right before the next key frame). Got ${n}s, but highest timestamp is ${i.maxTimestampBeforeLastKeyFrame}s.`);return i.maxTimestamp=Math.max(i.maxTimestamp,n),n}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var Ud;(function(t){t[t.IDR=5]="IDR",t[t.SPS=7]="SPS",t[t.PPS=8]="PPS",t[t.SPS_EXT=13]="SPS_EXT"})(Ud||(Ud={}));var Li;(function(t){t[t.RASL_N=8]="RASL_N",t[t.RASL_R=9]="RASL_R",t[t.BLA_W_LP=16]="BLA_W_LP",t[t.RSV_IRAP_VCL23=23]="RSV_IRAP_VCL23",t[t.VPS_NUT=32]="VPS_NUT",t[t.SPS_NUT=33]="SPS_NUT",t[t.PPS_NUT=34]="PPS_NUT",t[t.PREFIX_SEI_NUT=39]="PREFIX_SEI_NUT",t[t.SUFFIX_SEI_NUT=40]="SUFFIX_SEI_NUT"})(Li||(Li={}));const dm=t=>{const e=[];let n=0;for(;n<t.length;){let r=-1,i=0;for(let s=n;s<t.length-3;s++){if(t[s]===0&&t[s+1]===0&&t[s+2]===1){r=s,i=3;break}if(s<t.length-4&&t[s]===0&&t[s+1]===0&&t[s+2]===0&&t[s+3]===1){r=s,i=4;break}}if(r===-1)break;if(n>0&&r>n){const s=t.subarray(n,r);s.length>0&&e.push(s)}n=r+i}if(n<t.length){const r=t.subarray(n);r.length>0&&e.push(r)}return e},uR=(t,e)=>{const n=[];let r=0;const i=new DataView(t.buffer,t.byteOffset,t.byteLength);for(;r+e<=t.length;){let s;e===1?s=i.getUint8(r):e===2?s=i.getUint16(r,!1):e===3?s=Ib(i,r,!1):e===4?s=i.getUint32(r,!1):(Sc(e),G(!1)),r+=e;const o=t.subarray(r,r+s);n.push(o),r+=s}return n},Yx=t=>{const e=[],n=t.length;for(let r=0;r<n;r++)r+2<n&&t[r]===0&&t[r+1]===0&&t[r+2]===3?(e.push(0,0),r+=2):e.push(t[r]);return new Uint8Array(e)},$J=t=>{const n=dm(t);if(n.length===0)return null;let r=0;for(const a of n)r+=4+a.byteLength;const i=new Uint8Array(r),s=new DataView(i.buffer);let o=0;for(const a of n){const l=a.byteLength;s.setUint32(o,l,!1),o+=4,i.set(a,o),o+=a.byteLength}return i},zJ=(t,e)=>{if(e.description){const i=(Ho(e.description)[4]&3)+1;return uR(t,i)}else return dm(t)},Cg=t=>t[0]&31,dR=t=>{try{const e=dm(t),n=e.filter(f=>Cg(f)===Ud.SPS),r=e.filter(f=>Cg(f)===Ud.PPS),i=e.filter(f=>Cg(f)===Ud.SPS_EXT);if(n.length===0||r.length===0)return null;const s=n[0],o=new lr(Yx(s));if(o.skipBits(1),o.skipBits(2),o.readBits(5)!==7)return console.error("Invalid SPS NAL unit type"),null;const l=o.readAlignedByte(),c=o.readAlignedByte(),u=o.readAlignedByte(),d={configurationVersion:1,avcProfileIndication:l,profileCompatibility:c,avcLevelIndication:u,lengthSizeMinusOne:3,sequenceParameterSets:n,pictureParameterSets:r,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if(l===100||l===110||l===122||l===144){ct(o);const f=ct(o);f===3&&o.skipBits(1);const h=ct(o),p=ct(o);d.chromaFormat=f,d.bitDepthLumaMinus8=h,d.bitDepthChromaMinus8=p,d.sequenceParameterSetExt=i}return d}catch(e){return console.error("Error building AVC Decoder Configuration Record:",e),null}},UJ=t=>{const e=[];e.push(t.configurationVersion),e.push(t.avcProfileIndication),e.push(t.profileCompatibility),e.push(t.avcLevelIndication),e.push(252|t.lengthSizeMinusOne&3),e.push(224|t.sequenceParameterSets.length&31);for(const n of t.sequenceParameterSets){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}e.push(t.pictureParameterSets.length);for(const n of t.pictureParameterSets){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}if(t.avcProfileIndication===100||t.avcProfileIndication===110||t.avcProfileIndication===122||t.avcProfileIndication===144){G(t.chromaFormat!==null),G(t.bitDepthLumaMinus8!==null),G(t.bitDepthChromaMinus8!==null),G(t.sequenceParameterSetExt!==null),e.push(252|t.chromaFormat&3),e.push(248|t.bitDepthLumaMinus8&7),e.push(248|t.bitDepthChromaMinus8&7),e.push(t.sequenceParameterSetExt.length);for(const n of t.sequenceParameterSetExt){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}}return new Uint8Array(e)},fR=(t,e)=>{if(e.description){const i=(Ho(e.description)[21]&3)+1;return uR(t,i)}else return dm(t)},Ll=t=>t[0]>>1&63,hR=t=>{try{const e=dm(t),n=e.filter(_=>Ll(_)===Li.VPS_NUT),r=e.filter(_=>Ll(_)===Li.SPS_NUT),i=e.filter(_=>Ll(_)===Li.PPS_NUT),s=e.filter(_=>Ll(_)===Li.PREFIX_SEI_NUT||Ll(_)===Li.SUFFIX_SEI_NUT);if(r.length===0||i.length===0)return null;const o=r[0],a=new lr(Yx(o));a.skipBits(16),a.readBits(4);const l=a.readBits(3),c=a.readBits(1),{general_profile_space:u,general_tier_flag:d,general_profile_idc:f,general_profile_compatibility_flags:h,general_constraint_indicator_flags:p,general_level_idc:m}=HJ(a,l);ct(a);const g=ct(a);g===3&&a.skipBits(1),ct(a),ct(a),a.readBits(1)&&(ct(a),ct(a),ct(a),ct(a));const y=ct(a),b=ct(a);ct(a);const C=a.readBits(1)?0:l;for(let _=C;_<=l;_++)ct(a),ct(a),ct(a);ct(a),ct(a),ct(a),ct(a),ct(a),ct(a),a.readBits(1)&&a.readBits(1)&&VJ(a),a.skipBits(1),a.skipBits(1),a.readBits(1)&&(a.skipBits(4),a.skipBits(4),ct(a),ct(a),a.skipBits(1));const I=ct(a);if(WJ(a,I),a.readBits(1)){const _=ct(a);for(let O=0;O<_;O++)ct(a),a.skipBits(1)}a.skipBits(1),a.skipBits(1);let x=0;a.readBits(1)&&(x=qJ(a,l));let P=0;if(i.length>0){const _=i[0],O=new lr(Yx(_));O.skipBits(16),ct(O),ct(O),O.skipBits(1),O.skipBits(1),O.skipBits(3),O.skipBits(1),O.skipBits(1),ct(O),ct(O),Vh(O),O.skipBits(1),O.skipBits(1),O.readBits(1)&&ct(O),Vh(O),Vh(O),O.skipBits(1),O.skipBits(1),O.skipBits(1),O.skipBits(1);const F=O.readBits(1),L=O.readBits(1);!F&&!L?P=0:F&&!L?P=2:!F&&L?P=3:P=0}const T=[...n.length?[{arrayCompleteness:1,nalUnitType:Li.VPS_NUT,nalUnits:n}]:[],...r.length?[{arrayCompleteness:1,nalUnitType:Li.SPS_NUT,nalUnits:r}]:[],...i.length?[{arrayCompleteness:1,nalUnitType:Li.PPS_NUT,nalUnits:i}]:[],...s.length?[{arrayCompleteness:1,nalUnitType:Ll(s[0]),nalUnits:s}]:[]];return{configurationVersion:1,generalProfileSpace:u,generalTierFlag:d,generalProfileIdc:f,generalProfileCompatibilityFlags:h,generalConstraintIndicatorFlags:p,generalLevelIdc:m,minSpatialSegmentationIdc:x,parallelismType:P,chromaFormatIdc:g,bitDepthLumaMinus8:y,bitDepthChromaMinus8:b,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:l+1,temporalIdNested:c,lengthSizeMinusOne:3,arrays:T}}catch(e){return console.error("Error building HEVC Decoder Configuration Record:",e),null}},HJ=(t,e)=>{const n=t.readBits(2),r=t.readBits(1),i=t.readBits(5);let s=0;for(let u=0;u<32;u++)s=s<<1|t.readBits(1);const o=new Uint8Array(6);for(let u=0;u<6;u++)o[u]=t.readBits(8);const a=t.readBits(8),l=[],c=[];for(let u=0;u<e;u++)l.push(t.readBits(1)),c.push(t.readBits(1));if(e>0)for(let u=e;u<8;u++)t.skipBits(2);for(let u=0;u<e;u++)l[u]&&t.skipBits(88),c[u]&&t.skipBits(8);return{general_profile_space:n,general_tier_flag:r,general_profile_idc:i,general_profile_compatibility_flags:s,general_constraint_indicator_flags:o,general_level_idc:a}},VJ=t=>{for(let e=0;e<4;e++)for(let n=0;n<(e===3?2:6);n++)if(!t.readBits(1))ct(t);else{const i=Math.min(64,1<<4+(e<<1));e>1&&Vh(t);for(let s=0;s<i;s++)Vh(t)}},WJ=(t,e)=>{const n=[];for(let r=0;r<e;r++)n[r]=jJ(t,r,e,n)},jJ=(t,e,n,r)=>{let i=0,s=0,o=0;if(e!==0&&(s=t.readBits(1)),s){if(e===n){const l=ct(t);o=e-(l+1)}else o=e-1;t.readBits(1),ct(t);const a=r[o]??0;for(let l=0;l<=a;l++)t.readBits(1)||t.readBits(1);i=r[o]}else{const a=ct(t),l=ct(t);for(let c=0;c<a;c++)ct(t),t.readBits(1);for(let c=0;c<l;c++)ct(t),t.readBits(1);i=a+l}return i},qJ=(t,e)=>{if(t.readBits(1)&&t.readBits(8)===255&&(t.readBits(16),t.readBits(16)),t.readBits(1)&&t.readBits(1),t.readBits(1)&&(t.readBits(3),t.readBits(1),t.readBits(1)&&(t.readBits(8),t.readBits(8),t.readBits(8))),t.readBits(1)&&(ct(t),ct(t)),t.readBits(1),t.readBits(1),t.readBits(1),t.readBits(1)&&(ct(t),ct(t),ct(t),ct(t)),t.readBits(1)&&(t.readBits(32),t.readBits(32),t.readBits(1)&&ct(t),t.readBits(1)&&KJ(t,!0,e)),t.readBits(1)){t.readBits(1),t.readBits(1),t.readBits(1);const n=ct(t);return ct(t),ct(t),ct(t),ct(t),n}return 0},KJ=(t,e,n)=>{let r=!1,i=!1,s=!1;r=t.readBits(1)===1,i=t.readBits(1)===1,(r||i)&&(s=t.readBits(1)===1,s&&(t.readBits(8),t.readBits(5),t.readBits(1),t.readBits(5)),t.readBits(4),t.readBits(4),s&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let o=0;o<=n;o++){const a=t.readBits(1)===1;let l=!0;a||(l=t.readBits(1)===1);let c=!1;l?ct(t):c=t.readBits(1)===1;let u=1;c||(u=ct(t)+1),r&&GA(t,u,s),i&&GA(t,u,s)}},GA=(t,e,n)=>{for(let r=0;r<e;r++)ct(t),ct(t),n&&(ct(t),ct(t)),t.readBits(1)},GJ=t=>{const e=[];e.push(t.configurationVersion),e.push((t.generalProfileSpace&3)<<6|(t.generalTierFlag&1)<<5|t.generalProfileIdc&31),e.push(t.generalProfileCompatibilityFlags>>>24&255),e.push(t.generalProfileCompatibilityFlags>>>16&255),e.push(t.generalProfileCompatibilityFlags>>>8&255),e.push(t.generalProfileCompatibilityFlags&255),e.push(...t.generalConstraintIndicatorFlags),e.push(t.generalLevelIdc&255),e.push(240|t.minSpatialSegmentationIdc>>8&15),e.push(t.minSpatialSegmentationIdc&255),e.push(252|t.parallelismType&3),e.push(252|t.chromaFormatIdc&3),e.push(248|t.bitDepthLumaMinus8&7),e.push(248|t.bitDepthChromaMinus8&7),e.push(t.avgFrameRate>>8&255),e.push(t.avgFrameRate&255),e.push((t.constantFrameRate&3)<<6|(t.numTemporalLayers&7)<<3|(t.temporalIdNested&1)<<2|t.lengthSizeMinusOne&3),e.push(t.arrays.length&255);for(const n of t.arrays){e.push((n.arrayCompleteness&1)<<7|0|n.nalUnitType&63),e.push(n.nalUnits.length>>8&255),e.push(n.nalUnits.length&255);for(const r of n.nalUnits){e.push(r.length>>8&255),e.push(r.length&255);for(let i=0;i<r.length;i++)e.push(r[i])}}return new Uint8Array(e)},pR=t=>{const e=new lr(t);if(e.readBits(2)!==2)return null;const r=e.readBits(1),s=(e.readBits(1)<<1)+r;if(s===3&&e.skipBits(1),e.readBits(1)===1||e.readBits(1)!==0||(e.skipBits(2),e.readBits(24)!==4817730))return null;let c=8;s>=2&&(c=e.readBits(1)?12:10);const u=e.readBits(3);let d=0,f=0;if(u!==7)if(f=e.readBits(1),s===1||s===3){const P=e.readBits(1),T=e.readBits(1);d=!P&&!T?3:P&&!T?2:1,e.skipBits(1)}else d=1;else d=3,f=1;const h=e.readBits(16),p=e.readBits(16),m=h+1,g=p+1,y=m*g;let b=hr(Xl).level;for(const x of Xl)if(y<=x.maxPictureSize){b=x.level;break}return{profile:s,level:b,bitDepth:c,chromaSubsampling:d,videoFullRangeFlag:f,colourPrimaries:u===2?1:u===1?6:2,transferCharacteristics:u===2?1:u===1?6:2,matrixCoefficients:u===7?0:u===2?1:u===1?6:2}},mR=function*(t){const e=new lr(t),n=()=>{let r=0;for(let i=0;i<8;i++){const s=e.readAlignedByte();if(r|=(s&127)<<i*7,!(s&128))break;if(i===7&&s&128)return null}return r>=2**32-1?null:r};for(;e.getBitsLeft()>=8;){e.skipBits(1);const r=e.readBits(4),i=e.readBits(1),s=e.readBits(1);e.skipBits(1),i&&e.skipBits(8);let o;if(s){const a=n();if(a===null)return;o=a}else o=Math.floor(e.getBitsLeft()/8);G(e.pos%8===0),yield{type:r,data:t.subarray(e.pos/8,e.pos/8+o)},e.skipBits(o*8)}},gR=t=>{for(const{type:e,data:n}of mR(t)){if(e!==1)continue;const r=new lr(n),i=r.readBits(3);r.readBits(1);const s=r.readBits(1);let o=0,a=0,l=0;if(s)o=r.readBits(5);else{if(r.readBits(1)&&(r.skipBits(32),r.skipBits(32),r.readBits(1)))return null;const g=r.readBits(1);g&&(l=r.readBits(5),r.skipBits(32),r.skipBits(5),r.skipBits(5));const y=r.readBits(5);for(let b=0;b<=y;b++){r.skipBits(12);const E=r.readBits(5);if(b===0&&(o=E),E>7){const I=r.readBits(1);b===0&&(a=I)}if(g&&r.readBits(1)){const x=l+1;r.skipBits(x),r.skipBits(x),r.skipBits(1)}r.readBits(1)&&r.skipBits(4)}}const c=r.readBits(1);let u=8;i===2&&c?u=r.readBits(1)?12:10:i<=2&&(u=c?10:8);let d=0;i!==1&&(d=r.readBits(1));let f=1,h=1,p=0;return d||(i===0?(f=1,h=1):i===1?(f=0,h=0):u===12&&(f=r.readBits(1),f&&(h=r.readBits(1))),f&&h&&(p=r.readBits(2))),{profile:i,level:o,tier:a,bitDepth:u,monochrome:d,chromaSubsamplingX:f,chromaSubsamplingY:h,chromaSamplePosition:p}}return null},yR=t=>{const e=ti(t),n=e.getUint8(9),r=e.getUint16(10,!0),i=e.getUint32(12,!0),s=e.getInt16(16,!0),o=e.getUint8(18);let a=null;return o&&(a=t.subarray(19,21+n)),{outputChannelCount:n,preSkip:r,inputSampleRate:i,outputGain:s,channelMappingFamily:o,channelMappingTable:a}},ZJ=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],QJ=t=>{const e=t[0]>>3;return{durationInSamples:ZJ[e]}},XJ=t=>{if(t.length<7)throw new Error("Setup header is too short.");if(t[0]!==5)throw new Error("Wrong packet type in Setup header.");if(String.fromCharCode(...t.slice(1,7))!=="vorbis")throw new Error("Invalid packet signature in Setup header.");const n=t.length,r=new Uint8Array(n);for(let d=0;d<n;d++)r[d]=t[n-1-d];const i=new lr(r);let s=0;for(;i.getBitsLeft()>97;)if(i.readBits(1)===1){s=i.pos;break}if(s===0)throw new Error("Invalid Setup header: framing bit not found.");let o=0,a=!1,l=0;for(;i.getBitsLeft()>=97;){const d=i.pos,f=i.readBits(8),h=i.readBits(16),p=i.readBits(16);if(f>63||h!==0||p!==0){i.pos=d;break}if(i.skipBits(1),o++,o>64)break;i.clone().readBits(6)+1===o&&(a=!0,l=o)}if(!a)throw new Error("Invalid Setup header: mode header not found.");if(l>63)throw new Error(`Unsupported mode count: ${l}.`);const c=l;i.pos=0,i.skipBits(s);const u=Array(c).fill(0);for(let d=c-1;d>=0;d--)i.skipBits(40),u[d]=i.readBits(1);return{modeBlockflags:u}},bR=(t,e,n)=>{switch(t){case"avc":return zJ(n,e).some(s=>Cg(s)===Ud.IDR)?"key":"delta";case"hevc":return fR(n,e).some(s=>{const o=Ll(s);return Li.BLA_W_LP<=o&&o<=Li.RSV_IRAP_VCL23})?"key":"delta";case"vp8":return(n[0]&1)===0?"key":"delta";case"vp9":{const r=new lr(n);if(r.readBits(2)!==2)return null;const i=r.readBits(1);return(r.readBits(1)<<1)+i===3&&r.skipBits(1),r.readBits(1)?null:r.readBits(1)===0?"key":"delta"}case"av1":{let r=!1;for(const{type:i,data:s}of mR(n))if(i===1){const o=new lr(s);o.skipBits(4),r=!!o.readBits(1)}else if(i===3||i===6||i===7){if(r)return"key";const o=new lr(s);return o.readBits(1)?null:o.readBits(2)===0?"key":"delta"}return null}default:Sc(t),G(!1)}};var Hd;(function(t){t[t.STREAMINFO=0]="STREAMINFO",t[t.VORBIS_COMMENT=4]="VORBIS_COMMENT",t[t.PICTURE=6]="PICTURE"})(Hd||(Hd={}));const Jx=(t,e)=>{const n=ti(t);let r=0;const i=n.getUint32(r,!0);r+=4;const s=Ps.decode(t.subarray(r,r+i));r+=i,i>0&&(e.raw??={},e.raw.vendor??=s);const o=n.getUint32(r,!0);r+=4;for(let a=0;a<o;a++){const l=n.getUint32(r,!0);r+=4;const c=Ps.decode(t.subarray(r,r+l));r+=l;const u=c.indexOf("=");if(u===-1)continue;const d=c.slice(0,u).toUpperCase(),f=c.slice(u+1);switch(e.raw??={},e.raw[d]??=f,d){case"TITLE":e.title??=f;break;case"DESCRIPTION":e.description??=f;break;case"ARTIST":e.artist??=f;break;case"ALBUM":e.album??=f;break;case"ALBUMARTIST":e.albumArtist??=f;break;case"COMMENT":e.comment??=f;break;case"LYRICS":e.lyrics??=f;break;case"TRACKNUMBER":{const h=f.split("/"),p=Number.parseInt(h[0],10),m=h[1]&&Number.parseInt(h[1],10);Number.isInteger(p)&&p>0&&(e.trackNumber??=p),m&&Number.isInteger(m)&&m>0&&(e.tracksTotal??=m)}break;case"TRACKTOTAL":{const h=Number.parseInt(f,10);Number.isInteger(h)&&h>0&&(e.tracksTotal??=h)}break;case"DISCNUMBER":{const h=f.split("/"),p=Number.parseInt(h[0],10),m=h[1]&&Number.parseInt(h[1],10);Number.isInteger(p)&&p>0&&(e.discNumber??=p),m&&Number.isInteger(m)&&m>0&&(e.discsTotal??=m)}break;case"DISCTOTAL":{const h=Number.parseInt(f,10);Number.isInteger(h)&&h>0&&(e.discsTotal??=h)}break;case"DATE":{const h=new Date(f);Number.isNaN(h.getTime())||(e.date??=h)}break;case"GENRE":e.genre??=f;break;case"METADATA_BLOCK_PICTURE":{const h=EJ(f),p=ti(h),m=p.getUint32(0,!1),g=p.getUint32(4,!1),y=String.fromCharCode(...h.subarray(8,8+g)),b=p.getUint32(8+g,!1),E=Ps.decode(h.subarray(12+g,12+g+b)),C=p.getUint32(g+b+28),I=h.subarray(g+b+32,g+b+32+C);e.images??=[],e.images.push({data:I,mimeType:y,kind:m===3?"coverFront":m===4?"coverBack":"unknown",name:void 0,description:E||void 0})}break}}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class ju{constructor(e){this.input=e}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const wR=[],vR=[],e2=[],t2=[];/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Rs=new Uint8Array(0);class Ln{constructor(e,n,r,i,s=-1,o,a){if(this.data=e,this.type=n,this.timestamp=r,this.duration=i,this.sequenceNumber=s,e===Rs&&o===void 0)throw new Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(o===void 0&&(o=e.byteLength),!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(n!=="key"&&n!=="delta")throw new TypeError('type must be either "key" or "delta".');if(!Number.isFinite(r))throw new TypeError("timestamp must be a number.");if(!Number.isFinite(i)||i<0)throw new TypeError("duration must be a non-negative number.");if(!Number.isFinite(s))throw new TypeError("sequenceNumber must be a number.");if(!Number.isInteger(o)||o<0)throw new TypeError("byteLength must be a non-negative integer.");if(a!==void 0&&(typeof a!="object"||!a))throw new TypeError("sideData, when provided, must be an object.");if(a?.alpha!==void 0&&!(a.alpha instanceof Uint8Array))throw new TypeError("sideData.alpha, when provided, must be a Uint8Array.");if(a?.alphaByteLength!==void 0&&(!Number.isInteger(a.alphaByteLength)||a.alphaByteLength<0))throw new TypeError("sideData.alphaByteLength, when provided, must be a non-negative integer.");this.byteLength=o,this.sideData=a??{},this.sideData.alpha&&this.sideData.alphaByteLength===void 0&&(this.sideData.alphaByteLength=this.sideData.alpha.byteLength)}get isMetadataOnly(){return this.data===Rs}get microsecondTimestamp(){return Math.trunc(Ql*this.timestamp)}get microsecondDuration(){return Math.trunc(Ql*this.duration)}toEncodedVideoChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}alphaToEncodedVideoChunk(e=this.type){if(!this.sideData.alpha)throw new TypeError("This packet does not contain alpha side data.");if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.sideData.alpha,type:e,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}toEncodedAudioChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to an audio chunk.");if(typeof EncodedAudioChunk>"u")throw new Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}static fromEncodedChunk(e,n){if(!(e instanceof EncodedVideoChunk||e instanceof EncodedAudioChunk))throw new TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");const r=new Uint8Array(e.byteLength);return e.copyTo(r),new Ln(r,e.type,e.timestamp/1e6,(e.duration??0)/1e6,void 0,void 0,n)}clone(e){if(e!==void 0&&(typeof e!="object"||e===null))throw new TypeError("options, when provided, must be an object.");if(e?.timestamp!==void 0&&!Number.isFinite(e.timestamp))throw new TypeError("options.timestamp, when provided, must be a number.");if(e?.duration!==void 0&&!Number.isFinite(e.duration))throw new TypeError("options.duration, when provided, must be a number.");return new Ln(this.data,this.type,e?.timestamp??this.timestamp,e?.duration??this.duration,this.sequenceNumber,this.byteLength)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const YJ=t=>{let r=t,i=4096,s=0,o=12,a=0;for(r<0&&(r=-r,s=128),r+=33,r>8191&&(r=8191);(r&i)!==i&&o>=5;)i>>=1,o--;return a=r>>o-4&15,~(s|o-5<<4|a)&255},JJ=t=>{let n=0,r=0,i=~t;i&128&&(i&=-129,n=-1),r=((i&240)>>4)+5;const s=(1<<r|(i&15)<<r-4|1<<r-5)-33;return n===0?s:-s},eee=t=>{let n=2048,r=0,i=11,s=0,o=t;for(o<0&&(o=-o,r=128),o>4095&&(o=4095);(o&n)!==n&&i>=5;)n>>=1,i--;return s=o>>(i===4?1:i-4)&15,(r|i-4<<4|s)^85},tee=t=>{let e=0,n=0,r=t^85;r&128&&(r&=-129,e=-1),n=((r&240)>>4)+4;let i=0;return n!==4?i=1<<n|(r&15)<<n-4|1<<n-5:i=r<<1|1,e===0?i:-i};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */tR();class wi{get displayWidth(){return this.rotation%180===0?this.codedWidth:this.codedHeight}get displayHeight(){return this.rotation%180===0?this.codedHeight:this.codedWidth}get microsecondTimestamp(){return Math.trunc(Ql*this.timestamp)}get microsecondDuration(){return Math.trunc(Ql*this.duration)}get hasAlpha(){return this.format&&this.format.includes("A")}constructor(e,n){if(this._closed=!1,e instanceof ArrayBuffer||ArrayBuffer.isView(e)){if(!n||typeof n!="object")throw new TypeError("init must be an object.");if(!("format"in n)||typeof n.format!="string")throw new TypeError("init.format must be a string.");if(!Number.isInteger(n.codedWidth)||n.codedWidth<=0)throw new TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(n.codedHeight)||n.codedHeight<=0)throw new TypeError("init.codedHeight must be a positive integer.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(n.timestamp))throw new TypeError("init.timestamp must be a number.");if(n.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=Ho(e).slice(),this.format=n.format,this.codedWidth=n.codedWidth,this.codedHeight=n.codedHeight,this.rotation=n.rotation??0,this.timestamp=n.timestamp,this.duration=n.duration??0,this.colorSpace=new VideoColorSpace(n.colorSpace)}else if(typeof VideoFrame<"u"&&e instanceof VideoFrame){if(n?.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(n?.timestamp!==void 0&&!Number.isFinite(n?.timestamp))throw new TypeError("init.timestamp, when provided, must be a number.");if(n?.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=e,this.format=e.format,this.codedWidth=e.displayWidth,this.codedHeight=e.displayHeight,this.rotation=n?.rotation??0,this.timestamp=n?.timestamp??e.timestamp/1e6,this.duration=n?.duration??(e.duration??0)/1e6,this.colorSpace=e.colorSpace}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof SVGImageElement<"u"&&e instanceof SVGImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){if(!n||typeof n!="object")throw new TypeError("init must be an object.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(n.timestamp))throw new TypeError("init.timestamp must be a number.");if(n.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");if(typeof VideoFrame<"u")return new wi(new VideoFrame(e,{timestamp:Math.trunc(n.timestamp*Ql),duration:Math.trunc((n.duration??0)*Ql)||void 0}),n);let r=0,i=0;if("naturalWidth"in e?(r=e.naturalWidth,i=e.naturalHeight):"videoWidth"in e?(r=e.videoWidth,i=e.videoHeight):"width"in e&&(r=Number(e.width),i=Number(e.height)),!r||!i)throw new TypeError("Could not determine dimensions.");const s=new OffscreenCanvas(r,i),o=s.getContext("2d",{alpha:Ep(),willReadFrequently:!0});G(o),o.drawImage(e,0,0),this._data=s,this.format="RGBX",this.codedWidth=r,this.codedHeight=i,this.rotation=n.rotation??0,this.timestamp=n.timestamp,this.duration=n.duration??0,this.colorSpace=new VideoColorSpace({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}else throw new TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.")}clone(){if(this._closed)throw new Error("VideoSample is closed.");return G(this._data!==null),dh(this._data)?new wi(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?new wi(this._data.slice(),{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation}):new wi(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}close(){this._closed||(dh(this._data)?this._data.close():this._data=null,this._closed=!0)}allocationSize(){if(this._closed)throw new Error("VideoSample is closed.");return G(this._data!==null),dh(this._data)?this._data.allocationSize():this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}async copyTo(e){if(!Ab(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(this._closed)throw new Error("VideoSample is closed.");if(G(this._data!==null),dh(this._data))await this._data.copyTo(e);else if(this._data instanceof Uint8Array)Ho(e).set(this._data);else{const r=this._data.getContext("2d");G(r);const i=r.getImageData(0,0,this.codedWidth,this.codedHeight);Ho(e).set(i.data)}}toVideoFrame(){if(this._closed)throw new Error("VideoSample is closed.");return G(this._data!==null),dh(this._data)?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0})}draw(e,n,r,i,s,o,a,l,c){let u=0,d=0,f=this.displayWidth,h=this.displayHeight,p=0,m=0,g=this.displayWidth,y=this.displayHeight;if(o!==void 0?(u=n,d=r,f=i,h=s,p=o,m=a,l!==void 0?(g=l,y=c):(g=f,y=h)):(p=n,m=r,i!==void 0&&(g=i,y=s)),!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(u))throw new TypeError("sx must be a number.");if(!Number.isFinite(d))throw new TypeError("sy must be a number.");if(!Number.isFinite(f)||f<0)throw new TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(h)||h<0)throw new TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(p))throw new TypeError("dx must be a number.");if(!Number.isFinite(m))throw new TypeError("dy must be a number.");if(!Number.isFinite(g)||g<0)throw new TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(y)||y<0)throw new TypeError("dHeight must be a non-negative number.");if(this._closed)throw new Error("VideoSample is closed.");({sx:u,sy:d,sWidth:f,sHeight:h}=this._rotateSourceRegion(u,d,f,h,this.rotation));const b=this.toCanvasImageSource();e.save();const E=p+g/2,C=m+y/2;e.translate(E,C),e.rotate(this.rotation*Math.PI/180);const I=this.rotation%180===0?1:g/y;e.scale(1/I,I),e.drawImage(b,u,d,f,h,-g/2,-y/2,g,y),e.restore()}drawWithFit(e,n){if(!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(!["fill","contain","cover"].includes(n.fit))throw new TypeError("options.fit must be 'fill', 'contain', or 'cover'.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180, or 270.");n.crop!==void 0&&pk(n.crop,"options.");const r=e.canvas.width,i=e.canvas.height,s=n.rotation??this.rotation,[o,a]=s%180===0?[this.codedWidth,this.codedHeight]:[this.codedHeight,this.codedWidth];n.crop&&hk(n.crop,o,a);let l,c,u,d;const{sx:f,sy:h,sWidth:p,sHeight:m}=this._rotateSourceRegion(n.crop?.left??0,n.crop?.top??0,n.crop?.width??o,n.crop?.height??a,s);if(n.fit==="fill")l=0,c=0,u=r,d=i;else{const[y,b]=n.crop?[n.crop.width,n.crop.height]:[o,a],E=n.fit==="contain"?Math.min(r/y,i/b):Math.max(r/y,i/b);u=y*E,d=b*E,l=(r-u)/2,c=(i-d)/2}const g=s%180===0?1:u/d;e.translate(r/2,i/2),e.rotate(s*Math.PI/180),e.scale(1/g,g),e.translate(-r/2,-i/2),e.drawImage(this.toCanvasImageSource(),f,h,p,m,l,c,u,d)}_rotateSourceRegion(e,n,r,i,s){return s===90?[e,n,r,i]=[n,this.codedHeight-e-r,i,r]:s===180?[e,n]=[this.codedWidth-e-r,this.codedHeight-n-i]:s===270&&([e,n,r,i]=[this.codedWidth-n-i,e,i,r]),{sx:e,sy:n,sWidth:r,sHeight:i}}toCanvasImageSource(){if(this._closed)throw new Error("VideoSample is closed.");if(G(this._data!==null),this._data instanceof Uint8Array){const e=this.toVideoFrame();return queueMicrotask(()=>e.close()),e}else return this._data}setRotation(e){if(![0,90,180,270].includes(e))throw new TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}setDuration(e){if(!Number.isFinite(e)||e<0)throw new TypeError("newDuration must be a non-negative number.");this.duration=e}[Symbol.dispose](){this.close()}}const dh=t=>typeof VideoFrame<"u"&&t instanceof VideoFrame,hk=(t,e,n)=>{t.left=Math.min(t.left,e),t.top=Math.min(t.top,n),t.width=Math.min(t.width,e-t.left),t.height=Math.min(t.height,n-t.top),G(t.width>=0),G(t.height>=0)},pk=(t,e)=>{if(!t||typeof t!="object")throw new TypeError(e+"crop, when provided, must be an object.");if(!Number.isInteger(t.left)||t.left<0)throw new TypeError(e+"crop.left must be a non-negative integer.");if(!Number.isInteger(t.top)||t.top<0)throw new TypeError(e+"crop.top must be a non-negative integer.");if(!Number.isInteger(t.width)||t.width<0)throw new TypeError(e+"crop.width must be a non-negative integer.");if(!Number.isInteger(t.height)||t.height<0)throw new TypeError(e+"crop.height must be a non-negative integer.")},Pv=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]);class Zs{get microsecondTimestamp(){return Math.trunc(Ql*this.timestamp)}get microsecondDuration(){return Math.trunc(Ql*this.duration)}constructor(e){if(this._closed=!1,hh(e)){if(e.format===null)throw new TypeError("AudioData with null format is not supported.");this._data=e,this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=e.numberOfFrames,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp/1e6,this.duration=e.numberOfFrames/e.sampleRate}else{if(!e||typeof e!="object")throw new TypeError("Invalid AudioDataInit: must be an object.");if(!Pv.has(e.format))throw new TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(e.sampleRate)||e.sampleRate<=0)throw new TypeError("Invalid AudioDataInit: sampleRate must be > 0.");if(!Number.isInteger(e.numberOfChannels)||e.numberOfChannels===0)throw new TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(e?.timestamp))throw new TypeError("init.timestamp must be a number.");const n=e.data.byteLength/(fh(e.format)*e.numberOfChannels);if(!Number.isInteger(n))throw new TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=n,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp,this.duration=n/e.sampleRate;let r;if(e.data instanceof ArrayBuffer)r=new Uint8Array(e.data);else if(ArrayBuffer.isView(e.data))r=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);else throw new TypeError("Invalid AudioDataInit: data is not a BufferSource.");const i=this.numberOfFrames*this.numberOfChannels*fh(this.format);if(r.byteLength<i)throw new TypeError("Invalid AudioDataInit: insufficient data size.");this._data=r}}allocationSize(e){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(e.format!==void 0&&!Pv.has(e.format))throw new TypeError("Invalid format.");if(e.frameOffset!==void 0&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(e.frameCount!==void 0&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const n=e.format??this.format,r=e.frameOffset??0;if(r>=this.numberOfFrames)throw new RangeError("frameOffset out of range");const i=e.frameCount!==void 0?e.frameCount:this.numberOfFrames-r;if(i>this.numberOfFrames-r)throw new RangeError("frameCount out of range");const s=fh(n),o=Km(n);if(o&&e.planeIndex>=this.numberOfChannels)throw new RangeError("planeIndex out of range");if(!o&&e.planeIndex!==0)throw new RangeError("planeIndex out of range");return(o?i:i*this.numberOfChannels)*s}copyTo(e,n){if(!Ab(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(n.planeIndex)||n.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(n.format!==void 0&&!Pv.has(n.format))throw new TypeError("Invalid format.");if(n.frameOffset!==void 0&&(!Number.isInteger(n.frameOffset)||n.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(n.frameCount!==void 0&&(!Number.isInteger(n.frameCount)||n.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const{planeIndex:r,format:i,frameCount:s,frameOffset:o}=n,a=i??this.format;if(!a)throw new Error("Destination format not determined");const l=this.numberOfFrames,c=this.numberOfChannels,u=o??0;if(u>=l)throw new RangeError("frameOffset out of range");const d=s!==void 0?s:l-u;if(d>l-u)throw new RangeError("frameCount out of range");const f=fh(a),h=Km(a);if(h&&r>=c)throw new RangeError("planeIndex out of range");if(!h&&r!==0)throw new RangeError("planeIndex out of range");const m=(h?d:d*c)*f;if(e.byteLength<m)throw new RangeError("Destination buffer is too small");const g=ti(e),y=ree(a);if(hh(this._data))if(h)if(a==="f32-planar")this._data.copyTo(e,{planeIndex:r,frameOffset:u,frameCount:d,format:"f32-planar"});else{const b=new ArrayBuffer(d*4),E=new Float32Array(b);this._data.copyTo(E,{planeIndex:r,frameOffset:u,frameCount:d,format:"f32-planar"});const C=new DataView(b);for(let I=0;I<d;I++){const x=I*f,P=C.getFloat32(I*4,!0);y(g,x,P)}}else{const b=c,E=new Float32Array(d);for(let C=0;C<b;C++){this._data.copyTo(E,{planeIndex:C,frameOffset:u,frameCount:d,format:"f32-planar"});for(let I=0;I<d;I++){const P=(I*b+C)*f;y(g,P,E[I])}}}else{const b=this._data,E=new DataView(b.buffer,b.byteOffset,b.byteLength),C=this.format,I=nee(C),x=fh(C),P=Km(C);for(let T=0;T<d;T++)if(h){const S=T*f;let _;P?_=(r*l+(T+u))*x:_=((T+u)*c+r)*x;const O=I(E,_);y(g,S,O)}else for(let S=0;S<c;S++){const O=(T*c+S)*f;let F;P?F=(S*l+(T+u))*x:F=((T+u)*c+S)*x;const L=I(E,F);y(g,O,L)}}}clone(){if(this._closed)throw new Error("AudioSample is closed.");if(hh(this._data)){const e=new Zs(this._data.clone());return e.setTimestamp(this.timestamp),e}else return new Zs({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data})}close(){this._closed||(hh(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}toAudioData(){if(this._closed)throw new Error("AudioSample is closed.");if(hh(this._data)){if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(Km(this.format)){const e=this.allocationSize({planeIndex:0,format:this.format}),n=new ArrayBuffer(e*this.numberOfChannels);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(new Uint8Array(n,r*e,e),{planeIndex:r,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:n})}else{const e=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(e,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:e})}}else return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data})}toAudioBuffer(){if(this._closed)throw new Error("AudioSample is closed.");const e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),n=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(n,{planeIndex:r,format:"f32-planar"}),e.copyToChannel(n,r);return e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}[Symbol.dispose](){this.close()}static*_fromAudioBuffer(e,n){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const r=48e3*5,i=e.numberOfChannels,s=e.sampleRate,o=e.length,a=Math.floor(r/i);let l=0,c=o;for(;c>0;){const u=Math.min(a,c),d=new Float32Array(i*u);for(let f=0;f<i;f++)e.copyFromChannel(d.subarray(f*u,(f+1)*u),f,l);yield new Zs({format:"f32-planar",sampleRate:s,numberOfFrames:u,numberOfChannels:i,timestamp:n+l/s,data:d}),l+=u,c-=u}}static fromAudioBuffer(e,n){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const r=48e3*5,i=e.numberOfChannels,s=e.sampleRate,o=e.length,a=Math.floor(r/i);let l=0,c=o;const u=[];for(;c>0;){const d=Math.min(a,c),f=new Float32Array(i*d);for(let p=0;p<i;p++)e.copyFromChannel(f.subarray(p*d,(p+1)*d),p,l);const h=new Zs({format:"f32-planar",sampleRate:s,numberOfFrames:d,numberOfChannels:i,timestamp:n+l/s,data:f});u.push(h),l+=d,c-=d}return u}}const fh=t=>{switch(t){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":return 4;case"f32":case"f32-planar":return 4;default:throw new Error("Unknown AudioSampleFormat")}},Km=t=>{switch(t){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},nee=t=>{switch(t){case"u8":case"u8-planar":return(e,n)=>(e.getUint8(n)-128)/128;case"s16":case"s16-planar":return(e,n)=>e.getInt16(n,!0)/32768;case"s32":case"s32-planar":return(e,n)=>e.getInt32(n,!0)/2147483648;case"f32":case"f32-planar":return(e,n)=>e.getFloat32(n,!0)}},ree=t=>{switch(t){case"u8":case"u8-planar":return(e,n,r)=>e.setUint8(n,Or((r+1)*127.5,0,255));case"s16":case"s16-planar":return(e,n,r)=>e.setInt16(n,Or(Math.round(r*32767),-32768,32767),!0);case"s32":case"s32-planar":return(e,n,r)=>e.setInt32(n,Or(Math.round(r*2147483647),-2147483648,2147483647),!0);case"f32":case"f32-planar":return(e,n,r)=>e.setFloat32(n,r,!0)}},hh=t=>typeof AudioData<"u"&&t instanceof AudioData;/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const sd=t=>{if(!t||typeof t!="object")throw new TypeError("options must be an object.");if(t.metadataOnly!==void 0&&typeof t.metadataOnly!="boolean")throw new TypeError("options.metadataOnly, when defined, must be a boolean.");if(t.verifyKeyPackets!==void 0&&typeof t.verifyKeyPackets!="boolean")throw new TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(t.verifyKeyPackets&&t.metadataOnly)throw new TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},lc=t=>{if(!nR(t))throw new TypeError("timestamp must be a number.")},Ov=(t,e,n)=>n.verifyKeyPackets?e.then(async r=>{if(!r||r.type==="delta")return r;const i=await t.determinePacketType(r);return i&&(r.type=i),r}):e;class kp{constructor(e){if(!(e instanceof gk))throw new TypeError("track must be an InputTrack.");this._track=e}getFirstPacket(e={}){if(sd(e),this._track.input._disposed)throw new es;return Ov(this._track,this._track._backing.getFirstPacket(e),e)}getPacket(e,n={}){if(lc(e),sd(n),this._track.input._disposed)throw new es;return Ov(this._track,this._track._backing.getPacket(e,n),n)}getNextPacket(e,n={}){if(!(e instanceof Ln))throw new TypeError("packet must be an EncodedPacket.");if(sd(n),this._track.input._disposed)throw new es;return Ov(this._track,this._track._backing.getNextPacket(e,n),n)}async getKeyPacket(e,n={}){if(lc(e),sd(n),this._track.input._disposed)throw new es;if(!n.verifyKeyPackets)return this._track._backing.getKeyPacket(e,n);const r=await this._track._backing.getKeyPacket(e,n);return!r||r.type==="delta"?r:await this._track.determinePacketType(r)==="delta"?this.getKeyPacket(r.timestamp-1/this._track.timeResolution,n):r}async getNextKeyPacket(e,n={}){if(!(e instanceof Ln))throw new TypeError("packet must be an EncodedPacket.");if(sd(n),this._track.input._disposed)throw new es;if(!n.verifyKeyPackets)return this._track._backing.getNextKeyPacket(e,n);const r=await this._track._backing.getNextKeyPacket(e,n);return!r||r.type==="delta"?r:await this._track.determinePacketType(r)==="delta"?this.getNextKeyPacket(r,n):r}packets(e,n,r={}){if(e!==void 0&&!(e instanceof Ln))throw new TypeError("startPacket must be an EncodedPacket.");if(e!==void 0&&e.isMetadataOnly&&!r?.metadataOnly)throw new TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(n!==void 0&&!(n instanceof Ln))throw new TypeError("endPacket must be an EncodedPacket.");if(sd(r),this._track.input._disposed)throw new es;const i=[];let{promise:s,resolve:o}=Xr(),{promise:a,resolve:l}=Xr(),c=!1,u=!1,d=null;const f=[],h=()=>Math.max(2,f.length);(async()=>{let m=e??await this.getFirstPacket(r);for(;m&&!u&&!this._track.input._disposed&&!(n&&m.sequenceNumber>=n?.sequenceNumber);){if(i.length>h()){({promise:a,resolve:l}=Xr()),await a;continue}i.push(m),o(),{promise:s,resolve:o}=Xr(),m=await this.getNextPacket(m,r)}c=!0,o()})().catch(m=>{d||(d=m,o())});const p=this._track;return{async next(){for(;;){if(p.input._disposed)throw new es;if(u)return{value:void 0,done:!0};if(d)throw d;if(i.length>0){const m=i.shift(),g=performance.now();for(f.push(g);f.length>0&&g-f[0]>=1e3;)f.shift();return l(),{value:m,done:!1}}else{if(c)return{value:void 0,done:!0};await s}}},async return(){return u=!0,l(),o(),{value:void 0,done:!0}},async throw(m){throw m},[Symbol.asyncIterator](){return this}}}}class mk{constructor(e,n){this.onSample=e,this.onError=n}}class xR{mediaSamplesInRange(e=0,n=1/0){lc(e),lc(n);const r=[];let i=!1,s=null,{promise:o,resolve:a}=Xr(),{promise:l,resolve:c}=Xr(),u=!1,d=!1,f=!1,h=null;(async()=>{const g=new Error,y=await this._createDecoder(P=>{if(c(),P.timestamp>=n&&(d=!0),d){P.close();return}s&&(P.timestamp>e?(r.push(s),i=!0):s.close()),P.timestamp>=e&&(r.push(P),i=!0),s=i?null:P,r.length>0&&(a(),{promise:o,resolve:a}=Xr())},P=>{h||(P.stack=g.stack,h=P,a())}),b=this._createPacketSink(),E=await b.getKeyPacket(e,{verifyKeyPackets:!0})??await b.getFirstPacket();if(!E)return;let C=E,I;if(n<1/0){const P=await b.getPacket(n),T=P?P.type==="key"&&P.timestamp===n?P:await b.getNextKeyPacket(P,{verifyKeyPackets:!0}):null;T&&(I=T)}const x=b.packets(E,I);for(await x.next();C&&!d&&!this._track.input._disposed;){const P=ZA(r.length);if(r.length+y.getDecodeQueueSize()>P){({promise:l,resolve:c}=Xr()),await l;continue}y.decode(C);const T=await x.next();if(T.done)break;C=T.value}await x.return(),!f&&!this._track.input._disposed&&await y.flush(),y.close(),!i&&s&&r.push(s),u=!0,a()})().catch(g=>{h||(h=g,a())});const p=this._track,m=()=>{s?.close();for(const g of r)g.close()};return{async next(){for(;;){if(p.input._disposed)throw m(),new es;if(f)return{value:void 0,done:!0};if(h)throw m(),h;if(r.length>0){const g=r.shift();return c(),{value:g,done:!1}}else if(!u)await o;else return{value:void 0,done:!0}}},async return(){return f=!0,d=!0,c(),a(),m(),{value:void 0,done:!0}},async throw(g){throw g},[Symbol.asyncIterator](){return this}}}mediaSamplesAtTimestamps(e){gJ(e);const n=mJ(e),r=[],i=[];let{promise:s,resolve:o}=Xr(),{promise:a,resolve:l}=Xr(),c=!1,u=!1,d=null;const f=m=>{i.push(m),o(),{promise:s,resolve:o}=Xr()};(async()=>{const m=new Error,g=await this._createDecoder(P=>{if(l(),u){P.close();return}let T=0;for(;r.length>0&&P.timestamp-r[0]>-1e-10;)T++,r.shift();if(T>0)for(let S=0;S<T;S++)f(S<T-1?P.clone():P);else P.close()},P=>{d||(P.stack=m.stack,d=P,o())}),y=this._createPacketSink();let b=null,E=null,C=-1;const I=async()=>{G(E);let P=E;for(g.decode(P);P.sequenceNumber<C;){const T=ZA(i.length);for(;i.length+g.getDecodeQueueSize()>T&&!u;)({promise:a,resolve:l}=Xr()),await a;if(u)break;const S=await y.getNextPacket(P);G(S),g.decode(S),P=S}C=-1},x=async()=>{await g.flush();for(let P=0;P<r.length;P++)f(null);r.length=0};for await(const P of n){if(lc(P),u||this._track.input._disposed)break;const T=await y.getPacket(P),S=T&&await y.getKeyPacket(P,{verifyKeyPackets:!0});if(!S){C!==-1&&(await I(),await x()),f(null),b=null;continue}b&&(S.sequenceNumber!==E.sequenceNumber||T.timestamp<b.timestamp)&&(await I(),await x()),r.push(T.timestamp),C=Math.max(T.sequenceNumber,C),b=T,E=S}!u&&!this._track.input._disposed&&(C!==-1&&await I(),await x()),g.close(),c=!0,o()})().catch(m=>{d||(d=m,o())});const h=this._track,p=()=>{for(const m of i)m?.close()};return{async next(){for(;;){if(h.input._disposed)throw p(),new es;if(u)return{value:void 0,done:!0};if(d)throw p(),d;if(i.length>0){const m=i.shift();return G(m!==void 0),l(),{value:m,done:!1}}else if(!c)await s;else return{value:void 0,done:!0}}},async return(){return u=!0,l(),o(),p(),{value:void 0,done:!0}},async throw(m){throw m},[Symbol.asyncIterator](){return this}}}}const ZA=t=>t===0?40:8;class iee extends mk{constructor(e,n,r,i,s,o){super(e,n),this.codec=r,this.decoderConfig=i,this.rotation=s,this.timeResolution=o,this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new Pb,this.customDecoderQueueSize=0,this.inputTimestamps=[],this.sampleQueue=[],this.currentPacketIndex=0,this.raslSkipped=!1,this.alphaDecoder=null,this.alphaHadKeyframe=!1,this.colorQueue=[],this.alphaQueue=[],this.merger=null,this.mergerCreationFailed=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue=[],this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1;const a=wR.find(l=>l.supports(r,i));if(a)this.customDecoder=new a,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=l=>{if(!(l instanceof wi))throw new TypeError("The argument passed to onSample must be a VideoSample.");this.finalizeAndEmitSample(l)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const l=c=>{if(this.alphaQueue.length>0){const u=this.alphaQueue.shift();G(u!==void 0),this.mergeAlpha(c,u)}else this.colorQueue.push(c)};this.decoder=new VideoDecoder({output:c=>{try{l(c)}catch(u){this.onError(u)}},error:n}),this.decoder.configure(i)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(G(this.decoder),Math.max(this.decoder.decodeQueueSize,this.alphaDecoder?.decodeQueueSize??0))}decode(e){if(this.codec==="hevc"&&this.currentPacketIndex>0&&!this.raslSkipped){if(this.hasHevcRaslPicture(e.data))return;this.raslSkipped=!0}this.currentPacketIndex++,this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(G(this.decoder),Av()||zA(this.inputTimestamps,e.timestamp,n=>n),this.decoder.decode(e.toEncodedVideoChunk()),this.decodeAlphaData(e))}decodeAlphaData(e){if(!e.sideData.alpha||this.mergerCreationFailed){this.pushNullAlphaFrame();return}if(!this.merger)try{this.merger=new see}catch(r){console.error("Due to an error, only color data will be decoded.",r),this.mergerCreationFailed=!0,this.decodeAlphaData(e);return}if(!this.alphaDecoder){const r=i=>{if(this.alphaDecoderQueueSize--,this.colorQueue.length>0){const s=this.colorQueue.shift();G(s!==void 0),this.mergeAlpha(s,i)}else this.alphaQueue.push(i);for(this.decodedAlphaChunkCount++;this.nullAlphaFrameQueue.length>0&&this.nullAlphaFrameQueue[0]===this.decodedAlphaChunkCount;)if(this.nullAlphaFrameQueue.shift(),this.colorQueue.length>0){const s=this.colorQueue.shift();G(s!==void 0),this.mergeAlpha(s,null)}else this.alphaQueue.push(null)};this.alphaDecoder=new VideoDecoder({output:i=>{try{r(i)}catch(s){this.onError(s)}},error:this.onError}),this.alphaDecoder.configure(this.decoderConfig)}const n=bR(this.codec,this.decoderConfig,e.sideData.alpha);if(this.alphaHadKeyframe||(this.alphaHadKeyframe=n==="key"),this.alphaHadKeyframe){if(this.codec==="hevc"&&this.currentAlphaPacketIndex>0&&!this.alphaRaslSkipped){if(this.hasHevcRaslPicture(e.sideData.alpha)){this.pushNullAlphaFrame();return}this.alphaRaslSkipped=!0}this.currentAlphaPacketIndex++,this.alphaDecoder.decode(e.alphaToEncodedVideoChunk(n??e.type)),this.alphaDecoderQueueSize++}else this.pushNullAlphaFrame()}pushNullAlphaFrame(){this.alphaDecoderQueueSize===0?this.alphaQueue.push(null):this.nullAlphaFrameQueue.push(this.decodedAlphaChunkCount+this.alphaDecoderQueueSize)}hasHevcRaslPicture(e){return fR(e,this.decoderConfig).some(r=>{const i=Ll(r);return i===Li.RASL_N||i===Li.RASL_R})}sampleHandler(e){if(Av()){if(this.sampleQueue.length>0&&e.timestamp>=hr(this.sampleQueue).timestamp){for(const n of this.sampleQueue)this.finalizeAndEmitSample(n);this.sampleQueue.length=0}zA(this.sampleQueue,e,n=>n.timestamp)}else{const n=this.inputTimestamps.shift();G(n!==void 0),e.setTimestamp(n),this.finalizeAndEmitSample(e)}}finalizeAndEmitSample(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}mergeAlpha(e,n){if(!n){const s=new wi(e);this.sampleHandler(s);return}G(this.merger),this.merger.update(e,n),e.close(),n.close();const r=new VideoFrame(this.merger.canvas,{timestamp:e.timestamp,duration:e.duration??void 0}),i=new wi(r);this.sampleHandler(i)}async flush(){if(this.customDecoder?await this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(G(this.decoder),await Promise.all([this.decoder.flush(),this.alphaDecoder?.flush()]),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.alphaHadKeyframe=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue.length=0,this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1),Av()){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}this.currentPacketIndex=0,this.raslSkipped=!1}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(G(this.decoder),this.decoder.close(),this.alphaDecoder?.close(),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.merger?.close());for(const e of this.sampleQueue)e.close();this.sampleQueue.length=0}}class see{constructor(){typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(300,150):this.canvas=document.createElement("canvas");const e=this.canvas.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=e,this.program=this.createProgram(),this.vao=this.createVAO(),this.colorTexture=this.createTexture(),this.alphaTexture=this.createTexture(),this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_colorTexture"),0),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_alphaTexture"),1)}createProgram(){const e=this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_colorTexture;
			uniform sampler2D u_alphaTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec3 color = texture(u_colorTexture, v_texCoord).rgb;
				float alpha = texture(u_alphaTexture, v_texCoord).r;
				fragColor = vec4(color, alpha);
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createShader(e,n){const r=this.gl.createShader(e);return this.gl.shaderSource(r,n),this.gl.compileShader(r),r}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const n=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(this.program,"a_position"),s=this.gl.getAttribLocation(this.program,"a_texCoord");return this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}update(e,n){(e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.alphaTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class n2 extends xR{constructor(e){if(!(e instanceof fm))throw new TypeError("videoTrack must be an InputVideoTrack.");super(),this._track=e}async _createDecoder(e,n){if(!await this._track.canDecode())throw new Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._track.codec,i=this._track.rotation,s=await this._track.getDecoderConfig(),o=this._track.timeResolution;return G(r&&s),new iee(e,n,r,s,i,o)}_createPacketSink(){return new kp(this._track)}async getSample(e){lc(e);for await(const n of this.mediaSamplesAtTimestamps([e]))return n;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,n=1/0){return this.mediaSamplesInRange(e,n)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class oee{constructor(e,n={}){if(this._nextCanvasIndex=0,!(e instanceof fm))throw new TypeError("videoTrack must be an InputVideoTrack.");if(n&&typeof n!="object")throw new TypeError("options must be an object.");if(n.alpha!==void 0&&typeof n.alpha!="boolean")throw new TypeError("options.alpha, when provided, must be a boolean.");if(n.width!==void 0&&(!Number.isInteger(n.width)||n.width<=0))throw new TypeError("options.width, when defined, must be a positive integer.");if(n.height!==void 0&&(!Number.isInteger(n.height)||n.height<=0))throw new TypeError("options.height, when defined, must be a positive integer.");if(n.fit!==void 0&&!["fill","contain","cover"].includes(n.fit))throw new TypeError('options.fit, when provided, must be one of "fill", "contain", or "cover".');if(n.width!==void 0&&n.height!==void 0&&n.fit===void 0)throw new TypeError("When both options.width and options.height are provided, options.fit must also be provided.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180 or 270.");if(n.crop!==void 0&&pk(n.crop,"options."),n.poolSize!==void 0&&(typeof n.poolSize!="number"||!Number.isInteger(n.poolSize)||n.poolSize<0))throw new TypeError("poolSize must be a non-negative integer.");const r=n.rotation??e.rotation,[i,s]=r%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],o=n.crop;o&&hk(o,i,s);let[a,l]=o?[o.width,o.height]:[i,s];const c=a/l;n.width!==void 0&&n.height===void 0?(a=n.width,l=Math.round(a/c)):n.width===void 0&&n.height!==void 0?(l=n.height,a=Math.round(l*c)):n.width!==void 0&&n.height!==void 0&&(a=n.width,l=n.height),this._videoTrack=e,this._alpha=n.alpha??!1,this._width=a,this._height=l,this._rotation=r,this._crop=o,this._fit=n.fit??"fill",this._videoSampleSink=new n2(e),this._canvasPool=Array.from({length:n.poolSize??0},()=>null)}_videoSampleToWrappedCanvas(e){let n=this._canvasPool[this._nextCanvasIndex],r=!1;n||(typeof document<"u"?(n=document.createElement("canvas"),n.width=this._width,n.height=this._height):n=new OffscreenCanvas(this._width,this._height),this._canvasPool.length>0&&(this._canvasPool[this._nextCanvasIndex]=n),r=!0),this._canvasPool.length>0&&(this._nextCanvasIndex=(this._nextCanvasIndex+1)%this._canvasPool.length);const i=n.getContext("2d",{alpha:this._alpha||Ep()});G(i),i.resetTransform(),r||(!this._alpha&&Ep()?(i.fillStyle="black",i.fillRect(0,0,this._width,this._height)):i.clearRect(0,0,this._width,this._height)),e.drawWithFit(i,{fit:this._fit,rotation:this._rotation,crop:this._crop});const s={canvas:n,timestamp:e.timestamp,duration:e.duration};return e.close(),s}async getCanvas(e){lc(e);const n=await this._videoSampleSink.getSample(e);return n&&this._videoSampleToWrappedCanvas(n)}canvases(e=0,n=1/0){return UA(this._videoSampleSink.samples(e,n),r=>this._videoSampleToWrappedCanvas(r))}canvasesAtTimestamps(e){return UA(this._videoSampleSink.samplesAtTimestamps(e),n=>n&&this._videoSampleToWrappedCanvas(n))}}class aee extends mk{constructor(e,n,r,i){super(e,n),this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new Pb,this.customDecoderQueueSize=0,this.currentTimestamp=null;const s=a=>{(this.currentTimestamp===null||Math.abs(a.timestamp-this.currentTimestamp)>=a.duration)&&(this.currentTimestamp=a.timestamp);const l=this.currentTimestamp;if(this.currentTimestamp+=a.duration,a.numberOfFrames===0){a.close();return}const c=i.sampleRate;a.setTimestamp(Math.round(l*c)/c),e(a)},o=vR.find(a=>a.supports(r,i));o?(this.customDecoder=new o,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=a=>{if(!(a instanceof Zs))throw new TypeError("The argument passed to onSample must be an AudioSample.");s(a)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init())):(this.decoder=new AudioDecoder({output:a=>{try{s(new Zs(a))}catch(l){this.onError(l)}},error:n}),this.decoder.configure(i))}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(G(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(G(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}flush(){return this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(G(this.decoder),this.decoder.flush())}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(G(this.decoder),this.decoder.close())}}class lee extends mk{constructor(e,n,r){super(e,n),this.decoderConfig=r,this.currentTimestamp=null,G(xi.includes(r.codec)),this.codec=r.codec;const{dataType:i,sampleSize:s,littleEndian:o}=Rc(this.codec);switch(this.inputSampleSize=s,s){case 1:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint8(l)-2**7:i==="signed"?this.readInputValue=(a,l)=>a.getInt8(l):i==="ulaw"?this.readInputValue=(a,l)=>JJ(a.getUint8(l)):i==="alaw"?this.readInputValue=(a,l)=>tee(a.getUint8(l)):G(!1);break;case 2:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint16(l,o)-2**15:i==="signed"?this.readInputValue=(a,l)=>a.getInt16(l,o):G(!1);break;case 3:i==="unsigned"?this.readInputValue=(a,l)=>Ib(a,l,o)-2**23:i==="signed"?this.readInputValue=(a,l)=>yJ(a,l,o):G(!1);break;case 4:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint32(l,o)-2**31:i==="signed"?this.readInputValue=(a,l)=>a.getInt32(l,o):i==="float"?this.readInputValue=(a,l)=>a.getFloat32(l,o):G(!1);break;case 8:i==="float"?this.readInputValue=(a,l)=>a.getFloat64(l,o):G(!1);break;default:Sc(s),G(!1)}switch(s){case 1:i==="ulaw"||i==="alaw"?(this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(a,l,c)=>a.setInt16(l,c,!0)):(this.outputSampleSize=1,this.outputFormat="u8",this.writeOutputValue=(a,l,c)=>a.setUint8(l,c+2**7));break;case 2:this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(a,l,c)=>a.setInt16(l,c,!0);break;case 3:this.outputSampleSize=4,this.outputFormat="s32",this.writeOutputValue=(a,l,c)=>a.setInt32(l,c<<8,!0);break;case 4:this.outputSampleSize=4,i==="float"?(this.outputFormat="f32",this.writeOutputValue=(a,l,c)=>a.setFloat32(l,c,!0)):(this.outputFormat="s32",this.writeOutputValue=(a,l,c)=>a.setInt32(l,c,!0));break;case 8:this.outputSampleSize=4,this.outputFormat="f32",this.writeOutputValue=(a,l,c)=>a.setFloat32(l,c,!0);break;default:Sc(s),G(!1)}}getDecodeQueueSize(){return 0}decode(e){const n=ti(e.data),r=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,i=r*this.decoderConfig.numberOfChannels*this.outputSampleSize,s=new ArrayBuffer(i),o=new DataView(s);for(let u=0;u<r*this.decoderConfig.numberOfChannels;u++){const d=u*this.inputSampleSize,f=u*this.outputSampleSize,h=this.readInputValue(n,d);this.writeOutputValue(o,f,h)}const a=r/this.decoderConfig.sampleRate;(this.currentTimestamp===null||Math.abs(e.timestamp-this.currentTimestamp)>=a)&&(this.currentTimestamp=e.timestamp);const l=this.currentTimestamp;this.currentTimestamp+=a;const c=new Zs({format:this.outputFormat,data:s,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:r,timestamp:l});this.onSample(c)}async flush(){}close(){}}class QA extends xR{constructor(e){if(!(e instanceof ol))throw new TypeError("audioTrack must be an InputAudioTrack.");super(),this._track=e}async _createDecoder(e,n){if(!await this._track.canDecode())throw new Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._track.codec,i=await this._track.getDecoderConfig();return G(r&&i),xi.includes(i.codec)?new lee(e,n,i):new aee(e,n,r,i)}_createPacketSink(){return new kp(this._track)}async getSample(e){lc(e);for await(const n of this.mediaSamplesAtTimestamps([e]))return n;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,n=1/0){return this.mediaSamplesInRange(e,n)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class gk{constructor(e,n){this.input=e,this._backing=n}isVideoTrack(){return this instanceof fm}isAudioTrack(){return this instanceof ol}get id(){return this._backing.getId()}get internalCodecId(){return this._backing.getInternalCodecId()}get languageCode(){return this._backing.getLanguageCode()}get name(){return this._backing.getName()}get timeResolution(){return this._backing.getTimeResolution()}getFirstTimestamp(){return this._backing.getFirstTimestamp()}computeDuration(){return this._backing.computeDuration()}async computePacketStats(e=1/0){const n=new kp(this);let r=1/0,i=-1/0,s=0,o=0;for await(const a of n.packets(void 0,void 0,{metadataOnly:!0})){if(s>=e&&a.timestamp>=i)break;r=Math.min(r,a.timestamp),i=Math.max(i,a.timestamp+a.duration),s++,o+=a.byteLength}return{packetCount:s,averagePacketRate:s?Number((s/(i-r)).toPrecision(16)):0,averageBitrate:s?Number((8*o/(i-r)).toPrecision(16)):0}}}class fm extends gk{constructor(e,n){super(e,n),this._backing=n}get type(){return"video"}get codec(){return this._backing.getCodec()}get codedWidth(){return this._backing.getCodedWidth()}get codedHeight(){return this._backing.getCodedHeight()}get rotation(){return this._backing.getRotation()}get displayWidth(){return this._backing.getRotation()%180===0?this._backing.getCodedWidth():this._backing.getCodedHeight()}get displayHeight(){return this._backing.getRotation()%180===0?this._backing.getCodedHeight():this._backing.getCodedWidth()}getColorSpace(){return this._backing.getColorSpace()}async hasHighDynamicRange(){const e=await this._backing.getColorSpace();return e.primaries==="bt2020"||e.primaries==="smpte432"||e.transfer==="pg"||e.transfer==="hlg"||e.matrix==="bt2020-ncl"}canBeTransparent(){return this._backing.canBeTransparent()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const n=this._backing.getCodec();return G(n!==null),wR.some(i=>i.supports(n,e))?!0:typeof VideoDecoder>"u"?!1:(await VideoDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof Ln))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("packet must not be metadata-only to determine its type.");if(this.codec===null)return null;const n=await this.getDecoderConfig();return G(n),bR(this.codec,n,e.data)}}class ol extends gk{constructor(e,n){super(e,n),this._backing=n}get type(){return"audio"}get codec(){return this._backing.getCodec()}get numberOfChannels(){return this._backing.getNumberOfChannels()}get sampleRate(){return this._backing.getSampleRate()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const n=this._backing.getCodec();return G(n!==null),vR.some(r=>r.supports(n,e))||e.codec.startsWith("pcm-")?!0:typeof AudioDecoder>"u"?!1:(await AudioDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof Ln))throw new TypeError("packet must be an EncodedPacket.");return this.codec===null?null:"key"}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const SR=t=>{let n=(t.hasVideo?"video/":t.hasAudio?"audio/":"application/")+(t.isQuickTime?"quicktime":"mp4");if(t.codecStrings.length>0){const r=[...new Set(t.codecStrings)];n+=`; codecs="${r.join(", ")}"`}return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Aa=8,iu=16,Bl=t=>{let e=et(t);const n=$r(t,4);let r=8;e===1&&(e=Us(t),r=16);const s=e-r;return s<0?null:{name:n,totalSize:e,headerSize:r,contentSize:s}},Wc=t=>ou(t)/65536,Mv=t=>ou(t)/1073741824,Nv=t=>{let e=0;for(let n=0;n<4;n++){e<<=7;const r=mt(t);if(e|=r&127,(r&128)===0)break}return e},mo=t=>{let e=qr(t);return t.skip(2),e=Math.min(e,t.remainingLength),Ps.decode(It(t,e))},cee=t=>{const e=Bl(t);if(!e||e.name!=="data"||t.remainingLength<8)return null;const n=et(t);t.skip(4);const r=It(t,e.contentSize-8);switch(n){case 1:return Ps.decode(r);case 2:return new TextDecoder("utf-16be").decode(r);case 13:return new zd(r,"image/jpeg");case 14:return new zd(r,"image/png");case 27:return new zd(r,"image/bmp");default:return r}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class uee extends ju{constructor(e){super(e),this.moovSlice=null,this.currentTrack=null,this.tracks=[],this.metadataPromise=null,this.movieTimescale=-1,this.movieDurationInTimescale=-1,this.isQuickTime=!1,this.metadataTags={},this.currentMetadataKeys=null,this.isFragmented=!1,this.fragmentTrackDefaults=[],this.currentFragment=null,this.lastReadFragment=null,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getTracks(){return await this.readMetadata(),this.tracks.map(e=>e.inputTrack)}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(n=>n.inputTrack.getCodecParameterString()));return SR({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some(n=>n.info?.type==="video"),hasAudio:this.tracks.some(n=>n.info?.type==="audio"),codecStrings:e.filter(Boolean)})}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,Aa,iu);if(n instanceof Promise&&(n=await n),!n)break;const r=e,i=Bl(n);if(!i)break;if(i.name==="ftyp"){const s=$r(n,4);this.isQuickTime=s==="qt  "}else if(i.name==="moov"){let s=this.reader.requestSlice(n.filePos,i.contentSize);if(s instanceof Promise&&(s=await s),!s)break;this.moovSlice=s,this.readContiguousBoxes(this.moovSlice);for(const o of this.tracks){const a=o.editListPreviousSegmentDurations/this.movieTimescale;o.editListOffset-=Math.round(a*o.timescale)}break}e=r+i.totalSize}if(this.isFragmented&&this.reader.fileSize!==null){let n=this.reader.requestSlice(this.reader.fileSize-4,4);n instanceof Promise&&(n=await n),G(n);const r=et(n),i=this.reader.fileSize-r;if(i>=0&&i<=this.reader.fileSize-iu){let s=this.reader.requestSliceRange(i,Aa,iu);if(s instanceof Promise&&(s=await s),s){const o=Bl(s);if(o&&o.name==="mfra"){let a=this.reader.requestSlice(s.filePos,o.contentSize);a instanceof Promise&&(a=await a),a&&this.readContiguousBoxes(a)}}}}})()}getSampleTableForTrack(e){if(e.sampleTable)return e.sampleTable;const n={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};e.sampleTable=n,G(this.moovSlice);const r=this.moovSlice.slice(e.sampleTableByteOffset);if(this.currentTrack=e,this.traverseBox(r),this.currentTrack=null,e.info?.type==="audio"&&e.info.codec&&xi.includes(e.info.codec)&&n.sampleCompositionTimeOffsets.length===0){G(e.info?.type==="audio");const s=Rc(e.info.codec),o=[],a=[];for(let l=0;l<n.sampleToChunk.length;l++){const c=n.sampleToChunk[l],u=n.sampleToChunk[l+1],d=(u?u.startChunkIndex:n.chunkOffsets.length)-c.startChunkIndex;for(let f=0;f<d;f++){const h=c.startSampleIndex+f*c.samplesPerChunk,p=h+c.samplesPerChunk,m=Mn(n.sampleTimingEntries,h,T=>T.startIndex),g=n.sampleTimingEntries[m],y=Mn(n.sampleTimingEntries,p,T=>T.startIndex),b=n.sampleTimingEntries[y],E=g.startDecodeTimestamp+(h-g.startIndex)*g.delta,I=b.startDecodeTimestamp+(p-b.startIndex)*b.delta-E,x=hr(o);x&&x.delta===I?x.count++:o.push({startIndex:c.startChunkIndex+f,startDecodeTimestamp:E,count:1,delta:I});const P=c.samplesPerChunk*s.sampleSize*e.info.numberOfChannels;a.push(P)}c.startSampleIndex=c.startChunkIndex,c.samplesPerChunk=1}n.sampleTimingEntries=o,n.sampleSizes=a}if(n.sampleCompositionTimeOffsets.length>0){n.presentationTimestamps=[];for(const s of n.sampleTimingEntries)for(let o=0;o<s.count;o++)n.presentationTimestamps.push({presentationTimestamp:s.startDecodeTimestamp+o*s.delta,sampleIndex:s.startIndex+o});for(const s of n.sampleCompositionTimeOffsets)for(let o=0;o<s.count;o++){const a=s.startIndex+o,l=n.presentationTimestamps[a];l&&(l.presentationTimestamp+=s.offset)}n.presentationTimestamps.sort((s,o)=>s.presentationTimestamp-o.presentationTimestamp),n.presentationTimestampIndexMap=Array(n.presentationTimestamps.length).fill(-1);for(let s=0;s<n.presentationTimestamps.length;s++)n.presentationTimestampIndexMap[n.presentationTimestamps[s].sampleIndex]=s}return n}async readFragment(e){if(this.lastReadFragment?.moofOffset===e)return this.lastReadFragment;let n=this.reader.requestSliceRange(e,Aa,iu);n instanceof Promise&&(n=await n),G(n);const r=Bl(n);G(r?.name==="moof");let i=this.reader.requestSlice(e,r.totalSize);i instanceof Promise&&(i=await i),G(i),this.traverseBox(i);const s=this.lastReadFragment;G(s&&s.moofOffset===e);for(const[,o]of s.trackData){const a=o.track,{fragmentPositionCache:l}=a;if(!o.startTimestampIsFinal){const u=a.fragmentLookupTable.find(d=>d.moofOffset===s.moofOffset);if(u)Rv(o,u.timestamp);else{const d=Mn(l,s.moofOffset-1,f=>f.moofOffset);if(d!==-1){const f=l[d];Rv(o,f.endTimestamp)}}o.startTimestampIsFinal=!0}const c=Mn(l,o.startTimestamp,u=>u.startTimestamp);(c===-1||l[c].moofOffset!==s.moofOffset)&&l.splice(c+1,0,{moofOffset:s.moofOffset,startTimestamp:o.startTimestamp,endTimestamp:o.endTimestamp})}return s}readContiguousBoxes(e){const n=e.filePos;for(;e.filePos-n<=e.length-Aa&&this.traverseBox(e););}*iterateContiguousBoxes(e){const n=e.filePos;for(;e.filePos-n<=e.length-Aa;){const r=e.filePos,i=Bl(e);if(!i)break;yield{boxInfo:i,slice:e},e.filePos=r+i.totalSize}}traverseBox(e){const n=e.filePos,r=Bl(e);if(!r)return!1;const i=e.filePos,s=n+r.totalSize;switch(r.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"mvhd":{const o=mt(e);e.skip(3),o===1?(e.skip(16),this.movieTimescale=et(e),this.movieDurationInTimescale=Us(e)):(e.skip(8),this.movieTimescale=et(e),this.movieDurationInTimescale=et(e))}break;case"trak":{const o={id:-1,demuxer:this,inputTrack:null,info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,internalCodecId:null,name:null,languageCode:Cs,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:[],currentFragmentState:null,fragmentPositionCache:[],editListPreviousSegmentDurations:0,editListOffset:0};if(this.currentTrack=o,this.readContiguousBoxes(e.slice(i,r.contentSize)),o.id!==-1&&o.timescale!==-1&&o.info!==null){if(o.info.type==="video"&&o.info.width!==-1){const a=o;o.inputTrack=new fm(this.input,new dee(a)),this.tracks.push(o)}else if(o.info.type==="audio"&&o.info.numberOfChannels!==-1){const a=o;o.inputTrack=new ol(this.input,new fee(a)),this.tracks.push(o)}}this.currentTrack=null}break;case"tkhd":{const o=this.currentTrack;if(!o)break;const a=mt(e);if(!((md(e)&1)!==0))break;if(a===0)e.skip(8),o.id=et(e),e.skip(4),o.durationInMovieTimescale=et(e);else if(a===1)e.skip(16),o.id=et(e),e.skip(4),o.durationInMovieTimescale=Us(e);else throw new Error(`Incorrect track header version ${a}.`);e.skip(16);const u=[Wc(e),Wc(e),Mv(e),Wc(e),Wc(e),Mv(e),Wc(e),Wc(e),Mv(e)],d=uk(wJ(gee(u),90));G(d===0||d===90||d===180||d===270),o.rotation=d}break;case"elst":{const o=this.currentTrack;if(!o)break;const a=mt(e);e.skip(3);let l=!1,c=0;const u=et(e);for(let d=0;d<u;d++){const f=a===1?Us(e):et(e),h=a===1?Ete(e):ou(e),p=Wc(e);if(f!==0){if(l){console.warn("Unsupported edit list: multiple edits are not currently supported. Only using first edit.");break}if(h===-1){c+=f;continue}if(p!==1){console.warn("Unsupported edit list entry: media rate must be 1.");break}o.editListPreviousSegmentDurations=c,o.editListOffset=h,l=!0}}}break;case"mdhd":{const o=this.currentTrack;if(!o)break;const a=mt(e);e.skip(3),a===0?(e.skip(8),o.timescale=et(e),o.durationInMediaTimescale=et(e)):a===1&&(e.skip(16),o.timescale=et(e),o.durationInMediaTimescale=Us(e));let l=qr(e);if(l>0){o.languageCode="";for(let c=0;c<3;c++)o.languageCode=String.fromCharCode(96+(l&31))+o.languageCode,l>>=5;Sp(o.languageCode)||(o.languageCode=Cs)}}break;case"hdlr":{const o=this.currentTrack;if(!o)break;e.skip(8);const a=$r(e,4);a==="vide"?o.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:a==="soun"&&(o.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case"stbl":{const o=this.currentTrack;if(!o)break;o.sampleTableByteOffset=n,this.readContiguousBoxes(e.slice(i,r.contentSize))}break;case"stsd":{const o=this.currentTrack;if(!o||o.info===null||o.sampleTable)break;const a=mt(e);e.skip(3);const l=et(e);for(let c=0;c<l;c++){const u=e.filePos,d=Bl(e);if(!d)break;o.internalCodecId=d.name;const f=d.name.toLowerCase();if(o.info.type==="video")f==="avc1"?o.info.codec="avc":f==="hvc1"||f==="hev1"?o.info.codec="hevc":f==="vp08"?o.info.codec="vp8":f==="vp09"?o.info.codec="vp9":f==="av01"?o.info.codec="av1":console.warn(`Unsupported video codec (sample entry type '${d.name}').`),e.skip(24),o.info.width=qr(e),o.info.height=qr(e),e.skip(50),this.readContiguousBoxes(e.slice(e.filePos,u+d.totalSize-e.filePos));else{f==="mp4a"||(f==="opus"?o.info.codec="opus":f==="flac"?o.info.codec="flac":f==="twos"||f==="sowt"||f==="raw "||f==="in24"||f==="in32"||f==="fl32"||f==="fl64"||f==="lpcm"||f==="ipcm"||f==="fpcm"||(f==="ulaw"?o.info.codec="ulaw":f==="alaw"?o.info.codec="alaw":console.warn(`Unsupported audio codec (sample entry type '${d.name}').`))),e.skip(8);const h=qr(e);e.skip(6);let p=qr(e),m=qr(e);e.skip(4);let g=et(e)/65536;if(a===0&&h>0){if(h===1)e.skip(4),m=8*et(e),e.skip(8);else if(h===2){e.skip(4),g=LR(e),p=et(e),e.skip(4),m=et(e);const y=et(e);if(e.skip(8),f==="lpcm"){const b=m+7>>3,E=!!(y&1),C=!!(y&2),I=y&4?-1:0;m>0&&m<=64&&(E?m===32&&(o.info.codec=C?"pcm-f32be":"pcm-f32"):I&1<<b-1?b===1?o.info.codec="pcm-s8":b===2?o.info.codec=C?"pcm-s16be":"pcm-s16":b===3?o.info.codec=C?"pcm-s24be":"pcm-s24":b===4&&(o.info.codec=C?"pcm-s32be":"pcm-s32"):b===1&&(o.info.codec="pcm-u8")),o.info.codec===null&&console.warn("Unsupported PCM format.")}}}o.info.codec==="opus"&&(g=Ob),o.info.numberOfChannels=p,o.info.sampleRate=g,f==="twos"?m===8?o.info.codec="pcm-s8":m===16?o.info.codec="pcm-s16be":(console.warn(`Unsupported sample size ${m} for codec 'twos'.`),o.info.codec=null):f==="sowt"?m===8?o.info.codec="pcm-s8":m===16?o.info.codec="pcm-s16":(console.warn(`Unsupported sample size ${m} for codec 'sowt'.`),o.info.codec=null):f==="raw "?o.info.codec="pcm-u8":f==="in24"?o.info.codec="pcm-s24be":f==="in32"?o.info.codec="pcm-s32be":f==="fl32"?o.info.codec="pcm-f32be":f==="fl64"?o.info.codec="pcm-f64be":f==="ipcm"?o.info.codec="pcm-s16be":f==="fpcm"&&(o.info.codec="pcm-f32be"),this.readContiguousBoxes(e.slice(e.filePos,u+d.totalSize-e.filePos))}}}break;case"avcC":{const o=this.currentTrack;if(!o)break;G(o.info),o.info.codecDescription=It(e,r.contentSize)}break;case"hvcC":{const o=this.currentTrack;if(!o)break;G(o.info),o.info.codecDescription=It(e,r.contentSize)}break;case"vpcC":{const o=this.currentTrack;if(!o)break;G(o.info?.type==="video"),e.skip(4);const a=mt(e),l=mt(e),c=mt(e),u=c>>4,d=c>>1&7,f=c&1,h=mt(e),p=mt(e),m=mt(e);o.info.vp9CodecInfo={profile:a,level:l,bitDepth:u,chromaSubsampling:d,videoFullRangeFlag:f,colourPrimaries:h,transferCharacteristics:p,matrixCoefficients:m}}break;case"av1C":{const o=this.currentTrack;if(!o)break;G(o.info?.type==="video"),e.skip(1);const a=mt(e),l=a>>5,c=a&31,u=mt(e),d=u>>7,f=u>>6&1,h=u>>5&1,p=u>>4&1,m=u>>3&1,g=u>>2&1,y=u&3,b=l===2&&f?h?12:10:f?10:8;o.info.av1CodecInfo={profile:l,level:c,tier:d,bitDepth:b,monochrome:p,chromaSubsamplingX:m,chromaSubsamplingY:g,chromaSamplePosition:y}}break;case"colr":{const o=this.currentTrack;if(!o||(G(o.info?.type==="video"),$r(e,4)!=="nclx"))break;const l=qr(e),c=qr(e),u=qr(e),d=!!(mt(e)&128);o.info.colorSpace={primaries:GN[l],transfer:ZN[c],matrix:QN[u],fullRange:d}}break;case"wave":this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"esds":{const o=this.currentTrack;if(!o)break;G(o.info?.type==="audio"),e.skip(4);const a=mt(e);G(a===3),Nv(e),e.skip(2);const l=mt(e),c=(l&128)!==0,u=(l&64)!==0,d=(l&32)!==0;if(c&&e.skip(2),u){const g=mt(e);e.skip(g)}d&&e.skip(2);const f=mt(e);G(f===4);const h=Nv(e),p=e.filePos,m=mt(e);if(m===64||m===103?(o.info.codec="aac",o.info.aacCodecInfo={isMpeg2:m===103}):m===105||m===107?o.info.codec="mp3":m===221?o.info.codec="vorbis":console.warn(`Unsupported audio codec (objectTypeIndication ${m}) - discarding track.`),e.skip(12),h>e.filePos-p){const g=mt(e);G(g===5);const y=Nv(e);if(o.info.codecDescription=It(e,y),o.info.codec==="aac"){const b=aR(o.info.codecDescription);b.numberOfChannels!==null&&(o.info.numberOfChannels=b.numberOfChannels),b.sampleRate!==null&&(o.info.sampleRate=b.sampleRate)}}}break;case"enda":{const o=this.currentTrack;if(!o)break;G(o.info?.type==="audio"),qr(e)&255&&(o.info.codec==="pcm-s16be"?o.info.codec="pcm-s16":o.info.codec==="pcm-s24be"?o.info.codec="pcm-s24":o.info.codec==="pcm-s32be"?o.info.codec="pcm-s32":o.info.codec==="pcm-f32be"?o.info.codec="pcm-f32":o.info.codec==="pcm-f64be"&&(o.info.codec="pcm-f64"))}break;case"pcmC":{const o=this.currentTrack;if(!o)break;G(o.info?.type==="audio"),e.skip(4);const l=!!(mt(e)&1),c=mt(e);o.info.codec==="pcm-s16be"?l?c===16?o.info.codec="pcm-s16":c===24?o.info.codec="pcm-s24":c===32?o.info.codec="pcm-s32":(console.warn(`Invalid ipcm sample size ${c}.`),o.info.codec=null):c===16?o.info.codec="pcm-s16be":c===24?o.info.codec="pcm-s24be":c===32?o.info.codec="pcm-s32be":(console.warn(`Invalid ipcm sample size ${c}.`),o.info.codec=null):o.info.codec==="pcm-f32be"&&(l?c===32?o.info.codec="pcm-f32":c===64?o.info.codec="pcm-f64":(console.warn(`Invalid fpcm sample size ${c}.`),o.info.codec=null):c===32?o.info.codec="pcm-f32be":c===64?o.info.codec="pcm-f64be":(console.warn(`Invalid fpcm sample size ${c}.`),o.info.codec=null));break}case"dOps":{const o=this.currentTrack;if(!o)break;G(o.info?.type==="audio"),e.skip(1);const a=mt(e),l=qr(e),c=et(e),u=u2(e),d=mt(e);let f;d!==0?f=It(e,2+a):f=new Uint8Array(0);const h=new Uint8Array(19+f.byteLength),p=new DataView(h.buffer);p.setUint32(0,1332770163,!1),p.setUint32(4,1214603620,!1),p.setUint8(8,1),p.setUint8(9,a),p.setUint16(10,l,!0),p.setUint32(12,c,!0),p.setInt16(16,u,!0),p.setUint8(18,d),h.set(f,19),o.info.codecDescription=h,o.info.numberOfChannels=a}break;case"dfLa":{const o=this.currentTrack;if(!o)break;G(o.info?.type==="audio"),e.skip(4);const a=127,l=128,c=e.filePos;for(;e.filePos<s;){const p=mt(e),m=md(e);if((p&a)===Hd.STREAMINFO){e.skip(10);const y=et(e),b=y>>>12,E=(y>>9&7)+1;o.info.sampleRate=b,o.info.numberOfChannels=E,e.skip(20)}else e.skip(m);if(p&l)break}const u=e.filePos;e.filePos=c;const d=It(e,u-c),f=new Uint8Array(4+d.byteLength);new DataView(f.buffer).setUint32(0,1716281667,!1),f.set(d,4),o.info.codecDescription=f}break;case"stts":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=et(e);let l=0,c=0;for(let u=0;u<a;u++){const d=et(e),f=et(e);o.sampleTable.sampleTimingEntries.push({startIndex:l,startDecodeTimestamp:c,count:d,delta:f}),l+=d,c+=d*f}}break;case"ctts":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=et(e);let l=0;for(let c=0;c<a;c++){const u=et(e),d=ou(e);o.sampleTable.sampleCompositionTimeOffsets.push({startIndex:l,count:u,offset:d}),l+=u}}break;case"stsz":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=et(e),l=et(e);if(a===0)for(let c=0;c<l;c++){const u=et(e);o.sampleTable.sampleSizes.push(u)}else o.sampleTable.sampleSizes.push(a)}break;case"stz2":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4),e.skip(3);const a=mt(e),l=et(e),c=It(e,Math.ceil(l*a/8)),u=new lr(c);for(let d=0;d<l;d++){const f=u.readBits(a);o.sampleTable.sampleSizes.push(f)}}break;case"stss":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4),o.sampleTable.keySampleIndices=[];const a=et(e);for(let l=0;l<a;l++){const c=et(e)-1;o.sampleTable.keySampleIndices.push(c)}o.sampleTable.keySampleIndices[0]!==0&&o.sampleTable.keySampleIndices.unshift(0)}break;case"stsc":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=et(e);for(let c=0;c<a;c++){const u=et(e)-1,d=et(e),f=et(e);o.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:u,samplesPerChunk:d,sampleDescriptionIndex:f})}let l=0;for(let c=0;c<o.sampleTable.sampleToChunk.length;c++)if(o.sampleTable.sampleToChunk[c].startSampleIndex=l,c<o.sampleTable.sampleToChunk.length-1){const d=o.sampleTable.sampleToChunk[c+1].startChunkIndex-o.sampleTable.sampleToChunk[c].startChunkIndex;l+=d*o.sampleTable.sampleToChunk[c].samplesPerChunk}}break;case"stco":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=et(e);for(let l=0;l<a;l++){const c=et(e);o.sampleTable.chunkOffsets.push(c)}}break;case"co64":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=et(e);for(let l=0;l<a;l++){const c=Us(e);o.sampleTable.chunkOffsets.push(c)}}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"mehd":{const o=mt(e);e.skip(3);const a=o===1?Us(e):et(e);this.movieDurationInTimescale=a}break;case"trex":{e.skip(4);const o=et(e),a=et(e),l=et(e),c=et(e),u=et(e);this.fragmentTrackDefaults.push({trackId:o,defaultSampleDescriptionIndex:a,defaultSampleDuration:l,defaultSampleSize:c,defaultSampleFlags:u})}break;case"tfra":{const o=mt(e);e.skip(3);const a=et(e),l=this.tracks.find(b=>b.id===a);if(!l)break;const c=et(e),u=(c&48)>>4,d=(c&12)>>2,f=c&3,h=[mt,qr,md,et],p=h[u],m=h[d],g=h[f],y=et(e);for(let b=0;b<y;b++){const E=o===1?Us(e):et(e),C=o===1?Us(e):et(e);p(e),m(e),g(e),l.fragmentLookupTable.push({timestamp:E,moofOffset:C})}l.fragmentLookupTable.sort((b,E)=>b.timestamp-E.timestamp);for(let b=0;b<l.fragmentLookupTable.length-1;b++){const E=l.fragmentLookupTable[b],C=l.fragmentLookupTable[b+1];E.timestamp===C.timestamp&&(l.fragmentLookupTable.splice(b+1,1),b--)}}break;case"moof":this.currentFragment={moofOffset:n,moofSize:r.totalSize,implicitBaseDataOffset:n,trackData:new Map},this.readContiguousBoxes(e.slice(i,r.contentSize)),this.lastReadFragment=this.currentFragment,this.currentFragment=null;break;case"traf":if(G(this.currentFragment),this.readContiguousBoxes(e.slice(i,r.contentSize)),this.currentTrack){const o=this.currentFragment.trackData.get(this.currentTrack.id);if(o){const{currentFragmentState:a}=this.currentTrack;G(a),a.startTimestamp!==null&&(Rv(o,a.startTimestamp),o.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":{G(this.currentFragment),e.skip(1);const o=md(e),a=!!(o&1),l=!!(o&2),c=!!(o&8),u=!!(o&16),d=!!(o&32),f=!!(o&65536),h=!!(o&131072),p=et(e),m=this.tracks.find(y=>y.id===p);if(!m)break;const g=this.fragmentTrackDefaults.find(y=>y.trackId===p);this.currentTrack=m,m.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:g?.defaultSampleDescriptionIndex??null,defaultSampleDuration:g?.defaultSampleDuration??null,defaultSampleSize:g?.defaultSampleSize??null,defaultSampleFlags:g?.defaultSampleFlags??null,startTimestamp:null},a?m.currentFragmentState.baseDataOffset=Us(e):h&&(m.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),l&&(m.currentFragmentState.sampleDescriptionIndex=et(e)),c&&(m.currentFragmentState.defaultSampleDuration=et(e)),u&&(m.currentFragmentState.defaultSampleSize=et(e)),d&&(m.currentFragmentState.defaultSampleFlags=et(e)),f&&(m.currentFragmentState.defaultSampleDuration=0)}break;case"tfdt":{const o=this.currentTrack;if(!o)break;G(o.currentFragmentState);const a=mt(e);e.skip(3);const l=a===0?et(e):Us(e);o.currentFragmentState.startTimestamp=l}break;case"trun":{const o=this.currentTrack;if(!o)break;if(G(this.currentFragment),G(o.currentFragmentState),this.currentFragment.trackData.has(o.id)){console.warn("Can't have two trun boxes for the same track in one fragment. Ignoring...");break}const a=mt(e),l=md(e),c=!!(l&1),u=!!(l&4),d=!!(l&256),f=!!(l&512),h=!!(l&1024),p=!!(l&2048),m=et(e);let g=o.currentFragmentState.baseDataOffset;c&&(g+=ou(e));let y=null;u&&(y=et(e));let b=g;if(m===0){this.currentFragment.implicitBaseDataOffset=b;break}let E=0;const C={track:o,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(o.id,C);for(let P=0;P<m;P++){let T;d?T=et(e):(G(o.currentFragmentState.defaultSampleDuration!==null),T=o.currentFragmentState.defaultSampleDuration);let S;f?S=et(e):(G(o.currentFragmentState.defaultSampleSize!==null),S=o.currentFragmentState.defaultSampleSize);let _;h?_=et(e):(G(o.currentFragmentState.defaultSampleFlags!==null),_=o.currentFragmentState.defaultSampleFlags),P===0&&y!==null&&(_=y);let O=0;p&&(a===0?O=et(e):O=ou(e));const F=!(_&65536);C.samples.push({presentationTimestamp:E+O,duration:T,byteOffset:b,byteSize:S,isKeyFrame:F}),b+=S,E+=T}C.presentationTimestamps=C.samples.map((P,T)=>({presentationTimestamp:P.presentationTimestamp,sampleIndex:T})).sort((P,T)=>P.presentationTimestamp-T.presentationTimestamp);for(let P=0;P<C.presentationTimestamps.length;P++){const T=C.presentationTimestamps[P],S=C.samples[T.sampleIndex];if(C.firstKeyFrameTimestamp===null&&S.isKeyFrame&&(C.firstKeyFrameTimestamp=S.presentationTimestamp),P<C.presentationTimestamps.length-1){const _=C.presentationTimestamps[P+1];S.duration=_.presentationTimestamp-T.presentationTimestamp}}const I=C.samples[C.presentationTimestamps[0].sampleIndex],x=C.samples[hr(C.presentationTimestamps).sampleIndex];C.startTimestamp=I.presentationTimestamp,C.endTimestamp=x.presentationTimestamp+x.duration,this.currentFragment.implicitBaseDataOffset=b}break;case"udta":{const o=this.iterateContiguousBoxes(e.slice(i,r.contentSize));for(const{boxInfo:a,slice:l}of o){if(a.name!=="meta"&&!this.currentTrack){const c=l.filePos;this.metadataTags.raw??={},a.name[0]==="Â©"?this.metadataTags.raw[a.name]??=mo(l):this.metadataTags.raw[a.name]??=It(l,a.contentSize),l.filePos=c}switch(a.name){case"meta":l.skip(-a.headerSize),this.traverseBox(l);break;case"Â©nam":case"name":this.currentTrack?this.currentTrack.name=Ps.decode(It(l,a.contentSize)):this.metadataTags.title??=mo(l);break;case"Â©des":this.currentTrack||(this.metadataTags.description??=mo(l));break;case"Â©ART":this.currentTrack||(this.metadataTags.artist??=mo(l));break;case"Â©alb":this.currentTrack||(this.metadataTags.album??=mo(l));break;case"albr":this.currentTrack||(this.metadataTags.albumArtist??=mo(l));break;case"Â©gen":this.currentTrack||(this.metadataTags.genre??=mo(l));break;case"Â©day":if(!this.currentTrack){const c=new Date(mo(l));Number.isNaN(c.getTime())||(this.metadataTags.date??=c)}break;case"Â©cmt":this.currentTrack||(this.metadataTags.comment??=mo(l));break;case"Â©lyr":this.currentTrack||(this.metadataTags.lyrics??=mo(l));break}}}break;case"meta":{if(this.currentTrack)break;const a=et(e)!==0;this.currentMetadataKeys=new Map,a?this.readContiguousBoxes(e.slice(i,r.contentSize)):this.readContiguousBoxes(e.slice(i+4,r.contentSize-4)),this.currentMetadataKeys=null}break;case"keys":{if(!this.currentMetadataKeys)break;e.skip(4);const o=et(e);for(let a=0;a<o;a++){const l=et(e);e.skip(4);const c=Ps.decode(It(e,l-8));this.currentMetadataKeys.set(a+1,c)}}break;case"ilst":{if(!this.currentMetadataKeys)break;const o=this.iterateContiguousBoxes(e.slice(i,r.contentSize));for(const{boxInfo:a,slice:l}of o){let c=a.name;const u=(c.charCodeAt(0)<<24)+(c.charCodeAt(1)<<16)+(c.charCodeAt(2)<<8)+c.charCodeAt(3);this.currentMetadataKeys.has(u)&&(c=this.currentMetadataKeys.get(u));const d=cee(l);switch(this.metadataTags.raw??={},this.metadataTags.raw[c]??=d,c){case"Â©nam":case"titl":case"com.apple.quicktime.title":case"title":typeof d=="string"&&(this.metadataTags.title??=d);break;case"Â©des":case"desc":case"dscp":case"com.apple.quicktime.description":case"description":typeof d=="string"&&(this.metadataTags.description??=d);break;case"Â©ART":case"com.apple.quicktime.artist":case"artist":typeof d=="string"&&(this.metadataTags.artist??=d);break;case"Â©alb":case"albm":case"com.apple.quicktime.album":case"album":typeof d=="string"&&(this.metadataTags.album??=d);break;case"aART":case"album_artist":typeof d=="string"&&(this.metadataTags.albumArtist??=d);break;case"Â©cmt":case"com.apple.quicktime.comment":case"comment":typeof d=="string"&&(this.metadataTags.comment??=d);break;case"Â©gen":case"gnre":case"com.apple.quicktime.genre":case"genre":typeof d=="string"&&(this.metadataTags.genre??=d);break;case"Â©lyr":case"lyrics":typeof d=="string"&&(this.metadataTags.lyrics??=d);break;case"Â©day":case"rldt":case"com.apple.quicktime.creationdate":case"date":if(typeof d=="string"){const f=new Date(d);Number.isNaN(f.getTime())||(this.metadataTags.date??=f)}break;case"covr":case"com.apple.quicktime.artwork":d instanceof zd?(this.metadataTags.images??=[],this.metadataTags.images.push({data:d.data,kind:"coverFront",mimeType:d.mimeType})):d instanceof Uint8Array&&(this.metadataTags.images??=[],this.metadataTags.images.push({data:d,kind:"coverFront",mimeType:"image/*"}));break;case"track":if(typeof d=="string"){const f=d.split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(this.metadataTags.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(this.metadataTags.tracksTotal??=p)}break;case"trkn":if(d instanceof Uint8Array&&d.length>=6){const f=ti(d),h=f.getUint16(2,!1),p=f.getUint16(4,!1);h>0&&(this.metadataTags.trackNumber??=h),p>0&&(this.metadataTags.tracksTotal??=p)}break;case"disc":case"disk":if(d instanceof Uint8Array&&d.length>=6){const f=ti(d),h=f.getUint16(2,!1),p=f.getUint16(4,!1);h>0&&(this.metadataTags.discNumber??=h),p>0&&(this.metadataTags.discsTotal??=p)}break}}}break}return e.filePos=s,!0}}class ER{constructor(e){this.internalTrack=e,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.internalCodecId}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}getTimeResolution(){return this.internalTrack.timescale}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}async getFirstPacket(e){const n=await this.fetchPacketForSampleIndex(0,e);return n||!this.internalTrack.demuxer.isFragmented?n:this.performFragmentedLookup(null,r=>r.trackData.get(this.internalTrack.id)?{sampleIndex:0,correctSampleFound:!0}:{sampleIndex:-1,correctSampleFound:!1},-1/0,1/0,e)}mapTimestampIntoTimescale(e){return A0(e*this.internalTrack.timescale,14)+this.internalTrack.editListOffset}async getPacket(e,n){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=XA(i,r),o=await this.fetchPacketForSampleIndex(s,n);return!YA(i)||!this.internalTrack.demuxer.isFragmented?o:this.performFragmentedLookup(null,a=>{const l=a.trackData.get(this.internalTrack.id);if(!l)return{sampleIndex:-1,correctSampleFound:!1};const c=Mn(l.presentationTimestamps,r,f=>f.presentationTimestamp),u=c!==-1?l.presentationTimestamps[c].sampleIndex:-1,d=c!==-1&&r<l.endTimestamp;return{sampleIndex:u,correctSampleFound:d}},r,r,n)}async getNextPacket(e,n){const r=this.packetToSampleIndex.get(e);if(r!==void 0)return this.fetchPacketForSampleIndex(r+1,n);const i=this.packetToFragmentLocation.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(i.fragment,s=>{if(s===i.fragment){const o=s.trackData.get(this.internalTrack.id);if(i.sampleIndex+1<o.samples.length)return{sampleIndex:i.sampleIndex+1,correctSampleFound:!0}}else if(s.trackData.get(this.internalTrack.id))return{sampleIndex:0,correctSampleFound:!0};return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,n)}async getKeyPacket(e,n){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=XA(i,r),o=s===-1?-1:pee(i,s),a=await this.fetchPacketForSampleIndex(o,n);return!YA(i)||!this.internalTrack.demuxer.isFragmented?a:this.performFragmentedLookup(null,l=>{const c=l.trackData.get(this.internalTrack.id);if(!c)return{sampleIndex:-1,correctSampleFound:!1};const u=YN(c.presentationTimestamps,h=>c.samples[h.sampleIndex].isKeyFrame&&h.presentationTimestamp<=r),d=u!==-1?c.presentationTimestamps[u].sampleIndex:-1,f=u!==-1&&r<c.endTimestamp;return{sampleIndex:d,correctSampleFound:f}},r,r,n)}async getNextKeyPacket(e,n){const r=this.packetToSampleIndex.get(e);if(r!==void 0){const s=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),o=mee(s,r);return this.fetchPacketForSampleIndex(o,n)}const i=this.packetToFragmentLocation.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(i.fragment,s=>{if(s===i.fragment){const a=s.trackData.get(this.internalTrack.id).samples.findIndex((l,c)=>l.isKeyFrame&&c>i.sampleIndex);if(a!==-1)return{sampleIndex:a,correctSampleFound:!0}}else{const o=s.trackData.get(this.internalTrack.id);if(o&&o.firstKeyFrameTimestamp!==null){const a=o.samples.findIndex(l=>l.isKeyFrame);return G(a!==-1),{sampleIndex:a,correctSampleFound:!0}}}return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,n)}async fetchPacketForSampleIndex(e,n){if(e===-1)return null;const r=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),i=hee(r,e);if(!i)return null;let s;if(n.metadataOnly)s=Rs;else{let c=this.internalTrack.demuxer.reader.requestSlice(i.sampleOffset,i.sampleSize);c instanceof Promise&&(c=await c),G(c),s=It(c,i.sampleSize)}const o=(i.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,a=i.duration/this.internalTrack.timescale,l=new Ln(s,i.isKeyFrame?"key":"delta",o,a,e,i.sampleSize);return this.packetToSampleIndex.set(l,e),l}async fetchPacketInFragment(e,n,r){if(n===-1)return null;const s=e.trackData.get(this.internalTrack.id).samples[n];G(s);let o;if(r.metadataOnly)o=Rs;else{let u=this.internalTrack.demuxer.reader.requestSlice(s.byteOffset,s.byteSize);u instanceof Promise&&(u=await u),G(u),o=It(u,s.byteSize)}const a=(s.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,l=s.duration/this.internalTrack.timescale,c=new Ln(o,s.isKeyFrame?"key":"delta",a,l,e.moofOffset+n,s.byteSize);return this.packetToFragmentLocation.set(c,{fragment:e,sampleIndex:n}),c}async performFragmentedLookup(e,n,r,i,s){const o=this.internalTrack.demuxer;let a=null,l=null,c=-1;if(e){const{sampleIndex:g,correctSampleFound:y}=n(e);if(y)return this.fetchPacketInFragment(e,g,s);g!==-1&&(l=e,c=g)}const u=Mn(this.internalTrack.fragmentLookupTable,r,g=>g.timestamp),d=u!==-1?this.internalTrack.fragmentLookupTable[u]:null,f=Mn(this.internalTrack.fragmentPositionCache,r,g=>g.startTimestamp),h=f!==-1?this.internalTrack.fragmentPositionCache[f]:null,p=Math.max(d?.moofOffset??0,h?.moofOffset??0)||null;let m;for(e?p===null||e.moofOffset>=p?(m=e.moofOffset+e.moofSize,a=e):m=p:m=p??0;;){if(a){const E=a.trackData.get(this.internalTrack.id);if(E&&E.startTimestamp>i)break}let g=o.reader.requestSliceRange(m,Aa,iu);if(g instanceof Promise&&(g=await g),!g)break;const y=m,b=Bl(g);if(!b)break;if(b.name==="moof"){a=await o.readFragment(y);const{sampleIndex:E,correctSampleFound:C}=n(a);if(C)return this.fetchPacketInFragment(a,E,s);E!==-1&&(l=a,c=E)}m=y+b.totalSize}if(d&&(!l||l.moofOffset<d.moofOffset)){const g=this.internalTrack.fragmentLookupTable[u-1];G(!g||g.timestamp<d.timestamp);const y=g?.timestamp??-1/0;return this.performFragmentedLookup(null,n,y,i,s)}return l?this.fetchPacketInFragment(l,c,s):null}}class dee extends ER{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return!1}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{if(this.internalTrack.info.codec==="vp9"&&!this.internalTrack.info.vp9CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.vp9CodecInfo=e&&pR(e.data)}else if(this.internalTrack.info.codec==="av1"&&!this.internalTrack.info.av1CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.av1CodecInfo=e&&gR(e.data)}return{codec:iR(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class fee extends ER{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:sR(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const XA=(t,e)=>{if(t.presentationTimestamps){const n=Mn(t.presentationTimestamps,e,r=>r.presentationTimestamp);return n===-1?-1:t.presentationTimestamps[n].sampleIndex}else{const n=Mn(t.sampleTimingEntries,e,i=>i.startDecodeTimestamp);if(n===-1)return-1;const r=t.sampleTimingEntries[n];return r.startIndex+Math.min(Math.floor((e-r.startDecodeTimestamp)/r.delta),r.count-1)}},hee=(t,e)=>{const n=Mn(t.sampleTimingEntries,e,y=>y.startIndex),r=t.sampleTimingEntries[n];if(!r||r.startIndex+r.count<=e)return null;let s=r.startDecodeTimestamp+(e-r.startIndex)*r.delta;const o=Mn(t.sampleCompositionTimeOffsets,e,y=>y.startIndex),a=t.sampleCompositionTimeOffsets[o];a&&e-a.startIndex<a.count&&(s+=a.offset);const l=t.sampleSizes[Math.min(e,t.sampleSizes.length-1)],c=Mn(t.sampleToChunk,e,y=>y.startSampleIndex),u=t.sampleToChunk[c];G(u);const d=u.startChunkIndex+Math.floor((e-u.startSampleIndex)/u.samplesPerChunk),f=t.chunkOffsets[d],h=u.startSampleIndex+(d-u.startChunkIndex)*u.samplesPerChunk;let p=0,m=f;if(t.sampleSizes.length===1)m+=l*(e-h),p+=l*u.samplesPerChunk;else for(let y=h;y<h+u.samplesPerChunk;y++){const b=t.sampleSizes[y];y<e&&(m+=b),p+=b}let g=r.delta;if(t.presentationTimestamps){const y=t.presentationTimestampIndexMap[e];G(y!==void 0),y<t.presentationTimestamps.length-1&&(g=t.presentationTimestamps[y+1].presentationTimestamp-s)}return{presentationTimestamp:s,duration:g,sampleOffset:m,sampleSize:l,chunkOffset:f,chunkSize:p,isKeyFrame:t.keySampleIndices?fk(t.keySampleIndices,e,y=>y)!==-1:!0}},pee=(t,e)=>{if(!t.keySampleIndices)return e;const n=Mn(t.keySampleIndices,e,r=>r);return t.keySampleIndices[n]??-1},mee=(t,e)=>{if(!t.keySampleIndices)return e+1;const n=Mn(t.keySampleIndices,e,r=>r);return t.keySampleIndices[n+1]??-1},Rv=(t,e)=>{t.startTimestamp+=e,t.endTimestamp+=e;for(const n of t.samples)n.presentationTimestamp+=e;for(const n of t.presentationTimestamps)n.presentationTimestamp+=e},gee=t=>{const[e,,,n]=t,r=Math.hypot(e,n),i=e/r,s=n/r,o=-Math.atan2(s,i)*(180/Math.PI);return Number.isFinite(o)?o:0},YA=t=>t.sampleSizes.length===0;/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var Pe;(function(t){t[t.EBML=440786851]="EBML",t[t.EBMLVersion=17030]="EBMLVersion",t[t.EBMLReadVersion=17143]="EBMLReadVersion",t[t.EBMLMaxIDLength=17138]="EBMLMaxIDLength",t[t.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",t[t.DocType=17026]="DocType",t[t.DocTypeVersion=17031]="DocTypeVersion",t[t.DocTypeReadVersion=17029]="DocTypeReadVersion",t[t.Void=236]="Void",t[t.Segment=408125543]="Segment",t[t.SeekHead=290298740]="SeekHead",t[t.Seek=19899]="Seek",t[t.SeekID=21419]="SeekID",t[t.SeekPosition=21420]="SeekPosition",t[t.Duration=17545]="Duration",t[t.Info=357149030]="Info",t[t.TimestampScale=2807729]="TimestampScale",t[t.MuxingApp=19840]="MuxingApp",t[t.WritingApp=22337]="WritingApp",t[t.Tracks=374648427]="Tracks",t[t.TrackEntry=174]="TrackEntry",t[t.TrackNumber=215]="TrackNumber",t[t.TrackUID=29637]="TrackUID",t[t.TrackType=131]="TrackType",t[t.FlagEnabled=185]="FlagEnabled",t[t.FlagDefault=136]="FlagDefault",t[t.FlagForced=21930]="FlagForced",t[t.FlagLacing=156]="FlagLacing",t[t.Name=21358]="Name",t[t.Language=2274716]="Language",t[t.LanguageBCP47=2274717]="LanguageBCP47",t[t.CodecID=134]="CodecID",t[t.CodecPrivate=25506]="CodecPrivate",t[t.CodecDelay=22186]="CodecDelay",t[t.SeekPreRoll=22203]="SeekPreRoll",t[t.DefaultDuration=2352003]="DefaultDuration",t[t.Video=224]="Video",t[t.PixelWidth=176]="PixelWidth",t[t.PixelHeight=186]="PixelHeight",t[t.AlphaMode=21440]="AlphaMode",t[t.Audio=225]="Audio",t[t.SamplingFrequency=181]="SamplingFrequency",t[t.Channels=159]="Channels",t[t.BitDepth=25188]="BitDepth",t[t.SimpleBlock=163]="SimpleBlock",t[t.BlockGroup=160]="BlockGroup",t[t.Block=161]="Block",t[t.BlockAdditions=30113]="BlockAdditions",t[t.BlockMore=166]="BlockMore",t[t.BlockAdditional=165]="BlockAdditional",t[t.BlockAddID=238]="BlockAddID",t[t.BlockDuration=155]="BlockDuration",t[t.ReferenceBlock=251]="ReferenceBlock",t[t.Cluster=524531317]="Cluster",t[t.Timestamp=231]="Timestamp",t[t.Cues=475249515]="Cues",t[t.CuePoint=187]="CuePoint",t[t.CueTime=179]="CueTime",t[t.CueTrackPositions=183]="CueTrackPositions",t[t.CueTrack=247]="CueTrack",t[t.CueClusterPosition=241]="CueClusterPosition",t[t.Colour=21936]="Colour",t[t.MatrixCoefficients=21937]="MatrixCoefficients",t[t.TransferCharacteristics=21946]="TransferCharacteristics",t[t.Primaries=21947]="Primaries",t[t.Range=21945]="Range",t[t.Projection=30320]="Projection",t[t.ProjectionType=30321]="ProjectionType",t[t.ProjectionPoseRoll=30325]="ProjectionPoseRoll",t[t.Attachments=423732329]="Attachments",t[t.AttachedFile=24999]="AttachedFile",t[t.FileDescription=18046]="FileDescription",t[t.FileName=18030]="FileName",t[t.FileMediaType=18016]="FileMediaType",t[t.FileData=18012]="FileData",t[t.FileUID=18094]="FileUID",t[t.Chapters=272869232]="Chapters",t[t.Tags=307544935]="Tags",t[t.Tag=29555]="Tag",t[t.Targets=25536]="Targets",t[t.TargetTypeValue=26826]="TargetTypeValue",t[t.TargetType=25546]="TargetType",t[t.TagTrackUID=25541]="TagTrackUID",t[t.TagEditionUID=25545]="TagEditionUID",t[t.TagChapterUID=25540]="TagChapterUID",t[t.TagAttachmentUID=25542]="TagAttachmentUID",t[t.SimpleTag=26568]="SimpleTag",t[t.TagName=17827]="TagName",t[t.TagLanguage=17530]="TagLanguage",t[t.TagString=17543]="TagString",t[t.TagBinary=17541]="TagBinary",t[t.ContentEncodings=28032]="ContentEncodings",t[t.ContentEncoding=25152]="ContentEncoding",t[t.ContentEncodingOrder=20529]="ContentEncodingOrder",t[t.ContentEncodingScope=20530]="ContentEncodingScope",t[t.ContentCompression=20532]="ContentCompression",t[t.ContentCompAlgo=16980]="ContentCompAlgo",t[t.ContentCompSettings=16981]="ContentCompSettings",t[t.ContentEncryption=20533]="ContentEncryption"})(Pe||(Pe={}));const yee=[Pe.EBML,Pe.Segment],Tp=[Pe.SeekHead,Pe.Info,Pe.Cluster,Pe.Tracks,Pe.Cues,Pe.Attachments,Pe.Chapters,Pe.Tags],Ag=[...yee,...Tp],r2=8,qs=2,Ia=2*r2,kR=t=>{const e=mt(t);if(t.skip(-1),e===0)return null;let n=1,r=128;for(;(e&r)===0;)n++,r>>=1;return n},Oh=t=>{const e=mt(t);if(e===0)return null;let n=1,r=128;for(;(e&r)===0;)n++,r>>=1;let i=e&r-1;for(let s=1;s<n;s++)i*=256,i+=mt(t);return i},Xt=(t,e)=>{if(e<1||e>8)throw new Error("Bad unsigned int size "+e);let n=0;for(let r=0;r<e;r++)n*=256,n+=mt(t);return n},bee=(t,e)=>{if(e<1)throw new Error("Bad unsigned int size "+e);let n=0n;for(let r=0;r<e;r++)n<<=8n,n+=BigInt(mt(t));return n},wee=(t,e)=>{let n=Xt(t,e);return n&1<<e*8-1&&(n-=2**(e*8)),n},yk=t=>{const e=kR(t);return e===null?null:Xt(t,e)},TR=t=>{let e=mt(t);return e===255?e=null:(t.skip(-1),e=Oh(t),e===72057594037927940&&(e=null)),e},Sa=t=>{const e=yk(t);if(e===null)return null;const n=TR(t);return{id:e,size:n}},pd=(t,e)=>{const n=It(t,e);let r=0;for(;r<e&&n[r]!==0;)r+=1;return String.fromCharCode(...n.subarray(0,r))},ph=(t,e)=>{const n=It(t,e);let r=0;for(;r<e&&n[r]!==0;)r+=1;return Ps.decode(n.subarray(0,r))},Dv=(t,e)=>{if(e===0)return 0;if(e!==4&&e!==8)throw new Error("Bad float size "+e);return e===4?Tte(t):LR(t)},i2=async(t,e,n,r)=>{const i=new Set(n);let s=e;for(;r===null||s<r;){let o=t.requestSliceRange(s,qs,Ia);if(o instanceof Promise&&(o=await o),!o)break;const a=Sa(o);if(!a)break;if(i.has(a.id))return{pos:s,found:!0};Rl(a.size),s=o.filePos+a.size}return{pos:r!==null&&r>s?r:s,found:!1}},_R=async(t,e,n,r)=>{const s=new Set(n);let o=e;for(;o<r;){let a=t.requestSliceRange(o,0,Math.min(65536,r-o));if(a instanceof Promise&&(a=await a),!a||a.length<r2)break;for(let l=0;l<a.length-r2;l++){a.filePos=o;const c=yk(a);if(c!==null&&s.has(c))return o;o++}}return null},go={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC"};function Rl(t){if(t===null)throw new Error("Undefined element size is used in a place where it is not supported.")}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const vee=t=>{let n=(t.hasVideo?"video/":t.hasAudio?"audio/":"application/")+(t.isWebM?"webm":"x-matroska");if(t.codecStrings.length>0){const r=[...new Set(t.codecStrings.filter(Boolean))];n+=`; codecs="${r.join(", ")}"`}return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var ya;(function(t){t[t.None=0]="None",t[t.Xiph=1]="Xiph",t[t.FixedSize=2]="FixedSize",t[t.Ebml=3]="Ebml"})(ya||(ya={}));var O0;(function(t){t[t.Block=1]="Block",t[t.Private=2]="Private",t[t.Next=4]="Next"})(O0||(O0={}));var jh;(function(t){t[t.Zlib=0]="Zlib",t[t.Bzlib=1]="Bzlib",t[t.lzo1x=2]="lzo1x",t[t.HeaderStripping=3]="HeaderStripping"})(jh||(jh={}));const Lv=[{id:Pe.SeekHead,flag:"seekHeadSeen"},{id:Pe.Info,flag:"infoSeen"},{id:Pe.Tracks,flag:"tracksSeen"},{id:Pe.Cues,flag:"cuesSeen"}],CR=10*2**20;class xee extends ju{constructor(e){super(e),this.readMetadataPromise=null,this.segments=[],this.currentSegment=null,this.currentTrack=null,this.currentCluster=null,this.currentBlock=null,this.currentBlockAdditional=null,this.currentCueTime=null,this.currentDecodingInstruction=null,this.currentTagTargetIsMovie=!0,this.currentSimpleTagName=null,this.currentAttachedFile=null,this.isWebM=!1,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getTracks(){return await this.readMetadata(),this.segments.flatMap(e=>e.tracks.map(n=>n.inputTrack))}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.getCodecParameterString()));return vee({isWebM:this.isWebM,hasVideo:this.segments.some(r=>r.tracks.some(i=>i.info?.type==="video")),hasAudio:this.segments.some(r=>r.tracks.some(i=>i.info?.type==="audio")),codecStrings:n.filter(Boolean)})}async getMetadataTags(){await this.readMetadata();for(const n of this.segments)n.metadataTagsCollected||(this.reader.fileSize!==null&&await this.loadSegmentMetadata(n),n.metadataTagsCollected=!0);let e={};for(const n of this.segments)e={...e,...n.metadataTags};return e}readMetadata(){return this.readMetadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,qs,Ia);if(n instanceof Promise&&(n=await n),!n)break;const r=Sa(n);if(!r)break;const i=r.id;let s=r.size;const o=n.filePos;if(i===Pe.EBML){Rl(s);let a=this.reader.requestSlice(o,s);if(a instanceof Promise&&(a=await a),!a)break;this.readContiguousElements(a)}else if(i===Pe.Segment){if(await this.readSegment(o,s),s===null||this.reader.fileSize===null)break}else if(i===Pe.Cluster){if(this.reader.fileSize===null)break;s===null&&(s=(await i2(this.reader,o,Ag,this.reader.fileSize)).pos-o);const a=hr(this.segments);a&&(a.elementEndPos=o+s)}Rl(s),e=o+s}})()}async readSegment(e,n){this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,tagsSeen:!1,attachmentsSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:e,elementEndPos:n===null?null:e+n,clusterSeekStartPos:e,lastReadCluster:null,metadataTags:{},metadataTagsCollected:!1},this.segments.push(this.currentSegment);let r=e;for(;this.currentSegment.elementEndPos===null||r<this.currentSegment.elementEndPos;){let a=this.reader.requestSliceRange(r,qs,Ia);if(a instanceof Promise&&(a=await a),!a)break;const l=r,c=Sa(a);if(!c||!Tp.includes(c.id)&&c.id!==Pe.Void){const p=await _R(this.reader,l,Tp,Math.min(this.currentSegment.elementEndPos??1/0,l+CR));if(p){r=p;continue}else break}const{id:u,size:d}=c,f=a.filePos,h=Lv.findIndex(p=>p.id===u);if(h!==-1){const p=Lv[h].flag;this.currentSegment[p]=!0,Rl(d);let m=this.reader.requestSlice(f,d);m instanceof Promise&&(m=await m),m&&this.readContiguousElements(m)}else if(u===Pe.Tags||u===Pe.Attachments){u===Pe.Tags?this.currentSegment.tagsSeen=!0:this.currentSegment.attachmentsSeen=!0,Rl(d);let p=this.reader.requestSlice(f,d);p instanceof Promise&&(p=await p),p&&this.readContiguousElements(p)}else if(u===Pe.Cluster){this.currentSegment.clusterSeekStartPos=l;break}if(d===null)break;r=f+d}if(this.currentSegment.seekEntries.sort((a,l)=>a.segmentPosition-l.segmentPosition),this.reader.fileSize!==null)for(const a of this.currentSegment.seekEntries){const l=Lv.find(p=>p.id===a.id);if(!l||this.currentSegment[l.flag])continue;let c=this.reader.requestSliceRange(e+a.segmentPosition,qs,Ia);if(c instanceof Promise&&(c=await c),!c)continue;const u=Sa(c);if(!u)continue;const{id:d,size:f}=u;if(d!==l.id)continue;Rl(f),this.currentSegment[l.flag]=!0;let h=this.reader.requestSlice(c.filePos,f);h instanceof Promise&&(h=await h),h&&this.readContiguousElements(h)}this.currentSegment.timestampScale===-1&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e9/1e6),this.currentSegment.tracks.sort((a,l)=>Number(l.isDefault)-Number(a.isDefault));const i=new Map(this.currentSegment.tracks.map(a=>[a.id,a]));for(const a of this.currentSegment.cuePoints){const l=i.get(a.trackId);l&&l.cuePoints.push(a)}for(const a of this.currentSegment.tracks){a.cuePoints.sort((l,c)=>l.time-c.time);for(let l=0;l<a.cuePoints.length-1;l++){const c=a.cuePoints[l],u=a.cuePoints[l+1];c.time===u.time&&(a.cuePoints.splice(l+1,1),l--)}}let s=null,o=-1/0;for(const a of this.currentSegment.tracks)a.cuePoints.length>o&&(o=a.cuePoints.length,s=a);for(const a of this.currentSegment.tracks)a.cuePoints.length===0&&(a.cuePoints=s.cuePoints);this.currentSegment=null}async readCluster(e,n){if(n.lastReadCluster?.elementStartPos===e)return n.lastReadCluster;let r=this.reader.requestSliceRange(e,qs,Ia);r instanceof Promise&&(r=await r),G(r);const i=e,s=Sa(r);G(s);const o=s.id;G(o===Pe.Cluster);let a=s.size;const l=r.filePos;a===null&&(a=(await i2(this.reader,l,Ag,n.elementEndPos)).pos-l);let c=this.reader.requestSlice(l,a);c instanceof Promise&&(c=await c);const u={segment:n,elementStartPos:i,elementEndPos:l+a,dataStartPos:l,timestamp:-1,trackData:new Map};if(this.currentCluster=u,c){const d=this.readContiguousElements(c,Ag);u.elementEndPos=d}for(const[,d]of u.trackData){const f=d.track;G(d.blocks.length>0);let h=!1,p=!1;for(let b=0;b<d.blocks.length;b++){const E=d.blocks[b];E.timestamp+=u.timestamp,h||=E.referencedTimestamps.length>0,p||=E.lacing!==ya.None}h&&(d.blocks=kee(d.blocks)),d.presentationTimestamps=d.blocks.map((b,E)=>({timestamp:b.timestamp,blockIndex:E})).sort((b,E)=>b.timestamp-E.timestamp);for(let b=0;b<d.presentationTimestamps.length;b++){const E=d.presentationTimestamps[b],C=d.blocks[E.blockIndex];if(d.firstKeyFrameTimestamp===null&&C.isKeyFrame&&(d.firstKeyFrameTimestamp=C.timestamp),b<d.presentationTimestamps.length-1){const I=d.presentationTimestamps[b+1];C.duration=I.timestamp-C.timestamp}else C.duration===0&&f.defaultDuration!=null&&C.lacing===ya.None&&(C.duration=f.defaultDuration)}p&&(this.expandLacedBlocks(d.blocks,f),d.presentationTimestamps=d.blocks.map((b,E)=>({timestamp:b.timestamp,blockIndex:E})).sort((b,E)=>b.timestamp-E.timestamp));const m=d.blocks[d.presentationTimestamps[0].blockIndex],g=d.blocks[hr(d.presentationTimestamps).blockIndex];d.startTimestamp=m.timestamp,d.endTimestamp=g.timestamp+g.duration;const y=Mn(f.clusterPositionCache,d.startTimestamp,b=>b.startTimestamp);(y===-1||f.clusterPositionCache[y].elementStartPos!==i)&&f.clusterPositionCache.splice(y+1,0,{elementStartPos:u.elementStartPos,startTimestamp:d.startTimestamp})}return n.lastReadCluster=u,u}getTrackDataInCluster(e,n){let r=e.trackData.get(n);if(!r){const i=e.segment.tracks.find(s=>s.id===n);if(!i)return null;r={track:i,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(n,r)}return r}expandLacedBlocks(e,n){for(let r=0;r<e.length;r++){const i=e[r];if(i.lacing===ya.None)continue;i.decoded||(i.data=this.decodeBlockData(n,i.data),i.decoded=!0);const s=pf.tempFromBytes(i.data),o=[],a=mt(s)+1;switch(i.lacing){case ya.Xiph:{let l=0;for(let c=0;c<a-1;c++){let u=0;for(;s.bufferPos<s.length;){const d=mt(s);if(u+=d,d<255){o.push(u),l+=u;break}}}o.push(s.length-(s.bufferPos+l))}break;case ya.FixedSize:{const l=s.length-1,c=Math.floor(l/a);for(let u=0;u<a;u++)o.push(c)}break;case ya.Ebml:{const l=Oh(s);G(l!==null);let c=l;o.push(c);let u=c;for(let d=1;d<a-1;d++){const f=s.bufferPos,h=Oh(s);G(h!==null);const p=h,g=(1<<(s.bufferPos-f)*7-1)-1,y=p-g;c+=y,o.push(c),u+=c}o.push(s.length-(s.bufferPos+u))}break;default:G(!1)}G(o.length===a),e.splice(r,1);for(let l=0;l<a;l++){const c=o[l],u=It(s,c),d=i.duration||a*(n.defaultDuration??0),f=i.timestamp+d*l/a,h=d/a;e.splice(r+l,0,{timestamp:f,duration:h,isKeyFrame:i.isKeyFrame,referencedTimestamps:i.referencedTimestamps,data:u,lacing:ya.None,decoded:!0,mainAdditional:i.mainAdditional})}r+=a,r--}}async loadSegmentMetadata(e){for(const n of e.seekEntries){if(!(n.id===Pe.Tags&&!e.tagsSeen)){if(!(n.id===Pe.Attachments&&!e.attachmentsSeen))continue}let r=this.reader.requestSliceRange(e.dataStartPos+n.segmentPosition,qs,Ia);if(r instanceof Promise&&(r=await r),!r)continue;const i=Sa(r);if(!i||i.id!==n.id)continue;const{size:s}=i;Rl(s),G(!this.currentSegment),this.currentSegment=e;let o=this.reader.requestSlice(r.filePos,s);o instanceof Promise&&(o=await o),o&&this.readContiguousElements(o),this.currentSegment=null,n.id===Pe.Tags?e.tagsSeen=!0:n.id===Pe.Attachments&&(e.attachmentsSeen=!0)}}readContiguousElements(e,n){const r=e.filePos;for(;e.filePos-r<=e.length-qs;){const i=e.filePos;if(!this.traverseElement(e,n))return i}return e.filePos}traverseElement(e,n){const r=Sa(e);if(!r||n&&n.includes(r.id))return!1;const{id:i,size:s}=r,o=e.filePos;switch(Rl(s),i){case Pe.DocType:this.isWebM=pd(e,s)==="webm";break;case Pe.Seek:{if(!this.currentSegment)break;const a={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(a),this.readContiguousElements(e.slice(o,s)),(a.id===-1||a.segmentPosition===-1)&&this.currentSegment.seekEntries.pop()}break;case Pe.SeekID:{const a=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!a)break;a.id=Xt(e,s)}break;case Pe.SeekPosition:{const a=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!a)break;a.segmentPosition=Xt(e,s)}break;case Pe.TimestampScale:{if(!this.currentSegment)break;this.currentSegment.timestampScale=Xt(e,s),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale}break;case Pe.Duration:{if(!this.currentSegment)break;this.currentSegment.duration=Dv(e,s)}break;case Pe.TrackEntry:{if(!this.currentSegment)break;if(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusterPositionCache:[],cuePoints:[],isDefault:!1,inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,name:null,languageCode:Cs,decodingInstructions:[],info:null},this.readContiguousElements(e.slice(o,s)),this.currentTrack.decodingInstructions.some(a=>a.data?.type!=="decompress"||a.scope!==O0.Block||a.data.algorithm!==jh.HeaderStripping)&&(console.warn(`Track #${this.currentTrack.id} has an unsupported content encoding; dropping.`),this.currentTrack=null),this.currentTrack&&this.currentTrack.id!==-1&&this.currentTrack.codecId&&this.currentTrack.info){const a=this.currentTrack.codecId.indexOf("/"),l=a===-1?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,a);if(this.currentTrack.info.type==="video"&&this.currentTrack.info.width!==-1&&this.currentTrack.info.height!==-1){this.currentTrack.codecId===go.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===go.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):l===go.vp8?this.currentTrack.info.codec="vp8":l===go.vp9?this.currentTrack.info.codec="vp9":l===go.av1&&(this.currentTrack.info.codec="av1");const c=this.currentTrack,u=new fm(this.input,new See(c));this.currentTrack.inputTrack=u,this.currentSegment.tracks.push(this.currentTrack)}else if(this.currentTrack.info.type==="audio"&&this.currentTrack.info.numberOfChannels!==-1&&this.currentTrack.info.sampleRate!==-1){l===go.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2")},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===go.mp3?this.currentTrack.info.codec="mp3":l===go.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate,this.currentTrack.info.sampleRate=Ob):l===go.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):l===go.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId==="A_PCM/INT/LIT"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32"):this.currentTrack.codecId==="A_PCM/INT/BIG"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16be":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24be":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32be"):this.currentTrack.codecId==="A_PCM/FLOAT/IEEE"&&(this.currentTrack.info.bitDepth===32?this.currentTrack.info.codec="pcm-f32":this.currentTrack.info.bitDepth===64&&(this.currentTrack.info.codec="pcm-f64"));const c=this.currentTrack,u=new ol(this.input,new Eee(c));this.currentTrack.inputTrack=u,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null}break;case Pe.TrackNumber:{if(!this.currentTrack)break;this.currentTrack.id=Xt(e,s)}break;case Pe.TrackType:{if(!this.currentTrack)break;const a=Xt(e,s);a===1?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null,alphaMode:!1}:a===2&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case Pe.FlagEnabled:{if(!this.currentTrack)break;Xt(e,s)||(this.currentSegment.tracks.pop(),this.currentTrack=null)}break;case Pe.FlagDefault:{if(!this.currentTrack)break;this.currentTrack.isDefault=!!Xt(e,s)}break;case Pe.CodecID:{if(!this.currentTrack)break;this.currentTrack.codecId=pd(e,s)}break;case Pe.CodecPrivate:{if(!this.currentTrack)break;this.currentTrack.codecPrivate=It(e,s)}break;case Pe.DefaultDuration:{if(!this.currentTrack)break;this.currentTrack.defaultDuration=this.currentTrack.segment.timestampFactor*Xt(e,s)/1e9}break;case Pe.Name:{if(!this.currentTrack)break;this.currentTrack.name=ph(e,s)}break;case Pe.Language:{if(!this.currentTrack||this.currentTrack.languageCode!==Cs)break;this.currentTrack.languageCode=pd(e,s),Sp(this.currentTrack.languageCode)||(this.currentTrack.languageCode=Cs)}break;case Pe.LanguageBCP47:{if(!this.currentTrack)break;const l=pd(e,s).split("-")[0];l?this.currentTrack.languageCode=l:this.currentTrack.languageCode=Cs}break;case Pe.Video:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(o,s))}break;case Pe.PixelWidth:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.width=Xt(e,s)}break;case Pe.PixelHeight:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.height=Xt(e,s)}break;case Pe.AlphaMode:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.alphaMode=Xt(e,s)===1}break;case Pe.Colour:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e.slice(o,s))}break;case Pe.MatrixCoefficients:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Xt(e,s),l=QN[a]??null;this.currentTrack.info.colorSpace.matrix=l}break;case Pe.Range:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=Xt(e,s)===2}break;case Pe.TransferCharacteristics:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Xt(e,s),l=ZN[a]??null;this.currentTrack.info.colorSpace.transfer=l}break;case Pe.Primaries:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Xt(e,s),l=GN[a]??null;this.currentTrack.info.colorSpace.primaries=l}break;case Pe.Projection:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(o,s))}break;case Pe.ProjectionPoseRoll:{if(this.currentTrack?.info?.type!=="video")break;const l=-Dv(e,s);try{this.currentTrack.info.rotation=uk(l)}catch{}}break;case Pe.Audio:{if(this.currentTrack?.info?.type!=="audio")break;this.readContiguousElements(e.slice(o,s))}break;case Pe.SamplingFrequency:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.sampleRate=Dv(e,s)}break;case Pe.Channels:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.numberOfChannels=Xt(e,s)}break;case Pe.BitDepth:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.bitDepth=Xt(e,s)}break;case Pe.CuePoint:{if(!this.currentSegment)break;this.readContiguousElements(e.slice(o,s)),this.currentCueTime=null}break;case Pe.CueTime:this.currentCueTime=Xt(e,s);break;case Pe.CueTrackPositions:{if(this.currentCueTime===null)break;G(this.currentSegment);const a={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(a),this.readContiguousElements(e.slice(o,s)),(a.trackId===-1||a.clusterPosition===-1)&&this.currentSegment.cuePoints.pop()}break;case Pe.CueTrack:{const a=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!a)break;a.trackId=Xt(e,s)}break;case Pe.CueClusterPosition:{const a=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!a)break;G(this.currentSegment),a.clusterPosition=this.currentSegment.dataStartPos+Xt(e,s)}break;case Pe.Timestamp:{if(!this.currentCluster)break;this.currentCluster.timestamp=Xt(e,s)}break;case Pe.SimpleBlock:{if(!this.currentCluster)break;const a=Oh(e);if(a===null)break;const l=this.getTrackDataInCluster(this.currentCluster,a);if(!l)break;const c=u2(e),u=mt(e),d=!!(u&128),f=u>>1&3,h=It(e,s-(e.filePos-o)),p=l.track.decodingInstructions.length>0;l.blocks.push({timestamp:c,duration:0,isKeyFrame:d,referencedTimestamps:[],data:h,lacing:f,decoded:!p,mainAdditional:null})}break;case Pe.BlockGroup:{if(!this.currentCluster)break;if(this.readContiguousElements(e.slice(o,s)),this.currentBlock){for(let a=0;a<this.currentBlock.referencedTimestamps.length;a++)this.currentBlock.referencedTimestamps[a]+=this.currentBlock.timestamp;this.currentBlock=null}}break;case Pe.Block:{if(!this.currentCluster)break;const a=Oh(e);if(a===null)break;const l=this.getTrackDataInCluster(this.currentCluster,a);if(!l)break;const c=u2(e),d=mt(e)>>1&3,f=It(e,s-(e.filePos-o)),h=l.track.decodingInstructions.length>0;this.currentBlock={timestamp:c,duration:0,isKeyFrame:!0,referencedTimestamps:[],data:f,lacing:d,decoded:!h,mainAdditional:null},l.blocks.push(this.currentBlock)}break;case Pe.BlockAdditions:this.readContiguousElements(e.slice(o,s));break;case Pe.BlockMore:{if(!this.currentBlock)break;this.currentBlockAdditional={addId:1,data:null},this.readContiguousElements(e.slice(o,s)),this.currentBlockAdditional.data&&this.currentBlockAdditional.addId===1&&(this.currentBlock.mainAdditional=this.currentBlockAdditional.data),this.currentBlockAdditional=null}break;case Pe.BlockAdditional:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.data=It(e,s)}break;case Pe.BlockAddID:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.addId=Xt(e,s)}break;case Pe.BlockDuration:{if(!this.currentBlock)break;this.currentBlock.duration=Xt(e,s)}break;case Pe.ReferenceBlock:{if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1;const a=wee(e,s);this.currentBlock.referencedTimestamps.push(a)}break;case Pe.Tag:this.currentTagTargetIsMovie=!0,this.readContiguousElements(e.slice(o,s));break;case Pe.Targets:this.readContiguousElements(e.slice(o,s));break;case Pe.TargetTypeValue:Xt(e,s)!==50&&(this.currentTagTargetIsMovie=!1);break;case Pe.TagTrackUID:case Pe.TagEditionUID:case Pe.TagChapterUID:case Pe.TagAttachmentUID:this.currentTagTargetIsMovie=!1;break;case Pe.SimpleTag:{if(!this.currentTagTargetIsMovie)break;this.currentSimpleTagName=null,this.readContiguousElements(e.slice(o,s))}break;case Pe.TagName:this.currentSimpleTagName=ph(e,s);break;case Pe.TagString:{if(!this.currentSimpleTagName)break;const a=ph(e,s);this.processTagValue(this.currentSimpleTagName,a)}break;case Pe.TagBinary:{if(!this.currentSimpleTagName)break;const a=It(e,s);this.processTagValue(this.currentSimpleTagName,a)}break;case Pe.AttachedFile:{if(!this.currentSegment)break;this.currentAttachedFile={fileUid:null,fileName:null,fileMediaType:null,fileData:null,fileDescription:null},this.readContiguousElements(e.slice(o,s));const a=this.currentSegment.metadataTags;if(this.currentAttachedFile.fileUid&&this.currentAttachedFile.fileData&&(a.raw??={},a.raw[this.currentAttachedFile.fileUid.toString()]=new rR(this.currentAttachedFile.fileData,this.currentAttachedFile.fileMediaType??void 0,this.currentAttachedFile.fileName??void 0,this.currentAttachedFile.fileDescription??void 0)),this.currentAttachedFile.fileMediaType?.startsWith("image/")&&this.currentAttachedFile.fileData){const l=this.currentAttachedFile.fileName;let c="unknown";if(l){const u=l.toLowerCase();u.startsWith("cover.")?c="coverFront":u.startsWith("back.")&&(c="coverBack")}a.images??=[],a.images.push({data:this.currentAttachedFile.fileData,mimeType:this.currentAttachedFile.fileMediaType,kind:c,name:this.currentAttachedFile.fileName??void 0,description:this.currentAttachedFile.fileDescription??void 0})}this.currentAttachedFile=null}break;case Pe.FileUID:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileUid=bee(e,s)}break;case Pe.FileName:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileName=ph(e,s)}break;case Pe.FileMediaType:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileMediaType=pd(e,s)}break;case Pe.FileData:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileData=It(e,s)}break;case Pe.FileDescription:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileDescription=ph(e,s)}break;case Pe.ContentEncodings:{if(!this.currentTrack)break;this.readContiguousElements(e.slice(o,s)),this.currentTrack.decodingInstructions.sort((a,l)=>l.order-a.order)}break;case Pe.ContentEncoding:this.currentDecodingInstruction={order:0,scope:O0.Block,data:null},this.readContiguousElements(e.slice(o,s)),this.currentDecodingInstruction.data&&this.currentTrack.decodingInstructions.push(this.currentDecodingInstruction),this.currentDecodingInstruction=null;break;case Pe.ContentEncodingOrder:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.order=Xt(e,s)}break;case Pe.ContentEncodingScope:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.scope=Xt(e,s)}break;case Pe.ContentCompression:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decompress",algorithm:jh.Zlib,settings:null},this.readContiguousElements(e.slice(o,s))}break;case Pe.ContentCompAlgo:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.algorithm=Xt(e,s)}break;case Pe.ContentCompSettings:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.settings=It(e,s)}break;case Pe.ContentEncryption:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decrypt"}}break}return e.filePos=o+s,!0}decodeBlockData(e,n){G(e.decodingInstructions.length>0);let r=n;for(const i of e.decodingInstructions)switch(G(i.data),i.data.type){case"decompress":switch(i.data.algorithm){case jh.HeaderStripping:if(i.data.settings&&i.data.settings.length>0){const s=i.data.settings,o=new Uint8Array(s.length+r.length);o.set(s,0),o.set(r,s.length),r=o}break}break}return r}processTagValue(e,n){if(!this.currentSegment?.metadataTags)return;const r=this.currentSegment.metadataTags;if(r.raw??={},r.raw[e]??=n,typeof n=="string")switch(e.toLowerCase()){case"title":r.title??=n;break;case"description":r.description??=n;break;case"artist":r.artist??=n;break;case"album":r.album??=n;break;case"album_artist":r.albumArtist??=n;break;case"genre":r.genre??=n;break;case"comment":r.comment??=n;break;case"lyrics":r.lyrics??=n;break;case"date":{const i=new Date(n);Number.isNaN(i.getTime())||(r.date??=i)}break;case"track_number":case"part_number":{const i=n.split("/"),s=Number.parseInt(i[0],10),o=i[1]&&Number.parseInt(i[1],10);Number.isInteger(s)&&s>0&&(r.trackNumber??=s),o&&Number.isInteger(o)&&o>0&&(r.tracksTotal??=o)}break;case"disc_number":case"disc":{const i=n.split("/"),s=Number.parseInt(i[0],10),o=i[1]&&Number.parseInt(i[1],10);Number.isInteger(s)&&s>0&&(r.discNumber??=s),o&&Number.isInteger(o)&&o>0&&(r.discsTotal??=o)}break}}}class AR{constructor(e){this.internalTrack=e,this.packetToClusterLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.codecId}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}getTimeResolution(){return this.internalTrack.segment.timestampFactor}async getFirstPacket(e){return this.performClusterLookup(null,n=>n.trackData.get(this.internalTrack.id)?{blockIndex:0,correctBlockFound:!0}:{blockIndex:-1,correctBlockFound:!1},-1/0,1/0,e)}intoTimescale(e){return A0(e*this.internalTrack.segment.timestampFactor,14)}async getPacket(e,n){const r=this.intoTimescale(e);return this.performClusterLookup(null,i=>{const s=i.trackData.get(this.internalTrack.id);if(!s)return{blockIndex:-1,correctBlockFound:!1};const o=Mn(s.presentationTimestamps,r,c=>c.timestamp),a=o!==-1?s.presentationTimestamps[o].blockIndex:-1,l=o!==-1&&r<s.endTimestamp;return{blockIndex:a,correctBlockFound:l}},r,r,n)}async getNextPacket(e,n){const r=this.packetToClusterLocation.get(e);if(r===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(r.cluster,i=>{if(i===r.cluster){const s=i.trackData.get(this.internalTrack.id);if(r.blockIndex+1<s.blocks.length)return{blockIndex:r.blockIndex+1,correctBlockFound:!0}}else if(i.trackData.get(this.internalTrack.id))return{blockIndex:0,correctBlockFound:!0};return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,n)}async getKeyPacket(e,n){const r=this.intoTimescale(e);return this.performClusterLookup(null,i=>{const s=i.trackData.get(this.internalTrack.id);if(!s)return{blockIndex:-1,correctBlockFound:!1};const o=YN(s.presentationTimestamps,c=>s.blocks[c.blockIndex].isKeyFrame&&c.timestamp<=r),a=o!==-1?s.presentationTimestamps[o].blockIndex:-1,l=o!==-1&&r<s.endTimestamp;return{blockIndex:a,correctBlockFound:l}},r,r,n)}async getNextKeyPacket(e,n){const r=this.packetToClusterLocation.get(e);if(r===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(r.cluster,i=>{if(i===r.cluster){const o=i.trackData.get(this.internalTrack.id).blocks.findIndex((a,l)=>a.isKeyFrame&&l>r.blockIndex);if(o!==-1)return{blockIndex:o,correctBlockFound:!0}}else{const s=i.trackData.get(this.internalTrack.id);if(s&&s.firstKeyFrameTimestamp!==null){const o=s.blocks.findIndex(a=>a.isKeyFrame);return G(o!==-1),{blockIndex:o,correctBlockFound:!0}}}return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,n)}async fetchPacketInCluster(e,n,r){if(n===-1)return null;const s=e.trackData.get(this.internalTrack.id).blocks[n];G(s),s.decoded||(s.data=this.internalTrack.demuxer.decodeBlockData(this.internalTrack,s.data),s.decoded=!0);const o=r.metadataOnly?Rs:s.data,a=s.timestamp/this.internalTrack.segment.timestampFactor,l=s.duration/this.internalTrack.segment.timestampFactor,c={};s.mainAdditional&&this.internalTrack.info?.type==="video"&&this.internalTrack.info.alphaMode&&(c.alpha=r.metadataOnly?Rs:s.mainAdditional,c.alphaByteLength=s.mainAdditional.byteLength);const u=new Ln(o,s.isKeyFrame?"key":"delta",a,l,e.dataStartPos+n,s.data.byteLength,c);return this.packetToClusterLocation.set(u,{cluster:e,blockIndex:n}),u}async performClusterLookup(e,n,r,i,s){const{demuxer:o,segment:a}=this.internalTrack;let l=null,c=null,u=-1;if(e){const{blockIndex:y,correctBlockFound:b}=n(e);if(b)return this.fetchPacketInCluster(e,y,s);y!==-1&&(c=e,u=y)}const d=Mn(this.internalTrack.cuePoints,r,y=>y.time),f=d!==-1?this.internalTrack.cuePoints[d]:null,h=Mn(this.internalTrack.clusterPositionCache,r,y=>y.startTimestamp),p=h!==-1?this.internalTrack.clusterPositionCache[h]:null,m=Math.max(f?.clusterPosition??0,p?.elementStartPos??0)||null;let g;for(e?m===null||e.elementStartPos>=m?(g=e.elementEndPos,l=e):g=m:g=m??a.clusterSeekStartPos;a.elementEndPos===null||g<=a.elementEndPos-qs;){if(l){const T=l.trackData.get(this.internalTrack.id);if(T&&T.startTimestamp>i)break}let y=o.reader.requestSliceRange(g,qs,Ia);if(y instanceof Promise&&(y=await y),!y)break;const b=g,E=Sa(y);if(!E||!Tp.includes(E.id)&&E.id!==Pe.Void){const T=await _R(o.reader,b,Tp,Math.min(a.elementEndPos??1/0,b+CR));if(T){g=T;continue}else break}const C=E.id;let I=E.size;const x=y.filePos;if(C===Pe.Cluster){l=await o.readCluster(b,a),I=l.elementEndPos-x;const{blockIndex:T,correctBlockFound:S}=n(l);if(S)return this.fetchPacketInCluster(l,T,s);T!==-1&&(c=l,u=T)}I===null&&(G(C!==Pe.Cluster),I=(await i2(o.reader,x,Ag,a.elementEndPos)).pos-x);const P=x+I;if(a.elementEndPos===null){let T=o.reader.requestSliceRange(P,qs,Ia);if(T instanceof Promise&&(T=await T),!T)break;if(yk(T)===Pe.Segment){a.elementEndPos=P;break}}g=P}if(f&&(!c||c.elementStartPos<f.clusterPosition)){const y=this.internalTrack.cuePoints[d-1];G(!y||y.time<f.time);const b=y?.time??-1/0;return this.performClusterLookup(null,n,b,i,s)}return c?this.fetchPacketInCluster(c,u,s):null}}class See extends AR{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.info.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return this.internalTrack.info.alphaMode}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{let e=null;return(this.internalTrack.info.codec==="vp9"||this.internalTrack.info.codec==="av1"||this.internalTrack.info.codec==="avc"&&!this.internalTrack.info.codecDescription||this.internalTrack.info.codec==="hevc"&&!this.internalTrack.info.codecDescription)&&(e=await this.getFirstPacket({})),{codec:iR({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcCodecInfo:this.internalTrack.info.codec==="avc"&&e?dR(e.data):null,hevcCodecInfo:this.internalTrack.info.codec==="hevc"&&e?hR(e.data):null,vp9CodecInfo:this.internalTrack.info.codec==="vp9"&&e?pR(e.data):null,av1CodecInfo:this.internalTrack.info.codec==="av1"&&e?gR(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class Eee extends AR{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:sR({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const kee=t=>{const e=new Map;for(let s=0;s<t.length;s++){const o=t[s];e.set(o.timestamp,o)}const n=new Set,r=[],i=s=>{if(!n.has(s)){n.add(s);for(let o=0;o<s.referencedTimestamps.length;o++){const a=s.referencedTimestamps[o],l=e.get(a);l&&i(l)}r.push(s)}};for(let s=0;s<t.length;s++)i(t[s]);return r};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const IR=4,Tee=[44100,48e3,32e3],_ee=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1,-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1,-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],Cee=1483304551,Aee=1231971951,Iee=(t,e,n,r,i)=>e===0?0:e===1?Math.floor(144*n/(r<<t))+i:e===2?Math.floor(144*n/r)+i:(Math.floor(12*n/r)+i)*4,Pee=(t,e)=>t===3?e===3?21:36:e===3?13:21,Oee=(t,e)=>{const n=t>>>24,r=t>>>16&255,i=t>>>8&255,s=t&255;if(n!==255&&r!==255&&i!==255&&s!==255)return{header:null,bytesAdvanced:4};if(n!==255)return{header:null,bytesAdvanced:1};if((r&224)!==224)return{header:null,bytesAdvanced:1};let o=0,a=0;r&16?o=r&8?0:1:(o=1,a=1);const l=r>>3&3,c=r>>1&3,u=i>>4&15,d=(i>>2&3)%3,f=i>>1&1,h=s>>6&3,p=s>>4&3,m=s>>3&1,g=s>>2&1,y=s&3,b=_ee[o*16*4+c*16+u];if(b===-1)return{header:null,bytesAdvanced:1};const E=b*1e3,C=Tee[d]>>o+a,I=Iee(o,c,E,C,f);if(e!==null&&e<I)return{header:null,bytesAdvanced:1};let x;return l===3?x=c===3?384:1152:c===3?x=384:c===2?x=1152:x=576,{header:{totalSize:I,mpegVersionId:l,layer:c,bitrate:E,frequencyIndex:d,sampleRate:C,channel:h,modeExtension:p,copyright:m,original:g,emphasis:y,audioSamplesInFrame:x},bytesAdvanced:1}},s2=t=>{let e=2130706432,n=0;for(;e!==0;)n>>=1,n|=t&e,e>>=8;return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var Sd;(function(t){t[t.Unsynchronisation=128]="Unsynchronisation",t[t.ExtendedHeader=64]="ExtendedHeader",t[t.ExperimentalIndicator=32]="ExperimentalIndicator",t[t.Footer=16]="Footer"})(Sd||(Sd={}));var Ed;(function(t){t[t.ISO_8859_1=0]="ISO_8859_1",t[t.UTF_16_WITH_BOM=1]="UTF_16_WITH_BOM",t[t.UTF_16_BE_NO_BOM=2]="UTF_16_BE_NO_BOM",t[t.UTF_8=3]="UTF_8"})(Ed||(Ed={}));const Ig=128,M0=10,kd=["Blues","Classic rock","Country","Dance","Disco","Funk","Grunge","Hip-hop","Jazz","Metal","New age","Oldies","Other","Pop","Rhythm and blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death metal","Pranks","Soundtrack","Euro-techno","Ambient","Trip-hop","Vocal","Jazz & funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound clip","Gospel","Noise","Alternative rock","Bass","Soul","Punk","Space","Meditative","Instrumental pop","Instrumental rock","Ethnic","Gothic","Darkwave","Techno-industrial","Electronic","Pop-folk","Eurodance","Dream","Southern rock","Comedy","Cult","Gangsta","Top 40","Christian rap","Pop/funk","Jungle music","Native US","Cabaret","New wave","Psychedelic","Rave","Showtunes","Trailer","Lo-fi","Tribal","Acid punk","Acid jazz","Polka","Retro","Musical","Rock 'n' roll","Hard rock","Folk","Folk rock","National folk","Swing","Fast fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic rock","Progressive rock","Psychedelic rock","Symphonic rock","Slow rock","Big band","Chorus","Easy listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber music","Sonata","Symphony","Booty bass","Primus","Porn groove","Satire","Slow jam","Club","Tango","Samba","Folklore","Ballad","Power ballad","Rhythmic Soul","Freestyle","Duet","Punk rock","Drum solo","A cappella","Euro-house","Dance hall","Goa music","Drum & bass","Club-house","Hardcore techno","Terror","Indie","Britpop","Negerpunk","Polsk punk","Beat","Christian gangsta rap","Heavy metal","Black metal","Crossover","Contemporary Christian","Christian rock","Merengue","Salsa","Thrash metal","Anime","Jpop","Synthpop","Christmas","Art rock","Baroque","Bhangra","Big beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math rock","New romantic","Nu-breakz","Post-punk","Post-rock","Psytrance","Shoegaze","Space rock","Trop rock","World music","Neoclassical","Audiobook","Audio theatre","Neue Deutsche Welle","Podcast","Indie rock","G-Funk","Dubstep","Garage rock","Psybient"],Mee=(t,e)=>{const n=t.filePos;e.raw??={},e.raw.TAG??=It(t,Ig-3),t.filePos=n;const r=od(t,30);r&&(e.title??=r);const i=od(t,30);i&&(e.artist??=i);const s=od(t,30);s&&(e.album??=s);const o=od(t,4),a=Number.parseInt(o,10);Number.isInteger(a)&&a>0&&(e.date??=new Date(a,0,1));const l=It(t,30);let c;if(l[28]===0&&l[29]!==0){const d=l[29];d>0&&(e.trackNumber??=d),t.skip(-30),c=od(t,28),t.skip(2)}else t.skip(-30),c=od(t,30);c&&(e.comment??=c);const u=mt(t);u<kd.length&&(e.genre??=kd[u])},od=(t,e)=>{const n=It(t,e),r=hd(n.indexOf(0),n.length),i=n.subarray(0,r);let s="";for(let o=0;o<i.length;o++)s+=String.fromCharCode(i[o]);return s.trimEnd()},N0=t=>{const e=t.filePos,n=$r(t,3),r=mt(t),i=mt(t),s=mt(t),o=et(t);if(n!=="ID3"||r===255||i===255||(o&2155905152)!==0)return t.filePos=e,null;const a=s2(o);return{majorVersion:r,revision:i,flags:s,size:a}},PR=(t,e,n)=>{if(![2,3,4].includes(e.majorVersion)){console.warn(`Unsupported ID3v2 major version: ${e.majorVersion}`);return}const r=It(t,e.size),i=new Nee(e,r);if(e.flags&Sd.Footer&&i.removeFooter(),e.flags&Sd.Unsynchronisation&&e.majorVersion===3&&i.ununsynchronizeAll(),e.flags&Sd.ExtendedHeader){const s=i.readU32();e.majorVersion===3?i.pos+=s:i.pos+=s-4}for(;i.pos<=i.bytes.length-i.frameHeaderSize();){const s=i.readId3V2Frame();if(!s)break;const o=i.pos,a=i.pos+s.size;let l=!1,c=!1,u=!1;if(e.majorVersion===3?(l=!!(s.flags&64),c=!!(s.flags&128)):e.majorVersion===4&&(l=!!(s.flags&4),c=!!(s.flags&8),u=!!(s.flags&2)||!!(e.flags&Sd.Unsynchronisation)),l){console.warn(`Skipping encrypted ID3v2 frame ${s.id}`),i.pos=a;continue}if(c){console.warn(`Skipping compressed ID3v2 frame ${s.id}`),i.pos=a;continue}switch(u&&i.ununsynchronizeRegion(i.pos,a),n.raw??={},s.id[0]==="T"?n.raw[s.id]??=i.readId3V2EncodingAndText(a):n.raw[s.id]??=i.readBytes(s.size),i.pos=o,s.id){case"TIT2":case"TT2":n.title??=i.readId3V2EncodingAndText(a);break;case"TIT3":case"TT3":n.description??=i.readId3V2EncodingAndText(a);break;case"TPE1":case"TP1":n.artist??=i.readId3V2EncodingAndText(a);break;case"TALB":case"TAL":n.album??=i.readId3V2EncodingAndText(a);break;case"TPE2":case"TP2":n.albumArtist??=i.readId3V2EncodingAndText(a);break;case"TRCK":case"TRK":{const f=i.readId3V2EncodingAndText(a).split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(n.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(n.tracksTotal??=p)}break;case"TPOS":case"TPA":{const f=i.readId3V2EncodingAndText(a).split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(n.discNumber??=h),p&&Number.isInteger(p)&&p>0&&(n.discsTotal??=p)}break;case"TCON":case"TCO":{const d=i.readId3V2EncodingAndText(a);let f=/^\((\d+)\)/.exec(d);if(f){const h=Number.parseInt(f[1]);if(kd[h]!==void 0){n.genre??=kd[h];break}}if(f=/^\d+$/.exec(d),f){const h=Number.parseInt(f[0]);if(kd[h]!==void 0){n.genre??=kd[h];break}}n.genre??=d}break;case"TDRC":case"TDAT":{const d=i.readId3V2EncodingAndText(a),f=new Date(d);Number.isNaN(f.getTime())||(n.date??=f)}break;case"TYER":case"TYE":{const d=i.readId3V2EncodingAndText(a),f=Number.parseInt(d,10);Number.isInteger(f)&&(n.date??=new Date(f,0,1))}break;case"USLT":case"ULT":{const d=i.readU8();i.pos+=3,i.readId3V2Text(d,a),n.lyrics??=i.readId3V2Text(d,a)}break;case"COMM":case"COM":{const d=i.readU8();i.pos+=3,i.readId3V2Text(d,a),n.comment??=i.readId3V2Text(d,a)}break;case"APIC":case"PIC":{const d=i.readId3V2TextEncoding();let f;if(e.majorVersion===2){const g=i.readAscii(3);f=g==="PNG"?"image/png":g==="JPG"?"image/jpeg":"image/*"}else f=i.readId3V2Text(d,a);const h=i.readU8(),p=i.readId3V2Text(d,a).trimEnd(),m=a-i.pos;if(m>=0){const g=i.readBytes(m);n.images||(n.images=[]),n.images.push({data:g,mimeType:f,kind:h===3?"coverFront":h===4?"coverBack":"unknown",description:p})}}break;default:i.pos+=s.size;break}i.pos=a}};class Nee{constructor(e,n){this.header=e,this.bytes=n,this.pos=0,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength)}frameHeaderSize(){return this.header.majorVersion===2?6:10}ununsynchronizeAll(){const e=[];for(let n=0;n<this.bytes.length;n++){const r=this.bytes[n];e.push(r),r===255&&n!==this.bytes.length-1&&this.bytes[n]===0&&n++}this.bytes=new Uint8Array(e),this.view=new DataView(this.bytes.buffer)}ununsynchronizeRegion(e,n){const r=[];for(let o=e;o<n;o++){const a=this.bytes[o];r.push(a),a===255&&o!==n-1&&this.bytes[o+1]===0&&o++}const i=this.bytes.subarray(0,e),s=this.bytes.subarray(n);this.bytes=new Uint8Array(i.length+r.length+s.length),this.bytes.set(i,0),this.bytes.set(r,i.length),this.bytes.set(s,i.length+r.length),this.view=new DataView(this.bytes.buffer)}removeFooter(){this.bytes=this.bytes.subarray(0,this.bytes.length-M0),this.view=new DataView(this.bytes.buffer)}readBytes(e){const n=this.bytes.subarray(this.pos,this.pos+e);return this.pos+=e,n}readU8(){const e=this.view.getUint8(this.pos);return this.pos+=1,e}readU16(){const e=this.view.getUint16(this.pos,!1);return this.pos+=2,e}readU24(){const e=this.view.getUint16(this.pos,!1),n=this.view.getUint8(this.pos+1);return this.pos+=3,e*256+n}readU32(){const e=this.view.getUint32(this.pos,!1);return this.pos+=4,e}readAscii(e){let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(this.view.getUint8(this.pos+r));return this.pos+=e,n}readId3V2Frame(){if(this.header.majorVersion===2){const e=this.readAscii(3);if(e==="\0\0\0")return null;const n=this.readU24();return{id:e,size:n,flags:0}}else{const e=this.readAscii(4);if(e==="\0\0\0\0")return null;const n=this.readU32();let r=this.header.majorVersion===4?s2(n):n;const i=this.readU16(),s=this.pos,o=a=>{const l=this.pos+a;if(l>this.bytes.length)return!1;if(l<=this.bytes.length-this.frameHeaderSize()){this.pos+=a;const c=this.readAscii(4);if(c!=="\0\0\0\0"&&!/[0-9A-Z]{4}/.test(c))return!1}return!0};if(!o(r)){const a=this.header.majorVersion===4?n:s2(n);o(a)&&(r=a)}return this.pos=s,{id:e,size:r,flags:i}}}readId3V2TextEncoding(){const e=this.readU8();if(e>3)throw new Error(`Unsupported text encoding: ${e}`);return e}readId3V2Text(e,n){const r=this.pos,i=this.readBytes(n-this.pos);switch(e){case Ed.ISO_8859_1:{let s="";for(let o=0;o<i.length;o++){const a=i[o];if(a===0){this.pos=r+o+1;break}s+=String.fromCharCode(a)}return s}case Ed.UTF_16_WITH_BOM:if(i[0]===255&&i[1]===254){const s=new TextDecoder("utf-16le"),o=hd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(2,o))}else if(i[0]===254&&i[1]===255){const s=new TextDecoder("utf-16be"),o=hd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(2,o))}else{const s=hd(i.findIndex(o=>o===0),i.length);return this.pos=r+Math.min(s+1,i.length),Ps.decode(i.subarray(0,s))}case Ed.UTF_16_BE_NO_BOM:{const s=new TextDecoder("utf-16be"),o=hd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(0,o))}case Ed.UTF_8:{const s=hd(i.findIndex(o=>o===0),i.length);return this.pos=r+Math.min(s+1,i.length),Ps.decode(i.subarray(0,s))}}}readId3V2EncodingAndText(e){if(this.pos>=e)return"";const n=this.readId3V2TextEncoding();return this.readId3V2Text(n,e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const o2=async(t,e,n)=>{let r=e;for(;n===null||r<n;){let i=t.requestSlice(r,IR);if(i instanceof Promise&&(i=await i),!i)break;const s=et(i),o=Oee(s,t.fileSize!==null?t.fileSize-r:null);if(o.header)return{header:o.header,startPos:r};r+=o.bytesAdvanced}return null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Ree extends ju{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.metadataTags=null,this.tracks=[],this.readingMutex=new Ff,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();if(!this.firstFrameHeader)throw new Error("No valid MP3 frame found.");this.tracks=[new ol(this.input,new Dee(this))]})()}async advanceReader(){if(this.lastLoadedPos===0)for(;;){let a=this.reader.requestSlice(this.lastLoadedPos,M0);if(a instanceof Promise&&(a=await a),!a){this.lastSampleLoaded=!0;return}const l=N0(a);if(!l)break;this.lastLoadedPos=a.filePos+l.size}const e=await o2(this.reader,this.lastLoadedPos,this.reader.fileSize);if(!e){this.lastSampleLoaded=!0;return}const n=e.header;this.lastLoadedPos=e.startPos+n.totalSize-1;const r=Pee(n.mpegVersionId,n.channel);let i=this.reader.requestSlice(e.startPos+r,4);if(i instanceof Promise&&(i=await i),i){const a=et(i);if(a===Cee||a===Aee)return}this.firstFrameHeader||(this.firstFrameHeader=n),n.sampleRate!==this.firstFrameHeader.sampleRate&&console.warn(`MP3 changed sample rate mid-file: ${this.firstFrameHeader.sampleRate} Hz to ${n.sampleRate} Hz. Might be a bug, so please report this file.`);const s=n.audioSamplesInFrame/this.firstFrameHeader.sampleRate,o={timestamp:this.nextTimestampInSamples/this.firstFrameHeader.sampleRate,duration:s,dataStart:e.startPos,dataSize:n.totalSize};this.loadedSamples.push(o),this.nextTimestampInSamples+=n.audioSamplesInFrame}async getMimeType(){return"audio/mpeg"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return G(e),e.computeDuration()}async getMetadataTags(){const e=await this.readingMutex.acquire();try{if(await this.readMetadata(),this.metadataTags)return this.metadataTags;this.metadataTags={};let n=0,r=!1;for(;;){let i=this.reader.requestSlice(n,M0);if(i instanceof Promise&&(i=await i),!i)break;const s=N0(i);if(!s)break;r=!0;let o=this.reader.requestSlice(i.filePos,s.size);if(o instanceof Promise&&(o=await o),!o)break;PR(o,s,this.metadataTags),n=i.filePos+s.size}if(!r&&this.reader.fileSize!==null&&this.reader.fileSize>=Ig){let i=this.reader.requestSlice(this.reader.fileSize-Ig,Ig);i instanceof Promise&&(i=await i),G(i),$r(i,3)==="TAG"&&Mee(i,this.metadataTags)}return this.metadataTags}finally{e()}}}class Dee{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return G(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return Cs}getCodec(){return"mp3"}getInternalCodecId(){return null}getNumberOfChannels(){return G(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.channel===3?1:2}getSampleRate(){return G(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}async getDecoderConfig(){return G(this.demuxer.firstFrameHeader),{codec:"mp3",numberOfChannels:this.demuxer.firstFrameHeader.channel===3?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}}async getPacketAtIndex(e,n){if(e===-1)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=Rs;else{let s=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize);if(s instanceof Promise&&(s=await s),!s)return null;i=It(s,r.dataSize)}return new Ln(i,"key",r.timestamp,r.duration,e,r.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=fk(this.demuxer.loadedSamples,e.timestamp,o=>o.timestamp);if(i===-1)throw new Error("Packet was not created from this track.");const s=i+1;for(;s>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(s,n)}finally{r()}}async getPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=Mn(this.demuxer.loadedSamples,e,s=>s.timestamp);if(i===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(i,n);if(i>=0&&i+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(i,n);await this.demuxer.advanceReader()}}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const OR=1399285583,Lee=79764919,MR=new Uint32Array(256);for(let t=0;t<256;t++){let e=t<<24;for(let n=0;n<8;n++)e=e&2147483648?e<<1^Lee:e<<1;MR[t]=e>>>0&4294967295}const Bee=t=>{const e=ti(t),n=e.getUint32(22,!0);e.setUint32(22,0,!0);let r=0;for(let i=0;i<t.length;i++){const s=t[i];r=(r<<8^MR[r>>>24^s])>>>0}return e.setUint32(22,n,!0),r},Fee=(t,e,n)=>{let r=0,i=null;if(t.length>0)if(e.codec==="vorbis"){G(e.vorbisInfo);const s=e.vorbisInfo.modeBlockflags.length,a=(1<<vJ(s-1))-1<<1,l=(t[0]&a)>>1;if(l>=e.vorbisInfo.modeBlockflags.length)throw new Error("Invalid mode number.");let c=n;const u=e.vorbisInfo.modeBlockflags[l];if(i=e.vorbisInfo.blocksizes[u],u===1){const d=(a|1)+1,f=t[0]&d?1:0;c=e.vorbisInfo.blocksizes[f]}r=c!==null?c+i>>2:0}else e.codec==="opus"&&(r=QJ(t).durationInSamples);return{durationInSamples:r,vorbisBlockSize:i}},$ee=t=>{let e="audio/ogg";if(t.codecStrings){const n=[...new Set(t.codecStrings)];e+=`; codecs="${n.join(", ")}"`}return e};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const su=27,Vd=282,zee=Vd+65025,qh=t=>{const e=t.filePos;if(Td(t)!==OR)return null;t.skip(1);const r=mt(t),i=kte(t),s=Td(t),o=Td(t),a=Td(t),l=mt(t),c=new Uint8Array(l);for(let h=0;h<l;h++)c[h]=mt(t);const u=27+l,d=c.reduce((h,p)=>h+p,0),f=u+d;return{headerStartPos:e,totalSize:f,dataStartPos:e+u,dataSize:d,headerType:r,granulePosition:i,serialNumber:s,sequenceNumber:o,checksum:a,lacingValues:c}},Uee=(t,e)=>{for(;t.filePos<e-3;){const n=Td(t),r=n&255,i=n>>>8&255,s=n>>>16&255,o=n>>>24&255,a=79;if(!(r!==a&&i!==a&&s!==a&&o!==a)){if(t.skip(-4),n===OR)return!0;t.skip(1)}}return!1};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Hee extends ju{constructor(e){super(e),this.metadataPromise=null,this.bitstreams=[],this.tracks=[],this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,su,Vd);if(n instanceof Promise&&(n=await n),!n)break;const r=qh(n);if(!r||!!!(r.headerType&2))break;this.bitstreams.push({serialNumber:r.serialNumber,bosPage:r,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),e=r.headerStartPos+r.totalSize}for(const n of this.bitstreams){const r=await this.readPacket(n.bosPage,0);r&&(r.data.byteLength>=7&&r.data[0]===1&&r.data[1]===118&&r.data[2]===111&&r.data[3]===114&&r.data[4]===98&&r.data[5]===105&&r.data[6]===115?await this.readVorbisMetadata(r,n):r.data.byteLength>=8&&r.data[0]===79&&r.data[1]===112&&r.data[2]===117&&r.data[3]===115&&r.data[4]===72&&r.data[5]===101&&r.data[6]===97&&r.data[7]===100&&await this.readOpusMetadata(r,n),n.codecInfo.codec!==null&&this.tracks.push(new ol(this.input,new Vee(n,this))))}})()}async readVorbisMetadata(e,n){let r=await this.findNextPacketStart(e);if(!r)return;const i=await this.readPacket(r.startPage,r.startSegmentIndex);if(!i||(r=await this.findNextPacketStart(i),!r))return;const s=await this.readPacket(r.startPage,r.startSegmentIndex);if(!s||i.data[0]!==3||s.data[0]!==5)return;const o=[],a=d=>{for(;o.push(Math.min(255,d)),!(d<255);)d-=255};a(e.data.length),a(i.data.length);const l=new Uint8Array(1+o.length+e.data.length+i.data.length+s.data.length);l[0]=2,l.set(o,1),l.set(e.data,1+o.length),l.set(i.data,1+o.length+e.data.length),l.set(s.data,1+o.length+e.data.length+i.data.length),n.codecInfo.codec="vorbis",n.description=l,n.lastMetadataPacket=s;const c=ti(e.data);n.numberOfChannels=c.getUint8(11),n.sampleRate=c.getUint32(12,!0);const u=c.getUint8(28);n.codecInfo.vorbisInfo={blocksizes:[1<<(u&15),1<<(u>>4)],modeBlockflags:XJ(s.data).modeBlockflags},Jx(i.data.subarray(7),this.metadataTags)}async readOpusMetadata(e,n){const r=await this.findNextPacketStart(e);if(!r)return;const i=await this.readPacket(r.startPage,r.startSegmentIndex);if(!i)return;n.codecInfo.codec="opus",n.description=e.data,n.lastMetadataPacket=i;const s=yR(e.data);n.numberOfChannels=s.outputChannelCount,n.sampleRate=Ob,n.codecInfo.opusInfo={preSkip:s.preSkip},Jx(i.data.subarray(8),this.metadataTags)}async readPacket(e,n){G(n<e.lacingValues.length);let r=0;for(let d=0;d<n;d++)r+=e.lacingValues[d];let i=e,s=r,o=n;const a=[];e:for(;;){let d=this.reader.requestSlice(i.dataStartPos,i.dataSize);d instanceof Promise&&(d=await d),G(d);const f=It(d,i.dataSize);for(;;){if(o===i.lacingValues.length){a.push(f.subarray(r,s));break}const p=i.lacingValues[o];if(s+=p,p<255){a.push(f.subarray(r,s));break e}o++}let h=i.headerStartPos+i.totalSize;for(;;){let p=this.reader.requestSliceRange(h,su,Vd);if(p instanceof Promise&&(p=await p),!p)return null;const m=qh(p);if(!m)return null;if(i=m,i.serialNumber===e.serialNumber)break;h=i.headerStartPos+i.totalSize}r=0,s=0,o=0}const l=a.reduce((d,f)=>d+f.length,0),c=new Uint8Array(l);let u=0;for(let d=0;d<a.length;d++){const f=a[d];c.set(f,u),u+=f.length}return{data:c,endPage:i,endSegmentIndex:o}}async findNextPacketStart(e){if(e.endSegmentIndex<e.endPage.lacingValues.length-1)return{startPage:e.endPage,startSegmentIndex:e.endSegmentIndex+1};if(!!(e.endPage.headerType&4))return null;let r=e.endPage.headerStartPos+e.endPage.totalSize;for(;;){let i=this.reader.requestSliceRange(r,su,Vd);if(i instanceof Promise&&(i=await i),!i)return null;const s=qh(i);if(!s)return null;if(s.serialNumber===e.endPage.serialNumber)return{startPage:s,startSegmentIndex:0};r=s.headerStartPos+s.totalSize}}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(n=>n.getCodecParameterString()));return $ee({codecStrings:e.filter(Boolean)})}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}class Vee{constructor(e,n){this.bitstream=e,this.demuxer=n,this.encodedPacketToMetadata=new WeakMap,this.sequentialScanCache=[],this.sequentialScanMutex=new Ff,this.internalSampleRate=e.codecInfo.codec==="opus"?Ob:e.sampleRate}getId(){return this.bitstream.serialNumber}getNumberOfChannels(){return this.bitstream.numberOfChannels}getSampleRate(){return this.bitstream.sampleRate}getTimeResolution(){return this.bitstream.sampleRate}getCodec(){return this.bitstream.codecInfo.codec}getInternalCodecId(){return null}async getDecoderConfig(){return G(this.bitstream.codecInfo.codec),{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:this.bitstream.description??void 0}}getName(){return null}getLanguageCode(){return Cs}async getFirstTimestamp(){return 0}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}granulePositionToTimestampInSamples(e){return this.bitstream.codecInfo.codec==="opus"?(G(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}createEncodedPacketFromOggPacket(e,n,r){if(!e)return null;const{durationInSamples:i,vorbisBlockSize:s}=Fee(e.data,this.bitstream.codecInfo,n.vorbisLastBlocksize),o=new Ln(r.metadataOnly?Rs:e.data,"key",Math.max(0,n.timestampInSamples)/this.internalSampleRate,i/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(o,{packet:e,timestampInSamples:n.timestampInSamples,durationInSamples:i,vorbisLastBlockSize:n.vorbisLastBlocksize,vorbisBlockSize:s}),o}async getFirstPacket(e){G(this.bitstream.lastMetadataPacket);const n=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!n)return null;let r=0;this.bitstream.codecInfo.codec==="opus"&&(G(this.bitstream.codecInfo.opusInfo),r-=this.bitstream.codecInfo.opusInfo.preSkip);const i=await this.demuxer.readPacket(n.startPage,n.startSegmentIndex);return this.createEncodedPacketFromOggPacket(i,{timestampInSamples:r,vorbisLastBlocksize:null},e)}async getNextPacket(e,n){const r=this.encodedPacketToMetadata.get(e);if(!r)throw new Error("Packet was not created from this track.");const i=await this.demuxer.findNextPacketStart(r.packet);if(!i)return null;const s=r.timestampInSamples+r.durationInSamples,o=await this.demuxer.readPacket(i.startPage,i.startSegmentIndex);return this.createEncodedPacketFromOggPacket(o,{timestampInSamples:s,vorbisLastBlocksize:r.vorbisBlockSize},n)}async getPacket(e,n){if(this.demuxer.reader.fileSize===null)return this.getPacketSequential(e,n);const r=A0(e*this.internalSampleRate,14);if(r===0)return this.getFirstPacket(n);if(r<0)return null;G(this.bitstream.lastMetadataPacket);const i=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!i)return null;let s=i.startPage,o=this.demuxer.reader.fileSize;const a=[s];e:for(;s.headerStartPos+s.totalSize<o;){const b=s.headerStartPos,E=Math.floor((b+o)/2);let C=E;for(;;){const I=Math.min(C+zee,o-su);let x=this.demuxer.reader.requestSlice(C,I-C);if(x instanceof Promise&&(x=await x),G(x),!Uee(x,I)){o=E+su;continue e}let T=this.demuxer.reader.requestSliceRange(x.filePos,su,Vd);T instanceof Promise&&(T=await T),G(T);const S=qh(T);G(S);let _=!1;if(S.serialNumber===this.bitstream.serialNumber)_=!0;else{let F=this.demuxer.reader.requestSlice(S.headerStartPos,S.totalSize);F instanceof Promise&&(F=await F),G(F);const L=It(F,S.totalSize);_=Bee(L)===S.checksum}if(!_){C=S.headerStartPos+4;continue}if(_&&S.serialNumber!==this.bitstream.serialNumber){C=S.headerStartPos+S.totalSize;continue}if(S.granulePosition===-1){C=S.headerStartPos+S.totalSize;continue}this.granulePositionToTimestampInSamples(S.granulePosition)>r?o=S.headerStartPos:(s=S,a.push(S));continue e}}let l=i.startPage;for(const b of a){if(b.granulePosition===s.granulePosition)break;(!l||b.headerStartPos>l.headerStartPos)&&(l=b)}let c=l;const u=[c];for(;!(c.serialNumber===this.bitstream.serialNumber&&c.granulePosition===s.granulePosition);){const b=c.headerStartPos+c.totalSize;let E=this.demuxer.reader.requestSliceRange(b,su,Vd);E instanceof Promise&&(E=await E),G(E);const C=qh(E);G(C),c=C,c.serialNumber===this.bitstream.serialNumber&&u.push(c)}G(c.granulePosition!==-1);let d=null,f,h,p=c,m=0;if(c.headerStartPos===i.startPage.headerStartPos)f=this.granulePositionToTimestampInSamples(0),h=!0,d=0;else{f=0,h=!1;for(let C=c.lacingValues.length-1;C>=0;C--)if(c.lacingValues[C]<255){d=C+1;break}if(d===null)throw new Error("Invalid page with granule position: no packets end on this page.");m=d-1;const b={data:Rs,endPage:p,endSegmentIndex:m};if(await this.demuxer.findNextPacketStart(b)){const C=eI(u,c,d);G(C);const I=JA(u,C.page,C.segmentIndex);I&&(c=I.page,d=I.segmentIndex)}else for(;;){const C=eI(u,c,d);if(!C)break;const I=JA(u,C.page,C.segmentIndex);if(!I)break;if(c=I.page,d=I.segmentIndex,C.page.headerStartPos!==p.headerStartPos){p=C.page,m=C.segmentIndex;break}}}let g=null,y=null;for(;c!==null;){G(d!==null);const b=await this.demuxer.readPacket(c,d);if(!b)break;if(!(c.headerStartPos===i.startPage.headerStartPos&&d<i.startSegmentIndex)){let I=this.createEncodedPacketFromOggPacket(b,{timestampInSamples:f,vorbisLastBlocksize:y?.vorbisBlockSize??null},n);G(I);let x=this.encodedPacketToMetadata.get(I);if(G(x),!h&&b.endPage.headerStartPos===p.headerStartPos&&b.endSegmentIndex===m?(f=this.granulePositionToTimestampInSamples(c.granulePosition),h=!0,I=this.createEncodedPacketFromOggPacket(b,{timestampInSamples:f-x.durationInSamples,vorbisLastBlocksize:y?.vorbisBlockSize??null},n),G(I),x=this.encodedPacketToMetadata.get(I),G(x)):f+=x.durationInSamples,g=I,y=x,h&&(Math.max(f,0)>r||Math.max(x.timestampInSamples,0)===r))break}const C=await this.demuxer.findNextPacketStart(b);if(!C)break;c=C.startPage,d=C.startSegmentIndex}return g}async getPacketSequential(e,n){const r=await this.sequentialScanMutex.acquire();try{const i=A0(e*this.internalSampleRate,14);e=i/this.internalSampleRate;const s=Mn(this.sequentialScanCache,i,l=>l.timestampInSamples);let o;if(s!==-1){const l=this.sequentialScanCache[s];o=this.createEncodedPacketFromOggPacket(l.packet,{timestampInSamples:l.timestampInSamples,vorbisLastBlocksize:l.vorbisLastBlockSize},n)}else o=await this.getFirstPacket(n);let a=0;for(;o&&o.timestamp<e;){const l=await this.getNextPacket(o,n);if(!l||l.timestamp>e)break;if(o=l,a++,a===100){a=0;const c=this.encodedPacketToMetadata.get(o);G(c),this.sequentialScanCache.length>0&&G(hr(this.sequentialScanCache).timestampInSamples<=c.timestampInSamples),this.sequentialScanCache.push(c)}}return o}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const JA=(t,e,n)=>{let r=e,i=n;e:for(;;){for(i--,i;i>=0;i--)if(r.lacingValues[i]<255){i++;break e}if(G(i===-1),!(r.headerType&1)){i=0;break}const o=XN(t,a=>a.headerStartPos<r.headerStartPos);if(!o)return null;r=o,i=r.lacingValues.length}if(G(i!==-1),i===r.lacingValues.length){const s=t[t.indexOf(r)+1];G(s),r=s,i=0}return{page:r,segmentIndex:i}},eI=(t,e,n)=>{if(n>0)return{page:e,segmentIndex:n-1};const r=XN(t,i=>i.headerStartPos<e.headerStartPos);return r?{page:r,segmentIndex:r.lacingValues.length-1}:null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var ba;(function(t){t[t.PCM=1]="PCM",t[t.IEEE_FLOAT=3]="IEEE_FLOAT",t[t.ALAW=6]="ALAW",t[t.MULAW=7]="MULAW",t[t.EXTENSIBLE=65534]="EXTENSIBLE"})(ba||(ba={}));class Wee extends ju{constructor(e){super(e),this.metadataPromise=null,this.dataStart=-1,this.dataSize=-1,this.audioInfo=null,this.tracks=[],this.lastKnownPacketIndex=0,this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=this.reader.requestSlice(0,12);e instanceof Promise&&(e=await e),G(e);const n=$r(e,4),r=n!=="RIFX",i=n==="RF64",s=Yl(e,r);let o=i?this.reader.fileSize:Math.min(s+8,this.reader.fileSize??1/0);if($r(e,4)!=="WAVE")throw new Error("Invalid WAVE file - wrong format");let l=0,c=null,u=e.filePos;for(;o===null||u<o;){let f=this.reader.requestSlice(u,8);if(f instanceof Promise&&(f=await f),!f)break;const h=$r(f,4),p=Yl(f,r),m=f.filePos;if(i&&l===0&&h!=="ds64")throw new Error('Invalid RF64 file: First chunk must be "ds64".');if(h==="fmt ")await this.parseFmtChunk(m,p,r);else if(h==="data"){if(c??=p,this.dataStart=f.filePos,this.dataSize=Math.min(c,(o??1/0)-this.dataStart),this.reader.fileSize===null)break}else if(h==="ds64"){let g=this.reader.requestSlice(m,p);if(g instanceof Promise&&(g=await g),!g)break;const y=rI(g,r);c=rI(g,r),o=Math.min(y+8,this.reader.fileSize??1/0)}else h==="LIST"?await this.parseListChunk(m,p,r):(h==="ID3 "||h==="id3 ")&&await this.parseId3Chunk(m,p);u=m+p+(p&1),l++}if(!this.audioInfo)throw new Error('Invalid WAVE file - missing "fmt " chunk');if(this.dataStart===-1)throw new Error('Invalid WAVE file - missing "data" chunk');const d=this.audioInfo.blockSizeInBytes;this.dataSize=Math.floor(this.dataSize/d)*d,this.tracks.push(new ol(this.input,new jee(this)))})()}async parseFmtChunk(e,n,r){let i=this.reader.requestSlice(e,n);if(i instanceof Promise&&(i=await i),!i)return;let s=mh(i,r);const o=mh(i,r),a=Yl(i,r);i.skip(4);const l=mh(i,r);let c;if(n===14?c=8:c=mh(i,r),n>=18&&s!==357){const u=mh(i,r),d=n-18;if(Math.min(d,u)>=22&&s===ba.EXTENSIBLE){i.skip(6);const h=It(i,16);s=h[0]|h[1]<<8}}(s===ba.MULAW||s===ba.ALAW)&&(c=8),this.audioInfo={format:s,numberOfChannels:o,sampleRate:a,sampleSizeInBytes:Math.ceil(c/8),blockSizeInBytes:l}}async parseListChunk(e,n,r){let i=this.reader.requestSlice(e,n);if(i instanceof Promise&&(i=await i),!i)return;const s=$r(i,4);if(s!=="INFO"&&s!=="INF0")return;let o=i.filePos;for(;o<=e+n-8;){i.filePos=o;const a=$r(i,4),l=Yl(i,r),c=It(i,l);let u=0;for(let f=0;f<c.length&&c[f]!==0;f++)u++;const d=String.fromCharCode(...c.subarray(0,u));switch(this.metadataTags.raw??={},this.metadataTags.raw[a]=d,a){case"INAM":case"TITL":this.metadataTags.title??=d;break;case"TIT3":this.metadataTags.description??=d;break;case"IART":this.metadataTags.artist??=d;break;case"IPRD":this.metadataTags.album??=d;break;case"IPRT":case"ITRK":case"TRCK":{const f=d.split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(this.metadataTags.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(this.metadataTags.tracksTotal??=p)}break;case"ICRD":case"IDIT":{const f=new Date(d);Number.isNaN(f.getTime())||(this.metadataTags.date??=f)}break;case"YEAR":{const f=Number.parseInt(d,10);Number.isInteger(f)&&f>0&&(this.metadataTags.date??=new Date(f,0,1))}break;case"IGNR":case"GENR":this.metadataTags.genre??=d;break;case"ICMT":case"CMNT":case"COMM":this.metadataTags.comment??=d;break}o+=8+l+(l&1)}}async parseId3Chunk(e,n){let r=this.reader.requestSlice(e,n);if(r instanceof Promise&&(r=await r),!r)return;const i=N0(r);if(i){const s=r.slice(e+10,i.size);PR(s,i,this.metadataTags)}}getCodec(){if(G(this.audioInfo),this.audioInfo.format===ba.MULAW)return"ulaw";if(this.audioInfo.format===ba.ALAW)return"alaw";if(this.audioInfo.format===ba.PCM){if(this.audioInfo.sampleSizeInBytes===1)return"pcm-u8";if(this.audioInfo.sampleSizeInBytes===2)return"pcm-s16";if(this.audioInfo.sampleSizeInBytes===3)return"pcm-s24";if(this.audioInfo.sampleSizeInBytes===4)return"pcm-s32"}return this.audioInfo.format===ba.IEEE_FLOAT&&this.audioInfo.sampleSizeInBytes===4?"pcm-f32":null}async getMimeType(){return"audio/wav"}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return G(e),e.computeDuration()}async getTracks(){return await this.readMetadata(),this.tracks}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}const ad=2048;class jee{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return this.demuxer.getCodec()}getInternalCodecId(){return G(this.demuxer.audioInfo),this.demuxer.audioInfo.format}async getDecoderConfig(){const e=this.demuxer.getCodec();return e?(G(this.demuxer.audioInfo),{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}):null}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getNumberOfChannels(){return G(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}getSampleRate(){return G(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getTimeResolution(){return G(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return Cs}async getFirstTimestamp(){return 0}async getPacketAtIndex(e,n){G(this.demuxer.audioInfo);const r=e*ad*this.demuxer.audioInfo.blockSizeInBytes;if(r>=this.demuxer.dataSize)return null;const i=Math.min(ad*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-r);if(this.demuxer.reader.fileSize===null){let l=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,i);if(l instanceof Promise&&(l=await l),!l)return null}let s;if(n.metadataOnly)s=Rs;else{let l=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,i);l instanceof Promise&&(l=await l),G(l),s=It(l,i)}const o=e*ad/this.demuxer.audioInfo.sampleRate,a=i/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate;return this.demuxer.lastKnownPacketIndex=Math.max(e,o),new Ln(s,"key",o,a,e,i)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getPacket(e,n){G(this.demuxer.audioInfo);const r=Math.floor(Math.min(e*this.demuxer.audioInfo.sampleRate/ad,(this.demuxer.dataSize-1)/(ad*this.demuxer.audioInfo.blockSizeInBytes))),i=await this.getPacketAtIndex(r,n);if(i)return i;if(r===0)return null;G(this.demuxer.reader.fileSize===null);let s=await this.getPacketAtIndex(this.demuxer.lastKnownPacketIndex,n);for(;s;){const o=await this.getNextPacket(s,n);if(!o)break;s=o}return s}getNextPacket(e,n){G(this.demuxer.audioInfo);const r=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/ad);return this.getPacketAtIndex(r+1,n)}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const R0=7,D0=9,a2=t=>{const e=t.filePos,n=It(t,9),r=new lr(n);if(r.readBits(12)!==4095||(r.skipBits(1),r.readBits(2)!==0))return null;const o=r.readBits(1),a=r.readBits(2)+1,l=r.readBits(4);if(l===15)return null;r.skipBits(1);const c=r.readBits(3);if(c===0)throw new Error("ADTS frames with channel configuration 0 are not supported.");r.skipBits(1),r.skipBits(1),r.skipBits(1),r.skipBits(1);const u=r.readBits(13);r.skipBits(11);const d=r.readBits(2)+1;if(d!==1)throw new Error("ADTS frames with more than one AAC frame are not supported.");let f=null;return o===1?t.filePos-=2:f=r.readBits(16),{objectType:a,samplingFrequencyIndex:l,channelConfiguration:c,frameLength:u,numberOfAacFrames:d,crcCheck:f,startPos:e}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const l2=1024;class qee extends ju{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.tracks=[],this.readingMutex=new Ff,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();G(this.firstFrameHeader),this.tracks=[new ol(this.input,new Kee(this))]})()}async advanceReader(){let e=this.reader.requestSliceRange(this.lastLoadedPos,R0,D0);if(e instanceof Promise&&(e=await e),!e){this.lastSampleLoaded=!0;return}const n=a2(e);if(!n){this.lastSampleLoaded=!0;return}if(this.reader.fileSize!==null&&n.startPos+n.frameLength>this.reader.fileSize){this.lastSampleLoaded=!0;return}this.firstFrameHeader||(this.firstFrameHeader=n);const r=P0[n.samplingFrequencyIndex];G(r!==void 0);const i=l2/r,s=n.crcCheck?D0:R0,o={timestamp:this.nextTimestampInSamples/r,duration:i,dataStart:n.startPos+s,dataSize:n.frameLength-s};this.loadedSamples.push(o),this.nextTimestampInSamples+=l2,this.lastLoadedPos=n.startPos+n.frameLength}async getMimeType(){return"audio/aac"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return G(e),e.computeDuration()}async getMetadataTags(){return{}}}class Kee{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return this.getSampleRate()/l2}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return Cs}getCodec(){return"aac"}getInternalCodecId(){return G(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.objectType}getNumberOfChannels(){G(this.demuxer.firstFrameHeader);const e=oR[this.demuxer.firstFrameHeader.channelConfiguration];return G(e!==void 0),e}getSampleRate(){G(this.demuxer.firstFrameHeader);const e=P0[this.demuxer.firstFrameHeader.samplingFrequencyIndex];return G(e!==void 0),e}async getDecoderConfig(){G(this.demuxer.firstFrameHeader);const e=new Uint8Array(3),n=new lr(e),{objectType:r,samplingFrequencyIndex:i,channelConfiguration:s}=this.demuxer.firstFrameHeader;return r>31?(n.writeBits(5,31),n.writeBits(6,r-32)):n.writeBits(5,r),n.writeBits(4,i),n.writeBits(4,s),{codec:`mp4a.40.${this.demuxer.firstFrameHeader.objectType}`,numberOfChannels:this.getNumberOfChannels(),sampleRate:this.getSampleRate(),description:e.subarray(0,Math.ceil((n.pos-1)/8))}}async getPacketAtIndex(e,n){if(e===-1)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=Rs;else{let s=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize);if(s instanceof Promise&&(s=await s),!s)return null;i=It(s,r.dataSize)}return new Ln(i,"key",r.timestamp,r.duration,e,r.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=fk(this.demuxer.loadedSamples,e.timestamp,o=>o.timestamp);if(i===-1)throw new Error("Packet was not created from this track.");const s=i+1;for(;s>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(s,n)}finally{r()}}async getPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=Mn(this.demuxer.loadedSamples,e,s=>s.timestamp);if(i===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(i,n);if(i>=0&&i+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(i,n);await this.demuxer.advanceReader()}}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Gee=t=>t===0?null:t===1?192:t>=2&&t<=5?144*2**t:t===6?"uncommon-u8":t===7?"uncommon-u16":t>=8&&t<=15?2**t:null,Zee=(t,e)=>{switch(t){case 0:return e;case 1:return 88200;case 2:return 176400;case 3:return 192e3;case 4:return 8e3;case 5:return 16e3;case 6:return 22050;case 7:return 24e3;case 8:return 32e3;case 9:return 44100;case 10:return 48e3;case 11:return 96e3;case 12:return"uncommon-u8";case 13:return"uncommon-u16";case 14:return"uncommon-u16-10";default:return null}},Qee=t=>{let e=0;const n=new lr(It(t,1));for(;n.readBits(1)===1;)e++;if(e===0)return n.readBits(7);const r=[],i=e-1,s=new lr(It(t,i)),o=8-e-1;for(let l=0;l<o;l++)r.unshift(n.readBits(1));for(let l=0;l<i;l++)for(let c=0;c<8;c++){const u=s.readBits(1);c<2||r.unshift(u)}return r.reduce((l,c,u)=>l|c<<u,0)},Xee=(t,e)=>{if(e==="uncommon-u16")return qr(t)+1;if(e==="uncommon-u8")return mt(t)+1;if(typeof e=="number")return e;Sc(e),G(!1)},Yee=(t,e)=>e==="uncommon-u16"?qr(t):e==="uncommon-u16-10"?qr(t)*10:e==="uncommon-u8"?mt(t):typeof e=="number"?e:null,Jee=t=>{let n=0;for(const r of t){n^=r;for(let i=0;i<8;i++)(n&128)!==0?n=n<<1^7:n<<=1,n&=255}return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class ete extends ju{constructor(e){super(e),this.loadedSamples=[],this.metadataPromise=null,this.track=null,this.metadataTags={},this.audioInfo=null,this.lastLoadedPos=null,this.blockingBit=null,this.readingMutex=new Ff,this.lastSampleLoaded=!1,this.reader=e._reader}async computeDuration(){return await this.readMetadata(),G(this.track),this.track.computeDuration()}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}async getTracks(){return await this.readMetadata(),G(this.track),[this.track]}async getMimeType(){return"audio/flac"}async readMetadata(){let e=4;return this.metadataPromise??=(async()=>{for(;this.reader.fileSize===null||e<this.reader.fileSize;){let n=this.reader.requestSlice(e,4);if(n instanceof Promise&&(n=await n),e+=4,n===null)throw new Error(`Metadata block at position ${e} is too small! Corrupted file.`);G(n);const r=mt(n),i=md(n),s=(r&128)!==0;switch(r&127){case Hd.STREAMINFO:{let a=this.reader.requestSlice(e,i);if(a instanceof Promise&&(a=await a),G(a),a===null)throw new Error(`StreamInfo block at position ${e} is too small! Corrupted file.`);const l=It(a,34),c=new lr(l),u=c.readBits(16),d=c.readBits(16),f=c.readBits(24),h=c.readBits(24),p=c.readBits(20),m=c.readBits(3)+1;c.readBits(5);const g=c.readBits(36);c.skipBits(128);const y=new Uint8Array(42);y.set(new Uint8Array([102,76,97,67]),0),y.set(new Uint8Array([128,0,0,34]),4),y.set(l,8),this.audioInfo={numberOfChannels:m,sampleRate:p,totalSamples:g,minimumBlockSize:u,maximumBlockSize:d,minimumFrameSize:f,maximumFrameSize:h,description:y},this.track=new ol(this.input,new tte(this));break}case Hd.VORBIS_COMMENT:{let a=this.reader.requestSlice(e,i);a instanceof Promise&&(a=await a),G(a),Jx(It(a,i),this.metadataTags);break}case Hd.PICTURE:{let a=this.reader.requestSlice(e,i);a instanceof Promise&&(a=await a),G(a);const l=et(a),c=et(a),u=Ps.decode(It(a,c)),d=et(a),f=Ps.decode(It(a,d));a.skip(16);const h=et(a),p=It(a,h);this.metadataTags.images??=[],this.metadataTags.images.push({data:p,mimeType:u,kind:l===3?"coverFront":l===4?"coverBack":"unknown",description:f});break}}if(e+=i,s){this.lastLoadedPos=e;break}}})()}async readNextFlacFrame({startPos:e,isFirstPacket:n}){G(this.audioInfo);const r=6,s=this.audioInfo.maximumFrameSize+16,o=await this.reader.requestSliceRange(e,this.audioInfo.minimumFrameSize,s);if(!o)return null;const a=this.readFlacFrameHeader({slice:o,isFirstPacket:n});if(!a)return null;for(o.filePos=e+this.audioInfo.minimumFrameSize;;){if(o.filePos>o.end-r)return{num:a.num,blockSize:a.blockSize,sampleRate:a.sampleRate,size:o.end-e,isLastFrame:!0};if(mt(o)===255){const c=mt(o),u=this.blockingBit===1?249:248;if(c!==u){o.skip(-1);continue}o.skip(-2);const d=o.filePos-e;if(!this.readFlacFrameHeader({slice:o,isFirstPacket:!1})){o.skip(-1);continue}return{num:a.num,blockSize:a.blockSize,sampleRate:a.sampleRate,size:d,isLastFrame:!1}}}}readFlacFrameHeader({slice:e,isFirstPacket:n}){const r=e.filePos,i=It(e,4),s=new lr(i);if(s.readBits(15)!==32764)return null;if(this.blockingBit===null){G(n);const g=s.readBits(1);this.blockingBit=g}else if(this.blockingBit===1){if(G(!n),s.readBits(1)!==1)return null}else if(this.blockingBit===0){if(G(!n),s.readBits(1)!==0)return null}else throw new Error("Invalid blocking bit");const a=Gee(s.readBits(4));if(!a)return null;G(this.audioInfo);const l=Zee(s.readBits(4),this.audioInfo.sampleRate);if(!l||(s.readBits(4),s.readBits(3),s.readBits(1)!==0))return null;const u=Qee(e),d=Xee(e,a),f=Yee(e,l);if(f===null)return null;const h=e.filePos-r,p=mt(e);e.skip(-h),e.skip(-1);const m=Jee(It(e,h));return p!==m?null:{num:u,blockSize:d,sampleRate:f}}async advanceReader(){await this.readMetadata(),G(this.lastLoadedPos!==null),G(this.audioInfo);const e=this.lastLoadedPos,n=await this.readNextFlacFrame({startPos:e,isFirstPacket:this.loadedSamples.length===0});if(!n){this.lastSampleLoaded=!0;return}const r=this.loadedSamples[this.loadedSamples.length-1],s={blockOffset:r?r.blockOffset+r.blockSize:0,blockSize:n.blockSize,byteOffset:e,byteSize:n.size};if(this.lastLoadedPos=this.lastLoadedPos+n.size,this.loadedSamples.push(s),n.isLastFrame){this.lastSampleLoaded=!0;return}}}class tte{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return"flac"}getInternalCodecId(){return null}getNumberOfChannels(){return G(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getSampleRate(){return G(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return Cs}getTimeResolution(){return G(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}async getFirstTimestamp(){return 0}async getDecoderConfig(){return G(this.demuxer.audioInfo),{codec:"flac",numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate,description:this.demuxer.audioInfo.description}}async getPacket(e,n){if(G(this.demuxer.audioInfo),e<0)throw new Error("Timestamp cannot be negative");const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=Mn(this.demuxer.loadedSamples,e,l=>l.blockOffset/this.demuxer.audioInfo.sampleRate);if(i===-1){await this.demuxer.advanceReader();continue}const s=this.demuxer.loadedSamples[i],o=s.blockOffset/this.demuxer.audioInfo.sampleRate,a=s.blockSize/this.demuxer.audioInfo.sampleRate;if(o+a<=e){if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(this.demuxer.loadedSamples.length-1,n);await this.demuxer.advanceReader();continue}return this.getPacketAtIndex(i,n)}}finally{r()}}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=e.sequenceNumber+1;if(this.demuxer.lastSampleLoaded&&i>=this.demuxer.loadedSamples.length)return null;for(;i>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(i,n)}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}async getPacketAtIndex(e,n){const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=Rs;else{let a=this.demuxer.reader.requestSlice(r.byteOffset,r.byteSize);if(a instanceof Promise&&(a=await a),!a)return null;i=It(a,r.byteSize)}G(this.demuxer.audioInfo);const s=r.blockOffset/this.demuxer.audioInfo.sampleRate,o=r.blockSize/this.demuxer.audioInfo.sampleRate;return new Ln(i,"key",s,o,e,r.byteSize)}async getFirstPacket(e){for(;this.demuxer.loadedSamples.length===0&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(0,e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Dc{}class NR extends Dc{async _getMajorBrand(e){let n=e._reader.requestSlice(0,12);return n instanceof Promise&&(n=await n),!n||(n.skip(4),$r(n,4)!=="ftyp")?null:$r(n,4)}_createDemuxer(e){return new uee(e)}}class nte extends NR{async _canReadInput(e){const n=await this._getMajorBrand(e);return!!n&&n!=="qt  "}get name(){return"MP4"}get mimeType(){return"video/mp4"}}class rte extends NR{async _canReadInput(e){return await this._getMajorBrand(e)==="qt  "}get name(){return"QuickTime File Format"}get mimeType(){return"video/quicktime"}}class RR extends Dc{async isSupportedEBMLOfDocType(e,n){let r=e._reader.requestSlice(0,Ia);if(r instanceof Promise&&(r=await r),!r)return!1;const i=kR(r);if(i===null||i<1||i>8||Xt(r,i)!==Pe.EBML)return!1;const o=TR(r);if(o===null)return!1;let a=e._reader.requestSlice(r.filePos,o);if(a instanceof Promise&&(a=await a),!a)return!1;const l=r.filePos;for(;a.filePos<=l+o-qs;){const c=Sa(a);if(!c)break;const{id:u,size:d}=c,f=a.filePos;if(d===null)return!1;switch(u){case Pe.EBMLVersion:if(Xt(a,d)!==1)return!1;break;case Pe.EBMLReadVersion:if(Xt(a,d)!==1)return!1;break;case Pe.DocType:if(pd(a,d)!==n)return!1;break;case Pe.DocTypeVersion:if(Xt(a,d)>4)return!1;break}a.filePos=f+d}return!0}_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"matroska")}_createDemuxer(e){return new xee(e)}get name(){return"Matroska"}get mimeType(){return"video/x-matroska"}}class ite extends RR{_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"webm")}get name(){return"WebM"}get mimeType(){return"video/webm"}}class ste extends Dc{async _canReadInput(e){let n=e._reader.requestSlice(0,10);if(n instanceof Promise&&(n=await n),!n)return!1;let r=0,i=!1;for(;;){let c=e._reader.requestSlice(r,M0);if(c instanceof Promise&&(c=await c),!c)break;const u=N0(c);if(!u)break;i=!0,r=c.filePos+u.size}const s=await o2(e._reader,r,r+4096);if(!s)return!1;if(i)return!0;r=s.startPos+s.header.totalSize;const o=await o2(e._reader,r,r+IR);if(!o)return!1;const a=s.header,l=o.header;return!(a.channel!==l.channel||a.sampleRate!==l.sampleRate)}_createDemuxer(e){return new Ree(e)}get name(){return"MP3"}get mimeType(){return"audio/mpeg"}}class ote extends Dc{async _canReadInput(e){let n=e._reader.requestSlice(0,12);if(n instanceof Promise&&(n=await n),!n)return!1;const r=$r(n,4);return r!=="RIFF"&&r!=="RIFX"&&r!=="RF64"?!1:(n.skip(4),$r(n,4)==="WAVE")}_createDemuxer(e){return new Wee(e)}get name(){return"WAVE"}get mimeType(){return"audio/wav"}}class ate extends Dc{async _canReadInput(e){let n=e._reader.requestSlice(0,4);return n instanceof Promise&&(n=await n),n?$r(n,4)==="OggS":!1}_createDemuxer(e){return new Hee(e)}get name(){return"Ogg"}get mimeType(){return"application/ogg"}}class lte extends Dc{async _canReadInput(e){let n=e._reader.requestSlice(0,4);return n instanceof Promise&&(n=await n),n?$r(n,4)==="fLaC":!1}get name(){return"FLAC"}get mimeType(){return"audio/flac"}_createDemuxer(e){return new ete(e)}}class cte extends Dc{async _canReadInput(e){let n=e._reader.requestSliceRange(0,R0,D0);if(n instanceof Promise&&(n=await n),!n)return!1;const r=a2(n);if(!r||(n=e._reader.requestSliceRange(r.frameLength,R0,D0),n instanceof Promise&&(n=await n),!n))return!1;const i=a2(n);return i?r.objectType===i.objectType&&r.samplingFrequencyIndex===i.samplingFrequencyIndex&&r.channelConfiguration===i.channelConfiguration:!1}_createDemuxer(e){return new qee(e)}get name(){return"ADTS"}get mimeType(){return"audio/aac"}}const ute=new nte,dte=new rte,fte=new RR,hte=new ite,pte=new ste,mte=new ote,gte=new ate,yte=new cte,bte=new lte,tI=[ute,dte,fte,hte,mte,gte,bte,pte,yte];/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class DR{constructor(){this._disposed=!1,this._sizePromise=null,this.onread=null}async getSizeOrNull(){if(this._disposed)throw new es;return this._sizePromise??=Promise.resolve(this._retrieveSize())}async getSize(){if(this._disposed)throw new es;const e=await this.getSizeOrNull();if(e===null)throw new Error("Cannot determine the size of an unsized source.");return e}}class nI extends DR{constructor(e,n={}){if(!(e instanceof Blob))throw new TypeError("blob must be a Blob.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(n.maxCacheSize!==void 0&&(!nR(n.maxCacheSize)||n.maxCacheSize<0))throw new TypeError("options.maxCacheSize, when provided, must be a non-negative number.");super(),this._readers=new WeakMap,this._blob=e,this._orchestrator=new vte({maxCacheSize:n.maxCacheSize??8*2**20,maxWorkerCount:4,runWorker:this._runWorker.bind(this),prefetchProfile:wte.fileSystem})}_retrieveSize(){const e=this._blob.size;return this._orchestrator.fileSize=e,e}_read(e,n){return this._orchestrator.read(e,n)}async _runWorker(e){let n=this._readers.get(e);for(n===void 0&&("stream"in this._blob?n=this._blob.slice(e.currentPos).stream().getReader():n=null,this._readers.set(e,n));e.currentPos<e.targetPos&&!e.aborted;)if(n){const{done:r,value:i}=await n.read();if(r){if(this._orchestrator.forgetWorker(e),e.currentPos<e.targetPos)throw new Error("Blob reader stopped unexpectedly before all requested data was read.");break}this.onread?.(e.currentPos,e.currentPos+i.length),this._orchestrator.supplyWorkerData(e,i)}else{const r=await this._blob.slice(e.currentPos,e.targetPos).arrayBuffer();this.onread?.(e.currentPos,e.currentPos+r.byteLength),this._orchestrator.supplyWorkerData(e,new Uint8Array(r))}e.running=!1}_dispose(){this._orchestrator.dispose()}}const wte={fileSystem:(t,e)=>(t=Math.floor((t-65536)/65536)*65536,e=Math.ceil((e+65536)/65536)*65536,{start:t,end:e})};class vte{constructor(e){this.options=e,this.fileSize=null,this.nextAge=0,this.workers=[],this.cache=[],this.currentCacheSize=0,this.disposed=!1}read(e,n){G(this.fileSize!==null);const r=this.options.prefetchProfile(e,n,this.workers),i=Math.max(r.start,0),s=Math.min(r.end,this.fileSize);G(i<=e&&n<=s);let o=null;const a=Mn(this.cache,e,b=>b.start),l=a!==-1?this.cache[a]:null;l&&l.start<=e&&n<=l.end&&(l.age=this.nextAge++,o={bytes:l.bytes,view:l.view,offset:l.start});const c=Mn(this.cache,i,b=>b.start),u=o?null:new Uint8Array(n-e);let d=0,f=i;const h=[];if(c!==-1){for(let b=c;b<this.cache.length;b++){const E=this.cache[b];if(E.start>=s)break;if(E.end<=i)continue;const C=Math.max(i,E.start),I=Math.min(s,E.end);if(G(C<=I),f<C&&h.push({start:f,end:C}),f=I,u){const x=Math.max(e,E.start),P=Math.min(n,E.end);if(x<P){const T=x-e;u.set(E.bytes.subarray(x-E.start,P-E.start),T),T===d&&(d=P-e)}}E.age=this.nextAge++}f<s&&h.push({start:f,end:s})}else h.push({start:i,end:s});if(u&&d>=u.length&&(o={bytes:u,view:ti(u),offset:e}),h.length===0)return G(o),o;const{promise:p,resolve:m,reject:g}=Xr(),y=[];for(const b of h){const E=Math.max(e,b.start),C=Math.min(n,b.end);E===b.start&&C===b.end?y.push(b):E<C&&y.push({start:E,end:C})}for(const b of h){const E=u&&{start:e,bytes:u,holes:y,resolve:m,reject:g};let C=!1;for(const I of this.workers)if(HA(b.start-131072,b.start,I.currentPos,I.targetPos)){I.targetPos=Math.max(I.targetPos,b.end),C=!0,E&&!I.pendingSlices.includes(E)&&I.pendingSlices.push(E),I.running||this.runWorker(I);break}if(!C){const I=this.createWorker(b.start,b.end);E&&(I.pendingSlices=[E]),this.runWorker(I)}}return o||(G(u),o=p.then(b=>({bytes:b,view:ti(b),offset:e}))),o}createWorker(e,n){const r={startPos:e,currentPos:e,targetPos:n,running:!1,aborted:!1,pendingSlices:[],age:this.nextAge++};for(this.workers.push(r);this.workers.length>this.options.maxWorkerCount;){let i=0,s=this.workers[0];for(let o=1;o<this.workers.length;o++){const a=this.workers[o];a.age<s.age&&(i=o,s=a)}if(s.running&&s.pendingSlices.length>0)break;s.aborted=!0,this.workers.splice(i,1)}return r}runWorker(e){G(!e.running),G(e.currentPos<e.targetPos),e.running=!0,e.age=this.nextAge++,this.options.runWorker(e).catch(n=>{if(e.running=!1,e.pendingSlices.length>0)e.pendingSlices.forEach(r=>r.reject(n)),e.pendingSlices.length=0;else throw n})}supplyWorkerData(e,n){if(this.disposed)return;const r=e.currentPos,i=r+n.length;this.insertIntoCache({start:r,end:i,bytes:n,view:ti(n),age:this.nextAge++}),e.currentPos+=n.length,e.targetPos=Math.max(e.targetPos,e.currentPos);for(let s=0;s<e.pendingSlices.length;s++){const o=e.pendingSlices[s],a=Math.max(r,o.start),l=Math.min(i,o.start+o.bytes.length);a<l&&o.bytes.set(n.subarray(a-r,l-r),a-o.start);for(let c=0;c<o.holes.length;c++){const u=o.holes[c];r<=u.start&&i>u.start&&(u.start=i),u.end<=u.start&&(o.holes.splice(c,1),c--)}o.holes.length===0&&(o.resolve(o.bytes),e.pendingSlices.splice(s,1),s--)}for(let s=0;s<this.workers.length;s++){const o=this.workers[s];e===o||o.running||HA(r,i,o.currentPos,o.targetPos)&&(this.workers.splice(s,1),s--)}}forgetWorker(e){const n=this.workers.indexOf(e);G(n!==-1),this.workers.splice(n,1)}insertIntoCache(e){if(this.options.maxCacheSize===0)return;let n=Mn(this.cache,e.start,r=>r.start)+1;if(n>0){const r=this.cache[n-1];if(r.end>=e.end)return;if(r.end>e.start){const i=new Uint8Array(e.end-r.start);i.set(r.bytes,0),i.set(e.bytes,e.start-r.start),this.currentCacheSize+=e.end-r.end,r.bytes=i,r.view=ti(i),r.end=e.end,n--,e=r}else this.cache.splice(n,0,e),this.currentCacheSize+=e.bytes.length}else this.cache.splice(n,0,e),this.currentCacheSize+=e.bytes.length;for(let r=n+1;r<this.cache.length;r++){const i=this.cache[r];if(e.end<=i.start)break;if(e.end>=i.end){this.cache.splice(r,1),this.currentCacheSize-=i.bytes.length,r--;continue}const s=new Uint8Array(i.end-e.start);s.set(e.bytes,0),s.set(i.bytes,i.start-e.start),this.currentCacheSize-=e.end-i.start,e.bytes=s,e.view=ti(s),e.end=i.end,this.cache.splice(r,1);break}for(;this.currentCacheSize>this.options.maxCacheSize;){let r=0,i=this.cache[0];for(let s=1;s<this.cache.length;s++){const o=this.cache[s];o.age<i.age&&(r=s,i=o)}if(this.currentCacheSize-i.bytes.length<=this.options.maxCacheSize)break;this.cache.splice(r,1),this.currentCacheSize-=i.bytes.length}}dispose(){for(const e of this.workers)e.aborted=!0;this.workers.length=0,this.cache.length=0,this.disposed=!0}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */tR();class c2{get disposed(){return this._disposed}constructor(e){if(this._demuxerPromise=null,this._format=null,this._disposed=!1,!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Array.isArray(e.formats)||e.formats.some(n=>!(n instanceof Dc)))throw new TypeError("options.formats must be an array of InputFormat.");if(!(e.source instanceof DR))throw new TypeError("options.source must be a Source.");if(e.source._disposed)throw new Error("options.source must not be disposed.");this._formats=e.formats,this._source=e.source,this._reader=new xte(e.source)}_getDemuxer(){return this._demuxerPromise??=(async()=>{this._reader.fileSize=await this._source.getSizeOrNull();for(const e of this._formats)if(await e._canReadInput(this))return this._format=e,e._createDemuxer(this);throw new Error("Input has an unsupported or unrecognizable format.")})()}get source(){return this._source}async getFormat(){return await this._getDemuxer(),G(this._format),this._format}async computeDuration(){return(await this._getDemuxer()).computeDuration()}async getTracks(){return(await this._getDemuxer()).getTracks()}async getVideoTracks(){return(await this.getTracks()).filter(n=>n.isVideoTrack())}async getAudioTracks(){return(await this.getTracks()).filter(n=>n.isAudioTrack())}async getPrimaryVideoTrack(){return(await this.getTracks()).find(n=>n.isVideoTrack())??null}async getPrimaryAudioTrack(){return(await this.getTracks()).find(n=>n.isAudioTrack())??null}async getMimeType(){return(await this._getDemuxer()).getMimeType()}async getMetadataTags(){return(await this._getDemuxer()).getMetadataTags()}dispose(){this._disposed||(this._disposed=!0,this._source._disposed=!0,this._source._dispose())}[Symbol.dispose](){this.dispose()}}class es extends Error{constructor(e="Input has been disposed."){super(e),this.name="InputDisposedError"}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class xte{constructor(e){this.source=e}requestSlice(e,n){if(this.source._disposed)throw new es;if(this.fileSize!==null&&e+n>this.fileSize)return null;const r=e+n,i=this.source._read(e,r);return i instanceof Promise?i.then(s=>s?new pf(s.bytes,s.view,s.offset,e,r):null):i?new pf(i.bytes,i.view,i.offset,e,r):null}requestSliceRange(e,n,r){if(this.source._disposed)throw new es;if(this.fileSize!==null)return this.requestSlice(e,Or(this.fileSize-e,n,r));{const i=this.requestSlice(e,r),s=o=>{if(o)return o;const a=c=>(G(c!==null),this.requestSlice(e,Or(c-e,n,r))),l=this.source._retrieveSize();return l instanceof Promise?l.then(a):a(l)};return i instanceof Promise?i.then(s):s(i)}}}class pf{constructor(e,n,r,i,s){this.bytes=e,this.view=n,this.offset=r,this.start=i,this.end=s,this.bufferPos=i-r}static tempFromBytes(e){return new pf(e,ti(e),0,0,e.length)}get length(){return this.end-this.start}get filePos(){return this.offset+this.bufferPos}set filePos(e){this.bufferPos=e-this.offset}get remainingLength(){return Math.max(this.end-this.filePos,0)}skip(e){this.bufferPos+=e}slice(e,n=this.end-e){if(e<this.start||e+n>this.end)throw new RangeError("Slicing outside of original slice.");return new pf(this.bytes,this.view,this.offset,e,e+n)}}const Ki=(t,e)=>{if(t.filePos<t.start||t.filePos+e>t.end)throw new RangeError(`Tried reading [${t.filePos}, ${t.filePos+e}), but slice is [${t.start}, ${t.end}). This is likely an internal error, please report it alongside the file that caused it.`)},It=(t,e)=>{Ki(t,e);const n=t.bytes.subarray(t.bufferPos,t.bufferPos+e);return t.bufferPos+=e,n},mt=t=>(Ki(t,1),t.view.getUint8(t.bufferPos++)),mh=(t,e)=>{Ki(t,2);const n=t.view.getUint16(t.bufferPos,e);return t.bufferPos+=2,n},qr=t=>{Ki(t,2);const e=t.view.getUint16(t.bufferPos,!1);return t.bufferPos+=2,e},md=t=>{Ki(t,3);const e=Ib(t.view,t.bufferPos,!1);return t.bufferPos+=3,e},u2=t=>{Ki(t,2);const e=t.view.getInt16(t.bufferPos,!1);return t.bufferPos+=2,e},Yl=(t,e)=>{Ki(t,4);const n=t.view.getUint32(t.bufferPos,e);return t.bufferPos+=4,n},et=t=>{Ki(t,4);const e=t.view.getUint32(t.bufferPos,!1);return t.bufferPos+=4,e},Td=t=>{Ki(t,4);const e=t.view.getUint32(t.bufferPos,!0);return t.bufferPos+=4,e},ou=t=>{Ki(t,4);const e=t.view.getInt32(t.bufferPos,!1);return t.bufferPos+=4,e},Ste=t=>{Ki(t,4);const e=t.view.getInt32(t.bufferPos,!0);return t.bufferPos+=4,e},rI=(t,e)=>{let n,r;return e?(n=Yl(t,!0),r=Yl(t,!0)):(r=Yl(t,!1),n=Yl(t,!1)),r*4294967296+n},Us=t=>{const e=et(t),n=et(t);return e*4294967296+n},Ete=t=>{const e=ou(t),n=et(t);return e*4294967296+n},kte=t=>{const e=Td(t);return Ste(t)*4294967296+e},Tte=t=>{Ki(t,4);const e=t.view.getFloat32(t.bufferPos,!1);return t.bufferPos+=4,e},LR=t=>{Ki(t,8);const e=t.view.getFloat64(t.bufferPos,!1);return t.bufferPos+=8,e},$r=(t,e)=>{Ki(t,e);let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t.bytes[t.bufferPos++]);return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const iI=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,_te=t=>{const e=Math.floor(t/36e5),n=Math.floor(t%(3600*1e3)/(60*1e3)),r=Math.floor(t%(60*1e3)/1e3),i=t%1e3;return e.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+"."+i.toString().padStart(3,"0")};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class sI{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,Math.floor(e/2**32),!1),this.helperView.setUint32(4,e,!1),this.writer.write(this.helper.subarray(0,8))}writeAscii(e){for(let n=0;n<e.length;n++)this.helperView.setUint8(n%8,e.charCodeAt(n)),n%8===7&&this.writer.write(this.helper);e.length%8!==0&&this.writer.write(this.helper.subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.writer.getPos()),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.writer.write(e.contents);else{const n=this.writer.getPos();if(this.writeBoxHeader(e,0),e.contents&&this.writer.write(e.contents),e.children)for(const s of e.children)s&&this.writeBox(s);const r=this.writer.getPos(),i=e.size??r-n;this.writer.seek(n),this.writeBoxHeader(e,i),this.writer.seek(r)}}writeBoxHeader(e,n){this.writeU32(e.largeSize?1:n),this.writeAscii(e.type),e.largeSize&&this.writeU64(n)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){const n=this.offsets.get(e);G(n!==void 0);const r=this.writer.getPos();this.writer.seek(n),this.writeBox(e),this.writer.seek(r)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let n=this.measureBoxHeader(e);if(e.contents&&(n+=e.contents.byteLength),e.children)for(const r of e.children)r&&(n+=this.measureBox(r));return n}}}const Kt=new Uint8Array(8),Go=new DataView(Kt.buffer),jn=t=>[(t%256+256)%256],bt=t=>(Go.setUint16(0,t,!1),[Kt[0],Kt[1]]),BR=t=>(Go.setInt16(0,t,!1),[Kt[0],Kt[1]]),FR=t=>(Go.setUint32(0,t,!1),[Kt[1],Kt[2],Kt[3]]),Ze=t=>(Go.setUint32(0,t,!1),[Kt[0],Kt[1],Kt[2],Kt[3]]),Hl=t=>(Go.setInt32(0,t,!1),[Kt[0],Kt[1],Kt[2],Kt[3]]),Ru=t=>(Go.setUint32(0,Math.floor(t/2**32),!1),Go.setUint32(4,t,!1),[Kt[0],Kt[1],Kt[2],Kt[3],Kt[4],Kt[5],Kt[6],Kt[7]]),$R=t=>(Go.setInt16(0,2**8*t,!1),[Kt[0],Kt[1]]),Ea=t=>(Go.setInt32(0,2**16*t,!1),[Kt[0],Kt[1],Kt[2],Kt[3]]),Bv=t=>(Go.setInt32(0,2**30*t,!1),[Kt[0],Kt[1],Kt[2],Kt[3]]),Fv=(t,e)=>{const n=[];let r=t;do{let i=r&127;r>>=7,n.length>0&&(i|=128),n.push(i)}while(r>0||e);return n.reverse()},Kr=(t,e=!1)=>{const n=Array(t.length).fill(null).map((r,i)=>t.charCodeAt(i));return e&&n.push(0),n},bk=t=>{let e=null;for(const n of t)(!e||n.timestamp>e.timestamp)&&(e=n);return e},zR=t=>{const e=t*(Math.PI/180),n=Math.round(Math.cos(e)),r=Math.round(Math.sin(e));return[n,r,0,-r,n,0,0,0,1]},UR=zR(0),HR=t=>[Ea(t[0]),Ea(t[1]),Bv(t[2]),Ea(t[3]),Ea(t[4]),Bv(t[5]),Ea(t[6]),Ea(t[7]),Bv(t[8])],vt=(t,e,n)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:n}),ln=(t,e,n,r,i)=>vt(t,[jn(e),FR(n),r??[]],i),Cte=t=>t.isQuickTime?vt("ftyp",[Kr("qt  "),Ze(512),Kr("qt  ")]):t.fragmented?vt("ftyp",[Kr("iso5"),Ze(512),Kr("iso5"),Kr("iso6"),Kr("mp41")]):vt("ftyp",[Kr("isom"),Ze(512),Kr("isom"),t.holdsAvc?Kr("avc1"):[],Kr("mp41")]),Gm=t=>({type:"mdat",largeSize:t}),Ate=t=>({type:"free",size:t}),gh=t=>vt("moov",void 0,[Ite(t.creationTime,t.trackDatas),...t.trackDatas.map(e=>Pte(e,t.creationTime)),t.isFragmented?dne(t.trackDatas):null,kne(t)]),Ite=(t,e)=>{const n=gr(Math.max(0,...e.filter(o=>o.samples.length>0).map(o=>{const a=bk(o.samples);return a.timestamp+a.duration})),d2),r=Math.max(0,...e.map(o=>o.track.id))+1,i=!hf(t)||!hf(n),s=i?Ru:Ze;return ln("mvhd",+i,0,[s(t),s(t),Ze(d2),s(n),Ea(1),$R(1),Array(10).fill(0),HR(UR),Array(24).fill(0),Ze(r)])},Pte=(t,e)=>{const n=Lne(t);return vt("trak",void 0,[Ote(t,e),Mte(t,e),n.name!==void 0?vt("udta",void 0,[vt("name",[...Lo.encode(n.name)])]):null])},Ote=(t,e)=>{const n=bk(t.samples),r=gr(n?n.timestamp+n.duration:0,d2),i=!hf(e)||!hf(r),s=i?Ru:Ze;let o;if(t.type==="video"){const a=t.track.metadata.rotation;o=zR(a??0)}else o=UR;return ln("tkhd",+i,3,[s(e),s(e),Ze(t.track.id),Ze(0),s(r),Array(8).fill(0),bt(0),bt(t.track.id),$R(t.type==="audio"?1:0),bt(0),HR(o),Ea(t.type==="video"?t.info.width:0),Ea(t.type==="video"?t.info.height:0)])},Mte=(t,e)=>vt("mdia",void 0,[Nte(t,e),wk(!0,Rte[t.type],Dte[t.type]),Lte(t)]),Nte=(t,e)=>{const n=bk(t.samples),r=gr(n?n.timestamp+n.duration:0,t.timescale),i=!hf(e)||!hf(r),s=i?Ru:Ze;return ln("mdhd",+i,0,[s(e),s(e),Ze(t.timescale),s(r),bt(qR(t.track.metadata.languageCode??Cs)),bt(0)])},Rte={video:"vide",audio:"soun",subtitle:"text"},Dte={video:"MediabunnyVideoHandler",audio:"MediabunnySoundHandler",subtitle:"MediabunnyTextHandler"},wk=(t,e,n,r="\0\0\0\0")=>ln("hdlr",0,0,[t?Kr("mhlr"):Ze(0),Kr(e),Kr(r),Ze(0),Ze(0),Kr(n,!0)]),Lte=t=>vt("minf",void 0,[zte[t.type](),Ute(),Wte(t)]),Bte=()=>ln("vmhd",0,1,[bt(0),bt(0),bt(0),bt(0)]),Fte=()=>ln("smhd",0,0,[bt(0),bt(0)]),$te=()=>ln("nmhd",0,0),zte={video:Bte,audio:Fte,subtitle:$te},Ute=()=>vt("dinf",void 0,[Hte()]),Hte=()=>ln("dref",0,0,[Ze(1)],[Vte()]),Vte=()=>ln("url ",0,1),Wte=t=>{const e=t.compositionTimeOffsetTable.length>1||t.compositionTimeOffsetTable.some(n=>n.sampleCompositionTimeOffset!==0);return vt("stbl",void 0,[jte(t),ine(t),e?cne(t):null,e?une(t):null,one(t),ane(t),lne(t),sne(t)])},jte=t=>{let e;if(t.type==="video")e=qte(Ane[t.track.source._codec],t);else if(t.type==="audio"){const n=jR(t.track.source._codec,t.muxer.isQuickTime);G(n),e=Xte(n,t)}else t.type==="subtitle"&&(e=nne(One[t.track.source._codec],t));return G(e),ln("stsd",0,0,[Ze(1)],[e])},qte=(t,e)=>vt(t,[Array(6).fill(0),bt(1),bt(0),bt(0),Array(12).fill(0),bt(e.info.width),bt(e.info.height),Ze(4718592),Ze(4718592),Ze(0),bt(1),Array(32).fill(0),bt(24),BR(65535)],[Ine[e.track.source._codec](e),pJ(e.info.decoderConfig.colorSpace)?Kte(e):null]),Kte=t=>vt("colr",[Kr("nclx"),bt(lm[t.info.decoderConfig.colorSpace.primaries]),bt(cm[t.info.decoderConfig.colorSpace.transfer]),bt(um[t.info.decoderConfig.colorSpace.matrix]),jn((t.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),Gte=t=>t.info.decoderConfig&&vt("avcC",[...Ho(t.info.decoderConfig.description)]),Zte=t=>t.info.decoderConfig&&vt("hvcC",[...Ho(t.info.decoderConfig.description)]),oI=t=>{if(!t.info.decoderConfig)return null;const e=t.info.decoderConfig,n=e.codec.split("."),r=Number(n[1]),i=Number(n[2]),s=Number(n[3]),o=n[4]?Number(n[4]):1,a=n[8]?Number(n[8]):Number(e.colorSpace?.fullRange??0),l=(s<<4)+(o<<1)+a,c=n[5]?Number(n[5]):e.colorSpace?.primaries?lm[e.colorSpace.primaries]:2,u=n[6]?Number(n[6]):e.colorSpace?.transfer?cm[e.colorSpace.transfer]:2,d=n[7]?Number(n[7]):e.colorSpace?.matrix?um[e.colorSpace.matrix]:2;return ln("vpcC",1,0,[jn(r),jn(i),jn(l),jn(c),jn(u),jn(d),bt(0)])},Qte=t=>vt("av1C",TJ(t.info.decoderConfig.codec)),Xte=(t,e)=>{let n=0,r,i=16;if(xi.includes(e.track.source._codec)){const s=e.track.source._codec,{sampleSize:o}=Rc(s);i=8*o,i>16&&(n=1)}return n===0?r=[Array(6).fill(0),bt(1),bt(n),bt(0),Ze(0),bt(e.info.numberOfChannels),bt(i),bt(0),bt(0),bt(e.info.sampleRate<2**16?e.info.sampleRate:0),bt(0)]:r=[Array(6).fill(0),bt(1),bt(n),bt(0),Ze(0),bt(e.info.numberOfChannels),bt(Math.min(i,16)),bt(0),bt(0),bt(e.info.sampleRate<2**16?e.info.sampleRate:0),bt(0),Ze(1),Ze(i/8),Ze(e.info.numberOfChannels*i/8),Ze(2)],vt(t,r,[Pne(e.track.source._codec,e.muxer.isQuickTime)?.(e)??null])},$v=t=>{let e;switch(t.track.source._codec){case"aac":e=64;break;case"mp3":e=107;break;case"vorbis":e=221;break;default:throw new Error(`Unhandled audio codec: ${t.track.source._codec}`)}let n=[...jn(e),...jn(21),...FR(0),...Ze(0),...Ze(0)];if(t.info.decoderConfig.description){const r=Ho(t.info.decoderConfig.description);n=[...n,...jn(5),...Fv(r.byteLength),...r]}return n=[...bt(1),...jn(0),...jn(4),...Fv(n.length),...n,...jn(6),...jn(1),...jn(2)],n=[...jn(3),...Fv(n.length),...n],ln("esds",0,0,n)},_l=t=>vt("wave",void 0,[Yte(t),Jte(t),vt("\0\0\0\0")]),Yte=t=>vt("frma",[Kr(jR(t.track.source._codec,t.muxer.isQuickTime))]),Jte=t=>{const{littleEndian:e}=Rc(t.track.source._codec);return vt("enda",[bt(+e)])},ene=t=>{let e=t.info.numberOfChannels,n=3840,r=t.info.sampleRate,i=0,s=0,o=new Uint8Array(0);const a=t.info.decoderConfig?.description;if(a){G(a.byteLength>=18);const l=Ho(a),c=yR(l);e=c.outputChannelCount,n=c.preSkip,r=c.inputSampleRate,i=c.outputGain,s=c.channelMappingFamily,c.channelMappingTable&&(o=c.channelMappingTable)}return vt("dOps",[jn(0),jn(e),bt(n),Ze(r),BR(i),jn(s),...o])},tne=t=>{const e=t.info.decoderConfig?.description;G(e);const n=Ho(e);return ln("dfLa",0,0,[...n.subarray(4)])},yo=t=>{const{littleEndian:e,sampleSize:n}=Rc(t.track.source._codec),r=+e;return ln("pcmC",0,0,[jn(r),jn(8*n)])},nne=(t,e)=>vt(t,[Array(6).fill(0),bt(1)],[Mne[e.track.source._codec](e)]),rne=t=>vt("vttC",[...Lo.encode(t.info.config.description)]),ine=t=>ln("stts",0,0,[Ze(t.timeToSampleTable.length),t.timeToSampleTable.map(e=>[Ze(e.sampleCount),Ze(e.sampleDelta)])]),sne=t=>{if(t.samples.every(n=>n.type==="key"))return null;const e=[...t.samples.entries()].filter(([,n])=>n.type==="key");return ln("stss",0,0,[Ze(e.length),e.map(([n])=>Ze(n+1))])},one=t=>ln("stsc",0,0,[Ze(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(e=>[Ze(e.firstChunk),Ze(e.samplesPerChunk),Ze(1)])]),ane=t=>{if(t.type==="audio"&&t.info.requiresPcmTransformation){const{sampleSize:e}=Rc(t.track.source._codec);return ln("stsz",0,0,[Ze(e*t.info.numberOfChannels),Ze(t.samples.reduce((n,r)=>n+gr(r.duration,t.timescale),0))])}return ln("stsz",0,0,[Ze(0),Ze(t.samples.length),t.samples.map(e=>Ze(e.size))])},lne=t=>t.finalizedChunks.length>0&&hr(t.finalizedChunks).offset>=2**32?ln("co64",0,0,[Ze(t.finalizedChunks.length),t.finalizedChunks.map(e=>Ru(e.offset))]):ln("stco",0,0,[Ze(t.finalizedChunks.length),t.finalizedChunks.map(e=>Ze(e.offset))]),cne=t=>ln("ctts",1,0,[Ze(t.compositionTimeOffsetTable.length),t.compositionTimeOffsetTable.map(e=>[Ze(e.sampleCount),Hl(e.sampleCompositionTimeOffset)])]),une=t=>{let e=1/0,n=-1/0,r=1/0,i=-1/0;G(t.compositionTimeOffsetTable.length>0),G(t.samples.length>0);for(let o=0;o<t.compositionTimeOffsetTable.length;o++){const a=t.compositionTimeOffsetTable[o];e=Math.min(e,a.sampleCompositionTimeOffset),n=Math.max(n,a.sampleCompositionTimeOffset)}for(let o=0;o<t.samples.length;o++){const a=t.samples[o];r=Math.min(r,gr(a.timestamp,t.timescale)),i=Math.max(i,gr(a.timestamp+a.duration,t.timescale))}const s=Math.max(-e,0);return i>=2**31?null:ln("cslg",0,0,[Hl(s),Hl(e),Hl(n),Hl(r),Hl(i)])},dne=t=>vt("mvex",void 0,t.map(fne)),fne=t=>ln("trex",0,0,[Ze(t.track.id),Ze(1),Ze(0),Ze(0),Ze(0)]),aI=(t,e)=>vt("moof",void 0,[hne(t),...e.map(pne)]),hne=t=>ln("mfhd",0,0,[Ze(t)]),VR=t=>{let e=0,n=0;const r=0,i=0,s=t.type==="delta";return n|=+s,s?e|=1:e|=2,e<<24|n<<16|r<<8|i},pne=t=>vt("traf",void 0,[mne(t),gne(t),yne(t)]),mne=t=>{G(t.currentChunk);let e=0;e|=8,e|=16,e|=32,e|=131072;const n=t.currentChunk.samples[1]??t.currentChunk.samples[0],r={duration:n.timescaleUnitsToNextSample,size:n.size,flags:VR(n)};return ln("tfhd",0,e,[Ze(t.track.id),Ze(r.duration),Ze(r.size),Ze(r.flags)])},gne=t=>(G(t.currentChunk),ln("tfdt",1,0,[Ru(gr(t.currentChunk.startTimestamp,t.timescale))])),yne=t=>{G(t.currentChunk);const e=t.currentChunk.samples.map(m=>m.timescaleUnitsToNextSample),n=t.currentChunk.samples.map(m=>m.size),r=t.currentChunk.samples.map(VR),i=t.currentChunk.samples.map(m=>gr(m.timestamp-m.decodeTimestamp,t.timescale)),s=new Set(e),o=new Set(n),a=new Set(r),l=new Set(i),c=a.size===2&&r[0]!==r[1],u=s.size>1,d=o.size>1,f=!c&&a.size>1,h=l.size>1||[...l].some(m=>m!==0);let p=0;return p|=1,p|=4*+c,p|=256*+u,p|=512*+d,p|=1024*+f,p|=2048*+h,ln("trun",1,p,[Ze(t.currentChunk.samples.length),Ze(t.currentChunk.offset-t.currentChunk.moofOffset||0),c?Ze(r[0]):[],t.currentChunk.samples.map((m,g)=>[u?Ze(e[g]):[],d?Ze(n[g]):[],f?Ze(r[g]):[],h?Hl(i[g]):[]])])},bne=t=>vt("mfra",void 0,[...t.map(wne),vne()]),wne=(t,e)=>ln("tfra",1,0,[Ze(t.track.id),Ze(63),Ze(t.finalizedChunks.length),t.finalizedChunks.map(r=>[Ru(gr(r.samples[0].timestamp,t.timescale)),Ru(r.moofOffset),Ze(e+1),Ze(1),Ze(1)])]),vne=()=>ln("mfro",0,0,[Ze(0)]),xne=()=>vt("vtte"),Sne=(t,e,n,r,i)=>vt("vttc",void 0,[i!==null?vt("vsid",[Hl(i)]):null,n!==null?vt("iden",[...Lo.encode(n)]):null,e!==null?vt("ctim",[...Lo.encode(_te(e))]):null,r!==null?vt("sttg",[...Lo.encode(r)]):null,vt("payl",[...Lo.encode(t)])]),Ene=t=>vt("vtta",[...Lo.encode(t)]),kne=t=>{const e=[],n=t.format._options.metadataFormat??"auto",r=t.output._metadataTags;if(n==="mdir"||n==="auto"&&!t.isQuickTime){const i=_ne(r);i&&e.push(i)}else if(n==="mdta"){const i=Cne(r);i&&e.push(i)}else(n==="udta"||n==="auto"&&t.isQuickTime)&&Tne(e,t.output._metadataTags);return e.length===0?null:vt("udta",void 0,e)},Tne=(t,e)=>{for(const{key:n,value:r}of eR(e))switch(n){case"title":t.push(bo("Â©nam",r));break;case"description":t.push(bo("Â©des",r));break;case"artist":t.push(bo("Â©ART",r));break;case"album":t.push(bo("Â©alb",r));break;case"albumArtist":t.push(bo("albr",r));break;case"genre":t.push(bo("Â©gen",r));break;case"date":t.push(bo("Â©day",r.toISOString().slice(0,10)));break;case"comment":t.push(bo("Â©cmt",r));break;case"lyrics":t.push(bo("Â©lyr",r));break;case"raw":break;case"discNumber":case"discsTotal":case"trackNumber":case"tracksTotal":case"images":break;default:Sc(n)}if(e.raw)for(const n in e.raw){const r=e.raw[n];r==null||n.length!==4||t.some(i=>i.type===n)||(typeof r=="string"?t.push(bo(n,r)):r instanceof Uint8Array&&t.push(vt(n,Array.from(r))))}},bo=(t,e)=>{const n=Lo.encode(e);return vt(t,[bt(n.length),bt(qR("und")),Array.from(n)])},lI={"image/jpeg":13,"image/png":14,"image/bmp":27},WR=(t,e)=>{const n=[];for(const{key:r,value:i}of eR(t))switch(r){case"title":n.push({key:e?"title":"Â©nam",value:zs(i)});break;case"description":n.push({key:e?"description":"Â©des",value:zs(i)});break;case"artist":n.push({key:e?"artist":"Â©ART",value:zs(i)});break;case"album":n.push({key:e?"album":"Â©alb",value:zs(i)});break;case"albumArtist":n.push({key:e?"album_artist":"aART",value:zs(i)});break;case"comment":n.push({key:e?"comment":"Â©cmt",value:zs(i)});break;case"genre":n.push({key:e?"genre":"Â©gen",value:zs(i)});break;case"lyrics":n.push({key:e?"lyrics":"Â©lyr",value:zs(i)});break;case"date":n.push({key:e?"date":"Â©day",value:zs(i.toISOString().slice(0,10))});break;case"images":for(const s of i)s.kind==="coverFront"&&n.push({key:"covr",value:vt("data",[Ze(lI[s.mimeType]??0),Ze(0),Array.from(s.data)])});break;case"trackNumber":if(e){const s=t.tracksTotal!==void 0?`${i}/${t.tracksTotal}`:i.toString();n.push({key:"track",value:zs(s)})}else n.push({key:"trkn",value:vt("data",[Ze(0),Ze(0),bt(0),bt(i),bt(t.tracksTotal??0),bt(0)])});break;case"discNumber":e||n.push({key:"disc",value:vt("data",[Ze(0),Ze(0),bt(0),bt(i),bt(t.discsTotal??0),bt(0)])});break;case"tracksTotal":case"discsTotal":break;case"raw":break;default:Sc(r)}if(t.raw)for(const r in t.raw){const i=t.raw[r];i==null||!e&&r.length!==4||n.some(s=>s.key===r)||(typeof i=="string"?n.push({key:r,value:zs(i)}):i instanceof Uint8Array?n.push({key:r,value:vt("data",[Ze(0),Ze(0),Array.from(i)])}):i instanceof zd&&n.push({key:r,value:vt("data",[Ze(lI[i.mimeType]??0),Ze(0),Array.from(i.data)])}))}return n},_ne=t=>{const e=WR(t,!1);return e.length===0?null:ln("meta",0,0,void 0,[wk(!1,"mdir","","appl"),vt("ilst",void 0,e.map(n=>vt(n.key,void 0,[n.value])))])},Cne=t=>{const e=WR(t,!0);return e.length===0?null:vt("meta",void 0,[wk(!1,"mdta",""),ln("keys",0,0,[Ze(e.length)],e.map(n=>vt("mdta",[...Lo.encode(n.key)]))),vt("ilst",void 0,e.map((n,r)=>{const i=String.fromCharCode(...Ze(r+1));return vt(i,void 0,[n.value])}))])},zs=t=>vt("data",[Ze(1),Ze(0),...Lo.encode(t)]),Ane={avc:"avc1",hevc:"hvc1",vp8:"vp08",vp9:"vp09",av1:"av01"},Ine={avc:Gte,hevc:Zte,vp8:oI,vp9:oI,av1:Qte},jR=(t,e)=>{switch(t){case"aac":return"mp4a";case"mp3":return"mp4a";case"opus":return"Opus";case"vorbis":return"mp4a";case"flac":return"fLaC";case"ulaw":return"ulaw";case"alaw":return"alaw";case"pcm-u8":return"raw ";case"pcm-s8":return"sowt"}if(e)switch(t){case"pcm-s16":return"sowt";case"pcm-s16be":return"twos";case"pcm-s24":return"in24";case"pcm-s24be":return"in24";case"pcm-s32":return"in32";case"pcm-s32be":return"in32";case"pcm-f32":return"fl32";case"pcm-f32be":return"fl32";case"pcm-f64":return"fl64";case"pcm-f64be":return"fl64"}else switch(t){case"pcm-s16":return"ipcm";case"pcm-s16be":return"ipcm";case"pcm-s24":return"ipcm";case"pcm-s24be":return"ipcm";case"pcm-s32":return"ipcm";case"pcm-s32be":return"ipcm";case"pcm-f32":return"fpcm";case"pcm-f32be":return"fpcm";case"pcm-f64":return"fpcm";case"pcm-f64be":return"fpcm"}},Pne=(t,e)=>{switch(t){case"aac":return $v;case"mp3":return $v;case"opus":return ene;case"vorbis":return $v;case"flac":return tne}if(e)switch(t){case"pcm-s24":return _l;case"pcm-s24be":return _l;case"pcm-s32":return _l;case"pcm-s32be":return _l;case"pcm-f32":return _l;case"pcm-f32be":return _l;case"pcm-f64":return _l;case"pcm-f64be":return _l}else switch(t){case"pcm-s16":return yo;case"pcm-s16be":return yo;case"pcm-s24":return yo;case"pcm-s24be":return yo;case"pcm-s32":return yo;case"pcm-s32be":return yo;case"pcm-f32":return yo;case"pcm-f32be":return yo;case"pcm-f64":return yo;case"pcm-f64be":return yo}return null},One={webvtt:"wvtt"},Mne={webvtt:rne},qR=t=>{G(t.length===3);let e=0;for(let n=0;n<3;n++)e<<=5,e+=t.charCodeAt(n)-96;return e};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class KR{constructor(){this.ensureMonotonicity=!1,this.trackedWrites=null,this.trackedStart=-1,this.trackedEnd=-1}start(){}maybeTrackWrites(e){if(!this.trackedWrites)return;let n=this.getPos();if(n<this.trackedStart){if(n+e.byteLength<=this.trackedStart)return;e=e.subarray(this.trackedStart-n),n=0}const r=n+e.byteLength-this.trackedStart;let i=this.trackedWrites.byteLength;for(;i<r;)i*=2;if(i!==this.trackedWrites.byteLength){const s=new Uint8Array(i);s.set(this.trackedWrites,0),this.trackedWrites=s}this.trackedWrites.set(e,n-this.trackedStart),this.trackedEnd=Math.max(this.trackedEnd,n+e.byteLength)}startTrackingWrites(){this.trackedWrites=new Uint8Array(2**10),this.trackedStart=this.getPos(),this.trackedEnd=this.trackedStart}stopTrackingWrites(){if(!this.trackedWrites)throw new Error("Internal error: Can't get tracked writes since nothing was tracked.");const n={data:this.trackedWrites.subarray(0,this.trackedEnd-this.trackedStart),start:this.trackedStart,end:this.trackedEnd};return this.trackedWrites=null,n}}const zv=2**16,Uv=2**32;class GR extends KR{constructor(e){if(super(),this.pos=0,this.maxPos=0,this.target=e,this.supportsResize="resize"in new ArrayBuffer(0),this.supportsResize)try{this.buffer=new ArrayBuffer(zv,{maxByteLength:Uv})}catch{this.buffer=new ArrayBuffer(zv),this.supportsResize=!1}else this.buffer=new ArrayBuffer(zv);this.bytes=new Uint8Array(this.buffer)}ensureSize(e){let n=this.buffer.byteLength;for(;n<e;)n*=2;if(n!==this.buffer.byteLength){if(n>Uv)throw new Error(`ArrayBuffer exceeded maximum size of ${Uv} bytes. Please consider using another target.`);if(this.supportsResize)this.buffer.resize(n);else{const r=new ArrayBuffer(n),i=new Uint8Array(r);i.set(this.bytes,0),this.buffer=r,this.bytes=i}}}write(e){this.maybeTrackWrites(e),this.ensureSize(this.pos+e.byteLength),this.bytes.set(e,this.pos),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength,this.maxPos=Math.max(this.maxPos,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){}async finalize(){this.ensureSize(this.pos),this.target.buffer=this.buffer.slice(0,Math.max(this.maxPos,this.pos))}async close(){}getSlice(e,n){return this.bytes.slice(e,n)}}class Nne extends KR{constructor(e){super(),this.target=e,this.pos=0}write(e){this.maybeTrackWrites(e),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength}getPos(){return this.pos}seek(e){this.pos=e}async flush(){}async finalize(){}async close(){}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class vk{constructor(){this._output=null,this.onwrite=null}}class ZR extends vk{constructor(){super(...arguments),this.buffer=null}_createWriter(){return new GR(this)}}class Rne extends vk{_createWriter(){return new Nne(this)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const d2=1e3,Dne=2082844800,Lne=t=>{const e={},n=t.track;return n.metadata.name!==void 0&&(e.name=n.metadata.name),e},gr=(t,e,n=!0)=>{const r=t*e;return n?Math.round(r):r};class Bne extends FJ{constructor(e,n){super(e),this.auxTarget=new ZR,this.auxWriter=this.auxTarget._createWriter(),this.auxBoxWriter=new sI(this.auxWriter),this.mdat=null,this.ftypSize=null,this.trackDatas=[],this.allTracksKnown=Xr(),this.creationTime=Math.floor(Date.now()/1e3)+Dne,this.finalizedChunks=[],this.nextFragmentNumber=1,this.maxWrittenTimestamp=-1/0,this.format=n,this.writer=e._writer,this.boxWriter=new sI(this.writer),this.isQuickTime=n instanceof YR;const r=this.writer instanceof GR?"in-memory":!1;this.fastStart=n._options.fastStart??r,this.isFragmented=this.fastStart==="fragmented",(this.fastStart==="in-memory"||this.isFragmented)&&(this.writer.ensureMonotonicity=!0),this.minimumFragmentDuration=n._options.minimumFragmentDuration??1}async start(){const e=await this.mutex.acquire(),n=this.output._tracks.some(r=>r.type==="video"&&r.source._codec==="avc");if(this.format._options.onFtyp&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(Cte({isQuickTime:this.isQuickTime,holdsAvc:n,fragmented:this.isFragmented})),this.format._options.onFtyp){const{data:r,start:i}=this.writer.stopTrackingWrites();this.format._options.onFtyp(r,i)}if(this.ftypSize=this.writer.getPos(),this.fastStart!=="in-memory")if(this.fastStart==="reserve"){for(const r of this.output._tracks)if(r.metadata.maximumPacketCount===void 0)throw new Error("All tracks must specify maximumPacketCount in their metadata when using fastStart: 'reserve'.")}else this.isFragmented||(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=Gm(!0),this.boxWriter.writeBox(this.mdat));await this.writer.flush(),e()}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(n=>n.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map(n=>n.type==="video"||n.type==="audio"?n.info.decoderConfig.codec:{webvtt:"wvtt"}[n.track.source._codec]);return SR({isQuickTime:this.isQuickTime,hasVideo:this.trackDatas.some(n=>n.type==="video"),hasAudio:this.trackDatas.some(n=>n.type==="audio"),codecStrings:e})}getVideoTrackData(e,n,r){const i=this.trackDatas.find(c=>c.track===e);if(i)return i;RJ(r),G(r),G(r.decoderConfig);const s={...r.decoderConfig};G(s.codedWidth!==void 0),G(s.codedHeight!==void 0);let o=!1;if(e.source._codec==="avc"&&!s.description){const c=dR(n.data);if(!c)throw new Error("Couldn't extract an AVCDecoderConfigurationRecord from the AVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.264) when not providing a description, or provide a description (must be an AVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in AVCC format.");s.description=UJ(c),o=!0}else if(e.source._codec==="hevc"&&!s.description){const c=hR(n.data);if(!c)throw new Error("Couldn't extract an HEVCDecoderConfigurationRecord from the HEVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.265) when not providing a description, or provide a description (must be an HEVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in HEVC format.");s.description=GJ(c),o=!0}const a=SJ(1/(e.metadata.frameRate??57600),1e6).denominator,l={muxer:this,track:e,type:"video",info:{width:s.codedWidth,height:s.codedHeight,decoderConfig:s,requiresAnnexBTransformation:o},timescale:a,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(l),this.trackDatas.sort((c,u)=>c.track.id-u.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),l}getAudioTrackData(e,n){const r=this.trackDatas.find(s=>s.track===e);if(r)return r;LJ(n),G(n),G(n.decoderConfig);const i={muxer:this,track:e,type:"audio",info:{numberOfChannels:n.decoderConfig.numberOfChannels,sampleRate:n.decoderConfig.sampleRate,decoderConfig:n.decoderConfig,requiresPcmTransformation:!this.isFragmented&&xi.includes(e.source._codec)},timescale:n.decoderConfig.sampleRate,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(i),this.trackDatas.sort((s,o)=>s.track.id-o.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}getSubtitleTrackData(e,n){const r=this.trackDatas.find(s=>s.track===e);if(r)return r;BJ(n),G(n),G(n.config);const i={muxer:this,track:e,type:"subtitle",info:{config:n.config},timescale:1e3,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[],lastCueEndTimestamp:0,cueQueue:[],nextSourceId:0,cueToSourceId:new WeakMap};return this.trackDatas.push(i),this.trackDatas.sort((s,o)=>s.track.id-o.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}async addEncodedVideoPacket(e,n,r){const i=await this.mutex.acquire();try{const s=this.getVideoTrackData(e,n,r);let o=n.data;if(s.info.requiresAnnexBTransformation){const c=$J(o);if(!c)throw new Error("Failed to transform packet data. Make sure all packets are provided in Annex B format, as specified in ITU-T-REC-H.264 and ITU-T-REC-H.265.");o=c}const a=this.validateAndNormalizeTimestamp(s.track,n.timestamp,n.type==="key"),l=this.createSampleForTrack(s,o,a,n.duration,n.type);await this.registerSample(s,l)}finally{i()}}async addEncodedAudioPacket(e,n,r){const i=await this.mutex.acquire();try{const s=this.getAudioTrackData(e,r),o=this.validateAndNormalizeTimestamp(s.track,n.timestamp,n.type==="key"),a=this.createSampleForTrack(s,n.data,o,n.duration,n.type);s.info.requiresPcmTransformation&&await this.maybePadWithSilence(s,o),await this.registerSample(s,a)}finally{i()}}async maybePadWithSilence(e,n){const r=hr(e.samples),i=r?r.timestamp+r.duration:0,s=n-i,o=gr(s,e.timescale);if(o>0){const{sampleSize:a,silentValue:l}=Rc(e.info.decoderConfig.codec),c=o*e.info.numberOfChannels,u=new Uint8Array(a*c).fill(l),d=this.createSampleForTrack(e,new Uint8Array(u.buffer),i,s,"key");await this.registerSample(e,d)}}async addSubtitleCue(e,n,r){const i=await this.mutex.acquire();try{const s=this.getSubtitleTrackData(e,r);this.validateAndNormalizeTimestamp(s.track,n.timestamp,!0),e.source._codec==="webvtt"&&(s.cueQueue.push(n),await this.processWebVTTCues(s,n.timestamp))}finally{i()}}async processWebVTTCues(e,n){for(;e.cueQueue.length>0;){const r=new Set([]);for(const c of e.cueQueue)G(c.timestamp<=n),G(e.lastCueEndTimestamp<=c.timestamp+c.duration),r.add(Math.max(c.timestamp,e.lastCueEndTimestamp)),r.add(c.timestamp+c.duration);const i=[...r].sort((c,u)=>c-u),s=i[0],o=i[1]??s;if(n<o)break;if(e.lastCueEndTimestamp<s){this.auxWriter.seek(0);const c=xne();this.auxBoxWriter.writeBox(c);const u=this.auxWriter.getSlice(0,this.auxWriter.getPos()),d=this.createSampleForTrack(e,u,e.lastCueEndTimestamp,s-e.lastCueEndTimestamp,"key");await this.registerSample(e,d),e.lastCueEndTimestamp=s}this.auxWriter.seek(0);for(let c=0;c<e.cueQueue.length;c++){const u=e.cueQueue[c];if(u.timestamp>=o)break;iI.lastIndex=0;const d=iI.test(u.text),f=u.timestamp+u.duration;let h=e.cueToSourceId.get(u);if(h===void 0&&o<f&&(h=e.nextSourceId++,e.cueToSourceId.set(u,h)),u.notes){const m=Ene(u.notes);this.auxBoxWriter.writeBox(m)}const p=Sne(u.text,d?s:null,u.identifier??null,u.settings??null,h??null);this.auxBoxWriter.writeBox(p),f===o&&e.cueQueue.splice(c--,1)}const a=this.auxWriter.getSlice(0,this.auxWriter.getPos()),l=this.createSampleForTrack(e,a,s,o-s,"key");await this.registerSample(e,l),e.lastCueEndTimestamp=o}}createSampleForTrack(e,n,r,i,s){return{timestamp:r,decodeTimestamp:r,duration:i,data:n,size:n.byteLength,type:s,timescaleUnitsToNextSample:gr(i,e.timescale)}}processTimestamps(e,n){if(e.timestampProcessingQueue.length===0)return;if(e.type==="audio"&&e.info.requiresPcmTransformation){let i=0;for(let s=0;s<e.timestampProcessingQueue.length;s++){const o=e.timestampProcessingQueue[s],a=gr(o.duration,e.timescale);i+=a}if(e.timeToSampleTable.length===0)e.timeToSampleTable.push({sampleCount:i,sampleDelta:1});else{const s=hr(e.timeToSampleTable);s.sampleCount+=i}e.timestampProcessingQueue.length=0;return}const r=e.timestampProcessingQueue.map(i=>i.timestamp).sort((i,s)=>i-s);for(let i=0;i<e.timestampProcessingQueue.length;i++){const s=e.timestampProcessingQueue[i];s.decodeTimestamp=r[i],!this.isFragmented&&e.lastTimescaleUnits===null&&(s.decodeTimestamp=0);const o=gr(s.timestamp-s.decodeTimestamp,e.timescale),a=gr(s.duration,e.timescale);if(e.lastTimescaleUnits!==null){G(e.lastSample);const l=gr(s.decodeTimestamp,e.timescale,!1),c=Math.round(l-e.lastTimescaleUnits);if(G(c>=0),e.lastTimescaleUnits+=c,e.lastSample.timescaleUnitsToNextSample=c,!this.isFragmented){let u=hr(e.timeToSampleTable);if(G(u),u.sampleCount===1){u.sampleDelta=c;const f=e.timeToSampleTable[e.timeToSampleTable.length-2];f&&f.sampleDelta===c&&(f.sampleCount++,e.timeToSampleTable.pop(),u=f)}else u.sampleDelta!==c&&(u.sampleCount--,e.timeToSampleTable.push(u={sampleCount:1,sampleDelta:c}));u.sampleDelta===a?u.sampleCount++:e.timeToSampleTable.push({sampleCount:1,sampleDelta:a});const d=hr(e.compositionTimeOffsetTable);G(d),d.sampleCompositionTimeOffset===o?d.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:o})}}else e.lastTimescaleUnits=gr(s.decodeTimestamp,e.timescale,!1),this.isFragmented||(e.timeToSampleTable.push({sampleCount:1,sampleDelta:a}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:o}));e.lastSample=s}if(e.timestampProcessingQueue.length=0,G(e.lastSample),G(e.lastTimescaleUnits!==null),n!==void 0&&e.lastSample.timescaleUnitsToNextSample===0){G(n.type==="key");const i=gr(n.timestamp,e.timescale,!1),s=Math.round(i-e.lastTimescaleUnits);e.lastSample.timescaleUnitsToNextSample=s}}async registerSample(e,n){n.type==="key"&&this.processTimestamps(e,n),e.timestampProcessingQueue.push(n),this.isFragmented?(e.sampleQueue.push(n),await this.interleaveSamples()):this.fastStart==="reserve"?await this.registerSampleFastStartReserve(e,n):await this.addSampleToTrack(e,n)}async addSampleToTrack(e,n){if(!this.isFragmented&&(e.samples.push(n),this.fastStart==="reserve")){const i=e.track.metadata.maximumPacketCount;if(G(i!==void 0),e.samples.length>i)throw new Error(`Track #${e.track.id} has already reached the maximum packet count (${i}). Either add less packets or increase the maximum packet count.`)}let r=!1;if(!e.currentChunk)r=!0;else{e.currentChunk.startTimestamp=Math.min(e.currentChunk.startTimestamp,n.timestamp);const i=n.timestamp-e.currentChunk.startTimestamp;if(this.isFragmented){const s=this.trackDatas.every(o=>{if(e===o)return n.type==="key";const a=o.sampleQueue[0];return a?a.type==="key":o.track.source._closed});i>=this.minimumFragmentDuration&&s&&n.timestamp>this.maxWrittenTimestamp&&(r=!0,await this.finalizeFragment())}else r=i>=.5}r&&(e.currentChunk&&await this.finalizeCurrentChunk(e),e.currentChunk={startTimestamp:n.timestamp,samples:[],offset:null,moofOffset:null}),G(e.currentChunk),e.currentChunk.samples.push(n),this.isFragmented&&(this.maxWrittenTimestamp=Math.max(this.maxWrittenTimestamp,n.timestamp))}async finalizeCurrentChunk(e){if(G(!this.isFragmented),!e.currentChunk)return;e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk);let n=e.currentChunk.samples.length;if(e.type==="audio"&&e.info.requiresPcmTransformation&&(n=e.currentChunk.samples.reduce((r,i)=>r+gr(i.duration,e.timescale),0)),(e.compactlyCodedChunkTable.length===0||hr(e.compactlyCodedChunkTable).samplesPerChunk!==n)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:n}),this.fastStart==="in-memory"){e.currentChunk.offset=0;return}e.currentChunk.offset=this.writer.getPos();for(const r of e.currentChunk.samples)G(r.data),this.writer.write(r.data),r.data=null;await this.writer.flush()}async interleaveSamples(e=!1){if(G(this.isFragmented),!(!e&&!this.allTracksAreKnown()))e:for(;;){let n=null,r=1/0;for(const s of this.trackDatas){if(!e&&s.sampleQueue.length===0&&!s.track.source._closed)break e;s.sampleQueue.length>0&&s.sampleQueue[0].timestamp<r&&(n=s,r=s.sampleQueue[0].timestamp)}if(!n)break;const i=n.sampleQueue.shift();await this.addSampleToTrack(n,i)}}async finalizeFragment(e=!0){G(this.isFragmented);const n=this.nextFragmentNumber++;if(n===1){this.format._options.onMoov&&this.writer.startTrackingWrites();const h=gh(this);if(this.boxWriter.writeBox(h),this.format._options.onMoov){const{data:p,start:m}=this.writer.stopTrackingWrites();this.format._options.onMoov(p,m)}}const r=this.trackDatas.filter(h=>h.currentChunk),i=aI(n,r),s=this.writer.getPos(),o=s+this.boxWriter.measureBox(i);let a=o+Aa,l=1/0;for(const h of r){h.currentChunk.offset=a,h.currentChunk.moofOffset=s;for(const p of h.currentChunk.samples)a+=p.size;l=Math.min(l,h.currentChunk.startTimestamp)}const c=a-o,u=c>=2**32;if(u)for(const h of r)h.currentChunk.offset+=iu-Aa;this.format._options.onMoof&&this.writer.startTrackingWrites();const d=aI(n,r);if(this.boxWriter.writeBox(d),this.format._options.onMoof){const{data:h,start:p}=this.writer.stopTrackingWrites();this.format._options.onMoof(h,p,l)}G(this.writer.getPos()===o),this.format._options.onMdat&&this.writer.startTrackingWrites();const f=Gm(u);f.size=c,this.boxWriter.writeBox(f),this.writer.seek(o+(u?iu:Aa));for(const h of r)for(const p of h.currentChunk.samples)this.writer.write(p.data),p.data=null;if(this.format._options.onMdat){const{data:h,start:p}=this.writer.stopTrackingWrites();this.format._options.onMdat(h,p)}for(const h of r)h.finalizedChunks.push(h.currentChunk),this.finalizedChunks.push(h.currentChunk),h.currentChunk=null;e&&await this.writer.flush()}async registerSampleFastStartReserve(e,n){if(this.allTracksAreKnown()){if(!this.mdat){const r=gh(this),s=this.boxWriter.measureBox(r)+this.computeSampleTableSizeUpperBound()+4096;G(this.ftypSize!==null),this.writer.seek(this.ftypSize+s),this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=Gm(!0),this.boxWriter.writeBox(this.mdat);for(const o of this.trackDatas){for(const a of o.sampleQueue)await this.addSampleToTrack(o,a);o.sampleQueue.length=0}}await this.addSampleToTrack(e,n)}else e.sampleQueue.push(n)}computeSampleTableSizeUpperBound(){G(this.fastStart==="reserve");let e=0;for(const n of this.trackDatas){const r=n.track.metadata.maximumPacketCount;G(r!==void 0),e+=8*Math.ceil(2/3*r),e+=4*r,e+=8*Math.ceil(2/3*r),e+=12*Math.ceil(2/3*r),e+=4*r,e+=8*r}return e}async onTrackClose(e){const n=await this.mutex.acquire();if(e.type==="subtitle"&&e.source._codec==="webvtt"){const r=this.trackDatas.find(i=>i.track===e);r&&await this.processWebVTTCues(r,1/0)}this.allTracksAreKnown()&&this.allTracksKnown.resolve(),this.isFragmented&&await this.interleaveSamples(),n()}async finalize(){const e=await this.mutex.acquire();this.allTracksKnown.resolve();for(const n of this.trackDatas)n.type==="subtitle"&&n.track.source._codec==="webvtt"&&await this.processWebVTTCues(n,1/0);if(this.isFragmented){await this.interleaveSamples(!0);for(const n of this.trackDatas)this.processTimestamps(n);await this.finalizeFragment(!1)}else for(const n of this.trackDatas)this.processTimestamps(n),await this.finalizeCurrentChunk(n);if(this.fastStart==="in-memory"){this.mdat=Gm(!1);let n;for(let i=0;i<2;i++){const s=gh(this),o=this.boxWriter.measureBox(s);n=this.boxWriter.measureBox(this.mdat);let a=this.writer.getPos()+o+n;for(const l of this.finalizedChunks){l.offset=a;for(const{data:c}of l.samples)G(c),a+=c.byteLength,n+=c.byteLength}if(a<2**32)break;n>=2**32&&(this.mdat.largeSize=!0)}this.format._options.onMoov&&this.writer.startTrackingWrites();const r=gh(this);if(this.boxWriter.writeBox(r),this.format._options.onMoov){const{data:i,start:s}=this.writer.stopTrackingWrites();this.format._options.onMoov(i,s)}this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat.size=n,this.boxWriter.writeBox(this.mdat);for(const i of this.finalizedChunks)for(const s of i.samples)G(s.data),this.writer.write(s.data),s.data=null;if(this.format._options.onMdat){const{data:i,start:s}=this.writer.stopTrackingWrites();this.format._options.onMdat(i,s)}}else if(this.isFragmented){const n=this.writer.getPos(),r=bne(this.trackDatas);this.boxWriter.writeBox(r);const i=this.writer.getPos()-n;this.writer.seek(this.writer.getPos()-4),this.boxWriter.writeU32(i)}else{G(this.mdat);const n=this.boxWriter.offsets.get(this.mdat);G(n!==void 0);const r=this.writer.getPos()-n;if(this.mdat.size=r,this.mdat.largeSize=r>=2**32,this.boxWriter.patchBox(this.mdat),this.format._options.onMdat){const{data:s,start:o}=this.writer.stopTrackingWrites();this.format._options.onMdat(s,o)}const i=gh(this);if(this.fastStart==="reserve"){G(this.ftypSize!==null),this.writer.seek(this.ftypSize),this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(i);const s=this.boxWriter.offsets.get(this.mdat)-this.writer.getPos();this.boxWriter.writeBox(Ate(s))}else this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(i);if(this.format._options.onMoov){const{data:s,start:o}=this.writer.stopTrackingWrites();this.format._options.onMoov(s,o)}}e()}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class QR{getSupportedVideoCodecs(){return this.getSupportedCodecs().filter(e=>qo.includes(e))}getSupportedAudioCodecs(){return this.getSupportedCodecs().filter(e=>Ko.includes(e))}getSupportedSubtitleCodecs(){return this.getSupportedCodecs().filter(e=>I0.includes(e))}_codecUnsupportedHint(e){return""}}class XR extends QR{constructor(e={}){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(e.fastStart!==void 0&&![!1,"in-memory","reserve","fragmented"].includes(e.fastStart))throw new TypeError("options.fastStart, when provided, must be false, 'in-memory', 'reserve', or 'fragmented'.");if(e.minimumFragmentDuration!==void 0&&(!Number.isFinite(e.minimumFragmentDuration)||e.minimumFragmentDuration<0))throw new TypeError("options.minimumFragmentDuration, when provided, must be a non-negative number.");if(e.onFtyp!==void 0&&typeof e.onFtyp!="function")throw new TypeError("options.onFtyp, when provided, must be a function.");if(e.onMoov!==void 0&&typeof e.onMoov!="function")throw new TypeError("options.onMoov, when provided, must be a function.");if(e.onMdat!==void 0&&typeof e.onMdat!="function")throw new TypeError("options.onMdat, when provided, must be a function.");if(e.onMoof!==void 0&&typeof e.onMoof!="function")throw new TypeError("options.onMoof, when provided, must be a function.");if(e.metadataFormat!==void 0&&!["mdir","mdta","udta","auto"].includes(e.metadataFormat))throw new TypeError("options.metadataFormat, when provided, must be either 'auto', 'mdir', 'mdta', or 'udta'.");super(),this._options=e}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:2**32-1}}}get supportsVideoRotationMetadata(){return!0}_createMuxer(e){return new Bne(e,this)}}class xk extends XR{constructor(e){super(e)}get _name(){return"MP4"}get fileExtension(){return".mp4"}get mimeType(){return"video/mp4"}getSupportedCodecs(){return[...qo,...Wh,"pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be",...I0]}_codecUnsupportedHint(e){return new YR().getSupportedCodecs().includes(e)?" Switching to MOV will grant support for this codec.":""}}class YR extends XR{constructor(e){super(e)}get _name(){return"MOV"}get fileExtension(){return".mov"}get mimeType(){return"video/quicktime"}getSupportedCodecs(){return[...qo,...Ko]}_codecUnsupportedHint(e){return new xk().getSupportedCodecs().includes(e)?" Switching to MP4 will grant support for this codec.":""}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Fne=t=>{if(!t||typeof t!="object")throw new TypeError("Encoding config must be an object.");if(!qo.includes(t.codec))throw new TypeError(`Invalid video codec '${t.codec}'. Must be one of: ${qo.join(", ")}.`);if(!(t.bitrate instanceof oo)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("config.bitrate must be a positive integer or a quality.");if(t.keyFrameInterval!==void 0&&(!Number.isFinite(t.keyFrameInterval)||t.keyFrameInterval<0))throw new TypeError("config.keyFrameInterval, when provided, must be a non-negative number.");if(t.sizeChangeBehavior!==void 0&&!["deny","passThrough","fill","contain","cover"].includes(t.sizeChangeBehavior))throw new TypeError("config.sizeChangeBehavior, when provided, must be 'deny', 'passThrough', 'fill', 'contain' or 'cover'.");if(t.onEncodedPacket!==void 0&&typeof t.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(t.onEncoderConfig!==void 0&&typeof t.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");JR(t.codec,t)},JR=(t,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.alpha!==void 0&&!["discard","keep"].includes(e.alpha))throw new TypeError("options.alpha, when provided, must be 'discard' or 'keep'.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.latencyMode!==void 0&&!["quality","realtime"].includes(e.latencyMode))throw new TypeError("latencyMode, when provided, must be 'quality' or 'realtime'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&cR(e.fullCodecString)!==t)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${t}).`);if(e.hardwareAcceleration!==void 0&&!["no-preference","prefer-hardware","prefer-software"].includes(e.hardwareAcceleration))throw new TypeError("hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.");if(e.scalabilityMode!==void 0&&typeof e.scalabilityMode!="string")throw new TypeError("scalabilityMode, when provided, must be a string.");if(e.contentHint!==void 0&&typeof e.contentHint!="string")throw new TypeError("contentHint, when provided, must be a string.")},f2=t=>{const e=t.bitrate instanceof oo?t.bitrate._toVideoBitrate(t.codec,t.width,t.height):t.bitrate;return{codec:t.fullCodecString??kJ(t.codec,t.width,t.height,e),width:t.width,height:t.height,bitrate:e,bitrateMode:t.bitrateMode,alpha:t.alpha??"discard",framerate:t.framerate,latencyMode:t.latencyMode,hardwareAcceleration:t.hardwareAcceleration,scalabilityMode:t.scalabilityMode,contentHint:t.contentHint,...CJ(t.codec)}},$ne=t=>{if(!t||typeof t!="object")throw new TypeError("Encoding config must be an object.");if(!Ko.includes(t.codec))throw new TypeError(`Invalid audio codec '${t.codec}'. Must be one of: ${Ko.join(", ")}.`);if(t.bitrate===void 0&&(!xi.includes(t.codec)||t.codec==="flac"))throw new TypeError("config.bitrate must be provided for compressed audio codecs.");if(t.bitrate!==void 0&&!(t.bitrate instanceof oo)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("config.bitrate, when provided, must be a positive integer or a quality.");if(t.onEncodedPacket!==void 0&&typeof t.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(t.onEncoderConfig!==void 0&&typeof t.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");e5(t.codec,t)},e5=(t,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&cR(e.fullCodecString)!==t)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${t}).`)},h2=t=>{const e=t.bitrate instanceof oo?t.bitrate._toAudioBitrate(t.codec):t.bitrate;return{codec:t.fullCodecString??_J(t.codec,t.numberOfChannels,t.sampleRate),numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate,bitrate:e,bitrateMode:t.bitrateMode,...AJ(t.codec)}};class oo{constructor(e){this._factor=e}_toVideoBitrate(e,n,r){const i=n*r,s={avc:1,hevc:.6,vp9:.6,av1:.4,vp8:1.2},o=1920*1080,a=3e6,l=Math.pow(i/o,.95),d=a*l*s[e]*this._factor;return Math.ceil(d/1e3)*1e3}_toAudioBitrate(e){if(xi.includes(e)||e==="flac")return;const r={aac:128e3,opus:64e3,mp3:16e4,vorbis:64e3}[e];if(!r)throw new Error(`Unhandled codec: ${e}`);let i=r*this._factor;return e==="aac"?i=[96e3,128e3,16e4,192e3].reduce((o,a)=>Math.abs(a-i)<Math.abs(o-i)?a:o):e==="opus"||e==="vorbis"?i=Math.max(6e3,i):e==="mp3"&&(i=[8e3,16e3,24e3,32e3,4e4,48e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4].reduce((o,a)=>Math.abs(a-i)<Math.abs(o-i)?a:o)),Math.round(i/1e3)*1e3}}const cI=new oo(.3),uI=new oo(1),L0=new oo(2),zne=async(t,e={})=>{const{width:n=1280,height:r=720,bitrate:i=1e6,...s}=e;if(!qo.includes(t))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("width must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("height must be a positive integer.");if(!(i instanceof oo)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer or a quality.");JR(t,s);let o=null;return e2.length>0&&(o??=f2({codec:t,width:n,height:r,bitrate:i,framerate:void 0,...s}),e2.some(c=>c.supports(t,o)))?!0:typeof VideoEncoder>"u"||(n%2===1||r%2===1)&&(t==="avc"||t==="hevc")?!1:(o??=f2({codec:t,width:n,height:r,bitrate:i,framerate:void 0,...s,alpha:"discard"}),(await VideoEncoder.isConfigSupported(o)).supported===!0)},Une=async(t,e={})=>{const{numberOfChannels:n=2,sampleRate:r=48e3,bitrate:i=128e3,...s}=e;if(!Ko.includes(t))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("numberOfChannels must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("sampleRate must be a positive integer.");if(!(i instanceof oo)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer.");e5(t,s);let o=null;return t2.length>0&&(o??=h2({codec:t,numberOfChannels:n,sampleRate:r,bitrate:i,...s}),t2.some(l=>l.supports(t,o)))||xi.includes(t)?!0:typeof AudioEncoder>"u"?!1:(o??=h2({codec:t,numberOfChannels:n,sampleRate:r,bitrate:i,...s}),(await AudioEncoder.isConfigSupported(o)).supported===!0)},p2=async(t=Ko,e)=>{const n=await Promise.all(t.map(r=>Une(r,e)));return t.filter((r,i)=>n[i])},Hne=async(t,e)=>{for(const n of t)if(await zne(n,e))return n;return null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Sk{constructor(){this._connectedTrack=null,this._closingPromise=null,this._closed=!1,this._timestampOffset=0}_ensureValidAdd(){if(!this._connectedTrack)throw new Error("Source is not connected to an output track.");if(this._connectedTrack.output.state==="canceled")throw new Error("Output has been canceled.");if(this._connectedTrack.output.state==="finalizing"||this._connectedTrack.output.state==="finalized")throw new Error("Output has been finalized.");if(this._connectedTrack.output.state==="pending")throw new Error("Output has not started.");if(this._closed)throw new Error("Source is closed.")}async _start(){}async _flushAndClose(e){}close(){if(this._closingPromise)return;const e=this._connectedTrack;if(!e)throw new Error("Cannot call close without connecting the source to an output track.");if(e.output.state==="pending")throw new Error("Cannot call close before output has been started.");this._closingPromise=(async()=>{await this._flushAndClose(!1),this._closed=!0,!(e.output.state==="finalizing"||e.output.state==="finalized")&&e.output._muxer.onTrackClose(e)})()}async _flushOrWaitForOngoingClose(e){return this._closingPromise?this._closingPromise:this._flushAndClose(e)}}class Ek extends Sk{constructor(e){if(super(),this._connectedTrack=null,!qo.includes(e))throw new TypeError(`Invalid video codec '${e}'. Must be one of: ${qo.join(", ")}.`);this._codec=e}}class Vne extends Ek{constructor(e){super(e)}add(e,n){if(!(e instanceof Ln))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedVideoPacket(this._connectedTrack,e,n)}}class Wne{constructor(e,n){this.source=e,this.encodingConfig=n,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastMultipleOfKeyFrameInterval=-1,this.codedWidth=null,this.codedHeight=null,this.resizeCanvas=null,this.customEncoder=null,this.customEncoderCallSerializer=new Pb,this.customEncoderQueueSize=0,this.alphaEncoder=null,this.splitter=null,this.splitterCreationFailed=!1,this.alphaFrameQueue=[],this.error=null,this.errorNeedsNewStack=!0}async add(e,n,r){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.codedWidth!==null&&this.codedHeight!==null){if(e.codedWidth!==this.codedWidth||e.codedHeight!==this.codedHeight){const a=this.encodingConfig.sizeChangeBehavior??"deny";if(a!=="passThrough"){if(a==="deny")throw new Error(`Video sample size must remain constant. Expected ${this.codedWidth}x${this.codedHeight}, got ${e.codedWidth}x${e.codedHeight}. To allow the sample size to change over time, set \`sizeChangeBehavior\` to a value other than 'strict' in the encoding options.`);{let l=!1;this.resizeCanvas||(typeof document<"u"?(this.resizeCanvas=document.createElement("canvas"),this.resizeCanvas.width=this.codedWidth,this.resizeCanvas.height=this.codedHeight):this.resizeCanvas=new OffscreenCanvas(this.codedWidth,this.codedHeight),l=!0);const c=this.resizeCanvas.getContext("2d",{alpha:Ep()});G(c),l||(Ep()?(c.fillStyle="black",c.fillRect(0,0,this.codedWidth,this.codedHeight)):c.clearRect(0,0,this.codedWidth,this.codedHeight)),e.drawWithFit(c,{fit:a}),n&&e.close(),e=new wi(this.resizeCanvas,{timestamp:e.timestamp,duration:e.duration,rotation:e.rotation}),n=!0}}}}else this.codedWidth=e.codedWidth,this.codedHeight=e.codedHeight;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),G(this.encoderInitialized);const i=this.encodingConfig.keyFrameInterval??5,s=Math.floor(e.timestamp/i),o={...r,keyFrame:r?.keyFrame||i===0||s!==this.lastMultipleOfKeyFrameInterval};if(this.lastMultipleOfKeyFrameInterval=s,this.customEncoder){this.customEncoderQueueSize++;const a=e.clone(),l=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(a,o)).then(()=>this.customEncoderQueueSize--).catch(c=>this.error??=c).finally(()=>{a.close()});this.customEncoderQueueSize>=4&&await l}else{G(this.encoder);const a=e.toVideoFrame();if(!this.alphaEncoder)this.encoder.encode(a,o),a.close();else if(!!a.format&&!a.format.includes("A")||this.splitterCreationFailed)this.alphaFrameQueue.push(null),this.encoder.encode(a,o),a.close();else{const c=a.displayWidth,u=a.displayHeight;if(!this.splitter)try{this.splitter=new jne(c,u)}catch(d){console.error("Due to an error, only color data will be encoded.",d),this.splitterCreationFailed=!0,this.alphaFrameQueue.push(null),this.encoder.encode(a,o),a.close()}if(this.splitter){const d=this.splitter.extractColor(a),f=this.splitter.extractAlpha(a);this.alphaFrameQueue.push(f),this.encoder.encode(d,o),d.close(),a.close()}}n&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(l=>this.encoder.addEventListener("dequeue",l,{once:!0}))}await this.muxer.mutex.currentPromise}finally{n&&e.close()}}ensureEncoder(e){const n=new Error;this.ensureEncoderPromise=(async()=>{const r=f2({width:e.codedWidth,height:e.codedHeight,...this.encodingConfig,framerate:this.source._connectedTrack?.metadata.frameRate});this.encodingConfig.onEncoderConfig?.(r);const i=e2.find(s=>s.supports(this.encodingConfig.codec,r));if(i)this.customEncoder=new i,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=r,this.customEncoder.onPacket=(s,o)=>{if(!(s instanceof Ln))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(o!==void 0&&(!o||typeof o!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(s,o),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,s,o).catch(a=>{this.error??=a,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else{if(typeof VideoEncoder>"u")throw new Error("VideoEncoder is not supported by this browser.");if(r.alpha="discard",this.encodingConfig.alpha==="keep"&&(r.latencyMode="quality"),(r.width%2===1||r.height%2===1)&&(this.encodingConfig.codec==="avc"||this.encodingConfig.codec==="hevc"))throw new Error(`The dimensions ${r.width}x${r.height} are not supported for codec '${this.encodingConfig.codec}'; both width and height must be even numbers. Make sure to round your dimensions to the nearest even number.`);if(!(await VideoEncoder.isConfigSupported(r)).supported)throw new Error(`This specific encoder configuration (${r.codec}, ${r.bitrate} bps, ${r.width}x${r.height}, hardware acceleration: ${r.hardwareAcceleration??"no-preference"}) is not supported by this browser. Consider using another codec or changing your video parameters.`);const a=[],l=[];let c=0,u=0;const d=(f,h,p)=>{const m={};if(h){const y=new Uint8Array(h.byteLength);h.copyTo(y),m.alpha=y}const g=Ln.fromEncodedChunk(f,m);this.encodingConfig.onEncodedPacket?.(g,p),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,g,p).catch(y=>{this.error??=y,this.errorNeedsNewStack=!1})};this.encoder=new VideoEncoder({output:(f,h)=>{if(!this.alphaEncoder){d(f,null,h);return}const p=this.alphaFrameQueue.shift();G(p!==void 0),p?(this.alphaEncoder.encode(p,{keyFrame:f.type==="key"}),u++,p.close(),a.push({chunk:f,meta:h})):u===0?d(f,null,h):(l.push(c+u),a.push({chunk:f,meta:h}))},error:f=>{f.stack=n.stack,this.error??=f}}),this.encoder.configure(r),this.encodingConfig.alpha==="keep"&&(this.alphaEncoder=new VideoEncoder({output:(f,h)=>{u--;const p=a.shift();for(G(p!==void 0),d(p.chunk,f,p.meta),c++;l.length>0&&l[0]===c;){l.shift();const m=a.shift();G(m!==void 0),d(m.chunk,null,m.meta)}},error:f=>{f.stack=n.stack,this.error??=f}}),this.alphaEncoder.configure(r))}G(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||(await this.encoder.flush(),await this.alphaEncoder?.flush()),this.encoder.state!=="closed"&&this.encoder.close(),this.alphaEncoder&&this.alphaEncoder.state!=="closed"&&this.alphaEncoder.close(),this.alphaFrameQueue.forEach(n=>n?.close()),this.splitter?.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class jne{constructor(e,n){this.lastFrame=null,typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(e,n):(this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=n);const r=this.canvas.getContext("webgl2",{alpha:!0});if(!r)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=r,this.colorProgram=this.createColorProgram(),this.alphaProgram=this.createAlphaProgram(),this.vao=this.createVAO(),this.sourceTexture=this.createTexture(),this.alphaResolutionLocation=this.gl.getUniformLocation(this.alphaProgram,"u_resolution"),this.gl.useProgram(this.colorProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.colorProgram,"u_sourceTexture"),0),this.gl.useProgram(this.alphaProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.alphaProgram,"u_sourceTexture"),0)}createVertexShader(){return this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`)}createColorProgram(){const e=this.createVertexShader(),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec4 source = texture(u_sourceTexture, v_texCoord);
				fragColor = vec4(source.rgb, 1.0);
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createAlphaProgram(){const e=this.createVertexShader(),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			uniform vec2 u_resolution; // The width and height of the canvas
			in vec2 v_texCoord;
			out vec4 fragColor;

			// This function determines the value for a single byte in the YUV stream
			float getByteValue(float byteOffset) {
				float width = u_resolution.x;
				float height = u_resolution.y;

				float yPlaneSize = width * height;

				if (byteOffset < yPlaneSize) {
					// This byte is in the luma plane. Find the corresponding pixel coordinates to sample from
					float y = floor(byteOffset / width);
					float x = mod(byteOffset, width);
					
					// Add 0.5 to sample the center of the texel
					vec2 sampleCoord = (vec2(x, y) + 0.5) / u_resolution;
					
					// The luma value is the alpha from the source texture
					return texture(u_sourceTexture, sampleCoord).a;
				} else {
					// Write a fixed value for chroma and beyond
					return 128.0 / 255.0;
				}
			}
			
			void main() {
				// Each fragment writes 4 bytes (R, G, B, A)
				float pixelIndex = floor(gl_FragCoord.y) * u_resolution.x + floor(gl_FragCoord.x);
				float baseByteOffset = pixelIndex * 4.0;

				vec4 result;
				for (int i = 0; i < 4; i++) {
					float currentByteOffset = baseByteOffset + float(i);
					result[i] = getByteValue(currentByteOffset);
				}
				
				fragColor = result;
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createShader(e,n){const r=this.gl.createShader(e);return this.gl.shaderSource(r,n),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)||console.error("Shader compile error:",this.gl.getShaderInfoLog(r)),r}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const n=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(this.colorProgram,"a_position"),s=this.gl.getAttribLocation(this.colorProgram,"a_texCoord");return this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}updateTexture(e){this.lastFrame!==e&&((e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sourceTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.lastFrame=e)}extractColor(e){return this.updateTexture(e),this.gl.useProgram(this.colorProgram),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),new VideoFrame(this.canvas,{timestamp:e.timestamp,duration:e.duration??void 0,alpha:"discard"})}extractAlpha(e){this.updateTexture(e),this.gl.useProgram(this.alphaProgram),this.gl.uniform2f(this.alphaResolutionLocation,this.canvas.width,this.canvas.height),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const{width:n,height:r}=this.canvas,i=Math.ceil(n/2)*Math.ceil(r/2),s=n*r+i*2,o=Math.ceil(s/(n*4));let a=new Uint8Array(4*n*o);this.gl.readPixels(0,0,n,o,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),a=a.subarray(0,s),G(a[n*r]===128),G(a[a.length-1]===128);const l={format:"I420",codedWidth:n,codedHeight:r,timestamp:e.timestamp,duration:e.duration??void 0,transfer:[a.buffer]};return new VideoFrame(a,l)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class dI extends Ek{constructor(e){Fne(e),super(e.codec),this._encoder=new Wne(this,e)}add(e,n){if(!(e instanceof wi))throw new TypeError("videoSample must be a VideoSample.");return this._encoder.add(e,!1,n)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class kk extends Sk{constructor(e){if(super(),this._connectedTrack=null,!Ko.includes(e))throw new TypeError(`Invalid audio codec '${e}'. Must be one of: ${Ko.join(", ")}.`);this._codec=e}}class qne extends kk{constructor(e){super(e)}add(e,n){if(!(e instanceof Ln))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedAudioPacket(this._connectedTrack,e,n)}}class Kne{constructor(e,n){this.source=e,this.encodingConfig=n,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastNumberOfChannels=null,this.lastSampleRate=null,this.isPcmEncoder=!1,this.outputSampleSize=null,this.writeOutputValue=null,this.customEncoder=null,this.customEncoderCallSerializer=new Pb,this.customEncoderQueueSize=0,this.error=null,this.errorNeedsNewStack=!0}async add(e,n){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.lastNumberOfChannels!==null&&this.lastSampleRate!==null){if(e.numberOfChannels!==this.lastNumberOfChannels||e.sampleRate!==this.lastSampleRate)throw new Error(`Audio parameters must remain constant. Expected ${this.lastNumberOfChannels} channels at ${this.lastSampleRate} Hz, got ${e.numberOfChannels} channels at ${e.sampleRate} Hz.`)}else this.lastNumberOfChannels=e.numberOfChannels,this.lastSampleRate=e.sampleRate;if(this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),G(this.encoderInitialized),this.customEncoder){this.customEncoderQueueSize++;const r=e.clone(),i=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(r)).then(()=>this.customEncoderQueueSize--).catch(s=>this.error??=s).finally(()=>{r.close()});this.customEncoderQueueSize>=4&&await i,await this.muxer.mutex.currentPromise}else if(this.isPcmEncoder)await this.doPcmEncoding(e,n);else{G(this.encoder);const r=e.toAudioData();this.encoder.encode(r),r.close(),n&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(i=>this.encoder.addEventListener("dequeue",i,{once:!0})),await this.muxer.mutex.currentPromise}}finally{n&&e.close()}}async doPcmEncoding(e,n){G(this.outputSampleSize),G(this.writeOutputValue);const{numberOfChannels:r,numberOfFrames:i,sampleRate:s,timestamp:o}=e,a=2048,l=[];for(let f=0;f<i;f+=a){const h=Math.min(a,e.numberOfFrames-f),p=h*r*this.outputSampleSize,m=new ArrayBuffer(p),g=new DataView(m);l.push({frameCount:h,view:g})}const c=e.allocationSize({planeIndex:0,format:"f32-planar"}),u=new Float32Array(c/Float32Array.BYTES_PER_ELEMENT);for(let f=0;f<r;f++){e.copyTo(u,{planeIndex:f,format:"f32-planar"});for(let h=0;h<l.length;h++){const{frameCount:p,view:m}=l[h];for(let g=0;g<p;g++)this.writeOutputValue(m,(g*r+f)*this.outputSampleSize,u[h*a+g])}}n&&e.close();const d={decoderConfig:{codec:this.encodingConfig.codec,numberOfChannels:r,sampleRate:s}};for(let f=0;f<l.length;f++){const{frameCount:h,view:p}=l[f],m=p.buffer,g=f*a,y=new Ln(new Uint8Array(m),"key",o+g/s,h/s);this.encodingConfig.onEncodedPacket?.(y,d),await this.muxer.addEncodedAudioPacket(this.source._connectedTrack,y,d)}}ensureEncoder(e){const n=new Error;this.ensureEncoderPromise=(async()=>{const{numberOfChannels:r,sampleRate:i}=e,s=h2({numberOfChannels:r,sampleRate:i,...this.encodingConfig});this.encodingConfig.onEncoderConfig?.(s);const o=t2.find(a=>a.supports(this.encodingConfig.codec,s));if(o)this.customEncoder=new o,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=s,this.customEncoder.onPacket=(a,l)=>{if(!(a instanceof Ln))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(l!==void 0&&(!l||typeof l!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(a,l),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,a,l).catch(c=>{this.error??=c,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else if(xi.includes(this.encodingConfig.codec))this.initPcmEncoder();else{if(typeof AudioEncoder>"u")throw new Error("AudioEncoder is not supported by this browser.");if(!(await AudioEncoder.isConfigSupported(s)).supported)throw new Error(`This specific encoder configuration (${s.codec}, ${s.bitrate} bps, ${s.numberOfChannels} channels, ${s.sampleRate} Hz) is not supported by this browser. Consider using another codec or changing your audio parameters.`);this.encoder=new AudioEncoder({output:(l,c)=>{const u=Ln.fromEncodedChunk(l);this.encodingConfig.onEncodedPacket?.(u,c),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,u,c).catch(d=>{this.error??=d,this.errorNeedsNewStack=!1})},error:l=>{l.stack=n.stack,this.error??=l}}),this.encoder.configure(s)}G(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}initPcmEncoder(){this.isPcmEncoder=!0;const e=this.encodingConfig.codec,{dataType:n,sampleSize:r,littleEndian:i}=Rc(e);switch(this.outputSampleSize=r,r){case 1:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint8(o,Or((a+1)*127.5,0,255)):n==="signed"?this.writeOutputValue=(s,o,a)=>{s.setInt8(o,Or(Math.round(a*128),-128,127))}:n==="ulaw"?this.writeOutputValue=(s,o,a)=>{const l=Or(Math.floor(a*32767),-32768,32767);s.setUint8(o,YJ(l))}:n==="alaw"?this.writeOutputValue=(s,o,a)=>{const l=Or(Math.floor(a*32767),-32768,32767);s.setUint8(o,eee(l))}:G(!1);break;case 2:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint16(o,Or((a+1)*32767.5,0,65535),i):n==="signed"?this.writeOutputValue=(s,o,a)=>s.setInt16(o,Or(Math.round(a*32767),-32768,32767),i):G(!1);break;case 3:n==="unsigned"?this.writeOutputValue=(s,o,a)=>JN(s,o,Or((a+1)*83886075e-1,0,16777215),i):n==="signed"?this.writeOutputValue=(s,o,a)=>bJ(s,o,Or(Math.round(a*8388607),-8388608,8388607),i):G(!1);break;case 4:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint32(o,Or((a+1)*21474836475e-1,0,4294967295),i):n==="signed"?this.writeOutputValue=(s,o,a)=>s.setInt32(o,Or(Math.round(a*2147483647),-2147483648,2147483647),i):n==="float"?this.writeOutputValue=(s,o,a)=>s.setFloat32(o,a,i):G(!1);break;case 8:n==="float"?this.writeOutputValue=(s,o,a)=>s.setFloat64(o,a,i):G(!1);break;default:Sc(r),G(!1)}}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||await this.encoder.flush(),this.encoder.state!=="closed"&&this.encoder.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.isPcmEncoder?0:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class fI extends kk{constructor(e){$ne(e),super(e.codec),this._encoder=new Kne(this,e)}add(e){if(!(e instanceof Zs))throw new TypeError("audioSample must be an AudioSample.");return this._encoder.add(e,!1)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class Gne extends Sk{constructor(e){if(super(),this._connectedTrack=null,!I0.includes(e))throw new TypeError(`Invalid subtitle codec '${e}'. Must be one of: ${I0.join(", ")}.`);this._codec=e}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Zne=["video","audio","subtitle"],Hv=t=>{if(!t||typeof t!="object")throw new TypeError("metadata must be an object.");if(t.languageCode!==void 0&&!Sp(t.languageCode))throw new TypeError("metadata.languageCode, when provided, must be a three-letter, ISO 639-2/T language code.");if(t.name!==void 0&&typeof t.name!="string")throw new TypeError("metadata.name, when provided, must be a string.");if(t.maximumPacketCount!==void 0&&(!Number.isInteger(t.maximumPacketCount)||t.maximumPacketCount<0))throw new TypeError("metadata.maximumPacketCount, when provided, must be a non-negative integer.")};class m2{constructor(e){if(this.state="pending",this._tracks=[],this._startPromise=null,this._cancelPromise=null,this._finalizePromise=null,this._mutex=new Ff,this._metadataTags={},!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.format instanceof QR))throw new TypeError("options.format must be an OutputFormat.");if(!(e.target instanceof vk))throw new TypeError("options.target must be a Target.");if(e.target._output)throw new Error("Target is already used for another output.");e.target._output=this,this.format=e.format,this.target=e.target,this._writer=e.target._createWriter(),this._muxer=e.format._createMuxer(this)}addVideoTrack(e,n={}){if(!(e instanceof Ek))throw new TypeError("source must be a VideoSource.");if(Hv(n),n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError(`Invalid video rotation: ${n.rotation}. Has to be 0, 90, 180 or 270.`);if(!this.format.supportsVideoRotationMetadata&&n.rotation)throw new Error(`${this.format._name} does not support video rotation metadata.`);if(n.frameRate!==void 0&&(!Number.isFinite(n.frameRate)||n.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${n.frameRate}. Must be a positive number.`);this._addTrack("video",e,n)}addAudioTrack(e,n={}){if(!(e instanceof kk))throw new TypeError("source must be an AudioSource.");Hv(n),this._addTrack("audio",e,n)}addSubtitleTrack(e,n={}){if(!(e instanceof Gne))throw new TypeError("source must be a SubtitleSource.");Hv(n),this._addTrack("subtitle",e,n)}setMetadataTags(e){if(Xx(e),this.state!=="pending")throw new Error("Cannot set metadata tags after output has been started or canceled.");this._metadataTags=e}_addTrack(e,n,r){if(this.state!=="pending")throw new Error("Cannot add track after output has been started or canceled.");if(n._connectedTrack)throw new Error("Source is already used for a track.");const i=this.format.getSupportedTrackCounts(),s=this._tracks.reduce((c,u)=>c+(u.type===e?1:0),0),o=i[e].max;if(s===o)throw new Error(o===0?`${this.format._name} does not support ${e} tracks.`:`${this.format._name} does not support more than ${o} ${e} track${o===1?"":"s"}.`);const a=i.total.max;if(this._tracks.length===a)throw new Error(`${this.format._name} does not support more than ${a} tracks${a===1?"":"s"} in total.`);const l={id:this._tracks.length+1,output:this,type:e,source:n,metadata:r};if(l.type==="video"){const c=this.format.getSupportedVideoCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support video tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported video codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}else if(l.type==="audio"){const c=this.format.getSupportedAudioCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support audio tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported audio codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}else if(l.type==="subtitle"){const c=this.format.getSupportedSubtitleCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support subtitle tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported subtitle codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}this._tracks.push(l),n._connectedTrack=l}async start(){const e=this.format.getSupportedTrackCounts();for(const r of Zne){const i=this._tracks.reduce((o,a)=>o+(a.type===r?1:0),0),s=e[r].min;if(i<s)throw new Error(s===e[r].max?`${this.format._name} requires exactly ${s} ${r} track${s===1?"":"s"}.`:`${this.format._name} requires at least ${s} ${r} track${s===1?"":"s"}.`)}const n=e.total.min;if(this._tracks.length<n)throw new Error(n===e.total.max?`${this.format._name} requires exactly ${n} track${n===1?"":"s"}.`:`${this.format._name} requires at least ${n} track${n===1?"":"s"}.`);if(this.state==="canceled")throw new Error("Output has been canceled.");return this._startPromise?(console.warn("Output has already been started."),this._startPromise):this._startPromise=(async()=>{this.state="started",this._writer.start();const r=await this._mutex.acquire();await this._muxer.start();const i=this._tracks.map(s=>s.source._start());await Promise.all(i),r()})()}getMimeType(){return this._muxer.getMimeType()}async cancel(){if(this._cancelPromise)return console.warn("Output has already been canceled."),this._cancelPromise;if(this.state==="finalizing"||this.state==="finalized"){console.warn("Output has already been finalized.");return}return this._cancelPromise=(async()=>{this.state="canceled";const e=await this._mutex.acquire(),n=this._tracks.map(r=>r.source._flushOrWaitForOngoingClose(!0));await Promise.all(n),await this._writer.close(),e()})()}async finalize(){if(this.state==="pending")throw new Error("Cannot finalize before starting.");if(this.state==="canceled")throw new Error("Cannot finalize after canceling.");return this._finalizePromise?(console.warn("Output has already been finalized."),this._finalizePromise):this._finalizePromise=(async()=>{this.state="finalizing";const e=await this._mutex.acquire(),n=this._tracks.map(r=>r.source._flushOrWaitForOngoingClose(!1));await Promise.all(n),await this._muxer.finalize(),await this._writer.flush(),await this._writer.finalize(),this.state="finalized",e()})()}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const hI=t=>{if(t!==void 0&&(!t||typeof t!="object"))throw new TypeError("options.video, when provided, must be an object.");if(t?.discard!==void 0&&typeof t.discard!="boolean")throw new TypeError("options.video.discard, when provided, must be a boolean.");if(t?.forceTranscode!==void 0&&typeof t.forceTranscode!="boolean")throw new TypeError("options.video.forceTranscode, when provided, must be a boolean.");if(t?.codec!==void 0&&!qo.includes(t.codec))throw new TypeError(`options.video.codec, when provided, must be one of: ${qo.join(", ")}.`);if(t?.bitrate!==void 0&&!(t.bitrate instanceof oo)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("options.video.bitrate, when provided, must be a positive integer or a quality.");if(t?.width!==void 0&&(!Number.isInteger(t.width)||t.width<=0))throw new TypeError("options.video.width, when provided, must be a positive integer.");if(t?.height!==void 0&&(!Number.isInteger(t.height)||t.height<=0))throw new TypeError("options.video.height, when provided, must be a positive integer.");if(t?.fit!==void 0&&!["fill","contain","cover"].includes(t.fit))throw new TypeError("options.video.fit, when provided, must be one of 'fill', 'contain', or 'cover'.");if(t?.width!==void 0&&t.height!==void 0&&t.fit===void 0)throw new TypeError("When both options.video.width and options.video.height are provided, options.video.fit must also be provided.");if(t?.rotate!==void 0&&![0,90,180,270].includes(t.rotate))throw new TypeError("options.video.rotate, when provided, must be 0, 90, 180 or 270.");if(t?.crop!==void 0&&pk(t.crop,"options.video."),t?.frameRate!==void 0&&(!Number.isFinite(t.frameRate)||t.frameRate<=0))throw new TypeError("options.video.frameRate, when provided, must be a finite positive number.");if(t?.alpha!==void 0&&!["discard","keep"].includes(t.alpha))throw new TypeError("options.video.alpha, when provided, must be either 'discard' or 'keep'.");if(t?.keyFrameInterval!==void 0&&(!Number.isFinite(t.keyFrameInterval)||t.keyFrameInterval<0))throw new TypeError("options.video.keyFrameInterval, when provided, must be a non-negative number.");if(t?.process!==void 0&&typeof t.process!="function")throw new TypeError("options.video.process, when provided, must be a function.");if(t?.processedWidth!==void 0&&(!Number.isInteger(t.processedWidth)||t.processedWidth<=0))throw new TypeError("options.video.processedWidth, when provided, must be a positive integer.");if(t?.processedHeight!==void 0&&(!Number.isInteger(t.processedHeight)||t.processedHeight<=0))throw new TypeError("options.video.processedHeight, when provided, must be a positive integer.")},pI=t=>{if(t!==void 0&&(!t||typeof t!="object"))throw new TypeError("options.audio, when provided, must be an object.");if(t?.discard!==void 0&&typeof t.discard!="boolean")throw new TypeError("options.audio.discard, when provided, must be a boolean.");if(t?.forceTranscode!==void 0&&typeof t.forceTranscode!="boolean")throw new TypeError("options.audio.forceTranscode, when provided, must be a boolean.");if(t?.codec!==void 0&&!Ko.includes(t.codec))throw new TypeError(`options.audio.codec, when provided, must be one of: ${Ko.join(", ")}.`);if(t?.bitrate!==void 0&&!(t.bitrate instanceof oo)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("options.audio.bitrate, when provided, must be a positive integer or a quality.");if(t?.numberOfChannels!==void 0&&(!Number.isInteger(t.numberOfChannels)||t.numberOfChannels<=0))throw new TypeError("options.audio.numberOfChannels, when provided, must be a positive integer.");if(t?.sampleRate!==void 0&&(!Number.isInteger(t.sampleRate)||t.sampleRate<=0))throw new TypeError("options.audio.sampleRate, when provided, must be a positive integer.");if(t?.process!==void 0&&typeof t.process!="function")throw new TypeError("options.audio.process, when provided, must be a function.");if(t?.processedNumberOfChannels!==void 0&&(!Number.isInteger(t.processedNumberOfChannels)||t.processedNumberOfChannels<=0))throw new TypeError("options.audio.processedNumberOfChannels, when provided, must be a positive integer.");if(t?.processedSampleRate!==void 0&&(!Number.isInteger(t.processedSampleRate)||t.processedSampleRate<=0))throw new TypeError("options.audio.processedSampleRate, when provided, must be a positive integer.")},Vv=2,Wv=48e3;class Tk{static async init(e){const n=new Tk(e);return await n._init(),n}constructor(e){if(this._addedCounts={video:0,audio:0,subtitle:0},this._totalTrackCount=0,this._trackPromises=[],this._executed=!1,this._synchronizer=new Qne,this._totalDuration=null,this._maxTimestamps=new Map,this._canceled=!1,this.onProgress=void 0,this._computeProgress=!1,this._lastProgress=0,this.isValid=!1,this.utilizedTracks=[],this.discardedTracks=[],!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.input instanceof c2))throw new TypeError("options.input must be an Input.");if(!(e.output instanceof m2))throw new TypeError("options.output must be an Output.");if(e.output._tracks.length>0||Object.keys(e.output._metadataTags).length>0||e.output.state!=="pending")throw new TypeError("options.output must be fresh: no tracks or metadata tags added and not started.");if(typeof e.video!="function"&&hI(e.video),typeof e.audio!="function"&&pI(e.audio),e.trim!==void 0&&(!e.trim||typeof e.trim!="object"))throw new TypeError("options.trim, when provided, must be an object.");if(e.trim?.start!==void 0&&(!Number.isFinite(e.trim.start)||e.trim.start<0))throw new TypeError("options.trim.start, when provided, must be a non-negative number.");if(e.trim?.end!==void 0&&(!Number.isFinite(e.trim.end)||e.trim.end<0))throw new TypeError("options.trim.end, when provided, must be a non-negative number.");if(e.trim?.start!==void 0&&e.trim.end!==void 0&&e.trim.start>=e.trim.end)throw new TypeError("options.trim.start must be less than options.trim.end.");if(e.tags!==void 0&&(typeof e.tags!="object"||!e.tags)&&typeof e.tags!="function")throw new TypeError("options.tags, when provided, must be an object or a function.");if(typeof e.tags=="object"&&Xx(e.tags),e.showWarnings!==void 0&&typeof e.showWarnings!="boolean")throw new TypeError("options.showWarnings, when provided, must be a boolean.");this._options=e,this.input=e.input,this.output=e.output,this._startTimestamp=e.trim?.start??0,this._endTimestamp=e.trim?.end??1/0;const{promise:n,resolve:r}=Xr();this._started=n,this._start=r}async _init(){const e=await this.input.getTracks(),n=this.output.format.getSupportedTrackCounts();let r=1,i=1;for(const c of e){let u;if(c.isVideoTrack()?this._options.video&&(typeof this._options.video=="function"?(u=await this._options.video(c,r),hI(u),r++):u=this._options.video):c.isAudioTrack()?this._options.audio&&(typeof this._options.audio=="function"?(u=await this._options.audio(c,i),pI(u),i++):u=this._options.audio):G(!1),u?.discard){this.discardedTracks.push({track:c,reason:"discarded_by_user"});continue}if(this._totalTrackCount===n.total.max){this.discardedTracks.push({track:c,reason:"max_track_count_reached"});continue}if(this._addedCounts[c.type]===n[c.type].max){this.discardedTracks.push({track:c,reason:"max_track_count_of_type_reached"});continue}c.isVideoTrack()?await this._processVideoTrack(c,u??{}):c.isAudioTrack()&&await this._processAudioTrack(c,u??{})}const s=await this.input.getMetadataTags();let o;if(this._options.tags){const c=typeof this._options.tags=="function"?await this._options.tags(s):this._options.tags;Xx(c),o=c}else o=s;const a=(await this.input.getFormat()).mimeType===this.output.format.mimeType,l=s.raw===o.raw;if(s.raw&&l&&!a&&delete o.raw,this.output.setMetadataTags(o),this.isValid=this._totalTrackCount>=n.total.min&&this._addedCounts.video>=n.video.min&&this._addedCounts.audio>=n.audio.min&&this._addedCounts.subtitle>=n.subtitle.min,this._options.showWarnings??!0){const c=[],u=this.discardedTracks.filter(d=>d.reason!=="discarded_by_user");u.length>0&&c.push("Some tracks had to be discarded from the conversion:",u),this.isValid||c.push(`

`+this._getInvalidityExplanation().join("")),c.length>0&&console.warn(...c)}}_getInvalidityExplanation(){const e=[];if(this.discardedTracks.length===0)e.push("Due to missing tracks, this conversion cannot be executed.");else{const n=this.discardedTracks.every(r=>r.reason==="discarded_by_user"||r.reason==="no_encodable_target_codec");if(e.push("Due to discarded tracks, this conversion cannot be executed."),n){const r=this.discardedTracks.flatMap(i=>i.reason==="discarded_by_user"?[]:i.track.type==="video"?this.output.format.getSupportedVideoCodecs():i.track.type==="audio"?this.output.format.getSupportedAudioCodecs():this.output.format.getSupportedSubtitleCodecs());r.length===1?e.push(`
Tracks were discarded because your environment is not able to encode '${r[0]}'.`):e.push(`
Tracks were discarded because your environment is not able to encode any of the following codecs: ${r.map(i=>`'${i}'`).join(", ")}.`),r.includes("mp3")&&e.push(`
The @mediabunny/mp3-encoder extension package provides support for encoding MP3.`)}else e.push(`
Check the discardedTracks field for more info.`)}return e}async execute(){if(!this.isValid)throw new Error(`Cannot execute this conversion because its output configuration is invalid. Make sure to always check the isValid field before executing a conversion.
`+this._getInvalidityExplanation().join(""));if(this._executed)throw new Error("Conversion cannot be executed twice.");if(this._executed=!0,this.onProgress){this._computeProgress=!0,this._totalDuration=Math.min(await this.input.computeDuration()-this._startTimestamp,this._endTimestamp-this._startTimestamp);for(const e of this.utilizedTracks)this._maxTimestamps.set(e.id,0);this.onProgress?.(0)}await this.output.start(),this._start();try{await Promise.all(this._trackPromises)}catch(e){throw this._canceled||this.cancel(),e}this._canceled&&await new Promise(()=>{}),await this.output.finalize(),this._computeProgress&&this.onProgress?.(1)}async cancel(){if(!(this.output.state==="finalizing"||this.output.state==="finalized")){if(this._canceled){console.warn("Conversion already canceled.");return}this._canceled=!0,await this.output.cancel()}}async _processVideoTrack(e,n){const r=e.codec;if(!r){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let i;const s=uk(e.rotation+(n.rotate??0)),o=this.output.format.supportsVideoRotationMetadata,[a,l]=s%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],c=n.crop;c&&hk(c,a,l);const[u,d]=c?[c.width,c.height]:[a,l];let f=u,h=d;const p=f/h,m=I=>Math.ceil(I/2)*2;n.width!==void 0&&n.height===void 0?(f=m(n.width),h=m(Math.round(f/p))):n.width===void 0&&n.height!==void 0?(h=m(n.height),f=m(Math.round(h*p))):n.width!==void 0&&n.height!==void 0&&(f=m(n.width),h=m(n.height));const g=await e.getFirstTimestamp(),y=!!n.forceTranscode||this._startTimestamp>0||g<0||!!n.frameRate||n.keyFrameInterval!==void 0||n.process!==void 0;let b=f!==u||h!==d||s!==0&&!o||!!c;const E=n.alpha??"discard";let C=this.output.format.getSupportedVideoCodecs();if(!y&&!n.bitrate&&!b&&C.includes(r)&&(!n.codec||n.codec===r)){const I=new Vne(r);i=I,this._trackPromises.push((async()=>{await this._started;const x=new kp(e),T={decoderConfig:await e.getDecoderConfig()??void 0},S=Number.isFinite(this._endTimestamp)?await x.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const _ of x.packets(void 0,S,{verifyKeyPackets:!0})){if(this._canceled)return;E==="discard"&&(delete _.sideData.alpha,delete _.sideData.alphaByteLength),this._reportProgress(e.id,_.timestamp),await I.add(_,T),this._synchronizer.shouldWait(e.id,_.timestamp)&&await this._synchronizer.wait(_.timestamp)}I.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}n.codec&&(C=C.filter(_=>_===n.codec));const x=n.bitrate??L0,P=await Hne(C,{width:n.process&&n.processedWidth?n.processedWidth:f,height:n.process&&n.processedHeight?n.processedHeight:h,bitrate:x});if(!P){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}const T={codec:P,bitrate:x,keyFrameInterval:n.keyFrameInterval,sizeChangeBehavior:n.fit??"passThrough",alpha:E},S=new dI(T);if(i=S,!b){const _=new m2({format:new xk,target:new Rne}),O=new dI(T);_.addVideoTrack(O),await _.start();const L=await new n2(e).getSample(g);if(L)try{await O.add(L),L.close(),await _.finalize()}catch(B){console.info("Error when probing encoder support. Falling back to rerender path.",B),b=!0,_.cancel()}else await _.cancel()}b?this._trackPromises.push((async()=>{await this._started;const O=new oee(e,{width:f,height:h,fit:n.fit??"fill",rotation:s,crop:n.crop,poolSize:1,alpha:E==="keep"}).canvases(this._startTimestamp,this._endTimestamp),F=n.frameRate;let L=null,B=null,N=null;const M=async R=>{G(L),G(F!==void 0);const H=Math.round((R-B)*F);for(let z=1;z<H;z++){const V=new wi(L,{timestamp:B+z/F,duration:1/F});await this._registerVideoSample(e,n,S,V)}};for await(const{canvas:R,timestamp:H,duration:z}of O){if(this._canceled)return;let V=Math.max(H-this._startTimestamp,0);if(N=V+z,F!==void 0){const Y=Math.floor(V*F)/F;if(L!==null)if(Y<=B){L=R,B=Y;continue}else await M(Y);V=Y}const Q=new wi(R,{timestamp:V,duration:F!==void 0?1/F:z});await this._registerVideoSample(e,n,S,Q),F!==void 0?(L=R,B=V):Q.close()}L&&(G(N!==null),G(F!==void 0),await M(Math.floor(N*F)/F)),S.close(),this._synchronizer.closeTrack(e.id)})()):this._trackPromises.push((async()=>{await this._started;const _=new n2(e),O=n.frameRate;let F=null,L=null,B=null;const N=async M=>{G(F),G(O!==void 0);const R=Math.round((M-L)*O);for(let H=1;H<R;H++)F.setTimestamp(L+H/O),F.setDuration(1/O),await this._registerVideoSample(e,n,S,F);F.close()};for await(const M of _.samples(this._startTimestamp,this._endTimestamp)){if(this._canceled){F?.close();return}let R=Math.max(M.timestamp-this._startTimestamp,0);if(B=R+M.duration,O!==void 0){const H=Math.floor(R*O)/O;if(F!==null)if(H<=L){F.close(),F=M,L=H;continue}else await N(H);R=H,M.setDuration(1/O)}M.setTimestamp(R),await this._registerVideoSample(e,n,S,M),O!==void 0?(F=M,L=R):M.close()}F&&(G(B!==null),G(O!==void 0),await N(Math.floor(B*O)/O)),S.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addVideoTrack(i,{frameRate:n.frameRate,languageCode:Sp(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,rotation:b?0:s}),this._addedCounts.video++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerVideoSample(e,n,r,i){if(this._canceled)return;this._reportProgress(e.id,i.timestamp);let s;if(!n.process)s=[i];else{let o=n.process(i);o instanceof Promise&&(o=await o),Array.isArray(o)||(o=o===null?[]:[o]),s=o.map(a=>a instanceof wi?a:typeof VideoFrame<"u"&&a instanceof VideoFrame?new wi(a):new wi(a,{timestamp:i.timestamp,duration:i.duration}))}for(const o of s){if(this._canceled)break;await r.add(o),this._synchronizer.shouldWait(e.id,o.timestamp)&&await this._synchronizer.wait(o.timestamp)}for(const o of s)o!==i&&o.close()}async _processAudioTrack(e,n){const r=e.codec;if(!r){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let i;const s=e.numberOfChannels,o=e.sampleRate,a=await e.getFirstTimestamp();let l=n.numberOfChannels??s,c=n.sampleRate??o,u=l!==s||c!==o||this._startTimestamp>0||a<0,d=this.output.format.getSupportedAudioCodecs();if(!n.forceTranscode&&!n.bitrate&&!u&&d.includes(r)&&(!n.codec||n.codec===r)&&!n.process){const f=new qne(r);i=f,this._trackPromises.push((async()=>{await this._started;const h=new kp(e),m={decoderConfig:await e.getDecoderConfig()??void 0},g=Number.isFinite(this._endTimestamp)?await h.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const y of h.packets(void 0,g)){if(this._canceled)return;this._reportProgress(e.id,y.timestamp),await f.add(y,m),this._synchronizer.shouldWait(e.id,y.timestamp)&&await this._synchronizer.wait(y.timestamp)}f.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}let h=null;n.codec&&(d=d.filter(g=>g===n.codec));const p=n.bitrate??L0,m=await p2(d,{numberOfChannels:n.process&&n.processedNumberOfChannels?n.processedNumberOfChannels:l,sampleRate:n.process&&n.processedSampleRate?n.processedSampleRate:c,bitrate:p});if(!m.some(g=>Wh.includes(g))&&d.some(g=>Wh.includes(g))&&(l!==Vv||c!==Wv)){const y=(await p2(d,{numberOfChannels:Vv,sampleRate:Wv,bitrate:p})).find(b=>Wh.includes(b));y&&(u=!0,h=y,l=Vv,c=Wv)}else h=m[0]??null;if(h===null){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}if(u)i=this._resampleAudio(e,n,h,l,c,p);else{const g=new fI({codec:h,bitrate:p});i=g,this._trackPromises.push((async()=>{await this._started;const y=new QA(e);for await(const b of y.samples(void 0,this._endTimestamp)){if(this._canceled)return;await this._registerAudioSample(e,n,g,b),b.close()}g.close(),this._synchronizer.closeTrack(e.id)})())}}this.output.addAudioTrack(i,{languageCode:Sp(e.languageCode)?e.languageCode:void 0,name:e.name??void 0}),this._addedCounts.audio++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerAudioSample(e,n,r,i){if(this._canceled)return;this._reportProgress(e.id,i.timestamp);let s;if(!n.process)s=[i];else{let o=n.process(i);if(o instanceof Promise&&(o=await o),Array.isArray(o)||(o=o===null?[]:[o]),!o.every(a=>a instanceof Zs))throw new TypeError("The audio process function must return an AudioSample, null, or an array of AudioSamples.");s=o}for(const o of s){if(this._canceled)break;await r.add(o),this._synchronizer.shouldWait(e.id,o.timestamp)&&await this._synchronizer.wait(o.timestamp)}for(const o of s)o!==i&&o.close()}_resampleAudio(e,n,r,i,s,o){const a=new fI({codec:r,bitrate:o});return this._trackPromises.push((async()=>{await this._started;const l=new Xne({targetNumberOfChannels:i,targetSampleRate:s,startTime:this._startTimestamp,endTime:this._endTimestamp,onSample:d=>this._registerAudioSample(e,n,a,d)}),u=new QA(e).samples(this._startTimestamp,this._endTimestamp);for await(const d of u){if(this._canceled)return;await l.add(d)}await l.finalize(),a.close(),this._synchronizer.closeTrack(e.id)})()),a}_reportProgress(e,n){if(!this._computeProgress)return;G(this._totalDuration!==null),this._maxTimestamps.set(e,Math.max(n,this._maxTimestamps.get(e)));const r=Math.min(...this._maxTimestamps.values()),i=Or(r/this._totalDuration,0,1);i!==this._lastProgress&&(this._lastProgress=i,this.onProgress?.(i))}}const mI=5;class Qne{constructor(){this.maxTimestamps=new Map,this.resolvers=[]}computeMinAndMaybeResolve(){let e=1/0;for(const[,n]of this.maxTimestamps)e=Math.min(e,n);for(let n=0;n<this.resolvers.length;n++){const r=this.resolvers[n];r.timestamp-e<mI&&(r.resolve(),this.resolvers.splice(n,1),n--)}return e}shouldWait(e,n){this.maxTimestamps.set(e,Math.max(n,this.maxTimestamps.get(e)??-1/0));const r=this.computeMinAndMaybeResolve();return n-r>=mI}wait(e){const{promise:n,resolve:r}=Xr();return this.resolvers.push({timestamp:e,resolve:r}),n}closeTrack(e){this.maxTimestamps.delete(e),this.computeMinAndMaybeResolve()}}class Xne{constructor(e){this.sourceSampleRate=null,this.sourceNumberOfChannels=null,this.targetSampleRate=e.targetSampleRate,this.targetNumberOfChannels=e.targetNumberOfChannels,this.startTime=e.startTime,this.endTime=e.endTime,this.onSample=e.onSample,this.bufferSizeInFrames=Math.floor(this.targetSampleRate*5),this.bufferSizeInSamples=this.bufferSizeInFrames*this.targetNumberOfChannels,this.outputBuffer=new Float32Array(this.bufferSizeInSamples),this.bufferStartFrame=0,this.maxWrittenFrame=-1}doChannelMixerSetup(){G(this.sourceNumberOfChannels!==null);const e=this.sourceNumberOfChannels,n=this.targetNumberOfChannels;e===1&&n===2?this.channelMixer=(r,i)=>r[i*e]:e===1&&n===4?this.channelMixer=(r,i,s)=>r[i*e]*+(s<2):e===1&&n===6?this.channelMixer=(r,i,s)=>r[i*e]*+(s===2):e===2&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return .5*(r[s]+r[s+1])}:e===2&&n===4?this.channelMixer=(r,i,s)=>r[i*e+s]*+(s<2):e===2&&n===6?this.channelMixer=(r,i,s)=>r[i*e+s]*+(s<2):e===4&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return .25*(r[s]+r[s+1]+r[s+2]+r[s+3])}:e===4&&n===2?this.channelMixer=(r,i,s)=>{const o=i*e;return .5*(r[o+s]+r[o+s+2])}:e===4&&n===6?this.channelMixer=(r,i,s)=>{const o=i*e;return s<2?r[o+s]:s===2||s===3?0:r[o+s-2]}:e===6&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return Math.SQRT1_2*(r[s]+r[s+1])+r[s+2]+.5*(r[s+4]+r[s+5])}:e===6&&n===2?this.channelMixer=(r,i,s)=>{const o=i*e;return r[o+s]+Math.SQRT1_2*(r[o+2]+r[o+s+4])}:e===6&&n===4?this.channelMixer=(r,i,s)=>{const o=i*e;return s<2?r[o+s]+Math.SQRT1_2*r[o+2]:r[o+s+2]}:this.channelMixer=(r,i,s)=>s<e?r[i*e+s]:0}ensureTempBufferSize(e){let n=this.tempSourceBuffer.length;for(;n<e;)n*=2;if(n!==this.tempSourceBuffer.length){const r=new Float32Array(n);r.set(this.tempSourceBuffer),this.tempSourceBuffer=r}}async add(e){this.sourceSampleRate===null&&(this.sourceSampleRate=e.sampleRate,this.sourceNumberOfChannels=e.numberOfChannels,this.tempSourceBuffer=new Float32Array(this.sourceSampleRate*this.sourceNumberOfChannels),this.doChannelMixerSetup());const n=e.numberOfFrames*e.numberOfChannels;this.ensureTempBufferSize(n);const r=e.allocationSize({planeIndex:0,format:"f32"}),i=new Float32Array(this.tempSourceBuffer.buffer,0,r/4);e.copyTo(i,{planeIndex:0,format:"f32"});const s=e.timestamp-this.startTime,o=e.numberOfFrames/this.sourceSampleRate,a=Math.min(s+o,this.endTime-this.startTime),l=Math.floor(s*this.targetSampleRate),c=Math.ceil(a*this.targetSampleRate);for(let u=l;u<c;u++){if(u<this.bufferStartFrame)continue;for(;u>=this.bufferStartFrame+this.bufferSizeInFrames;)await this.finalizeCurrentBuffer(),this.bufferStartFrame+=this.bufferSizeInFrames;const d=u-this.bufferStartFrame;G(d<this.bufferSizeInFrames);const p=(u/this.targetSampleRate-s)*this.sourceSampleRate,m=Math.floor(p),g=Math.ceil(p),y=p-m;for(let b=0;b<this.targetNumberOfChannels;b++){let E=0,C=0;m>=0&&m<e.numberOfFrames&&(E=this.channelMixer(i,m,b)),g>=0&&g<e.numberOfFrames&&(C=this.channelMixer(i,g,b));const I=E+y*(C-E),x=d*this.targetNumberOfChannels+b;this.outputBuffer[x]+=I}this.maxWrittenFrame=Math.max(this.maxWrittenFrame,d)}}async finalizeCurrentBuffer(){if(this.maxWrittenFrame<0)return;const e=(this.maxWrittenFrame+1)*this.targetNumberOfChannels,n=new Float32Array(e);n.set(this.outputBuffer.subarray(0,e));const r=this.bufferStartFrame/this.targetSampleRate,i=new Zs({format:"f32",sampleRate:this.targetSampleRate,numberOfChannels:this.targetNumberOfChannels,timestamp:r,data:n});await this.onSample(i),this.outputBuffer.fill(0),this.maxWrittenFrame=-1}finalize(){return this.finalizeCurrentBuffer()}}const Zm=["wss://purplepag.es/","wss://directory.yabu.me/","wss://indexer.coracle.social/","wss://user.kindpag.es/"],Qm=["wss://relay.nostr.band/","wss://nos.lol/","wss://relay.damus.io/","wss://relay-jp.nostr.wirednet.jp/","wss://yabu.me/","wss://r.kojira.io/","wss://nrelay-jp.c-stellar.net/"],yh="https://nostr.build/api/v2/upload/files",gI=1024*1024*1024,Zc={none:{skip:!0},low:{maxWidthOrHeight:2048,fileType:"image/webp",initialQuality:.95,useWebWorker:!0},medium:{maxWidthOrHeight:1024,fileType:"image/webp",initialQuality:.8,useWebWorker:!0},high:{maxWidthOrHeight:800,fileType:"image/webp",initialQuality:.5,useWebWorker:!0}},Pg={none:{skip:!0},low:{crf:20,preset:"superfast",maxSize:1280,audioBitrate:"128k",mediabunnyVideoQuality:L0,mediabunnyAudioQuality:L0},medium:{crf:26,preset:"superfast",maxSize:640,audioBitrate:"64k",audioSampleRate:44100,mediabunnyVideoQuality:uI,mediabunnyAudioQuality:uI},high:{crf:28,preset:"medium",maxSize:320,audioBitrate:"32k",audioSampleRate:16e3,audioChannels:1,mediabunnyVideoQuality:cI,mediabunnyAudioQuality:cI}},g2=/(?:^|[\s\n\u3000])#([^\s\n\u3000#]+)/g,Yne=["http:","https:"],Jne=[".png",".jpg",".jpeg",".gif",".webp",".svg"],ere=[".mp4",".webm",".mov",".avi",".mkv"],tre=400,nre=10,yI=100,bI=1,rre=10,bi={LOCALE:"locale",UPLOAD_ENDPOINT:"uploadEndpoint",CLIENT_TAG_ENABLED:"clientTagEnabled",IMAGE_COMPRESSION_LEVEL:"imageCompressionLevel",VIDEO_COMPRESSION_LEVEL:"videoCompressionLevel",DRAFTS:"nostr-drafts"},t5=20,Xm=50,ire=1e3,n5=[{label:"share.yabu.me",url:"https://share.yabu.me/api/v2/media"},{label:"nostpic.com",url:"https://nostpic.com/api/v2/media"},{label:"nostrcheck.me",url:"https://nostrcheck.me/api/v2/media"},{label:"files.sovbit.host",url:"https://files.sovbit.host/api/v2/media"},{label:"nostr.build",url:"https://nostr.build/api/v2/nip96/upload"}];function _k(t){return t==="ja"?"https://share.yabu.me/api/v2/media":"https://nostrcheck.me/api/v2/media"}function sre(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}function ore(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}const sr={MIN_SCALE:1,MAX_SCALE:100,DEFAULT_SCALE:1,DOUBLE_CLICK_SCALE:2.5,RESET_THRESHOLD:1.3,ZOOM_DELTA:{IN:1.1,OUT:.9},THRESHOLD:.1,PINCH_MIN_DISTANCE:10},wI={FRICTION:.92,MIN_VELOCITY:.1},r5={EDITOR_FOCUS_DELAY:100,TRANSITION_DURATION:"0.3s"},are={EDITOR:".tiptap-editor"},So={URL_REGEX:/https?:\/\/[^\s\u3000]+/gi,DEBOUNCE_DELAY:300,ENABLE_HASHTAGS:!0,ENABLE_AUTO_LINK:!0,ENABLE_IMAGE_CONVERSION:!0,HASHTAG_CLASS:"hashtag",PLUGIN_KEYS:{HASHTAG_DECORATION:"hashtag-decoration",LINK_AND_IMAGE_CONVERSION:"link-and-image-conversion",CONTENT_UPDATE_TRACKER:"content-update-tracker"}},lre=["balloonMessage.info.hello","balloonMessage.info.hello2","balloonMessage.info.welcome","balloonMessage.info.waited","balloonMessage.info.relax","balloonMessage.info.good_weather","balloonMessage.info.thwomp","balloonMessage.info.sleep_on_floor","balloonMessage.info.home_here","balloonMessage.info.donai","balloonMessage.info.kita_na","balloonMessage.info.no_licking","balloonMessage.info.not_thwomp","balloonMessage.info.kitte_origin","balloonMessage.info.normal_stamp","balloonMessage.info.backside_curious","balloonMessage.info.corner_weapon","balloonMessage.info.square_peace","balloonMessage.info.how_much_stamp","balloonMessage.info.cancellation_done","balloonMessage.info.want_to_roll","balloonMessage.info.want_candy","balloonMessage.info.tetris_gone","balloonMessage.info.comfy_here","balloonMessage.info.what_did_you_eat","balloonMessage.info.go_to_bed_early","balloonMessage.info.did_you_brush_teeth","balloonMessage.info.kit-ten_ketten","balloonMessage.info.such_is_life"],cre=["balloonMessage.success.post_success","balloonMessage.success.sent","balloonMessage.success.to_everyone"],ure="balloonMessage.error.post_error",jv={MAX_WAIT_TIME:15e3,RETRY_INTERVAL:1e3,TIMEOUT_MESSAGE:"Upload processing timeout"},dre=/nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{10,}/,fre=/^nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58}$/,ka={INDEXEDDB_NAME:"share-handler-db",INDEXEDDB_VERSION:1,STORE_NAME:"flags",REQUEST_TIMEOUT:3e3,SW_CONTROLLER_WAIT_TIMEOUT:100};class B0{static parseKind10002Tags(e){const n={};return e.filter(r=>Array.isArray(r)&&r.length>=2&&r[0]==="r").forEach(r=>{const i=r[1];if(!i||typeof i!="string")return;let s=!0,o=!0;r.length>2&&(r.length===3?r[2]==="read"?o=!1:r[2]==="write"&&(s=!1):(s=r.includes("read"),o=r.includes("write"))),n[i]={read:s,write:o}}),n}static parseKind3Content(e){try{const n=JSON.parse(e);return n&&typeof n=="object"&&!Array.isArray(n)?n:null}catch{return null}}static isValidRelayConfig(e){return e?Array.isArray(e)?e.every(n=>typeof n=="string"):typeof e=="object"?Object.entries(e).every(([n,r])=>typeof n=="string"&&r&&typeof r=="object"&&"read"in r&&"write"in r&&typeof r.read=="boolean"&&typeof r.write=="boolean"):!1:!1}}class Mh{static normalizeRelayUrl(e){return e.endsWith("/")?e:e+"/"}static mergeRelayConfigs(...e){const n=new Set;return e.forEach(r=>{Array.isArray(r)?r.forEach(i=>n.add(this.normalizeRelayUrl(i))):typeof r=="object"&&Object.keys(r).forEach(i=>{n.add(this.normalizeRelayUrl(i))})}),Array.from(n)}static extractWriteRelays(e){return Array.isArray(e)?e.map(n=>this.normalizeRelayUrl(n)):typeof e=="object"?Object.keys(e).filter(n=>e[n]?.write!==!1).map(n=>this.normalizeRelayUrl(n)):[]}static extractAllRelays(e){return Array.isArray(e)?e.map(n=>this.normalizeRelayUrl(n)):typeof e=="object"?Object.keys(e).map(n=>this.normalizeRelayUrl(n)):[]}}class hre{constructor(e,n,r,i){this.localStorage=e,this.console=n,this.relayListUpdatedStore=r,this.pubkeyHex=i}setPubkey(e){this.pubkeyHex=e}save(e,n){try{const r=`nostr-relays-${e}`;if(n===null){if(this.localStorage.removeItem(r),this.console.log(`ãªã¬ã¼ãªã¹ããåé¤: ${e}`),typeof window<"u")try{DI(e,{})}catch{}return}if(!B0.isValidRelayConfig(n)){this.console.warn("ç¡å¹ãªãªã¬ã¼è¨­å®ã®ããä¿å­ãã¹ã­ãã:",n);return}if(this.localStorage.setItem(r,JSON.stringify(n)),typeof window<"u")try{DI(e,n)}catch(i){this.console.warn("ã¹ãã¢ã®æ´æ°ã«å¤±æ:",i)}this.relayListUpdatedStore&&this.relayListUpdatedStore.set(this.relayListUpdatedStore.value+1),this.console.log("ãªã¬ã¼ãªã¹ããã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){this.console.error("ãªã¬ã¼ãªã¹ãã®ä¿å­ã«å¤±æ:",r)}}get(e){try{const n=`nostr-relays-${e}`,r=this.localStorage.getItem(n);if(!r)return null;const i=JSON.parse(r);return B0.isValidRelayConfig(i)?i:null}catch(n){return this.console.error("ãªã¬ã¼ãªã¹ãã®åå¾ã«å¤±æ:",n),null}}clear(e){this.save(e,null)}}class pre{constructor(e,n,r,i){this.rxNostr=e,this.console=n,this.setTimeoutFn=r,this.clearTimeoutFn=i}async fetchKind10002(e,n,r=3e3){return this.console.log(`Kind 10002åå¾è©¦è¡: ${e}`),new Promise(i=>{const s=Xg();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=d=>{a||(a=!0,c(),i(d))};try{l=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:d=>{if(!a&&d.event?.kind===10002&&d.event.pubkey===e)try{const f=B0.parseKind10002Tags(d.event.tags);Object.keys(f).length>0&&(o=!0,this.console.log("Kind 10002ãããªã¬ã¼ãåå¾:",f),u({success:!0,relayConfig:f,source:"kind10002"}))}catch(f){this.console.error("Kind 10002ã®ãã¼ã¹ã¨ã©ã¼:",f)}},complete:()=>{a||(o||this.console.log("Kind 10002: EOSEåä¿¡ãã¤ãã³ããªã"),u({success:o,error:o?void 0:"not_found"}))},error:d=>{a||(this.console.error("Kind 10002åå¾ã¨ã©ã¼:",d),u({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[10002],until:Math.floor(Date.now()/1e3)}),s.over()}catch(d){this.console.error("Kind 10002ãªã¯ã¨ã¹ãä½æã¨ã©ã¼:",d),u({success:!1,error:"request_error"})}})}async fetchKind3(e,n,r=3e3){return this.console.log(`Kind 3åå¾è©¦è¡: ${e}`),new Promise(i=>{const s=Xg();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=d=>{a||(a=!0,c(),i(d))};try{l=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:d=>{if(!a&&d.event?.kind===3&&d.event.pubkey===e){const f=B0.parseKind3Content(d.event.content);f&&(o=!0,this.console.log("Kind 3ãããªã¬ã¼ãåå¾:",f),u({success:!0,relayConfig:f,source:"kind3"}))}},complete:()=>{a||(o||this.console.log("Kind 3: EOSEåä¿¡ãã¤ãã³ããªã"),u({success:o,error:o?void 0:"not_found"}))},error:d=>{a||(this.console.error("Kind 3åå¾ã¨ã©ã¼:",d),u({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[3],until:Math.floor(Date.now()/1e3)}),s.over()}catch(d){this.console.error("Kind 3ãªã¯ã¨ã¹ãä½æã¨ã©ã¼:",d),u({success:!1,error:"request_error"})}})}}class mre{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.console||(typeof window<"u"?window.console:{}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.relayListUpdatedStore||(typeof window<"u"?{value:0,set:l=>{}}:void 0);this.storage=new hre(r,i,a),this.networkFetcher=new pre(e,i,s,o)}storage;networkFetcher;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}setBootstrapRelays(){try{this.rxNostr.use(Xg(),{on:{relays:Zm}}).subscribe()}catch(e){console.error("Bootstrap relaysè¨­å®ã¨ã©ã¼:",e)}}useRelaysFromLocalStorageIfExists(e){const n=this.storage.get(e);if(n)try{return this.rxNostr.setDefaultRelays(n),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼ãªã¹ããä½¿ç¨:",n),!0}catch(r){return console.error("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼è¨­å®ã¨ã©ã¼:",r),this.storage.clear(e),!1}return!1}async fetchUserRelays(e,n={}){const r=n.timeoutMs||3e3;if(console.log(`ãªã¬ã¼åå¾éå§: ${e}`),!n.forceRemote){const o=this.storage.get(e);if(o)return this.rxNostr.setDefaultRelays(o),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ãããªã¬ã¼ãå¾©åãã¾ãã"),{success:!0,relayConfig:o,source:"localStorage"}}console.log("ãªã¢ã¼ããããªã¬ã¼æå ±ãåå¾ä¸­...");const i=await this.networkFetcher.fetchKind10002(e,Zm,r);if(i.success&&i.relayConfig)return this.rxNostr.setDefaultRelays(i.relayConfig),this.storage.save(e,i.relayConfig),console.log("Kind 10002ãããªã¬ã¼åå¾æå"),{success:!0,relayConfig:i.relayConfig,source:"kind10002"};const s=await this.networkFetcher.fetchKind3(e,Zm,r);return s.success&&s.relayConfig?(this.rxNostr.setDefaultRelays(s.relayConfig),this.storage.save(e,s.relayConfig),console.log("Kind 3ãããªã¬ã¼åå¾æå"),{success:!0,relayConfig:s.relayConfig,source:"kind3"}):(console.log("ãªã¢ã¼ãåå¾å¤±æããã©ã¼ã«ããã¯ãªã¬ã¼ãä½¿ç¨"),this.rxNostr.setDefaultRelays(Qm),console.log("ãã©ã¼ã«ããã¯ãªã¬ã¼ãè¨­å®:",Qm),this.storage.save(e,Qm),{success:!1,relayConfig:Qm,source:"fallback"})}getRelayListsForProfile(e,n=Zm){const r=this.storage.get(e);let i=[],s=[];return r?(i=Mh.extractWriteRelays(r),s=Mh.mergeRelayConfigs(r,n)):s=n.map(o=>Mh.normalizeRelayUrl(o)),{writeRelays:i,additionalRelays:s}}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}loadRelayConfigForUI(e){const n=this.storage.get(e);if(!n)return null;const r=Mh.extractWriteRelays(n);return{relayConfig:n,writeRelays:r}}}let vI=ge(Nt({info:null,visible:!1}));const _d={get value(){return k(vI)},set:t=>{K(vI,t,!0)}};let qv=ge(!1);const an={get value(){return k(qv)},set:t=>{K(qv,t,!0)},reset:()=>{K(qv,!1)}};let F0=null;function gre(t){F0=t}function yre(){return F0}let $0=null;function bre(t){$0=t}function wre(){return $0}function vre(){an.set(!0),F0&&F0.abort(),$0&&$0.abort(),Gh.set(0),Zh.set(0)}const z0={type:"none",isAuthenticated:!1,pubkey:"",npub:"",nprofile:"",isValid:!1,isInitialized:!1,isExtensionLogin:!1};let mf=ge(Nt({...z0}));const Dr={get value(){return k(mf)||z0},subscribe:t=>{Ge(()=>{t(k(mf)||z0)})}};function Ck(t){const n={...k(mf),...t};n.isAuthenticated=n.type!=="none"&&n.isValid,n.isExtensionLogin=n.isAuthenticated&&n.type==="nostr-login"&&typeof window<"u"&&typeof window.nostr=="object"&&typeof window.nostr.signEvent=="function",K(mf,n,!0),console.log("[updateAuthState] èªè¨¼ç¶æãæ´æ°:",{type:n.type,isAuthenticated:n.isAuthenticated,isValid:n.isValid,pubkey:n.pubkey?n.pubkey.substring(0,8)+"...":"empty"})}function xI(t=!0){K(mf,{...z0,isInitialized:t?k(mf).isInitialized:!1},!0)}function xre(t,e,n){if(!t||!e||!n){console.warn("setNsecAuth: All parameters are required");return}Ck({type:"nsec",pubkey:t,npub:e,nprofile:n,isValid:!0})}function SI(t,e,n,r){if(!t||!e||!n){console.warn("setNostrLoginAuth: All parameters are required");return}console.log("[setNostrLoginAuth] NostrLoginèªè¨¼ç¶æãæ´æ°:",{pubkey:t.substring(0,8)+"...",npub:e.substring(0,12)+"...",type:"nostr-login",nostrLoginAuthMethod:r}),Ck({type:"nostr-login",pubkey:t,npub:e,nprofile:n,isValid:!0,nostrLoginAuthMethod:r})}function Sre(){Ck({isInitialized:!0})}const Mr=Nt({file:null,metadata:void 0,received:!1});function EI(t,e){Mr.file=t,Mr.metadata=e,Mr.received=!!t}function Ere(){Mr.file=null,Mr.metadata=void 0,Mr.received=!1}const mu=Nt({content:null,received:!1});function kre(t){mu.content=t,mu.received=!!t}function Tre(){mu.content=null,mu.received=!1}function _re(){return Mr.file}function Cre(){return Mr.metadata}let kI=ge(!1),TI=ge(!1),_I=ge(!1),CI=ge(!1);const Kh={get value(){return k(kI)},set:t=>{K(kI,t,!0)}},U0={get value(){return k(TI)},set:t=>{K(TI,t,!0)}},Ak={get value(){return k(_I)},set:t=>{K(_I,t,!0)}},bh={get value(){return k(CI)},set:t=>{K(CI,t,!0)}};let AI=ge(!1),II=ge(!1),PI=ge(null);const Ym={get value(){return k(AI)},set:t=>{K(AI,t,!0)}},ld={get value(){return k(II)},set:t=>{K(II,t,!0)}},Jm={get value(){return k(PI)},set:t=>{K(PI,t,!0)}},i5=(()=>{try{if(typeof BA=="function")return BA({onRegistered:t=>{console.log("SW registered successfully",t)},onRegisterError(t){console.warn("SW registration error",t)},onNeedRefresh(){console.log("SW needs refresh - showing prompt")},immediate:!0,onOfflineReady(){console.log("App ready to work offline")}})}catch(t){console.warn("Failed to initialize Service Worker:",t)}return{needRefresh:{subscribe:()=>{}},updateServiceWorker:()=>{}}})(),Ik=i5.needRefresh,Are=i5.updateServiceWorker;let Kv=ge(null);const s5={get value(){return k(Kv)},set:t=>{K(Kv,t,!0)},subscribe:t=>{Ge(()=>{t(k(Kv))})}};let Gv=ge(Nt({name:"",picture:"",npub:"",nprofile:""})),Zv=ge(!1),Qv=ge(!1);const Vl={get value(){return k(Gv)},set:t=>{K(Gv,t,!0)},subscribe:t=>{Ge(()=>{t(k(Gv))})}},gd={get value(){return k(Zv)},set:t=>{K(Zv,t,!0)},subscribe:t=>{Ge(()=>{t(k(Zv))})}},Hs={get value(){return k(Qv)},set:t=>{K(Qv,t,!0)},subscribe:t=>{Ge(()=>{t(k(Qv))})}};let Xv=ge(!1);const Ire={get value(){return k(Xv)},set:t=>{K(Xv,t,!0)},subscribe:t=>{Ge(()=>{t(k(Xv))})}};let Yv=ge(0);const Gh={get value(){return k(Yv)},set:t=>{K(Yv,t,!0)},subscribe:t=>{Ge(()=>{t(k(Yv))})}};let Jv=ge(0);const Zh={get value(){return k(Jv)},set:t=>{K(Jv,t,!0)},subscribe:t=>{Ge(()=>{t(k(Jv))})}};Nt({content:"",hashtags:[],tags:[]});let e1=ge(null);const Pre={get value(){return k(e1)},set:t=>{K(e1,t,!0)},subscribe:t=>{Ge(()=>{t(k(e1))})}};let y2=null,t1=ge(Nt([])),n1=ge(null),OI=ge(!1),MI=ge(!1);const Qh={get value(){return k(t1)},set:t=>{K(t1,t,!0)},subscribe:t=>{Ge(()=>{t(k(t1))})}},Og={get value(){return k(n1)},set:t=>{K(n1,t,!0)},subscribe:t=>{Ge(()=>{t(k(n1))})}},b2={get value(){return k(OI)},set:t=>{K(OI,t,!0)}},NI={get value(){return k(MI)},set:t=>{K(MI,t,!0)}};let Mg=ge(0);const w2={get value(){return k(Mg)},set:t=>{K(Mg,t,!0)},subscribe:t=>{Ge(()=>{t(k(Mg))})}};function Ore(t){y2=t}function RI(t){if(!y2||!t){Og.set(null),Qh.set([]);return}const e=y2.loadRelayConfigForUI(t);if(!e){Og.set(null),Qh.set([]);return}Og.set(e.relayConfig),Qh.set(e.writeRelays)}function DI(t,e){if(!t)return;const n=`nostr-relays-${t}`;try{localStorage.setItem(n,JSON.stringify(e)),Og.set(e);const r=Mh.extractWriteRelays(e);Qh.set(r),w2.set(k(Mg)+1)}catch(r){console.error("ãªã¬ã¼è¨­å®ã®ä¿å­ã¨ã©ã¼:",r)}}const is=Ts({open:!1,nodeId:void 0,src:void 0});let LI=ge(null);const za={get value(){return k(LI)},set:t=>{K(LI,t,!0)}};let ur=Nt({showSecretKeyDialog:!1,pendingPost:"",showImageFullscreen:!1,fullscreenImageSrc:"",fullscreenImageAlt:"",showPopupModal:!1,popupX:0,popupY:0,popupMessage:""});const ua={get value(){return ur},subscribe:t=>{Ge(()=>{t(ur)})},showSecretKeyDialog:t=>{ur.pendingPost=t,ur.showSecretKeyDialog=!0},hideSecretKeyDialog:()=>{ur.showSecretKeyDialog=!1,ur.pendingPost=""},getPendingPost:()=>ur.pendingPost,showImageFullscreen:(t,e="")=>{ur.fullscreenImageSrc=t,ur.fullscreenImageAlt=e,ur.showImageFullscreen=!0},hideImageFullscreen:()=>{ur.showImageFullscreen=!1,ur.fullscreenImageSrc="",ur.fullscreenImageAlt=""},showPopupMessage:(t,e,n,r=1800)=>{ur.popupX=t,ur.popupY=e,ur.popupMessage=n,ur.showPopupModal=!0,setTimeout(()=>{ur.showPopupModal=!1},r)},hidePopupMessage:()=>{ur.showPopupModal=!1}};function BI(t,e=3e3){if(t===null){o5();return}_d.set({info:t,visible:!0})}function o5(){_d.set({info:null,visible:!1})}function Mre(){Kh.set(!0)}function eg(){Kh.set(!1)}function Nre(){U0.set(!0)}function Rre(){U0.set(!1)}function Dre(){Ak.set(!0)}function Lre(){Ak.set(!1)}function Bre(){Are(!0)}function Fre(){return navigator.serviceWorker?.controller?new Promise(t=>{const e=new MessageChannel;if(e.port1.onmessage=n=>{n.data?.version?(s5.set(n.data.version),t(n.data.version)):t(null)},navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({type:"GET_VERSION"},[e.port2]);else{t(null);return}setTimeout(()=>t(null),2e3)}):Promise.resolve(null)}const Ec={setBodyStyle(t,e){document.body.style.setProperty(t,e)},querySelector(t){return document.querySelector(t)},querySelectorAll(t){return document.querySelectorAll(t)},focusElement(t){t.focus()}};function gu(t,e){Ec.setBodyStyle(t,e)}function $re(){gu("overflow",""),gu("user-select",""),gu("-webkit-user-select","")}function zre(){return document.activeElement}function Ure(t){return t.classList?.contains?.("tiptap-editor")||!!t.closest?.(".tiptap-editor")}function Hre(t){return["INPUT","TEXTAREA"].includes(t.tagName)||t.isContentEditable}function Vre(){const t=zre();t&&(Ure(t)||Hre(t))&&(t.blur?.(),document.body?.focus?.())}function Ra(){return typeof window<"u"&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0||navigator&&!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|Mobile/i))}function a5(){try{if(Vre(),Ra()){const t=document.querySelector(".tiptap-editor");t&&t.blur?.()}}catch{}}const Wre={setTimeout:(t,e)=>setTimeout(t,e)};function jre(t,e,n=Wre){n.setTimeout(()=>{const r=Ec.querySelector(t);r&&Ec.focusElement(r)},e)}function qre(t=200){if(!(typeof window>"u"||typeof navigator>"u"))if("vibrate"in navigator)try{navigator.vibrate(t)}catch{}else try{const e=document.getElementById("vibrateSwitch");e&&e.click()}catch{}}var Kre=1063;function Gre(t){const e={content:t.content,created_at:Math.floor(Date.now()/1e3),kind:Kre,tags:[["url",t.url],["m",t.m],["x",t.x],["ox",t.ox]]};return t.size&&e.tags.push(["size",t.size]),t.dim&&e.tags.push(["dim",t.dim]),t.i&&e.tags.push(["i",t.i]),t.blurhash&&e.tags.push(["blurhash",t.blurhash]),t.thumb&&e.tags.push(["thumb",t.thumb]),t.image&&e.tags.push(["image",t.image]),t.summary&&e.tags.push(["summary",t.summary]),t.alt&&e.tags.push(["alt",t.alt]),t.fallback&&t.fallback.forEach(n=>e.tags.push(["fallback",n])),e}var l5=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],Nh=t=>{let e=0;for(let n=0;n<t.length;n++){let r=t[n],i=l5.indexOf(r);e=e*83+i}return e},wh=(t,e)=>{var n="";for(let r=1;r<=e;r++){let i=Math.floor(t)/Math.pow(83,e-r)%83;n+=l5[Math.floor(i)]}return n},Wd=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},jd=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},Zre=t=>t<0?-1:1,qd=(t,e)=>Zre(t)*Math.pow(Math.abs(t),e),H0=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},Qre=t=>{if(!t||t.length<6)throw new H0("The blurhash string must be at least 6 characters");let e=Nh(t[0]),n=Math.floor(e/9)+1,r=e%9+1;if(t.length!==4+2*r*n)throw new H0(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*r*n}`)},Xre=t=>{let e=t>>16,n=t>>8&255,r=t&255;return[Wd(e),Wd(n),Wd(r)]},Yre=(t,e)=>{let n=Math.floor(t/361),r=Math.floor(t/19)%19,i=t%19;return[qd((n-9)/9,2)*e,qd((r-9)/9,2)*e,qd((i-9)/9,2)*e]},Jre=(t,e,n,r)=>{Qre(t),r=r|1;let i=Nh(t[0]),s=Math.floor(i/9)+1,o=i%9+1,a=(Nh(t[1])+1)/166,l=new Array(o*s);for(let d=0;d<l.length;d++)if(d===0){let f=Nh(t.substring(2,6));l[d]=Xre(f)}else{let f=Nh(t.substring(4+d*2,6+d*2));l[d]=Yre(f,a*r)}let c=e*4,u=new Uint8ClampedArray(c*n);for(let d=0;d<n;d++)for(let f=0;f<e;f++){let h=0,p=0,m=0;for(let E=0;E<s;E++)for(let C=0;C<o;C++){let I=Math.cos(Math.PI*f*C/e)*Math.cos(Math.PI*d*E/n),x=l[C+E*o];h+=x[0]*I,p+=x[1]*I,m+=x[2]*I}let g=jd(h),y=jd(p),b=jd(m);u[4*f+0+d*c]=g,u[4*f+1+d*c]=y,u[4*f+2+d*c]=b,u[4*f+3+d*c]=255}return u},eie=Jre,FI=4,tie=(t,e,n,r)=>{let i=0,s=0,o=0,a=e*FI;for(let c=0;c<e;c++){let u=FI*c;for(let d=0;d<n;d++){let f=u+d*a,h=r(c,d);i+=h*Wd(t[f]),s+=h*Wd(t[f+1]),o+=h*Wd(t[f+2])}}let l=1/(e*n);return[i*l,s*l,o*l]},nie=t=>{let e=jd(t[0]),n=jd(t[1]),r=jd(t[2]);return(e<<16)+(n<<8)+r},rie=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor(qd(t[0]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(qd(t[1]/e,.5)*9+9.5)))),i=Math.floor(Math.max(0,Math.min(18,Math.floor(qd(t[2]/e,.5)*9+9.5))));return n*19*19+r*19+i},iie=(t,e,n,r,i)=>{if(r<1||r>9||i<1||i>9)throw new H0("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new H0("Width and height must match the pixels array");let s=[];for(let d=0;d<i;d++)for(let f=0;f<r;f++){let h=f==0&&d==0?1:2,p=tie(t,e,n,(m,g)=>h*Math.cos(Math.PI*f*m/e)*Math.cos(Math.PI*d*g/n));s.push(p)}let o=s[0],a=s.slice(1),l="",c=r-1+(i-1)*9;l+=wh(c,1);let u;if(a.length>0){let d=Math.max(...a.map(h=>Math.max(...h))),f=Math.floor(Math.max(0,Math.min(82,Math.floor(d*166-.5))));u=(f+1)/166,l+=wh(f,1)}else u=1,l+=wh(0,1);return l+=wh(nie(o),4),a.forEach(d=>{l+=wh(rie(d,u),2)}),l},sie=iie;async function c5(t){if(!t.url)throw new Error("url is required for imeta tag");if(!t.m)throw new Error("m (MIME type) is required for imeta tag");let e=t.dim;if(!e&&t.url)try{e=await new Promise(i=>{const s=new window.Image;s.onload=()=>{i(`${s.naturalWidth}x${s.naturalHeight}`)},s.onerror=()=>i(void 0),s.src=t.url})}catch{e=void 0}const n=Gre({content:t.content||"",url:t.url,m:t.m,x:t.x||"",ox:t.ox||"",size:t.size,dim:e,blurhash:t.blurhash,thumb:t.thumb,image:t.image,summary:t.summary,alt:t.alt,fallback:t.fallback}),r=[`url ${t.url}`];for(const i of n.tags){const[s,...o]=i;s!=="url"&&(o.length===1?r.push(`${s} ${o[0]}`):o.length>1&&r.push(`${s} ${o.join(" ")}`))}return["imeta",...r]}async function oie(t){try{if(an.value)return null;const e=await new Promise((o,a)=>{const l=URL.createObjectURL(t),c=new window.Image;c.onload=()=>{URL.revokeObjectURL(l),o(c)},c.onerror=u=>{URL.revokeObjectURL(l),a(u)},c.src=l});if(an.value)return null;const n=document.createElement("canvas");n.width=Math.min(e.width,64),n.height=Math.min(e.height,64);const r=n.getContext("2d");if(!r)return null;r.drawImage(e,0,0,n.width,n.height);const i=r.getImageData(0,0,n.width,n.height);return sie(i.data,i.width,i.height,4,4)}catch{return null}}async function aie(t){try{return URL.createObjectURL(t)}catch{return null}}async function lie(t){return await oie(t)}function u5(t){const e={};return t&&t.state&&t.state.doc&&t.state.doc.descendants(n=>{n.type?.name==="image"&&n.attrs?.src&&n.attrs?.blurhash&&!n.attrs?.isPlaceholder&&!n.attrs?.src?.startsWith("placeholder-")&&(e[n.attrs.src]=n.attrs.blurhash)}),e}function cie(t,e,n,r){try{const i=eie(t,n,r),s=e.getContext("2d");if(!s)return!1;const o=new ImageData(new Uint8ClampedArray(Array.from(i)),n,r);return s.putImageData(o,0,0),!0}catch(i){return console.warn("Failed to decode blurhash:",i),!1}}function d5(t){const e=t.split(".").pop()?.toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",svg:"image/svg+xml"}[e||""]||"image/jpeg"}async function uie(t){try{const e=await fetch(t);if(!e.ok)return null;const n=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}catch(e){return console.warn("Failed to calculate image hash:",e),null}}const $I={maxWidth:780,maxHeight:240};function f5(t,e,n=$I.maxWidth,r=$I.maxHeight){if(t<=n&&e<=r)return{width:t,height:e,displayWidth:t,displayHeight:e};const i=t/e;let s,o;return t/n>e/r?(s=n,o=Math.round(n/i)):(o=r,s=Math.round(r*i)),{width:t,height:e,displayWidth:s,displayHeight:o}}function die(t){if(!t)return null;const e=t.match(/^(\d+)x(\d+)$/);return e?{width:parseInt(e[1],10),height:parseInt(e[2],10)}:null}function r1(){return{width:200,height:150,displayWidth:200,displayHeight:150}}function fie(t,e,n){return{start:{nodePos:n?.()},move:e,end:{nodeData:e?.nodeData||{pos:n?.()},dropX:0,dropY:0,target:null,dropPosition:null,...e}}[t]}function hie(t){return{start:"touch-image-drag-start",move:"touch-image-drag-move",end:"touch-image-drop"}[t]}function vh(t,e,n){const r=hie(t),i=fie(t,e,n),s=new CustomEvent(r,{detail:i,bubbles:!0,cancelable:!0});window.dispatchEvent(s),document.dispatchEvent(new CustomEvent(r,{detail:s.detail}))}function pie(t,e){return document.elementFromPoint(t,e)?.closest(".drop-zone-indicator")||null}function mie(){Ec.querySelectorAll(".drop-zone-indicator").forEach(t=>{t.classList.remove("drop-zone-hover")})}function gie(t){t?.classList.add("drop-zone-hover")}function yie(t,e){mie();const n=pie(t,e);gie(n)}function bie(t,e=140){const n=Math.min(e,t.width||e),r=t.width>0?Math.round(t.height/t.width*n):n;return{width:n,height:r}}function wie(t){if(!t)return null;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n&&n.drawImage(t,0,0),e}function vie(t){if(!t)return null;const e=document.createElement("img");return e.src=t.src,e.alt=t.alt||"",e}function xie(t,e,n){Object.assign(t.style,{width:`${e.width}px`,height:`${e.height}px`,left:`${n.x-e.width/2}px`,top:`${n.y-e.height/2}px`,transformOrigin:"center center",transition:"transform 120ms ease, opacity 120ms ease"})}function Sie(t,e,n,r=!1){const i=t.getBoundingClientRect(),s=bie(i);let o=null;if(r){const a=t.querySelector("canvas");a&&(o=wie(a))}else{const a=t.querySelector("img");a&&(o=vie(a))}return o?(xie(o,s,{x:e,y:n}),o.classList.add("drag-preview"),document.body.appendChild(o),requestAnimationFrame(()=>{o.style.transform="scale(0.8) rotate(0deg)",o.style.opacity="0.95"}),o):null}function Eie(t,e,n){if(!t)return;const r=t.getBoundingClientRect(),i=r.width||100,s=r.height||100;t.style.left=`${e-i/2}px`,t.style.top=`${n-s/2}px`}function i1(t){t?.parentNode?.removeChild(t)}function kie(t,e,n,r,i){const s=t-n,o=e-r;return s*s+o*o>i*i}function Tie(t,e,n,r){return!!(t||e||n&&!r)}function hm(t){const e=t();if(e===void 0)return;Ra()&&a5();const n=new CustomEvent("select-image-node",{detail:{pos:e}});window.dispatchEvent(n),document.dispatchEvent(n)}function _ie(t,e,n,r,i,s,o,a,l){return Tie(n,r,s,e)?(t.preventDefault(),!1):(hm(l),t.preventDefault(),e||t.stopPropagation(),!0)}function Cie(t,e,n){return!!(t&&e&&n.displayWidth>0&&n.displayHeight>0)}function Aie(t,e){t.width=e.displayWidth,t.height=e.displayHeight}function zI(t,e,n,r,i=!1){Cie(t,e,n)&&(Aie(e,n),cie(t,e,n.displayWidth,n.displayHeight))}const Iie={getItem:t=>localStorage.getItem(t),setItem:(t,e)=>localStorage.setItem(t,e)},Pie={language:navigator.language},Oie={location:{reload:()=>window.location.reload()}},Mie={setTimeout:(t,e)=>setTimeout(t,e)};function Nie(t,e){if(t<=0)return 100;const n=e/t*100;return Number(n.toPrecision(2))}function Rie(t,e){const n=t/1024>=1e3,r=i=>n?`${(i/1048576).toFixed(2)}MB`:`${Math.round(i/1024)}KB`;return`${r(t)} â ${r(e)}`}function Die(t,e,n,r,i,s){return{originalSize:t,compressedSize:e,wasCompressed:n,compressionRatio:Nie(t,e),sizeReduction:Rie(t,e),originalFilename:r,compressedFilename:i,wasSkipped:s}}function Lie(t){return t.wasCompressed||t.originalFilename!==t.compressedFilename||t.originalSize!==t.compressedSize||!!t.wasSkipped}function UI(t){if(!t||!Lie(t))return null;const e=t.originalSize/1024>=1e3,n=r=>e?`${(r/1048576).toFixed(2)}MB`:`${Math.round(r/1024)}KB`;return{wasCompressed:t.wasCompressed,originalSize:n(t.originalSize),compressedSize:n(t.compressedSize),compressionRatio:t.compressionRatio,originalFilename:t.originalFilename,compressedFilename:t.compressedFilename,wasSkipped:t.wasSkipped}}function Bie(t){return dre.test(t)}function Fie(t){return fre.test(t)}function $ie(t){return Eb(t)}function zie(t){return{npub:Za.npubEncode(t),nprofile:Za.nprofileEncode({pubkey:t,relays:[]})}}function Uie(t){try{const{type:e,data:n}=Za.decode(t);if(e!=="nsec")return console.warn("ç¡å¹ãªnsecå½¢å¼ã§ã"),{hex:"",npub:"",nprofile:""};const r=$ie(n),{npub:i,nprofile:s}=zie(r);return{hex:r,npub:i,nprofile:s}}catch{return{hex:"",npub:"",nprofile:""}}}function h5(t){try{return Za.npubEncode(t)}catch{return`npub1${t.slice(0,10)}...`}}function Hie(t,e=[],n=[]){try{const r=[];e.length>0&&r.push(e[0]);const i=3-r.length;if(i>0){const s=n.filter(o=>!r.includes(o));r.push(...s.slice(0,Math.min(i,2)))}return Za.nprofileEncode({pubkey:t,relays:r})}catch{return""}}async function p5(t,e=window.crypto.subtle){if(an.value)throw new Error("Upload aborted by user");const n=await t.arrayBuffer(),r=await e.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function Vie(t,e){try{return await p5(t,e)}catch{return}}async function Wie(t){return new Promise(e=>{if(!t.type.startsWith("image/")){e(null);return}const n=new Image,r=URL.createObjectURL(t);n.onload=()=>{try{const i=f5(n.naturalWidth,n.naturalHeight);URL.revokeObjectURL(r),e(i)}catch(i){console.error("Failed to calculate image display size:",i),URL.revokeObjectURL(r),e(null)}},n.onerror=()=>{URL.revokeObjectURL(r),e(null)},n.src=r})}function jie(t,e){const r={"image/webp":".webp","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/avif":".avif","image/bmp":".bmp"}[e];return r?`${t.replace(/\.[^.]+$/,"")}${r}`:t}function qie(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function Kie(t,e){const n=t.getItem(bi.LOCALE),r=e.language;return n||(r&&r.startsWith("ja")?"ja":"en")}function Gie(t,e,n){const r=e.getItem(bi.UPLOAD_ENDPOINT);return r&&n5.some(i=>i.url===r)?r:n||_k(t)}function Zie(t){const e=t.getItem(bi.CLIENT_TAG_ENABLED),n=e===null?!0:e==="true";return e===null&&t.setItem(bi.CLIENT_TAG_ENABLED,"true"),n}function Qie(t,e){return t.getItem(bi.IMAGE_COMPRESSION_LEVEL)||e||"medium"}function Xie(t={}){const{selectedEndpoint:e,selectedCompression:n,storage:r=Iie,navigator:i=Pie}=t,s=Kie(r,i),o=Gie(s,r,e),a=Zie(r),l=Qie(r,n);return{endpoint:o,clientTagEnabled:a,compression:l}}function Yie(t,e,n={}){const{timeout:r=1e3,windowAdapter:i=Oie,timeoutAdapter:s=Mie}=n;e(!0),t(),s.setTimeout(()=>{i.location.reload()},r)}async function m5(t,e,n,r="readonly"){return new Promise(i=>{try{const s=indexedDB.open(t,e);s.onupgradeneeded=o=>{const a=o.target.result;a.objectStoreNames.contains(n)||a.createObjectStore(n,{keyPath:"id"})},s.onerror=()=>i(null),s.onsuccess=o=>{try{const a=o.target.result;if(!a.objectStoreNames.contains(n)){a.close(),i(null);return}const l=a.transaction([n],r),c=l.objectStore(n);i({db:a,transaction:l,store:c})}catch{i(null)}}}catch{i(null)}})}async function Jie(t,e,n,r){const i=await m5(t,e,n,"readonly");if(!i)return null;const{db:s,store:o}=i;return new Promise(a=>{const l=o.get(r);l.onsuccess=()=>{s.close(),a(l.result)},l.onerror=()=>{s.close(),a(null)}})}async function ese(t,e,n,r){const i=await m5(t,e,n,"readwrite");if(!i)return!1;const{db:s,store:o}=i;return new Promise(a=>{const l=o.delete(r);l.onsuccess=()=>{s.close(),a(!0)},l.onerror=()=>{s.close(),a(!1)}})}function tse(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function Pk(t,e=ka.REQUEST_TIMEOUT){if(!navigator.serviceWorker.controller)throw new Error("No ServiceWorker controller available");const n=new MessageChannel,r=tse();return new Promise((i,s)=>{const o=setTimeout(()=>{n.port1.close(),s(new Error("ServiceWorker communication timeout"))},e);n.port1.onmessage=a=>{clearTimeout(o),n.port1.close();const{data:l}=a.data||{};i(l)},n.port1.addEventListener("error",a=>{clearTimeout(o),n.port1.close(),s(a)});try{if(navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({...t,requestId:r},[n.port2]);else throw new Error("ServiceWorker controller became unavailable")}catch(a){clearTimeout(o),n.port1.close(),s(a)}})}async function nse(){if(!navigator.serviceWorker.controller)return new Promise((t,e)=>{const n=setTimeout(()=>{navigator.serviceWorker.removeEventListener("controllerchange",r),e(new Error("ServiceWorkerã³ã³ãã­ã¼ã©ã¼å¾æ©ã¿ã¤ã ã¢ã¦ã"))},ka.REQUEST_TIMEOUT),r=()=>{clearTimeout(n),navigator.serviceWorker.removeEventListener("controllerchange",r),setTimeout(t,ka.SW_CONTROLLER_WAIT_TIMEOUT)};navigator.serviceWorker.addEventListener("controllerchange",r)})}async function rse(){const t=await Jie(ka.INDEXEDDB_NAME,ka.INDEXEDDB_VERSION,ka.STORE_NAME,"sharedImageData");return t?.data?(await ese(ka.INDEXEDDB_NAME,ka.INDEXEDDB_VERSION,ka.STORE_NAME,"sharedImageData"),t.data.image?.arrayBuffer&&t.data.image._isFile?{image:new File([t.data.image.arrayBuffer],t.data.image.name||"shared-image",{type:t.data.image.type||"image/jpeg"}),metadata:t.data.metadata}:t.data):null}async function ise(){try{const t=await Pk({action:"getSharedImage"});return t&&t.image?t:null}catch(t){return console.error("Failed to send message to ServiceWorker:",t),null}}async function sse(){try{try{await Promise.race([nse(),new Promise((t,e)=>setTimeout(()=>e(new Error("SW controller timeout")),2e3))])}catch(t){console.warn("Service Worker controller not ready, trying alternatives:",t)}try{const t=await ise();if(t)return console.log("Shared image retrieved via ServiceWorker MessageChannel"),t}catch(t){console.warn("Service Worker MessageChannel failed:",t)}try{const t=await rse();if(t)return console.log("Shared image retrieved via IndexedDB fallback"),t}catch(t){console.warn("IndexedDB fallback failed:",t)}try{const t=await Pk({action:"getSharedImageForce"},1e3),e=t&&t.image?t:null;if(e)return console.log("Shared image retrieved via forced Service Worker request"),e}catch(t){console.warn("Forced Service Worker request failed:",t)}return console.log("No shared image found through any method"),null}catch(t){return console.error("Error in getSharedImageWithFallback:",t),null}}async function ose(){if(!("serviceWorker"in navigator))return{isReady:!1,hasController:!1,error:"Service Worker not supported"};const t=await navigator.serviceWorker.getRegistration(),e=!!navigator.serviceWorker.controller;return t?{isReady:t.active!==null,hasController:e}:{isReady:!1,hasController:e,error:"Service Worker not registered"}}async function ase(){try{const t=await Pk({type:"PING_TEST"},3e3);return console.log("ServiceWorker communication test successful:",t),!0}catch(t){return console.warn("ServiceWorker communication test timeout"),console.error("ServiceWorker communication test error:",t),!1}}function Cd(t){if(t.type.startsWith("touch")){const e=t,n=e.touches[0]||e.changedTouches[0];return{x:n.clientX,y:n.clientY}}else{const e=t;return{x:e.clientX,y:e.clientY}}}function Kd(t,e,n,r,i){const s=window.innerWidth||document.documentElement.clientWidth||0,o=window.innerHeight||document.documentElement.clientHeight||0,a=typeof n=="number"?n:0,l=r?s-r-a:s-a,c=i?o-i-a:o-a;return{x:Math.max(a,Math.min(l,t)),y:Math.max(a,Math.min(c,e))}}async function lse(t,e){const n=[];if(an.value)throw new Error("Upload aborted by user");for(let r=0;r<t.length;r++){const i=t[r],[s,o]=await Promise.all([Vie(i,e.crypto),e.getImageDimensions(i)]);n.push({file:i,index:r,ox:s,dimensions:o??void 0})}return n}function cse(t){return t.map(e=>({caption:e.name,expiration:"",size:e.size,alt:e.name,media_type:void 0,content_type:e.type||"",no_transform:"true"}))}function HI(t,e){const n=[];for(let r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}class VI{static addCacheBuster(e){if(!e)return e;try{const n=new URL(e);return n.searchParams.set("cb",Date.now().toString()),n.toString()}catch{return e}}static addProfileMarker(e,n=!1,r=!0){if(!e)return e;try{const i=new URL(e);return i.searchParams.set("profile","true"),n&&r?i.searchParams.has("cb")&&i.searchParams.set("cb",Date.now().toString()):i.searchParams.delete("cb"),i.toString()}catch{return e}}}class use{constructor(e={}){this.deps=e}createProfileData(e,n,r){const i=r?.profileRelays||[],s=r?.writeRelays||[],o=r?.forceRemote||!1;let a=e?.picture||"";if(a){o&&(a=VI.addCacheBuster(a));const l=this.deps.navigator?.onLine??!0;a=VI.addProfileMarker(a,o,l)}return{name:e?.name||"",picture:a,npub:h5(n),nprofile:Hie(n,i,s),profileRelays:i.length>0?i:void 0}}}class dse{constructor(e,n,r){this.localStorage=e,this.console=n,this.profileDataFactory=r}save(e,n){try{if(n===null){this.localStorage.removeItem(`nostr-profile-${e}`);return}this.localStorage.setItem(`nostr-profile-${e}`,JSON.stringify(n)),this.console.log("ãã­ãã£ã¼ã«æå ±ãã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){this.console.error("ãã­ãã£ã¼ã«æå ±ã®ä¿å­ã«å¤±æ:",r)}}get(e){try{const n=this.localStorage.getItem(`nostr-profile-${e}`);if(!n)return null;const r=JSON.parse(n);return r.npub&&r.nprofile?{...r,profileRelays:r.profileRelays||void 0}:this.profileDataFactory.createProfileData(r,e,{forceRemote:!1})}catch(n){return this.console.error("ãã­ãã£ã¼ã«æå ±ã®åå¾ã«å¤±æ:",n),null}}clear(e){this.save(e,null)}}class fse{constructor(e,n,r,i,s){this.rxNostr=e,this.profileDataFactory=n,this.setTimeoutFn=r,this.clearTimeoutFn=i,this.console=s}async fetchFromNetwork(e,n){n?.timeoutMs;const r=n?.additionalRelays??[];return new Promise(i=>{const s=Xg();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=h=>{a||(a=!0,c(),i(h))},d=r.length>0?{on:{relays:r}}:void 0;l=(d?this.rxNostr.use(s,d):this.rxNostr.use(s)).subscribe({next:h=>{if(!a&&h.event?.kind===0&&h.event.pubkey===e){o=!0;try{const p=JSON.parse(h.event.content),m=[];if(h.from&&typeof h.from=="string"){const y=h.from.endsWith("/")?h.from:h.from+"/";m.push(y)}const g=this.profileDataFactory.createProfileData(p,e,{profileRelays:m,writeRelays:n?.writeRelays,forceRemote:n?.forceRemote});this.console.log("Kind 0ãããã­ãã£ã¼ã«æå ±ãåå¾:",g,"from relay:",h.from),u(g)}catch(p){this.console.error("Kind 0ã®ãã¼ã¹ã¨ã©ã¼:",p),u(null)}}},complete:()=>{if(!a&&!o){this.console.log("ãã­ãã£ã¼ã«åå¾EOSEãããã©ã«ããã­ãã£ã¼ã«ãä½¿ç¨");const h=this.profileDataFactory.createProfileData({},e,{writeRelays:n?.writeRelays,forceRemote:n?.forceRemote});u(h)}},error:h=>{a||(this.console.error("ãã­ãã£ã¼ã«åå¾ã¨ã©ã¼:",h),u(null))}}),s.emit({authors:[e],kinds:[0],until:Math.floor(Date.now()/1e3)}),s.over()})}}class hse{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.navigator||(typeof window<"u"?window.navigator:{onLine:!0}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.console||(typeof window<"u"?window.console:{});this.profileDataFactory=new use({navigator:i}),this.storage=new dse(r,a,this.profileDataFactory),this.networkFetcher=new fse(e,this.profileDataFactory,s,o,a)}storage;networkFetcher;profileDataFactory;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}async fetchProfileData(e,n){const r=this.networkFetcher.console;if(r.log(`ãã­ãã£ã¼ã«åå¾éå§: ${e}`),!n?.forceRemote){const s=this.storage.get(e);if(s)return r.log("ã­ã£ãã·ã¥ãããã­ãã£ã¼ã«ãå¾©å:",s),s}r.log("ãªã¢ã¼ããããã­ãã£ã¼ã«æå ±ãåå¾ä¸­...");const i=await this.networkFetcher.fetchFromNetwork(e,n);return i&&this.storage.save(e,i),i}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}getProfileDataFactory(){return this.profileDataFactory}}class pse{relayManager;profileManager;constructor(e,n,r){this.relayManager=n,this.profileManager=r}async initializeRelays(e){e?this.relayManager.useRelaysFromLocalStorageIfExists(e)||this.relayManager.setBootstrapRelays():this.relayManager.setBootstrapRelays()}async fetchRelays(e,n=!1){if(!n){const i=this.relayManager.getFromLocalStorage(e);if(i)return console.log("ã­ã£ãã·ã¥ãããªã¬ã¼ãªã¹ããå¾©å:",i),{success:!0,relayConfig:i,source:"localStorage"}}return await this.relayManager.fetchUserRelays(e,{forceRemote:n})}async fetchProfile(e,n=!1){if(!e)return null;n&&this.profileManager.saveToLocalStorage(e,null);const{writeRelays:r,additionalRelays:i}=this.relayManager.getRelayListsForProfile(e);return await this.profileManager.fetchProfileData(e,{forceRemote:n,writeRelays:r,additionalRelays:i})}async initializeForLogin(e){console.log(`ã­ã°ã¤ã³åæåéå§: ${e}`),await this.fetchRelays(e,!1);const n=await this.fetchProfile(e,!1);return console.log(`ã­ã°ã¤ã³åæåå®äº: ${e}`),n}async refreshRelaysAndProfile(e){console.log(`ãªã¬ã¼ã»ãã­ãã£ã¼ã«ååå¾éå§: ${e}`),await this.fetchRelays(e,!0);const n=await this.fetchProfile(e,!0);return console.log(`ãªã¬ã¼ã»ãã­ãã£ã¼ã«ååå¾å®äº: ${e}`),n}getRelayManager(){return this.relayManager}getProfileManager(){return this.profileManager}}function Pr(t){this.content=t}Pr.prototype={constructor:Pr,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new Pr(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Pr(n)},addToStart:function(t,e){return new Pr([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Pr(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new Pr(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Pr.from(t),t.size?new Pr(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Pr.from(t),t.size?new Pr(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Pr.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Pr.from=function(t){if(t instanceof Pr)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Pr(e)};function g5(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=g5(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function y5(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=y5(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class De{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:s+=r),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new De(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new De(r,i)}cutByIndex(e,n){return e==n?De.empty:e==0&&n==this.content.length?this:new De(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new De(i,s)}addToStart(e){return new De([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new De(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return g5(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return y5(this,e,n,r)}findIndex(e){if(e==0)return tg(0,e);if(e==this.size)return tg(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),s=r+i.nodeSize;if(s>=e)return s==e?tg(n+1,s):tg(n,r);r=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return De.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new De(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return De.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new De(n||e,r)}static from(e){if(!e)return De.empty;if(e instanceof De)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new De([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}De.empty=new De([],0);const s1={index:0,offset:0};function tg(t,e){return s1.index=t,s1.offset=e,s1}function V0(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!V0(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!V0(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let _n=class v2{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&V0(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let i=r.create(n.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return v2.none;if(e instanceof v2)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}};_n.none=[];class W0 extends Error{}class nt{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=w5(this.content,e+this.openStart,n);return r&&new nt(r,this.openStart,this.openEnd)}removeBetween(e,n){return new nt(b5(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return nt.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new nt(De.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new nt(e,r,i)}}nt.empty=new nt(De.empty,0,0);function b5(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(b5(s.content,e-i-1,n-i-1)))}function w5(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=w5(o.content,e-s-1,n,o);return a&&t.replaceChild(i,o.copy(a))}function mse(t,e,n){if(n.openStart>t.depth)throw new W0("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new W0("Inconsistent open depths");return v5(t,e,n,0)}function v5(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=v5(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return bu(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=gse(n,t);return bu(s,S5(t,o,a,e,r))}else return bu(s,j0(t,e,r))}function x5(t,e){if(!e.type.compatibleContent(t.type))throw new W0("Cannot join "+e.type.name+" onto "+t.type.name)}function x2(t,e,n){let r=t.node(n);return x5(r,e.node(n)),r}function yu(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Xh(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(yu(t.nodeAfter,r),s++));for(let a=s;a<o;a++)yu(i.child(a),r);e&&e.depth==n&&e.textOffset&&yu(e.nodeBefore,r)}function bu(t,e){return t.type.checkContent(e),t.copy(e)}function S5(t,e,n,r,i){let s=t.depth>i&&x2(t,e,i+1),o=r.depth>i&&x2(n,r,i+1),a=[];return Xh(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(x5(s,o),yu(bu(s,S5(t,e,n,r,i+1)),a)):(s&&yu(bu(s,j0(t,e,i+1)),a),Xh(e,n,i,a),o&&yu(bu(o,j0(n,r,i+1)),a)),Xh(r,null,i,a),new De(a)}function j0(t,e,n){let r=[];if(Xh(null,t,n,r),t.depth>n){let i=x2(t,e,n+1);yu(bu(i,j0(t,e,n+1)),r)}return Xh(e,null,n,r),new De(r)}function gse(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(De.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class _p{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return _n.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new q0(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new _p(n,r,s)}static resolveCached(e,n){let r=WI.get(e);if(r)for(let s=0;s<r.elts.length;s++){let o=r.elts[s];if(o.pos==n)return o}else WI.set(e,r=new yse);let i=r.elts[r.i]=_p.resolve(e,n);return r.i=(r.i+1)%bse,i}}class yse{constructor(){this.elts=[],this.i=0}}const bse=12,WI=new WeakMap;class q0{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const wse=Object.create(null);let cc=class S2{constructor(e,n,r,i=_n.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||De.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&V0(this.attrs,n||e.defaultAttrs||wse)&&_n.sameSet(this.marks,r||_n.none)}copy(e=null){return e==this.content?this:new S2(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new S2(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return nt.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new nt(c,i.depth-o,s.depth-o)}replace(e,n,r){return mse(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return _p.resolveCached(this,e)}resolveNoCache(e){return _p.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),E5(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=De.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=_n.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!_n.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=De.fromJSON(e,n.content),s=e.nodeType(n.type).create(n.attrs,i,r);return s.type.checkAttrs(s.attrs),s}};cc.prototype.text=void 0;class K0 extends cc{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):E5(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new K0(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new K0(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function E5(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Du{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new vse(e,n);if(r.next==null)return Du.empty;let i=k5(r);r.next&&r.err("Unexpected trailing text");let s=Cse(_se(i));return Ase(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return De.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let f=s(d,a.concat(u));if(f)return f}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}Du.empty=new Du(!0);class vse{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function k5(t){let e=[];do e.push(xse(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function xse(t){let e=[];do e.push(Sse(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Sse(t){let e=Tse(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=Ese(t,e);else break;return e}function jI(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function Ese(t,e){let n=jI(t),r=n;return t.eat(",")&&(t.next!="}"?r=jI(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function kse(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function Tse(t){if(t.eat("(")){let e=k5(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=kse(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function _se(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function T5(t,e){return e-t}function qI(t,e){let n=[];return r(e),n.sort(T5);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function Cse(t){let e=Object.create(null);return n(qI(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);qI(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new Du(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(T5);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function Ase(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function _5(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function C5(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function A5(t,e,n,r){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${n} of type ${i}`);for(let i in t){let s=t[i];s.validate&&s.validate(e[i])}}function I5(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new Pse(t,r,e[r]);return n}let KI=class P5{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=I5(e,r.attrs),this.defaultAttrs=_5(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Du.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:C5(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new cc(this,this.computeAttrs(e),De.from(n),_n.setFrom(r))}createChecked(e=null,n,r){return n=De.from(n),this.checkContent(n),new cc(this,this.computeAttrs(e),n,_n.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=De.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(De.empty,!0);return s?new cc(this,e,n.append(s),_n.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){A5(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:_n.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new P5(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function Ise(t,e,n){let r=n.split("|");return i=>{let s=i===null?"null":typeof i;if(r.indexOf(s)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${s}`)}}class Pse{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?Ise(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Mb{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=I5(e,i.attrs),this.excluded=null;let s=_5(this.attrs);this.instance=s?new _n(this,s):null}create(e=null){return!e&&this.instance?this.instance:new _n(this,C5(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new Mb(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){A5(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class O5{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let i in e)n[i]=e[i];n.nodes=Pr.from(e.nodes),n.marks=Pr.from(e.marks||{}),this.nodes=KI.compile(this.spec.nodes,this),this.marks=Mb.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=r[o]||(r[o]=Du.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?GI(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:GI(this,o.split(" "))}this.nodeFromJSON=i=>cc.fromJSON(this,i),this.markFromJSON=i=>_n.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof KI){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new K0(r,r.defaultAttrs,e,_n.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function GI(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function Ose(t){return t.tag!=null}function Mse(t){return t.style!=null}class uc{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(i=>{if(Ose(i))this.tags.push(i);else if(Mse(i)){let s=/[^=]*/.exec(i.style)[0];r.indexOf(s)<0&&r.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,n={}){let r=new QI(this,n,!1);return r.addAll(e,_n.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new QI(this,n,!0);return r.addAll(e,_n.none,n.from,n.to),nt.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(Dse(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=XI(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=XI(o)),o.node||o.ignore||o.mark||(o.node=i)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new uc(e,uc.schemaRules(e)))}}const M5={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Nse={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},N5={ol:!0,ul:!0},Cp=1,E2=2,Yh=4;function ZI(t,e,n){return e!=null?(e?Cp:0)|(e==="full"?E2:0):t&&t.whitespace=="pre"?Cp|E2:n&~Yh}class ng{constructor(e,n,r,i,s,o){this.type=e,this.attrs=n,this.marks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=_n.none,this.match=s||(o&Yh?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(De.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Cp)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=De.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(De.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!M5.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class QI{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let i=n.topNode,s,o=ZI(null,n.preserveWhitespace,0)|(r?Yh:0);i?s=new ng(i.type,i.attrs,_n.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new ng(null,null,_n.none,!0,null,o):s=new ng(e.schema.topNodeType,null,_n.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,i=this.top,s=i.options&E2?"full":this.localPreserveWS||(i.options&Cp)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(s)if(s==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;N5.hasOwnProperty(o)&&this.parser.normalizeLists&&Rse(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:Nse.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(M5.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let d=l&&l.skip?n:this.readStyles(e,n);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=r.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,i){let s,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(s=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,n,r,i){let s=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,n);this.findAtPoint(e,s)}findPlace(e,n,r){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)n=this.enterInner(i[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(n=this.enterInner(s,null,n))}let i=this.findPlace(e,n,r);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=_n.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):YI(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,n,r,i){let s=this.findPlace(e.create(n),r,!1);return s&&(s=this.enterInner(e,n,r,!0,i)),s}enterInner(e,n,r,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=ZI(e,s,o.options);o.options&Yh&&o.content.length==0&&(a|=Yh);let l=_n.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):YI(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new ng(e,n,l,i,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=Cp)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function Rse(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&N5.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function Dse(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function XI(t){let e={};for(let n in t)e[n]=t[n];return e}function YI(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class qu{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=o1(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=Ng(o1(n),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&Ng(o1(r),i(e,n),null,e.attrs)}static renderSpec(e,n,r=null,i){return Ng(e,n,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new qu(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=JI(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return JI(e.marks)}}function JI(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function o1(t){return t.document||window.document}const e3=new WeakMap;function Lse(t){let e=e3.get(t);return e===void 0&&e3.set(t,e=Bse(t)),e}function Bse(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)n(r[i]);else for(let i in r)n(r[i])}return n(t),e}function Ng(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(s=Lse(r))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));let a,l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let f=d.indexOf(" ");f>0?l.setAttributeNS(d.slice(0,f),d.slice(f+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let f=e[d];if(f===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:h,contentDOM:p}=Ng(t,f,n,r);if(l.appendChild(h),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const R5=65535,D5=Math.pow(2,16);function Fse(t,e){return t+e*D5}function t3(t){return t&R5}function $se(t){return(t-(t&R5))/D5}const L5=1,B5=2,Rg=4,F5=8;class k2{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&F5)>0}get deletedBefore(){return(this.delInfo&(L5|Rg))>0}get deletedAfter(){return(this.delInfo&(B5|Rg))>0}get deletedAcross(){return(this.delInfo&Rg)>0}}class ns{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ns.empty)return ns.empty}recover(e){let n=0,r=t3(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+$se(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let f=c?e==l?-1:e==d?1:n:n,h=l+i+(f<0?0:u);if(r)return h;let p=e==(n<0?l:d)?null:Fse(a/3,e-l),m=e==l?B5:e==d?L5:Rg;return(n<0?e!=l:e!=d)&&(m|=F5),new k2(h,m,p)}i+=u-c}return r?e+i:new k2(e+i,0,null)}touches(e,n){let r=0,i=t3(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new ns(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ns.empty:new ns(e<0?[0,-e,0]:[0,0,e])}}ns.empty=new ns([]);class Ap{constructor(e,n,r=0,i=e?e.length:0){this.mirror=n,this.from=r,this.to=i,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new Ap(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let i=e.getMirror(n);this.appendMap(e._maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e._maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new Ap;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new k2(e,i,null)}}const a1=Object.create(null);class li{getMap(){return ns.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=a1[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in a1)throw new RangeError("Duplicate use of step JSON ID "+e);return a1[e]=n,n.prototype.jsonID=e,n}}class ar{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new ar(e,null)}static fail(e){return new ar(null,e)}static fromReplace(e,n,r,i){try{return ar.ok(e.replace(n,r,i))}catch(s){if(s instanceof W0)return ar.fail(s.message);throw s}}}function Ok(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(Ok(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return De.fromArray(r)}class Jl extends li{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new nt(Ok(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return ar.fromReplace(e,this.from,this.to,s)}invert(){return new Qs(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Jl(n.pos,r.pos,this.mark)}merge(e){return e instanceof Jl&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Jl(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Jl(n.from,n.to,e.markFromJSON(n.mark))}}li.jsonID("addMark",Jl);class Qs extends li{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new nt(Ok(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return ar.fromReplace(e,this.from,this.to,r)}invert(){return new Jl(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Qs(n.pos,r.pos,this.mark)}merge(e){return e instanceof Qs&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Qs(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Qs(n.from,n.to,e.markFromJSON(n.mark))}}li.jsonID("removeMark",Qs);class ec extends li{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return ar.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return ar.fromReplace(e,this.pos,this.pos+1,new nt(De.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new ec(this.pos,n.marks[i]);return new ec(this.pos,this.mark)}}return new Lu(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ec(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new ec(n.pos,e.markFromJSON(n.mark))}}li.jsonID("addNodeMark",ec);class Lu extends li{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return ar.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return ar.fromReplace(e,this.pos,this.pos+1,new nt(De.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new ec(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Lu(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Lu(n.pos,e.markFromJSON(n.mark))}}li.jsonID("removeNodeMark",Lu);class br extends li{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&T2(e,this.from,this.to)?ar.fail("Structure replace would overwrite content"):ar.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ns([this.from,this.to-this.from,this.slice.size])}invert(e){return new br(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new br(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof br)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?nt.empty:new nt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new br(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?nt.empty:new nt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new br(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new br(n.from,n.to,nt.fromJSON(e,n.slice),!!n.structure)}}li.jsonID("replace",br);class Er extends li{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(T2(e,this.from,this.gapFrom)||T2(e,this.gapTo,this.to)))return ar.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return ar.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?ar.fromReplace(e,this.from,this.to,r):ar.fail("Content does not fit in gap")}getMap(){return new ns([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Er(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new Er(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Er(n.from,n.to,n.gapFrom,n.gapTo,nt.fromJSON(e,n.slice),n.insert,!!n.structure)}}li.jsonID("replaceAround",Er);function T2(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function zse(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!r.isInSet(d)&&u.type.allowsMarkType(r.type)){let f=Math.max(c,e),h=Math.min(c+l.nodeSize,n),p=r.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==f&&o.mark.eq(d[m])?o.to=h:i.push(o=new Qs(f,h,d[m])));a&&a.to==f?a.to=h:s.push(a=new Jl(f,h,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function Use(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof Mb){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let d=l[u],f;for(let h=0;h<i.length;h++){let p=i[h];p.step==s-1&&d.eq(i[h].style)&&(f=p)}f?(f.to=c,f.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new Qs(o.from,o.to,o.style)))}function Mk(t,e,n,r=n.contentMatch,i=!0){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=r.matchType(c.type);if(!d)o.push(new br(a,u,nt.empty));else{r=d;for(let f=0;f<c.marks.length;f++)n.allowsMarkType(c.marks[f].type)||t.step(new Qs(a,u,c.marks[f]));if(i&&c.isText&&n.whitespace!="pre"){let f,h=/\r?\n|\r/g,p;for(;f=h.exec(c.text);)p||(p=new nt(De.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new br(a+f.index,a+f.index+f[0].length,p))}}a=u}if(!r.validEnd){let l=r.fillBefore(De.empty,!0);t.replace(a,a,new nt(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function Hse(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function $f(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let i=t.$from.node(r),s=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&i.canReplace(s,o,n))return r;if(r==0||i.type.spec.isolating||!Hse(i,s,o))break}return null}function Vse(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=De.empty,d=0;for(let p=s,m=!1;p>n;p--)m||r.index(p)>0?(m=!0,u=De.from(r.node(p).copy(u)),d++):l--;let f=De.empty,h=0;for(let p=s,m=!1;p>n;p--)m||i.after(p+1)<i.end(p)?(m=!0,f=De.from(i.node(p).copy(f)),h++):c++;t.step(new Er(l,c,o,a,new nt(u.append(f),d,h),u.size-d,!0))}function Nk(t,e,n=null,r=t){let i=Wse(t,e),s=i&&jse(r,e);return s?i.map(n3).concat({type:e,attrs:n}).concat(s.map(n3)):null}function n3(t){return{type:t,attrs:null}}function Wse(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function jse(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function qse(t,e,n){let r=De.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=De.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new Er(i,s,i,s,new nt(r,0,0),n.length,!0))}function Kse(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(r,l)&&Gse(t.doc,t.mapping.slice(s).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let h=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);h&&!p?c=!1:!h&&p&&(c=!0)}c===!1&&z5(t,o,a,s),Mk(t,t.mapping.slice(s).map(a,1),r,void 0,c===null);let u=t.mapping.slice(s),d=u.map(a,1),f=u.map(a+o.nodeSize,1);return t.step(new Er(d,f,d+1,f-1,new nt(De.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&$5(t,o,a,s),!1}})}function $5(t,e,n,r){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=t.mapping.slice(r).map(n+1+s+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function z5(t,e,n,r){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+s);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function Gse(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function Zse(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Er(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new nt(De.from(o),0,0),1,!0))}function Ua(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let d=i.node(c),f=i.index(c);if(d.type.spec.isolating)return!1;let h=d.content.cutByIndex(f,d.childCount),p=r&&r[u+1];p&&(h=h.replaceChild(0,p.type.create(p.attrs)));let m=r&&r[u]||d;if(!d.canReplace(f+1,d.childCount)||!m.type.validContent(h))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function Qse(t,e,n=1,r){let i=t.doc.resolve(e),s=De.empty,o=De.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=De.from(i.node(a).copy(s));let u=r&&r[c];o=De.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new br(e,e,new nt(s.append(o),n,n),!0))}function Lc(t,e){let n=t.resolve(e),r=n.index();return U5(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Xse(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==r?t.type.schema.nodes.text:s.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(s.marks))return!1}return n.validEnd}function U5(t,e){return!!(t&&e&&!t.isLeaf&&Xse(t,e))}function Nb(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let s,o,a=r.index(i);if(i==r.depth?(s=r.nodeBefore,o=r.nodeAfter):n>0?(s=r.node(i+1),a++,o=r.node(i).maybeChild(a)):(s=r.node(i).maybeChild(a-1),o=r.node(i+1)),s&&!s.isTextblock&&U5(s,o)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=n<0?r.before(i):r.after(i)}}function Yse(t,e,n){let r=null,{linebreakReplacement:i}=t.doc.type.schema,s=t.doc.resolve(e-n),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?r=!1:!u&&d&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);z5(t,u.node(),u.before(),a)}o.inlineContent&&Mk(t,e+n-1,o,s.node().contentMatchAt(s.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new br(c,l.map(e+n,-1),nt.empty,!0)),r===!0){let u=t.doc.resolve(c);$5(t,u.node(),u.before(),t.steps.length)}return t}function Jse(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function H5(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let d=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Rb(t,e,n=e,r=nt.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return V5(i,s,r)?new br(e,n,r):new eoe(i,s,r).fit()}function V5(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class eoe{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=De.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=De.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new nt(s,o,a);return e>-1?new Er(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new br(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let s=n.firstChild;if(n.childCount>1&&(i=0),s.type.spec.isolating&&i<=r){e=r;break}n=s.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let i,s=null;r?(s=l1(this.unplaced.content,r-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(n==1&&(o?c.matchType(o.type)||(d=c.fillBefore(De.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:r,frontierDepth:a,parent:s,inject:d};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=l1(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new nt(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=l1(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new nt(Rh(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new nt(Rh(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:f}=this.frontier[n];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let h=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(W5(m.mark(f.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?h:-1)))}let p=c==a.childCount;p||(h=-1),this.placed=Dh(this.placed,n,De.from(u)),this.frontier[n].match=d,p&&h<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<h;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?nt.empty:new nt(Rh(o.content,e-1,1),e-1,h<0?o.openEnd:e-1):new nt(Rh(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!c1(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=c1(e,n,i,r,s);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=c1(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Dh(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Dh(this.placed,this.depth,De.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(De.empty,!0);n.childCount&&(this.placed=Dh(this.placed,this.frontier.length,n))}}function Rh(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Rh(t.firstChild.content,e-1,n)))}function Dh(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Dh(t.lastChild.content,e-1,n)))}function l1(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function W5(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,W5(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(De.empty,!0)))),t.copy(r)}function c1(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!toe(n,s.content,o)?a:null}function toe(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function noe(t){return t.spec.defining||t.spec.definingForContent}function roe(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(V5(i,s,r))return t.step(new br(e,n,r));let o=q5(i,t.doc.resolve(n));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let f=i.depth,h=i.pos-1;f>0;f--,h--){let p=i.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(f)>-1?a=f:i.before(f)==h&&o.splice(1,0,-f)}let l=o.indexOf(a),c=[],u=r.openStart;for(let f=r.content,h=0;;h++){let p=f.firstChild;if(c.push(p),h==r.openStart)break;f=p.content}for(let f=u-1;f>=0;f--){let h=c[f],p=noe(h.type);if(p&&!h.sameMarkup(i.node(Math.abs(a)-1)))u=f;else if(p||!h.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let h=(f+u+1)%(r.openStart+1),p=c[h];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let b=i.node(g-1),E=i.index(g-1);if(b.canReplaceWith(E,E,p.type,p.marks))return t.replace(i.before(g),y?s.after(g):n,new nt(j5(r.content,0,r.openStart,h),h,r.openEnd))}}let d=t.steps.length;for(let f=o.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>d));f--){let h=o[f];h<0||(e=i.before(h),n=s.after(h))}}function j5(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(j5(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(De.empty,!0))}return t}function ioe(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=Jse(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new nt(De.from(r),0,0))}function soe(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=q5(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function q5(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class Gd extends li{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return ar.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return ar.fromReplace(e,this.pos,this.pos+1,new nt(De.from(i),0,n.isLeaf?0:1))}getMap(){return ns.empty}invert(e){return new Gd(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Gd(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Gd(n.pos,n.attr,n.value)}}li.jsonID("attr",Gd);class Ip extends li{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return ar.ok(r)}getMap(){return ns.empty}invert(e){return new Ip(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Ip(n.attr,n.value)}}li.jsonID("docAttr",Ip);let gf=class extends Error{};gf=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};gf.prototype=Object.create(Error.prototype);gf.prototype.constructor=gf;gf.prototype.name="TransformError";class K5{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ap}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new gf(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=nt.empty){let i=Rb(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new nt(De.from(r),0,0))}delete(e,n){return this.replace(e,n,nt.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return roe(this,e,n,r),this}replaceRangeWith(e,n,r){return ioe(this,e,n,r),this}deleteRange(e,n){return soe(this,e,n),this}lift(e,n){return Vse(this,e,n),this}join(e,n=1){return Yse(this,e,n),this}wrap(e,n){return qse(this,e,n),this}setBlockType(e,n=e,r,i=null){return Kse(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i){return Zse(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new Gd(e,n,r)),this}setDocAttribute(e,n){return this.step(new Ip(e,n)),this}addNodeMark(e,n){return this.step(new ec(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof _n)n.isInSet(r.marks)&&this.step(new Lu(e,n));else{let i=r.marks,s,o=[];for(;s=n.isInSet(i);)o.push(new Lu(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return Qse(this,e,n,r),this}addMark(e,n,r){return zse(this,e,n,r),this}removeMark(e,n,r){return Use(this,e,n,r),this}clearIncompatible(e,n,r){return Mk(this,e,n,r),this}}const u1=Object.create(null);class zt{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new ooe(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=nt.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?nt.empty:n),a==0&&s3(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),s3(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new Ct(e):yd(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?yd(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):yd(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new ss(e.node(0))}static atStart(e){return yd(e,e,0,0,1)||new ss(e)}static atEnd(e){return yd(e,e,e.content.size,e.childCount,-1)||new ss(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=u1[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in u1)throw new RangeError("Duplicate use of selection JSON ID "+e);return u1[e]=n,n.prototype.jsonID=e,n}getBookmark(){return Ct.between(this.$anchor,this.$head).getBookmark()}}zt.prototype.visible=!0;class ooe{constructor(e,n){this.$from=e,this.$to=n}}let r3=!1;function i3(t){!r3&&!t.parent.inlineContent&&(r3=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class Ct extends zt{constructor(e,n=e){i3(e),i3(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return zt.near(r);let i=e.resolve(n.map(this.anchor));return new Ct(i.parent.inlineContent?i:r,r)}replace(e,n=nt.empty){if(super.replace(e,n),n==nt.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof Ct&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Db(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Ct(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=zt.findFrom(n,r,!0)||zt.findFrom(n,-r,!0);if(s)n=s.$head;else return zt.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(zt.findFrom(e,-r,!0)||zt.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new Ct(e,n)}}zt.jsonID("text",Ct);class Db{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Db(e.map(this.anchor),e.map(this.head))}resolve(e){return Ct.between(e.resolve(this.anchor),e.resolve(this.head))}}class ut extends zt{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?zt.near(s):new ut(s)}content(){return new nt(De.from(this.node),0,0)}eq(e){return e instanceof ut&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Rk(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ut(e.resolve(n.anchor))}static create(e,n){return new ut(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}ut.prototype.visible=!1;zt.jsonID("node",ut);class Rk{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Db(r,r):new Rk(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&ut.isSelectable(r)?new ut(n):zt.near(n)}}class ss extends zt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=nt.empty){if(n==nt.empty){e.delete(0,e.doc.content.size);let r=zt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new ss(e)}map(e){return new ss(e)}eq(e){return e instanceof ss}getBookmark(){return aoe}}zt.jsonID("all",ss);const aoe={map(){return this},resolve(t){return new ss(t)}};function yd(t,e,n,r,i,s=!1){if(e.inlineContent)return Ct.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&ut.isSelectable(a))return ut.create(t,n-(i<0?a.nodeSize:0))}else{let l=yd(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function s3(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof br||i instanceof Er))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(zt.near(t.doc.resolve(o),n))}const o3=1,rg=2,a3=4;class loe extends K5{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|o3)&~rg,this.storedMarks=null,this}get selectionSet(){return(this.updated&o3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=rg,this}ensureMarks(e){return _n.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&rg)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~rg,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||_n.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(zt.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=a3,this}get scrolledIntoView(){return(this.updated&a3)>0}}function l3(t,e){return!e||!t?t:t.bind(e)}class Lh{constructor(e,n,r){this.name=e,this.init=l3(n.init,r),this.apply=l3(n.apply,r)}}const coe=[new Lh("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Lh("selection",{init(t,e){return t.selection||zt.atStart(e.doc)},apply(t){return t.selection}}),new Lh("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Lh("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class d1{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=coe.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Lh(r.key,r.spec.state,r))})}}class Ad{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Ad(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new loe(this)}static create(e){let n=new d1(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Ad(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new d1(this.schema,e.plugins),r=n.fields,i=new Ad(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new d1(e.schema,e.plugins),s=new Ad(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=cc.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=zt.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function G5(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=G5(i,e,{})),n[r]=i}return n}class un{constructor(e){this.spec=e,this.props={},e.props&&G5(e.props,this,this.props),this.key=e.key?e.key.key:Z5("plugin")}getState(e){return e[this.key]}}const f1=Object.create(null);function Z5(t){return t in f1?t+"$"+ ++f1[t]:(f1[t]=0,t+"$")}class An{constructor(e="key"){this.key=Z5(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Dk=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function Q5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const X5=(t,e,n)=>{let r=Q5(t,n);if(!r)return!1;let i=Lk(r);if(!i){let o=r.blockRange(),a=o&&$f(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(oD(t,i,e,-1))return!0;if(r.parent.content.size==0&&(yf(s,"end")||ut.isSelectable(s)))for(let o=r.depth;;o--){let a=Rb(t.doc,r.before(o),r.after(o),nt.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(yf(s,"end")?zt.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):ut.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1},uoe=(t,e,n)=>{let r=Q5(t,n);if(!r)return!1;let i=Lk(r);return i?Y5(t,i,e):!1},doe=(t,e,n)=>{let r=eD(t,n);if(!r)return!1;let i=Bk(r);return i?Y5(t,i,e):!1};function Y5(t,e,n){let r=e.nodeBefore,i=r,s=e.pos-1;for(;!i.isTextblock;s--){if(i.type.spec.isolating)return!1;let u=i.lastChild;if(!u)return!1;i=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=Rb(t.doc,s,l,nt.empty);if(!c||c.from!=s||c instanceof br&&c.slice.size>=l-s)return!1;if(n){let u=t.tr.step(c);u.setSelection(Ct.create(u.doc,s)),n(u.scrollIntoView())}return!0}function yf(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const J5=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=Lk(r)}let o=s&&s.nodeBefore;return!o||!ut.isSelectable(o)?!1:(e&&e(t.tr.setSelection(ut.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function Lk(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function eD(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const tD=(t,e,n)=>{let r=eD(t,n);if(!r)return!1;let i=Bk(r);if(!i)return!1;let s=i.nodeAfter;if(oD(t,i,e,1))return!0;if(r.parent.content.size==0&&(yf(s,"start")||ut.isSelectable(s))){let o=Rb(t.doc,r.before(),r.after(),nt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(yf(s,"start")?zt.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):ut.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},nD=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=Bk(r)}let o=s&&s.nodeAfter;return!o||!ut.isSelectable(o)?!1:(e&&e(t.tr.setSelection(ut.create(t.doc,s.pos)).scrollIntoView()),!0)};function Bk(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const foe=(t,e)=>{let n=t.selection,r=n instanceof ut,i;if(r){if(n.node.isTextblock||!Lc(t.doc,n.from))return!1;i=n.from}else if(i=Nb(t.doc,n.from,-1),i==null)return!1;if(e){let s=t.tr.join(i);r&&s.setSelection(ut.create(s.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},hoe=(t,e)=>{let n=t.selection,r;if(n instanceof ut){if(n.node.isTextblock||!Lc(t.doc,n.to))return!1;r=n.to}else if(r=Nb(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},poe=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&$f(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},rD=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function Fk(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const moe=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=Fk(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(zt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},iD=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof ss||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=Fk(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(Ct.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},sD=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(Ua(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&$f(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function goe(t){return(e,n)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof ut&&e.selection.node.isBlock)return!r.parentOffset||!Ua(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let s=[],o,a,l=!1,c=!1;for(let h=r.depth;;h--)if(r.node(h).isBlock){l=r.end(h)==r.pos+(r.depth-h),c=r.start(h)==r.pos-(r.depth-h),a=Fk(r.node(h-1).contentMatchAt(r.indexAfter(h-1))),s.unshift(l&&a?{type:a}:null),o=h;break}else{if(h==1)return!1;s.unshift(null)}let u=e.tr;(e.selection instanceof Ct||e.selection instanceof ss)&&u.deleteSelection();let d=u.mapping.map(r.pos),f=Ua(u.doc,d,s.length,s);if(f||(s[0]=a?{type:a}:null,f=Ua(u.doc,d,s.length,s)),!f)return!1;if(u.split(d,s.length,s),!l&&c&&r.node(o).type!=a){let h=u.mapping.map(r.before(o)),p=u.doc.resolve(h);a&&r.node(o-1).canReplaceWith(p.index(),p.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const yoe=goe(),boe=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(ut.create(t.doc,i))),!0)};function woe(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||Lc(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function oD(t,e,n,r){let i=e.nodeBefore,s=e.nodeAfter,o,a,l=i.type.spec.isolating||s.type.spec.isolating;if(!l&&woe(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(n){let h=e.pos+s.nodeSize,p=De.empty;for(let y=o.length-1;y>=0;y--)p=De.from(o[y].create(null,p));p=De.from(i.copy(p));let m=t.tr.step(new Er(e.pos-1,h,e.pos,h,new nt(p,1,0),o.length,!0)),g=m.doc.resolve(h+2*o.length);g.nodeAfter&&g.nodeAfter.type==i.type&&Lc(m.doc,g.pos)&&m.join(g.pos),n(m.scrollIntoView())}return!0}let u=s.type.spec.isolating||r>0&&l?null:zt.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),f=d&&$f(d);if(f!=null&&f>=e.depth)return n&&n(t.tr.lift(d,f).scrollIntoView()),!0;if(c&&yf(s,"start",!0)&&yf(i,"end")){let h=i,p=[];for(;p.push(h),!h.isTextblock;)h=h.lastChild;let m=s,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(h.canReplace(h.childCount,h.childCount,m.content)){if(n){let y=De.empty;for(let E=p.length-1;E>=0;E--)y=De.from(p[E].copy(y));let b=t.tr.step(new Er(e.pos-p.length,e.pos+s.nodeSize,e.pos+g,e.pos+s.nodeSize-g,new nt(y,p.length,0),0,!0));n(b.scrollIntoView())}return!0}}return!1}function aD(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(Ct.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const voe=aD(-1),xoe=aD(1);function Soe(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&Nk(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function c3(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[s];n.doc.nodesBetween(o,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let u=n.doc.resolve(c),d=u.index();i=u.parent.canReplaceWith(d,d+1,t)}})}if(!i)return!1;if(r){let s=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];s.setBlockType(a,l,t,e)}r(s.scrollIntoView())}return!0}}function $k(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}$k(Dk,X5,J5);$k(Dk,tD,nD);$k(rD,iD,sD,yoe);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Eoe(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s);if(!o)return!1;let a=r?n.tr:null;return koe(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function koe(t,e,n,r=null){let i=!1,s=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);s=new q0(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new q0(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=Nk(s,n,r,e);return a?(t&&Toe(t,e,a,i,n),!0):!1}function Toe(t,e,n,r,i){let s=De.empty;for(let u=n.length-1;u>=0;u--)s=De.from(n[u].type.create(n[u].attrs,s));t.step(new Er(e.start-(r?2:0),e.end,e.start,e.end,new nt(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,f=!0;u<d;u++,f=!1)!f&&Ua(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function _oe(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?Coe(e,n,t,s):Aoe(e,n,s):!0:!1}}function Coe(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new Er(s-1,o,s,o,new nt(De.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new q0(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=$f(r);if(a==null)return!1;i.lift(r,a);let l=i.doc.resolve(i.mapping.map(s,-1)-1);return Lc(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function Aoe(t,e,n){let r=t.tr,i=n.parent;for(let h=n.end,p=n.endIndex-1,m=n.startIndex;p>m;p--)h-=i.child(p).nodeSize,r.delete(h-1,h+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?De.empty:De.from(i))))return!1;let d=s.pos,f=d+o.nodeSize;return r.step(new Er(d-(a?1:0),f+(l?1:0),d+1,f-1,new nt((a?De.empty:De.from(i.copy(De.empty))).append(l?De.empty:De.from(i.copy(De.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function Ioe(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=De.from(c?t.create():null),d=new nt(De.from(t.create(null,De.from(a.type.create(null,u)))),c?3:1,0),f=s.start,h=s.end;n(e.tr.step(new Er(f-(c?3:1),h,f,h,d,1,!0)).scrollIntoView())}return!0}}const Br=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},bf=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let _2=null;const wa=function(t,e,n){let r=_2||(_2=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},Poe=function(){_2=null},Bu=function(t,e,n,r){return n&&(u3(t,e,n,r,-1)||u3(t,e,n,r,1))},Ooe=/^(img|br|input|textarea|hr)$/i;function u3(t,e,n,r,i){for(var s;;){if(t==n&&e==r)return!0;if(e==(i<0?0:ks(t))){let o=t.parentNode;if(!o||o.nodeType!=1||pm(t)||Ooe.test(t.nodeName)||t.contentEditable=="false")return!1;e=Br(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else t=o,e=i<0?ks(t):0}else return!1}}function ks(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Moe(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=ks(t)}else if(t.parentNode&&!pm(t))e=Br(t),t=t.parentNode;else return null}}function Noe(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!pm(t))e=Br(t)+1,t=t.parentNode;else return null}}function Roe(t,e,n){for(let r=e==0,i=e==ks(t);r||i;){if(t==n)return!0;let s=Br(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==ks(t)}}function pm(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Lb=function(t){return t.focusNode&&Bu(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function tu(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function Doe(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Loe(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(ks(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(ks(r.startContainer),r.startOffset)}}}const Zo=typeof navigator<"u"?navigator:null,d3=typeof document<"u"?document:null,Bc=Zo&&Zo.userAgent||"",C2=/Edge\/(\d+)/.exec(Bc),lD=/MSIE \d/.exec(Bc),A2=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Bc),Wi=!!(lD||A2||C2),dc=lD?document.documentMode:A2?+A2[1]:C2?+C2[1]:0,Os=!Wi&&/gecko\/(\d+)/i.test(Bc);Os&&+(/Firefox\/(\d+)/.exec(Bc)||[0,0])[1];const I2=!Wi&&/Chrome\/(\d+)/.exec(Bc),ii=!!I2,cD=I2?+I2[1]:0,Si=!Wi&&!!Zo&&/Apple Computer/.test(Zo.vendor),wf=Si&&(/Mobile\/\w+/.test(Bc)||!!Zo&&Zo.maxTouchPoints>2),Ss=wf||(Zo?/Mac/.test(Zo.platform):!1),Boe=Zo?/Win/.test(Zo.platform):!1,Da=/Android \d/.test(Bc),mm=!!d3&&"webkitFontSmoothing"in d3.documentElement.style,Foe=mm?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function $oe(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function da(t,e){return typeof t=="number"?t:t[e]}function zoe(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function f3(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=bf(o);continue}let a=o,l=a==s.body,c=l?$oe(s):zoe(a),u=0,d=0;if(e.top<c.top+da(r,"top")?d=-(c.top-e.top+da(i,"top")):e.bottom>c.bottom-da(r,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+da(i,"top")-c.top:e.bottom-c.bottom+da(i,"bottom")),e.left<c.left+da(r,"left")?u=-(c.left-e.left+da(i,"left")):e.right>c.right-da(r,"right")&&(u=e.right-c.right+da(i,"right")),u||d)if(l)s.defaultView.scrollBy(u,d);else{let h=a.scrollLeft,p=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let m=a.scrollLeft-h,g=a.scrollTop-p;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}let f=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:bf(o)}}function Uoe(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:uD(t.dom)}}function uD(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=bf(r));return e}function Hoe({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;dD(n,r==0?0:r-e)}function dD(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let cd=null;function Voe(t){if(t.setActive)return t.setActive();if(cd)return t.focus(cd);let e=uD(t);t.focus(cd==null?{get preventScroll(){return cd={preventScroll:!0},!0}}:void 0),cd||(cd=!1,dD(e,0))}function fD(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,d=0;u;u=u.nextSibling,d++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=wa(u).getClientRects();else continue;for(let h=0;h<f.length;h++){let p=f[h];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<r){n=u,r=m,i=m&&n.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&m&&(s=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(s=d+1)}}return!n&&l&&(n=l,i=c,r=0),n&&n.nodeType==3?Woe(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:fD(n,i)}function Woe(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let s=Dl(r,1);if(s.top!=s.bottom&&zk(e,s))return{node:t,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:t,offset:0}}function zk(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function joe(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function qoe(t,e,n){let{node:r,offset:i}=fD(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function Koe(t,e,n,r){let i=-1;for(let s=e,o=!1;s!=t.dom;){let a=t.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?i=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function hD(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(zk(e,c))return hD(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function Goe(t,e){let n=t.dom.ownerDocument,r,i=0,s=Loe(n,e.left,e.top);s&&({node:r,offset:i}=s);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!zk(e,c)||(o=hD(t.dom,e,c),!o))return null}if(Si)for(let c=o;r&&c;c=bf(c))c.draggable&&(r=void 0);if(o=joe(o,e),r){if(Os&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let u=r.childNodes[i],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&i++}let c;mm&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=Koe(t,r,i,e))}a==null&&(a=qoe(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function h3(t){return t.top<t.bottom||t.left<t.right}function Dl(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(h3(r))return r}return Array.prototype.find.call(n,h3)||t.getBoundingClientRect()}const Zoe=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function pD(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=mm||Os;if(r.nodeType==3)if(o&&(Zoe.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=Dl(wa(r,i,i),n);if(Os&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=Dl(wa(r,i-1,i-1),-1);if(c.top==l.top){let u=Dl(wa(r,i,i+1),-1);if(u.top!=l.top)return xh(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,xh(Dl(wa(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==ks(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return h1(l.getBoundingClientRect(),!1)}if(s==null&&i<ks(r)){let l=r.childNodes[i];if(l.nodeType==1)return h1(l.getBoundingClientRect(),!0)}return h1(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==ks(r))){let l=r.childNodes[i-1],c=l.nodeType==3?wa(l,ks(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return xh(Dl(c,1),!1)}if(s==null&&i<ks(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?wa(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return xh(Dl(c,-1),!0)}return xh(Dl(r.nodeType==3?wa(r):r,-n),n>=0)}function xh(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function h1(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function mD(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function Qoe(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return mD(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=pD(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=wa(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const Xoe=/[\u0590-\u08ac]/;function Yoe(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return a?!Xoe.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:mD(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=t.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",n,"character");let h=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:p,focusOffset:m}=t.domSelectionRange(),g=p&&!h.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==m;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return f!=null&&(a.caretBidiLevel=f),g}):r.pos==r.start()||r.pos==r.end()}let p3=null,m3=null,g3=!1;function Joe(t,e,n){return p3==e&&m3==n?g3:(p3=e,m3=n,g3=n=="up"||n=="down"?Qoe(t,e,n):Yoe(t,e,n))}const Ms=0,y3=1,au=2,Qo=3;class gm{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=Ms,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>Br(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof yD){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof gD&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?Br(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?Br(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let d=a;d>0;d--){let f=this.children[d-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){i=Br(f.dom)+1;break}e-=f.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=Br(d.dom);break}n+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let h=0,p=0;h<this.children.length;h++){let m=this.children[h],g=p+m.size;if(s>p&&o<g)return m.setSelection(e-p-m.border,n-p-m.border,r,i);p=g}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),d=!1;if((Os||Si)&&e==n){let{node:h,offset:p}=a;if(h.nodeType==3){if(d=!!(p&&h.nodeValue[p-1]==`
`),d&&p==h.nodeValue.length)for(let m=h,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:Br(g)+1});break}let y=m.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let m=h.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(Os&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let h=u.focusNode.childNodes[u.focusOffset];h&&h.contentEditable=="false"&&(i=!0)}if(!(i||d&&Si)&&Bu(a.node,a.offset,u.anchorNode,u.anchorOffset)&&Bu(l.node,l.offset,u.focusNode,u.focusOffset))return;let f=!1;if((c.extend||e==n)&&!(d&&Os)){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>n){let p=a;a=l,l=p}let h=document.createRange();h.setEnd(l.node,l.offset),h.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(h)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?au:y3,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=Qo:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?au:Qo}r=o}this.dirty=au}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?au:y3;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class gD extends gm{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==Ms&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class eae extends gm{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Fu extends gm{constructor(e,n,r,i,s){super(e,[],r,i),this.mark=n,this.spec=s}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=qu.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new Fu(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&Qo||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Qo&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Ms){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Ms}}slice(e,n,r){let i=Fu.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=O2(s,n,o,r)),e>0&&(s=O2(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class fc extends gm{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,d=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=qu.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!d&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let f=u;return u=vD(u,r,n),c?l=new tae(e,n,r,i,u,d||null,f,c,s,o+1):n.isText?new Bb(e,n,r,i,u,f,s):new fc(e,n,r,i,u,d||null,f,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>De.empty)}return e}matchesNode(e,n,r){return this.dirty==Ms&&e.eq(this.node)&&G0(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new rae(this,o&&o.node,e);oae(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?_n.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,i)},(c,u,d,f)=>{l.syncToMarks(c.marks,r,e);let h;l.findNodeMatch(c,u,d,f)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(h=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,d,h,e)||l.updateNextNode(c,u,d,e,f,i)||l.addNode(c,u,d,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==au)&&(o&&this.protectLocalComposition(e,o),bD(this.contentDOM,this.children,e),wf&&aae(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof Ct)||r<n||i>n+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=lae(this.node.content,o,r-n,i-n);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new eae(this,s,n,i);e.input.compositionNodes.push(o),this.children=O2(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==Qo||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Ms}updateOuterDeco(e){if(G0(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=wD(this.dom,this.nodeDOM,P2(this.outerDeco,this.node,n),P2(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function b3(t,e,n,r,i){vD(r,e,t);let s=new fc(void 0,t,e,n,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class Bb extends fc{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==Qo||this.dirty!=Ms&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Ms||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Ms,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new Bb(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=Qo)}get domAtom(){return!1}isText(e){return this.node.text==e}}class yD extends gm{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Ms&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class tae extends fc{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==Qo)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function bD(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=w3(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof Fu){let l=r?r.previousSibling:t.lastChild;bD(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=w3(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const Jh=function(t){t&&(this.nodeName=t)};Jh.prototype=Object.create(null);const lu=[new Jh];function P2(t,e,n){if(t.length==0)return lu;let r=n?lu[0]:new Jh,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new Jh(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new Jh(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function wD(t,e,n,r){if(n==lu&&r==lu)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=lu[0]),i=l}nae(i,a||lu[0],o)}return i}function nae(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function vD(t,e,n){return wD(t,t,lu,P2(e,n,t.nodeType!=1))}function G0(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function w3(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class rae{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=iae(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=Ms,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[s])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Fu.create(this.top,e[s],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==Qo&&o.dom==o.contentDOM&&(o.dirty=au),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof fc){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,d,f=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Qo&&G0(n,l.outerDeco));if(!f&&l.update(e,n,r,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(d=this.recreateWrapper(l,e,n,r,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=au,d.updateChildren(i,o+1),d.dirty=Ms),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,i,s,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!G0(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=fc.create(this.top,n,r,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,i,s){let o=fc.create(this.top,e,n,r,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new gD(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Fu;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Bb)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Si||ii)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new yD(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function iae(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof Fu)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function sae(t,e){return t.type.side-e.type.side}function oae(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<i.length&&i[o].to==s;){let g=i[o++];g.widget&&(u?(d||(d=[u])).push(g):u=g)}if(u)if(d){d.sort(sae);for(let g=0;g<d.length;g++)n(d[g],c,!!l)}else n(u,c,!!l);let f,h;if(l)h=-1,f=l,l=null;else if(c<t.childCount)h=c,f=t.child(c++);else break;for(let g=0;g<a.length;g++)a[g].to<=s&&a.splice(g--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+f.nodeSize;if(f.isText){let g=p;o<i.length&&i[o].from<g&&(g=i[o].from);for(let y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<p&&(l=f.cut(g-s),f=f.cut(0,g-s),p=g,h=-1)}else for(;o<i.length&&i[o].to<p;)o++;let m=f.isInline&&!f.isLeaf?a.filter(g=>!g.inline):a.slice();r(f,m,e.forChild(s,f),h),s=p}}function aae(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function lae(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function O2(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function Uk(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(Lb(n)){for(l=o;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&ut.isSelectable(d)&&i.parent&&!(d.isInline&&Roe(n.focusNode,n.focusOffset,i.dom))){let f=i.posBefore;c=new ut(o==f?a:r.resolve(f))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let d=o,f=o;for(let h=0;h<n.rangeCount;h++){let p=n.getRangeAt(h);d=Math.min(d,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=f==t.state.selection.anchor?[f,d]:[d,f],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let d=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=Hk(t,u,a,d)}return c}function xD(t){return t.editable?t.hasFocus():ED(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Ha(t,e=!1){let n=t.state.selection;if(SD(t,n),!!xD(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&ii){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&Bu(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)uae(t);else{let{anchor:r,head:i}=n,s,o;v3&&!(n instanceof Ct)&&(n.$from.parent.inlineContent||(s=x3(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=x3(t,n.to))),t.docView.setSelection(r,i,t,e),v3&&(s&&S3(s),o&&S3(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&cae(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const v3=Si||ii&&cD<63;function x3(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(Si&&i&&i.contentEditable=="false")return p1(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return p1(i);if(s)return p1(s)}}function p1(t){return t.contentEditable="true",Si&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function S3(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function cae(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!xD(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function uae(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,Br(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Wi&&dc<=11&&(n.disabled=!0,n.disabled=!1)}function SD(t,e){if(e instanceof ut){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(E3(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else E3(t)}function E3(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Hk(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||Ct.between(e,n,r)}function k3(t){return t.editable&&!t.hasFocus()?!1:ED(t)}function ED(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function dae(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return Bu(e.node,e.offset,n.anchorNode,n.anchorOffset)}function M2(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&zt.findFrom(s,e)}function Fl(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function T3(t,e,n){let r=t.state.selection;if(r instanceof Ct)if(n.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return Fl(t,new Ct(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=M2(t.state,e);return i&&i instanceof ut?Fl(t,i):!1}else if(!(Ss&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?ut.isSelectable(s)?Fl(t,new ut(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):mm?Fl(t,new Ct(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof ut&&r.node.isInline)return Fl(t,new Ct(e>0?r.$to:r.$from));{let i=M2(t.state,e);return i?Fl(t,i):!1}}}function Z0(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function ep(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function ud(t,e){return e<0?fae(t):hae(t)}function fae(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for(Os&&n.nodeType==1&&r<Z0(n)&&ep(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(ep(a,-1))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(kD(n))break;{let a=n.previousSibling;for(;a&&ep(a,-1);)i=n.parentNode,s=Br(a),a=a.previousSibling;if(a)n=a,r=Z0(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?N2(t,n,r):i&&N2(t,i,s)}function hae(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=Z0(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(ep(a,1))s=n,o=++r;else break}else{if(kD(n))break;{let a=n.nextSibling;for(;a&&ep(a,1);)s=a.parentNode,o=Br(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=Z0(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&N2(t,s,o)}function kD(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function pae(t,e){for(;t&&e==t.childNodes.length&&!pm(t);)e=Br(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function mae(t,e){for(;t&&!e&&!pm(t);)e=Br(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function N2(t,e,n){if(e.nodeType!=3){let s,o;(o=pae(e,n))?(e=o,n=0):(s=mae(e,n))&&(e=s,n=s.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Lb(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&Ha(t)},50)}function _3(t,e){let n=t.state.doc.resolve(e);if(!(ii||Boe)&&n.parent.inlineContent){let i=t.coordsAtPos(e);if(e>n.start()){let s=t.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<n.end()){let s=t.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function C3(t,e,n){let r=t.state.selection;if(r instanceof Ct&&!r.empty||n.indexOf("s")>-1||Ss&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=M2(t.state,e);if(o&&o instanceof ut)return Fl(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof ss?zt.near(o,e):zt.findFrom(o,e);return a?Fl(t,a):!1}return!1}function A3(t,e){if(!(t.state.selection instanceof Ct))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function I3(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function gae(t){if(!Si||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;I3(t,r,"true"),setTimeout(()=>I3(t,r,"false"),20)}return!1}function yae(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function bae(t,e){let n=e.keyCode,r=yae(e);if(n==8||Ss&&n==72&&r=="c")return A3(t,-1)||ud(t,-1);if(n==46&&!e.shiftKey||Ss&&n==68&&r=="c")return A3(t,1)||ud(t,1);if(n==13||n==27)return!0;if(n==37||Ss&&n==66&&r=="c"){let i=n==37?_3(t,t.state.selection.from)=="ltr"?-1:1:-1;return T3(t,i,r)||ud(t,i)}else if(n==39||Ss&&n==70&&r=="c"){let i=n==39?_3(t,t.state.selection.from)=="ltr"?1:-1:1;return T3(t,i,r)||ud(t,i)}else{if(n==38||Ss&&n==80&&r=="c")return C3(t,-1,r)||ud(t,-1);if(n==40||Ss&&n==78&&r=="c")return gae(t)||C3(t,1,r)||ud(t,1);if(r==(Ss?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function Vk(t,e){t.someProp("transformCopied",h=>{e=h(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let h=r.firstChild;n.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let o=t.someProp("clipboardSerializer")||qu.fromSchema(t.state.schema),a=PD(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=ID[c.nodeName.toLowerCase()]);){for(let h=u.length-1;h>=0;h--){let p=a.createElement(u[h]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",h=>h(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:f,slice:e}}function TD(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",f=>{e=f(e,s||r,t)}),s)return a=new nt(De.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{a=f(a,t,!0)}),a;let d=t.someProp("clipboardTextParser",f=>f(e,i,r,t));if(d)a=d;else{let f=i.marks(),{schema:h}=t.state,p=qu.fromSchema(h);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(h.text(m,f)))})}}else t.someProp("transformPastedHTML",d=>{n=d(n,t)}),o=Sae(n),mm&&Eae(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||uc.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!wae.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)a=kae(P3(a,+u[1],+u[2]),u[4]);else if(a=nt.maxOpen(vae(a.content,i),!0),a.openStart||a.openEnd){let d=0,f=0;for(let h=a.content.firstChild;d<a.openStart&&!h.type.spec.isolating;d++,h=h.firstChild);for(let h=a.content.lastChild;f<a.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);a=P3(a,d,f)}return t.someProp("transformPasted",d=>{a=d(a,t,l)}),a}const wae=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function vae(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&CD(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=AD(o[o.length-1],s.length));let u=_D(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return De.from(o)}return t}function _D(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,De.from(t));return t}function CD(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=CD(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(De.from(_D(n,t,i+1))))}}function AD(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,AD(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(De.empty,!0);return t.copy(n.append(r))}function R2(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),i<r-1&&(a=R2(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(De.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function P3(t,e,n){return e<t.openStart&&(t=new nt(R2(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new nt(R2(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const ID={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let O3=null;function PD(){return O3||(O3=document.implementation.createHTMLDocument("title"))}let m1=null;function xae(t){let e=window.trustedTypes;return e?(m1||(m1=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),m1.createHTML(t)):t}function Sae(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=PD().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&ID[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=xae(t),i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function Eae(t){let e=t.querySelectorAll(ii?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent=="Â "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function kae(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=De.from(l.create(r[a+1],i)),s++,o++}return new nt(i,s,o)}const Ei={},ki={},Tae={touchstart:!0,touchmove:!0};class _ae{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Cae(t){for(let e in Ei){let n=Ei[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{Iae(t,r)&&!Wk(t,r)&&(t.editable||!(r.type in ki))&&n(t,r)},Tae[e]?{passive:!0}:void 0)}Si&&t.dom.addEventListener("input",()=>null),D2(t)}function tc(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function Aae(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function D2(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>Wk(t,r))})}function Wk(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function Iae(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function Pae(t,e){!Wk(t,e)&&Ei[e.type]&&(t.editable||!(e.type in ki))&&Ei[e.type](t,e)}ki.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!MD(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Da&&ii&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),wf&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,tu(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||bae(t,n)?n.preventDefault():tc(t,"key")};ki.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};ki.keypress=(t,e)=>{let n=e;if(MD(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ss&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof Ct)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode),s=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,i,s))&&t.dispatch(s()),n.preventDefault()}};function Fb(t){return{left:t.clientX,top:t.clientY}}function Oae(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function jk(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function Zd(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function Mae(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&ut.isSelectable(r)?(Zd(t,new ut(n)),!0):!1}function Nae(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof ut&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(ut.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(Zd(t,ut.create(t.state.doc,i)),!0):!1}function Rae(t,e,n,r,i){return jk(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?Nae(t,n):Mae(t,n))}function Dae(t,e,n,r){return jk(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function Lae(t,e,n,r){return jk(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||Bae(t,n,r)}function Bae(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(Zd(t,Ct.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)Zd(t,Ct.create(r,a+1,a+1+o.content.size));else if(ut.isSelectable(o))Zd(t,ut.create(r,a));else continue;return!0}}function qk(t){return Q0(t)}const OD=Ss?"metaKey":"ctrlKey";Ei.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=qk(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&Oae(n,t.input.lastClick)&&!n[OD]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s,button:n.button};let o=t.posAtCoords(Fb(n));o&&(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new Fae(t,o,n,!!r)):(s=="doubleClick"?Dae:Lae)(t,o.pos,o.inside,n)?n.preventDefault():tc(t,"pointer"))};class Fae{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[OD],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof ut&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Os&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),tc(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Ha(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Fb(e))),this.updateAllowDefault(e),this.allowDefault||!n?tc(this.view,"pointer"):Rae(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Si&&this.mightDrag&&!this.mightDrag.node.isAtom||ii&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Zd(this.view,zt.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):tc(this.view,"pointer")}move(e){this.updateAllowDefault(e),tc(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ei.touchstart=t=>{t.input.lastTouch=Date.now(),qk(t),tc(t,"pointer")};Ei.touchmove=t=>{t.input.lastTouch=Date.now(),tc(t,"pointer")};Ei.contextmenu=t=>qk(t);function MD(t,e){return t.composing?!0:Si&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const $ae=Da?5e3:-1;ki.compositionstart=ki.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof Ct&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),Q0(t,!0),t.markCursor=null;else if(Q0(t,!e.selection.empty),Os&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}ND(t,$ae)};ki.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,ND(t,20))};function ND(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Q0(t),e))}function RD(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=Uae());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function zae(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=Moe(e.focusNode,e.focusOffset),r=Noe(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let i=r.pmViewDesc,s=t.domObserver.lastChangedTextNode;if(n==s||r==s)return s;if(!i||!i.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function Uae(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Q0(t,e=!1){if(!(Da&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),RD(t),e||t.docView&&t.docView.dirty){let n=Uk(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function Hae(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Pp=Wi&&dc<15||wf&&Foe<604;Ei.copy=ki.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=Pp?null:n.clipboardData,o=r.content(),{dom:a,text:l}=Vk(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):Hae(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Vae(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function Wae(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Op(t,r.value,null,i,e):Op(t,r.textContent,r.innerHTML,i,e)},50)}function Op(t,e,n,r,i){let s=TD(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,s||nt.empty)))return!0;if(!s)return!1;let o=Vae(s),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function DD(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}ki.paste=(t,e)=>{let n=e;if(t.composing&&!Da)return;let r=Pp?null:n.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&Op(t,DD(r),r.getData("text/html"),i,n)?n.preventDefault():Wae(t,n)};class LD{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const jae=Ss?"altKey":"ctrlKey";function BD(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[jae]}Ei.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(Fb(n)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof ut?i.to-1:i.to))){if(r&&r.mightDrag)o=ut.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let d=t.docView.nearestDesc(n.target,!0);d&&d.node.type.spec.draggable&&d!=t.docView&&(o=ut.create(t.state.doc,d.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=Vk(t,a);(!n.dataTransfer.files.length||!ii||cD>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Pp?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Pp||n.dataTransfer.setData("text/plain",c),t.dragging=new LD(u,BD(t,n),o)};Ei.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};ki.dragover=ki.dragenter=(t,e)=>e.preventDefault();ki.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(Fb(n));if(!i)return;let s=t.state.doc.resolve(i.pos),o=r&&r.slice;o?t.someProp("transformPasted",p=>{o=p(o,t,!1)}):o=TD(t,DD(n.dataTransfer),Pp?null:n.dataTransfer.getData("text/html"),!1,s);let a=!!(r&&BD(t,n));if(t.someProp("handleDrop",p=>p(t,n,o||nt.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?H5(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let c=t.state.tr;if(a){let{node:p}=r;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=c.doc;if(d?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(f))return;let h=c.doc.resolve(u);if(d&&ut.isSelectable(o.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new ut(h));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((m,g,y,b)=>p=b),c.setSelection(Hk(t,h,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};Ei.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Ha(t)},20))};Ei.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ei.beforeinput=(t,e)=>{if(ii&&Da&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,tu(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in ki)Ei[t]=ki[t];function Mp(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class X0{constructor(e,n){this.toDOM=e,this.spec=n||wu,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new Sr(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof X0&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Mp(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class hc{constructor(e,n){this.attrs=e,this.spec=n||wu}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new Sr(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof hc&&Mp(this.attrs,e.attrs)&&Mp(this.spec,e.spec)}static is(e){return e.type instanceof hc}destroy(){}}class Kk{constructor(e,n){this.attrs=e,this.spec=n||wu}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new Sr(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof Kk&&Mp(this.attrs,e.attrs)&&Mp(this.spec,e.spec)}destroy(){}}class Sr{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new Sr(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new Sr(e,e,new X0(n,r))}static inline(e,n,r,i){return new Sr(e,n,new hc(r,i))}static node(e,n,r,i){return new Sr(e,n,new Kk(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof hc}get widget(){return this.type instanceof X0}}const bd=[],wu={};class xn{constructor(e,n){this.local=e.length?e:bd,this.children=n.length?n:bd}static create(e,n){return n.length?Y0(n,e,0,wu):Gr}find(e,n,r){let i=[];return this.findInner(e??0,n??1e9,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==Gr||e.maps.length==0?this:this.mapInner(e,n,0,0,r||wu)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?qae(this.children,o||[],e,n,r,i,s):o?new xn(o.sort(vu),bd):Gr}add(e,n){return n.length?this==Gr?xn.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(u=$D(n,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,Y0(u,a,c+1,wu)),s+=3}});let o=FD(s?zD(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new xn(o.length?this.local.concat(o).sort(vu):this.local,i||this.children)}remove(e){return e.length==0||this==Gr?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=Gr?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new xn(i,r):Gr}forChild(e,n){if(this==Gr)return this;if(n.isLeaf)return xn.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof hc){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new xn(i.sort(vu),bd);return r?new Wl([a,r]):a}return r||Gr}eq(e){if(this==e)return!0;if(!(e instanceof xn)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Gk(this.localsInner(e))}localsInner(e){if(this==Gr)return bd;if(e.inlineContent||!this.local.some(hc.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof hc||n.push(this.local[r]);return n}forEachSet(e){e(this)}}xn.empty=new xn([],[]);xn.removeOverlap=Gk;const Gr=xn.empty;class Wl{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,wu));return Wl.from(r)}forChild(e,n){if(n.isLeaf)return xn.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=Gr&&(s instanceof Wl?r=r.concat(s.members):r.push(s))}return Wl.from(r)}eq(e){if(!(e instanceof Wl)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?Gk(r?n:n.sort(vu)):bd}static from(e){switch(e.length){case 0:return Gr;case 1:return e[0];default:return new Wl(e.every(n=>n instanceof xn)?e:e.reduce((n,r)=>n.concat(r instanceof xn?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function qae(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let d=0;n.maps[c].forEach((f,h,p,m)=>{let g=m-p-(h-f);for(let y=0;y<a.length;y+=3){let b=a[y+1];if(b<0||f>b+u-d)continue;let E=a[y]+u-d;h>=E?a[y+1]=f<=E?-2:-1:f>=u&&g&&(a[y]+=g,a[y+1]+=g)}d+=g}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),d=u-i;if(d<0||d>=r.content.size){l=!0;continue}let f=n.map(t[c+1]+s,-1),h=f-i,{index:p,offset:m}=r.content.findIndex(d),g=r.maybeChild(p);if(g&&m==d&&m+g.nodeSize==h){let y=a[c+2].mapInner(n,g,u+1,t[c]+s+1,o);y!=Gr?(a[c]=d,a[c+1]=h,a[c+2]=y):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=Kae(a,t,e,n,i,s,o),u=Y0(c,r,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,f=0;d<u.children.length;d+=3){let h=u.children[d];for(;f<a.length&&a[f]<h;)f+=3;a.splice(f,0,u.children[d],u.children[d+1],u.children[d+2])}}return new xn(e.sort(vu),a)}function FD(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new Sr(i.from+e,i.to+e,i.type))}return n}function Kae(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(r,i,c);d?n.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function $D(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function zD(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Y0(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=$D(t,a,l+n);if(c){s=!0;let u=Y0(c,a,n+l+1,r);u!=Gr&&i.push(l,l+a.nodeSize,u)}});let o=FD(s?zD(t):t,-n).sort(vu);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new xn(o,i):Gr}function vu(t,e){return t.from-e.from||t.to-e.to}function Gk(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),M3(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),M3(e,i,r.copy(s.from,r.to)));break}}}return e}function M3(t,e,n){for(;e<t.length&&vu(n,t[e])>0;)e++;t.splice(e,0,n)}function g1(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=Gr&&e.push(r)}),t.cursorWrapper&&e.push(xn.create(t.state.doc,[t.cursorWrapper.deco])),Wl.from(e)}const Gae={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Zae=Wi&&dc<=11;class Qae{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Xae{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Qae,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);Wi&&dc<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),Zae&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Gae)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(k3(this.view)){if(this.suppressingSelectionUpdates)return Ha(this.view);if(Wi&&dc<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Bu(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=bf(s))n.add(s);for(let s=e.anchorNode;s;s=bf(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&k3(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let d=this.registerMutation(n[u],l);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if(Os&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,f]=u;d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let f of u){let h=f.parentNode;h&&h.nodeName=="LI"&&(!d||ele(e,d)!=h)&&f.remove()}}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Lb(r)&&(c=Uk(e))&&c.eq(zt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Ha(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),Yae(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Ha(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];n.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(Wi&&dc<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:f}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f)}let o=i&&i.parentNode==e.target?Br(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?Br(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let N3=new WeakMap,R3=!1;function Yae(t){if(!N3.has(t)&&(N3.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Os,R3)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),R3=!0}}function D3(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return Bu(o.node,o.offset,i,s)&&([n,r,i,s]=[i,s,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}}function Jae(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return D3(t,i)}let n;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?D3(t,n):null}function ele(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function tle(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],Lb(l)||c.push({node:l.focusNode,offset:l.focusOffset})),ii&&t.input.lastKeyCode===8)for(let g=s;g>i;g--){let y=r.childNodes[g-1],b=y.pmViewDesc;if(y.nodeName=="BR"&&!b){s=g;break}if(!b||b.size)break}let d=t.state.doc,f=t.someProp("domParser")||uc.fromSchema(t.state.schema),h=d.resolve(o),p=null,m=f.parse(r,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:i,to:s,preserveWhitespace:h.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:nle,context:h});if(c&&c[0].pos!=null){let g=c[0].pos,y=c[1]&&c[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:m,sel:p,from:o,to:a}}function nle(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Si&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Si&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const rle=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function ile(t,e,n,r,i){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let P=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,T=Uk(t,P);if(T&&!t.state.selection.eq(T)){if(ii&&Da&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",_=>_(t,tu(13,"Enter"))))return;let S=t.state.tr.setSelection(T);P=="pointer"?S.setMeta("pointer",!0):P=="key"&&S.scrollIntoView(),s&&S.setMeta("composition",s),t.dispatch(S)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=tle(t,e,n),u=t.state.doc,d=u.slice(c.from,c.to),f,h;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,h="end"):(f=t.state.selection.from,h="start"),t.input.lastKeyCode=null;let p=ale(d.content,c.doc.content,c.from,f,h);if(p&&t.input.domChangeCount++,(wf&&t.input.lastIOSEnter>Date.now()-225||Da)&&i.some(P=>P.nodeType==1&&!rle.test(P.nodeName))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",P=>P(t,tu(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!p)if(r&&l instanceof Ct&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let P=L3(t,t.state.doc,c.sel);if(P&&!P.eq(t.state.selection)){let T=t.state.tr.setSelection(P);s&&T.setMeta("composition",s),t.dispatch(T)}}return}t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof Ct&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),Wi&&dc<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" Â "&&(p.start--,p.endA--,p.endB--);let m=c.doc.resolveNoCache(p.start-c.from),g=c.doc.resolveNoCache(p.endB-c.from),y=u.resolve(p.start),b=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=p.endA;if((wf&&t.input.lastIOSEnter>Date.now()-225&&(!b||i.some(P=>P.nodeName=="DIV"||P.nodeName=="P"))||!b&&m.pos<c.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&m.pos<g.pos&&!/\S/.test(c.doc.textBetween(m.pos,g.pos,"","")))&&t.someProp("handleKeyDown",P=>P(t,tu(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>p.start&&ole(u,p.start,p.endA,m,g)&&t.someProp("handleKeyDown",P=>P(t,tu(8,"Backspace")))){Da&&ii&&t.domObserver.suppressSelectionUpdates();return}ii&&p.endB==p.start&&(t.input.lastChromeDelete=Date.now()),Da&&!b&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,g=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(P){return P(t,tu(13,"Enter"))})},20));let E=p.start,C=p.endA,I=P=>{let T=P||t.state.tr.replace(E,C,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let S=L3(t,T.doc,c.sel);S&&!(ii&&t.composing&&S.empty&&(p.start!=p.endB||t.input.lastChromeDelete<Date.now()-100)&&(S.head==E||S.head==T.mapping.map(C)-1)||Wi&&S.empty&&S.head==E)&&T.setSelection(S)}return s&&T.setMeta("composition",s),T.scrollIntoView()},x;if(b)if(m.pos==g.pos){Wi&&dc<=11&&m.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Ha(t),20));let P=I(t.state.tr.delete(E,C)),T=u.resolve(p.start).marksAcross(u.resolve(p.endA));T&&P.ensureMarks(T),t.dispatch(P)}else if(p.endA==p.endB&&(x=sle(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start())))){let P=I(t.state.tr);x.type=="add"?P.addMark(E,C,x.mark):P.removeMark(E,C,x.mark),t.dispatch(P)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let P=m.parent.textBetween(m.parentOffset,g.parentOffset),T=()=>I(t.state.tr.insertText(P,E,C));t.someProp("handleTextInput",S=>S(t,E,C,P,T))||t.dispatch(T())}else t.dispatch(I());else t.dispatch(I())}function L3(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:Hk(t,e.resolve(n.anchor),e.resolve(n.head))}function sle(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(De.from(c).eq(t))return{mark:a,type:o}}function ole(t,e,n,r,i){if(n-e<=i.pos-r.pos||y1(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(!r.parent.isTextblock){let a=s.nodeAfter;return a!=null&&n==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(y1(s,!0,!0));return!o.parent.isTextblock||o.pos>n||y1(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function y1(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function ale(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}if(o<s&&t.size<e.size){let l=r<=s&&r>=o?s-r:0;s-=l,s&&s<e.size&&B3(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=r<=s&&r>=a?s-r:0;s-=l,s&&s<t.size&&B3(t.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function B3(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class UD{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new _ae,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(H3),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=z3(this),$3(this),this.nodeViews=U3(this),this.docView=b3(this.state.doc,F3(this),g1(this),this.dom,this),this.domObserver=new Xae(this,(r,i,s,o)=>ile(this,r,i,s,o)),this.domObserver.start(),Cae(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&D2(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(H3),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(RD(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let h=U3(this);cle(h,this.nodeViews)&&(this.nodeViews=h,s=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&D2(this),this.editable=z3(this),$3(this);let l=g1(this),c=F3(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(i.selection))&&(o=!0);let f=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&Uoe(this);if(o){this.domObserver.stop();let h=d&&(Wi||ii)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&lle(i.selection,e.selection);if(d){let p=ii?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=zae(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=b3(e.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(h=!0)}h||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&dae(this))?Ha(this,h):(SD(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&Hoe(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof ut){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&f3(this,n.getBoundingClientRect(),e)}else f3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let s=r.from+(this.state.doc.content.size-n.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==r.node&&(i=s)}this.dragging=new LD(e.slice,e.move,i<0?void 0:ut.create(this.state.doc,i))}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(Wi){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Voe(this.dom),Ha(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Goe(this,e)}coordsAtPos(e,n=1){return pD(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return Joe(this,n||this.state,e)}pasteHTML(e,n){return Op(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return Op(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return Vk(this,e)}destroy(){this.docView&&(Aae(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],g1(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Poe())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Pae(this,e)}domSelectionRange(){let e=this.domSelection();return e?Si&&this.root.nodeType===11&&Doe(this.dom.ownerDocument)==this.dom&&Jae(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}UD.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function F3(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[Sr.node(0,t.state.doc.content.size,e)]}function $3(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Sr.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function z3(t){return!t.someProp("editable",e=>e(t.state)===!1)}function lle(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function U3(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function cle(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function H3(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var kc={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},J0={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},ule=typeof navigator<"u"&&/Mac/.test(navigator.platform),dle=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Fr=0;Fr<10;Fr++)kc[48+Fr]=kc[96+Fr]=String(Fr);for(var Fr=1;Fr<=24;Fr++)kc[Fr+111]="F"+Fr;for(var Fr=65;Fr<=90;Fr++)kc[Fr]=String.fromCharCode(Fr+32),J0[Fr]=String.fromCharCode(Fr);for(var b1 in kc)J0.hasOwnProperty(b1)||(J0[b1]=kc[b1]);function fle(t){var e=ule&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||dle&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?J0:kc)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const hle=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),ple=typeof navigator<"u"&&/Win/.test(navigator.platform);function mle(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))hle?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function gle(t){let e=Object.create(null);for(let n in t)e[mle(n)]=t[n];return e}function w1(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function yle(t){return new un({props:{handleKeyDown:HD(t)}})}function HD(t){let e=gle(t);return function(n,r){let i=fle(r),s,o=e[w1(i,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[w1(i,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(ple&&r.ctrlKey&&r.altKey)&&(s=kc[r.keyCode])&&s!=i){let a=e[w1(s,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}var ble=Object.defineProperty,Zk=(t,e)=>{for(var n in e)ble(t,n,{get:e[n],enumerable:!0})};function $b(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}var zb=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:i}=n,s=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([o,a])=>[o,(...c)=>{const u=a(...c)(s);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(i),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o=[],a=!!t,l=t||i.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(l),o.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(n).map(([d,f])=>[d,(...p)=>{const m=this.buildProps(l,e),g=f(...p)(m);return o.push(g),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,r=!1,i=t||n.tr,s=this.buildProps(i,r);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...s,dispatch:void 0})])),chain:()=>this.createChain(i,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o={tr:t,editor:r,view:s,state:$b({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},VD={};Zk(VD,{blur:()=>wle,clearContent:()=>vle,clearNodes:()=>xle,command:()=>Sle,createParagraphNear:()=>Ele,cut:()=>kle,deleteCurrentNode:()=>Tle,deleteNode:()=>_le,deleteRange:()=>Cle,deleteSelection:()=>Ale,enter:()=>Ile,exitCode:()=>Ple,extendMarkRange:()=>Ole,first:()=>Mle,focus:()=>Nle,forEach:()=>Rle,insertContent:()=>Dle,insertContentAt:()=>Fle,joinBackward:()=>Ule,joinDown:()=>zle,joinForward:()=>Hle,joinItemBackward:()=>Vle,joinItemForward:()=>Wle,joinTextblockBackward:()=>jle,joinTextblockForward:()=>qle,joinUp:()=>$le,keyboardShortcut:()=>Gle,lift:()=>Zle,liftEmptyBlock:()=>Qle,liftListItem:()=>Xle,newlineInCode:()=>Yle,resetAttributes:()=>Jle,scrollIntoView:()=>ece,selectAll:()=>tce,selectNodeBackward:()=>nce,selectNodeForward:()=>rce,selectParentNode:()=>ice,selectTextblockEnd:()=>sce,selectTextblockStart:()=>oce,setContent:()=>ace,setMark:()=>Tce,setMeta:()=>_ce,setNode:()=>Cce,setNodeSelection:()=>Ace,setTextSelection:()=>Ice,sinkListItem:()=>Pce,splitBlock:()=>Oce,splitListItem:()=>Mce,toggleList:()=>Nce,toggleMark:()=>Rce,toggleNode:()=>Dce,toggleWrap:()=>Lce,undoInputRule:()=>Bce,unsetAllMarks:()=>Fce,unsetMark:()=>$ce,updateAttributes:()=>zce,wrapIn:()=>Uce,wrapInList:()=>Hce});var wle=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())==null||n.removeAllRanges())}),!0),vle=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),xle=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),f=c.resolve(u.map(l+a.nodeSize)),h=d.blockRange(f);if(!h)return;const p=$f(h);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(h.start,m)}(p||p===0)&&e.lift(h,p)})}),!0},Sle=t=>e=>t(e),Ele=()=>({state:t,dispatch:e})=>iD(t,e),kle=(t,e)=>({editor:n,tr:r})=>{const{state:i}=n,s=i.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,s.content),r.setSelection(new Ct(r.doc.resolve(Math.max(o-1,0)))),!0},Tle=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===r.type){if(e){const a=i.before(s),l=i.after(s);t.delete(a,l).scrollIntoView()}return!0}return!1};function cr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var _le=t=>({tr:e,state:n,dispatch:r})=>{const i=cr(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},Cle=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},Ale=()=>({state:t,dispatch:e})=>Dk(t,e),Ile=()=>({commands:t})=>t.keyboardShortcut("Enter"),Ple=()=>({state:t,dispatch:e})=>moe(t,e);function Qk(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function ey(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:Qk(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function WD(t,e,n={}){return t.find(r=>r.type===e&&ey(Object.fromEntries(Object.keys(n).map(i=>[i,r.attrs[i]])),n))}function V3(t,e,n={}){return!!WD(t,e,n)}function Xk(t,e,n){var r;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(n=n||((r=i.node.marks[0])==null?void 0:r.attrs),!WD([...i.node.marks],e,n)))return;let o=i.index,a=t.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&V3([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&V3([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function al(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var Ole=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=al(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const d=Xk(l,s,e);if(d&&d.from<=c&&d.to>=u){const f=Ct.create(o,d.from,d.to);n.setSelection(f)}}return!0},Mle=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function jD(t){return t instanceof Ct}function cu(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function qD(t,e=null){if(!e)return null;const n=zt.atStart(t),r=zt.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?Ct.create(t,cu(0,i,s),cu(t.content.size,i,s)):Ct.create(t,cu(e,i,s),cu(e,i,s))}function KD(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Ub(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Nle=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(Ub()||KD())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!jD(n.state.selection))return o(),!0;const a=qD(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},Rle=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),Dle=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),GD=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&GD(r)}return t};function ig(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return GD(n)}function Np(t,e,n){if(t instanceof cc||t instanceof De)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,i=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return De.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(s){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),Np("",e,n)}if(i){if(n.errorOnInvalidContent){let o=!1,a="";const l=new O5({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?uc.fromSchema(l).parseSlice(ig(t),n.parseOptions):uc.fromSchema(l).parse(ig(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=uc.fromSchema(e);return n.slice?s.parseSlice(ig(t),n.parseOptions).content:s.parse(ig(t),n.parseOptions)}return Np("",e,n)}function Lle(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof br||i instanceof Er))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(zt.near(t.doc.resolve(o),n))}var Ble=t=>!("type"in t),Fle=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{var o;if(i){n={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{Np(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=Np(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,h=!0;if((Ble(a)?a:[a]).forEach(g=>{g.check(),f=f?g.isText&&g.marks.length===0:!1,h=h?g.isBlock:!1}),u===d&&h){const{parent:g}=r.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(f){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof De){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;r.insertText(m,u,d)}else{m=a;const g=r.doc.resolve(u),y=g.node(),b=g.parentOffset===0,E=y.isText||y.isTextblock,C=y.content.size>0;b&&E&&C&&(u=Math.max(0,u-1)),r.replaceWith(u,d,m)}n.updateSelection&&Lle(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:m}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:m})}return!0},$le=()=>({state:t,dispatch:e})=>foe(t,e),zle=()=>({state:t,dispatch:e})=>hoe(t,e),Ule=()=>({state:t,dispatch:e})=>X5(t,e),Hle=()=>({state:t,dispatch:e})=>tD(t,e),Vle=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Nb(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Wle=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Nb(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},jle=()=>({state:t,dispatch:e})=>uoe(t,e),qle=()=>({state:t,dispatch:e})=>doe(t,e);function ZD(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Kle(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))Ub()||ZD()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}var Gle=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=Kle(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l?.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function Tc(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?cr(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(d,f)=>{if(d.isText)return;const h=Math.max(r,f),p=Math.min(i,f+d.nodeSize);a.push({node:d,from:h,to:p})});const l=i-r,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>ey(d.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((d,f)=>d+f.to-f.from,0)>=l}var Zle=(t,e={})=>({state:n,dispatch:r})=>{const i=cr(t,n.schema);return Tc(n,i,e)?poe(n,r):!1},Qle=()=>({state:t,dispatch:e})=>sD(t,e),Xle=t=>({state:e,dispatch:n})=>{const r=cr(t,e.schema);return _oe(r)(e,n)},Yle=()=>({state:t,dispatch:e})=>rD(t,e);function Hb(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function W3(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}var Jle=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=Hb(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=cr(t,r.schema)),a==="mark"&&(o=al(t,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&n.setNodeMarkup(u,void 0,W3(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(d=>{o===d.type&&n.addMark(u,u+c.nodeSize,o.create(W3(d.attrs,e)))})})}),!0):!1},ece=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),tce=()=>({tr:t,dispatch:e})=>{if(e){const n=new ss(t.doc);t.setSelection(n)}return!0},nce=()=>({state:t,dispatch:e})=>J5(t,e),rce=()=>({state:t,dispatch:e})=>nD(t,e),ice=()=>({state:t,dispatch:e})=>boe(t,e),sce=()=>({state:t,dispatch:e})=>xoe(t,e),oce=()=>({state:t,dispatch:e})=>voe(t,e);function L2(t,e,n={},r={}){return Np(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var ace=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(r.preserveWhitespace!=="full"){const c=L2(t,i.schema,r,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return o&&s.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:r,errorOnInvalidContent:e??i.options.enableContentCheck})};function QD(t,e){const n=al(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function Yk(t,e){const n=new K5(t);return e.forEach(r=>{r.steps.forEach(i=>{n.step(i)})}),n}function lce(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function cce(t,e){const n=[];return t.descendants((r,i)=>{e(r)&&n.push({node:r,pos:i})}),n}function XD(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(i,s)=>{n(i)&&r.push({node:i,pos:s})}),r}function uce(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Vb(t){return e=>uce(e.$from,t)}function gt(t,e,n){return t.config[e]===void 0&&t.parent?gt(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?gt(t.parent,e,n):null}):t.config[e]}function Jk(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},r=gt(e,"addExtensions",n);return r?[e,...Jk(r())]:e}).flat(10)}function eT(t,e){const n=qu.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}function YD(t){return typeof t=="function"}function gn(t,e=void 0,...n){return YD(t)?e?t.bind(e)(...n):t(...n):t}function dce(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Rp(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function JD(t){const e=[],{nodeExtensions:n,markExtensions:r}=Rp(t),i=[...n,...r],s={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=gt(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([f,h])=>{e.push({type:d,name:f,attribute:{...s,...h}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=gt(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const f={...s,...d};typeof f?.default=="function"&&(f.default=f.default()),f?.isRequired&&f?.default===void 0&&delete f.default,e.push({type:o.name,name:u,attribute:f})})}),e}function Gn(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(u=>!l.includes(u));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),a.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),r[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[i]=s}),r},{})}function Dp(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>Gn(n,r),{})}function fce(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function j3(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):fce(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function q3(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&dce(n)?!1:n!=null))}function hce(t,e){var n;const r=JD(t),{nodeExtensions:i,markExtensions:s}=Rp(t),o=(n=i.find(c=>gt(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(i.map(c=>{const u=r.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((y,b)=>{const E=gt(b,"extendNodeSchema",d);return{...y,...E?E(c):{}}},{}),h=q3({...f,content:gn(gt(c,"content",d)),marks:gn(gt(c,"marks",d)),group:gn(gt(c,"group",d)),inline:gn(gt(c,"inline",d)),atom:gn(gt(c,"atom",d)),selectable:gn(gt(c,"selectable",d)),draggable:gn(gt(c,"draggable",d)),code:gn(gt(c,"code",d)),whitespace:gn(gt(c,"whitespace",d)),linebreakReplacement:gn(gt(c,"linebreakReplacement",d)),defining:gn(gt(c,"defining",d)),isolating:gn(gt(c,"isolating",d)),attrs:Object.fromEntries(u.map(y=>{var b,E;return[y.name,{default:(b=y?.attribute)==null?void 0:b.default,validate:(E=y?.attribute)==null?void 0:E.validate}]}))}),p=gn(gt(c,"parseHTML",d));p&&(h.parseDOM=p.map(y=>j3(y,u)));const m=gt(c,"renderHTML",d);m&&(h.toDOM=y=>m({node:y,HTMLAttributes:Dp(y,u)}));const g=gt(c,"renderText",d);return g&&(h.toText=g),[c.name,h]})),l=Object.fromEntries(s.map(c=>{const u=r.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((g,y)=>{const b=gt(y,"extendMarkSchema",d);return{...g,...b?b(c):{}}},{}),h=q3({...f,inclusive:gn(gt(c,"inclusive",d)),excludes:gn(gt(c,"excludes",d)),group:gn(gt(c,"group",d)),spanning:gn(gt(c,"spanning",d)),code:gn(gt(c,"code",d)),attrs:Object.fromEntries(u.map(g=>{var y,b;return[g.name,{default:(y=g?.attribute)==null?void 0:y.default,validate:(b=g?.attribute)==null?void 0:b.validate}]}))}),p=gn(gt(c,"parseHTML",d));p&&(h.parseDOM=p.map(g=>j3(g,u)));const m=gt(c,"renderHTML",d);return m&&(h.toDOM=g=>m({mark:g,HTMLAttributes:Dp(g,u)})),[c.name,h]}));return new O5({topNode:o,nodes:a,marks:l})}function pce(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}function tT(t){return t.sort((n,r)=>{const i=gt(n,"priority")||100,s=gt(r,"priority")||100;return i>s?-1:i<s?1:0})}function eL(t){const e=tT(Jk(t)),n=pce(e.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}function tL(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,i,(l,c,u,d)=>{var f;l.isBlock&&c>r&&(a+=s);const h=o?.[l.type.name];if(h)return u&&(a+=h({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(f=l?.text)==null?void 0:f.slice(Math.max(r,c)-c,i-c))}),a}function mce(t,e){const n={from:0,to:t.content.size};return tL(t,n,e)}function nL(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function gce(t,e){const n=cr(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function rL(t,e){const n=Hb(typeof e=="string"?e:e.name,t.schema);return n==="node"?gce(t,e):n==="mark"?QD(t,e):{}}function yce(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function bce(t){const e=yce(t);return e.length===1?e:e.filter((n,r)=>!e.filter((s,o)=>o!==r).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function nT(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),f=e.invert().map(u);r.push({oldRange:{from:d,to:f},newRange:{from:c,to:u}})})}),bce(r)}function rT(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t),o=Xk(s,i.type);o&&r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{!i||i?.nodeSize===void 0||r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}var wce=(t,e,n,r=20)=>{const i=t.doc.resolve(n);let s=r,o=null;for(;s>0&&o===null;){const a=i.node(s);a?.type.name===e?o=a:s-=1}return[o,s]};function v1(t,e){return e.nodes[t]||e.marks[t]||null}function Dg(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}var vce=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)==null?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";n+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,r-s))}),n};function B2(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?al(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>ey(d.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:f})=>{const h=d.pos,p=f.pos;t.doc.nodesBetween(h,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(h,g),b=Math.min(p,g+m.nodeSize),E=b-y;o+=E,a.push(...m.marks.map(C=>({mark:C,from:y,to:b})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>ey(d.mark.attrs,n,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,f)=>d+f.to-f.from,0);return(l>0?l+c:l)>=o}function xce(t,e,n={}){if(!e)return Tc(t,null,n)||B2(t,null,n);const r=Hb(e,t.schema);return r==="node"?Tc(t,e,n):r==="mark"?B2(t,e,n):!1}var Sce=(t,e)=>{const{$from:n,$to:r,$anchor:i}=t.selection;if(e){const s=Vb(a=>a.type.name===e)(t.selection);if(!s)return!1;const o=t.doc.resolve(s.pos+1);return i.pos+1===o.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)},Ece=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function K3(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function G3(t,e){const{nodeExtensions:n}=Rp(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=gn(gt(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function Wb(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!=null?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(s=>{i!==!1&&(Wb(s,{ignoreWhitespace:n,checkChildren:e})||(i=!1))}),i}return!1}function iL(t){return t instanceof ut}function kce(t,e,n){var r;const{selection:i}=e;let s=null;if(jD(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!=null?r:s.marks();return s.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,f)=>{if(c)return!1;if(u.isInline){const h=!f||f.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(n));c=h&&p}return!c}),c})}var Tce=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=al(t,r.schema);if(i)if(o){const c=QD(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(u,d,(f,h)=>{const p=Math.max(h,u),m=Math.min(h+f.nodeSize,d);f.marks.find(y=>y.type===l)?f.marks.forEach(y=>{l===y.type&&n.addMark(p,m,l.create({...y.attrs,...e}))}):n.addMark(p,m,l.create(e))})});return kce(r,n,l)},_ce=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),Cce=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=cr(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>c3(s,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>c3(s,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Ace=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=cu(t,0,r.content.size),s=ut.create(r,i);e.setSelection(s)}return!0},Ice=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=Ct.atStart(r).from,a=Ct.atEnd(r).to,l=cu(i,o,a),c=cu(s,o,a),u=Ct.create(r,l,c);e.setSelection(u)}return!0},Pce=t=>({state:e,dispatch:n})=>{const r=cr(t,e.schema);return Ioe(r)(e,n)};function Z3(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(r)}}var Oce=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=Dg(c,a.node().type.name,a.node().attrs);if(s instanceof ut&&s.node.isBlock)return!a.parentOffset||!Ua(o,a.pos)?!1:(r&&(t&&Z3(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:lce(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=d&&f?[{type:f,attrs:u}]:void 0,p=Ua(e.doc,e.mapping.map(a.pos),1,h);if(!h&&!p&&Ua(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(p=!0,h=f?[{type:f,attrs:u}]:void 0),r){if(p&&(s instanceof Ct&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,h),f&&!d&&!a.parentOffset&&a.parent.type!==f)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}t&&Z3(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},Mce=(t,e={})=>({tr:n,state:r,dispatch:i,editor:s})=>{var o;const a=cr(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const f=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=De.empty;const b=l.index(-1)?1:l.index(-2)?2:3;for(let T=l.depth-b;T>=l.depth-3;T-=1)y=De.from(l.node(T).copy(y));const E=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,C={...Dg(f,l.node().type.name,l.node().attrs),...e},I=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(C))||void 0;y=y.append(De.from(a.createAndFill(null,I)||void 0));const x=l.before(l.depth-(b-1));n.replace(x,l.after(-E),new nt(y,4-b,0));let P=-1;n.doc.nodesBetween(x,n.doc.content.size,(T,S)=>{if(P>-1)return!1;T.isTextblock&&T.content.size===0&&(P=S+1)}),P>-1&&n.setSelection(Ct.near(n.doc.resolve(P))),n.scrollIntoView()}return!0}const h=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...Dg(f,d.type.name,d.attrs),...e},m={...Dg(f,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const g=h?[{type:a,attrs:p},{type:h,attrs:m}]:[{type:a,attrs:p}];if(!Ua(n.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:b}=r,{splittableMarks:E}=s.extensionManager,C=b||y.$to.parentOffset&&y.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!C||!i)return!0;const I=C.filter(x=>E.includes(x.type.name));n.ensureMarks(I)}return!0},x1=(t,e)=>{const n=Vb(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&Lc(t.doc,n.pos)&&t.join(n.pos),!0},S1=(t,e)=>{const n=Vb(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&Lc(t.doc,r)&&t.join(r),!0},Nce=(t,e,n,r={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:f}=i.extensionManager,h=cr(t,o.schema),p=cr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:b}=m,E=y.blockRange(b),C=g||m.$to.parentOffset&&m.$from.marks();if(!E)return!1;const I=Vb(x=>G3(x.type.name,d))(m);if(E.depth>=1&&I&&E.depth-I.depth<=1){if(I.node.type===h)return c.liftListItem(p);if(G3(I.node.type.name,d)&&h.validContent(I.node.content)&&a)return l().command(()=>(s.setNodeMarkup(I.pos,h),!0)).command(()=>x1(s,h)).command(()=>S1(s,h)).run()}return!n||!C||!a?l().command(()=>u().wrapInList(h,r)?!0:c.clearNodes()).wrapInList(h,r).command(()=>x1(s,h)).command(()=>S1(s,h)).run():l().command(()=>{const x=u().wrapInList(h,r),P=C.filter(T=>f.includes(T.type.name));return s.ensureMarks(P),x?!0:c.clearNodes()}).wrapInList(h,r).command(()=>x1(s,h)).command(()=>S1(s,h)).run()},Rce=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=al(t,r.schema);return B2(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},Dce=(t,e,n={})=>({state:r,commands:i})=>{const s=cr(t,r.schema),o=cr(e,r.schema),a=Tc(r,s,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...n})},Lce=(t,e={})=>({state:n,commands:r})=>{const i=cr(t,n.schema);return Tc(n,i,e)?r.lift(i):r.wrapIn(i,e)},Bce=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},Fce=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},$ce=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=al(t,r.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:f,to:h}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=Xk(c,l,p);m&&(f=m.from,h=m.to),n.removeMark(f,h,l)}else d.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,l)});return n.removeStoredMark(l),!0},zce=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=Hb(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=cr(t,r.schema)),a==="mark"&&(o=al(t,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let d,f,h,p;n.selection.empty?r.doc.nodesBetween(c,u,(m,g)=>{s&&s===m.type&&(h=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,f=m)}):r.doc.nodesBetween(c,u,(m,g)=>{g<c&&s&&s===m.type&&(h=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,f=m),g>=c&&g<=u&&(s&&s===m.type&&n.setNodeMarkup(g,void 0,{...m.attrs,...e}),o&&m.marks.length&&m.marks.forEach(y=>{if(o===y.type){const b=Math.max(g,c),E=Math.min(g+m.nodeSize,u);n.addMark(b,E,o.create({...y.attrs,...e}))}}))}),f&&(d!==void 0&&n.setNodeMarkup(d,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(m=>{o===m.type&&n.addMark(h,p,o.create({...m.attrs,...e}))}))}),!0):!1},Uce=(t,e={})=>({state:n,dispatch:r})=>{const i=cr(t,n.schema);return Soe(i,e)(n,r)},Hce=(t,e={})=>({state:n,dispatch:r})=>{const i=cr(t,n.schema);return Eoe(i,e)(n,r)},Vce=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(r=>r.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(r=>r!==e):delete this.callbacks[t]),this}once(t,e){const n=(...r)=>{this.off(t,n),e.apply(this,r)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},jb=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},Wce=(t,e)=>{if(Qk(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function sg(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const d=vce(c)+s;return o.forEach(f=>{if(u)return;const h=Wce(d,f.find);if(!h)return;const p=l.state.tr,m=$b({state:l.state,transaction:p}),g={from:r-(h[0].length-s.length),to:i},{commands:y,chain:b,can:E}=new zb({editor:n,state:m});f.handler({state:m,range:g,match:h,commands:y,chain:b,can:E})===null||!p.steps.length||(f.undoable&&p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function jce(t){const{editor:e,rules:n}=t,r=new un({state:{init(){return null},apply(i,s,o){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=eT(De.from(u),o.schema);const{from:d}=l,f=d+u.length;sg({editor:e,from:d,to:f,text:u,rules:n,plugin:r})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return sg({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&sg({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?sg({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function qce(t){return Object.prototype.toString.call(t).slice(8,-1)}function og(t){return qce(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function sL(t,e){const n={...t};return og(t)&&og(e)&&Object.keys(e).forEach(r=>{og(e[r])&&og(t[r])?n[r]=sL(t[r],e[r]):n[r]=e[r]}),n}var iT=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...gn(gt(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...gn(gt(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>sL(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Ku=class oL extends iT{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new oL(n)}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===n.name))return!1;const l=o.find(c=>c?.type.name===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function Kce(t){return typeof t=="number"}var Gce=class{constructor(t){this.find=t.find,this.handler=t.handler}},Zce=(t,e,n)=>{if(Qk(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(i=>{const s=[i.text];return s.index=i.index,s.input=t,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function Qce(t){const{editor:e,state:n,from:r,to:i,rule:s,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new zb({editor:e,state:n}),d=[];return n.doc.nodesBetween(r,i,(h,p)=>{var m,g,y,b,E;if((g=(m=h.type)==null?void 0:m.spec)!=null&&g.code||!(h.isText||h.isTextblock||h.isInline))return;const C=(E=(b=(y=h.content)==null?void 0:y.size)!=null?b:h.nodeSize)!=null?E:0,I=Math.max(r,p),x=Math.min(i,p+C);if(I>=x)return;const P=h.isText?h.text||"":h.textBetween(I-p,x-p,void 0,"ï¿¼");Zce(P,s.find,o).forEach(S=>{if(S.index===void 0)return;const _=I+S.index+1,O=_+S[0].length,F={from:n.tr.mapping.map(_),to:n.tr.mapping.map(O)},L=s.handler({state:n,range:F,match:S,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(L)})}),d.every(h=>h!==null)}var ag=null,Xce=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function Yce(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:f,rule:h,pasteEvt:p})=>{const m=u.tr,g=$b({state:u,transaction:m});if(!(!Qce({editor:e,state:g,from:Math.max(d-1,0),to:f.b-1,rule:h,pasteEvent:p,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return n.map(u=>new un({view(d){const f=p=>{var m;r=(m=d.dom.parentElement)!=null&&m.contains(p.target)?d.dom.parentElement:null,r&&(ag=e)},h=()=>{ag&&(ag=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",h),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",h)}}},props:{handleDOMEvents:{drop:(d,f)=>{if(s=r===d.dom.parentElement,a=f,!s){const h=ag;h?.isEditable&&setTimeout(()=>{const p=h.state.selection;p&&h.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,f)=>{var h;const p=(h=f.clipboardData)==null?void 0:h.getData("text/html");return o=f,i=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(d,f,h)=>{const p=d[0],m=p.getMeta("uiEvent")==="paste"&&!i,g=p.getMeta("uiEvent")==="drop"&&!s,y=p.getMeta("applyPasteRules"),b=!!y;if(!m&&!g&&!b)return;if(b){let{text:I}=y;typeof I=="string"?I=I:I=eT(De.from(I),h.schema);const{from:x}=y,P=x+I.length,T=Xce(I);return l({rule:u,state:h,from:x,to:{b:P},pasteEvt:T})}const E=f.doc.content.findDiffStart(h.doc.content),C=f.doc.content.findDiffEnd(h.doc.content);if(!(!Kce(E)||!C||E===C.b))return l({rule:u,state:h,from:E,to:C,pasteEvt:o})}}))}var qb=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=eL(t),this.schema=hce(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:v1(e.name,this.schema)},r=gt(e,"addCommands",n);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this;return tT([...this.extensions].reverse()).flatMap(r=>{const i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:v1(r.name,this.schema)},s=[],o=gt(r,"addKeyboardShortcuts",i);let a={};if(r.type==="mark"&&gt(r,"exitable",i)&&(a.ArrowRight=()=>Ku.handleExit({editor:t,mark:r})),o){const f=Object.fromEntries(Object.entries(o()).map(([h,p])=>[h,()=>p({editor:t})]));a={...a,...f}}const l=yle(a);s.push(l);const c=gt(r,"addInputRules",i);if(K3(r,t.options.enableInputRules)&&c){const f=c();if(f&&f.length){const h=jce({editor:t,rules:f}),p=Array.isArray(h)?h:[h];s.push(...p)}}const u=gt(r,"addPasteRules",i);if(K3(r,t.options.enablePasteRules)&&u){const f=u();if(f&&f.length){const h=Yce({editor:t,rules:f});s.push(...h)}}const d=gt(r,"addProseMirrorPlugins",i);if(d){const f=d();s.push(...f)}return s})}get attributes(){return JD(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Rp(this.extensions);return Object.fromEntries(e.filter(n=>!!gt(n,"addNodeView")).map(n=>{const r=this.attributes.filter(l=>l.type===n.name),i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:cr(n.name,this.schema)},s=gt(n,"addNodeView",i);if(!s)return[];const o=s();if(!o)return[];const a=(l,c,u,d,f)=>{const h=Dp(l,r);return o({node:l,view:c,getPos:u,decorations:d,innerDecorations:f,editor:t,extension:n,HTMLAttributes:h})};return[n.name,a]}))}get markViews(){const{editor:t}=this,{markExtensions:e}=Rp(this.extensions);return Object.fromEntries(e.filter(n=>!!gt(n,"addMarkView")).map(n=>{const r=this.attributes.filter(a=>a.type===n.name),i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:al(n.name,this.schema)},s=gt(n,"addMarkView",i);if(!s)return[];const o=(a,l,c)=>{const u=Dp(a,r);return s()({mark:a,view:l,inline:c,editor:t,extension:n,HTMLAttributes:u,updateAttributes:d=>{hue(a,t,d)}})};return[n.name,o]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:v1(e.name,this.schema)};e.type==="mark"&&((n=gn(gt(e,"keepOnSplit",r)))==null||n)&&this.splittableMarks.push(e.name);const i=gt(e,"onBeforeCreate",r),s=gt(e,"onCreate",r),o=gt(e,"onUpdate",r),a=gt(e,"onSelectionUpdate",r),l=gt(e,"onTransaction",r),c=gt(e,"onFocus",r),u=gt(e,"onBlur",r),d=gt(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};qb.resolve=eL;qb.sort=tT;qb.flatten=Jk;var Jce={};Zk(Jce,{ClipboardTextSerializer:()=>lL,Commands:()=>cL,Delete:()=>uL,Drop:()=>dL,Editable:()=>fL,FocusEvents:()=>pL,Keymap:()=>mL,Paste:()=>gL,Tabindex:()=>yL,focusEventsPluginKey:()=>hL});var In=class aL extends iT{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new aL(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},lL=In.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new un({key:new An("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=nL(n);return tL(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),cL=In.create({name:"commands",addCommands(){return{...VD}}}),uL=In.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=Yk(t.before,[t,...e]);nT(u).forEach(h=>{u.mapping.mapResult(h.oldRange.from).deletedAfter&&u.mapping.mapResult(h.oldRange.to).deletedBefore&&u.before.nodesBetween(h.oldRange.from,h.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=h.oldRange.from<=m&&g<=h.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:h.oldRange,newRange:h.newRange,partial:!y,editor:this.editor,transaction:t,combinedTransform:u})})});const f=u.mapping;u.steps.forEach((h,p)=>{var m,g;if(h instanceof Qs){const y=f.slice(p).map(h.from,-1),b=f.slice(p).map(h.to),E=f.invert().map(y,-1),C=f.invert().map(b),I=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(P=>P.eq(h.mark)),x=(g=u.doc.nodeAt(b))==null?void 0:g.marks.some(P=>P.eq(h.mark));this.editor.emit("delete",{type:"mark",mark:h.mark,from:h.from,to:h.to,deletedRange:{from:E,to:C},newRange:{from:y,to:b},partial:!!(x||I),editor:this.editor,transaction:t,combinedTransform:u})}})};(i=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||i?setTimeout(s,0):s()}}),dL=In.create({name:"drop",addProseMirrorPlugins(){return[new un({key:new An("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),fL=In.create({name:"editable",addProseMirrorPlugins(){return[new un({key:new An("editable"),props:{editable:()=>this.editor.options.editable}})]}}),hL=new An("focusEvents"),pL=In.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new un({key:hL,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),mL=In.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:f,parent:h}=d,p=d.parent.isTextblock&&f>0?a.doc.resolve(f-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:zt.atStart(c).from===f;return!u||!h.type.isTextblock||h.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ub()||ZD()?s:i},addProseMirrorPlugins(){return[new un({key:new An("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(m=>m.getMeta("composition")))return;const r=t.some(m=>m.docChanged)&&!e.doc.eq(n.doc),i=t.some(m=>m.getMeta("preventClearDocument"));if(!r||i)return;const{empty:s,from:o,to:a}=e.selection,l=zt.atStart(e.doc).from,c=zt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!Wb(n.doc))return;const f=n.tr,h=$b({state:n,transaction:f}),{commands:p}=new zb({editor:this.editor,state:h});if(p.clearNodes(),!!f.steps.length)return f}})]}}),gL=In.create({name:"paste",addProseMirrorPlugins(){return[new un({key:new An("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),yL=In.create({name:"tabindex",addProseMirrorPlugins(){return[new un({key:new An("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),eue=class wd{constructor(e,n,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You canât set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new wd(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new wd(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new wd(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const i=n.isBlock&&!n.isTextblock,s=n.isAtom&&!n.isText,o=this.pos+r+(s?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new wd(a,this.editor,i,i?n:null);i&&(l.actualDepth=this.depth+1),e.push(new wd(a,this.editor,i,i?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(n).length>0){const s=i.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==n[l])break}}else r=i;i=i.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(n);return this.children.forEach(o=>{r&&i.length>0||(o.node.type.name===e&&s.every(l=>n[l]===o.node.attrs[l])&&i.push(o),!(r&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,n,r))))}),i}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},tue=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function nue(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var rue=class extends Vce{constructor(e={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:i})=>{throw i},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:i,slice:s,moved:o})=>this.options.onDrop(i,s,o)),this.on("paste",({event:i,slice:s})=>this.options.onPaste(i,s)),this.on("delete",this.options.onDelete);const n=this.createDoc(),r=qD(n,this.options.autofocus);this.editorState=Ad.create({doc:n,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(e){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(e),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const e=this.editorView.dom;e?.editor&&delete e.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(e){console.warn("Failed to remove CSS element:",e)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=nue(tue,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:e=>{this.editorState=e},dispatch:e=>{this.dispatchTransaction(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(e,n)=>{if(this.editorView)return this.editorView[n];if(n==="state")return this.editorState;if(n in e)return Reflect.get(e,n);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${n}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(e,n){const r=YD(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,n;const i=[...this.options.enableCoreExtensions?[fL,lL.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)==null?void 0:e.clipboardTextSerializer)==null?void 0:n.blockSeparator}),cL,pL,mL,yL,dL,gL,uL].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s?.type));this.extensionManager=new qb(i,this)}createCommandManager(){this.commandManager=new zb({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let e;try{e=L2(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(n){if(!(n instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(n.message))throw n;this.emit("contentError",{editor:this,error:n,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),e=L2(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return e}createView(e){var n;this.editorView=new UD(e,{...this.options.editorProps,attributes:{role:"textbox",...(n=this.options.editorProps)==null?void 0:n.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.prependClass(),this.injectCSS();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(u=>{var d;return(d=this.capturedTransaction)==null?void 0:d.step(u)});return}const{state:n,transactions:r}=this.state.applyTransaction(e),i=!this.state.selection.eq(n.selection),s=r.includes(e),o=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),!s)return;this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e,appendedTransactions:r.slice(1)}),i&&this.emit("selectionUpdate",{editor:this,transaction:e});const a=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),l=a?.getMeta("focus"),c=a?.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:a}),c&&this.emit("blur",{editor:this,event:c.event,transaction:a}),!(e.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||o.doc.eq(n.doc))&&this.emit("update",{editor:this,transaction:e,appendedTransactions:r.slice(1)})}getAttributes(e){return rL(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return xce(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return eT(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return mce(this.state.doc,{blockSeparator:n,textSerializers:{...nL(this.schema),...r}})}get isEmpty(){return Wb(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var e,n;return(n=(e=this.editorView)==null?void 0:e.isDestroyed)!=null?n:!0}$node(e,n){var r;return((r=this.$doc)==null?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new eue(n,this)}get $doc(){return this.$pos(0)}};function vf(t){return new jb({find:t.find,handler:({state:e,range:n,match:r})=>{const i=gn(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(rT(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(m=>m===t.type&&m!==h.mark.type)).filter(h=>h.to>c).length)return null;u<n.to&&s.delete(u,n.to),c>n.from&&s.delete(n.from+l,c);const f=n.from+l+o.length;s.addMark(n.from+l,f,t.type.create(i||{})),s.removeStoredMark(t.type)}},undoable:t.undoable})}function bL(t){return new jb({find:t.find,handler:({state:e,range:n,match:r})=>{const i=gn(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;const l=t.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const d=r[0][r[0].length-1];s.insertText(d,o+r[0].length-1),s.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;s.insert(c,t.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()},undoable:t.undoable})}function F2(t){return new jb({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=gn(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)},undoable:t.undoable})}function xf(t){return new jb({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const s=gn(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&Nk(l,t.type,s);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:f}=e,{splittableMarks:h}=t.editor.extensionManager,p=f||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(g=>h.includes(g.type.name));o.ensureMarks(m)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(d,s).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&Lc(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)},undoable:t.undoable})}var iue=t=>"touches"in t,sue=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.handleMouseMove=o=>{if(!this.isResizing||!this.activeHandle)return;const a=o.clientX-this.startX,l=o.clientY-this.startY;this.handleResize(a,l)},this.handleTouchMove=o=>{if(!this.isResizing||!this.activeHandle)return;const a=o.touches[0];if(!a)return;const l=a.clientX-this.startX,c=a.clientY-this.startY;this.handleResize(l,c)},this.handleMouseUp=()=>{if(!this.isResizing)return;const o=this.element.offsetWidth,a=this.element.offsetHeight;this.onCommit(o,a),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=o=>{o.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=o=>{o.key==="Shift"&&(this.isShiftKeyPressed=!1)};var e,n,r,i,s;this.node=t.node,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(e=t.options)!=null&&e.min&&(this.minSize={...this.minSize,...t.options.min}),(n=t.options)!=null&&n.max&&(this.maxSize=t.options.max),(r=t?.options)!=null&&r.directions&&(this.directions=t.options.directions),(i=t.options)!=null&&i.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(s=t.options)!=null&&s.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles()}get dom(){return this.container}get contentDOM(){return this.contentElement}update(t,e,n){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,e,n):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",t.style.justifyContent="flex-start",t.style.alignItems="flex-start",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const e=document.createElement("div");return e.dataset.resizeHandle=t,e.style.position="absolute",this.classNames.handle&&(e.className=this.classNames.handle),e}positionHandle(t,e){const n=e.includes("top"),r=e.includes("bottom"),i=e.includes("left"),s=e.includes("right");n&&(t.style.top="0"),r&&(t.style.bottom="0"),i&&(t.style.left="0"),s&&(t.style.right="0"),(e==="top"||e==="bottom")&&(t.style.left="0",t.style.right="0"),(e==="left"||e==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{const e=this.createHandle(t);this.positionHandle(e,t),e.addEventListener("mousedown",n=>this.handleResizeStart(n,t)),e.addEventListener("touchstart",n=>this.handleResizeStart(n,t)),this.wrapper.appendChild(e)})}applyInitialSize(){const t=this.node.attrs.width,e=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,e?(this.element.style.height=`${e}px`,this.initialHeight=e):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=e,iue(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,e){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:r,height:i}=this.calculateNewDimensions(this.activeHandle,t,e),s=this.applyConstraints(r,i,n);this.element.style.width=`${s.width}px`,this.element.style.height=`${s.height}px`,this.onResize&&this.onResize(s.width,s.height)}calculateNewDimensions(t,e,n){let r=this.startWidth,i=this.startHeight;const s=t.includes("right"),o=t.includes("left"),a=t.includes("bottom"),l=t.includes("top");return s?r=this.startWidth+e:o&&(r=this.startWidth-e),a?i=this.startHeight+n:l&&(i=this.startHeight-n),(t==="right"||t==="left")&&(r=this.startWidth+(s?e:-e)),(t==="top"||t==="bottom")&&(i=this.startHeight+(a?n:-n)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(r,i,t):{width:r,height:i}}applyConstraints(t,e,n){var r,i,s,o;if(!n){let c=Math.max(this.minSize.width,t),u=Math.max(this.minSize.height,e);return(r=this.maxSize)!=null&&r.width&&(c=Math.min(this.maxSize.width,c)),(i=this.maxSize)!=null&&i.height&&(u=Math.min(this.maxSize.height,u)),{width:c,height:u}}let a=t,l=e;return a<this.minSize.width&&(a=this.minSize.width,l=a/this.aspectRatio),l<this.minSize.height&&(l=this.minSize.height,a=l*this.aspectRatio),(s=this.maxSize)!=null&&s.width&&a>this.maxSize.width&&(a=this.maxSize.width,l=a/this.aspectRatio),(o=this.maxSize)!=null&&o.height&&l>this.maxSize.height&&(l=this.maxSize.height,a=l*this.aspectRatio),{width:a,height:l}}applyAspectRatio(t,e,n){const r=n==="left"||n==="right",i=n==="top"||n==="bottom";return r?{width:t,height:t/this.aspectRatio}:i?{width:e*this.aspectRatio,height:e}:{width:t,height:t/this.aspectRatio}}};function oue(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof ut){const s=r.index();return r.parent.canReplaceWith(s,s+1,e)}let i=r.depth;for(;i>=0;){const s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}var aue={};Zk(aue,{createAtomBlockMarkdownSpec:()=>lue,createBlockMarkdownSpec:()=>cue,createInlineMarkdownSpec:()=>fue,parseAttributes:()=>sT,parseIndentedBlocks:()=>$2,renderNestedMarkdownContent:()=>aT,serializeAttributes:()=>oT});function sT(t){if(!t?.trim())return{};const e={},n=[],r=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),i=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(o)).forEach(([,c,u])=>{var d;const f=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),h=n[f];h&&(e[c]=h.slice(1,-1))});const l=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function oT(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?e.push(n):r!==!1&&r!=null&&e.push(`${n}="${String(r)}"`))}),e.join(" ")}function lue(t){const{nodeName:e,name:n,parseAttributes:r=sT,serializeAttributes:i=oT,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=t,l=n||e,c=u=>{if(!a)return u;const d={};return a.forEach(f=>{f in u&&(d[f]=u[f])}),d};return{parseMarkdown:(u,d)=>{const f={...s,...u.attributes};return d.createNode(e,f,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const f=new RegExp(`^:::${l}(?:\\s|$)`,"m"),h=(d=u.match(f))==null?void 0:d.index;return h!==void 0?h:-1},tokenize(u,d,f){const h=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(h);if(!p)return;const m=p[1]||"",g=r(m);if(!o.find(b=>!(b in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),f=i(d),h=f?` {${f}}`:"";return`:::${l}${h} :::`}}}function cue(t){const{nodeName:e,name:n,getContent:r,parseAttributes:i=sT,serializeAttributes:s=oT,defaultAttributes:o={},content:a="block",allowedAttributes:l}=t,c=n||e,u=d=>{if(!l)return d;const f={};return l.forEach(h=>{h in d&&(f[h]=d[h])}),f};return{parseMarkdown:(d,f)=>{let h;if(r){const m=r(d);h=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?h=f.parseChildren(d.tokens||[]):h=f.parseInline(d.tokens||[]);const p={...o,...d.attributes};return f.createNode(e,p,h)},markdownTokenizer:{name:e,level:"block",start(d){var f;const h=new RegExp(`^:::${c}`,"m"),p=(f=d.match(h))==null?void 0:f.index;return p!==void 0?p:-1},tokenize(d,f,h){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,b=""]=g,E=i(b);let C=1;const I=y.length;let x="";const P=/^:::([\w-]*)(\s.*)?/gm,T=d.slice(I);for(P.lastIndex=0;;){const S=P.exec(T);if(S===null)break;const _=S.index,O=S[1];if(!((p=S[2])!=null&&p.endsWith(":::"))){if(O)C+=1;else if(C-=1,C===0){const F=T.slice(0,_);x=F.trim();const L=d.slice(0,I+_+S[0].length);let B=[];if(x)if(a==="block")for(B=h.blockTokens(F),B.forEach(N=>{N.text&&(!N.tokens||N.tokens.length===0)&&(N.tokens=h.inlineTokens(N.text))});B.length>0;){const N=B[B.length-1];if(N.type==="paragraph"&&(!N.text||N.text.trim()===""))B.pop();else break}else B=h.inlineTokens(x);return{type:e,raw:L,attributes:E,content:x,tokens:B}}}}}},renderMarkdown:(d,f)=>{const h=u(d.attrs||{}),p=s(h),m=p?` {${p}}`:"",g=f.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function uue(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(t);for(;r!==null;){const[,i,s,o]=r;e[i]=s||o,r=n.exec(t)}return e}function due(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function fue(t){const{nodeName:e,name:n,getContent:r,parseAttributes:i=uue,serializeAttributes:s=due,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=t,c=n||e,u=f=>{if(!l)return f;const h={};return l.forEach(p=>{p in f&&(h[p]=f[p])}),h},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(f,h)=>{const p={...o,...f.attributes};if(a)return h.createNode(e,p);const m=r?r(f):f.content||"";return m?h.createNode(e,p,[h.createTextNode(m)]):h.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(f){const h=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=f.match(h),m=p?.index;return m!==void 0?m:-1},tokenize(f,h,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=f.match(m);if(!g)return;let y="",b="";if(a){const[,C]=g;b=C}else{const[,C,I]=g;b=C,y=I||""}const E=i(b.trim());return{type:e,raw:g[0],content:y.trim(),attributes:E}}},renderMarkdown:f=>{let h="";r?h=r(f):f.content&&f.content.length>0&&(h=f.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(f.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${h}[/${c}]`}}}function $2(t,e,n){var r,i,s,o;const a=t.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const f=a[u],h=f.match(e.itemPattern);if(!h){if(l.length>0)break;if(f.trim()===""){u+=1;continue}else return}const p=e.extractItemData(h),{indentLevel:m,mainContent:g}=p;c=`${c}${f}
`;const y=[g];for(u+=1;u<a.length;){const I=a[u];if(I.trim()===""){const P=a.slice(u+1).findIndex(_=>_.trim()!=="");if(P===-1)break;if((((i=(r=a[u+1+P].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:i.length)||0)>m){y.push(I),c=`${c}${I}
`,u+=1;continue}else break}if((((o=(s=I.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(I),c=`${c}${I}
`,u+=1;else break}let b;const E=y.slice(1);if(E.length>0){const I=E.map(x=>x.slice(m+d)).join(`
`);I.trim()&&(e.customNestedParser?b=e.customNestedParser(I):b=n.blockTokens(I))}const C=e.createToken(p,b);l.push(C)}if(l.length!==0)return{items:l,raw:c.trim()}}function aT(t,e,n,r){if(!t||!Array.isArray(t.content))return"";const i=typeof n=="function"?n(r):n,[s,...o]=t.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(f=>f?e.indent(f):"").join(`
`);l.push(d)}}),l.join(`
`)}function hue(t,e,n={}){const{state:r}=e,{doc:i,tr:s}=r,o=t;i.descendants((a,l)=>{const c=s.mapping.map(l),u=s.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(h=>{if(h!==o)return!1;d=h}),!d)return;let f=!1;if(Object.keys(n).forEach(h=>{n[h]!==d.attrs[h]&&(f=!0)}),f){const h=t.type.create({...t.attrs,...n});s.removeMark(c,u,t.type),s.addMark(c,u,h)}}),s.docChanged&&e.view.dispatch(s)}var Ci=class wL extends iT{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new wL(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},pue=class{constructor(t,e,n){this.isDragging=!1,this.component=t,this.editor=e.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=e.extension,this.node=e.node,this.decorations=e.decorations,this.innerDecorations=e.innerDecorations,this.view=e.view,this.HTMLAttributes=e.HTMLAttributes,this.getPos=e.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(t){var e,n,r,i,s,o,a;const{view:l}=this.editor,c=t.target,u=c.nodeType===3?(e=c.parentElement)==null?void 0:e.closest("[data-drag-handle]"):c.closest("[data-drag-handle]");if(!this.dom||(n=this.contentDOM)!=null&&n.contains(c)||!u)return;let d=0,f=0;if(this.dom!==u){const b=this.dom.getBoundingClientRect(),E=u.getBoundingClientRect(),C=(i=t.offsetX)!=null?i:(r=t.nativeEvent)==null?void 0:r.offsetX,I=(o=t.offsetY)!=null?o:(s=t.nativeEvent)==null?void 0:s.offsetY;d=E.x-b.x+C,f=E.y-b.y+I}const h=this.dom.cloneNode(!0);try{const b=this.dom.getBoundingClientRect();h.style.width=`${Math.round(b.width)}px`,h.style.height=`${Math.round(b.height)}px`,h.style.boxSizing="border-box",h.style.pointerEvents="none"}catch{}let p=null;try{p=document.createElement("div"),p.style.position="absolute",p.style.top="-9999px",p.style.left="-9999px",p.style.pointerEvents="none",p.appendChild(h),document.body.appendChild(p),(a=t.dataTransfer)==null||a.setDragImage(h,d,f)}finally{p&&setTimeout(()=>{try{p?.remove()}catch{}},0)}const m=this.getPos();if(typeof m!="number")return;const g=ut.create(l.state.doc,m),y=l.state.tr.setSelection(g);l.dispatch(y)}stopEvent(t){var e;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:t});const n=t.target;if(!(this.dom.contains(n)&&!((e=this.contentDOM)!=null&&e.contains(n))))return!1;const i=t.type.startsWith("drag"),s=t.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable)&&!s&&!i)return!0;const{isEditable:a}=this.editor,{isDragging:l}=this,c=!!this.node.type.spec.draggable,u=ut.isSelectable(this.node),d=t.type==="copy",f=t.type==="paste",h=t.type==="cut",p=t.type==="mousedown";if(!c&&u&&i&&t.target===this.dom&&t.preventDefault(),c&&i&&!l&&t.target===this.dom)return t.preventDefault(),!1;if(c&&a&&!l&&p){const m=n.closest("[data-drag-handle]");m&&(this.dom===m||this.dom.contains(m))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(l||s||d||f||h||p&&u)}ignoreMutation(t){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:t}):this.node.isLeaf||this.node.isAtom?!0:t.type==="selection"||this.dom.contains(t.target)&&t.type==="childList"&&(Ub()||KD())&&this.editor.isFocused&&[...Array.from(t.addedNodes),...Array.from(t.removedNodes)].every(n=>n.isContentEditable)?!1:this.contentDOM===t.target&&t.type==="attributes"?!0:!this.contentDOM.contains(t.target)}updateAttributes(t){this.editor.commands.command(({tr:e})=>{const n=this.getPos();return typeof n!="number"?!1:(e.setNodeMarkup(n,void 0,{...this.node.attrs,...t}),!0)})}deleteNode(){const t=this.getPos();if(typeof t!="number")return;const e=t+this.node.nodeSize;this.editor.commands.deleteRange({from:t,to:e})}};function $u(t){return new Gce({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:i})=>{const s=gn(t.getAttributes,void 0,r,i);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),f=d+a.length;if(rT(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===t.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;f<n.to&&o.delete(f,n.to),d>n.from&&o.delete(n.from+u,d),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}class mue extends rue{contentElement=null}const gue=t=>{const e=new mue(t);return u4(e,n=>(e.on("transaction",()=>{n(e)}),()=>{e.destroy()}))};class yue{component;props;dom;constructor(e,{element:n,props:r}){this.component=e,this.props=r,this.dom=n,this.dom.classList.add("svelte-renderer")}updateProps(e){Object.assign(this.props,e)}updateAttributes(e){Object.keys(e).forEach(n=>{this.dom.setAttribute(n,e[n])})}destroy(){e4(this.component)}}const vL="TipTapNodeView",bue=(t,e)=>{if(!t)throw new Error(e)};class wue extends pue{mount(){const e=this.component,n=Nt({editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(a={})=>this.updateAttributes(a),deleteNode:()=>this.deleteNode()});this.contentDOMElement=this.node.isLeaf?null:document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");const r=this.options.context||new RM;r.set(vL,{onDragStart:this.onDragStart.bind(this)});const i=this.options.as??(this.node.isInline?"span":"div"),s=document.createElement(i);s.classList.add(`node-${this.node.type.name}`),this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate);const o=PS(e,{target:s,props:n,context:r});this.renderer=new yue(o,{element:s,props:n}),this.appendContendDom(),this.updateElementAttributes()}appendContendDom(){const e=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&e&&!e.contains(this.contentDOMElement)&&e.appendChild(this.contentDOMElement)}get dom(){return bue(this.renderer.dom.firstElementChild?.hasAttribute("data-node-view-wrapper"),"Please use the NodeViewWrapper component for your node view."),this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection,r=this.getPos();if(typeof r=="number")if(e<=r&&n>=r+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n,r){const i=s=>{this.renderer.updateProps(s),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(typeof this.options.update=="function"){const s=this.node,o=this.decorations,a=this.innerDecorations;return this.node=e,this.decorations=n,this.innerDecorations=r,this.options.update({oldNode:s,oldDecorations:o,oldInnerDecorations:a,newNode:e,newDecorations:n,newInnerDecorations:r,updateProps:()=>i({node:e,decorations:n,innerDecorations:r})})}return e.type!==this.node.type?!1:(e===this.node&&this.decorations===n&&this.innerDecorations===r||(this.node=e,this.decorations=n,this.innerDecorations=r,i({node:e,decorations:n,innerDecorations:r})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.dom.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.dom.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const n=this.editor.extensionManager.attributes,r=Dp(this.node,n);e=this.options.attrs({node:this.node,HTMLAttributes:r})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}const xL=(t,e)=>n=>new wue(t,n,e);var vue=_e("<div></div> <!>",1);function xue(t,e){St(e,!0);const n=le(e,"editor",7);let r;us(async()=>{await qa(),r&&n()?.options.element&&(n().contentElement||(r.append(...Array.from(n().options.element?.childNodes||[])),n().setOptions({element:r}),n().contentElement=r))}),_u(()=>{if(!n()||(n().contentElement=null,!n().options.element?.firstChild))return;const c=document.createElement("div");c.append(...Array.from(n().options.element?.childNodes||[])),n().setOptions({element:c})});var s=vue(),o=Te(s);pr(o,c=>r=c,()=>r);var a=ve(o,2);{var l=c=>{var u=Fe(),d=Te(u);Tt(d,()=>e.children),X(c,u)};$e(a,c=>{e.children&&c(l)})}je(()=>eo(o,1,i4(e.class))),X(t,s),Et()}function SL(t,e){St(e,!0);const n=le(e,"as",3,"div"),r=_i(e,["$$slots","$$events","$$legacy","as","children"]),{onDragStart:i}=rx(vL);let s;us(async()=>{await qa(),s.style.whiteSpace="normal"});var o=Fe(),a=Te(o);AU(a,n,!1,(l,c)=>{pr(l,h=>s=h,()=>s),wr(l,()=>({"data-node-view-wrapper":"",role:"none",...r,ondragstart:i}));var u=Fe(),d=Te(u);{var f=h=>{var p=Fe(),m=Te(p);Tt(m,()=>e.children),X(h,p)};$e(d,h=>{e.children&&h(f)})}X(c,u)}),X(t,o),Et()}class tp{static isValidNsec(e){return Fie(e)}static derivePublicKey(e){return Uie(e)}static pubkeyToNpub(e){try{return e?h5(e):""}catch(n){return console.error("pubkeyããnpubã¸ã®å¤æã¨ã©ã¼:",n),""}}}class Sue{constructor(e,n,r){this.localStorage=e,this.console=n,this.secretKeyStore=r}saveToStorage(e){if(!e?.trim())return{success:!1,error:{type:"validation",message:"Key cannot be empty"}};try{const n=e.trim();return this.localStorage.setItem("nostr-secret-key",n),this.secretKeyStore.set(n),{success:!0}}catch(n){const r={type:"storage",message:"éµã®ä¿å­ã«å¤±æãã¾ãã",originalError:n};return this.console.error("éµã®ä¿å­ã«å¤±æ:",n),{success:!1,error:r}}}loadFromStorage(){let e=this.secretKeyStore.value;if(e)return e;try{return e=this.localStorage.getItem("nostr-secret-key"),e&&this.secretKeyStore.set(e),e}catch(n){return this.console.error("éµã®èª­ã¿è¾¼ã¿ã«å¤±æ:",n),null}}getFromStore(){return this.secretKeyStore.value}hasStoredKey(){try{return!!this.localStorage.getItem("nostr-secret-key")}catch(e){return this.console.error("ã¹ãã¬ã¼ã¸ã¢ã¯ã»ã¹ã¨ã©ã¼:",e),!1}}}class Eue{constructor(e){this.window=e}isWindowNostrAvailable(){return typeof this.window<"u"&&"nostr"in this.window&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}async getPublicKeyFromWindowNostr(){if(!this.isWindowNostrAvailable()||!this.window?.nostr)return{success:!1,error:{type:"validation",message:"window.nostr is not available"}};try{return{success:!0,pubkey:await this.window.nostr.getPublicKey()}}catch(e){const n={type:"network",message:"window.nostrããå¬ééµã®åå¾ã«å¤±æãã¾ãã",originalError:e};return console.error("window.nostrããå¬ééµã®åå¾ã«å¤±æ:",e),{success:!1,error:n}}}}class EL{constructor(e={}){this.deps=e,this._nsecStore.subscribe(n=>this.updateFromNsec(n))}_nsecStore=Ts("");_dataStore=Ts({hex:"",npub:"",nprofile:""});_isValidStore=Ts(!1);_isNostrLoginStore=Ts(!1);nsec={subscribe:this._nsecStore.subscribe};data={subscribe:this._dataStore.subscribe};isValid={subscribe:this._isValidStore.subscribe};isNostrLogin={subscribe:this._isNostrLoginStore.subscribe};hex=$a(this._dataStore,e=>e.hex);npub=$a(this._dataStore,e=>e.npub);nprofile=$a(this._dataStore,e=>e.nprofile);setNsec(e){const n=e?.trim()||"";this._nsecStore.set(n),this._isNostrLoginStore.set(!1)}setNostrLoginAuth(e){if(e.type==="logout"){this.clear();return}if(!e.pubkey){console.warn("NostrLoginAuth: pubkey is required for login/signup");return}try{const n=e.npub||Za.npubEncode(e.pubkey),r=Za.nprofileEncode({pubkey:e.pubkey,relays:[]});let i;if(this.deps.localStorage&&typeof this.deps.localStorage.getItem=="function")try{const s=this.deps.localStorage.getItem("__nostrlogin_accounts");if(s){const o=JSON.parse(s);if(Array.isArray(o)){const a=o.find(l=>l?.pubkey===e.pubkey);if(a?.authMethod){const l=a.authMethod;(l==="connect"||l==="extension"||l==="local")&&(i=l)}}}}catch(s){console.warn("Failed to get authMethod from localStorage:",s)}this._dataStore.set({hex:e.pubkey,npub:n,nprofile:r}),this._isValidStore.set(!0),this._isNostrLoginStore.set(!0),this._nsecStore.set(""),this.deps.setNostrLoginAuthFn?this.deps.setNostrLoginAuthFn(e.pubkey,n,r,i):setTimeout(()=>{this.deps.setNostrLoginAuthFn&&this.deps.setNostrLoginAuthFn(e.pubkey,n,r,i)},10),console.log("[PublicKeyState] NostrLoginèªè¨¼ç¶æãè¨­å®:",{pubkey:e.pubkey,npub:n,type:e.type,authMethod:i})}catch(n){console.error("Failed to set NostrLogin auth:",n),this.clear()}}updateFromNsec(e){if(!e||!tp.isValidNsec(e)){this._resetState();return}try{const n=tp.derivePublicKey(e);n.hex?(this._dataStore.set(n),this._isValidStore.set(!0)):this._resetState()}catch(n){console.error("Failed to derive public key from nsec:",n),this._resetState()}}_resetState(){this._dataStore.set({hex:"",npub:"",nprofile:""}),this._isValidStore.set(!1)}clear(){this._nsecStore.set(""),this._isNostrLoginStore.set(!1),this.deps.clearAuthStateFn&&this.deps.clearAuthStateFn()}get currentIsValid(){return Ys(this._isValidStore)}get currentHex(){return Ys(this.hex)}get currentIsNostrLogin(){return Ys(this._isNostrLoginStore)}}class kL{storage;externalAuth;constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.console||(typeof window<"u"?window.console:{}),i=e.secretKeyStore||{value:null,set:()=>{}},s=e.window||(typeof window<"u"?window:void 0);this.storage=new Sue(n,r,i),this.externalAuth=new Eue(s)}isValidNsec(e){return tp.isValidNsec(e)}derivePublicKey(e){return tp.derivePublicKey(e)}pubkeyToNpub(e){return tp.pubkeyToNpub(e)}saveToStorage(e){return this.storage.saveToStorage(e)}loadFromStorage(){return this.storage.loadFromStorage()}getFromStore(){return this.storage.getFromStore()}hasStoredKey(){return this.storage.hasStoredKey()}isWindowNostrAvailable(){return this.externalAuth.isWindowNostrAvailable()}async getPublicKeyFromWindowNostr(){return await this.externalAuth.getPublicKeyFromWindowNostr()}getStorage(){return this.storage}getExternalAuth(){return this.externalAuth}}const z2=new kL;let TL=Nt({content:"",hashtags:[],tags:[]});const jl=TL;function kue(){return B7(TL)}Nt({});let Sh=Nt({});const U2={get value(){return Sh},set:t=>{Object.assign(Sh,t)},update:t=>{const e=t(Sh);Object.assign(Sh,e)},subscribe:t=>(Ge(()=>{t(Sh)}),()=>{})};let Eh=ge(!1),E1=ge("");const xu={get value(){return k(Eh)},set:t=>{K(Eh,t,!0)},toggle:()=>{K(Eh,!k(Eh))},reset:()=>{K(Eh,!1)}},Qd={get value(){return k(E1)},set:t=>{K(E1,t,!0)},reset:()=>{K(E1,"")}},Q3=["client","eHagaki","31990:ec42c765418b3db9c85abff3a88f4a3bbe57535eebbdc54522041fa5328c0600:1754918316480","wss://relay.nostr.band"];function Tue(){try{const t=localStorage.getItem("clientTagEnabled");return(t===null?!0:t==="true")?[...Q3]:null}catch{return[...Q3]}}function _ue(t){return encodeURI(t.trim())}function Cue(t){return Yne.includes(t)}function Aue(t){const e=t.toLowerCase();return Jne.some(n=>e.endsWith(n))}function Iue(t){const e=t.toLowerCase();return ere.some(n=>e.endsWith(n))}function _L(t){try{const e=_ue(t),n=new URL(e);return Cue(n.protocol)?n.href:null}catch{return null}}function CL(t){const e=_L(t);if(!e)return null;try{const n=new URL(e);return Aue(n.pathname)?e:null}catch{return null}}function Pue(t){const e=_L(t);if(!e)return null;try{const n=new URL(e);return Iue(n.pathname)?e:null}catch{return null}}function AL(t){return t.replace(/\r\n/g,`
`).replace(/\r/g,`
`)}function Oue(t){return!t||/[\s\n\u3000]/.test(t)}function Mue(t){const e=/([.,;:!?ï¼ãããããã\]}>ï¼]){2,}$/,n=t.match(e);if(n){const r=n[0];return{cleanUrl:t.slice(0,-r.length),trailingChars:r}}return{cleanUrl:t,trailingChars:""}}function Nue(t){const{cleanUrl:e}=Mue(t);return{cleanUrl:e,actualLength:e.length}}function Rue(t){if(t.childCount===1){const e=t.firstChild;return e?.type.name==="paragraph"&&e.content.size===0}return t.childCount===0}function Due(t){return Rue(t.doc)}function Lue(t,e){return t.type.name==="paragraph"&&t.content.size===e&&t.textContent.trim().length===e}function Bue(t){const e=[];return t.descendants(n=>{if(n.type.name==="paragraph"){const r=n.textContent;e.push(r)}else if(n.type.name==="image"){const r=n.attrs?.src;r&&e.push(r)}else if(n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}}),e}function Fue(t){if(!t)return null;try{const e=typeof t=="function"?t():t;return e?.state?.doc??e?.view?.state?.doc??null}catch{return null}}function IL(t){const e=Fue(t);return e?Bue(e).join(`
`):""}function $ue(t,e,n){if(t===e)return null;let r=t;if(n){const i=n.resolve(t);i.parent.type.name==="paragraph"&&(r=i.after())}return r<e?{insertPos:r,deleteStart:e+1,deleteEnd:e+2}:r>e+1?{insertPos:r-1,deleteStart:e,deleteEnd:e+1}:null}function zue(t,e,n){return n.insertPos<n.deleteStart?t.insert(n.insertPos,e).delete(n.deleteStart,n.deleteEnd):t.delete(n.deleteStart,n.deleteEnd).insert(n.insertPos,e)}function k1(t,e,n){const{tr:r,doc:i,schema:s}=t.state,o=e.pos,a=$ue(n,o,i);if(!a)return!0;const l=s.nodes.image.create(e.attrs);try{const c=zue(r,l,a);return t.dispatch(c),!0}catch(c){return console.error("Error moving image:",c),!1}}function X3(t){t.dispatch(t.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null}))}function lT(t,e,n){if(!t)return;t.state.doc.descendants((i,s)=>{if(e(i,s))return n(i,s),!1})}function Uue(t,e,n,r){t.update(i=>{const s={...i};return e&&delete s[e],s})}function T1(t,e,n,r,i=!1){n&&(Uue(r,t),lT(n,(s,o)=>{const a=s.type?.name;return(e&&a==="video"||!e&&a==="image")&&(s.attrs?.src===t||s.attrs?.id===t)},(s,o)=>{const a=n.state.tr.delete(o,o+s.nodeSize);n.view.dispatch(a),i&&console.log("[uploadHelper] Deleted placeholder:",t)}))}function PL(t,e=!1){if(!t)return;const{state:n}=t,{doc:r}=n,i=n.tr;let s=0;const o=[];r.descendants((a,l)=>{const c=a.type?.name,u=a.attrs?.isPlaceholder===!0||a.attrs?.src?.startsWith("placeholder-")||a.attrs?.src?.startsWith("blob:");(c==="image"||c==="video")&&u&&o.push({pos:l,size:a.nodeSize})}),o.reverse().forEach(({pos:a,size:l})=>{i.delete(a,a+l),s++}),s>0&&(t.view.dispatch(i),e&&console.log(`[editorUtils] Deleted ${s} placeholder(s)`))}function H2(t){if(!t||!t.types)return!1;try{return Array.from(t.types).some(e=>e==="application/x-tiptap-node")}catch{return!1}}function OL(t){if(!t)return!1;try{return Array.from(t.types).includes("Files")||t.files&&t.files.length>0}catch{return!!(t.files&&t.files.length>0)}}function Hue(t){let e=ge(!1);function n(s){const o=s.dataTransfer,a=H2(o);OL(o)&&!a?(s.preventDefault(),k(e)||(K(e,!0),t.classList.add("drag-over"))):k(e)&&(K(e,!1),t.classList.remove("drag-over"))}function r(s){k(e)&&(K(e,!1),t.classList.remove("drag-over"))}async function i(s){K(e,!1),t.classList.remove("drag-over");const o=s.dataTransfer;H2(o)||o?.files&&o.files.length>0&&typeof t.__uploadFiles=="function"&&(s.preventDefault(),t.__uploadFiles(o.files))}return t.addEventListener("dragover",n),t.addEventListener("dragleave",r),t.addEventListener("drop",i),{destroy(){t.removeEventListener("dragover",n),t.removeEventListener("dragleave",r),t.removeEventListener("drop",i)}}}function Vue(t,e){const n=Hue(t);function r(o){const a=o.dataTransfer,l=H2(a);OL(a)&&!l?e.dragOver(!0):e.dragOver(!1)}function i(o){e.dragOver(!1)}function s(o){e.dragOver(!1)}return t.addEventListener("dragover",r),t.addEventListener("dragleave",i),t.addEventListener("drop",s),{destroy(){n?.destroy?.(),t.removeEventListener("dragover",r),t.removeEventListener("dragleave",i),t.removeEventListener("drop",s)}}}function Wue(t){function e(n){if(!n.clipboardData)return;const r=[];for(const i of n.clipboardData.items)if(i.kind==="file"&&i.type.startsWith("image/")){const s=i.getAsFile();s&&r.push(s)}r.length>0&&(n.preventDefault(),t.__uploadFiles?.(r))}return t.addEventListener("paste",e),{destroy(){t.removeEventListener("paste",e)}}}function jue(t){function e(r){const i=r.target;if(i&&i.closest('.editor-image-button[data-dragging="true"]')){const s=r.touches[0],o=120,a=Ec.querySelector(".tiptap-editor");if(a){const l=a.getBoundingClientRect(),c=s.clientY<l.top+o,u=s.clientY>l.bottom-o;if(!c&&!u)return r.preventDefault(),!1}}}function n(r){const i=Ec.querySelectorAll(".drop-zone-indicator");i.forEach(s=>{s.classList.remove("drop-zone-hover"),s.classList.add("drop-zone-fade-out")}),setTimeout(()=>{i.forEach(s=>{s.parentNode&&s.parentNode.removeChild(s)})},300)}return t.addEventListener("touchmove",e),t.addEventListener("touchend",n),{destroy(){t.removeEventListener("touchmove",e),t.removeEventListener("touchend",n)}}}function que(t){function e(n){if((n.ctrlKey||n.metaKey)&&(n.key==="Enter"||n.key==="NumpadEnter")){n.preventDefault();const r=t.__currentEditor,i=typeof r=="function"?r():r,s=t.__hasStoredKey,o=typeof s=="function"?s():s,a=t.__postStatus,l=typeof a=="function"?a():a,c=i?IL(i):"";!l?.sending&&c.trim()&&o&&t.__submitPost?.()}}return t.addEventListener("keydown",e),{destroy(){t.removeEventListener("keydown",e)}}}function Kue(t){let e=!1;return t?.descendants(n=>{n.type?.name==="image"&&(e=!0)}),e}function Gue(t){let e=!1;return t?.descendants(n=>{n.type?.name==="video"&&(e=!0)}),e}function Zue(t){return Kue(t)||Gue(t)}function Que(t){const{currentEditor:e,editorContainerEl:n,callbacks:r}=t,i=a=>{const c=a.detail.plainText,u=e?Zue(e.state?.doc):!1;r.onContentUpdate?.(c,u)},s=a=>{const l=a;r.onImageFullscreenRequest?.(l.detail.src,l.detail.alt||"")},o=a=>{const c=a?.detail?.pos;if(c!=null&&!(!e||!e.view)){try{"ontouchstart"in window||navigator.maxTouchPoints>0||e.view.focus();const u=ut.create(e.state.doc,c);e.view.dispatch(e.state.tr.setSelection(u).scrollIntoView())}catch(u){console.warn("select-image-node handler failed:",u)}r.onSelectImageNode?.(c)}};return window.addEventListener("editor-content-changed",i),window.addEventListener("image-fullscreen-request",s),window.addEventListener("select-image-node",o),n&&(n.addEventListener("image-fullscreen-request",s),n.addEventListener("select-image-node",o)),{handleContentUpdate:i,handleImageFullscreenRequest:s,handleSelectImageNode:o}}function Xue(t,e){window.removeEventListener("editor-content-changed",t.handleContentUpdate),window.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),window.removeEventListener("select-image-node",t.handleSelectImageNode),e&&(e.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),e.removeEventListener("select-image-node",t.handleSelectImageNode))}function ML(t){const e=[],n=g2.source;return t.descendants((r,i)=>{if(!r.isText||!r.text)return;const s=r.text,o=new RegExp(n,"g");let a;for(;(a=o.exec(s))!==null;){const l=a[0].indexOf("#");if(l===-1)continue;const c=i+a.index+l,u=c+1+a[1].length;e.push({from:c,to:u,hashtag:a[1]})}}),e}function Yue(t){const e=[],n=new Set;g2.lastIndex=0;let r;for(;(r=g2.exec(t))!==null;){const i=r[1];i&&i.trim()&&(n.has(i)||(n.add(i),e.push(i)))}return e}function Jue(t){const e=ML(t),n=[],r=new Set;for(const i of e)r.has(i.hashtag)||(r.add(i.hashtag),n.push(i.hashtag));return n}function ede(t){Array.isArray(jl.hashtags)&&[...jl.hashtags];let e,n;typeof t=="string"?(n=t,e=Yue(n)):(e=Jue(t),n=t.textContent);const r=e.map(i=>["t",i.toLowerCase()]);jl.content=n,jl.hashtags=e,jl.tags=r}function Y3(t){const n=ML(t).map(({from:r,to:i})=>Sr.inline(r,i,{class:So.HASHTAG_CLASS}));return xn.create(t,n)}function tde(t,e,n,r,i,s){const o=e.doc.resolve(i),a=o.parent,l=a.type.name==="paragraph"&&a.textContent.trim().length===0,c=Lue(a,s-i),u=Due(e),d=n.create({src:r,alt:"Image"});if(l||c){const f=o.depth,h=o.start(f),p=o.end(f);return u||e.doc.childCount===1&&c?t.delete(0,e.doc.content.size).insert(0,d):t.replaceWith(h,p,d)}return t.replaceWith(i,s,d)}function nde(t,e,n){const r=t.schema.marks.link,i=t.schema.nodes.image;if(!r)return null;let s=t.tr,o=!1;const a=[];e&&t.doc.descendants((l,c)=>{if(!l.isText)return;l.marks.find(d=>d.type===r)&&a.push({type:"removeMark",from:c,to:c+l.nodeSize})}),t.doc.descendants((l,c)=>{if(!l.isTextblock||l.childCount===0)return;let u="";const d=[];if(l.forEach((h,p)=>{h.isText&&h.text&&(d.push({textOffset:u.length,docPos:c+1+p}),u+=h.text)}),!u)return;let f;for(;(f=So.URL_REGEX.exec(u))!==null;){if(typeof f.index!="number")continue;const h=f.index,p=f[0],m=h>0?u[h-1]:void 0;if(!Oue(m))continue;const{cleanUrl:g,actualLength:y}=Nue(p),b=h+y,E=c+1+h,C=c+1+b;if(n){const I=CL(g);if(I&&i){a.push({type:"replaceImage",from:E,to:C,imageUrl:I});break}}if(e){if(g.length<8||!/^https?:\/\/[a-zA-Z0-9]/.test(g))continue;try{const x=new URL(g).hostname;if(x.length>0&&x.includes(".")){const P=x.split("."),T=P[P.length-1];if(T&&T.length>=2){const S=r.create({href:g});a.push({type:"addMark",from:E,to:C,mark:S})}}}catch{continue}}}}),a.sort((l,c)=>c.from-l.from);for(const l of a)l.type==="removeMark"?(s=s.removeMark(l.from,l.to,r),o=!0):l.type==="addMark"&&l.mark?(s=s.addMark(l.from,l.to,l.mark),o=!0):l.type==="replaceImage"&&l.imageUrl&&(s=tde(s,t,i,l.imageUrl,l.from,l.to),o=!0);return o&&s.docChanged?s:null}const rde=In.create({name:"contentTracking",addOptions(){return{debounceDelay:So.DEBOUNCE_DELAY,enableHashtags:So.ENABLE_HASHTAGS,enableAutoLink:So.ENABLE_AUTO_LINK,enableImageConversion:So.ENABLE_IMAGE_CONVERSION}},addStorage(){return{updateTimeout:null}},addProseMirrorPlugins(){const t=this.storage,e=this.options;return[...e.enableHashtags?[new un({key:new An(So.PLUGIN_KEYS.HASHTAG_DECORATION),state:{init:(n,{doc:r})=>Y3(r),apply(n,r){return n.docChanged?Y3(n.doc):r.map(n.mapping,n.doc)}},props:{decorations(n){return this.getState(n)}}})]:[],...e.enableAutoLink||e.enableImageConversion?[new un({key:new An(So.PLUGIN_KEYS.LINK_AND_IMAGE_CONVERSION),appendTransaction:(n,r,i)=>{if(!n.some(l=>l.docChanged))return null;const o=!n.some(l=>l.getMeta("paste")),a=nde(i,e.enableAutoLink??!0,o&&(e.enableImageConversion??!0));return a&&a.setMeta("addToHistory",!1),a}})]:[],new un({key:new An(So.PLUGIN_KEYS.CONTENT_UPDATE_TRACKER),state:{init:()=>null,apply(n){return n.docChanged&&(t.updateTimeout&&clearTimeout(t.updateTimeout),t.updateTimeout=setTimeout(()=>{ede(n.doc),window.dispatchEvent(new CustomEvent("editor-content-changed",{detail:{plainText:n.doc.textContent}}))},e.debounceDelay??So.DEBOUNCE_DELAY)),null}}})]},onDestroy(){this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout)}});function J3(t){return t.split(/[\n ]+/).map(e=>e.trim()).filter(Boolean).map(e=>{const n=CL(e);if(n)return{url:n,type:"image"};const r=Pue(e);return r?{url:r,type:"video"}:null}).filter(e=>e!==null)}function ide(t,e){const n=e.parent;return n.type.name==="paragraph"&&n.textContent.trim().length===0}function sde(t){const{selection:e}=t,n=t.doc.resolve(e.from);if(ide(e,n)){const r=n.depth,i=n.start(r),s=n.end(r);return{start:i,end:s}}return null}function eP(t,e){return t.map((n,r)=>{const i=Date.now();if(n.type==="image")return e.nodes.image.create({src:n.url,alt:"Pasted image"});{const s=`pasted-video-${i}-${r}`;return e.nodes.video.create({src:n.url,id:s})}})}function tP(t){const e=t.doc;if(!e)return t;const n=[];return e.descendants((r,i)=>{if(r.type.name==="paragraph"&&r.textContent.trim().length===0){if(e.childCount===1&&e.firstChild===r)return;let s=!1;r.descendants(o=>o.type&&(o.type.name==="image"||o.type.name==="video")?(s=!0,!1):!0),s||n.push([i,i+r.nodeSize])}}),n.sort((r,i)=>i[0]-r[0]),n.forEach(([r,i])=>{t=t.delete(r,i)}),t}const ode=In.create({name:"mediaPaste",addProseMirrorPlugins(){return[new un({key:new An("image-paste"),props:{handlePaste:(t,e)=>{const n=e.clipboardData?.getData("text/plain")||"",r=J3(n);if(r.length>0){e.preventDefault();const{state:i,dispatch:s}=t,{tr:o,selection:a,schema:l}=i,c=eP(r,l);let u=o;const d=sde(i);if(d&&c.length>0){u=u.replaceWith(d.start,d.end,c[0]);let f=d.start+c[0].nodeSize;for(let h=1;h<c.length;h++)u=u.insert(f,c[h]),f+=c[h].nodeSize}else{let f=a.from;c.forEach(h=>{u=u.insert(f,h),f+=h.nodeSize})}return u=tP(u),s(u),!0}return!1},handleTextInput:(t,e,n,r)=>{if(r.includes(`
`)||r.length>20){const i=J3(r);if(i.length>0){const{state:s,dispatch:o}=t,{tr:a,schema:l}=s,c=eP(i,l);let u=a;u=u.delete(e,n);let d=e;return c.forEach(f=>{u=u.insert(d,f),d+=f.nodeSize}),u=tP(u),o(u),!0}}return!1}}})]}}),ade=In.create({name:"imageDragDrop",addProseMirrorPlugins(){const t=new An("image-drag-drop"),e=new An("drop-zone-indicator");return[new un({key:t,state:{init:()=>({isDragging:!1,draggedNodePos:null,autoScrollInterval:null}),apply:(n,r)=>{const i=n.getMeta("imageDrag");return i?i.isDragging===!1&&r.autoScrollInterval?(clearInterval(r.autoScrollInterval),{...r,...i,autoScrollInterval:null}):{...r,...i}:r}},props:{handleDrop:(n,r,i,s)=>{const o=r.dataTransfer?.getData("application/x-tiptap-node");if(!s&&o)try{const a=JSON.parse(o);if(a.type==="image"){r.preventDefault();const l=n.posAtCoords({left:r.clientX,top:r.clientY});if(l&&typeof a.pos=="number")return X3(n),k1(n,a,l.pos),!0}}catch(a){console.warn("Failed to parse drag data:",a)}return!1},handleDOMEvents:{dragstart:(n,r)=>Ra()?(r.preventDefault(),!0):!1,dragover:(n,r)=>Ra()?(r.preventDefault(),!0):!1,drop:(n,r)=>Ra()?(r.preventDefault(),!0):!1}},view:n=>{let r=null;const i=(c,u)=>{r&&(cancelAnimationFrame(r),r=null);const d=n.dom;if(!d)return;const f=d.getBoundingClientRect(),h=yI;let p=0;c==="up"?p=u-f.top:p=f.bottom-u;const m=Math.max(0,Math.min(1,p/h)),g=bI+(rre-bI)*(1-m),y=()=>{const b=d.scrollTop,E=d.scrollHeight,C=d.clientHeight;if(c==="up"&&b>0){const I=Math.max(0,b-g);d.scrollTop=I,I>0&&(r=requestAnimationFrame(y))}else if(c==="down"&&b<E-C){const I=Math.min(E-C,b+g);d.scrollTop=I,I<E-C&&(r=requestAnimationFrame(y))}};r=requestAnimationFrame(y)},s=()=>{r&&(cancelAnimationFrame(r),r=null)},o=c=>{const{nodeData:u,dropPosition:d,dropX:f,dropY:h}=c.detail;if(s(),n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null})),u&&u.type==="image"){let p;typeof d=="number"?p=d:p=n.posAtCoords({left:f,top:h})?.pos||u.pos,typeof u.pos=="number"&&k1(n,u,p)}},a=c=>{const{nodePos:u}=c.detail;n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!0,draggedNodePos:u}))},l=c=>{const{touchY:u}=c.detail;if(typeof u!="number"||!t.getState(n.state)?.isDragging)return;const f=n.dom;if(!f)return;const h=f.getBoundingClientRect(),p=yI;u<h.top+p?i("up",u):u>h.bottom-p?i("down",u):s()};return window.addEventListener("touch-image-drop",o),window.addEventListener("touch-image-drag-start",a),window.addEventListener("touch-image-drag-move",l),{destroy(){s(),window.removeEventListener("touch-image-drop",o),window.removeEventListener("touch-image-drag-start",a),window.removeEventListener("touch-image-drag-move",l)}}}}),new un({key:e,state:{init(){return xn.empty},apply(n,r,i,s){if(!Ra())return xn.empty;const o=t.getState(s);if(!o?.isDragging)return xn.empty;const a=[],l=s.doc;let c=!1;if(typeof o.draggedNodePos=="number"){const u=l.firstChild;u&&u.type.name==="image"&&u.attrs&&o.draggedNodePos===0&&(c=!0)}return c||a.push(Sr.widget(0,()=>{const u=document.createElement("div");u.className="drop-zone-indicator drop-zone-top",u.setAttribute("data-drop-pos","0");const d=document.createElement("div");return d.className="drop-zone-bar",u.appendChild(d),u},{side:-1})),l.descendants((u,d)=>{if(u.type.name==="paragraph"||u.type.name==="image"){const f=d+u.nodeSize;if(typeof o.draggedNodePos=="number"&&f===o.draggedNodePos)return;o.draggedNodePos!==d&&a.push(Sr.widget(f,()=>{const h=document.createElement("div");h.className="drop-zone-indicator drop-zone-between",h.setAttribute("data-drop-pos",f.toString());const p=document.createElement("div");return p.className="drop-zone-bar",h.appendChild(p),h},{side:1}))}}),xn.create(l,a)}},props:{decorations(n){return this.getState(n)}}})]},addStorage(){return{moveImageNode:(t,e,n)=>(X3(t),k1(t,e,n))}}}),lde=In.create({name:"smartBackspace",addProseMirrorPlugins(){return[new un({key:new An("smart-backspace"),props:{handleKeyDown(t,e){if(e.key!=="Backspace"||Ra()&&document.activeElement!==t.dom)return!1;const{state:n}=t,{selection:r,doc:i}=n;if(r.empty&&r.from===1){const s=i.firstChild,o=i.childCount>1?i.child(1):null;if(s&&s.type.name==="paragraph"&&s.content.size===0&&o&&o.type.name==="image")return t.dispatch(n.tr.delete(0,s.nodeSize)),!0}return!1}}})]}});var cde=_e('<div class="loader-container svelte-zx73mp"><div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div></div>'),ude=_e('<div class="placeholder-image svelte-zx73mp" aria-hidden="true"></div>'),dde=_e('<span class="placeholder-text loading-text svelte-zx73mp"> </span>'),fde=_e("<div><!> <!> <!></div>");function pc(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=le(e,"text",3,!1),o=le(e,"showImage",3,!1),a=le(e,"showLoader",3,!1),l=le(e,"customClass",3,""),c=ae(()=>typeof s()=="string"?s():s()===!0?n()("loadingPlaceholder.loading"):"");var u=fde(),d=re(u);{var f=y=>{var b=cde();X(y,b)};$e(d,y=>{a()&&y(f)})}var h=ve(d,2);{var p=y=>{var b=ude();X(y,b)};$e(h,y=>{o()&&y(p)})}var m=ve(h,2);{var g=y=>{var b=dde(),E=re(b);je(()=>Re(E,k(c))),X(y,b)};$e(m,y=>{k(c)&&y(g)})}je(()=>{eo(u,1,`loading-placeholder ${l()??""}`,"svelte-zx73mp"),yn(u,"aria-label",k(c))}),X(t,u),Et(),i()}function hde(t,e={}){const{collapseEmptyLines:n=!1,maxConsecutiveEmptyLines:r=2}=e;let i=AL(t);if(n){const o=new RegExp(`\\n{${r+2},}`,"g");i=i.replace(o,`
`.repeat(r+1))}let s=i.split(`
`);return s.length>0&&s[s.length-1]===""&&(s=s.slice(0,-1)),s.length===1&&s[0]===""&&(s=[]),{normalized:i,lines:s}}function pde(t){return t.join(`
`)}async function Kb(t,e="",n,r){const i=n??navigator;try{if(i?.clipboard&&typeof i.clipboard.writeText=="function"){await i.clipboard.writeText(t),console.log(`${e} copied to clipboard`);return}}catch(s){console.error(`Failed to copy ${e}:`,s),await nP(t,e,r);return}await nP(t,e,r)}async function nP(t,e="",n){const r=n??window;try{const i=r&&r.document||document,s=i.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-9999px",s.style.top="0",s.setAttribute("readonly","true"),i.body.appendChild(s),s.focus(),s.select();const o=i.execCommand&&i.execCommand("copy");if(i.body.removeChild(s),o)console.log(`${e} copied to clipboard (fallback)`);else throw new Error("fallback_copy_failed")}catch(i){console.warn(`Failed to copy ${e} (both clipboard API and fallback failed):`,i)}}function mde(t,e,n,r,i,s){const o=window,a=navigator,l=s?.editorObj??window.__currentEditor,c=nr,u=typeof c=="function"?c:Ys(c);return[{label:u("videoContextMenu.playPause"),action:()=>{const d=document.querySelector(`video[data-node-id="${i}"]`);d?d.paused?d.play().catch(f=>{console.warn("Failed to play video:",f)}):d.pause():console.warn("Video element not found for nodeId:",i)},src:t,icon:"/icons/play_pause_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg"},{label:u("videoContextMenu.copyUrl"),action:async()=>{Kb(t,"video URL",a,o)},src:t,icon:"/icons/copy-solid-full.svg"},{label:u("videoContextMenu.delete"),action:()=>{const d=l?.view;if(d?.state&&d?.dispatch){let f=!1;d.state.doc.descendants((h,p)=>{if(!f&&h.type.name==="video"&&h.attrs.id===i)return d.dispatch(d.state.tr.delete(p,p+h.nodeSize)),f=!0,!1})}},disabled:!1,src:t,icon:"/icons/trash-solid-full.svg"}]}function Gb(t,e,n,r,i,s){const o=((c,u,...d)=>setTimeout(c,u,...d));let a=!1,l;if(t.update(c=>(a=c.open&&c.nodeId!==e,l=c.nodeId,c)),a&&l){t.set({open:!1,nodeId:void 0,src:void 0,videoElement:void 0}),o(()=>{t.set({open:!0,nodeId:e,src:r,videoElement:i})},0);return}t.set({open:!0,nodeId:e,src:r,videoElement:i})}function gde(t,e,n,r){if(!t.open||!t.nodeId)return null;const i=t.nodeId,s=t.src||"";t.videoElement;let o=0,a=1;e?.state?.doc&&e.state.doc.descendants((d,f)=>{if(d.attrs.id===i)return o=f,a=d.nodeSize,!1});const c=mde(s,()=>o,a,!0,i,{editorObj:e});let u={x:0,y:0};return n&&(u=Kd(n.x,n.y)),{items:c,x:u.x,y:u.y}}function yde(t,e,n,r,i,s){if(k(e)||n()||t.target===k(r))return;t.stopPropagation(),t.preventDefault(),hm(i.getPos);const o=Cd(t);za.set(o),Gb(is,k(s),o,i.node.attrs.src||"",k(r))}function bde(t,e,n,r,i,s){if(k(e)||n())return;if(k(r)){const a=k(r).getBoundingClientRect(),l=t.clientY,c=a.bottom;if(l>c-48)return}if(t.button===2)return;t.stopPropagation(),t.preventDefault(),hm(i.getPos);const o=Cd(t);za.set(o),Gb(is,k(s),o,i.node.attrs.src||"",k(r))}function wde(t,e,n,r,i){if(t.key==="Enter"||t.key===" "){t.preventDefault(),hm(e.getPos);const s={x:0,y:0};za.set(s),k(n)||Gb(is,k(r),s,e.node.attrs.src||"",k(i))}}var vde=_e('<video controls playsinline="" autoplay loop preload="metadata"><track kind="captions"/> </video>',2),xde=_e('<div class="video-wrapper svelte-1rghf39" data-video-node="" role="button" tabindex="0"><!></div>');function Sde(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=ge(void 0),o=ge(!1),a=ge(void 0),l=ae(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src?.startsWith("placeholder-")||e.node.attrs.src?.startsWith("blob:")||!e.node.attrs.src),c=ae(()=>e.node.attrs.id||(typeof e.getPos=="function"?(e.getPos()??"unknown").toString():"unknown"));function u(){K(o,!0)}function d(){k(l)||console.error("Failed to load video:",e.node.attrs.src)}function f(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}let h=0,p={x:0,y:0};const m=200,g=10;function y(E){if(k(l)||E.touches.length!==1)return;h=Date.now();const C=E.touches[0];p={x:C.clientX,y:C.clientY}}function b(E){if(k(l)||f())return;if(Date.now()-h<m&&E.changedTouches.length===1){const x=E.changedTouches[0],P={x:x.clientX,y:x.clientY};if(Math.sqrt(Math.pow(P.x-p.x,2)+Math.pow(P.y-p.y,2))<g){if(k(s)){const _=k(s).getBoundingClientRect(),O=x.clientY,F=_.bottom;if(O>F-48)return}E.stopPropagation(),E.preventDefault(),hm(e.getPos);const S={x:x.clientX,y:x.clientY};za.set(S),Gb(is,k(c),S,e.node.attrs.src||"")}}}us(()=>(k(s)&&(k(s).addEventListener("touchstart",y,{passive:!1}),k(s).addEventListener("touchend",b,{passive:!1})),()=>{k(s)&&(k(s).removeEventListener("touchstart",y),k(s).removeEventListener("touchend",b))})),SL(t,{children:(E,C)=>{var I=xde();I.__click=[yde,l,f,s,e,c],I.__keydown=[wde,e,l,c,s];var x=re(I);{var P=S=>{{let _=ae(()=>n()("videoNode.uploading"));pc(S,{get text(){return k(_)},showLoader:!0})}},T=S=>{var _=vde();_.muted=!0;let O;_.__click=[bde,l,f,s,e,c],_.__touchstart=y,_.__touchend=b;var F=ve(re(_));pr(_,L=>K(s,L),()=>k(s)),je((L,B)=>{yn(_,"src",e.node.attrs.src),O=eo(_,1,"editor-video svelte-1rghf39",null,O,L),yn(_,"data-node-id",k(c)),Re(F,` ${B??""}`)},[()=>({loaded:k(o)}),()=>n()("videoNode.not_supported")]),js("loadeddata",_,u),js("error",_,d),X(S,_)};$e(x,S=>{k(l)?S(P):S(T,!1)})}pr(I,S=>K(a,S),()=>k(a)),X(E,I)},$$slots:{default:!0}}),Et(),i()}Ti(["click","keydown","touchstart","touchend"]);const Ede=Ci.create({name:"video",group:"block",draggable:!1,addAttributes(){return{src:{default:null},isPlaceholder:{default:!1}}},parseHTML(){return[{tag:"video[src]"}]},renderHTML({HTMLAttributes:t}){return["video",Gn(t,{controls:!0})]},addNodeView(){return xL(Sde)}});function kde(t){const e=[];return t.content.forEach(n=>{if(n.type.name==="paragraph"){let r="";n.content.forEach(i=>{i.isText&&(r+=i.text||"")}),e.push(r)}else if(n.type.name==="image"||n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}else n.isTextblock&&e.push(n.textContent)}),e}const Tde=In.create({name:"clipboardExtension",addProseMirrorPlugins(){return[new un({key:new An("clipboardExtension"),props:{handlePaste(t,e,n){const{state:r,dispatch:i}=t,{clipboardData:s}=e;if(!s||s.files&&s.files.length>0)return!1;const a=s.getData("text/plain");if(!a)return!1;const l=s.types.includes("text/html");let c=!1;if(l){const g=s.getData("text/html");if(g.includes("<strong>")||g.includes("<b>")||g.includes("<em>")||g.includes("<i>")||g.includes("<a ")||g.includes("<a>"))return!1;c=g.includes('data-block="true"')&&g.includes("data-editor=")}const{lines:u}=hde(a,{collapseEmptyLines:c,maxConsecutiveEmptyLines:1});if(u.length===0)return!1;const d=u.join(`
`),f=r.schema.text(d),h=De.from(f),p=new nt(h,0,0),m=r.tr.replaceSelection(p).setMeta("paste",!0).setMeta("uiEvent","paste").setMeta("addToHistory",!0);return i(m),!0},clipboardTextSerializer(t){const e=kde(t);return pde(e)}}})]}});var ty=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...r}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,r,n]},_de=/^\s*>\s$/,Cde=Ci.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return ty("blockquote",{...Gn(this.options.HTMLAttributes,t),children:ty("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=[];return t.content.forEach(i=>{const o=e.renderChildren(i).split(`
`).map(a=>`> ${a}`).join(`
`);n.push(o)}),n.flatMap(i=>[i,"> "]).slice(0,-1).join(`
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[xf({find:_de,type:this.type})]}}),Ade=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Ide=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Pde=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Ode=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Mde=Ku.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return ty("strong",{...Gn(this.options.HTMLAttributes,t),children:ty("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[vf({find:Ade,type:this.type}),vf({find:Pde,type:this.type})]},addPasteRules(){return[$u({find:Ide,type:this.type}),$u({find:Ode,type:this.type})]}}),Nde=/(^|[^`])`([^`]+)`(?!`)$/,Rde=/(^|[^`])`([^`]+)`(?!`)/g,Dde=Ku.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Gn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[vf({find:Nde,type:this.type})]},addPasteRules(){return[$u({find:Rde,type:this.type})]}}),_1=4,Lde=/^```([a-z]+)?[\s\n]$/,Bde=/^~~~([a-z]+)?[\s\n]$/,Fde=Ci.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:_1,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const s=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Gn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let r="";const i=((n=t.attrs)==null?void 0:n.language)||"";return t.content?r=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):r=`\`\`\`${i}

\`\`\``,r},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:_1,{state:r}=t,{selection:i}=r,{$from:s,empty:o}=i;if(s.parent.type!==this.type)return!1;const a=" ".repeat(n);return o?t.commands.insertContent(a):t.commands.command(({tr:l})=>{const{from:c,to:u}=i,h=r.doc.textBetween(c,u,`
`,`
`).split(`
`).map(p=>a+p).join(`
`);return l.replaceWith(c,u,r.schema.text(h)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:_1,{state:r}=t,{selection:i}=r,{$from:s,empty:o}=i;return s.parent.type!==this.type?!1:o?t.commands.command(({tr:a})=>{var l;const{pos:c}=s,u=s.start(),d=s.end(),h=r.doc.textBetween(u,d,`
`,`
`).split(`
`);let p=0,m=0;const g=c-u;for(let x=0;x<h.length;x+=1){if(m+h[x].length>=g){p=x;break}m+=h[x].length+1}const b=((l=h[p].match(/^ */))==null?void 0:l[0])||"",E=Math.min(b.length,n);if(E===0)return!0;let C=u;for(let x=0;x<p;x+=1)C+=h[x].length+1;return a.delete(C,C+E),c-C<=E&&a.setSelection(Ct.create(a.doc,C)),!0}):t.commands.command(({tr:a})=>{const{from:l,to:c}=i,f=r.doc.textBetween(l,c,`
`,`
`).split(`
`).map(h=>{var p;const m=((p=h.match(/^ */))==null?void 0:p[0])||"",g=Math.min(m.length,n);return h.slice(g)}).join(`
`);return a.replaceWith(l,c,r.schema.text(f)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(zt.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[F2({find:Lde,type:this.type,getAttributes:t=>({language:t[1]})}),F2({find:Bde,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new un({key:new An("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i?.mode;if(!n||!s)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(Ct.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),$de=Ci.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),zde=Ci.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Gn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:(t,e)=>e.indent(`
`),parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(f=>a.includes(f.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Ude=Ci.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Gn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const r=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,i="#".repeat(r);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>F2({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),Hde=Ci.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Gn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!oue(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:r}=n,i=t();return iL(n)?i.insertContentAt(r.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:s,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(Ct.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(ut.create(o.doc,l.pos)):o.setSelection(Ct.create(o.doc,l.pos));else{const u=s.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,d=u?.create();d&&(o.insert(c,d),o.setSelection(Ct.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[bL({find:/^(?:---|â-|___\s|\*\*\*\s)$/,type:this.type})]}}),Vde=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Wde=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,jde=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,qde=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Kde=Ku.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Gn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[vf({find:Vde,type:this.type}),vf({find:jde,type:this.type})]},addPasteRules(){return[$u({find:Wde,type:this.type}),$u({find:qde,type:this.type})]}});const Gde="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Zde="ÎµÎ»1Ï2Ð±Ð³1ÐµÐ»3Ð´ÐµÑÐ¸4ÐµÑ2ÐºÐ°ÑÐ¾Ð»Ð¸Ðº6Ð¾Ð¼3Ð¼ÐºÐ´2Ð¾Ð½1ÑÐºÐ²Ð°6Ð¾Ð½Ð»Ð°Ð¹Ð½5ÑÐ³3ÑÑÑ2Ñ2ÑÐ°Ð¹Ñ3ÑÐ±3ÑÐºÑ3ÒÐ°Ð·3Õ°Õ¡Õµ3××©×¨××5×§××3Ø§Ø¨ÙØ¸Ø¨Ù5Ø±Ø§ÙÙÙ5ÙØ§Ø±Ø¯Ù4Ø¨Ø­Ø±ÙÙ5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙØ¯ÙØ©6Ø¹ÙÙØ§Ù5ÙØºØ±Ø¨5ÙØ§Ø±Ø§Øª5ÛØ±Ø§Ù5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙØªÙ3Ú¾Ø§Ø±Øª5ØªÙÙØ³4Ø³ÙØ¯Ø§Ù3Ø±ÙØ©5Ø´Ø¨ÙØ©4Ø¹Ø±Ø§Ù2Ø¨2ÙØ§Ù4ÙÙØ³Ø·ÙÙ6ÙØ·Ø±3ÙØ§Ø«ÙÙÙÙ6ÙÙ3ÙØµØ±2ÙÙØ³ÙØ§5ÙØ±ÙØªØ§ÙÙØ§7ÙØ¹4ÙÙØ±Ø§Ù5Ù¾Ø§Ú©Ø³ØªØ§Ù7ÚØ§Ø±Øª4à¤à¥à¤®3à¤¨à¥à¤3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥à¤¤5à¤¸à¤à¤à¤ à¤¨5à¦¬à¦¾à¦à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®à®¨à¯à®¤à®¿à®¯à®¾6à®²à®à¯à®à¯6à®à®¿à®à¯à®à®ªà¯à®ªà¯à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´5à¶½à¶à¶à·4à¸à¸­à¸¡3à¹à¸à¸¢3àº¥àº²àº§3áá2ã¿ããª3ã¢ãã¾ã³4ã¯ã©ã¦ã4ã°ã¼ã°ã«4ã³ã 2ã¹ãã¢3ã»ã¼ã«3ãã¡ãã·ã§ã³6ãã¤ã³ã4ä¸ç2ä¸­ä¿¡1å½1å1æç½3äºé©¬é3ä¼ä¸2ä½å±±2ä¿¡æ¯2å¥åº·2å«å¦2å¬å¸1ç2å°æ¹¾1ç£2åå1åº1æ 2åé0å¤§éåº5å¨çº¿2å¤§æ¿2å¤©ä¸»æ3å¨±ä¹2å®¶é»2å¹¿ä¸2å¾®å2æå2æç±ä½ 3ææº2æè2æ¿å¡1åº2æ°å å¡2é»2æ¶å°2æ¸ç±2æºæ2æ·¡é©¬é¡3æ¸¸æ2æ¾³é2ç¹ç2ç§»å¨2ç»ç»æºæ4ç½å1åº1ç«1ç»2èé2è°·æ­2è´­ç©2éè²©2éå¢2é»è¨çç§4é£å©æµ¦3é£å2é¤å2é¦æ ¼éæ3æ¸¯2ë·ë·1ì»´2ì¼ì±2íêµ­2",V2="numeric",W2="ascii",j2="alpha",np="asciinumeric",Bh="alphanumeric",q2="domain",NL="emoji",Qde="scheme",Xde="slashscheme",C1="whitespace";function Yde(t,e){return t in e||(e[t]=[]),e[t]}function uu(t,e,n){e[V2]&&(e[np]=!0,e[Bh]=!0),e[W2]&&(e[np]=!0,e[j2]=!0),e[np]&&(e[Bh]=!0),e[j2]&&(e[Bh]=!0),e[Bh]&&(e[q2]=!0),e[NL]&&(e[q2]=!0);for(const r in e){const i=Yde(r,n);i.indexOf(t)<0&&i.push(t)}}function Jde(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Bi(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Bi.groups={};Bi.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(t))return s}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let i=0;i<t.length;i++)this.tt(t[i],e,n,r)},tr(t,e,n,r){r=r||Bi.groups;let i;return e&&e.j?i=e:(i=new Bi(e),n&&r&&uu(e,n,r)),this.jr.push([t,i]),i},ts(t,e,n,r){let i=this;const s=t.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(t[o]);return i.tt(t[s-1],e,n,r)},tt(t,e,n,r){r=r||Bi.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const s=e;let o,a=i.go(t);if(a?(o=new Bi,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Bi,s){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(Jde(o.t,r),n);uu(s,l,r)}else n&&uu(s,n,r);o.t=s}return i.j[t]=o,o}};const $t=(t,e,n,r,i)=>t.ta(e,n,r,i),Vn=(t,e,n,r,i)=>t.tr(e,n,r,i),rP=(t,e,n,r,i)=>t.ts(e,n,r,i),Ve=(t,e,n,r,i)=>t.tt(e,n,r,i),pa="WORD",K2="UWORD",RL="ASCIINUMERICAL",DL="ALPHANUMERICAL",Lp="LOCALHOST",G2="TLD",Z2="UTLD",Lg="SCHEME",vd="SLASH_SCHEME",cT="NUM",Q2="WS",uT="NL",rp="OPENBRACE",ip="CLOSEBRACE",ny="OPENBRACKET",ry="CLOSEBRACKET",iy="OPENPAREN",sy="CLOSEPAREN",oy="OPENANGLEBRACKET",ay="CLOSEANGLEBRACKET",ly="FULLWIDTHLEFTPAREN",cy="FULLWIDTHRIGHTPAREN",uy="LEFTCORNERBRACKET",dy="RIGHTCORNERBRACKET",fy="LEFTWHITECORNERBRACKET",hy="RIGHTWHITECORNERBRACKET",py="FULLWIDTHLESSTHAN",my="FULLWIDTHGREATERTHAN",gy="AMPERSAND",yy="APOSTROPHE",by="ASTERISK",$l="AT",wy="BACKSLASH",vy="BACKTICK",xy="CARET",ql="COLON",dT="COMMA",Sy="DOLLAR",Eo="DOT",Ey="EQUALS",fT="EXCLAMATION",gs="HYPHEN",sp="PERCENT",ky="PIPE",Ty="PLUS",_y="POUND",op="QUERY",hT="QUOTE",LL="FULLWIDTHMIDDLEDOT",pT="SEMI",ko="SLASH",ap="TILDE",Cy="UNDERSCORE",BL="EMOJI",Ay="SYM";var FL=Object.freeze({__proto__:null,ALPHANUMERICAL:DL,AMPERSAND:gy,APOSTROPHE:yy,ASCIINUMERICAL:RL,ASTERISK:by,AT:$l,BACKSLASH:wy,BACKTICK:vy,CARET:xy,CLOSEANGLEBRACKET:ay,CLOSEBRACE:ip,CLOSEBRACKET:ry,CLOSEPAREN:sy,COLON:ql,COMMA:dT,DOLLAR:Sy,DOT:Eo,EMOJI:BL,EQUALS:Ey,EXCLAMATION:fT,FULLWIDTHGREATERTHAN:my,FULLWIDTHLEFTPAREN:ly,FULLWIDTHLESSTHAN:py,FULLWIDTHMIDDLEDOT:LL,FULLWIDTHRIGHTPAREN:cy,HYPHEN:gs,LEFTCORNERBRACKET:uy,LEFTWHITECORNERBRACKET:fy,LOCALHOST:Lp,NL:uT,NUM:cT,OPENANGLEBRACKET:oy,OPENBRACE:rp,OPENBRACKET:ny,OPENPAREN:iy,PERCENT:sp,PIPE:ky,PLUS:Ty,POUND:_y,QUERY:op,QUOTE:hT,RIGHTCORNERBRACKET:dy,RIGHTWHITECORNERBRACKET:hy,SCHEME:Lg,SEMI:pT,SLASH:ko,SLASH_SCHEME:vd,SYM:Ay,TILDE:ap,TLD:G2,UNDERSCORE:Cy,UTLD:Z2,UWORD:K2,WORD:pa,WS:Q2});const fa=/[a-z]/,kh=new RegExp("\\p{L}","u"),A1=new RegExp("\\p{Emoji}","u"),ha=/\d/,I1=/\s/,iP="\r",P1=`
`,efe="ï¸",tfe="â",O1="ï¿¼";let lg=null,cg=null;function nfe(t=[]){const e={};Bi.groups=e;const n=new Bi;lg==null&&(lg=sP(Gde)),cg==null&&(cg=sP(Zde)),Ve(n,"'",yy),Ve(n,"{",rp),Ve(n,"}",ip),Ve(n,"[",ny),Ve(n,"]",ry),Ve(n,"(",iy),Ve(n,")",sy),Ve(n,"<",oy),Ve(n,">",ay),Ve(n,"ï¼",ly),Ve(n,"ï¼",cy),Ve(n,"ã",uy),Ve(n,"ã",dy),Ve(n,"ã",fy),Ve(n,"ã",hy),Ve(n,"ï¼",py),Ve(n,"ï¼",my),Ve(n,"&",gy),Ve(n,"*",by),Ve(n,"@",$l),Ve(n,"`",vy),Ve(n,"^",xy),Ve(n,":",ql),Ve(n,",",dT),Ve(n,"$",Sy),Ve(n,".",Eo),Ve(n,"=",Ey),Ve(n,"!",fT),Ve(n,"-",gs),Ve(n,"%",sp),Ve(n,"|",ky),Ve(n,"+",Ty),Ve(n,"#",_y),Ve(n,"?",op),Ve(n,'"',hT),Ve(n,"/",ko),Ve(n,";",pT),Ve(n,"~",ap),Ve(n,"_",Cy),Ve(n,"\\",wy),Ve(n,"ã»",LL);const r=Vn(n,ha,cT,{[V2]:!0});Vn(r,ha,r);const i=Vn(r,fa,RL,{[np]:!0}),s=Vn(r,kh,DL,{[Bh]:!0}),o=Vn(n,fa,pa,{[W2]:!0});Vn(o,ha,i),Vn(o,fa,o),Vn(i,ha,i),Vn(i,fa,i);const a=Vn(n,kh,K2,{[j2]:!0});Vn(a,fa),Vn(a,ha,s),Vn(a,kh,a),Vn(s,ha,s),Vn(s,fa),Vn(s,kh,s);const l=Ve(n,P1,uT,{[C1]:!0}),c=Ve(n,iP,Q2,{[C1]:!0}),u=Vn(n,I1,Q2,{[C1]:!0});Ve(n,O1,u),Ve(c,P1,l),Ve(c,O1,u),Vn(c,I1,u),Ve(u,iP),Ve(u,P1),Vn(u,I1,u),Ve(u,O1,u);const d=Vn(n,A1,BL,{[NL]:!0});Ve(d,"#"),Vn(d,A1,d),Ve(d,efe,d);const f=Ve(d,tfe);Ve(f,"#"),Vn(f,A1,d);const h=[[fa,o],[ha,i]],p=[[fa,null],[kh,a],[ha,s]];for(let m=0;m<lg.length;m++)Cl(n,lg[m],G2,pa,h);for(let m=0;m<cg.length;m++)Cl(n,cg[m],Z2,K2,p);uu(G2,{tld:!0,ascii:!0},e),uu(Z2,{utld:!0,alpha:!0},e),Cl(n,"file",Lg,pa,h),Cl(n,"mailto",Lg,pa,h),Cl(n,"http",vd,pa,h),Cl(n,"https",vd,pa,h),Cl(n,"ftp",vd,pa,h),Cl(n,"ftps",vd,pa,h),uu(Lg,{scheme:!0,ascii:!0},e),uu(vd,{slashscheme:!0,ascii:!0},e),t=t.sort((m,g)=>m[0]>g[0]?1:-1);for(let m=0;m<t.length;m++){const g=t[m][0],b=t[m][1]?{[Qde]:!0}:{[Xde]:!0};g.indexOf("-")>=0?b[q2]=!0:fa.test(g)?ha.test(g)?b[np]=!0:b[W2]=!0:b[V2]=!0,rP(n,g,g,b)}return rP(n,"localhost",Lp,{ascii:!0}),n.jd=new Bi(Ay),{start:n,tokens:Object.assign({groups:e},FL)}}function $L(t,e){const n=rfe(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,i=[];let s=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,d=-1,f=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(d=0,f=0,u=a):d>=0&&(d+=n[o].length,f++),c+=n[o].length,s+=n[o].length,o++;s-=d,o-=f,c-=d,i.push({t:u.t,v:e.slice(s-c,s),s:s-c,e:s})}return i}function rfe(t){const e=[],n=t.length;let r=0;for(;r<n;){let i=t.charCodeAt(r),s,o=i<55296||i>56319||r+1===n||(s=t.charCodeAt(r+1))<56320||s>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function Cl(t,e,n,r,i){let s;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?s=t.j[l]:(s=new Bi(r),s.jr=i.slice(),t.j[l]=s),t=s}return s=new Bi(n),s.jr=i.slice(),t.j[e[o-1]]=s,s}function sP(t){const e=[],n=[];let r=0,i="0123456789";for(;r<t.length;){let s=0;for(;i.indexOf(t[r+s])>=0;)s++;if(s>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+s),10);o>0;o--)n.pop();r+=s}else n.push(t[r]),r++}return e}const Bp={defaultProtocol:"http",events:null,format:oP,formatHref:oP,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function mT(t,e=null){let n=Object.assign({},Bp);t&&(n=Object.assign(n,t instanceof mT?t.o:t));const r=n.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=i}mT.prototype={o:Bp,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:Bp[t],typeof i=="function"&&r&&(i=i(e,n))):typeof i=="function"&&r&&(i=i(e,n.t,n)),i)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function oP(t){return t}function zL(t,e){this.t="token",this.v=t,this.tk=e}zL.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"â¦":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Bp.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),i=t.get("tagName",n,e),s=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),d=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:i,attributes:o,content:s,eventListeners:d}}};function Zb(t,e){class n extends zL{constructor(i,s){super(i,s),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const aP=Zb("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),lP=Zb("text"),ife=Zb("nl"),ug=Zb("url",{isLink:!0,toHref(t=Bp.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Lp&&t[1].t===ql}}),ps=t=>new Bi(t);function sfe({groups:t}){const e=t.domain.concat([gy,by,$l,wy,vy,xy,Sy,Ey,gs,cT,sp,ky,Ty,_y,ko,Ay,ap,Cy]),n=[yy,ql,dT,Eo,fT,sp,op,hT,pT,oy,ay,rp,ip,ry,ny,iy,sy,ly,cy,uy,dy,fy,hy,py,my],r=[gy,yy,by,wy,vy,xy,Sy,Ey,gs,rp,ip,sp,ky,Ty,_y,op,ko,Ay,ap,Cy],i=ps(),s=Ve(i,ap);$t(s,r,s),$t(s,t.domain,s);const o=ps(),a=ps(),l=ps();$t(i,t.domain,o),$t(i,t.scheme,a),$t(i,t.slashscheme,l),$t(o,r,s),$t(o,t.domain,o);const c=Ve(o,$l);Ve(s,$l,c),Ve(a,$l,c),Ve(l,$l,c);const u=Ve(s,Eo);$t(u,r,s),$t(u,t.domain,s);const d=ps();$t(c,t.domain,d),$t(d,t.domain,d);const f=Ve(d,Eo);$t(f,t.domain,d);const h=ps(aP);$t(f,t.tld,h),$t(f,t.utld,h),Ve(c,Lp,h);const p=Ve(d,gs);Ve(p,gs,p),$t(p,t.domain,d),$t(h,t.domain,d),Ve(h,Eo,f),Ve(h,gs,p);const m=Ve(h,ql);$t(m,t.numeric,aP);const g=Ve(o,gs),y=Ve(o,Eo);Ve(g,gs,g),$t(g,t.domain,o),$t(y,r,s),$t(y,t.domain,o);const b=ps(ug);$t(y,t.tld,b),$t(y,t.utld,b),$t(b,t.domain,o),$t(b,r,s),Ve(b,Eo,y),Ve(b,gs,g),Ve(b,$l,c);const E=Ve(b,ql),C=ps(ug);$t(E,t.numeric,C);const I=ps(ug),x=ps();$t(I,e,I),$t(I,n,x),$t(x,e,I),$t(x,n,x),Ve(b,ko,I),Ve(C,ko,I);const P=Ve(a,ql),T=Ve(l,ql),S=Ve(T,ko),_=Ve(S,ko);$t(a,t.domain,o),Ve(a,Eo,y),Ve(a,gs,g),$t(l,t.domain,o),Ve(l,Eo,y),Ve(l,gs,g),$t(P,t.domain,I),Ve(P,ko,I),Ve(P,op,I),$t(_,t.domain,I),$t(_,e,I),Ve(_,ko,I);const O=[[rp,ip],[ny,ry],[iy,sy],[oy,ay],[ly,cy],[uy,dy],[fy,hy],[py,my]];for(let F=0;F<O.length;F++){const[L,B]=O[F],N=Ve(I,L);Ve(x,L,N),Ve(N,B,I);const M=ps(ug);$t(N,e,M);const R=ps();$t(N,n),$t(M,e,M),$t(M,n,R),$t(R,e,M),$t(R,n,R),Ve(M,B,I),Ve(R,B,I)}return Ve(i,Lp,b),Ve(i,uT,ife),{start:i,tokens:FL}}function ofe(t,e,n){let r=n.length,i=0,s=[],o=[];for(;i<r;){let a=t,l=null,c=null,u=0,d=null,f=-1;for(;i<r&&!(l=a.go(n[i].t));)o.push(n[i++]);for(;i<r&&(c=l||a.go(n[i].t));)l=null,a=c,a.accepts()?(f=0,d=a):f>=0&&f++,i++,u++;if(f<0)i-=u,i<r&&(o.push(n[i]),i++);else{o.length>0&&(s.push(M1(lP,e,o)),o=[]),i-=f,u-=f;const h=d.t,p=n.slice(i-u,i);s.push(M1(h,e,p))}}return o.length>0&&s.push(M1(lP,e,o)),s}function M1(t,e,n){const r=n[0].s,i=n[n.length-1].e,s=e.slice(r,i);return new t(s,n)}const afe=typeof console<"u"&&console&&console.warn||(()=>{}),lfe="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Rn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function cfe(){return Bi.groups={},Rn.scanner=null,Rn.parser=null,Rn.tokenQueue=[],Rn.pluginQueue=[],Rn.customSchemes=[],Rn.initialized=!1,Rn}function cP(t,e=!1){if(Rn.initialized&&afe(`linkifyjs: already initialized - will not register custom scheme "${t}" ${lfe}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Rn.customSchemes.push([t,e])}function ufe(){Rn.scanner=nfe(Rn.customSchemes);for(let t=0;t<Rn.tokenQueue.length;t++)Rn.tokenQueue[t][1]({scanner:Rn.scanner});Rn.parser=sfe(Rn.scanner.tokens);for(let t=0;t<Rn.pluginQueue.length;t++)Rn.pluginQueue[t][1]({scanner:Rn.scanner,parser:Rn.parser});return Rn.initialized=!0,Rn}function gT(t){return Rn.initialized||ufe(),ofe(Rn.parser.start,t,$L(Rn.scanner.start,t))}gT.scan=$L;function UL(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new mT(n),i=gT(t),s=[];for(let o=0;o<i.length;o++){const a=i[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&s.push(a.toFormattedObject(r))}return s}var yT="[\0- Â áá â-\u2029âã]",dfe=new RegExp(yT),ffe=new RegExp(`${yT}$`),hfe=new RegExp(yT,"g");function pfe(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function mfe(t){return new un({key:new An("autolink"),appendTransaction:(e,n,r)=>{const i=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=r,a=Yk(n.doc,[...e]);if(nT(a).forEach(({newRange:c})=>{const u=XD(r.doc,c,h=>h.isTextblock);let d,f;if(u.length>1)d=u[0],f=r.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const h=r.doc.textBetween(c.from,c.to," "," ");if(!ffe.test(h))return;d=u[0],f=r.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&f){const h=f.split(dfe).filter(Boolean);if(h.length<=0)return!1;const p=h[h.length-1],m=d.pos+f.lastIndexOf(p);if(!p)return!1;const g=gT(p).map(y=>y.toObject(t.defaultProtocol));if(!pfe(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:m+y.start+1,to:m+y.end+1})).filter(y=>r.schema.marks.code?!r.doc.rangeHasMark(y.from,y.to,r.schema.marks.code):!0).filter(y=>t.validate(y.value)).filter(y=>t.shouldAutoLink(y.value)).forEach(y=>{rT(y.from,y.to,r.doc).some(b=>b.mark.type===t.type)||o.addMark(y.from,y.to,t.type.create({href:y.href}))})}}),!!o.steps.length)return o}})}function gfe(t){return new un({key:new An("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,s;if(r.button!==0||!e.editable)return!1;let o=null;if(r.target instanceof HTMLAnchorElement)o=r.target;else{let u=r.target;const d=[];for(;u.nodeName!=="DIV";)d.push(u),u=u.parentNode;o=d.find(f=>f.nodeName==="A")}if(!o)return!1;const a=rL(e.state,t.type.name),l=(i=o?.href)!=null?i:a.href,c=(s=o?.target)!=null?s:a.target;return t.enableClickSelection&&t.editor.commands.extendMarkRange(t.type.name),o&&l?(window.open(l,c),!0):!1}}})}function yfe(t){return new un({key:new An("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{shouldAutoLink:i}=t,{state:s}=e,{selection:o}=s,{empty:a}=o;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=UL(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||i!==void 0&&!i(c.href)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function jc(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const i=typeof r=="string"?r:r.scheme;i&&n.push(i)}),!t||t.replace(hfe,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var HL=Ku.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){cP(t);return}cP(t.scheme,t.optionalSlashes)})},onDestroy(){cfe()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!jc(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!jc(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!jc(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Gn(this.options.HTMLAttributes,t),0]:["a",Gn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n;const r=((n=t.attrs)==null?void 0:n.href)||"";return`[${e.renderChildren(t)}](${r})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!jc(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!jc(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[$u({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,i=UL(t).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:o=>!!jc(o,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(s=>{this.options.shouldAutoLink(s.value)&&e.push({text:s.value,data:{href:s.href},index:s.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(mfe({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:i=>!!jc(i,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(gfe({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(yfe({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),bfe=HL,wfe=Object.defineProperty,vfe=(t,e)=>{for(var n in e)wfe(t,n,{get:e[n],enumerable:!0})},xfe="listItem",uP="textStyle",dP=/^\s*([-+*])\s$/,VL=Ci.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Gn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(xfe,this.editor.getAttributes(uP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=xf({find:dP,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=xf({find:dP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(uP),editor:this.editor})),[t]}}),WL=Ci.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Gn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))n=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const o=t.tokens.slice(1),a=e.parseChildren(o);n.push(...a)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>aT(t,e,r=>r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${r.index+1}. `:"- ",n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Sfe={};vfe(Sfe,{findListItemPos:()=>ym,getNextListDepth:()=>bT,handleBackspace:()=>X2,handleDelete:()=>Y2,hasListBefore:()=>jL,hasListItemAfter:()=>Efe,hasListItemBefore:()=>qL,listItemHasSubList:()=>KL,nextListIsDeeper:()=>GL,nextListIsHigher:()=>ZL});var ym=(t,e)=>{const{$from:n}=e.selection,r=cr(t,e.schema);let i=null,s=n.depth,o=n.pos,a=null;for(;s>0&&a===null;)i=n.node(s),i.type===r?a=s:(s-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},bT=(t,e)=>{const n=ym(t,e);if(!n)return!1;const[,r]=wce(e,t,n.$pos.pos+4);return r},jL=(t,e,n)=>{const{$anchor:r}=t.selection,i=Math.max(0,r.pos-2),s=t.doc.resolve(i).node();return!(!s||!n.includes(s.type.name))},qL=(t,e)=>{var n;const{$anchor:r}=e.selection,i=e.doc.resolve(r.pos-2);return!(i.index()===0||((n=i.nodeBefore)==null?void 0:n.type.name)!==t)},KL=(t,e,n)=>{if(!n)return!1;const r=cr(t,e.schema);let i=!1;return n.descendants(s=>{s.type===r&&(i=!0)}),i},X2=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!Tc(t.state,e)&&jL(t.state,e,n)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((f,h)=>{f.type.name===e&&c.push({node:f,pos:h})});const u=c.at(-1);if(!u)return!1;const d=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!Tc(t.state,e)||!Ece(t.state))return!1;const r=ym(e,t.state);if(!r)return!1;const s=t.state.doc.resolve(r.$pos.pos-2).node(r.depth),o=KL(e,t.state,s);return qL(e,t.state)&&!o?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},GL=(t,e)=>{const n=bT(t,e),r=ym(t,e);return!r||!n?!1:n>r.depth},ZL=(t,e)=>{const n=bT(t,e),r=ym(t,e);return!r||!n?!1:n<r.depth},Y2=(t,e)=>{if(!Tc(t.state,e)||!Sce(t.state,e))return!1;const{selection:n}=t.state,{$from:r,$to:i}=n;return!n.empty&&r.sameParent(i)?!1:GL(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():ZL(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},Efe=(t,e)=>{var n;const{$anchor:r}=e.selection,i=e.doc.resolve(r.pos-r.parentOffset-2);return!(i.index()===i.parent.childCount-1||((n=i.nodeAfter)==null?void 0:n.type.name)!==t)},QL=In.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&Y2(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&Y2(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&X2(t,n,r)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&X2(t,n,r)&&(e=!0)}),e}}}}),fP=/^(\s*)(\d+)\.\s+(.*)$/,kfe=/^\s/;function Tfe(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n],s=i.match(fP);if(!s)break;const[,o,a,l]=s,c=o.length;let u=l,d=n+1;const f=[i];for(;d<t.length;){const h=t[d];if(h.match(fP))break;if(h.trim()==="")f.push(h),u+=`
`,d+=1;else if(h.match(kfe))f.push(h),u+=`
${h.slice(c+2)}`,d+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:f.join(`
`)}),r=d,n=d}return[e,r]}function XL(t,e,n){var r;const i=[];let s=0;for(;s<t.length;){const o=t[s];if(o.indent===e){const a=o.content.split(`
`),l=((r=a[0])==null?void 0:r.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const h=n.blockTokens(u);c.push(...h)}let d=s+1;const f=[];for(;d<t.length&&t[d].indent>e;)f.push(t[d]),d+=1;if(f.length>0){const h=Math.min(...f.map(m=>m.indent)),p=XL(f,h,n);c.push({type:"list",ordered:!0,start:f[0].number,items:p,raw:f.map(m=>m.raw).join(`
`)})}i.push({type:"list_item",raw:o.raw,tokens:c}),s=d}else s+=1}return i}function _fe(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const r=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")r.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const s=e.parseChildren([i]);r.push({type:"paragraph",content:s})}else{const s=e.parseChildren([i]);s.length>0&&r.push(...s)}}),{type:"listItem",content:r}})}var Cfe="listItem",hP="textStyle",pP=/^(\d+)\.\s$/,YL=Ci.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",Gn(this.options.HTMLAttributes,n),0]:["ol",Gn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,r=t.items?_fe(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e?.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var r;const i=t.split(`
`),[s,o]=Tfe(i);if(s.length===0)return;const a=XL(s,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((r=s[0])==null?void 0:r.number)||1,items:a,raw:i.slice(0,o).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Cfe,this.editor.getAttributes(hP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=xf({find:pP,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=xf({find:pP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(hP)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),Afe=/^\s*(\[([( |x])?\])\s$/,Ife=Ci.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Gn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const r=e.parseChildren(t.nestedTokens);n.push(...r)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const i=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return aT(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const i=document.createElement("li"),s=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var d,f;a.ariaLabel=((f=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:f.call(d,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(t),s.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const h=n();if(typeof h!="number")return!1;const p=f.doc.nodeAt(h);return f.setNodeMarkup(h,void 0,{...p?.attrs,checked:d}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{i.setAttribute(u,d)}),i.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,s.append(a,o),i.append(s,l),Object.entries(e).forEach(([u,d])=>{i.setAttribute(u,d)}),{dom:i,contentDOM:l,update:u=>u.type!==this.type?!1:(i.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[xf({find:Afe,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),Pfe=Ci.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Gn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const r=s=>{const o=$2(s,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:r},n);return o?[{type:"taskList",raw:o.raw,items:o.items}]:n.blockTokens(s)},i=$2(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:s=>({indentLevel:s[1].length,mainContent:s[4],checked:s[3].toLowerCase()==="x"}),createToken:(s,o)=>({type:"taskItem",raw:"",mainContent:s.mainContent,indentLevel:s.indentLevel,checked:s.checked,text:s.mainContent,tokens:n.inlineTokens(s.mainContent),nestedTokens:o}),customNestedParser:r},n);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});In.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(VL.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(WL.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(QL.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(YL.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(Ife.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(Pfe.configure(this.options.taskList)),t}});var Ofe=Ci.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Gn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];return n.length===1&&n[0].type==="image"?e.parseChildren([n[0]]):e.createNode("paragraph",void 0,e.parseInline(n))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Mfe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Nfe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Rfe=Ku.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Gn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[vf({find:Mfe,type:this.type})]},addPasteRules(){return[$u({find:Nfe,type:this.type})]}}),Dfe=Ci.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),Lfe=Ku.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Gn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const s=i[2].trim();return{type:"underline",raw:i[0],text:s,tokens:n.inlineTokens(s)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function Bfe(t={}){return new un({view(e){return new Ffe(e,t)}})}class Ffe{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,i=this.editorView.dom,s=i.getBoundingClientRect(),o=s.width/i.offsetWidth,a=s.height/i.offsetHeight;if(n){let d=e.nodeBefore,f=e.nodeAfter;if(d||f){let h=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(h){let p=h.getBoundingClientRect(),m=d?p.bottom:p.top;d&&f&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*a;r={left:p.left,right:p.right,top:m-g,bottom:m+g}}}}if(!r){let d=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;r={left:d.left-f,right:d.left+f,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),f=d.width/l.offsetWidth,h=d.height/l.offsetHeight;c=d.left-l.scrollLeft*f,u=d.top-l.scrollTop*h}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n,e):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=H5(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class Un extends zt{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Un.valid(r)?new Un(r):zt.near(r)}content(){return nt.empty}eq(e){return e instanceof Un&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Un(e.resolve(n.pos))}getBookmark(){return new wT(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!$fe(e)||!zfe(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Un.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(Un.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!ut.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(Un.valid(a))return a}return null}}}Un.prototype.visible=!1;Un.findFrom=Un.findGapCursorFrom;zt.jsonID("gapcursor",Un);class wT{constructor(e){this.pos=e}map(e){return new wT(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Un.valid(n)?new Un(n):zt.near(n)}}function JL(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function $fe(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||JL(i.type))return!0;if(i.inlineContent)return!1}}return!0}function zfe(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||JL(i.type))return!0;if(i.inlineContent)return!1}}return!0}function Ufe(){return new un({props:{decorations:jfe,createSelectionBetween(t,e,n){return e.pos==n.pos&&Un.valid(n)?new Un(n):null},handleClick:Vfe,handleKeyDown:Hfe,handleDOMEvents:{beforeinput:Wfe}}})}const Hfe=HD({ArrowLeft:dg("horiz",-1),ArrowRight:dg("horiz",1),ArrowUp:dg("vert",-1),ArrowDown:dg("vert",1)});function dg(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof Ct){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=Un.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new Un(c))),!0):!1}}function Vfe(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Un.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&ut.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Un(r))),!0)}function Wfe(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Un))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=De.empty;for(let o=r.length-1;o>=0;o--)i=De.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new nt(i,0,0));return s.setSelection(Ct.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function jfe(t){if(!(t.selection instanceof Un))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",xn.create(t.doc,[Sr.widget(t.selection.head,e,{key:"gapcursor"})])}var Iy=200,kr=function(){};kr.prototype.append=function(e){return e.length?(e=kr.from(e),!this.length&&e||e.length<Iy&&this.leafAppend(e)||this.length<Iy&&e.leafPrepend(this)||this.appendInner(e)):this};kr.prototype.prepend=function(e){return e.length?kr.from(e).append(this):this};kr.prototype.appendInner=function(e){return new qfe(this,e)};kr.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?kr.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};kr.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};kr.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};kr.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};kr.from=function(e){return e instanceof kr?e:e&&e.length?new e6(e):kr.empty};var e6=(function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=Iy)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=Iy)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(kr);kr.empty=new e6([]);var qfe=(function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(kr);const Kfe=500;class Gs{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((d,f)=>{if(!d.step){i||(i=this.remapping(r,f+1),s=i.maps.length),s--,u.push(d);return}if(i){u.push(new To(d.map));let h=d.step.map(i.slice(s)),p;h&&o.maybeStep(h).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new To(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(d.step);if(d.selection)return a=i?d.selection.map(i.slice(s)):d.selection,l=new Gs(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let d=e.steps[u].invert(e.docs[u]),f=new To(e.mapping.maps[u],d,n),h;(h=l&&l.merge(f))&&(f=h,u?s.pop():a=a.slice(0,a.length-1)),s.push(f),n&&(o++,n=void 0),i||(l=f)}let c=o-r.depth;return c>Zfe&&(a=Gfe(a,c),o-=c),new Gs(a.append(s),o)}remapping(e,n){let r=new Ap;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Gs(this.items.append(e.map(n=>new To(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(f=>{f.selection&&a--},i);let l=n;this.items.forEach(f=>{let h=s.getMirror(--l);if(h==null)return;o=Math.min(o,h);let p=s.maps[h];if(f.step){let m=e.steps[h].invert(e.docs[h]),g=f.selection&&f.selection.map(s.slice(l+1,h));g&&a++,r.push(new To(p,m,g))}else r.push(new To(p))},i);let c=[];for(let f=n;f<o;f++)c.push(new To(s.maps[f]));let u=this.items.slice(0,i).append(c).append(r),d=new Gs(u,a);return d.emptyItemCount()>Kfe&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let d=new To(c.invert(),l,u),f,h=i.length-1;(f=i.length&&i[h].merge(d))?i[h]=f:i.push(d)}}else o.map&&r--},this.items.length,0),new Gs(kr.from(i.reverse()),s)}}Gs.empty=new Gs(kr.empty,0);function Gfe(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class To{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new To(n.getMap().invert(),n,this.selection)}}}class zl{constructor(e,n,r,i,s){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const Zfe=20;function Qfe(t,e,n,r){let i=n.getMeta(Su),s;if(i)return i.historyState;n.getMeta(Jfe)&&(t=new zl(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Su))return o.getMeta(Su).redo?new zl(t.done.addTransform(n,void 0,r,Bg(e)),t.undone,mP(n.mapping.maps),t.prevTime,t.prevComposition):new zl(t.done,t.undone.addTransform(n,void 0,r,Bg(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!Xfe(n,t.prevRanges)),c=o?N1(t.prevRanges,n.mapping):mP(n.mapping.maps);return new zl(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,Bg(e)),Gs.empty,c,n.time,a??t.prevComposition)}else return(s=n.getMeta("rebased"))?new zl(t.done.rebased(n,s),t.undone.rebased(n,s),N1(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new zl(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),N1(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function Xfe(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function mP(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,i,s,o)=>e.push(s,o));return e}function N1(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function Yfe(t,e,n){let r=Bg(e),i=Su.get(e).spec.config,s=(n?t.undone:t.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(n?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),l=new zl(n?a:s.remaining,n?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(Su,{redo:n,historyState:l})}let R1=!1,gP=null;function Bg(t){let e=t.plugins;if(gP!=e){R1=!1,gP=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){R1=!0;break}}return R1}const Su=new An("history"),Jfe=new An("closeHistory");function ehe(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new un({key:Su,state:{init(){return new zl(Gs.empty,Gs.empty,null,0,-1)},apply(e,n,r){return Qfe(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?n6:r=="historyRedo"?r6:null;return i?(n.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function t6(t,e){return(n,r)=>{let i=Su.getState(n);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(r){let s=Yfe(i,n,t);s&&r(e?s.scrollIntoView():s)}return!0}}const n6=t6(!1,!0),r6=t6(!0,!0);In.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new un({key:new An("characterCount"),appendTransaction:(e,n,r)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const s=this.storage.characters({node:r.doc});if(s>i){const o=s-i,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const i=this.storage.characters({node:n.doc}),s=this.storage.characters({node:e.doc});if(s<=r||i>r&&s>r&&s<=i)return!0;if(i>r&&s>r&&s>i||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=s-r,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>r)}})]}});var the=In.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Bfe(this.options)]}}),nhe=In.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new un({key:new An("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:i}=e,s=[];if(!n||!r)return xn.create(t,[]);let o=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(i>=c&&i<=c+l.nodeSize-1))return!1;o+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(i>=c&&i<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";s.push(Sr.node(c,c+l.nodeSize,{class:this.options.className}))}),xn.create(t,s)}}})]}}),rhe=In.create({name:"gapCursor",addProseMirrorPlugins(){return[Ufe()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=gn(gt(t,"allowGapCursor",n)))!=null?e:null}}}),ihe=In.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something â¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new un({key:new An("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,i=[];if(!n)return null;const s=this.editor.isEmpty;return t.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&Wb(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];s&&u.push(this.options.emptyEditorClass);const d=Sr.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});i.push(d)}return this.options.includeChildren}),xn.create(t,i)}}})]}});In.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new un({key:new An("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||iL(n.selection)||t.view.dragging?null:xn.create(n.doc,[Sr.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function yP({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var she=In.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new An(this.name),n=((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||this.options.node||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(n).includes(i.name));return[new un({key:e,appendTransaction:(i,s,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),d=a.content.size,f=c.nodes[n];if(u)return l.insert(d,f.create())},state:{init:(i,s)=>{const o=s.tr.doc.lastChild;return!yP({node:o,types:r})},apply:(i,s)=>{if(!i.docChanged)return s;const o=i.doc.lastChild;return!yP({node:o,types:r})}}})]}}),ohe=In.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>n6(t,e),redo:()=>({state:t,dispatch:e})=>r6(t,e)}},addProseMirrorPlugins(){return[ehe(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),ahe=In.create({name:"starterKit",addExtensions(){var t,e,n,r;const i=[];return this.options.bold!==!1&&i.push(Mde.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(Cde.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(VL.configure(this.options.bulletList)),this.options.code!==!1&&i.push(Dde.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(Fde.configure(this.options.codeBlock)),this.options.document!==!1&&i.push($de.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(the.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(rhe.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(zde.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(Ude.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(ohe.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(Hde.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(Kde.configure(this.options.italic)),this.options.listItem!==!1&&i.push(WL.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(QL.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(HL.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(YL.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(Ofe.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(Rfe.configure(this.options.strike)),this.options.text!==!1&&i.push(Dfe.configure(this.options.text)),this.options.underline!==!1&&i.push(Lfe.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&i.push(she.configure((r=this.options)==null?void 0:r.trailingNode)),i}}),lhe=ahe,che=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,uhe=Ci.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",Gn(this.options.HTMLAttributes,t)]},parseMarkdown:(t,e)=>e.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var e,n,r,i,s,o;const a=(n=(e=t.attrs)==null?void 0:e.src)!=null?n:"",l=(i=(r=t.attrs)==null?void 0:r.alt)!=null?i:"",c=(o=(s=t.attrs)==null?void 0:s.title)!=null?o:"";return c?`![${l}](${a} "${c}")`:`![${l}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u"||!this.editor.isEditable)return null;const{directions:t,minWidth:e,minHeight:n,alwaysPreserveAspectRatio:r}=this.options.resize;return({node:i,getPos:s,HTMLAttributes:o})=>{const a=document.createElement("img");Object.entries(o).forEach(([u,d])=>{if(d!=null)switch(u){case"width":case"height":break;default:a.setAttribute(u,d);break}}),a.src=o.src;const l=new sue({element:a,node:i,getPos:s,onResize:(u,d)=>{a.style.width=`${u}px`,a.style.height=`${d}px`},onCommit:(u,d)=>{const f=s();f!==void 0&&this.editor.chain().setNodeSelection(f).updateAttributes(this.name,{width:u,height:d}).run()},onUpdate:(u,d,f)=>u.type===i.type,options:{directions:t,min:{width:e,height:n},preserveAspectRatio:r===!0}}),c=l.dom;return c.style.visibility="hidden",c.style.pointerEvents="none",a.onload=()=>{c.style.visibility="",c.style.pointerEvents=""},l}},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[bL({find:che,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),dhe=uhe,Ir=[];for(var D1=0;D1<256;++D1)Ir.push((D1+256).toString(16).slice(1));function fhe(t,e=0){return(Ir[t[e+0]]+Ir[t[e+1]]+Ir[t[e+2]]+Ir[t[e+3]]+"-"+Ir[t[e+4]]+Ir[t[e+5]]+"-"+Ir[t[e+6]]+Ir[t[e+7]]+"-"+Ir[t[e+8]]+Ir[t[e+9]]+"-"+Ir[t[e+10]]+Ir[t[e+11]]+Ir[t[e+12]]+Ir[t[e+13]]+Ir[t[e+14]]+Ir[t[e+15]]).toLowerCase()}var fg,hhe=new Uint8Array(16);function phe(){if(!fg&&(fg=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!fg))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return fg(hhe)}var mhe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const bP={randomUUID:mhe};function ghe(t,e,n){if(bP.randomUUID&&!t)return bP.randomUUID();t=t||{};var r=t.random||(t.rng||phe)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,fhe(r)}function yhe(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function bhe(t){const e=t.filter((r,i)=>t.indexOf(r)!==i);return yhe(e)}var whe=In.create({name:"uniqueID",priority:1e4,addOptions(){return{attributeName:"id",types:[],generateID:()=>ghe(),filterTransaction:null,updateDocument:!0}},addGlobalAttributes(){return[{types:this.options.types,attributes:{[this.options.attributeName]:{default:null,parseHTML:t=>t.getAttribute(`data-${this.options.attributeName}`),renderHTML:t=>t[this.options.attributeName]?{[`data-${this.options.attributeName}`]:t[this.options.attributeName]}:{}}}}]},onCreate(){var t;if(!this.options.updateDocument)return;const e=this.editor.extensionManager.extensions.find(a=>a.name==="collaboration"),n=this.editor.extensionManager.extensions.find(a=>a.name==="collaborationCaret"),i=[e,n].filter(Boolean).find(a=>{var l;return(l=a?.options)==null?void 0:l.provider}),s=(t=i?.options)==null?void 0:t.provider,o=()=>{const{view:a,state:l}=this.editor,{tr:c,doc:u}=l,{types:d,attributeName:f,generateID:h}=this.options;cce(u,m=>d.includes(m.type.name)&&m.attrs[f]===null).forEach(({node:m,pos:g})=>{c.setNodeMarkup(g,void 0,{...m.attrs,[f]:h({node:m,pos:g})})}),c.setMeta("addToHistory",!1),a.dispatch(c),s&&s.off("synced",o)};if(i){if(!s)return o();s.on("synced",o)}else return o()},addProseMirrorPlugins(){if(!this.options.updateDocument)return[];let t=null,e=!1;return[new un({key:new An("uniqueID"),appendTransaction:(n,r,i)=>{const s=n.some(m=>m.docChanged)&&!r.doc.eq(i.doc),o=this.options.filterTransaction&&n.some(m=>{var g,y;return!((y=(g=this.options).filterTransaction)!=null&&y.call(g,m))});if(n.find(m=>m.getMeta("y-sync$"))||!s||o)return;const{tr:l}=i,{types:c,attributeName:u,generateID:d}=this.options,f=Yk(r.doc,n),{mapping:h}=f;if(nT(f).forEach(({newRange:m})=>{const g=XD(i.doc,m,b=>c.includes(b.type.name)),y=g.map(({node:b})=>b.attrs[u]).filter(b=>b!==null);g.forEach(({node:b,pos:E},C)=>{var I;const x=(I=l.doc.nodeAt(E))==null?void 0:I.attrs[u];if(x===null){l.setNodeMarkup(E,void 0,{...b.attrs,[u]:d({node:b,pos:E})});return}const P=g[C+1];if(P&&b.content.size===0){if(l.setNodeMarkup(P.pos,void 0,{...P.node.attrs,[u]:x}),y[C+1]=x,P.node.attrs[u])return;const O=d({node:b,pos:E});return l.setNodeMarkup(E,void 0,{...b.attrs,[u]:O}),y[C]=O,l}const T=bhe(y),{deleted:S}=h.invert().mapResult(E);S&&T.includes(x)&&l.setNodeMarkup(E,void 0,{...b.attrs,[u]:d({node:b,pos:E})})})}),!!l.steps.length)return l.setStoredMarks(i.tr.storedMarks),l},view(n){const r=i=>{var s;t=(s=n.dom.parentElement)!=null&&s.contains(i.target)?n.dom.parentElement:null};return window.addEventListener("dragstart",r),{destroy(){window.removeEventListener("dragstart",r)}}},props:{handleDOMEvents:{drop:(n,r)=>{var i,s;return(t!==n.dom.parentElement||((i=r.dataTransfer)==null?void 0:i.effectAllowed)==="copyMove"||((s=r.dataTransfer)==null?void 0:s.effectAllowed)==="copy")&&(t=null,e=!0),!1},paste:()=>(e=!0,!1)},transformPasted:n=>{if(!e)return n;const{types:r,attributeName:i}=this.options,s=o=>{const a=[];return o.forEach(l=>{if(l.isText){a.push(l);return}if(!r.includes(l.type.name)){a.push(l.copy(s(l.content)));return}const c=l.type.create({...l.attrs,[i]:null},s(l.content),l.marks);a.push(c)}),De.from(a)};return e=!1,new nt(s(n.content),n.openStart,n.openEnd)}}})]}}),vhe=whe;function xhe(t,e,n,r,i,s,o){const a=window,l=navigator,c=o?.editorObj??window.__currentEditor,u=nr,d=typeof u=="function"?u:Ys(u);return[{label:d("imageContextMenu.fullscreen"),action:()=>{let f=c?.view?.dom||document.querySelector(".editor-container")||a;typeof f.dispatchEvent!="function"&&(f=window),f.dispatchEvent(new CustomEvent("image-fullscreen-request",{detail:{src:t,alt:e},bubbles:!0,composed:!0}))},src:t,icon:"/icons/expand-solid-full.svg"},{label:d("imageContextMenu.copyUrl"),action:async()=>{Kb(t,"image URL",l,a)},src:t,icon:"/icons/copy-solid-full.svg"},{label:d("imageContextMenu.delete"),action:()=>{const f=c?.view;if(f?.state&&f?.dispatch){let h=!1;f.state.doc.descendants((p,m)=>{if(!h&&p.type.name==="image"&&p.attrs.id===s)return f.dispatch(f.state.tr.delete(m,m+p.nodeSize)),h=!0,!1})}},disabled:!1,src:t,icon:"/icons/trash-solid-full.svg"}]}function She(t,e,n,r,i){const s=((l,c,...u)=>setTimeout(l,c,...u));let o=!1,a;if(t.update(l=>(o=l.open&&l.nodeId!==e,a=l.nodeId,l)),o&&a){t.set({open:!1,nodeId:void 0,src:void 0}),s(()=>{t.set({open:!0,nodeId:e,src:r})},0);return}t.set({open:!0,nodeId:e,src:r})}function Ehe(t,e,n,r){if(!t.open||!t.nodeId)return null;const i=t.nodeId,s=t.src||"",o="Image";let a=0,l=1;e?.state?.doc&&e.state.doc.descendants((f,h)=>{if(f.attrs.id===i)return a=h,l=f.nodeSize,!1});const u=xhe(s,o,()=>a,l,!0,i,{editorObj:e});let d={x:0,y:0};return n&&(d=Kd(n.x,n.y)),{items:u,x:d.x,y:d.y}}function khe(t,e,n){e(t,!1),n()}function The(t){t.preventDefault()}var _he=_e("<canvas></canvas>"),Che=_e('<img draggable="false" style="z-index:2; position:relative;"/>'),Ahe=_e('<button type="button" class="editor-image-button svelte-bckq2i" tabindex="0"><!> <!></button>');function Ihe(t,e){St(e,!0);let n=SP,r=EP,i=ge(!1),s=ge(!1),o=ge(void 0),a=ge(void 0);const l=Ra(),c=400;let u=ae(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src&&e.node.attrs.src.startsWith("placeholder-")),d=ae(()=>!k(u)&&e.node.attrs.src&&!e.node.attrs.src.startsWith("placeholder-")),f=ae(()=>e.node.attrs.blurhash&&(k(u)||!k(i)||k(s))),h=ge(null);const p=!1;Ge(()=>{const L=e.node.attrs.src;if(!L)return;const B=U2.value[L];if(B){K(h,B,!0);return}const N=die(e.node.attrs.dim);if(N){const M=f5(N.width,N.height);K(h,M,!0),U2.update(R=>({...R,[L]:M}))}else k(u)&&K(h,r1(),!0)});let m=ge(!1),g=ae(()=>za.value);const y=ae(()=>e.node.attrs.id||`fallback-${typeof e.getPos=="function"?e.getPos():"unknown"}`);Ge(()=>{is.subscribe(L=>{(!L.open||L.nodeId!==k(y))&&K(m,!1)})});function b(){k(g)&&She(is,k(y),k(g),e.node.attrs.src)}function E(L,B=!1){const N=Cd(L);za.set(N),_ie(L,B,n.isDragging,k(u),e.selected,r.justSelected,e.node.attrs.src,e.node.attrs.alt||"Image",e.getPos)&&!e.selected&&(r.justSelectedTimeout&&clearTimeout(r.justSelectedTimeout),r.justSelected=!0,r.justSelectedTimeout=setTimeout(()=>{r.justSelected=!1,r.justSelectedTimeout=null},c))}function C(){n.isDragging=!0,vh("start",{},e.getPos),n.preview=Sie(n.startTarget,n.startPos.x,n.startPos.y,k(u))}function I(){n.longPressTimeout&&(clearTimeout(n.longPressTimeout),n.longPressTimeout=null),n.startTarget=null}function x(L,B,N){I(),n.startPos={x:B,y:N},n.startTarget=L,n.longPressTimeout=setTimeout(()=>{C()},tre)}function P(){K(i,!0),K(s,!0),setTimeout(()=>{K(s,!1)},400)}function T(){K(i,!1)}function S(L,B){if(L==="start"){const N=B;if(!N?.dataTransfer&&!l)return;if(l){B?.preventDefault();return}N?.dataTransfer&&(N.dataTransfer.setData("application/x-tiptap-node",JSON.stringify({type:"image",attrs:e.node.attrs,pos:e.getPos()})),N.dataTransfer.effectAllowed="move"),n.isDragging=!0,vh("start")}else n.isDragging=!1,i1(n.preview),vh("end")}function _(L){if(L.touches.length!==1)return;a5();const B=Cd(L);za.set(B),x(L.currentTarget,B.x,B.y)}function O(L){if(L.touches.length!==1){I();return}const B=Cd(L);if(!n.isDragging&&n.longPressTimeout&&kie(B.x,B.y,n.startPos.x,n.startPos.y,nre)){I();return}n.isDragging&&(L.preventDefault(),Eie(n.preview,B.x,B.y),yie(B.x,B.y),vh("move",{touchX:B.x,touchY:B.y,nodePos:e.getPos()}))}function F(L){if(n.longPressTimeout&&(I(),!n.isDragging)){E(L,!0),b();return}if(!n.isDragging)return;L.preventDefault();const B=Cd(L),N=document.elementFromPoint(B.x,B.y);if(N){const R=N.closest(".drop-zone-indicator")?.getAttribute("data-drop-pos");vh("end",{nodeData:{type:"image",attrs:e.node.attrs,pos:e.getPos()},dropX:B.x,dropY:B.y,target:N,dropPosition:R?parseInt(R,10):null})}n.isDragging=!1,i1(n.preview),n.preview=null}us(()=>{e.node.attrs.blurhash&&k(o)&&zI(e.node.attrs.blurhash,k(o),k(h)||r1(),k(u),p),l&&k(a)&&(k(a).addEventListener("touchstart",_,{passive:!1}),k(a).addEventListener("touchmove",O,{passive:!1}),k(a).addEventListener("touchend",F,{passive:!1}))}),Ge(()=>{e.node.attrs.blurhash&&k(o)&&zI(e.node.attrs.blurhash,k(o),k(h)||r1(),k(u),p)}),_u(()=>{I(),r.justSelectedTimeout&&clearTimeout(r.justSelectedTimeout),i1(n.preview),is.set({open:!1,nodeId:void 0}),l&&k(a)&&(k(a).removeEventListener("touchstart",_),k(a).removeEventListener("touchmove",O),k(a).removeEventListener("touchend",F)),Object.assign(SP,{isDragging:!1,longPressTimeout:null,startTarget:null,preview:null}),Object.assign(EP,{justSelected:!1,justSelectedTimeout:null}),K(o,void 0)}),SL(t,{children:(L,B)=>{var N=Ahe();N.__click=[khe,E,b];var M=re(N);{var R=V=>{var Q=_he();let Y;pr(Q,ie=>K(o,ie),()=>k(o)),je(ie=>Y=eo(Q,1,"blurhash-canvas svelte-bckq2i",null,Y,ie),[()=>({"is-placeholder":k(u),"fade-out":k(i)&&k(s)&&k(d)})]),X(V,Q)};$e(M,V=>{k(f)&&V(R)})}var H=ve(M,2);{var z=V=>{var Q=Che();let Y;Q.__contextmenu=[The],je(ie=>{yn(Q,"src",e.node?.attrs?.src),yn(Q,"alt",e.node?.attrs?.alt||""),Y=eo(Q,1,"editor-image svelte-bckq2i",null,Y,ie)},[()=>({"image-loading":!k(i)})]),js("load",Q,P),js("error",Q,T),X(V,Q)};$e(H,V=>{k(d)&&V(z)})}pr(N,V=>K(a,V),()=>k(a)),je(()=>{yn(N,"data-dragging",n.isDragging),yn(N,"aria-label",e.node?.attrs?.alt||"Image"),yn(N,"draggable",!l)}),js("dragstart",N,V=>S("start",V)),js("dragend",N,()=>S("end")),js("dragover",N,function(...V){(l?Q=>Q.preventDefault():void 0)?.apply(this,V)}),js("drop",N,function(...V){(l?Q=>Q.preventDefault():void 0)?.apply(this,V)}),X(L,N)},$$slots:{default:!0}}),Et()}Ti(["click","contextmenu"]);const wP=new Set(["image","video"]),vP=".node-image.is-node-focused, .node-video.is-node-focused",Phe=In.create({name:"gapCursorFocusReset",onSelectionUpdate(){const{state:t,view:e}=this.editor,n=t.selection,r=i=>{e.dom.querySelectorAll(vP).forEach(s=>{i&&s===i||s.classList.remove("is-node-focused")})};if(n instanceof ut&&wP.has(n.node.type.name)){const i=e.nodeDOM(n.from),s=i?.matches(".node-image, .node-video")?i:i?.closest(".node-image, .node-video");if(s){r(s),s.classList.add("is-node-focused");return}}if(n instanceof Un){r();return}r()},onCreate(){const t=e=>{const{view:n}=this.editor,r=e.target;if(n.dom.contains(r))return;n.dom.querySelectorAll(vP).forEach(o=>{o.classList.remove("is-node-focused")});const{state:i}=n,{selection:s}=i;if(s instanceof ut&&wP.has(s.node.type.name)){const o=i.doc.content.size,a=i.doc.resolve(o),l=i.tr.setSelection(Ct.near(a)).setMeta("addToHistory",!1);n.dispatch(l)}};document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),this.editor.__outsideClickHandler=t},onDestroy(){const t=this.editor.__outsideClickHandler;t&&(document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t),delete this.editor.__outsideClickHandler)}});function Ohe(t){const{placeholderText:e,onSubmitPost:n,onUpdate:r,onCreate:i,onDestroy:s}=t;return gue({extensions:[lhe.configure({paragraph:{HTMLAttributes:{class:"editor-paragraph"}},undoRedo:{depth:100,newGroupDelay:500},dropcursor:{color:"dodgerblue",width:5},link:!1}),bfe.extend({renderHTML({mark:a,HTMLAttributes:l}){return["a",{...l,href:a.attrs.href},0]}}).configure({HTMLAttributes:{class:"preview-link",rel:null,target:"_blank"},autolink:!1,linkOnPaste:!1,defaultProtocol:"https",isAllowedUri:(a,l)=>{if(!l.defaultValidate(a)||a.startsWith("./")||a.startsWith("../"))return!1;try{const c=new URL(a,`${l.defaultProtocol}://`);return l.protocols.includes(c.protocol.replace(":",""))}catch{return!1}},shouldAutoLink:a=>{if(a.length<8)return!1;try{return new URL(a).hostname.length>0&&/^https?:\/\/[a-zA-Z0-9]/.test(a)}catch{return!1}},protocols:[{scheme:"http",optionalSlashes:!1},{scheme:"https",optionalSlashes:!1}]}),dhe.configure({HTMLAttributes:{class:"editor-image"},allowBase64:!1}).extend({addAttributes(){return{src:{default:null},blurhash:{default:null},isPlaceholder:{default:null},dim:{default:null},alt:{default:null}}},addNodeView(){return xL(Ihe)}}),vhe.configure({types:["image","video"],attributeName:"id"}),nhe.configure({className:"is-node-focused",mode:"all"}),Phe,rde,Ede,Tde,ode,ade,lde,ihe.configure({placeholder:e,emptyEditorClass:"is-editor-empty",showOnlyWhenEditable:!0,showOnlyCurrent:!1,includeChildren:!1})],enablePasteRules:["clipboardExtension"],content:{type:"doc",content:[{type:"paragraph"}]},editorProps:{attributes:{class:"tiptap-editor"},handleClickOn(a,l,c,u,d,f){let h=d.target;for(;h&&h!==a.dom;){if(h.tagName==="A"&&h.hasAttribute("href"))return d.ctrlKey||d.metaKey?!1:(d.preventDefault(),!0);h=h.parentElement}return!1},handleKeyDown:(a,l)=>(l.ctrlKey||l.metaKey)&&(l.key==="Enter"||l.key==="NumpadEnter")?(l.preventDefault(),n(),!0):!1},onCreate({editor:a}){window.__currentEditor=a,i?.(a)},onUpdate(){r?.()},onDestroy(){delete window.__currentEditor,s?.()}})}function Mhe(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function Nhe(t,e,n,r,i,s,o=!1){const a=[],l=new s,c=Date.now();if(!n)return a;const u=n.state,d=u.selection,f=d instanceof ut&&d.node?.type?.name==="image";o&&console.log("[dev] insertPlaceholdersIntoEditor:",{fileCount:t.length,isImageNodeSelected:f,selectionType:d.constructor.name,selectionFrom:d.from,selectionTo:d.to,docSize:u.doc.content.size});const h=u.doc.childCount===1&&u.doc.firstChild?.type.name==="paragraph"&&u.doc.firstChild.content.size===0;let p=u.tr,m=f?d.to:d.from;return t.forEach((g,y)=>{const b=g.type.startsWith("video/"),E=l.validateMediaFile(g);if(!E.isValid){r(E.errorMessage||"postComponent.upload_failed");return}const C=`placeholder-${c}-${y}-${Mhe()}`,I=e[y],x=I?.ox,P=I?.dimensions;try{let T;if(b){const S={src:C,isPlaceholder:!0};T=u.schema.nodes.video.create(S)}else{const S={src:C,isPlaceholder:!0};P&&(S.dim=`${P.width}x${P.height}`,i.update(_=>({..._,[C]:P}))),T=u.schema.nodes.image.create(S)}h&&y===0?(p=p.replaceWith(0,u.doc.content.size,T),m=T.nodeSize):(p=p.insert(m,T),m+=T.nodeSize),a.push({file:g,placeholderId:C,ox:x,dimensions:P})}catch(T){o&&console.error("[uploadHelper] failed to insert media node",{placeholderId:C,file:g.name,isVideo:b,error:T,insertPos:m,docSize:u.doc.content.size}),r(b?"åç»ã®æ¿å¥ã«å¤±æãã¾ãã":"ç»åã®æ¿å¥ã«å¤±æãã¾ãã")}}),a.length>0&&n.view.dispatch(p),a}async function Rhe(t,e,n,r=!1){if(an.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted before blurhash generation");return}const i=new n,s=t.map(async o=>{if(an.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted during blurhash generation");return}try{const a=await i.generateBlurhashForFile(o.file);if(an.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted after blurhash generation");return}a&&(o.blurhash=a,e&&lT(e,(l,c)=>{const u=l.type?.name,d=o.file.type.startsWith("video/")&&u==="video",f=!o.file.type.startsWith("video/")&&u==="image";return(d||f)&&(l.attrs?.src===o.placeholderId||l.attrs?.id===o.placeholderId)},(l,c)=>{const u=e.state.tr.setNodeMarkup(c,void 0,{...l.attrs,blurhash:a});e.view.dispatch(u)}))}catch(a){r&&console.warn("[uploadHelper] blurhash generation failed",{file:o.file.name,error:a})}});await Promise.all(s)}async function Dhe(t,e,n,r,i,s,o,a,l,c,u=!1){const d=[],f={};let h="";const p=[...e];for(let m=0;m<t.length;m++){const g=t[m];if(u&&console.log("[uploadHelper] Processing result",m,":",{success:g.success,url:g.url,filename:g.filename,sizeInfo:g.sizeInfo,aborted:g.aborted}),g.aborted){const y=p.shift();if(y){const b=y.file.type.startsWith("video/");T1(y.placeholderId,b,n,s,u)}continue}if(g.success&&g.url){let y,b=-1;if(g.sizeInfo&&g.sizeInfo.originalFilename&&(b=p.findIndex(E=>E.file.name===g.sizeInfo.originalFilename),b!==-1&&(y=p[b])),!y&&p.length>0&&(y=p[0],b=0),y&&b!==-1&&n){p.splice(b,1);const E=y.file.type.startsWith("video/");if(u&&console.log("[uploadHelper] Replacing placeholder",{placeholderId:y.placeholderId,url:g.url,isVideo:E}),lT(n,(C,I)=>{const x=C.type?.name;return(E&&x==="video"||!E&&x==="image")&&C.attrs?.src===y.placeholderId},(C,I)=>{if(E){const x={...C.attrs,src:g.url,isPlaceholder:!1},P=n.state.tr.setNodeMarkup(I,void 0,x);n.view.dispatch(P)}else{const x={...C.attrs,src:g.url,isPlaceholder:!1,blurhash:y.blurhash??void 0};y.dimensions&&(x.dim=`${y.dimensions.width}x${y.dimensions.height}`);const P=n.state.tr.setNodeMarkup(I,void 0,x);n.view.dispatch(P),s.update(T=>{const S={...T};return delete S[y.placeholderId],y.dimensions&&(S[g.url]=y.dimensions),S})}}),!E){const C=g.nip94||{},I=C.blurhash??C.b??void 0;I&&g.url&&(f[g.url]=I);const x=C.ox??C.o??void 0,P=C.x??void 0;if(x&&g.url?r[g.url]=x:y.ox&&g.url&&(r[g.url]=y.ox),g.url)if(P)i[g.url]=P;else try{const T=await l(g.url);T&&(i[g.url]=T)}catch(T){u&&console.warn("[uploadHelper] failed to calculate x hash (fallback)",{url:g.url,error:T})}}}}else if(!g.success){d.push(g);const y=p.shift();if(y){const b=y.file.type.startsWith("video/");T1(y.placeholderId,b,n,s,u)}}}for(const m of p){const g=m.file.type.startsWith("video/");T1(m.placeholderId,g,n,s,u)}return d.length&&(h=d.length===1?d[0].error||"postComponent.upload_failed":`${d.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`),{failedResults:d,errorMessage:h,imageServerBlurhashMap:f}}let Lhe=Nt({value:""}),xP=ge(null);const vT={get value(){return k(xP)},set:t=>{K(xP,t,!0)}};let Cn=Nt({content:"",canPost:!1,isUploading:!1,uploadErrorMessage:"",postStatus:{sending:!1,success:!1,error:!1,message:""},hasImage:!1});const SP=Nt({isDragging:!1,startPos:{x:0,y:0},longPressTimeout:null,startTarget:null,preview:null}),EP=Nt({justSelected:!1,justSelectedTimeout:null});function Bhe(t,e){return!!t.trim()||e}function Fhe(t,e=!1){Cn.content=t,Cn.hasImage=e,Cn.canPost=Bhe(t,e)}function ma(t){Cn.postStatus=t}function $he(){Cn.content="",Cn.canPost=!1,Cn.uploadErrorMessage="",Cn.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1},Cn.hasImage=!1}function zhe(){Cn.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1}}let J2;function Uhe(t){J2=t}async function Hhe(){J2&&await J2()}function Vhe(t){const{placeholderText:e,editorContainerEl:n,hasStoredKey:r,submitPost:i,uploadFiles:s,eventCallbacks:o}=t;Lhe.value=e;const a=Ohe({placeholderText:e,onSubmitPost:i,onCreate:d=>{vT.set(d)}});let l=null;const c=a.subscribe(d=>{l=d}),u=Que({currentEditor:l,editorContainerEl:n,callbacks:o});return Uhe(i),n&&Object.assign(n,{__uploadFiles:s,__currentEditor:()=>l,__hasStoredKey:()=>r,__postStatus:()=>Cn.postStatus,__submitPost:i}),{editor:a,unsubscribe:c,handlers:u}}function Whe(t){const{unsubscribe:e,handlers:n,currentEditor:r,editorContainerEl:i}=t;Xue(n,i),e(),r?.destroy?.(),i&&(delete i.__uploadFiles,delete i.__currentEditor,delete i.__hasStoredKey,delete i.__postStatus,delete i.__submitPost)}class jhe{allowedOrigins;console;windowObj;constructor(e={}){this.allowedOrigins=e.allowedOrigins||[],this.console=e.console||(typeof console<"u"?console:{log:()=>{},warn:()=>{},error:()=>{}}),this.windowObj=e.window||(typeof window<"u"?window:void 0)}isInIframe(){if(!this.windowObj)return!1;try{return this.windowObj.self!==this.windowObj.top}catch{return!0}}getParentOrigin(){if(!this.windowObj||!this.isInIframe())return null;try{return this.windowObj.parent.location.origin}catch{if(this.windowObj.document&&this.windowObj.document.referrer)try{return new URL(this.windowObj.document.referrer).origin}catch(n){return this.console.warn("è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ãåå¾ã§ãã¾ããã§ãã:",n),null}return null}}isOriginAllowed(e){return e?this.allowedOrigins.length===0?!0:this.allowedOrigins.includes(e):!1}sendMessageToParent(e){if(!this.windowObj||!this.isInIframe())return!1;const n=this.getParentOrigin();if(!n)return this.console.warn("è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ãç¹å®ã§ããªããããpostMessageãéä¿¡ã§ãã¾ãã"),!1;if(!this.isOriginAllowed(n))return this.console.warn(`è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ ${n} ã¯è¨±å¯ããã¦ãã¾ãã`),!1;try{return this.windowObj.parent.postMessage(e,n),this.console.log(`è¦ªã¦ã£ã³ãã¦ (${n}) ã«ã¡ãã»ã¼ã¸ãéä¿¡ãã¾ãã:`,e),!0}catch(r){return this.console.error("postMessageã®éä¿¡ã«å¤±æãã¾ãã:",r),!1}}notifyPostSuccess(){return this.sendMessageToParent({type:"POST_SUCCESS",timestamp:Date.now()})}notifyPostError(e){return this.sendMessageToParent({type:"POST_ERROR",timestamp:Date.now(),error:e})}setAllowedOrigins(e){this.allowedOrigins=e}addAllowedOrigin(e){this.allowedOrigins.includes(e)||this.allowedOrigins.push(e)}}const qhe=new jhe;class Khe{static validatePost(e,n,r){return e.trim()?r?n?{valid:!0}:{valid:!1,error:"login_required"}:{valid:!1,error:"nostr_not_ready"}:{valid:!1,error:"empty_content"}}}class kP{static async buildEvent(e,n,r,i,s,o,a,l,c){const u=Array.isArray(r)&&r.length?[...r]:Array.isArray(n)?n.map(h=>["t",h.toLowerCase()]):[],d=u.some(h=>h[0]==="t"&&h[1]==="nsfw");if((l||d)&&(c&&c.trim()?u.push(["content-warning",c.trim()]):u.push(["content-warning"]),l&&!d&&u.push(["t","nsfw"])),a){const h=a();h&&u.push(h)}if(s&&o){for(const[h,p]of Object.entries(s))if(h&&p&&p.m){const m=await o({url:h,...p});u.push(m)}}const f={kind:1,content:e,tags:u,created_at:Math.floor(Date.now()/1e3)};return i&&(f.pubkey=i),f}}class Ghe{constructor(e,n){this.rxNostr=e,this.console=n}sendEvent(e,n){return new Promise(r=>{let i=!1,s=!1,o=null;const a=()=>{try{o?.unsubscribe()}catch{}},l={next:c=>{this.console.log(`ãªã¬ã¼ ${c.from} ã¸ã®éä¿¡çµæ:`,c.ok?"æå":"å¤±æ"),c.ok&&!i&&(s=!0,i=!0,a(),r({success:!0}))},error:c=>{this.console.error("éä¿¡ã¨ã©ã¼:",c),i||(i=!0,a(),r({success:!1,error:"post_error"}))},complete:()=>{!i&&!s&&(i=!0,a(),r({success:!1,error:"post_error"}))}};o=this.rxNostr.send(e,n?{signer:n}:void 0).subscribe(l),setTimeout(()=>{i||(i=!0,a(),r(s?{success:!0}:{success:!1,error:"post_error"}))},1e4)})}}class Zhe{constructor(e,n={}){this.deps=n,e&&this.setRxNostr(e),this.deps.console=n.console||(typeof window<"u"?window.console:{}),this.deps.createImetaTagFn=n.createImetaTagFn||c5,this.deps.getClientTagFn=n.getClientTagFn||Tue,this.deps.seckeySignerFn=n.seckeySignerFn||xx,this.deps.extractContentWithImagesFn=n.extractContentWithImagesFn||IL,this.deps.extractImageBlurhashMapFn=n.extractImageBlurhashMapFn||u5,this.deps.resetEditorStateFn=n.resetEditorStateFn||$he,this.deps.resetPostStatusFn=n.resetPostStatusFn||zhe,this.deps.iframeMessageService=n.iframeMessageService||qhe}rxNostr=null;eventSender=null;setRxNostr(e){this.rxNostr=e,this.eventSender=new Ghe(e,this.deps.console||console)}validatePost(e){const n=this.deps.authStateStore||{value:Dr.value};return Khe.validatePost(e,n.value.isAuthenticated,!!this.rxNostr)}async submitPost(e,n){const r=this.validatePost(e);if(!r.valid)return this.deps.iframeMessageService?.notifyPostError(r.error),{success:!1,error:r.error};if(!this.eventSender)return this.deps.iframeMessageService?.notifyPostError("nostr_not_ready"),{success:!1,error:"nostr_not_ready"};try{const i=this.deps.authStateStore||{value:Dr.value},s=this.deps.hashtagStore||jl,{hashtags:o,tags:a}=this.getHashtagArrays(s),l=this.deps.keyManager||z2,c=this.deps.window||(typeof window<"u"?window:void 0),u=xu.value,d=Qd.value,f=i.value;if(f.type==="nostr-login"&&l.isWindowNostrAvailable()&&c?.nostr)try{const b=f.pubkey;if(!b)return this.deps.iframeMessageService?.notifyPostError("pubkey_not_found"),{success:!1,error:"pubkey_not_found"};const E=await kP.buildEvent(e,o,a,b,n,this.deps.createImetaTagFn,this.deps.getClientTagFn,u,d);if(typeof c.nostr.signEvent=="function"){const C=await c.nostr.signEvent(E);this.deps.console?.log("ç½²åæ¸ã¿ã¤ãã³ã:",C);const I=await this.eventSender.sendEvent(C);return I.success?this.deps.iframeMessageService?.notifyPostSuccess():this.deps.iframeMessageService?.notifyPostError(I.error),I}else return this.deps.iframeMessageService?.notifyPostError("nostr_sign_event_not_supported"),{success:!1,error:"nostr_sign_event_not_supported"}}catch(b){return this.deps.console?.error("window.nostrã§ã®æç¨¿ã¨ã©ã¼:",b),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}const p=l.getFromStore()||l.loadFromStorage();if(!p)return this.deps.iframeMessageService?.notifyPostError("key_not_found"),{success:!1,error:"key_not_found"};const m=await kP.buildEvent(e,o,a,void 0,n,this.deps.createImetaTagFn,this.deps.getClientTagFn,u,d),g=this.deps.seckeySignerFn?this.deps.seckeySignerFn(p):xx(p),y=await this.eventSender.sendEvent(m,g);return y.success?this.deps.iframeMessageService?.notifyPostSuccess():this.deps.iframeMessageService?.notifyPostError(y.error),y}catch(i){return this.deps.console?.error("æç¨¿ã¨ã©ã¼:",i),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}}getEventSender(){return this.eventSender}getHashtagArrays(e){const n=e||jl,r=this.deps.hashtagSnapshotFn;if(r){const i=r(n);return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}if(n===jl)try{const i=kue();return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}catch(i){this.deps.console?.warn("hashtag_snapshot_failed",i)}return{hashtags:Array.isArray(n?.hashtags)?[...n.hashtags]:[],tags:Array.isArray(n?.tags)?n.tags.map(i=>[...i]):[]}}preparePostContent(e){return this.deps.extractContentWithImagesFn(e)||""}prepareImageBlurhashMap(e,n,r){const i=this.deps.extractImageBlurhashMapFn(e),s={};for(const[o,a]of Object.entries(i))s[o]={m:d5(o),blurhash:a,ox:n[o],x:r[o]};return s}async performPostSubmission(e,n,r,i,s,o){const a=this.preparePostContent(e),l=this.prepareImageBlurhashMap(e,n,r);i?.();try{const c=await this.submitPost(a,l);c.success?s?.():o?.(c.error||"post_error")}catch{o?.("post_error")}}applyEmptyStateToEditor(e){e.chain().clearContent().run()}resetPostContent(e){this.applyEmptyStateToEditor(e),this.deps.resetEditorStateFn?.(),this.deps.resetPostStatusFn?.(),xu.reset(),Qd.reset()}clearContentAfterSuccess(e){this.applyEmptyStateToEditor(e),xu.reset(),Qd.reset()}}function Qhe(t,e){return e.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}}))})),Object.freeze(t)}function i6(t,e){return new Promise((function(n,r){let i;return Xhe(t).then((function(s){try{return i=s,n(new Blob([e.slice(0,2),i,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}}),r)}))}const Xhe=t=>new Promise(((e,n)=>{const r=new FileReader;r.addEventListener("load",(({target:{result:i}})=>{const s=new DataView(i);let o=0;if(s.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=s.getUint16(o);if(a===65498)break;const l=s.getUint16(o+2);if(a===65505&&s.getUint32(o+4)===1165519206){const c=o+10;let u;switch(s.getUint16(c)){case 18761:u=!0;break;case 19789:u=!1;break;default:return n("TIFF header contains invalid endian")}if(s.getUint16(c+2,u)!==42)return n("TIFF header contains invalid version");const d=s.getUint32(c+4,u),f=c+d+2+12*s.getUint16(c+d,u);for(let h=c+d+2;h<f;h+=12)if(s.getUint16(h,u)==274){if(s.getUint16(h+2,u)!==3)return n("Orientation data type is invalid");if(s.getUint32(h+4,u)!==1)return n("Orientation data count is invalid");s.setUint16(h+8,1,u);break}return e(i.slice(o,o+2+l))}o+=2+l}return e(new Blob)})),r.readAsArrayBuffer(t)}));var Py={},Yhe={get exports(){return Py},set exports(t){Py=t}};(function(t){var e,n,r={};Yhe.exports=r,r.parse=function(i,s){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,c={},u=new Uint8Array(i),d=u.length-4;a(u,d)!=101010256;)d--;l=d,l+=4;var f=o(u,l+=4);o(u,l+=2);var h=a(u,l+=2),p=a(u,l+=4);l+=4,l=p;for(var m=0;m<f;m++){a(u,l),l+=4,l+=4,l+=4,a(u,l+=4),h=a(u,l+=4);var g=a(u,l+=4),y=o(u,l+=4),b=o(u,l+2),E=o(u,l+4);l+=6;var C=a(u,l+=8);l+=4,l+=y+b+E,r._readLocal(u,C,c,h,g,s)}return c},r._readLocal=function(i,s,o,a,l,c){var u=r.bin.readUshort,d=r.bin.readUint;d(i,s),u(i,s+=4),u(i,s+=2);var f=u(i,s+=2);d(i,s+=2),d(i,s+=4),s+=4;var h=u(i,s+=8),p=u(i,s+=2);s+=2;var m=r.bin.readUTF8(i,s,h);if(s+=h,s+=p,c)o[m]={size:l,csize:a};else{var g=new Uint8Array(i.buffer,s);if(f==0)o[m]=new Uint8Array(g.buffer.slice(s,s+a));else{if(f!=8)throw"unknown compression method: "+f;var y=new Uint8Array(l);r.inflateRaw(g,y),o[m]=y}}},r.inflateRaw=function(i,s){return r.F.inflate(i,s)},r.inflate=function(i,s){return i[0],i[1],r.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-6),s)},r.deflate=function(i,s){s==null&&(s={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*i.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(i,a,o,s.level);var l=r.adler(i,0,i.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(i,s){s==null&&(s={level:6});var o=new Uint8Array(50+Math.floor(1.1*i.length)),a=r.F.deflateRaw(i,o,a,s.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(i,s){s==null&&(s=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,c={};for(var u in i){var d=!r._noNeed(u)&&!s,f=i[u],h=r.crc.crc(f,0,f.length);c[u]={cpr:d,usize:f.length,crc:h,file:d?r.deflateRaw(f):f}}for(var u in c)o+=c[u].file.length+30+46+2*r.bin.sizeUTF8(u);o+=22;var p=new Uint8Array(o),m=0,g=[];for(var u in c){var y=c[u];g.push(m),m=r._writeHeader(p,m,u,y,0)}var b=0,E=m;for(var u in c)y=c[u],g.push(m),m=r._writeHeader(p,m,u,y,1,g[b++]);var C=m-E;return a(p,m,101010256),m+=4,l(p,m+=4,b),l(p,m+=2,b),a(p,m+=2,C),a(p,m+=4,E),m+=4,m+=2,p.buffer},r._noNeed=function(i){var s=i.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(s)!=-1},r._writeHeader=function(i,s,o,a,l,c){var u=r.bin.writeUint,d=r.bin.writeUshort,f=a.file;return u(i,s,l==0?67324752:33639248),s+=4,l==1&&(s+=2),d(i,s,20),d(i,s+=2,0),d(i,s+=2,a.cpr?8:0),u(i,s+=2,0),u(i,s+=4,a.crc),u(i,s+=4,f.length),u(i,s+=4,a.usize),d(i,s+=4,r.bin.sizeUTF8(o)),d(i,s+=2,0),s+=2,l==1&&(s+=2,s+=2,u(i,s+=6,c),s+=4),s+=r.bin.writeUTF8(i,s,o),l==0&&(i.set(f,s),s+=f.length),s},r.crc={table:(function(){for(var i=new Uint32Array(256),s=0;s<256;s++){for(var o=s,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;i[s]=o}return i})(),update:function(i,s,o,a){for(var l=0;l<a;l++)i=r.crc.table[255&(i^s[o+l])]^i>>>8;return i},crc:function(i,s,o){return 4294967295^r.crc.update(4294967295,i,s,o)}},r.adler=function(i,s,o){for(var a=1,l=0,c=s,u=s+o;c<u;){for(var d=Math.min(c+5552,u);c<d;)l+=a+=i[c++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(i,s){return i[s]|i[s+1]<<8},writeUshort:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255},readUint:function(i,s){return 16777216*i[s+3]+(i[s+2]<<16|i[s+1]<<8|i[s])},writeUint:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255,i[s+2]=o>>16&255,i[s+3]=o>>24&255},readASCII:function(i,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(i[s+l]);return a},writeASCII:function(i,s,o){for(var a=0;a<o.length;a++)i[s+a]=o.charCodeAt(a)},pad:function(i){return i.length<2?"0"+i:i},readUTF8:function(i,s,o){for(var a,l="",c=0;c<o;c++)l+="%"+r.bin.pad(i[s+c].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(i,s,o)}return a},writeUTF8:function(i,s,o){for(var a=o.length,l=0,c=0;c<a;c++){var u=o.charCodeAt(c);if((4294967168&u)==0)i[s+l]=u,l++;else if((4294965248&u)==0)i[s+l]=192|u>>6,i[s+l+1]=128|u>>0&63,l+=2;else if((4294901760&u)==0)i[s+l]=224|u>>12,i[s+l+1]=128|u>>6&63,i[s+l+2]=128|u>>0&63,l+=3;else{if((4292870144&u)!=0)throw"e";i[s+l]=240|u>>18,i[s+l+1]=128|u>>12&63,i[s+l+2]=128|u>>6&63,i[s+l+3]=128|u>>0&63,l+=4}}return l},sizeUTF8:function(i){for(var s=i.length,o=0,a=0;a<s;a++){var l=i.charCodeAt(a);if((4294967168&l)==0)o++;else if((4294965248&l)==0)o+=2;else if((4294901760&l)==0)o+=3;else{if((4292870144&l)!=0)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(i,s,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],c=r.F.U,u=r.F._goodIndex;r.F._hash;var d=r.F._putsE,f=0,h=o<<3,p=0,m=i.length;if(a==0){for(;f<m;)d(s,h,f+(O=Math.min(65535,m-f))==m?1:0),h=r.F._copyExact(i,f,O,s,h+8),f+=O;return h>>>3}var g=c.lits,y=c.strt,b=c.prev,E=0,C=0,I=0,x=0,P=0,T=0;for(m>2&&(y[T=r.F._hash(i,0)]=0),f=0;f<m;f++){if(P=T,f+1<m-2){T=r.F._hash(i,f+1);var S=f+1&32767;b[S]=y[T],y[T]=S}if(p<=f){(E>14e3||C>26697)&&m-f>100&&(p<f&&(g[E]=f-p,E+=2,p=f),h=r.F._writeBlock(f==m-1||p==m?1:0,g,E,x,i,I,f-I,s,h),E=C=x=0,I=f);var _=0;f<m-2&&(_=r.F._bestMatch(i,f,b,P,Math.min(l[2],m-f),l[3]));var O=_>>>16,F=65535&_;if(_!=0){F=65535&_;var L=u(O=_>>>16,c.of0);c.lhst[257+L]++;var B=u(F,c.df0);c.dhst[B]++,x+=c.exb[L]+c.dxb[B],g[E]=O<<23|f-p,g[E+1]=F<<16|L<<8|B,E+=2,p=f+O}else c.lhst[i[f]]++;C++}}for(I==f&&i.length!=0||(p<f&&(g[E]=f-p,E+=2,p=f),h=r.F._writeBlock(1,g,E,x,i,I,f-I,s,h),E=0,C=0,E=C=x=0,I=f);(7&h)!=0;)h++;return h>>>3},r.F._bestMatch=function(i,s,o,a,l,c){var u=32767&s,d=o[u],f=u-d+32768&32767;if(d==u||a!=r.F._hash(i,s-f))return 0;for(var h=0,p=0,m=Math.min(32767,s);f<=m&&--c!=0&&d!=u;){if(h==0||i[s+h]==i[s+h-f]){var g=r.F._howLong(i,s,f);if(g>h){if(p=f,(h=g)>=l)break;f+2<g&&(g=f+2);for(var y=0,b=0;b<g-2;b++){var E=s-f+b+32768&32767,C=E-o[E]+32768&32767;C>y&&(y=C,d=E)}}}f+=(u=d)-(d=o[u])+32768&32767}return h<<16|p},r.F._howLong=function(i,s,o){if(i[s]!=i[s-o]||i[s+1]!=i[s+1-o]||i[s+2]!=i[s+2-o])return 0;var a=s,l=Math.min(i.length,s+258);for(s+=3;s<l&&i[s]==i[s-o];)s++;return s-a},r.F._hash=function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(i,s,o,a,l,c,u,d,f){var h,p,m,g,y,b,E,C,I,x=r.F.U,P=r.F._putsF,T=r.F._putsE;x.lhst[256]++,p=(h=r.F.getTrees())[0],m=h[1],g=h[2],y=h[3],b=h[4],E=h[5],C=h[6],I=h[7];var S=32+((f+3&7)==0?0:8-(f+3&7))+(u<<3),_=a+r.F.contSize(x.fltree,x.lhst)+r.F.contSize(x.fdtree,x.dhst),O=a+r.F.contSize(x.ltree,x.lhst)+r.F.contSize(x.dtree,x.dhst);O+=14+3*E+r.F.contSize(x.itree,x.ihst)+(2*x.ihst[16]+3*x.ihst[17]+7*x.ihst[18]);for(var F=0;F<286;F++)x.lhst[F]=0;for(F=0;F<30;F++)x.dhst[F]=0;for(F=0;F<19;F++)x.ihst[F]=0;var L=S<_&&S<O?0:_<O?1:2;if(P(d,f,i),P(d,f+1,L),f+=3,L==0){for(;(7&f)!=0;)f++;f=r.F._copyExact(l,c,u,d,f)}else{var B,N;if(L==1&&(B=x.fltree,N=x.fdtree),L==2){r.F.makeCodes(x.ltree,p),r.F.revCodes(x.ltree,p),r.F.makeCodes(x.dtree,m),r.F.revCodes(x.dtree,m),r.F.makeCodes(x.itree,g),r.F.revCodes(x.itree,g),B=x.ltree,N=x.dtree,T(d,f,y-257),T(d,f+=5,b-1),T(d,f+=5,E-4),f+=4;for(var M=0;M<E;M++)T(d,f+3*M,x.itree[1+(x.ordr[M]<<1)]);f+=3*E,f=r.F._codeTiny(C,x.itree,d,f),f=r.F._codeTiny(I,x.itree,d,f)}for(var R=c,H=0;H<o;H+=2){for(var z=s[H],V=z>>>23,Q=R+(8388607&z);R<Q;)f=r.F._writeLit(l[R++],B,d,f);if(V!=0){var Y=s[H+1],ie=Y>>16,ne=Y>>8&255,J=255&Y;T(d,f=r.F._writeLit(257+ne,B,d,f),V-x.of0[ne]),f+=x.exb[ne],P(d,f=r.F._writeLit(J,N,d,f),ie-x.df0[J]),f+=x.dxb[J],R+=V}}f=r.F._writeLit(256,B,d,f)}return f},r.F._copyExact=function(i,s,o,a,l){var c=l>>>3;return a[c]=o,a[c+1]=o>>>8,a[c+2]=255-a[c],a[c+3]=255-a[c+1],c+=4,a.set(new Uint8Array(i.buffer,s,o),c),l+(o+4<<3)},r.F.getTrees=function(){for(var i=r.F.U,s=r.F._hufTree(i.lhst,i.ltree,15),o=r.F._hufTree(i.dhst,i.dtree,15),a=[],l=r.F._lenCodes(i.ltree,a),c=[],u=r.F._lenCodes(i.dtree,c),d=0;d<a.length;d+=2)i.ihst[a[d]]++;for(d=0;d<c.length;d+=2)i.ihst[c[d]]++;for(var f=r.F._hufTree(i.ihst,i.itree,7),h=19;h>4&&i.itree[1+(i.ordr[h-1]<<1)]==0;)h--;return[s,o,f,l,u,h,a,c]},r.F.getSecond=function(i){for(var s=[],o=0;o<i.length;o+=2)s.push(i[o+1]);return s},r.F.nonZero=function(i){for(var s="",o=0;o<i.length;o+=2)i[o+1]!=0&&(s+=(o>>1)+",");return s},r.F.contSize=function(i,s){for(var o=0,a=0;a<s.length;a++)o+=s[a]*i[1+(a<<1)];return o},r.F._codeTiny=function(i,s,o,a){for(var l=0;l<i.length;l+=2){var c=i[l],u=i[l+1];a=r.F._writeLit(c,s,o,a);var d=c==16?2:c==17?3:7;c>15&&(r.F._putsE(o,a,u,d),a+=d)}return a},r.F._lenCodes=function(i,s){for(var o=i.length;o!=2&&i[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=i[a+1],c=a+3<o?i[a+3]:-1,u=a+5<o?i[a+5]:-1,d=a==0?-1:i[a-1];if(l==0&&c==l&&u==l){for(var f=a+5;f+2<o&&i[f+2]==l;)f+=2;(h=Math.min(f+1-a>>>1,138))<11?s.push(17,h-3):s.push(18,h-11),a+=2*h-2}else if(l==d&&c==l&&u==l){for(f=a+5;f+2<o&&i[f+2]==l;)f+=2;var h=Math.min(f+1-a>>>1,6);s.push(16,h-3),a+=2*h-2}else s.push(l,0)}return o>>>1},r.F._hufTree=function(i,s,o){var a=[],l=i.length,c=s.length,u=0;for(u=0;u<c;u+=2)s[u]=0,s[u+1]=0;for(u=0;u<l;u++)i[u]!=0&&a.push({lit:u,f:i[u]});var d=a.length,f=a.slice(0);if(d==0)return 0;if(d==1){var h=a[0].lit;return f=h==0?1:0,s[1+(h<<1)]=1,s[1+(f<<1)]=1,1}a.sort((function(C,I){return C.f-I.f}));var p=a[0],m=a[1],g=0,y=1,b=2;for(a[0]={lit:-1,f:p.f+m.f,l:p,r:m,d:0};y!=d-1;)p=g!=y&&(b==d||a[g].f<a[b].f)?a[g++]:a[b++],m=g!=y&&(b==d||a[g].f<a[b].f)?a[g++]:a[b++],a[y++]={lit:-1,f:p.f+m.f,l:p,r:m};var E=r.F.setDepth(a[y-1],0);for(E>o&&(r.F.restrictDepth(f,o,E),E=o),u=0;u<d;u++)s[1+(f[u].lit<<1)]=f[u].d;return E},r.F.setDepth=function(i,s){return i.lit!=-1?(i.d=s,s):Math.max(r.F.setDepth(i.l,s+1),r.F.setDepth(i.r,s+1))},r.F.restrictDepth=function(i,s,o){var a=0,l=1<<o-s,c=0;for(i.sort((function(d,f){return f.d==d.d?d.f-f.f:f.d-d.d})),a=0;a<i.length&&i[a].d>s;a++){var u=i[a].d;i[a].d=s,c+=l-(1<<o-u)}for(c>>>=o-s;c>0;)(u=i[a].d)<s?(i[a].d++,c-=1<<s-u-1):a++;for(;a>=0;a--)i[a].d==s&&c<0&&(i[a].d--,c++);c!=0&&console.log("debt left")},r.F._goodIndex=function(i,s){var o=0;return s[16|o]<=i&&(o|=16),s[8|o]<=i&&(o|=8),s[4|o]<=i&&(o|=4),s[2|o]<=i&&(o|=2),s[1|o]<=i&&(o|=1),o},r.F._writeLit=function(i,s,o,a){return r.F._putsF(o,a,s[i<<1]),a+s[1+(i<<1)]},r.F.inflate=function(i,s){var o=Uint8Array;if(i[0]==3&&i[1]==0)return s||new o(0);var a=r.F,l=a._bitsF,c=a._bitsE,u=a._decodeTiny,d=a.makeCodes,f=a.codes2map,h=a._get17,p=a.U,m=s==null;m&&(s=new o(i.length>>>2<<3));for(var g,y,b=0,E=0,C=0,I=0,x=0,P=0,T=0,S=0,_=0;b==0;)if(b=l(i,_,1),E=l(i,_+1,2),_+=3,E!=0){if(m&&(s=r.F._check(s,S+(1<<17))),E==1&&(g=p.flmap,y=p.fdmap,P=511,T=31),E==2){C=c(i,_,5)+257,I=c(i,_+5,5)+1,x=c(i,_+10,4)+4,_+=14;for(var O=0;O<38;O+=2)p.itree[O]=0,p.itree[O+1]=0;var F=1;for(O=0;O<x;O++){var L=c(i,_+3*O,3);p.itree[1+(p.ordr[O]<<1)]=L,L>F&&(F=L)}_+=3*x,d(p.itree,F),f(p.itree,F,p.imap),g=p.lmap,y=p.dmap,_=u(p.imap,(1<<F)-1,C+I,i,_,p.ttree);var B=a._copyOut(p.ttree,0,C,p.ltree);P=(1<<B)-1;var N=a._copyOut(p.ttree,C,I,p.dtree);T=(1<<N)-1,d(p.ltree,B),f(p.ltree,B,g),d(p.dtree,N),f(p.dtree,N,y)}for(;;){var M=g[h(i,_)&P];_+=15&M;var R=M>>>4;if(!(R>>>8))s[S++]=R;else{if(R==256)break;var H=S+R-254;if(R>264){var z=p.ldef[R-257];H=S+(z>>>3)+c(i,_,7&z),_+=7&z}var V=y[h(i,_)&T];_+=15&V;var Q=V>>>4,Y=p.ddef[Q],ie=(Y>>>4)+l(i,_,15&Y);for(_+=15&Y,m&&(s=r.F._check(s,S+(1<<17)));S<H;)s[S]=s[S++-ie],s[S]=s[S++-ie],s[S]=s[S++-ie],s[S]=s[S++-ie];S=H}}}else{(7&_)!=0&&(_+=8-(7&_));var ne=4+(_>>>3),J=i[ne-4]|i[ne-3]<<8;m&&(s=r.F._check(s,S+J)),s.set(new o(i.buffer,i.byteOffset+ne,J),S),_=ne+J<<3,S+=J}return s.length==S?s:s.slice(0,S)},r.F._check=function(i,s){var o=i.length;if(s<=o)return i;var a=new Uint8Array(Math.max(o<<1,s));return a.set(i,0),a},r.F._decodeTiny=function(i,s,o,a,l,c){for(var u=r.F._bitsE,d=r.F._get17,f=0;f<o;){var h=i[d(a,l)&s];l+=15&h;var p=h>>>4;if(p<=15)c[f]=p,f++;else{var m=0,g=0;p==16?(g=3+u(a,l,2),l+=2,m=c[f-1]):p==17?(g=3+u(a,l,3),l+=3):p==18&&(g=11+u(a,l,7),l+=7);for(var y=f+g;f<y;)c[f]=m,f++}}return l},r.F._copyOut=function(i,s,o,a){for(var l=0,c=0,u=a.length>>>1;c<o;){var d=i[c+s];a[c<<1]=0,a[1+(c<<1)]=d,d>l&&(l=d),c++}for(;c<u;)a[c<<1]=0,a[1+(c<<1)]=0,c++;return l},r.F.makeCodes=function(i,s){for(var o,a,l,c,u=r.F.U,d=i.length,f=u.bl_count,h=0;h<=s;h++)f[h]=0;for(h=1;h<d;h+=2)f[i[h]]++;var p=u.next_code;for(o=0,f[0]=0,a=1;a<=s;a++)o=o+f[a-1]<<1,p[a]=o;for(l=0;l<d;l+=2)(c=i[l+1])!=0&&(i[l]=p[c],p[c]++)},r.F.codes2map=function(i,s,o){for(var a=i.length,l=r.F.U.rev15,c=0;c<a;c+=2)if(i[c+1]!=0)for(var u=c>>1,d=i[c+1],f=u<<4|d,h=s-d,p=i[c]<<h,m=p+(1<<h);p!=m;)o[l[p]>>>15-s]=f,p++},r.F.revCodes=function(i,s){for(var o=r.F.U.rev15,a=15-s,l=0;l<i.length;l+=2){var c=i[l]<<s-i[l+1];i[l]=o[c]>>>a}},r.F._putsE=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8},r.F._putsF=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8,i[a+2]|=o>>>16},r.F._bitsE=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8)>>>(7&s)&(1<<o)-1},r.F._bitsF=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)&(1<<o)-1},r.F._get17=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)},r.F._get25=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16|i[3+(s>>>3)]<<24)>>>(7&s)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),(function(){for(var i=r.F.U,s=0;s<32768;s++){var o=s;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,i.rev15[s]=(o>>>16|o<<16)>>>17}function a(l,c,u){for(;c--!=0;)l.push(0,u)}for(s=0;s<32;s++)i.ldef[s]=i.of0[s]<<3|i.exb[s],i.ddef[s]=i.df0[s]<<4|i.dxb[s];a(i.fltree,144,8),a(i.fltree,112,9),a(i.fltree,24,7),a(i.fltree,8,8),r.F.makeCodes(i.fltree,9),r.F.codes2map(i.fltree,9,i.flmap),r.F.revCodes(i.fltree,9),a(i.fdtree,32,5),r.F.makeCodes(i.fdtree,5),r.F.codes2map(i.fdtree,5,i.fdmap),r.F.revCodes(i.fdtree,5),a(i.itree,19,0),a(i.ltree,286,0),a(i.dtree,30,0),a(i.ttree,320,0)})()})();var Jhe=Qhe({__proto__:null,default:Py},[Py]);const Vs=(function(){var t={nextZero(u,d){for(;u[d]!=0;)d++;return d},readUshort:(u,d)=>u[d]<<8|u[d+1],writeUshort(u,d,f){u[d]=f>>8&255,u[d+1]=255&f},readUint:(u,d)=>16777216*u[d]+(u[d+1]<<16|u[d+2]<<8|u[d+3]),writeUint(u,d,f){u[d]=f>>24&255,u[d+1]=f>>16&255,u[d+2]=f>>8&255,u[d+3]=255&f},readASCII(u,d,f){let h="";for(let p=0;p<f;p++)h+=String.fromCharCode(u[d+p]);return h},writeASCII(u,d,f){for(let h=0;h<f.length;h++)u[d+h]=f.charCodeAt(h)},readBytes(u,d,f){const h=[];for(let p=0;p<f;p++)h.push(u[d+p]);return h},pad:u=>u.length<2?`0${u}`:u,readUTF8(u,d,f){let h,p="";for(let m=0;m<f;m++)p+=`%${t.pad(u[d+m].toString(16))}`;try{h=decodeURIComponent(p)}catch{return t.readASCII(u,d,f)}return h}};function e(u,d,f,h){const p=d*f,m=s(h),g=Math.ceil(d*m/8),y=new Uint8Array(4*p),b=new Uint32Array(y.buffer),{ctype:E}=h,{depth:C}=h,I=t.readUshort;if(E==6){const z=p<<2;if(C==8)for(var x=0;x<z;x+=4)y[x]=u[x],y[x+1]=u[x+1],y[x+2]=u[x+2],y[x+3]=u[x+3];if(C==16)for(x=0;x<z;x++)y[x]=u[x<<1]}else if(E==2){const z=h.tabs.tRNS;if(z==null){if(C==8)for(x=0;x<p;x++){var P=3*x;b[x]=255<<24|u[P+2]<<16|u[P+1]<<8|u[P]}if(C==16)for(x=0;x<p;x++)P=6*x,b[x]=255<<24|u[P+4]<<16|u[P+2]<<8|u[P]}else{var T=z[0];const V=z[1],Q=z[2];if(C==8)for(x=0;x<p;x++){var S=x<<2;P=3*x,b[x]=255<<24|u[P+2]<<16|u[P+1]<<8|u[P],u[P]==T&&u[P+1]==V&&u[P+2]==Q&&(y[S+3]=0)}if(C==16)for(x=0;x<p;x++)S=x<<2,P=6*x,b[x]=255<<24|u[P+4]<<16|u[P+2]<<8|u[P],I(u,P)==T&&I(u,P+2)==V&&I(u,P+4)==Q&&(y[S+3]=0)}}else if(E==3){const z=h.tabs.PLTE,V=h.tabs.tRNS,Q=V?V.length:0;if(C==1)for(var _=0;_<f;_++){var O=_*g,F=_*d;for(x=0;x<d;x++){S=F+x<<2;var L=3*(B=u[O+(x>>3)]>>7-((7&x)<<0)&1);y[S]=z[L],y[S+1]=z[L+1],y[S+2]=z[L+2],y[S+3]=B<Q?V[B]:255}}if(C==2)for(_=0;_<f;_++)for(O=_*g,F=_*d,x=0;x<d;x++)S=F+x<<2,L=3*(B=u[O+(x>>2)]>>6-((3&x)<<1)&3),y[S]=z[L],y[S+1]=z[L+1],y[S+2]=z[L+2],y[S+3]=B<Q?V[B]:255;if(C==4)for(_=0;_<f;_++)for(O=_*g,F=_*d,x=0;x<d;x++)S=F+x<<2,L=3*(B=u[O+(x>>1)]>>4-((1&x)<<2)&15),y[S]=z[L],y[S+1]=z[L+1],y[S+2]=z[L+2],y[S+3]=B<Q?V[B]:255;if(C==8)for(x=0;x<p;x++){var B;S=x<<2,L=3*(B=u[x]),y[S]=z[L],y[S+1]=z[L+1],y[S+2]=z[L+2],y[S+3]=B<Q?V[B]:255}}else if(E==4){if(C==8)for(x=0;x<p;x++){S=x<<2;var N=u[M=x<<1];y[S]=N,y[S+1]=N,y[S+2]=N,y[S+3]=u[M+1]}if(C==16)for(x=0;x<p;x++){var M;S=x<<2,N=u[M=x<<2],y[S]=N,y[S+1]=N,y[S+2]=N,y[S+3]=u[M+2]}}else if(E==0)for(T=h.tabs.tRNS?h.tabs.tRNS:-1,_=0;_<f;_++){const z=_*g,V=_*d;if(C==1)for(var R=0;R<d;R++){var H=(N=255*(u[z+(R>>>3)]>>>7-(7&R)&1))==255*T?0:255;b[V+R]=H<<24|N<<16|N<<8|N}else if(C==2)for(R=0;R<d;R++)H=(N=85*(u[z+(R>>>2)]>>>6-((3&R)<<1)&3))==85*T?0:255,b[V+R]=H<<24|N<<16|N<<8|N;else if(C==4)for(R=0;R<d;R++)H=(N=17*(u[z+(R>>>1)]>>>4-((1&R)<<2)&15))==17*T?0:255,b[V+R]=H<<24|N<<16|N<<8|N;else if(C==8)for(R=0;R<d;R++)H=(N=u[z+R])==T?0:255,b[V+R]=H<<24|N<<16|N<<8|N;else if(C==16)for(R=0;R<d;R++)N=u[z+(R<<1)],H=I(u,z+(R<<1))==T?0:255,b[V+R]=H<<24|N<<16|N<<8|N}return y}function n(u,d,f,h){const p=s(u),m=Math.ceil(f*p/8),g=new Uint8Array((m+1+u.interlace)*h);return d=u.tabs.CgBI?i(d,g):r(d,g),u.interlace==0?d=o(d,u,0,f,h):u.interlace==1&&(d=(function(b,E){const C=E.width,I=E.height,x=s(E),P=x>>3,T=Math.ceil(C*x/8),S=new Uint8Array(I*T);let _=0;const O=[0,0,4,0,2,0,1],F=[0,4,0,2,0,1,0],L=[8,8,8,4,4,2,2],B=[8,8,4,4,2,2,1];let N=0;for(;N<7;){const R=L[N],H=B[N];let z=0,V=0,Q=O[N];for(;Q<I;)Q+=R,V++;let Y=F[N];for(;Y<C;)Y+=H,z++;const ie=Math.ceil(z*x/8);o(b,E,_,z,V);let ne=0,J=O[N];for(;J<I;){let ke=F[N],ze=_+ne*ie<<3;for(;ke<C;){var M;if(x==1&&(M=(M=b[ze>>3])>>7-(7&ze)&1,S[J*T+(ke>>3)]|=M<<7-((7&ke)<<0)),x==2&&(M=(M=b[ze>>3])>>6-(7&ze)&3,S[J*T+(ke>>2)]|=M<<6-((3&ke)<<1)),x==4&&(M=(M=b[ze>>3])>>4-(7&ze)&15,S[J*T+(ke>>1)]|=M<<4-((1&ke)<<2)),x>=8){const he=J*T+ke*P;for(let Ee=0;Ee<P;Ee++)S[he+Ee]=b[(ze>>3)+Ee]}ze+=x,ke+=H}ne++,J+=R}z*V!=0&&(_+=V*(1+ie)),N+=1}return S})(d,u)),d}function r(u,d){return i(new Uint8Array(u.buffer,2,u.length-6),d)}var i=(function(){const u={H:{}};return u.H.N=function(d,f){const h=Uint8Array;let p,m,g=0,y=0,b=0,E=0,C=0,I=0,x=0,P=0,T=0;if(d[0]==3&&d[1]==0)return f||new h(0);const S=u.H,_=S.b,O=S.e,F=S.R,L=S.n,B=S.A,N=S.Z,M=S.m,R=f==null;for(R&&(f=new h(d.length>>>2<<5));g==0;)if(g=_(d,T,1),y=_(d,T+1,2),T+=3,y!=0){if(R&&(f=u.H.W(f,P+(1<<17))),y==1&&(p=M.J,m=M.h,I=511,x=31),y==2){b=O(d,T,5)+257,E=O(d,T+5,5)+1,C=O(d,T+10,4)+4,T+=14;let z=1;for(var H=0;H<38;H+=2)M.Q[H]=0,M.Q[H+1]=0;for(H=0;H<C;H++){const Y=O(d,T+3*H,3);M.Q[1+(M.X[H]<<1)]=Y,Y>z&&(z=Y)}T+=3*C,L(M.Q,z),B(M.Q,z,M.u),p=M.w,m=M.d,T=F(M.u,(1<<z)-1,b+E,d,T,M.v);const V=S.V(M.v,0,b,M.C);I=(1<<V)-1;const Q=S.V(M.v,b,E,M.D);x=(1<<Q)-1,L(M.C,V),B(M.C,V,p),L(M.D,Q),B(M.D,Q,m)}for(;;){const z=p[N(d,T)&I];T+=15&z;const V=z>>>4;if(!(V>>>8))f[P++]=V;else{if(V==256)break;{let Q=P+V-254;if(V>264){const ke=M.q[V-257];Q=P+(ke>>>3)+O(d,T,7&ke),T+=7&ke}const Y=m[N(d,T)&x];T+=15&Y;const ie=Y>>>4,ne=M.c[ie],J=(ne>>>4)+_(d,T,15&ne);for(T+=15&ne;P<Q;)f[P]=f[P++-J],f[P]=f[P++-J],f[P]=f[P++-J],f[P]=f[P++-J];P=Q}}}}else{(7&T)!=0&&(T+=8-(7&T));const z=4+(T>>>3),V=d[z-4]|d[z-3]<<8;R&&(f=u.H.W(f,P+V)),f.set(new h(d.buffer,d.byteOffset+z,V),P),T=z+V<<3,P+=V}return f.length==P?f:f.slice(0,P)},u.H.W=function(d,f){const h=d.length;if(f<=h)return d;const p=new Uint8Array(h<<1);return p.set(d,0),p},u.H.R=function(d,f,h,p,m,g){const y=u.H.e,b=u.H.Z;let E=0;for(;E<h;){const C=d[b(p,m)&f];m+=15&C;const I=C>>>4;if(I<=15)g[E]=I,E++;else{let x=0,P=0;I==16?(P=3+y(p,m,2),m+=2,x=g[E-1]):I==17?(P=3+y(p,m,3),m+=3):I==18&&(P=11+y(p,m,7),m+=7);const T=E+P;for(;E<T;)g[E]=x,E++}}return m},u.H.V=function(d,f,h,p){let m=0,g=0;const y=p.length>>>1;for(;g<h;){const b=d[g+f];p[g<<1]=0,p[1+(g<<1)]=b,b>m&&(m=b),g++}for(;g<y;)p[g<<1]=0,p[1+(g<<1)]=0,g++;return m},u.H.n=function(d,f){const h=u.H.m,p=d.length;let m,g,y,b;const E=h.j;for(var C=0;C<=f;C++)E[C]=0;for(C=1;C<p;C+=2)E[d[C]]++;const I=h.K;for(m=0,E[0]=0,g=1;g<=f;g++)m=m+E[g-1]<<1,I[g]=m;for(y=0;y<p;y+=2)b=d[y+1],b!=0&&(d[y]=I[b],I[b]++)},u.H.A=function(d,f,h){const p=d.length,m=u.H.m.r;for(let g=0;g<p;g+=2)if(d[g+1]!=0){const y=g>>1,b=d[g+1],E=y<<4|b,C=f-b;let I=d[g]<<C;const x=I+(1<<C);for(;I!=x;)h[m[I]>>>15-f]=E,I++}},u.H.l=function(d,f){const h=u.H.m.r,p=15-f;for(let m=0;m<d.length;m+=2){const g=d[m]<<f-d[m+1];d[m]=h[g]>>>p}},u.H.M=function(d,f,h){h<<=7&f;const p=f>>>3;d[p]|=h,d[p+1]|=h>>>8},u.H.I=function(d,f,h){h<<=7&f;const p=f>>>3;d[p]|=h,d[p+1]|=h>>>8,d[p+2]|=h>>>16},u.H.e=function(d,f,h){return(d[f>>>3]|d[1+(f>>>3)]<<8)>>>(7&f)&(1<<h)-1},u.H.b=function(d,f,h){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)&(1<<h)-1},u.H.Z=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)},u.H.i=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16|d[3+(f>>>3)]<<24)>>>(7&f)},u.H.m=(function(){const d=Uint16Array,f=Uint32Array;return{K:new d(16),j:new d(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new d(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new f(32),J:new d(512),_:[],h:new d(32),$:[],w:new d(32768),C:[],v:[],d:new d(32768),D:[],u:new d(512),Q:[],r:new d(32768),s:new f(286),Y:new f(30),a:new f(19),t:new f(15e3),k:new d(65536),g:new d(32768)}})(),(function(){const d=u.H.m;for(var f=0;f<32768;f++){let p=f;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,d.r[f]=(p>>>16|p<<16)>>>17}function h(p,m,g){for(;m--!=0;)p.push(0,g)}for(f=0;f<32;f++)d.q[f]=d.S[f]<<3|d.T[f],d.c[f]=d.p[f]<<4|d.z[f];h(d._,144,8),h(d._,112,9),h(d._,24,7),h(d._,8,8),u.H.n(d._,9),u.H.A(d._,9,d.J),u.H.l(d._,9),h(d.$,32,5),u.H.n(d.$,5),u.H.A(d.$,5,d.h),u.H.l(d.$,5),h(d.Q,19,0),h(d.C,286,0),h(d.D,30,0),h(d.v,320,0)})(),u.H.N})();function s(u){return[1,null,3,1,2,null,4][u.ctype]*u.depth}function o(u,d,f,h,p){let m=s(d);const g=Math.ceil(h*m/8);let y,b;m=Math.ceil(m/8);let E=u[f],C=0;if(E>1&&(u[f]=[0,0,1][E-2]),E==3)for(C=m;C<g;C++)u[C+1]=u[C+1]+(u[C+1-m]>>>1)&255;for(let I=0;I<p;I++)if(y=f+I*g,b=y+I+1,E=u[b-1],C=0,E==0)for(;C<g;C++)u[y+C]=u[b+C];else if(E==1){for(;C<m;C++)u[y+C]=u[b+C];for(;C<g;C++)u[y+C]=u[b+C]+u[y+C-m]}else if(E==2)for(;C<g;C++)u[y+C]=u[b+C]+u[y+C-g];else if(E==3){for(;C<m;C++)u[y+C]=u[b+C]+(u[y+C-g]>>>1);for(;C<g;C++)u[y+C]=u[b+C]+(u[y+C-g]+u[y+C-m]>>>1)}else{for(;C<m;C++)u[y+C]=u[b+C]+a(0,u[y+C-g],0);for(;C<g;C++)u[y+C]=u[b+C]+a(u[y+C-m],u[y+C-g],u[y+C-m-g])}return u}function a(u,d,f){const h=u+d-f,p=h-u,m=h-d,g=h-f;return p*p<=m*m&&p*p<=g*g?u:m*m<=g*g?d:f}function l(u,d,f){f.width=t.readUint(u,d),d+=4,f.height=t.readUint(u,d),d+=4,f.depth=u[d],d++,f.ctype=u[d],d++,f.compress=u[d],d++,f.filter=u[d],d++,f.interlace=u[d],d++}function c(u,d,f,h,p,m,g,y,b){const E=Math.min(d,p),C=Math.min(f,m);let I=0,x=0;for(let N=0;N<C;N++)for(let M=0;M<E;M++)if(g>=0&&y>=0?(I=N*d+M<<2,x=(y+N)*p+g+M<<2):(I=(-y+N)*d-g+M<<2,x=N*p+M<<2),b==0)h[x]=u[I],h[x+1]=u[I+1],h[x+2]=u[I+2],h[x+3]=u[I+3];else if(b==1){var P=u[I+3]*.00392156862745098,T=u[I]*P,S=u[I+1]*P,_=u[I+2]*P,O=h[x+3]*(1/255),F=h[x]*O,L=h[x+1]*O,B=h[x+2]*O;const R=1-P,H=P+O*R,z=H==0?0:1/H;h[x+3]=255*H,h[x+0]=(T+F*R)*z,h[x+1]=(S+L*R)*z,h[x+2]=(_+B*R)*z}else if(b==2)P=u[I+3],T=u[I],S=u[I+1],_=u[I+2],O=h[x+3],F=h[x],L=h[x+1],B=h[x+2],P==O&&T==F&&S==L&&_==B?(h[x]=0,h[x+1]=0,h[x+2]=0,h[x+3]=0):(h[x]=T,h[x+1]=S,h[x+2]=_,h[x+3]=P);else if(b==3){if(P=u[I+3],T=u[I],S=u[I+1],_=u[I+2],O=h[x+3],F=h[x],L=h[x+1],B=h[x+2],P==O&&T==F&&S==L&&_==B)continue;if(P<220&&O>20)return!1}return!0}return{decode:function(d){const f=new Uint8Array(d);let h=8;const p=t,m=p.readUshort,g=p.readUint,y={tabs:{},frames:[]},b=new Uint8Array(f.length);let E,C=0,I=0;const x=[137,80,78,71,13,10,26,10];for(var P=0;P<8;P++)if(f[P]!=x[P])throw"The input is not a PNG file!";for(;h<f.length;){const N=p.readUint(f,h);h+=4;const M=p.readASCII(f,h,4);if(h+=4,M=="IHDR")l(f,h,y);else if(M=="iCCP"){for(var T=h;f[T]!=0;)T++;p.readASCII(f,h,T-h),f[T+1];const R=f.slice(T+2,h+N);let H=null;try{H=r(R)}catch{H=i(R)}y.tabs[M]=H}else if(M=="CgBI")y.tabs[M]=f.slice(h,h+4);else if(M=="IDAT"){for(P=0;P<N;P++)b[C+P]=f[h+P];C+=N}else if(M=="acTL")y.tabs[M]={num_frames:g(f,h),num_plays:g(f,h+4)},E=new Uint8Array(f.length);else if(M=="fcTL"){I!=0&&((B=y.frames[y.frames.length-1]).data=n(y,E.slice(0,I),B.rect.width,B.rect.height),I=0);const R={x:g(f,h+12),y:g(f,h+16),width:g(f,h+4),height:g(f,h+8)};let H=m(f,h+22);H=m(f,h+20)/(H==0?100:H);const z={rect:R,delay:Math.round(1e3*H),dispose:f[h+24],blend:f[h+25]};y.frames.push(z)}else if(M=="fdAT"){for(P=0;P<N-4;P++)E[I+P]=f[h+P+4];I+=N-4}else if(M=="pHYs")y.tabs[M]=[p.readUint(f,h),p.readUint(f,h+4),f[h+8]];else if(M=="cHRM")for(y.tabs[M]=[],P=0;P<8;P++)y.tabs[M].push(p.readUint(f,h+4*P));else if(M=="tEXt"||M=="zTXt"){y.tabs[M]==null&&(y.tabs[M]={});var S=p.nextZero(f,h),_=p.readASCII(f,h,S-h),O=h+N-S-1;if(M=="tEXt")L=p.readASCII(f,S+1,O);else{var F=r(f.slice(S+2,S+2+O));L=p.readUTF8(F,0,F.length)}y.tabs[M][_]=L}else if(M=="iTXt"){y.tabs[M]==null&&(y.tabs[M]={}),S=0,T=h,S=p.nextZero(f,T),_=p.readASCII(f,T,S-T);const R=f[T=S+1];var L;f[T+1],T+=2,S=p.nextZero(f,T),p.readASCII(f,T,S-T),T=S+1,S=p.nextZero(f,T),p.readUTF8(f,T,S-T),O=N-((T=S+1)-h),R==0?L=p.readUTF8(f,T,O):(F=r(f.slice(T,T+O)),L=p.readUTF8(F,0,F.length)),y.tabs[M][_]=L}else if(M=="PLTE")y.tabs[M]=p.readBytes(f,h,N);else if(M=="hIST"){const R=y.tabs.PLTE.length/3;for(y.tabs[M]=[],P=0;P<R;P++)y.tabs[M].push(m(f,h+2*P))}else if(M=="tRNS")y.ctype==3?y.tabs[M]=p.readBytes(f,h,N):y.ctype==0?y.tabs[M]=m(f,h):y.ctype==2&&(y.tabs[M]=[m(f,h),m(f,h+2),m(f,h+4)]);else if(M=="gAMA")y.tabs[M]=p.readUint(f,h)/1e5;else if(M=="sRGB")y.tabs[M]=f[h];else if(M=="bKGD")y.ctype==0||y.ctype==4?y.tabs[M]=[m(f,h)]:y.ctype==2||y.ctype==6?y.tabs[M]=[m(f,h),m(f,h+2),m(f,h+4)]:y.ctype==3&&(y.tabs[M]=f[h]);else if(M=="IEND")break;h+=N,p.readUint(f,h),h+=4}var B;return I!=0&&((B=y.frames[y.frames.length-1]).data=n(y,E.slice(0,I),B.rect.width,B.rect.height)),y.data=n(y,b,y.width,y.height),delete y.compress,delete y.interlace,delete y.filter,y},toRGBA8:function(d){const f=d.width,h=d.height;if(d.tabs.acTL==null)return[e(d.data,f,h,d).buffer];const p=[];d.frames[0].data==null&&(d.frames[0].data=d.data);const m=f*h*4,g=new Uint8Array(m),y=new Uint8Array(m),b=new Uint8Array(m);for(let C=0;C<d.frames.length;C++){const I=d.frames[C],x=I.rect.x,P=I.rect.y,T=I.rect.width,S=I.rect.height,_=e(I.data,T,S,d);if(C!=0)for(var E=0;E<m;E++)b[E]=g[E];if(I.blend==0?c(_,T,S,g,f,h,x,P,0):I.blend==1&&c(_,T,S,g,f,h,x,P,1),p.push(g.buffer.slice(0)),I.dispose!=0){if(I.dispose==1)c(y,T,S,g,f,h,x,P,0);else if(I.dispose==2)for(E=0;E<m;E++)g[E]=b[E]}}return p},_paeth:a,_copyTile:c,_bin:t}})();(function(){const{_copyTile:t}=Vs,{_bin:e}=Vs,n=Vs._paeth;var r={table:(function(){const T=new Uint32Array(256);for(let S=0;S<256;S++){let _=S;for(let O=0;O<8;O++)1&_?_=3988292384^_>>>1:_>>>=1;T[S]=_}return T})(),update(T,S,_,O){for(let F=0;F<O;F++)T=r.table[255&(T^S[_+F])]^T>>>8;return T},crc:(T,S,_)=>4294967295^r.update(4294967295,T,S,_)};function i(T,S,_,O){S[_]+=T[0]*O>>4,S[_+1]+=T[1]*O>>4,S[_+2]+=T[2]*O>>4,S[_+3]+=T[3]*O>>4}function s(T){return Math.max(0,Math.min(255,T))}function o(T,S){const _=T[0]-S[0],O=T[1]-S[1],F=T[2]-S[2],L=T[3]-S[3];return _*_+O*O+F*F+L*L}function a(T,S,_,O,F,L,B){B==null&&(B=1);const N=O.length,M=[];for(var R=0;R<N;R++){const J=O[R];M.push([J>>>0&255,J>>>8&255,J>>>16&255,J>>>24&255])}for(R=0;R<N;R++){let J=4294967295;for(var H=0,z=0;z<N;z++){var V=o(M[R],M[z]);z!=R&&V<J&&(J=V,H=z)}}const Q=new Uint32Array(F.buffer),Y=new Int16Array(S*_*4),ie=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(R=0;R<ie.length;R++)ie[R]=255*((ie[R]+.5)/16-.5);for(let J=0;J<_;J++)for(let ke=0;ke<S;ke++){var ne;R=4*(J*S+ke),B!=2?ne=[s(T[R]+Y[R]),s(T[R+1]+Y[R+1]),s(T[R+2]+Y[R+2]),s(T[R+3]+Y[R+3])]:(V=ie[4*(3&J)+(3&ke)],ne=[s(T[R]+V),s(T[R+1]+V),s(T[R+2]+V),s(T[R+3]+V)]),H=0;let ze=16777215;for(z=0;z<N;z++){const Le=o(ne,M[z]);Le<ze&&(ze=Le,H=z)}const he=M[H],Ee=[ne[0]-he[0],ne[1]-he[1],ne[2]-he[2],ne[3]-he[3]];B==1&&(ke!=S-1&&i(Ee,Y,R+4,7),J!=_-1&&(ke!=0&&i(Ee,Y,R+4*S-4,3),i(Ee,Y,R+4*S,5),ke!=S-1&&i(Ee,Y,R+4*S+4,1))),L[R>>2]=H,Q[R>>2]=O[H]}}function l(T,S,_,O,F){F==null&&(F={});const{crc:L}=r,B=e.writeUint,N=e.writeUshort,M=e.writeASCII;let R=8;const H=T.frames.length>1;let z,V=!1,Q=33+(H?20:0);if(F.sRGB!=null&&(Q+=13),F.pHYs!=null&&(Q+=21),F.iCCP!=null&&(z=pako.deflate(F.iCCP),Q+=21+z.length+4),T.ctype==3){for(var Y=T.plte.length,ie=0;ie<Y;ie++)T.plte[ie]>>>24!=255&&(V=!0);Q+=8+3*Y+4+(V?8+1*Y+4:0)}for(var ne=0;ne<T.frames.length;ne++)H&&(Q+=38),Q+=(he=T.frames[ne]).cimg.length+12,ne!=0&&(Q+=4);Q+=12;const J=new Uint8Array(Q),ke=[137,80,78,71,13,10,26,10];for(ie=0;ie<8;ie++)J[ie]=ke[ie];if(B(J,R,13),R+=4,M(J,R,"IHDR"),R+=4,B(J,R,S),R+=4,B(J,R,_),R+=4,J[R]=T.depth,R++,J[R]=T.ctype,R++,J[R]=0,R++,J[R]=0,R++,J[R]=0,R++,B(J,R,L(J,R-17,17)),R+=4,F.sRGB!=null&&(B(J,R,1),R+=4,M(J,R,"sRGB"),R+=4,J[R]=F.sRGB,R++,B(J,R,L(J,R-5,5)),R+=4),F.iCCP!=null){const Ee=13+z.length;B(J,R,Ee),R+=4,M(J,R,"iCCP"),R+=4,M(J,R,"ICC profile"),R+=11,R+=2,J.set(z,R),R+=z.length,B(J,R,L(J,R-(Ee+4),Ee+4)),R+=4}if(F.pHYs!=null&&(B(J,R,9),R+=4,M(J,R,"pHYs"),R+=4,B(J,R,F.pHYs[0]),R+=4,B(J,R,F.pHYs[1]),R+=4,J[R]=F.pHYs[2],R++,B(J,R,L(J,R-13,13)),R+=4),H&&(B(J,R,8),R+=4,M(J,R,"acTL"),R+=4,B(J,R,T.frames.length),R+=4,B(J,R,F.loop!=null?F.loop:0),R+=4,B(J,R,L(J,R-12,12)),R+=4),T.ctype==3){for(B(J,R,3*(Y=T.plte.length)),R+=4,M(J,R,"PLTE"),R+=4,ie=0;ie<Y;ie++){const Ee=3*ie,Le=T.plte[ie],pe=255&Le,xe=Le>>>8&255,Me=Le>>>16&255;J[R+Ee+0]=pe,J[R+Ee+1]=xe,J[R+Ee+2]=Me}if(R+=3*Y,B(J,R,L(J,R-3*Y-4,3*Y+4)),R+=4,V){for(B(J,R,Y),R+=4,M(J,R,"tRNS"),R+=4,ie=0;ie<Y;ie++)J[R+ie]=T.plte[ie]>>>24&255;R+=Y,B(J,R,L(J,R-Y-4,Y+4)),R+=4}}let ze=0;for(ne=0;ne<T.frames.length;ne++){var he=T.frames[ne];H&&(B(J,R,26),R+=4,M(J,R,"fcTL"),R+=4,B(J,R,ze++),R+=4,B(J,R,he.rect.width),R+=4,B(J,R,he.rect.height),R+=4,B(J,R,he.rect.x),R+=4,B(J,R,he.rect.y),R+=4,N(J,R,O[ne]),R+=2,N(J,R,1e3),R+=2,J[R]=he.dispose,R++,J[R]=he.blend,R++,B(J,R,L(J,R-30,30)),R+=4);const Ee=he.cimg;B(J,R,(Y=Ee.length)+(ne==0?0:4)),R+=4;const Le=R;M(J,R,ne==0?"IDAT":"fdAT"),R+=4,ne!=0&&(B(J,R,ze++),R+=4),J.set(Ee,R),R+=Y,B(J,R,L(J,Le,R-Le)),R+=4}return B(J,R,0),R+=4,M(J,R,"IEND"),R+=4,B(J,R,L(J,R-4,4)),R+=4,J.buffer}function c(T,S,_){for(let O=0;O<T.frames.length;O++){const F=T.frames[O];F.rect.width;const L=F.rect.height,B=new Uint8Array(L*F.bpl+L);F.cimg=h(F.img,L,F.bpp,F.bpl,B,S,_)}}function u(T,S,_,O,F){const L=F[0],B=F[1],N=F[2],M=F[3],R=F[4],H=F[5];let z=6,V=8,Q=255;for(var Y=0;Y<T.length;Y++){const tt=new Uint8Array(T[Y]);for(var ie=tt.length,ne=0;ne<ie;ne+=4)Q&=tt[ne+3]}const J=Q!=255,ke=(function(Ae,We,lt,ht,wt,Lt){const Rt=[];for(var pt=0;pt<Ae.length;pt++){const Vt=new Uint8Array(Ae[pt]),Qt=new Uint32Array(Vt.buffer);var He;let Jt=0,Sn=0,en=We,cn=lt,Bt=ht?1:0;if(pt!=0){const tn=Lt||ht||pt==1||Rt[pt-2].dispose!=0?1:2;let hn=0,Gi=1e9;for(let Zi=0;Zi<tn;Zi++){var st=new Uint8Array(Ae[pt-1-Zi]);const ds=new Uint32Array(Ae[pt-1-Zi]);let _t=We,Fn=lt,Ai=-1,ci=-1;for(let Qn=0;Qn<lt;Qn++)for(let ui=0;ui<We;ui++)Qt[Mt=Qn*We+ui]!=ds[Mt]&&(ui<_t&&(_t=ui),ui>Ai&&(Ai=ui),Qn<Fn&&(Fn=Qn),Qn>ci&&(ci=Qn));Ai==-1&&(_t=Fn=Ai=ci=0),wt&&((1&_t)==1&&_t--,(1&Fn)==1&&Fn--);const rr=(Ai-_t+1)*(ci-Fn+1);rr<Gi&&(Gi=rr,hn=Zi,Jt=_t,Sn=Fn,en=Ai-_t+1,cn=ci-Fn+1)}st=new Uint8Array(Ae[pt-1-hn]),hn==1&&(Rt[pt-1].dispose=2),He=new Uint8Array(en*cn*4),t(st,We,lt,He,en,cn,-Jt,-Sn,0),Bt=t(Vt,We,lt,He,en,cn,-Jt,-Sn,3)?1:0,Bt==1?f(Vt,We,lt,He,{x:Jt,y:Sn,width:en,height:cn}):t(Vt,We,lt,He,en,cn,-Jt,-Sn,0)}else He=Vt.slice(0);Rt.push({rect:{x:Jt,y:Sn,width:en,height:cn},img:He,blend:Bt,dispose:0})}if(ht)for(pt=0;pt<Rt.length;pt++){if((dn=Rt[pt]).blend==1)continue;const Vt=dn.rect,Qt=Rt[pt-1].rect,Jt=Math.min(Vt.x,Qt.x),Sn=Math.min(Vt.y,Qt.y),en={x:Jt,y:Sn,width:Math.max(Vt.x+Vt.width,Qt.x+Qt.width)-Jt,height:Math.max(Vt.y+Vt.height,Qt.y+Qt.height)-Sn};Rt[pt-1].dispose=1,pt-1!=0&&d(Ae,We,lt,Rt,pt-1,en,wt),d(Ae,We,lt,Rt,pt,en,wt)}let Ot=0;if(Ae.length!=1)for(var Mt=0;Mt<Rt.length;Mt++){var dn;Ot+=(dn=Rt[Mt]).rect.width*dn.rect.height}return Rt})(T,S,_,L,B,N),ze={},he=[],Ee=[];if(O!=0){const tt=[];for(ne=0;ne<ke.length;ne++)tt.push(ke[ne].img.buffer);const Ae=(function(wt){let Lt=0;for(var Rt=0;Rt<wt.length;Rt++)Lt+=wt[Rt].byteLength;const pt=new Uint8Array(Lt);let He=0;for(Rt=0;Rt<wt.length;Rt++){const st=new Uint8Array(wt[Rt]),Ot=st.length;for(let Mt=0;Mt<Ot;Mt+=4){let dn=st[Mt],Vt=st[Mt+1],Qt=st[Mt+2];const Jt=st[Mt+3];Jt==0&&(dn=Vt=Qt=0),pt[He+Mt]=dn,pt[He+Mt+1]=Vt,pt[He+Mt+2]=Qt,pt[He+Mt+3]=Jt}He+=Ot}return pt.buffer})(tt),We=m(Ae,O);for(ne=0;ne<We.plte.length;ne++)he.push(We.plte[ne].est.rgba);let lt=0;for(ne=0;ne<ke.length;ne++){const ht=(pe=ke[ne]).img.length;var Le=new Uint8Array(We.inds.buffer,lt>>2,ht>>2);Ee.push(Le);const wt=new Uint8Array(We.abuf,lt,ht);H&&a(pe.img,pe.rect.width,pe.rect.height,he,wt,Le),pe.img.set(wt),lt+=ht}}else for(Y=0;Y<ke.length;Y++){var pe=ke[Y];const tt=new Uint32Array(pe.img.buffer);var xe=pe.rect.width;for(ie=tt.length,Le=new Uint8Array(ie),Ee.push(Le),ne=0;ne<ie;ne++){const Ae=tt[ne];if(ne!=0&&Ae==tt[ne-1])Le[ne]=Le[ne-1];else if(ne>xe&&Ae==tt[ne-xe])Le[ne]=Le[ne-xe];else{let We=ze[Ae];if(We==null&&(ze[Ae]=We=he.length,he.push(Ae),he.length>=300))break;Le[ne]=We}}}const Me=he.length;for(Me<=256&&R==0&&(V=Me<=2?1:Me<=4?2:Me<=16?4:8,V=Math.max(V,M)),Y=0;Y<ke.length;Y++){(pe=ke[Y]).rect.x,pe.rect.y,xe=pe.rect.width;const tt=pe.rect.height;let Ae=pe.img;new Uint32Array(Ae.buffer);let We=4*xe,lt=4;if(Me<=256&&R==0){We=Math.ceil(V*xe/8);var Ue=new Uint8Array(We*tt);const ht=Ee[Y];for(let wt=0;wt<tt;wt++){ne=wt*We;const Lt=wt*xe;if(V==8)for(var qe=0;qe<xe;qe++)Ue[ne+qe]=ht[Lt+qe];else if(V==4)for(qe=0;qe<xe;qe++)Ue[ne+(qe>>1)]|=ht[Lt+qe]<<4-4*(1&qe);else if(V==2)for(qe=0;qe<xe;qe++)Ue[ne+(qe>>2)]|=ht[Lt+qe]<<6-2*(3&qe);else if(V==1)for(qe=0;qe<xe;qe++)Ue[ne+(qe>>3)]|=ht[Lt+qe]<<7-1*(7&qe)}Ae=Ue,z=3,lt=1}else if(J==0&&ke.length==1){Ue=new Uint8Array(xe*tt*3);const ht=xe*tt;for(ne=0;ne<ht;ne++){const wt=3*ne,Lt=4*ne;Ue[wt]=Ae[Lt],Ue[wt+1]=Ae[Lt+1],Ue[wt+2]=Ae[Lt+2]}Ae=Ue,z=2,lt=3,We=3*xe}pe.img=Ae,pe.bpl=We,pe.bpp=lt}return{ctype:z,depth:V,plte:he,frames:ke}}function d(T,S,_,O,F,L,B){const N=Uint8Array,M=Uint32Array,R=new N(T[F-1]),H=new M(T[F-1]),z=F+1<T.length?new N(T[F+1]):null,V=new N(T[F]),Q=new M(V.buffer);let Y=S,ie=_,ne=-1,J=-1;for(let ze=0;ze<L.height;ze++)for(let he=0;he<L.width;he++){const Ee=L.x+he,Le=L.y+ze,pe=Le*S+Ee,xe=Q[pe];xe==0||O[F-1].dispose==0&&H[pe]==xe&&(z==null||z[4*pe+3]!=0)||(Ee<Y&&(Y=Ee),Ee>ne&&(ne=Ee),Le<ie&&(ie=Le),Le>J&&(J=Le))}ne==-1&&(Y=ie=ne=J=0),B&&((1&Y)==1&&Y--,(1&ie)==1&&ie--),L={x:Y,y:ie,width:ne-Y+1,height:J-ie+1};const ke=O[F];ke.rect=L,ke.blend=1,ke.img=new Uint8Array(L.width*L.height*4),O[F-1].dispose==0?(t(R,S,_,ke.img,L.width,L.height,-L.x,-L.y,0),f(V,S,_,ke.img,L)):t(V,S,_,ke.img,L.width,L.height,-L.x,-L.y,0)}function f(T,S,_,O,F){t(T,S,_,O,F.width,F.height,-F.x,-F.y,2)}function h(T,S,_,O,F,L,B){const N=[];let M,R=[0,1,2,3,4];L!=-1?R=[L]:(S*O>5e5||_==1)&&(R=[0]),B&&(M={level:0});const H=Jhe;for(var z=0;z<R.length;z++){for(let Y=0;Y<S;Y++)p(F,T,Y,O,_,R[z]);N.push(H.deflate(F,M))}let V,Q=1e9;for(z=0;z<N.length;z++)N[z].length<Q&&(V=z,Q=N[z].length);return N[V]}function p(T,S,_,O,F,L){const B=_*O;let N=B+_;if(T[N]=L,N++,L==0)if(O<500)for(var M=0;M<O;M++)T[N+M]=S[B+M];else T.set(new Uint8Array(S.buffer,B,O),N);else if(L==1){for(M=0;M<F;M++)T[N+M]=S[B+M];for(M=F;M<O;M++)T[N+M]=S[B+M]-S[B+M-F]+256&255}else if(_==0){for(M=0;M<F;M++)T[N+M]=S[B+M];if(L==2)for(M=F;M<O;M++)T[N+M]=S[B+M];if(L==3)for(M=F;M<O;M++)T[N+M]=S[B+M]-(S[B+M-F]>>1)+256&255;if(L==4)for(M=F;M<O;M++)T[N+M]=S[B+M]-n(S[B+M-F],0,0)+256&255}else{if(L==2)for(M=0;M<O;M++)T[N+M]=S[B+M]+256-S[B+M-O]&255;if(L==3){for(M=0;M<F;M++)T[N+M]=S[B+M]+256-(S[B+M-O]>>1)&255;for(M=F;M<O;M++)T[N+M]=S[B+M]+256-(S[B+M-O]+S[B+M-F]>>1)&255}if(L==4){for(M=0;M<F;M++)T[N+M]=S[B+M]+256-n(0,S[B+M-O],0)&255;for(M=F;M<O;M++)T[N+M]=S[B+M]+256-n(S[B+M-F],S[B+M-O],S[B+M-F-O])&255}}}function m(T,S){const _=new Uint8Array(T),O=_.slice(0),F=new Uint32Array(O.buffer),L=g(O,S),B=L[0],N=L[1],M=_.length,R=new Uint8Array(M>>2);let H;if(_.length<2e7)for(var z=0;z<M;z+=4)H=y(B,V=_[z]*(1/255),Q=_[z+1]*(1/255),Y=_[z+2]*(1/255),ie=_[z+3]*(1/255)),R[z>>2]=H.ind,F[z>>2]=H.est.rgba;else for(z=0;z<M;z+=4){var V=_[z]*.00392156862745098,Q=_[z+1]*(1/255),Y=_[z+2]*(1/255),ie=_[z+3]*(1/255);for(H=B;H.left;)H=b(H.est,V,Q,Y,ie)<=0?H.left:H.right;R[z>>2]=H.ind,F[z>>2]=H.est.rgba}return{abuf:O.buffer,inds:R,plte:N}}function g(T,S,_){_==null&&(_=1e-4);const O=new Uint32Array(T.buffer),F={i0:0,i1:T.length,bst:null,est:null,tdst:0,left:null,right:null};F.bst=I(T,F.i0,F.i1),F.est=x(F.bst);const L=[F];for(;L.length<S;){let N=0,M=0;for(var B=0;B<L.length;B++)L[B].est.L>N&&(N=L[B].est.L,M=B);if(N<_)break;const R=L[M],H=E(T,O,R.i0,R.i1,R.est.e,R.est.eMq255);if(R.i0>=H||R.i1<=H){R.est.L=0;continue}const z={i0:R.i0,i1:H,bst:null,est:null,tdst:0,left:null,right:null};z.bst=I(T,z.i0,z.i1),z.est=x(z.bst);const V={i0:H,i1:R.i1,bst:null,est:null,tdst:0,left:null,right:null};for(V.bst={R:[],m:[],N:R.bst.N-z.bst.N},B=0;B<16;B++)V.bst.R[B]=R.bst.R[B]-z.bst.R[B];for(B=0;B<4;B++)V.bst.m[B]=R.bst.m[B]-z.bst.m[B];V.est=x(V.bst),R.left=z,R.right=V,L[M]=z,L.push(V)}for(L.sort(((N,M)=>M.bst.N-N.bst.N)),B=0;B<L.length;B++)L[B].ind=B;return[F,L]}function y(T,S,_,O,F){if(T.left==null)return T.tdst=(function(z,V,Q,Y,ie){const ne=V-z[0],J=Q-z[1],ke=Y-z[2],ze=ie-z[3];return ne*ne+J*J+ke*ke+ze*ze})(T.est.q,S,_,O,F),T;const L=b(T.est,S,_,O,F);let B=T.left,N=T.right;L>0&&(B=T.right,N=T.left);const M=y(B,S,_,O,F);if(M.tdst<=L*L)return M;const R=y(N,S,_,O,F);return R.tdst<M.tdst?R:M}function b(T,S,_,O,F){const{e:L}=T;return L[0]*S+L[1]*_+L[2]*O+L[3]*F-T.eMq}function E(T,S,_,O,F,L){for(O-=4;_<O;){for(;C(T,_,F)<=L;)_+=4;for(;C(T,O,F)>L;)O-=4;if(_>=O)break;const B=S[_>>2];S[_>>2]=S[O>>2],S[O>>2]=B,_+=4,O-=4}for(;C(T,_,F)>L;)_-=4;return _+4}function C(T,S,_){return T[S]*_[0]+T[S+1]*_[1]+T[S+2]*_[2]+T[S+3]*_[3]}function I(T,S,_){const O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],F=[0,0,0,0],L=_-S>>2;for(let B=S;B<_;B+=4){const N=T[B]*.00392156862745098,M=T[B+1]*(1/255),R=T[B+2]*(1/255),H=T[B+3]*(1/255);F[0]+=N,F[1]+=M,F[2]+=R,F[3]+=H,O[0]+=N*N,O[1]+=N*M,O[2]+=N*R,O[3]+=N*H,O[5]+=M*M,O[6]+=M*R,O[7]+=M*H,O[10]+=R*R,O[11]+=R*H,O[15]+=H*H}return O[4]=O[1],O[8]=O[2],O[9]=O[6],O[12]=O[3],O[13]=O[7],O[14]=O[11],{R:O,m:F,N:L}}function x(T){const{R:S}=T,{m:_}=T,{N:O}=T,F=_[0],L=_[1],B=_[2],N=_[3],M=O==0?0:1/O,R=[S[0]-F*F*M,S[1]-F*L*M,S[2]-F*B*M,S[3]-F*N*M,S[4]-L*F*M,S[5]-L*L*M,S[6]-L*B*M,S[7]-L*N*M,S[8]-B*F*M,S[9]-B*L*M,S[10]-B*B*M,S[11]-B*N*M,S[12]-N*F*M,S[13]-N*L*M,S[14]-N*B*M,S[15]-N*N*M],H=R,z=P;let V=[Math.random(),Math.random(),Math.random(),Math.random()],Q=0,Y=0;if(O!=0)for(let ne=0;ne<16&&(V=z.multVec(H,V),Y=Math.sqrt(z.dot(V,V)),V=z.sml(1/Y,V),!(ne!=0&&Math.abs(Y-Q)<1e-9));ne++)Q=Y;const ie=[F*M,L*M,B*M,N*M];return{Cov:R,q:ie,e:V,L:Q,eMq255:z.dot(z.sml(255,ie),V),eMq:z.dot(V,ie),rgba:(Math.round(255*ie[3])<<24|Math.round(255*ie[2])<<16|Math.round(255*ie[1])<<8|Math.round(255*ie[0])<<0)>>>0}}var P={multVec:(T,S)=>[T[0]*S[0]+T[1]*S[1]+T[2]*S[2]+T[3]*S[3],T[4]*S[0]+T[5]*S[1]+T[6]*S[2]+T[7]*S[3],T[8]*S[0]+T[9]*S[1]+T[10]*S[2]+T[11]*S[3],T[12]*S[0]+T[13]*S[1]+T[14]*S[2]+T[15]*S[3]],dot:(T,S)=>T[0]*S[0]+T[1]*S[1]+T[2]*S[2]+T[3]*S[3],sml:(T,S)=>[T*S[0],T*S[1],T*S[2],T*S[3]]};Vs.encode=function(S,_,O,F,L,B,N){F==null&&(F=0),N==null&&(N=!1);const M=u(S,_,O,F,[!1,!1,!1,0,N,!1]);return c(M,-1),l(M,_,O,L,B)},Vs.encodeLL=function(S,_,O,F,L,B,N,M){const R={ctype:0+(F==1?0:2)+(L==0?0:4),depth:B,frames:[]},H=(F+L)*B,z=H*_;for(let V=0;V<S.length;V++)R.frames.push({rect:{x:0,y:0,width:_,height:O},img:new Uint8Array(S[V]),blend:0,dispose:1,bpp:Math.ceil(H/8),bpl:Math.ceil(z/8)});return c(R,0,!0),l(R,_,O,N,M)},Vs.encode.compress=u,Vs.encode.dither=a,Vs.quantize=m,Vs.quantize.getKDtree=g,Vs.quantize.getNearest=y})();const s6={toArrayBuffer(t,e){const n=t.width,r=t.height,i=n<<2,s=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(s.data.buffer),a=(32*n+31)/32<<2,l=a*r,c=122+l,u=new ArrayBuffer(c),d=new DataView(u),f=1<<20;let h,p,m,g,y=f,b=0,E=0,C=0;function I(T){d.setUint16(E,T,!0),E+=2}function x(T){d.setUint32(E,T,!0),E+=4}function P(T){E+=T}I(19778),x(c),P(4),x(122),x(108),x(n),x(-r>>>0),I(1),I(32),x(3),x(l),x(2835),x(2835),P(8),x(16711680),x(65280),x(255),x(4278190080),x(1466527264),(function T(){for(;b<r&&y>0;){for(g=122+b*a,h=0;h<i;)y--,p=o[C++],m=p>>>24,d.setUint32(g+h,p<<8|m),h+=4;b++}C<o.length?(y=f,setTimeout(T,s6._dly)):e(u)})()},toBlob(t,e){this.toArrayBuffer(t,(n=>{e(new Blob([n],{type:"image/bmp"}))}))},_dly:9};var Fi={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},epe={[Fi.CHROME]:16384,[Fi.FIREFOX]:11180,[Fi.DESKTOP_SAFARI]:16384,[Fi.IE]:8192,[Fi.IOS]:4096,[Fi.ETC]:8192};const xT=typeof window<"u",o6=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Oy=xT&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),tpe=(xT||o6)&&(Oy&&Oy.getOriginalSymbol(window,"File")||typeof File<"u"&&File),a6=(xT||o6)&&(Oy&&Oy.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function ST(t,e,n=Date.now()){return new Promise((r=>{const i=t.split(","),s=i[0].match(/:(.*?);/)[1],o=globalThis.atob(i[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const c=new Blob([l],{type:s});c.name=e,c.lastModified=n,r(c)}))}function l6(t){return new Promise(((e,n)=>{const r=new a6;r.onload=()=>e(r.result),r.onerror=i=>n(i),r.readAsDataURL(t)}))}function c6(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=i=>n(i),r.src=t}))}function du(){if(du.cachedResult!==void 0)return du.cachedResult;let t=Fi.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Fi.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Fi.IOS:/Safari/i.test(e)?t=Fi.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Fi.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Fi.IE),du.cachedResult=t,du.cachedResult}function u6(t,e){const n=du(),r=epe[n];let i=t,s=e,o=i*s;const a=i>s?s/i:i/s;for(;o>r*r;){const l=(r+i)/2,c=(r+s)/2;l<c?(s=c,i=c*a):(s=l*a,i=l),o=i*s}return{width:i,height:s}}function Qb(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function d6(t,e){const{width:n,height:r}=u6(t.width,t.height),[i,s]=Qb(n,r);return e&&/jpe?g/.test(e)&&(s.fillStyle="white",s.fillRect(0,0,i.width,i.height)),s.drawImage(t,0,0,i.width,i.height),i}function Fg(){return Fg.cachedResult!==void 0||(Fg.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Fg.cachedResult}function My(t,e={}){return new Promise((function(n,r){let i,s;var o=function(){try{return s=d6(i,e.fileType||t.type),n([i,s])}catch(l){return r(l)}},a=function(l){try{var c=function(u){try{throw u}catch(d){return r(d)}};try{let u;return l6(t).then((function(d){try{return u=d,c6(u).then((function(f){try{return i=f,(function(){try{return o()}catch(h){return r(h)}})()}catch(h){return c(h)}}),c)}catch(f){return c(f)}}),c)}catch(u){c(u)}}catch(u){return r(u)}};try{if(Fg()||[Fi.DESKTOP_SAFARI,Fi.MOBILE_SAFARI].includes(du()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then((function(l){try{return i=l,o()}catch{return a()}}),a)}catch{a()}}))}function Ny(t,e,n,r,i=1){return new Promise((function(s,o){let a;if(e==="image/png"){let c,u,d;return c=t.getContext("2d"),{data:u}=c.getImageData(0,0,t.width,t.height),d=Vs.encode([u.buffer],t.width,t.height,4096*i),a=new Blob([d],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let c=function(){return l.call(this)};if(e==="image/bmp")return new Promise((u=>s6.toBlob(t,u))).then((function(u){try{return a=u,a.name=n,a.lastModified=r,c.call(this)}catch(d){return o(d)}}).bind(this),o);{let u=function(){return c.call(this)};if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:i}).then((function(d){try{return a=d,a.name=n,a.lastModified=r,u.call(this)}catch(f){return o(f)}}).bind(this),o);{let d;return d=t.toDataURL(e,i),ST(d,n,r).then((function(f){try{return a=f,u.call(this)}catch(h){return o(h)}}).bind(this),o)}}}function l(){return s(a)}}))}function Co(t){t.width=0,t.height=0}function Id(){return new Promise((function(t,e){let n,r,i,s;return Id.cachedResult!==void 0?t(Id.cachedResult):ST("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(o){try{return n=o,My(n).then((function(a){try{return r=a[1],Ny(r,n.type,n.name,n.lastModified).then((function(l){try{return i=l,Co(r),My(i).then((function(c){try{return s=c[0],Id.cachedResult=s.width===1&&s.height===2,t(Id.cachedResult)}catch(u){return e(u)}}),e)}catch(c){return e(c)}}),e)}catch(l){return e(l)}}),e)}catch(a){return e(a)}}),e)}))}function f6(t){return new Promise(((e,n)=>{const r=new a6;r.onload=i=>{const s=new DataView(i.target.result);if(s.getUint16(0,!1)!=65496)return e(-2);const o=s.byteLength;let a=2;for(;a<o;){if(s.getUint16(a+2,!1)<=8)return e(-1);const l=s.getUint16(a,!1);if(a+=2,l==65505){if(s.getUint32(a+=2,!1)!=1165519206)return e(-1);const c=s.getUint16(a+=6,!1)==18761;a+=s.getUint32(a+4,c);const u=s.getUint16(a,c);a+=2;for(let d=0;d<u;d++)if(s.getUint16(a+12*d,c)==274)return e(s.getUint16(a+12*d+8,c))}else{if((65280&l)!=65280)break;a+=s.getUint16(a,!1)}}return e(-1)},r.onerror=i=>n(i),r.readAsArrayBuffer(t)}))}function h6(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:i}=e;let s,o=t;return isFinite(i)&&(n>i||r>i)&&([o,s]=Qb(n,r),n>r?(o.width=i,o.height=r/n*i):(o.width=n/r*i,o.height=i),s.drawImage(t,0,0,o.width,o.height),Co(t)),o}function p6(t,e){const{width:n}=t,{height:r}=t,[i,s]=Qb(n,r);switch(e>4&&e<9?(i.width=r,i.height=n):(i.width=n,i.height=r),e){case 2:s.transform(-1,0,0,1,n,0);break;case 3:s.transform(-1,0,0,-1,n,r);break;case 4:s.transform(1,0,0,-1,0,r);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,r,0);break;case 7:s.transform(0,-1,-1,0,r,n);break;case 8:s.transform(0,-1,1,0,0,n)}return s.drawImage(t,0,0,n,r),Co(t),i}function TP(t,e,n=0){return new Promise((function(r,i){let s,o,a,l,c,u,d,f,h,p,m,g,y,b,E,C,I,x,P,T;function S(O=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;s+=O,e.onProgress(Math.min(s,100))}function _(O){if(e.signal&&e.signal.aborted)throw e.signal.reason;s=Math.min(Math.max(O,s),100),e.onProgress(s)}return s=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,S(),My(t,e).then((function(O){try{return[,l]=O,S(),c=h6(l,e),S(),new Promise((function(F,L){var B;if(!(B=e.exifOrientation))return f6(t).then((function(M){try{return B=M,N.call(this)}catch(R){return L(R)}}).bind(this),L);function N(){return F(B)}return N.call(this)})).then((function(F){try{return u=F,S(),Id().then((function(L){try{return d=L?c:p6(c,u),S(),f=e.initialQuality||1,h=e.fileType||t.type,Ny(d,h,t.name,t.lastModified,f).then((function(B){try{{let M=function(){if(o--&&(E>a||E>y)){let H,z;return H=T?.95*P.width:P.width,z=T?.95*P.height:P.height,[I,x]=Qb(H,z),x.drawImage(P,0,0,H,z),f*=h==="image/png"?.85:.95,Ny(I,h,t.name,t.lastModified,f).then((function(V){try{return C=V,Co(P),P=I,E=C.size,_(Math.min(99,Math.floor((b-E)/(b-a)*100))),M}catch(Q){return i(Q)}}),i)}return[1]},R=function(){return Co(P),Co(I),Co(c),Co(d),Co(l),_(100),r(C)};if(p=B,S(),m=p.size>a,g=p.size>t.size,!m&&!g)return _(100),r(p);var N;return y=t.size,b=p.size,E=b,P=d,T=!e.alwaysKeepResolution&&m,(N=(function(H){for(;H;){if(H.then)return void H.then(N,i);try{if(H.pop){if(H.length)return H.pop()?R.call(this):H;H=M}else H=H.call(this)}catch(z){return i(z)}}}).bind(this))(M)}}catch(M){return i(M)}}).bind(this),i)}catch(B){return i(B)}}).bind(this),i)}catch(L){return i(L)}}).bind(this),i)}catch(F){return i(F)}}).bind(this),i)}))}const npe=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let L1;function rpe(t,e){return new Promise(((n,r)=>{L1||(L1=(function(o){const a=[];return a.push(o),URL.createObjectURL(new Blob(a))})(npe));const i=new Worker(L1);i.addEventListener("message",(function(o){if(e.signal&&e.signal.aborted)i.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void i.terminate();n(o.data.file),i.terminate()}else e.onProgress(o.data.progress)})),i.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",(()=>{r(e.signal.reason),i.terminate()})),i.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})}))}function jr(t,e){return new Promise((function(n,r){let i,s,o,a,l,c;if(i={...e},o=0,{onProgress:a}=i,i.maxSizeMB=i.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof i.useWebWorker!="boolean"||i.useWebWorker,delete i.useWebWorker,i.onProgress=h=>{o=h,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof tpe))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(c=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||c)return TP(t,i).then((function(h){try{return s=h,f.call(this)}catch(p){return r(p)}}).bind(this),r);var u=(function(){try{return f.call(this)}catch(h){return r(h)}}).bind(this),d=function(h){try{return TP(t,i).then((function(p){try{return s=p,u()}catch(m){return r(m)}}),r)}catch(p){return r(p)}};try{return i.libURL=i.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",rpe(t,i).then((function(h){try{return s=h,u()}catch{return d()}}),d)}catch{d()}function f(){try{s.name=t.name,s.lastModified=t.lastModified}catch{}try{i.preserveExif&&t.type==="image/jpeg"&&(!i.fileType||i.fileType&&i.fileType===t.type)&&(s=i6(t,s))}catch{}return n(s)}}))}jr.getDataUrlFromFile=l6,jr.getFilefromDataUrl=ST,jr.loadImage=c6,jr.drawImageInCanvas=d6,jr.drawFileInCanvas=My,jr.canvasToFile=Ny,jr.getExifOrientation=f6,jr.handleMaxWidthOrHeight=h6,jr.followExifOrientation=p6,jr.cleanupCanvasMemory=Co,jr.isAutoOrientationInBrowser=Id,jr.approximateBelowMaximumCanvasSizeOfBrowser=u6,jr.copyExifWithoutOrientation=i6,jr.getBrowserName=du,jr.version="2.0.2";function _o(t,...e){}function Ws(t,...e){}function m6(t,e,n){if(t.size>=e.size)return{file:e,wasCompressed:!1};const r=e.name.replace(/\.[^.]+$/,"");return{file:new File([t],`${r}_compressed.mp4`,{type:"video/mp4"}),wasCompressed:!0}}function ipe(t,e,n){return an.value?(n&&n(0),{file:t,wasCompressed:!1,wasSkipped:!0,aborted:!0}):null}function spe(t,e){return!!(!t||typeof t=="object"&&t&&"skip"in t&&t.skip)}function ope(t,e=200*1024){return t.size<=e}function ape(t){return t.type.startsWith("video/")}class g6{onProgress;context;constructor(e){this.context=e}setProgressCallback(e){this.onProgress=e}checkAbort(e){return ipe(e,this.context,this.onProgress)}resetProgress(){this.onProgress&&this.onProgress(0)}updateProgress(e){this.onProgress&&this.onProgress(Math.round(e))}log(...e){_o(this.context,...e)}}async function lpe(){if(!(typeof VideoEncoder<"u"&&typeof VideoDecoder<"u")||/Android.*Firefox/.test(navigator.userAgent))return!1;try{const r=(await p2()).includes("opus");return _o("MediaBunnyCompression","MediaBunny supported - Video encoding available, Opus codec available:",r),!0}catch{return!0}}async function cpe(){if(typeof AudioEncoder>"u")return!1;try{const t={codec:"opus",sampleRate:48e3,numberOfChannels:2,bitrate:128e3};return(await AudioEncoder.isConfigSupported(t)).supported||!1}catch{return!1}}async function upe(t,e,n){if(typeof AudioEncoder>"u")return!1;try{const r={codec:"opus",sampleRate:t,numberOfChannels:e,bitrate:n};return(await AudioEncoder.isConfigSupported(r)).supported||!1}catch{return!1}}function Th(t,e,n=!1){if(t)try{t.dispose()}catch{}if(e&&n)try{e.finalize()}catch{}}class dpe extends g6{constructor(e,n,r){super("MediaBunnyCompression"),this.parseAudioBitrate=e,this.mergeVideoAndAudioWithFFmpeg=n,this.compressWithFFmpeg=r}abortController=null;abort(){this.log("Abort requested"),this.resetProgress(),this.abortController&&(this.log("Aborting Mediabunny conversion"),this.abortController.abort(),this.abortController=null)}async cleanup(){this.abortController=null}async findSupportedOpusConfig(e,n,r,i){const s=Math.max(i,64e3),o=Array.from(new Set([r,48e3,24e3,e.sampleRate])).filter(l=>Number.isFinite(l)&&l>0),a=[{sampleRate:r,bitrate:i},...o.map(l=>({sampleRate:l,bitrate:s}))];for(const{sampleRate:l,bitrate:c}of a){if(!Number.isFinite(l)||l<=0||!Number.isFinite(c)||c<=0)continue;const u=Math.round(l),d=Math.round(c),f=await upe(u,n,d);if(this.log("Opus encoding support probe:",{trackId:e.id,codec:e.codec,targetChannels:n,sampleRate:u,bitrate:d,supported:f}),f)return{sampleRate:u,bitrate:d}}return null}async validateMediabunnyAudioConfig(e,n,r){const i=new Map;let s=await cpe(),o=r?null:this.parseAudioBitrate(n?.audioBitrate),a=r?null:typeof n?.audioSampleRate=="number"?n.audioSampleRate:null;if(this.log("Opus encoding supported (global check):",s),s&&e.length>0)for(const l of e){const c=n.audioChannels??l.numberOfChannels,u=n.audioSampleRate??l.sampleRate,d=r?64e3:this.parseAudioBitrate(n.audioBitrate)??128e3,f=await this.findSupportedOpusConfig(l,c,u,d);if(!f){s=!1,this.log("Opus encoder does not support requested settings; will copy audio track as-is via Mediabunny.",{trackId:l.id,preferredSampleRate:u,preferredBitrate:d,targetChannels:c});break}i.set(l.id,{sampleRate:f.sampleRate,bitrate:f.bitrate,channels:c}),(f.sampleRate!==u||f.bitrate!==d)&&this.log("Adjusted Mediabunny audio target due to encoder support limitations.",{trackId:l.id,preferredSampleRate:u,preferredBitrate:d,resolvedSampleRate:f.sampleRate,resolvedBitrate:f.bitrate}),r||(a=f.sampleRate,o=f.bitrate)}return{canEncodeOpus:s,audioConfigByTrack:i,desiredAudioSampleRate:a,desiredAudioBitrate:o}}buildConversionOptions(e,n,r,i,s,o,a,l){return{input:e,output:n,video:u=>{const d={codec:"avc",...o?{bitrate:o}:{}},f=r.maxSize;return typeof f=="number"&&Number.isFinite(f)&&(u.displayWidth>u.displayHeight?d.width=Math.min(u.displayWidth,f):d.height=Math.min(u.displayHeight,f),this.log("Applying video resize:",{originalWidth:u.displayWidth,originalHeight:u.displayHeight,maxSize:f,targetWidth:d.width,targetHeight:d.height,bitrate:o||"custom"})),d},audio:a?i&&s?{codec:"opus",bitrate:s,forceTranscode:!0}:u=>{const d=l.get(u.id),f=d?.channels??r.audioChannels??u.numberOfChannels,h=d?.sampleRate??r.audioSampleRate??u.sampleRate;this.log("Configuring audio track for compression:",{inputCodec:u.codec,inputChannels:u.numberOfChannels,inputSampleRate:u.sampleRate,targetChannels:f,targetSampleRate:h});const p=d?.bitrate??this.parseAudioBitrate(r.audioBitrate)??128e3;return{codec:"opus",forceTranscode:!0,...typeof f=="number"?{numberOfChannels:f}:{},...typeof h=="number"?{sampleRate:h}:{},bitrate:p}}:u=>{this.log("Copying audio track as-is (Opus encoding not supported):",{trackId:u.id,codec:u.codec,channels:u.numberOfChannels,sampleRate:u.sampleRate})},showWarnings:!1}}validateConversion(e,n,r,i){if(e.discardedTracks.length>0){this.log("Discarded tracks:",e.discardedTracks.map(o=>({type:o.track.type,reason:o.reason})));const s=e.discardedTracks.filter(o=>o.track.type==="video"||o.track.type==="audio");if(s.length>0&&(console.warn("[MediaBunnyCompression] Important tracks discarded:",s.map(a=>({type:a.track.type,reason:a.reason,codec:a.track.type==="audio"?a.track.codec:void 0}))),s.some(a=>a.track.type==="audio"&&a.reason==="no_encodable_target_codec")&&i))throw Ws(this.context,"Mediabunny cannot encode audio for this environment, falling back to FFmpeg."),Th(n,r,!0),new Error("mediabunny-unsupported-audio-codec")}return e.isValid?null:(Ws(this.context,"Conversion is not valid:",e.discardedTracks),Th(n,r,!0),{file:new File([],""),wasCompressed:!1,wasSkipped:!0})}async executeConversion(e,n){const r=new Promise(i=>{this.abortController.signal.addEventListener("abort",()=>{this.log("Mediabunny conversion aborted"),e.cancel().then(i)})});return await Promise.race([e.execute(),r]),this.checkAbort(n)}async compressWithMediabunny(e,n){let r=null,i=null,s=null;const o=typeof n?.mediabunnyAudioQuality<"u",a=n?.mediabunnyAudioQuality,l=n?.mediabunnyVideoQuality??n?.mediabunnyAudioQuality;try{this.log("Starting Mediabunny compression"),this.abortController=new AbortController,r=new c2({source:new nI(e),formats:tI}),s=new ZR,i=new m2({target:s,format:new xk({fastStart:"in-memory"})});const c=await r.getAudioTracks(),u=c.length>0;this.log("Input audio tracks:",c.length),c.length>0&&this.log("First audio track codec:",c[0].codec);const d=await this.validateMediabunnyAudioConfig(c,n,o);let{canEncodeOpus:f,audioConfigByTrack:h,desiredAudioSampleRate:p,desiredAudioBitrate:m}=d;const g=this.buildConversionOptions(r,i,n,o,a,l,f,h),y=await Tk.init(g),b=this.validateConversion(y,r,i,f);if(b)return this.abortController=null,b;y.onProgress=P=>{this.onProgress&&this.onProgress(Math.round(P*100))};const E=await this.executeConversion(y,e);if(E)return Th(r,null),this.abortController=null,E;const C=s.buffer;if(!C)throw new Error("Output buffer is null");let I=new Blob([C],{type:"video/mp4"});if(Th(r,null),!f&&u){this.log("Attempting to mux original audio track via FFmpeg copy");const P=await this.mergeVideoAndAudioWithFFmpeg(I,e),T=this.checkAbort(e);if(T)return this.abortController=null,T;if(!P)return Ws(this.context,"Audio mux failed; falling back to FFmpeg compression."),this.abortController=null,await this.compressWithFFmpeg(e,n);I=P,this.log("Successfully muxed original audio track.")}const x=m6(I,e,this.context);if(!x.wasCompressed)return this.abortController=null,x;if(f&&u&&(m||p)){if(!(await this.verifyMediabunnyAudio(x.file,p,m)).passed)return this.abortController=null,await this.compressWithFFmpeg(e,n)}else!f&&u&&this.log("Audio was copied as-is, skipping audio verification");return this.onProgress&&this.onProgress(100),this.abortController=null,x}catch(c){Th(r,null);const u=this.checkAbort(e);return u?(this.abortController=null,u):(console.error("[MediaBunnyCompression] Mediabunny compression failed:",c),this.abortController=null,{file:e,wasCompressed:!1,wasSkipped:!0})}}async verifyMediabunnyAudio(e,n,r){const i=typeof r=="number"&&Number.isFinite(r),s=typeof n=="number"&&Number.isFinite(n);if(!i&&!s)return{passed:!0};let o=null;try{o=new c2({source:new nI(e),formats:tI});const a=await o.getAudioTracks();if(a.length===0)return Ws(this.context,"Mediabunny output lost audio track; falling back to FFmpeg"),{passed:!1};const l=a[0],c=await l.computePacketStats(120),u=l.sampleRate,d=c.averageBitrate;if(this.log("Mediabunny audio verification:",{expectedBitrate:r,actualBitrate:d,expectedSampleRate:n,actualSampleRate:u}),s&&Math.abs(u-n)>1)return Ws(this.context,"Audio sample rate mismatch detected, falling back to FFmpeg"),{passed:!1};if(i){const f=r*1.25;if(!Number.isFinite(d)||d>f)return Ws(this.context,"Audio bitrate exceeds expected range, falling back to FFmpeg",{actualBitrate:d,allowedUpperBitrate:f}),{passed:!1}}return{passed:!0}}catch(a){return Ws(this.context,"Audio verification error, falling back to FFmpeg:",a),{passed:!1}}finally{o?.dispose()}}}var kn;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(kn||(kn={}));const fpe=(()=>{let t=0;return()=>t++})(),hpe=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),ppe=new Error("called FFmpeg.terminate()");class mpe{#e=null;#t={};#n={};#r=[];#i=[];loaded=!1;#o=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:n,data:r}})=>{switch(n){case kn.LOAD:this.loaded=!0,this.#t[e](r);break;case kn.MOUNT:case kn.UNMOUNT:case kn.EXEC:case kn.WRITE_FILE:case kn.READ_FILE:case kn.DELETE_FILE:case kn.RENAME:case kn.CREATE_DIR:case kn.LIST_DIR:case kn.DELETE_DIR:this.#t[e](r);break;case kn.LOG:this.#r.forEach(i=>i(r));break;case kn.PROGRESS:this.#i.forEach(i=>i(r));break;case kn.ERROR:this.#n[e](r);break}delete this.#t[e],delete this.#n[e]})};#a=({type:e,data:n},r=[],i)=>this.#e?new Promise((s,o)=>{const a=fpe();this.#e&&this.#e.postMessage({id:a,type:e,data:n},r),this.#t[a]=s,this.#n[a]=o,i?.addEventListener("abort",()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(hpe);on(e,n){e==="log"?this.#r.push(n):e==="progress"&&this.#i.push(n)}off(e,n){e==="log"?this.#r=this.#r.filter(r=>r!==n):e==="progress"&&(this.#i=this.#i.filter(r=>r!==n))}load=({classWorkerURL:e,...n}={},{signal:r}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/ehagaki/assets/worker-0l8QF2aX.js",import.meta.url),{type:"module"}),this.#o()),this.#a({type:kn.LOAD,data:n},void 0,r));exec=(e,n=-1,{signal:r}={})=>this.#a({type:kn.EXEC,data:{args:e,timeout:n}},void 0,r);terminate=()=>{const e=Object.keys(this.#n);for(const n of e)this.#n[n](ppe),delete this.#n[n],delete this.#t[n];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,n,{signal:r}={})=>{const i=[];return n instanceof Uint8Array&&i.push(n.buffer),this.#a({type:kn.WRITE_FILE,data:{path:e,data:n}},i,r)};mount=(e,n,r)=>{const i=[];return this.#a({type:kn.MOUNT,data:{fsType:e,options:n,mountPoint:r}},i)};unmount=e=>{const n=[];return this.#a({type:kn.UNMOUNT,data:{mountPoint:e}},n)};readFile=(e,n="binary",{signal:r}={})=>this.#a({type:kn.READ_FILE,data:{path:e,encoding:n}},void 0,r);deleteFile=(e,{signal:n}={})=>this.#a({type:kn.DELETE_FILE,data:{path:e}},void 0,n);rename=(e,n,{signal:r}={})=>this.#a({type:kn.RENAME,data:{oldPath:e,newPath:n}},void 0,r);createDir=(e,{signal:n}={})=>this.#a({type:kn.CREATE_DIR,data:{path:e}},void 0,n);listDir=(e,{signal:n}={})=>this.#a({type:kn.LIST_DIR,data:{path:e}},void 0,n);deleteDir=(e,{signal:n}={})=>this.#a({type:kn.DELETE_DIR,data:{path:e}},void 0,n)}const gpe=t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{const{result:i}=r;i instanceof ArrayBuffer?e(new Uint8Array(i)):e(new Uint8Array)},r.onerror=i=>{n(Error(`File could not be read! Code=${i?.target?.error?.code||-1}`))},r.readAsArrayBuffer(t)}),B1=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await gpe(t);else return new Uint8Array;return new Uint8Array(e)};class ype extends g6{ffmpeg=null;isLoaded=!1;loadPromise=null;isCompressing=!1;constructor(){super("FFmpegCompression")}abort(){if(this.log("Abort requested"),this.resetProgress(),this.ffmpeg&&this.isCompressing){this.log("Terminating FFmpeg");try{this.ffmpeg.terminate()}catch(e){Ws(this.context,"Error terminating FFmpeg:",e)}}}async loadFFmpeg(){if(!this.isLoaded)return this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{this.log("Loading FFmpeg from node_modules"),this.ffmpeg=new mpe,this.ffmpeg.on("log",({message:e})=>{console.log("[FFmpeg]",e)}),this.ffmpeg.on("progress",({progress:e})=>{this.updateProgress(e*100)});try{const e="/ehagaki/",n=new URL(e,window.location.origin).href,r=new URL("ffmpeg-core/ffmpeg-core.js",n).href,i=new URL("ffmpeg-core/ffmpeg-core.wasm",n).href;this.log("Base URL:",n),this.log("Core URL:",r),this.log("WASM URL:",i),await this.ffmpeg.load({coreURL:r,wasmURL:i}),this.isLoaded=!0,this.log("FFmpeg loaded successfully")}catch(e){throw Ws(this.context,"Failed to load FFmpeg:",e),e}})(),this.loadPromise)}async mergeVideoAndAudioWithFFmpeg(e,n){const r="mediabunny-video.mp4",i="mediabunny-audio-source.mp4",s="mediabunny-merged.mp4",o=async a=>{if(!a)return;const l=[r,i,s];for(const c of l)try{await a.deleteFile(c)}catch{}};try{if(an.value)return this.log("Abort detected before audio mux"),null;await this.loadFFmpeg();const a=this.ffmpeg;if(!a)return Ws(this.context,"FFmpeg instance unavailable for audio mux"),null;await a.writeFile(r,await B1(e)),await a.writeFile(i,await B1(n));const l=["-i",r,"-i",i,"-map","0:v:0","-map","1:a:0","-c:v","copy","-c:a","copy","-movflags","+faststart","-shortest","-y",s];if(this.log("Executing FFmpeg audio mux with args:",l),this.isCompressing=!0,await a.exec(l),an.value)return this.log("Abort detected during audio mux"),await o(a),null;const c=await a.readFile(s),u=new Blob([c],{type:"video/mp4"});return await o(a),u}catch(a){return an.value?this.log("Audio mux aborted, returning null"):Ws(this.context,"Failed to mux audio with FFmpeg copy:",a),await o(this.ffmpeg),null}finally{this.isCompressing=!1}}buildFFmpegArgs(e,n,r){const i=["-i",e,"-c:v","libx264","-crf",String(r.crf),"-preset",r.preset,"-c:a","aac","-b:a",r.audioBitrate||"128k"];if(r.audioSampleRate&&i.push("-ar",String(r.audioSampleRate)),r.audioChannels&&i.push("-ac",String(r.audioChannels)),r.maxSize){const s=`scale='if(gte(iw,ih),min(${r.maxSize},iw),-2)':'if(lt(iw,ih),min(${r.maxSize},ih),-2)'`;i.push("-vf",s)}return i.push("-movflags","+faststart","-y",n),i}async compressWithFFmpeg(e,n){try{this.log("Loading FFmpeg..."),await this.loadFFmpeg();const r=this.checkAbort(e);if(r)return r;if(!this.ffmpeg)throw new Error("FFmpeg not loaded");const i="input.mp4",s="output.mp4";await this.ffmpeg.writeFile(i,await B1(e));const o=this.buildFFmpegArgs(i,s,n),a=this.checkAbort(e);if(a)return await this.ffmpeg.deleteFile(i),a;this.log("Starting compression with args:",o),this.isCompressing=!0;try{await this.ffmpeg.exec(o)}catch(u){if(an.value)this.log("Compression aborted during execution");else throw console.error("[FFmpegCompression] FFmpeg execution error:",u),u}finally{this.isCompressing=!1}if(an.value){this.log("Cleaning up after abort");try{await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s)}catch{}return{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}}const l=await this.ffmpeg.readFile(s),c=new Blob([l],{type:"video/mp4"});return await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s),m6(c,e,this.context)}catch(r){return this.isCompressing=!1,an.value?(this.log("Compression aborted, using original file"),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}):(console.error("[FFmpegCompression] Compression failed:",r),{file:e,wasCompressed:!1,wasSkipped:!0})}}async cleanup(){if(this.ffmpeg&&this.isLoaded)try{this.isLoaded=!1,this.ffmpeg=null,this.loadPromise=null}catch(e){console.error("[FFmpegCompression] Cleanup error:",e)}}}class _P{constructor(e){this.localStorage=e,this.ffmpegCompression=new ype,this.mediabunnyCompression=new dpe(this.parseAudioBitrate.bind(this),this.ffmpegCompression.mergeVideoAndAudioWithFFmpeg.bind(this.ffmpegCompression),this.ffmpegCompression.compressWithFFmpeg.bind(this.ffmpegCompression))}context="VideoCompressionService";mediabunnyCompression;ffmpegCompression;useMediabunny=null;mediabunnyCheckPromise=null;onProgress;async checkMediaBunnySupport(){return this.useMediabunny!==null?this.useMediabunny:this.mediabunnyCheckPromise?this.mediabunnyCheckPromise:(this.mediabunnyCheckPromise=(async()=>{const e=await lpe();return this.useMediabunny=e,_o(this.context,`Using ${e?"Mediabunny":"FFmpeg"} for compression`),e})(),this.mediabunnyCheckPromise)}abort(){_o(this.context,"Abort requested"),this.onProgress&&this.onProgress(0),this.mediabunnyCompression.abort(),this.ffmpegCompression.abort()}setProgressCallback(e){this.onProgress=e,this.mediabunnyCompression.setProgressCallback(e),this.ffmpegCompression.setProgressCallback(e)}getCompressionOptions(){const e=this.localStorage.getItem("videoCompressionLevel")||"medium",n=Pg[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n||null}hasCompressionSettings(){return this.getCompressionOptions()!==null}parseAudioBitrate(e){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const n=Number.parseInt(e,10);if(Number.isFinite(n)&&n>0)return n*1e3}return null}async compress(e){if(!ape(e))return _o(this.context,"Skipping non-video file"),{file:e,wasCompressed:!1};if(ope(e))return _o(this.context,"Skipping small video file"),{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(spe(n,this.context))return{file:e,wasCompressed:!1,wasSkipped:!0};if(an.value)return _o(this.context,"Compression aborted"),this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0};try{if(await this.checkMediaBunnySupport()){_o(this.context,"Attempting compression with MediaBunny");const i=await this.mediabunnyCompression.compressWithMediabunny(e,n);return!i.wasCompressed&&!i.wasSkipped?(_o(this.context,"MediaBunny failed, falling back to FFmpeg"),await this.ffmpegCompression.compressWithFFmpeg(e,n)):i}else return _o(this.context,"Using FFmpeg for compression"),await this.ffmpegCompression.compressWithFFmpeg(e,n)}catch(r){return console.error("[VideoCompressionService] Compression failed:",r),{file:e,wasCompressed:!1,wasSkipped:!0}}}async cleanup(){await this.ffmpegCompression.cleanup(),await this.mediabunnyCompression.cleanup()}}var dd=Symbol("verified"),bpe=t=>t instanceof Object;function wpe(t){if(!bpe(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}new TextDecoder("utf-8");var y6=new TextEncoder,vpe=class{generateSecretKey(){return Io.utils.randomPrivateKey()}getPublicKey(t){return or(Io.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=or(Io.getPublicKey(e)),n.id=F1(n),n.sig=or(Io.sign(F1(n),e)),n[dd]=!0,n}verifyEvent(t){if(typeof t[dd]=="boolean")return t[dd];const e=F1(t);if(e!==t.id)return t[dd]=!1,!1;try{const n=Io.verify(t.sig,e,t.pubkey);return t[dd]=n,n}catch{return t[dd]=!1,!1}}};function xpe(t){if(!wpe(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function F1(t){let e=Wu(y6.encode(xpe(t)));return or(e)}var Xb=new vpe;Xb.generateSecretKey;Xb.getPublicKey;Xb.finalizeEvent;Xb.verifyEvent;var Spe=27235,Epe="Nostr ";async function kpe(t,e,n,r=!1,i){const s={kind:Spe,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""},o=await n(s);return(r?Epe:"")+jo.encode(y6.encode(JSON.stringify(o)))}const ET=Ts([]);function Tpe(){return window.location.port==="4173"||window.location.hostname==="localhost"}function b6(){return Tpe()}function _pe(...t){const e=t.map(n=>typeof n=="object"?JSON.stringify(n):String(n)).join(" ");ET.update(n=>[e,...n].slice(0,250))}const Cpe=console.log;typeof window<"u"&&(window.__originalConsoleLog=Cpe);async function Ape(t){let e=[];t?e=t:ET.subscribe(r=>e=r)();const n=e?.join(`
`)??"";n&&Kb(n,"dev log",navigator,window)}typeof window<"u"&&(window.showSwUpdateModalDebug=()=>{Ik.set(!0),console.log("SWæ´æ°ãã¿ã³ãå¼·å¶è¡¨ç¤ºãã¾ããï¼è¨­å®ãã¿ã³ã©ã³ãï¼SettingsDialogåï¼")});b6()&&(window.testDevLog=()=>{console.log("ãã¹ãç¨ã­ã°åºå:",new Date().toISOString()),_pe("ç´æ¥devLogã«è¿½å :",Math.random())},window.showPostSuccessDebug=()=>{Cn.postStatus={...Cn.postStatus,success:!0,error:!1,message:"post_success",completed:!0}},window.showPostErrorDebug=()=>{Cn.postStatus={...Cn.postStatus,success:!1,error:!0,message:"post_error",completed:!1}});class Ipe{constructor(e){this.document=e}mimeSupportCache={};webpQualitySupport;async canEncodeWebpWithQuality(){if(this.webpQualitySupport!==void 0)return this.webpQualitySupport;try{if(!this.document)return this.webpQualitySupport=!1;const e=this.document.createElement("canvas");e.width=2,e.height=2;const n=e.getContext("2d");if(!n)return this.webpQualitySupport=!1;n.fillStyle="#f00",n.fillRect(0,0,2,2);const r=e.toDataURL("image/webp",.2),i=e.toDataURL("image/webp",.9),s=r.startsWith("data:image/webp")&&i.startsWith("data:image/webp")&&r.length!==i.length;return this.webpQualitySupport=s,s}catch{return this.webpQualitySupport=!1,!1}}canEncodeMimeType(e){if(!e)return!1;if(e in this.mimeSupportCache)return this.mimeSupportCache[e];try{if(!this.document)return this.mimeSupportCache[e]=!1;const n=this.document.createElement("canvas");n.width=2,n.height=2;const r=n.getContext("2d");if(!r)return this.mimeSupportCache[e]=!1;r.fillStyle="#000",r.fillRect(0,0,2,2);const i=n.toDataURL(e),s=typeof i=="string"&&i.startsWith(`data:${e}`);return this.mimeSupportCache[e]=s,s}catch{return this.mimeSupportCache[e]=!1,!1}}}class CP{constructor(e,n){this.mimeSupport=e,this.localStorage=n}onProgress;abort(){this.onProgress&&this.onProgress(0)}setProgressCallback(e){this.onProgress=e}getCompressionOptions(){const e=this.localStorage.getItem("imageCompressionLevel")||"medium",n=Zc[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n?{...n,preserveExif:!1}:null}hasCompressionSettings(){return this.getCompressionOptions()!==null}async compress(e){if(an.value)return{file:e,wasCompressed:!1,aborted:!0};if(!e.type.startsWith("image/"))return{file:e,wasCompressed:!1};if(e.size<=20*1024)return{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(!n)return{file:e,wasCompressed:!1,wasSkipped:!0};let r={...n,onProgress:s=>{this.onProgress&&this.onProgress(Math.round(s*100))}};if(r.fileType==="image/webp"&&(await this.mimeSupport.canEncodeWebpWithQuality()||(r.fileType=e.type==="image/png"?"image/png":"image/jpeg")),an.value)return{file:e,wasCompressed:!1,aborted:!0};let i=r.fileType||e.type;this.mimeSupport.canEncodeMimeType(i)||(i=e.type,delete r.fileType);try{const s=await jr(e,r);if(an.value)return this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0};if(s.size>=e.size)return{file:e,wasCompressed:!1};const o=r.fileType||s.type||i||e.type,a=jie(e.name,o),l=new File([s],a,{type:o});return{file:l,wasCompressed:!0}}catch(s){return an.value?(this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0}):(console.warn("[ImageCompressionService] Compression failed:",s),{file:e,wasCompressed:!1,wasSkipped:!0})}}}class Ppe{async waitForWindowNostr(e=3e3,n=100){const r=Date.now();for(;Date.now()-r<e;){const i=window?.nostr;if(i?.signEvent)return i;await new Promise(s=>setTimeout(s,n))}return null}async buildAuthHeader(e,n="POST"){const r=z2.getFromStore()||z2.loadFromStorage();let i;if(r)i=s=>xx(r).signEvent(s);else{let s=window?.nostr;if(s?.signEvent||(s=await this.waitForWindowNostr()),s?.signEvent)i=o=>s.signEvent(o);else throw new Error("Authentication required")}return await kpe(e,n,i,!0)}}class w6{constructor(e={localStorage:window.localStorage,fetch:window.fetch.bind(window),crypto:window.crypto.subtle,document:window.document,window,navigator:window.navigator},n,r,i,s){this.dependencies=e,this.mimeSupport=s||new Ipe(e.document),this.imageCompressionService=r||new CP(this.mimeSupport,e.localStorage),this.videoCompressionService=i||new _P(e.localStorage),this.authService=n||new Ppe,this.videoCompressionService instanceof _P&&!yre()&&(gre(this.videoCompressionService),console.log("[FileUploadManager] VideoCompressionService registered to store")),this.imageCompressionService instanceof CP&&!wre()&&(bre(this.imageCompressionService),console.log("[FileUploadManager] ImageCompressionService registered to store"))}imageCompressionService;videoCompressionService;mimeSupport;authService;validateImageFile(e){return e.type.startsWith("image/")?e.size>gI?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}:{isValid:!1,errorMessage:"only_images_allowed"}}validateMediaFile(e){const n=e.type.startsWith("image/"),r=e.type.startsWith("video/");return!n&&!r?{isValid:!1,errorMessage:"only_images_or_videos_allowed"}:e.size>gI?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}}async generateBlurhashForFile(e){return await lie(e)}async createPlaceholderUrl(e){return await aie(e)}getUploadEndpoint(e){const n=this.dependencies.localStorage.getItem("uploadEndpoint"),r=i=>i&&i.trim().length>0?i:void 0;return r(n)??r(e)??yh}async pollUploadStatus(e,n,r=jv.MAX_WAIT_TIME){const i=Date.now();for(;;){if(an.value)throw new Error("Upload aborted by user");if(Date.now()-i>r)throw new Error(jv.TIMEOUT_MESSAGE);const s=await this.dependencies.fetch(e,{method:"GET",headers:{Authorization:n}});if(!s.ok)throw new Error(`Unexpected status code ${s.status} while polling processing_url`);let o=null;try{o=await s.json()}catch{o=null}if(s.status===201&&o)return o;if(o?.status==="processing"){await new Promise(a=>setTimeout(a,jv.RETRY_INTERVAL));continue}if(o?.status==="success")return o;if(o?.status==="error")throw new Error(o?.message||"File processing failed");if(s.status===200)return o;throw new Error("Unexpected processing status")}}async uploadFile(e,n=yh,r=!1,i,s){let o;try{if(!e)return{success:!1,error:"No file selected"};let a;try{a=await p5(e,this.dependencies.crypto)}catch{a=void 0}const l=e.size;if(an.value)return r&&console.log("[FileUploadManager] Upload aborted before compression"),{success:!1,error:"Upload aborted by user",aborted:!0};const c=e.type.startsWith("video/"),u=c?this.videoCompressionService:this.imageCompressionService;c&&s?.onVideoCompressionProgress&&this.videoCompressionService.setProgressCallback(s.onVideoCompressionProgress),!c&&s?.onImageCompressionProgress&&this.imageCompressionService.setProgressCallback(s.onImageCompressionProgress);const{file:d,wasCompressed:f,wasSkipped:h,aborted:p}=await u.compress(e);if(c?this.videoCompressionService.setProgressCallback(void 0):this.imageCompressionService.setProgressCallback(void 0),p)return r&&console.log("[FileUploadManager] Upload aborted by user"),{success:!1,error:"Upload aborted by user",aborted:!0};const m=d.size,g=c?this.videoCompressionService.hasCompressionSettings():this.imageCompressionService.hasCompressionSettings();o=Die(l,m,g||f,e.name,d.name,h);const y=this.getUploadEndpoint(n),b=await this.authService.buildAuthHeader(y,"POST"),E=new FormData;E.append("file",d),i?.caption&&E.append("caption",String(i.caption)),i?.expiration!==void 0&&E.append("expiration",String(i.expiration)),E.append("size",String(d.size)),i?.alt&&E.append("alt",String(i.alt)),i?.media_type&&E.append("media_type",String(i.media_type)),E.append("content_type",i?.content_type?String(i.content_type):d.type||""),E.append("no_transform",i?.no_transform?String(i.no_transform):"true");const C=await this.dependencies.fetch(y,{method:"POST",headers:{Authorization:b},body:E});if(an.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};if(!C.ok){const P=await C.text().catch(()=>"Unknown error");return{success:!1,error:`Upload failed: ${C.status} ${C.statusText} - ${P}`,sizeInfo:o}}let I;try{I=await C.json()}catch(P){return r&&console.error("[dev] JSON parse error:",P),{success:!1,error:"Could not parse upload response",sizeInfo:o}}if((C.status===200||C.status===202)&&I.processing_url)try{const P=await this.authService.buildAuthHeader(I.processing_url,"GET");if(I=await this.pollUploadStatus(I.processing_url,P),an.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0}}catch(P){return{success:!1,error:P instanceof Error?P.message:String(P),sizeInfo:o}}const x={};if(I?.nip94_event?.tags&&Array.isArray(I.nip94_event.tags))for(const P of I.nip94_event.tags){if(!Array.isArray(P)||P.length<2)continue;const T=String(P[0]),S=P.slice(1).join(" ");T in x||(x[T]=S)}if(I.status==="success"&&I.nip94_event?.tags){const P=I.nip94_event.tags.find(T=>T[0]==="url");if(P?.[1])return{success:!0,url:P[1],sizeInfo:o,nip94:x}}return{success:!1,error:I.message||"Could not extract URL from response",sizeInfo:o,nip94:Object.keys(x).length?x:void 0}}catch(a){if(an.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};r&&console.error("[dev] Upload error:",a);const l=a instanceof Error?a.message:String(a);return l.includes("aborted by user")?{success:!1,error:l,sizeInfo:o,aborted:!0}:{success:!1,error:l.includes("Failed to fetch")?`${l} (Service Workerãç»åã¢ããã­ã¼ãããã­ãã¯ãã¦ããå¯è½æ§ãããã¾ã)`:l}}}async uploadMultipleFiles(e,n=yh,r,i=!1,s,o){if(!e?.length)return[];const a=new Array(e.length);let l=0,c=0,u=0;const d=()=>r?.({completed:l,failed:c,aborted:u,total:e.length,inProgress:l+c+u<e.length});d();for(let f=0;f<e.length;f++){if(an.value){for(let p=f;p<e.length;p++)a[p]={success:!1,aborted:!0},u++;d();break}const h=e[f];try{const p=s?s[f]:void 0,m=await this.uploadFile(h,n,i,p,o);a[f]=m,m.success?l++:m.aborted?u++:c++,d()}catch(p){a[f]={success:!1,error:p instanceof Error?p.message:String(p)},c++,d()}}return a}async uploadFileWithCallbacks(e,n=yh,r,i=!1,s){r?.onProgress?.({completed:0,failed:0,aborted:0,total:1,inProgress:!0});try{const o=await this.uploadFile(e,n,i,s,r);if(r?.onProgress?.({completed:o.success?1:0,failed:!o.success&&!o.aborted?1:0,aborted:o.aborted?1:0,total:1,inProgress:!1}),o.success&&o.sizeInfo&&!o.aborted){const a=UI(o.sizeInfo);a&&BI(a)}return o}catch(o){return r?.onProgress?.({completed:0,failed:1,aborted:0,total:1,inProgress:!1}),{success:!1,error:o instanceof Error?o.message:String(o)}}}async uploadMultipleFilesWithCallbacks(e,n=yh,r,i){if(!e?.length)return[];r?.onProgress?.({completed:0,failed:0,aborted:0,total:e.length,inProgress:!0});const s=await this.uploadMultipleFiles(e,n,r?.onProgress,!1,i,r);if(!an.value){const o=s.find(a=>a.success&&a.sizeInfo);if(o?.sizeInfo){const a=UI(o.sizeInfo);a&&BI(a)}}return s}async getSharedImageFromServiceWorker(){if(!this.dependencies.navigator?.serviceWorker?.controller)return null;try{const e=new MessageChannel,n=new Promise(r=>{e.port1.onmessage=i=>{i.data?.type==="SHARED_IMAGE"?r(i.data.data):r(null)},setTimeout(()=>r(null),3e3)});return this.dependencies.navigator.serviceWorker.controller.postMessage({action:"getSharedImage"},[e.port2]),await n}catch(e){return console.error("Service Workerããã®å±æç»ååå¾ã«å¤±æ:",e),null}}checkIfOpenedFromShare(){return this.dependencies.window?.location?new URLSearchParams(this.dependencies.window.location.search).get("shared")==="true":!1}async processSharedImageOnLaunch(){try{const e=await this.getSharedImageFromServiceWorker();return e?.image?{success:!0,data:e,fromServiceWorker:!0}:{success:!1,error:"å±æç»åãè¦ã¤ããã¾ãã"}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}}class Ope{dependencies;devMode;fileUploadManager;constructor(e,n){this.dependencies=e,this.devMode=n,this.fileUploadManager=new this.dependencies.FileUploadManager}async uploadFiles(e,n,r,i){try{if(e.length===1)return[await this.fileUploadManager.uploadFileWithCallbacks(e[0],n,r,this.devMode,i?.[0])];if(e.length>1)return await this.fileUploadManager.uploadMultipleFilesWithCallbacks(e,n,r,i)}catch(s){if(this.devMode){const a=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";console.error(`${a} [uploadHelper] Upload error:`,s)}throw s}return null}}function $1(t,e,n,r,i,s=!1,o=!1){return r(!1),o&&n&&PL(n,s),i?.onProgress&&i.onProgress({completed:0,failed:0,aborted:t.length,total:t.length,inProgress:!1}),{placeholderMap:o?[]:e,results:null,imageOxMap:{},imageXMap:{},failedResults:[],errorMessage:"Upload aborted by user"}}const v6=()=>({localStorage:window.localStorage,crypto:window.crypto.subtle,tick:qa,FileUploadManager:w6,getImageDimensions:Wie,extractImageBlurhashMap:u5,calculateImageHash:uie,getMimeTypeFromUrl:d5,createImetaTag:async t=>await c5(t),imageSizeMapStore:U2});async function Mpe({files:t,currentEditor:e,fileInput:n,uploadCallbacks:r,showUploadError:i,updateUploadState:s,devMode:o,dependencies:a=v6()}){const l=Array.from(t),c=a.localStorage.getItem("uploadEndpoint")||"",u={},d={},h=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:0,total:l.length,inProgress:!0}),an.reset();const p=new Ope(a,o);let m;try{m=await lse(l,a)}catch(x){if(x instanceof Error&&x.message==="Upload aborted by user")return s(!1),r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:l.length,total:l.length,inProgress:!1}),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:"Upload aborted by user"};throw x}if(an.value)return $1(l,[],e,s,r,o,!1);let g=Nhe(l,m,e,i,a.imageSizeMapStore,a.FileUploadManager,o);if(g.length===0)return{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:""};if(an.value||(s(!0,""),await Rhe(g,e,a.FileUploadManager,o),an.value))return $1(l,g,e,s,r,o,!0);const y=g.map(x=>x.file);let b=null;try{const x=cse(y);b=await p.uploadFiles(y,c,r,x)}catch(x){const P=x instanceof Error?x.message:String(x);i(P,5e3),b=null}finally{s(!1)}if(an.value)return n&&(n.value=""),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:"Upload aborted by user"};await a.tick();const E=[];let C="",I={};if(b&&g.length>0){const x=await Dhe(b,g,e,u,d,a.imageSizeMapStore,a.extractImageBlurhashMap,a.getMimeTypeFromUrl,a.calculateImageHash,a.createImetaTag,o);E.push(...x.failedResults),C=x.errorMessage,I=x.imageServerBlurhashMap,g=[]}if(o&&e)try{const x=a.extractImageBlurhashMap(e),P=new Set([...Object.keys(x),...Object.keys(I)]);await Promise.all(Array.from(P).map(async S=>{if(!d[S]){const _=await a.calculateImageHash(S);_&&(d[S]=_)}}));const T=await Promise.all(Array.from(P).map(async S=>{const _=I[S]??x[S],O=a.getMimeTypeFromUrl(S),F=u[S],L=d[S];return(await a.createImetaTag({url:S,m:O,blurhash:_,ox:F,x:L})).join(" ")}))}catch(x){console.warn(`${h} [dev] imetaã¿ã°çæå¤±æ`,x)}return n&&(n.value=""),{placeholderMap:g,results:b,imageOxMap:u,imageXMap:d,failedResults:E,errorMessage:C}}function Npe(t){const{onUploadProgress:e,videoCompressionProgressStore:n,imageCompressionProgressStore:r}=t;return e?{onProgress:e,onVideoCompressionProgress:i=>{n.set(i)},onImageCompressionProgress:i=>{r.set(i)}}:void 0}function AP(t,e=3e3,n){n.updateUploadState(!1,t),setTimeout(()=>n.updateUploadState(!1,""),e)}async function Rpe(t){const{files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,updateUploadState:s,devMode:o,imageOxMap:a,imageXMap:l,dependencies:c=v6(),getUploadFailedText:u}=t;if(!e||e.length===0)return;const d=await Mpe({files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,showUploadError:(f,h)=>AP(f,h,{updateUploadState:s}),updateUploadState:s,devMode:o,dependencies:c});Object.assign(a,d.imageOxMap),Object.assign(l,d.imageXMap),d.failedResults?.length&&AP(d.errorMessage||(d.failedResults.length===1?d.failedResults[0].error||u("postComponent.upload_failed"):`${d.failedResults.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`),5e3,{updateUploadState:s}),r&&(r.value="")}async function Dpe(t){const{files:e,currentEditor:n,fileInput:r,onUploadProgress:i,updateUploadState:s,imageOxMap:o,imageXMap:a,videoCompressionProgressStore:l,imageCompressionProgressStore:c,getUploadFailedText:u,dependencies:d}=t,f=Npe({onUploadProgress:i,videoCompressionProgressStore:l,imageCompressionProgressStore:c});await Rpe({files:e,currentEditor:n,fileInput:r,uploadCallbacks:f,updateUploadState:s,devMode:!1,imageOxMap:o,imageXMap:a,dependencies:d,getUploadFailedText:u})}var Lpe=_e('<div class="context-menu-header svelte-1ea8bn9"> </div>'),Bpe=async(t,e,n,r,i)=>{if(k(e).icon==="/icons/copy-solid-full.svg"||/copy/i.test(String(k(e).label)))try{k(e).action(),n(t)}catch(o){console.warn("Copy failed:",o),r(t)}else k(e).action();i.onClose()},Fpe=_e('<span aria-hidden="true"></span>'),$pe=_e('<button role="menuitem"><!> </button>'),zpe=_e('<div class="context-menu svelte-1ea8bn9" role="menu" aria-label="Image context menu"><!> <!></div>');function Upe(t,e){St(e,!0);let n=e.x,r=e.y,i=ge(Nt(e.x)),s=ge(Nt(e.y)),o=ge(void 0),a=ge(!0),l=0,c=!1;function u(T){if(k(a))return;const S=Date.now();c&&S-l<500||k(o)&&!k(o).contains(T.target)&&(e.onClose(),is.set({open:!1,nodeId:void 0}))}function d(T){k(a)||(c=!0,l=Date.now(),k(o)&&T.target instanceof Node&&!k(o).contains(T.target)&&(e.onClose(),is.set({open:!1,nodeId:void 0})))}function f(T){T.key==="Escape"&&(e.onClose(),is.set({open:!1,nodeId:void 0}))}async function h(){await qa();let T=k(o)?k(o).getBoundingClientRect().width:0,S=k(o)?k(o).getBoundingClientRect().height:0;(!T||T<8)&&(T=k(o)?.offsetWidth??160),(!S||S<4)&&(S=k(o)?.offsetHeight??40);const O=Kd(n,r,8,T,S);K(i,O.x,!0),K(s,O.y,!0)}Ge(()=>{n=e.x,r=e.y,h()});function p(){h()}us(()=>{setTimeout(()=>{K(a,!1),document.addEventListener("click",u),document.addEventListener("touchend",d)},0),document.addEventListener("keydown",f),window.addEventListener("resize",p),h()}),_u(()=>{document.removeEventListener("click",u),document.removeEventListener("touchend",d),document.removeEventListener("keydown",f),window.removeEventListener("resize",p)});let m=ge(null);Ge(()=>{const T=e.items[0]?.src;if(typeof T=="string"){let S=T.replace(/^https?:\/\//,"");S.length>26?K(m,`${S.slice(0,18)}...${S.slice(-8)}`):K(m,S,!0)}else K(m,null)});const g=T=>{const S=Ys(nr);return typeof S=="function"?S(T):String(T)},y=ae(()=>()=>{const T=e.items[0];if(T&&T.label){const S=typeof T.label=="string"?T.label:"";if(S===g("videoContextMenu.copyUrl")||S===g("videoContextMenu.delete"))return"video"}return"image"});function b(T){let S;T&&typeof T.clientX=="number"&&typeof T.clientY=="number"?S={x:T.clientX,y:T.clientY}:S={x:e.x,y:e.y};const _=Kd(S.x,S.y),F=k(y)()==="video"?"videoContextMenu.copySuccess":"imageContextMenu.copySuccess";e.onShowPopup(_.x,_.y,g(F))}function E(T){let S;T&&typeof T.clientX=="number"&&typeof T.clientY=="number"?S={x:T.clientX,y:T.clientY}:S={x:e.x,y:e.y};const _=Kd(S.x,S.y),F=k(y)()==="video"?"videoContextMenu.copyFailed":"imageContextMenu.copyFailed";e.onShowPopup(_.x,_.y,g(F))}var C=zpe(),I=re(C);{var x=T=>{var S=Lpe(),_=re(S);je(()=>Re(_,k(m))),X(T,S)};$e(I,T=>{k(m)&&T(x)})}var P=ve(I,2);va(P,17,()=>e.items,T=>T.label,(T,S)=>{var _=$pe();let O;_.__click=[Bpe,S,b,E,e];var F=re(_);{var L=N=>{var M=Fpe();let R;je(H=>R=eo(M,1,"menu-icon svg-icon svelte-1ea8bn9",null,R,H),[()=>({"expand-icon":k(S).icon==="/icons/expand-solid-full.svg","copy-icon":k(S).icon==="/icons/copy-solid-full.svg","play-pause-icon":k(S).icon==="/icons/play_pause_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg","trash-icon":k(S).icon==="/icons/trash-solid-full.svg"})]),X(N,M)};$e(F,N=>{k(S).icon&&N(L)})}var B=ve(F);je(N=>{O=eo(_,1,"context-menu-item svelte-1ea8bn9",null,O,N),_.disabled=k(S).disabled,Re(B,` ${k(S).label??""}`)},[()=>({disabled:k(S).disabled})]),X(T,_)}),pr(C,T=>K(o,T),()=>k(o)),je(()=>Oa(C,`left: ${k(i)??""}px; top: ${k(s)??""}px;`)),X(t,C),Et()}Ti(["click"]);var Hpe=t=>t.stopPropagation?.(),Vpe=(t,e)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e())},Wpe=_e('<div class="popup-modal svelte-1i030h4" role="dialog" aria-modal="true" tabindex="0"><div class="popup-body svelte-1i030h4" role="document"><span class="info-icon svg-icon svelte-1i030h4" aria-hidden="true"></span> <div class="popup-children svelte-1i030h4"><!></div></div></div>');function kT(t,e){St(e,!0);let n=le(e,"show",3,!1),r=le(e,"x",3,0),i=le(e,"y",3,0),s=le(e,"onClose",3,void 0),o=le(e,"children",3,void 0);function a(){try{s()&&s()()}catch{}}function l(g){g.key==="Escape"&&a()}us(()=>{window.addEventListener("keydown",l)}),_u(()=>{window.removeEventListener("keydown",l)});let c=ge(void 0);Ge(()=>{n()&&k(c)&&(async()=>(await qa(),k(c).parentElement!==document.body&&document.body.appendChild(k(c))))()}),_u(()=>{if(k(c)&&k(c).parentElement===document.body)try{document.body.removeChild(k(c))}catch{}});let u=ge(Nt(r())),d=ge(Nt(i()));const f=10;Ge(()=>{n()&&k(c)&&(async()=>{if(await qa(),k(c).parentElement===document.body){const g=k(c).getBoundingClientRect(),y=g.width,b=g.height,E=window.innerWidth,C=window.innerHeight;let I=r(),x=i();I+y+f>E&&(I=E-y-f),I-f<0&&(I=f),x+b+f>C&&(x=C-b-f),x-f<0&&(x=f),K(u,I,!0),K(d,x,!0)}})()});var h=Fe(),p=Te(h);{var m=g=>{var y=Wpe();y.__click=[Hpe],y.__keydown=[Vpe,a];var b=re(y),E=ve(re(b),2),C=re(E);Tt(C,()=>o()??Ut),pr(y,I=>K(c,I),()=>k(c)),je(()=>Oa(y,`left: ${k(u)??""}px; top: ${k(d)??""}px;`)),X(g,y)};$e(p,g=>{n()&&g(m)})}X(t,h),Et()}Ti(["click","keydown"]);var jpe=_e("<button><!></button>");function Yt(t,e){St(e,!0);let n=le(e,"className",3,""),r=le(e,"disabled",3,!1),i=le(e,"type",3,"button"),s=le(e,"ariaLabel",3,""),o=le(e,"style",3,""),a=le(e,"variant",3,"default"),l=le(e,"shape",3,"rounded"),c=le(e,"onClick",3,void 0),u=le(e,"selected",3,!1),d=_i(e,["$$slots","$$events","$$legacy","className","disabled","type","ariaLabel","style","variant","shape","children","onClick","selected"]);function f(m){c()&&c()(m)}var h=jpe();wr(h,()=>({type:i(),class:`${n()} ${a()} ${l()} ${u()?"selected":""}`,disabled:r(),"aria-label":s(),style:o(),onclick:f,...d}),void 0,void 0,"svelte-1a2s1c5");var p=re(h);Tt(p,()=>e.children??Ut),X(t,h),Et()}var qpe=_e("<div><!></div>"),Kpe=_e('<!> <!> <div class="dialog-content svelte-kensir"><!></div> <!>',1),Gpe=_e("<!> <!>",1);function zf(t,e){St(e,!0);let n=le(e,"open",15,!1),r=le(e,"contentClass",3,""),i=le(e,"footerVariant",3,"default");function s(c){c||e.onOpenChange?.(!1)}function o(c){c.preventDefault()}var a=Fe(),l=Te(a);Dt(l,()=>SG,(c,u)=>{u(c,{onOpenChange:s,get open(){return n()},set open(d){n(d)},children:(d,f)=>{var h=Fe(),p=Te(h);Dt(p,()=>oc,(m,g)=>{g(m,{children:(y,b)=>{var E=Gpe(),C=Te(E);Dt(C,()=>sK,(x,P)=>{P(x,{class:"dialog-overlay"})});var I=ve(C,2);Dt(I,()=>_G,(x,P)=>{P(x,{get class(){return`dialog ${r()??""}`},onCloseAutoFocus:o,children:(T,S)=>{var _=Kpe(),O=Te(_);Dt(O,()=>fq,(R,H)=>{H(R,{class:"visually-hidden",children:(z,V)=>{var Q=on();je(()=>Re(Q,e.title)),X(z,Q)},$$slots:{default:!0}})});var F=ve(O,2);Dt(F,()=>aK,(R,H)=>{H(R,{class:"visually-hidden",children:(z,V)=>{var Q=on();je(()=>Re(Q,e.description)),X(z,Q)},$$slots:{default:!0}})});var L=ve(F,2),B=re(L);Tt(B,()=>e.children??Ut);var N=ve(L,2);{var M=R=>{var H=qpe();let z;var V=re(H);Tt(V,()=>e.footer),je(Q=>z=eo(H,1,"dialog-footer svelte-kensir",null,z,Q),[()=>({"close-button-footer":i()==="close-button"})]),X(R,H)};$e(N,R=>{e.footer&&R(M)})}X(T,_)},$$slots:{default:!0}})}),X(y,E)},$$slots:{default:!0}})}),X(d,h)},$$slots:{default:!0}})}),X(t,a),Et()}function Uf(t,e,n=!0){if(typeof window>"u"||!n)return;let r=null,i=!1;const s=o=>{t()&&o.state?.modalId!==r&&e()};Ge(()=>{const o=t();if(o&&!i){r=`modal-${qie()}`,history.pushState({modalId:r},"",window.location.href),i=!0;return}if(!o&&i){const a=history.state?.modalId===r;r=null,i=!1,a&&history.back()}}),us(()=>{window.addEventListener("popstate",s)}),_u(()=>{window.removeEventListener("popstate",s),i&&history.state?.modalId===r&&history.back()})}var Zpe=_e('<div class="confirm-dialog-message svelte-tqip21"> </div>'),Qpe=_e('<div class="confirm-dialog-content svelte-tqip21"><!> <div class="confirm-dialog-buttons svelte-tqip21"><!> <!></div></div>');function x6(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=le(e,"open",15,!1),o=le(e,"confirmVariant",3,"danger"),a=le(e,"confirmDisabled",3,!1),l=le(e,"autofocusConfirm",3,!1),c=le(e,"contentClass",3,"confirm-dialog"),u=le(e,"addToHistory",3,!1);const d=ae(()=>e.confirmLabel||n()("common.ok")),f=ae(()=>e.cancelLabel||n()("common.cancel")),h=ae(()=>e.title||n()("common.confirm"));function p(){s(!1),e.onCancel?.()}function m(){e.onConfirm(),s(!1)}Uf(()=>s(),p,u()),zf(t,{onOpenChange:g=>!g&&p(),get title(){return k(h)},get description(){return e.description},get contentClass(){return c()},get open(){return s()},set open(g){s(g)},children:(g,y)=>{var b=Qpe(),E=re(b);{var C=L=>{var B=Fe(),N=Te(B);Tt(N,()=>e.children),X(L,B)},I=L=>{var B=Zpe(),N=re(B);je(()=>Re(N,e.description)),X(L,B)};$e(E,L=>{e.children?L(C):L(I,!1)})}var x=ve(E,2),P=re(x);{var T=L=>{var B=Fe(),N=Te(B);Tt(N,()=>e.renderConfirm),X(L,B)},S=L=>{Yt(L,{className:"btn-confirm",get variant(){return o()},shape:"square",onClick:m,get disabled(){return a()},get autofocus(){return l()},children:(B,N)=>{var M=on();je(()=>Re(M,k(d))),X(B,M)},$$slots:{default:!0}})};$e(P,L=>{e.renderConfirm?L(T):L(S,!1)})}var _=ve(P,2);{var O=L=>{var B=Fe(),N=Te(B);Tt(N,()=>e.renderCancel),X(L,B)},F=L=>{var B=Fe(),N=Te(B);{const M=(R,H)=>{Yt(R,Kn(()=>H?.().props,{className:"btn-cancel",variant:"secondary",shape:"square",onClick:p,children:(V,Q)=>{var Y=on();je(()=>Re(Y,k(f))),X(V,Y)},$$slots:{default:!0}}))};Dt(N,()=>Df,(R,H)=>{H(R,{child:M,$$slots:{child:!0}})})}X(L,B)};$e(_,L=>{e.renderCancel?L(O):L(F,!1)})}X(g,b)},$$slots:{default:!0}}),Et(),i()}function Xpe(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=le(e,"show",15,!1);{let o=ae(()=>n()("postComponent.warning")),a=ae(()=>n()("postComponent.secret_key_detected")),l=ae(()=>n()("postComponent.post")),c=ae(()=>n()("postComponent.cancel"));x6(t,{get title(){return k(o)},get description(){return k(a)},get confirmLabel(){return k(l)},get cancelLabel(){return k(c)},confirmVariant:"danger",get onConfirm(){return e.onConfirm},get onCancel(){return e.onCancel},contentClass:"secretkey-warning-dialog",addToHistory:!1,get open(){return s()},set open(u){s(u)}})}Et(),i()}function Ype(t,e,n){const r=t.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{centerX:i.x,centerY:i.y,offsetX:e-r.left-i.x,offsetY:n-r.top-i.y}}function Jpe(t,e){return{x:t.x-e.x,y:t.y-e.y}}function eme(t,e,n){const r=e.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{scale:n,offsetX:t.clientX-r.left-i.x,offsetY:t.clientY-r.top-i.y}}function tme({scale:t,translate:e,useTransition:n},r){const i=r??document.querySelector(".image-container");i&&(i.style.transition=n?`transform ${r5.TRANSITION_DURATION} ease`:"none",i.style.transform=`scale(${t}) translate(${e.x/t}px, ${e.y/t}px)`,i.style.transformOrigin="center")}function nme(t,e,n,r){const i=r??document.querySelector(".image-container");i&&(i.style.transition="none",i.style.transform=`scale(${t}) translate(${e/t}px, ${n/t}px)`)}function qc(t,e){const n=e??document.querySelector(".image-container");n&&(n.style.cursor=t>sr.DEFAULT_SCALE?"grab":"default")}function _h(t,e){const n=e??document.querySelector(".fullscreen-overlay");n&&(n.style.cursor=t>sr.DEFAULT_SCALE?"grab":"default")}function Al(t){Ji.setTransition(t)}function IP(t){const e=t?"":"none";gu("user-select",e),gu("-webkit-user-select",e)}function Fp(t){t!==null&&clearTimeout(t)}function PP(t,e){if(t&&e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i={imageWidth:n.width,imageHeight:n.height,containerWidth:r.width,containerHeight:r.height};Ji.setBoundaryConstraints(i)}}function hg(t,e,n,r,i){t!==null&&cancelAnimationFrame(t),e!==null&&cancelAnimationFrame(e),t=null,e=null,Ji.reset(),Ji.setBoundaryConstraints(null),n.isDragging=!1,r.isPinching=!1,Fp(i),$re()}function rme(t,e,n,r,i,s,o){if(!s)return{isDoubleTap:!1,newLastTapTime:t,newLastTapPosition:e,newTapTimeoutId:n};const a=Date.now(),l=e?Math.sqrt(Math.pow(r-e.x,2)+Math.pow(i-e.y,2)):0;if(a-t<200&&l<50&&n!==null)return Fp(n),o(r,i),{isDoubleTap:!0,newLastTapTime:0,newLastTapPosition:null,newTapTimeoutId:null};const c=a,u={x:r,y:i};Fp(n);const d=window.setTimeout(()=>{},300);return{isDoubleTap:!1,newLastTapTime:c,newLastTapPosition:u,newTapTimeoutId:d}}function OP(t,e,n,r,i,s,o,a,l,c){let u={...n},d=r,f=i,h=s;const p=rme(r,i,s,o,a,l,c);return d=p.newLastTapTime,f=p.newLastTapPosition,h=p.newTapTimeoutId,p.isDoubleTap&&l?{newDragState:u,newLastTapTime:d,newLastTapPosition:f,newTapTimeoutId:h}:(t>sr.DEFAULT_SCALE&&(u.start={x:o,y:a},u.startTranslate={...e}),{newDragState:u,newLastTapTime:d,newLastTapPosition:f,newTapTimeoutId:h})}function MP(t,e,n,r,i,s,o,a){let l={...t},c=!1;return r&&(l.start?Math.sqrt(Math.pow(e-l.start.x,2)+Math.pow(n-l.start.y,2)):0)>i&&(c=!0,!l.isDragging&&s>sr.DEFAULT_SCALE&&(o(l.start.x,l.start.y),l.isDragging=!0)),l.isDragging&&a(e,n),{newDragState:l,touchMoved:c}}function NP(t,e,n,r,i){e&&Date.now()-n<200&&!r||i()}function eS(t,e,n){return Math.max(e,Math.min(n,t))}function ime(t,e,n){return Math.abs(t-e)<n}function sme(t,e,n){const r=e.x-t.x,i=e.y-t.y;return{x:r/n*16,y:i/n*16}}function ome(t,e,n,r,i,s,o){s!==null&&cancelAnimationFrame(s);let a={...t},l={...e};const c=wI.FRICTION,u=wI.MIN_VELOCITY;function d(){if(a.x*=c,a.y*=c,Math.abs(a.x)<u&&Math.abs(a.y)<u){o(null),i();return}l.x+=a.x,l.y+=a.y,l=Ji.applyBoundaryConstraints(l,n),r(l),o(requestAnimationFrame(d))}o(requestAnimationFrame(d))}let Nn=Nt({scale:sr.DEFAULT_SCALE,translate:{x:0,y:0},useTransition:!0}),tS=null;function RP(t,e){if(!tS)return t;const{imageWidth:n,imageHeight:r,containerWidth:i}=tS,s=n*e,o=r*e;let a=t.x,l=t.y;if(s>i){const d=(s-i)/2,f=-d;a=eS(a,f,d)}else a=0;const c=o/2,u=-c;return l=eS(l,u,c),{x:a,y:l}}const Ji={get state(){return Nn},reset(){Nn.scale=sr.DEFAULT_SCALE,Nn.translate={x:0,y:0},Nn.useTransition=!0},setDirectState(t){Nn.scale=t.scale,Nn.translate={...t.translate},Nn.useTransition=t.useTransition??Nn.useTransition},zoom(t){const e=eS(t.scale,sr.MIN_SCALE,sr.MAX_SCALE);if(ime(e,sr.DEFAULT_SCALE,sr.THRESHOLD)){this.reset();return}const n=e/Nn.scale;Nn.translate.x=Nn.translate.x*n-t.offsetX*(n-1),Nn.translate.y=Nn.translate.y*n-t.offsetY*(n-1),Nn.scale=e},zoomToPoint(t,e=0,n=0){if(Nn.scale>=sr.RESET_THRESHOLD){this.reset();return}const r=t/Nn.scale;Nn.translate.x=Nn.translate.x*r-e*(r-1),Nn.translate.y=Nn.translate.y*r-n*(r-1),Nn.scale=t},drag(t,e,n){const r={x:n.x+t,y:n.y+e},i=RP(r,Nn.scale);Nn.translate.x=i.x,Nn.translate.y=i.y},setTransition(t){Nn.useTransition=t},setBoundaryConstraints(t){tS=t},applyBoundaryConstraints(t,e){return RP(t,e)}};function ame(){return{isDragging:!1,start:{x:0,y:0},startTranslate:{x:0,y:0}}}function lme(){return{isPinching:!1,initialDistance:0,initialScale:1,centerX:0,centerY:0}}function cme(t,e,n){e(),n(t.clientX,t.clientY)}function ume(t,e){t.key==="Escape"&&e()}var dme=t=>t.stopPropagation(),fme=(t,e)=>{t.stopPropagation(),e()},hme=_e('<div class="fullscreen-overlay svelte-mot0ha" tabindex="0" role="dialog" aria-label="ç»åå¨ç»é¢è¡¨ç¤º"><div class="close-button-container svelte-mot0ha"><button type="button" class="close-button svelte-mot0ha" aria-label="Close fullscreen image"><span class="svg-icon close-icon svelte-mot0ha"></span></button></div> <div class="image-container svelte-mot0ha"><img class="fullscreen-image svelte-mot0ha" draggable="false"/></div></div>');function pme(t,e){St(e,!0);let n=le(e,"src",3,""),r=le(e,"alt",3,""),i=le(e,"show",15,!1),s=le(e,"onClose",3,()=>{}),o=ge(void 0),a=ge(void 0),l=ge(void 0),c=Ji.state,u=ame(),d=lme(),f=null,h=null,p=null,m=!1,g=0,y=null,b=null,E=0,C=!1,I=10,x=0,P={x:0,y:0},T={x:0,y:0};Ge(()=>{c=Ji.state,tme({scale:c.scale,translate:c.translate,useTransition:c.useTransition??!1},k(l))});function S(pe){if(pe.preventDefault(),!k(l)||!k(a))return;const xe=pe.deltaY>0?sr.ZOOM_DELTA.OUT:sr.ZOOM_DELTA.IN,Me=c.scale*xe,Ue=eme(pe,k(a),Me);Ji.zoom(Ue),qc(c.scale,k(l)),_h(c.scale,k(a))}function _(pe,xe){Al(!0),setTimeout(()=>{if(c.scale>=sr.RESET_THRESHOLD)Ji.reset();else{const Me=pe!==void 0&&xe!==void 0&&k(a)?Ype(k(a),pe,xe):{offsetX:0,offsetY:0};Ji.zoomToPoint(sr.DOUBLE_CLICK_SCALE,Me.offsetX,Me.offsetY)}qc(c.scale,k(l))},100)}function O(pe,xe){c.scale<=sr.DEFAULT_SCALE||(u.isDragging=!0,u.start={x:pe,y:xe},u.startTranslate={...c.translate},x=Date.now(),P={x:pe,y:xe},T={x:0,y:0},k(l)&&(k(l).style.cursor="grabbing",Al(!1)),k(a)&&(k(a).style.cursor="grabbing"),IP(!1))}function F(pe,xe){u.isDragging&&(f!==null&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{const Me=Jpe({x:pe,y:xe},u.start);Ji.drag(Me.x,Me.y,u.startTranslate);const Ue=Date.now(),qe=Ue-x;qe>0&&(T=sme(P,{x:pe,y:xe},qe)),x=Ue,P={x:pe,y:xe}}))}function L(){u.isDragging&&(u.isDragging=!1,f!==null&&(cancelAnimationFrame(f),f=null),Ra()?ome(T,c.translate,c.scale,pe=>{Ji.setDirectState({...c,translate:pe,useTransition:!1})},()=>{Al(!0),qc(c.scale,k(l)),_h(c.scale,k(a))},p,pe=>{p=pe}):(qc(c.scale,k(l)),_h(c.scale,k(a)),setTimeout(()=>Al(!0),50)),IP(!0))}function B(){u.isDragging&&L()}function N(pe){const[xe,Me]=[pe.touches[0],pe.touches[1]],Ue=xe.clientX-Me.clientX,qe=xe.clientY-Me.clientY,tt=Math.sqrt(Ue*Ue+qe*qe);tt>sr.PINCH_MIN_DISTANCE&&(d.isPinching=!0,d.initialDistance=tt,d.initialScale=c.scale,d.centerX=(xe.clientX+Me.clientX)/2,d.centerY=(xe.clientY+Me.clientY)/2,Al(!1))}function M(pe){!d.isPinching||!k(a)||(h!==null&&cancelAnimationFrame(h),h=requestAnimationFrame(()=>{const[xe,Me]=[pe.touches[0],pe.touches[1]],Ue=xe.clientX-Me.clientX,qe=xe.clientY-Me.clientY,tt=Math.sqrt(Ue*Ue+qe*qe);if(tt>sr.PINCH_MIN_DISTANCE){const Ae=tt/d.initialDistance,We=Math.max(sr.MIN_SCALE,Math.min(sr.MAX_SCALE,d.initialScale*Ae));if(!k(a))return;const lt=k(a).getBoundingClientRect(),ht=lt.width/2,wt=lt.height/2,Lt=d.centerX-lt.left-ht,Rt=d.centerY-lt.top-wt,pt=We/c.scale,He=c.translate.x*pt-Lt*(pt-1),st=c.translate.y*pt-Rt*(pt-1);nme(We,He,st,k(l))}}))}function R(){if(d.isPinching){if(h!==null&&(cancelAnimationFrame(h),h=null),d.isPinching=!1,k(l)){const pe=k(l).style.transform,xe=pe.match(/scale\(([^)]+)\)/),Me=pe.match(/translate\(([^,]+)px,\s*([^)]+)px\)/);if(xe&&Me){const Ue=parseFloat(xe[1]),qe=parseFloat(Me[1])*Ue,tt=parseFloat(Me[2])*Ue;Ji.setDirectState({scale:Ue,translate:{x:qe,y:tt},useTransition:!0})}}Al(!0),qc(c.scale,k(l))}}function H(pe){if(!pe.target?.closest(".close-button-container"))if(pe.preventDefault(),p!==null&&(cancelAnimationFrame(p),p=null,Al(!0),qc(c.scale,k(l)),_h(c.scale,k(a))),pe.touches.length===1){const xe=pe.touches[0],Me=OP(c.scale,c.translate,u,g,b,y,xe.clientX,xe.clientY,!0,(Ue,qe)=>_(Ue,qe));u=Me.newDragState,g=Me.newLastTapTime,b=Me.newLastTapPosition,y=Me.newTapTimeoutId}else pe.touches.length===2&&(L(),Fp(y),N(pe))}function z(pe){if(pe.preventDefault(),pe.touches.length===1){const xe=pe.touches[0],Me=MP(u,xe.clientX,xe.clientY,!0,I,c.scale,O,F);u=Me.newDragState,C=Me.touchMoved}else pe.touches.length===2&&d.isPinching&&M(pe)}function V(pe){pe.preventDefault(),pe.touches.length===0?(NP(u,!0,E,C,L),R()):pe.touches.length===1&&d.isPinching&&R()}function Q(pe){if(pe.target?.closest(".close-button-container"))return;p!==null&&(cancelAnimationFrame(p),p=null,Al(!0),qc(c.scale,k(l)),_h(c.scale,k(a)));const xe=OP(c.scale,c.translate,u,g,b,y,pe.clientX,pe.clientY,!1,(Me,Ue)=>_(Me,Ue));u=xe.newDragState,g=xe.newLastTapTime,b=xe.newLastTapPosition,y=xe.newTapTimeoutId,O(pe.clientX,pe.clientY)}function Y(pe){u.isDragging&&(pe.preventDefault(),u=MP(u,pe.clientX,pe.clientY,!1,I,c.scale,O,F).newDragState)}function ie(){NP(u,!1,E,C,L)}function ne(pe){i()&&m&&(pe.preventDefault(),hg(f,h,u,d,g),f=null,h=null,g=0,y=null,i(!1),s()())}function J(){hg(f,h,u,d,g),f=null,h=null,g=0,y=null,i(!1),s()(),m&&(m=!1,history.back()),jre(are.EDITOR,r5.EDITOR_FOCUS_DELAY)}Ge(()=>{i()?(hg(f,h,u,d,g),f=null,h=null,g=0,y=null,gu("overflow","hidden"),m||(history.pushState({imageFullscreen:!0},"",""),m=!0),k(o)&&k(o).complete&&PP(k(o),k(a))):(gu("overflow",""),m=!1)});function ke(){const pe=[{event:"mousemove",handler:Y,target:document},{event:"mouseup",handler:ie,target:document},{event:"popstate",handler:ne,target:window}];return pe.forEach(({event:xe,handler:Me,target:Ue})=>Ue.addEventListener(xe,Me)),pe}function ze(pe){pe.forEach(({event:xe,handler:Me,target:Ue})=>Ue.removeEventListener(xe,Me))}us(()=>{const pe=ke();return()=>{ze(pe),Fp(y)}}),_u(()=>{hg(f,h,u,d,g),m=!1,b=null});var he=Fe(),Ee=Te(he);{var Le=pe=>{var xe=hme();xe.__keydown=[ume,J],xe.__mousedown=Q,xe.__touchstart=H,xe.__touchmove=z,xe.__touchend=V;var Me=re(xe),Ue=re(Me);Ue.__click=J,Ue.__touchstart=[dme],Ue.__touchend=[fme,J];var qe=ve(Me,2),tt=re(qe);tt.__dblclick=[cme,B,_],pr(tt,Ae=>K(o,Ae),()=>k(o)),pr(qe,Ae=>K(l,Ae),()=>k(l)),pr(xe,Ae=>K(a,Ae),()=>k(a)),je(()=>{yn(tt,"src",n()),yn(tt,"alt",r())}),js("wheel",xe,S),js("load",tt,Ae=>PP(k(o),k(a))),X(pe,xe)};$e(Ee,pe=>{i()&&pe(Le)})}X(t,he),Et()}Ti(["keydown","mousedown","touchstart","touchmove","touchend","click","dblclick"]);function mme(t,e){const n=t.target;n?.files?.length&&e(n.files)}var gme=_e('<div class="upload-error svelte-15xolqm"> </div>'),yme=_e('<div class="copy-success-message"> </div>'),bme=_e('<div class="post-container svelte-15xolqm"><div aria-label="ãã­ã¹ãå¥åã¨ãªã¢" role="textbox" tabindex="0"><!></div> <input type="file" accept="image/*,video/*" multiple style="display: none;"/> <!></div> <!> <!> <!> <!>',1);function wme(t,e){St(e,!0);const n=()=>qn(is,"$globalContextMenuStore",i),r=()=>qn(nr,"$_",i),[i,s]=oi();let o=ge(null),a=ge(null),l=ge(!1),c=ge(void 0),u=ge(void 0),d=Nt({}),f=Nt({}),h=ae(()=>Cn.postStatus),p=ae(()=>Cn.uploadErrorMessage),m=null,g=null,y=ae(()=>ua.value),b=ae(()=>k(y).showSecretKeyDialog),E=ae(()=>k(y).showImageFullscreen),C=ae(()=>k(y).fullscreenImageSrc),I=ae(()=>k(y).fullscreenImageAlt),x=ae(()=>k(y).showPopupModal),P=ae(()=>k(y).popupX),T=ae(()=>k(y).popupY),S=ae(()=>k(y).popupMessage),_=ge(Nt(n())),O=ae(()=>k(_).open),F=ge(0),L=ge(0),B=ge(Nt([]));Ge(()=>is.subscribe(st=>{K(_,st,!0)})),Ge(()=>{e.rxNostr&&(k(u)?k(u).setRxNostr(e.rxNostr):K(u,new Zhe(e.rxNostr),!0))});async function N(He){!He||He.length===0||await Dpe({files:He,currentEditor:k(a),fileInput:k(c),onUploadProgress:e.onUploadProgress,updateUploadState:(st,Ot)=>{Cn.isUploading=st,Cn.uploadErrorMessage=Ot||""},imageOxMap:d,imageXMap:f,videoCompressionProgressStore:Gh,imageCompressionProgressStore:Zh,getUploadFailedText:st=>r()(st)})}us(()=>{const He=r()("postComponent.enter_your_text")||"ãã­ã¹ããå¥åãã¦ãã ãã";return g=Vhe({placeholderText:He,editorContainerEl:m,currentEditor:k(a),hasStoredKey:e.hasStoredKey,submitPost:V,uploadFiles:st=>{N(st)},eventCallbacks:{onContentUpdate:Fhe,onImageFullscreenRequest:(st,Ot)=>{ua.showImageFullscreen(st,Ot)},onSelectImageNode:st=>{}}}),K(o,g.editor,!0),k(o).subscribe(st=>{K(a,st,!0),vT.set(st)}),()=>{g&&Whe({unsubscribe:g.unsubscribe,handlers:g.handlers,currentEditor:k(a),editorContainerEl:m})}});async function M(He){await N(He)}function R(He){if(!k(a)||!He)return;const st=k(a),Mt=He.split(`
`).map(dn=>({type:"paragraph",content:dn?[{type:"text",text:dn}]:void 0}));st.commands.setContent({type:"doc",content:Mt}),st.commands.focus("end")}function H(He){!k(a)||!He||(k(a).commands.setContent(He),k(a).commands.focus("end"))}function z(){return k(a)?k(a).getHTML():""}async function V(){if(!k(u)||!k(a))return;const He=k(u).preparePostContent(k(a));if(Bie(He)){ua.showSecretKeyDialog(He);return}await k(u).performPostSubmission(k(a),d,f,()=>ma({sending:!0,success:!1,error:!1,message:"",completed:!1}),()=>{ma({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),Y(),e.onPostSuccess?.()},st=>ma({sending:!1,success:!1,error:!0,message:st||"postComponent.post_error",completed:!1}))}function Q(){k(u)&&k(a)&&k(u).resetPostContent(k(a))}function Y(){k(u)&&k(a)&&k(u).clearContentAfterSuccess(k(a))}function ie(){Ec.querySelector(".tiptap-editor")?.focus()}async function ne(){const He=ua.getPendingPost();if(ua.hideSecretKeyDialog(),k(u)&&k(a)){const st=k(u).prepareImageBlurhashMap(k(a),d,f);ma({sending:!0,success:!1,error:!1,message:"",completed:!1});try{const Ot=await k(u).submitPost(He,st);Ot.success?(ma({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),Y(),e.onPostSuccess?.()):ma({sending:!1,success:!1,error:!0,message:Ot.error||"postComponent.post_error",completed:!1})}catch{ma({sending:!1,success:!1,error:!0,message:"postComponent.post_error",completed:!1})}}}function J(){ua.hideSecretKeyDialog()}function ke(){ua.hideImageFullscreen(),setTimeout(()=>{Ec.querySelector(".tiptap-editor")?.focus()},150)}Ge(()=>{if(k(O)&&k(_).nodeId){const He=k(_).nodeId;let st=!1;k(a)?.state?.doc&&k(a).state.doc.descendants(Mt=>{if(Mt.attrs.id===He)return st=Mt.type.name==="video",!1});let Ot;st?Ot=gde(k(_),k(a),za.value):Ot=Ehe(k(_),k(a),za.value),Ot&&(K(B,Ot.items,!0),K(F,Ot.x,!0),K(L,Ot.y,!0))}}),Ge(()=>{k(a)&&k(u)&&k(u).preparePostContent(k(a))!==Cn.content&&k(h).error&&ma({...k(h),error:!1,message:""})});function ze(){k(c)?.click()}var he={uploadFiles:M,insertTextContent:R,loadDraftContent:H,getEditorHtml:z,submitPost:V,resetPostContent:Q,clearContentAfterSuccess:Y,focusEditor:ie,openFileDialog:ze},Ee=bme(),Le=Te(Ee),pe=re(Le);let xe;var Me=re(pe);{var Ue=He=>{xue(He,{get editor(){return k(a)},class:"editor-content"})};$e(Me,He=>{k(o)&&k(a)&&He(Ue)})}Fm(pe,(He,st)=>Vue?.(He,st),()=>({dragOver:He=>K(l,He,!0)})),Fm(pe,He=>Wue?.(He)),Fm(pe,He=>jue?.(He)),Fm(pe,He=>que?.(He)),pr(pe,He=>m=He,()=>m);var qe=ve(pe,2);qe.__change=[mme,N],pr(qe,He=>K(c,He),()=>k(c));var tt=ve(qe,2);{var Ae=He=>{var st=gme(),Ot=re(st);je(()=>Re(Ot,k(p))),X(He,st)};$e(tt,He=>{k(p)&&He(Ae)})}var We=ve(Le,2);Xpe(We,{onConfirm:ne,onCancel:J,get show(){return k(b)},set show(He){K(b,He)}});var lt=ve(We,2);pme(lt,{get src(){return k(C)},get alt(){return k(I)},onClose:ke,get show(){return k(E)},set show(He){K(E,He)}});var ht=ve(lt,2);{var wt=He=>{Upe(He,{get x(){return k(F)},get y(){return k(L)},get items(){return k(B)},onClose:()=>is.set({open:!1,nodeId:void 0,src:void 0}),get onShowPopup(){return ua.showPopupMessage}})};$e(ht,He=>{k(O)&&He(wt)})}var Lt=ve(ht,2);{var Rt=He=>{kT(He,{get show(){return k(x)},get x(){return k(P)},get y(){return k(T)},onClose:()=>ua.hidePopupMessage(),children:(st,Ot)=>{var Mt=yme(),dn=re(Mt);je(()=>Re(dn,k(S))),X(st,Mt)},$$slots:{default:!0}})};$e(Lt,He=>{k(x)&&He(Rt)})}je(He=>xe=eo(pe,1,"editor-container svelte-15xolqm",null,xe,He),[()=>({"drag-over":k(l)})]),X(t,Ee);var pt=Et(he);return s(),pt}Ti(["change"]);function vme(t,e){e.onChange&&e.onChange(e.value)}var xme=_e('<input type="radio" style="display: none;"/> <!>',1);function DP(t,e){St(e,!0);let n=le(e,"checked",3,!1),r=le(e,"disabled",3,!1),i=le(e,"variant",3,"default"),s=le(e,"shape",3,"rounded"),o=le(e,"className",3,""),a=le(e,"ariaLabel",3,""),l=le(e,"style",3,""),c;function u(){!r()&&c&&c.click()}var d=xme(),f=Te(d);f.__change=[vme,e],pr(f,p=>c=p,()=>c);var h=ve(f,2);Yt(h,{get variant(){return i()},get shape(){return s()},get className(){return o()},get ariaLabel(){return a()},get style(){return l()},get disabled(){return r()},get selected(){return n()},onClick:u,children:(p,m)=>{var g=Fe(),y=Te(g);Tt(y,()=>e.children??Ut),X(p,g)},$$slots:{default:!0}}),je(()=>{l4(f,e.value),yn(f,"name",e.name),NU(f,n()),f.disabled=r()}),X(t,d),Et()}Ti(["change"]);/*! MIT License

Copyright (c) 2024 Lokuyow

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
 */var Sme={203:(t,e)=>{function n(S){if(!Number.isSafeInteger(S))throw new Error(`Wrong integer: ${S}`)}function r(...S){const _=(L,B)=>N=>L(B(N)),O=Array.from(S).reverse().reduce(((L,B)=>L?_(L,B.encode):B.encode),void 0),F=S.reduce(((L,B)=>L?_(L,B.decode):B.decode),void 0);return{encode:O,decode:F}}function i(S){return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return _.map((O=>{if(n(O),O<0||O>=S.length)throw new Error(`Digit index outside alphabet: ${O} (alphabet: ${S.length})`);return S[O]}))},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("alphabet.decode input should be array of strings");return _.map((O=>{if(typeof O!="string")throw new Error(`alphabet.decode: not string element=${O}`);const F=S.indexOf(O);if(F===-1)throw new Error(`Unknown letter: "${O}". Allowed: ${S}`);return F}))}}}function s(S=""){if(typeof S!="string")throw new Error("join separator should be string");return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("join.encode input should be array of strings");for(let O of _)if(typeof O!="string")throw new Error(`join.encode: non-string input=${O}`);return _.join(S)},decode:_=>{if(typeof _!="string")throw new Error("join.decode input should be string");return _.split(S)}}}function o(S,_="="){if(n(S),typeof _!="string")throw new Error("padding chr should be string");return{encode(O){if(!Array.isArray(O)||O.length&&typeof O[0]!="string")throw new Error("padding.encode input should be array of strings");for(let F of O)if(typeof F!="string")throw new Error(`padding.encode: non-string input=${F}`);for(;O.length*S%8;)O.push(_);return O},decode(O){if(!Array.isArray(O)||O.length&&typeof O[0]!="string")throw new Error("padding.encode input should be array of strings");for(let L of O)if(typeof L!="string")throw new Error(`padding.decode: non-string input=${L}`);let F=O.length;if(F*S%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;F>0&&O[F-1]===_;F--)if(!((F-1)*S%8))throw new Error("Invalid padding: string has too much padding");return O.slice(0,F)}}}function a(S){if(typeof S!="function")throw new Error("normalize fn should be function");return{encode:_=>_,decode:_=>S(_)}}function l(S,_,O){if(_<2)throw new Error(`convertRadix: wrong from=${_}, base cannot be less than 2`);if(O<2)throw new Error(`convertRadix: wrong to=${O}, base cannot be less than 2`);if(!Array.isArray(S))throw new Error("convertRadix: data should be array");if(!S.length)return[];let F=0;const L=[],B=Array.from(S);for(B.forEach((N=>{if(n(N),N<0||N>=_)throw new Error(`Wrong integer: ${N}`)}));;){let N=0,M=!0;for(let R=F;R<B.length;R++){const H=B[R],z=_*N+H;if(!Number.isSafeInteger(z)||_*N/_!==N||z-H!=_*N)throw new Error("convertRadix: carry overflow");if(N=z%O,B[R]=Math.floor(z/O),!Number.isSafeInteger(B[R])||B[R]*O+N!==z)throw new Error("convertRadix: carry overflow");M&&(B[R]?M=!1:F=R)}if(L.push(N),M)break}for(let N=0;N<S.length-1&&S[N]===0;N++)L.push(0);return L.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const c=(S,_)=>_?c(_,S%_):S,u=(S,_)=>S+(_-c(S,_));function d(S,_,O,F){if(!Array.isArray(S))throw new Error("convertRadix2: data should be array");if(_<=0||_>32)throw new Error(`convertRadix2: wrong from=${_}`);if(O<=0||O>32)throw new Error(`convertRadix2: wrong to=${O}`);if(u(_,O)>32)throw new Error(`convertRadix2: carry overflow from=${_} to=${O} carryBits=${u(_,O)}`);let L=0,B=0;const N=2**O-1,M=[];for(const R of S){if(n(R),R>=2**_)throw new Error(`convertRadix2: invalid data word=${R} from=${_}`);if(L=L<<_|R,B+_>32)throw new Error(`convertRadix2: carry overflow pos=${B} from=${_}`);for(B+=_;B>=O;B-=O)M.push((L>>B-O&N)>>>0);L&=2**B-1}if(L=L<<O-B&N,!F&&B>=_)throw new Error("Excess padding");if(!F&&L)throw new Error(`Non-zero padding: ${L}`);return F&&B>0&&M.push(L>>>0),M}function f(S){return n(S),{encode:_=>{if(!(_ instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return l(Array.from(_),256,S)},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(l(_,S,256))}}}function h(S,_=!1){if(n(S),S<=0||S>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,S)>32||u(S,8)>32)throw new Error("radix2: carry overflow");return{encode:O=>{if(!(O instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return d(Array.from(O),8,S,!_)},decode:O=>{if(!Array.isArray(O)||O.length&&typeof O[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(d(O,S,8,_))}}}function p(S){if(typeof S!="function")throw new Error("unsafeWrapper fn should be function");return function(..._){try{return S.apply(null,_)}catch{}}}function m(S,_){if(n(S),typeof _!="function")throw new Error("checksum fn should be function");return{encode(O){if(!(O instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const F=_(O).slice(0,S),L=new Uint8Array(O.length+S);return L.set(O),L.set(F,O.length),L},decode(O){if(!(O instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const F=O.slice(0,-S),L=_(F).slice(0,S),B=O.slice(-S);for(let N=0;N<S;N++)if(L[N]!==B[N])throw new Error("Invalid checksum");return F}}}e.utils={alphabet:i,chain:r,checksum:m,radix:f,radix2:h,join:s,padding:o},e.base16=r(h(4),i("0123456789ABCDEF"),s("")),e.base32=r(h(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),e.base32hex=r(h(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),e.base32crockford=r(h(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((S=>S.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),e.base64url=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const g=S=>r(f(58),i(S),s(""));e.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(S){let _="";for(let O=0;O<S.length;O+=8){const F=S.subarray(O,O+8);_+=e.base58.encode(F).padStart(y[F.length],"1")}return _},decode(S){let _=[];for(let O=0;O<S.length;O+=11){const F=S.slice(O,O+11),L=y.indexOf(F.length),B=e.base58.decode(F);for(let N=0;N<B.length-L;N++)if(B[N]!==0)throw new Error("base58xmr: wrong padding");_=_.concat(Array.from(B.slice(B.length-L)))}return Uint8Array.from(_)}},e.base58check=S=>r(m(4,(_=>S(S(_)))),e.base58);const b=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),E=[996825010,642813549,513874426,1027748829,705979059];function C(S){const _=S>>25;let O=(33554431&S)<<5;for(let F=0;F<E.length;F++)(_>>F&1)==1&&(O^=E[F]);return O}function I(S,_,O=1){const F=S.length;let L=1;for(let B=0;B<F;B++){const N=S.charCodeAt(B);if(N<33||N>126)throw new Error(`Invalid prefix (${S})`);L=C(L)^N>>5}L=C(L);for(let B=0;B<F;B++)L=C(L)^31&S.charCodeAt(B);for(let B of _)L=C(L)^B;for(let B=0;B<6;B++)L=C(L);return L^=O,b.encode(d([L%2**30],30,5,!1))}function x(S){const _=S==="bech32"?1:734539939,O=h(5),F=O.decode,L=O.encode,B=p(F);function N(M,R=90){if(typeof M!="string")throw new Error("bech32.decode input should be string, not "+typeof M);if(M.length<8||R!==!1&&M.length>R)throw new TypeError(`Wrong string length: ${M.length} (${M}). Expected (8..${R})`);const H=M.toLowerCase();if(M!==H&&M!==M.toUpperCase())throw new Error("String must be lowercase or uppercase");const z=(M=H).lastIndexOf("1");if(z===0||z===-1)throw new Error('Letter "1" must be present between prefix and data only');const V=M.slice(0,z),Q=M.slice(z+1);if(Q.length<6)throw new Error("Data must be at least 6 characters long");const Y=b.decode(Q).slice(0,-6),ie=I(V,Y,_);if(!Q.endsWith(ie))throw new Error(`Invalid checksum in ${M}: expected "${ie}"`);return{prefix:V,words:Y}}return{encode:function(M,R,H=90){if(typeof M!="string")throw new Error("bech32.encode prefix should be string, not "+typeof M);if(!Array.isArray(R)||R.length&&typeof R[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof R);const z=M.length+7+R.length;if(H!==!1&&z>H)throw new TypeError(`Length ${z} exceeds limit ${H}`);return`${M=M.toLowerCase()}1${b.encode(R)}${I(M,R,_)}`},decode:N,decodeToBytes:function(M){const{prefix:R,words:H}=N(M,!1);return{prefix:R,words:H,bytes:F(H)}},decodeUnsafe:p(N),fromWords:F,fromWordsUnsafe:B,toWords:L}}e.bech32=x("bech32"),e.bech32m=x("bech32m"),e.utf8={encode:S=>new TextDecoder().decode(S),decode:S=>new TextEncoder().encode(S)},e.hex=r(h(4),i("0123456789abcdef"),s(""),a((S=>{if(typeof S!="string"||S.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof S} with length ${S.length}`);return S.toLowerCase()})));const P={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},T=`Invalid encoding type. Available types: ${Object.keys(P).join(", ")}`;e.bytesToString=(S,_)=>{if(typeof S!="string"||!P.hasOwnProperty(S))throw new TypeError(T);if(!(_ instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return P[S].encode(_)},e.str=e.bytesToString,e.stringToBytes=(S,_)=>{if(!P.hasOwnProperty(S))throw new TypeError(T);if(typeof _!="string")throw new TypeError("stringToBytes() expects string");return P[S].decode(_)},e.bytes=e.stringToBytes},806:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([t.id,`.zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

/* Color Classes Generator */
[class*="zap-amount-"] .zap-sender {
  border-radius: 6px;
}

[class*="zap-amount-"] .zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

[class*="zap-amount-"] .zap-details {
  padding-top: 8px;
  padding-bottom: 8px;
}

/* Amount-based Styles */
.zap-amount-100 .zap-sender {
  background-color: var(--zap-100);
}

.zap-amount-200 .zap-sender {
  background-color: var(--zap-200);
}

.zap-amount-500 .zap-sender {
  background-color: var(--zap-500);
}

.zap-amount-1k .zap-sender {
  background-color: var(--zap-1k);
}

.zap-amount-2k .zap-sender {
  background-color: var(--zap-2k);
}

.zap-amount-5k .zap-sender {
  background-color: var(--zap-5k);
}

.zap-amount-10k .zap-sender {
  background-color: var(--zap-10k);
}

/* Details Background Colors */
.zap-amount-100 .zap-details {
  background-color: var(--zap-100-light);
}

.zap-amount-200 .zap-details {
  background-color: var(--zap-200-light);
}

.zap-amount-500 .zap-details {
  background-color: var(--zap-500-light);
}

.zap-amount-1k .zap-details {
  background-color: var(--zap-1k-light);
}

.zap-amount-2k .zap-details {
  background-color: var(--zap-2k-light);
}

.zap-amount-5k .zap-details {
  background-color: var(--zap-5k-light);
}

.zap-amount-10k .zap-details {
  background-color: var(--zap-10k-light);
}

/* Dark Text Colors */
.zap-amount-100,
.zap-amount-2k,
.zap-amount-5k,
.zap-amount-10k {
  .zap-amount {
    color: var(--text-light);
  }

  .sender-name {
    color: var(--text-light-secondary);
  }

  .sender-pubkey {
    color: var(--text-light-tertiary);
  }

  .zap-comment {
    color: var(--text-light);
  }
}

/* Light Text Colors */
.zap-amount-200,
.zap-amount-500,
.zap-amount-1k {
  .zap-amount {
    color: var(--text-dark);
  }

  .sender-name {
    color: var(--text-dark-secondary);
  }

  .sender-pubkey {
    color: var(--text-dark-tertiary);
  }

  .zap-comment {
    color: var(--text-dark);
  }
}`,""]);const a=o},540:(t,e,n)=>{n.r(e),n.d(e,{default:()=>c});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(806),l=o()(i());l.i(a.A),l.push([t.id,`/* styles.css */

:host {
  --main-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  --main-text: Black;
  --pubkey-text: #888;
  --custom-title-text: #555;
  --stats-item-text: #333;
  --name-text: #444;
  --dialog-bg: #ffffff;
  --zap-stats-bg: #edf2f7;
  --hover-bg: #edf2f7;
  --border: #ddd;
  --skeleton: #fdfdfd;
  --skeleton2: #e2e5ec;
  --zap-stats-skeleton-bg: #bbc5cf;
  --new-mark: #22c55e;

  /* Zap Amount Colors */
  --zap-100: #1565c0;
  --zap-200: #00b8d4;
  --zap-500: #00bfa5;
  --zap-1k: #ffb300;
  --zap-2k: #e65100;
  --zap-5k: #c2185b;
  --zap-10k: #d00000;

  /* Light Variants */
  --zap-100-light: #1e88e5;
  --zap-200-light: #00e5ff;
  --zap-500-light: #1de9b6;
  --zap-1k-light: #ffca28;
  --zap-2k-light: #f57c00;
  --zap-5k-light: #e91e63;
  --zap-10k-light: #e62117;

  /* Text Colors */
  --text-light: #ffffff;
  --text-light-secondary: rgba(255, 255, 255, 0.9);
  --text-light-tertiary: rgba(255, 255, 255, 0.5);
  --text-dark: #000000;
  --text-dark-secondary: rgba(0, 0, 0, 0.7);
  --text-dark-tertiary: rgba(0, 0, 0, 0.5);
}

* {
  box-sizing: border-box;
}

button {
  color: var(--main-text);
  background: none;
  border: none;
  cursor: pointer;
}

.dialog {
  font-family: var(--main-font);
  color: var(--main-text);
  font-size: medium;
  font-weight: normal;
  max-height: 700px;
  height: 100dvh;
  width: 360px;
  margin: auto;
  padding: 0;
  border: none;
  border-radius: 10px;
  background: var(--dialog-bg);
  display: flex;
  flex-direction: column;
}

.close-dialog-button {
  color: var(--custom-title-text);
  font-size: 16px;
  font-weight: 500;
  position: absolute;
  right: 0;
  width: 2.625rem;
  height: 2.625rem;
  border: none;
  border-radius: 50%;
  background: none;
  cursor: pointer;
  padding: 10px;
  text-align: center;
}

.close-dialog-button:hover {
  background-color: var(--hover-bg);
}

.dialog-title {
  height: 42px;
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;

  & a {
    font-size: 0.9rem;
    font-weight: normal;
    color: var(--pubkey-text);
    text-decoration: none;
    cursor: pointer;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
  }

  & a:hover {
    text-decoration: underline;
  }
}

.dialog-title.custom-title a {
  color: var(--custom-title-text);
  font-weight: 600;
  font-size: 1rem;
}

.zap-stats {
  min-height: 80px;
  padding: 6px 14px;
  background: var(--zap-stats-bg);
  border-radius: 6px;
  display: grid;
  grid-template-columns: 90px 1fr 40px;
  grid-template-rows: repeat(3, 1fr);
  gap: 4px;
  margin: 0 8px;

  .stats-item {
    height: 23px;
    color: var(--stats-item-text);
    font-size: 0.9rem;

    .number {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .number.skeleton {
      width: 100%;
      background: linear-gradient(90deg,
          var(--skeleton) 0%,
          var(--zap-stats-skeleton-bg) 50%,
          var(--skeleton) 100%);
      background-size: 200% 100%;
    }
  }
}

.stats-item:nth-child(3n + 1) {
  justify-content: flex-start;
}

.stats-item:nth-child(3n + 2),
.stats-item:nth-child(3n + 3) {
  justify-content: flex-end;
}

.text-muted {
  margin-right: 16px;
  opacity: 0.4;
}

.dialog-zap-list {
  list-style-type: none;
  margin: 10px 0;
  padding: 0 6px;
  flex: 1;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: smooth;

  /* ã¹ã¯ã­ã¼ã«ãã¼ã®ã¹ã¿ã¤ãªã³ã° */
  &::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 3px;
  }

  &::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    transition: background 0.2s;
  }

  &::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.2);
  }

  /* Firefoxç¨ã®ã¹ã¯ã­ã¼ã«ãã¼ã¹ã¿ã¤ã« */
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
}

.zap-list-item {
  display: flex;
  flex-direction: column;
  border-top: 1px solid var(--border);
  padding: 4px 0;
}

.zap-content {
  display: flex;
  flex-direction: column;
}

.reference-container {
  display: flex;
  flex-direction: column;
}

.zap-sender {
  gap: 12px;
  height: 46px;
  justify-content: space-between;
  padding: 6px;
}

.sender-icon {
  flex-shrink: 0;

  & img {
    width: 100%;
    height: 100%;
    border-radius: 4px;
    object-fit: cover;
    object-position: center;
  }
}

.sender-icon.is-new::before {
  content: "";
  position: absolute;
  top: -4px;
  left: -4px;
  width: 8px;
  height: 8px;
  background-color: var(--new-mark);
  border: 1px solid #fff;
  border-radius: 50%;
  z-index: 1;
  animation: pulse 2500ms cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  50% {
    opacity: 0.3;
  }
}

.sender-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  overflow: hidden;
  min-width: 0;
}

.sender-name {
  font-size: 0.9375rem;
  font-weight: bold;
  color: var(--name-text);
}

.sender-pubkey {
  font-size: 0.625rem;
  color: var(--pubkey-text);
  margin-top: -1px;
}

.zap-amount {
  font-size: 0.8rem;
  white-space: nowrap;
  flex-shrink: 0;

  .number {
    font-size: 1.4rem;
    font-weight: 500;
    text-align: right;
  }
}

.zap-details {
  padding: 2px 8px;
  border-radius: 0 0 6px 6px;
  margin: 0;
}

.zap-comment {
  font-size: 0.9375rem;
  margin: 0;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  max-width: 100%;
}

.no-zaps-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

.no-zaps-message {
  text-align: center;
  color: var(--pubkey-text);
  font-size: 1.8rem;
  font-weight: 700;
}

.zap-reference {
  padding: 2px 0 2px 12px;
  margin: 0;
  font-size: 0.875rem;
  color: var(--pubkey-text);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.reference-arrow {
  flex-shrink: 0;

  img {
    height: 16px;
    width: auto;
  }
}

.reference-text {
  font-size: 0.75rem;
  margin: 0 2px;
  flex-grow: 1;
}

.reference-link {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 1.5rem;
  width: 2.6rem;
  text-decoration: none;
  border-left: 1px solid var(--border);
  flex-shrink: 0;

  & img {
    height: 20px;
    width: auto;
  }
}

.zap-placeholder-name {
  height: 30px;
  width: 140px;
}

.zap-placeholder-name.skeleton {
  width: 120px;
  height: 19px;
  margin: 2px 0;
}

.skeleton {
  color: transparent;
  border-radius: 2px;
  background: linear-gradient(90deg,
      var(--skeleton) 0%,
      var(--skeleton2) 50%,
      var(--skeleton) 100%);
  background-size: 200% 100%;
  animation: loading-animation 3.5s infinite;
  opacity: 0.7;
}

@keyframes loading-animation {
  0% {
    background-position: 200% 0;
  }

  100% {
    background-position: -200% 0;
  }
}

/* å±éã®ãã­ã¹ããªã¼ãã¼ãã­ã¼å¦ç */
.dialog-title,
.sender-name,
.sender-pubkey,
.reference-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* å±éã®ãã¬ãã¯ã¹ããã¯ã¹è¨­å® */
.zap-sender,
.stats-item,
.zap-details,
.reference-link,
.zap-reference {
  display: flex;
  align-items: center;
}

/* å±éã®ã¢ã¤ã³ã³ãµã¤ãº */
.zap-placeholder-icon,
.sender-icon {
  width: 32px;
  height: 32px;
  border-radius: 4px;
  position: relative;
}

.load-more-trigger {
  height: 40px;
  margin: 10px 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--zap-stats-bg);
  border-top: 3px solid var(--pubkey-text);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}`,""]);const c=l},314:t=>{t.exports=function(e){var n=[];return n.toString=function(){return this.map((function(r){var i="",s=r[5]!==void 0;return r[4]&&(i+="@supports (".concat(r[4],") {")),r[2]&&(i+="@media ".concat(r[2]," {")),s&&(i+="@layer".concat(r[5].length>0?" ".concat(r[5]):""," {")),i+=e(r),s&&(i+="}"),r[2]&&(i+="}"),r[4]&&(i+="}"),i})).join("")},n.i=function(r,i,s,o,a){typeof r=="string"&&(r=[[null,r,void 0]]);var l={};if(s)for(var c=0;c<this.length;c++){var u=this[c][0];u!=null&&(l[u]=!0)}for(var d=0;d<r.length;d++){var f=[].concat(r[d]);s&&l[f[0]]||(a!==void 0&&(f[5]===void 0||(f[1]="@layer".concat(f[5].length>0?" ".concat(f[5]):""," {").concat(f[1],"}")),f[5]=a),i&&(f[2]&&(f[1]="@media ".concat(f[2]," {").concat(f[1],"}")),f[2]=i),o&&(f[4]?(f[1]="@supports (".concat(f[4],") {").concat(f[1],"}"),f[4]=o):f[4]="".concat(o)),n.push(f))}},n}},601:t=>{t.exports=function(e){return e[1]}},705:(t,e,n)=>{const{bech32:r,hex:i,utf8:s}=n(203),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},d=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],f={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},h=BigInt("2100000000000000000"),p=BigInt(1e11),m={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},g={};for(let I=0,x=Object.keys(m);I<x.length;I++){const P=x[I],T=m[x[I]].toString();g[T]=P}const y={1:I=>i.encode(r.fromWordsUnsafe(I)),16:I=>i.encode(r.fromWordsUnsafe(I)),13:I=>s.encode(r.fromWordsUnsafe(I)),19:I=>i.encode(r.fromWordsUnsafe(I)),23:I=>i.encode(r.fromWordsUnsafe(I)),27:I=>i.encode(r.fromWordsUnsafe(I)),6:E,24:E,3:function(I){const x=[];let P,T,S,_,O,F=r.fromWordsUnsafe(I);for(;F.length>0;)P=i.encode(F.slice(0,33)),T=i.encode(F.slice(33,41)),S=parseInt(i.encode(F.slice(41,45)),16),_=parseInt(i.encode(F.slice(45,49)),16),O=parseInt(i.encode(F.slice(49,51)),16),F=F.slice(51),x.push({pubkey:P,short_channel_id:T,fee_base_msat:S,fee_proportional_millionths:_,cltv_expiry_delta:O});return x},5:function(I){const x=I.slice().reverse().map((S=>[!!(1&S),!!(2&S),!!(4&S),!!(8&S),!!(16&S)])).reduce(((S,_)=>S.concat(_)),[]);for(;x.length<2*d.length;)x.push(!1);const P={};d.forEach(((S,_)=>{let O;O=x[2*_]?"required":x[2*_+1]?"supported":"unsupported",P[S]=O}));const T=x.slice(2*d.length);return P.extra_bits={start_bit:2*d.length,bits:T,has_required:T.reduce(((S,_,O)=>O%2!=0?S||!1:S||_),!1)},P}};function b(I){return x=>({tagCode:parseInt(I),words:r.encode("unknown",x,Number.MAX_SAFE_INTEGER)})}function E(I){return I.reverse().reduce(((x,P,T)=>x+P*Math.pow(32,T)),0)}function C(I,x){let P,T;if(I.slice(-1).match(/^[munp]$/))P=I.slice(-1),T=I.slice(0,-1);else{if(I.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");T=I}if(!T.match(/^\d+$/))throw new Error("Not a valid human readable amount");const S=BigInt(T),_=P?S*p/f[P]:S*p;if(P==="p"&&S%BigInt(10)!==BigInt(0)||_>h)throw new Error("Amount is outside of valid range");return x?_.toString():_}t.exports={decode:function(I,x){if(typeof I!="string")throw new Error("Lightning Payment Request must be string");if(I.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const P=[],T=r.decode(I,Number.MAX_SAFE_INTEGER);I=I.toLowerCase();const S=T.prefix;let _=T.words,O=I.slice(S.length+1),F=_.slice(-104);_=_.slice(0,-104);let L=S.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(L&&!L[2]&&(L=S.match(/^ln(\S+)$/)),!L)throw new Error("Not a proper lightning payment request");P.push({name:"lightning_network",letters:"ln"});const B=L[1];let N;if(x){if(x.bech32===void 0||x.pubKeyHash===void 0||x.scriptHash===void 0||!Array.isArray(x.validWitnessVersions))throw new Error("Invalid network");N=x}else switch(B){case o.bech32:N=o;break;case a.bech32:N=a;break;case l.bech32:N=l;break;case c.bech32:N=c;break;case u.bech32:N=u}if(!N||N.bech32!==B)throw new Error("Unknown coin bech32 prefix");P.push({name:"coin_network",letters:B,value:N});const M=L[2];let R;M?(R=C(M+L[3],!0),P.push({name:"amount",letters:L[2]+L[3],value:R})):R=null,P.push({name:"separator",letters:"1"});const H=E(_.slice(0,7));let z,V,Q,Y;for(_=_.slice(7),P.push({name:"timestamp",letters:O.slice(0,7),value:H}),O=O.slice(7);_.length>0;){const J=_[0].toString();z=g[J]||"unknown_tag",V=y[J]||b(J),_=_.slice(1),Q=E(_.slice(0,2)),_=_.slice(2),Y=_.slice(0,Q),_=_.slice(Q),P.push({name:z,tag:O[0],letters:O.slice(0,3+Q),value:V(Y)}),O=O.slice(3+Q)}P.push({name:"signature",letters:O.slice(0,104),value:i.encode(r.fromWordsUnsafe(F))}),O=O.slice(104),P.push({name:"checksum",letters:O});let ie={paymentRequest:I,sections:P,get expiry(){let J=P.find((ke=>ke.name==="expiry"));if(J)return ne("timestamp")+J.value},get route_hints(){return P.filter((J=>J.name==="route_hint")).map((J=>J.value))}};for(let J in m)J!=="route_hint"&&Object.defineProperty(ie,J,{get:()=>ne(J)});return ie;function ne(J){let ke=P.find((ze=>ze.name===J));return ke?ke.value:void 0}},hrpToMillisat:C}},0:(t,e,n)=>{var r=n(540);r&&r.__esModule&&(r=r.default),t.exports=typeof r=="string"?r:r.toString()}},LP={};function Jr(t){var e=LP[t];if(e!==void 0)return e.exports;var n=LP[t]={id:t,exports:{}};return Sme[t](n,n.exports,Jr),n.exports}Jr.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return Jr.d(e,{a:e}),e},Jr.d=(t,e)=>{for(var n in e)Jr.o(e,n)&&!Jr.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},Jr.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Jr.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var ta={};Jr.d(ta,{vQ:()=>kt,ZM:()=>Vp,yk:()=>ft,h0:()=>hu,n_:()=>LF,Xz:()=>gbe,Uv:()=>Wp,fU:()=>jp,Dw:()=>Mo});var nS={};Jr.r(nS),Jr.d(nS,{OG:()=>AT,My:()=>Sf,Ph:()=>zi,lX:()=>_T,Id:()=>zu,fg:()=>C6,qj:()=>Yr,aT:()=>$p,lq:()=>mc,z:()=>CT,Q5:()=>zp});var rS={};Jr.r(rS),Jr.d(rS,{Relay:()=>BB,SimplePool:()=>F0e,finalizeEvent:()=>ao,fj:()=>PB,generateSecretKey:()=>mB,getEventHash:()=>lp,getFilterLimit:()=>P0e,getPublicKey:()=>$T,kinds:()=>gB,matchFilter:()=>AB,matchFilters:()=>IB,mergeFilters:()=>I0e,nip04:()=>zB,nip05:()=>VB,nip10:()=>jB,nip11:()=>qB,nip13:()=>KB,nip18:()=>QB,nip19:()=>FB,nip21:()=>YB,nip25:()=>JB,nip27:()=>eF,nip28:()=>tF,nip30:()=>nF,nip39:()=>iF,nip42:()=>NB,nip44:()=>sF,nip47:()=>uF,nip57:()=>dF,nip59:()=>fF,nip98:()=>xF,parseReferences:()=>K0e,serializeEvent:()=>pB,sortEvents:()=>hge,utils:()=>dB,validateEvent:()=>iw,verifiedSymbol:()=>Ul,verifyEvent:()=>qf});var Eme=Jr(705);function BP(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function S6(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function kme(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");BP(t.outputLen),BP(t.blockLen)}function Ry(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Tme(t,e){S6(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const z1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,E6=t=>t instanceof Uint8Array,U1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),wo=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function TT(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!E6(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class k6{clone(){return this._cloneInto()}}function _me(t){const e=r=>t().update(TT(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function T6(t=32){if(z1&&typeof z1.getRandomValues=="function")return z1.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class Cme extends k6{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=U1(this.buffer)}update(e){Ry(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=TT(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=U1(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ry(this),Tme(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;(function(d,f,h,p){if(typeof d.setBigUint64=="function")return d.setBigUint64(f,h,p);const m=BigInt(32),g=BigInt(4294967295),y=Number(h>>m&g),b=Number(h&g),E=p?4:0,C=p?0:4;d.setUint32(f+E,y,p),d.setUint32(f+C,b,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=U1(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const Ame=(t,e,n)=>t&e^t&n^e&n,Ime=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Il=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Pl=new Uint32Array(64);class Pme extends Cme{constructor(){super(64,32,8,!1),this.A=0|Il[0],this.B=0|Il[1],this.C=0|Il[2],this.D=0|Il[3],this.E=0|Il[4],this.F=0|Il[5],this.G=0|Il[6],this.H=0|Il[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let f=0;f<16;f++,n+=4)Pl[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Pl[f-15],p=Pl[f-2],m=wo(h,7)^wo(h,18)^h>>>3,g=wo(p,17)^wo(p,19)^p>>>10;Pl[f]=g+Pl[f-7]+m+Pl[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=u+(wo(a,6)^wo(a,11)^wo(a,25))+((d=a)&l^~d&c)+Ime[f]+Pl[f]|0,p=(wo(r,2)^wo(r,13)^wo(r,22))+Ame(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var d;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Pl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const iS=_me((()=>new Pme)),Ome=(BigInt(0),BigInt(1)),Mme=BigInt(2),Yb=t=>t instanceof Uint8Array,Nme=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Sf(t){if(!Yb(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Nme[t[n]];return e}function _6(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function $p(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function zi(t){return _6(Sf(t))}function _T(t){if(!Yb(t))throw new Error("Uint8Array expected");return _6(Sf(Uint8Array.from(t).reverse()))}function mc(t,e){return $p(t.toString(16).padStart(2*e,"0"))}function CT(t,e){return mc(t,e).reverse()}function Yr(t,e,n){let r;if(typeof e=="string")try{r=$p(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else{if(!Yb(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function zu(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!Yb(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}const AT=t=>(Mme<<BigInt(t-1))-Ome,H1=t=>new Uint8Array(t),FP=t=>Uint8Array.from(t);function C6(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=H1(t),i=H1(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=H1())=>{i=a(FP([0]),u),r=a(),u.length!==0&&(i=a(FP([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){r=a();const f=r.slice();d.push(f),u+=r.length}return zu(...d)};return(u,d)=>{let f;for(o(),l(u);!(f=d(c()));)l();return o(),f}}const Rme={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function zp(t,e,n={}){const r=(i,s,o)=>{const a=Rme[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0||a(l,t)))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const yr=BigInt(0),Yn=BigInt(1),Kc=BigInt(2),Dme=BigInt(3),V1=BigInt(4),$P=BigInt(5),zP=BigInt(8);BigInt(9),BigInt(16);function Lr(t,e){const n=t%e;return n>=yr?n:e+n}function Lme(t,e,n){if(n<=yr||e<yr)throw new Error("Expected power/modulo > 0");if(n===Yn)return yr;let r=Yn;for(;e>yr;)e&Yn&&(r=r*t%n),t=t*t%n,e>>=Yn;return r}function ms(t,e,n){let r=t;for(;e-- >yr;)r*=r,r%=n;return r}function sS(t,e){if(t===yr||e<=yr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Lr(t,e),r=e,i=yr,s=Yn;for(;n!==yr;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==Yn)throw new Error("invert: does not exist");return Lr(i,e)}function Bme(t){if(t%V1===Dme){const e=(t+Yn)/V1;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%zP===$P){const e=(t-$P)/zP;return function(n,r){const i=n.mul(r,Kc),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Kc),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return(function(e){const n=(e-Yn)/Kc;let r,i,s;for(r=e-Yn,i=0;r%Kc===yr;r/=Kc,i++);for(s=Kc;s<e&&Lme(s,n,e)!==e-Yn;s++);if(i===1){const a=(e+Yn)/V1;return function(l,c){const u=l.pow(c,a);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const o=(r+Yn)/Kc;return function(a,l){if(a.pow(l,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,u=a.pow(a.mul(a.ONE,s),r),d=a.pow(l,o),f=a.pow(l,r);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let m=a.sqr(f);h<c&&!a.eql(m,a.ONE);h++)m=a.sqr(m);const p=a.pow(u,Yn<<BigInt(c-h-1));u=a.sqr(p),d=a.mul(d,p),f=a.mul(f,u),c=h}return d}})(t)}const Fme=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function A6(t,e){const n=e!==void 0?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function I6(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function UP(t){const e=I6(t);return e+Math.ceil(e/2)}class P6 extends k6{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,kme(e);const r=TT(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Ry(this),this.iHash.update(e),this}digestInto(e){Ry(this),S6(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const O6=(t,e,n)=>new P6(t,e).update(n).digest();O6.create=(t,e)=>new P6(t,e);const $me=BigInt(0),W1=BigInt(1);function M6(t){return zp(t.Fp,Fme.reduce(((e,n)=>(e[n]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),zp(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...A6(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:zme,aT:Ume}=nS,fu={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=fu;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(r[0]===0&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:zme(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=fu,n=typeof t=="string"?Ume(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=fu._parseInt(n.subarray(2)),{d:o,l:a}=fu._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>8&Number.parseInt(c[0],16)?"00"+c:c,n=c=>{const u=c.toString(16);return 1&u.length?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Pa=BigInt(0),vs=BigInt(1),HP=(BigInt(2),BigInt(3));BigInt(4);function Hme(t){const e=(function(p){const m=M6(p);zp(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:g,Fp:y,a:b}=m;if(g){if(!y.eql(b,y.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof g!="object"||typeof g.beta!="bigint"||typeof g.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})})(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return zu(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1);return{x:n.fromBytes(m.subarray(0,n.BYTES)),y:n.fromBytes(m.subarray(n.BYTES,2*n.BYTES))}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Pa<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Sf(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(2*g,"0")}let E;try{E=typeof p=="bigint"?p:zi(Yr("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(E=Lr(E,b)),a(E),E}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=E=>n.eql(E,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map((y=>y.pz)));return m.map(((y,b)=>y.toAffine(g[b]))).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(Yr("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:E,py:C,pz:I}=m,x=n.eql(n.mul(g,I),n.mul(E,b)),P=n.eql(n.mul(y,I),n.mul(C,b));return x&&P}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,HP),{px:b,py:E,pz:C}=this;let I=n.ZERO,x=n.ZERO,P=n.ZERO,T=n.mul(b,b),S=n.mul(E,E),_=n.mul(C,C),O=n.mul(b,E);return O=n.add(O,O),P=n.mul(b,C),P=n.add(P,P),I=n.mul(m,P),x=n.mul(y,_),x=n.add(I,x),I=n.sub(S,x),x=n.add(S,x),x=n.mul(I,x),I=n.mul(O,I),P=n.mul(y,P),_=n.mul(m,_),O=n.sub(T,_),O=n.mul(m,O),O=n.add(O,P),P=n.add(T,T),T=n.add(P,T),T=n.add(T,_),T=n.mul(T,O),x=n.add(x,T),_=n.mul(E,C),_=n.add(_,_),T=n.mul(_,O),I=n.sub(I,T),P=n.mul(_,S),P=n.add(P,P),P=n.add(P,P),new d(I,x,P)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:E,py:C,pz:I}=m;let x=n.ZERO,P=n.ZERO,T=n.ZERO;const S=e.a,_=n.mul(e.b,HP);let O=n.mul(g,E),F=n.mul(y,C),L=n.mul(b,I),B=n.add(g,y),N=n.add(E,C);B=n.mul(B,N),N=n.add(O,F),B=n.sub(B,N),N=n.add(g,b);let M=n.add(E,I);return N=n.mul(N,M),M=n.add(O,L),N=n.sub(N,M),M=n.add(y,b),x=n.add(C,I),M=n.mul(M,x),x=n.add(F,L),M=n.sub(M,x),T=n.mul(S,N),x=n.mul(_,L),T=n.add(x,T),x=n.sub(F,T),T=n.add(F,T),P=n.mul(x,T),F=n.add(O,O),F=n.add(F,O),L=n.mul(S,L),N=n.mul(_,N),F=n.add(F,L),L=n.sub(O,L),L=n.mul(S,L),N=n.add(N,L),O=n.mul(F,N),P=n.add(P,O),O=n.mul(M,N),x=n.mul(B,x),x=n.sub(x,O),O=n.mul(B,F),T=n.mul(M,T),T=n.add(T,O),new d(x,P,T)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,(g=>{const y=n.invertBatch(g.map((b=>b.pz)));return g.map(((b,E)=>b.toAffine(y[E]))).map(d.fromAffine)}))}multiplyUnsafe(m){const g=d.ZERO;if(m===Pa)return g;if(a(m),m===vs)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:E,k2neg:C,k2:I}=y.splitScalar(m),x=g,P=g,T=this;for(;E>Pa||I>Pa;)E&vs&&(x=x.add(T)),I&vs&&(P=P.add(T)),T=T.double(),E>>=vs,I>>=vs;return b&&(x=x.negate()),C&&(P=P.negate()),P=new d(n.mul(P.px,y.beta),P.py,P.pz),x.add(P)}multiply(m){a(m);let g,y,b=m;const{endo:E}=e;if(E){const{k1neg:C,k1:I,k2neg:x,k2:P}=E.splitScalar(b);let{p:T,f:S}=this.wNAF(I),{p:_,f:O}=this.wNAF(P);T=h.constTimeNegate(C,T),_=h.constTimeNegate(x,_),_=new d(n.mul(_.px,E.beta),_.py,_.pz),g=T.add(_),y=S.add(O)}else{const{p:C,f:I}=this.wNAF(b);g=C,y=I}return d.normalizeZ([g,y])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,E=(I,x)=>x!==Pa&&x!==vs&&I.equals(b)?I.multiply(x):I.multiplyUnsafe(x),C=E(this,g).add(E(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,E=this.is0();m==null&&(m=E?n.ONE:n.inv(b));const C=n.mul(g,m),I=n.mul(y,m),x=n.mul(b,m);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:C,y:I}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===vs)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===vs?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return Sf(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=(function(p,m){const g=(b,E)=>{const C=E.negate();return b?C:E},y=b=>({windows:Math.ceil(m/b)+1,windowSize:2**(b-1)});return{constTimeNegate:g,unsafeLadder(b,E){let C=p.ZERO,I=b;for(;E>$me;)E&W1&&(C=C.add(I)),I=I.double(),E>>=W1;return C},precomputeWindow(b,E){const{windows:C,windowSize:I}=y(E),x=[];let P=b,T=P;for(let S=0;S<C;S++){T=P,x.push(T);for(let _=1;_<I;_++)T=T.add(P),x.push(T);P=T.double()}return x},wNAF(b,E,C){const{windows:I,windowSize:x}=y(b);let P=p.ZERO,T=p.BASE;const S=BigInt(2**b-1),_=2**b,O=BigInt(b);for(let F=0;F<I;F++){const L=F*x;let B=Number(C&S);C>>=O,B>x&&(B-=_,C+=W1);const N=L,M=L+Math.abs(B)-1,R=F%2!=0,H=B<0;B===0?T=T.add(g(R,E[N])):P=P.add(g(H,E[M]))}return{p:P,f:T}},wNAFCached(b,E,C,I){const x=b._WINDOW_SIZE||1;let P=E.get(b);return P||(P=this.precomputeWindow(b,x),x!==1&&E.set(b,I(P))),this.wNAF(x,P,C)}}})(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function Vme(t){const e=(function(S){const _=M6(S);return zp(_,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,..._})})(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(S){return Lr(S,r)}function a(S){return sS(S,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:d}=Hme({...e,toBytes(S,_,O){const F=_.toAffine(),L=n.toBytes(F.x),B=zu;return O?B(Uint8Array.from([_.hasEvenY()?2:3]),L):B(Uint8Array.from([4]),L,n.toBytes(F.y))},fromBytes(S){const _=S.length,O=S[0],F=S.subarray(1);if(_!==i||O!==2&&O!==3){if(_===s&&O===4)return{x:n.fromBytes(F.subarray(0,n.BYTES)),y:n.fromBytes(F.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${_} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const B=zi(F);if(!(Pa<(L=B)&&L<n.ORDER))throw new Error("Point is not on curve");const N=u(B);let M=n.sqrt(N);return!(1&~O)!=((M&vs)===vs)&&(M=n.neg(M)),{x:B,y:M}}var L}}),f=S=>Sf(mc(S,e.nByteLength));function h(S){return S>r>>vs}const p=(S,_,O)=>zi(S.slice(_,O));class m{constructor(_,O,F){this.r=_,this.s=O,this.recovery=F,this.assertValidity()}static fromCompact(_){const O=e.nByteLength;return _=Yr("compactSignature",_,2*O),new m(p(_,0,O),p(_,O,2*O))}static fromDER(_){const{r:O,s:F}=fu.toSig(Yr("DER",_));return new m(O,F)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(_){return new m(this.r,this.s,_)}recoverPublicKey(_){const{r:O,s:F,recovery:L}=this,B=E(Yr("msgHash",_));if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");const N=L===2||L===3?O+e.n:O;if(N>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const M=1&L?"03":"02",R=l.fromHex(M+f(N)),H=a(N),z=o(-B*H),V=o(F*H),Q=l.BASE.multiplyAndAddUnsafe(R,z,V);if(!Q)throw new Error("point at infinify");return Q.assertValidity(),Q}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return $p(this.toDERHex())}toDERHex(){return fu.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return $p(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}const g={isValidPrivateKey(S){try{return c(S),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const S=UP(e.n);return(function(_,O,F=!1){const L=_.length,B=I6(O),N=UP(O);if(L<16||L<N||L>1024)throw new Error(`expected ${N}-1024 bytes of input, got ${L}`);const M=Lr(F?zi(_):_T(_),O-Yn)+Yn;return F?CT(M,B):mc(M,B)})(e.randomBytes(S),e.n)},precompute:(S=8,_=l.BASE)=>(_._setWindowSize(S),_.multiply(BigInt(3)),_)};function y(S){const _=S instanceof Uint8Array,O=typeof S=="string",F=(_||O)&&S.length;return _?F===i||F===s:O?F===2*i||F===2*s:S instanceof l}const b=e.bits2int||function(S){const _=zi(S),O=8*S.length-e.nBitLength;return O>0?_>>BigInt(O):_},E=e.bits2int_modN||function(S){return o(b(S))},C=AT(e.nBitLength);function I(S){if(typeof S!="bigint")throw new Error("bigint expected");if(!(Pa<=S&&S<C))throw new Error(`bigint expected < 2^${e.nBitLength}`);return mc(S,e.nByteLength)}function x(S,_,O=P){if(["recovered","canonical"].some((Y=>Y in O)))throw new Error("sign() legacy options not supported");const{hash:F,randomBytes:L}=e;let{lowS:B,prehash:N,extraEntropy:M}=O;B==null&&(B=!0),S=Yr("msgHash",S),N&&(S=Yr("prehashed msgHash",F(S)));const R=E(S),H=c(_),z=[I(H),I(R)];if(M!=null){const Y=M===!0?L(n.BYTES):M;z.push(Yr("extraEntropy",Y))}const V=zu(...z),Q=R;return{seed:V,k2sig:function(Y){const ie=b(Y);if(!d(ie))return;const ne=a(ie),J=l.BASE.multiply(ie).toAffine(),ke=o(J.x);if(ke===Pa)return;const ze=o(ne*o(Q+ke*H));if(ze===Pa)return;let he=(J.x===ke?0:2)|Number(J.y&vs),Ee=ze;return B&&h(ze)&&(Ee=(function(Le){return h(Le)?o(-Le):Le})(ze),he^=1),new m(ke,Ee,he)}}}const P={lowS:e.lowS,prehash:!1},T={lowS:e.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(S,_=!0){return l.fromPrivateKey(S).toRawBytes(_)},getSharedSecret:function(S,_,O=!0){if(y(S))throw new Error("first arg must be private key");if(!y(_))throw new Error("second arg must be public key");return l.fromHex(_).multiply(c(S)).toRawBytes(O)},sign:function(S,_,O=P){const{seed:F,k2sig:L}=x(S,_,O),B=e;return C6(B.hash.outputLen,B.nByteLength,B.hmac)(F,L)},verify:function(S,_,O,F=T){const L=S;if(_=Yr("msgHash",_),O=Yr("publicKey",O),"strict"in F)throw new Error("options.strict was renamed to lowS");const{lowS:B,prehash:N}=F;let M,R;try{if(typeof L=="string"||L instanceof Uint8Array)try{M=m.fromDER(L)}catch(J){if(!(J instanceof fu.Err))throw J;M=m.fromCompact(L)}else{if(typeof L!="object"||typeof L.r!="bigint"||typeof L.s!="bigint")throw new Error("PARSE");{const{r:J,s:ke}=L;M=new m(J,ke)}}R=l.fromHex(O)}catch(J){if(J.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(B&&M.hasHighS())return!1;N&&(_=e.hash(_));const{r:H,s:z}=M,V=E(_),Q=a(z),Y=o(V*Q),ie=o(H*Q),ne=l.BASE.multiplyAndAddUnsafe(R,Y,ie)?.toAffine();return!!ne&&o(ne.x)===H},ProjectivePoint:l,Signature:m,utils:g}}function Wme(t){return{hash:t,hmac:(e,...n)=>O6(t,e,(function(...r){const i=new Uint8Array(r.reduce(((o,a)=>o+a.length),0));let s=0;return r.forEach((o=>{if(!E6(o))throw new Error("Uint8Array expected");i.set(o,s),s+=o.length})),i})(...n)),randomBytes:T6}}const Jb=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Dy=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),N6=BigInt(1),Ly=BigInt(2),VP=(t,e)=>(t+e/Ly)/e;function R6(t){const e=Jb,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=ms(u,n,e)*u%e,f=ms(d,n,e)*u%e,h=ms(f,Ly,e)*c%e,p=ms(h,i,e)*h%e,m=ms(p,s,e)*p%e,g=ms(m,a,e)*m%e,y=ms(g,l,e)*g%e,b=ms(y,a,e)*m%e,E=ms(b,n,e)*u%e,C=ms(E,o,e)*p%e,I=ms(C,r,e)*c%e,x=ms(I,Ly,e);if(!oS.eql(oS.sqr(x),t))throw new Error("Cannot find square root");return x}const oS=(function(t,e,n=!1,r={}){if(t<=yr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=A6(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=Bme(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:AT(i),ZERO:yr,ONE:Yn,create:l=>Lr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("Invalid field element: expected bigint, got "+typeof l);return yr<=l&&l<t},is0:l=>l===yr,isOdd:l=>(l&Yn)===Yn,neg:l=>Lr(-l,t),eql:(l,c)=>l===c,sqr:l=>Lr(l*l,t),add:(l,c)=>Lr(l+c,t),sub:(l,c)=>Lr(l-c,t),mul:(l,c)=>Lr(l*c,t),pow:(l,c)=>(function(u,d,f){if(f<yr)throw new Error("Expected power > 0");if(f===yr)return u.ONE;if(f===Yn)return d;let h=u.ONE,p=d;for(;f>yr;)f&Yn&&(h=u.mul(h,p)),p=u.sqr(p),f>>=Yn;return h})(a,l,c),div:(l,c)=>Lr(l*sS(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>sS(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>(function(c,u){const d=new Array(u.length),f=u.reduce(((p,m,g)=>c.is0(m)?p:(d[g]=p,c.mul(p,m))),c.ONE),h=c.inv(f);return u.reduceRight(((p,m,g)=>c.is0(m)?p:(d[g]=c.mul(p,d[g]),c.mul(p,m))),h),d})(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?CT(l,s):mc(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?_T(l):zi(l)}});return Object.freeze(a)})(Jb,void 0,void 0,{sqrt:R6}),Hf=(function(t,e){const n=r=>Vme({...t,...Wme(r)});return Object.freeze({...n(e),create:n})})({a:BigInt(0),b:BigInt(7),Fp:oS,n:Dy,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Dy,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-N6*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=VP(s*t,e),l=VP(-r*t,e);let c=Lr(t-a*n-l*i,e),u=Lr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},iS),ew=BigInt(0),D6=t=>typeof t=="bigint"&&ew<t&&t<Jb,WP={};function By(t,...e){let n=WP[t];if(n===void 0){const r=iS(Uint8Array.from(t,(i=>i.charCodeAt(0))));n=zu(r,r),WP[t]=n}return iS(zu(n,...e))}const IT=t=>t.toRawBytes(!0).slice(1),aS=t=>mc(t,32),j1=t=>Lr(t,Jb),Up=t=>Lr(t,Dy),PT=Hf.ProjectivePoint;function lS(t){let e=Hf.utils.normPrivateKeyToScalar(t),n=PT.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Up(-e),bytes:IT(n)}}function L6(t){if(!D6(t))throw new Error("bad x: need 0 < x < p");const e=j1(t*t);let n=R6(j1(e*t+BigInt(7)));n%Ly!==ew&&(n=j1(-n));const r=new PT(t,n,N6);return r.assertValidity(),r}function B6(...t){return Up(zi(By("BIP0340/challenge",...t)))}function jme(t){return lS(t).bytes}function qme(t,e,n=T6(32)){const r=Yr("message",t),{bytes:i,scalar:s}=lS(e),o=Yr("auxRand",n,32),a=aS(s^zi(By("BIP0340/aux",o))),l=By("BIP0340/nonce",a,i,r),c=Up(zi(l));if(c===ew)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=lS(c),f=B6(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(aS(Up(d+f*s)),32),!F6(h,r,i))throw new Error("sign: Invalid signature produced");return h}function F6(t,e,n){const r=Yr("signature",t,64),i=Yr("message",e),s=Yr("publicKey",n,32);try{const u=L6(zi(s)),d=zi(r.subarray(0,32));if(!D6(d))return!1;const f=zi(r.subarray(32,64));if(!(typeof(c=f)=="bigint"&&ew<c&&c<Dy))return!1;const h=B6(aS(d),IT(u),i),p=(o=u,a=f,l=Up(-h),PT.BASE.multiplyAndAddUnsafe(o,a,l));return!(!p||!p.hasEvenY()||p.toAffine().x!==d)}catch{return!1}var o,a,l,c}const Po={getPublicKey:jme,sign:qme,verify:F6,utils:{randomPrivateKey:Hf.utils.randomPrivateKey,lift_x:L6,pointToBytes:IT,numberToBytesBE:mc,bytesToNumberBE:zi,taggedHash:By,mod:Lr}},q1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,OT=t=>t instanceof Uint8Array,K1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),vo=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");const Kme=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function fr(t){if(!OT(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Kme[t[n]];return e}function Ef(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Hp(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!OT(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function tw(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!OT(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}class $6{clone(){return this._cloneInto()}}function z6(t){const e=r=>t().update(Hp(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function U6(t=32){if(q1&&typeof q1.getRandomValues=="function")return q1.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function G1(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function jP(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const Gme={number:G1,bool:function(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)},bytes:jP,hash:function(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");G1(t.outputLen),G1(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){jP(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},Bo=Gme;class Zme extends $6{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=K1(this.buffer)}update(e){Bo.exists(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=Hp(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=K1(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Bo.exists(this),Bo.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;(function(d,f,h,p){if(typeof d.setBigUint64=="function")return d.setBigUint64(f,h,p);const m=BigInt(32),g=BigInt(4294967295),y=Number(h>>m&g),b=Number(h&g),E=p?4:0,C=p?0:4;d.setUint32(f+E,y,p),d.setUint32(f+C,b,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=K1(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const Qme=(t,e,n)=>t&e^t&n^e&n,Xme=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ol=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ml=new Uint32Array(64);class H6 extends Zme{constructor(){super(64,32,8,!1),this.A=0|Ol[0],this.B=0|Ol[1],this.C=0|Ol[2],this.D=0|Ol[3],this.E=0|Ol[4],this.F=0|Ol[5],this.G=0|Ol[6],this.H=0|Ol[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let f=0;f<16;f++,n+=4)Ml[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Ml[f-15],p=Ml[f-2],m=vo(h,7)^vo(h,18)^h>>>3,g=vo(p,17)^vo(p,19)^p>>>10;Ml[f]=g+Ml[f-7]+m+Ml[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=u+(vo(a,6)^vo(a,11)^vo(a,25))+((d=a)&l^~d&c)+Xme[f]+Ml[f]|0,p=(vo(r,2)^vo(r,13)^vo(r,22))+Qme(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var d;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Ml.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Yme extends H6{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Gu=z6((()=>new H6));z6((()=>new Yme));function Vf(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Va(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce(((i,s)=>i?e(i,s.encode):s.encode),void 0),r=t.reduce(((i,s)=>i?e(i,s.decode):s.decode),void 0);return{encode:n,decode:r}}function Wa(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map((n=>{if(Vf(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]}))},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map((n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r}))}}}function ja(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function Fy(t,e="="){if(Vf(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function V6(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function qP(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((o=>{if(Vf(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)}));;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!=e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");a&&(s[l]?a=!1:r=l)}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const W6=(t,e)=>e?W6(e,t%e):t,$y=(t,e)=>t+(e-W6(t,e));function cS(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if($y(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${$y(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(Vf(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function Jme(t){return Vf(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return qP(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(qP(e,t,256))}}}function gc(t,e=!1){if(Vf(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if($y(8,t)>32||$y(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return cS(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(cS(n,t,8,e))}}}function KP(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}Va(gc(4),Wa("0123456789ABCDEF"),ja(""));Va(gc(5),Wa("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Fy(5),ja(""));const _c=(Va(gc(5),Wa("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Fy(5),ja("")),Va(gc(5),Wa("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ja(""),V6((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),Va(gc(6),Wa("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Fy(6),ja("")));Va(gc(6),Wa("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Fy(6),ja(""));const uS=t=>Va(Jme(58),Wa(t),ja(""));uS("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");uS("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),uS("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const dS=Va(Wa("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ja("")),GP=[996825010,642813549,513874426,1027748829,705979059];function Ch(t){const e=t>>25;let n=(33554431&t)<<5;for(let r=0;r<GP.length;r++)(e>>r&1)==1&&(n^=GP[r]);return n}function ZP(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Ch(i)^o>>5}i=Ch(i);for(let s=0;s<r;s++)i=Ch(i)^31&t.charCodeAt(s);for(let s of e)i=Ch(i)^s;for(let s=0;s<6;s++)i=Ch(i);return i^=n,dS.encode(cS([i%2**30],30,5,!1))}function j6(t){const e=t==="bech32"?1:734539939,n=gc(5),r=n.decode,i=n.encode,s=KP(r);function o(a,l=90){if(typeof a!="string")throw new Error("bech32.decode input should be string, not "+typeof a);if(a.length<8||l!==!1&&a.length>l)throw new TypeError(`Wrong string length: ${a.length} (${a}). Expected (8..${l})`);const c=a.toLowerCase();if(a!==c&&a!==a.toUpperCase())throw new Error("String must be lowercase or uppercase");const u=(a=c).lastIndexOf("1");if(u===0||u===-1)throw new Error('Letter "1" must be present between prefix and data only');const d=a.slice(0,u),f=a.slice(u+1);if(f.length<6)throw new Error("Data must be at least 6 characters long");const h=dS.decode(f).slice(0,-6),p=ZP(d,h,e);if(!f.endsWith(p))throw new Error(`Invalid checksum in ${a}: expected "${p}"`);return{prefix:d,words:h}}return{encode:function(a,l,c=90){if(typeof a!="string")throw new Error("bech32.encode prefix should be string, not "+typeof a);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof l);const u=a.length+7+l.length;if(c!==!1&&u>c)throw new TypeError(`Length ${u} exceeds limit ${c}`);return`${a=a.toLowerCase()}1${dS.encode(l)}${ZP(a,l,e)}`},decode:o,decodeToBytes:function(a){const{prefix:l,words:c}=o(a,!1);return{prefix:l,words:c,bytes:r(c)}},decodeUnsafe:KP(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const kf=j6("bech32");j6("bech32m");Va(gc(4),Wa("0123456789abcdef"),ja(""),V6((t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));function Z1(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function QP(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function q6(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function wn(t,...e){if(!q6(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Tf(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function MT(t,e){wn(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const NT=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),Ht=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),nw=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function Cc(t){if(typeof t=="string")t=(function(e){if(typeof e!="string")throw new Error("string expected, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t);else{if(!q6(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function RT(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const Wf=(t,e)=>(Object.assign(e,t),e);function fS(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const Ta=16,DT=new Uint8Array(16),Oo=Ht(DT),xs=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class K6{constructor(e,n){this.blockLen=Ta,this.outputLen=Ta,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,wn(e=Cc(e),16);const r=nw(e);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const l=[];for(let y=0;y<128;y++)l.push({s0:xs(i),s1:xs(s),s2:xs(o),s3:xs(a)}),{s0:i,s1:s,s2:o,s3:a}={s3:(d=o)<<31|(f=a)>>>1,s2:(u=s)<<31|d>>>1,s1:(c=i)<<31|u>>>1,s0:c>>>1^225<<24&-(1&f)};var c,u,d,f;const h=(y=>y>65536?8:y>1024?4:2)(n||1024);if(![1,2,4,8].includes(h))throw new Error(`ghash: wrong window size=${h}, should be 2, 4 or 8`);this.W=h;const p=128/h,m=this.windowSize=2**h,g=[];for(let y=0;y<p;y++)for(let b=0;b<m;b++){let E=0,C=0,I=0,x=0;for(let P=0;P<h;P++){if(!(b>>>h-P-1&1))continue;const{s0:T,s1:S,s2:_,s3:O}=l[h*y+P];E^=T,C^=S,I^=_,x^=O}g.push({s0:E,s1:C,s2:I,s3:x})}this.t=g}_updateBlock(e,n,r,i){e^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let l=0,c=0,u=0,d=0;const f=(1<<s)-1;let h=0;for(const p of[e,n,r,i])for(let m=0;m<4;m++){const g=p>>>8*m&255;for(let y=8/s-1;y>=0;y--){const b=g>>>s*y&f,{s0:E,s1:C,s2:I,s3:x}=o[h*a+b];l^=E,c^=C,u^=I,d^=x,h+=1}}this.s0=l,this.s1=c,this.s2=u,this.s3=d}update(e){e=Cc(e),Tf(this);const n=Ht(e),r=Math.floor(e.length/Ta),i=e.length%Ta;for(let s=0;s<r;s++)this._updateBlock(n[4*s+0],n[4*s+1],n[4*s+2],n[4*s+3]);return i&&(DT.set(e.subarray(r*Ta)),this._updateBlock(Oo[0],Oo[1],Oo[2],Oo[3]),Oo.fill(0)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){Tf(this),MT(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Ht(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e}digest(){const e=new Uint8Array(Ta);return this.digestInto(e),this.destroy(),e}}class ege extends K6{constructor(e,n){const r=(function(i){i.reverse();const s=1&i[15];let o=0;for(let a=0;a<i.length;a++){const l=i[a];i[a]=l>>>1|o,o=(1&l)<<7}return i[0]^=225&-s,i})((e=Cc(e)).slice());super(r,n),r.fill(0)}update(e){e=Cc(e),Tf(this);const n=Ht(e),r=e.length%Ta,i=Math.floor(e.length/Ta);for(let s=0;s<i;s++)this._updateBlock(xs(n[4*s+3]),xs(n[4*s+2]),xs(n[4*s+1]),xs(n[4*s+0]));return r&&(DT.set(e.subarray(i*Ta)),this._updateBlock(xs(Oo[3]),xs(Oo[2]),xs(Oo[1]),xs(Oo[0])),Oo.fill(0)),this}digestInto(e){Tf(this),MT(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Ht(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e.reverse()}}function G6(t){const e=(r,i)=>t(i,r.length).update(Cc(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,i)=>t(r,i),e}const XP=G6(((t,e)=>new K6(t,e))),tge=G6(((t,e)=>new ege(t,e))),ji=16,pg=new Uint8Array(ji);function LT(t){return t<<1^283&-(t>>7)}function Pd(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=LT(t);return n}const hS=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=LT(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),nge=hS.map(((t,e)=>hS.indexOf(e))),Q1=t=>t<<8|t>>>24;function Z6(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((c,u)=>e(t[u]))),r=n.map(Q1),i=r.map(Q1),s=i.map(Q1),o=new Uint32Array(65536),a=new Uint32Array(65536),l=new Uint16Array(65536);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const d=256*c+u;o[d]=n[c]^r[u],a[d]=i[c]^s[u],l[d]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const BT=Z6(hS,(t=>Pd(t,3)<<24|t<<16|t<<8|Pd(t,2))),Q6=Z6(nge,(t=>Pd(t,11)<<24|Pd(t,13)<<16|Pd(t,9)<<8|Pd(t,14))),rge=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=LT(n))t[e]=n;return t})();function Ac(t){wn(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=BT,r=Ht(t),i=r.length,s=l=>Fo(n,l,l,l,l),o=new Uint32Array(e+28);o.set(r);for(let l=i;l<o.length;l++){let c=o[l-1];l%i==0?c=s((a=c)<<24|a>>>8)^rge[l/i-1]:i>6&&l%i==4&&(c=s(c)),o[l]=o[l-i]^c}var a;return o}function X6(t){const e=Ac(t),n=e.slice(),r=e.length,{sbox2:i}=BT,{T0:s,T1:o,T2:a,T3:l}=Q6;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],d=Fo(i,u,u,u,u);n[c]=s[255&d]^o[d>>>8&255]^a[d>>>16&255]^l[d>>>24]}return n}function nc(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function Fo(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function Ds(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=BT;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const d=t[l++]^nc(o,a,e,n,r,i),f=t[l++]^nc(o,a,n,r,i,e),h=t[l++]^nc(o,a,r,i,e,n),p=t[l++]^nc(o,a,i,e,n,r);e=d,n=f,r=h,i=p}return{s0:t[l++]^Fo(s,e,n,r,i),s1:t[l++]^Fo(s,n,r,i,e),s2:t[l++]^Fo(s,r,i,e,n),s3:t[l++]^Fo(s,i,e,n,r)}}function Y6(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=Q6;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const d=t[l++]^nc(o,a,e,i,r,n),f=t[l++]^nc(o,a,n,e,i,r),h=t[l++]^nc(o,a,r,n,e,i),p=t[l++]^nc(o,a,i,r,n,e);e=d,n=f,r=h,i=p}return{s0:t[l++]^Fo(s,e,i,r,n),s1:t[l++]^Fo(s,n,e,i,r),s2:t[l++]^Fo(s,r,n,e,i),s3:t[l++]^Fo(s,i,r,n,e)}}function jf(t,e){if(!e)return new Uint8Array(t);if(wn(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function ige(t,e,n,r){wn(e,ji),wn(n);const i=n.length;r=jf(i,r);const s=e,o=Ht(s);let{s0:a,s1:l,s2:c,s3:u}=Ds(t,o[0],o[1],o[2],o[3]);const d=Ht(n),f=Ht(r);for(let p=0;p+4<=d.length;p+=4){f[p+0]=d[p+0]^a,f[p+1]=d[p+1]^l,f[p+2]=d[p+2]^c,f[p+3]=d[p+3]^u;let m=1;for(let g=s.length-1;g>=0;g--)m=m+(255&s[g])|0,s[g]=255&m,m>>>=8;({s0:a,s1:l,s2:c,s3:u}=Ds(t,o[0],o[1],o[2],o[3]))}const h=ji*Math.floor(d.length/4);if(h<i){const p=new Uint32Array([a,l,c,u]),m=NT(p);for(let g=h,y=0;g<i;g++,y++)r[g]=n[g]^m[y]}return r}function Fh(t,e,n,r,i){wn(n,ji),wn(r),i=jf(r.length,i);const s=n,o=Ht(s),a=nw(s),l=Ht(r),c=Ht(i),u=e?0:12,d=r.length;let f=a.getUint32(u,e),{s0:h,s1:p,s2:m,s3:g}=Ds(t,o[0],o[1],o[2],o[3]);for(let b=0;b+4<=l.length;b+=4)c[b+0]=l[b+0]^h,c[b+1]=l[b+1]^p,c[b+2]=l[b+2]^m,c[b+3]=l[b+3]^g,f=f+1>>>0,a.setUint32(u,f,e),{s0:h,s1:p,s2:m,s3:g}=Ds(t,o[0],o[1],o[2],o[3]);const y=ji*Math.floor(l.length/4);if(y<d){const b=new Uint32Array([h,p,m,g]),E=NT(b);for(let C=y,I=0;C<d;C++,I++)i[C]=r[C]^E[I]}return i}Wf({blockSize:16,nonceLength:16},(function(t,e){function n(r,i){const s=Ac(t),o=e.slice(),a=ige(s,o,r,i);return s.fill(0),o.fill(0),a}return wn(t),wn(e,ji),{encrypt:(r,i)=>n(r,i),decrypt:(r,i)=>n(r,i)}}));function J6(t){if(wn(t),t.length%ji!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function eB(t,e,n){let r=t.length;const i=r%ji;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=Ht(t);if(e){let a=ji-i;a||(a=ji),r+=a}const o=jf(r,n);return{b:s,o:Ht(o),out:o}}function tB(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function nB(t){const e=new Uint8Array(16),n=Ht(e);e.set(t);const r=ji-t.length;for(let i=ji-r;i<ji;i++)e[i]=r;return n}Wf({blockSize:16},(function(t,e={}){wn(t);const n=!e.disablePadding;return{encrypt:(r,i)=>{wn(r);const{b:s,o,out:a}=eB(r,n,i),l=Ac(t);let c=0;for(;c+4<=s.length;){const{s0:u,s1:d,s2:f,s3:h}=Ds(l,s[c+0],s[c+1],s[c+2],s[c+3]);o[c++]=u,o[c++]=d,o[c++]=f,o[c++]=h}if(n){const u=nB(r.subarray(4*c)),{s0:d,s1:f,s2:h,s3:p}=Ds(l,u[0],u[1],u[2],u[3]);o[c++]=d,o[c++]=f,o[c++]=h,o[c++]=p}return l.fill(0),a},decrypt:(r,i)=>{J6(r);const s=X6(t),o=jf(r.length,i),a=Ht(r),l=Ht(o);for(let c=0;c+4<=a.length;){const{s0:u,s1:d,s2:f,s3:h}=Y6(s,a[c+0],a[c+1],a[c+2],a[c+3]);l[c++]=u,l[c++]=d,l[c++]=f,l[c++]=h}return s.fill(0),tB(o,n)}}}));const rB=Wf({blockSize:16,nonceLength:16},(function(t,e,n={}){wn(t),wn(e,16);const r=!n.disablePadding;return{encrypt:(i,s)=>{const o=Ac(t),{b:a,o:l,out:c}=eB(i,r,s),u=Ht(e);let d=u[0],f=u[1],h=u[2],p=u[3],m=0;for(;m+4<=a.length;)d^=a[m+0],f^=a[m+1],h^=a[m+2],p^=a[m+3],{s0:d,s1:f,s2:h,s3:p}=Ds(o,d,f,h,p),l[m++]=d,l[m++]=f,l[m++]=h,l[m++]=p;if(r){const g=nB(i.subarray(4*m));d^=g[0],f^=g[1],h^=g[2],p^=g[3],{s0:d,s1:f,s2:h,s3:p}=Ds(o,d,f,h,p),l[m++]=d,l[m++]=f,l[m++]=h,l[m++]=p}return o.fill(0),c},decrypt:(i,s)=>{J6(i);const o=X6(t),a=Ht(e),l=jf(i.length,s),c=Ht(i),u=Ht(l);let d=a[0],f=a[1],h=a[2],p=a[3];for(let m=0;m+4<=c.length;){const g=d,y=f,b=h,E=p;d=c[m+0],f=c[m+1],h=c[m+2],p=c[m+3];const{s0:C,s1:I,s2:x,s3:P}=Y6(o,d,f,h,p);u[m++]=C^g,u[m++]=I^y,u[m++]=x^b,u[m++]=P^E}return o.fill(0),tB(l,r)}}}));Wf({blockSize:16,nonceLength:16},(function(t,e){function n(r,i,s){const o=Ac(t),a=r.length;s=jf(a,s);const l=Ht(r),c=Ht(s),u=i?c:l,d=Ht(e);let f=d[0],h=d[1],p=d[2],m=d[3];for(let y=0;y+4<=l.length;){const{s0:b,s1:E,s2:C,s3:I}=Ds(o,f,h,p,m);c[y+0]=l[y+0]^b,c[y+1]=l[y+1]^E,c[y+2]=l[y+2]^C,c[y+3]=l[y+3]^I,f=u[y++],h=u[y++],p=u[y++],m=u[y++]}const g=ji*Math.floor(l.length/4);if(g<a){({s0:f,s1:h,s2:p,s3:m}=Ds(o,f,h,p,m));const y=NT(new Uint32Array([f,h,p,m]));for(let b=g,E=0;b<a;b++,E++)s[b]=r[b]^y[E];y.fill(0)}return o.fill(0),s}return wn(t),wn(e,16),{encrypt:(r,i)=>n(r,!0,i),decrypt:(r,i)=>n(r,!1,i)}}));function iB(t,e,n,r,i){const s=t.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=nw(o);return i&&fS(a,0,BigInt(8*i.length),e),fS(a,8,BigInt(8*r.length),e),s.update(o),s.digest()}Wf({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(wn(e),e.length===0)throw new Error("aes/gcm: empty nonce");const r=16;function i(o,a,l){const c=iB(XP,!1,o,l,n);for(let u=0;u<a.length;u++)c[u]^=a[u];return c}function s(){const o=Ac(t),a=pg.slice(),l=pg.slice();if(Fh(o,!1,l,l,a),e.length===12)l.set(e);else{const c=pg.slice();fS(nw(c),8,BigInt(8*e.length),!1),XP.create(a).update(e).update(c).digestInto(l)}return{xk:o,authKey:a,counter:l,tagMask:Fh(o,!1,l,pg)}}return{encrypt:o=>{wn(o);const{xk:a,authKey:l,counter:c,tagMask:u}=s(),d=new Uint8Array(o.length+r);Fh(a,!1,c,o,d);const f=i(l,u,d.subarray(0,d.length-r));return d.set(f,o.length),a.fill(0),d},decrypt:o=>{if(wn(o),o.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:a,authKey:l,counter:c,tagMask:u}=s(),d=o.subarray(0,-16),f=o.subarray(-16);if(!RT(i(l,u,d),f))throw new Error("aes/gcm: invalid ghash tag");const h=Fh(a,!1,c,d);return l.fill(0),u.fill(0),a.fill(0),h}}}));const mg=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};Wf({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=mg("AAD",0,68719476736),i=mg("plaintext",0,2**36),s=mg("nonce",12,12),o=mg("ciphertext",16,2**36+16);function a(){const u=t.length;if(u!==16&&u!==24&&u!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${u} bytes`);const d=Ac(t),f=new Uint8Array(u),h=new Uint8Array(16),p=Ht(e);let m=0,g=p[0],y=p[1],b=p[2],E=0;for(const C of[h,f].map(Ht)){const I=Ht(C);for(let x=0;x<I.length;x+=2){const{s0:P,s1:T}=Ds(d,m,g,y,b);I[x+0]=P,I[x+1]=T,m=++E}}return d.fill(0),{authKey:h,encKey:Ac(f)}}function l(u,d,f){const h=iB(tge,!0,d,f,n);for(let E=0;E<12;E++)h[E]^=e[E];h[15]&=127;const p=Ht(h);let m=p[0],g=p[1],y=p[2],b=p[3];return{s0:m,s1:g,s2:y,s3:b}=Ds(u,m,g,y,b),p[0]=m,p[1]=g,p[2]=y,p[3]=b,h}function c(u,d,f){let h=d.slice();return h[15]|=128,Fh(u,!0,h,f)}return wn(e),s(e.length),n&&(wn(n),r(n.length)),{encrypt:u=>{wn(u),i(u.length);const{encKey:d,authKey:f}=a(),h=l(d,f,u),p=new Uint8Array(u.length+16);return p.set(h,u.length),p.set(c(d,h,u)),d.fill(0),f.fill(0),p},decrypt:u=>{wn(u),o(u.length);const d=u.subarray(-16),{encKey:f,authKey:h}=a(),p=c(f,d,u.subarray(0,-16)),m=l(f,h,p);if(f.fill(0),h.fill(0),!RT(d,m))throw new Error("invalid polyval tag");return p}}}));const Ar=(t,e)=>255&t[e++]|(255&t[e++])<<8;class sge{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,wn(e=Cc(e),32);const n=Ar(e,0),r=Ar(e,2),i=Ar(e,4),s=Ar(e,6),o=Ar(e,8),a=Ar(e,10),l=Ar(e,12),c=Ar(e,14);this.r[0]=8191&n,this.r[1]=8191&(n>>>13|r<<3),this.r[2]=7939&(r>>>10|i<<6),this.r[3]=8191&(i>>>7|s<<9),this.r[4]=255&(s>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|a<<2),this.r[7]=8065&(a>>>11|l<<5),this.r[8]=8191&(l>>>8|c<<8),this.r[9]=c>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Ar(e,16+2*u)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],l=o[1],c=o[2],u=o[3],d=o[4],f=o[5],h=o[6],p=o[7],m=o[8],g=o[9],y=Ar(e,n+0),b=Ar(e,n+2),E=Ar(e,n+4),C=Ar(e,n+6),I=Ar(e,n+8),x=Ar(e,n+10),P=Ar(e,n+12),T=Ar(e,n+14);let S=s[0]+(8191&y),_=s[1]+(8191&(y>>>13|b<<3)),O=s[2]+(8191&(b>>>10|E<<6)),F=s[3]+(8191&(E>>>7|C<<9)),L=s[4]+(8191&(C>>>4|I<<12)),B=s[5]+(I>>>1&8191),N=s[6]+(8191&(I>>>14|x<<2)),M=s[7]+(8191&(x>>>11|P<<5)),R=s[8]+(8191&(P>>>8|T<<8)),H=s[9]+(T>>>5|i),z=0,V=z+S*a+_*(5*g)+O*(5*m)+F*(5*p)+L*(5*h);z=V>>>13,V&=8191,V+=B*(5*f)+N*(5*d)+M*(5*u)+R*(5*c)+H*(5*l),z+=V>>>13,V&=8191;let Q=z+S*l+_*a+O*(5*g)+F*(5*m)+L*(5*p);z=Q>>>13,Q&=8191,Q+=B*(5*h)+N*(5*f)+M*(5*d)+R*(5*u)+H*(5*c),z+=Q>>>13,Q&=8191;let Y=z+S*c+_*l+O*a+F*(5*g)+L*(5*m);z=Y>>>13,Y&=8191,Y+=B*(5*p)+N*(5*h)+M*(5*f)+R*(5*d)+H*(5*u),z+=Y>>>13,Y&=8191;let ie=z+S*u+_*c+O*l+F*a+L*(5*g);z=ie>>>13,ie&=8191,ie+=B*(5*m)+N*(5*p)+M*(5*h)+R*(5*f)+H*(5*d),z+=ie>>>13,ie&=8191;let ne=z+S*d+_*u+O*c+F*l+L*a;z=ne>>>13,ne&=8191,ne+=B*(5*g)+N*(5*m)+M*(5*p)+R*(5*h)+H*(5*f),z+=ne>>>13,ne&=8191;let J=z+S*f+_*d+O*u+F*c+L*l;z=J>>>13,J&=8191,J+=B*a+N*(5*g)+M*(5*m)+R*(5*p)+H*(5*h),z+=J>>>13,J&=8191;let ke=z+S*h+_*f+O*d+F*u+L*c;z=ke>>>13,ke&=8191,ke+=B*l+N*a+M*(5*g)+R*(5*m)+H*(5*p),z+=ke>>>13,ke&=8191;let ze=z+S*p+_*h+O*f+F*d+L*u;z=ze>>>13,ze&=8191,ze+=B*c+N*l+M*a+R*(5*g)+H*(5*m),z+=ze>>>13,ze&=8191;let he=z+S*m+_*p+O*h+F*f+L*d;z=he>>>13,he&=8191,he+=B*u+N*c+M*l+R*a+H*(5*g),z+=he>>>13,he&=8191;let Ee=z+S*g+_*m+O*p+F*h+L*f;z=Ee>>>13,Ee&=8191,Ee+=B*d+N*u+M*c+R*l+H*a,z+=Ee>>>13,Ee&=8191,z=(z<<2)+z|0,z=z+V|0,V=8191&z,z>>>=13,Q+=z,s[0]=V,s[1]=Q,s[2]=Y,s[3]=ie,s[4]=ne,s[5]=J,s[6]=ke,s[7]=ze,s[8]=he,s[9]=Ee}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(1^i)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+n[0];e[0]=65535&o;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=65535&o}update(e){Tf(this);const{buffer:n,blockLen:r}=this,i=(e=Cc(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0);else for(;r<=i-s;s+=r)this.process(e,s)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){Tf(this),MT(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}(function(t){const e=(r,i)=>t(i).update(Cc(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e})((t=>new sge(t)));const sB=t=>Uint8Array.from(t.split("").map((e=>e.charCodeAt(0)))),oge=sB("expand 16-byte k"),age=sB("expand 32-byte k"),lge=Ht(oge),oB=Ht(age);oB.slice();function ot(t,e){return t<<e|t>>>32-e}function X1(t){return t.byteOffset%4==0}const YP=2**32-1,JP=new Uint32Array;function aB(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=(function(a,l){if(l==null||typeof l!="object")throw new Error("options must be defined");return Object.assign(a,l)})({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Z1(i),Z1(o),QP(s),QP(n),(a,l,c,u,d=0)=>{wn(a),wn(l),wn(c);const f=c.length;if(u||(u=new Uint8Array(f)),wn(u),Z1(d),d<0||d>=YP)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const h=[];let p,m,g=a.length;if(g===32)p=a.slice(),h.push(p),m=oB;else{if(g!==16||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);p=new Uint8Array(32),p.set(a),p.set(a,16),m=lge,h.push(p)}X1(l)||(l=l.slice(),h.push(l));const y=Ht(p);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,y,Ht(l.subarray(0,16)),y),l=l.subarray(16)}const b=16-i;if(b!==l.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const C=new Uint8Array(12);C.set(l,s?0:12-l.length),l=C,h.push(l)}const E=Ht(l);for(!(function(C,I,x,P,T,S,_,O){const F=T.length,L=new Uint8Array(64),B=Ht(L),N=X1(T)&&X1(S),M=N?Ht(T):JP,R=N?Ht(S):JP;for(let H=0;H<F;_++){if(C(I,x,P,B,_,O),_>=YP)throw new Error("arx: counter overflow");const z=Math.min(64,F-H);if(N&&z===64){const V=H/4;if(H%4!=0)throw new Error("arx: invalid block position");for(let Q,Y=0;Y<16;Y++)Q=V+Y,R[Q]=M[Q]^B[Y];H+=64}else{for(let V,Q=0;Q<z;Q++)V=H+Q,S[V]=T[V]^L[Q];H+=z}}})(t,m,y,E,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function lB(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],d=e[1],f=e[2],h=e[3],p=e[4],m=e[5],g=e[6],y=e[7],b=i,E=n[0],C=n[1],I=n[2],x=o,P=a,T=l,S=c,_=u,O=d,F=f,L=h,B=p,N=m,M=g,R=y,H=b,z=E,V=C,Q=I;for(let ie=0;ie<s;ie+=2)x=x+_|0,H=ot(H^x,16),B=B+H|0,_=ot(_^B,12),x=x+_|0,H=ot(H^x,8),B=B+H|0,_=ot(_^B,7),P=P+O|0,z=ot(z^P,16),N=N+z|0,O=ot(O^N,12),P=P+O|0,z=ot(z^P,8),N=N+z|0,O=ot(O^N,7),T=T+F|0,V=ot(V^T,16),M=M+V|0,F=ot(F^M,12),T=T+F|0,V=ot(V^T,8),M=M+V|0,F=ot(F^M,7),S=S+L|0,Q=ot(Q^S,16),R=R+Q|0,L=ot(L^R,12),S=S+L|0,Q=ot(Q^S,8),R=R+Q|0,L=ot(L^R,7),x=x+O|0,Q=ot(Q^x,16),M=M+Q|0,O=ot(O^M,12),x=x+O|0,Q=ot(Q^x,8),M=M+Q|0,O=ot(O^M,7),P=P+F|0,H=ot(H^P,16),R=R+H|0,F=ot(F^R,12),P=P+F|0,H=ot(H^P,8),R=R+H|0,F=ot(F^R,7),T=T+L|0,z=ot(z^T,16),B=B+z|0,L=ot(L^B,12),T=T+L|0,z=ot(z^T,8),B=B+z|0,L=ot(L^B,7),S=S+_|0,V=ot(V^S,16),N=N+V|0,_=ot(_^N,12),S=S+_|0,V=ot(V^S,8),N=N+V|0,_=ot(_^N,7);let Y=0;r[Y++]=o+x|0,r[Y++]=a+P|0,r[Y++]=l+T|0,r[Y++]=c+S|0,r[Y++]=u+_|0,r[Y++]=d+O|0,r[Y++]=f+F|0,r[Y++]=h+L|0,r[Y++]=p+B|0,r[Y++]=m+N|0,r[Y++]=g+M|0,r[Y++]=y+R|0,r[Y++]=b+H|0,r[Y++]=E+z|0,r[Y++]=C+V|0,r[Y++]=I+Q|0}const cB=aB(lB,{counterRight:!1,counterLength:4,allowShortKeys:!1});aB(lB,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let i=t[0],s=t[1],o=t[2],a=t[3],l=e[0],c=e[1],u=e[2],d=e[3],f=e[4],h=e[5],p=e[6],m=e[7],g=n[0],y=n[1],b=n[2],E=n[3];for(let I=0;I<20;I+=2)i=i+l|0,g=ot(g^i,16),f=f+g|0,l=ot(l^f,12),i=i+l|0,g=ot(g^i,8),f=f+g|0,l=ot(l^f,7),s=s+c|0,y=ot(y^s,16),h=h+y|0,c=ot(c^h,12),s=s+c|0,y=ot(y^s,8),h=h+y|0,c=ot(c^h,7),o=o+u|0,b=ot(b^o,16),p=p+b|0,u=ot(u^p,12),o=o+u|0,b=ot(b^o,8),p=p+b|0,u=ot(u^p,7),a=a+d|0,E=ot(E^a,16),m=m+E|0,d=ot(d^m,12),a=a+d|0,E=ot(E^a,8),m=m+E|0,d=ot(d^m,7),i=i+c|0,E=ot(E^i,16),p=p+E|0,c=ot(c^p,12),i=i+c|0,E=ot(E^i,8),p=p+E|0,c=ot(c^p,7),s=s+u|0,g=ot(g^s,16),m=m+g|0,u=ot(u^m,12),s=s+u|0,g=ot(g^s,8),m=m+g|0,u=ot(u^m,7),o=o+d|0,y=ot(y^o,16),f=f+y|0,d=ot(d^f,12),o=o+d|0,y=ot(y^o,8),f=f+y|0,d=ot(d^f,7),a=a+l|0,b=ot(b^a,16),h=h+b|0,l=ot(l^h,12),a=a+l|0,b=ot(b^a,8),h=h+b|0,l=ot(l^h,7);let C=0;r[C++]=i,r[C++]=s,r[C++]=o,r[C++]=a,r[C++]=g,r[C++]=y,r[C++]=b,r[C++]=E},allowShortKeys:!1});class uB extends $6{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Bo.hash(e);const r=Hp(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Bo.exists(this),this.iHash.update(e),this}digestInto(e){Bo.exists(this),Bo.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const rw=(t,e,n)=>new uB(t,e).update(n).digest();function cge(t,e,n){return Bo.hash(t),rw(t,Hp(n),Hp(e))}rw.create=(t,e)=>new uB(t,e);const Y1=new Uint8Array([0]),eO=new Uint8Array;function uge(t,e,n,r=32){if(Bo.hash(t),Bo.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=eO);const s=new Uint8Array(i*t.outputLen),o=rw.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)Y1[0]=c+1,a.update(c===0?eO:l).update(n).update(Y1).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),Y1.fill(0),s.slice(0,r)}var dge=Object.defineProperty,Zn=(t,e)=>{for(var n in e)dge(t,n,{get:e[n],enumerable:!0})},Ul=Symbol("verified"),fge=t=>t instanceof Object;function iw(t){if(!fge(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function hge(t){return t.sort(((e,n)=>e.created_at!==n.created_at?n.created_at-e.created_at:e.id.localeCompare(n.id)))}var dB={};Zn(dB,{Queue:()=>hB,QueueNode:()=>fB,binarySearch:()=>FT,insertEventIntoAscendingList:()=>mge,insertEventIntoDescendingList:()=>pge,normalizeURL:()=>Od,utf8Decoder:()=>La,utf8Encoder:()=>io});var La=new TextDecoder("utf-8"),io=new TextEncoder;function Od(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function pge(t,e){const[n,r]=FT(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at));return r||t.splice(n,0,e),t}function mge(t,e){const[n,r]=FT(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at));return r||t.splice(n,0,e),t}function FT(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var fB=class{value;next=null;prev=null;constructor(t){this.value=t}},hB=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new fB(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function pB(t){if(!iw(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function lp(t){return fr(Gu(io.encode(pB(t))))}var sw=new class{generateSecretKey(){return Po.utils.randomPrivateKey()}getPublicKey(t){return fr(Po.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=fr(Po.getPublicKey(e)),n.id=lp(n),n.sig=fr(Po.sign(lp(n),e)),n[Ul]=!0,n}verifyEvent(t){if(typeof t[Ul]=="boolean")return t[Ul];const e=lp(t);if(e!==t.id)return t[Ul]=!1,!1;try{const n=Po.verify(t.sig,e,t.pubkey);return t[Ul]=n,n}catch{return t[Ul]=!1,!1}}},mB=sw.generateSecretKey,$T=sw.getPublicKey,ao=sw.finalizeEvent,qf=sw.verifyEvent,gB={};function yB(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function zT(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function bB(t){return 2e4<=t&&t<3e4}function UT(t){return 3e4<=t&&t<4e4}function gge(t){return yB(t)?"regular":zT(t)?"replaceable":bB(t)?"ephemeral":UT(t)?"parameterized":"unknown"}function yge(t,e){const n=e instanceof Array?e:[e];return iw(t)&&n.includes(t.kind)||!1}Zn(gB,{Application:()=>y0e,BadgeAward:()=>kge,BadgeDefinition:()=>u0e,BlockedRelaysList:()=>Gge,BookmarkList:()=>jge,Bookmarksets:()=>a0e,Calendar:()=>k0e,CalendarEventRSVP:()=>T0e,ChannelCreation:()=>vB,ChannelHideMessage:()=>EB,ChannelMessage:()=>SB,ChannelMetadata:()=>xB,ChannelMuteUser:()=>kB,ClassifiedListing:()=>v0e,ClientAuth:()=>_B,CommunitiesList:()=>qge,CommunityDefinition:()=>A0e,CommunityPostApproval:()=>Rge,Contacts:()=>xge,CreateOrUpdateProduct:()=>h0e,CreateOrUpdateStall:()=>f0e,Curationsets:()=>l0e,Date:()=>S0e,DirectMessageRelaysList:()=>Yge,DraftClassifiedListing:()=>x0e,DraftLong:()=>m0e,Emojisets:()=>g0e,EncryptedDirectMessage:()=>Sge,EventDeletion:()=>Ege,FileMetadata:()=>Age,FileServerPreference:()=>Jge,Followsets:()=>i0e,GenericRepost:()=>_ge,Genericlists:()=>s0e,GiftWrap:()=>TB,HTTPAuth:()=>WT,Handlerinformation:()=>C0e,Handlerrecommendation:()=>_0e,Highlights:()=>Uge,InterestsList:()=>Qge,Interestsets:()=>d0e,JobFeedback:()=>Bge,JobRequest:()=>Dge,JobResult:()=>Lge,Label:()=>Nge,LightningPubRPC:()=>t0e,LiveChatMessage:()=>Ige,LiveEvent:()=>b0e,LongFormArticle:()=>p0e,Metadata:()=>bge,Mutelist:()=>Hge,NWCWalletInfo:()=>e0e,NWCWalletRequest:()=>CB,NWCWalletResponse:()=>n0e,NostrConnect:()=>r0e,OpenTimestamps:()=>Cge,Pinlist:()=>Vge,PrivateDirectMessage:()=>Tge,ProblemTracker:()=>Pge,ProfileBadges:()=>c0e,PublicChatsList:()=>Kge,Reaction:()=>VT,RecommendRelay:()=>vge,RelayList:()=>Wge,Relaysets:()=>o0e,Report:()=>Oge,Reporting:()=>Mge,Repost:()=>HT,Seal:()=>wB,SearchRelaysList:()=>Zge,ShortTextNote:()=>wge,Time:()=>E0e,UserEmojiList:()=>Xge,UserStatuses:()=>w0e,Zap:()=>zge,ZapGoal:()=>Fge,ZapRequest:()=>$ge,classifyKind:()=>gge,isEphemeralKind:()=>bB,isKind:()=>yge,isParameterizedReplaceableKind:()=>UT,isRegularKind:()=>yB,isReplaceableKind:()=>zT});var bge=0,wge=1,vge=2,xge=3,Sge=4,Ege=5,HT=6,VT=7,kge=8,wB=13,Tge=14,_ge=16,vB=40,xB=41,SB=42,EB=43,kB=44,Cge=1040,TB=1059,Age=1063,Ige=1311,Pge=1971,Oge=1984,Mge=1984,Nge=1985,Rge=4550,Dge=5999,Lge=6999,Bge=7e3,Fge=9041,$ge=9734,zge=9735,Uge=9802,Hge=1e4,Vge=10001,Wge=10002,jge=10003,qge=10004,Kge=10005,Gge=10006,Zge=10007,Qge=10015,Xge=10030,Yge=10050,Jge=10096,e0e=13194,t0e=21e3,_B=22242,CB=23194,n0e=23195,r0e=24133,WT=27235,i0e=3e4,s0e=30001,o0e=30002,a0e=30003,l0e=30004,c0e=30008,u0e=30009,d0e=30015,f0e=30017,h0e=30018,p0e=30023,m0e=30024,g0e=30030,y0e=30078,b0e=30311,w0e=30315,v0e=30402,x0e=30403,S0e=31922,E0e=31923,k0e=31924,T0e=31925,_0e=31989,C0e=31990,A0e=34550;function AB(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}function IB(t,e){for(let n=0;n<t.length;n++)if(AB(t[n],e))return!0;return!1}function I0e(...t){let e={};for(let n=0;n<t.length;n++){let r=t[n];Object.entries(r).forEach((([i,s])=>{if(i==="kinds"||i==="ids"||i==="authors"||i[0]==="#"){e[i]=e[i]||[];for(let o=0;o<s.length;o++){let a=s[o];e[i].includes(a)||e[i].push(a)}}})),r.limit&&(!e.limit||r.limit>e.limit)&&(e.limit=r.limit),r.until&&(!e.until||r.until>e.until)&&(e.until=r.until),r.since&&(!e.since||r.since<e.since)&&(e.since=r.since)}return e}function P0e(t){if(t.ids&&!t.ids.length||t.kinds&&!t.kinds.length||t.authors&&!t.authors.length)return 0;for(const[e,n]of Object.entries(t))if(e[0]==="#"&&Array.isArray(n)&&!n.length)return 0;return Math.min(Math.max(0,t.limit??1/0),t.ids?.length??1/0,t.authors?.length&&t.kinds?.every((e=>zT(e)))?t.authors.length*t.kinds.length:1/0,t.authors?.length&&t.kinds?.every((e=>UT(e)))&&t["#d"]?.length?t.authors.length*t.kinds.length*t["#d"].length:1/0)}var PB={};function ow(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function OB(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function MB(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function O0e(t,e){return e===ow(t,"id")}function M0e(t,e){return e===ow(t,"pubkey")}function N0e(t,e){return e===OB(t,"kind")}Zn(PB,{getHex64:()=>ow,getInt:()=>OB,getSubscriptionId:()=>MB,matchEventId:()=>O0e,matchEventKind:()=>N0e,matchEventPubkey:()=>M0e});var NB={};function RB(t,e){return{kind:_B,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function R0e(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}Zn(NB,{makeAuthEvent:()=>RB});var DB,D0e=t=>(t[Ul]=!0,!0),jT=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new hB;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=Od(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new jT(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await R0e();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=MB(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=ow(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&IB(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t(RB(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new L0e(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},L0e=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{DB=WebSocket}catch{}var LB,BB=class extends jT{constructor(t){super(t,{verifyEvent:qf,websocketImplementation:DB})}static async connect(t){const e=new BB(t);return await e.connect(),e}},B0e=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=Od(t);let n=this.relays.get(t);return n||(n=new jT(t,{verifyEvent:this.trustedRelayURLs.has(t)?D0e:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(Od).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(d,f)=>{let h=this.seenOn.get(f);h||(h=new Set,this.seenOn.set(f,h)),h.add(d)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=d=>{s[d]=!0,s.filter((f=>f)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(d,f)=>{o(d),a[d]=f,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=d=>{if(e.alreadyHaveEvent?.(d))return!0;const f=n.has(d);return n.add(d),f},u=Promise.all(Object.entries(t).map((async(d,f,h)=>{if(h.indexOf(d)!==f)return void l(f,"duplicate url");let p,[m,g]=d;m=Od(m);try{p=await this.ensureRelay(m,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(b){return void l(f,b?.message||String(b))}let y=p.subscribe(g,{...e,oneose:()=>o(f),onclose:b=>l(f,b),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)})));return{async close(){await u,r.forEach((d=>{d.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(Od).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{LB=WebSocket}catch{}var F0e=class extends B0e{constructor(){super({verifyEvent:qf,websocketImplementation:LB})}},FB={};Zn(FB,{BECH32_REGEX:()=>$B,Bech32MaxSize:()=>qT,NostrTypeGuard:()=>$0e,decode:()=>bm,encodeBytes:()=>lw,naddrEncode:()=>j0e,neventEncode:()=>W0e,noteEncode:()=>H0e,nprofileEncode:()=>V0e,npubEncode:()=>U0e,nsecEncode:()=>z0e});var $0e={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},qT=5e3,$B=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function bm(t){let{prefix:e,words:n}=kf.decode(t,qT),r=new Uint8Array(kf.fromWords(n));switch(e){case"nprofile":{let i=J1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:fr(i[0][0]),relays:i[1]?i[1].map((s=>La.decode(s))):[]}}}case"nevent":{let i=J1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:fr(i[0][0]),relays:i[1]?i[1].map((s=>La.decode(s))):[],author:i[2]?.[0]?fr(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(fr(i[3][0]),16):void 0}}}case"naddr":{let i=J1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:La.decode(i[0][0]),pubkey:fr(i[2][0]),kind:parseInt(fr(i[3][0]),16),relays:i[1]?i[1].map((s=>La.decode(s))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:fr(r)};default:throw new Error(`unknown prefix ${e}`)}}function J1(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function z0e(t){return lw("nsec",t)}function U0e(t){return lw("npub",Ef(t))}function H0e(t){return lw("note",Ef(t))}function aw(t,e){let n=kf.toWords(e);return kf.encode(t,n,qT)}function lw(t,e){return aw(t,e)}function V0e(t){return aw("nprofile",KT({0:[Ef(t.pubkey)],1:(t.relays||[]).map((e=>io.encode(e)))}))}function W0e(t){let e;return t.kind!==void 0&&(e=(function(n){const r=new Uint8Array(4);return r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=255&n,r})(t.kind)),aw("nevent",KT({0:[Ef(t.id)],1:(t.relays||[]).map((n=>io.encode(n))),2:t.author?[Ef(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function j0e(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),aw("naddr",KT({0:[io.encode(t.identifier)],1:(t.relays||[]).map((n=>io.encode(n))),2:[Ef(t.pubkey)],3:[new Uint8Array(e)]}))}function KT(t){let e=[];return Object.entries(t).reverse().forEach((([n,r])=>{r.forEach((i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)}))})),tw(...e)}var q0e=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function K0e(t){let e=[];for(let n of t.content.matchAll(q0e))if(n[2])try{let{type:r,data:i}=bm(n[1]);switch(r){case"npub":e.push({text:n[0],profile:{pubkey:i,relays:[]}});break;case"nprofile":e.push({text:n[0],profile:i});break;case"note":e.push({text:n[0],event:{id:i,relays:[]}});break;case"nevent":e.push({text:n[0],event:i});break;case"naddr":e.push({text:n[0],address:i})}}catch{}else if(n[3]){let r=parseInt(n[3],10),i=t.tags[r];if(!i)continue;switch(i[0]){case"p":e.push({text:n[0],profile:{pubkey:i[1],relays:i[2]?[i[2]]:[]}});break;case"e":e.push({text:n[0],event:{id:i[1],relays:i[2]?[i[2]]:[]}});break;case"a":try{let[s,o,a]=i[1].split(":");e.push({text:n[0],address:{identifier:a,pubkey:o,kind:parseInt(s,10),relays:i[2]?[i[2]]:[]}})}catch{}}}return e}var zB={};async function UB(t,e,n){const r=t instanceof Uint8Array?fr(t):t,i=HB(Hf.getSharedSecret(r,"02"+e));let s=Uint8Array.from(U6(16)),o=io.encode(n),a=rB(i,s).encrypt(o);return`${_c.encode(new Uint8Array(a))}?iv=${_c.encode(new Uint8Array(s.buffer))}`}async function G0e(t,e,n){const r=t instanceof Uint8Array?fr(t):t;let[i,s]=n.split("?iv="),o=HB(Hf.getSharedSecret(r,"02"+e)),a=_c.decode(s),l=_c.decode(i),c=rB(o,a).decrypt(l);return La.decode(c)}function HB(t){return t.slice(1,33)}Zn(zB,{decrypt:()=>G0e,encrypt:()=>UB});var VB={};Zn(VB,{NIP05_REGEX:()=>GT,isNip05:()=>Z0e,isValid:()=>Y0e,queryProfile:()=>WB,searchDomain:()=>X0e,useFetchImplementation:()=>Q0e});var cw,GT=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Z0e=t=>GT.test(t||"");try{cw=fetch}catch{}function Q0e(t){cw=t}async function X0e(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await cw(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function WB(t){const e=t.match(GT);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await cw(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function Y0e(t,e){const n=await WB(e);return!!n&&n.pubkey===t}var jB={};function J0e(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,d={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=d;continue}if(c==="reply"){e.reply=d;continue}if(c==="mention"){e.mentions.push(d);continue}n?r=d:n=d,e.mentions.push(d)}else{if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}s[0]==="p"&&s[1]&&e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find((a=>a.pubkey===i.author));o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach((a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)})),o.relays=i.relays)}})),e.mentions.forEach((i=>{if(i.author){let s=e.profiles.find((o=>o.pubkey===i.author));s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach((o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)})),s.relays=i.relays)}})),e}Zn(jB,{parse:()=>J0e});var qB={};Zn(qB,{fetchRelayInformation:()=>tye,useFetchImplementation:()=>eye});function eye(t){}async function tye(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var KB={};function GB(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r!==0){e+=Math.clz32(r);break}e+=32}return e}function nye(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=ZB(r),GB(r.id)>=e)break}return r}function ZB(t){return fr(Gu(io.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}Zn(KB,{fastEventHash:()=>ZB,getPow:()=>GB,minePow:()=>nye});var QB={};function rye(t,e,n,r){return ao({kind:HT,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function XB(t){if(t.kind!==HT)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0?{id:e[1],relays:[e[2],n?.[2]].filter((r=>typeof r=="string")),author:n?.[1]}:void 0}function iye(t,{skipVerification:e}={}){const n=XB(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}return r.id===n.id&&(e||qf(r))?r:void 0}Zn(QB,{finishRepostEvent:()=>rye,getRepostedEvent:()=>iye,getRepostedEventPointer:()=>XB});var YB={};Zn(YB,{NOSTR_URI_REGEX:()=>uw,parse:()=>oye,test:()=>sye});var uw=new RegExp(`nostr:(${$B.source})`);function sye(t){return typeof t=="string"&&new RegExp(`^${uw.source}$`).test(t)}function oye(t){const e=t.match(new RegExp(`^${uw.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:bm(e[1])}}var JB={};function aye(t,e,n){const r=e.tags.filter((i=>i.length>=2&&(i[0]==="e"||i[0]==="p")));return ao({...t,kind:VT,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function lye(t){if(t.kind!==VT)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0&&n!==void 0?{id:e[1],relays:[e[2],n[2]].filter((r=>r!==void 0)),author:n[1]}:void 0}Zn(JB,{finishReactionEvent:()=>aye,getReactedEventPointer:()=>lye});var eF={};Zn(eF,{matchAll:()=>cye,regex:()=>ZT,replaceAll:()=>uye});var ZT=()=>new RegExp(`\\b${uw.source}\\b`,"g");function*cye(t){const e=t.matchAll(ZT());for(const n of e)try{const[r,i]=n;yield{uri:r,value:i,decoded:bm(i),start:n.index,end:n.index+r.length}}catch{}}function uye(t,e){return t.replaceAll(ZT(),((n,r)=>e({uri:n,value:r,decoded:bm(r)})))}var tF={};Zn(tF,{channelCreateEvent:()=>dye,channelHideMessageEvent:()=>pye,channelMessageEvent:()=>hye,channelMetadataEvent:()=>fye,channelMuteUserEvent:()=>mye});var dye=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return ao({kind:vB,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},fye=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return ao({kind:xB,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},hye=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),ao({kind:SB,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},pye=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return ao({kind:EB,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},mye=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return ao({kind:kB,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},nF={};Zn(nF,{EMOJI_SHORTCODE_REGEX:()=>rF,matchAll:()=>gye,regex:()=>QT,replaceAll:()=>yye});var rF=/:(\w+):/,QT=()=>new RegExp(`\\B${rF.source}\\B`,"g");function*gye(t){const e=t.matchAll(QT());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function yye(t,e){return t.replaceAll(QT(),((n,r)=>e({shortcode:n,name:r})))}var XT,iF={};Zn(iF,{useFetchImplementation:()=>bye,validateGithub:()=>wye});try{XT=fetch}catch{}function bye(t){XT=t}async function wye(t,e,n){try{return await(await XT(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var sF={};Zn(sF,{decrypt:()=>t_,encrypt:()=>e_,getConversationKey:()=>YT,v2:()=>xye});var oF=1,aF=65535;function YT(t,e){const n=Hf.getSharedSecret(t,"02"+e).subarray(1,33);return cge(Gu,n,"nip44-v2")}function lF(t,e){const n=uge(Gu,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function JT(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function vye(t){const e=io.encode(t),n=e.length;return tw((function(r){if(!Number.isSafeInteger(r)||r<oF||r>aF)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const i=new Uint8Array(2);return new DataView(i.buffer).setUint16(0,r,!1),i})(n),e,new Uint8Array(JT(n)-n))}function cF(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=tw(n,e);return rw(Gu,t,r)}function e_(t,e,n=U6(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=lF(e,n),o=vye(t),a=cB(r,i,o),l=cF(s,a,n);return _c.encode(tw(new Uint8Array([2]),n,a,l))}function t_(t,e){const{nonce:n,ciphertext:r,mac:i}=(function(l){if(typeof l!="string")throw new Error("payload must be a valid string");const c=l.length;if(c<132||c>87472)throw new Error("invalid payload length: "+c);if(l[0]==="#")throw new Error("unknown encryption version");let u;try{u=_c.decode(l)}catch(h){throw new Error("invalid base64: "+h.message)}const d=u.length;if(d<99||d>65603)throw new Error("invalid data length: "+d);const f=u[0];if(f!==2)throw new Error("unknown encryption version "+f);return{nonce:u.subarray(1,33),ciphertext:u.subarray(33,-32),mac:u.subarray(-32)}})(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=lF(e,n);if(!RT(cF(a,r,n),i))throw new Error("invalid MAC");return(function(l){const c=new DataView(l.buffer).getUint16(0),u=l.subarray(2,2+c);if(c<oF||c>aF||u.length!==c||l.length!==2+JT(c))throw new Error("invalid padding");return La.decode(u)})(cB(s,o,r))}var xye={utils:{getConversationKey:YT,calcPaddedLen:JT},encrypt:e_,decrypt:t_},uF={};function Sye(t){const{pathname:e,searchParams:n}=new URL(t),r=e,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function Eye(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},i=await UB(e,t,JSON.stringify(r)),s={kind:CB,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return ao(s,e)}Zn(uF,{makeNwcRequestEvent:()=>Eye,parseConnectionString:()=>Sye});var n_,dF={};Zn(dF,{getZapEndpoint:()=>Tye,makeZapReceipt:()=>Aye,makeZapRequest:()=>_ye,useFetchImplementation:()=>kye,validateZapRequest:()=>Cye});try{n_=fetch}catch{}function kye(t){n_=t}async function Tye(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=kf.decode(n,1e3),a=kf.fromWords(o);e=La.decode(a)}else{if(!r)return null;{let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}}let i=await n_(e),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function _ye({profile:t,event:e,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function Cye(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!iw(e))return"Zap request is not a valid Nostr event.";if(!qf(e))return"Invalid signature on zap request.";let n=e.tags.find((([i,s])=>i==="p"&&s));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([i,s])=>i==="e"&&s));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([i,s])=>i==="relays"&&s))?null:"Zap request doesn't have a 'relays' tag."}function Aye({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter((([a])=>a==="e"||a==="p"||a==="a")),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}var fF={};Zn(fF,{createRumor:()=>yF,createSeal:()=>bF,createWrap:()=>wF,unwrapEvent:()=>vF,unwrapManyEvents:()=>Pye,wrapEvent:()=>pS,wrapManyEvents:()=>Iye});var hF=()=>Math.round(Date.now()/1e3),pF=()=>Math.round(hF()-172800*Math.random()),mF=(t,e)=>YT(t,e),gF=(t,e,n)=>e_(JSON.stringify(t),mF(e,n)),tO=(t,e)=>JSON.parse(t_(t.content,mF(e,t.pubkey)));function yF(t,e){const n={created_at:hF(),content:"",tags:[],...t,pubkey:$T(e)};return n.id=lp(n),n}function bF(t,e,n){return ao({kind:wB,content:gF(t,e,n),created_at:pF(),tags:[]},e)}function wF(t,e){const n=mB();return ao({kind:TB,content:gF(t,n,e),created_at:pF(),tags:[["p",e]]},n)}function pS(t,e,n){return wF(bF(yF(t,e),e,n),n)}function Iye(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=$T(e),i=[pS(t,e,r)];return n.forEach((s=>{i.push(pS(t,e,s))})),i}function vF(t,e){const n=tO(t,e);return tO(n,e)}function Pye(t,e){let n=[];return t.forEach((r=>{n.push(vF(r,e))})),n.sort(((r,i)=>r.created_at-i.created_at)),n}var xF={};Zn(xF,{getToken:()=>Oye,hashPayload:()=>r_,unpackEventFromToken:()=>EF,validateEvent:()=>IF,validateEventKind:()=>TF,validateEventMethodTag:()=>CF,validateEventPayloadTag:()=>AF,validateEventTimestamp:()=>kF,validateEventUrlTag:()=>_F,validateToken:()=>Mye});var SF="Nostr ";async function Oye(t,e,n,r=!1,i){const s={kind:WT,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",r_(i)]);const o=await n(s);return(r?SF:"")+_c.encode(io.encode(JSON.stringify(o)))}async function Mye(t,e,n){const r=await EF(t).catch((i=>{throw i}));return await IF(r,e,n).catch((i=>{throw i}))}async function EF(t){if(!t)throw new Error("Missing token");t=t.replace(SF,"");const e=La.decode(_c.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function kF(t){return!!t.created_at&&Math.round(new Date().getTime()/1e3)-t.created_at<60}function TF(t){return t.kind===WT}function _F(t,e){const n=t.tags.find((r=>r[0]==="u"));return!!n&&n.length>0&&n[1]===e}function CF(t,e){const n=t.tags.find((r=>r[0]==="method"));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function r_(t){return fr(Gu(io.encode(JSON.stringify(t))))}function AF(t,e){const n=t.tags.find((i=>i[0]==="payload"));if(!n)return!1;const r=r_(e);return n.length>0&&n[1]===r}async function IF(t,e,n,r){if(!qf(t))throw new Error("Invalid nostr event, signature invalid");if(!TF(t))throw new Error("Invalid nostr event, kind invalid");if(!kF(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!_F(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!CF(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!AF(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const kt={LIBRARIES:{decodeBolt11:Eme.decode,NostrTools:rS},DEFAULT_OPTIONS:{theme:"light",colorMode:!0},BATCH_SIZE:5,REQ_CONFIG:{INITIAL_LOAD_COUNT:15,ADDITIONAL_LOAD_COUNT:20},LOAD_TIMEOUT:1e4,BUFFER_INTERVAL:500,BUFFER_MIN_INTERVAL:100,INFINITE_SCROLL:{ROOT_MARGIN:"400px",THRESHOLD:.1,DEBOUNCE_TIME:500,RETRY_DELAY:500},ZAP_CONFIG:{DEFAULT_LIMIT:1,DEFAULT_COLOR_MODE:!0,ERRORS:{DIALOG_NOT_FOUND:"Zap dialog not found",BUTTON_NOT_FOUND:"Fetch button not found",DECODE_FAILED:"Failed to decode identifier"}},ZAP_AMOUNT_CONFIG:{DEFAULT_COLOR_MODE:!0,THRESHOLDS:[{value:1e4,className:"zap-amount-10k"},{value:5e3,className:"zap-amount-5k"},{value:2e3,className:"zap-amount-2k"},{value:1e3,className:"zap-amount-1k"},{value:500,className:"zap-amount-500"},{value:200,className:"zap-amount-200"},{value:100,className:"zap-amount-100"}],DEFAULT_CLASS:"default-color",DISABLED_CLASS:""},DIALOG_CONFIG:{DEFAULT_TITLE:"To ",NO_ZAPS_MESSAGE:"No Zaps yet!<br>Send the first Zap!",DEFAULT_NO_ZAPS_DELAY:1500,ZAP_LIST:{INITIAL_BATCH:30,REMAINING_BATCH:30,PROFILE_BATCH:30,MIN_HEIGHT:"100px"}},REQUEST_CONFIG:{METADATA_TIMEOUT:2e4,REQUEST_TIMEOUT:2e3,CACHE_DURATION:3e5},PROFILE_CONFIG:{BATCH_SIZE:20,BATCH_DELAY:100,RELAYS:["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine","wss://directory.yabu.me"]},BATCH_CONFIG:{REFERENCE_PROCESSOR:{BATCH_SIZE:20,BATCH_DELAY:100},SUPPORTED_EVENT_KINDS:[1,30023,30030,30009,40,42,31990]},BATCH_PROCESSOR_CONFIG:{DEFAULT_BATCH_SIZE:20,DEFAULT_BATCH_DELAY:100,DEFAULT_MAX_CACHE_AGE:18e5,DEFAULT_RELAY_URLS:[],TIMEOUT_DURATION:500}};class Vp{constructor(e,n,r=null){this.identifier=e,this.relayUrls=n,this.isColorModeEnabled=r===null?kt.ZAP_CONFIG.DEFAULT_COLOR_MODE:String(r).toLowerCase()==="true"}static determineColorMode(e){if(!e||!e.hasAttribute("data-zap-color-mode"))return kt.ZAP_CONFIG.DEFAULT_COLOR_MODE;const n=e.getAttribute("data-zap-color-mode");return n.toLowerCase()!=="true"&&n.toLowerCase()!=="false"||n.toLowerCase()==="true"}static fromButton(e){if(!e)throw new Error(kt.ZAP_CONFIG.ERRORS.BUTTON_NOT_FOUND);const n=Vp.determineColorMode(e);return new Vp(e.getAttribute("data-nzv-id"),e.getAttribute("data-relay-urls").split(","),n)}}class Qa{constructor(e=1e3){this.cache=new Map,this.maxSize=e,this.accessOrder=new Map}set(e,n){if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const r=this.accessOrder.keys().next().value;this.cache.delete(r),this.accessOrder.delete(r)}return this.cache.set(e,n),this.accessOrder.delete(e),this.accessOrder.set(e,Date.now()),n}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.accessOrder.set(e,Date.now()),n}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}}class i_ extends Qa{#e=new Map;setProfile(e,n){if(!e||!n)return;const r=this.get(e);r&&r._eventCreatedAt&&n._eventCreatedAt&&!(n._eventCreatedAt>r._eventCreatedAt)||(this.set(e,n),this.#t(e,n))}#t(e,n){this.#e.forEach((r=>{try{r(e,n)}catch{}}))}subscribe(e){if(typeof e!="function")return null;const n=Math.random().toString(36).substr(2,9);return this.#e.set(n,e),()=>this.#e.delete(n)}clearSubscriptions(){this.#e.clear()}}class Nye extends Qa{#e=new Map;initializeView(e){this.#e.set(e,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,batchProcessing:!1})}getViewState(e){return this.#e.get(e)||this.initializeView(e)}updateViewState(e,n){const r=this.getViewState(e);return this.#e.set(e,{...r,...n}),this.#e.get(e)}getEvents(e){return this.get(e)||[]}setEvents(e,n,r=!1){const i=r?this.getEvents(e):[],s=new Map(n.map((a=>[a.id,a]))),o=[...i.filter((a=>!s.has(a.id))),...n];this.set(e,o)}addEvent(e,n){if(!n?.id)return!1;const r=this.getEvents(e);return!this.#t(r,n)&&(r.push(n),r.sort(((i,s)=>s.created_at-i.created_at)),this.setEvents(e,r,!0),!0)}#t(e,n){return e.some((r=>r.id===n.id||r.kind===n.kind&&r.pubkey===n.pubkey&&r.content===n.content&&r.created_at===n.created_at))}}class Rye extends Qa{#e=new Map;#t=new Map;async getOrFetch(e,n){const r=this.get(e);if(r)return r;const i=this.#e.get(e);if(i)return i;const s=n().then((o=>(o&&this.set(e,o),this.#e.delete(e),o))).catch((o=>(this.#e.delete(e),null)));return this.#e.set(e,s),s}clearPendingFetches(){this.#e.clear()}setComponent(e,n){this.#t.set(e,n)}getComponent(e){return this.#t.get(e)}clearComponents(){this.#t.clear()}clear(){super.clear(),this.clearPendingFetches(),this.clearComponents()}}class Dye extends Qa{#e=new Map;#t=new Map;setCached(e,n,r){const i=`${e}:${n}`;this.set(i,{stats:r,timestamp:Date.now()}),this.updateViewStats(e,r)}getCached(e,n){const r=`${e}:${n}`;return this.get(r)}updateViewStats(e,n){n&&this.#e.set(e,{...n,lastUpdate:Date.now()})}getViewStats(e){return this.#e.get(e)}clearViewStats(e){this.#e.delete(e)}setNoZapsState(e,n){this.#t.set(e,n)}hasNoZaps(e){return this.#t.get(e)||!1}clearNoZapsState(e){this.#t.delete(e)}clear(){super.clear(),this.#e.clear(),this.#t.clear()}}class Lye extends Qa{hasDecoded(e){return this.has(e)}setDecoded(e,n){this.set(e,n)}getDecoded(e){return this.get(e)}}class Bye extends Qa{initializeLoadState(e){const n={isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,currentCount:0};return this.set(e,n),n}getLoadState(e){return this.has(e)?this.get(e):this.initializeLoadState(e)}updateLoadState(e,n){const r={...this.getLoadState(e),...n};return this.set(e,r),r}canLoadMore(e){const n=this.getLoadState(e);return n&&!n.isLoading&&n.lastEventTime}updateLoadProgress(e,n){const r=this.getLoadState(e);return r.currentCount+=n,this.updateLoadState(e,{currentCount:r.currentCount}),r.currentCount}}class Fye extends Qa{setZapInfo(e,n){this.set(e,n)}getZapInfo(e){return this.get(e)}clearZapInfo(e){this.delete(e)}}class $ye extends i_{setImage(e,n){e&&n&&this.set(e,{image:n,timestamp:Date.now()})}getImage(e){return this.get(e)?.image}hasImage(e){return this.has(e)}clearExpired(e=36e5){const n=Date.now();for(const[r,i]of this.cache.entries())n-i.timestamp>e&&this.delete(r)}}class zye extends i_{#e=new Map;setNip05(e,n){e&&this.set(e,{value:n,timestamp:Date.now(),verified:!0})}getNip05(e){return this.get(e)?.value}setPendingVerification(e,n){this.#e.set(e,n)}getPendingVerification(e){return this.#e.get(e)}deletePendingVerification(e){this.#e.delete(e)}clearPendingVerifications(){this.#e.clear()}clear(){super.clear(),this.clearPendingVerifications()}}class cp{static#e=null;#t=null;#n={};constructor(){if(cp.#e)return cp.#e;this.profileCache=new i_,this.zapEventCache=new Nye,this.referenceCache=new Rye,this.statsCache=new Dye,this.decodedCache=new Lye,this.loadStateCache=new Bye,this.zapInfoCache=new Fye,this.imageCache=new $ye,this.nip05Cache=new zye,this.nip05PendingCache=new Qa,this.#n=["zapInfo","uiComponent","decoded","nip05","nip05PendingFetches","zapLoadStates","imageCache","isEventIdentifier"].reduce(((e,n)=>(e[n]=new Qa,e)),{}),this.viewStats=new Map,this.viewStates=new Map,cp.#e=this}setProfile(e,n){return this.profileCache.setProfile(e,n)}getProfile(e){return this.profileCache.get(e)}subscribeToProfileUpdates(e){return this.profileCache.subscribe(e)}initializeZapView(e){return this.zapEventCache.initializeView(e)}getZapEvents(e){return this.zapEventCache.getEvents(e)}setZapEvents(e,n,r){return this.zapEventCache.setEvents(e,n,r)}addZapEvent(e,n){return this.zapEventCache.addEvent(e,n)}getZapViewState(e){return this.zapEventCache.getViewState(e)}updateZapViewState(e,n){return this.zapEventCache.updateViewState(e,n)}setReference(e,n){return this.referenceCache.set(e,n)}getReference(e){return this.referenceCache.get(e)}getOrFetchReference(e,n){return this.referenceCache.getOrFetch(e,n)}getReferenceComponent(e){return this.referenceCache.getComponent(e)}setReferenceComponent(e,n){return this.referenceCache.setComponent(e,n)}getCachedStats(e,n){return this.statsCache.getCached(e,n)}updateStatsCache(e,n,r){this.statsCache.setCached(e,n,r),this.statsCache.updateViewStats(e,r)}getViewStats(e){return this.statsCache.getViewStats(e)}setNoZapsState(e,n){return this.statsCache.setNoZapsState(e,n)}hasNoZaps(e){return this.statsCache.hasNoZaps(e)}async processCachedData(e,n){this.setRelayUrls(n.relayUrls);const r=this.getZapEvents(e),i=r.some((s=>this.getReference(s.id)));return{stats:(await Promise.all([this.getCachedStats(e,n.identifier)]))[0],hasEnoughCachedEvents:r.length>=kt.REQ_CONFIG.INITIAL_LOAD_COUNT,hasReferences:i}}hasDecoded(e){return this.decodedCache.hasDecoded(e)}setDecoded(e,n){return this.decodedCache.setDecoded(e,n)}getDecoded(e){return this.decodedCache.getDecoded(e)}initializeLoadState(e){return this.loadStateCache.initializeLoadState(e)}getLoadState(e){return this.loadStateCache.getLoadState(e)}updateLoadState(e,n){return this.loadStateCache.updateLoadState(e,n)}canLoadMore(e){return this.loadStateCache.canLoadMore(e)}updateLoadProgress(e,n){return this.loadStateCache.updateLoadProgress(e,n)}setZapInfo(e,n){return this.zapInfoCache.setZapInfo(e,n)}getZapInfo(e){return this.zapInfoCache.getZapInfo(e)}clearZapInfo(e){return this.zapInfoCache.clearZapInfo(e)}setImageCache(e,n){return this.imageCache.setImage(e,n)}getImageCache(e){return this.imageCache.getImage(e)}hasImageCache(e){return this.imageCache.hasImage(e)}setNip05(e,n){return this.nip05Cache.setNip05(e,n)}getNip05(e){return this.nip05Cache.getNip05(e)}setNip05PendingFetch(e,n){this.nip05Cache.setPendingVerification(e,n)}getNip05PendingFetch(e){return this.nip05Cache.getPendingVerification(e)}deleteNip05PendingFetch(e){this.nip05Cache.deletePendingVerification(e)}getOrCreateViewState(e,n={}){return this.viewStates.has(e)||this.viewStates.set(e,{currentStats:null,...n}),this.viewStates.get(e)}getViewState(e){return this.getOrCreateViewState(e)}updateViewState(e,n){const r=this.getOrCreateViewState(e);return this.viewStates.set(e,{...r,...n}),this.viewStates.get(e)}setCacheItem(e,n,r){const i=this.#n[e];return i&&n!==void 0?i.set(n,r):null}getCacheItem(e,n){const r=this.#n[e];return r&&n!==void 0?r.get(n):null}setRelayUrls(e){this.#t=e}getRelayUrls(){return this.#t}clearAll(){this.profileCache.clear(),this.profileCache.clearSubscriptions(),this.zapEventCache.clear(),this.referenceCache.clear(),this.referenceCache.clearPendingFetches(),this.referenceCache.clearComponents(),this.statsCache.clear(),this.decodedCache.clear(),this.loadStateCache.clear(),this.zapInfoCache.clear(),this.imageCache.clear(),this.nip05Cache.clear(),this.nip05Cache.clearPendingVerifications(),Object.values(this.#n).forEach((e=>e.clear())),this.viewStats.clear(),this.viewStates.clear()}}const ft=new cp,nO="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDYuMzMgMjA2LjMzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICA8ZGVmcz4KICAgICAgPHN0eWxlPgogICAgICAgICAuY2xzLTEgewogICAgICAgICAgICBmaWxsOiBub25lOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTIgewogICAgICAgICAgICBmaWxsOiAjZmZmOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTMgewogICAgICAgICAgICBmaWxsOiAjNjY2OwogICAgICAgICB9CiAgICAgIDwvc3R5bGU+CiAgIDwvZGVmcz4KICAgPHBhdGggY2xhc3M9ImNscy0yIgogICAgICBkPSJtMjA2LjMzIDEzNC4zOWMwIDIwLjcxIDAgMzEuMDctMy41MyA0Mi4yMi00LjQzIDEyLjE3LTE0LjAyIDIxLjc2LTI2LjE5IDI2LjE5LTExLjE1IDMuNTMtMjEuNSAzLjUzLTQyLjIyIDMuNTNoLTYyLjQ2Yy0yMC43MSAwLTMxLjA2IDAtNDIuMjEtMy41My0xMi4xNy00LjQzLTIxLjc2LTE0LjAyLTI2LjE5LTI2LjE5LTMuNTMtMTEuMTUtMy41My0yMS41LTMuNTMtNDIuMjJ2LTYyLjQ2YzAtMjAuNzEgMC0zMS4wNyAzLjUzLTQyLjIyIDQuNDMtMTIuMTcgMTQuMDItMjEuNzYgMjYuMTktMjYuMTkgMTEuMTUtMy41MiAyMS41LTMuNTIgNDIuMjEtMy41Mmg2Mi40NmMyMC43MSAwIDMxLjA3IDAgNDIuMjIgMy41MiAxMi4xNyA0LjQzIDIxLjc2IDE0LjAyIDI2LjE5IDI2LjE5IDMuNTMgMTEuMTUgMy41MyAyMS41IDMuNTMgNDIuMjJ6IiAvPgogICA8cGF0aCBjbGFzcz0iY2xzLTMiCiAgICAgIGQ9Im0xODUuOTggOTEuMXY4My4yM2MwIDMuMTMtMi41NCA1LjY3LTUuNjcgNS42N2gtNjguMDRjLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNS41YzAuMzEtMTkgMi4zMi0zNy4yIDYuNTQtNDUuNDggMi41My00Ljk4IDYuNy03LjY5IDExLjQ5LTkuMTQgOS4wNS0yLjcyIDI0LjkzLTAuODYgMzEuNjctMS4xOCAwIDAgMjAuMzYgMC44MSAyMC4zNi0xMC43MiAwLTkuMjgtOS4xLTguNTUtOS4xLTguNTUtMTAuMDMgMC4yNi0xNy42Ny0wLjQyLTIyLjYyLTIuMzctOC4yOS0zLjI2LTguNTctOS4yNC04LjYtMTEuMjQtMC40MS0yMy4xLTM0LjQ3LTI1Ljg3LTY0LjQ4LTIwLjE0LTMyLjgxIDYuMjQgMC4zNiA1My4yNyAwLjM2IDExNi4wNXY4LjM4Yy0wLjA2IDMuMDgtMi41NSA1LjU3LTUuNjUgNS41N2gtMzMuNjljLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNDMuOTVjMC0zLjEzIDIuNTQtNS42NyA1LjY3LTUuNjdoMzEuNjdjMy4xMyAwIDUuNjcgMi41NCA1LjY3IDUuNjcgMCA0LjY1IDUuMjMgNy4yNCA5LjAxIDQuNTMgMTEuMzktOC4xNiAyNi4wMS0xMi41MSA0Mi4zNy0xMi41MSAzNi42NSAwIDY0LjM2IDIxLjM2IDY0LjM2IDY4LjY5em0tNjAuODQtMTYuODljMC02LjctNS40My0xMi4xMy0xMi4xMy0xMi4xM3MtMTIuMTMgNS40My0xMi4xMyAxMi4xMyA1LjQzIDEyLjEzIDEyLjEzIDEyLjEzIDEyLjEzLTUuNDMgMTIuMTMtMTIuMTN6IiAvPgo8L3N2Zz4=",Uye=t=>typeof t=="string"&&t.length>0,Hye=t=>{try{return window.NostrTools.nip19.decode(t)}catch{return null}},Vye=(t,e,n)=>{const r={npub:()=>({kinds:[9735],"#p":[e]}),note:()=>({kinds:[9735],"#e":[e]}),nprofile:()=>({kinds:[9735],"#p":[e.pubkey]}),nevent:()=>({kinds:[9735],"#e":[e.id]}),naddr:()=>({kinds:[9735],"#a":[`${e.kind}:${e.pubkey}:${e.identifier}`]})}[t];if(!r)return null;const i=r();return i.limit=n?kt.REQ_CONFIG.ADDITIONAL_LOAD_COUNT:kt.REQ_CONFIG.INITIAL_LOAD_COUNT,n&&(i.until=n),{req:i}};function rO(t,e=null){const n=`${t}:${e}`;if(ft.hasDecoded(n))return ft.getDecoded(n);if(!Uye(t))throw new Error(kt.ZAP_CONFIG.ERRORS.DECODE_FAILED);const r=Hye(t);if(!r)return null;const i=Vye(r.type,r.data,e);return i&&ft.setDecoded(n,i),i}function PF(t){return t?.display_name||t?.name||"nameless"}async function Wye(t,e){if(!t||!e)return null;try{return(await window.NostrTools.nip05.queryProfile(t))?.pubkey===e?t:null}catch{return null}}function $g(t){return new Intl.NumberFormat().format(t)}function OF(t){if(!t||typeof t!="string")return"unknown";try{return`${window.NostrTools.nip19.decode(t).type.toLowerCase()}1${t.slice(5,11)}...${t.slice(-4)}`}catch{return"unknown"}}function Xd(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function jye(t){try{return window.NostrTools.nip19.npubEncode(t)}catch{return null}}function _f(t){if(!t||typeof t!="string")return!1;const e=`isEventIdentifier:${t}`,n=ft.getCacheItem("isEventIdentifier",e);if(n!==void 0)return n;const r=t.startsWith("note1")||t.startsWith("nevent1")||t.startsWith("naddr1");return ft.setCacheItem("isEventIdentifier",e,r),r}async function qye(t){const{pubkey:e,content:n}=(function(i){const s=i.tags.find((o=>o[0]==="description"))?.[1];if(!s)return{pubkey:null,content:""};try{const o=Kye(s);let a;try{a=JSON.parse(o)}catch{const c=o.match(/"pubkey"\s*:\s*"([^"]+)"|"content"\s*:\s*"([^"]+)"/g);if(!c)throw new Error("Invalid JSON structure");a={},c.forEach((u=>{const[d,f]=u.split(":").map((h=>h.trim().replace(/"/g,"")));a[d]=f}))}let l=null;return a.pubkey&&(l=typeof a.pubkey=="string"?a.pubkey:String(a.pubkey)),{pubkey:l,content:typeof a.content=="string"?a.content.trim():""}}catch{return{pubkey:null,content:""}}})(t),r=await(async function(i){const s=i.tags.find((o=>o[0].toLowerCase()==="bolt11"))?.[1];if(!s)return"Amount: Unknown";try{const o=window.decodeBolt11(s),a=o.sections.find((l=>l.name==="amount"))?.value;return a?`${$g(Math.floor(a/1e3))} sats`:"Amount: Unknown"}catch{return"Amount: Unknown"}})(t);return{pubkey:e,content:n,satsText:r}}function iO(t){try{return window.NostrTools.nip19.decode(t)}catch{return null}}function Kye(t){return t.replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/\\\\/g,"\\").replace(/\\(?!(["\\\/bfnrt]|u[0-9a-fA-F]{4}))/g,"").replace(/\\+(["\\/bfnrt])/g,"\\$1").replace(/\\u(?![0-9a-fA-F]{4})/g,"")}class Gye{constructor(e){this.root=e}displayStats(e){requestAnimationFrame((()=>{const n=this.root?.querySelector(".zap-stats");if(n)try{let r;r=e?e.skeleton?this.#e():e.error?this.createTimeoutStats():this.createNormalStats(e):this.createTimeoutStats(),n.innerHTML=r}catch{n.innerHTML=this.createTimeoutStats()}}))}#e(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
    `}createTimeoutStats(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number text-muted">nostr.band</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number text-muted">Stats</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number text-muted">Unavailable</span></div>
      <div class="stats-item">sats</div>
    `}createNormalStats(e){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number">${$g(e.count)}</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number">${$g(Math.floor(e.msats/1e3))}</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number">${$g(Math.floor(e.maxMsats/1e3))}</span></div>
      <div class="stats-item">sats</div>
    `}}class s_{constructor(e={}){this._validateOptions(e),this._initializeProperties(e)}_validateOptions(e){if(!e.pool?.ensureRelay)throw new Error("Invalid pool object: ensureRelay method is required")}_initializeProperties(e){this.pool=e.pool,this.batchSize=e.batchSize||kt.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_SIZE,this.batchDelay=e.batchDelay||kt.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_DELAY,this.relayUrls=e.relayUrls||kt.BATCH_PROCESSOR_CONFIG.DEFAULT_RELAY_URLS,this.batchQueue=new Set,this.pendingFetches=new Map,this.resolvers=new Map,this.processingItems=new Set,this.batchTimer=null,this.eventCache=new Map,this.maxCacheAge=e.maxCacheAge||kt.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}getOrCreateFetchPromise(e){if(this.pendingFetches.has(e))return this.pendingFetches.get(e);const n=new Promise((r=>{this.resolvers.set(e,r)}));return this.pendingFetches.set(e,n),this.batchQueue.add(e),this._scheduleBatchProcess(),n}_scheduleBatchProcess(){this.batchTimer||(this.batchTimer=setTimeout((()=>{this.batchTimer=null,this._processBatchQueue()}),this.batchDelay))}async _processBatchQueue(){if(this.batchQueue.size===0)return;const e=this._getBatchItems();await this._processBatch(e),this.batchQueue.size>0&&this._scheduleBatchProcess()}_getBatchItems(){const e=Array.from(this.batchQueue).slice(0,this.batchSize);return e.forEach((n=>{this.batchQueue.delete(n),this.processingItems.add(n)})),e}async _processBatch(e){try{await this.onBatchProcess(e)}catch(n){this._handleBatchError(e,n)}finally{this._cleanupBatchItems(e)}}_handleBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanupBatchItems(e){e.forEach((n=>{this.processingItems.delete(n),this.pendingFetches.delete(n),this.resolvers.delete(n)}))}resolveItem(e,n){const r=this.resolvers.get(e);r&&(r(n),this.resolvers.delete(e))}async onBatchProcess(e){throw new Error("onBatchProcess must be implemented by derived class")}onBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanup(e,n,r,i){clearTimeout(e),n&&n.close(),r.forEach((s=>{!i.has(s)&&this.resolvers.has(s)&&this.resolveItem(s,null)}))}_getSubscriptionPool(){return this.pool}async _createSubscriptionPromise(e,n,r,i){if(n?.length)return new Promise((s=>{const o=new Set,a=kt.BATCH_PROCESSOR_CONFIG.TIMEOUT_DURATION;let l,c,u=!1;const d=()=>{u||(u=!0,l&&clearTimeout(l),c&&c.close(),e.forEach((f=>{o.has(f)||this.resolveItem(f,null)})),s())};c=this.pool.subscribeMany(n,r,{onevent:f=>{try{u||(i(f,o),o.size===e.length&&d())}catch{}},oneose:()=>{setTimeout(d,100)},onerror:f=>{}}),l=setTimeout((()=>{u||d()}),a)}));e.forEach((s=>this.resolveItem(s,null)))}setRelayUrls(e){this.relayUrls=Array.isArray(e)?e:[]}getCachedItem(e){const n=this.eventCache.get(e);return this._isValidCache(n)?n.event:(this.eventCache.delete(e),null)}_isValidCache(e){return!!e&&Date.now()-e.timestamp<=this.maxCacheAge}setCachedItem(e,n){this.eventCache.set(e,{event:n,timestamp:Date.now()})}}class Zye extends s_{constructor(e={}){super(e)}async onBatchProcess(e){if(!e?.length)return;const n=[{ids:e.slice(0,this.batchSize)}];await this._createSubscriptionPromise(e,this.relayUrls,n,((r,i)=>{if(e.includes(r.id)){const s=this.getCachedItem(r.id);(!s||r.created_at>s.created_at)&&(this.setCachedItem(r.id,r),this.resolveItem(r.id,r),i.add(r.id))}}))}}class Qye extends s_{constructor(e={}){super(e)}_parseAtagValue(e){const n=e.split(":");return n.length!==3?null:{kind:parseInt(n[0]),pubkey:n[1],identifier:n[2]}}async onBatchProcess(e){if(!e?.length)return;const n=[],r={kinds:[],authors:[],"#d":[]};if(e.slice(0,this.batchSize).forEach((s=>{const o=this._parseAtagValue(s);o?(r.kinds.push(o.kind),r.authors.push(o.pubkey),r["#d"].push(o.identifier),n.push(s)):this.resolveItem(s,null)})),n.length===0)return;const i=[r];await this._createSubscriptionPromise(n,this.relayUrls,i,((s,o)=>{const a=n.find((l=>{const c=this._parseAtagValue(l);return c&&s.kind===c.kind&&s.pubkey===c.pubkey&&s.tags.some((u=>u[0]==="d"&&u[1]===c.identifier))}));if(a){const l=this.getCachedItem(a);(!l||s.created_at>l.created_at)&&(this.setCachedItem(a,s),this.resolveItem(a,s),o.add(a))}}))}}class Xye extends s_{constructor(e={}){const{simplePool:n,config:r}=e;super({pool:n,batchSize:r.BATCH_SIZE||kt.PROFILE_CONFIG.BATCH_SIZE,batchDelay:r.BATCH_DELAY||kt.PROFILE_CONFIG.BATCH_DELAY,relayUrls:r.RELAYS||kt.PROFILE_CONFIG.RELAYS,maxCacheAge:kt.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}),this.config=r}async onBatchProcess(e){if(!this.config.RELAYS?.length)throw new Error("No relays configured for profile fetch");const n=e.filter((o=>{const a=this.getCachedItem(o);return!a||(this.resolveItem(o,a),!1)}));if(n.length===0)return;const r=[{kinds:[0],authors:n}],i=new Map,s=(o,a)=>{const l=i.get(o.pubkey);(!l||o.created_at>l.created_at)&&(i.set(o.pubkey,o),this.setCachedItem(o.pubkey,o)),a.add(o.pubkey)};try{await this._createSubscriptionPromise(n,this.config.RELAYS,r,s),n.forEach((o=>{const a=i.get(o);this.resolveItem(o,a||null)}))}catch(o){this.onBatchError(e,o)}}}var Qc=Symbol("verified");function Yye(t){if(!(t instanceof Object)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var Jye=new TextEncoder;function $h(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}var ebe=class{value;next=null;prev=null;constructor(t){this.value=t}},tbe=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new ebe(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function ex(t){return fr(Gu(Jye.encode((function(e){if(!Yye(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])})(t))))}var gg=new class{generateSecretKey(){return Po.utils.randomPrivateKey()}getPublicKey(t){return fr(Po.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=fr(Po.getPublicKey(e)),n.id=ex(n),n.sig=fr(Po.sign(ex(n),e)),n[Qc]=!0,n}verifyEvent(t){if(typeof t[Qc]=="boolean")return t[Qc];const e=ex(t);if(e!==t.id)return t[Qc]=!1,!1;try{const n=Po.verify(t.sig,e,t.pubkey);return t[Qc]=n,n}catch{return t[Qc]=!1,!1}}},nbe=(gg.generateSecretKey,gg.getPublicKey,gg.finalizeEvent,gg.verifyEvent);function rbe(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}async function ibe(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}var MF,sbe=t=>(t[Qc]=!0,!0),NF=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new tbe;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=$h(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new NF(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await ibe();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=(function(n){let r=n.slice(0,22).indexOf('"EVENT"');if(r===-1)return null;let i=n.slice(r+7+1).indexOf('"');if(i===-1)return null;let s=r+7+1+i,o=n.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return n.slice(s+1,a)})(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=(function(s,o){let a=o.length+3,l=s.indexOf(`"${o}":`)+a,c=s.slice(l).indexOf('"')+l+1;return s.slice(c,c+64)})(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&(function(s,o){for(let a=0;a<s.length;a++)if(rbe(s[a],o))return!0;return!1})(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t((function(r,i){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",i]],content:""}})(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new obe(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},obe=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}},abe=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=$h(t);let n=this.relays.get(t);return n||(n=new NF(t,{verifyEvent:this.trustedRelayURLs.has(t)?sbe:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map($h).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(d,f)=>{let h=this.seenOn.get(f);h||(h=new Set,this.seenOn.set(f,h)),h.add(d)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=d=>{s[d]=!0,s.filter((f=>f)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(d,f)=>{o(d),a[d]=f,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=d=>{if(e.alreadyHaveEvent?.(d))return!0;const f=n.has(d);return n.add(d),f},u=Promise.all(Object.entries(t).map((async(d,f,h)=>{if(h.indexOf(d)!==f)return void l(f,"duplicate url");let p,[m,g]=d;m=$h(m);try{p=await this.ensureRelay(m,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(b){return void l(f,b?.message||String(b))}let y=p.subscribe(g,{...e,oneose:()=>o(f),onclose:b=>l(f,b),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)})));return{async close(){await u,r.forEach((d=>{d.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map($h).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{MF=WebSocket}catch{}var RF=class extends abe{constructor(){super({verifyEvent:nbe,websocketImplementation:MF})}};class up{static instance=null;#e;#t;#n=!0;#r;constructor(){return up.instance?up.instance:(this.#i(),up.instance=this,this)}#i(){if(this.#e=kt.PROFILE_CONFIG,this.#t=new RF,!this.#t?.ensureRelay)throw new Error("Failed to initialize SimplePool");this.#r=new Xye({simplePool:this.#t,config:{...this.#e,RELAYS:this.#e.RELAYS||[]}})}get isInitialized(){return this.#n}async fetchProfiles(e){if(!Array.isArray(e)||e.length===0)return[];const n=Date.now(),r=new Array(e.length),i=e.reduce(((s,o,a)=>{const l=ft.getProfile(o);return this.#o(l,n)?r[a]=l:s.push({index:a,pubkey:o}),s}),[]);return i.length>0&&await this.#s(i,r,e),r}async processBatchProfiles(e){const n=this.#a(e);if(n.length!==0)try{await Promise.all([this.fetchProfiles(n),...n.map((r=>this.verifyNip05Async(r)))])}catch{}}async verifyNip05Async(e){const n=ft.getNip05(e);if(n!==void 0)return n;const r=ft.getNip05PendingFetch(e);if(r)return r;const i=this.#u(e);return ft.setNip05PendingFetch(e,i),i}getNip05(e){return ft.getNip05(e)}clearCache(){ft.clearAll(),this.#r.clearPendingFetches()}#o(e,n){return e&&e._lastUpdated&&n-e._lastUpdated<18e5}#a(e){return[...new Set(e?.map((n=>n?.pubkey))?.filter((n=>n&&typeof n=="string"&&n.length===64)))]}async#s(e,n,r){if(!e.length)return;const i=Date.now(),s=e.filter((({pubkey:a})=>a&&typeof a=="string"&&a.length===64));if(s.length===0)return;const o=await Promise.all(s.map((({pubkey:a})=>this.#l(a,i))));s.forEach((({index:a},l)=>{a>=0&&a<n.length&&(n[a]=o[l],r[a]&&ft.setProfile(r[a],o[l]))}))}async#l(e,n){if(!e||typeof e!="string"||e.length!==64)return this.#c();try{const r={kinds:[0],authors:[e],limit:1},i=await this.#r.getOrCreateFetchPromise(e,r);if(!i?.content)return this.#c();let s;try{s=JSON.parse(i.content)}catch{return this.#c()}return{...s,name:PF(s)||"nameless",_lastUpdated:n,_eventCreatedAt:i.created_at}}catch{return this.#c()}}async#u(e){try{const[n]=await this.fetchProfiles([e]);if(!n?.nip05)return ft.setNip05(e,null),null;const r=await Promise.race([Wye(n.nip05,e),new Promise(((s,o)=>setTimeout((()=>o(new Error("NIP-05 timeout"))),5e3)))]);if(!r)return ft.setNip05(e,null),null;const i=Xd(r.startsWith("_@")?r.slice(1):r);return ft.setNip05(e,i),i}catch{return ft.setNip05(e,null),null}finally{ft.deleteNip05PendingFetch(e)}}#c(){return{name:"anonymous",display_name:"anonymous"}}}const Wp=new up;class lbe{async loadAndUpdate(e,n){if(e)try{const r=n.querySelector(".sender-name"),i=n.querySelector(".zap-placeholder-name"),s=n.querySelector(".sender-icon"),o=s?.querySelector(".zap-placeholder-icon"),a=n.querySelector(".sender-pubkey");let l=ft.getProfile(e);const c=l?PF(l)||"nameless":"anonymous",u=l?.picture?(function(d){if(!d||typeof d!="string")return null;try{const f=new URL(d);return["http:","https:"].includes(f.protocol)?f.href:null}catch{return null}})(l.picture):null;this.#e(i,r,c),this.#n(o,s,u,c),this.#r(a,e)}catch{this.#i(n)}}#e(e,n,r){e?e.replaceWith(Object.assign(document.createElement("span"),{className:"sender-name",textContent:r})):n&&(n.textContent=r)}#t(e,n="anonymous user's icon"){const r=`https://robohash.org/${e}.png?set=set5&bgset=bg2&size=128x128`,i=ft.getImageCache(r),s=Object.assign(document.createElement("img"),{alt:n,loading:"lazy",className:"profile-icon"});if(i)return s.src=r,s;const o=new Image;return o.onerror=()=>{s.src=nO,ft.setImageCache(r,nO)},o.onload=()=>{ft.setImageCache(r,o)},o.src=r,s.src=r,s}#n(e,n,r,i){if(e&&n){const s=o=>{e.remove();const a=n.querySelector("img"),l=n.querySelector("a");a&&a.remove(),l&&l.remove();const c=o==="robohash"?this.#t(n.closest("[data-pubkey]")?.dataset.pubkey,`${Xd(i)}'s icon`):Object.assign(document.createElement("img"),{src:o,alt:`${Xd(i)}'s icon`,loading:"lazy",className:"profile-icon"}),u=n.closest("[data-pubkey]")?.dataset.pubkey;if(u){const d=(function(h,p=[]){try{return window.NostrTools.nip19.nprofileEncode({pubkey:h,relays:p})}catch{return null}})(u),f=Object.assign(document.createElement("a"),{href:`https://njump.me/${d}`,target:"_blank",rel:"noopener noreferrer"});f.appendChild(c),n.appendChild(f)}else n.appendChild(c)};if(r){const o=new Image;o.onload=()=>{ft.setImageCache(r,o),s(r)},o.onerror=()=>{s("robohash")},o.src=r}else s("robohash")}}#r(e,n){if(e&&!e.getAttribute("data-nip05-updated")){const r=Wp.getNip05(n);r?(e.textContent=r,e.setAttribute("data-nip05-updated","true")):Wp.verifyNip05Async(n).then((i=>{i&&(e.textContent=i,e.setAttribute("data-nip05-updated","true"))}))}}#i(e){const n=e.querySelector(".zap-placeholder-icon");if(n){const r=n.parentElement,i=e.closest("[data-pubkey]")?.dataset.pubkey;n.remove(),r.appendChild(this.#t(i))}}async updateProfileElement(e,n){if(!e||!n)return;const r=e.querySelector(".sender-icon img, .zap-placeholder-icon");if(r)if(n.picture){const s=document.createElement("img");s.alt=n.name||"Profile Picture",s.width=32,s.height=32,s.className="profile-icon",s.onerror=()=>{const o=e.getAttribute("data-pubkey");if(o){const a=this.#t(o,n.name||"anonymous user");s.parentElement&&s.parentElement.replaceChild(a,s)}},s.src=n.picture,r.parentElement&&r.parentElement.replaceChild(s,r)}else{const s=e.getAttribute("data-pubkey");if(s){const o=this.#t(s,n.name||"anonymous user");r.parentElement&&r.parentElement.replaceChild(o,r)}}const i=e.querySelector(".sender-name, .zap-placeholder-name");if(i&&(i.textContent=n.display_name||n.name||"anonymous",i.className="sender-name"),n.nip05){const s=e.getAttribute("data-pubkey");if(s){const o=e.querySelector('[data-nip05-target="true"]');o&&await this.updateNip05Display(s,o)}}}}class $i{static#e={1:"content",30023:"title",30030:"title",30009:"name",40:"content",42:"name",31990:"alt"};static#t={UI_COMPONENTS:"Failed to create UI components:",ZAP_ITEM:"Failed to create zap item HTML:",REFERENCE:"Reference component creation failed:"};static createUIComponents(e,n,r){try{const i=this.viewConfigs?.get(n),s=r||i?.identifier,o=_f(s)?null:this.#s(e);return{iconComponent:this.#n(),nameComponent:this.#u(e),pubkeyComponent:this.#c(e,s),referenceComponent:this.#d(o)}}catch{return this.#r()}}static#n(){return'<div class="zap-placeholder-icon skeleton"></div>'}static#r(){return{iconComponent:'<div class="zap-placeholder-icon skeleton"></div>',nameComponent:'<div class="zap-placeholder-name skeleton"></div>',pubkeyComponent:"",referenceComponent:""}}static createReferenceComponent(e){return this.#d(this.#s({reference:e}))}static addReferenceToElement(e,n){if(!this.#i(e,n))return;const r=e.querySelector(".zap-content");this.#o(r,n)}static#i(e,n){return e&&n&&e.querySelector(".zap-content")}static#o(e,n){e.querySelectorAll(".zap-reference").forEach((i=>i.remove()));const r=this.createReferenceComponent({reference:n});e.insertAdjacentHTML("beforeend",r)}static getDialogTemplate(){return`
      <dialog class="dialog">
        <h2 class="dialog-title"><a href="#" target="_blank"></a></h2>
        <button class="close-dialog-button">X</button>
        <div class="zap-stats"></div>
        <ul class="dialog-zap-list"></ul>
      </dialog>
    `}static createZapItemHTML(e,n,r,i){try{const s=this.createUIComponents(e,r,i);return this.#a(e,n,s)}catch{return""}}static createNoZapsMessageHTML(e){return`
      <div class="no-zaps-container">
        <div class="no-zaps-message">${e}</div>
      </div>
    `}static#a(e,n,r){const[i,s]=e.satsText.split(" "),o=(a=e.created_at,Math.floor(Date.now()/1e3)-a<86400);var a;return`
      <div class="zap-content">
        <div class="zap-sender${e.comment?" with-comment":""}" data-pubkey="${e.pubkey}">
          <div class="sender-icon${o?" is-new":""}">
            ${r.iconComponent}
          </div>
          <div class="sender-info">
            ${r.nameComponent}
            ${r.pubkeyComponent}
          </div>
          <div class="zap-amount ${n}"><span class="number">${i}</span> ${s}</div>
        </div>
        ${e.comment?`<div class="zap-details"><span class="zap-comment">${Xd(e.comment)}</span></div>`:""}
        ${r.referenceComponent}
      </div>
    `}static#s(e){if(!e)return null;if(this.#l(e))return e;if(e.reference&&typeof e.reference=="object"){if(e.reference.reference&&this.#l(e.reference.reference))return e.reference.reference;if(this.#l(e.reference))return e.reference}return null}static#l(e){return e&&typeof e=="object"&&"id"in e&&"tags"in e&&Array.isArray(e.tags)&&"content"in e&&"kind"in e}static#u({senderName:e}){return e?`<span class="sender-name">${Xd(e)}</span>`:'<div class="zap-placeholder-name skeleton"></div>'}static#c({pubkey:e,displayIdentifier:n,reference:r},i){const s=!_f(i),o=`class="sender-pubkey" data-pubkey="${e}"`;return r&&s?`<span ${o}>${n}</span>`:`<span ${o} data-nip05-target="true">${n}</span>`}static#d(e){if(!this.#l(e))return"";const n=e.id,r=ft.getReferenceComponent(n);if(r)return r;try{const i=this.#h(e),s=this.#p(e),o=this.#g(i,s);return ft.setReferenceComponent(n,o),o}catch{return""}}static#h(e){if(!e?.tags)return"";if(e.kind===31990)return this.#f(e)||"";const n=Array.isArray(e.tags)?e.tags.find((r=>Array.isArray(r)&&r[0]==="d")):null;return n?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.naddrEncode({kind:r,pubkey:i,identifier:s,relays:o})}catch{return null}})(e.kind,e.pubkey,n[1])}`:e.id?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.neventEncode({id:r,kind:i,pubkey:s,relays:o})}catch{return null}})(e.id,e.kind,e.pubkey)}`:""}static#f(e){const n=e.tags.filter((i=>i[0]==="r"));return(n.find((i=>!i.includes("source")))||n[0])?.[1]}static#p(e){if(!e)return"";const n=$i.#e[e.kind];if(n){const r=e.tags.find((i=>Array.isArray(i)&&i[0]===n));if(r&&r[1])return r[1]}if(e.kind===40)try{return JSON.parse(e.content).name||e.content}catch{}return e.content||""}static#g(e,n){return`
      <div class="zap-reference">
        <div class="reference-arrow">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aCBkPSJtNTYwLTEyMC01Ny01NyAxNDQtMTQzSDIwMHYtNDgwaDgwdjQwMGgzNjdMNTAzLTU0NGw1Ni01NyAyNDEgMjQxLTI0MCAyNDBaIiAvPg0KPC9zdmc+" alt="Reference" width="18" height="18" />
        </div>
        <div class="reference-text">${Xd(n)}</div>
        <a href="${e}" target="_blank" class="reference-link">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aA0KICAgICAgICBkPSJNNDQwLTI4MEgyODBxLTgzIDAtMTQxLjUtNTguNVQ4MC00ODBxMC04MyA1OC41LTE0MS41VDI4MC02ODBoMTYwdjgwSDI4MHEtNTAgMC04NSAzNXQtMzUgODVxMCA1MCAzNSA4NXQ4NSAzNWgxNjB2ODBaTTMyMC00NDB2LTgwaDMyMHY4MEgzMjBabTIwMCAxNjB2LTgwaDE2MHE1MCAwIDg1LTM1dDM1LTg1cTAtNTAtMzUtODV0LTg1LTM1SDUyMHYtODBoMTYwcTgzIDAgMTQxLjUgNTguNVQ4ODAtNDgwcTAgODMtNTguNSAxNDEuNVQ2ODAtMjgwSDUyMFoiIC8+DQo8L3N2Zz4=" alt="Quick Reference" width="16" height="16" />
        </a>
      </div>
    `}static ZapInfo=class{#m;constructor(e){this.#m=e}static async createFromEvent(e,n={}){return await new $i.ZapInfo(e).extractInfo(n)}static getAmountColorClass(e,n){return(n===void 0?kt.ZAP_AMOUNT_CONFIG.DEFAULT_COLOR_MODE:n)?this.#y(e):kt.ZAP_AMOUNT_CONFIG.DISABLED_CLASS}static#y(e){const{THRESHOLDS:n,DEFAULT_CLASS:r}=kt.ZAP_AMOUNT_CONFIG;return n.find((i=>e>=i.value))?.className||r}async extractInfo(e={}){const n=this.#m.id,r=ft.getZapInfo(n);if(r)return r.colorClass=$i.ZapInfo.getAmountColorClass(r.satsAmount,e.isColorModeEnabled),r;try{const{pubkey:s,content:o,satsText:a}=await qye(this.#m),l=parseInt(a.replace(/,/g,"").split(" ")[0],10),c=typeof s=="string"?s:null,u=this.#m.reference||null,d={satsText:a,satsAmount:l,comment:o||"",pubkey:c||"",created_at:this.#m.created_at,displayIdentifier:c?OF(jye(c)):"anonymous",senderName:null,senderIcon:null,reference:u,colorClass:$i.ZapInfo.getAmountColorClass(l,e?.isColorModeEnabled)};return ft.setZapInfo(n,d),d}catch{const o={satsText:"Amount: Unknown",satsAmount:0,comment:"",pubkey:"",created_at:this.#m.created_at,displayIdentifier:"anonymous",senderName:"anonymous",senderIcon:i,reference:null};return ft.setZapInfo(n,o),o}var i}static async batchExtractInfo(e,n=!0){const r=new Map;return await Promise.all(e.map((async i=>{const s=new $i.ZapInfo(i),o=await s.extractInfo({isColorModeEnabled:n});r.set(i.id,o)}))),r}};static viewConfigs=new Map}class cbe{constructor(e,n){this.viewId=e,this.config=n}async createListItem(e){const n=await $i.ZapInfo.createFromEvent(e,{isColorModeEnabled:this.config?.isColorModeEnabled}),r=document.createElement("li");return r.className=`zap-list-item ${n.colorClass}${n.comment?" with-comment":""}`,r.setAttribute("data-pubkey",n.pubkey),e?.id&&r.setAttribute("data-event-id",e.id),r.innerHTML=$i.createZapItemHTML(n,n.colorClass,this.viewId),r.setAttribute("data-timestamp",e.created_at.toString()),{li:r,zapInfo:n}}}class ube{constructor(e,n,r,i){if(!e)throw new Error("shadowRoot is required");if(!i)throw new Error("config is required");this.shadowRoot=e,this.profileUI=n,this.viewId=r,this.config=i,this.itemBuilder=new cbe(r,this.config),this.profileUpdateUnsubscribe=null,this.#h()}destroy(){this.profileUpdateUnsubscribe&&(this.profileUpdateUnsubscribe(),this.profileUpdateUnsubscribe=null);const e=this.#e(".dialog-zap-list");e&&(e.innerHTML="")}#e(e){return this.shadowRoot.querySelector(e)}getElementByEventId(e){return this.#e(`.zap-list-item[data-event-id="${e}"]`)}async#t(e){const n=this.#e(".dialog-zap-list");if(n)try{return this.#r(n),await e(n)}catch{n.children.length===0&&this.showNoZapsMessage()}}#n(e,n){const r=e.querySelector(".load-more-trigger");r&&r.remove(),Array.from(n.children).forEach((i=>{const s=i.getAttribute("data-event-id"),o=parseInt(i.getAttribute("data-timestamp"));let a=null;const l=Array.from(e.children);for(let c=0;c<l.length;c++)if(o>parseInt(l[c].getAttribute("data-timestamp"))){a=l[c];break}e.querySelector(`.zap-list-item[data-event-id="${s}"]`)||(a?e.insertBefore(i,a):e.appendChild(i))})),r&&e.appendChild(r)}#r(e){const n=e.querySelector(".no-zaps-message");n&&n.remove()}async#i(e,n){return this.#t((async r=>{const{li:i,zapInfo:s}=await this.itemBuilder.createListItem(e);return n(r,i),await this.#g(s.pubkey,i),{li:i,zapInfo:s}}))}async renderZapListFromCache(e){if(!e?.length)return ft.setNoZapsState(this.viewId,!1),this.showNoZapsMessage();await this.#t((async n=>{const{initialBatch:r,remainingBatch:i}=this.#o(e),{fragment:s,profileUpdates:o}=await this.#a(r);this.#n(n,s),i.length>0?this.#s(i,n,o):await this.#p(o)}))}#o(e){const n=this.#y(e),r=kt.DIALOG_CONFIG.ZAP_LIST.INITIAL_BATCH;return{initialBatch:n.slice(0,r),remainingBatch:n.slice(r)}}async#a(e){const n=document.createDocumentFragment(),r=[];for(const i of e){const{li:s,zapInfo:o}=await this.itemBuilder.createListItem(i);this.#b(i.id,s),n.appendChild(s),o.pubkey&&r.push({pubkey:o.pubkey,element:s})}return{fragment:n,profileUpdates:r}}#s(e,n,r){if(!e.length)return;const i=kt.DIALOG_CONFIG.ZAP_LIST.REMAINING_BATCH;let s=0;const o=async()=>{if(s>=e.length)return void await this.#p(r);const a=e.slice(s,s+i);await this.#l(a,n,r),s+=i,setTimeout((()=>o()),0)};requestIdleCallback((()=>o()))}async#l(e,n,r){const i=document.createDocumentFragment();await Promise.all(e.map((async o=>{const{li:a,zapInfo:l}=await this.itemBuilder.createListItem(o);this.#b(o.id,a),i.appendChild(a),l.pubkey&&r.push({pubkey:l.pubkey,element:a})})));const s=n.querySelector(".load-more-trigger");s&&s.remove(),n.appendChild(i),s&&n.appendChild(s),await new Promise((o=>requestAnimationFrame(o)))}async prependZap(e){return this.#i(e,((n,r)=>n.prepend(r)))}async appendZap(e){return this.#i(e,((n,r)=>{const i=this.#d(n,e.created_at);i?n.insertBefore(r,i):n.appendChild(r)}))}async replacePlaceholderWithZap(e,n){const r=this.#e(`[data-index="${n}"]`);if(this.#w(r))try{const{zapInfo:i}=await this.itemBuilder.createListItem(e);this.#v(r,i,e.id),await this.#g(i.pubkey,r)}catch{r.remove()}}async showNoZapsMessage(){const e=this.#e(".dialog-zap-list");if(e){if(ft.hasNoZaps(this.viewId))return void this.#c(e);await this.#u()||(this.#c(e),ft.setNoZapsState(this.viewId,!0))}}async#u(){const e=this.config.noZapsDelay||kt.DIALOG_CONFIG.DEFAULT_NO_ZAPS_DELAY;await new Promise((r=>setTimeout(r,e)));const n=ft.getZapEvents(this.viewId);return!!n?.length&&(await this.renderZapListFromCache(n),!0)}#c(e){const n=this.config.noZapsMessage||kt.DIALOG_CONFIG.NO_ZAPS_MESSAGE;e.innerHTML=$i.createNoZapsMessageHTML(n),e.style.minHeight=kt.DIALOG_CONFIG.ZAP_LIST.MIN_HEIGHT}async batchUpdate(e,n={}){const r=this.#e(".dialog-zap-list");if(r)try{const i=new Map(Array.from(r.querySelectorAll(".zap-list-item")).map((c=>[c.getAttribute("data-event-id"),c]))),s=this.#y(e),o=_f(this.config.identifier),a=s.filter((c=>{const u=i.get(c.id);return o?!u:!u||c.reference&&!u.querySelector(".zap-reference")}));if(a.length===0&&!n.isFullUpdate)return;const l=document.createDocumentFragment();for(const c of a){const{li:u,zapInfo:d}=await this.itemBuilder.createListItem(c);!o&&c.reference&&this.updateZapReference(c),l.appendChild(u),d.pubkey&&await this.#g(d.pubkey,u)}this.#n(r,l)}catch{}}#d(e,n){return Array.from(e.children).find((r=>{const i=parseInt(r.getAttribute("data-timestamp")||"0");return n>i}))}updateZapReference(e){if(e?.id&&e?.reference)try{const n=this.getElementByEventId(e.id);if(!n)return;$i.addReferenceToElement(n,e.reference),ft.setReference(e.id,e.reference)}catch{}}#h(){this.profileUpdateUnsubscribe=ft.subscribeToProfileUpdates(this.#f.bind(this))}async#f(e,n){const r=this.shadowRoot.querySelectorAll(`[data-pubkey="${e}"]`);await Promise.allSettled(Array.from(r).map((i=>this.profileUI.updateProfileElement(i,n))))}async#p(e){const n=kt.DIALOG_CONFIG.ZAP_LIST.PROFILE_BATCH;for(let r=0;r<e.length;r+=n){const i=e.slice(r,r+n);await Promise.all(i.map((({pubkey:s,element:o})=>this.#g(s,o)))),await new Promise((s=>requestAnimationFrame(s)))}}async#g(e,n){e&&await this.#m(e,n)}async#m(e,n){if(e&&n)try{await this.profileUI.loadAndUpdate(e,n)}catch{}}#y(e){return[...new Map(e.map((n=>[n.id,n]))).values()].sort(((n,r)=>r.created_at-n.created_at))}#b(e,n){if(_f(this.config.identifier))return;const r=ft.getReference(e);r&&$i.addReferenceToElement(n,r)}#w(e){return e&&e.classList.contains("placeholder")}#v(e,n,r){const i=this.itemBuilder.getAmountColorClass(n.satsAmount);e.className=`zap-list-item ${i}${n.comment?" with-comment":""}`,e.setAttribute("data-pubkey",n.pubkey),e.setAttribute("data-event-id",r),e.innerHTML=$i.createZapItemHTML(n,i,this.viewId),e.removeAttribute("data-index")}}var dbe=Jr(0),fbe=Jr.n(dbe);const jp=new class{#e=new Map;#t=new Map;constructor(){}async getZapStats(t,e){const n=await this.#n(e,t);if(n)return n;const r=await this.fetchStats(t);return r&&ft.updateStatsCache(e,t,r),r}async fetchStats(t){try{const e=await this._fetchFromApi(t);return this._formatStats(e)||this.createTimeoutError()}catch(e){return this.handleFetchError(e)}}createTimeoutError(){return{error:!0,timeout:!0}}handleFetchError(t){return{error:!0,timeout:t.message==="STATS_TIMEOUT"}}async _fetchFromApi(t){const e=iO(t);if(!e)return null;const n=`https://api.nostr.band/v0/stats/${e.type==="npub"||e.type==="nprofile"?"profile":"event"}/${t}`,r=new AbortController,i=setTimeout((()=>r.abort()),kt.REQUEST_CONFIG.REQUEST_TIMEOUT);try{return await(await fetch(n,{signal:r.signal})).json()}catch(s){throw s.name==="AbortError"?new Error("STATS_TIMEOUT"):s}finally{clearTimeout(i)}}_formatStats(t){if(!t?.stats)return null;const e=Object.values(t.stats)[0];return e?{count:parseInt(e.zaps_received?.count||e.zaps?.count||0,10),msats:parseInt(e.zaps_received?.msats||e.zaps?.msats||0,10),maxMsats:parseInt(e.zaps_received?.max_msats||e.zaps?.max_msats||0,10)}:null}async initializeStats(t,e,n=!1){if(n&&this.displayStats({skeleton:!0},e),this.#t.has(e))return this.#t.get(e);if(iO(t)?.type==="naddr"){const s=this.createTimeoutError();return this.displayStats(s,e),this.#e.set(e,s),s}const i=(async()=>{try{const s=await this.getZapStats(t,e);return s&&(this.displayStats(s,e),this.#e.set(e,s)),s}catch{return null}finally{this.#t.delete(e)}})();return this.#t.set(e,i),i}async#n(t,e){const n=ft.getCachedStats(t,e),r=Date.now();return n&&r-n.timestamp<kt.REQUEST_CONFIG.CACHE_DURATION?n.stats:null}getCurrentStats(t){return this.#e.get(t)}async handleZapEvent(t,e,n){if(t?.isRealTimeEvent)try{const r=t.tags.find((l=>l[0].toLowerCase()==="bolt11"))?.[1],i=this.extractAmountFromBolt11(r);if(i<=0)return;const s=ft.getViewStats(e),o={count:s?.count||0,msats:s?.msats||0,maxMsats:s?.maxMsats||0},a={count:o.count+1,msats:o.msats+i,maxMsats:Math.max(o.maxMsats,i)};ft.updateStatsCache(e,n,a),this.#e.set(e,a),await this.displayStats(a,e),t.isStatsCalculated=!0,t.amountMsats=i}catch{}}extractAmountFromBolt11(t){try{const e=window.decodeBolt11(t);return parseInt(e.sections.find((n=>n.name==="amount"))?.value??"0",10)}catch{return 0}}async displayStats(t,e){try{await pbe(t,e)}catch{}}},hu=new class{#e;#t;#n;#r;#i;#o;#a;constructor(){this.#e=new RF,this.#s(),this.#l()}#s(){this.#n=new Map,this.#r=new Map,this.#i=new Map,this.#t=!1}#l(){const t={pool:this.#e,batchSize:kt.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_SIZE,batchDelay:kt.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_DELAY};this.#o=new Zye(t),this.#a=new Qye(t)}#u(t){this.#n.has(t)||this.#n.set(t,{zap:null}),this.#r.has(t)||this.#r.set(t,{isZapClosed:!1})}#c(t,e,n,r){this.#n.get(t).zap=this.#e.subscribeMany(e.relayUrls,[n.req],r)}#d(t){return t&&t.id&&Array.isArray(t.tags)}#h(t,e){return t&&this.#i.delete(t),null}async connectToRelays(t){this.#t||([this.#o,this.#a].forEach((e=>e.setRelayUrls(t))),this.#t=!0)}subscribeToZaps(t,e,n,r){try{this.#f(n),this.#u(t),this.#r.get(t).isZapClosed=!1,this.#c(t,e,n,this.#p(r))}catch(i){this.#g("Subscription error",i)}}#f(t){if(!t?.req?.kinds||!Array.isArray(t.req.kinds))throw new Error("Invalid subscription settings")}async fetchReference(t,e,n){try{if(!this.#d(e))return null;const r=e.tags.find((l=>Array.isArray(l)&&l[0]===n));if(!r)return null;const i=n==="e"?r[1]:`${r[1]}`,s=ft.getReference(i);if(s)return s;const o=this.#i.get(i);if(o)return o;const a=n==="e"?this.#o:this.#a;try{const l=await a.getOrCreateFetchPromise(i);return l&&ft.setReference(i,l),this.#i.delete(i),l}finally{this.#i.delete(i)}}catch(r){return this.#h(e?.id,r)}}#p(t){const e=Math.floor(Date.now()/1e3);return{...t,onevent:n=>{n.isRealTimeEvent=n.created_at>=e,t.onevent(n)},oneose:t.oneose}}#g(t,e){throw e}get zapPool(){return this.#e}},{zapPool:h1e}=hu,Mo=new class{constructor(){this.viewConfigs=new Map,this.configStore=new Map,this.observers=new Map,this.#e=new Map,this.#t=new Map}#e;#t;setZapListUI(t){this.zapListUI=t}setViewConfig(t,e){this.viewConfigs.set(t,e),$i.viewConfigs.set(t,e),ft.initializeZapView(t)}getViewConfig(t){return this.viewConfigs.get(t)}async updateEventReference(t,e){try{const n=this.getViewConfig(e);if(!n?.relayUrls?.length||_f(n?.identifier||""))return!1;const r=await this._fetchEventReference(t,n);return!!r&&(t.reference=r,!0)}catch{return!1}}async _fetchEventReference(t,e){const n=async()=>{if(!t?.tags||!Array.isArray(t.tags))return null;try{if(t.tags.find((s=>Array.isArray(s)&&s[0]==="a"))?.[1])return await hu.fetchReference(e.relayUrls,t,"a");const i=t.tags.find((s=>Array.isArray(s)&&s[0]==="e"));return i?.[1]&&/^[0-9a-f]{64}$/.test(i[1].toLowerCase())?await hu.fetchReference(e.relayUrls,t,"e"):null}catch{return null}};try{return await ft.getOrFetchReference(t.id,n)}catch{return null}}async updateEventReferenceBatch(t,e){const n=this.getViewConfig(e);if(!n?.relayUrls?.length||_f(n?.identifier||""))return;const r=t.map((i=>this.updateEventReference(i,e)));await Promise.allSettled(r)}updateUIReferences(t){this.zapListUI&&t.forEach((e=>{e.reference&&this.zapListUI.updateZapReference(e)}))}async initializeSubscriptions(t,e){try{if(!this._isValidFilter(t))throw new Error("Invalid filter settings");const n=rO(t.identifier);if(!n)throw new Error(kt.ZAP_CONFIG.ERRORS.DECODE_FAILED);this._initializeLoadState(e),this._showInitialLoadingSpinner(e);const{batchEvents:r,lastEventTime:i}=await this._collectInitialEvents(e,t,n);r?.length>0&&this._processBatchEvents(r,e).catch(console.error),await this.finalizeInitialization(e,i)}catch(n){throw n}}_showInitialLoadingSpinner(t){const e=this._getListElement(t);if(e){const n=this._createLoadTrigger();e.appendChild(n)}}async finalizeInitialization(t,e){const n=ft.getZapEvents(t),r=this._getListElement(t),i=ft.updateLoadState(t,{isInitialFetchComplete:!0,lastEventTime:e});await Promise.all([i,n.length===0?this.zapListUI?.showNoZapsMessage():null,n.length>=kt.REQ_CONFIG.INITIAL_LOAD_COUNT?this.setupInfiniteScroll(t):null]),r?.querySelector(".load-more-trigger")?.remove()}_initializeLoadState(t){ft.updateLoadState(t,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1})}_isValidFilter(t){return t&&t.relayUrls&&Array.isArray(t.relayUrls)&&t.relayUrls.length>0&&t.identifier}setupInfiniteScroll(t){try{this._cleanupInfiniteScroll(t);const e=this._getListElement(t);if(!e)return;const n=this._createLoadTrigger();e.appendChild(n),this._observeLoadTrigger(n,t,e)}catch{}}_createLoadTrigger(){const t=document.createElement("div");t.className="load-more-trigger";const e=document.createElement("div");return e.className="loading-spinner",t.appendChild(e),t}_observeLoadTrigger(t,e,n){const r=new IntersectionObserver((i=>this._handleIntersection(i[0],e)),{root:n,rootMargin:kt.INFINITE_SCROLL.ROOT_MARGIN,threshold:kt.INFINITE_SCROLL.THRESHOLD});r.observe(t),this.observers.set(e,r)}async _handleIntersection(t,e){t.isIntersecting&&(ft.getLoadState(e).isLoading?setTimeout((()=>{t.isIntersecting&&this._handleIntersection(t,e)}),kt.INFINITE_SCROLL.RETRY_DELAY):this.loadMoreZaps(e).then((n=>{n===0&&this._cleanupInfiniteScroll(e)})).catch((n=>{this._cleanupInfiniteScroll(e)})))}_cleanupInfiniteScroll(t){const e=this.observers.get(t);if(!e)return;e.disconnect(),this._getListElement(t)?.querySelector(".load-more-trigger")?.remove(),this.observers.delete(t)}_getListElement(t){return document.querySelector(`nzv-dialog[data-view-id="${t}"]`)?.shadowRoot?.querySelector(".dialog-zap-list")}async loadMoreZaps(t){const e=ft.getLoadState(t),n=this.getViewConfig(t);if(!this._canLoadMore(e,n))return 0;e.isLoading=!0;try{const r=await this._executeLoadMore(t,e,n);if(r>0){const i=ft.getZapEvents(t).slice(-r);await this.updateEventReferenceBatch(i,t),this.updateUIReferences(i)}return r}finally{e.isLoading=!1}}async _executeLoadMore(t,e,n){const r=rO(n.identifier,e.lastEventTime);if(!r)return 0;const i=[],s=setTimeout((()=>{i.length===0&&this._cleanupInfiniteScroll(t)}),kt.LOAD_TIMEOUT);try{return await this._collectEvents(t,n,r,i,kt.REQ_CONFIG.ADDITIONAL_LOAD_COUNT,e),i.length>0&&await this._processBatchEvents(i,t),i.length}catch{return 0}finally{clearTimeout(s)}}async _collectEvents(t,e,n,r,i,s){return new Promise(((o,a)=>{const l=setTimeout((()=>a(new Error("Load timeout"))),kt.LOAD_TIMEOUT);hu.subscribeToZaps(t,e,n,{onevent:c=>{c.created_at<s.lastEventTime&&(r.push(c),s.lastEventTime=Math.min(s.lastEventTime,c.created_at),r.length>=i&&(clearTimeout(l),o()))},oneose:()=>{clearTimeout(l),o()}})}))}async _collectInitialEvents(t,e,n){const r=[];let i=null;return new Promise((s=>{const o=this._setupBufferInterval(r,t),a=hu.subscribeToZaps(t,e,n,{onevent:l=>{const c=this._handleInitialEvent(l,r,i,t);c!==null&&(i=c)},oneose:()=>{clearInterval(o),s({batchEvents:[...r],lastEventTime:i})}});this.#e.set(t,{zap:a})}))}_handleInitialEvent(t,e,n,r){const i=Math.min(n||t.created_at,t.created_at);if(ft.addZapEvent(r,t)){if(e.push(t),this.updateEventReference(t,r).then((s=>{s&&this.zapListUI&&t.reference&&this.zapListUI.updateZapReference(t)})),t.isRealTimeEvent){const s=this.getViewConfig(r);jp.handleZapEvent(t,r,s?.identifier),this.zapListUI&&this.zapListUI.prependZap(t).catch(console.error)}e.length>=kt.BATCH_SIZE&&this.zapListUI&&this.zapListUI.batchUpdate(ft.getZapEvents(r)).catch(console.error)}return i}async _processBatchEvents(t,e){if(t?.length){t.sort(((n,r)=>r.created_at-n.created_at)),t.forEach((n=>ft.addZapEvent(e,n)));try{await Promise.all([Wp.processBatchProfiles(t)])}catch{}await this._updateUI(t,e)}}async _updateUI(t,e){this.zapListUI&&await this.zapListUI.batchUpdate(t,{isFullUpdate:!0})}_setupBufferInterval(t,e){let n=0;const r=kt.BUFFER_MIN_INTERVAL;return setInterval((()=>{const i=Date.now();t.length>0&&i-n>=r&&this.zapListUI&&(this.zapListUI.batchUpdate(ft.getZapEvents(e),{isBufferUpdate:!0}).catch(console.error),n=i)}),kt.BUFFER_INTERVAL)}_canLoadMore(t,e){return e&&!t.isLoading&&t.lastEventTime}unsubscribe(t){try{const e=this.#e.get(t);e?.zap&&(e.zap(),e.zap=null),this.#t.set(t,{isZapClosed:!0}),this._cleanupInfiniteScroll(t)}catch{}}};class hbe extends HTMLElement{#e;#t;constructor(){super(),this.attachShadow({mode:"open"}),this.#e={isInitialized:!1,theme:kt.DEFAULT_OPTIONS.theme},this.popStateHandler=e=>{e.preventDefault(),this.#s(".dialog")?.open&&this.closeDialog()}}async connectedCallback(){if(this.viewId=this.getAttribute("data-view-id"),this.viewId){this.#t=this.#n();try{await this.#t,this.#e.isInitialized=!0;const e=Mo.getViewConfig(this.viewId);if(!e)throw new Error("Config is required for initialization");if(await this.#r(e),this.getAttribute("data-nzv-id")){const n=await jp.getCurrentStats(this.viewId);n&&this.statsUI.displayStats(n)}this.#e.isInitialized=!0,this.dispatchEvent(new CustomEvent("dialog-initialized",{detail:{viewId:this.viewId}}))}catch{}}}async#n(){return new Promise((e=>{const n=document.createElement("template");n.innerHTML=$i.getDialogTemplate(),this.shadowRoot.appendChild(n.content.cloneNode(!0)),this.#i(),queueMicrotask((()=>e()))}))}async#r(e){const n=document.createElement("style");n.textContent=fbe(),this.shadowRoot.appendChild(n),this.statsUI=new Gye(this.shadowRoot),this.profileUI=new lbe,this.zapListUI=new ube(this.shadowRoot,this.profileUI,this.viewId,e),Mo.setZapListUI(this.zapListUI);const r=ft.getZapEvents(this.viewId);r?.length?await this.zapListUI.renderZapListFromCache(r):this.zapListUI.showNoZapsMessage();const i=this.getAttribute("data-nzv-id");if(i){const s=await ft.getCachedStats(this.viewId,i);if(s?.stats)this.statsUI.displayStats(s.stats);else{const o=await jp.getCurrentStats(this.viewId);o&&this.statsUI.displayStats(o)}}}static get observedAttributes(){return["data-theme"]}#i(){const e=this.#s(".dialog");this.#s(".close-dialog-button").addEventListener("click",(()=>this.closeDialog())),e.addEventListener("click",(n=>{n.target===e&&this.closeDialog()})),e.addEventListener("cancel",(n=>{n.preventDefault(),this.closeDialog()})),document.addEventListener("keydown",(n=>{if(e?.open){if(n.key==="Escape")this.closeDialog();else if(n.key===" "){n.preventDefault();const r=this.#s(".dialog-zap-list");r&&(r.scrollTop+=.8*r.clientHeight)}}}))}attributeChangedCallback(e,n,r){n!==r&&e==="data-theme"&&this.#o(r)}#o(e){ft.updateThemeState(this.viewId,{theme:e}).isInitialized&&this.#a()}#a(){const e=ft.getThemeState(this.viewId).theme==="dark"?"dark-theme":"light-theme";this.shadowRoot.host.classList.add(e)}async showDialog(){await this.#t;const e=this.#s(".dialog");e&&!e.open&&this.#e.isInitialized&&(window.addEventListener("popstate",this.popStateHandler),e.showModal(),queueMicrotask((()=>{document.activeElement&&document.activeElement.blur()})),this.#l())}closeDialog(){const e=this.#s(".dialog");e?.open&&(this.zapListUI?.destroy(),Mo.unsubscribe(this.viewId),e.close(),this.remove(),window.removeEventListener("popstate",this.popStateHandler))}displayZapStats(e){this.statsUI.displayStats(e)}#s(e){return this.shadowRoot.querySelector(e)}#l(){const e=this.getAttribute("data-view-id"),n=document.querySelector(`button[data-zap-view-id="${e}"]`);if(!n)return;const r=this.#s(".dialog-title"),i=this.#s(".dialog-title a");if(!i||!r)return;const s=n.getAttribute("data-title"),o=n.getAttribute("data-nzv-id");i.href=o?`https://njump.me/${o}`:"#",s?.trim()?(i.textContent=s,r.classList.add("custom-title")):(i.textContent=kt.DIALOG_CONFIG.DEFAULT_TITLE+OF(o),r.classList.remove("custom-title"))}getOperations(){if(!this.#e.isInitialized)return null;const e={closeDialog:()=>this.closeDialog(),showDialog:()=>this.showDialog()};return this.#e.isInitialized&&Object.assign(e,{prependZap:n=>this.zapListUI?.prependZap(n),displayZapStats:n=>this.statsUI?.displayStats(n),showNoZapsMessage:()=>this.zapListUI?.showNoZapsMessage()}),e}async waitForInitialization(){return this.#t}}customElements.define("nzv-dialog",hbe);const zy={create:async(t,e)=>{if(!t||!e)return Promise.reject(new Error("Invalid viewId or config"));Mo.setViewConfig(t,e);const n=document.querySelector(`nzv-dialog[data-view-id="${t}"]`);if(n)return n;const r=document.createElement("nzv-dialog");r.setAttribute("data-view-id",t),r.setAttribute("data-config",JSON.stringify(e));const i=document.querySelector(`button[data-zap-view-id="${t}"]`);return i?.getAttribute("data-nzv-id")&&r.setAttribute("data-nzv-id",i.getAttribute("data-nzv-id")),document.body.appendChild(r),await r.waitForInitialization(),r},get:t=>document.querySelector(`nzv-dialog[data-view-id="${t}"]`),execute:(t,e,...n)=>{const r=zy.get(t),i=r?.getOperations();return i?i[e]?.(...n)??null:null}},pbe=(t,e)=>zy.execute(e,"displayZapStats",t);async function mbe(t,e){try{const n=Vp.fromButton(t);if(!n)throw new Error("Failed to create config from button");if(Mo.setViewConfig(e,n),!await(async function(i){try{const s=Mo.getViewConfig(i);if(!s)throw new Error(`View configuration not found for viewId: ${i}`);return Mo.setViewConfig(i,s),await zy.create(i,s)}catch{return null}})(e))throw new Error(kt.ZAP_CONFIG.ERRORS.DIALOG_NOT_FOUND);await(async function(i){try{const s=zy.get(i);if(!s)throw new Error("Dialog not found");await s.waitForInitialization();const o=s.getOperations();if(!o?.showDialog)throw new Error("Basic dialog operations not available");o.showDialog()}catch{}})(e),setTimeout((async()=>{if(await(async function(i,s){const o=ft.getZapEvents(i);if(o.length>0){const l=[...new Set(o.map((c=>c.pubkey)))];Wp.fetchProfiles(l)}const{hasEnoughCachedEvents:a}=await ft.processCachedData(i,s);return a&&Mo.setupInfiniteScroll(i),a})(e,n),!t.hasAttribute("data-initialized")){const i=t.getAttribute("data-nzv-id");await Promise.all([hu.connectToRelays(n.relayUrls),Mo.initializeSubscriptions(n,e),i?jp.initializeStats(i,e,!0):Promise.resolve()]),t.setAttribute("data-initialized","true")}}),0)}catch{}}function DF(){Object.entries(kt.LIBRARIES).forEach((([t,e])=>{window[t]=e})),document.querySelectorAll("button[data-nzv-id]").forEach(((t,e)=>{if(t.hasAttribute("data-zap-view-id"))return;const n=`nostr-zap-view-${e}`;t.setAttribute("data-zap-view-id",n),t.hasAttribute("data-zap-color-mode")||t.setAttribute("data-zap-color-mode",kt.ZAP_CONFIG.DEFAULT_COLOR_MODE),t.addEventListener("click",(()=>mbe(t,n)))}))}function LF(t={}){Object.assign(kt,t),typeof window<"u"&&DF()}function gbe(t={}){return LF(t)}typeof window<"u"&&document.addEventListener("DOMContentLoaded",DF);ta.vQ;ta.ZM;ta.yk;ta.h0;ta.n_;var ybe=ta.Xz;ta.Uv;ta.fU;ta.Dw;var sO={},oO;function bbe(){if(oO)return sO;oO=1;var t=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof DC<"u"?DC:{};function e(v){return v&&v.__esModule?v.default:v}var n={},r={},i=t.parcelRequire1faa;i==null&&(i=function(v){if(v in n)return n[v].exports;if(v in r){var w=r[v];delete r[v];var A={id:v,exports:{}};return n[v]=A,w.call(A.exports,A,A.exports),A.exports}var D=new Error("Cannot find module '"+v+"'");throw D.code="MODULE_NOT_FOUND",D},i.register=function(w,A){r[w]=A},t.parcelRequire1faa=i),i.register("58QMB",function(v,w){(function(){function A(j,Z){var oe,me=Object.keys(Z);for(oe=0;oe<me.length;oe++)j=j.replace(new RegExp("\\{"+me[oe]+"\\}","gi"),Z[me[oe]]);return j}function D(j){var Z,oe,me;if(!j)throw new Error("cannot create a random attribute name for an undefined object");Z="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",oe="";do for(oe="",me=0;me<12;me++)oe+=Z[Math.floor(Math.random()*Z.length)];while(j[oe]);return oe}function $(j){var Z={left:"start",right:"end",center:"middle",start:"start",end:"end"};return Z[j]||Z.start}function U(j){var Z={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return Z[j]||Z.alphabetic}var q,W,ue,be,de;de=(function(j,Z){var oe,me,Se,Ce={};for(j=j.split(","),Z=Z||10,oe=0;oe<j.length;oe+=2)me="&"+j[oe+1]+";",Se=parseInt(j[oe],Z),Ce[me]="&#"+Se+";";return Ce["\\xa0"]="&#160;",Ce})("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),q={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},ue=function(j,Z){this.__root=j,this.__ctx=Z},ue.prototype.addColorStop=function(j,Z){var oe,me,Se=this.__ctx.__createElement("stop");Se.setAttribute("offset",j),Z.indexOf("rgba")!==-1?(oe=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,me=oe.exec(Z),Se.setAttribute("stop-color",A("rgb({r},{g},{b})",{r:me[1],g:me[2],b:me[3]})),Se.setAttribute("stop-opacity",me[4])):Se.setAttribute("stop-color",Z),this.__root.appendChild(Se)},be=function(j,Z){this.__root=j,this.__ctx=Z},W=function(j){var Z,oe={width:500,height:500,enableMirroring:!1};if(arguments.length>1?(Z=oe,Z.width=arguments[0],Z.height=arguments[1]):Z=j||oe,!(this instanceof W))return new W(Z);this.width=Z.width||oe.width,this.height=Z.height||oe.height,this.enableMirroring=Z.enableMirroring!==void 0?Z.enableMirroring:oe.enableMirroring,this.canvas=this,this.__document=Z.document||document,Z.ctx?this.__ctx=Z.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)},W.prototype.__createElement=function(j,Z,oe){Z===void 0&&(Z={});var me,Se,Ce=this.__document.createElementNS("http://www.w3.org/2000/svg",j),Ke=Object.keys(Z);for(oe&&(Ce.setAttribute("fill","none"),Ce.setAttribute("stroke","none")),me=0;me<Ke.length;me++)Se=Ke[me],Ce.setAttribute(Se,Z[Se]);return Ce},W.prototype.__setDefaultStyles=function(){var j,Z,oe=Object.keys(q);for(j=0;j<oe.length;j++)Z=oe[j],this[Z]=q[Z].canvas},W.prototype.__applyStyleState=function(j){var Z,oe,me=Object.keys(j);for(Z=0;Z<me.length;Z++)oe=me[Z],this[oe]=j[oe]},W.prototype.__getStyleState=function(){var j,Z,oe={},me=Object.keys(q);for(j=0;j<me.length;j++)Z=me[j],oe[Z]=this[Z];return oe},W.prototype.__applyStyleToCurrentElement=function(j){var Z=this.__currentElement,oe=this.__currentElementsToStyle;oe&&(Z.setAttribute(j,""),Z=oe.element,oe.children.forEach(function(fn){fn.setAttribute(j,"")}));var me,Se,Ce,Ke,Ne,rt,Je=Object.keys(q);for(me=0;me<Je.length;me++)if(Se=q[Je[me]],Ce=this[Je[me]],Se.apply){if(Ce instanceof be){if(Ce.__ctx)for(;Ce.__ctx.__defs.childNodes.length;)Ke=Ce.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[Ke]=Ke,this.__defs.appendChild(Ce.__ctx.__defs.childNodes[0]);Z.setAttribute(Se.apply,A("url(#{id})",{id:Ce.__root.getAttribute("id")}))}else if(Ce instanceof ue)Z.setAttribute(Se.apply,A("url(#{id})",{id:Ce.__root.getAttribute("id")}));else if(Se.apply.indexOf(j)!==-1&&Se.svg!==Ce)if(Se.svgAttr!=="stroke"&&Se.svgAttr!=="fill"||Ce.indexOf("rgba")===-1){var Ye=Se.svgAttr;if(Je[me]==="globalAlpha"&&(Ye=j+"-"+Se.svgAttr,Z.getAttribute(Ye)))continue;Z.setAttribute(Ye,Ce)}else{Ne=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,rt=Ne.exec(Ce),Z.setAttribute(Se.svgAttr,A("rgb({r},{g},{b})",{r:rt[1],g:rt[2],b:rt[3]}));var it=rt[4],dt=this.globalAlpha;dt!=null&&(it*=dt),Z.setAttribute(Se.svgAttr+"-opacity",it)}}},W.prototype.__closestGroupOrSvg=function(j){return j=j||this.__currentElement,j.nodeName==="g"||j.nodeName==="svg"?j:this.__closestGroupOrSvg(j.parentNode)},W.prototype.getSerializedSvg=function(j){var Z,oe,me,Se,Ce,Ke,Ne=new XMLSerializer().serializeToString(this.__root);if(Ke=/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi,Ke.test(Ne)&&(Ne=Ne.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),j)for(Z=Object.keys(de),oe=0;oe<Z.length;oe++)me=Z[oe],Se=de[me],Ce=new RegExp(me,"gi"),Ce.test(Ne)&&(Ne=Ne.replace(Ce,Se));return Ne},W.prototype.getSvg=function(){return this.__root},W.prototype.save=function(){var j=this.__createElement("g"),Z=this.__closestGroupOrSvg();this.__groupStack.push(Z),Z.appendChild(j),this.__currentElement=j,this.__stack.push(this.__getStyleState())},W.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var j=this.__stack.pop();this.__applyStyleState(j)},W.prototype.__addTransform=function(j){var Z=this.__closestGroupOrSvg();if(Z.childNodes.length>0){this.__currentElement.nodeName==="path"&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:Z,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var oe=this.__createElement("g");Z.appendChild(oe),this.__currentElement=oe}var me=this.__currentElement.getAttribute("transform");me?me+=" ":me="",me+=j,this.__currentElement.setAttribute("transform",me)},W.prototype.scale=function(j,Z){Z===void 0&&(Z=j),this.__addTransform(A("scale({x},{y})",{x:j,y:Z}))},W.prototype.rotate=function(j){var Z=180*j/Math.PI;this.__addTransform(A("rotate({angle},{cx},{cy})",{angle:Z,cx:0,cy:0}))},W.prototype.translate=function(j,Z){this.__addTransform(A("translate({x},{y})",{x:j,y:Z}))},W.prototype.transform=function(j,Z,oe,me,Se,Ce){this.__addTransform(A("matrix({a},{b},{c},{d},{e},{f})",{a:j,b:Z,c:oe,d:me,e:Se,f:Ce}))},W.prototype.beginPath=function(){var j,Z;this.__currentDefaultPath="",this.__currentPosition={},j=this.__createElement("path",{},!0),Z=this.__closestGroupOrSvg(),Z.appendChild(j),this.__currentElement=j},W.prototype.__applyCurrentDefaultPath=function(){var j=this.__currentElement;j.nodeName==="path"?j.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",j.nodeName)},W.prototype.__addPathCommand=function(j){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=j},W.prototype.moveTo=function(j,Z){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.__currentPosition={x:j,y:Z},this.__addPathCommand(A("M {x} {y}",{x:j,y:Z}))},W.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},W.prototype.lineTo=function(j,Z){this.__currentPosition={x:j,y:Z},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(A("L {x} {y}",{x:j,y:Z})):this.__addPathCommand(A("M {x} {y}",{x:j,y:Z}))},W.prototype.bezierCurveTo=function(j,Z,oe,me,Se,Ce){this.__currentPosition={x:Se,y:Ce},this.__addPathCommand(A("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:j,cp1y:Z,cp2x:oe,cp2y:me,x:Se,y:Ce}))},W.prototype.quadraticCurveTo=function(j,Z,oe,me){this.__currentPosition={x:oe,y:me},this.__addPathCommand(A("Q {cpx} {cpy} {x} {y}",{cpx:j,cpy:Z,x:oe,y:me}))};var ye=function(j){var Z=Math.sqrt(j[0]*j[0]+j[1]*j[1]);return[j[0]/Z,j[1]/Z]};W.prototype.arcTo=function(j,Z,oe,me,Se){var Ce=this.__currentPosition&&this.__currentPosition.x,Ke=this.__currentPosition&&this.__currentPosition.y;if(Ce!==void 0&&Ke!==void 0){if(Se<0)throw new Error("IndexSizeError: The radius provided ("+Se+") is negative.");if(Ce===j&&Ke===Z||j===oe&&Z===me||Se===0)return void this.lineTo(j,Z);var Ne=ye([Ce-j,Ke-Z]),rt=ye([oe-j,me-Z]);if(Ne[0]*rt[1]==Ne[1]*rt[0])return void this.lineTo(j,Z);var Je=Ne[0]*rt[0]+Ne[1]*rt[1],Ye=Math.acos(Math.abs(Je)),it=ye([Ne[0]+rt[0],Ne[1]+rt[1]]),dt=Se/Math.sin(Ye/2),fn=j+dt*it[0],te=Z+dt*it[1],se=[-Ne[1],Ne[0]],ee=[rt[1],-rt[0]],fe=function(Qe){var Ie=Qe[0];return Qe[1]>=0?Math.acos(Ie):-Math.acos(Ie)},we=fe(se),Oe=fe(ee);this.lineTo(fn+se[0]*Se,te+se[1]*Se),this.arc(fn,te,Se,we,Oe)}},W.prototype.stroke=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},W.prototype.fill=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},W.prototype.rect=function(j,Z,oe,me){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.moveTo(j,Z),this.lineTo(j+oe,Z),this.lineTo(j+oe,Z+me),this.lineTo(j,Z+me),this.lineTo(j,Z),this.closePath()},W.prototype.fillRect=function(j,Z,oe,me){var Se,Ce;Se=this.__createElement("rect",{x:j,y:Z,width:oe,height:me,"shape-rendering":"crispEdges"},!0),Ce=this.__closestGroupOrSvg(),Ce.appendChild(Se),this.__currentElement=Se,this.__applyStyleToCurrentElement("fill")},W.prototype.strokeRect=function(j,Z,oe,me){var Se,Ce;Se=this.__createElement("rect",{x:j,y:Z,width:oe,height:me},!0),Ce=this.__closestGroupOrSvg(),Ce.appendChild(Se),this.__currentElement=Se,this.__applyStyleToCurrentElement("stroke")},W.prototype.__clearCanvas=function(){for(var j=this.__closestGroupOrSvg(),Z=j.getAttribute("transform"),oe=this.__root.childNodes[1],me=oe.childNodes,Se=me.length-1;Se>=0;Se--)me[Se]&&oe.removeChild(me[Se]);this.__currentElement=oe,this.__groupStack=[],Z&&this.__addTransform(Z)},W.prototype.clearRect=function(j,Z,oe,me){if(j===0&&Z===0&&oe===this.width&&me===this.height)return void this.__clearCanvas();var Se,Ce=this.__closestGroupOrSvg();Se=this.__createElement("rect",{x:j,y:Z,width:oe,height:me,fill:"#FFFFFF"},!0),Ce.appendChild(Se)},W.prototype.createLinearGradient=function(j,Z,oe,me){var Se=this.__createElement("linearGradient",{id:D(this.__ids),x1:j+"px",x2:oe+"px",y1:Z+"px",y2:me+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(Se),new ue(Se,this)},W.prototype.createRadialGradient=function(j,Z,oe,me,Se,Ce){var Ke=this.__createElement("radialGradient",{id:D(this.__ids),cx:me+"px",cy:Se+"px",r:Ce+"px",fx:j+"px",fy:Z+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(Ke),new ue(Ke,this)},W.prototype.__parseFont=function(){var j=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i,Z=j.exec(this.font),oe={style:Z[1]||"normal",size:Z[4]||"10px",family:Z[6]||"sans-serif",weight:Z[3]||"normal",decoration:Z[2]||"normal",href:null};return this.__fontUnderline==="underline"&&(oe.decoration="underline"),this.__fontHref&&(oe.href=this.__fontHref),oe},W.prototype.__wrapTextLink=function(j,Z){if(j.href){var oe=this.__createElement("a");return oe.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",j.href),oe.appendChild(Z),oe}return Z},W.prototype.__applyText=function(j,Z,oe,me){var Se=this.__parseFont(),Ce=this.__closestGroupOrSvg(),Ke=this.__createElement("text",{"font-family":Se.family,"font-size":Se.size,"font-style":Se.style,"font-weight":Se.weight,"text-decoration":Se.decoration,x:Z,y:oe,"text-anchor":$(this.textAlign),"dominant-baseline":U(this.textBaseline)},!0);Ke.appendChild(this.__document.createTextNode(j)),this.__currentElement=Ke,this.__applyStyleToCurrentElement(me),Ce.appendChild(this.__wrapTextLink(Se,Ke))},W.prototype.fillText=function(j,Z,oe){this.__applyText(j,Z,oe,"fill")},W.prototype.strokeText=function(j,Z,oe){this.__applyText(j,Z,oe,"stroke")},W.prototype.measureText=function(j){return this.__ctx.font=this.font,this.__ctx.measureText(j)},W.prototype.arc=function(j,Z,oe,me,Se,Ce){if(me!==Se){me%=2*Math.PI,Se%=2*Math.PI,me===Se&&(Se=(Se+2*Math.PI-.001*(Ce?-1:1))%(2*Math.PI));var Ke=j+oe*Math.cos(Se),Ne=Z+oe*Math.sin(Se),rt=j+oe*Math.cos(me),Je=Z+oe*Math.sin(me),Ye=Ce?0:1,it=0,dt=Se-me;dt<0&&(dt+=2*Math.PI),it=Ce?dt>Math.PI?0:1:dt>Math.PI?1:0,this.lineTo(rt,Je),this.__addPathCommand(A("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:oe,ry:oe,xAxisRotation:0,largeArcFlag:it,sweepFlag:Ye,endX:Ke,endY:Ne})),this.__currentPosition={x:Ke,y:Ne}}},W.prototype.clip=function(){var j=this.__closestGroupOrSvg(),Z=this.__createElement("clipPath"),oe=D(this.__ids),me=this.__createElement("g");this.__applyCurrentDefaultPath(),j.removeChild(this.__currentElement),Z.setAttribute("id",oe),Z.appendChild(this.__currentElement),this.__defs.appendChild(Z),j.setAttribute("clip-path",A("url(#{id})",{id:oe})),j.appendChild(me),this.__currentElement=me},W.prototype.drawImage=function(){var j,Z,oe,me,Se,Ce,Ke,Ne,rt,Je,Ye,it,dt,fn,te=Array.prototype.slice.call(arguments),se=te[0],ee=0,fe=0;if(te.length===3)j=te[1],Z=te[2],Se=se.width,Ce=se.height,oe=Se,me=Ce;else if(te.length===5)j=te[1],Z=te[2],oe=te[3],me=te[4],Se=se.width,Ce=se.height;else{if(te.length!==9)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);ee=te[1],fe=te[2],Se=te[3],Ce=te[4],j=te[5],Z=te[6],oe=te[7],me=te[8]}Ke=this.__closestGroupOrSvg(),this.__currentElement;var we="translate("+j+", "+Z+")";if(se instanceof W){if(Ne=se.getSvg().cloneNode(!0),Ne.childNodes&&Ne.childNodes.length>1){for(rt=Ne.childNodes[0];rt.childNodes.length;)fn=rt.childNodes[0].getAttribute("id"),this.__ids[fn]=fn,this.__defs.appendChild(rt.childNodes[0]);if(Je=Ne.childNodes[1]){var Oe,Qe=Je.getAttribute("transform");Oe=Qe?Qe+" "+we:we,Je.setAttribute("transform",Oe),Ke.appendChild(Je)}}}else se.nodeName!=="CANVAS"&&se.nodeName!=="IMG"||(Ye=this.__createElement("image"),Ye.setAttribute("width",oe),Ye.setAttribute("height",me),Ye.setAttribute("preserveAspectRatio","none"),Ye.setAttribute("opacity",this.globalAlpha),(ee||fe||Se!==se.width||Ce!==se.height)&&(it=this.__document.createElement("canvas"),it.width=oe,it.height=me,dt=it.getContext("2d"),dt.drawImage(se,ee,fe,Se,Ce,0,0,oe,me),se=it),Ye.setAttribute("transform",we),Ye.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",se.nodeName==="CANVAS"?se.toDataURL():se.originalSrc),Ke.appendChild(Ye))},W.prototype.createPattern=function(j,Z){var oe,me=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),Se=D(this.__ids);return me.setAttribute("id",Se),me.setAttribute("width",j.width),me.setAttribute("height",j.height),j.nodeName==="CANVAS"||j.nodeName==="IMG"?(oe=this.__document.createElementNS("http://www.w3.org/2000/svg","image"),oe.setAttribute("width",j.width),oe.setAttribute("height",j.height),oe.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",j.nodeName==="CANVAS"?j.toDataURL():j.getAttribute("src")),me.appendChild(oe),this.__defs.appendChild(me)):j instanceof W&&(me.appendChild(j.__root.childNodes[1]),this.__defs.appendChild(me)),new be(me,this)},W.prototype.setLineDash=function(j){j&&j.length>0?this.lineDash=j.join(","):this.lineDash=null},W.prototype.drawFocusRing=function(){},W.prototype.createImageData=function(){},W.prototype.getImageData=function(){},W.prototype.putImageData=function(){},W.prototype.globalCompositeOperation=function(){},W.prototype.setTransform=function(){},typeof window=="object"&&(window.C2S=W),typeof v.exports=="object"&&(v.exports=W)})(),(function(){function A(te,se,ee){this.mode=Ke.MODE_8BIT_BYTE,this.data=te,this.parsedData=[];for(var fe=0,we=this.data.length;fe<we;fe++){var Oe=[],Qe=this.data.charCodeAt(fe);se?Oe[0]=Qe:Qe>65536?(Oe[0]=240|(1835008&Qe)>>>18,Oe[1]=128|(258048&Qe)>>>12,Oe[2]=128|(4032&Qe)>>>6,Oe[3]=128|63&Qe):Qe>2048?(Oe[0]=224|(61440&Qe)>>>12,Oe[1]=128|(4032&Qe)>>>6,Oe[2]=128|63&Qe):Qe>128?(Oe[0]=192|(1984&Qe)>>>6,Oe[1]=128|63&Qe):Oe[0]=Qe,this.parsedData.push(Oe)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),ee||this.parsedData.length==this.data.length||(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function D(te,se){this.typeNumber=te,this.errorCorrectLevel=se,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function $(te,se){if(te.length==de)throw new Error(te.length+"/"+se);for(var ee=0;ee<te.length&&te[ee]==0;)ee++;this.num=new Array(te.length-ee+se);for(var fe=0;fe<te.length-ee;fe++)this.num[fe]=te[fe+ee]}function U(te,se){this.totalCount=te,this.dataCount=se}function q(){this.buffer=[],this.length=0}function W(){var te=!1,se=navigator.userAgent;if(/android/i.test(se)){te=!0;var ee=se.toString().match(/android ([0-9]\.[0-9])/i);ee&&ee[1]&&(te=parseFloat(ee[1]))}return te}function ue(te,se){for(var ee=se.correctLevel,fe=1,we=be(te),Oe=0,Qe=dt.length;Oe<Qe;Oe++){var Ie=0;switch(ee){case Ne.L:Ie=dt[Oe][0];break;case Ne.M:Ie=dt[Oe][1];break;case Ne.Q:Ie=dt[Oe][2];break;case Ne.H:Ie=dt[Oe][3]}if(we<=Ie)break;fe++}if(fe>dt.length)throw new Error("Too long data. the CorrectLevel."+["M","L","H","Q"][ee]+" limit length is "+Ie);return se.version!=0&&(fe<=se.version?(fe=se.version,se.runVersion=fe):(console.warn("QR Code version "+se.version+" too small, run version use "+fe),se.runVersion=fe)),fe}function be(te){var se=encodeURI(te).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return se.length+(se.length!=te.length?3:0)}var de,ye,j=typeof t=="object"&&t&&t.Object===Object&&t,Z=typeof self=="object"&&self&&self.Object===Object&&self,oe=j||Z||Function("return this")(),me=w&&!w.nodeType&&w,Se=me&&!0&&v&&!v.nodeType&&v,Ce=oe.QRCode;A.prototype={getLength:function(te){return this.parsedData.length},write:function(te){for(var se=0,ee=this.parsedData.length;se<ee;se++)te.put(this.parsedData[se],8)}},D.prototype={addData:function(te,se,ee){var fe=new A(te,se,ee);this.dataList.push(fe),this.dataCache=null},isDark:function(te,se){if(te<0||this.moduleCount<=te||se<0||this.moduleCount<=se)throw new Error(te+","+se);return this.modules[te][se][0]},getEye:function(te,se){if(te<0||this.moduleCount<=te||se<0||this.moduleCount<=se)throw new Error(te+","+se);var ee=this.modules[te][se];if(ee[1]){var fe="P"+ee[1]+"_"+ee[2];return ee[2]=="A"&&(fe="A"+ee[1]),{isDark:ee[0],type:fe}}return null},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(te,se){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var ee=0;ee<this.moduleCount;ee++){this.modules[ee]=new Array(this.moduleCount);for(var fe=0;fe<this.moduleCount;fe++)this.modules[ee][fe]=[]}this.setupPositionProbePattern(0,0,"TL"),this.setupPositionProbePattern(this.moduleCount-7,0,"BL"),this.setupPositionProbePattern(0,this.moduleCount-7,"TR"),this.setupPositionAdjustPattern("A"),this.setupTimingPattern(),this.setupTypeInfo(te,se),this.typeNumber>=7&&this.setupTypeNumber(te),this.dataCache==null&&(this.dataCache=D.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,se)},setupPositionProbePattern:function(te,se,ee){for(var fe=-1;fe<=7;fe++)if(!(te+fe<=-1||this.moduleCount<=te+fe))for(var we=-1;we<=7;we++)se+we<=-1||this.moduleCount<=se+we||(0<=fe&&fe<=6&&(we==0||we==6)||0<=we&&we<=6&&(fe==0||fe==6)||2<=fe&&fe<=4&&2<=we&&we<=4?(this.modules[te+fe][se+we][0]=!0,this.modules[te+fe][se+we][2]=ee,this.modules[te+fe][se+we][1]=fe==-0||we==-0||fe==6||we==6?"O":"I"):this.modules[te+fe][se+we][0]=!1)},getBestMaskPattern:function(){for(var te=0,se=0,ee=0;ee<8;ee++){this.makeImpl(!0,ee);var fe=Je.getLostPoint(this);(ee==0||te>fe)&&(te=fe,se=ee)}return se},createMovieClip:function(te,se,ee){var fe=te.createEmptyMovieClip(se,ee);this.make();for(var we=0;we<this.modules.length;we++)for(var Oe=1*we,Qe=0;Qe<this.modules[we].length;Qe++){var Ie=1*Qe,ce=this.modules[we][Qe][0];ce&&(fe.beginFill(0,100),fe.moveTo(Ie,Oe),fe.lineTo(Ie+1,Oe),fe.lineTo(Ie+1,Oe+1),fe.lineTo(Ie,Oe+1),fe.endFill())}return fe},setupTimingPattern:function(){for(var te=8;te<this.moduleCount-8;te++)this.modules[te][6][0]==null&&(this.modules[te][6][0]=te%2==0);for(var se=8;se<this.moduleCount-8;se++)this.modules[6][se][0]==null&&(this.modules[6][se][0]=se%2==0)},setupPositionAdjustPattern:function(te){for(var se=Je.getPatternPosition(this.typeNumber),ee=0;ee<se.length;ee++)for(var fe=0;fe<se.length;fe++){var we=se[ee],Oe=se[fe];if(this.modules[we][Oe][0]==null)for(var Qe=-2;Qe<=2;Qe++)for(var Ie=-2;Ie<=2;Ie++)Qe==-2||Qe==2||Ie==-2||Ie==2||Qe==0&&Ie==0?(this.modules[we+Qe][Oe+Ie][0]=!0,this.modules[we+Qe][Oe+Ie][2]=te,this.modules[we+Qe][Oe+Ie][1]=Qe==-2||Ie==-2||Qe==2||Ie==2?"O":"I"):this.modules[we+Qe][Oe+Ie][0]=!1}},setupTypeNumber:function(te){for(var se=Je.getBCHTypeNumber(this.typeNumber),ee=0;ee<18;ee++){var fe=!te&&(se>>ee&1)==1;this.modules[Math.floor(ee/3)][ee%3+this.moduleCount-8-3][0]=fe}for(var ee=0;ee<18;ee++){var fe=!te&&(se>>ee&1)==1;this.modules[ee%3+this.moduleCount-8-3][Math.floor(ee/3)][0]=fe}},setupTypeInfo:function(te,se){for(var ee=this.errorCorrectLevel<<3|se,fe=Je.getBCHTypeInfo(ee),we=0;we<15;we++){var Oe=!te&&(fe>>we&1)==1;we<6?this.modules[we][8][0]=Oe:we<8?this.modules[we+1][8][0]=Oe:this.modules[this.moduleCount-15+we][8][0]=Oe}for(var we=0;we<15;we++){var Oe=!te&&(fe>>we&1)==1;we<8?this.modules[8][this.moduleCount-we-1][0]=Oe:we<9?this.modules[8][15-we-1+1][0]=Oe:this.modules[8][15-we-1][0]=Oe}this.modules[this.moduleCount-8][8][0]=!te},mapData:function(te,se){for(var ee=-1,fe=this.moduleCount-1,we=7,Oe=0,Qe=this.moduleCount-1;Qe>0;Qe-=2)for(Qe==6&&Qe--;;){for(var Ie=0;Ie<2;Ie++)if(this.modules[fe][Qe-Ie][0]==null){var ce=!1;Oe<te.length&&(ce=(te[Oe]>>>we&1)==1);var mn=Je.getMask(se,fe,Qe-Ie);mn&&(ce=!ce),this.modules[fe][Qe-Ie][0]=ce,we--,we==-1&&(Oe++,we=7)}if((fe+=ee)<0||this.moduleCount<=fe){fe-=ee,ee=-ee;break}}}},D.PAD0=236,D.PAD1=17,D.createData=function(te,se,ee){for(var fe=U.getRSBlocks(te,se),we=new q,Oe=0;Oe<ee.length;Oe++){var Qe=ee[Oe];we.put(Qe.mode,4),we.put(Qe.getLength(),Je.getLengthInBits(Qe.mode,te)),Qe.write(we)}for(var Ie=0,Oe=0;Oe<fe.length;Oe++)Ie+=fe[Oe].dataCount;if(we.getLengthInBits()>8*Ie)throw new Error("code length overflow. ("+we.getLengthInBits()+">"+8*Ie+")");for(we.getLengthInBits()+4<=8*Ie&&we.put(0,4);we.getLengthInBits()%8!=0;)we.putBit(!1);for(;!(we.getLengthInBits()>=8*Ie||(we.put(D.PAD0,8),we.getLengthInBits()>=8*Ie));)we.put(D.PAD1,8);return D.createBytes(we,fe)},D.createBytes=function(te,se){for(var ee=0,fe=0,we=0,Oe=new Array(se.length),Qe=new Array(se.length),Ie=0;Ie<se.length;Ie++){var ce=se[Ie].dataCount,mn=se[Ie].totalCount-ce;fe=Math.max(fe,ce),we=Math.max(we,mn),Oe[Ie]=new Array(ce);for(var At=0;At<Oe[Ie].length;At++)Oe[Ie][At]=255&te.buffer[At+ee];ee+=ce;var Xn=Je.getErrorCorrectPolynomial(mn),yt=new $(Oe[Ie],Xn.getLength()-1),Ni=yt.mod(Xn);Qe[Ie]=new Array(Xn.getLength()-1);for(var At=0;At<Qe[Ie].length;At++){var mi=At+Ni.getLength()-Qe[Ie].length;Qe[Ie][At]=mi>=0?Ni.get(mi):0}}for(var aa=0,At=0;At<se.length;At++)aa+=se[At].totalCount;for(var Xi=new Array(aa),_r=0,At=0;At<fe;At++)for(var Ie=0;Ie<se.length;Ie++)At<Oe[Ie].length&&(Xi[_r++]=Oe[Ie][At]);for(var At=0;At<we;At++)for(var Ie=0;Ie<se.length;Ie++)At<Qe[Ie].length&&(Xi[_r++]=Qe[Ie][At]);return Xi};for(var Ke={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Ne={L:1,M:0,Q:3,H:2},rt={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},Je={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(te){for(var se=te<<10;Je.getBCHDigit(se)-Je.getBCHDigit(Je.G15)>=0;)se^=Je.G15<<Je.getBCHDigit(se)-Je.getBCHDigit(Je.G15);return(te<<10|se)^Je.G15_MASK},getBCHTypeNumber:function(te){for(var se=te<<12;Je.getBCHDigit(se)-Je.getBCHDigit(Je.G18)>=0;)se^=Je.G18<<Je.getBCHDigit(se)-Je.getBCHDigit(Je.G18);return te<<12|se},getBCHDigit:function(te){for(var se=0;te!=0;)se++,te>>>=1;return se},getPatternPosition:function(te){return Je.PATTERN_POSITION_TABLE[te-1]},getMask:function(te,se,ee){switch(te){case rt.PATTERN000:return(se+ee)%2==0;case rt.PATTERN001:return se%2==0;case rt.PATTERN010:return ee%3==0;case rt.PATTERN011:return(se+ee)%3==0;case rt.PATTERN100:return(Math.floor(se/2)+Math.floor(ee/3))%2==0;case rt.PATTERN101:return se*ee%2+se*ee%3==0;case rt.PATTERN110:return(se*ee%2+se*ee%3)%2==0;case rt.PATTERN111:return(se*ee%3+(se+ee)%2)%2==0;default:throw new Error("bad maskPattern:"+te)}},getErrorCorrectPolynomial:function(te){for(var se=new $([1],0),ee=0;ee<te;ee++)se=se.multiply(new $([1,Ye.gexp(ee)],0));return se},getLengthInBits:function(te,se){if(1<=se&&se<10)switch(te){case Ke.MODE_NUMBER:return 10;case Ke.MODE_ALPHA_NUM:return 9;case Ke.MODE_8BIT_BYTE:case Ke.MODE_KANJI:return 8;default:throw new Error("mode:"+te)}else if(se<27)switch(te){case Ke.MODE_NUMBER:return 12;case Ke.MODE_ALPHA_NUM:return 11;case Ke.MODE_8BIT_BYTE:return 16;case Ke.MODE_KANJI:return 10;default:throw new Error("mode:"+te)}else{if(!(se<41))throw new Error("type:"+se);switch(te){case Ke.MODE_NUMBER:return 14;case Ke.MODE_ALPHA_NUM:return 13;case Ke.MODE_8BIT_BYTE:return 16;case Ke.MODE_KANJI:return 12;default:throw new Error("mode:"+te)}}},getLostPoint:function(te){for(var se=te.getModuleCount(),ee=0,fe=0;fe<se;fe++)for(var we=0;we<se;we++){for(var Oe=0,Qe=te.isDark(fe,we),Ie=-1;Ie<=1;Ie++)if(!(fe+Ie<0||se<=fe+Ie))for(var ce=-1;ce<=1;ce++)we+ce<0||se<=we+ce||Ie==0&&ce==0||Qe==te.isDark(fe+Ie,we+ce)&&Oe++;Oe>5&&(ee+=3+Oe-5)}for(var fe=0;fe<se-1;fe++)for(var we=0;we<se-1;we++){var mn=0;te.isDark(fe,we)&&mn++,te.isDark(fe+1,we)&&mn++,te.isDark(fe,we+1)&&mn++,te.isDark(fe+1,we+1)&&mn++,mn!=0&&mn!=4||(ee+=3)}for(var fe=0;fe<se;fe++)for(var we=0;we<se-6;we++)te.isDark(fe,we)&&!te.isDark(fe,we+1)&&te.isDark(fe,we+2)&&te.isDark(fe,we+3)&&te.isDark(fe,we+4)&&!te.isDark(fe,we+5)&&te.isDark(fe,we+6)&&(ee+=40);for(var we=0;we<se;we++)for(var fe=0;fe<se-6;fe++)te.isDark(fe,we)&&!te.isDark(fe+1,we)&&te.isDark(fe+2,we)&&te.isDark(fe+3,we)&&te.isDark(fe+4,we)&&!te.isDark(fe+5,we)&&te.isDark(fe+6,we)&&(ee+=40);for(var At=0,we=0;we<se;we++)for(var fe=0;fe<se;fe++)te.isDark(fe,we)&&At++;return ee+=Math.abs(100*At/se/se-50)/5*10}},Ye={glog:function(te){if(te<1)throw new Error("glog("+te+")");return Ye.LOG_TABLE[te]},gexp:function(te){for(;te<0;)te+=255;for(;te>=256;)te-=255;return Ye.EXP_TABLE[te]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},it=0;it<8;it++)Ye.EXP_TABLE[it]=1<<it;for(var it=8;it<256;it++)Ye.EXP_TABLE[it]=Ye.EXP_TABLE[it-4]^Ye.EXP_TABLE[it-5]^Ye.EXP_TABLE[it-6]^Ye.EXP_TABLE[it-8];for(var it=0;it<255;it++)Ye.LOG_TABLE[Ye.EXP_TABLE[it]]=it;$.prototype={get:function(te){return this.num[te]},getLength:function(){return this.num.length},multiply:function(te){for(var se=new Array(this.getLength()+te.getLength()-1),ee=0;ee<this.getLength();ee++)for(var fe=0;fe<te.getLength();fe++)se[ee+fe]^=Ye.gexp(Ye.glog(this.get(ee))+Ye.glog(te.get(fe)));return new $(se,0)},mod:function(te){if(this.getLength()-te.getLength()<0)return this;for(var se=Ye.glog(this.get(0))-Ye.glog(te.get(0)),ee=new Array(this.getLength()),fe=0;fe<this.getLength();fe++)ee[fe]=this.get(fe);for(var fe=0;fe<te.getLength();fe++)ee[fe]^=Ye.gexp(Ye.glog(te.get(fe))+se);return new $(ee,0).mod(te)}},U.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],U.getRSBlocks=function(te,se){var ee=U.getRsBlockTable(te,se);if(ee==de)throw new Error("bad rs block @ typeNumber:"+te+"/errorCorrectLevel:"+se);for(var fe=ee.length/3,we=[],Oe=0;Oe<fe;Oe++)for(var Qe=ee[3*Oe+0],Ie=ee[3*Oe+1],ce=ee[3*Oe+2],mn=0;mn<Qe;mn++)we.push(new U(Ie,ce));return we},U.getRsBlockTable=function(te,se){switch(se){case Ne.L:return U.RS_BLOCK_TABLE[4*(te-1)+0];case Ne.M:return U.RS_BLOCK_TABLE[4*(te-1)+1];case Ne.Q:return U.RS_BLOCK_TABLE[4*(te-1)+2];case Ne.H:return U.RS_BLOCK_TABLE[4*(te-1)+3];default:return de}},q.prototype={get:function(te){var se=Math.floor(te/8);return(this.buffer[se]>>>7-te%8&1)==1},put:function(te,se){for(var ee=0;ee<se;ee++)this.putBit((te>>>se-ee-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(te){var se=Math.floor(this.length/8);this.buffer.length<=se&&this.buffer.push(0),te&&(this.buffer[se]|=128>>>this.length%8),this.length++}};var dt=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],fn=(function(){return typeof CanvasRenderingContext2D<"u"})()?(function(){function te(){if(this._htOption.drawer=="svg"){var Oe=this._oContext.getSerializedSvg(!0);this.dataURL=Oe,this._el.innerHTML=Oe}else try{var Qe=this._elCanvas.toDataURL("image/png");this.dataURL=Qe}catch(Ie){console.error(Ie)}this._htOption.onRenderingEnd&&(this.dataURL||console.error("Can not get base64 data, please check: 1. Published the page and image to the server 2. The image request support CORS 3. Configured `crossOrigin:'anonymous'` option"),this._htOption.onRenderingEnd(this._htOption,this.dataURL))}function se(Oe,Qe){var Ie=this;if(Ie._fFail=Qe,Ie._fSuccess=Oe,Ie._bSupportDataURI===null){var ce=document.createElement("img"),mn=function(){Ie._bSupportDataURI=!1,Ie._fFail&&Ie._fFail.call(Ie)},At=function(){Ie._bSupportDataURI=!0,Ie._fSuccess&&Ie._fSuccess.call(Ie)};return ce.onabort=mn,ce.onerror=mn,ce.onload=At,void(ce.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}Ie._bSupportDataURI===!0&&Ie._fSuccess?Ie._fSuccess.call(Ie):Ie._bSupportDataURI===!1&&Ie._fFail&&Ie._fFail.call(Ie)}if(oe._android&&oe._android<=2.1){var ee=1/window.devicePixelRatio,fe=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(Oe,Qe,Ie,ce,mn,At,Xn,yt,Ni){if("nodeName"in Oe&&/img/i.test(Oe.nodeName))for(var mi=arguments.length-1;mi>=1;mi--)arguments[mi]=arguments[mi]*ee;else yt===void 0&&(arguments[1]*=ee,arguments[2]*=ee,arguments[3]*=ee,arguments[4]*=ee);fe.apply(this,arguments)}}var we=function(Oe,Qe){this._bIsPainted=!1,this._android=W(),this._el=Oe,this._htOption=Qe,this._htOption.drawer=="svg"?(this._oContext={},this._elCanvas={}):(this._elCanvas=document.createElement("canvas"),this._el.appendChild(this._elCanvas),this._oContext=this._elCanvas.getContext("2d")),this._bSupportDataURI=null,this.dataURL=null};return we.prototype.draw=function(Oe){function Qe(){ce.quietZone>0&&ce.quietZoneColor&&(yt.lineWidth=0,yt.fillStyle=ce.quietZoneColor,yt.fillRect(0,0,Ni._elCanvas.width,ce.quietZone),yt.fillRect(0,ce.quietZone,ce.quietZone,Ni._elCanvas.height-2*ce.quietZone),yt.fillRect(Ni._elCanvas.width-ce.quietZone,ce.quietZone,ce.quietZone,Ni._elCanvas.height-2*ce.quietZone),yt.fillRect(0,Ni._elCanvas.height-ce.quietZone,Ni._elCanvas.width,ce.quietZone))}function Ie(aa){function Xi($s){var Cr=Math.round(ce.width/3.5),Di=Math.round(ce.height/3.5);Cr!==Di&&(Cr=Di),ce.logoMaxWidth?Cr=Math.round(ce.logoMaxWidth):ce.logoWidth&&(Cr=Math.round(ce.logoWidth)),ce.logoMaxHeight?Di=Math.round(ce.logoMaxHeight):ce.logoHeight&&(Di=Math.round(ce.logoHeight));var bl,wl;$s.naturalWidth===void 0?(bl=$s.width,wl=$s.height):(bl=$s.naturalWidth,wl=$s.naturalHeight),(ce.logoMaxWidth||ce.logoMaxHeight)&&(ce.logoMaxWidth&&bl<=Cr&&(Cr=bl),ce.logoMaxHeight&&wl<=Di&&(Di=wl),bl<=Cr&&wl<=Di&&(Cr=bl,Di=wl));var $w=(ce.width+2*ce.quietZone-Cr)/2,zw=(ce.height+ce.titleHeight+2*ce.quietZone-Di)/2,j_=Math.min(Cr/bl,Di/wl),Uw=bl*j_,Hw=wl*j_;(ce.logoMaxWidth||ce.logoMaxHeight)&&(Cr=Uw,Di=Hw,$w=(ce.width+2*ce.quietZone-Cr)/2,zw=(ce.height+ce.titleHeight+2*ce.quietZone-Di)/2),ce.logoBackgroundTransparent||(yt.fillStyle=ce.logoBackgroundColor,yt.fillRect($w,zw,Cr,Di));var s7=yt.imageSmoothingQuality,o7=yt.imageSmoothingEnabled;yt.imageSmoothingEnabled=!0,yt.imageSmoothingQuality="high",yt.drawImage($s,$w+(Cr-Uw)/2,zw+(Di-Hw)/2,Uw,Hw),yt.imageSmoothingEnabled=o7,yt.imageSmoothingQuality=s7,Qe(),td._bIsPainted=!0,td.makeImage()}ce.onRenderingStart&&ce.onRenderingStart(ce);for(var _r=0;_r<mn;_r++)for(var Ri=0;Ri<mn;Ri++){var yl=Ri*At+ce.quietZone,Hc=_r*Xn+ce.quietZone,th=aa.isDark(_r,Ri),Vr=aa.getEye(_r,Ri),Hn=ce.dotScale;yt.lineWidth=0;var ir,Wr;Vr?(ir=ce[Vr.type]||ce[Vr.type.substring(0,2)]||ce.colorDark,Wr=ce.colorLight):ce.backgroundImage?(Wr="rgba(0,0,0,0)",_r==6?ce.autoColor?(ir=ce.timing_H||ce.timing||ce.autoColorDark,Wr=ce.autoColorLight):ir=ce.timing_H||ce.timing||ce.colorDark:Ri==6?ce.autoColor?(ir=ce.timing_V||ce.timing||ce.autoColorDark,Wr=ce.autoColorLight):ir=ce.timing_V||ce.timing||ce.colorDark:ce.autoColor?(ir=ce.autoColorDark,Wr=ce.autoColorLight):ir=ce.colorDark):(ir=_r==6?ce.timing_H||ce.timing||ce.colorDark:Ri==6&&(ce.timing_V||ce.timing)||ce.colorDark,Wr=ce.colorLight),yt.strokeStyle=th?ir:Wr,yt.fillStyle=th?ir:Wr,Vr?(Hn=Vr.type=="AO"?ce.dotScaleAO:Vr.type=="AI"?ce.dotScaleAI:1,ce.backgroundImage&&ce.autoColor?(ir=(Vr.type=="AO"?ce.AI:ce.AO)||ce.autoColorDark,Wr=ce.autoColorLight):ir=(Vr.type=="AO"?ce.AI:ce.AO)||ir,th=Vr.isDark,yt.fillRect(yl+At*(1-Hn)/2,ce.titleHeight+Hc+Xn*(1-Hn)/2,At*Hn,Xn*Hn)):_r==6?(Hn=ce.dotScaleTiming_H,yt.fillRect(yl+At*(1-Hn)/2,ce.titleHeight+Hc+Xn*(1-Hn)/2,At*Hn,Xn*Hn)):Ri==6?(Hn=ce.dotScaleTiming_V,yt.fillRect(yl+At*(1-Hn)/2,ce.titleHeight+Hc+Xn*(1-Hn)/2,At*Hn,Xn*Hn)):(ce.backgroundImage,yt.fillRect(yl+At*(1-Hn)/2,ce.titleHeight+Hc+Xn*(1-Hn)/2,At*Hn,Xn*Hn)),ce.dotScale==1||Vr||(yt.strokeStyle=ce.colorLight)}if(ce.title&&(yt.fillStyle=ce.titleBackgroundColor,yt.fillRect(ce.quietZone,ce.quietZone,ce.width,ce.titleHeight),yt.font=ce.titleFont,yt.fillStyle=ce.titleColor,yt.textAlign="center",yt.fillText(ce.title,this._elCanvas.width/2,+ce.quietZone+ce.titleTop)),ce.subTitle&&(yt.font=ce.subTitleFont,yt.fillStyle=ce.subTitleColor,yt.fillText(ce.subTitle,this._elCanvas.width/2,+ce.quietZone+ce.subTitleTop)),ce.logo){var la=new Image,td=this;la.onload=function(){Xi(la)},la.onerror=function($s){console.error($s)},ce.crossOrigin!=null&&(la.crossOrigin=ce.crossOrigin),la.originalSrc=ce.logo,la.src=ce.logo}else Qe(),this._bIsPainted=!0,this.makeImage()}var ce=this._htOption,mn=Oe.getModuleCount(),At=Math.round(ce.width/mn),Xn=Math.round((ce.height-ce.titleHeight)/mn);At<=1&&(At=1),Xn<=1&&(Xn=1),ce.width=At*mn,ce.height=Xn*mn+ce.titleHeight,ce.quietZone=Math.round(ce.quietZone),this._elCanvas.width=ce.width+2*ce.quietZone,this._elCanvas.height=ce.height+2*ce.quietZone,this._htOption.drawer!="canvas"&&(this._oContext=new C2S(this._elCanvas.width,this._elCanvas.height)),this.clear();var yt=this._oContext;yt.lineWidth=0,yt.fillStyle=ce.colorLight,yt.fillRect(0,0,this._elCanvas.width,this._elCanvas.height),yt.clearRect(ce.quietZone,ce.quietZone,ce.width,ce.titleHeight);var Ni=this;if(ce.backgroundImage){var mi=new Image;mi.onload=function(){yt.globalAlpha=1,yt.globalAlpha=ce.backgroundImageAlpha;var aa=yt.imageSmoothingQuality,Xi=yt.imageSmoothingEnabled;yt.imageSmoothingEnabled=!0,yt.imageSmoothingQuality="high",yt.drawImage(mi,0,ce.titleHeight,ce.width+2*ce.quietZone,ce.height+2*ce.quietZone-ce.titleHeight),yt.imageSmoothingEnabled=Xi,yt.imageSmoothingQuality=aa,yt.globalAlpha=1,Ie.call(Ni,Oe)},ce.crossOrigin!=null&&(mi.crossOrigin=ce.crossOrigin),mi.originalSrc=ce.backgroundImage,mi.src=ce.backgroundImage}else Ie.call(Ni,Oe)},we.prototype.makeImage=function(){this._bIsPainted&&se.call(this,te)},we.prototype.isPainted=function(){return this._bIsPainted},we.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},we.prototype.remove=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1,this._el.innerHTML=""},we.prototype.round=function(Oe){return Oe&&Math.floor(1e3*Oe)/1e3},we})():(function(){var te=function(se,ee){this._el=se,this._htOption=ee};return te.prototype.draw=function(se){var ee=this._htOption,fe=this._el,we=se.getModuleCount(),Oe=Math.round(ee.width/we),Qe=Math.round((ee.height-ee.titleHeight)/we);Oe<=1&&(Oe=1),Qe<=1&&(Qe=1),this._htOption.width=Oe*we,this._htOption.height=Qe*we+ee.titleHeight,this._htOption.quietZone=Math.round(this._htOption.quietZone);var Ie=[],ce="",mn=Math.round(Oe*ee.dotScale),At=Math.round(Qe*ee.dotScale);mn<4&&(mn=4,At=4);var Xn=ee.colorDark,yt=ee.colorLight;if(ee.backgroundImage){ee.autoColor?(ee.colorDark="rgba(0, 0, 0, .6);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#99000000', EndColorStr='#99000000');",ee.colorLight="rgba(255, 255, 255, .7);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#B2FFFFFF', EndColorStr='#B2FFFFFF');"):ee.colorLight="rgba(0,0,0,0)";var Ni='<div style="display:inline-block; z-index:-10;position:absolute;"><img src="'+ee.backgroundImage+'" widht="'+(ee.width+2*ee.quietZone)+'" height="'+(ee.height+2*ee.quietZone)+'" style="opacity:'+ee.backgroundImageAlpha+";filter:alpha(opacity="+100*ee.backgroundImageAlpha+'); "/></div>';Ie.push(Ni)}if(ee.quietZone&&(ce="display:inline-block; width:"+(ee.width+2*ee.quietZone)+"px; height:"+(ee.width+2*ee.quietZone)+"px;background:"+ee.quietZoneColor+"; text-align:center;"),Ie.push('<div style="font-size:0;'+ce+'">'),Ie.push('<table  style="font-size:0;border:0;border-collapse:collapse; margin-top:'+ee.quietZone+'px;" border="0" cellspacing="0" cellspadding="0" align="center" valign="middle">'),Ie.push('<tr height="'+ee.titleHeight+'" align="center"><td style="border:0;border-collapse:collapse;margin:0;padding:0" colspan="'+we+'">'),ee.title){var mi=ee.titleColor,aa=ee.titleFont;Ie.push('<div style="width:100%;margin-top:'+ee.titleTop+"px;color:"+mi+";font:"+aa+";background:"+ee.titleBackgroundColor+'">'+ee.title+"</div>")}ee.subTitle&&Ie.push('<div style="width:100%;margin-top:'+(ee.subTitleTop-ee.titleTop)+"px;color:"+ee.subTitleColor+"; font:"+ee.subTitleFont+'">'+ee.subTitle+"</div>"),Ie.push("</td></tr>");for(var Xi=0;Xi<we;Xi++){Ie.push('<tr style="border:0; padding:0; margin:0;" height="7">');for(var _r=0;_r<we;_r++){var Ri=se.isDark(Xi,_r),yl=se.getEye(Xi,_r);if(yl){Ri=yl.isDark;var Hc=yl.type,th=ee[Hc]||ee[Hc.substring(0,2)]||Xn;Ie.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Oe+"px;height:"+Qe+'px;"><span style="width:'+Oe+"px;height:"+Qe+"px;background-color:"+(Ri?th:yt)+';display:inline-block"></span></td>')}else{var Vr=ee.colorDark;Xi==6?(Vr=ee.timing_H||ee.timing||Xn,Ie.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Oe+"px;height:"+Qe+"px;background-color:"+(Ri?Vr:yt)+';"></td>')):_r==6?(Vr=ee.timing_V||ee.timing||Xn,Ie.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Oe+"px;height:"+Qe+"px;background-color:"+(Ri?Vr:yt)+';"></td>')):Ie.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Oe+"px;height:"+Qe+'px;"><div style="display:inline-block;width:'+mn+"px;height:"+At+"px;background-color:"+(Ri?Vr:ee.colorLight)+';"></div></td>')}}Ie.push("</tr>")}if(Ie.push("</table>"),Ie.push("</div>"),ee.logo){var Hn=new Image;ee.crossOrigin!=null&&(Hn.crossOrigin=ee.crossOrigin),Hn.src=ee.logo;var ir=ee.width/3.5,Wr=ee.height/3.5;ir!=Wr&&(ir=Wr),ee.logoWidth&&(ir=ee.logoWidth),ee.logoHeight&&(Wr=ee.logoHeight);var la="position:relative; z-index:1;display:table-cell;top:-"+((ee.height-ee.titleHeight)/2+Wr/2+ee.quietZone)+"px;text-align:center; width:"+ir+"px; height:"+Wr+"px;line-height:"+ir+"px; vertical-align: middle;";ee.logoBackgroundTransparent||(la+="background:"+ee.logoBackgroundColor),Ie.push('<div style="'+la+'"><img  src="'+ee.logo+'"  style="max-width: '+ir+"px; max-height: "+Wr+'px;" /> <div style=" display: none; width:1px;margin-left: -1px;"></div></div>')}ee.onRenderingStart&&ee.onRenderingStart(ee),fe.innerHTML=Ie.join("");var td=fe.childNodes[0],$s=(ee.width-td.offsetWidth)/2,Cr=(ee.height-td.offsetHeight)/2;$s>0&&Cr>0&&(td.style.margin=Cr+"px "+$s+"px"),this._htOption.onRenderingEnd&&this._htOption.onRenderingEnd(this._htOption,null)},te.prototype.clear=function(){this._el.innerHTML=""},te})();ye=function(te,se){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:Ne.H,dotScale:1,dotScaleTiming:1,dotScaleTiming_H:de,dotScaleTiming_V:de,dotScaleA:1,dotScaleAO:de,dotScaleAI:de,quietZone:0,quietZoneColor:"rgba(0,0,0,0)",title:"",titleFont:"normal normal bold 16px Arial",titleColor:"#000000",titleBackgroundColor:"#ffffff",titleHeight:0,titleTop:30,subTitle:"",subTitleFont:"normal normal normal 14px Arial",subTitleColor:"#4F4F4F",subTitleTop:60,logo:de,logoWidth:de,logoHeight:de,logoMaxWidth:de,logoMaxHeight:de,logoBackgroundColor:"#ffffff",logoBackgroundTransparent:!1,PO:de,PI:de,PO_TL:de,PI_TL:de,PO_TR:de,PI_TR:de,PO_BL:de,PI_BL:de,AO:de,AI:de,timing:de,timing_H:de,timing_V:de,backgroundImage:de,backgroundImageAlpha:1,autoColor:!1,autoColorDark:"rgba(0, 0, 0, .6)",autoColorLight:"rgba(255, 255, 255, .7)",onRenderingStart:de,onRenderingEnd:de,version:0,tooltip:!1,binary:!1,drawer:"canvas",crossOrigin:null,utf8WithoutBOM:!0},typeof se=="string"&&(se={text:se}),se)for(var ee in se)this._htOption[ee]=se[ee];this._htOption.title||this._htOption.subTitle||(this._htOption.titleHeight=0),(this._htOption.version<0||this._htOption.version>40)&&(console.warn("QR Code version '"+this._htOption.version+"' is invalidate, reset to 0"),this._htOption.version=0),(this._htOption.dotScale<0||this._htOption.dotScale>1)&&(console.warn(this._htOption.dotScale+" , is invalidate, dotScale must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScale=1),(this._htOption.dotScaleTiming<0||this._htOption.dotScaleTiming>1)&&(console.warn(this._htOption.dotScaleTiming+" , is invalidate, dotScaleTiming must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming=1),this._htOption.dotScaleTiming_H?(this._htOption.dotScaleTiming_H<0||this._htOption.dotScaleTiming_H>1)&&(console.warn(this._htOption.dotScaleTiming_H+" , is invalidate, dotScaleTiming_H must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_H=1):this._htOption.dotScaleTiming_H=this._htOption.dotScaleTiming,this._htOption.dotScaleTiming_V?(this._htOption.dotScaleTiming_V<0||this._htOption.dotScaleTiming_V>1)&&(console.warn(this._htOption.dotScaleTiming_V+" , is invalidate, dotScaleTiming_V must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_V=1):this._htOption.dotScaleTiming_V=this._htOption.dotScaleTiming,(this._htOption.dotScaleA<0||this._htOption.dotScaleA>1)&&(console.warn(this._htOption.dotScaleA+" , is invalidate, dotScaleA must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleA=1),this._htOption.dotScaleAO?(this._htOption.dotScaleAO<0||this._htOption.dotScaleAO>1)&&(console.warn(this._htOption.dotScaleAO+" , is invalidate, dotScaleAO must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAO=1):this._htOption.dotScaleAO=this._htOption.dotScaleA,this._htOption.dotScaleAI?(this._htOption.dotScaleAI<0||this._htOption.dotScaleAI>1)&&(console.warn(this._htOption.dotScaleAI+" , is invalidate, dotScaleAI must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAI=1):this._htOption.dotScaleAI=this._htOption.dotScaleA,(this._htOption.backgroundImageAlpha<0||this._htOption.backgroundImageAlpha>1)&&(console.warn(this._htOption.backgroundImageAlpha+" , is invalidate, backgroundImageAlpha must between 0 and 1, now reset to 1. "),this._htOption.backgroundImageAlpha=1),this._htOption.height=this._htOption.height+this._htOption.titleHeight,typeof te=="string"&&(te=document.getElementById(te)),(!this._htOption.drawer||this._htOption.drawer!="svg"&&this._htOption.drawer!="canvas")&&(this._htOption.drawer="canvas"),this._android=W(),this._el=te,this._oQRCode=null,this._htOption._element=te;var fe={};for(var ee in this._htOption)fe[ee]=this._htOption[ee];this._oDrawing=new fn(this._el,fe),this._htOption.text&&this.makeCode(this._htOption.text)},ye.prototype.makeCode=function(te){this._oQRCode=new D(ue(te,this._htOption),this._htOption.correctLevel),this._oQRCode.addData(te,this._htOption.binary,this._htOption.utf8WithoutBOM),this._oQRCode.make(),this._htOption.tooltip&&(this._el.title=te),this._oDrawing.draw(this._oQRCode)},ye.prototype.makeImage=function(){typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},ye.prototype.clear=function(){this._oDrawing.remove()},ye.prototype.resize=function(te,se){this._oDrawing._htOption.width=te,this._oDrawing._htOption.height=se,this._oDrawing.draw(this._oQRCode)},ye.prototype.noConflict=function(){return oe.QRCode===this&&(oe.QRCode=Ce),ye},ye.CorrectLevel=Ne,Se?((Se.exports=ye).QRCode=ye,me.QRCode=ye):oe.QRCode=ye}).call(this)});var s=i("58QMB");/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */var o={};const a=BigInt(0),l=BigInt(1),c=BigInt(2),u=BigInt(3),d=BigInt(8),f=Object.freeze({a,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),h=(v,w)=>(v+w/c)/w,p={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(v){const{n:w}=f,A=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),D=-l*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),$=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),U=A,q=BigInt("0x100000000000000000000000000000000"),W=h(U*v,w),ue=h(-D*v,w);let be=he(v-W*A-ue*$,w),de=he(-W*D-ue*U,w);const ye=be>q,j=de>q;if(ye&&(be=w-be),j&&(de=w-de),be>q||de>q)throw new Error("splitScalarEndo: Endomorphism failed, k="+v);return{k1neg:ye,k1:be,k2neg:j,k2:de}}},m=32,g=32,y=32,b=m+1,E=2*m+1;function C(v){const{a:w,b:A}=f,D=he(v*v),$=he(D*v);return he($+w*v+A)}const I=f.a===a;class x extends Error{constructor(w){super(w)}}function P(v){if(!(v instanceof T))throw new TypeError("JacobianPoint expected")}class T{constructor(w,A,D){this.x=w,this.y=A,this.z=D}static fromAffine(w){if(!(w instanceof O))throw new TypeError("JacobianPoint#fromAffine: expected Point");return w.equals(O.ZERO)?T.ZERO:new T(w.x,w.y,l)}static toAffineBatch(w){const A=xe(w.map(D=>D.z));return w.map((D,$)=>D.toAffine(A[$]))}static normalizeZ(w){return T.toAffineBatch(w).map(T.fromAffine)}equals(w){P(w);const{x:A,y:D,z:$}=this,{x:U,y:q,z:W}=w,ue=he($*$),be=he(W*W),de=he(A*be),ye=he(U*ue),j=he(he(D*W)*be),Z=he(he(q*$)*ue);return de===ye&&j===Z}negate(){return new T(this.x,he(-this.y),this.z)}double(){const{x:w,y:A,z:D}=this,$=he(w*w),U=he(A*A),q=he(U*U),W=w+U,ue=he(c*(he(W*W)-$-q)),be=he(u*$),de=he(be*be),ye=he(de-c*ue),j=he(be*(ue-ye)-d*q),Z=he(c*A*D);return new T(ye,j,Z)}add(w){P(w);const{x:A,y:D,z:$}=this,{x:U,y:q,z:W}=w;if(U===a||q===a)return this;if(A===a||D===a)return w;const ue=he($*$),be=he(W*W),de=he(A*be),ye=he(U*ue),j=he(he(D*W)*be),Z=he(he(q*$)*ue),oe=he(ye-de),me=he(Z-j);if(oe===a)return me===a?this.double():T.ZERO;const Se=he(oe*oe),Ce=he(oe*Se),Ke=he(de*Se),Ne=he(me*me-Ce-c*Ke),rt=he(me*(Ke-Ne)-j*Ce),Je=he($*W*oe);return new T(Ne,rt,Je)}subtract(w){return this.add(w.negate())}multiplyUnsafe(w){const A=T.ZERO;if(typeof w=="bigint"&&w===a)return A;let D=ze(w);if(D===l)return this;if(!I){let ye=A,j=this;for(;D>a;)D&l&&(ye=ye.add(j)),j=j.double(),D>>=l;return ye}let{k1neg:$,k1:U,k2neg:q,k2:W}=p.splitScalar(D),ue=A,be=A,de=this;for(;U>a||W>a;)U&l&&(ue=ue.add(de)),W&l&&(be=be.add(de)),de=de.double(),U>>=l,W>>=l;return $&&(ue=ue.negate()),q&&(be=be.negate()),be=new T(he(be.x*p.beta),be.y,be.z),ue.add(be)}precomputeWindow(w){const A=I?128/w+1:256/w+1,D=[];let $=this,U=$;for(let q=0;q<A;q++){U=$,D.push(U);for(let W=1;W<2**(w-1);W++)U=U.add($),D.push(U);$=U.double()}return D}wNAF(w,A){!A&&this.equals(T.BASE)&&(A=O.BASE);const D=A&&A._WINDOW_SIZE||1;if(256%D)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let $=A&&_.get(A);$||($=this.precomputeWindow(D),A&&D!==1&&($=T.normalizeZ($),_.set(A,$)));let U=T.ZERO,q=T.BASE;const W=1+(I?128/D:256/D),ue=2**(D-1),be=BigInt(2**D-1),de=2**D,ye=BigInt(D);for(let j=0;j<W;j++){const Z=j*ue;let oe=Number(w&be);w>>=ye,oe>ue&&(oe-=de,w+=l);const me=Z,Se=Z+Math.abs(oe)-1,Ce=j%2!==0,Ke=oe<0;oe===0?q=q.add(S(Ce,$[me])):U=U.add(S(Ke,$[Se]))}return{p:U,f:q}}multiply(w,A){let D=ze(w),$,U;if(I){const{k1neg:q,k1:W,k2neg:ue,k2:be}=p.splitScalar(D);let{p:de,f:ye}=this.wNAF(W,A),{p:j,f:Z}=this.wNAF(be,A);de=S(q,de),j=S(ue,j),j=new T(he(j.x*p.beta),j.y,j.z),$=de.add(j),U=ye.add(Z)}else{const{p:q,f:W}=this.wNAF(D,A);$=q,U=W}return T.normalizeZ([$,U])[0]}toAffine(w){const{x:A,y:D,z:$}=this,U=this.equals(T.ZERO);w==null&&(w=U?d:pe($));const q=w,W=he(q*q),ue=he(W*q),be=he(A*W),de=he(D*ue),ye=he($*q);if(U)return O.ZERO;if(ye!==l)throw new Error("invZ was invalid");return new O(be,de)}}T.BASE=new T(f.Gx,f.Gy,l),T.ZERO=new T(a,l,a);function S(v,w){const A=w.negate();return v?A:w}const _=new WeakMap;class O{constructor(w,A){this.x=w,this.y=A}_setWindowSize(w){this._WINDOW_SIZE=w,_.delete(this)}hasEvenY(){return this.y%c===a}static fromCompressedHex(w){const A=w.length===32,D=J(A?w:w.subarray(1));if(!lt(D))throw new Error("Point is not on curve");const $=C(D);let U=Le($);const q=(U&l)===l;A?q&&(U=he(-U)):(w[0]&1)===1!==q&&(U=he(-U));const W=new O(D,U);return W.assertValidity(),W}static fromUncompressedHex(w){const A=J(w.subarray(1,m+1)),D=J(w.subarray(m+1,m*2+1)),$=new O(A,D);return $.assertValidity(),$}static fromHex(w){const A=ke(w),D=A.length,$=A[0];if(D===m)return this.fromCompressedHex(A);if(D===b&&($===2||$===3))return this.fromCompressedHex(A);if(D===E&&$===4)return this.fromUncompressedHex(A);throw new Error(`Point.fromHex: received invalid point. Expected 32-${b} compressed bytes or ${E} uncompressed bytes, not ${D}`)}static fromPrivateKey(w){return O.BASE.multiply(wt(w))}static fromSignature(w,A,D){const{r:$,s:U}=Rt(A);if(![0,1,2,3].includes(D))throw new Error("Cannot recover: invalid recovery bit");const q=Ue(ke(w)),{n:W}=f,ue=D===2||D===3?$+W:$,be=pe(ue,W),de=he(-q*be,W),ye=he(U*be,W),j=D&1?"03":"02",Z=O.fromHex(j+V(ue)),oe=O.BASE.multiplyAndAddUnsafe(Z,de,ye);if(!oe)throw new Error("Cannot recover signature: point at infinify");return oe.assertValidity(),oe}toRawBytes(w=!1){return ne(this.toHex(w))}toHex(w=!1){const A=V(this.x);return w?`${this.hasEvenY()?"02":"03"}${A}`:`04${A}${V(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const w="Point is not on elliptic curve",{x:A,y:D}=this;if(!lt(A)||!lt(D))throw new Error(w);const $=he(D*D),U=C(A);if(he($-U)!==a)throw new Error(w)}equals(w){return this.x===w.x&&this.y===w.y}negate(){return new O(this.x,he(-this.y))}double(){return T.fromAffine(this).double().toAffine()}add(w){return T.fromAffine(this).add(T.fromAffine(w)).toAffine()}subtract(w){return this.add(w.negate())}multiply(w){return T.fromAffine(this).multiply(w,this).toAffine()}multiplyAndAddUnsafe(w,A,D){const $=T.fromAffine(this),U=A===a||A===l||this!==O.BASE?$.multiplyUnsafe(A):$.multiply(A),q=T.fromAffine(w).multiplyUnsafe(D),W=U.add(q);return W.equals(T.ZERO)?void 0:W.toAffine()}}O.BASE=new O(f.Gx,f.Gy),O.ZERO=new O(a,a);function F(v){return Number.parseInt(v[0],16)>=8?"00"+v:v}function L(v){if(v.length<2||v[0]!==2)throw new Error(`Invalid signature integer tag: ${H(v)}`);const w=v[1],A=v.subarray(2,w+2);if(!w||A.length!==w)throw new Error("Invalid signature integer: wrong length");if(A[0]===0&&A[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:J(A),left:v.subarray(w+2)}}function B(v){if(v.length<2||v[0]!=48)throw new Error(`Invalid signature tag: ${H(v)}`);if(v[1]!==v.length-2)throw new Error("Invalid signature: incorrect length");const{data:w,left:A}=L(v.subarray(2)),{data:D,left:$}=L(A);if($.length)throw new Error(`Invalid signature: left bytes after parsing: ${H($)}`);return{r:w,s:D}}class N{constructor(w,A){this.r=w,this.s=A,this.assertValidity()}static fromCompact(w){const A=w instanceof Uint8Array,D="Signature.fromCompact";if(typeof w!="string"&&!A)throw new TypeError(`${D}: Expected string or Uint8Array`);const $=A?H(w):w;if($.length!==128)throw new Error(`${D}: Expected 64-byte hex`);return new N(ie($.slice(0,64)),ie($.slice(64,128)))}static fromDER(w){const A=w instanceof Uint8Array;if(typeof w!="string"&&!A)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:D,s:$}=B(A?w:ne(w));return new N(D,$)}static fromHex(w){return this.fromDER(w)}assertValidity(){const{r:w,s:A}=this;if(!We(w))throw new Error("Invalid Signature: r must be 0 < r < n");if(!We(A))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const w=f.n>>l;return this.s>w}normalizeS(){return this.hasHighS()?new N(this.r,he(-this.s,f.n)):this}toDERRawBytes(){return ne(this.toDERHex())}toDERHex(){const w=F(Y(this.s)),A=F(Y(this.r)),D=w.length/2,$=A.length/2,U=Y(D),q=Y($);return`30${Y($+D+4)}02${q}${A}02${U}${w}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return ne(this.toCompactHex())}toCompactHex(){return V(this.r)+V(this.s)}}function M(...v){if(!v.every(D=>D instanceof Uint8Array))throw new Error("Uint8Array list expected");if(v.length===1)return v[0];const w=v.reduce((D,$)=>D+$.length,0),A=new Uint8Array(w);for(let D=0,$=0;D<v.length;D++){const U=v[D];A.set(U,$),$+=U.length}return A}const R=Array.from({length:256},(v,w)=>w.toString(16).padStart(2,"0"));function H(v){if(!(v instanceof Uint8Array))throw new Error("Expected Uint8Array");let w="";for(let A=0;A<v.length;A++)w+=R[v[A]];return w}const z=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function V(v){if(typeof v!="bigint")throw new Error("Expected bigint");if(!(a<=v&&v<z))throw new Error("Expected number 0 <= n < 2^256");return v.toString(16).padStart(64,"0")}function Q(v){const w=ne(V(v));if(w.length!==32)throw new Error("Error: expected 32 bytes");return w}function Y(v){const w=v.toString(16);return w.length&1?`0${w}`:w}function ie(v){if(typeof v!="string")throw new TypeError("hexToNumber: expected string, got "+typeof v);return BigInt(`0x${v}`)}function ne(v){if(typeof v!="string")throw new TypeError("hexToBytes: expected string, got "+typeof v);if(v.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+v.length);const w=new Uint8Array(v.length/2);for(let A=0;A<w.length;A++){const D=A*2,$=v.slice(D,D+2),U=Number.parseInt($,16);if(Number.isNaN(U)||U<0)throw new Error("Invalid byte sequence");w[A]=U}return w}function J(v){return ie(H(v))}function ke(v){return v instanceof Uint8Array?Uint8Array.from(v):ne(v)}function ze(v){if(typeof v=="number"&&Number.isSafeInteger(v)&&v>0)return BigInt(v);if(typeof v=="bigint"&&We(v))return v;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function he(v,w=f.P){const A=v%w;return A>=a?A:w+A}function Ee(v,w){const{P:A}=f;let D=v;for(;w-- >a;)D*=D,D%=A;return D}function Le(v){const{P:w}=f,A=BigInt(6),D=BigInt(11),$=BigInt(22),U=BigInt(23),q=BigInt(44),W=BigInt(88),ue=v*v*v%w,be=ue*ue*v%w,de=Ee(be,u)*be%w,ye=Ee(de,u)*be%w,j=Ee(ye,c)*ue%w,Z=Ee(j,D)*j%w,oe=Ee(Z,$)*Z%w,me=Ee(oe,q)*oe%w,Se=Ee(me,W)*me%w,Ce=Ee(Se,q)*oe%w,Ke=Ee(Ce,u)*be%w,Ne=Ee(Ke,U)*Z%w,rt=Ee(Ne,A)*ue%w,Je=Ee(rt,c);if(Je*Je%w!==v)throw new Error("Cannot find square root");return Je}function pe(v,w=f.P){if(v===a||w<=a)throw new Error(`invert: expected positive integers, got n=${v} mod=${w}`);let A=he(v,w),D=w,$=a,U=l;for(;A!==a;){const W=D/A,ue=D%A,be=$-U*W;D=A,A=ue,$=U,U=be}if(D!==l)throw new Error("invert: does not exist");return he($,w)}function xe(v,w=f.P){const A=new Array(v.length),D=v.reduce((U,q,W)=>q===a?U:(A[W]=U,he(U*q,w)),l),$=pe(D,w);return v.reduceRight((U,q,W)=>q===a?U:(A[W]=he(U*A[W],w),he(U*q,w)),$),A}function Me(v){const w=v.length*8-g*8,A=J(v);return w>0?A>>BigInt(w):A}function Ue(v,w=!1){const A=Me(v);if(w)return A;const{n:D}=f;return A>=D?A-D:A}let qe,tt;class Ae{constructor(w,A){if(this.hashLen=w,this.qByteLen=A,typeof w!="number"||w<2)throw new Error("hashLen must be a number");if(typeof A!="number"||A<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(w).fill(1),this.k=new Uint8Array(w).fill(0),this.counter=0}hmac(...w){return Pt.hmacSha256(this.k,...w)}hmacSync(...w){return tt(this.k,...w)}checkSync(){if(typeof tt!="function")throw new x("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(w=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),w),this.v=await this.hmac(this.v),w.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),w),this.v=await this.hmac(this.v))}reseedSync(w=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),w),this.v=this.hmacSync(this.v),w.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),w),this.v=this.hmacSync(this.v))}async generate(){this.incr();let w=0;const A=[];for(;w<this.qByteLen;){this.v=await this.hmac(this.v);const D=this.v.slice();A.push(D),w+=this.v.length}return M(...A)}generateSync(){this.checkSync(),this.incr();let w=0;const A=[];for(;w<this.qByteLen;){this.v=this.hmacSync(this.v);const D=this.v.slice();A.push(D),w+=this.v.length}return M(...A)}}function We(v){return a<v&&v<f.n}function lt(v){return a<v&&v<f.P}function ht(v,w,A,D=!0){const{n:$}=f,U=Ue(v,!0);if(!We(U))return;const q=pe(U,$),W=O.BASE.multiply(U),ue=he(W.x,$);if(ue===a)return;const be=he(q*he(w+A*ue,$),$);if(be===a)return;let de=new N(ue,be),ye=(W.x===de.r?0:2)|Number(W.y&l);return D&&de.hasHighS()&&(de=de.normalizeS(),ye^=1),{sig:de,recovery:ye}}function wt(v){let w;if(typeof v=="bigint")w=v;else if(typeof v=="number"&&Number.isSafeInteger(v)&&v>0)w=BigInt(v);else if(typeof v=="string"){if(v.length!==2*g)throw new Error("Expected 32 bytes of private key");w=ie(v)}else if(v instanceof Uint8Array){if(v.length!==g)throw new Error("Expected 32 bytes of private key");w=J(v)}else throw new TypeError("Expected valid private key");if(!We(w))throw new Error("Expected private key: 0 < key < n");return w}function Lt(v){return v instanceof O?(v.assertValidity(),v):O.fromHex(v)}function Rt(v){if(v instanceof N)return v.assertValidity(),v;try{return N.fromDER(v)}catch{return N.fromCompact(v)}}function pt(v,w=!1){return O.fromPrivateKey(v).toRawBytes(w)}function He(v){const w=v instanceof Uint8Array,A=typeof v=="string",D=(w||A)&&v.length;return w?D===b||D===E:A?D===b*2||D===E*2:v instanceof O}function st(v,w,A=!1){if(He(v))throw new TypeError("getSharedSecret: first arg must be private key");if(!He(w))throw new TypeError("getSharedSecret: second arg must be public key");const D=Lt(w);return D.assertValidity(),D.multiply(wt(v)).toRawBytes(A)}function Ot(v){const w=v.length>m?v.slice(0,m):v;return J(w)}function Mt(v){const w=Ot(v),A=he(w,f.n);return dn(A<a?w:A)}function dn(v){return Q(v)}function Vt(v,w,A){if(v==null)throw new Error(`sign: expected valid message hash, not "${v}"`);const D=ke(v),$=wt(w),U=[dn($),Mt(D)];if(A!=null){A===!0&&(A=Pt.randomBytes(m));const ue=ke(A);if(ue.length!==m)throw new Error(`sign: Expected ${m} bytes of extra data`);U.push(ue)}const q=M(...U),W=Ot(D);return{seed:q,m:W,d:$}}function Qt(v,w){const{sig:A,recovery:D}=v,{der:$,recovered:U}=Object.assign({canonical:!0,der:!0},w),q=$?A.toDERRawBytes():A.toCompactRawBytes();return U?[q,D]:q}function Jt(v,w,A={}){const{seed:D,m:$,d:U}=Vt(v,w,A.extraEntropy),q=new Ae(y,g);q.reseedSync(D);let W;for(;!(W=ht(q.generateSync(),$,U,A.canonical));)q.reseedSync();return Qt(W,A)}const Sn={strict:!0};function en(v,w,A,D=Sn){let $;try{$=Rt(v),w=ke(w)}catch{return!1}const{r:U,s:q}=$;if(D.strict&&$.hasHighS())return!1;const W=Ue(w);let ue;try{ue=Lt(A)}catch{return!1}const{n:be}=f,de=pe(q,be),ye=he(W*de,be),j=he(U*de,be),Z=O.BASE.multiplyAndAddUnsafe(ue,ye,j);return Z?he(Z.x,be)===U:!1}function cn(v){return he(J(v),f.n)}class Bt{constructor(w,A){this.r=w,this.s=A,this.assertValidity()}static fromHex(w){const A=ke(w);if(A.length!==64)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${A.length}`);const D=J(A.subarray(0,32)),$=J(A.subarray(32,64));return new Bt(D,$)}assertValidity(){const{r:w,s:A}=this;if(!lt(w)||!We(A))throw new Error("Invalid signature")}toHex(){return V(this.r)+V(this.s)}toRawBytes(){return ne(this.toHex())}}function tn(v){return O.fromPrivateKey(v).toRawX()}class hn{constructor(w,A,D=Pt.randomBytes()){if(w==null)throw new TypeError(`sign: Expected valid message, not "${w}"`);this.m=ke(w);const{x:$,scalar:U}=this.getScalar(wt(A));if(this.px=$,this.d=U,this.rand=ke(D),this.rand.length!==32)throw new TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(w){const A=O.fromPrivateKey(w),D=A.hasEvenY()?w:f.n-w;return{point:A,scalar:D,x:A.toRawX()}}initNonce(w,A){return Q(w^J(A))}finalizeNonce(w){const A=he(J(w),f.n);if(A===a)throw new Error("sign: Creation of signature failed. k is zero");const{point:D,x:$,scalar:U}=this.getScalar(A);return{R:D,rx:$,k:U}}finalizeSig(w,A,D,$){return new Bt(w.x,he(A+D*$,f.n)).toRawBytes()}error(){throw new Error("sign: Invalid signature produced")}async calc(){const{m:w,d:A,px:D,rand:$}=this,U=Pt.taggedHash,q=this.initNonce(A,await U(Qn.aux,$)),{R:W,rx:ue,k:be}=this.finalizeNonce(await U(Qn.nonce,q,D,w)),de=cn(await U(Qn.challenge,ue,D,w)),ye=this.finalizeSig(W,be,de,A);return await Fn(ye,w,D)||this.error(),ye}calcSync(){const{m:w,d:A,px:D,rand:$}=this,U=Pt.taggedHashSync,q=this.initNonce(A,U(Qn.aux,$)),{R:W,rx:ue,k:be}=this.finalizeNonce(U(Qn.nonce,q,D,w)),de=cn(U(Qn.challenge,ue,D,w)),ye=this.finalizeSig(W,be,de,A);return Ai(ye,w,D)||this.error(),ye}}async function Gi(v,w,A){return new hn(v,w,A).calc()}function Zi(v,w,A){return new hn(v,w,A).calcSync()}function ds(v,w,A){const D=v instanceof Bt,$=D?v:Bt.fromHex(v);return D&&$.assertValidity(),{...$,m:ke(w),P:Lt(A)}}function _t(v,w,A,D){const $=O.BASE.multiplyAndAddUnsafe(w,wt(A),he(-D,f.n));return!(!$||!$.hasEvenY()||$.x!==v)}async function Fn(v,w,A){try{const{r:D,s:$,m:U,P:q}=ds(v,w,A),W=cn(await Pt.taggedHash(Qn.challenge,Q(D),q.toRawX(),U));return _t(D,q,$,W)}catch{return!1}}function Ai(v,w,A){try{const{r:D,s:$,m:U,P:q}=ds(v,w,A),W=cn(Pt.taggedHashSync(Qn.challenge,Q(D),q.toRawX(),U));return _t(D,q,$,W)}catch(D){if(D instanceof x)throw D;return!1}}const ci={Signature:Bt,getPublicKey:tn,sign:Gi,verify:Fn,signSync:Zi,verifySync:Ai};O.BASE._setWindowSize(8);const rr={node:o,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Qn={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},ui={},Pt={bytesToHex:H,hexToBytes:ne,concatBytes:M,mod:he,invert:pe,isValidPrivateKey(v){try{return wt(v),!0}catch{return!1}},_bigintTo32Bytes:Q,_normalizePrivateKey:wt,hashToPrivateKey:v=>{v=ke(v);const w=g+8;if(v.length<w||v.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const A=he(J(v),f.n-l)+l;return Q(A)},randomBytes:(v=32)=>{if(rr.web)return rr.web.getRandomValues(new Uint8Array(v));if(rr.node){const{randomBytes:w}=rr.node;return Uint8Array.from(w(v))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Pt.hashToPrivateKey(Pt.randomBytes(g+8)),precompute(v=8,w=O.BASE){const A=w===O.BASE?w:new O(w.x,w.y);return A._setWindowSize(v),A.multiply(u),A},sha256:async(...v)=>{if(rr.web){const w=await rr.web.subtle.digest("SHA-256",M(...v));return new Uint8Array(w)}else if(rr.node){const{createHash:w}=rr.node,A=w("sha256");return v.forEach(D=>A.update(D)),Uint8Array.from(A.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(v,...w)=>{if(rr.web){const A=await rr.web.subtle.importKey("raw",v,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),D=M(...w),$=await rr.web.subtle.sign("HMAC",A,D);return new Uint8Array($)}else if(rr.node){const{createHmac:A}=rr.node,D=A("sha256",v);return w.forEach($=>D.update($)),Uint8Array.from(D.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(v,...w)=>{let A=ui[v];if(A===void 0){const D=await Pt.sha256(Uint8Array.from(v,$=>$.charCodeAt(0)));A=M(D,D),ui[v]=A}return Pt.sha256(A,...w)},taggedHashSync:(v,...w)=>{if(typeof qe!="function")throw new x("sha256Sync is undefined, you need to set it");let A=ui[v];if(A===void 0){const D=qe(Uint8Array.from(v,$=>$.charCodeAt(0)));A=M(D,D),ui[v]=A}return qe(A,...w)},_JacobianPoint:T};Object.defineProperties(Pt,{sha256Sync:{configurable:!1,get(){return qe},set(v){qe||(qe=v)}},hmacSha256Sync:{configurable:!1,get(){return tt},set(v){tt||(tt=v)}}});var Tr={};Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.sha224=Tr.sha256=void 0;var na={};Object.defineProperty(na,"__esModule",{value:!0}),na.SHA2=void 0;var jt={};Object.defineProperty(jt,"__esModule",{value:!0}),jt.output=jt.exists=jt.hash=jt.bytes=jt.bool=jt.number=void 0;function Zu(v){if(!Number.isSafeInteger(v)||v<0)throw new Error(`Wrong positive integer: ${v}`)}jt.number=Zu;function wm(v){if(typeof v!="boolean")throw new Error(`Expected boolean, not ${v}`)}jt.bool=wm;function Kf(v,...w){if(!(v instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length>0&&!w.includes(v.length))throw new TypeError(`Expected Uint8Array of length ${w}, not of length=${v.length}`)}jt.bytes=Kf;function ll(v){if(typeof v!="function"||typeof v.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Zu(v.outputLen),Zu(v.blockLen)}jt.hash=ll;function Gf(v,w=!0){if(v.destroyed)throw new Error("Hash instance has been destroyed");if(w&&v.finished)throw new Error("Hash#digest() has already been called")}jt.exists=Gf;function vm(v,w){Kf(v);const A=w.outputLen;if(v.length<A)throw new Error(`digestInto() expects output buffer of length at least ${A}`)}jt.output=vm;const hw={number:Zu,bool:wm,bytes:Kf,hash:ll,exists:Gf,output:vm};jt.default=hw;var Xe={};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.randomBytes=Xe.wrapConstructorWithOpts=Xe.wrapConstructor=Xe.checkOpts=Xe.Hash=Xe.concatBytes=Xe.toBytes=Xe.utf8ToBytes=Xe.asyncLoop=Xe.nextTick=Xe.hexToBytes=Xe.bytesToHex=Xe.isLE=Xe.rotr=Xe.createView=Xe.u32=Xe.u8=void 0;var ra={};Object.defineProperty(ra,"__esModule",{value:!0}),ra.crypto=void 0,ra.crypto={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};const pw=v=>new Uint8Array(v.buffer,v.byteOffset,v.byteLength);Xe.u8=pw;const mw=v=>new Uint32Array(v.buffer,v.byteOffset,Math.floor(v.byteLength/4));Xe.u32=mw;const Ft=v=>new DataView(v.buffer,v.byteOffset,v.byteLength);Xe.createView=Ft;const vn=(v,w)=>v<<32-w|v>>>w;if(Xe.rotr=vn,Xe.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!Xe.isLE)throw new Error("Non little-endian hardware is not supported");const nn=Array.from({length:256},(v,w)=>w.toString(16).padStart(2,"0"));function Pn(v){if(!(v instanceof Uint8Array))throw new Error("Uint8Array expected");let w="";for(let A=0;A<v.length;A++)w+=nn[v[A]];return w}Xe.bytesToHex=Pn;function pn(v){if(typeof v!="string")throw new TypeError("hexToBytes: expected string, got "+typeof v);if(v.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const w=new Uint8Array(v.length/2);for(let A=0;A<w.length;A++){const D=A*2,$=v.slice(D,D+2),U=Number.parseInt($,16);if(Number.isNaN(U)||U<0)throw new Error("Invalid byte sequence");w[A]=U}return w}Xe.hexToBytes=pn;const On=async()=>{};Xe.nextTick=On;async function En(v,w,A){let D=Date.now();for(let $=0;$<v;$++){A($);const U=Date.now()-D;U>=0&&U<w||(await(0,Xe.nextTick)(),D+=U)}}Xe.asyncLoop=En;function $n(v){if(typeof v!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof v}`);return new TextEncoder().encode(v)}Xe.utf8ToBytes=$n;function zn(v){if(typeof v=="string"&&(v=$n(v)),!(v instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof v})`);return v}Xe.toBytes=zn;function lo(...v){if(!v.every(D=>D instanceof Uint8Array))throw new Error("Uint8Array list expected");if(v.length===1)return v[0];const w=v.reduce((D,$)=>D+$.length,0),A=new Uint8Array(w);for(let D=0,$=0;D<v.length;D++){const U=v[D];A.set(U,$),$+=U.length}return A}Xe.concatBytes=lo;class ia{clone(){return this._cloneInto()}}Xe.Hash=ia;const sa=v=>Object.prototype.toString.call(v)==="[object Object]"&&v.constructor===Object;function cl(v,w){if(w!==void 0&&(typeof w!="object"||!sa(w)))throw new TypeError("Options should be object or undefined");return Object.assign(v,w)}Xe.checkOpts=cl;function ul(v){const w=D=>v().update(zn(D)).digest(),A=v();return w.outputLen=A.outputLen,w.blockLen=A.blockLen,w.create=()=>v(),w}Xe.wrapConstructor=ul;function Fc(v){const w=(D,$)=>v($).update(zn(D)).digest(),A=v({});return w.outputLen=A.outputLen,w.blockLen=A.blockLen,w.create=D=>v(D),w}Xe.wrapConstructorWithOpts=Fc;function Ii(v=32){if(ra.crypto.web)return ra.crypto.web.getRandomValues(new Uint8Array(v));if(ra.crypto.node)return new Uint8Array(ra.crypto.node.randomBytes(v).buffer);throw new Error("The environment doesn't have randomBytes function")}Xe.randomBytes=Ii;function Ls(v,w,A,D){if(typeof v.setBigUint64=="function")return v.setBigUint64(w,A,D);const $=BigInt(32),U=BigInt(4294967295),q=Number(A>>$&U),W=Number(A&U),ue=D?4:0,be=D?0:4;v.setUint32(w+ue,q,D),v.setUint32(w+be,W,D)}class dl extends Xe.Hash{constructor(w,A,D,$){super(),this.blockLen=w,this.outputLen=A,this.padOffset=D,this.isLE=$,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(w),this.view=(0,Xe.createView)(this.buffer)}update(w){jt.default.exists(this);const{view:A,buffer:D,blockLen:$}=this;w=(0,Xe.toBytes)(w);const U=w.length;for(let q=0;q<U;){const W=Math.min($-this.pos,U-q);if(W===$){const ue=(0,Xe.createView)(w);for(;$<=U-q;q+=$)this.process(ue,q);continue}D.set(w.subarray(q,q+W),this.pos),this.pos+=W,q+=W,this.pos===$&&(this.process(A,0),this.pos=0)}return this.length+=w.length,this.roundClean(),this}digestInto(w){jt.default.exists(this),jt.default.output(w,this),this.finished=!0;const{buffer:A,view:D,blockLen:$,isLE:U}=this;let{pos:q}=this;A[q++]=128,this.buffer.subarray(q).fill(0),this.padOffset>$-q&&(this.process(D,0),q=0);for(let ye=q;ye<$;ye++)A[ye]=0;Ls(D,$-8,BigInt(this.length*8),U),this.process(D,0);const W=(0,Xe.createView)(w),ue=this.outputLen;if(ue%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const be=ue/4,de=this.get();if(be>de.length)throw new Error("_sha2: outputLen bigger than state");for(let ye=0;ye<be;ye++)W.setUint32(4*ye,de[ye],U)}digest(){const{buffer:w,outputLen:A}=this;this.digestInto(w);const D=w.slice(0,A);return this.destroy(),D}_cloneInto(w){w||(w=new this.constructor),w.set(...this.get());const{blockLen:A,buffer:D,length:$,finished:U,destroyed:q,pos:W}=this;return w.length=$,w.pos=W,w.finished=U,w.destroyed=q,$%A&&w.buffer.set(D),w}}na.SHA2=dl;const $c=(v,w,A)=>v&w^~v&A,fl=(v,w,A)=>v&w^v&A^w&A,hl=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),di=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qi=new Uint32Array(64);class Qu extends na.SHA2{constructor(){super(64,32,8,!1),this.A=di[0]|0,this.B=di[1]|0,this.C=di[2]|0,this.D=di[3]|0,this.E=di[4]|0,this.F=di[5]|0,this.G=di[6]|0,this.H=di[7]|0}get(){const{A:w,B:A,C:D,D:$,E:U,F:q,G:W,H:ue}=this;return[w,A,D,$,U,q,W,ue]}set(w,A,D,$,U,q,W,ue){this.A=w|0,this.B=A|0,this.C=D|0,this.D=$|0,this.E=U|0,this.F=q|0,this.G=W|0,this.H=ue|0}process(w,A){for(let ye=0;ye<16;ye++,A+=4)Qi[ye]=w.getUint32(A,!1);for(let ye=16;ye<64;ye++){const j=Qi[ye-15],Z=Qi[ye-2],oe=(0,Xe.rotr)(j,7)^(0,Xe.rotr)(j,18)^j>>>3,me=(0,Xe.rotr)(Z,17)^(0,Xe.rotr)(Z,19)^Z>>>10;Qi[ye]=me+Qi[ye-7]+oe+Qi[ye-16]|0}let{A:D,B:$,C:U,D:q,E:W,F:ue,G:be,H:de}=this;for(let ye=0;ye<64;ye++){const j=(0,Xe.rotr)(W,6)^(0,Xe.rotr)(W,11)^(0,Xe.rotr)(W,25),Z=de+j+$c(W,ue,be)+hl[ye]+Qi[ye]|0,me=((0,Xe.rotr)(D,2)^(0,Xe.rotr)(D,13)^(0,Xe.rotr)(D,22))+fl(D,$,U)|0;de=be,be=ue,ue=W,W=q+Z|0,q=U,U=$,$=D,D=Z+me|0}D=D+this.A|0,$=$+this.B|0,U=U+this.C|0,q=q+this.D|0,W=W+this.E|0,ue=ue+this.F|0,be=be+this.G|0,de=de+this.H|0,this.set(D,$,U,q,W,ue,be,de)}roundClean(){Qi.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Zf extends Qu{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}Tr.sha256=(0,Xe.wrapConstructor)(()=>new Qu),Tr.sha224=(0,Xe.wrapConstructor)(()=>new Zf);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Bs(v){if(!Number.isSafeInteger(v))throw new Error(`Wrong integer: ${v}`)}function fi(...v){const w=($,U)=>q=>$(U(q)),A=Array.from(v).reverse().reduce(($,U)=>$?w($,U.encode):U.encode,void 0),D=v.reduce(($,U)=>$?w($,U.decode):U.decode,void 0);return{encode:A,decode:D}}function hi(v){return{encode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return w.map(A=>{if(Bs(A),A<0||A>=v.length)throw new Error(`Digit index outside alphabet: ${A} (alphabet: ${v.length})`);return v[A]})},decode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="string")throw new Error("alphabet.decode input should be array of strings");return w.map(A=>{if(typeof A!="string")throw new Error(`alphabet.decode: not string element=${A}`);const D=v.indexOf(A);if(D===-1)throw new Error(`Unknown letter: "${A}". Allowed: ${v}`);return D})}}}function Pi(v=""){if(typeof v!="string")throw new Error("join separator should be string");return{encode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="string")throw new Error("join.encode input should be array of strings");for(let A of w)if(typeof A!="string")throw new Error(`join.encode: non-string input=${A}`);return w.join(v)},decode:w=>{if(typeof w!="string")throw new Error("join.decode input should be string");return w.split(v)}}}function co(v,w="="){if(Bs(v),typeof w!="string")throw new Error("padding chr should be string");return{encode(A){if(!Array.isArray(A)||A.length&&typeof A[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of A)if(typeof D!="string")throw new Error(`padding.encode: non-string input=${D}`);for(;A.length*v%8;)A.push(w);return A},decode(A){if(!Array.isArray(A)||A.length&&typeof A[0]!="string")throw new Error("padding.encode input should be array of strings");for(let $ of A)if(typeof $!="string")throw new Error(`padding.decode: non-string input=${$}`);let D=A.length;if(D*v%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;D>0&&A[D-1]===w;D--)if(!((D-1)*v%8))throw new Error("Invalid padding: string has too much padding");return A.slice(0,D)}}}function xm(v){if(typeof v!="function")throw new Error("normalize fn should be function");return{encode:w=>w,decode:w=>v(w)}}function Sm(v,w,A){if(w<2)throw new Error(`convertRadix: wrong from=${w}, base cannot be less than 2`);if(A<2)throw new Error(`convertRadix: wrong to=${A}, base cannot be less than 2`);if(!Array.isArray(v))throw new Error("convertRadix: data should be array");if(!v.length)return[];let D=0;const $=[],U=Array.from(v);for(U.forEach(q=>{if(Bs(q),q<0||q>=w)throw new Error(`Wrong integer: ${q}`)});;){let q=0,W=!0;for(let ue=D;ue<U.length;ue++){const be=U[ue],de=w*q+be;if(!Number.isSafeInteger(de)||w*q/w!==q||de-be!==w*q)throw new Error("convertRadix: carry overflow");if(q=de%A,U[ue]=Math.floor(de/A),!Number.isSafeInteger(U[ue])||U[ue]*A+q!==de)throw new Error("convertRadix: carry overflow");if(W)U[ue]?W=!1:D=ue;else continue}if($.push(q),W)break}for(let q=0;q<v.length-1&&v[q]===0;q++)$.push(0);return $.reverse()}const Em=(v,w)=>w?Em(w,v%w):v,Xu=(v,w)=>v+(w-Em(v,w));function Qf(v,w,A,D){if(!Array.isArray(v))throw new Error("convertRadix2: data should be array");if(w<=0||w>32)throw new Error(`convertRadix2: wrong from=${w}`);if(A<=0||A>32)throw new Error(`convertRadix2: wrong to=${A}`);if(Xu(w,A)>32)throw new Error(`convertRadix2: carry overflow from=${w} to=${A} carryBits=${Xu(w,A)}`);let $=0,U=0;const q=2**A-1,W=[];for(const ue of v){if(Bs(ue),ue>=2**w)throw new Error(`convertRadix2: invalid data word=${ue} from=${w}`);if($=$<<w|ue,U+w>32)throw new Error(`convertRadix2: carry overflow pos=${U} from=${w}`);for(U+=w;U>=A;U-=A)W.push(($>>U-A&q)>>>0);$&=2**U-1}if($=$<<A-U&q,!D&&U>=w)throw new Error("Excess padding");if(!D&&$)throw new Error(`Non-zero padding: ${$}`);return D&&U>0&&W.push($>>>0),W}function km(v){return Bs(v),{encode:w=>{if(!(w instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Sm(Array.from(w),256,v)},decode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Sm(w,v,256))}}}function Fs(v,w=!1){if(Bs(v),v<=0||v>32)throw new Error("radix2: bits should be in (0..32]");if(Xu(8,v)>32||Xu(v,8)>32)throw new Error("radix2: carry overflow");return{encode:A=>{if(!(A instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Qf(Array.from(A),8,v,!w)},decode:A=>{if(!Array.isArray(A)||A.length&&typeof A[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Qf(A,v,8,w))}}}function Tm(v){if(typeof v!="function")throw new Error("unsafeWrapper fn should be function");return function(...w){try{return v.apply(null,w)}catch{}}}function _m(v,w){if(Bs(v),typeof w!="function")throw new Error("checksum fn should be function");return{encode(A){if(!(A instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const D=w(A).slice(0,v),$=new Uint8Array(A.length+v);return $.set(A),$.set(D,A.length),$},decode(A){if(!(A instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const D=A.slice(0,-v),$=w(D).slice(0,v),U=A.slice(-v);for(let q=0;q<v;q++)if($[q]!==U[q])throw new Error("Invalid checksum");return D}}}const Yu={alphabet:hi,chain:fi,checksum:_m,radix:km,radix2:Fs,join:Pi,padding:co},gw=fi(Fs(4),hi("0123456789ABCDEF"),Pi("")),yw=fi(Fs(5),hi("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),co(5),Pi(""));fi(Fs(5),hi("0123456789ABCDEFGHIJKLMNOPQRSTUV"),co(5),Pi("")),fi(Fs(5),hi("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Pi(""),xm(v=>v.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Xf=fi(Fs(6),hi("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),co(6),Pi("")),VF=fi(Fs(6),hi("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),co(6),Pi("")),bw=v=>fi(km(58),hi(v),Pi("")),Cm=bw("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");bw("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),bw("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const o_=[0,2,3,5,6,7,9,10,11],WF={encode(v){let w="";for(let A=0;A<v.length;A+=8){const D=v.subarray(A,A+8);w+=Cm.encode(D).padStart(o_[D.length],"1")}return w},decode(v){let w=[];for(let A=0;A<v.length;A+=11){const D=v.slice(A,A+11),$=o_.indexOf(D.length),U=Cm.decode(D);for(let q=0;q<U.length-$;q++)if(U[q]!==0)throw new Error("base58xmr: wrong padding");w=w.concat(Array.from(U.slice(U.length-$)))}return Uint8Array.from(w)}},jF=v=>fi(_m(4,w=>v(v(w))),Cm),ww=fi(hi("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Pi("")),a_=[996825010,642813549,513874426,1027748829,705979059];function Yf(v){const w=v>>25;let A=(v&33554431)<<5;for(let D=0;D<a_.length;D++)(w>>D&1)===1&&(A^=a_[D]);return A}function l_(v,w,A=1){const D=v.length;let $=1;for(let U=0;U<D;U++){const q=v.charCodeAt(U);if(q<33||q>126)throw new Error(`Invalid prefix (${v})`);$=Yf($)^q>>5}$=Yf($);for(let U=0;U<D;U++)$=Yf($)^v.charCodeAt(U)&31;for(let U of w)$=Yf($)^U;for(let U=0;U<6;U++)$=Yf($);return $^=A,ww.encode(Qf([$%2**30],30,5,!1))}function c_(v){const w=v==="bech32"?1:734539939,A=Fs(5),D=A.decode,$=A.encode,U=Tm(D);function q(de,ye,j=90){if(typeof de!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof de}`);if(!Array.isArray(ye)||ye.length&&typeof ye[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof ye}`);const Z=de.length+7+ye.length;if(j!==!1&&Z>j)throw new TypeError(`Length ${Z} exceeds limit ${j}`);return de=de.toLowerCase(),`${de}1${ww.encode(ye)}${l_(de,ye,w)}`}function W(de,ye=90){if(typeof de!="string")throw new Error(`bech32.decode input should be string, not ${typeof de}`);if(de.length<8||ye!==!1&&de.length>ye)throw new TypeError(`Wrong string length: ${de.length} (${de}). Expected (8..${ye})`);const j=de.toLowerCase();if(de!==j&&de!==de.toUpperCase())throw new Error("String must be lowercase or uppercase");de=j;const Z=de.lastIndexOf("1");if(Z===0||Z===-1)throw new Error('Letter "1" must be present between prefix and data only');const oe=de.slice(0,Z),me=de.slice(Z+1);if(me.length<6)throw new Error("Data must be at least 6 characters long");const Se=ww.decode(me).slice(0,-6),Ce=l_(oe,Se,w);if(!me.endsWith(Ce))throw new Error(`Invalid checksum in ${de}: expected "${Ce}"`);return{prefix:oe,words:Se}}const ue=Tm(W);function be(de){const{prefix:ye,words:j}=W(de,!1);return{prefix:ye,words:j,bytes:D(j)}}return{encode:q,decode:W,decodeToBytes:be,decodeUnsafe:ue,fromWords:D,fromWordsUnsafe:U,toWords:$}}const Oi=c_("bech32");c_("bech32m");const qF={encode:v=>new TextDecoder().decode(v),decode:v=>new TextEncoder().encode(v)},KF=fi(Fs(4),hi("0123456789abcdef"),Pi(""),xm(v=>{if(typeof v!="string"||v.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof v} with length ${v.length}`);return v.toLowerCase()}));`${Object.keys({utf8:qF,hex:KF,base16:gw,base32:yw,base64:Xf,base64url:VF,base58:Cm,base58xmr:WF}).join(", ")}`;var Jf={};Object.defineProperty(Jf,"__esModule",{value:!0}),Jf.wordlist=void 0,Jf.wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);var Hr={};Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.mnemonicToSeedSync=Hr.mnemonicToSeed=Hr.validateMnemonic=Hr.entropyToMnemonic=Hr.mnemonicToEntropy=Hr.generateMnemonic=void 0;var zc={};Object.defineProperty(zc,"__esModule",{value:!0}),zc.pbkdf2Async=zc.pbkdf2=void 0;var oa={};Object.defineProperty(oa,"__esModule",{value:!0}),oa.hmac=void 0;class u_ extends Xe.Hash{constructor(w,A){super(),this.finished=!1,this.destroyed=!1,jt.default.hash(w);const D=(0,Xe.toBytes)(A);if(this.iHash=w.create(),typeof this.iHash.update!="function")throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const $=this.blockLen,U=new Uint8Array($);U.set(D.length>$?w.create().update(D).digest():D);for(let q=0;q<U.length;q++)U[q]^=54;this.iHash.update(U),this.oHash=w.create();for(let q=0;q<U.length;q++)U[q]^=106;this.oHash.update(U),U.fill(0)}update(w){return jt.default.exists(this),this.iHash.update(w),this}digestInto(w){jt.default.exists(this),jt.default.bytes(w,this.outputLen),this.finished=!0,this.iHash.digestInto(w),this.oHash.update(w),this.oHash.digestInto(w),this.destroy()}digest(){const w=new Uint8Array(this.oHash.outputLen);return this.digestInto(w),w}_cloneInto(w){w||(w=Object.create(Object.getPrototypeOf(this),{}));const{oHash:A,iHash:D,finished:$,destroyed:U,blockLen:q,outputLen:W}=this;return w.finished=$,w.destroyed=U,w.blockLen=q,w.outputLen=W,w.oHash=A._cloneInto(w.oHash),w.iHash=D._cloneInto(w.iHash),w}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const GF=(v,w,A)=>new u_(v,w).update(A).digest();oa.hmac=GF,oa.hmac.create=(v,w)=>new u_(v,w);function d_(v,w,A,D){jt.default.hash(v);const $=(0,Xe.checkOpts)({dkLen:32,asyncTick:10},D),{c:U,dkLen:q,asyncTick:W}=$;if(jt.default.number(U),jt.default.number(q),jt.default.number(W),U<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const ue=(0,Xe.toBytes)(w),be=(0,Xe.toBytes)(A),de=new Uint8Array(q),ye=oa.hmac.create(v,ue),j=ye._cloneInto().update(be);return{c:U,dkLen:q,asyncTick:W,DK:de,PRF:ye,PRFSalt:j}}function f_(v,w,A,D,$){return v.destroy(),w.destroy(),D&&D.destroy(),$.fill(0),A}function ZF(v,w,A,D){const{c:$,dkLen:U,DK:q,PRF:W,PRFSalt:ue}=d_(v,w,A,D);let be;const de=new Uint8Array(4),ye=(0,Xe.createView)(de),j=new Uint8Array(W.outputLen);for(let Z=1,oe=0;oe<U;Z++,oe+=W.outputLen){const me=q.subarray(oe,oe+W.outputLen);ye.setInt32(0,Z,!1),(be=ue._cloneInto(be)).update(de).digestInto(j),me.set(j.subarray(0,me.length));for(let Se=1;Se<$;Se++){W._cloneInto(be).update(j).digestInto(j);for(let Ce=0;Ce<me.length;Ce++)me[Ce]^=j[Ce]}}return f_(W,ue,q,be,j)}zc.pbkdf2=ZF;async function QF(v,w,A,D){const{c:$,dkLen:U,asyncTick:q,DK:W,PRF:ue,PRFSalt:be}=d_(v,w,A,D);let de;const ye=new Uint8Array(4),j=(0,Xe.createView)(ye),Z=new Uint8Array(ue.outputLen);for(let oe=1,me=0;me<U;oe++,me+=ue.outputLen){const Se=W.subarray(me,me+ue.outputLen);j.setInt32(0,oe,!1),(de=be._cloneInto(de)).update(ye).digestInto(Z),Se.set(Z.subarray(0,Se.length)),await(0,Xe.asyncLoop)($-1,q,Ce=>{ue._cloneInto(de).update(Z).digestInto(Z);for(let Ke=0;Ke<Se.length;Ke++)Se[Ke]^=Z[Ke]})}return f_(ue,be,W,de,Z)}zc.pbkdf2Async=QF;var pi={};Object.defineProperty(pi,"__esModule",{value:!0}),pi.sha384=pi.sha512_256=pi.sha512_224=pi.sha512=pi.SHA512=void 0;var xt={};Object.defineProperty(xt,"__esModule",{value:!0}),xt.add=xt.toBig=xt.split=xt.fromBig=void 0;const Am=BigInt(2**32-1),vw=BigInt(32);function xw(v,w=!1){return w?{h:Number(v&Am),l:Number(v>>vw&Am)}:{h:Number(v>>vw&Am)|0,l:Number(v&Am)|0}}xt.fromBig=xw;function h_(v,w=!1){let A=new Uint32Array(v.length),D=new Uint32Array(v.length);for(let $=0;$<v.length;$++){const{h:U,l:q}=xw(v[$],w);[A[$],D[$]]=[U,q]}return[A,D]}xt.split=h_;const XF=(v,w)=>BigInt(v>>>0)<<vw|BigInt(w>>>0);xt.toBig=XF;const YF=(v,w,A)=>v>>>A,JF=(v,w,A)=>v<<32-A|w>>>A,e$=(v,w,A)=>v>>>A|w<<32-A,t$=(v,w,A)=>v<<32-A|w>>>A,n$=(v,w,A)=>v<<64-A|w>>>A-32,r$=(v,w,A)=>v>>>A-32|w<<64-A,i$=(v,w)=>w,s$=(v,w)=>v,o$=(v,w,A)=>v<<A|w>>>32-A,a$=(v,w,A)=>w<<A|v>>>32-A,l$=(v,w,A)=>w<<A-32|v>>>64-A,c$=(v,w,A)=>v<<A-32|w>>>64-A;function p_(v,w,A,D){const $=(w>>>0)+(D>>>0);return{h:v+A+($/2**32|0)|0,l:$|0}}xt.add=p_;const u$=(v,w,A)=>(v>>>0)+(w>>>0)+(A>>>0),d$=(v,w,A,D)=>w+A+D+(v/2**32|0)|0,f$=(v,w,A,D)=>(v>>>0)+(w>>>0)+(A>>>0)+(D>>>0),h$=(v,w,A,D,$)=>w+A+D+$+(v/2**32|0)|0,p$=(v,w,A,D,$)=>(v>>>0)+(w>>>0)+(A>>>0)+(D>>>0)+($>>>0),m$=(v,w,A,D,$,U)=>w+A+D+$+U+(v/2**32|0)|0,g$={fromBig:xw,split:h_,toBig:xt.toBig,shrSH:YF,shrSL:JF,rotrSH:e$,rotrSL:t$,rotrBH:n$,rotrBL:r$,rotr32H:i$,rotr32L:s$,rotlSH:o$,rotlSL:a$,rotlBH:l$,rotlBL:c$,add:p_,add3L:u$,add3H:d$,add4L:f$,add4H:h$,add5H:m$,add5L:p$};xt.default=g$;const[y$,b$]=xt.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(v=>BigInt(v))),pl=new Uint32Array(80),ml=new Uint32Array(80);class eh extends na.SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:w,Al:A,Bh:D,Bl:$,Ch:U,Cl:q,Dh:W,Dl:ue,Eh:be,El:de,Fh:ye,Fl:j,Gh:Z,Gl:oe,Hh:me,Hl:Se}=this;return[w,A,D,$,U,q,W,ue,be,de,ye,j,Z,oe,me,Se]}set(w,A,D,$,U,q,W,ue,be,de,ye,j,Z,oe,me,Se){this.Ah=w|0,this.Al=A|0,this.Bh=D|0,this.Bl=$|0,this.Ch=U|0,this.Cl=q|0,this.Dh=W|0,this.Dl=ue|0,this.Eh=be|0,this.El=de|0,this.Fh=ye|0,this.Fl=j|0,this.Gh=Z|0,this.Gl=oe|0,this.Hh=me|0,this.Hl=Se|0}process(w,A){for(let Ne=0;Ne<16;Ne++,A+=4)pl[Ne]=w.getUint32(A),ml[Ne]=w.getUint32(A+=4);for(let Ne=16;Ne<80;Ne++){const rt=pl[Ne-15]|0,Je=ml[Ne-15]|0,Ye=xt.default.rotrSH(rt,Je,1)^xt.default.rotrSH(rt,Je,8)^xt.default.shrSH(rt,Je,7),it=xt.default.rotrSL(rt,Je,1)^xt.default.rotrSL(rt,Je,8)^xt.default.shrSL(rt,Je,7),dt=pl[Ne-2]|0,fn=ml[Ne-2]|0,te=xt.default.rotrSH(dt,fn,19)^xt.default.rotrBH(dt,fn,61)^xt.default.shrSH(dt,fn,6),se=xt.default.rotrSL(dt,fn,19)^xt.default.rotrBL(dt,fn,61)^xt.default.shrSL(dt,fn,6),ee=xt.default.add4L(it,se,ml[Ne-7],ml[Ne-16]),fe=xt.default.add4H(ee,Ye,te,pl[Ne-7],pl[Ne-16]);pl[Ne]=fe|0,ml[Ne]=ee|0}let{Ah:D,Al:$,Bh:U,Bl:q,Ch:W,Cl:ue,Dh:be,Dl:de,Eh:ye,El:j,Fh:Z,Fl:oe,Gh:me,Gl:Se,Hh:Ce,Hl:Ke}=this;for(let Ne=0;Ne<80;Ne++){const rt=xt.default.rotrSH(ye,j,14)^xt.default.rotrSH(ye,j,18)^xt.default.rotrBH(ye,j,41),Je=xt.default.rotrSL(ye,j,14)^xt.default.rotrSL(ye,j,18)^xt.default.rotrBL(ye,j,41),Ye=ye&Z^~ye&me,it=j&oe^~j&Se,dt=xt.default.add5L(Ke,Je,it,b$[Ne],ml[Ne]),fn=xt.default.add5H(dt,Ce,rt,Ye,y$[Ne],pl[Ne]),te=dt|0,se=xt.default.rotrSH(D,$,28)^xt.default.rotrBH(D,$,34)^xt.default.rotrBH(D,$,39),ee=xt.default.rotrSL(D,$,28)^xt.default.rotrBL(D,$,34)^xt.default.rotrBL(D,$,39),fe=D&U^D&W^U&W,we=$&q^$&ue^q&ue;Ce=me|0,Ke=Se|0,me=Z|0,Se=oe|0,Z=ye|0,oe=j|0,{h:ye,l:j}=xt.default.add(be|0,de|0,fn|0,te|0),be=W|0,de=ue|0,W=U|0,ue=q|0,U=D|0,q=$|0;const Oe=xt.default.add3L(te,ee,we);D=xt.default.add3H(Oe,fn,se,fe),$=Oe|0}({h:D,l:$}=xt.default.add(this.Ah|0,this.Al|0,D|0,$|0)),{h:U,l:q}=xt.default.add(this.Bh|0,this.Bl|0,U|0,q|0),{h:W,l:ue}=xt.default.add(this.Ch|0,this.Cl|0,W|0,ue|0),{h:be,l:de}=xt.default.add(this.Dh|0,this.Dl|0,be|0,de|0),{h:ye,l:j}=xt.default.add(this.Eh|0,this.El|0,ye|0,j|0),{h:Z,l:oe}=xt.default.add(this.Fh|0,this.Fl|0,Z|0,oe|0),{h:me,l:Se}=xt.default.add(this.Gh|0,this.Gl|0,me|0,Se|0),{h:Ce,l:Ke}=xt.default.add(this.Hh|0,this.Hl|0,Ce|0,Ke|0),this.set(D,$,U,q,W,ue,be,de,ye,j,Z,oe,me,Se,Ce,Ke)}roundClean(){pl.fill(0),ml.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}pi.SHA512=eh;class w$ extends eh{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class v$ extends eh{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class x$ extends eh{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}pi.sha512=(0,Xe.wrapConstructor)(()=>new eh),pi.sha512_224=(0,Xe.wrapConstructor)(()=>new w$),pi.sha512_256=(0,Xe.wrapConstructor)(()=>new v$),pi.sha384=(0,Xe.wrapConstructor)(()=>new x$);const S$=v=>v[0]==="ãããããã";function m_(v){if(typeof v!="string")throw new TypeError(`Invalid mnemonic type: ${typeof v}`);return v.normalize("NFKD")}function Sw(v){const w=m_(v),A=w.split(" ");if(![12,15,18,21,24].includes(A.length))throw new Error("Invalid mnemonic");return{nfkd:w,words:A}}function g_(v){jt.default.bytes(v,16,20,24,28,32)}function E$(v,w=128){if(jt.default.number(w),w%32!==0||w>256)throw new TypeError("Invalid entropy");return w_((0,Xe.randomBytes)(w/8),v)}Hr.generateMnemonic=E$;const k$=v=>{const w=8-v.length/4;return new Uint8Array([(0,Tr.sha256)(v)[0]>>w<<w])};function y_(v){if(!Array.isArray(v)||v.length!==2048||typeof v[0]!="string")throw new Error("Worlist: expected array of 2048 strings");return v.forEach(w=>{if(typeof w!="string")throw new Error(`Wordlist: non-string element: ${w}`)}),Yu.chain(Yu.checksum(1,k$),Yu.radix2(11,!0),Yu.alphabet(v))}function b_(v,w){const{words:A}=Sw(v),D=y_(w).decode(A);return g_(D),D}Hr.mnemonicToEntropy=b_;function w_(v,w){return g_(v),y_(w).encode(v).join(S$(w)?"ã":" ")}Hr.entropyToMnemonic=w_;function T$(v,w){try{b_(v,w)}catch{return!1}return!0}Hr.validateMnemonic=T$;const v_=v=>m_(`mnemonic${v}`);function _$(v,w=""){return(0,zc.pbkdf2Async)(pi.sha512,Sw(v).nfkd,v_(w),{c:2048,dkLen:64})}Hr.mnemonicToSeed=_$;function C$(v,w=""){return(0,zc.pbkdf2)(pi.sha512,Sw(v).nfkd,v_(w),{c:2048,dkLen:64})}Hr.mnemonicToSeedSync=C$;var Ju={};Object.defineProperty(Ju,"__esModule",{value:!0}),Ju.ripemd160=Ju.RIPEMD160=void 0;const A$=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),x_=Uint8Array.from({length:16},(v,w)=>w),I$=x_.map(v=>(9*v+5)%16);let Ew=[x_],kw=[I$];for(let v=0;v<4;v++)for(let w of[Ew,kw])w.push(w[v].map(A=>A$[A]));const S_=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(v=>new Uint8Array(v)),P$=Ew.map((v,w)=>v.map(A=>S_[w][A])),O$=kw.map((v,w)=>v.map(A=>S_[w][A])),M$=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),N$=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),Im=(v,w)=>v<<w|v>>>32-w;function E_(v,w,A,D){return v===0?w^A^D:v===1?w&A|~w&D:v===2?(w|~A)^D:v===3?w&D|A&~D:w^(A|~D)}const Pm=new Uint32Array(16);class k_ extends na.SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:w,h1:A,h2:D,h3:$,h4:U}=this;return[w,A,D,$,U]}set(w,A,D,$,U){this.h0=w|0,this.h1=A|0,this.h2=D|0,this.h3=$|0,this.h4=U|0}process(w,A){for(let Z=0;Z<16;Z++,A+=4)Pm[Z]=w.getUint32(A,!0);let D=this.h0|0,$=D,U=this.h1|0,q=U,W=this.h2|0,ue=W,be=this.h3|0,de=be,ye=this.h4|0,j=ye;for(let Z=0;Z<5;Z++){const oe=4-Z,me=M$[Z],Se=N$[Z],Ce=Ew[Z],Ke=kw[Z],Ne=P$[Z],rt=O$[Z];for(let Je=0;Je<16;Je++){const Ye=Im(D+E_(Z,U,W,be)+Pm[Ce[Je]]+me,Ne[Je])+ye|0;D=ye,ye=be,be=Im(W,10)|0,W=U,U=Ye}for(let Je=0;Je<16;Je++){const Ye=Im($+E_(oe,q,ue,de)+Pm[Ke[Je]]+Se,rt[Je])+j|0;$=j,j=de,de=Im(ue,10)|0,ue=q,q=Ye}}this.set(this.h1+W+de|0,this.h2+be+j|0,this.h3+ye+$|0,this.h4+D+q|0,this.h0+U+ue|0)}roundClean(){Pm.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}Ju.RIPEMD160=k_,Ju.ripemd160=(0,Xe.wrapConstructor)(()=>new k_),Pt.hmacSha256Sync=(v,...w)=>(0,oa.hmac)(Tr.sha256,v,Pt.concatBytes(...w));const Tw=jF(Tr.sha256);function T_(v){return BigInt(`0x${(0,Xe.bytesToHex)(v)}`)}function R$(v){return(0,Xe.hexToBytes)(v.toString(16).padStart(64,"0"))}const D$=(0,Xe.utf8ToBytes)("Bitcoin seed"),_w={private:76066276,public:76067358},Cw=2147483648,L$=v=>(0,Ju.ripemd160)((0,Tr.sha256)(v)),B$=v=>(0,Xe.createView)(v).getUint32(0,!1),Om=v=>{if(!Number.isSafeInteger(v)||v<0||v>2**32-1)throw new Error(`Invalid number=${v}. Should be from 0 to 2 ** 32 - 1`);const w=new Uint8Array(4);return(0,Xe.createView)(w).setUint32(0,v,!1),w};class Uc{constructor(w){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!w||typeof w!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=w.versions||_w,this.depth=w.depth||0,this.chainCode=w.chainCode,this.index=w.index||0,this.parentFingerprint=w.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(w.publicKey&&w.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(w.privateKey){if(!Pt.isValidPrivateKey(w.privateKey))throw new Error("Invalid private key");this.privKey=typeof w.privateKey=="bigint"?w.privateKey:T_(w.privateKey),this.privKeyBytes=R$(this.privKey),this.pubKey=pt(w.privateKey,!0)}else if(w.publicKey)this.pubKey=O.fromHex(w.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=L$(this.pubKey)}get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return B$(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const w=this.privateKey;if(!w)throw new Error("No private key");return Tw.encode(this.serialize(this.versions.private,(0,Xe.concatBytes)(new Uint8Array([0]),w)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return Tw.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(w,A=_w){if((0,jt.bytes)(w),8*w.length<128||8*w.length>512)throw new Error(`HDKey: wrong seed length=${w.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const D=(0,oa.hmac)(pi.sha512,D$,w);return new Uc({versions:A,chainCode:D.slice(32),privateKey:D.slice(0,32)})}static fromExtendedKey(w,A=_w){const D=Tw.decode(w),$=(0,Xe.createView)(D),U=$.getUint32(0,!1),q={versions:A,depth:D[4],parentFingerprint:$.getUint32(5,!1),index:$.getUint32(9,!1),chainCode:D.slice(13,45)},W=D.slice(45),ue=W[0]===0;if(U!==A[ue?"private":"public"])throw new Error("Version mismatch");return ue?new Uc({...q,privateKey:W.slice(1)}):new Uc({...q,publicKey:W})}static fromJSON(w){return Uc.fromExtendedKey(w.xpriv)}derive(w){if(!/^[mM]'?/.test(w))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(w))return this;const A=w.replace(/^[mM]'?\//,"").split("/");let D=this;for(const $ of A){const U=/^(\d+)('?)$/.exec($);if(!U||U.length!==3)throw new Error(`Invalid child index: ${$}`);let q=+U[1];if(!Number.isSafeInteger(q)||q>=Cw)throw new Error("Invalid index");U[2]==="'"&&(q+=Cw),D=D.deriveChild(q)}return D}deriveChild(w){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let A=Om(w);if(w>=Cw){const W=this.privateKey;if(!W)throw new Error("Could not derive hardened child key");A=(0,Xe.concatBytes)(new Uint8Array([0]),W,A)}else A=(0,Xe.concatBytes)(this.pubKey,A);const D=(0,oa.hmac)(pi.sha512,this.chainCode,A),$=T_(D.slice(0,32)),U=D.slice(32);if(!Pt.isValidPrivateKey($))throw new Error("Tweak bigger than curve order");const q={versions:this.versions,chainCode:U,depth:this.depth+1,parentFingerprint:this.fingerprint,index:w};try{if(this.privateKey){const W=Pt.mod(this.privKey+$,f.n);if(!Pt.isValidPrivateKey(W))throw new Error("The tweak was out of range or the resulted private key is invalid");q.privateKey=W}else{const W=O.fromHex(this.pubKey).add(O.fromPrivateKey($));if(W.equals(O.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");q.publicKey=W.toRawBytes(!0)}return new Uc(q)}catch{return this.deriveChild(w+1)}}sign(w){if(!this.privateKey)throw new Error("No privateKey set!");return(0,jt.bytes)(w,32),Jt(w,this.privKey,{canonical:!0,der:!1})}verify(w,A){if((0,jt.bytes)(w,32),(0,jt.bytes)(A,64),!this.publicKey)throw new Error("No publicKey set!");let D;try{D=N.fromCompact(A)}catch{return!1}return en(D,w,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(w,A){if(!this.chainCode)throw new Error("No chainCode set");return(0,jt.bytes)(A,33),(0,Xe.concatBytes)(Om(w),new Uint8Array([this.depth]),Om(this.parentFingerprint),Om(this.index),this.chainCode,A)}}var F$=Object.defineProperty,Mi=(v,w)=>{for(var A in w)F$(v,A,{get:w[A],enumerable:!0})};function $$(){return Pt.bytesToHex(Pt.randomPrivateKey())}function __(v){return Pt.bytesToHex(ci.getPublicKey(v))}var z$={};Mi(z$,{insertEventIntoAscendingList:()=>H$,insertEventIntoDescendingList:()=>U$,normalizeURL:()=>Aw,utf8Decoder:()=>gl,utf8Encoder:()=>uo});var gl=new TextDecoder("utf-8"),uo=new TextEncoder;function Aw(v){let w=new URL(v);return w.pathname=w.pathname.replace(/\/+/g,"/"),w.pathname.endsWith("/")&&(w.pathname=w.pathname.slice(0,-1)),(w.port==="80"&&w.protocol==="ws:"||w.port==="443"&&w.protocol==="wss:")&&(w.port=""),w.searchParams.sort(),w.hash="",w.toString()}function U$(v,w){let A=0,D=v.length-1,$,U=A;if(D<0)U=0;else if(w.created_at<v[D].created_at)U=D+1;else if(w.created_at>=v[A].created_at)U=A;else for(;;){if(D<=A+1){U=D;break}if($=Math.floor(A+(D-A)/2),v[$].created_at>w.created_at)A=$;else if(v[$].created_at<w.created_at)D=$;else{U=$;break}}return v[U]?.id!==w.id?[...v.slice(0,U),w,...v.slice(U)]:v}function H$(v,w){let A=0,D=v.length-1,$,U=A;if(D<0)U=0;else if(w.created_at>v[D].created_at)U=D+1;else if(w.created_at<=v[A].created_at)U=A;else for(;;){if(D<=A+1){U=D;break}if($=Math.floor(A+(D-A)/2),v[$].created_at<w.created_at)A=$;else if(v[$].created_at>w.created_at)D=$;else{U=$;break}}return v[U]?.id!==w.id?[...v.slice(0,U),w,...v.slice(U)]:v}function V$(v,w){let A=v;return A.pubkey=__(w),A.id=Iw(A),A.sig=q$(A,w),A}function W$(v){if(!Pw(v))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,v.pubkey,v.created_at,v.kind,v.tags,v.content])}function Iw(v){let w=(0,Tr.sha256)(uo.encode(W$(v)));return Pt.bytesToHex(w)}var j$=v=>v instanceof Object;function Pw(v){if(!j$(v)||typeof v.kind!="number"||typeof v.content!="string"||typeof v.created_at!="number"||typeof v.pubkey!="string"||!v.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(v.tags))return!1;for(let w=0;w<v.tags.length;w++){let A=v.tags[w];if(!Array.isArray(A))return!1;for(let D=0;D<A.length;D++)if(typeof A[D]=="object")return!1}return!0}function C_(v){return ci.verifySync(v.sig,Iw(v),v.pubkey)}function q$(v,w){return Pt.bytesToHex(ci.signSync(Iw(v),w))}function K$(v,w){if(v.ids&&v.ids.indexOf(w.id)===-1&&!v.ids.some(A=>w.id.startsWith(A))||v.kinds&&v.kinds.indexOf(w.kind)===-1||v.authors&&v.authors.indexOf(w.pubkey)===-1&&!v.authors.some(A=>w.pubkey.startsWith(A)))return!1;for(let A in v)if(A[0]==="#"){let D=A.slice(1),$=v[`#${D}`];if($&&!w.tags.find(([U,q])=>U===A.slice(1)&&$.indexOf(q)!==-1))return!1}return!(v.since&&w.created_at<v.since||v.until&&w.created_at>=v.until)}function G$(v,w){for(let A=0;A<v.length;A++)if(K$(v[A],w))return!0;return!1}var Z$={};Mi(Z$,{getHex64:()=>Mm,getInt:()=>A_,getSubscriptionId:()=>I_,matchEventId:()=>Q$,matchEventKind:()=>Y$,matchEventPubkey:()=>X$});function Mm(v,w){let A=w.length+3,D=v.indexOf(`"${w}":`)+A,$=v.slice(D).indexOf('"')+D+1;return v.slice($,$+64)}function A_(v,w){let A=w.length,D=v.indexOf(`"${w}":`)+A+3,$=v.slice(D),U=Math.min($.indexOf(","),$.indexOf("}"));return parseInt($.slice(0,U),10)}function I_(v){let w=v.slice(0,22).indexOf('"EVENT"');if(w===-1)return null;let A=v.slice(w+7+1).indexOf('"');if(A===-1)return null;let D=w+7+1+A,$=v.slice(D+1,80).indexOf('"');if($===-1)return null;let U=D+1+$;return v.slice(D+1,U)}function Q$(v,w){return w===Mm(v,"id")}function X$(v,w){return w===Mm(v,"pubkey")}function Y$(v,w){return w===A_(v,"kind")}var P_=()=>({connect:[],disconnect:[],error:[],notice:[],auth:[]});function J$(v,w={}){let{listTimeout:A=3e3,getTimeout:D=3e3,countTimeout:$=3e3}=w;var U,q={},W=P_(),ue={},be={},de;async function ye(){return de||(de=new Promise((Ce,Ke)=>{try{U=new WebSocket(v)}catch(Ye){Ke(Ye)}U.onopen=()=>{W.connect.forEach(Ye=>Ye()),Ce()},U.onerror=()=>{de=void 0,W.error.forEach(Ye=>Ye()),Ke()},U.onclose=async()=>{de=void 0,W.disconnect.forEach(Ye=>Ye())};let Ne=[],rt;U.onmessage=Ye=>{Ne.push(Ye.data),rt||(rt=setInterval(Je,0))};function Je(){if(Ne.length===0){clearInterval(rt),rt=null;return}var Ye=Ne.shift();if(!Ye)return;let it=I_(Ye);if(it){let dt=q[it];if(dt&&dt.alreadyHaveEvent&&dt.alreadyHaveEvent(Mm(Ye,"id"),v))return}try{let dt=JSON.parse(Ye);switch(dt[0]){case"EVENT":{let ee=dt[1],fe=dt[2];Pw(fe)&&q[ee]&&(q[ee].skipVerification||C_(fe))&&G$(q[ee].filters,fe)&&(q[ee],(ue[ee]?.event||[]).forEach(we=>we(fe)));return}case"COUNT":let fn=dt[1],te=dt[2];q[fn]&&(ue[fn]?.count||[]).forEach(ee=>ee(te));return;case"EOSE":{let ee=dt[1];ee in ue&&(ue[ee].eose.forEach(fe=>fe()),ue[ee].eose=[]);return}case"OK":{let ee=dt[1],fe=dt[2],we=dt[3]||"";ee in be&&(fe?be[ee].ok.forEach(Oe=>Oe()):be[ee].failed.forEach(Oe=>Oe(we)),be[ee].ok=[],be[ee].failed=[]);return}case"NOTICE":let se=dt[1];W.notice.forEach(ee=>ee(se));return;case"AUTH":{let ee=dt[1];W.auth?.forEach(fe=>fe(ee));return}}}catch{return}}}),de)}function j(){return U?.readyState===1}async function Z(){j()||await ye()}async function oe(Ce){let Ke=JSON.stringify(Ce);if(!(!j()&&(await new Promise(Ne=>setTimeout(Ne,1e3)),!j())))try{U.send(Ke)}catch(Ne){console.log(Ne)}}const me=(Ce,{verb:Ke="REQ",skipVerification:Ne=!1,alreadyHaveEvent:rt=null,id:Je=Math.random().toString().slice(2)}={})=>{let Ye=Je;return q[Ye]={id:Ye,filters:Ce,skipVerification:Ne,alreadyHaveEvent:rt},oe([Ke,Ye,...Ce]),{sub:(it,dt={})=>me(it||Ce,{skipVerification:dt.skipVerification||Ne,alreadyHaveEvent:dt.alreadyHaveEvent||rt,id:Ye}),unsub:()=>{delete q[Ye],delete ue[Ye],oe(["CLOSE",Ye])},on:(it,dt)=>{ue[Ye]=ue[Ye]||{event:[],count:[],eose:[]},ue[Ye][it].push(dt)},off:(it,dt)=>{let fn=ue[Ye],te=fn[it].indexOf(dt);te>=0&&fn[it].splice(te,1)}}};function Se(Ce,Ke){if(!Ce.id)throw new Error(`event ${Ce} has no id`);let Ne=Ce.id;return oe([Ke,Ce]),{on:(rt,Je)=>{be[Ne]=be[Ne]||{ok:[],failed:[]},be[Ne][rt].push(Je)},off:(rt,Je)=>{let Ye=be[Ne];if(!Ye)return;let it=Ye[rt].indexOf(Je);it>=0&&Ye[rt].splice(it,1)}}}return{url:v,sub:me,on:(Ce,Ke)=>{W[Ce].push(Ke),Ce==="connect"&&U?.readyState===1&&Ke()},off:(Ce,Ke)=>{let Ne=W[Ce].indexOf(Ke);Ne!==-1&&W[Ce].splice(Ne,1)},list:(Ce,Ke)=>new Promise(Ne=>{let rt=me(Ce,Ke),Je=[],Ye=setTimeout(()=>{rt.unsub(),Ne(Je)},A);rt.on("eose",()=>{rt.unsub(),clearTimeout(Ye),Ne(Je)}),rt.on("event",it=>{Je.push(it)})}),get:(Ce,Ke)=>new Promise(Ne=>{let rt=me([Ce],Ke),Je=setTimeout(()=>{rt.unsub(),Ne(null)},D);rt.on("event",Ye=>{rt.unsub(),clearTimeout(Je),Ne(Ye)})}),count:Ce=>new Promise(Ke=>{let Ne=me(Ce,{...me,verb:"COUNT"}),rt=setTimeout(()=>{Ne.unsub(),Ke(null)},$);Ne.on("count",Je=>{Ne.unsub(),clearTimeout(rt),Ke(Je)})}),publish(Ce){return Se(Ce,"EVENT")},auth(Ce){return Se(Ce,"AUTH")},connect:Z,close(){W=P_(),ue={},be={},U.readyState===WebSocket.OPEN&&U?.close()},get status(){return U?.readyState??3}}}var O_=class{_conn;_seenOn={};eoseSubTimeout;getTimeout;constructor(v={}){this._conn={},this.eoseSubTimeout=v.eoseSubTimeout||3400,this.getTimeout=v.getTimeout||3400}close(v){v.forEach(w=>{let A=this._conn[Aw(w)];A&&A.close()})}async ensureRelay(v){const w=Aw(v);this._conn[w]||(this._conn[w]=J$(w,{getTimeout:this.getTimeout*.9,listTimeout:this.getTimeout*.9}));const A=this._conn[w];return await A.connect(),A}sub(v,w,A){let D=new Set,$={...A||{}};$.alreadyHaveEvent=(j,Z)=>{if(A?.alreadyHaveEvent?.(j,Z))return!0;let oe=this._seenOn[j]||new Set;return oe.add(Z),this._seenOn[j]=oe,D.has(j)};let U=[],q=new Set,W=new Set,ue=v.length,be=!1,de=setTimeout(()=>{be=!0;for(let j of W.values())j()},this.eoseSubTimeout);v.forEach(async j=>{let Z;try{Z=await this.ensureRelay(j)}catch{me();return}if(!Z)return;let oe=Z.sub(w,$);oe.on("event",Se=>{D.add(Se.id);for(let Ce of q.values())Ce(Se)}),oe.on("eose",()=>{be||me()}),U.push(oe);function me(){if(ue--,ue===0){clearTimeout(de);for(let Se of W.values())Se()}}});let ye={sub(j,Z){return U.forEach(oe=>oe.sub(j,Z)),ye},unsub(){U.forEach(j=>j.unsub())},on(j,Z){j==="event"?q.add(Z):j==="eose"&&W.add(Z)},off(j,Z){j==="event"?q.delete(Z):j==="eose"&&W.delete(Z)}};return ye}get(v,w,A){return new Promise(D=>{let $=this.sub(v,[w],A),U=setTimeout(()=>{$.unsub(),D(null)},this.getTimeout);$.on("event",q=>{D(q),clearTimeout(U),$.unsub()})})}list(v,w,A){return new Promise(D=>{let $=[],U=this.sub(v,w,A);U.on("event",q=>{$.push(q)}),U.on("eose",()=>{U.unsub(),D($)})})}publish(v,w){const A=v.map(async $=>{let U;try{return U=await this.ensureRelay($),U.publish(w)}catch{return{on(){},off(){}}}}),D=new Map;return{on($,U){v.forEach(async(q,W)=>{let ue=await A[W],be=()=>U(q);D.set(U,be),ue.on($,be)})},off($,U){v.forEach(async(q,W)=>{let ue=D.get(U);ue&&(await A[W]).off($,ue)})}}}seenOn(v){return Array.from(this._seenOn[v]?.values?.()||[])}},Ow={};Mi(Ow,{decode:()=>Nm,naddrEncode:()=>sz,neventEncode:()=>iz,noteEncode:()=>nz,nprofileEncode:()=>rz,npubEncode:()=>tz,nrelayEncode:()=>oz,nsecEncode:()=>ez});var ed=5e3;function Nm(v){let{prefix:w,words:A}=Oi.decode(v,ed),D=new Uint8Array(Oi.fromWords(A));switch(w){case"nprofile":{let $=Rm(D);if(!$[0]?.[0])throw new Error("missing TLV 0 for nprofile");if($[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Pt.bytesToHex($[0][0]),relays:$[1]?$[1].map(U=>gl.decode(U)):[]}}}case"nevent":{let $=Rm(D);if(!$[0]?.[0])throw new Error("missing TLV 0 for nevent");if($[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if($[2]&&$[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");return{type:"nevent",data:{id:Pt.bytesToHex($[0][0]),relays:$[1]?$[1].map(U=>gl.decode(U)):[],author:$[2]?.[0]?Pt.bytesToHex($[2][0]):void 0}}}case"naddr":{let $=Rm(D);if(!$[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!$[2]?.[0])throw new Error("missing TLV 2 for naddr");if($[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!$[3]?.[0])throw new Error("missing TLV 3 for naddr");if($[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:gl.decode($[0][0]),pubkey:Pt.bytesToHex($[2][0]),kind:parseInt(Pt.bytesToHex($[3][0]),16),relays:$[1]?$[1].map(U=>gl.decode(U)):[]}}}case"nrelay":{let $=Rm(D);if(!$[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:gl.decode($[0][0])}}case"nsec":case"npub":case"note":return{type:w,data:Pt.bytesToHex(D)};default:throw new Error(`unknown prefix ${w}`)}}function Rm(v){let w={},A=v;for(;A.length>0;){let D=A[0],$=A[1],U=A.slice(2,2+$);A=A.slice(2+$),!(U.length<$)&&(w[D]=w[D]||[],w[D].push(U))}return w}function ez(v){return Mw("nsec",v)}function tz(v){return Mw("npub",v)}function nz(v){return Mw("note",v)}function Mw(v,w){let A=Pt.hexToBytes(w),D=Oi.toWords(A);return Oi.encode(v,D,ed)}function rz(v){let w=Dm({0:[Pt.hexToBytes(v.pubkey)],1:(v.relays||[]).map(D=>uo.encode(D))}),A=Oi.toWords(w);return Oi.encode("nprofile",A,ed)}function iz(v){let w=Dm({0:[Pt.hexToBytes(v.id)],1:(v.relays||[]).map(D=>uo.encode(D)),2:v.author?[Pt.hexToBytes(v.author)]:[]}),A=Oi.toWords(w);return Oi.encode("nevent",A,ed)}function sz(v){let w=new ArrayBuffer(4);new DataView(w).setUint32(0,v.kind,!1);let A=Dm({0:[uo.encode(v.identifier)],1:(v.relays||[]).map($=>uo.encode($)),2:[Pt.hexToBytes(v.pubkey)],3:[new Uint8Array(w)]}),D=Oi.toWords(A);return Oi.encode("naddr",D,ed)}function oz(v){let w=Dm({0:[uo.encode(v)]}),A=Oi.toWords(w);return Oi.encode("nrelay",A,ed)}function Dm(v){let w=[];return Object.entries(v).forEach(([A,D])=>{D.forEach($=>{let U=new Uint8Array($.length+2);U.set([parseInt(A)],0),U.set([$.length],1),U.set($,2),w.push(U)})}),Pt.concatBytes(...w)}var az={};Mi(az,{decrypt:()=>cz,encrypt:()=>lz});async function lz(v,w,A){const D=st(v,"02"+w),$=M_(D);let U=Uint8Array.from((0,Xe.randomBytes)(16)),q=uo.encode(A),W=await crypto.subtle.importKey("raw",$,{name:"AES-CBC"},!1,["encrypt"]),ue=await crypto.subtle.encrypt({name:"AES-CBC",iv:U},W,q),be=Xf.encode(new Uint8Array(ue)),de=Xf.encode(new Uint8Array(U.buffer));return`${be}?iv=${de}`}async function cz(v,w,A){let[D,$]=A.split("?iv="),U=st(v,"02"+w),q=M_(U),W=await crypto.subtle.importKey("raw",q,{name:"AES-CBC"},!1,["decrypt"]),ue=Xf.decode(D),be=Xf.decode($),de=await crypto.subtle.decrypt({name:"AES-CBC",iv:be},W,ue);return gl.decode(de)}function M_(v){return v.slice(1,33)}var uz={};Mi(uz,{queryProfile:()=>hz,searchDomain:()=>fz,useFetchImplementation:()=>dz});var Lm;try{Lm=fetch}catch{}function dz(v){Lm=v}async function fz(v,w=""){try{return(await(await Lm(`https://${v}/.well-known/nostr.json?name=${w}`)).json()).names}catch{return{}}}async function hz(v){let[w,A]=v.split("@");if(A||(A=w,w="_"),!w.match(/^[A-Za-z0-9-_.]+$/)||!A.includes("."))return null;let D;try{D=await(await Lm(`https://${A}/.well-known/nostr.json?name=${w}`)).json()}catch{return null}if(!D?.names?.[w])return null;let $=D.names[w],U=D.relays?.[$]||[];return{pubkey:$,relays:U}}var pz={};Mi(pz,{generateSeedWords:()=>gz,privateKeyFromSeedWords:()=>mz,validateWords:()=>yz});function mz(v,w){let D=Uc.fromMasterSeed((0,Hr.mnemonicToSeedSync)(v,w)).derive("m/44'/1237'/0'/0/0").privateKey;if(!D)throw new Error("could not derive private key");return Pt.bytesToHex(D)}function gz(){return(0,Hr.generateMnemonic)(Jf.wordlist)}function yz(v){return(0,Hr.validateMnemonic)(v,Jf.wordlist)}var bz={};Mi(bz,{parse:()=>wz});function wz(v){const w={reply:void 0,root:void 0,mentions:[],profiles:[]},A=[];for(const D of v.tags)D[0]==="e"&&D[1]&&A.push(D),D[0]==="p"&&D[1]&&w.profiles.push({pubkey:D[1],relays:D[2]?[D[2]]:[]});for(let D=0;D<A.length;D++){const $=A[D],[U,q,W,ue]=$,be={id:q,relays:W?[W]:[]},de=D===0,ye=D===A.length-1;if(ue==="root"){w.root=be;continue}if(ue==="reply"){w.reply=be;continue}if(ue==="mention"){w.mentions.push(be);continue}if(de){w.root=be;continue}if(ye){w.reply=be;continue}w.mentions.push(be)}return w}var vz={};Mi(vz,{getPow:()=>xz});function xz(v){return Sz(Pt.hexToBytes(v))}function Sz(v){let w,A,D;for(A=0,w=0;A<v.length&&(D=Ez(v[A]),w+=D,D===8);A++);return w}function Ez(v){let w=0;if(v===0)return 8;for(;v>>=1;)w++;return 7-w}var kz={};Mi(kz,{BECH32_REGEX:()=>N_,NOSTR_URI_REGEX:()=>Bm,parse:()=>_z,test:()=>Tz});var N_=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/,Bm=new RegExp(`nostr:(${N_.source})`);function Tz(v){return typeof v=="string"&&new RegExp(`^${Bm.source}$`).test(v)}function _z(v){const w=v.match(new RegExp(`^${Bm.source}$`));if(!w)throw new Error(`Invalid Nostr URI: ${v}`);return{uri:w[0],value:w[1],decoded:Nm(w[1])}}var Cz={};Mi(Cz,{createDelegation:()=>Az,getDelegator:()=>Iz});function Az(v,w){let A=[];(w.kind||-1)>=0&&A.push(`kind=${w.kind}`),w.until&&A.push(`created_at<${w.until}`),w.since&&A.push(`created_at>${w.since}`);let D=A.join("&");if(D==="")throw new Error("refusing to create a delegation without any conditions");let $=(0,Tr.sha256)(uo.encode(`nostr:delegation:${w.pubkey}:${D}`)),U=Pt.bytesToHex(ci.signSync($,v));return{from:__(v),to:w.pubkey,cond:D,sig:U}}function Iz(v){let w=v.tags.find(W=>W[0]==="delegation"&&W.length>=4);if(!w)return null;let A=w[1],D=w[2],$=w[3],U=D.split("&");for(let W=0;W<U.length;W++){let[ue,be,de]=U[W].split(/\b/);if(!(ue==="kind"&&be==="="&&v.kind===parseInt(de))){if(ue==="created_at"&&be==="<"&&v.created_at<parseInt(de))continue;if(ue==="created_at"&&be===">"&&v.created_at>parseInt(de))continue;return null}}let q=(0,Tr.sha256)(uo.encode(`nostr:delegation:${v.pubkey}:${D}`));return ci.verifySync($,q,A)?A:null}var Pz={};Mi(Pz,{matchAll:()=>Oz,regex:()=>Nw,replaceAll:()=>Mz});var Nw=()=>new RegExp(`\\b${Bm.source}\\b`,"g");function*Oz(v){const w=v.matchAll(Nw());for(const A of w){const[D,$]=A;yield{uri:D,value:$,decoded:Nm($),start:A.index,end:A.index+D.length}}}function Mz(v,w){return v.replaceAll(Nw(),(A,D)=>w({uri:A,value:D,decoded:Nm(D)}))}var Nz={};Mi(Nz,{useFetchImplementation:()=>Rz,validateGithub:()=>Dz});var Rw;try{Rw=fetch}catch{}function Rz(v){Rw=v}async function Dz(v,w,A){try{return await(await Rw(`https://gist.github.com/${w}/${A}/raw`)).text()===`Verifying that I control the following Nostr public key: ${v}`}catch{return!1}}var Lz={};Mi(Lz,{authenticate:()=>Bz});var Bz=async({challenge:v,relay:w,sign:A})=>{const D={kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",w.url],["challenge",v]],content:""},$=w.auth(await A(D));return new Promise((U,q)=>{$.on("ok",function W(){$.off("ok",W),U()}),$.on("failed",function W(ue){$.off("failed",W),q(ue)})})},Dw={};Mi(Dw,{getZapEndpoint:()=>$z,makeZapReceipt:()=>Hz,makeZapRequest:()=>zz,useFetchImplementation:()=>Fz,validateZapRequest:()=>Uz});var Lw;try{Lw=fetch}catch{}function Fz(v){Lw=v}async function $z(v){try{let w="",{lud06:A,lud16:D}=JSON.parse(v.content);if(A){let{words:q}=Oi.decode(A,1e3),W=Oi.fromWords(q);w=gl.decode(W)}else if(D){let[q,W]=D.split("@");w=`https://${W}/.well-known/lnurlp/${q}`}else return null;let U=await(await Lw(w)).json();if(U.allowsNostr&&U.nostrPubkey)return U.callback}catch{}return null}function zz({profile:v,event:w,amount:A,relays:D,comment:$=""}){if(!A)throw new Error("amount not given");if(!v)throw new Error("profile not given");let U={kind:9734,created_at:Math.round(Date.now()/1e3),content:$,tags:[["p",v],["amount",A.toString()],["relays",...D]]};return w&&U.tags.push(["e",w]),U}function Uz(v){let w;try{w=JSON.parse(v)}catch{return"Invalid zap request JSON."}if(!Pw(w))return"Zap request is not a valid Nostr event.";if(!C_(w))return"Invalid signature on zap request.";let A=w.tags.find(([U,q])=>U==="p"&&q);if(!A)return"Zap request doesn't have a 'p' tag.";if(!A[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let D=w.tags.find(([U,q])=>U==="e"&&q);return D&&!D[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":w.tags.find(([U,q])=>U==="relays"&&q)?null:"Zap request doesn't have a 'relays' tag."}function Hz({zapRequest:v,preimage:w,bolt11:A,paidAt:D}){let U=JSON.parse(v).tags.filter(([W])=>W==="e"||W==="p"||W==="a"),q={kind:9735,created_at:Math.round(D.getTime()/1e3),content:"",tags:[...U,["bolt11",A],["description",v]]};return w&&q.tags.push(["preimage",w]),q}Pt.hmacSha256Sync=(v,...w)=>(0,oa.hmac)(Tr.sha256,v,Pt.concatBytes(...w)),Pt.sha256Sync=(...v)=>(0,Tr.sha256)(Pt.concatBytes(...v));const Vz=v=>Ow.decode(v).data,R_=v=>Ow.decode(v).data;let D_={};const Wz=async v=>{if(D_[v])return D_[v];const w=new O_,A=["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine"];try{return await w.get(A,{authors:[v],kinds:[0]})}catch{throw new Error("failed to fetch user profile :(")}finally{w.close(A)}},jz=v=>JSON.parse(v.content),qz=async v=>{const w=await Dw.getZapEndpoint(v);if(!w)throw new Error("failed to retrieve zap endpoint :(");return w},Kz=async(v,w)=>{if(L_()&&!w)try{return await window.nostr.signEvent(v)}catch{}return V$(v,$$())},Gz=async({profile:v,nip19Target:w,amount:A,relays:D,comment:$,anon:U})=>{const q=Dw.makeZapRequest({profile:v,event:w&&w.startsWith("note")?R_(w):void 0,amount:A,relays:D,comment:$}),W=w&&w.startsWith("naddr")?R_(w):void 0;if(W){const ue=W.relays?W.relays.reduce((be,de)=>`${de},${be}`,""):"";q.tags.push(["a",`${W.kind}:${W.pubkey}:${W.identifier}`,ue])}return(!L_()||U)&&q.tags.push(["anon"]),Kz(q,U)},Zz=async({zapEndpoint:v,amount:w,comment:A,authorId:D,nip19Target:$,normalizedRelays:U,anon:q})=>{const W=await Gz({profile:D,nip19Target:$,amount:w,relays:U,comment:A,anon:q});let ue=`${v}?amount=${w}&nostr=${encodeURIComponent(JSON.stringify(W))}`;A&&(ue=`${ue}&comment=${encodeURIComponent(A)}`);const be=await fetch(ue),{pr:de,reason:ye,status:j}=await be.json();if(de)return de;throw j==="ERROR"?new Error(ye??"Unable to fetch invoice"):new Error("Unable to fetch invoice")},L_=()=>window!==void 0&&window.nostr!==void 0,Qz=({relays:v,invoice:w,onSuccess:A})=>{const D=new O_,$=Array.from(new Set([...v,"wss://relay.nostr.band"])),U=()=>{D&&D.close($)},q=Math.round(Date.now()/1e3),W=setInterval(()=>{D.sub($,[{kinds:[9735],since:q}]).on("event",be=>{be.tags.find(de=>de[0]==="bolt11"&&de[1]===w)&&(A(),U(),clearInterval(W))})},5e3);return()=>{U(),clearInterval(W)}},B_="nostrZap.",F_="lightningUri",$_=()=>typeof localStorage<"u",Xz=v=>{if($_())return localStorage.getItem(`${B_}${v}`)},Yz=(v,w)=>{$_()&&localStorage.setItem(`${B_}${v}`,w)},Jz=()=>Xz(F_),e7=v=>Yz(F_,v);let Bw=null;const t7=v=>{v=v.replace(/^#/,""),v.length===3&&(v=v.split("").map(U=>U+U).join(""));const w=parseInt(v,16),A=w>>16&255,D=w>>8&255,$=w&255;return{r:A,g:D,b:$}},n7=({r:v,g:w,b:A})=>(v*299+w*587+A*114)/1e3,z_=v=>{const w=t7(v);return n7(w)<128?"#fff":"#000"},Fw=v=>{const w=document.createElement("dialog");return w.classList.add("nostr-zap-dialog"),w.innerHTML=v,w.addEventListener("click",function({clientX:A,clientY:D}){const{left:$,right:U,top:q,bottom:W}=w.getBoundingClientRect();A===0&&D===0||(A<$||A>U||D<q||D>W)&&w.close()}),Bw.appendChild(w),w},r7=({dialogHeader:v,invoice:w,relays:A,buttonColor:D})=>{const $=Jz(),q=Fw(`
        <button class="close-button">X</button>
        ${v}
        <div class="qrcode">
          <div class="overlay">copied invoice to clipboard</div>
        </div>
        <p>click QR code to copy invoice</p>
        <select name="lightning-wallet">
          ${[{label:"Default Wallet",value:"lightning:"},{label:"Strike",value:"strike:lightning:"},{label:"Cash App",value:"https://cash.app/launch/lightning/"},{label:"Muun",value:"muun:"},{label:"Blue Wallet",value:"bluewallet:lightning:"},{label:"Wallet of Satoshi",value:"walletofsatoshi:lightning:"},{label:"Zebedee",value:"zebedee:lightning:"},{label:"Zeus LN",value:"zeusln:lightning:"},{label:"Phoenix",value:"phoenix://"},{label:"Breez",value:"breez:"},{label:"Bitcoin Beach",value:"bitcoinbeach://"},{label:"Blixt",value:"blixtwallet:lightning:"},{label:"River",value:"river://"}].map(({label:j,value:Z})=>`<option value="${Z}" ${$===Z?"selected":""}>${j}</option>`).join("")}
        </select>
        <button class="cta-button"
          ${D?`style="background-color: ${D}; color: ${z_(D)}"`:""} 
        >Open Wallet</button>
      `),W=q.querySelector(".qrcode"),ue=q.querySelector('select[name="lightning-wallet"]'),be=q.querySelector(".cta-button"),de=W.querySelector(".overlay"),ye=Qz({relays:A,invoice:w,onSuccess:()=>{q.close()}});return new(e(s))(W,{text:w,quietZone:10}),W.addEventListener("click",function(){navigator.clipboard.writeText(w),de.classList.add("show"),setTimeout(()=>de.classList.remove("show"),2e3)}),be.addEventListener("click",function(){e7(ue.value),window.location.href=`${ue.value}${w}`}),q.addEventListener("close",function(){ye(),q.remove()}),q.querySelector(".close-button").addEventListener("click",function(){q.close()}),q},i7=async({npub:v,nip19Target:w,relays:A,buttonColor:D,anon:$})=>{const U=it=>`${it.substring(0,12)}...${it.substring(it.length-12)}`,q=A?A.split(","):["wss://relay.nostr.band","wss://relay.damus.io","wss://nos.lol"],W=Vz(v),ue=Wz(W),be="https://pbs.twimg.com/profile_images/1604195803748306944/LxHDoJ7P_400x400.jpg",de=async()=>{const{picture:it,display_name:dt,name:fn}=jz(await ue);return`
      <h2>${dt||fn}</h2>
        <img
          src="${it||be}"
          width="80"
          height="80"
          alt="nostr user avatar"
        />
      <p>${U(w||v)}</p>
    `},ye=Fw(`
      <button class="close-button">X</button>
      <div class="dialog-header-container">
        <h2 class="skeleton-placeholder"></h2>
          <img
            src="${be}"
            width="80"
            height="80"
            alt="placeholder avatar"
          />
        <p class="skeleton-placeholder"></p>
      </div>
      <div class="preset-zap-options-container">
        <button data-value="21">21 â¡ï¸</button>
        <button data-value="69">69 â¡ï¸</button>
        <button data-value="420">420 â¡ï¸</button>
        <button data-value="1337">1337 â¡ï¸</button>
        <button data-value="5000">5k â¡ï¸</button>
        <button data-value="10000">10k â¡ï¸</button>
        <button data-value="21000">21k â¡ï¸</button>
        <button data-value="1000000">1M â¡ï¸</button>
      </div>
      <form>
        <input name="amount" type="number" placeholder="amount in sats" required />
        <input name="comment" placeholder="optional comment" />
        <button class="cta-button" 
          ${D?`style="background-color: ${D}; color: ${z_(D)}"`:""} 
          type="submit" disabled>Zap</button>
      </form>
    `),j=ye.querySelector(".preset-zap-options-container"),Z=ye.querySelector("form"),oe=ye.querySelector('input[name="amount"]'),me=ye.querySelector('input[name="comment"]'),Se=ye.querySelector('button[type="submit"]'),Ce=ye.querySelector(".dialog-header-container"),Ke=it=>{ye.close(),U_(it,v).showModal()};de().then(it=>{Ce.innerHTML=it,Se.disabled=!1}).catch(Ke);const Ne=()=>{Se.disabled=!0,Se.innerHTML='<div class="spinner">Loading</div>'},rt=()=>{Se.disabled=!1,Se.innerHTML="Zap"},Je=it=>{oe.value=it};ye.addEventListener("close",function(){rt(),Z.reset()}),ye.querySelector(".close-button").addEventListener("click",function(){ye.close()}),j.addEventListener("click",function(it){it.target.matches("button")&&(Je(it.target.getAttribute("data-value")),oe.focus())});const Ye=ue.then(qz);return Z.addEventListener("submit",async function(it){it.preventDefault(),Ne();const dt=Number(oe.value)*1e3,fn=me.value;try{const te=await Zz({zapEndpoint:await Ye,amount:dt,comment:fn,authorId:W,nip19Target:w,normalizedRelays:q,anon:$}),se=async()=>{const ee=r7({dialogHeader:await de(),invoice:te,relays:q,buttonColor:D}),fe=ee.querySelector(".cta-button");ye.close(),ee.showModal(),fe.focus()};if(window.webln)try{await window.webln.enable(),await window.webln.sendPayment(te),ye.close()}catch{se()}else se()}catch(te){Ke(te)}}),ye},U_=(v,w)=>{const A=Fw(`
    <button class="close-button">X</button>
    <p class="error-message">${v}</p>
    <a href="https://nosta.me/${w}" target="_blank">
      <button class="cta-button">View Nostr Profile</button>
    </a>
  `);return A.addEventListener("close",function(){A.remove()}),A.querySelector(".close-button").addEventListener("click",function(){A.close()}),A},H_=async({npub:v,noteId:w,naddr:A,relays:D,cachedAmountDialog:$,buttonColor:U,anon:q})=>{let W=$;try{return W||(W=await i7({npub:v,nip19Target:A||w,relays:D,buttonColor:U,anon:q})),W.showModal(),window.matchMedia("(max-height: 932px)").matches||W.querySelector('input[name="amount"]').focus(),W}catch(ue){W&&W.close(),U_(ue,v).showModal()}},V_=v=>{let w=null,A=null;v.addEventListener("click",async function(){const D=v.getAttribute("data-npub"),$=v.getAttribute("data-note-id"),U=v.getAttribute("data-naddr"),q=v.getAttribute("data-relays"),W=v.getAttribute("data-button-color"),ue=v.getAttribute("data-anon")==="true";A&&(A.npub!==D||A.noteId!==$||A.naddr!==U||A.relays!==q||A.buttonColor!==W||A.anon!==ue)&&(w=null),A={npub:D,noteId:$,naddr:U,relays:q,buttonColor:W,anon:ue},w=await H_({npub:D,noteId:$,naddr:U,relays:q,cachedAmountDialog:w,buttonColor:W,anon:ue})})},W_=v=>{document.querySelectorAll(v||"[data-npub]").forEach(V_)};return(()=>{const v=document.createElement("style");v.innerHTML=`
      .nostr-zap-dialog {
        width: 424px;
        min-width: 376px;
        margin: auto;
        box-sizing: content-box;
        border: none;
        border-radius: 10px;
        padding: 36px;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        background-color: white;
      }
      .nostr-zap-dialog[open],
      .nostr-zap-dialog form {
        display: block;
        max-width: fit-content;
      }
      .nostr-zap-dialog form {
        padding: 0;
        width: 100%;
      }
      .nostr-zap-dialog img {
        display: inline;
        border-radius: 50%;
      }
      .nostr-zap-dialog h2 {
        font-size: 1.5em;
        font-weight: bold;
        color: black;
      }
      .nostr-zap-dialog p {
        font-size: 1em;
        font-weight: normal;
        color: black;
      }
      .nostr-zap-dialog h2,
      .nostr-zap-dialog p,
      .nostr-zap-dialog .skeleton-placeholder {
        margin: 4px;
        word-wrap: break-word;
      }
      .nostr-zap-dialog button {
        background-color: inherit;
        padding: 12px 0;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid rgb(226, 232, 240);
        width: 100px;
        max-width: 100px;
        max-height: 52px;
        white-space: nowrap;
        color: black;
        box-sizing: border-box;
      }
      .nostr-zap-dialog button:hover {
        background-color: #edf2f7;
      }
      .nostr-zap-dialog button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .nostr-zap-dialog .cta-button {
        background-color: #7f00ff;
        color: #fff;
        width: 100%;
        max-width: 100%;
        margin-top: 16px;
      }
      .nostr-zap-dialog .cta-button:hover {
        background-color: indigo;
      }
      .nostr-zap-dialog .close-button {
        background-color: inherit;
        color: black;
        border-radius: 50%;
        width: 42px;
        height: 42px;
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 12px;
        border: none;
      }
      .nostr-zap-dialog .preset-zap-options-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin: 24px 0 8px 0;
        height: 120px;
      }
      .nostr-zap-dialog input {
        padding: 12px;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        width: 100%;
        max-width: 100%;
        background-color: #f7fafc;
        color: #1a202c;
        box-shadow: none;
        box-sizing: border-box;
        margin-bottom: 16px;
        border: 1px solid lightgray;
      }
      .nostr-zap-dialog .spinner {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .nostr-zap-dialog .spinner:after {
        content: " ";
        display: block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 4px solid #fff;
        border-color: #fff transparent #fff transparent;
        animation: nostr-zap-dialog-spinner 1.2s linear infinite;
        margin-left: 8px;
      }
      .nostr-zap-dialog .error-message {
        text-align: left;
        color: red;
        margin-top: 8px;
      }
      .nostr-zap-dialog .qrcode {
        position: relative;
        display: inline-block;
        margin-top: 24px;
      }
      .nostr-zap-dialog .qrcode .overlay {
        position: absolute;
        color: white;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(127, 17, 224, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }
      .nostr-zap-dialog .qrcode .overlay.show {
        opacity: 1;
      }
      @keyframes nostr-zap-dialog-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes nostr-zap-dialog-skeleton-pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.8;
        }
        100% {
          opacity: 0.6;
        }
      }
      .nostr-zap-dialog .skeleton-placeholder {
        animation-name: nostr-zap-dialog-skeleton-pulse;
        animation-duration: 1.5s;
        animation-iteration-count: infinite;
        animation-timing-function: ease-in-out;
        background-color: #e8e8e8;
        border-radius: 4px;
        margin: 4px auto;
      }
      .nostr-zap-dialog p.skeleton-placeholder {
        height: 20px;
        width: 200px;
      }
      .nostr-zap-dialog h2.skeleton-placeholder {
        height: 28px;
        width: 300px;
      }
      .nostr-zap-dialog select[name="lightning-wallet"] {
        appearance: none;
        background-color: white;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%232D3748" width="24" height="24" viewBox="0 0 24 24"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" /></svg>');
        background-repeat: no-repeat;
        background-position: right 0.7rem center;
        background-size: 16px;
        border: 1px solid #CBD5E0;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: 0.25rem;
        width: 100%;
        margin-top: 24px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        cursor: pointer;
      }
      .nostr-zap-dialog select[name="lightning-wallet"]:focus {
        outline: none;
        border-color: #4FD1C5;
        box-shadow: 0 0 0 2px #4FD1C5;
      }
      @media only screen and (max-width: 480px) {
        .nostr-zap-dialog {
          padding: 18px;
        }

        .nostr-zap-dialog button {
          width: 92px;
          max-width: 92px;
        }
      }
      @media only screen and (max-width: 413px) {
        .nostr-zap-dialog {
          min-width: 324px;
        }
        .nostr-zap-dialog button {
          width: 78px;
          max-width: 78px;
        }
      }
  `;const w=document.createElement("div");document.body.appendChild(w),Bw=w.attachShadow({mode:"open"}),Bw.appendChild(v)})(),W_(),window.nostrZap={init:H_,initTarget:V_,initTargets:W_},sO}bbe();var wbe=_e('<div class="info-icon svg-icon svelte-1gjsub4"></div>'),vbe=_e('<div class="popover-body svelte-1gjsub4"><div class="popover-children svelte-1gjsub4"><!></div></div>'),xbe=_e("<!> <!>",1);function mS(t,e){let n=le(e,"side",3,"top"),r=le(e,"sideOffset",3,0),i=le(e,"ariaLabel",3,"æå ±ãè¡¨ç¤º");var s=Fe(),o=Te(s);Dt(o,()=>CG,(a,l)=>{l(a,{children:(c,u)=>{var d=xbe(),f=Te(d);Dt(f,()=>xG,(p,m)=>{m(p,{class:"info-trigger",get"aria-label"(){return i()},children:(g,y)=>{var b=wbe();X(g,b)},$$slots:{default:!0}})});var h=ve(f,2);Dt(h,()=>oc,(p,m)=>{m(p,{children:(g,y)=>{var b=Fe(),E=Te(b);Dt(E,()=>wG,(C,I)=>{I(C,{get side(){return n()},get sideOffset(){return r()},class:"popover-content",trapFocus:!1,onCloseAutoFocus:x=>x.preventDefault(),children:(x,P)=>{var T=vbe(),S=re(T),_=re(S);Tt(_,()=>e.children??Ut),X(x,T)},$$slots:{default:!0}})}),X(g,b)},$$slots:{default:!0}})}),X(c,d)},$$slots:{default:!0}})}),X(t,s)}var Sbe=_e('<div class="xmark-icon svg-icon svelte-1k7010o" aria-label="éãã"></div>'),Ebe=_e('<div class="help-icon svg-icon" aria-label="Help"></div>'),kbe=_e('<div class="github-icon svg-icon svelte-1k7010o" aria-label="GitHub"></div>'),Tbe=_e('<div class="rotate-right-icon svg-icon svelte-1k7010o"></div> <span class="btn-text"> </span>',1),_be=_e('<div class="setting-section sw-update-section svelte-1k7010o"><div class="setting-row svelte-1k7010o"><span class="setting-label sw-update-label svelte-1k7010o"> </span> <div class="setting-control svelte-1k7010o"><!></div></div></div>'),Cbe=_e('<div class="lang-icon-btn svg-icon svelte-1k7010o"></div> <span class="btn-text"> </span>',1),Abe=_e('<table class="popover-table svelte-1k7010o"><thead class="svelte-1k7010o"><tr class="svelte-1k7010o"><th class="svelte-1k7010o"> </th><th class="svelte-1k7010o"> </th><th class="svelte-1k7010o"> </th></tr></thead><tbody class="svelte-1k7010o"><tr class="svelte-1k7010o"><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td></tr><tr class="svelte-1k7010o"><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td></tr><tr class="svelte-1k7010o"><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td></tr></tbody></table>'),Ibe=_e('<div class="radio-pair svelte-1k7010o"></div>'),Pbe=_e('<table class="popover-table svelte-1k7010o"><thead class="svelte-1k7010o"><tr class="svelte-1k7010o"><th class="svelte-1k7010o"> </th><th class="svelte-1k7010o"> </th></tr></thead><tbody class="svelte-1k7010o"><tr class="svelte-1k7010o"><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td></tr><tr class="svelte-1k7010o"><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td></tr><tr class="svelte-1k7010o"><td class="svelte-1k7010o"> </td><td class="svelte-1k7010o"> </td></tr></tbody></table>'),Obe=_e('<div class="radio-pair svelte-1k7010o"></div>'),Mbe=_e("<option> </option>"),Nbe=_e('<div class="rotate-right-icon svg-icon svelte-1k7010o"></div> <span class="btn-text"> </span>',1),Rbe=(t,e)=>b2.set(!k(e)),Dbe=_e('<li class="svelte-1k7010o"> </li>'),Lbe=_e('<ul class="svelte-1k7010o"></ul>'),Bbe=_e('<span style="color: #888;"> </span>'),Fbe=_e('<div class="relay-list svelte-1k7010o"><!></div>'),$be=_e('<div class="settings-header svelte-1k7010o"><div class="first-row svelte-1k7010o"><div class="site-title svelte-1k7010o"><span class="site-name svelte-1k7010o">eHagaki</span> <span class="cache-version svelte-1k7010o"> </span></div> <div class="author-info svelte-1k7010o"><span> </span><a href="https://lokuyow.github.io/" target="_blank" class="svelte-1k7010o"> </a></div></div> <div class="second-row svelte-1k7010o"><!> <!> <div><div class="zap-view-btn-group svelte-1k7010o"><button class="zap-btn svelte-1k7010o" data-npub="npub1a3pvwe2p3v7mnjz6hle63r628wl9w567aw7u23fzqs062v5vqcqqu3sgh3" data-note-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-relays="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">Support</button> <span class="divider svelte-1k7010o"></span> <button class="view-btn svelte-1k7010o" data-title="Thanks for the Support!" data-nzv-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-zap-color-mode="true" data-relay-urls="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">View</button></div></div></div></div> <div class="modal-body svelte-1k7010o"><!> <div class="setting-section svelte-1k7010o"><div class="setting-row svelte-1k7010o"><span class="setting-label svelte-1k7010o">Language/è¨èª</span> <div class="setting-control svelte-1k7010o"><!></div></div></div> <div class="setting-section svelte-1k7010o"><div class="setting-row svelte-1k7010o"><div class="setting-label-wrapper svelte-1k7010o"><span class="setting-label svelte-1k7010o"> </span> <!></div> <div class="setting-control radio-group svelte-1k7010o"></div></div></div> <div class="setting-section svelte-1k7010o"><div class="setting-row svelte-1k7010o"><div class="setting-label-wrapper svelte-1k7010o"><span class="setting-label svelte-1k7010o"> </span> <!></div> <div class="setting-control radio-group svelte-1k7010o"></div></div></div> <div class="setting-section svelte-1k7010o"><div class="setting-row svelte-1k7010o"><span class="setting-label svelte-1k7010o"> </span> <div class="setting-control svelte-1k7010o"><select class="svelte-1k7010o"></select></div></div></div> <div class="setting-section svelte-1k7010o"><div class="setting-row svelte-1k7010o"><span class="setting-label svelte-1k7010o"> </span> <div class="setting-control svelte-1k7010o"><label class="toggle-switch svelte-1k7010o"><input type="checkbox" class="svelte-1k7010o"/> <span class="slider svelte-1k7010o"></span></label></div></div></div> <div class="setting-section svelte-1k7010o"><div class="setting-row svelte-1k7010o"><span class="setting-label svelte-1k7010o"> </span> <div class="setting-control svelte-1k7010o"><!></div></div> <div class="setting-info svelte-1k7010o"><button type="button" class="relay-toggle-label svelte-1k7010o" style="cursor:pointer; background:none; border:none; padding:0; font: inherit;"><span class="relay-toggle-icon svelte-1k7010o" aria-label="toggle"><!></span> </button> <!></div></div></div>',1);function zbe(t,e){const n=Xo();St(e,!0);const r=()=>qn(nr,"$_",o),i=()=>qn(cs,"$locale",o),s=()=>qn(Ik,"$swNeedRefresh",o),[o,a]=oi();let l=le(e,"show",15,!1),c=le(e,"onRefreshRelaysAndProfile",3,()=>{}),u=le(e,"selectedCompression",3,"medium"),d=le(e,"onSelectedCompressionChange",3,void 0),f=le(e,"selectedEndpoint",3,""),h=le(e,"onSelectedEndpointChange",3,void 0),p=le(e,"onOpenWelcomeDialog",3,void 0);function m(){l(!1),e.onClose?.()}Uf(()=>l(),m,!0);let g=ae(()=>sre(r())),y=ae(()=>ore(r())),b=ae(()=>HI(k(g),2)),E=ae(()=>HI(k(y),2)),C=ge(!0),I=ge(Nt(u())),x=ge("medium"),P=ge(Nt(f())),T=ge(!1),S=ae(()=>s5.value),_=ae(()=>Qh.value),O=ae(()=>b2.value),F=ae(()=>NI.value);Ge(()=>{const M=u();M!==void 0&&M!==""&&K(I,M,!0)}),Ge(()=>{d()&&k(I)!==u()&&d()(k(I))}),Ge(()=>{const M=f();M!==void 0&&M!==""&&K(P,M,!0)}),Ge(()=>{h()&&k(P)!==f()&&h()(k(P))}),Ge(()=>{k(T)&&k(I)&&localStorage.setItem(bi.IMAGE_COMPRESSION_LEVEL,k(I))}),Ge(()=>{k(T)&&k(x)&&localStorage.setItem(bi.VIDEO_COMPRESSION_LEVEL,k(x))}),Ge(()=>{k(T)&&k(P)&&localStorage.setItem(bi.UPLOAD_ENDPOINT,k(P))}),Ge(()=>{k(T)&&localStorage.setItem(bi.CLIENT_TAG_ENABLED,k(C)?"true":"false")});function L(){Yie(Bre,M=>NI.set(M),{timeout:ire})}function B(){const M=Xie({selectedEndpoint:f(),selectedCompression:u()});K(P,M.endpoint,!0),K(C,M.clientTagEnabled,!0),K(I,M.compression,!0);const R=localStorage.getItem(bi.VIDEO_COMPRESSION_LEVEL);R?R==="skip"?(K(x,"none"),localStorage.setItem(bi.VIDEO_COMPRESSION_LEVEL,"none")):K(x,R,!0):(K(x,"medium"),localStorage.setItem(bi.VIDEO_COMPRESSION_LEVEL,"medium")),K(T,!0)}us(()=>{B(),Fre(),Dr.value?.pubkey&&Dr.value?.isAuthenticated&&RI(Dr.value.pubkey)}),Ge(()=>{if(!l()){b2.set(!1);return}Dr.value?.pubkey&&Dr.value?.isAuthenticated&&RI(Dr.value.pubkey),(async()=>(await qa(),ybe(),window.nostrZap?.initTargets()))()}),Ge(()=>{i()&&!localStorage.getItem(bi.UPLOAD_ENDPOINT)&&K(P,_k(i()),!0)});function N(){cs.set(i()==="ja"?"en":"ja")}{const M=z=>{var V=Fe(),Q=Te(V);{const Y=(ie,ne)=>{Yt(ie,Kn(()=>ne?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(ke,ze)=>{var he=Sbe();X(ke,he)},$$slots:{default:!0}}))};Dt(Q,()=>Df,(ie,ne)=>{ne(ie,{child:Y,$$slots:{child:!0}})})}X(z,V)};let R=ae(()=>r()("settings")||"è¨­å®"),H=ae(()=>r()("settingsDialog.image_quality_setting"));zf(t,{onOpenChange:z=>!z&&m(),get title(){return k(R)},get description(){return k(H)},contentClass:"settings-dialog",footerVariant:"close-button",get open(){return l()},set open(z){l(z)},footer:M,children:(z,V)=>{var Q=$be(),Y=Te(Q),ie=re(Y),ne=re(ie),J=ve(re(ne),2),ke=re(J),ze=ve(ne,2),he=re(ze),Ee=re(he),Le=ve(he),pe=re(Le),xe=ve(ie,2),Me=re(xe);Yt(Me,{shape:"circle",variant:"default",className:"help-btn",onClick:()=>{m(),p()?.()},ariaLabel:"Help",children:(Ft,vn)=>{var nn=Ebe();X(Ft,nn)},$$slots:{default:!0}});var Ue=ve(Me,2);Yt(Ue,{shape:"circle",variant:"default",className:"github-link-btn",onClick:()=>window.open("https://github.com/Lokuyow/ehagaki","_blank"),ariaLabel:"GitHub Repository",children:(Ft,vn)=>{var nn=kbe();X(Ft,nn)},$$slots:{default:!0}});var qe=ve(Y,2),tt=re(qe);{var Ae=Ft=>{var vn=_be(),nn=re(vn),Pn=re(nn),pn=re(Pn),On=ve(Pn,2),En=re(On);{let $n=ae(()=>k(F)?"loading":""),zn=ae(()=>r()("settingsDialog.update_app")||"ã¢ããªãæ´æ°");Yt(En,{variant:"primary",shape:"rounded",get className(){return`sw-update-btn ${k($n)??""}`},onClick:L,get disabled(){return k(F)},get ariaLabel(){return k(zn)},children:(lo,ia)=>{var sa=Fe(),cl=Te(sa);{var ul=Ii=>{{let Ls=ae(()=>r()("settingsDialog.updating")||"æ´æ°ä¸­...");pc(Ii,{showLoader:!0,get text(){return k(Ls)}})}},Fc=Ii=>{var Ls=Tbe(),dl=Te(Ls),$c=ve(dl,2),fl=re($c);je((hl,di)=>{yn(dl,"aria-label",hl),Re(fl,di)},[()=>r()("settingsDialog.refresh")||"æ´æ°",()=>r()("settingsDialog.update_app")||"æ´æ°"]),X(Ii,Ls)};$e(cl,Ii=>{k(F)?Ii(ul):Ii(Fc,!1)})}X(lo,sa)},$$slots:{default:!0}})}je($n=>Re(pn,$n),[()=>r()("settingsDialog.sw_update_available")||"ã¢ããªã®æ´æ°ãããã¾ã"]),X(Ft,vn)};$e(tt,Ft=>{s()&&Ft(Ae)})}var We=ve(tt,2),lt=re(We),ht=ve(re(lt),2),wt=re(ht);Yt(wt,{variant:"default",shape:"rounded",className:"lang-btn",onClick:N,children:(Ft,vn)=>{var nn=Cbe(),Pn=Te(nn),pn=ve(Pn,2),On=re(pn);je((En,$n)=>{yn(Pn,"aria-label",En),Re(On,$n)},[()=>r()("settingsDialog.change")||"å¤æ´",()=>r()("settingsDialog.change")||"å¤æ´"]),X(Ft,nn)},$$slots:{default:!0}});var Lt=ve(We,2),Rt=re(Lt),pt=re(Rt),He=re(pt),st=re(He),Ot=ve(He,2);mS(Ot,{side:"top",ariaLabel:"ç»åå§ç¸®è¨­å®ã®èª¬æ",children:(Ft,vn)=>{var nn=Abe(),Pn=re(nn),pn=re(Pn),On=re(pn),En=re(On),$n=ve(On),zn=re($n),lo=ve($n),ia=re(lo),sa=ve(Pn),cl=re(sa),ul=re(cl),Fc=re(ul),Ii=ve(ul),Ls=re(Ii),dl=ve(Ii),$c=re(dl),fl=ve(cl),hl=re(fl),di=re(hl),Qi=ve(hl),Qu=re(Qi),Zf=ve(Qi),Bs=re(Zf),fi=ve(fl),hi=re(fi),Pi=re(hi),co=ve(hi),xm=re(co),Sm=ve(co),Em=re(Sm);je((Xu,Qf,km,Fs,Tm,_m,Yu,gw,yw)=>{Re(En,Xu),Re(zn,Qf),Re(ia,km),Re(Fc,Fs),Re(Ls,`${Zc.low.maxWidthOrHeight}px`),Re($c,`${Tm??""}%`),Re(di,_m),Re(Qu,`${Zc.medium.maxWidthOrHeight}px`),Re(Bs,`${Yu??""}%`),Re(Pi,gw),Re(xm,`${Zc.high.maxWidthOrHeight}px`),Re(Em,`${yw??""}%`)},[()=>r()("settingsDialog.info_header_setting"),()=>r()("settingsDialog.info_header_pixels"),()=>r()("settingsDialog.info_header_quality"),()=>r()("settingsDialog.quality_high"),()=>Math.round(Zc.low.initialQuality*100),()=>r()("settingsDialog.quality_medium"),()=>Math.round(Zc.medium.initialQuality*100),()=>r()("settingsDialog.quality_low"),()=>Math.round(Zc.high.initialQuality*100)]),X(Ft,nn)},$$slots:{default:!0}});var Mt=ve(pt,2);va(Mt,21,()=>k(b),Gc,(Ft,vn)=>{var nn=Ibe();va(nn,21,()=>k(vn),Gc,(Pn,pn)=>{{let On=ae(()=>k(I)===k(pn).value);DP(Pn,{get value(){return k(pn).value},name:"compression",get checked(){return k(On)},variant:"default",shape:"rounded",onChange:En=>K(I,En,!0),get ariaLabel(){return k(pn).label},children:(En,$n)=>{var zn=on();je(()=>Re(zn,k(pn).label)),X(En,zn)},$$slots:{default:!0}})}}),X(Ft,nn)});var dn=ve(Lt,2),Vt=re(dn),Qt=re(Vt),Jt=re(Qt),Sn=re(Jt),en=ve(Jt,2);mS(en,{side:"top",ariaLabel:"åç»å§ç¸®è¨­å®ã®èª¬æ",children:(Ft,vn)=>{var nn=Pbe(),Pn=re(nn),pn=re(Pn),On=re(pn),En=re(On),$n=ve(On),zn=re($n),lo=ve(Pn),ia=re(lo),sa=re(ia),cl=re(sa),ul=ve(sa),Fc=re(ul),Ii=ve(ia),Ls=re(Ii),dl=re(Ls),$c=ve(Ls),fl=re($c),hl=ve(Ii),di=re(hl),Qi=re(di),Qu=ve(di),Zf=re(Qu);je((Bs,fi,hi,Pi,co)=>{Re(En,Bs),Re(zn,fi),Re(cl,hi),Re(Fc,`${Pg.low.maxSize??""}px`),Re(dl,Pi),Re(fl,`${Pg.medium.maxSize??""}px`),Re(Qi,co),Re(Zf,`${Pg.high.maxSize??""}px`)},[()=>r()("settingsDialog.info_header_setting"),()=>r()("settingsDialog.info_header_pixels"),()=>r()("settingsDialog.quality_high"),()=>r()("settingsDialog.quality_medium"),()=>r()("settingsDialog.quality_low")]),X(Ft,nn)},$$slots:{default:!0}});var cn=ve(Qt,2);va(cn,21,()=>k(E),Gc,(Ft,vn)=>{var nn=Obe();va(nn,21,()=>k(vn),Gc,(Pn,pn)=>{{let On=ae(()=>k(x)===k(pn).value);DP(Pn,{get value(){return k(pn).value},name:"videoCompression",get checked(){return k(On)},variant:"default",shape:"rounded",onChange:En=>K(x,En,!0),get ariaLabel(){return k(pn).label},children:(En,$n)=>{var zn=on();je(()=>Re(zn,k(pn).label)),X(En,zn)},$$slots:{default:!0}})}}),X(Ft,nn)});var Bt=ve(dn,2),tn=re(Bt),hn=re(tn),Gi=re(hn),Zi=ve(hn,2),ds=re(Zi);va(ds,21,()=>n5,Gc,(Ft,vn)=>{var nn=Mbe(),Pn=re(nn),pn={};je(()=>{Re(Pn,k(vn).label),pn!==(pn=k(vn).url)&&(nn.value=(nn.__value=k(vn).url)??"")}),X(Ft,nn)});var _t=ve(Bt,2),Fn=re(_t),Ai=re(Fn),ci=re(Ai),rr=ve(Ai,2),Qn=re(rr),ui=re(Qn),Pt=ve(_t,2),Tr=re(Pt),na=re(Tr),jt=re(na),Zu=ve(na,2),wm=re(Zu);{let Ft=ae(()=>r()("settingsDialog.refresh_relays_and_profile")||"ååå¾");Yt(wm,{variant:"default",shape:"rounded",className:"refresh-relays-profile-btn",onClick:()=>c()&&c()(),get ariaLabel(){return k(Ft)},children:(vn,nn)=>{var Pn=Nbe(),pn=Te(Pn),On=ve(pn,2),En=re(On);je(($n,zn)=>{yn(pn,"aria-label",$n),Re(En,zn)},[()=>r()("settingsDialog.refresh")||"æ´æ°",()=>r()("settingsDialog.refresh")||"æ´æ°"]),X(vn,Pn)},$$slots:{default:!0}})}var Kf=ve(Tr,2),ll=re(Kf);ll.__click=[Rbe,O];var Gf=re(ll),vm=re(Gf);{var hw=Ft=>{var vn=on("â¼");X(Ft,vn)},Xe=Ft=>{var vn=on("â¶");X(Ft,vn)};$e(vm,Ft=>{k(O)?Ft(hw):Ft(Xe,!1)})}var ra=ve(Gf),pw=ve(ll,2);{var mw=Ft=>{var vn=Fbe(),nn=re(vn);{var Pn=On=>{var En=Lbe();va(En,21,()=>k(_),Gc,($n,zn)=>{var lo=Dbe(),ia=re(lo);je(()=>Re(ia,k(zn))),X($n,lo)}),X(On,En)},pn=On=>{var En=Bbe(),$n=re(En);je(zn=>Re($n,zn),[()=>r()("settingsDialog.no_relay_info")||"ãªã¬ã¼æå ±ãªã"]),X(On,En)};$e(nn,On=>{k(_).length>0?On(Pn):On(pn,!1)})}X(Ft,vn)};$e(pw,Ft=>{k(O)&&Ft(mw)})}je((Ft,vn,nn,Pn,pn,On,En,$n,zn)=>{Re(ke,k(S)?`v${k(S)}`:""),Re(Ee,Ft),Re(pe,vn),Re(st,nn),Re(Sn,Pn),Re(Gi,pn),yn(ds,"id",`${n}-endpoint`),Re(ci,On),yn(Qn,"for",`${n}-client-tag`),yn(ui,"id",`${n}-client-tag`),Re(jt,En),yn(ll,"aria-pressed",k(O)),yn(ll,"aria-label",$n),Re(ra,` ${zn??""}`)},[()=>r()("settingsDialog.author_info")||"å¶ä½ï¼",()=>r()("settingsDialog.author_name")||" Lokuyow",()=>r()("settingsDialog.image_quality_setting"),()=>r()("settingsDialog.video_quality_setting"),()=>r()("settingsDialog.upload_destination")||"ã¢ããã­ã¼ãå",()=>r()("settingsDialog.client_tag_label")||"æç¨¿è©³ç´°ã«ã¯ã©ã¤ã¢ã³ãåãã¤ããï¼Client tagï¼",()=>r()("settingsDialog.refresh_relays_and_profile")||"ãªã¬ã¼ãªã¹ãã»ãã­ãã£ã¼ã«ååå¾",()=>r()("settingsDialog.toggle_write_relays_list")||"æç¨¿åãªã¬ã¼ã®è¡¨ç¤ºåæ¿",()=>r()("settingsDialog.write_relays_list")||"æ¸ãè¾¼ã¿åãªã¬ã¼ãªã¹ã"]),MU(ds,()=>k(P),Ft=>K(P,Ft)),BU(ui,()=>k(C),Ft=>K(C,Ft)),X(z,Q)},$$slots:{footer:!0,default:!0}})}Et(),a()}Ti(["click"]);var Ube=_e('<div class="xmark-icon svg-icon svelte-6wkr0b" aria-label="éãã"></div>'),Hbe=_e('<img class="profile-image svelte-6wkr0b"/>'),Vbe=_e('<div class="profile-image-placeholder svg-icon svelte-6wkr0b" aria-label="Profile image placeholder"></div>'),Wbe=(t,e,n)=>e(k(n).npub,"npub",t),jbe=_e('<div class="profile-info-row svelte-6wkr0b"><div class="profile-info-content svelte-6wkr0b"><span class="profile-info-text svelte-6wkr0b"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-6wkr0b" aria-label="Copy npub"></div></button></div></div>'),qbe=(t,e,n)=>e(k(n).nprofile,"nprofile",t),Kbe=_e('<div class="profile-info-row svelte-6wkr0b"><div class="profile-info-content svelte-6wkr0b"><span class="profile-info-text svelte-6wkr0b"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-6wkr0b" aria-label="Copy nprofile"></div></button></div></div>'),Gbe=_e('<div class="profile-info-label svelte-6wkr0b"> </div> <span class="profile-info-text"><!></span>',1),Zbe=_e('<div class="profile-container svelte-6wkr0b"><div class="profile-summary svelte-6wkr0b"><div class="profile-image-container svelte-6wkr0b"><!></div> <div class="profile-name svelte-6wkr0b"> </div></div> <div class="nostr-ids svelte-6wkr0b"><div class="profile-info-label svelte-6wkr0b"> </div> <div class="profile-info-container svelte-6wkr0b"><!> <!></div></div> <div class="auth-controls svelte-6wkr0b"><div class="auth-container svelte-6wkr0b"><!></div> <!></div></div>'),Qbe=_e('<div class="copy-success-message"> </div>'),Xbe=_e("<!> <!>",1);function Ybe(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=le(e,"show",15,!1),o=le(e,"isLoggingOut",3,!1);function a(){s(!1),e.onClose?.()}Uf(()=>s(),a,!0);let l=ae(()=>Vl.value),c=ae(()=>Dr.value),u=ge(Nt(Vl.value)),d=ge(!1),f=ge(0),h=ge(0);Ge(()=>{!o()&&k(l)&&K(u,k(l),!0)});function p(){e.onLogout?.()}async function m(E,C,I){try{await Kb(E,C,navigator,window);const x=Kd(I.clientX,I.clientY);K(f,x.x,!0),K(h,x.y,!0),K(d,!0),setTimeout(()=>{K(d,!1)},1800)}catch(x){console.warn("Copy failed:",x)}}var g=Xbe(),y=Te(g);{const E=x=>{var P=Fe(),T=Te(P);{const S=(_,O)=>{Yt(_,Kn(()=>O?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(L,B)=>{var N=Ube();X(L,N)},$$slots:{default:!0}}))};Dt(T,()=>Df,(_,O)=>{O(_,{child:S,$$slots:{child:!0}})})}X(x,P)};let C=ae(()=>n()("profileDialog.title")),I=ae(()=>n()("profileDialog.npub"));zf(y,{onOpenChange:x=>!x&&a(),get title(){return k(C)},get description(){return k(I)},contentClass:"profile-dialog",footerVariant:"close-button",get open(){return s()},set open(x){s(x)},footer:E,children:(x,P)=>{var T=Zbe(),S=re(T),_=re(S),O=re(_);{var F=Ee=>{var Le=Hbe();je(()=>{yn(Le,"src",k(u).picture),yn(Le,"alt",k(u).name||"Profile")}),X(Ee,Le)},L=Ee=>{var Le=Vbe();X(Ee,Le)};$e(O,Ee=>{k(u).picture?Ee(F):Ee(L,!1)})}var B=ve(_,2),N=re(B),M=ve(S,2),R=re(M),H=re(R),z=ve(R,2),V=re(z);{var Q=Ee=>{var Le=jbe(),pe=re(Le),xe=re(pe),Me=re(xe),Ue=ve(xe,2);Ue.__click=[Wbe,m,u],je(qe=>{Re(Me,k(u).npub),yn(Ue,"aria-label",qe)},[()=>n()("profileDialog.copy_npub")]),X(Ee,Le)};$e(V,Ee=>{k(u).npub&&Ee(Q)})}var Y=ve(V,2);{var ie=Ee=>{var Le=Kbe(),pe=re(Le),xe=re(pe),Me=re(xe),Ue=ve(xe,2);Ue.__click=[qbe,m,u],je(qe=>{Re(Me,k(u).nprofile),yn(Ue,"aria-label",qe)},[()=>n()("profileDialog.copy_nprofile")]),X(Ee,Le)};$e(Y,Ee=>{k(u).nprofile&&Ee(ie)})}var ne=ve(M,2),J=re(ne),ke=re(J);{var ze=Ee=>{var Le=Gbe(),pe=Te(Le),xe=re(pe),Me=ve(pe,2),Ue=re(Me);{var qe=Ae=>{var We=on();je(lt=>Re(We,lt),[()=>n()("profileDialog.login_method_nsec")]),X(Ae,We)},tt=Ae=>{var We=Fe(),lt=Te(We);{var ht=wt=>{var Lt=Fe(),Rt=Te(Lt);{var pt=st=>{var Ot=on();je(Mt=>Re(Ot,Mt),[()=>n()("profileDialog.login_method_nostr_login_connect")]),X(st,Ot)},He=st=>{var Ot=Fe(),Mt=Te(Ot);{var dn=Qt=>{var Jt=on();je(Sn=>Re(Jt,Sn),[()=>n()("profileDialog.login_method_nostr_login_extension")]),X(Qt,Jt)},Vt=Qt=>{var Jt=Fe(),Sn=Te(Jt);{var en=Bt=>{var tn=on();je(hn=>Re(tn,hn),[()=>n()("profileDialog.login_method_nostr_login_local")]),X(Bt,tn)},cn=Bt=>{var tn=on();je(hn=>Re(tn,hn),[()=>n()("profileDialog.login_method_nostr_login_connect")]),X(Bt,tn)};$e(Sn,Bt=>{k(c)?.nostrLoginAuthMethod==="local"?Bt(en):Bt(cn,!1)},!0)}X(Qt,Jt)};$e(Mt,Qt=>{k(c)?.nostrLoginAuthMethod==="extension"?Qt(dn):Qt(Vt,!1)},!0)}X(st,Ot)};$e(Rt,st=>{k(c)?.nostrLoginAuthMethod==="connect"?st(pt):st(He,!1)})}X(wt,Lt)};$e(lt,wt=>{k(c)?.type==="nostr-login"&&wt(ht)},!0)}X(Ae,We)};$e(Ue,Ae=>{k(c)?.type==="nsec"?Ae(qe):Ae(tt,!1)})}je(Ae=>Re(xe,Ae),[()=>n()("profileDialog.login_method")]),X(Ee,Le)};$e(ke,Ee=>{(k(c)?.type==="nsec"||k(c)?.type==="nostr-login")&&Ee(ze)})}var he=ve(J,2);{let Ee=ae(()=>o()?"loading":"");Yt(he,{onClick:p,get className(){return`logout-btn ${k(Ee)??""}`},variant:"danger",shape:"square",get disabled(){return o()},children:(Le,pe)=>{var xe=Fe(),Me=Te(xe);{var Ue=tt=>{pc(tt,{text:!0,showLoader:!0})},qe=tt=>{var Ae=on();je(We=>Re(Ae,We),[()=>n()("logoutDialog.logout")]),X(tt,Ae)};$e(Me,tt=>{o()?tt(Ue):tt(qe,!1)})}X(Le,xe)},$$slots:{default:!0}})}je((Ee,Le)=>{Re(N,Ee),Re(H,Le)},[()=>k(u).name||n()("profileDialog.anonymous"),()=>n()("profileDialog.npub")]),X(x,T)},$$slots:{footer:!0,default:!0}})}var b=ve(y,2);kT(b,{get show(){return k(d)},get x(){return k(f)},get y(){return k(h)},onClose:()=>K(d,!1),children:(E,C)=>{var I=Qbe(),x=re(I);je(P=>Re(x,P),[()=>n()("imageContextMenu.copySuccess")]),X(E,I)},$$slots:{default:!0}}),X(t,g),Et(),i()}Ti(["click"]);var Jbe=_e('<div><span style="word-break:break-all"> </span></div>'),ewe=_e('<div><span style="word-break:break-all"> </span></div>'),twe=_e('<div class="toast npub-toast svelte-yvvqx6"><!> <!></div>'),nwe=_e('<div class="xmark-icon svg-icon svelte-yvvqx6" aria-label="éãã"></div>'),rwe=_e('<img src="./icons/nostr-login.svg" alt="nostr-login" class="nostr-login-icon svelte-yvvqx6"/> <span class="btn-text svelte-yvvqx6">Nostr Login</span>',1),iwe=(t,e)=>{t.key==="Enter"&&e()},swe=(t,e)=>{k(e)&&k(e).setCustomValidity("")},owe=_e('<!> <div class="divider svelte-yvvqx6"><span class="svelte-yvvqx6"> </span></div> <h3 class="svelte-yvvqx6"> </h3> <form class="svelte-yvvqx6"><input type="text" name="username" autocomplete="username" style="display: none;" aria-hidden="true"/> <input type="password" placeholder="nsec1â¦" class="secret-input svelte-yvvqx6" id="secretKey" name="secretKey" autocomplete="current-password" required minlength="63" maxlength="63"/> <div class="dialog-buttons svelte-yvvqx6"><!> <!></div></form>',1),awe=_e("<!> <!>",1);function lwe(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=le(e,"show",15,!1),o=le(e,"secretKey",15),a=le(e,"isLoadingNostrLogin",3,!1);function l(){s(!1),e.onClose?.()}Uf(()=>s(),l,!0);const c=new EL;let u=ge(null);Ge(()=>{o()!==void 0&&(c.setNsec(o()),k(u)&&(o()||k(u).setCustomValidity("")))});let d=ge(!1),f=ge(""),h=ge("");Ge(()=>{c.isValid.subscribe(x=>K(d,x,!0))}),Ge(()=>{c.npub.subscribe(x=>K(f,x,!0))}),Ge(()=>{c.nprofile.subscribe(x=>K(h,x,!0))});function p(){if(k(u)){const x=k(u).validity,P=k(u).value??"";if(x.valueMissing){k(u).setCustomValidity(n()("loginDialog.secret_required")),k(u).reportValidity();return}if(!P.startsWith("nsec1")){k(u).setCustomValidity(n()("loginDialog.secret_must_start_nsec1")),k(u).reportValidity();return}if(P.length!==63){P.length<63?k(u).setCustomValidity(n()("loginDialog.secret_too_short")):k(u).setCustomValidity(n()("loginDialog.secret_too_long")),k(u).reportValidity();return}if(!k(d)){k(u).setCustomValidity(n()("loginDialog.invalid_secret")),k(u).reportValidity();return}k(u).setCustomValidity("")}e.onSave?.()}function m(){o(""),k(u)&&k(u).setCustomValidity("")}function g(){e.onNostrLogin?.()}function y(x){x.preventDefault(),p()}var b=awe(),E=Te(b);{var C=x=>{var P=twe(),T=re(P);{var S=F=>{var L=Jbe(),B=re(L),N=re(B);je(()=>Re(N,k(f))),X(F,L)};$e(T,F=>{k(f)&&F(S)})}var _=ve(T,2);{var O=F=>{var L=ewe(),B=re(L),N=re(B);je(()=>Re(N,k(h))),X(F,L)};$e(_,F=>{k(h)&&F(O)})}X(x,P)};$e(E,x=>{(k(f)||k(h))&&x(C)})}var I=ve(E,2);{const x=S=>{var _=Fe(),O=Te(_);{const F=(L,B)=>{Yt(L,Kn(()=>B?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(M,R)=>{var H=nwe();X(M,H)},$$slots:{default:!0}}))};Dt(O,()=>Df,(L,B)=>{B(L,{child:F,$$slots:{child:!0}})})}X(S,_)};let P=ae(()=>n()("loginDialog.input_secret")),T=ae(()=>n()("loginDialog.hint_input_secret"));zf(I,{onOpenChange:S=>!S&&l(),get title(){return k(P)},get description(){return k(T)},contentClass:"login-dialog",footerVariant:"close-button",get open(){return s()},set open(S){s(S)},footer:x,children:(S,_)=>{var O=owe(),F=Te(O);{let ie=ae(()=>a()?"loading":"");Yt(F,{variant:"default",shape:"rounded",get className(){return`nostr-login-button ${k(ie)??""}`},onClick:g,get disabled(){return a()},children:(ne,J)=>{var ke=Fe(),ze=Te(ke);{var he=Le=>{pc(Le,{text:!0,showLoader:!0,customClass:"nostr-login-placeholder"})},Ee=Le=>{var pe=rwe();X(Le,pe)};$e(ze,Le=>{a()?Le(he):Le(Ee,!1)})}X(ne,ke)},$$slots:{default:!0}})}var L=ve(F,2),B=re(L),N=re(B),M=ve(L,2),R=re(M),H=ve(M,2),z=ve(re(H),2);z.__keydown=[iwe,p],z.__input=[swe,u],pr(z,ie=>K(u,ie),()=>k(u));var V=ve(z,2),Q=re(V);Yt(Q,{variant:"warning",shape:"square",type:"button",onClick:m,className:"clear-btn",children:(ie,ne)=>{var J=on();je(ke=>Re(J,ke),[()=>n()("loginDialog.clear")]),X(ie,J)},$$slots:{default:!0}});var Y=ve(Q,2);Yt(Y,{variant:"primary",shape:"square",type:"submit",className:"save-btn",children:(ie,ne)=>{var J=on();je(ke=>Re(J,ke),[()=>n()("loginDialog.save")]),X(ie,J)},$$slots:{default:!0}}),je((ie,ne,J)=>{Re(N,ie),Re(R,ne),yn(z,"title",J)},[()=>n()("loginDialog.or"),()=>n()("loginDialog.input_secret"),()=>n()("loginDialog.hint_input_secret")]),js("submit",H,y),LU(z,o),X(S,O)},$$slots:{footer:!0,default:!0}})}X(t,b),Et(),i()}Ti(["keydown","input"]);var cwe=_e('<div class="welcome-content svelte-1veb7bk"><div class="title-section svelte-1veb7bk"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-1veb7bk"/> <h2 class="svelte-1veb7bk"> </h2></div> <p class="svelte-1veb7bk"> </p> <pre class="features svelte-1veb7bk"> </pre></div>');function uwe(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=le(e,"show",15,!1);function o(){s(!1),e.onClose?.()}Uf(()=>s(),o,!0);{const a=u=>{var d=Fe(),f=Te(d);{const h=(p,m)=>{Yt(p,Kn(()=>m?.().props,{variant:"primary",shape:"square",className:"get-started-btn",children:(y,b)=>{var E=on();je(C=>Re(E,C),[()=>n()("welcomeDialog.get_started")]),X(y,E)},$$slots:{default:!0}}))};Dt(f,()=>Df,(p,m)=>{m(p,{child:h,$$slots:{child:!0}})})}X(u,d)};let l=ae(()=>n()("welcomeDialog.title")),c=ae(()=>n()("welcomeDialog.description"));zf(t,{onOpenChange:u=>!u&&o(),get title(){return k(l)},get description(){return k(c)},contentClass:"welcome-dialog",get open(){return s()},set open(u){s(u)},footer:a,children:(u,d)=>{var f=cwe(),h=re(f),p=ve(re(h),2),m=re(p),g=ve(h,2),y=re(g),b=ve(g,2),E=re(b);je((C,I,x)=>{Re(m,C),Re(y,I),Re(E,x)},[()=>n()("welcomeDialog.title"),()=>n()("welcomeDialog.description"),()=>n()("welcomeDialog.features")]),X(u,f)},$$slots:{footer:!0,default:!0}})}Et(),i()}function dw(){const t=localStorage.getItem(bi.DRAFTS);if(!t)return[];try{return JSON.parse(t).sort((n,r)=>r.timestamp-n.timestamp)}catch{return[]}}function fw(t){localStorage.setItem(bi.DRAFTS,JSON.stringify(t))}function BF(t){const e=document.createElement("div");e.innerHTML=t;const n=e.querySelector("img")!==null,r=e.querySelector("video")!==null,o=(e.textContent||e.innerText||"").split(`
`).filter(h=>h.trim())[0]||"",a=Ys(cs)||"en",l=Ys(nr);let c="[ç»å]",u="[åç»]";try{c=l("draft.media.image")||(a.startsWith("ja")?"[ç»å]":"[Image]"),u=l("draft.media.video")||(a.startsWith("ja")?"[åç»]":"[Video]")}catch{c=a.startsWith("ja")?"[ç»å]":"[Image]",u=a.startsWith("ja")?"[åç»]":"[Video]"}const d=[];n&&d.push(c),r&&d.push(u);const f=d.join("");if(o){if(f){const h=`${o} ${f}`;if(h.length>Xm){const p=Xm-f.length-2;return p>0?`${o.substring(0,p)}â¦ ${f}`:f}return h}return o.length>Xm?o.substring(0,Xm)+"â¦":o}if(f)return f;try{return l("draft.no_content")||(a.startsWith("ja")?"(åå®¹ãªã)":"(No content)")}catch{return a.startsWith("ja")?"(åå®¹ãªã)":"(No content)"}}function FF(){return`draft_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function dwe(t){const e=dw();if(e.length>=t5)return{success:!1,needsConfirmation:!0,drafts:e};const r=[{id:FF(),content:t,preview:BF(t),timestamp:Date.now()},...e];return fw(r),{success:!0,needsConfirmation:!1,drafts:r}}function fwe(t){const n=dw().slice(0,t5-1),i=[{id:FF(),content:t,preview:BF(t),timestamp:Date.now()},...n];return fw(i),i}function hwe(t){const n=dw().filter(r=>r.id!==t);return fw(n),n}function pwe(){return fw([]),[]}function mwe(t){const e=Date.now(),n=e-t,r=60*1e3,i=60*r,s=24*i,o=Ys(cs)||"en",a=Ys(nr),l=new Intl.RelativeTimeFormat(o,{numeric:"auto"});if(n<r)try{return a("draft.time.now")}catch{return o.startsWith("ja")?"ä»":"Now"}else if(n<i){const c=Math.floor(n/r);return o.startsWith("en")?`${c}m ago`:l.format(-c,"minute")}else if(n<s){const c=Math.floor(n/i);return o.startsWith("en")?`${c}h ago`:l.format(-c,"hour")}else{const c=new Date(t),u=365*s;return e-t<u?new Intl.DateTimeFormat(o,{month:"numeric",day:"numeric"}).format(c):new Intl.DateTimeFormat(o,{year:"numeric",month:"numeric",day:"numeric"}).format(c)}}var gwe=_e('<div class="xmark-icon svg-icon svelte-xjbbf5"></div>'),ywe=_e('<div class="trash-icon svg-icon svelte-xjbbf5"></div> <span class="delete-all-label"> </span>',1),bwe=_e('<div class="empty-message svelte-xjbbf5"> </div>'),wwe=(t,e,n)=>e(k(n)),vwe=_e('<div class="trash-icon svg-icon svelte-xjbbf5"></div>'),xwe=_e('<li class="draft-item svelte-xjbbf5"><button type="button" class="draft-content svelte-xjbbf5"><span class="draft-preview svelte-xjbbf5"> </span> <span class="draft-timestamp svelte-xjbbf5"> </span></button> <!></li>'),Swe=_e('<ul class="draft-list svelte-xjbbf5"></ul>'),Ewe=_e('<div class="dialog-heading-container svelte-xjbbf5"><div class="dialog-heading-wrapper svelte-xjbbf5"><h3 class="dialog-heading svelte-xjbbf5"> </h3> <!></div> <!></div> <div class="draft-list-container svelte-xjbbf5"><!></div>',1);function kwe(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=le(e,"show",15,!1),o=ge(Nt([]));function a(){s(!1),e.onClose?.()}Uf(()=>s(),a,!0),Ge(()=>{s()&&K(o,dw(),!0)});function l(d){e.onApplyDraft(d.content),a()}function c(d){K(o,hwe(d),!0)}function u(){K(o,pwe(),!0)}{const d=p=>{var m=Fe(),g=Te(m);{const y=(b,E)=>{let C=()=>E?.().props;{let I=ae(()=>n()("global.close")||"éãã");Yt(b,Kn(C,{className:"modal-close",variant:"default",shape:"square",get ariaLabel(){return k(I)},children:(x,P)=>{var T=gwe();je(S=>yn(T,"aria-label",S),[()=>n()("global.close")||"éãã"]),X(x,T)},$$slots:{default:!0}}))}};Dt(g,()=>Df,(b,E)=>{E(b,{child:y,$$slots:{child:!0}})})}X(p,m)};let f=ae(()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§"),h=ae(()=>n()("draft.list_description")||"ä¿å­ããä¸æ¸ããé¸æãã¦å¾©å");zf(t,{onOpenChange:p=>!p&&a(),get title(){return k(f)},get description(){return k(h)},contentClass:"draft-list-dialog",footerVariant:"close-button",get open(){return s()},set open(p){s(p)},footer:d,children:(p,m)=>{var g=Ewe(),y=Te(g),b=re(y),E=re(b),C=re(E),I=ve(E,2);{let O=ae(()=>n()("draft.info")||"ä¸æ¸ãæå ±");mS(I,{side:"bottom",sideOffset:8,get ariaLabel(){return k(O)},children:(F,L)=>{var B=on();je(N=>Re(B,N),[()=>n()("draft.info")||"ä¸æ¸ãã¯ãã©ã¦ã¶ã«ä¿å­ããã¾ãããã©ã¦ã¶ã®ãã¼ã¿ãåé¤ããããã­ã°ã¢ã¦ãããã¨ä¸æ¸ãã¯åé¤ããã¾ãã"]),X(F,B)},$$slots:{default:!0}})}var x=ve(b,2);{let O=ae(()=>n()("draft.delete_all")||"å¨ã¦åé¤");Yt(x,{className:"delete-all-button",variant:"default",shape:"rounded",get ariaLabel(){return k(O)},onClick:u,children:(F,L)=>{var B=ywe(),N=ve(Te(B),2),M=re(N);je(R=>Re(M,R),[()=>n()("draft.delete_all")||"å¨ã¦åé¤"]),X(F,B)},$$slots:{default:!0}})}var P=ve(y,2),T=re(P);{var S=O=>{var F=bwe(),L=re(F);je(B=>Re(L,B),[()=>n()("draft.no_drafts")||"ä¸æ¸ããããã¾ãã"]),X(O,F)},_=O=>{var F=Swe();va(F,21,()=>k(o),L=>L.id,(L,B)=>{var N=xwe(),M=re(N);M.__click=[wwe,l,B];var R=re(M),H=re(R),z=ve(R,2),V=re(z),Q=ve(M,2);{let Y=ae(()=>n()("draft.delete")||"åé¤");Yt(Q,{className:"delete-button",variant:"default",shape:"square",get ariaLabel(){return k(Y)},onClick:()=>c(k(B).id),children:(ie,ne)=>{var J=vwe();X(ie,J)},$$slots:{default:!0}})}je(Y=>{Re(H,k(B).preview),Re(V,Y)},[()=>mwe(k(B).timestamp)]),X(L,N)}),X(O,F)};$e(T,O=>{k(o).length===0?O(S):O(_,!1)})}je(O=>Re(C,O),[()=>n()("draft.title")||"ä¸æ¸ã"]),X(p,g)},$$slots:{footer:!0,default:!0}})}Et(),i()}Ti(["click"]);class Uy{static createMergedOptions(e){return{theme:"default",noBanner:!0,methods:"connect, extension, local",perms:"get_public_key,sign_event:1,sign_event:27235",startScreen:"welcome",...e}}static processBunkers(e){return Array.isArray(e)?e.join(","):void 0}static async npubToPubkey(e){try{if(!e)return{success:!1,error:{type:"decode",message:"npub is empty or null"}};const n=Za.decode(e);return n.type==="npub"?{success:!0,pubkey:n.data}:{success:!1,error:{type:"decode",message:"Invalid npub format"}}}catch(n){return{success:!1,error:{type:"decode",message:"Failed to decode npub",originalError:n}}}}static getCurrentUserFromWindow(e){try{const n=e.nostrLogin;if(n&&n.pubkey)return{pubkey:n.pubkey,npub:n.npub}}catch{return null}return null}static getNostrLoginAuthMethod(e,n){try{const r=n.getItem("__nostrlogin_accounts");if(!r)return;const i=JSON.parse(r);if(!Array.isArray(i))return;const s=i.find(a=>a?.pubkey===e);if(!s||!s.authMethod)return;const o=s.authMethod;return o==="connect"||o==="extension"||o==="local"?o:void 0}catch{return}}}class Twe{constructor(e,n,r){this.console=e,this.getAuthHandler=n,this.isLoggingOut=r}async handleAuthCallback(e,n){const r=this.getAuthHandler();if(!(!r||this.isLoggingOut()))try{if(!e){r({type:"logout"});return}const i=await Uy.npubToPubkey(e);if(!i.success||!i.pubkey){this.console.warn("NostrLogin: Failed to get pubkey from npub",i.error);return}const s=n?.type||"login";r({type:s,pubkey:i.pubkey,npub:e,otpData:n?.otpData})}catch(i){this.console.error("NostrLogin auth callback error:",i)}}}class _we{constructor(e,n,r){this.console=e,this.importNostrLogin=n,this.authHandler=r}async initialize(e){try{const r=(await this.importNostrLogin()).init;if(!r)throw new TypeError("nostr-login: init function is missing");const i=Uy.createMergedOptions(e),s=this.authHandler.handleAuthCallback.bind(this.authHandler),o=i.bunkers!==void 0?Uy.processBunkers(i.bunkers):void 0,a={...i,bunkers:o,startScreen:i.startScreen,onAuth:s};return await Promise.resolve(r(a)),this.console.log("nostr-loginåæåå®äº"),{success:!0}}catch(n){const r={type:"initialization",message:"Failed to initialize nostr-login",originalError:n};return this.console.error("nostr-loginåæåã¨ã©ã¼:",n),{success:!1,error:r}}}}class Cwe{constructor(e){this.importNostrLogin=e}async launch(e){try{const{launch:n}=await this.importNostrLogin();return await n(e||"welcome"),{success:!0}}catch(n){return{success:!1,error:{type:"launch",message:"Failed to launch nostr-login",originalError:n}}}}}class Awe{constructor(e,n){this.document=e,this.setTimeout=n}logout(e){e(!0);try{const n=new Event("nlLogout");this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlLogout event:",n)}try{this.setTimeout(()=>{e(!1)},100)}catch(n){console.error("Failed to set logout flag timeout:",n),e(!1)}}setDarkMode(e){try{const n=new CustomEvent("nlDarkMode",{detail:e});this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlDarkMode event:",n)}}}class Iwe{initialized=!1;authHandler=null;isLoggingOutFlag=!1;initPromise=null;resolvedPromise=null;initializer;launcher;eventEmitter;authCallbackHandler;windowObj;documentObj;consoleObj;setTimeoutFn;constructor(e={}){this.windowObj=e.window||(typeof window<"u"?window:{}),this.documentObj=e.document||(typeof window<"u"?window.document:{}),this.consoleObj=e.console||(typeof window<"u"?window.console:{}),this.setTimeoutFn=e.setTimeout||(typeof window<"u"&&window.setTimeout?window.setTimeout.bind(window):(()=>{}));const n=e.importNostrLogin||(()=>ob(()=>import("./index.esm-B6zogCv1.js"),[]));this.authCallbackHandler=new Twe(this.consoleObj,()=>this.authHandler,()=>this.isLoggingOutFlag),this.initializer=new _we(this.consoleObj,n,this.authCallbackHandler),this.launcher=new Cwe(n),this.eventEmitter=new Awe(this.documentObj,this.setTimeoutFn)}init(e={}){return this.initPromise!==null?this.initPromise:this.initialized?this.resolvedPromise:(this.initPromise=new Promise((n,r)=>{this.initializer.initialize(e).then(i=>{if(i.success)this.initialized=!0,this.resolvedPromise=this.initPromise,n();else{this._resetInitializationState();const s=i.error?.message||"Initialization failed",o=i.error?.originalError;o instanceof Error?r(o):r(new Error(s))}}).catch(i=>{this._resetInitializationState(),r(i)})}),this.initPromise)}_resetInitializationState(){this.initialized=!1,this.initPromise=null,this.resolvedPromise=null}setAuthHandler(e){this.authHandler=e}async showLogin(e){if(!this._ensureInitialized())throw new Error("nostr-login is not initialized");const n=await this.launcher.launch(e);if(!n.success)throw n.error?.originalError instanceof Error?n.error.originalError:new Error(n.error?.message||"Failed to launch login")}logout(){try{if(!this._ensureInitialized())return;this.eventEmitter.logout(e=>{this.isLoggingOutFlag=e})}catch(e){this.consoleObj.error("NostrLogin logout error:",e)}}setDarkMode(e){this._ensureInitialized()&&this.eventEmitter.setDarkMode(e)}getCurrentUser(){return this.initialized?Uy.getCurrentUserFromWindow(this.windowObj):null}_ensureInitialized(){return this.initialized?!0:(this.consoleObj.warn("nostr-loginãåæåããã¦ãã¾ãã"),!1)}get isInitialized(){return this.initialized}getInitializer(){return this.initializer}getLauncher(){return this.launcher}getEventEmitter(){return this.eventEmitter}getAuthCallbackHandler(){return this.authCallbackHandler}}const aO=new Iwe;class Hy{static isValidSecretKey(e,n){return n.isValidNsec(e)}static hasRequiredPubkey(e){return e.type!=="logout"&&!!e.pubkey}static isLogoutAuth(e){return e.type==="logout"}}class Pwe{constructor(e,n,r){this.keyManager=e,this.setNsecAuth=n,this.console=r}async authenticate(e){if(!Hy.isValidSecretKey(e,this.keyManager))return{success:!1,error:"invalid_secret"};const{success:n}=this.keyManager.saveToStorage(e);if(!n)return{success:!1,error:"error_saving"};try{const r=this.keyManager.derivePublicKey(e);return r.hex?(this.setNsecAuth(r.hex,r.npub,r.nprofile),{success:!0,pubkeyHex:r.hex}):{success:!1,error:"derivation_failed"}}catch(r){return this.console.error("nsecèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",r),{success:!1,error:"authentication_error"}}}}class Owe{constructor(e,n){this.publicKeyState=e,this.console=n}async authenticate(e){if(Hy.isLogoutAuth(e))return{success:!0};if(!Hy.hasRequiredPubkey(e))return this.console.warn("NostrLoginAuth: pubkey is required for login/signup"),{success:!1,error:"missing_pubkey"};try{return this.publicKeyState.setNostrLoginAuth(e),{success:!0,pubkeyHex:e.pubkey}}catch(n){return this.console.error("nostr-loginèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",n),{success:!1,error:"nostr_login_error"}}}}class Mwe{constructor(e){this.window=e}async waitForExternalAuth(e=5e3){const n=Date.now(),r=100;return new Promise(i=>{const s=()=>{if(this.isWindowNostrAvailable()){i(!0);return}if(Date.now()-n>=e){i(!1);return}setTimeout(s,r)};s()})}isWindowNostrAvailable(){return typeof this.window<"u"&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}}class Nwe{constructor(e,n){this.navigator=e,this.console=n}async clearProfileImageCache(){try{if(!this.hasServiceWorker())return;const e=new MessageChannel;return new Promise((n,r)=>{e.port1.onmessage=i=>{i.data.success?(this.console.log("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ãã¯ãªã¢ãã¾ãã"),n()):(this.console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢å¤±æ:",i.data.error),r(new Error(i.data.error)))},this.navigator.serviceWorker.controller?this.navigator.serviceWorker.controller.postMessage({action:"clearProfileCache"},[e.port2]):r(new Error("Service worker controller is null."))})}catch(e){this.console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}}hasServiceWorker(){return"serviceWorker"in this.navigator&&!!this.navigator.serviceWorker.controller}}class Rwe{constructor(e){this.localStorage=e}getStoredNostrLoginData(){try{const e=this.localStorage.getItem("__nostrlogin_nip46");if(!e)return null;const n=JSON.parse(e);return n?.pubkey?{pubkey:n.pubkey,npub:n.npub}:null}catch{return null}}}class Dwe{constructor(e,n,r,i,s,o,a){this.keyManager=e,this.publicKeyState=n,this.nostrLoginManager=r,this.externalAuthWaiter=i,this.storageManager=s,this.setNsecAuth=o,this.console=a}async initialize(e){try{const n=await this.checkNsecAuth();if(n.hasAuth)return n;await this.externalAuthWaiter.waitForExternalAuth(100);const r=await this.checkNostrLoginAuth(e);if(r.hasAuth)return r}catch(n){this.console.error("nostr-loginåæåå¤±æ:",n)}return{hasAuth:!1}}async checkNsecAuth(){const e=this.keyManager.loadFromStorage();if(!e)return{hasAuth:!1};this.publicKeyState.setNsec(e);try{const n=this.keyManager.derivePublicKey(e);return n.hex?(this.setNsecAuth(n.hex,n.npub,n.nprofile),{hasAuth:!0,pubkeyHex:n.hex,isNostrLogin:!1}):(this.keyManager.saveToStorage(""),{hasAuth:!1})}catch{return this.keyManager.saveToStorage(""),{hasAuth:!1}}}async checkNostrLoginAuth(e){await this.nostrLoginManager.init(e),await new Promise(i=>setTimeout(i,100));const n=this.nostrLoginManager.getCurrentUser();if(n?.pubkey)return this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:n.pubkey,npub:n.npub}),{hasAuth:!0,pubkeyHex:n.pubkey,isNostrLogin:!0};const r=this.storageManager.getStoredNostrLoginData();return r?.pubkey?(this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:r.pubkey,npub:r.npub}),{hasAuth:!0,pubkeyHex:r.pubkey,isNostrLogin:!0}):{hasAuth:!1}}}class Lwe{publicKeyState;nsecAuthenticator;nostrLoginAuthenticator;profileCacheCleaner;authInitializer;nostrLoginMgr;keyManager;nostrLoginOptions={theme:"default",noBanner:!0,methods:"connect, extension, local"};constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.keyManager||new kL({secretKeyStore:e.secretKeyStore||Pre,setNostrLoginAuthFn:e.setNostrLoginAuth||SI,clearAuthStateFn:e.clearAuthState||xI,localStorage:n}),i=e.window||(typeof window<"u"?window:{}),s=e.navigator||(typeof window<"u"?window.navigator:{}),o=e.console||(typeof window<"u"?window.console:{}),a=e.setNsecAuth||xre;this.nostrLoginMgr=e.nostrLoginManager||aO,this.publicKeyState=new EL({setNostrLoginAuthFn:e.setNostrLoginAuth||SI,clearAuthStateFn:e.clearAuthState||xI,localStorage:n}),this.nsecAuthenticator=new Pwe(r,a,o),this.nostrLoginAuthenticator=new Owe(this.publicKeyState,o),this.profileCacheCleaner=new Nwe(s,o);const l=new Mwe(i),c=new Rwe(n);this.authInitializer=new Dwe(r,this.publicKeyState,this.nostrLoginMgr,l,c,a,o),this.keyManager=r}async authenticateWithNsec(e){return await this.nsecAuthenticator.authenticate(e)}async authenticateWithNostrLogin(e){return Hy.isLogoutAuth(e)?(this.logout(),{success:!0}):await this.nostrLoginAuthenticator.authenticate(e)}async showNostrLoginDialog(){const e=aO;if(!e.isInitialized)throw new Error("nostr-login is not initialized");try{await e.showLogin()}catch(n){if(!(n instanceof Error&&n.message==="Cancelled"))throw console.error("nostr-loginã§ã¨ã©ã¼:",n),n}}logout(){try{if(this.publicKeyState.currentIsNostrLogin&&this.nostrLoginMgr.isInitialized)try{this.nostrLoginMgr.logout()}catch(e){console.error("nostr-loginã­ã°ã¢ã¦ãä¸­ã«ã¨ã©ã¼:",e)}try{const e=localStorage.getItem("firstVisit");localStorage.clear(),e&&localStorage.setItem("firstVisit",e)}catch(e){console.error("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}this.profileCacheCleaner.clearProfileImageCache().catch(e=>{console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}),setTimeout(()=>{try{typeof window<"u"&&window.location&&typeof window.location.replace=="function"?window.location.replace(window.location.pathname):typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(e){console.error("ãã¼ã¸ãªã­ã¼ãä¸­ã«ã¨ã©ã¼:",e)}},500)}catch(e){console.error("ã­ã°ã¢ã¦ãå¦çä¸­ã«äºæããªãã¨ã©ã¼:",e),setTimeout(()=>{try{typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(n){console.error("ãã¼ã¸ãªã­ã¼ãä¸­ã«ã¨ã©ã¼:",n)}},2e3)}}async initializeAuth(){return await this.authInitializer.initialize(this.nostrLoginOptions)}getPublicKeyState(){return this.publicKeyState}setNostrLoginHandler(e){this.nostrLoginMgr.setAuthHandler(e)}markAuthInitialized(){Sre()}getNsecAuthenticator(){return this.nsecAuthenticator}getNostrLoginAuthenticator(){return this.nostrLoginAuthenticator}getProfileCacheCleaner(){return this.profileCacheCleaner}getAuthInitializer(){return this.authInitializer}}const Nl=new Lwe;var Bwe=_e('<div><div class="balloon-message svelte-ut8h7c"> </div></div>');function Fwe(t,e){let n=le(e,"type",3,"success"),r=le(e,"message",3,"");var i=Bwe(),s=re(i),o=re(s);je(()=>{eo(i,1,`balloon-message-wrapper ${n()??""}`,"svelte-ut8h7c"),Re(o,r())}),X(t,i)}class $F{constructor(e){this.$_=e}showTimeout=null;lastMessageTime=0;debounceDelay=500;getRandomInfoMessage(){const e=lre,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getRandomSuccessMessage(){const e=cre,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getErrorMessage(){return this.$_(ure)??""}createMessage(e,n,r=!1){const i=Date.now();if(!r&&i-this.lastMessageTime<this.debounceDelay)return{type:e,message:""};this.lastMessageTime=i;let s=n;if(!s)switch(e){case"info":s=this.getRandomInfoMessage();break;case"success":s=this.getRandomSuccessMessage();break;case"error":s=this.getErrorMessage();break;default:s=""}return{type:e,message:s}}scheduleHide(e,n=3e3){this.showTimeout&&clearTimeout(this.showTimeout),this.showTimeout=setTimeout(e,n)}cancelScheduledHide(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}createMessageImmediate(e,n){return this.createMessage(e,n,!0)}dispose(){this.cancelScheduledHide(),this.lastMessageTime=0}}var $we=_e('<div class="trash-icon svg-icon svelte-14s1rzx"></div>'),zwe=_e("<!> <!>",1),Uwe=_e('<div class="list-icon svg-icon svelte-14s1rzx"></div>'),Hwe=_e("<!> <!>",1),Vwe=_e('<div class="floppy-disk-icon svg-icon svelte-14s1rzx"></div>'),Wwe=_e("<!> <!>",1),jwe=_e('<div class="copy-success-message"> </div>'),qwe=_e('<div class="header-container svelte-14s1rzx"><div class="header-left svelte-14s1rzx"><a href="https://lokuyow.github.io/ehagaki/" class="site-icon-link svelte-14s1rzx" aria-label="ehagaki"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-14s1rzx"/></a> <!></div> <div class="post-actions svelte-14s1rzx"><div class="buttons-container svelte-14s1rzx"><!> <!> <!></div></div></div>  <label id="vibrateSwitch" style="display: none;" aria-hidden="true"><input type="checkbox" checked/></label> <!>',1);function Kwe(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=le(e,"balloonMessage",3,null),o=ge(!1),a=ge(0),l=ge(0);function c(V){if(e.onSaveDraft()){const ie=V.currentTarget.getBoundingClientRect();K(a,ie.left+ie.width/2),K(l,ie.bottom+8),K(o,!0),setTimeout(()=>{K(o,!1)},2e3)}}let u=null;Ge(()=>{n()&&!u&&(u=new $F(n()))});let d=ae(()=>Cn.postStatus),f=ae(()=>Cn.isUploading),h=ae(()=>Cn.canPost),p=ge(null),m=ge(!1);function g(){u&&!k(m)&&(K(p,u.createMessage("success"),!0),K(m,!0),u.scheduleHide(()=>{K(p,null),K(m,!1),ma({...Cn.postStatus,success:!1,message:"",completed:!1})},3e3))}Ge(()=>{k(d).success&&k(d).completed&&!k(p)&&!k(m)&&g()}),Ge(()=>{(!k(d).success||!k(d).completed)&&(k(p)||k(m))&&(K(p,null),K(m,!1),u&&u.cancelScheduledHide())});let y=ae(()=>k(d).error&&u!==null?u.createMessage("error"):null),b=ge(null);const E=typeof window<"u"&&(window.location.port==="4173"||window.location.hostname==="localhost");let C=ge(null);Ge(()=>{if(typeof window<"u"&&u){const V=new URLSearchParams(window.location.search),Q=V.get("error");if(Q&&V.get("shared")==="true"){if(["processing-error","no-image","upload-failed","network-error","client-error"].includes(Q)){setTimeout(()=>{const ne=new URL(window.location.href);ne.searchParams.delete("error"),ne.searchParams.delete("shared"),window.history.replaceState({},"",ne.toString())},1e3);return}let ie="";switch(Q){case"messaging-error":ie="Service Workerã¨ã®éä¿¡ã§ã¨ã©ã¼ãçºçãã¾ããããã¼ã¸ãæ´æ°ãã¦ããä¸åº¦ãè©¦ããã ããã";break;case"window-error":ie="æ°ããã¦ã£ã³ãã¦ã®ä½æã«å¤±æãã¾ãã";break;default:setTimeout(()=>{const ne=new URL(window.location.href);ne.searchParams.delete("error"),ne.searchParams.delete("shared"),window.history.replaceState({},"",ne.toString())},1e3);return}K(C,{type:"error",message:ie},!0),setTimeout(()=>{const ne=new URL(window.location.href);ne.searchParams.delete("error"),ne.searchParams.delete("shared"),window.history.replaceState({},"",ne.toString()),setTimeout(()=>{K(C,null)},5e3)},1e3)}}}),E&&(window.showInfoBalloonDebug=V=>{K(b,{type:"info",message:V},!0)},window.hideInfoBalloonDebug=()=>{K(b,null)});let I=ae(()=>k(C)||(E?k(b)||s()||k(y)||k(p):s()||k(y)||k(p)));Ge(()=>()=>{u&&u.dispose()});let x=ge(void 0);Ge(()=>{k(x)&&k(x).setAttribute("switch","")});var P=qwe(),T=Te(P),S=re(T),_=ve(re(S),2);{var O=V=>{Fwe(V,{get type(){return k(I).type},get message(){return k(I).message}})};$e(_,V=>{k(I)&&V(O)})}var F=ve(S,2),L=re(F),B=re(L);Dt(B,()=>Bd,(V,Q)=>{Q(V,{delayDuration:500,children:(Y,ie)=>{var ne=zwe(),J=Te(ne);{const ze=(he,Ee)=>{let Le=()=>Ee?.().props;const pe=ae(()=>{const{onclick:xe,...Me}=Le();return{tooltipOnclick:xe,restProps:Me}});{let xe=ae(()=>!k(h)||k(d).sending||k(f)),Me=ae(()=>n()("postComponent.clear_editor"));Yt(he,Kn({variant:"header",shape:"square",className:"clear-button",get disabled(){return k(xe)},onClick:Ue=>{e.onResetPostContent(),typeof k(pe).tooltipOnclick=="function"&&k(pe).tooltipOnclick(Ue)},get ariaLabel(){return k(Me)}},()=>k(pe).restProps,{children:(Ue,qe)=>{var tt=$we();X(Ue,tt)},$$slots:{default:!0}}))}};Dt(J,()=>$d,(he,Ee)=>{Ee(he,{child:ze,$$slots:{child:!0}})})}var ke=ve(J,2);Dt(ke,()=>oc,(ze,he)=>{he(ze,{children:(Ee,Le)=>{var pe=Fe(),xe=Te(pe);Dt(xe,()=>Fd,(Me,Ue)=>{Ue(Me,{sideOffset:8,class:"tooltip-content",children:(qe,tt)=>{var Ae=on();je(We=>Re(Ae,We),[()=>n()("postComponent.clear_editor")]),X(qe,Ae)},$$slots:{default:!0}})}),X(Ee,pe)},$$slots:{default:!0}})}),X(Y,ne)},$$slots:{default:!0}})});var N=ve(B,2);Dt(N,()=>Bd,(V,Q)=>{Q(V,{delayDuration:500,children:(Y,ie)=>{var ne=Hwe(),J=Te(ne);{const ze=(he,Ee)=>{let Le=()=>Ee?.().props;const pe=ae(()=>{const{onclick:xe,...Me}=Le();return{tooltipOnclick:xe,restProps:Me}});{let xe=ae(()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§");Yt(he,Kn({variant:"header",shape:"square",className:"draft-list-button",onClick:Me=>{e.onShowDraftList(),typeof k(pe).tooltipOnclick=="function"&&k(pe).tooltipOnclick(Me)},get ariaLabel(){return k(xe)}},()=>k(pe).restProps,{children:(Me,Ue)=>{var qe=Uwe();X(Me,qe)},$$slots:{default:!0}}))}};Dt(J,()=>$d,(he,Ee)=>{Ee(he,{child:ze,$$slots:{child:!0}})})}var ke=ve(J,2);Dt(ke,()=>oc,(ze,he)=>{he(ze,{children:(Ee,Le)=>{var pe=Fe(),xe=Te(pe);Dt(xe,()=>Fd,(Me,Ue)=>{Ue(Me,{sideOffset:8,class:"tooltip-content",children:(qe,tt)=>{var Ae=on();je(We=>Re(Ae,We),[()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§"]),X(qe,Ae)},$$slots:{default:!0}})}),X(Ee,pe)},$$slots:{default:!0}})}),X(Y,ne)},$$slots:{default:!0}})});var M=ve(N,2);Dt(M,()=>Bd,(V,Q)=>{Q(V,{delayDuration:500,children:(Y,ie)=>{var ne=Wwe(),J=Te(ne);{const ze=(he,Ee)=>{let Le=()=>Ee?.().props;const pe=ae(()=>{const{onclick:xe,...Me}=Le();return{tooltipOnclick:xe,restProps:Me}});{let xe=ae(()=>!k(h)||k(d).sending||k(f)),Me=ae(()=>n()("draft.save")||"ä¸æ¸ãä¿å­");Yt(he,Kn({variant:"header",shape:"square",className:"draft-save-button",get disabled(){return k(xe)},onClick:Ue=>{c(Ue),typeof k(pe).tooltipOnclick=="function"&&k(pe).tooltipOnclick(Ue)},get ariaLabel(){return k(Me)}},()=>k(pe).restProps,{children:(Ue,qe)=>{var tt=Vwe();X(Ue,tt)},$$slots:{default:!0}}))}};Dt(J,()=>$d,(he,Ee)=>{Ee(he,{child:ze,$$slots:{child:!0}})})}var ke=ve(J,2);Dt(ke,()=>oc,(ze,he)=>{he(ze,{children:(Ee,Le)=>{var pe=Fe(),xe=Te(pe);Dt(xe,()=>Fd,(Me,Ue)=>{Ue(Me,{sideOffset:8,class:"tooltip-content",children:(qe,tt)=>{var Ae=on();je(We=>Re(Ae,We),[()=>n()("draft.save")||"ä¸æ¸ãä¿å­"]),X(qe,Ae)},$$slots:{default:!0}})}),X(Ee,pe)},$$slots:{default:!0}})}),X(Y,ne)},$$slots:{default:!0}})});var R=ve(T,2),H=re(R);pr(H,V=>K(x,V),()=>k(x));var z=ve(R,2);kT(z,{get show(){return k(o)},get x(){return k(a)},get y(){return k(l)},onClose:()=>K(o,!1),children:(V,Q)=>{var Y=jwe(),ie=re(Y);je(ne=>Re(ie,ne),[()=>n()("draft.saved")]),X(V,Y)},$$slots:{default:!0}}),X(t,P),Et(),i()}async function lO(t,e,n){try{t?.preventDefault()}catch{}try{const r=[...e()].reverse();await Ape(r),(r?.length??0)>0&&(K(n,!0),setTimeout(()=>K(n,!1),1500))}catch(r){console.warn("dev log copy failed:",r)}}var Gwe=_e('<li class="svelte-1czx13o"> </li>'),Zwe=_e('<button type="button" class="floating-dev-console-log svelte-1czx13o" title="ã¿ããã§å¨ã³ãã¼" aria-label="éçºèã­ã°ãã³ãã¼"><ul class="svelte-1czx13o"></ul></button>'),Qwe=_e('<div class="shared-image-error svelte-1czx13o"><div class="error-text svelte-1czx13o"> </div></div>'),Xwe=_e('<div class="stop-icon svg-icon"></div>'),Ywe=_e('<div class="compression-container svelte-1czx13o"><!> <div class="upload-progress svelte-1czx13o"><div class="progress-text svelte-1czx13o"> </div> <div class="progress-bar svelte-1czx13o"><div class="progress-fill svelte-1czx13o"></div></div></div></div>'),Jwe=_e('<div class="stop-icon svg-icon"></div>'),eve=_e('<div class="compression-container svelte-1czx13o"><!> <div class="upload-progress svelte-1czx13o"><div class="progress-text svelte-1czx13o"> </div> <div class="progress-bar svelte-1czx13o"><div class="progress-fill svelte-1czx13o"></div></div></div></div>'),tve=_e('<div class="stop-icon svg-icon"></div>'),nve=_e('<div class="compression-container svelte-1czx13o"><!> <div class="upload-progress svelte-1czx13o"><div class="progress-text svelte-1czx13o"> <!> <!></div> <div class="progress-bar svelte-1czx13o"><div class="progress-fill svelte-1czx13o"></div></div></div></div>'),rve=_e('<div class="upload-progress svelte-1czx13o"><div class="progress-text svelte-1czx13o"> <!> <!></div> <div class="progress-bar svelte-1czx13o"><div class="progress-fill svelte-1czx13o"></div></div></div>'),ive=_e(" <br/> <!>",1),sve=_e('<div class="image-size-info svelte-1czx13o"><div class="size-label svelte-1czx13o"> </div> <div class="size-details svelte-1czx13o"><!></div></div>'),ove=_e('<!> <div class="footer-center svelte-1czx13o"><!></div>',1);function ave(t,e){St(e,!0);const n=()=>qn(ET,"$devLog",i),r=()=>qn(nr,"$_",i),[i,s]=oi();let o=ge(!1),a=ge(null);Ge(()=>{if(typeof window<"u"){const z=new URLSearchParams(window.location.search),V=z.get("error");if(V&&z.get("shared")==="true"){const Q=()=>{const Y=localStorage.getItem("sharedImageProcessed")==="1",J=!new URLSearchParams(window.location.search).get("error");return Y||J};if(Q()){console.log("Shared image was processed successfully, ignoring error parameter");return}setTimeout(()=>{if(Q()){console.log("Shared image processing detected after delay, not showing error");return}let Y="";switch(V){case"processing-error":Y="å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼ãçºçãã¾ãã";break;case"no-image":Y="å±æç»åãè¦ã¤ããã¾ããã§ãã";break;case"upload-failed":Y="ç»åã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã";break;case"network-error":Y="ãããã¯ã¼ã¯ã¨ã©ã¼ãçºçãã¾ãã";break;case"client-error":Y="ç»åå±æå¦çã§ã¨ã©ã¼ãçºçãã¾ãã";break;default:return}K(a,Y,!0),setTimeout(()=>{const ie=new URL(window.location.href);ie.searchParams.delete("error"),ie.searchParams.delete("shared"),window.history.replaceState({},"",ie.toString()),setTimeout(()=>{K(a,null)},5e3)},1e3)},100)}}});let l=le(e,"uploadProgress",31,()=>Nt({total:0,completed:0,failed:0,aborted:0,inProgress:!1})),c=ae(()=>Gh.value),u=ae(()=>Zh.value),d=ge(null),f=ge(0),h=null;Ge(()=>{k(c)>0&&k(c)<100?k(d)||(K(d,Date.now(),!0),S({imageSizeInfoOnly:!0}),h=window.setInterval(()=>{k(d)&&K(f,Math.floor((Date.now()-k(d))/1e3),!0)},1e3)):(h!==null&&(clearInterval(h),h=null),K(d,null),K(f,0))}),Ge(()=>{k(u)>0&&k(u)<100?k(d)||(K(d,Date.now(),!0),S({imageSizeInfoOnly:!0}),h=window.setInterval(()=>{k(d)&&K(f,Math.floor((Date.now()-k(d))/1e3),!0)},1e3)):(h!==null&&(clearInterval(h),h=null),K(d,null),K(f,0))});let p=ae(()=>_d.value.info),m=ae(()=>_d.value.visible),g=ge(!1);Ge(()=>{l().inProgress&&!k(g)&&S({imageSizeInfoOnly:!0}),K(g,l().inProgress,!0)});function y(z){if(z<60)return`${z}s`;const V=Math.floor(z/60),Q=z%60;return`${V}m ${Q}s`}function b(){Gh.set(0),Zh.set(0),h!==null&&(clearInterval(h),h=null),K(d,null),K(f,0),l({total:0,completed:0,failed:0,aborted:0,inProgress:!1});const V=vT.value;V&&PL(V,!1),vre()}function E(){b()}function C(){b()}function I(z){if(!z)return"";const V=z.match(/\.([a-zA-Z0-9]+)$/);if(!V)return"";const Q=V[1].toUpperCase();return Q==="JPEG"?"JPG":Q}function x(){return typeof window>"u"?"medium":localStorage.getItem("videoCompressionLevel")||"medium"}function P(z){switch(z){case"none":return r()("settingsDialog.quality_lossless");case"low":return r()("footerInfoDisplay.videoQualityLevel.high");case"medium":return r()("footerInfoDisplay.videoQualityLevel.medium");case"high":return r()("footerInfoDisplay.videoQualityLevel.low");default:return r()("footerInfoDisplay.videoQualityLevel.medium")}}function T(z){l(z),!z.inProgress&&z.total>0&&setTimeout(()=>{l({total:0,completed:0,failed:0,aborted:0,inProgress:!1})},1e3)}function S(z){if(z?.imageSizeInfoOnly){_d.set({info:null,visible:!1});return}l({total:0,completed:0,failed:0,aborted:0,inProgress:!1}),Gh.set(0),Zh.set(0),h!==null&&(clearInterval(h),h=null),K(d,null),K(f,0),_d.set({info:null,visible:!1}),K(a,null)}let _=ae(()=>k(a)!==null||k(u)>0&&k(u)<100||k(c)>0&&k(c)<100||l().inProgress||l().total>0||k(m)&&k(p)!==null);var O={updateProgress:T,reset:S},F=ove(),L=Te(F);{var B=z=>{var V=Zwe();V.__click=[lO,n,o],V.__touchend=[lO,n,o];var Q=re(V);va(Q,5,()=>[...n()].reverse(),Gc,(Y,ie)=>{var ne=Gwe(),J=re(ne);je(()=>Re(J,k(ie))),X(Y,ne)}),X(z,V)};$e(L,z=>{b6()&&n().length&&z(B)})}var N=ve(L,2),M=re(N);{var R=z=>{var V=Fe(),Q=Te(V);{var Y=ne=>{var J=Qwe(),ke=re(J),ze=re(ke);je(()=>Re(ze,k(a))),X(ne,J)},ie=ne=>{var J=Fe(),ke=Te(J);{var ze=Ee=>{var Le=Ywe(),pe=re(Le);Yt(pe,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"å§ç¸®ä¸­æ­¢",onClick:C,children:(Ae,We)=>{var lt=Xwe();X(Ae,lt)},$$slots:{default:!0}});var xe=ve(pe,2),Me=re(xe),Ue=re(Me),qe=ve(Me,2),tt=re(qe);je((Ae,We)=>{Re(Ue,`${Ae??""}: ${k(u)??""}%
                        (${We??""})`),Oa(tt,`width: ${k(u)??""}%`)},[()=>r()("imageCompression.compressing"),()=>y(k(f))]),X(Ee,Le)},he=Ee=>{var Le=Fe(),pe=Te(Le);{var xe=Ue=>{var qe=eve(),tt=re(qe);Yt(tt,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"å§ç¸®ä¸­æ­¢",onClick:E,children:(Lt,Rt)=>{var pt=Jwe();X(Lt,pt)},$$slots:{default:!0}});var Ae=ve(tt,2),We=re(Ae),lt=re(We),ht=ve(We,2),wt=re(ht);je((Lt,Rt,pt)=>{Re(lt,`${Lt??""}${Rt??""}: ${k(c)??""}%
                        (${pt??""})`),Oa(wt,`width: ${k(c)??""}%`)},[()=>P(x()),()=>r()("videoQualityLabelSuffix"),()=>y(k(f))]),X(Ue,qe)},Me=Ue=>{var qe=Fe(),tt=Te(qe);{var Ae=lt=>{var ht=Fe(),wt=Te(ht);{var Lt=pt=>{var He=nve(),st=re(He);Yt(st,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"ã¢ããã­ã¼ãä¸­æ­¢",onClick:C,children:(Bt,tn)=>{var hn=tve();X(Bt,hn)},$$slots:{default:!0}});var Ot=ve(st,2),Mt=re(Ot),dn=re(Mt),Vt=ve(dn);{var Qt=Bt=>{var tn=on();je(hn=>Re(tn,`(${hn??""}: ${l().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),X(Bt,tn)};$e(Vt,Bt=>{l().failed>0&&Bt(Qt)})}var Jt=ve(Vt,2);{var Sn=Bt=>{var tn=on();je(hn=>Re(tn,`(${hn??""}: ${l().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),X(Bt,tn)};$e(Jt,Bt=>{l().aborted>0&&Bt(Sn)})}var en=ve(Mt,2),cn=re(en);je((Bt,tn)=>{Re(dn,`${Bt??""}: ${l().completed??""}/${l().total??""} `),Oa(cn,`width: ${tn??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>l().total>0?Math.round(l().completed/l().total*100):0]),X(pt,He)},Rt=pt=>{var He=rve(),st=re(He),Ot=re(st),Mt=ve(Ot);{var dn=en=>{var cn=on();je(Bt=>Re(cn,`(${Bt??""}: ${l().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),X(en,cn)};$e(Mt,en=>{l().failed>0&&en(dn)})}var Vt=ve(Mt,2);{var Qt=en=>{var cn=on();je(Bt=>Re(cn,`(${Bt??""}: ${l().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),X(en,cn)};$e(Vt,en=>{l().aborted>0&&en(Qt)})}var Jt=ve(st,2),Sn=re(Jt);je((en,cn)=>{Re(Ot,`${en??""}: ${l().completed??""}/${l().total??""} `),Oa(Sn,`width: ${cn??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>l().total>0?Math.round(l().completed/l().total*100):0]),X(pt,He)};$e(wt,pt=>{l().inProgress?pt(Lt):pt(Rt,!1)})}X(lt,ht)},We=lt=>{var ht=Fe(),wt=Te(ht);{var Lt=Rt=>{var pt=sve(),He=re(pt),st=re(He),Ot=ve(He,2),Mt=re(Ot);{var dn=Vt=>{var Qt=ive(),Jt=Te(Qt),Sn=ve(Jt,2),en=ve(Sn);{var cn=tn=>{var hn=on();je(Gi=>Re(hn,Gi),[()=>r()("footerInfoDisplay.no_compression")||"å§ç¸®ãªã"]),X(tn,hn)},Bt=tn=>{var hn=Fe(),Gi=Te(hn);{var Zi=_t=>{var Fn=on();je(()=>Re(Fn,`${k(p).compressedSize??""}
                            (${k(p).compressionRatio??""}%)`)),X(_t,Fn)},ds=_t=>{var Fn=on();je(()=>Re(Fn,`${k(p).compressedSize??""}
                            (${k(p).compressionRatio??""}%)`)),X(_t,Fn)};$e(Gi,_t=>{k(p).wasCompressed?_t(Zi):_t(ds,!1)},!0)}X(tn,hn)};$e(en,tn=>{k(p).wasSkipped?tn(cn):tn(Bt,!1)})}je((tn,hn)=>{Re(Jt,`${tn??""}
                        ${k(p).originalSize??""}`),Re(Sn,` â ${hn??""} `)},[()=>I(k(p).originalFilename),()=>I(k(p).compressedFilename)]),X(Vt,Qt)};$e(Mt,Vt=>{k(p).originalFilename&&k(p).compressedFilename&&Vt(dn)})}je(Vt=>Re(st,`${Vt??""}:`),[()=>r()("footerInfoDisplay.data_size")]),X(Rt,pt)};$e(wt,Rt=>{k(m)&&k(p)&&Rt(Lt)},!0)}X(lt,ht)};$e(tt,lt=>{l().inProgress||l().total>0?lt(Ae):lt(We,!1)},!0)}X(Ue,qe)};$e(pe,Ue=>{k(c)>0&&k(c)<100?Ue(xe):Ue(Me,!1)},!0)}X(Ee,Le)};$e(ke,Ee=>{k(u)>0&&k(u)<100?Ee(ze):Ee(he,!1)},!0)}X(ne,J)};$e(Q,ne=>{k(a)?ne(Y):ne(ie,!1)})}X(z,V)};$e(M,z=>{k(_)&&z(R)})}X(t,F);var H=Et(O);return s(),H}Ti(["click","touchend"]);var lve=_e("<img/>"),cve=_e('<div class="profile-picture default svg-icon svelte-r12bo1" aria-label="User"></div>'),uve=_e('<div class="update-indicator svelte-r12bo1"></div>'),dve=_e('<div class="settings-icon svg-icon svelte-r12bo1" aria-label="Settings"></div> <!>',1),fve=_e('<div class="footer-bar svelte-r12bo1"><!> <!> <!></div>');function hve(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=ae(()=>Vl.value),o=ae(()=>Hs.value),a=ae(()=>gd.value),l=ge(void 0),c=ge(!1);const u=()=>k(s)?.name?k(s).name:k(s)?.npub?k(s).npub:"User";function d(T){console.log("ãã­ãã£ã¼ã«ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãã:",T),K(c,!0),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&console.log("Service Workerã«ããã­ã£ãã·ã¥å¦çã®å¯è½æ§ãããã¾ã")}function f(T){if(!T)return!1;try{return new URL(T,location.href).origin===location.origin}catch{return!1}}let h=ge(!1);Ge(()=>{k(s)?.picture?(K(c,!1),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&k(s).picture.includes("profile=true")&&console.log("Service Workerã§ãã­ãã£ã¼ã«ç»åãã­ã£ãã·ã¥å¦çäºå®:",k(s).picture),K(h,f(k(s).picture),!0)):K(h,!1)});function p(T){k(l)?.updateProgress(T)}function m(){k(l)?.reset()}var g={isSameOriginPictureUrl:f,updateProgress:p,reset:m},y=fve(),b=re(y);{var E=T=>{Yt(T,{shape:"circle",className:"profile-display loading",disabled:!0,children:(S,_)=>{pc(S,{showLoader:!0})},$$slots:{default:!0}})},C=T=>{var S=Fe(),_=Te(S);{var O=L=>{Yt(L,{shape:"circle",className:"profile-display loading",disabled:!0,children:(B,N)=>{pc(B,{showLoader:!0})},$$slots:{default:!0}})},F=L=>{var B=Fe(),N=Te(B);{var M=H=>{{let z=ae(()=>`profile-display${k(o)?" loading":""}`);Yt(H,{variant:"default",shape:"circle",get className(){return k(z)},get disabled(){return k(o)},onClick:()=>{k(o)||e.onOpenLogoutDialog()},children:(V,Q)=>{var Y=Fe(),ie=Te(Y);{var ne=ke=>{pc(ke,{showLoader:!0})},J=ke=>{var ze=Fe(),he=Te(ze);{var Ee=pe=>{var xe=lve();wr(xe,Me=>({src:k(s).picture,alt:Me,class:"profile-picture",loading:"lazy",...k(h)?{crossorigin:"anonymous",referrerpolicy:"no-referrer"}:{},onerror:d}),[u],void 0,"svelte-r12bo1"),X(pe,xe)},Le=pe=>{var xe=cve();X(pe,xe)};$e(he,pe=>{k(s)?.picture&&!k(c)?pe(Ee):pe(Le,!1)},!0)}X(ke,ze)};$e(ie,ke=>{k(o)?ke(ne):ke(J,!1)})}X(V,Y)},$$slots:{default:!0}})}},R=H=>{var z=Fe(),V=Te(z);{var Q=Y=>{Yt(Y,{className:"login-btn",variant:"primary",shape:"pill",get onClick(){return e.onShowLoginDialog},children:(ie,ne)=>{var J=on();je(ke=>Re(J,ke),[()=>n()("app.login")]),X(ie,J)},$$slots:{default:!0}})};$e(V,Y=>{!k(o)&&!e.isAuthenticated&&Y(Q)},!0)}X(H,z)};$e(N,H=>{e.isAuthenticated&&(k(a)||k(o))?H(M):H(R,!1)},!0)}X(L,B)};$e(_,L=>{e.isAuthenticated&&k(o)?L(O):L(F,!1)},!0)}X(T,S)};$e(b,T=>{e.isAuthInitialized?T(C,!1):T(E)})}var I=ve(b,2);pr(ave(I,{}),T=>K(l,T,!0),()=>k(l));var x=ve(I,2);{let T=ae(()=>e.swNeedRefresh?"has-update":"");Yt(x,{variant:"default",shape:"circle",get className(){return`settings-btn ${k(T)??""}`},get onClick(){return e.onOpenSettingsDialog},ariaLabel:"è¨­å®",children:(S,_)=>{var O=dve(),F=ve(Te(O),2);{var L=B=>{var N=uve();X(B,N)};$e(F,B=>{e.swNeedRefresh&&B(L)})}X(S,O)},$$slots:{default:!0}})}X(t,y);var P=Et(g);return i(),P}const zF=66,pve=50,mve=50,gve=100;let cO=ge(!1);const yve={get value(){return k(cO)},set:t=>{K(cO,t,!0),typeof document<"u"&&document.documentElement.style.setProperty("--reason-input-height",t?`${mve}px`:"0px")}};let UF=ge(zF),uO=ge(0);const HF={get value(){return k(UF)}};function bve(){if(typeof window>"u"||!window.visualViewport)return;let t=null;function e(){t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{const n=window.visualViewport;if(!n)return;const r=n.height+(n.offsetTop||0),i=Math.max(0,window.innerHeight-r),s=i>gve;K(UF,s?i:zF,!0),K(uO,s?i:0,!0);const o=document.documentElement;o.style.setProperty("--keyboard-height",`${k(uO)}px`),o.style.setProperty("--visible-viewport-height",`${n.height}px`)})}return e(),window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e),()=>{window.visualViewport?.removeEventListener("resize",e),window.visualViewport?.removeEventListener("scroll",e),t&&cancelAnimationFrame(t),t=null}}function dO(t){t.preventDefault()}var wve=_e('<div class="image-icon svg-icon svelte-1yo5b35"></div>'),vve=_e("<!> <!>",1),xve=_e('<div class="plane-icon svg-icon svelte-1yo5b35"></div>'),Sve=_e("<!> <!>",1),Eve=_e('<div class="content-warning-icon svg-icon svelte-1yo5b35"></div>'),kve=_e("<!> <!>",1),Tve=_e('<div class="footer-button-bar svelte-1yo5b35"><div class="button-container svelte-1yo5b35"><!> <!> <!></div></div>');function _ve(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=ge(!1);Ge(()=>Dr.subscribe(E=>{K(s,E&&E.isAuthenticated,!0)}));let o=ae(()=>Cn.postStatus),a=ae(()=>Cn.isUploading),l=ae(()=>Cn.canPost),c=ge(!1);Ge(()=>{k(o).sending?K(c,!0):k(c)&&setTimeout(()=>{K(c,!1)},400)});let u=ae(()=>xu.value);function d(){xu.toggle(),xu.value||Qd.reset()}let f=ae(()=>HF.value);Ge(()=>bve());var h=Tve(),p=re(h);p.__mousedown=[dO],p.__touchstart=[dO];var m=re(p);Dt(m,()=>Bd,(b,E)=>{E(b,{delayDuration:500,children:(C,I)=>{var x=vve(),P=Te(x);{const S=(_,O)=>{let F=()=>O?.().props;const L=ae(()=>{const{onclick:B,...N}=F();return{tooltipOnclick:B,restProps:N}});{let B=ae(()=>!k(s)||k(o).sending||k(a)),N=ae(()=>n()("postComponent.upload_image"));Yt(_,Kn({variant:"footer",shape:"square",className:"image-button",get disabled(){return k(B)},onClick:M=>{e.onUploadImage?.(),typeof k(L).tooltipOnclick=="function"&&k(L).tooltipOnclick(M)},get ariaLabel(){return k(N)}},()=>k(L).restProps,{children:(M,R)=>{var H=wve();X(M,H)},$$slots:{default:!0}}))}};Dt(P,()=>$d,(_,O)=>{O(_,{child:S,$$slots:{child:!0}})})}var T=ve(P,2);Dt(T,()=>oc,(S,_)=>{_(S,{children:(O,F)=>{var L=Fe(),B=Te(L);Dt(B,()=>Fd,(N,M)=>{M(N,{sideOffset:8,class:"tooltip-content",children:(R,H)=>{var z=on();je(V=>Re(z,V),[()=>n()("keyboardButtonBar.upload_image_tooltip")]),X(R,z)},$$slots:{default:!0}})}),X(O,L)},$$slots:{default:!0}})}),X(C,x)},$$slots:{default:!0}})});var g=ve(m,2);Dt(g,()=>Bd,(b,E)=>{E(b,{delayDuration:500,children:(C,I)=>{var x=Sve(),P=Te(x);{const S=(_,O)=>{let F=()=>O?.().props;const L=ae(()=>{const{onclick:B,...N}=F();return{tooltipOnclick:B,restProps:N}});{let B=ae(()=>k(c)?"loading":""),N=ae(()=>!k(l)||k(o).sending||k(a)||!k(s)||k(o).completed),M=ae(()=>n()("postComponent.post"));Yt(_,Kn({variant:"primary",shape:"square",get className(){return`post-button ${k(B)??""}`},get disabled(){return k(N)},onClick:R=>{qre(30),Hhe(),typeof k(L).tooltipOnclick=="function"&&k(L).tooltipOnclick(R)},get ariaLabel(){return k(M)}},()=>k(L).restProps,{children:(R,H)=>{var z=Fe(),V=Te(z);{var Q=ie=>{pc(ie,{showLoader:!0,text:!1,customClass:"post-button-loading"})},Y=ie=>{var ne=xve();X(ie,ne)};$e(V,ie=>{k(c)?ie(Q):ie(Y,!1)})}X(R,z)},$$slots:{default:!0}}))}};Dt(P,()=>$d,(_,O)=>{O(_,{child:S,$$slots:{child:!0}})})}var T=ve(P,2);Dt(T,()=>oc,(S,_)=>{_(S,{children:(O,F)=>{var L=Fe(),B=Te(L);Dt(B,()=>Fd,(N,M)=>{M(N,{sideOffset:8,class:"tooltip-content",children:(R,H)=>{var z=on();je(V=>Re(z,V),[()=>n()("keyboardButtonBar.post_tooltip")]),X(R,z)},$$slots:{default:!0}})}),X(O,L)},$$slots:{default:!0}})}),X(C,x)},$$slots:{default:!0}})});var y=ve(g,2);Dt(y,()=>Bd,(b,E)=>{E(b,{delayDuration:500,children:(C,I)=>{var x=kve(),P=Te(x);{const S=(_,O)=>{let F=()=>O?.().props;const L=ae(()=>{const{onclick:B,...N}=F();return{tooltipOnclick:B,restProps:N}});{let B=ae(()=>n()("keyboardButtonBar.content_warning_toggle"));Yt(_,Kn({variant:"footer",shape:"square",get selected(){return k(u)},onClick:N=>{d(),typeof k(L).tooltipOnclick=="function"&&k(L).tooltipOnclick(N)},get ariaLabel(){return k(B)}},()=>k(L).restProps,{children:(N,M)=>{var R=Eve();X(N,R)},$$slots:{default:!0}}))}};Dt(P,()=>$d,(_,O)=>{O(_,{child:S,$$slots:{child:!0}})})}var T=ve(P,2);Dt(T,()=>oc,(S,_)=>{_(S,{children:(O,F)=>{var L=Fe(),B=Te(L);Dt(B,()=>Fd,(N,M)=>{M(N,{sideOffset:8,class:"tooltip-content",children:(R,H)=>{var z=on();je(V=>Re(z,V),[()=>n()("keyboardButtonBar.content_warning_tooltip")]),X(R,z)},$$slots:{default:!0}})}),X(O,L)},$$slots:{default:!0}})}),X(C,x)},$$slots:{default:!0}})}),je(()=>Oa(h,`bottom: ${k(f)??""}px;`)),X(t,h),Et(),i()}Ti(["mousedown","touchstart"]);function fO(t){const e=t.target;Qd.set(e.value)}var Cve=_e('<div class="reason-input-container svelte-gk2c4b"><input id="content-warning-reason-input" type="text" class="reason-input svelte-gk2c4b"/></div>');function Ave(t,e){St(e,!0);const n=()=>qn(nr,"$_",r),[r,i]=oi();let s=ae(()=>xu.value),o=ae(()=>Qd.value),a=ae(()=>k(s));Ge(()=>{yve.set(k(a))});let l=ae(()=>HF.value+pve);var c=Fe(),u=Te(c);{var d=f=>{var h=Cve(),p=re(h);p.__change=[fO],p.__input=[fO],je((m,g)=>{Oa(h,`bottom: ${k(l)??""}px;`),yn(p,"placeholder",m),l4(p,k(o)),yn(p,"aria-label",g)},[()=>n()("postComponent.content_warning_reason_placeholder"),()=>n()("postComponent.content_warning_reason_label")]),X(f,h)};$e(u,f=>{k(a)&&f(d)})}X(t,c),Et(),i()}Ti(["change","input"]);class Ive{fileUploadManager;isProcessingSharedImage=!1;constructor(e){this.fileUploadManager=new w6(e),this.setupServiceWorkerListeners()}setupServiceWorkerListeners(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}handleServiceWorkerMessage(e){const{data:n,type:r}=e.data||{};r==="SHARED_IMAGE"&&n?.image&&EI(n.image,n.metadata)}checkIfOpenedFromShareInternal(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).get("shared")==="true"}async checkForSharedImageOnLaunch(){if(this.isProcessingSharedImage)return{success:!1,error:"æ¢ã«å¦çä¸­ã§ã"};if(!this.checkIfOpenedFromShareInternal())return{success:!1,error:"å±æçµç±ã§ã®èµ·åã§ã¯ããã¾ãã"};this.isProcessingSharedImage=!0;try{const e=await this.fileUploadManager.processSharedImageOnLaunch();return e.success&&e.data&&EI(e.data.image,e.data.metadata),e}finally{this.isProcessingSharedImage=!1}}async getSharedImageFromServiceWorker(){return await this.fileUploadManager.getSharedImageFromServiceWorker()}checkIfOpenedFromShare(){return this.fileUploadManager.checkIfOpenedFromShare()}isProcessing(){return this.isProcessingSharedImage}getSharedImageFile(){return _re()}getSharedImageMetadata(){return Cre()}clearSharedImage(){Ere()}}let tx=null;function Pve(){return tx||(tx=new Ive),tx}function hO(){return Pve().checkIfOpenedFromShare()}function Ove(){if(typeof window>"u"||!window.location)return null;const e=new URLSearchParams(window.location.search).get("content");if(!e)return null;try{const n=decodeURIComponent(e);return AL(n)}catch(n){return console.error("URLã¯ã¨ãªãã©ã¡ã¼ã¿ã®ãã³ã¼ãã«å¤±æ:",n),null}}function Mve(){if(typeof window>"u"||!window.location)return;const t=new URLSearchParams(window.location.search),e=[];let n=!1;if(t.has("content")){const i=t.get("content");(!i||i.trim()==="")&&(n=!0),t.delete("content"),n=!0}const r=[];if(t.forEach((i,s)=>{e.includes(s)||(r.push(s),n=!0)}),r.forEach(i=>t.delete(i)),n){const i=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",i)}}function Nve(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).has("content")}var Rve=_e('<main class="svelte-1o28cpc"><div class="main-content svelte-1o28cpc"><!> <!></div> <!> <!> <!> <!> <!> <!> <!> <!> <!></main>');function Dve(t,e){St(e,!0);const n=()=>qn(cs,"$locale",s),r=()=>qn(nr,"$_",s),i=()=>qn(Ik,"$swNeedRefresh",s),[s,o]=oi();let a=ge(""),l=ge("");const c=Nl.getPublicKeyState();Ge(()=>{c.setNsec(k(l))}),Ge(()=>{Kh.value&&(K(l,""),K(a,""))});let u=ae(()=>Dr.value?.isAuthenticated??!1),d=ae(()=>Dr.value?.isInitialized??!1),f=!1,h="";if(!f){const Ae=localStorage.getItem("nsec"),We=localStorage.getItem("__nostrlogin_nip46");if(!Ae){if(We)try{const lt=JSON.parse(We);lt?.pubkey&&(h=lt.pubkey)}catch{}}f=!0}let p=ge(void 0),m,g=ge(!1),y=ge(void 0),b=ge(void 0),E=ge(!1);async function C(Ae){K(p,yH({verifier:AV}),!0);const We=new hse(k(p)),lt=new mre(k(p),{relayListUpdatedStore:{value:w2.value,set:ht=>w2.set(ht)}});m=new pse(k(p),lt,We),Ore(lt),await m.initializeRelays(Ae)}async function I(Ae){const We=await Nl.authenticateWithNostrLogin(Ae);if(!We.success){console.error("nostr-loginèªè¨¼å¤±æ:",We.error);return}if(We.pubkeyHex){K(g,!0),Hs.set(!0),eg();try{await C();const lt=await m.initializeForLogin(We.pubkeyHex);lt&&(Vl.set(lt),gd.set(!0)),Hs.set(!1)}catch(lt){console.error("nostr-loginèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",lt),Hs.set(!1)}finally{K(g,!1)}}}async function x(){const Ae=await Nl.authenticateWithNsec(k(l));if(!Ae.success){K(a,Ae.error||"authentication_error",!0);return}Hs.set(!0),eg(),K(a,"");try{if(Ae.pubkeyHex){const We=await m.initializeForLogin(Ae.pubkeyHex);We&&(Vl.set(We),gd.set(!0)),Hs.set(!1)}else Hs.set(!1)}catch{Hs.set(!1)}}function P(){K(E,!0),Nl.logout(),Vl.set({name:"",picture:"",npub:"",nprofile:""}),gd.set(!1),k(y)?.resetPostContent&&k(y).resetPostContent(),o5(),K(l,""),K(a,"")}async function T(){K(g,!0);try{eg(),await Nl.showNostrLoginDialog()}catch(Ae){Ae instanceof Error&&Ae.message==="Cancelled"||console.error("nostr-loginã§ã¨ã©ã¼:",Ae)}finally{K(g,!1)}}Ge(()=>{n()&&localStorage.setItem("locale",n())}),Ge(()=>{const Ae=Dr.value?.pubkey;Ae&&Dr.value?.isAuthenticated&&m&&m.getRelayManager().loadRelayConfigForUI(Ae)});let S=ge(!1);const _=localStorage.getItem("sharedImageProcessed")==="1";us(()=>((async()=>{const We=localStorage.getItem("locale");if(We&&We!==n()&&cs.set(We),await dj(),K(S,!0),Nl.setNostrLoginHandler(I),hO()){const ht=await ose(),wt=await ase();(!ht.isReady||!ht.hasController||!wt)&&console.warn("Service Worker not ready for shared image processing:",ht)}if((async()=>{try{const ht=await Nl.initializeAuth();if(ht.hasAuth&&ht.pubkeyHex){await C(ht.pubkeyHex);const wt=await m.initializeForLogin(ht.pubkeyHex);wt&&(Vl.set(wt),gd.set(!0)),Hs.set(!1)}else await C(),Hs.set(!1)}catch(ht){console.error("èªè¨¼åæåä¸­ã«ã¨ã©ã¼:",ht),await C(),Hs.set(!1)}finally{Nl.markAuthInitialized()}})(),hO()&&!_)try{const ht=await sse();if(ht?.image)Mr.file=ht.image,Mr.metadata=ht.metadata,Mr.received=!0,localStorage.setItem("sharedImageProcessed","1");else{console.warn("No shared image data received");const Lt=new URLSearchParams(window.location.search).get("error");Lt&&console.error("Shared image processing failed with error parameter:",{error:Lt,location:window.location.href})}}catch(ht){console.error("å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼:",ht)}if(localStorage.getItem("firstVisit")!=="1"?(bh.set(!0),localStorage.setItem("firstVisit","1")):setTimeout(()=>{k(y)?.focusEditor()},300),Nve()){const ht=Ove();ht&&kre(ht)}Mve()})(),ze=document.visibilityState==="hidden",document.addEventListener("visibilitychange",Ee),()=>{document.removeEventListener("visibilitychange",Ee)})),Ge(()=>{Mr.received&&Mr.file&&k(y)&&(k(y).uploadFiles([Mr.file]),Mr.file=null,Mr.metadata=void 0,Mr.received=!1,localStorage.setItem("sharedImageProcessed","1"),setTimeout(()=>localStorage.removeItem("sharedImageProcessed"),500))}),Ge(()=>{mu.received&&mu.content&&k(y)&&(k(y).insertTextContent(mu.content),Tre())});function O(Ae){Ire.set(Ae)}function F(Ae){k(b)&&k(b).updateProgress(Ae)}function L(){k(b)?.reset&&k(b).reset(),localStorage.removeItem("sharedImageProcessed")}function B(){k(y)?.resetPostContent()}function N(){if(!k(y)?.getEditorHtml)return!1;const Ae=k(y).getEditorHtml();if(!Ae||Ae==="<p></p>")return!1;const We=dwe(Ae);return We.needsConfirmation?(Jm.set(Ae),ld.set(!0),!1):We.success}function M(){const Ae=Jm.value;Ae&&fwe(Ae),Jm.set(null),ld.set(!1)}function R(){Jm.set(null),ld.set(!1)}let H=ge(!1);Ge(()=>{K(H,ld.value,!0)}),Ge(()=>{!k(H)&&ld.value&&ld.set(!1)});function z(){Ym.set(!0)}function V(Ae){k(y)?.loadDraftContent(Ae)}let Q=null;async function Y(){if(!k(u)||!Dr.value.pubkey)return;m||await C(Dr.value.pubkey);const Ae=await m.refreshRelaysAndProfile(Dr.value.pubkey);Ae&&(Vl.set(Ae),gd.set(!0))}let ie=ge(!1),ne=ge(null),J=ge(!1);Ge(()=>{r()&&!Q&&(Q=new $F(r()))}),Ge(()=>{k(S)&&Q&&!k(ie)&&!k(J)&&(ke(),K(J,!0))});function ke(){!Q||k(ie)||(K(ne,Q.createMessage("info"),!0),K(ie,!0),Q.scheduleHide(()=>{K(ie,!1),K(ne,null)},3e3))}let ze=!1,he=0;function Ee(){const Ae=Date.now();if(Ae-he<1e3){ze=document.visibilityState==="hidden";return}document.visibilityState==="visible"&&ze&&k(S)&&Q&&!k(ie)&&(ke(),he=Ae),ze=document.visibilityState==="hidden"}let Le=ge(Nt(localStorage.getItem("imageCompressionLevel")||"medium"));function pe(Ae){K(Le,Ae,!0)}let xe=ge(Nt(localStorage.getItem("uploadEndpoint")||_k(n())));function Me(Ae){K(xe,Ae,!0)}Ge(()=>()=>{Q&&Q.dispose()});var Ue=Fe(),qe=Te(Ue);{var tt=Ae=>{var We=Fe(),lt=Te(We);Dt(lt,()=>OG,(ht,wt)=>{wt(ht,{children:(Lt,Rt)=>{var pt=Rve(),He=re(pt),st=re(He);{let _t=ae(()=>k(ie)&&k(ne)?k(ne):null);Kwe(st,{onResetPostContent:B,onSaveDraft:N,onShowDraftList:z,get balloonMessage(){return k(_t)}})}var Ot=ve(st,2);pr(wme(Ot,{get rxNostr(){return k(p)},get hasStoredKey(){return k(u)},onPostSuccess:L,onUploadStatusChange:O,onUploadProgress:F}),_t=>K(y,_t,!0),()=>k(y));var Mt=ve(He,2);Ave(Mt,{});var dn=ve(Mt,2);_ve(dn,{onUploadImage:()=>k(y)?.openFileDialog()});var Vt=ve(dn,2);pr(hve(Vt,{get isAuthenticated(){return k(u)},get isAuthInitialized(){return k(d)},get swNeedRefresh(){return i()},get onShowLoginDialog(){return Mre},get onOpenSettingsDialog(){return Dre},get onOpenLogoutDialog(){return Nre}}),_t=>K(b,_t,!0),()=>k(b));var Qt=ve(Vt,2);{var Jt=_t=>{lwe(_t,{get show(){return Kh.value},get onClose(){return eg},onSave:x,onNostrLogin:T,get isLoadingNostrLogin(){return k(g)},get secretKey(){return k(l)},set secretKey(Fn){K(l,Fn,!0)}})};$e(Qt,_t=>{Kh.value&&_t(Jt)})}var Sn=ve(Qt,2);{var en=_t=>{Ybe(_t,{get show(){return U0.value},get onClose(){return Rre},onLogout:P,get isLoggingOut(){return k(E)}})};$e(Sn,_t=>{U0.value&&_t(en)})}var cn=ve(Sn,2);{var Bt=_t=>{uwe(_t,{get show(){return bh.value},onClose:()=>bh.set(!1)})};$e(cn,_t=>{bh.value&&_t(Bt)})}var tn=ve(cn,2);{var hn=_t=>{kwe(_t,{get show(){return Ym.value},onClose:()=>Ym.set(!1),onApplyDraft:V})};$e(tn,_t=>{Ym.value&&_t(hn)})}var Gi=ve(tn,2);{var Zi=_t=>{{let Fn=ae(()=>r()("common.confirm")),Ai=ae(()=>r()("draft.limit_reached")),ci=ae(()=>r()("common.ok")),rr=ae(()=>r()("common.cancel"));x6(_t,{get title(){return k(Fn)},get description(){return k(Ai)},get confirmLabel(){return k(ci)},get cancelLabel(){return k(rr)},confirmVariant:"danger",onConfirm:M,onCancel:R,get open(){return k(H)},set open(Qn){K(H,Qn,!0)}})}};$e(Gi,_t=>{k(H)&&_t(Zi)})}var ds=ve(Gi,2);zbe(ds,{get show(){return Ak.value},get onClose(){return Lre},onRefreshRelaysAndProfile:Y,get selectedCompression(){return k(Le)},onSelectedCompressionChange:pe,get selectedEndpoint(){return k(xe)},onSelectedEndpointChange:Me,onOpenWelcomeDialog:()=>bh.set(!0)}),X(Lt,pt)},$$slots:{default:!0}})}),X(Ae,We)};$e(qe,Ae=>{n()&&k(S)&&Ae(tt)})}X(t,Ue),Et(),o()}PS(Dve,{target:document.getElementById("app")});
