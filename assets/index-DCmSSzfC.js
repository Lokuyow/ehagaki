(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const H2=!1;var _b=Array.isArray,w7=Array.prototype.indexOf,Ab=Array.from,h4=Object.defineProperty,bc=Object.getOwnPropertyDescriptor,p4=Object.getOwnPropertyDescriptors,m4=Object.prototype,v7=Array.prototype,Pb=Object.getPrototypeOf,B_=Object.isExtensible;function _h(t){return typeof t=="function"}const Bt=()=>{};function g4(t){for(var e=0;e<t.length;e++)t[e]()}function y4(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}const Qr=2,S0=4,Cm=8,rk=1<<24,dl=16,fl=32,Kc=64,ik=128,Ls=512,pi=1024,Ai=2048,hl=4096,us=8192,Xa=16384,sk=32768,sl=65536,F_=1<<17,b4=1<<18,hd=1<<19,w4=1<<20,Wa=1<<25,Zu=32768,V2=1<<21,ok=1<<22,wc=1<<23,qo=Symbol("$state"),v4=Symbol("legacy props"),x7=Symbol(""),Zd=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function ak(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function S7(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function k7(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function E7(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function T7(t){throw new Error("https://svelte.dev/e/effect_orphan")}function C7(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function _7(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function A7(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function P7(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function I7(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function O7(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const M7=1,N7=2,x4=4,R7=8,D7=16,L7=1,B7=4,F7=8,$7=16,z7=1,U7=2,br=Symbol(),H7="http://www.w3.org/1999/xhtml",V7="http://www.w3.org/2000/svg",S4="@attach";function W7(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function j7(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function k4(t){return t===this.v}function lk(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function E4(t){return!lk(t,this.v)}let q7=!1;const K7=[];function G7(t,e=!1,n=!1){return t0(t,new Map,"",K7,null,n)}function t0(t,e,n,r,i=null,s=!1){if(typeof t=="object"&&t!==null){var o=e.get(t);if(o!==void 0)return o;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(_b(t)){var a=Array(t.length);e.set(t,a),i!==null&&e.set(i,a);for(var l=0;l<t.length;l+=1){var c=t[l];l in t&&(a[l]=t0(c,e,n,r,null,s))}return a}if(Pb(t)===m4){a={},e.set(t,a),i!==null&&e.set(i,a);for(var u in t)a[u]=t0(t[u],e,n,r,null,s);return a}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return t0(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let Xr=null;function Ef(t){Xr=t}function W2(t){return Ib().get(t)}function Z7(t,e){return Ib().set(t,e),e}function X7(t){return Ib().has(t)}function Q7(){return Ib()}function wt(t,e=!1,n){Xr={p:Xr,i:!1,c:null,e:null,s:t,x:null,l:null}}function vt(t){var e=Xr,n=e.e;if(n!==null){e.e=null;for(var r of n)j4(r)}return t!==void 0&&(e.x=t),e.i=!0,Xr=e.p,t??{}}function T4(){return!0}function Ib(t){return Xr===null&&ak(),Xr.c??=new Map(Y7(Xr)||void 0)}function Y7(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}let Su=[];function C4(){var t=Su;Su=[],g4(t)}function pd(t){if(Su.length===0&&!mp){var e=Su;queueMicrotask(()=>{e===Su&&C4()})}Su.push(t)}function J7(){for(;Su.length>0;)C4()}function _4(t){var e=hn;if(e===null)return Wt.f|=wc,t;if((e.f&sk)===0){if((e.f&ik)===0)throw t;e.b.error(t)}else Tf(t,e)}function Tf(t,e){for(;e!==null;){if((e.f&ik)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const e9=-7169;function Or(t,e){t.f=t.f&e9|e}function ck(t){(t.f&Ls)!==0||t.deps===null?Or(t,pi):Or(t,hl)}function A4(t){if(t!==null)for(const e of t)(e.f&Qr)===0||(e.f&Zu)===0||(e.f^=Zu,A4(e.deps))}function P4(t,e,n){(t.f&Ai)!==0?e.add(t):(t.f&hl)!==0&&n.add(t),A4(t.deps),Or(t,pi)}const xg=new Set;let cn=null,pp=null,eo=null,As=[],Ob=null,j2=!1,mp=!1;class no{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#r=0;#i=null;#a=new Set;#s=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#r>0}process(e){As=[],pp=null,this.apply();var n=[],r=[];for(const i of e)this.#o(i,n,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(n)):(pp=this,cn=null,$_(r),$_(n),pp=null,this.#i?.resolve()),eo=null}#o(e,n,r){e.f^=pi;for(var i=e.first,s=null;i!==null;){var o=i.f,a=(o&(fl|Kc))!==0,l=a&&(o&pi)!==0,c=l||(o&us)!==0||this.skipped_effects.has(i);if(!c&&i.fn!==null){a?i.f^=pi:s!==null&&(o&(S0|Cm|rk))!==0?s.b.defer_effect(i):(o&S0)!==0?n.push(i):Om(i)&&((o&dl)!==0&&this.#a.add(i),qp(i));var u=i.first;if(u!==null){i=u;continue}}var d=i.parent;for(i=i.next;i===null&&d!==null;)d===s&&(s=null),i=d.next,d=d.parent}}#l(e){for(var n=0;n<e.length;n+=1)P4(e[n],this.#a,this.#s)}capture(e,n){n!==br&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&wc)===0&&(this.current.set(e,e.v),eo?.set(e,e.v))}activate(){cn=this,this.apply()}deactivate(){cn===this&&(cn=null,eo=null)}flush(){if(this.activate(),As.length>0){if(I4(),cn!==null&&cn!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#c(){if(this.#r===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#u()}#u(){if(xg.size>1){this.previous.clear();var e=eo,n=!0;for(const i of xg){if(i===this){n=!1;continue}const s=[];for(const[a,l]of this.current){if(i.current.has(a))if(n&&l!==i.current.get(a))i.current.set(a,l);else continue;s.push(a)}if(s.length===0)continue;const o=[...i.current.keys()].filter(a=>!this.current.has(a));if(o.length>0){var r=As;As=[];const a=new Set,l=new Map;for(const c of s)O4(c,o,a,l);if(As.length>0){cn=i,i.apply();for(const c of As)i.#o(c,[],[]);i.deactivate()}As=r}}cn=null,eo=e}this.committed=!0,xg.delete(this)}increment(e){this.#n+=1,e&&(this.#r+=1)}decrement(e){this.#n-=1,e&&(this.#r-=1),this.revive()}revive(){for(const e of this.#a)this.#s.delete(e),Or(e,Ai),ol(e);for(const e of this.#s)Or(e,hl),ol(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#i??=y4()).promise}static ensure(){if(cn===null){const e=cn=new no;xg.add(cn),mp||no.enqueue(()=>{cn===e&&e.flush()})}return cn}static enqueue(e){pd(e)}apply(){}}function t9(t){var e=mp;mp=!0;try{for(var n;;){if(J7(),As.length===0&&(cn?.flush(),As.length===0))return Ob=null,n;I4()}}finally{mp=e}}function I4(){var t=$u;j2=!0;var e=null;try{var n=0;for(T0(!0);As.length>0;){var r=no.ensure();if(n++>1e3){var i,s;n9()}r.process(As),vc.clear()}}finally{j2=!1,T0(t),Ob=null}}function n9(){try{C7()}catch(t){Tf(t,Ob)}}let Ca=null;function $_(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(Xa|us))===0&&Om(r)&&(Ca=new Set,qp(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Z4(r):r.fn=null),Ca?.size>0)){vc.clear();for(const i of Ca){if((i.f&(Xa|us))!==0)continue;const s=[i];let o=i.parent;for(;o!==null;)Ca.has(o)&&(Ca.delete(o),s.push(o)),o=o.parent;for(let a=s.length-1;a>=0;a--){const l=s[a];(l.f&(Xa|us))===0&&qp(l)}}Ca.clear()}}Ca=null}}function O4(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const i of t.reactions){const s=i.f;(s&Qr)!==0?O4(i,e,n,r):(s&(ok|dl))!==0&&(s&Ai)===0&&M4(i,e,r)&&(Or(i,Ai),ol(i))}}function M4(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const i of t.deps){if(e.includes(i))return!0;if((i.f&Qr)!==0&&M4(i,e,n))return n.set(i,!0),!0}return n.set(t,!1),!1}function ol(t){for(var e=Ob=t;e.parent!==null;){e=e.parent;var n=e.f;if(j2&&e===hn&&(n&dl)!==0&&(n&b4)===0)return;if((n&(Kc|fl))!==0){if((n&pi)===0)return;e.f^=pi}}As.push(e)}function uk(t){let e=0,n=Nc(0),r;return()=>{hk()&&(E(n),Im(()=>(e===0&&(r=ps(()=>t(()=>No(n)))),e+=1,()=>{pd(()=>{e-=1,e===0&&(r?.(),r=void 0,No(n))})})))}}var r9=sl|hd|ik;function i9(t,e,n){new s9(t,e,n)}class s9{parent;is_pending=!1;#e;#t=null;#n;#r;#i;#a=null;#s=null;#o=null;#l=null;#c=null;#u=0;#d=0;#h=!1;#p=new Set;#g=new Set;#f=null;#m=uk(()=>(this.#f=Nc(this.#u),()=>{this.#f=null}));constructor(e,n,r){this.#e=e,this.#n=n,this.#r=r,this.parent=hn.b,this.is_pending=!!this.#n.pending,this.#i=md(()=>{hn.b=this;{var i=this.#b();try{this.#a=Hi(()=>r(i))}catch(s){this.error(s)}this.#d>0?this.#x():this.is_pending=!1}return()=>{this.#c?.remove()}},r9)}#y(){try{this.#a=Hi(()=>this.#r(this.#e))}catch(e){this.error(e)}}#w(){const e=this.#n.pending;e&&(this.#s=Hi(()=>e(this.#e)),no.enqueue(()=>{var n=this.#b();this.#a=this.#v(()=>(no.ensure(),Hi(()=>this.#r(n)))),this.#d>0?this.#x():(Fu(this.#s,()=>{this.#s=null}),this.is_pending=!1)}))}#b(){var e=this.#e;return this.is_pending&&(this.#c=Ko(),this.#e.before(this.#c),e=this.#c),e}defer_effect(e){P4(e,this.#p,this.#g)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#n.pending}#v(e){var n=hn,r=Wt,i=Xr;Xo(this.#i),qi(this.#i),Ef(this.#i.ctx);try{return e()}catch(s){return _4(s),null}finally{Xo(n),qi(r),Ef(i)}}#x(){const e=this.#n.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Y4(this.#a,this.#l)),this.#s===null&&(this.#s=Hi(()=>e(this.#e)))}#S(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#S(e);return}if(this.#d+=e,this.#d===0){this.is_pending=!1;for(const n of this.#p)Or(n,Ai),ol(n);for(const n of this.#g)Or(n,hl),ol(n);this.#p.clear(),this.#g.clear(),this.#s&&Fu(this.#s,()=>{this.#s=null}),this.#l&&(this.#e.before(this.#l),this.#l=null)}}update_pending_count(e){this.#S(e),this.#u+=e,this.#f&&Cf(this.#f,this.#u)}get_effect_pending(){return this.#m(),E(this.#f)}error(e){var n=this.#n.onerror;let r=this.#n.failed;if(this.#h||!n&&!r)throw e;this.#a&&(_r(this.#a),this.#a=null),this.#s&&(_r(this.#s),this.#s=null),this.#o&&(_r(this.#o),this.#o=null);var i=!1,s=!1;const o=()=>{if(i){j7();return}i=!0,s&&O7(),no.ensure(),this.#u=0,this.#o!==null&&Fu(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#v(()=>(this.#h=!1,Hi(()=>this.#r(this.#e)))),this.#d>0?this.#x():this.is_pending=!1};var a=Wt;try{qi(null),s=!0,n?.(e,o),s=!1}catch(l){Tf(l,this.#i&&this.#i.parent)}finally{qi(a)}r&&pd(()=>{this.#o=this.#v(()=>{no.ensure(),this.#h=!0;try{return Hi(()=>{r(this.#e,()=>e,()=>o)})}catch(l){return Tf(l,this.#i.parent),null}finally{this.#h=!1}})})}}function N4(t,e,n,r){const i=Mb;if(n.length===0&&t.length===0){r(e.map(i));return}var s=cn,o=hn,a=o9();function l(){Promise.all(n.map(c=>a9(c))).then(c=>{a();try{r([...e.map(i),...c])}catch(u){(o.f&Xa)===0&&Tf(u,o)}s?.deactivate(),k0()}).catch(c=>{Tf(c,o)})}t.length>0?Promise.all(t).then(()=>{a();try{return l()}finally{s?.deactivate(),k0()}}):l()}function o9(){var t=hn,e=Wt,n=Xr,r=cn;return function(s=!0){Xo(t),qi(e),Ef(n),s&&r?.activate()}}function k0(){Xo(null),qi(null),Ef(null)}function Mb(t){var e=Qr|Ai,n=Wt!==null&&(Wt.f&Qr)!==0?Wt:null;return hn!==null&&(hn.f|=hd),{ctx:Xr,deps:null,effects:null,equals:k4,f:e,fn:t,reactions:null,rv:0,v:br,wv:0,parent:n??hn,ac:null}}function a9(t,e,n){let r=hn;r===null&&S7();var i=r.b,s=void 0,o=Nc(br),a=!Wt,l=new Map;return w9(()=>{var c=y4();s=c.promise;try{Promise.resolve(t()).then(c.resolve,c.reject).then(()=>{u===cn&&u.committed&&u.deactivate(),k0()})}catch(h){c.reject(h),k0()}var u=cn;if(a){var d=i.is_rendered();i.update_pending_count(1),u.increment(d),l.get(u)?.reject(Zd),l.delete(u),l.set(u,c)}const f=(h,p=void 0)=>{if(u.activate(),p)p!==Zd&&(o.f|=wc,Cf(o,p));else{(o.f&wc)!==0&&(o.f^=wc),Cf(o,h);for(const[m,g]of l){if(l.delete(m),m===u)break;g.reject(Zd)}}a&&(i.update_pending_count(-1),u.decrement(d))};c.promise.then(f,h=>f(null,h||"unknown"))}),Am(()=>{for(const c of l.values())c.reject(Zd)}),new Promise(c=>{function u(d){function f(){d===s?c(o):u(s)}d.then(f,f)}u(s)})}function oe(t){const e=Mb(t);return J4(e),e}function R4(t){const e=Mb(t);return e.equals=E4,e}function D4(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)_r(e[n])}}function l9(t){for(var e=t.parent;e!==null;){if((e.f&Qr)===0)return(e.f&Xa)===0?e:null;e=e.parent}return null}function dk(t){var e,n=hn;Xo(l9(t));try{t.f&=~Zu,D4(t),e=rM(t)}finally{Xo(n)}return e}function L4(t){var e=dk(t);if(!t.equals(e)&&(t.wv=tM(),(!cn?.is_fork||t.deps===null)&&(t.v=e,t.deps===null))){Or(t,pi);return}Rc||(eo!==null?(hk()||cn?.is_fork)&&eo.set(t,e):ck(t))}let q2=new Set;const vc=new Map;let B4=!1;function Nc(t,e){var n={f:0,v:t,reactions:null,equals:k4,rv:0,wv:0};return n}function ye(t,e){const n=Nc(t);return J4(n),n}function F4(t,e=!1,n=!0){const r=Nc(t);return e||(r.equals=E4),r}function Q(t,e,n=!1){Wt!==null&&(!ro||(Wt.f&F_)!==0)&&T4()&&(Wt.f&(Qr|dl|ok|F_))!==0&&!Qa?.includes(t)&&I7();let r=n?Zt(e):e;return Cf(t,r)}function Cf(t,e){if(!t.equals(e)){var n=t.v;Rc?vc.set(t,e):vc.set(t,n),t.v=e;var r=no.ensure();if(r.capture(t,n),(t.f&Qr)!==0){const i=t;(t.f&Ai)!==0&&dk(i),ck(i)}t.wv=tM(),$4(t,Ai),hn!==null&&(hn.f&pi)!==0&&(hn.f&(fl|Kc))===0&&(ks===null?S9([t]):ks.push(t)),!r.is_fork&&q2.size>0&&!B4&&c9()}return e}function c9(){B4=!1;var t=$u;T0(!0);const e=Array.from(q2);try{for(const n of e)(n.f&pi)!==0&&Or(n,hl),Om(n)&&qp(n)}finally{T0(t)}q2.clear()}function No(t){Q(t,t.v+1)}function $4(t,e){var n=t.reactions;if(n!==null)for(var r=n.length,i=0;i<r;i++){var s=n[i],o=s.f,a=(o&Ai)===0;if(a&&Or(s,e),(o&Qr)!==0){var l=s;eo?.delete(l),(o&Zu)===0&&(o&Ls&&(s.f|=Zu),$4(l,hl))}else a&&((o&dl)!==0&&Ca!==null&&Ca.add(s),ol(s))}}function Zt(t){if(typeof t!="object"||t===null||qo in t)return t;const e=Pb(t);if(e!==m4&&e!==v7)return t;var n=new Map,r=_b(t),i=ye(0),s=Ya,o=a=>{if(Ya===s)return a();var l=Wt,c=Ya;qi(null),W_(s);var u=a();return qi(l),W_(c),u};return r&&n.set("length",ye(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&A7();var u=n.get(l);return u===void 0?u=o(()=>{var d=ye(c.value);return n.set(l,d),d}):Q(u,c.value,!0),!0},deleteProperty(a,l){var c=n.get(l);if(c===void 0){if(l in a){const u=o(()=>ye(br));n.set(l,u),No(i)}}else Q(c,br),No(i);return!0},get(a,l,c){if(l===qo)return t;var u=n.get(l),d=l in a;if(u===void 0&&(!d||bc(a,l)?.writable)&&(u=o(()=>{var h=Zt(d?a[l]:br),p=ye(h);return p}),n.set(l,u)),u!==void 0){var f=E(u);return f===br?void 0:f}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=E(u))}else if(c===void 0){var d=n.get(l),f=d?.v;if(d!==void 0&&f!==br)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(a,l){if(l===qo)return!0;var c=n.get(l),u=c!==void 0&&c.v!==br||Reflect.has(a,l);if(c!==void 0||hn!==null&&(!u||bc(a,l)?.writable)){c===void 0&&(c=o(()=>{var f=u?Zt(a[l]):br,h=ye(f);return h}),n.set(l,c));var d=E(c);if(d===br)return!1}return u},set(a,l,c,u){var d=n.get(l),f=l in a;if(r&&l==="length")for(var h=c;h<d.v;h+=1){var p=n.get(h+"");p!==void 0?Q(p,br):h in a&&(p=o(()=>ye(br)),n.set(h+"",p))}if(d===void 0)(!f||bc(a,l)?.writable)&&(d=o(()=>ye(void 0)),Q(d,Zt(c)),n.set(l,d));else{f=d.v!==br;var m=o(()=>Zt(c));Q(d,m)}var g=Reflect.getOwnPropertyDescriptor(a,l);if(g?.set&&g.set.call(u,c),!f){if(r&&typeof l=="string"){var y=n.get("length"),b=Number(l);Number.isInteger(b)&&b>=y.v&&Q(y,b+1)}No(i)}return!0},ownKeys(a){E(i);var l=Reflect.ownKeys(a).filter(d=>{var f=n.get(d);return f===void 0||f.v!==br});for(var[c,u]of n)u.v!==br&&!(c in a)&&l.push(c);return l},setPrototypeOf(){P7()}})}function z_(t){try{if(t!==null&&typeof t=="object"&&qo in t)return t[qo]}catch{}return t}function u9(t,e){return Object.is(z_(t),z_(e))}var U_,z4,U4,H4;function d9(){if(U_===void 0){U_=window,z4=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;U4=bc(e,"firstChild").get,H4=bc(e,"nextSibling").get,B_(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),B_(n)&&(n.__t=void 0)}}function Ko(t=""){return document.createTextNode(t)}function E0(t){return U4.call(t)}function _m(t){return H4.call(t)}function ie(t,e){return E0(t)}function Te(t,e=!1){{var n=E0(t);return n instanceof Comment&&n.data===""?_m(n):n}}function ve(t,e=1,n=!1){let r=t;for(;e--;)r=_m(r);return r}function f9(t){t.textContent=""}function V4(){return!1}function h9(t,e){if(e){const n=document.body;t.autofocus=!0,pd(()=>{document.activeElement===n&&t.focus()})}}let H_=!1;function p9(){H_||(H_=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Nb(t){var e=Wt,n=hn;qi(null),Xo(null);try{return t()}finally{qi(e),Xo(n)}}function fk(t,e,n,r=n){t.addEventListener(e,()=>Nb(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),p9()}function W4(t){hn===null&&(Wt===null&&T7(),E7()),Rc&&k7()}function m9(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Hs(t,e,n){var r=hn;r!==null&&(r.f&us)!==0&&(t|=us);var i={ctx:Xr,deps:null,nodes:null,f:t|Ai|Ls,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{qp(i),i.f|=sk}catch(a){throw _r(i),a}else e!==null&&ol(i);var s=i;if(n&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&(s.f&hd)===0&&(s=s.first,(t&dl)!==0&&(t&sl)!==0&&s!==null&&(s.f|=sl)),s!==null&&(s.parent=r,r!==null&&m9(s,r),Wt!==null&&(Wt.f&Qr)!==0&&(t&Kc)===0)){var o=Wt;(o.effects??=[]).push(s)}return i}function hk(){return Wt!==null&&!ro}function Am(t){const e=Hs(Cm,null,!1);return Or(e,pi),e.teardown=t,e}function nt(t){W4();var e=hn.f,n=!Wt&&(e&fl)!==0&&(e&sk)===0;if(n){var r=Xr;(r.e??=[]).push(t)}else return j4(t)}function j4(t){return Hs(S0|w4,t,!1)}function g9(t){return W4(),Hs(Cm|w4,t,!0)}function y9(t){no.ensure();const e=Hs(Kc|hd,t,!0);return()=>{_r(e)}}function b9(t){no.ensure();const e=Hs(Kc|hd,t,!0);return(n={})=>new Promise(r=>{n.outro?Fu(e,()=>{_r(e),r(void 0)}):(_r(e),r(void 0))})}function Pm(t){return Hs(S0,t,!1)}function w9(t){return Hs(ok|hd,t,!0)}function Im(t,e=0){return Hs(Cm|e,t,!0)}function Ge(t,e=[],n=[],r=[]){N4(r,e,n,i=>{Hs(Cm,()=>t(...i.map(E)),!0)})}function md(t,e=0){var n=Hs(dl|e,t,!0);return n}function q4(t,e=0){var n=Hs(rk|e,t,!0);return n}function Hi(t){return Hs(fl|hd,t,!0)}function K4(t){var e=t.teardown;if(e!==null){const n=Rc,r=Wt;V_(!0),qi(null);try{e.call(null)}finally{V_(n),qi(r)}}}function G4(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&Nb(()=>{i.abort(Zd)});var r=n.next;(n.f&Kc)!==0?n.parent=null:_r(n,e),n=r}}function v9(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&fl)===0&&_r(e),e=n}}function _r(t,e=!0){var n=!1;(e||(t.f&b4)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(x9(t.nodes.start,t.nodes.end),n=!0),G4(t,e&&!n),C0(t,0),Or(t,Xa);var r=t.nodes&&t.nodes.t;if(r!==null)for(const s of r)s.stop();K4(t);var i=t.parent;i!==null&&i.first!==null&&Z4(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function x9(t,e){for(;t!==null;){var n=t===e?null:_m(t);t.remove(),t=n}}function Z4(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Fu(t,e,n=!0){var r=[];X4(t,r,!0);var i=()=>{n&&_r(t),e&&e()},s=r.length;if(s>0){var o=()=>--s||i();for(var a of r)a.out(o)}else i()}function X4(t,e,n){if((t.f&us)===0){t.f^=us;var r=t.nodes&&t.nodes.t;if(r!==null)for(const a of r)(a.is_global||n)&&e.push(a);for(var i=t.first;i!==null;){var s=i.next,o=(i.f&sl)!==0||(i.f&fl)!==0&&(t.f&dl)!==0;X4(i,e,o?n:!1),i=s}}}function pk(t){Q4(t,!0)}function Q4(t,e){if((t.f&us)!==0){t.f^=us,(t.f&pi)===0&&(Or(t,Ai),ol(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&sl)!==0||(n.f&fl)!==0;Q4(n,i?e:!1),n=r}var s=t.nodes&&t.nodes.t;if(s!==null)for(const o of s)(o.is_global||e)&&o.in()}}function Y4(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var i=n===r?null:_m(n);e.append(n),n=i}}let $u=!1;function T0(t){$u=t}let Rc=!1;function V_(t){Rc=t}let Wt=null,ro=!1;function qi(t){Wt=t}let hn=null;function Xo(t){hn=t}let Qa=null;function J4(t){Wt!==null&&(Qa===null?Qa=[t]:Qa.push(t))}let Ci=null,ns=0,ks=null;function S9(t){ks=t}let eM=1,jp=0,Ya=jp;function W_(t){Ya=t}function tM(){return++eM}function Om(t){var e=t.f;if((e&Ai)!==0)return!0;if(e&Qr&&(t.f&=~Zu),(e&hl)!==0){for(var n=t.deps,r=n.length,i=0;i<r;i++){var s=n[i];if(Om(s)&&L4(s),s.wv>t.wv)return!0}(e&Ls)!==0&&eo===null&&Or(t,pi)}return!1}function nM(t,e,n=!0){var r=t.reactions;if(r!==null&&!Qa?.includes(t))for(var i=0;i<r.length;i++){var s=r[i];(s.f&Qr)!==0?nM(s,e,!1):e===s&&(n?Or(s,Ai):(s.f&pi)!==0&&Or(s,hl),ol(s))}}function rM(t){var e=Ci,n=ns,r=ks,i=Wt,s=Qa,o=Xr,a=ro,l=Ya,c=t.f;Ci=null,ns=0,ks=null,Wt=(c&(fl|Kc))===0?t:null,Qa=null,Ef(t.ctx),ro=!1,Ya=++jp,t.ac!==null&&(Nb(()=>{t.ac.abort(Zd)}),t.ac=null);try{t.f|=V2;var u=t.fn,d=u(),f=t.deps;if(Ci!==null){var h;if(C0(t,ns),f!==null&&ns>0)for(f.length=ns+Ci.length,h=0;h<Ci.length;h++)f[ns+h]=Ci[h];else t.deps=f=Ci;if(hk()&&(t.f&Ls)!==0)for(h=ns;h<f.length;h++)(f[h].reactions??=[]).push(t)}else f!==null&&ns<f.length&&(C0(t,ns),f.length=ns);if(T4()&&ks!==null&&!ro&&f!==null&&(t.f&(Qr|hl|Ai))===0)for(h=0;h<ks.length;h++)nM(ks[h],t);return i!==null&&i!==t&&(jp++,ks!==null&&(r===null?r=ks:r.push(...ks))),(t.f&wc)!==0&&(t.f^=wc),d}catch(p){return _4(p)}finally{t.f^=V2,Ci=e,ns=n,ks=r,Wt=i,Qa=s,Ef(o),ro=a,Ya=l}}function k9(t,e){let n=e.reactions;if(n!==null){var r=w7.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}if(n===null&&(e.f&Qr)!==0&&(Ci===null||!Ci.includes(e))){var s=e;(s.f&Ls)!==0&&(s.f^=Ls,s.f&=~Zu),ck(s),D4(s),C0(s,0)}}function C0(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)k9(t,n[r])}function qp(t){var e=t.f;if((e&Xa)===0){Or(t,pi);var n=hn,r=$u;hn=t,$u=!0;try{(e&(dl|rk))!==0?v9(t):G4(t),K4(t);var i=rM(t);t.teardown=typeof i=="function"?i:null,t.wv=eM;var s;H2&&q7&&(t.f&Ai)!==0&&t.deps}finally{$u=r,hn=n}}}async function Dc(){await Promise.resolve(),t9()}function E(t){var e=t.f,n=(e&Qr)!==0;if(Wt!==null&&!ro){var r=hn!==null&&(hn.f&Xa)!==0;if(!r&&!Qa?.includes(t)){var i=Wt.deps;if((Wt.f&V2)!==0)t.rv<jp&&(t.rv=jp,Ci===null&&i!==null&&i[ns]===t?ns++:Ci===null?Ci=[t]:Ci.includes(t)||Ci.push(t));else{(Wt.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[Wt]:s.includes(Wt)||s.push(Wt)}}}if(Rc&&vc.has(t))return vc.get(t);if(n){var o=t;if(Rc){var a=o.v;return((o.f&pi)===0&&o.reactions!==null||sM(o))&&(a=dk(o)),vc.set(o,a),a}var l=(o.f&Ls)===0&&!ro&&Wt!==null&&($u||(Wt.f&Ls)!==0),c=o.deps===null;Om(o)&&(l&&(o.f|=Ls),L4(o)),l&&!c&&iM(o)}if(eo?.has(t))return eo.get(t);if((t.f&wc)!==0)throw t.v;return t.v}function iM(t){if(t.deps!==null){t.f|=Ls;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&Qr)!==0&&(e.f&Ls)===0&&iM(e)}}function sM(t){if(t.v===br)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(vc.has(e)||(e.f&Qr)!==0&&sM(e))return!0;return!1}function ps(t){var e=ro;try{return ro=!0,t()}finally{ro=e}}function E9(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(qo in t)K2(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&qo in n&&K2(n)}}}function K2(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{K2(t[r],e)}catch{}const n=Pb(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=p4(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}function T9(){return Symbol(S4)}function C9(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const _9=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function A9(t){return _9.includes(t)}const P9={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function I9(t){return t=t.toLowerCase(),P9[t]??t}const O9=["touchstart","touchmove"];function M9(t){return O9.includes(t)}const oM=new Set,G2=new Set;function mk(t,e,n,r={}){function i(s){if(r.capture||Jh.call(e,s),!s.cancelBubble)return Nb(()=>n?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?pd(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function Sr(t,e,n,r={}){var i=mk(e,t,n,r);return()=>{t.removeEventListener(e,i,r)}}function Is(t,e,n,r,i){var s={capture:r,passive:i},o=mk(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Am(()=>{e.removeEventListener(t,o,s)})}function Mi(t){for(var e=0;e<t.length;e++)oM.add(t[e]);for(var n of G2)n(t)}let j_=null;function Jh(t){var e=this,n=e.ownerDocument,r=t.type,i=t.composedPath?.()||[],s=i[0]||t.target;j_=t;var o=0,a=j_===t&&t.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=i.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=i[o]||t.target,s!==e){h4(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=Wt,d=hn;qi(null),Xo(null);try{for(var f,h=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+r];m!=null&&(!s.disabled||t.target===s)&&m.call(s,t)}catch(g){f?h.push(g):f=g}if(t.cancelBubble||p===e||p===null)break;s=p}if(f){for(let g of h)queueMicrotask(()=>{throw g});throw f}}finally{t.__root=e,delete t.currentTarget,qi(u),Xo(d)}}}function N9(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Kp(t,e){var n=hn;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function Ce(t,e){var n=(e&z7)!==0,r=(e&U7)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=N9(s?t:"<!>"+t),n||(i=E0(i)));var o=r||z4?document.importNode(i,!0):i.cloneNode(!0);if(n){var a=E0(o),l=o.lastChild;Kp(a,l)}else Kp(o,o);return o}}function Yt(t=""){{var e=Ko(t+"");return Kp(e,e),e}}function ze(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Ko();return t.append(e,n),Kp(e,n),t}function Y(t,e){t!==null&&t.before(e)}function sa(){return(window.__svelte??={}).uid??=1,`c${window.__svelte.uid++}`}function Be(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function Rb(t,e){return R9(t,e)}const Ad=new Map;function R9(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:o=!0}){d9();var a=new Set,l=d=>{for(var f=0;f<d.length;f++){var h=d[f];if(!a.has(h)){a.add(h);var p=M9(h);e.addEventListener(h,Jh,{passive:p});var m=Ad.get(h);m===void 0?(document.addEventListener(h,Jh,{passive:p}),Ad.set(h,1)):Ad.set(h,m+1)}}};l(Ab(oM)),G2.add(l);var c=void 0,u=b9(()=>{var d=n??e.appendChild(Ko());return i9(d,{pending:()=>{}},f=>{if(s){wt({});var h=Xr;h.c=s}i&&(r.$$events=i),c=t(f,r)||{},s&&vt()}),()=>{for(var f of a){e.removeEventListener(f,Jh);var h=Ad.get(f);--h===0?(document.removeEventListener(f,Jh),Ad.delete(f)):Ad.set(f,h)}G2.delete(l),d!==n&&d.parentNode?.removeChild(d)}});return Z2.set(c,u),c}let Z2=new WeakMap;function gp(t,e){const n=Z2.get(t);return n?(Z2.delete(t),n(e)):Promise.resolve()}class Mm{anchor;#e=new Map;#t=new Map;#n=new Map;#r=new Set;#i=!0;constructor(e,n=!0){this.anchor=e,this.#i=n}#a=()=>{var e=cn;if(this.#e.has(e)){var n=this.#e.get(e),r=this.#t.get(n);if(r)pk(r),this.#r.delete(n);else{var i=this.#n.get(n);i&&(this.#t.set(n,i.effect),this.#n.delete(n),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),r=i.effect)}for(const[s,o]of this.#e){if(this.#e.delete(s),s===e)break;const a=this.#n.get(o);a&&(_r(a.effect),this.#n.delete(o))}for(const[s,o]of this.#t){if(s===n||this.#r.has(s))continue;const a=()=>{if(Array.from(this.#e.values()).includes(s)){var c=document.createDocumentFragment();Y4(o,c),c.append(Ko()),this.#n.set(s,{effect:o,fragment:c})}else _r(o);this.#r.delete(s),this.#t.delete(s)};this.#i||!r?(this.#r.add(s),Fu(o,a,!1)):a()}}};#s=e=>{this.#e.delete(e);const n=Array.from(this.#e.values());for(const[r,i]of this.#n)n.includes(r)||(_r(i.effect),this.#n.delete(r))};ensure(e,n){var r=cn,i=V4();if(n&&!this.#t.has(e)&&!this.#n.has(e))if(i){var s=document.createDocumentFragment(),o=Ko();s.append(o),this.#n.set(e,{effect:Hi(()=>n(o)),fragment:s})}else this.#t.set(e,Hi(()=>n(this.anchor)));if(this.#e.set(r,e),i){for(const[a,l]of this.#t)a===e?r.skipped_effects.delete(l):r.skipped_effects.add(l);for(const[a,l]of this.#n)a===e?r.skipped_effects.delete(l.effect):r.skipped_effects.add(l.effect);r.oncommit(this.#a),r.ondiscard(this.#s)}else this.#a()}}function He(t,e,n=!1){var r=new Mm(t),i=n?sl:0;function s(o,a){r.ensure(o,a)}md(()=>{var o=!1;e((a,l=!0)=>{o=!0,s(l,a)}),o||s(!1,null)},i)}function D9(t,e,n){var r=new Mm(t);md(()=>{var i=e();r.ensure(i,n)})}function pu(t,e){return e}function L9(t,e,n){for(var r=[],i=e.length,s,o=e.length,a=0;a<i;a++){let d=e[a];Fu(d,()=>{if(s){if(s.pending.delete(d),s.done.add(d),s.pending.size===0){var f=t.outrogroups;X2(Ab(s.done)),f.delete(s),f.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=r.length===0&&n!==null;if(l){var c=n,u=c.parentNode;f9(u),u.append(c),t.items.clear()}X2(e,!l)}else s={pending:new Set(e),done:new Set},(t.outrogroups??=new Set).add(s)}function X2(t,e=!0){for(var n=0;n<t.length;n++)_r(t[n],e)}var q_;function Ma(t,e,n,r,i,s=null){var o=t,a=new Map,l=(e&x4)!==0;if(l){var c=t;o=c.appendChild(Ko())}var u=null,d=R4(()=>{var y=n();return _b(y)?y:y==null?[]:Ab(y)}),f,h=!0;function p(){g.fallback=u,B9(g,f,o,e,r),u!==null&&(f.length===0?(u.f&Wa)===0?pk(u):(u.f^=Wa,ep(u,null,o)):Fu(u,()=>{u=null}))}var m=md(()=>{f=E(d);for(var y=f.length,b=new Set,x=cn,C=V4(),P=0;P<y;P+=1){var S=f[P],_=r(S,P),k=h?null:a.get(_);k?(k.v&&Cf(k.v,S),k.i&&Cf(k.i,P),C&&x.skipped_effects.delete(k.e)):(k=F9(a,h?o:q_??=Ko(),S,_,P,i,e,n),h||(k.e.f|=Wa),a.set(_,k)),b.add(_)}if(y===0&&s&&!u&&(h?u=Hi(()=>s(o)):(u=Hi(()=>s(q_??=Ko())),u.f|=Wa)),!h)if(C){for(const[T,O]of a)b.has(T)||x.skipped_effects.add(O.e);x.oncommit(p),x.ondiscard(()=>{})}else p();E(d)}),g={effect:m,items:a,outrogroups:null,fallback:u};h=!1}function B9(t,e,n,r,i){var s=(r&R7)!==0,o=e.length,a=t.items,l=t.effect.first,c,u=null,d,f=[],h=[],p,m,g,y;if(s)for(y=0;y<o;y+=1)p=e[y],m=i(p,y),g=a.get(m).e,(g.f&Wa)===0&&(g.nodes?.a?.measure(),(d??=new Set).add(g));for(y=0;y<o;y+=1){if(p=e[y],m=i(p,y),g=a.get(m).e,t.outrogroups!==null)for(const O of t.outrogroups)O.pending.delete(g),O.done.delete(g);if((g.f&Wa)!==0)if(g.f^=Wa,g===l)ep(g,null,n);else{var b=u?u.next:l;g===t.effect.last&&(t.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),Dl(t,u,g),Dl(t,g,b),ep(g,b,n),u=g,f=[],h=[],l=u.next;continue}if((g.f&us)!==0&&(pk(g),s&&(g.nodes?.a?.unfix(),(d??=new Set).delete(g))),g!==l){if(c!==void 0&&c.has(g)){if(f.length<h.length){var x=h[0],C;u=x.prev;var P=f[0],S=f[f.length-1];for(C=0;C<f.length;C+=1)ep(f[C],x,n);for(C=0;C<h.length;C+=1)c.delete(h[C]);Dl(t,P.prev,S.next),Dl(t,u,P),Dl(t,S,x),l=x,u=S,y-=1,f=[],h=[]}else c.delete(g),ep(g,l,n),Dl(t,g.prev,g.next),Dl(t,g,u===null?t.effect.first:u.next),Dl(t,u,g),u=g;continue}for(f=[],h=[];l!==null&&l!==g;)(c??=new Set).add(l),h.push(l),l=l.next;if(l===null)continue}(g.f&Wa)===0&&f.push(g),u=g,l=g.next}if(t.outrogroups!==null){for(const O of t.outrogroups)O.pending.size===0&&(X2(Ab(O.done)),t.outrogroups?.delete(O));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||c!==void 0){var _=[];if(c!==void 0)for(g of c)(g.f&us)===0&&_.push(g);for(;l!==null;)(l.f&us)===0&&l!==t.fallback&&_.push(l),l=l.next;var k=_.length;if(k>0){var T=(r&x4)!==0&&o===0?n:null;if(s){for(y=0;y<k;y+=1)_[y].nodes?.a?.measure();for(y=0;y<k;y+=1)_[y].nodes?.a?.fix()}L9(t,_,T)}}s&&pd(()=>{if(d!==void 0)for(g of d)g.nodes?.a?.apply()})}function F9(t,e,n,r,i,s,o,a){var l=(o&M7)!==0?(o&D7)===0?F4(n,!1,!1):Nc(n):null,c=(o&N7)!==0?Nc(i):null;return{v:l,i:c,e:Hi(()=>(s(e,l??n,c??i,a),()=>{t.delete(r)}))}}function ep(t,e,n){if(t.nodes)for(var r=t.nodes.start,i=t.nodes.end,s=e&&(e.f&Wa)===0?e.nodes.start:n;r!==null;){var o=_m(r);if(s.before(r),r===i)return;r=o}}function Dl(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function kt(t,e,...n){var r=new Mm(t);md(()=>{const i=e()??null;r.ensure(i,i&&(s=>i(s,...n)))},sl)}function _t(t,e,n){var r=new Mm(t);md(()=>{var i=e()??null;r.ensure(i,i&&(s=>n(s,i)))},sl)}function $9(t,e,n,r,i,s){var o=null,a=t,l=new Mm(a,!1);md(()=>{const c=e()||null;var u=c==="svg"?V7:null;if(c===null){l.ensure(null,null);return}return l.ensure(c,d=>{if(c){if(o=u?document.createElementNS(u,c):document.createElement(c),Kp(o,o),r){var f=o.appendChild(Ko());r(o,f)}hn.nodes.end=o,d.before(o)}}),()=>{}},sl),Am(()=>{})}function Sg(t,e,n){Pm(()=>{var r=ps(()=>e(t,n?.())||{});if(n&&r?.update){var i=!1,s={};Im(()=>{var o=n();E9(o),i&&lk(s,o)&&(s=o,r.update(o))}),i=!0}if(r?.destroy)return()=>r.destroy()})}function z9(t,e){var n=void 0,r;q4(()=>{n!==(n=e())&&(r&&(_r(r),r=null),n&&(r=Hi(()=>{Pm(()=>n(t))})))})}function aM(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=aM(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function n0(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=aM(t))&&(r&&(r+=" "),r+=e);return r}function lM(t){return typeof t=="object"?n0(t):t??""}const K_=[...` 	
\r\fÂ \v\uFEFF`];function U9(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,o=0;(o=r.indexOf(i,o))>=0;){var a=o+s;(o===0||K_.includes(r[o-1]))&&(a===r.length||K_.includes(r[a]))?r=(o===0?"":r.substring(0,o))+r.substring(a+1):o=a}}return r===""?null:r}function G_(t,e=!1){var n=e?" !important;":";",r="";for(var i in t){var s=t[i];s!=null&&s!==""&&(r+=" "+i+": "+s+n)}return r}function Ev(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function H9(t,e){if(e){var n="",r,i;if(Array.isArray(e)?(r=e[0],i=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,o=0,a=!1,l=[];r&&l.push(...Object.keys(r).map(Ev)),i&&l.push(...Object.keys(i).map(Ev));var c=0,u=-1;const m=t.length;for(var d=0;d<m;d++){var f=t[d];if(a?f==="/"&&t[d-1]==="*"&&(a=!1):s?s===f&&(s=!1):f==="/"&&t[d+1]==="*"?a=!0:f==='"'||f==="'"?s=f:f==="("?o++:f===")"&&o--,!a&&s===!1&&o===0){if(f===":"&&u===-1)u=d;else if(f===";"||d===m-1){if(u!==-1){var h=Ev(t.substring(c,u).trim());if(!l.includes(h)){f!==";"&&d++;var p=t.substring(c,d).trim();n+=" "+p+";"}}c=d+1,u=-1}}}}return r&&(n+=G_(r)),i&&(n+=G_(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Qo(t,e,n,r,i,s){var o=t.__className;if(o!==n||o===void 0){var a=U9(n,r,s);a==null?t.removeAttribute("class"):e?t.className=a:t.setAttribute("class",a),t.__className=n}else if(s&&i!==s)for(var l in s){var c=!!s[l];(i==null||c!==!!i[l])&&t.classList.toggle(l,c)}return s}function Tv(t,e={},n,r){for(var i in n){var s=n[i];e[i]!==s&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,s,r))}}function lc(t,e,n,r){var i=t.__style;if(i!==e){var s=H9(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(Tv(t,n?.[0],r[0]),Tv(t,n?.[1],r[1],"important")):Tv(t,n,r));return r}function _0(t,e,n=!1){if(t.multiple){if(e==null)return;if(!_b(e))return W7();for(var r of t.options)r.selected=e.includes(yp(r));return}for(r of t.options){var i=yp(r);if(u9(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function cM(t){var e=new MutationObserver(()=>{_0(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Am(()=>{e.disconnect()})}function V9(t,e,n=e){var r=new WeakSet,i=!0;fk(t,"change",s=>{var o=s?"[selected]":":checked",a;if(t.multiple)a=[].map.call(t.querySelectorAll(o),yp);else{var l=t.querySelector(o)??t.querySelector("option:not([disabled])");a=l&&yp(l)}n(a),cn!==null&&r.add(cn)}),Pm(()=>{var s=e();if(t===document.activeElement){var o=pp??cn;if(r.has(o))return}if(_0(t,s,i),i&&s===void 0){var a=t.querySelector(":checked");a!==null&&(s=yp(a),n(s))}t.__value=s,i=!1}),cM(t)}function yp(t){return"__value"in t?t.__value:t.value}const Ah=Symbol("class"),Ph=Symbol("style"),uM=Symbol("is custom element"),dM=Symbol("is html");function fM(t,e){var n=Db(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function W9(t,e){var n=Db(t);n.checked!==(n.checked=e??void 0)&&(t.checked=e)}function j9(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function fn(t,e,n,r){var i=Db(t);i[e]!==(i[e]=n)&&(e==="loading"&&(t[x7]=n),n==null?t.removeAttribute(e):typeof n!="string"&&hM(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function q9(t,e,n,r,i=!1,s=!1){var o=Db(t),a=o[uM],l=!o[dM],c=e||{},u=t.tagName==="OPTION";for(var d in e)d in n||(n[d]=null);n.class?n.class=lM(n.class):(r||n[Ah])&&(n.class=null),n[Ph]&&(n.style??=null);var f=hM(t);for(const x in n){let C=n[x];if(u&&x==="value"&&C==null){t.value=t.__value="",c[x]=C;continue}if(x==="class"){var h=t.namespaceURI==="http://www.w3.org/1999/xhtml";Qo(t,h,C,r,e?.[Ah],n[Ah]),c[x]=C,c[Ah]=n[Ah];continue}if(x==="style"){lc(t,C,e?.[Ph],n[Ph]),c[x]=C,c[Ph]=n[Ph];continue}var p=c[x];if(!(C===p&&!(C===void 0&&t.hasAttribute(x)))){c[x]=C;var m=x[0]+x[1];if(m!=="$$")if(m==="on"){const P={},S="$$"+x;let _=x.slice(2);var g=A9(_);if(C9(_)&&(_=_.slice(0,-7),P.capture=!0),!g&&p){if(C!=null)continue;t.removeEventListener(_,c[S],P),c[S]=null}if(C!=null)if(g)t[`__${_}`]=C,Mi([_]);else{let k=function(T){c[x].call(this,T)};c[S]=mk(_,t,k,P)}else g&&(t[`__${_}`]=void 0)}else if(x==="style")fn(t,x,C);else if(x==="autofocus")h9(t,!!C);else if(!a&&(x==="__value"||x==="value"&&C!=null))t.value=t.__value=C;else if(x==="selected"&&u)j9(t,C);else{var y=x;l||(y=I9(y));var b=y==="defaultValue"||y==="defaultChecked";if(C==null&&!a&&!b)if(o[x]=null,y==="value"||y==="checked"){let P=t;const S=e===void 0;if(y==="value"){let _=P.defaultValue;P.removeAttribute(y),P.defaultValue=_,P.value=P.__value=S?_:null}else{let _=P.defaultChecked;P.removeAttribute(y),P.defaultChecked=_,P.checked=S?_:!1}}else t.removeAttribute(x);else b||f.includes(y)&&(a||typeof C!="string")?(t[y]=C,y in o&&(o[y]=br)):typeof C!="function"&&fn(t,y,C)}}}return c}function kr(t,e,n=[],r=[],i=[],s,o=!1,a=!1){N4(i,n,r,l=>{var c=void 0,u={},d=t.nodeName==="SELECT",f=!1;if(q4(()=>{var p=e(...l.map(E)),m=q9(t,c,p,s,o,a);f&&d&&"value"in p&&_0(t,p.value);for(let y of Object.getOwnPropertySymbols(u))p[y]||_r(u[y]);for(let y of Object.getOwnPropertySymbols(p)){var g=p[y];y.description===S4&&(!c||g!==c[y])&&(u[y]&&_r(u[y]),u[y]=Hi(()=>z9(t,()=>g))),m[y]=g}c=m}),d){var h=t;Pm(()=>{_0(h,c.value,!0),cM(h)})}f=!0})}function Db(t){return t.__attributes??={[uM]:t.nodeName.includes("-"),[dM]:t.namespaceURI===H7}}var Z_=new Map;function hM(t){var e=t.getAttribute("is")||t.nodeName,n=Z_.get(e);if(n)return n;Z_.set(e,n=[]);for(var r,i=t,s=Element.prototype;s!==i;){r=p4(i);for(var o in r)r[o].set&&n.push(o);i=Pb(i)}return n}function K9(t,e,n=e){var r=new WeakSet;fk(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=Cv(t)?_v(s):s,n(s),cn!==null&&r.add(cn),await Dc(),s!==(s=e())){var o=t.selectionStart,a=t.selectionEnd,l=t.value.length;if(t.value=s??"",a!==null){var c=t.value.length;o===a&&a===l&&c>l?(t.selectionStart=c,t.selectionEnd=c):(t.selectionStart=o,t.selectionEnd=Math.min(a,c))}}}),ps(e)==null&&t.value&&(n(Cv(t)?_v(t.value):t.value),cn!==null&&r.add(cn)),Im(()=>{var i=e();if(t===document.activeElement){var s=pp??cn;if(r.has(s))return}Cv(t)&&i===_v(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function G9(t,e,n=e){fk(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),ps(e)==null&&n(t.checked),Im(()=>{var r=e();t.checked=!!r})}function Cv(t){var e=t.type;return e==="number"||e==="range"}function _v(t){return t===""?null:+t}function X_(t,e){return t===e||t?.[qo]===e}function Ar(t={},e,n,r){return Pm(()=>{var i,s;return Im(()=>{i=s,s=[],ps(()=>{t!==n(...s)&&(e(t,...s),i&&X_(n(...i),t)&&e(null,...i))})}),()=>{pd(()=>{s&&X_(n(...s),t)&&e(null,...s)})}}),t}function gk(t,e,n){if(t==null)return e(void 0),n&&n(void 0),Bt;const r=ps(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const Pd=[];function pM(t,e){return{subscribe:io(t,e).subscribe}}function io(t,e=Bt){let n=null;const r=new Set;function i(a){if(lk(t,a)&&(t=a,n)){const l=!Pd.length;for(const c of r)c[1](),Pd.push(c,t);if(l){for(let c=0;c<Pd.length;c+=2)Pd[c][0](Pd[c+1]);Pd.length=0}}}function s(a){i(a(t))}function o(a,l=Bt){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,s)||Bt),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function Ja(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return pM(n,(o,a)=>{let l=!1;const c=[];let u=0,d=Bt;const f=()=>{if(u)return;d();const p=e(r?c[0]:c,o,a);s?o(p):d=typeof p=="function"?p:Bt},h=i.map((p,m)=>gk(p,g=>{c[m]=g,u&=~(1<<m),l&&f()},()=>{u|=1<<m}));return l=!0,f(),function(){g4(h),d(),l=!1}})}function xc(t){let e;return gk(t,n=>e=n)(),e}let kg=!1,Q2=Symbol();function Qn(t,e,n){const r=n[e]??={store:null,source:F4(void 0),unsubscribe:Bt};if(r.store!==t&&!(Q2 in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=Bt;else{var i=!0;r.unsubscribe=gk(t,s=>{i?r.source.v=s:Q(r.source,s)}),i=!1}return t&&Q2 in n?xc(t):E(r.source)}function ei(){const t={};function e(){Am(()=>{for(var n in t)t[n].unsubscribe();h4(t,Q2,{enumerable:!1,value:!0})})}return[t,e]}function Z9(t){var e=kg;try{return kg=!1,[t(),kg]}finally{kg=e}}const X9={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function Ni(t,e,n){return new Proxy({props:t,exclude:e},X9)}const Q9={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(_h(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let i=t.props[r];_h(i)&&(i=i());const s=bc(i,e);if(s&&s.set)return s.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(_h(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const i=bc(r,e);return i&&!i.configurable&&(i.configurable=!0),i}}},has(t,e){if(e===qo||e===v4)return!1;for(let n of t.props)if(_h(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(_h(n)&&(n=n()),!!n){for(const r in n)e.includes(r)||e.push(r);for(const r of Object.getOwnPropertySymbols(n))e.includes(r)||e.push(r)}return e}};function qn(...t){return new Proxy({props:t},Q9)}function ce(t,e,n,r){var i=(n&F7)!==0,s=(n&$7)!==0,o=r,a=!0,l=()=>(a&&(a=!1,o=s?ps(r):r),o),c;if(i){var u=qo in t||v4 in t;c=bc(t,e)?.set??(u&&e in t?b=>t[e]=b:void 0)}var d,f=!1;i?[d,f]=Z9(()=>t[e]):d=t[e],d===void 0&&r!==void 0&&(d=l(),c&&(_7(),c(d)));var h;if(h=()=>{var b=t[e];return b===void 0?l():(a=!0,b)},(n&B7)===0)return h;if(c){var p=t.$$legacy;return(function(b,x){return arguments.length>0?((!x||p||f)&&c(x?h():b),b):h()})}var m=!1,g=((n&L7)!==0?Mb:R4)(()=>(m=!1,h()));i&&E(g);var y=hn;return(function(b,x){if(arguments.length>0){const C=x?E(g):i?Zt(b):b;return Q(g,C),m=!0,o!==void 0&&(o=C),b}return Rc&&m||(y.f&Xa)!==0?g.v:E(g)})}function Vs(t){Xr===null&&ak(),nt(()=>{const e=ps(t);if(typeof e=="function")return e})}function _f(t){Xr===null&&ak(),Vs(()=>()=>ps(t))}const Y9="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Y9);var J9=Object.defineProperty,eH=(t,e,n)=>e in t?J9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ct=(t,e,n)=>(eH(t,typeof e!="symbol"?e+"":e,n),n);let Nm=class extends Error{},Q_=class extends Nm{constructor(e){super(`RxNostrWebSocketError: WebSocket was closed with code ${e} by relay.`),this.code=e,this.name="RxNostrWebSocketError"}},r0=class extends Nm{constructor(e){super(`RxNostrInvalidUsageError: ${e}`),this.name="RxNostrInvalidUsageError"}},Av=class extends Nm{constructor(e){super(`RxNostrEnvironmentError: ${e}`),this.name="RxNostrEnvironmentError"}},mM=class extends Nm{constructor(){super("RxNostrLogicError: This is rx-nostr's internal bug. Please report to the author of the library."),this.name="RxNostrLogicError"}},_a=class extends Nm{constructor(){super("RxNostrAlreadyDisposedError: Attempted to access a disposed resource."),this.name="RxNostrAlreadyDisposedError"}};const Rm=(t,e)=>({...e,...t});function tH(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function Pv(t){throw t}function nH(t){return{async signEvent(e){var n,r;const i={...e,pubkey:e.pubkey??await((n=window?.nostr)==null?void 0:n.getPublicKey())??Pv(new Av("window.nostr.getPublicKey() is not found")),tags:[...e.tags??[]],created_at:e.created_at??Math.floor(Date.now()/1e3)};return tH(i)?i:await((r=window?.nostr)==null?void 0:r.signEvent(i))??Pv(new Av("window.nostr.signEvent() is not found"))},getPublicKey(){var e;return((e=window?.nostr)==null?void 0:e.getPublicKey())??Pv(new Av("window.nostr.getPublicKey() is not found"))}}}const rH=t=>Rm(t,{signer:nH(),connectionStrategy:"lazy",retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},disconnectTimeout:1e4,eoseTimeout:30*1e3,okTimeout:30*1e3,authTimeout:30*1e3,skipVerify:!1,skipValidateFilterMatching:!1,skipExpirationCheck:!1,skipFetchNip11:!1});function iH(t){return"length"in t?t.map(Y_):[Y_(t)]}function Y_(t){return{...t,since:t.since?J_(t.since):void 0,until:t.until?J_(t.until):void 0}}function J_(t){return typeof t=="number"?t:t()}async function sH(t){try{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws(s?):/,"http$1:"),await(await fetch(e.toString(),{headers:{Accept:"application/nostr+json"}})).json()}catch{return{}}}function eA(t,e){try{return t()}catch(n){return e instanceof Function?e(n):e}}function Na(t){let e="";try{e=t.trim();const n=new URL(e);n.hash="",n.pathname=eA(()=>decodeURI(n.pathname),n.pathname),n.pathname=n.pathname.replace(/\/$/,""),n.hostname=n.hostname.replace(/\.$/,""),n.searchParams.sort(),n.search=eA(()=>decodeURIComponent(n.search),n.search);let r=n.toString();return n.search||(r=r.replace(/\/$/,"")),r}catch{return e}}let i0=class gM extends Map{constructor(e){if(super(),!!e)for(const[n,r]of Object.entries(e))this.set(Na(n),r)}get(e){return super.get(Na(e))}getMany(e){const n=[];for(const r of new Set(e.map(Na))){const i=this.get(r);i!==void 0&&n.push(i)}return n}set(e,n){return super.set(Na(e),n)}has(e){return super.has(Na(e))}delete(e){return super.delete(Na(e))}toObject(){const e={};for(const[n,r]of this.entries())e[n]=r;return e}toKeys(){return[...super.keys()]}toValues(){return[...super.values()]}copy(){return new gM(this.toObject())}},A0=class{static async getValue(e,n,r){if(!(r!=null&&r.skipCache)){const i=await this.cache.get(e);if(i)return n(i)}if(!(r!=null&&r.skipFetch)){const i=await this.fetch(e);if(i)return n(i)}return n(this.default)}static get(e){const n=this.cache.get(e);if(n&&!(n instanceof Promise))return n}static async fetch(e){const n=sH(e);return this.cache.set(e,n),n.then(r=>{this.cache.set(e,r)}),n}static async getOrFetch(e){return this.cache.get(e)??this.fetch(e)}static set(e,n){this.cache.set(e,n)}static getDefault(){return this.default}static setDefault(e){this.default=e}static forget(e){this.cache.delete(e)}static forgetAll(){this.cache.clear()}};ct(A0,"cache",new i0),ct(A0,"default",{});new Uint8Array(new Uint32Array([287454020]).buffer)[0];function oH(t,e,n){return Array.isArray(e)?e.some(r=>tA(t,r)):tA(t,e)}function tA(t,e,n){const{sinceInclusive:r,untilInclusive:i}=Rm({},{sinceInclusive:!0,untilInclusive:!0});if(e.ids&&e.ids.every(s=>!t.id.startsWith(s))||e.kinds&&!e.kinds.includes(t.kind)||e.authors&&e.authors.every(s=>!t.pubkey.startsWith(s))||e.since&&(r&&!(e.since<=t.created_at)||!r&&!(e.since<t.created_at))||e.until&&(i&&!(t.created_at<=e.until)||!i&&!(t.created_at<e.until)))return!1;for(const[s,o]of Object.entries(e)){if(!s.startsWith("#")||!Array.isArray(o))continue;const a=s.slice(1);if(!t.tags.find(([l,c])=>a===l&&o.includes(c)))return!1}return!0}function aH(t,e){const n=t.tags.find(r=>r[0]==="expiration");if(!n)return!1;try{const r=Number(n[1]);return Number.isInteger(r)?r<=(e??Math.floor(Date.now()/1e3)):!1}catch{return!1}}var Y2=function(t,e){return Y2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Y2(t,e)};function pl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Y2(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function lH(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}function yM(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Af(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pf(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function If(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function uf(t){return this instanceof uf?(this.v=t,this):new uf(t)}function cH(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(h){return new Promise(function(p,m){s.push([f,h,p,m])>1||a(f,h)})})}function a(f,h){try{l(r[f](h))}catch(p){d(s[0][3],p)}}function l(f){f.value instanceof uf?Promise.resolve(f.value.v).then(c,u):d(s[0][2],f)}function c(f){a("next",f)}function u(f){a("throw",f)}function d(f,h){f(h),s.shift(),s.length&&a(s[0][0],s[0][1])}}function uH(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Af=="function"?Af(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function sr(t){return typeof t=="function"}function Lb(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Iv=Lb(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function P0(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Dm=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Af(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(m){e={error:m}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(sr(u))try{u()}catch(m){s=m instanceof Iv?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Af(d),h=f.next();!h.done;h=f.next()){var p=h.value;try{nA(p)}catch(m){s=s??[],m instanceof Iv?s=If(If([],Pf(s)),Pf(m.errors)):s.push(m)}}}catch(m){r={error:m}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(s)throw new Iv(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)nA(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&P0(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&P0(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),bM=Dm.EMPTY;function wM(t){return t instanceof Dm||t&&"closed"in t&&sr(t.remove)&&sr(t.add)&&sr(t.unsubscribe)}function nA(t){sr(t)?t():t.unsubscribe()}var dH={Promise:void 0},fH={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,If([t,e],Pf(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function vM(t){fH.setTimeout(function(){throw t})}function J2(){}function s0(t){t()}var yk=(function(t){pl(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,wM(n)&&n.add(r)):r.destination=mH,r}return e.create=function(n,r,i){return new I0(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Dm),hH=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Eg(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Eg(r)}else Eg(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Eg(n)}},t})(),I0=(function(t){pl(e,t);function e(n,r,i){var s=t.call(this)||this,o;return sr(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new hH(o),s}return e})(yk);function Eg(t){vM(t)}function pH(t){throw t}var mH={closed:!0,next:J2,error:pH,complete:J2},bk=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function ml(t){return t}function gH(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xM(t)}function xM(t){return t.length===0?ml:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var Yi=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=bH(e)?e:new I0(e,n,r);return s0(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=rA(n),new n(function(i,s){var o=new I0({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[bk]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return xM(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=rA(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function rA(t){var e;return(e=t??dH.Promise)!==null&&e!==void 0?e:Promise}function yH(t){return t&&sr(t.next)&&sr(t.error)&&sr(t.complete)}function bH(t){return t&&t instanceof yk||yH(t)&&wM(t)}function wH(t){return sr(t?.lift)}function mi(t){return function(e){if(wH(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Yr(t,e,n,r,i){return new vH(t,e,n,r,i)}var vH=(function(t){pl(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(yk),xH=Lb(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Zn=(function(t){pl(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new iA(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new xH},e.prototype.next=function(n){var r=this;s0(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Af(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;s0(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;s0(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?bM:(this.currentObservers=null,a.push(n),new Dm(function(){r.currentObservers=null,P0(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Yi;return n.source=this,n},e.create=function(n,r){return new iA(n,r)},e})(Yi),iA=(function(t){pl(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:bM},e})(Zn),SH=(function(t){pl(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(Zn),kH={now:function(){return Date.now()}},EH=(function(t){pl(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(Dm),ex={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=ex.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,If([t,e],Pf(n))):setInterval.apply(void 0,If([t,e],Pf(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},TH=(function(t){pl(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),ex.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&ex.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,P0(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(EH),sA=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=kH.now,t})(),CH=(function(t){pl(e,t);function e(n,r){r===void 0&&(r=sA.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(sA),SM=new CH(TH),_H=SM,Lm=new Yi(function(t){return t.complete()});function AH(t){return t&&sr(t.schedule)}function wk(t){return t[t.length-1]}function PH(t){return sr(wk(t))?t.pop():void 0}function vk(t){return AH(wk(t))?t.pop():void 0}function IH(t,e){return typeof wk(t)=="number"?t.pop():e}var kM=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function EM(t){return sr(t?.then)}function TM(t){return sr(t[bk])}function CM(t){return Symbol.asyncIterator&&sr(t?.[Symbol.asyncIterator])}function _M(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function OH(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var AM=OH();function PM(t){return sr(t?.[AM])}function IM(t){return cH(this,arguments,function(){var e,n,r,i;return yM(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,uf(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,uf(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,uf(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function OM(t){return sr(t?.getReader)}function oa(t){if(t instanceof Yi)return t;if(t!=null){if(TM(t))return MH(t);if(kM(t))return NH(t);if(EM(t))return RH(t);if(CM(t))return MM(t);if(PM(t))return DH(t);if(OM(t))return LH(t)}throw _M(t)}function MH(t){return new Yi(function(e){var n=t[bk]();if(sr(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function NH(t){return new Yi(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function RH(t){return new Yi(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,vM)})}function DH(t){return new Yi(function(e){var n,r;try{for(var i=Af(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function MM(t){return new Yi(function(e){BH(t,e).catch(function(n){return e.error(n)})})}function LH(t){return MM(IM(t))}function BH(t,e){var n,r,i,s;return lH(this,void 0,void 0,function(){var o,a;return yM(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=uH(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Go(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function NM(t,e){return e===void 0&&(e=0),mi(function(n,r){n.subscribe(Yr(r,function(i){return Go(r,t,function(){return r.next(i)},e)},function(){return Go(r,t,function(){return r.complete()},e)},function(i){return Go(r,t,function(){return r.error(i)},e)}))})}function RM(t,e){return e===void 0&&(e=0),mi(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function FH(t,e){return oa(t).pipe(RM(e),NM(e))}function $H(t,e){return oa(t).pipe(RM(e),NM(e))}function zH(t,e){return new Yi(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function UH(t,e){return new Yi(function(n){var r;return Go(n,e,function(){r=t[AM](),Go(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return sr(r?.return)&&r.return()}})}function DM(t,e){if(!t)throw new Error("Iterable cannot be null");return new Yi(function(n){Go(n,e,function(){var r=t[Symbol.asyncIterator]();Go(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function HH(t,e){return DM(IM(t),e)}function VH(t,e){if(t!=null){if(TM(t))return FH(t,e);if(kM(t))return zH(t,e);if(EM(t))return $H(t,e);if(CM(t))return DM(t,e);if(PM(t))return UH(t,e);if(OM(t))return HH(t,e)}throw _M(t)}function Bm(t,e){return e?VH(t,e):oa(t)}function LM(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=vk(t);return Bm(t,n)}var xk=Lb(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function BM(t,e){return new Promise(function(n,r){var i=new I0({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new xk)}});t.subscribe(i)})}function FM(t){return t instanceof Date&&!isNaN(t)}var $M=Lb(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function zM(t,e){var n=FM(t)?{first:t}:typeof t=="number"?{each:t}:t,r=n.first,i=n.each,s=n.with,o=s===void 0?WH:s,a=n.scheduler,l=a===void 0?SM:a,c=n.meta,u=c===void 0?null:c;if(r==null&&i==null)throw new TypeError("No timeout provided.");return mi(function(d,f){var h,p,m=null,g=0,y=function(b){p=Go(f,l,function(){try{h.unsubscribe(),oa(o({meta:u,lastValue:m,seen:g})).subscribe(f)}catch(x){f.error(x)}},b)};h=d.subscribe(Yr(f,function(b){p?.unsubscribe(),g++,f.next(m=b),i>0&&y(i)},void 0,void 0,function(){p!=null&&p.closed||p==null||p.unsubscribe(),m=null})),!g&&y(r!=null?typeof r=="number"?r:+r-l.now():i)})}function WH(t){throw new $M(t)}function Sc(t,e){return mi(function(n,r){var i=0;n.subscribe(Yr(r,function(s){r.next(t.call(e,s,i++))}))})}var jH=Array.isArray;function qH(t,e){return jH(e)?t.apply(void 0,If([],Pf(e))):t(e)}function KH(t){return Sc(function(e){return qH(t,e)})}var GH=Array.isArray,ZH=Object.getPrototypeOf,XH=Object.prototype,QH=Object.keys;function YH(t){if(t.length===1){var e=t[0];if(GH(e))return{args:e,keys:null};if(JH(e)){var n=QH(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function JH(t){return t&&typeof t=="object"&&ZH(t)===XH}function eV(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function tV(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=vk(t),r=PH(t),i=YH(t),s=i.args,o=i.keys;if(s.length===0)return Bm([],n);var a=new Yi(nV(s,n,o?function(l){return eV(o,l)}:ml));return r?a.pipe(KH(r)):a}function nV(t,e,n){return n===void 0&&(n=ml),function(r){oA(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(u){oA(e,function(){var d=Bm(t[u],e),f=!1;d.subscribe(Yr(r,function(h){s[u]=h,f||(f=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function oA(t,e,n){t?Go(n,t,e):e()}function rV(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,d=!1,f=function(){d&&!l.length&&!c&&e.complete()},h=function(m){return c<r?p(m):l.push(m)},p=function(m){c++;var g=!1;oa(n(m,u++)).subscribe(Yr(e,function(y){e.next(y)},function(){g=!0},void 0,function(){if(g)try{c--;for(var y=function(){var b=l.shift();o?Go(e,o,function(){return p(b)}):p(b)};l.length&&c<r;)y();f()}catch(b){e.error(b)}}))};return t.subscribe(Yr(e,h,function(){d=!0,f()})),function(){}}function O0(t,e,n){return n===void 0&&(n=1/0),sr(e)?O0(function(r,i){return Sc(function(s,o){return e(r,s,i,o)})(oa(t(r,i)))},n):(typeof e=="number"&&(n=e),mi(function(r,i){return rV(r,i,t,n)}))}function UM(t){return t===void 0&&(t=1/0),O0(ml,t)}function aA(t,e,n){return t===void 0&&(t=0),n===void 0&&(n=_H),new Yi(function(r){var i=FM(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){r.closed||(r.next(s++),r.complete())},i)})}function iV(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=vk(t),r=IH(t,1/0),i=t;return i.length?i.length===1?oa(i[0]):UM(r)(Bm(i,n)):Lm}function Ms(t,e){return mi(function(n,r){var i=0;n.subscribe(Yr(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function HM(t){return mi(function(e,n){var r=null,i=!1,s;r=e.subscribe(Yr(n,void 0,void 0,function(o){s=oa(t(o,HM(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function sV(t){return mi(function(e,n){var r=!1;e.subscribe(Yr(n,function(i){r=!0,n.next(i)},function(){r||n.next(t),n.complete()}))})}function oV(t){return t<=0?function(){return Lm}:mi(function(e,n){var r=0;e.subscribe(Yr(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function aV(t,e){return e===void 0&&(e=ml),t=t??lV,mi(function(n,r){var i,s=!0;n.subscribe(Yr(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function lV(t,e){return t===e}function cV(t){return t===void 0&&(t=uV),mi(function(e,n){var r=!1;e.subscribe(Yr(n,function(i){r=!0,n.next(i)},function(){return r?n.complete():n.error(t())}))})}function uV(){return new xk}function Ov(t){return mi(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function tx(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?Ms(function(i,s){return t(i,s,r)}):ml,oV(1),n?sV(e):cV(function(){return new xk}))}}function dV(t,e){return mi(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Yr(r,function(l){i?.unsubscribe();var c=0,u=s++;oa(t(l,u)).subscribe(i=Yr(r,function(d){return r.next(e?e(l,d,u,c++):d)},function(){i=null,a()}))},function(){o=!0,a()}))})}function fV(){return dV(ml)}function Ih(t){return mi(function(e,n){oa(t).subscribe(Yr(n,function(){return n.complete()},J2)),!n.closed&&e.subscribe(n)})}function hV(t,e){return mi(function(n,r){var i=0;n.subscribe(Yr(r,function(s){var o=t(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function Tg(t,e,n){var r=sr(t)||e||n?{next:t,error:e,complete:n}:t;return r?mi(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Yr(s,function(l){var c;(c=r.next)===null||c===void 0||c.call(r,l),s.next(l)},function(){var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),s.complete()},function(l){var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),s.error(l)},function(){var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):ml}function pV(t){return O0((e,n)=>Bm(t(e,n)).pipe(O0(r=>r?LM(e):Lm)))}function lA(t){return gH(zM(t),HM(e=>{if(e instanceof $M)return Lm;throw e}))}function Mv(t,e){const{not:n}=Rm(e,{not:!1});return Ms(r=>mV(r.subId===t,n))}function mV(t,e){return!t&&e||t&&!e}let gV=class{constructor(e){ct(this,"relay"),ct(this,"config"),ct(this,"authenticator"),ct(this,"ongoings",new Set),ct(this,"authResult$",new Zn),ct(this,"disposed",!1),this.relay=e.relay,this.config=e.config,this.authenticator=e.authenticator;const n=this.relay.getOKObservable().subscribe(i=>{const{eventId:s,ok:o}=i;this.ongoings.has(s)&&(this.ongoings.delete(s),this.authResult$.next(o),o||(n.unsubscribe(),r.unsubscribe()))}),r=this.relay.getAUTHObservable().subscribe(({challenge:i})=>{this.challenge(i)})}getAuthResultObservable(){return this.authResult$.asObservable()}async challenge(e){try{const n=await this.signer.signEvent({kind:22242,content:"",tags:[["relay",this.relay.url],["challenge",e]]});this.ongoings.add(n.id),this.relay.send(["AUTH",n])}catch{this.authResult$.next(!1)}}get signer(){return this.authenticator.signer??this.config.signer}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.authResult$];for(const n of e)n.complete()}},VM=class extends SH{constructor(e){super(e??0)}increment(){this.next(this.getValue()+1)}decrement(){this.next(this.getValue()-1)}next(e){typeof e=="number"?super.next(e):super.next(e(this.getValue()))}},yV=class extends Zn{waitNext(){return BM(this.pipe(tx(null,void 0)))}},bV=class{constructor(e){ct(this,"relay"),ct(this,"authProxy"),ct(this,"pubs",new Map),ct(this,"authRequiredPubs",new Set),ct(this,"count$",new VM(0)),ct(this,"ok$",new Zn),ct(this,"disposed",!1);var n;this.relay=e.relay,this.authProxy=e.authProxy,this.relay.getReconnectedObservable().subscribe(r=>{for(const[i,s]of r)i==="EVENT"&&this.pubs.has(s.id)&&this.sendEVENT(s)}),this.relay.getOKObservable().subscribe(async r=>{const{eventId:i,notice:s}=r;this.pubs.get(i)&&(this.authProxy&&s!=null&&s.startsWith("auth-required:")?(this.authRequiredPubs.add(i),this.ok$.next({...r,done:!1})):(this.ok$.next({...r,done:!0}),this.confirmOK(i)))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{if(r)for(const i of this.authRequiredPubs){const s=this.pubs.get(i);s&&this.sendEVENT(s)}else for(const i of this.authRequiredPubs)this.confirmOK(i);this.authRequiredPubs.clear()})}async publish(e){if(!this.disposed)return this.pubs.has(e.id)||(this.pubs.set(e.id,e),this.count$.increment()),this.sendEVENT(e)}confirmOK(e){this.disposed||this.pubs.has(e)||(this.pubs.delete(e),this.count$.decrement())}getOkAgainstEventObservable(){return this.ok$.asObservable()}getLogicalConnectionSizeObservable(){return this.count$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.count$,this.ok$];for(const n of e)n.complete()}sendEVENT(e){return this.relay.send(["EVENT",e])}};const cA={OPEN:1};let wV=class{constructor(e,n){ct(this,"socket",null),ct(this,"buffer",[]),ct(this,"unsent",[]),ct(this,"reconnected$",new Zn),ct(this,"outgoing$",new Zn),ct(this,"message$",new Zn),ct(this,"error$",new Zn),ct(this,"retryTimer",null),ct(this,"sendAttempted$",new yV),ct(this,"isFirstTry",!0),ct(this,"maybeDown",!1),ct(this,"disposed",!1),ct(this,"state$",new Zn),ct(this,"_state","initialized"),this.url=e,this.config=n,n.skipFetchNip11||A0.getOrFetch(e),this.setState("initialized")}get state(){return this._state}setState(e){this._state=e,this.state$.next(e)}connectManually(){this.connect()}connect(e){if(this.state==="terminated")return;const n=typeof e=="number";(this.state==="initialized"||this.state==="dormant"||this.state==="error"||this.state==="rejected"||n)&&(this.socket=this.createSocket(e??0))}createSocket(e){const n=this.isFirstTry;this.isFirstTry=!1;let r=!1;const i=e>0,s=!i&&(this.state==="error"||this.state==="rejected");i?this.setState("retrying"):this.setState("connecting");const o=async()=>{if(this.state==="terminated"){u?.close($d.RX_NOSTR_DISPOSED);return}this.setState("connected"),r=!0,e=0,(i||s)&&(this.reconnected$.next(this.unsent),this.unsent=[]);try{for(const d of this.buffer)this.send(d)}catch(d){this.error$.next(d)}finally{this.buffer=[]}},a=({data:d})=>{if(this.state!=="terminated")try{this.message$.next(this.pack(JSON.parse(d)))}catch(f){this.error$.next(f)}},l=({code:d})=>{var f;if(u?.removeEventListener("open",o),u?.removeEventListener("message",a),u?.removeEventListener("close",l),this.socket===u&&(this.socket=null),this.state==="terminated"||d===$d.RX_NOSTR_DISPOSED){this.unsent=[],this.buffer=[];return}if(d===$d.RX_NOSTR_IDLE)this.setState("dormant"),this.buffer.length>0&&this.connect();else if(d===$d.DONT_RETRY)this.unsent=[],this.buffer=[],this.error$.next(new Q_(d)),this.setState("rejected");else{n&&!r&&(this.maybeDown=!0),this.unsent.push(...this.buffer),this.buffer=[],this.error$.next(new Q_(d));const h=e+1;this.config.retry.strategy!=="off"&&!(this.config.retry.polite&&this.maybeDown)&&h<=this.config.retry.maxCount?(this.setState("waiting-for-retrying"),(f=this.retryTimer)==null||f.unsubscribe(),this.retryTimer=vV(this.config.retry,h).subscribe(()=>{this.disposed||this.connect(h)})):this.setState("error")}},c=this.config.websocketCtor??globalThis.WebSocket;if(!c)throw new r0("WebSocket constructor is missing");const u=(()=>{try{return new c(this.url)}catch{return l({code:0}),null}})();return u?.addEventListener("open",o),u?.addEventListener("message",a),u?.addEventListener("close",l),u}pack(e){const n=e[0],r=this.url;switch(n){case"EVENT":return{from:r,type:n,message:e,subId:e[1],event:e[2]};case"EOSE":return{from:r,type:n,message:e,subId:e[1]};case"OK":return{from:r,type:n,message:e,eventId:e[1],ok:e[2],notice:e[3]};case"CLOSED":return{from:r,type:n,message:e,subId:e[1],notice:e[2]};case"NOTICE":return{from:r,type:n,message:e,notice:e[1]};case"AUTH":return{from:r,type:n,message:e,challenge:e[1]};case"COUNT":return{from:r,type:n,message:e,subId:e[1],count:e[2]};default:return{from:r,type:"unknown",message:e}}}disconnect(e){var n;((n=this.socket)==null?void 0:n.readyState)===cA.OPEN&&this.socket.close(e)}send(e){const n=this.sendAttempted$.waitNext();switch(this.state){case"terminated":case"rejected":return this.sendAttempted$.next(),n;case"initialized":case"connecting":case"dormant":return this.buffer.push(e),this.connect(),n;case"connected":{if(!this.socket)throw new mM;return this.socket.readyState===cA.OPEN?(this.outgoing$.next({to:this.url,message:e}),this.socket.send(JSON.stringify(e)),this.sendAttempted$.next(),n):(this.buffer.push(e),n)}case"waiting-for-retrying":case"retrying":case"error":return this.sendAttempted$.next(),this.unsent.push(e),n}}getEVENTObservable(){return this.message$.pipe(Ms(e=>e.type==="EVENT"))}getEOSEObservable(){return this.message$.pipe(Ms(e=>e.type==="EOSE"))}getCLOSEDObservable(){return this.message$.pipe(Ms(e=>e.type==="CLOSED"))}getOKObservable(){return this.message$.pipe(Ms(e=>e.type==="OK"))}getAUTHObservable(){return this.message$.pipe(Ms(e=>e.type==="AUTH"))}getAllMessageObservable(){return this.message$.asObservable()}getOutgoingMessageObservable(){return this.outgoing$.asObservable()}getReconnectedObservable(){return this.reconnected$.asObservable()}getConnectionStateObservable(){return this.state$.pipe(aV(),Sc(e=>({from:this.url,state:e})))}getErrorObservable(){return this.error$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){var e,n;if(this.disposed)return;this.disposed=!0,this.setState("terminated"),(e=this.retryTimer)==null||e.unsubscribe(),(n=this.socket)==null||n.close($d.RX_NOSTR_DISPOSED),this.socket=null;const r=[this.state$,this.outgoing$,this.message$,this.error$,this.reconnected$,this.sendAttempted$];for(const i of r)i.complete()}};function vV(t,e){switch(t.strategy){case"exponential":{const n=Math.max(t.initialDelay*2**(e-1)+(Math.random()-.5)*1e3,1e3);return aA(n)}case"immediately":return LM(0);case"linear":return aA(t.interval);case"off":return Lm}}const $d={DONT_RETRY:4e3,RX_NOSTR_IDLE:4537,RX_NOSTR_DISPOSED:4538};let xV=class{constructor(e){ct(this,"relay"),ct(this,"authProxy"),ct(this,"config"),ct(this,"subs",new Map),ct(this,"authRequiredSubs",new Set),ct(this,"fin$",new Zn),ct(this,"disposed",!1),ct(this,"queue");var n;this.relay=e.relay,this.authProxy=e.authProxy,this.config=e.config,this.queue=new SV(this.relay.url,this.config),this.queue.getActivationObservable().subscribe(r=>{for(const{req:i}of r)this.sendREQ(i)}),this.relay.getReconnectedObservable().subscribe(()=>{for(const{req:r}of this.queue.ongoings)this.sendREQ(r)}),this.relay.getEOSEObservable().subscribe(({subId:r})=>{var i;(i=this.subs.get(r))!=null&&i.autoclose&&this.unsubscribe(r)}),this.relay.getCLOSEDObservable().subscribe(async({subId:r,notice:i})=>{this.subs.get(r)&&(this.authProxy&&i!=null&&i.startsWith("auth-required:")?this.authRequiredSubs.add(r):this.fin(r))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{var i;if(r)for(const s of this.authRequiredSubs){const o=(i=this.subs.get(s))==null?void 0:i.req;o&&this.sendREQ(o)}else for(const s of this.authRequiredSubs)this.fin(s);this.authRequiredSubs.clear()})}subscribe(e,n){if(this.disposed)return;const r=e[1],i={subId:r,req:e,autoclose:n};this.subs.set(r,i),this.queue.enqueue(i)}unsubscribe(e){this.disposed||(this.subs.has(e)&&this.sendCLOSE(e),this.fin(e))}isOngoingOrQueued(e){return this.subs.has(e)}getEventObservable(){return this.relay.getEVENTObservable().pipe(Ms(({subId:e,event:n})=>{var r;const i=(r=this.subs.get(e))==null?void 0:r.filters;return i?this.config.skipValidateFilterMatching||oH(n,i):!1}))}getFinObservable(){return this.fin$.asObservable()}getLogicalConnectionSizeObservable(){return this.queue.getSizeObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.fin$];for(const n of e)n.complete();this.queue.dispose()}sendREQ([,e,...n]){const r=iH(n),i=this.subs.get(e);i&&(i.filters=r,this.relay.send(["REQ",e,...r]))}sendCLOSE(e){this.relay.send(["CLOSE",e])}fin(e){this.subs.delete(e),this.queue.drop(e),this.fin$.next({from:this.relay.url,subId:e})}},SV=class{constructor(e,n){ct(this,"_queuings",[]),ct(this,"_ongoings",[]),ct(this,"activated$",new Zn),ct(this,"count$",new VM),this.url=e,this.config=n}get queuings(){return this._queuings}set queuings(e){this._queuings=e}get ongoings(){return this._ongoings}set ongoings(e){this._ongoings=e}enqueue(e){this.queuings=[...this.queuings,e],this.count$.increment(),this.shift()}drop(e){const n=(a,l)=>{const c=a.length,u=a.filter(f=>f.subId!==l),d=c-u.length;return[u,d]},[r,i]=n(this.queuings,e),[s,o]=n(this.ongoings,e);this.queuings=r,this.ongoings=s,this.count$.next(a=>a-(i+o)),this.shift()}getActivationObservable(){return this.activated$.asObservable()}getSizeObservable(){return this.count$.asObservable()}dispose(){const e=[this.activated$,this.count$];for(const n of e)n.complete()}async shift(){const e=await this.capacity(),n=[...this.ongoings,...this.queuings],r=n.slice(0,e),i=n.slice(e),s=this.queuings.slice(0,e-this.ongoings.length);this.ongoings=r,this.queuings=i,s.length>0&&this.activated$.next(s)}async capacity(){return await A0.getValue(this.url,e=>{var n;return(n=e.limitation)==null?void 0:n.max_subscriptions},{skipFetch:this.config.skipFetchNip11})??1/0}},kV=class{constructor(e,n){ct(this,"relay"),ct(this,"pubProxy"),ct(this,"subProxy"),ct(this,"defaultSubscriptionIds",new Set),ct(this,"communicating",!1),ct(this,"strategy","lazy"),ct(this,"disconnectTimeout"),ct(this,"disconnectTimer"),ct(this,"isDefaultRelay",!1),ct(this,"disposed",!1),ct(this,"_url"),this._url=Na(e);const r=EV(e,n),i=new wV(this.url,n),s=r?new gV({relay:i,config:n,authenticator:r}):null,o=new bV({relay:i,authProxy:s}),a=new xV({relay:i,authProxy:s,config:n});this.relay=i,this.pubProxy=o,this.subProxy=a,this.disconnectTimeout=n.disconnectTimeout,tV([this.pubProxy.getLogicalConnectionSizeObservable(),this.subProxy.getLogicalConnectionSizeObservable()]).pipe(Sc(([l,c])=>l+c)).subscribe(l=>{this.communicating=l>0,this.resetConnection()})}get url(){return this._url}setConnectionStrategy(e){this.disposed||(this.strategy=e,this.resetConnection())}resetConnection(){let e=this.strategy;switch(this.isDefaultRelay||(e="lazy"),e){case"lazy":{const n=()=>{this.communicating||this.relay.disconnect($d.RX_NOSTR_IDLE)};this.disconnectTimeout>0?(this.disconnectTimeout&&(clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0),this.disconnectTimer=setTimeout(n,this.disconnectTimeout)):n();break}case"lazy-keep":break;case"aggressive":{(this.connectionState==="initialized"||this.connectionState==="dormant")&&this.relay.connectManually();break}}}markAsDefault(e){if(!this.disposed){if(this.isDefaultRelay=e,!this.isDefaultRelay){for(const n of this.defaultSubscriptionIds)this.subProxy.unsubscribe(n);this.defaultSubscriptionIds.clear()}this.resetConnection()}}async publish(e){if(!this.disposed)return this.pubProxy.publish(e)}confirmOK(e){this.disposed||this.pubProxy.confirmOK(e)}subscribe(e,n){if(this.disposed)return;const{mode:r,overwrite:i,autoclose:s}=Rm(n??{},{overwrite:!1,autoclose:!1,mode:"default"}),[,o]=e;r==="default"&&!this.isDefaultRelay||!i&&this.subProxy.isOngoingOrQueued(o)||(r==="default"&&this.defaultSubscriptionIds.add(o),this.subProxy.subscribe(e,s))}unsubscribe(e){this.disposed||(this.defaultSubscriptionIds.delete(e),this.subProxy.unsubscribe(e))}getEventObservable(){if(this.disposed)throw new _a;return this.subProxy.getEventObservable()}getFinObservable(){if(this.disposed)throw new _a;return this.subProxy.getFinObservable()}getOkAgainstEventObservable(){if(this.disposed)throw new _a;return this.pubProxy.getOkAgainstEventObservable()}getAllMessageObservable(){if(this.disposed)throw new _a;return this.relay.getAllMessageObservable()}getOutgoingMessageObservable(){if(this.disposed)throw new _a;return this.relay.getOutgoingMessageObservable()}getConnectionStateObservable(){if(this.disposed)throw new _a;return this.relay.getConnectionStateObservable()}get connectionState(){return this.relay.state}getErrorObservable(){if(this.disposed)throw new _a;return this.relay.getErrorObservable().pipe(Sc(e=>({from:this.url,reason:e})))}connectManually(){this.relay.connectManually()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){this.disposed||(this.disposed=!0,this.disconnectTimer&&clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0,this.relay.dispose(),this.pubProxy.dispose(),this.subProxy.dispose())}};function EV(t,e){const n=e.authenticator;if(!n)return;const r=n instanceof Function?n(t):n;return r==="auto"?{}:r}function TV(t,e){return t.filter(n=>!e.includes(n))}function CV(t){const{rxReq:e,index:n}=t,{rxReqId:r,strategy:i}=e;return`${r}:${i==="backward"?n:0}`}function _V(t){const{rxReq:e,filters:n,index:r}=t;return["REQ",CV({rxReq:e,index:r}),...n]}function uA(t){if(Array.isArray(t)){const e=t.map(n=>{let r="",i=!1,s=!1;if(typeof n=="string")r=n,i=!0,s=!0;else if(Array.isArray(n)){const o=n[2];r=n[1],i=!o||o==="read",s=!o||o==="write"}else r=n.url,i=n.read,s=n.write;return{url:r,read:i,write:s}});return Object.fromEntries(e.map(n=>[n.url,n]))}else{const e=Object.entries(t).map(([n,r])=>({url:n,...r}));return Object.fromEntries(e.map(n=>[n.url,n]))}}function dA(t,e){const n=new Set;if(e!=null&&e.on){const r=e.on;if(!r.defaultReadRelays&&!r.defaultWriteRelays&&!r.relays)return;const i=t.getDefaultRelays();if(r.defaultReadRelays)for(const{url:s}of Object.values(i).filter(o=>o.read))n.add(s);if(r.defaultWriteRelays)for(const{url:s}of Object.values(i).filter(o=>o.write))n.add(s);if(r.relays)for(const s of r.relays)n.add(Na(s));return[...n]}else if(e!=null&&e.relays){for(const r of e.relays)n.add(Na(r));return[...n]}else return}function AV(t){return new PV(rH(t??{}))}let PV=class{constructor(e){ct(this,"connections",new i0),ct(this,"defaultRelays",new i0),ct(this,"defaultSubscriptions",new Map),ct(this,"event$",new Zn),ct(this,"fin$",new Zn),ct(this,"ok$",new Zn),ct(this,"all$",new Zn),ct(this,"error$",new Zn),ct(this,"connectionState$",new Zn),ct(this,"outgoing$",new Zn),ct(this,"dispose$",new Zn),ct(this,"disposed",!1),this.config=e}get defaultReadableConnections(){const e=[];for(const{url:n,read:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}get defaultWritableConnections(){const e=[];for(const{url:n,write:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}getDefaultRelays(){if(this.disposed)throw new _a;return this.defaultRelays.toObject()}getDefaultRelay(e){return this.defaultRelays.get(e)}setDefaultRelays(e){if(this.disposed)throw new _a;const n=new i0(uA(e)),r=[];for(const{read:i,url:s}of n.values()){const o=this.ensureNostrConnection(s);o.setConnectionStrategy(this.config.connectionStrategy),i&&r.push(o)}this.updateDefaultSubscriptions(r),this.defaultRelays=n}ensureNostrConnection(e){let n=this.connections.get(e);return n||(n=new kV(e,this.config),this.attachNostrConnection(n),this.connections.set(e,n),n)}attachNostrConnection(e){e.getEventObservable().subscribe(this.event$),e.getFinObservable().subscribe(this.fin$),e.getOkAgainstEventObservable().subscribe(this.ok$),e.getAllMessageObservable().subscribe(this.all$),e.getConnectionStateObservable().subscribe(this.connectionState$),e.getErrorObservable().subscribe(this.error$),e.getOutgoingMessageObservable().subscribe(this.outgoing$)}updateDefaultSubscriptions(e){const n=TV(this.defaultReadableConnections,e);for(const r of n)r.markAsDefault(!1);for(const r of e){r.markAsDefault(!0);for(const{req:i,autoclose:s}of this.defaultSubscriptions.values())r?.subscribe(i,{mode:"default",overwrite:!1,autoclose:s})}}addDefaultRelays(e){const n=uA(e);this.setDefaultRelays({...this.defaultRelays.toObject(),...n})}removeDefaultRelays(e){const n=this.defaultRelays.copy(),r=Array.isArray(e)?e:[e];for(const i of r)n.delete(i);this.setDefaultRelays(n.toObject())}getAllRelayStatus(){return Object.fromEntries(Array.from(this.connections.values()).map(e=>[e.url,{connection:e.connectionState}]))}getRelayStatus(e){const n=this.connections.get(e);if(n)return{connection:n.connectionState}}reconnect(e){const n=this.getDefaultRelay(e);if(!n)throw new r0(`The relay (${e}) is not a default relay. \`reconnect()\` can be used only for a readable default relay.`);if(!n.read)throw new r0(`The relay (${e}) is not readable. \`reconnect()\` can be used only for a readable default relay.`);const r=this.connections.get(e);if(!r)throw new mM;(r.connectionState==="error"||r.connectionState==="rejected")&&r.connectManually()}use(e,n){const r=dA(this,n),i=({filters:u,relays:d},f)=>{var h;const p=e.strategy==="backward"?d:void 0,m=_V({rxReq:e,filters:u,index:f});return{subId:m[1],req:m,targetConnections:((h=p??r)==null?void 0:h.map(g=>this.ensureNostrConnection(g)))??this.defaultReadableConnections,mode:p===void 0&&r===void 0?"default":"temporary"}},s=({req:u,targetConnections:d,mode:f})=>{this.startSubscription({req:u,targetConnections:d,mode:f,overwrite:e.strategy==="forward",autoclose:e.strategy==="backward"})},o=({subId:u,targetConnections:d,mode:f})=>{this.teardownSubscription({subId:u,targetConnections:d,mode:f})},a=({req:u,targetConnections:d})=>e.strategy==="forward"?this.createForwardEventObservable({req:u}).pipe(Ih(this.dispose$)):this.createBackwardEventObservable({req:u,targetConnections:d}).pipe(Ih(this.dispose$)),l=e.getReqPacketObservable().pipe(Ms(({filters:u})=>u.length>0),Sc(i),Ih(this.dispose$)),c=()=>pV(async({event:u})=>(this.config.skipVerify||await this.config.verifier(u))&&(this.config.skipExpirationCheck||!aH(u)));if(e.strategy==="forward"){let u;return l.pipe(Tg(d=>{u=d}),Tg(s),Sc(a),Ov(()=>{u&&o(u)}),fV(),c())}else return l.pipe(Tg(s),Sc(u=>a(u).pipe(Ov(()=>{o(u)}))),UM(),c())}createForwardEventObservable(e){const{req:n}=e,r=n[1];return this.event$.pipe(Mv(r))}createBackwardEventObservable(e){const{req:n,targetConnections:r}=e,i=n[1],s=new Set,o=u=>u==="error"||u==="rejected"||u==="terminated",a=()=>r.every(({connectionState:u,url:d})=>o(u)||s.has(d)),l=this.fin$.pipe(Mv(i),Tg(({from:u})=>{s.add(u)})),c=iV(l,this.connectionState$.asObservable()).pipe(Ms(()=>a()),tx(null,void 0));return this.event$.pipe(Ih(c),lA(this.config.eoseTimeout),Mv(i),Ms(u=>!s.has(u.from)))}startSubscription(e){const{req:n,targetConnections:r,mode:i,overwrite:s,autoclose:o}=e,a=n[1];i==="default"&&this.defaultSubscriptions.set(a,{req:n,autoclose:o});for(const l of r)l.subscribe(n,{mode:i,overwrite:s,autoclose:o})}teardownSubscription(e){const{subId:n,targetConnections:r,mode:i}=e;i==="default"&&this.defaultSubscriptions.delete(n);for(const s of r)s.unsubscribe(n)}createAllEventObservable(){return this.event$.asObservable()}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.all$.asObservable()}createConnectionStateObservable(){return this.connectionState$.asObservable()}createOutgoingMessageObservable(){return this.outgoing$.asObservable()}send(e,n){const{signer:r,errorOnTimeout:i,completeOn:s}=Rm(n??{},{signer:this.config.signer,errorOnTimeout:!1,completeOn:"all-ok"}),o=dA(this,n),a=o===void 0?this.defaultWritableConnections:o.map(h=>this.ensureNostrConnection(h)),l=new Zn,c=new Set;let u="";const d=()=>{l.closed||l.complete();for(const h of a)h.confirmOK(u)};r.signEvent(e).then(async h=>{l.closed||(u=h.id,this.ok$.pipe(Ms(({eventId:p})=>p===h.id)).subscribe(l),await Promise.all(a.map(p=>p.publish(h))),s==="sent"&&l.complete())}).catch(h=>{throw d(),new r0(h instanceof Error?h.message:"Failed to sign the given event")});const f=(()=>{switch(s){case"sent":return ml;case"all-ok":return hV(({from:h,done:p})=>(p&&c.add(h),c.size<a.length),!0);case"any-ok":return tx(h=>h.ok)}})();return l.pipe(f,Ih(this.dispose$),i?zM(this.config.okTimeout):lA(this.config.okTimeout),Ov(d))}async cast(e,n){await BM(this.send(e,{...n,completeOn:"sent"}))}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;for(const n of this.connections.values())n.dispose();this.connections.clear();const e=[this.event$,this.ok$,this.fin$,this.all$,this.connectionState$,this.error$,this.outgoing$];for(const n of e)n.complete();this.dispose$.next(),this.dispose$.complete()}};const WM=t=>{const{strategy:e}=t,n=t.operators??[],r=t.rxReqId??IV(),i=t.subject??new Zn;return{strategy:e,rxReqId:r,getReqPacketObservable(){return i.pipe(...n)},pipe(...s){return WM({strategy:e,rxReqId:r,operators:[...n,...s],subject:i})},emit(s,o){i.next({filters:MV(s),...o??{}})},over(){i.complete()}}};function M0(t){return WM({strategy:"backward",rxReqId:t})}function IV(){return`${Math.floor(Math.random()*1e6)}`}function OV(t){var e,n;const r={},i=s=>/^#[a-zA-Z]$/.test(s);for(const s of Object.keys(t)){if(s==="limit"&&(t[s]??-1)>=0){r[s]=t[s];continue}if(s==="since"||s==="until"){const o=t[s];if(typeof o!="number"||(o??-1)>=0){r[s]=o;continue}}if((i(s)||s==="ids"||s==="authors")&&t[s]!==void 0&&(((e=t[s])==null?void 0:e.length)??-1)>0){r[s]=t[s];continue}if(s==="kinds"&&t[s]!==void 0&&(((n=t[s])==null?void 0:n.length)??-1)>0){r[s]=t[s];continue}if(s==="search"&&t[s]!==void 0){r[s]=t[s];continue}}return typeof r.since!="number"||typeof r.until!="number"||r.since<=r.until?r:null}function MV(t){return(Array.isArray(t)?t:[t]).map(e=>OV(e)).filter(e=>e!==null)}function fA(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function NV(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Fm(t,...e){if(!NV(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function RV(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");fA(t.outputLen),fA(t.blockLen)}function N0(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function DV(t,e){Fm(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Nv=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Rv=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),bo=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const LV=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function R0(t){Fm(t);let e="";for(let n=0;n<t.length;n++)e+=LV[t[n]];return e}function BV(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Sk(t){return typeof t=="string"&&(t=BV(t)),Fm(t),t}function FV(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Fm(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}let jM=class{clone(){return this._cloneInto()}};function $V(t){const e=r=>t().update(Sk(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function qM(t=32){if(Nv&&typeof Nv.getRandomValues=="function")return Nv.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function zV(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const UV=(t,e,n)=>t&e^~t&n,HV=(t,e,n)=>t&e^t&n^e&n;let VV=class extends jM{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Rv(this.buffer)}update(e){N0(this);const{view:n,buffer:r,blockLen:i}=this;e=Sk(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=Rv(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){N0(this),DV(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;zV(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Rv(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const WV=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ll=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Bl=new Uint32Array(64);let jV=class extends VV{constructor(){super(64,32,8,!1),this.A=Ll[0]|0,this.B=Ll[1]|0,this.C=Ll[2]|0,this.D=Ll[3]|0,this.E=Ll[4]|0,this.F=Ll[5]|0,this.G=Ll[6]|0,this.H=Ll[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)Bl[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=Bl[d-15],h=Bl[d-2],p=bo(f,7)^bo(f,18)^f>>>3,m=bo(h,17)^bo(h,19)^h>>>10;Bl[d]=m+Bl[d-7]+p+Bl[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=bo(a,6)^bo(a,11)^bo(a,25),h=u+f+UV(a,l,c)+WV[d]+Bl[d]|0,p=(bo(r,2)^bo(r,13)^bo(r,22))+HV(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Bl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const D0=$V(()=>new jV);const KM=BigInt(0),Bb=BigInt(1),qV=BigInt(2);function Xu(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function $m(t){if(!Xu(t))throw new Error("Uint8Array expected")}const KV=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Of(t){$m(t);let e="";for(let n=0;n<t.length;n++)e+=KV[t[n]];return e}function GM(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function kk(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}const ba={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function hA(t){if(t>=ba._0&&t<=ba._9)return t-ba._0;if(t>=ba._A&&t<=ba._F)return t-(ba._A-10);if(t>=ba._a&&t<=ba._f)return t-(ba._a-10)}function Mf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=hA(t.charCodeAt(s)),a=hA(t.charCodeAt(s+1));if(o===void 0||a===void 0){const l=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function Gi(t){return kk(Of(t))}function Ek(t){return $m(t),kk(Of(Uint8Array.from(t).reverse()))}function Lc(t,e){return Mf(t.toString(16).padStart(e*2,"0"))}function Tk(t,e){return Lc(t,e).reverse()}function GV(t){return Mf(GM(t))}function ai(t,e,n){let r;if(typeof e=="string")try{r=Mf(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Xu(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Qu(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];$m(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}function ZV(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function XV(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function QV(t){let e;for(e=0;t>KM;t>>=Bb,e+=1);return e}function YV(t,e){return t>>BigInt(e)&Bb}function JV(t,e,n){return t|(n?Bb:KM)<<BigInt(e)}const Ck=t=>(qV<<BigInt(t-1))-Bb,Dv=t=>new Uint8Array(t),pA=t=>Uint8Array.from(t);function ZM(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Dv(t),i=Dv(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=Dv())=>{i=a(pA([0]),u),r=a(),u.length!==0&&(i=a(pA([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){r=a();const f=r.slice();d.push(f),u+=r.length}return Qu(...d)};return(u,d)=>{o(),l(u);let f;for(;!(f=d(c()));)l();return o(),f}}const eW={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Xu(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function zm(t,e,n={}){const r=(i,s,o)=>{const a=eW[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const tW=Object.freeze(Object.defineProperty({__proto__:null,abytes:$m,bitGet:YV,bitLen:QV,bitMask:Ck,bitSet:JV,bytesToHex:Of,bytesToNumberBE:Gi,bytesToNumberLE:Ek,concatBytes:Qu,createHmacDrbg:ZM,ensureBytes:ai,equalBytes:ZV,hexToBytes:Mf,hexToNumber:kk,isBytes:Xu,numberToBytesBE:Lc,numberToBytesLE:Tk,numberToHexUnpadded:GM,numberToVarBytesBE:GV,utf8ToBytes:XV,validateObject:zm},Symbol.toStringTag,{value:"Module"}));const Er=BigInt(0),rr=BigInt(1),yu=BigInt(2),nW=BigInt(3),nx=BigInt(4),mA=BigInt(5),gA=BigInt(8);BigInt(9);BigInt(16);function Vr(t,e){const n=t%e;return n>=Er?n:e+n}function rW(t,e,n){if(n<=Er||e<Er)throw new Error("Expected power/modulo > 0");if(n===rr)return Er;let r=rr;for(;e>Er;)e&rr&&(r=r*t%n),t=t*t%n,e>>=rr;return r}function bs(t,e,n){let r=t;for(;e-- >Er;)r*=r,r%=n;return r}function rx(t,e){if(t===Er||e<=Er)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Vr(t,e),r=e,i=Er,s=rr;for(;n!==Er;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==rr)throw new Error("invert: does not exist");return Vr(i,e)}function iW(t){const e=(t-rr)/yu;let n,r,i;for(n=t-rr,r=0;n%yu===Er;n/=yu,r++);for(i=yu;i<t&&rW(i,e,t)!==t-rr;i++);if(r===1){const o=(t+rr)/nx;return function(a,l){const c=a.pow(l,o);if(!a.eql(a.sqr(c),l))throw new Error("Cannot find square root");return c}}const s=(n+rr)/yu;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let l=r,c=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),d=o.pow(a,n);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let f=1;for(let p=o.sqr(d);f<l&&!o.eql(p,o.ONE);f++)p=o.sqr(p);const h=o.pow(c,rr<<BigInt(l-f-1));c=o.sqr(h),u=o.mul(u,h),d=o.mul(d,c),l=f}return u}}function sW(t){if(t%nx===nW){const e=(t+rr)/nx;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%gA===mA){const e=(t-mA)/gA;return function(n,r){const i=n.mul(r,yu),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,yu),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return iW(t)}const oW=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function aW(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=oW.reduce((r,i)=>(r[i]="function",r),e);return zm(t,n)}function lW(t,e,n){if(n<Er)throw new Error("Expected power > 0");if(n===Er)return t.ONE;if(n===rr)return e;let r=t.ONE,i=e;for(;n>Er;)n&rr&&(r=t.mul(r,i)),i=t.sqr(i),n>>=rr;return r}function cW(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function XM(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function uW(t,e,n=!1,r={}){if(t<=Er)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=XM(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=sW(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:Ck(i),ZERO:Er,ONE:rr,create:l=>Vr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Er<=l&&l<t},is0:l=>l===Er,isOdd:l=>(l&rr)===rr,neg:l=>Vr(-l,t),eql:(l,c)=>l===c,sqr:l=>Vr(l*l,t),add:(l,c)=>Vr(l+c,t),sub:(l,c)=>Vr(l-c,t),mul:(l,c)=>Vr(l*c,t),pow:(l,c)=>lW(a,l,c),div:(l,c)=>Vr(l*rx(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>rx(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>cW(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?Tk(l,s):Lc(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?Ek(l):Gi(l)}});return Object.freeze(a)}function QM(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function YM(t){const e=QM(t);return e+Math.ceil(e/2)}function dW(t,e,n=!1){const r=t.length,i=QM(e),s=YM(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Gi(t):Ek(t),a=Vr(o,e-rr)+rr;return n?Tk(a,i):Lc(a,i)}const fW=BigInt(0),Lv=BigInt(1);function hW(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>fW;)s&Lv&&(o=o.add(a)),a=a.double(),s>>=Lv;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let d=0;d<o;d++){u=c,l.push(u);for(let f=1;f<a;f++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const d=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const m=p*l;let g=Number(o&d);o>>=h,g>l&&(g-=f,o+=Lv);const y=m,b=m+Math.abs(g)-1,x=p%2!==0,C=g<0;g===0?u=u.add(n(x,s[y])):c=c.add(n(C,s[b]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function JM(t){return aW(t.Fp),zm(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...XM(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function pW(t){const e=JM(t);zm(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:mW,hexToBytes:gW}=tW,ku={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=ku;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:mW(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=ku,n=typeof t=="string"?gW(t):t;$m(n);let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=ku._parseInt(n.subarray(2)),{d:o,l:a}=ku._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Fa=BigInt(0),Es=BigInt(1);BigInt(2);const yA=BigInt(3);BigInt(4);function yW(t){const e=pW(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return Qu(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1),g=n.fromBytes(m.subarray(0,n.BYTES)),y=n.fromBytes(m.subarray(n.BYTES,2*n.BYTES));return{x:g,y}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Fa<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(Xu(p)&&(p=Of(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let x;try{x=typeof p=="bigint"?p:Gi(ai("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(x=Vr(x,b)),a(x),x}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=x=>n.eql(x,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map(y=>y.pz));return m.map((y,b)=>y.toAffine(g[b])).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(ai("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:x,py:C,pz:P}=m,S=n.eql(n.mul(g,P),n.mul(x,b)),_=n.eql(n.mul(y,P),n.mul(C,b));return S&&_}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,yA),{px:b,py:x,pz:C}=this;let P=n.ZERO,S=n.ZERO,_=n.ZERO,k=n.mul(b,b),T=n.mul(x,x),O=n.mul(C,C),M=n.mul(b,x);return M=n.add(M,M),_=n.mul(b,C),_=n.add(_,_),P=n.mul(m,_),S=n.mul(y,O),S=n.add(P,S),P=n.sub(T,S),S=n.add(T,S),S=n.mul(P,S),P=n.mul(M,P),_=n.mul(y,_),O=n.mul(m,O),M=n.sub(k,O),M=n.mul(m,M),M=n.add(M,_),_=n.add(k,k),k=n.add(_,k),k=n.add(k,O),k=n.mul(k,M),S=n.add(S,k),O=n.mul(x,C),O=n.add(O,O),k=n.mul(O,M),P=n.sub(P,k),_=n.mul(O,T),_=n.add(_,_),_=n.add(_,_),new d(P,S,_)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:x,py:C,pz:P}=m;let S=n.ZERO,_=n.ZERO,k=n.ZERO;const T=e.a,O=n.mul(e.b,yA);let M=n.mul(g,x),L=n.mul(y,C),F=n.mul(b,P),B=n.add(g,y),R=n.add(x,C);B=n.mul(B,R),R=n.add(M,L),B=n.sub(B,R),R=n.add(g,b);let A=n.add(x,P);return R=n.mul(R,A),A=n.add(M,F),R=n.sub(R,A),A=n.add(y,b),S=n.add(C,P),A=n.mul(A,S),S=n.add(L,F),A=n.sub(A,S),k=n.mul(T,R),S=n.mul(O,F),k=n.add(S,k),S=n.sub(L,k),k=n.add(L,k),_=n.mul(S,k),L=n.add(M,M),L=n.add(L,M),F=n.mul(T,F),R=n.mul(O,R),L=n.add(L,F),F=n.sub(M,F),F=n.mul(T,F),R=n.add(R,F),M=n.mul(L,R),_=n.add(_,M),M=n.mul(A,R),S=n.mul(B,S),S=n.sub(S,M),M=n.mul(B,L),k=n.mul(A,k),k=n.add(k,M),new d(S,_,k)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,g=>{const y=n.invertBatch(g.map(b=>b.pz));return g.map((b,x)=>b.toAffine(y[x])).map(d.fromAffine)})}multiplyUnsafe(m){const g=d.ZERO;if(m===Fa)return g;if(a(m),m===Es)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:x,k2neg:C,k2:P}=y.splitScalar(m),S=g,_=g,k=this;for(;x>Fa||P>Fa;)x&Es&&(S=S.add(k)),P&Es&&(_=_.add(k)),k=k.double(),x>>=Es,P>>=Es;return b&&(S=S.negate()),C&&(_=_.negate()),_=new d(n.mul(_.px,y.beta),_.py,_.pz),S.add(_)}multiply(m){a(m);let g=m,y,b;const{endo:x}=e;if(x){const{k1neg:C,k1:P,k2neg:S,k2:_}=x.splitScalar(g);let{p:k,f:T}=this.wNAF(P),{p:O,f:M}=this.wNAF(_);k=h.constTimeNegate(C,k),O=h.constTimeNegate(S,O),O=new d(n.mul(O.px,x.beta),O.py,O.pz),y=k.add(O),b=T.add(M)}else{const{p:C,f:P}=this.wNAF(g);y=C,b=P}return d.normalizeZ([y,b])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,x=(P,S)=>S===Fa||S===Es||!P.equals(b)?P.multiplyUnsafe(S):P.multiply(S),C=x(this,g).add(x(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,x=this.is0();m==null&&(m=x?n.ONE:n.inv(b));const C=n.mul(g,m),P=n.mul(y,m),S=n.mul(b,m);if(x)return{x:n.ZERO,y:n.ZERO};if(!n.eql(S,n.ONE))throw new Error("invZ was invalid");return{x:C,y:P}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===Es)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===Es?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return Of(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=hW(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function bW(t){const e=JM(t);return zm(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function wW(t){const e=bW(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(R){return Fa<R&&R<n.ORDER}function a(R){return Vr(R,r)}function l(R){return rx(R,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=yW({...e,toBytes(R,A,N){const z=A.toAffine(),U=n.toBytes(z.x),V=Qu;return N?V(Uint8Array.from([A.hasEvenY()?2:3]),U):V(Uint8Array.from([4]),U,n.toBytes(z.y))},fromBytes(R){const A=R.length,N=R[0],z=R.subarray(1);if(A===i&&(N===2||N===3)){const U=Gi(z);if(!o(U))throw new Error("Point is not on curve");const V=d(U);let q;try{q=n.sqrt(V)}catch(ne){const te=ne instanceof Error?": "+ne.message:"";throw new Error("Point is not on curve"+te)}const G=(q&Es)===Es;return(N&1)===1!==G&&(q=n.neg(q)),{x:U,y:q}}else if(A===s&&N===4){const U=n.fromBytes(z.subarray(0,n.BYTES)),V=n.fromBytes(z.subarray(n.BYTES,2*n.BYTES));return{x:U,y:V}}else throw new Error(`Point of length ${A} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=R=>Of(Lc(R,e.nByteLength));function p(R){const A=r>>Es;return R>A}function m(R){return p(R)?a(-R):R}const g=(R,A,N)=>Gi(R.slice(A,N));class y{constructor(A,N,z){this.r=A,this.s=N,this.recovery=z,this.assertValidity()}static fromCompact(A){const N=e.nByteLength;return A=ai("compactSignature",A,N*2),new y(g(A,0,N),g(A,N,2*N))}static fromDER(A){const{r:N,s:z}=ku.toSig(ai("DER",A));return new y(N,z)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(A){return new y(this.r,this.s,A)}recoverPublicKey(A){const{r:N,s:z,recovery:U}=this,V=_(ai("msgHash",A));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const q=U===2||U===3?N+e.n:N;if(q>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const G=U&1?"03":"02",ne=c.fromHex(G+h(q)),te=l(q),Z=a(-V*te),ae=a(z*te),_e=c.BASE.multiplyAndAddUnsafe(ne,Z,ae);if(!_e)throw new Error("point at infinify");return _e.assertValidity(),_e}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Mf(this.toDERHex())}toDERHex(){return ku.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Mf(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const b={isValidPrivateKey(R){try{return u(R),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const R=YM(e.n);return dW(e.randomBytes(R),e.n)},precompute(R=8,A=c.BASE){return A._setWindowSize(R),A.multiply(BigInt(3)),A}};function x(R,A=!0){return c.fromPrivateKey(R).toRawBytes(A)}function C(R){const A=Xu(R),N=typeof R=="string",z=(A||N)&&R.length;return A?z===i||z===s:N?z===2*i||z===2*s:R instanceof c}function P(R,A,N=!0){if(C(R))throw new Error("first arg must be private key");if(!C(A))throw new Error("second arg must be public key");return c.fromHex(A).multiply(u(R)).toRawBytes(N)}const S=e.bits2int||function(R){const A=Gi(R),N=R.length*8-e.nBitLength;return N>0?A>>BigInt(N):A},_=e.bits2int_modN||function(R){return a(S(R))},k=Ck(e.nBitLength);function T(R){if(typeof R!="bigint")throw new Error("bigint expected");if(!(Fa<=R&&R<k))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Lc(R,e.nByteLength)}function O(R,A,N=M){if(["recovered","canonical"].some(Ee=>Ee in N))throw new Error("sign() legacy options not supported");const{hash:z,randomBytes:U}=e;let{lowS:V,prehash:q,extraEntropy:G}=N;V==null&&(V=!0),R=ai("msgHash",R),q&&(R=ai("prehashed msgHash",z(R)));const ne=_(R),te=u(A),Z=[T(te),T(ne)];if(G!=null&&G!==!1){const Ee=G===!0?U(n.BYTES):G;Z.push(ai("extraEntropy",Ee))}const ae=Qu(...Z),_e=ne;function de(Ee){const Re=S(Ee);if(!f(Re))return;const je=l(Re),Ve=c.BASE.multiply(Re).toAffine(),Se=a(Ve.x);if(Se===Fa)return;const Me=a(je*a(_e+Se*te));if(Me===Fa)return;let Ne=(Ve.x===Se?0:2)|Number(Ve.y&Es),Ke=Me;return V&&p(Me)&&(Ke=m(Me),Ne^=1),new y(Se,Ke,Ne)}return{seed:ae,k2sig:de}}const M={lowS:e.lowS,prehash:!1},L={lowS:e.lowS,prehash:!1};function F(R,A,N=M){const{seed:z,k2sig:U}=O(R,A,N),V=e;return ZM(V.hash.outputLen,V.nByteLength,V.hmac)(z,U)}c.BASE._setWindowSize(8);function B(R,A,N,z=L){var U;const V=R;if(A=ai("msgHash",A),N=ai("publicKey",N),"strict"in z)throw new Error("options.strict was renamed to lowS");const{lowS:q,prehash:G}=z;let ne,te;try{if(typeof V=="string"||Xu(V))try{ne=y.fromDER(V)}catch(Ve){if(!(Ve instanceof ku.Err))throw Ve;ne=y.fromCompact(V)}else if(typeof V=="object"&&typeof V.r=="bigint"&&typeof V.s=="bigint"){const{r:Ve,s:Se}=V;ne=new y(Ve,Se)}else throw new Error("PARSE");te=c.fromHex(N)}catch(Ve){if(Ve.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(q&&ne.hasHighS())return!1;G&&(A=e.hash(A));const{r:Z,s:ae}=ne,_e=_(A),de=l(ae),Ee=a(_e*de),Re=a(Z*de),je=(U=c.BASE.multiplyAndAddUnsafe(te,Ee,Re))==null?void 0:U.toAffine();return je?a(je.x)===Z:!1}return{CURVE:e,getPublicKey:x,getSharedSecret:P,sign:F,verify:B,ProjectivePoint:c,Signature:y,utils:b}}let e8=class extends jM{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,RV(e);const r=Sk(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return N0(this),this.iHash.update(e),this}digestInto(e){N0(this),Fm(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const t8=(t,e,n)=>new e8(t,e).update(n).digest();t8.create=(t,e)=>new e8(t,e);function vW(t){return{hash:t,hmac:(e,...n)=>t8(t,e,FV(...n)),randomBytes:qM}}function xW(t,e){const n=r=>wW({...t,...vW(r)});return Object.freeze({...n(e),create:n})}const Fb=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),L0=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),n8=BigInt(1),B0=BigInt(2),bA=(t,e)=>(t+e/B0)/e;function r8(t){const e=Fb,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=bs(u,n,e)*u%e,f=bs(d,n,e)*u%e,h=bs(f,B0,e)*c%e,p=bs(h,i,e)*h%e,m=bs(p,s,e)*p%e,g=bs(m,a,e)*m%e,y=bs(g,l,e)*g%e,b=bs(y,a,e)*m%e,x=bs(b,n,e)*u%e,C=bs(x,o,e)*p%e,P=bs(C,r,e)*c%e,S=bs(P,B0,e);if(!ix.eql(ix.sqr(S),t))throw new Error("Cannot find square root");return S}const ix=uW(Fb,void 0,void 0,{sqrt:r8}),_k=xW({a:BigInt(0),b:BigInt(7),Fp:ix,n:L0,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=L0,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-n8*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=bA(s*t,e),l=bA(-r*t,e);let c=Vr(t-a*n-l*i,e),u=Vr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},D0),$b=BigInt(0),i8=t=>typeof t=="bigint"&&$b<t&&t<Fb,SW=t=>typeof t=="bigint"&&$b<t&&t<L0,wA={};function F0(t,...e){let n=wA[t];if(n===void 0){const r=D0(Uint8Array.from(t,i=>i.charCodeAt(0)));n=Qu(r,r),wA[t]=n}return D0(Qu(n,...e))}const Ak=t=>t.toRawBytes(!0).slice(1),sx=t=>Lc(t,32),Bv=t=>Vr(t,Fb),Gp=t=>Vr(t,L0),Pk=_k.ProjectivePoint,kW=(t,e,n)=>Pk.BASE.multiplyAndAddUnsafe(t,e,n);function ox(t){let e=_k.utils.normPrivateKeyToScalar(t),n=Pk.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Gp(-e),bytes:Ak(n)}}function s8(t){if(!i8(t))throw new Error("bad x: need 0 < x < p");const e=Bv(t*t),n=Bv(e*t+BigInt(7));let r=r8(n);r%B0!==$b&&(r=Bv(-r));const i=new Pk(t,r,n8);return i.assertValidity(),i}function o8(...t){return Gp(Gi(F0("BIP0340/challenge",...t)))}function EW(t){return ox(t).bytes}function TW(t,e,n=qM(32)){const r=ai("message",t),{bytes:i,scalar:s}=ox(e),o=ai("auxRand",n,32),a=sx(s^Gi(F0("BIP0340/aux",o))),l=F0("BIP0340/nonce",a,i,r),c=Gp(Gi(l));if(c===$b)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=ox(c),f=o8(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(sx(Gp(d+f*s)),32),!a8(h,r,i))throw new Error("sign: Invalid signature produced");return h}function a8(t,e,n){const r=ai("signature",t,64),i=ai("message",e),s=ai("publicKey",n,32);try{const o=s8(Gi(s)),a=Gi(r.subarray(0,32));if(!i8(a))return!1;const l=Gi(r.subarray(32,64));if(!SW(l))return!1;const c=o8(sx(a),Ak(o),i),u=kW(o,l,Gp(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const Fv={getPublicKey:EW,sign:TW,verify:a8,utils:{randomPrivateKey:_k.utils.randomPrivateKey,lift_x:s8,pointToBytes:Ak,numberToBytesBE:Lc,bytesToNumberBE:Gi,taggedHash:F0,mod:Vr}};function CW(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function _W(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function AW(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function PW(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}const l8=(t,e)=>e?l8(e,t%e):t,$0=(t,e)=>t+(e-l8(t,e));function ax(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if($0(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${$0(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function IW(t,e=!1){if($0(8,t)>32||$0(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!CW(n))throw new Error("radix2.encode input should be Uint8Array");return ax(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(ax(n,t,8,e))}}}function vA(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const lx=_W(AW("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),PW("")),xA=[996825010,642813549,513874426,1027748829,705979059];function Oh(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<xA.length;r++)(e>>r&1)===1&&(n^=xA[r]);return n}function SA(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Oh(i)^o>>5}i=Oh(i);for(let s=0;s<r;s++)i=Oh(i)^t.charCodeAt(s)&31;for(let s of e)i=Oh(i)^s;for(let s=0;s<6;s++)i=Oh(i);return i^=n,lx.encode(ax([i%2**30],30,5,!1))}function OW(t){const n=IW(5),r=n.decode,i=n.encode,s=vA(r);function o(u,d,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof d}`);if(u.length===0)throw new TypeError(`Invalid prefix length ${u.length}`);const h=u.length+7+d.length;if(f!==!1&&h>f)throw new TypeError(`Length ${h} exceeds limit ${f}`);const p=u.toLowerCase(),m=SA(p,d,1);return`${p}1${lx.encode(d)}${m}`}function a(u,d=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||d!==!1&&u.length>d)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${d})`);const f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");const h=f.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=f.slice(0,h),m=f.slice(h+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const g=lx.decode(m).slice(0,-6),y=SA(p,g,1);if(!m.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:g}}const l=vA(a);function c(u){const{prefix:d,words:f}=a(u,!1);return{prefix:d,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const kA=OW(),MW=new TextEncoder;function NW(t){return R0(D0(MW.encode(t)))}const Ik={sign:(t,e)=>R0(Fv.sign(t,e)),verify:Fv.verify,getPublicKey:t=>R0(Fv.getPublicKey(t))};function RW(t){return Ik.getPublicKey(t)}function c8(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return NW(e)}function DW(t,e){return Ik.sign(t,e)}function LW(t){try{return Ik.verify(t.sig,c8(t),t.pubkey)}catch(e){return console.warn("The following error occurred during verify():",e),!1}}function BW(t){const{words:e}=kA.decode(t),n=new Uint8Array(kA.fromWords(e));return R0(n)}function cx(t,e){const n=t.startsWith("nsec1")?BW(t):t,r=RW(n);return{async signEvent(i){const s={...i,pubkey:i.pubkey??r,tags:[...i.tags??[],...e?.tags??[]],created_at:i.created_at??Math.floor(Date.now()/1e3)};if(FW(s))return s;const o=s.id??c8(s),a=s.sig??DW(o,n);return{...s,id:o,sig:a}},async getPublicKey(){return r}}}function FW(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}const $W=async t=>LW(t),zW="modulepreload",UW=function(t){return"/ehagaki/"+t},EA={},zb=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=l(n.map(c=>{if(c=UW(c),c in EA)return;EA[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":zW,u||(f.as="script"),f.crossOrigin="",f.href=c,a&&f.setAttribute("nonce",a),document.head.appendChild(f),u)return new Promise((h,p)=>{f.addEventListener("load",h),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var TA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function HW(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $v,CA;function VW(){if(CA)return $v;CA=1;var t=function(b){return e(b)&&!n(b)};function e(y){return!!y&&typeof y=="object"}function n(y){var b=Object.prototype.toString.call(y);return b==="[object RegExp]"||b==="[object Date]"||s(y)}var r=typeof Symbol=="function"&&Symbol.for,i=r?Symbol.for("react.element"):60103;function s(y){return y.$$typeof===i}function o(y){return Array.isArray(y)?[]:{}}function a(y,b){return b.clone!==!1&&b.isMergeableObject(y)?m(o(y),y,b):y}function l(y,b,x){return y.concat(b).map(function(C){return a(C,x)})}function c(y,b){if(!b.customMerge)return m;var x=b.customMerge(y);return typeof x=="function"?x:m}function u(y){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(y).filter(function(b){return Object.propertyIsEnumerable.call(y,b)}):[]}function d(y){return Object.keys(y).concat(u(y))}function f(y,b){try{return b in y}catch{return!1}}function h(y,b){return f(y,b)&&!(Object.hasOwnProperty.call(y,b)&&Object.propertyIsEnumerable.call(y,b))}function p(y,b,x){var C={};return x.isMergeableObject(y)&&d(y).forEach(function(P){C[P]=a(y[P],x)}),d(b).forEach(function(P){h(y,P)||(f(y,P)&&x.isMergeableObject(b[P])?C[P]=c(P,x)(y[P],b[P],x):C[P]=a(b[P],x))}),C}function m(y,b,x){x=x||{},x.arrayMerge=x.arrayMerge||l,x.isMergeableObject=x.isMergeableObject||t,x.cloneUnlessOtherwiseSpecified=a;var C=Array.isArray(b),P=Array.isArray(y),S=C===P;return S?C?x.arrayMerge(y,b,x):p(y,b,x):a(b,x)}m.all=function(b,x){if(!Array.isArray(b))throw new Error("first argument should be an array");return b.reduce(function(C,P){return m(C,P,x)},{})};var g=m;return $v=g,$v}var WW=VW();const jW=HW(WW);var ux=function(t,e){return ux=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},ux(t,e)};function Ub(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ux(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var sn=function(){return sn=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},sn.apply(this,arguments)};function qW(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function zv(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Uv(t,e){var n=e&&e.cache?e.cache:JW,r=e&&e.serializer?e.serializer:QW,i=e&&e.strategy?e.strategy:ZW;return i(t,{cache:n,serializer:r})}function KW(t){return t==null||typeof t=="number"||typeof t=="boolean"}function GW(t,e,n,r){var i=KW(r)?r:n(r),s=e.get(i);return typeof s>"u"&&(s=t.call(this,r),e.set(i,s)),s}function u8(t,e,n){var r=Array.prototype.slice.call(arguments,3),i=n(r),s=e.get(i);return typeof s>"u"&&(s=t.apply(this,r),e.set(i,s)),s}function d8(t,e,n,r,i){return n.bind(e,t,r,i)}function ZW(t,e){var n=t.length===1?GW:u8;return d8(t,this,n,e.cache.create(),e.serializer)}function XW(t,e){return d8(t,this,u8,e.cache.create(),e.serializer)}var QW=function(){return JSON.stringify(arguments)},YW=(function(){function t(){this.cache=Object.create(null)}return t.prototype.get=function(e){return this.cache[e]},t.prototype.set=function(e,n){this.cache[e]=n},t})(),JW={create:function(){return new YW}},Hv={variadic:XW},Vt;(function(t){t[t.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",t[t.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",t[t.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",t[t.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",t[t.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",t[t.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",t[t.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",t[t.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",t[t.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",t[t.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",t[t.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",t[t.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",t[t.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",t[t.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",t[t.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",t[t.INVALID_TAG=23]="INVALID_TAG",t[t.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",t[t.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",t[t.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(Vt||(Vt={}));var $n;(function(t){t[t.literal=0]="literal",t[t.argument=1]="argument",t[t.number=2]="number",t[t.date=3]="date",t[t.time=4]="time",t[t.select=5]="select",t[t.plural=6]="plural",t[t.pound=7]="pound",t[t.tag=8]="tag"})($n||($n={}));var Nf;(function(t){t[t.number=0]="number",t[t.dateTime=1]="dateTime"})(Nf||(Nf={}));function _A(t){return t.type===$n.literal}function ej(t){return t.type===$n.argument}function f8(t){return t.type===$n.number}function h8(t){return t.type===$n.date}function p8(t){return t.type===$n.time}function m8(t){return t.type===$n.select}function g8(t){return t.type===$n.plural}function tj(t){return t.type===$n.pound}function y8(t){return t.type===$n.tag}function b8(t){return!!(t&&typeof t=="object"&&t.type===Nf.number)}function dx(t){return!!(t&&typeof t=="object"&&t.type===Nf.dateTime)}var w8=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,nj=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function rj(t){var e={};return t.replace(nj,function(n){var r=n.length;switch(n[0]){case"G":e.era=r===4?"long":r===5?"narrow":"short";break;case"y":e.year=r===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":e.month=["numeric","2-digit","short","long","narrow"][r-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":e.day=["numeric","2-digit"][r-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":e.weekday=r===4?"long":r===5?"narrow":"short";break;case"e":if(r<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"c":if(r<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"a":e.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":e.hourCycle="h12",e.hour=["numeric","2-digit"][r-1];break;case"H":e.hourCycle="h23",e.hour=["numeric","2-digit"][r-1];break;case"K":e.hourCycle="h11",e.hour=["numeric","2-digit"][r-1];break;case"k":e.hourCycle="h24",e.hour=["numeric","2-digit"][r-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":e.minute=["numeric","2-digit"][r-1];break;case"s":e.second=["numeric","2-digit"][r-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":e.timeZoneName=r<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),e}var ij=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function sj(t){if(t.length===0)throw new Error("Number skeleton cannot be empty");for(var e=t.split(ij).filter(function(f){return f.length>0}),n=[],r=0,i=e;r<i.length;r++){var s=i[r],o=s.split("/");if(o.length===0)throw new Error("Invalid number skeleton");for(var a=o[0],l=o.slice(1),c=0,u=l;c<u.length;c++){var d=u[c];if(d.length===0)throw new Error("Invalid number skeleton")}n.push({stem:a,options:l})}return n}function oj(t){return t.replace(/^(.*?)-/,"")}var AA=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,v8=/^(@+)?(\+|#+)?[rs]?$/g,aj=/(\*)(0+)|(#+)(0+)|(0+)/g,x8=/^(0+)$/;function PA(t){var e={};return t[t.length-1]==="r"?e.roundingPriority="morePrecision":t[t.length-1]==="s"&&(e.roundingPriority="lessPrecision"),t.replace(v8,function(n,r,i){return typeof i!="string"?(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length):i==="+"?e.minimumSignificantDigits=r.length:r[0]==="#"?e.maximumSignificantDigits=r.length:(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length+(typeof i=="string"?i.length:0)),""}),e}function S8(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function lj(t){var e;if(t[0]==="E"&&t[1]==="E"?(e={notation:"engineering"},t=t.slice(2)):t[0]==="E"&&(e={notation:"scientific"},t=t.slice(1)),e){var n=t.slice(0,2);if(n==="+!"?(e.signDisplay="always",t=t.slice(2)):n==="+?"&&(e.signDisplay="exceptZero",t=t.slice(2)),!x8.test(t))throw new Error("Malformed concise eng/scientific notation");e.minimumIntegerDigits=t.length}return e}function IA(t){var e={},n=S8(t);return n||e}function cj(t){for(var e={},n=0,r=t;n<r.length;n++){var i=r[n];switch(i.stem){case"percent":case"%":e.style="percent";continue;case"%x100":e.style="percent",e.scale=100;continue;case"currency":e.style="currency",e.currency=i.options[0];continue;case"group-off":case",_":e.useGrouping=!1;continue;case"precision-integer":case".":e.maximumFractionDigits=0;continue;case"measure-unit":case"unit":e.style="unit",e.unit=oj(i.options[0]);continue;case"compact-short":case"K":e.notation="compact",e.compactDisplay="short";continue;case"compact-long":case"KK":e.notation="compact",e.compactDisplay="long";continue;case"scientific":e=sn(sn(sn({},e),{notation:"scientific"}),i.options.reduce(function(l,c){return sn(sn({},l),IA(c))},{}));continue;case"engineering":e=sn(sn(sn({},e),{notation:"engineering"}),i.options.reduce(function(l,c){return sn(sn({},l),IA(c))},{}));continue;case"notation-simple":e.notation="standard";continue;case"unit-width-narrow":e.currencyDisplay="narrowSymbol",e.unitDisplay="narrow";continue;case"unit-width-short":e.currencyDisplay="code",e.unitDisplay="short";continue;case"unit-width-full-name":e.currencyDisplay="name",e.unitDisplay="long";continue;case"unit-width-iso-code":e.currencyDisplay="symbol";continue;case"scale":e.scale=parseFloat(i.options[0]);continue;case"rounding-mode-floor":e.roundingMode="floor";continue;case"rounding-mode-ceiling":e.roundingMode="ceil";continue;case"rounding-mode-down":e.roundingMode="trunc";continue;case"rounding-mode-up":e.roundingMode="expand";continue;case"rounding-mode-half-even":e.roundingMode="halfEven";continue;case"rounding-mode-half-down":e.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":e.roundingMode="halfExpand";continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(aj,function(l,c,u,d,f,h){if(c)e.minimumIntegerDigits=u.length;else{if(d&&f)throw new Error("We currently do not support maximum integer digits");if(h)throw new Error("We currently do not support exact integer digits")}return""});continue}if(x8.test(i.stem)){e.minimumIntegerDigits=i.stem.length;continue}if(AA.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(AA,function(l,c,u,d,f,h){return u==="*"?e.minimumFractionDigits=c.length:d&&d[0]==="#"?e.maximumFractionDigits=d.length:f&&h?(e.minimumFractionDigits=f.length,e.maximumFractionDigits=f.length+h.length):(e.minimumFractionDigits=c.length,e.maximumFractionDigits=c.length),""});var s=i.options[0];s==="w"?e=sn(sn({},e),{trailingZeroDisplay:"stripIfInteger"}):s&&(e=sn(sn({},e),PA(s)));continue}if(v8.test(i.stem)){e=sn(sn({},e),PA(i.stem));continue}var o=S8(i.stem);o&&(e=sn(sn({},e),o));var a=lj(i.stem);a&&(e=sn(sn({},e),a))}return e}var Cg={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function uj(t,e){for(var n="",r=0;r<t.length;r++){var i=t.charAt(r);if(i==="j"){for(var s=0;r+1<t.length&&t.charAt(r+1)===i;)s++,r++;var o=1+(s&1),a=s<2?1:3+(s>>1),l="a",c=dj(e);for((c=="H"||c=="k")&&(a=0);a-- >0;)n+=l;for(;o-- >0;)n=c+n}else i==="J"?n+="H":n+=i}return n}function dj(t){var e=t.hourCycle;if(e===void 0&&t.hourCycles&&t.hourCycles.length&&(e=t.hourCycles[0]),e)switch(e){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var n=t.language,r;n!=="root"&&(r=t.maximize().region);var i=Cg[r||""]||Cg[n||""]||Cg["".concat(n,"-001")]||Cg["001"];return i[0]}var Vv,fj=new RegExp("^".concat(w8.source,"*")),hj=new RegExp("".concat(w8.source,"*$"));function Kt(t,e){return{start:t,end:e}}var pj=!!String.prototype.startsWith&&"_a".startsWith("a",1),mj=!!String.fromCodePoint,gj=!!Object.fromEntries,yj=!!String.prototype.codePointAt,bj=!!String.prototype.trimStart,wj=!!String.prototype.trimEnd,vj=!!Number.isSafeInteger,xj=vj?Number.isSafeInteger:function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<=9007199254740991},fx=!0;try{var Sj=E8("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");fx=((Vv=Sj.exec("a"))===null||Vv===void 0?void 0:Vv[0])==="a"}catch{fx=!1}var OA=pj?function(e,n,r){return e.startsWith(n,r)}:function(e,n,r){return e.slice(r,r+n.length)===n},hx=mj?String.fromCodePoint:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r="",i=e.length,s=0,o;i>s;){if(o=e[s++],o>1114111)throw RangeError(o+" is not a valid code point");r+=o<65536?String.fromCharCode(o):String.fromCharCode(((o-=65536)>>10)+55296,o%1024+56320)}return r},MA=gj?Object.fromEntries:function(e){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r],o=s[0],a=s[1];n[o]=a}return n},k8=yj?function(e,n){return e.codePointAt(n)}:function(e,n){var r=e.length;if(!(n<0||n>=r)){var i=e.charCodeAt(n),s;return i<55296||i>56319||n+1===r||(s=e.charCodeAt(n+1))<56320||s>57343?i:(i-55296<<10)+(s-56320)+65536}},kj=bj?function(e){return e.trimStart()}:function(e){return e.replace(fj,"")},Ej=wj?function(e){return e.trimEnd()}:function(e){return e.replace(hj,"")};function E8(t,e){return new RegExp(t,e)}var px;if(fx){var NA=E8("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");px=function(e,n){var r;NA.lastIndex=n;var i=NA.exec(e);return(r=i[1])!==null&&r!==void 0?r:""}}else px=function(e,n){for(var r=[];;){var i=k8(e,n);if(i===void 0||T8(i)||Aj(i))break;r.push(i),n+=i>=65536?2:1}return hx.apply(void 0,r)};var Tj=(function(){function t(e,n){n===void 0&&(n={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!n.ignoreTag,this.locale=n.locale,this.requiresOtherClause=!!n.requiresOtherClause,this.shouldParseSkeletons=!!n.shouldParseSkeletons}return t.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},t.prototype.parseMessage=function(e,n,r){for(var i=[];!this.isEOF();){var s=this.char();if(s===123){var o=this.parseArgument(e,r);if(o.err)return o;i.push(o.val)}else{if(s===125&&e>0)break;if(s===35&&(n==="plural"||n==="selectordinal")){var a=this.clonePosition();this.bump(),i.push({type:$n.pound,location:Kt(a,this.clonePosition())})}else if(s===60&&!this.ignoreTag&&this.peek()===47){if(r)break;return this.error(Vt.UNMATCHED_CLOSING_TAG,Kt(this.clonePosition(),this.clonePosition()))}else if(s===60&&!this.ignoreTag&&mx(this.peek()||0)){var o=this.parseTag(e,n);if(o.err)return o;i.push(o.val)}else{var o=this.parseLiteral(e,n);if(o.err)return o;i.push(o.val)}}}return{val:i,err:null}},t.prototype.parseTag=function(e,n){var r=this.clonePosition();this.bump();var i=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:$n.literal,value:"<".concat(i,"/>"),location:Kt(r,this.clonePosition())},err:null};if(this.bumpIf(">")){var s=this.parseMessage(e+1,n,!0);if(s.err)return s;var o=s.val,a=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!mx(this.char()))return this.error(Vt.INVALID_TAG,Kt(a,this.clonePosition()));var l=this.clonePosition(),c=this.parseTagName();return i!==c?this.error(Vt.UNMATCHED_CLOSING_TAG,Kt(l,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:$n.tag,value:i,children:o,location:Kt(r,this.clonePosition())},err:null}:this.error(Vt.INVALID_TAG,Kt(a,this.clonePosition())))}else return this.error(Vt.UNCLOSED_TAG,Kt(r,this.clonePosition()))}else return this.error(Vt.INVALID_TAG,Kt(r,this.clonePosition()))},t.prototype.parseTagName=function(){var e=this.offset();for(this.bump();!this.isEOF()&&_j(this.char());)this.bump();return this.message.slice(e,this.offset())},t.prototype.parseLiteral=function(e,n){for(var r=this.clonePosition(),i="";;){var s=this.tryParseQuote(n);if(s){i+=s;continue}var o=this.tryParseUnquoted(e,n);if(o){i+=o;continue}var a=this.tryParseLeftAngleBracket();if(a){i+=a;continue}break}var l=Kt(r,this.clonePosition());return{val:{type:$n.literal,value:i,location:l},err:null}},t.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!Cj(this.peek()||0))?(this.bump(),"<"):null},t.prototype.tryParseQuote=function(e){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(e==="plural"||e==="selectordinal")break;return null;default:return null}this.bump();var n=[this.char()];for(this.bump();!this.isEOF();){var r=this.char();if(r===39)if(this.peek()===39)n.push(39),this.bump();else{this.bump();break}else n.push(r);this.bump()}return hx.apply(void 0,n)},t.prototype.tryParseUnquoted=function(e,n){if(this.isEOF())return null;var r=this.char();return r===60||r===123||r===35&&(n==="plural"||n==="selectordinal")||r===125&&e>0?null:(this.bump(),hx(r))},t.prototype.parseArgument=function(e,n){var r=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(Vt.EXPECT_ARGUMENT_CLOSING_BRACE,Kt(r,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(Vt.EMPTY_ARGUMENT,Kt(r,this.clonePosition()));var i=this.parseIdentifierIfPossible().value;if(!i)return this.error(Vt.MALFORMED_ARGUMENT,Kt(r,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(Vt.EXPECT_ARGUMENT_CLOSING_BRACE,Kt(r,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:$n.argument,value:i,location:Kt(r,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(Vt.EXPECT_ARGUMENT_CLOSING_BRACE,Kt(r,this.clonePosition())):this.parseArgumentOptions(e,n,i,r);default:return this.error(Vt.MALFORMED_ARGUMENT,Kt(r,this.clonePosition()))}},t.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),n=this.offset(),r=px(this.message,n),i=n+r.length;this.bumpTo(i);var s=this.clonePosition(),o=Kt(e,s);return{value:r,location:o}},t.prototype.parseArgumentOptions=function(e,n,r,i){var s,o=this.clonePosition(),a=this.parseIdentifierIfPossible().value,l=this.clonePosition();switch(a){case"":return this.error(Vt.EXPECT_ARGUMENT_TYPE,Kt(o,l));case"number":case"date":case"time":{this.bumpSpace();var c=null;if(this.bumpIf(",")){this.bumpSpace();var u=this.clonePosition(),d=this.parseSimpleArgStyleIfPossible();if(d.err)return d;var f=Ej(d.val);if(f.length===0)return this.error(Vt.EXPECT_ARGUMENT_STYLE,Kt(this.clonePosition(),this.clonePosition()));var h=Kt(u,this.clonePosition());c={style:f,styleLocation:h}}var p=this.tryParseArgumentClose(i);if(p.err)return p;var m=Kt(i,this.clonePosition());if(c&&OA(c?.style,"::",0)){var g=kj(c.style.slice(2));if(a==="number"){var d=this.parseNumberSkeletonFromString(g,c.styleLocation);return d.err?d:{val:{type:$n.number,value:r,location:m,style:d.val},err:null}}else{if(g.length===0)return this.error(Vt.EXPECT_DATE_TIME_SKELETON,m);var y=g;this.locale&&(y=uj(g,this.locale));var f={type:Nf.dateTime,pattern:y,location:c.styleLocation,parsedOptions:this.shouldParseSkeletons?rj(y):{}},b=a==="date"?$n.date:$n.time;return{val:{type:b,value:r,location:m,style:f},err:null}}}return{val:{type:a==="number"?$n.number:a==="date"?$n.date:$n.time,value:r,location:m,style:(s=c?.style)!==null&&s!==void 0?s:null},err:null}}case"plural":case"selectordinal":case"select":{var x=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(Vt.EXPECT_SELECT_ARGUMENT_OPTIONS,Kt(x,sn({},x)));this.bumpSpace();var C=this.parseIdentifierIfPossible(),P=0;if(a!=="select"&&C.value==="offset"){if(!this.bumpIf(":"))return this.error(Vt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Kt(this.clonePosition(),this.clonePosition()));this.bumpSpace();var d=this.tryParseDecimalInteger(Vt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Vt.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(d.err)return d;this.bumpSpace(),C=this.parseIdentifierIfPossible(),P=d.val}var S=this.tryParsePluralOrSelectOptions(e,a,n,C);if(S.err)return S;var p=this.tryParseArgumentClose(i);if(p.err)return p;var _=Kt(i,this.clonePosition());return a==="select"?{val:{type:$n.select,value:r,options:MA(S.val),location:_},err:null}:{val:{type:$n.plural,value:r,options:MA(S.val),offset:P,pluralType:a==="plural"?"cardinal":"ordinal",location:_},err:null}}default:return this.error(Vt.INVALID_ARGUMENT_TYPE,Kt(o,l))}},t.prototype.tryParseArgumentClose=function(e){return this.isEOF()||this.char()!==125?this.error(Vt.EXPECT_ARGUMENT_CLOSING_BRACE,Kt(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},t.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,n=this.clonePosition();!this.isEOF();){var r=this.char();switch(r){case 39:{this.bump();var i=this.clonePosition();if(!this.bumpUntil("'"))return this.error(Vt.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,Kt(i,this.clonePosition()));this.bump();break}case 123:{e+=1,this.bump();break}case 125:{if(e>0)e-=1;else return{val:this.message.slice(n.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(n.offset,this.offset()),err:null}},t.prototype.parseNumberSkeletonFromString=function(e,n){var r=[];try{r=sj(e)}catch{return this.error(Vt.INVALID_NUMBER_SKELETON,n)}return{val:{type:Nf.number,tokens:r,location:n,parsedOptions:this.shouldParseSkeletons?cj(r):{}},err:null}},t.prototype.tryParsePluralOrSelectOptions=function(e,n,r,i){for(var s,o=!1,a=[],l=new Set,c=i.value,u=i.location;;){if(c.length===0){var d=this.clonePosition();if(n!=="select"&&this.bumpIf("=")){var f=this.tryParseDecimalInteger(Vt.EXPECT_PLURAL_ARGUMENT_SELECTOR,Vt.INVALID_PLURAL_ARGUMENT_SELECTOR);if(f.err)return f;u=Kt(d,this.clonePosition()),c=this.message.slice(d.offset,this.offset())}else break}if(l.has(c))return this.error(n==="select"?Vt.DUPLICATE_SELECT_ARGUMENT_SELECTOR:Vt.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,u);c==="other"&&(o=!0),this.bumpSpace();var h=this.clonePosition();if(!this.bumpIf("{"))return this.error(n==="select"?Vt.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:Vt.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,Kt(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,n,r);if(p.err)return p;var m=this.tryParseArgumentClose(h);if(m.err)return m;a.push([c,{value:p.val,location:Kt(h,this.clonePosition())}]),l.add(c),this.bumpSpace(),s=this.parseIdentifierIfPossible(),c=s.value,u=s.location}return a.length===0?this.error(n==="select"?Vt.EXPECT_SELECT_ARGUMENT_SELECTOR:Vt.EXPECT_PLURAL_ARGUMENT_SELECTOR,Kt(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!o?this.error(Vt.MISSING_OTHER_CLAUSE,Kt(this.clonePosition(),this.clonePosition())):{val:a,err:null}},t.prototype.tryParseDecimalInteger=function(e,n){var r=1,i=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(r=-1);for(var s=!1,o=0;!this.isEOF();){var a=this.char();if(a>=48&&a<=57)s=!0,o=o*10+(a-48),this.bump();else break}var l=Kt(i,this.clonePosition());return s?(o*=r,xj(o)?{val:o,err:null}:this.error(n,l)):this.error(e,l)},t.prototype.offset=function(){return this.position.offset},t.prototype.isEOF=function(){return this.offset()===this.message.length},t.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},t.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var n=k8(this.message,e);if(n===void 0)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return n},t.prototype.error=function(e,n){return{val:null,err:{kind:e,message:this.message,location:n}}},t.prototype.bump=function(){if(!this.isEOF()){var e=this.char();e===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},t.prototype.bumpIf=function(e){if(OA(this.message,e,this.offset())){for(var n=0;n<e.length;n++)this.bump();return!0}return!1},t.prototype.bumpUntil=function(e){var n=this.offset(),r=this.message.indexOf(e,n);return r>=0?(this.bumpTo(r),!0):(this.bumpTo(this.message.length),!1)},t.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var n=this.offset();if(n===e)break;if(n>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},t.prototype.bumpSpace=function(){for(;!this.isEOF()&&T8(this.char());)this.bump()},t.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),n=this.offset(),r=this.message.charCodeAt(n+(e>=65536?2:1));return r??null},t})();function mx(t){return t>=97&&t<=122||t>=65&&t<=90}function Cj(t){return mx(t)||t===47}function _j(t){return t===45||t===46||t>=48&&t<=57||t===95||t>=97&&t<=122||t>=65&&t<=90||t==183||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}function T8(t){return t>=9&&t<=13||t===32||t===133||t>=8206&&t<=8207||t===8232||t===8233}function Aj(t){return t>=33&&t<=35||t===36||t>=37&&t<=39||t===40||t===41||t===42||t===43||t===44||t===45||t>=46&&t<=47||t>=58&&t<=59||t>=60&&t<=62||t>=63&&t<=64||t===91||t===92||t===93||t===94||t===96||t===123||t===124||t===125||t===126||t===161||t>=162&&t<=165||t===166||t===167||t===169||t===171||t===172||t===174||t===176||t===177||t===182||t===187||t===191||t===215||t===247||t>=8208&&t<=8213||t>=8214&&t<=8215||t===8216||t===8217||t===8218||t>=8219&&t<=8220||t===8221||t===8222||t===8223||t>=8224&&t<=8231||t>=8240&&t<=8248||t===8249||t===8250||t>=8251&&t<=8254||t>=8257&&t<=8259||t===8260||t===8261||t===8262||t>=8263&&t<=8273||t===8274||t===8275||t>=8277&&t<=8286||t>=8592&&t<=8596||t>=8597&&t<=8601||t>=8602&&t<=8603||t>=8604&&t<=8607||t===8608||t>=8609&&t<=8610||t===8611||t>=8612&&t<=8613||t===8614||t>=8615&&t<=8621||t===8622||t>=8623&&t<=8653||t>=8654&&t<=8655||t>=8656&&t<=8657||t===8658||t===8659||t===8660||t>=8661&&t<=8691||t>=8692&&t<=8959||t>=8960&&t<=8967||t===8968||t===8969||t===8970||t===8971||t>=8972&&t<=8991||t>=8992&&t<=8993||t>=8994&&t<=9e3||t===9001||t===9002||t>=9003&&t<=9083||t===9084||t>=9085&&t<=9114||t>=9115&&t<=9139||t>=9140&&t<=9179||t>=9180&&t<=9185||t>=9186&&t<=9254||t>=9255&&t<=9279||t>=9280&&t<=9290||t>=9291&&t<=9311||t>=9472&&t<=9654||t===9655||t>=9656&&t<=9664||t===9665||t>=9666&&t<=9719||t>=9720&&t<=9727||t>=9728&&t<=9838||t===9839||t>=9840&&t<=10087||t===10088||t===10089||t===10090||t===10091||t===10092||t===10093||t===10094||t===10095||t===10096||t===10097||t===10098||t===10099||t===10100||t===10101||t>=10132&&t<=10175||t>=10176&&t<=10180||t===10181||t===10182||t>=10183&&t<=10213||t===10214||t===10215||t===10216||t===10217||t===10218||t===10219||t===10220||t===10221||t===10222||t===10223||t>=10224&&t<=10239||t>=10240&&t<=10495||t>=10496&&t<=10626||t===10627||t===10628||t===10629||t===10630||t===10631||t===10632||t===10633||t===10634||t===10635||t===10636||t===10637||t===10638||t===10639||t===10640||t===10641||t===10642||t===10643||t===10644||t===10645||t===10646||t===10647||t===10648||t>=10649&&t<=10711||t===10712||t===10713||t===10714||t===10715||t>=10716&&t<=10747||t===10748||t===10749||t>=10750&&t<=11007||t>=11008&&t<=11055||t>=11056&&t<=11076||t>=11077&&t<=11078||t>=11079&&t<=11084||t>=11085&&t<=11123||t>=11124&&t<=11125||t>=11126&&t<=11157||t===11158||t>=11159&&t<=11263||t>=11776&&t<=11777||t===11778||t===11779||t===11780||t===11781||t>=11782&&t<=11784||t===11785||t===11786||t===11787||t===11788||t===11789||t>=11790&&t<=11798||t===11799||t>=11800&&t<=11801||t===11802||t===11803||t===11804||t===11805||t>=11806&&t<=11807||t===11808||t===11809||t===11810||t===11811||t===11812||t===11813||t===11814||t===11815||t===11816||t===11817||t>=11818&&t<=11822||t===11823||t>=11824&&t<=11833||t>=11834&&t<=11835||t>=11836&&t<=11839||t===11840||t===11841||t===11842||t>=11843&&t<=11855||t>=11856&&t<=11857||t===11858||t>=11859&&t<=11903||t>=12289&&t<=12291||t===12296||t===12297||t===12298||t===12299||t===12300||t===12301||t===12302||t===12303||t===12304||t===12305||t>=12306&&t<=12307||t===12308||t===12309||t===12310||t===12311||t===12312||t===12313||t===12314||t===12315||t===12316||t===12317||t>=12318&&t<=12319||t===12320||t===12336||t===64830||t===64831||t>=65093&&t<=65094}function gx(t){t.forEach(function(e){if(delete e.location,m8(e)||g8(e))for(var n in e.options)delete e.options[n].location,gx(e.options[n].value);else f8(e)&&b8(e.style)||(h8(e)||p8(e))&&dx(e.style)?delete e.style.location:y8(e)&&gx(e.children)})}function Pj(t,e){e===void 0&&(e={}),e=sn({shouldParseSkeletons:!0,requiresOtherClause:!0},e);var n=new Tj(t,e).parse();if(n.err){var r=SyntaxError(Vt[n.err.kind]);throw r.location=n.err.location,r.originalMessage=n.err.message,r}return e?.captureLocation||gx(n.val),n.val}var Rf;(function(t){t.MISSING_VALUE="MISSING_VALUE",t.INVALID_VALUE="INVALID_VALUE",t.MISSING_INTL_API="MISSING_INTL_API"})(Rf||(Rf={}));var Hb=(function(t){Ub(e,t);function e(n,r,i){var s=t.call(this,n)||this;return s.code=r,s.originalMessage=i,s}return e.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},e})(Error),RA=(function(t){Ub(e,t);function e(n,r,i,s){return t.call(this,'Invalid values for "'.concat(n,'": "').concat(r,'". Options are "').concat(Object.keys(i).join('", "'),'"'),Rf.INVALID_VALUE,s)||this}return e})(Hb),Ij=(function(t){Ub(e,t);function e(n,r,i){return t.call(this,'Value for "'.concat(n,'" must be of type ').concat(r),Rf.INVALID_VALUE,i)||this}return e})(Hb),Oj=(function(t){Ub(e,t);function e(n,r){return t.call(this,'The intl string context variable "'.concat(n,'" was not provided to the string "').concat(r,'"'),Rf.MISSING_VALUE,r)||this}return e})(Hb),Ti;(function(t){t[t.literal=0]="literal",t[t.object=1]="object"})(Ti||(Ti={}));function Mj(t){return t.length<2?t:t.reduce(function(e,n){var r=e[e.length-1];return!r||r.type!==Ti.literal||n.type!==Ti.literal?e.push(n):r.value+=n.value,e},[])}function Nj(t){return typeof t=="function"}function o0(t,e,n,r,i,s,o){if(t.length===1&&_A(t[0]))return[{type:Ti.literal,value:t[0].value}];for(var a=[],l=0,c=t;l<c.length;l++){var u=c[l];if(_A(u)){a.push({type:Ti.literal,value:u.value});continue}if(tj(u)){typeof s=="number"&&a.push({type:Ti.literal,value:n.getNumberFormat(e).format(s)});continue}var d=u.value;if(!(i&&d in i))throw new Oj(d,o);var f=i[d];if(ej(u)){(!f||typeof f=="string"||typeof f=="number")&&(f=typeof f=="string"||typeof f=="number"?String(f):""),a.push({type:typeof f=="string"?Ti.literal:Ti.object,value:f});continue}if(h8(u)){var h=typeof u.style=="string"?r.date[u.style]:dx(u.style)?u.style.parsedOptions:void 0;a.push({type:Ti.literal,value:n.getDateTimeFormat(e,h).format(f)});continue}if(p8(u)){var h=typeof u.style=="string"?r.time[u.style]:dx(u.style)?u.style.parsedOptions:r.time.medium;a.push({type:Ti.literal,value:n.getDateTimeFormat(e,h).format(f)});continue}if(f8(u)){var h=typeof u.style=="string"?r.number[u.style]:b8(u.style)?u.style.parsedOptions:void 0;h&&h.scale&&(f=f*(h.scale||1)),a.push({type:Ti.literal,value:n.getNumberFormat(e,h).format(f)});continue}if(y8(u)){var p=u.children,m=u.value,g=i[m];if(!Nj(g))throw new Ij(m,"function",o);var y=o0(p,e,n,r,i,s),b=g(y.map(function(P){return P.value}));Array.isArray(b)||(b=[b]),a.push.apply(a,b.map(function(P){return{type:typeof P=="string"?Ti.literal:Ti.object,value:P}}))}if(m8(u)){var x=u.options[f]||u.options.other;if(!x)throw new RA(u.value,f,Object.keys(u.options),o);a.push.apply(a,o0(x.value,e,n,r,i));continue}if(g8(u)){var x=u.options["=".concat(f)];if(!x){if(!Intl.PluralRules)throw new Hb(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,Rf.MISSING_INTL_API,o);var C=n.getPluralRules(e,{type:u.pluralType}).select(f-(u.offset||0));x=u.options[C]||u.options.other}if(!x)throw new RA(u.value,f,Object.keys(u.options),o);a.push.apply(a,o0(x.value,e,n,r,i,f-(u.offset||0)));continue}}return Mj(a)}function Rj(t,e){return e?sn(sn(sn({},t||{}),e||{}),Object.keys(t).reduce(function(n,r){return n[r]=sn(sn({},t[r]),e[r]||{}),n},{})):t}function Dj(t,e){return e?Object.keys(t).reduce(function(n,r){return n[r]=Rj(t[r],e[r]),n},sn({},t)):t}function Wv(t){return{create:function(){return{get:function(e){return t[e]},set:function(e,n){t[e]=n}}}}}function Lj(t){return t===void 0&&(t={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:Uv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.NumberFormat).bind.apply(e,zv([void 0],n,!1)))},{cache:Wv(t.number),strategy:Hv.variadic}),getDateTimeFormat:Uv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.DateTimeFormat).bind.apply(e,zv([void 0],n,!1)))},{cache:Wv(t.dateTime),strategy:Hv.variadic}),getPluralRules:Uv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.PluralRules).bind.apply(e,zv([void 0],n,!1)))},{cache:Wv(t.pluralRules),strategy:Hv.variadic})}}var C8=(function(){function t(e,n,r,i){n===void 0&&(n=t.defaultLocale);var s=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(l){var c=s.formatToParts(l);if(c.length===1)return c[0].value;var u=c.reduce(function(d,f){return!d.length||f.type!==Ti.literal||typeof d[d.length-1]!="string"?d.push(f.value):d[d.length-1]+=f.value,d},[]);return u.length<=1?u[0]||"":u},this.formatToParts=function(l){return o0(s.ast,s.locales,s.formatters,s.formats,l,void 0,s.message)},this.resolvedOptions=function(){var l;return{locale:((l=s.resolvedLocale)===null||l===void 0?void 0:l.toString())||Intl.NumberFormat.supportedLocalesOf(s.locales)[0]}},this.getAst=function(){return s.ast},this.locales=n,this.resolvedLocale=t.resolveLocale(n),typeof e=="string"){if(this.message=e,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var o=i||{};o.formatters;var a=qW(o,["formatters"]);this.ast=t.__parse(e,sn(sn({},a),{locale:this.resolvedLocale}))}else this.ast=e;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=Dj(t.formats,r),this.formatters=i&&i.formatters||Lj(this.formatterCache)}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.resolveLocale=function(e){if(!(typeof Intl.Locale>"u")){var n=Intl.NumberFormat.supportedLocalesOf(e);return n.length>0?new Intl.Locale(n[0]):new Intl.Locale(typeof e=="string"?e:e[0])}},t.__parse=Pj,t.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t})();function Bj(t,e){if(e==null)return;if(e in t)return t[e];const n=e.split(".");let r=t;for(let i=0;i<n.length;i++)if(typeof r=="object"){if(i>0){const s=n.slice(i,n.length).join(".");if(s in r){r=r[s];break}}r=r[n[i]]}else r=void 0;return r}const cc={},Fj=(t,e,n)=>n&&(e in cc||(cc[e]={}),t in cc[e]||(cc[e][t]=n),n),_8=(t,e)=>{if(e==null)return;if(e in cc&&t in cc[e])return cc[e][t];const n=Um(e);for(let r=0;r<n.length;r++){const i=n[r],s=zj(i,t);if(s)return Fj(t,e,s)}};let Ok;const nh=io({});function $j(t){return Ok[t]||null}function Mk(t){return t in Ok}function zj(t,e){if(!Mk(t))return null;const n=$j(t);return Bj(n,e)}function Uj(t){if(t==null)return;const e=Um(t);for(let n=0;n<e.length;n++){const r=e[n];if(Mk(r))return r}}function Hj(t,...e){delete cc[t],nh.update(n=>(n[t]=jW.all([n[t]||{},...e]),n))}Ja([nh],([t])=>Object.keys(t));nh.subscribe(t=>Ok=t);const bp={};function Vj(t){bp[t]=new Set}function Wj(t,e){bp[t].delete(e),bp[t].size===0&&delete bp[t]}function wp(t){return bp[t]}function jj(t){return Um(t).map(e=>{const n=wp(e);return[e,n?[...n]:[]]}).filter(([,e])=>e.length>0)}function z0(t){return t==null?!1:Um(t).some(e=>{var n;return(n=wp(e))==null?void 0:n.size})}function qj(t,e){return Promise.all(e.map(r=>(Wj(t,r),r().then(i=>i.default||i)))).then(r=>Hj(t,...r))}const Mh={};function Nk(t){if(!z0(t))return t in Mh?Mh[t]:Promise.resolve();const e=jj(t);return Mh[t]=Promise.all(e.map(([n,r])=>qj(n,r))).then(()=>{if(z0(t))return Nk(t);delete Mh[t]}),Mh[t]}function A8(t,e){wp(t)||Vj(t);const n=wp(t);wp(t).has(e)||(Mk(t)||nh.update(r=>(r[t]={},r)),n.add(e))}var DA=Object.getOwnPropertySymbols,Kj=Object.prototype.hasOwnProperty,Gj=Object.prototype.propertyIsEnumerable,Zj=(t,e)=>{var n={};for(var r in t)Kj.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&DA)for(var r of DA(t))e.indexOf(r)<0&&Gj.call(t,r)&&(n[r]=t[r]);return n};const Xj={number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};function Qj({locale:t,id:e}){console.warn(`[svelte-i18n] The message "${e}" was not found in "${Um(t).join('", "')}".${z0(gl())?`

Note: there are at least one loader still registered to this locale that wasn't executed.`:""}`)}const Yj={fallbackLocale:null,loadingDelay:200,formats:Xj,warnOnMissingMessages:!0,handleMissingMessage:void 0,ignoreTag:!0},tp=Yj;function Yu(){return tp}function Jj(t){const e=t,{formats:n}=e,r=Zj(e,["formats"]);let i=t.fallbackLocale;if(t.initialLocale)try{C8.resolveLocale(t.initialLocale)&&(i=t.initialLocale)}catch{console.warn(`[svelte-i18n] The initial locale "${t.initialLocale}" is not a valid locale.`)}return r.warnOnMissingMessages&&(delete r.warnOnMissingMessages,r.handleMissingMessage==null?r.handleMissingMessage=Qj:console.warn('[svelte-i18n] The "warnOnMissingMessages" option is deprecated. Please use the "handleMissingMessage" option instead.')),Object.assign(tp,r,{initialLocale:i}),n&&("number"in n&&Object.assign(tp.formats.number,n.number),"date"in n&&Object.assign(tp.formats.date,n.date),"time"in n&&Object.assign(tp.formats.time,n.time)),ms.set(i)}const jv=io(!1);var eq=Object.defineProperty,tq=Object.defineProperties,nq=Object.getOwnPropertyDescriptors,LA=Object.getOwnPropertySymbols,rq=Object.prototype.hasOwnProperty,iq=Object.prototype.propertyIsEnumerable,BA=(t,e,n)=>e in t?eq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,sq=(t,e)=>{for(var n in e||(e={}))rq.call(e,n)&&BA(t,n,e[n]);if(LA)for(var n of LA(e))iq.call(e,n)&&BA(t,n,e[n]);return t},oq=(t,e)=>tq(t,nq(e));let yx;const U0=io(null);function FA(t){return t.split("-").map((e,n,r)=>r.slice(0,n+1).join("-")).reverse()}function Um(t,e=Yu().fallbackLocale){const n=FA(t);return e?[...new Set([...n,...FA(e)])]:n}function gl(){return yx??void 0}U0.subscribe(t=>{yx=t??void 0,typeof window<"u"&&t!=null&&document.documentElement.setAttribute("lang",t)});const aq=t=>{if(t&&Uj(t)&&z0(t)){const{loadingDelay:e}=Yu();let n;return typeof window<"u"&&gl()!=null&&e?n=window.setTimeout(()=>jv.set(!0),e):jv.set(!0),Nk(t).then(()=>{U0.set(t)}).finally(()=>{clearTimeout(n),jv.set(!1)})}return U0.set(t)},ms=oq(sq({},U0),{set:aq}),lq=()=>typeof window>"u"?null:window.navigator.language||window.navigator.languages[0],Vb=t=>{const e=Object.create(null);return r=>{const i=JSON.stringify(r);return i in e?e[i]:e[i]=t(r)}};var cq=Object.defineProperty,H0=Object.getOwnPropertySymbols,P8=Object.prototype.hasOwnProperty,I8=Object.prototype.propertyIsEnumerable,$A=(t,e,n)=>e in t?cq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rk=(t,e)=>{for(var n in e||(e={}))P8.call(e,n)&&$A(t,n,e[n]);if(H0)for(var n of H0(e))I8.call(e,n)&&$A(t,n,e[n]);return t},rh=(t,e)=>{var n={};for(var r in t)P8.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&H0)for(var r of H0(t))e.indexOf(r)<0&&I8.call(t,r)&&(n[r]=t[r]);return n};const Zp=(t,e)=>{const{formats:n}=Yu();if(t in n&&e in n[t])return n[t][e];throw new Error(`[svelte-i18n] Unknown "${e}" ${t} format.`)},uq=Vb(t=>{var e=t,{locale:n,format:r}=e,i=rh(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return r&&(i=Zp("number",r)),new Intl.NumberFormat(n,i)}),dq=Vb(t=>{var e=t,{locale:n,format:r}=e,i=rh(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return r?i=Zp("date",r):Object.keys(i).length===0&&(i=Zp("date","short")),new Intl.DateTimeFormat(n,i)}),fq=Vb(t=>{var e=t,{locale:n,format:r}=e,i=rh(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return r?i=Zp("time",r):Object.keys(i).length===0&&(i=Zp("time","short")),new Intl.DateTimeFormat(n,i)}),hq=(t={})=>{var e=t,{locale:n=gl()}=e,r=rh(e,["locale"]);return uq(Rk({locale:n},r))},pq=(t={})=>{var e=t,{locale:n=gl()}=e,r=rh(e,["locale"]);return dq(Rk({locale:n},r))},mq=(t={})=>{var e=t,{locale:n=gl()}=e,r=rh(e,["locale"]);return fq(Rk({locale:n},r))},gq=Vb((t,e=gl())=>new C8(t,e,Yu().formats,{ignoreTag:Yu().ignoreTag})),yq=(t,e={})=>{var n,r,i,s;let o=e;typeof t=="object"&&(o=t,t=o.id);const{values:a,locale:l=gl(),default:c}=o;if(l==null)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let u=_8(t,l);if(!u)u=(s=(i=(r=(n=Yu()).handleMissingMessage)==null?void 0:r.call(n,{locale:l,id:t,defaultValue:c}))!=null?i:c)!=null?s:t;else if(typeof u!="string")return console.warn(`[svelte-i18n] Message with id "${t}" must be of type "string", found: "${typeof u}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),u;if(!a)return u;let d=u;try{d=gq(u,l).format(a)}catch(f){f instanceof Error&&console.warn(`[svelte-i18n] Message "${t}" has syntax error:`,f.message)}return d},bq=(t,e)=>mq(e).format(t),wq=(t,e)=>pq(e).format(t),vq=(t,e)=>hq(e).format(t),xq=(t,e=gl())=>_8(t,e),yr=Ja([ms,nh],()=>yq);Ja([ms],()=>bq);Ja([ms],()=>wq);Ja([ms],()=>vq);Ja([ms,nh],()=>xq);function Sq(t){return Nk(gl()||Yu().initialLocale)}A8("ja",()=>zb(()=>import("./ja-CEgR9QMg.js"),[]));A8("en",()=>zb(()=>import("./en-DDndUP09.js"),[]));function kq(){const t=localStorage.getItem("locale"),e=lq();return t&&(t==="ja"||t==="en")?t:e&&e.startsWith("ja")?"ja":"en"}const O8=kq();Jj({fallbackLocale:"ja",initialLocale:O8,loadingDelay:0});ms.set(O8);function Eq(t){return typeof t=="function"}function Hm(t){return t!==null&&typeof t=="object"}const Tq=["string","number","bigint","boolean"];function bx(t){return t==null||Tq.includes(typeof t)?!0:Array.isArray(t)?t.every(e=>bx(e)):typeof t=="object"?Object.getPrototypeOf(t)===Object.prototype:!1}const V0=Symbol("box"),M8=Symbol("is-writable");function $e(t,e){const n=oe(t);return e?{[V0]:!0,[M8]:!0,get current(){return E(n)},set current(r){e(r)}}:{[V0]:!0,get current(){return t()}}}function N8(t){return Hm(t)&&V0 in t}function Cq(t){return N8(t)?t:Eq(t)?$e(t):Rs(t)}function Rs(t){let e=ye(Zt(t));return{[V0]:!0,[M8]:!0,get current(){return E(e)},set current(n){Q(e,n,!0)}}}function R8(...t){return function(e){for(const n of t)if(n){if(e.defaultPrevented)return;typeof n=="function"?n.call(this,e):n.current?.call(this,e)}}}var zA=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,_q=/\n/g,Aq=/^\s*/,Pq=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,Iq=/^:\s*/,Oq=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,Mq=/^[;\s]*/,Nq=/^\s+|\s+$/g,Rq=`
`,UA="/",HA="*",bu="",Dq="comment",Lq="declaration";function Bq(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function i(p){var m=p.match(_q);m&&(n+=m.length);var g=p.lastIndexOf(Rq);r=~g?p.length-g:r+p.length}function s(){var p={line:n,column:r};return function(m){return m.position=new o(p),c(),m}}function o(p){this.start=p,this.end={line:n,column:r},this.source=e.source}o.prototype.content=t;function a(p){var m=new Error(e.source+":"+n+":"+r+": "+p);if(m.reason=p,m.filename=e.source,m.line=n,m.column=r,m.source=t,!e.silent)throw m}function l(p){var m=p.exec(t);if(m){var g=m[0];return i(g),t=t.slice(g.length),m}}function c(){l(Aq)}function u(p){var m;for(p=p||[];m=d();)m!==!1&&p.push(m);return p}function d(){var p=s();if(!(UA!=t.charAt(0)||HA!=t.charAt(1))){for(var m=2;bu!=t.charAt(m)&&(HA!=t.charAt(m)||UA!=t.charAt(m+1));)++m;if(m+=2,bu===t.charAt(m-1))return a("End of comment missing");var g=t.slice(2,m-2);return r+=2,i(g),t=t.slice(m),r+=2,p({type:Dq,comment:g})}}function f(){var p=s(),m=l(Pq);if(m){if(d(),!l(Iq))return a("property missing ':'");var g=l(Oq),y=p({type:Lq,property:VA(m[0].replace(zA,bu)),value:g?VA(g[0].replace(zA,bu)):bu});return l(Mq),y}}function h(){var p=[];u(p);for(var m;m=f();)m!==!1&&(p.push(m),u(p));return p}return c(),h()}function VA(t){return t?t.replace(Nq,bu):bu}function Fq(t,e){let n=null;if(!t||typeof t!="string")return n;const r=Bq(t),i=typeof e=="function";return r.forEach(s=>{if(s.type!=="declaration")return;const{property:o,value:a}=s;i?e(o,a,s):a&&(n=n||{},n[o]=a)}),n}const $q=/\d/,zq=["-","_","/","."];function Uq(t=""){if(!$q.test(t))return t!==t.toLowerCase()}function Hq(t){const e=[];let n="",r,i;for(const s of t){const o=zq.includes(s);if(o===!0){e.push(n),n="",r=void 0;continue}const a=Uq(s);if(i===!1){if(r===!1&&a===!0){e.push(n),n=s,r=a;continue}if(r===!0&&a===!1&&n.length>1){const l=n.at(-1);e.push(n.slice(0,Math.max(0,n.length-1))),n=l+s,r=a;continue}}n+=s,r=a,i=o}return e.push(n),e}function D8(t){return t?Hq(t).map(e=>Wq(e)).join(""):""}function Vq(t){return jq(D8(t||""))}function Wq(t){return t?t[0].toUpperCase()+t.slice(1):""}function jq(t){return t?t[0].toLowerCase()+t.slice(1):""}function np(t){if(!t)return{};const e={};function n(r,i){if(r.startsWith("-moz-")||r.startsWith("-webkit-")||r.startsWith("-ms-")||r.startsWith("-o-")){e[D8(r)]=i;return}if(r.startsWith("--")){e[r]=i;return}e[Vq(r)]=i}return Fq(t,n),e}function vp(...t){return(...e)=>{for(const n of t)typeof n=="function"&&n(...e)}}function qq(t,e){const n=RegExp(t,"g");return r=>{if(typeof r!="string")throw new TypeError(`expected an argument of type string, but got ${typeof r}`);return r.match(n)?r.replace(n,e):r}}const Kq=qq(/[A-Z]/,t=>`-${t.toLowerCase()}`);function Gq(t){if(!t||typeof t!="object"||Array.isArray(t))throw new TypeError(`expected an argument of type object, but got ${typeof t}`);return Object.keys(t).map(e=>`${Kq(e)}: ${t[e]};`).join(`
`)}function L8(t={}){return Gq(t).replace(`
`," ")}const Zq=["onabort","onanimationcancel","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncompositionend","oncompositionstart","oncompositionupdate","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel"],Xq=new Set(Zq);function Qq(t){return Xq.has(t)}function gr(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const r=t[n];if(r){for(const i of Object.keys(r)){const s=e[i],o=r[i],a=typeof s=="function",l=typeof o=="function";if(a&&Qq(i)){const c=s,u=o;e[i]=R8(c,u)}else if(a&&l)e[i]=vp(s,o);else if(i==="class"){const c=bx(s),u=bx(o);c&&u?e[i]=n0(s,o):c?e[i]=n0(s):u&&(e[i]=n0(o))}else if(i==="style"){const c=typeof s=="object",u=typeof o=="object",d=typeof s=="string",f=typeof o=="string";if(c&&u)e[i]={...s,...o};else if(c&&f){const h=np(o);e[i]={...s,...h}}else if(d&&u){const h=np(s);e[i]={...h,...o}}else if(d&&f){const h=np(s),p=np(o);e[i]={...h,...p}}else c?e[i]=s:u?e[i]=o:d?e[i]=s:f&&(e[i]=o)}else e[i]=o!==void 0?o:s}for(const i of Object.getOwnPropertySymbols(r)){const s=e[i],o=r[i];e[i]=o!==void 0?o:s}}}return typeof e.style=="object"&&(e.style=L8(e.style).replaceAll(`
`," ")),e.hidden===!1&&(e.hidden=void 0,delete e.hidden),e.disabled===!1&&(e.disabled=void 0,delete e.disabled),e}const B8=typeof window<"u"?window:void 0;function Yq(t){let e=t.activeElement;for(;e?.shadowRoot;){const n=e.shadowRoot.activeElement;if(n===e)break;e=n}return e}class F8 extends Map{#e=new Map;#t=ye(0);#n=ye(0);#r=Ya||-1;constructor(e){if(super(),e){for(var[n,r]of e)super.set(n,r);this.#n.v=super.size}}#i(e){return Ya===this.#r?ye(e):Nc(e)}has(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#i(0),n.set(e,r);else return E(this.#t),!1}return E(r),!0}forEach(e,n){this.#a(),super.forEach(e,n)}get(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#i(0),n.set(e,r);else{E(this.#t);return}}return E(r),super.get(e)}set(e,n){var r=this.#e,i=r.get(e),s=super.get(e),o=super.set(e,n),a=this.#t;if(i===void 0)i=this.#i(0),r.set(e,i),Q(this.#n,super.size),No(a);else if(s!==n){No(i);var l=a.reactions===null?null:new Set(a.reactions),c=l===null||!i.reactions?.every(u=>l.has(u));c&&No(a)}return o}delete(e){var n=this.#e,r=n.get(e),i=super.delete(e);return r!==void 0&&(n.delete(e),Q(this.#n,super.size),Q(r,-1),No(this.#t)),i}clear(){if(super.size!==0){super.clear();var e=this.#e;Q(this.#n,0);for(var n of e.values())Q(n,-1);No(this.#t),e.clear()}}#a(){E(this.#t);var e=this.#e;if(this.#n.v!==e.size){for(var n of super.keys())if(!e.has(n)){var r=this.#i(0);e.set(n,r)}}for([,r]of this.#e)E(r)}keys(){return E(this.#t),super.keys()}values(){return this.#a(),super.values()}entries(){return this.#a(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return E(this.#n),super.size}}class Jq{#e;#t;constructor(e={}){const{window:n=B8,document:r=n?.document}=e;n!==void 0&&(this.#e=r,this.#t=uk(i=>{const s=Sr(n,"focusin",i),o=Sr(n,"focusout",i);return()=>{s(),o()}}))}get current(){return this.#t?.(),this.#e?Yq(this.#e):null}}new Jq;function eK(t){return typeof t=="function"}class Gc{#e;#t;constructor(e){this.#e=e,this.#t=Symbol(e)}get key(){return this.#t}exists(){return X7(this.#t)}get(){const e=W2(this.#t);if(e===void 0)throw new Error(`Context "${this.#e}" not found`);return e}getOr(e){const n=W2(this.#t);return n===void 0?e:n}set(e){return Z7(this.#t,e)}}function tK(t,e){switch(t){case"post":nt(e);break;case"pre":g9(e);break}}function $8(t,e,n,r={}){const{lazy:i=!1}=r;let s=!i,o=Array.isArray(t)?[]:void 0;tK(e,()=>{const a=Array.isArray(t)?t.map(c=>c()):t();if(!s){s=!0,o=a;return}const l=ps(()=>n(a,o));return o=a,l})}function Mr(t,e,n){$8(t,"post",e,n)}function nK(t,e,n){$8(t,"pre",e,n)}Mr.pre=nK;function WA(t){return eK(t)?t():t}class rK{#e={width:0,height:0};#t=!1;#n;#r;#i;#a=oe(()=>(E(this.#o)?.(),this.getSize().width));#s=oe(()=>(E(this.#o)?.(),this.getSize().height));#o=oe(()=>{const e=WA(this.#r);if(e)return uk(n=>{if(!this.#i)return;const r=new this.#i.ResizeObserver(i=>{this.#t=!0;for(const s of i){const o=this.#n.box==="content-box"?s.contentBoxSize:s.borderBoxSize,a=Array.isArray(o)?o:[o];this.#e.width=a.reduce((l,c)=>Math.max(l,c.inlineSize),0),this.#e.height=a.reduce((l,c)=>Math.max(l,c.blockSize),0)}n()});return r.observe(e),()=>{this.#t=!1,r.disconnect()}})});constructor(e,n={box:"border-box"}){this.#i=n.window??B8,this.#n=n,this.#r=e,this.#e={width:0,height:0}}calculateSize(){const e=WA(this.#r);if(!e||!this.#i)return;const n=e.offsetWidth,r=e.offsetHeight;if(this.#n.box==="border-box")return{width:n,height:r};const i=this.#i.getComputedStyle(e),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),a=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth),l=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),c=n-s-a,u=r-o-l;return{width:c,height:u}}getSize(){return this.#t?this.#e:this.calculateSize()??this.#e}get current(){return E(this.#o)?.(),this.getSize()}get width(){return E(this.#a)}get height(){return E(this.#s)}}function gd(t){nt(()=>()=>{t()})}function iK(t){nt(()=>ps(()=>t()))}function sK(t,e){return setTimeout(e,t)}function Dk(t){Dc().then(t)}const oK=1,aK=9,lK=11;function wx(t){return Hm(t)&&t.nodeType===oK&&typeof t.nodeName=="string"}function z8(t){return Hm(t)&&t.nodeType===aK}function cK(t){return Hm(t)&&t.constructor?.name==="VisualViewport"}function uK(t){return Hm(t)&&t.nodeType!==void 0}function U8(t){return uK(t)&&t.nodeType===lK&&"host"in t}function dK(t,e){if(!t||!e||!wx(t)||!wx(e))return!1;const n=e.getRootNode?.();if(t===e||t.contains(e))return!0;if(n&&U8(n)){let r=e;for(;r;){if(t===r)return!0;r=r.parentNode||r.host}}return!1}function H8(t){return z8(t)?t:cK(t)?t.document:t?.ownerDocument??document}function V8(t){return U8(t)?V8(t.host):z8(t)?t.defaultView??window:wx(t)?t.ownerDocument?.defaultView??window:window}function fK(t){let e=t.activeElement;for(;e?.shadowRoot;){const n=e.shadowRoot.activeElement;if(n===e)break;e=n}return e}class Wb{element;#e=oe(()=>this.element.current?this.element.current.getRootNode()??document:document);get root(){return E(this.#e)}set root(e){Q(this.#e,e)}constructor(e){typeof e=="function"?this.element=$e(e):this.element=e}getDocument=()=>H8(this.root);getWindow=()=>this.getDocument().defaultView??window;getActiveElement=()=>fK(this.root);isActiveElement=e=>e===this.getActiveElement();getElementById(e){return this.root.getElementById(e)}querySelector=e=>this.root?this.root.querySelector(e):null;querySelectorAll=e=>this.root?this.root.querySelectorAll(e):[];setTimeout=(e,n)=>this.getWindow().setTimeout(e,n);clearTimeout=e=>this.getWindow().clearTimeout(e)}function Bs(t,e){return{[T9()]:n=>N8(t)?(t.current=n,ps(()=>e?.(n)),()=>{"isConnected"in n&&n.isConnected||(t.current=null,e?.(null))}):(t(n),ps(()=>e?.(n)),()=>{"isConnected"in n&&n.isConnected||(t(null),e?.(null))})}}function hK(t){return t?"true":"false"}function Df(t){return t?"":void 0}function Lk(t){return t?"open":"closed"}class pK{#e;#t;attrs;constructor(e){this.#e=e.getVariant?e.getVariant():null,this.#t=this.#e?`data-${this.#e}-`:`data-${e.component}-`,this.getAttr=this.getAttr.bind(this),this.selector=this.selector.bind(this),this.attrs=Object.fromEntries(e.parts.map(n=>[n,this.getAttr(n)]))}getAttr(e,n){return n?`data-${n}-${e}`:`${this.#t}${e}`}selector(e,n){return`[${this.getAttr(e,n)}]`}}function jb(t){const e=new pK(t);return{...e.attrs,selector:e.selector,getAttr:e.getAttr}}const W8="Enter",mK="Escape",j8=" ",q8=typeof document<"u",jA=gK();function gK(){return q8&&window?.navigator?.userAgent&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||window?.navigator?.maxTouchPoints>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function qA(t){return t instanceof HTMLElement}function df(t){return t instanceof Element}function yK(t){return t instanceof Element||t instanceof SVGElement}function W0(t){return t.pointerType==="touch"}function bK(t){return t.matches(":focus-visible")}function wK(t){return t!==null}class vK{#e;#t=null;constructor(e){this.#e=e,gd(()=>this.#n())}#n(){this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null)}run(e){this.#n();const n=this.#e.ref.current;if(n){if(typeof n.getAnimations!="function"){this.#r(e);return}this.#t=window.requestAnimationFrame(()=>{const r=n.getAnimations();if(r.length===0){this.#r(e);return}Promise.allSettled(r.map(i=>i.finished)).then(()=>{this.#r(e)})})}}#r(e){const n=()=>{e()};this.#e.afterTick?Dk(n):n()}}class Xp{#e;#t;#n;#r=ye(!1);constructor(e){this.#e=e,Q(this.#r,e.open.current,!0),this.#t=e.enabled??!0,this.#n=new vK({ref:this.#e.ref,afterTick:this.#e.open}),Mr(()=>this.#e.open.current,n=>{n&&Q(this.#r,!0),this.#t&&this.#n.run(()=>{n===this.#e.open.current&&(this.#e.open.current||Q(this.#r,!1),this.#e.onComplete?.())})})}get shouldRender(){return E(this.#r)}}function vn(){}function yl(t,e){return`bits-${t}`}const xK=jb({component:"dialog",parts:["content","trigger","overlay","title","description","close","cancel","action"]}),Ju=new Gc("Dialog.Root | AlertDialog.Root");class Bk{static create(e){const n=Ju.getOr(null);return Ju.set(new Bk(e,n))}opts;#e=ye(null);get triggerNode(){return E(this.#e)}set triggerNode(e){Q(this.#e,e,!0)}#t=ye(null);get contentNode(){return E(this.#t)}set contentNode(e){Q(this.#t,e,!0)}#n=ye(null);get overlayNode(){return E(this.#n)}set overlayNode(e){Q(this.#n,e,!0)}#r=ye(null);get descriptionNode(){return E(this.#r)}set descriptionNode(e){Q(this.#r,e,!0)}#i=ye(void 0);get contentId(){return E(this.#i)}set contentId(e){Q(this.#i,e,!0)}#a=ye(void 0);get titleId(){return E(this.#a)}set titleId(e){Q(this.#a,e,!0)}#s=ye(void 0);get triggerId(){return E(this.#s)}set triggerId(e){Q(this.#s,e,!0)}#o=ye(void 0);get descriptionId(){return E(this.#o)}set descriptionId(e){Q(this.#o,e,!0)}#l=ye(null);get cancelNode(){return E(this.#l)}set cancelNode(e){Q(this.#l,e,!0)}#c=ye(0);get nestedOpenCount(){return E(this.#c)}set nestedOpenCount(e){Q(this.#c,e,!0)}depth;parent;contentPresence;overlayPresence;constructor(e,n){this.opts=e,this.parent=n,this.depth=n?n.depth+1:0,this.handleOpen=this.handleOpen.bind(this),this.handleClose=this.handleClose.bind(this),this.contentPresence=new Xp({ref:$e(()=>this.contentNode),open:this.opts.open,enabled:!0,onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),this.overlayPresence=new Xp({ref:$e(()=>this.overlayNode),open:this.opts.open,enabled:!0}),Mr(()=>this.opts.open.current,r=>{this.parent&&(r?this.parent.incrementNested():this.parent.decrementNested())},{lazy:!0}),gd(()=>{this.opts.open.current&&this.parent?.decrementNested()})}handleOpen(){this.opts.open.current||(this.opts.open.current=!0)}handleClose(){this.opts.open.current&&(this.opts.open.current=!1)}getBitsAttr=e=>xK.getAttr(e,this.opts.variant.current);incrementNested(){this.nestedOpenCount++,this.parent?.incrementNested()}decrementNested(){this.nestedOpenCount!==0&&(this.nestedOpenCount--,this.parent?.decrementNested())}#u=oe(()=>({"data-state":Lk(this.opts.open.current)}));get sharedProps(){return E(this.#u)}set sharedProps(e){Q(this.#u,e)}}class Fk{static create(e){return new Fk(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Bs(this.opts.ref),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onclick(e){this.opts.disabled.current||e.button>0||this.root.handleClose()}onkeydown(e){this.opts.disabled.current||(e.key===j8||e.key===W8)&&(e.preventDefault(),this.root.handleClose())}#e=oe(()=>({id:this.opts.id.current,[this.root.getBitsAttr(this.opts.variant.current)]:"",onclick:this.onclick,onkeydown:this.onkeydown,disabled:this.opts.disabled.current?!0:void 0,tabindex:0,...this.root.sharedProps,...this.attachment}));get props(){return E(this.#e)}set props(e){Q(this.#e,e)}}class $k{static create(e){return new $k(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.root.titleId=this.opts.id.current,this.attachment=Bs(this.opts.ref),Mr.pre(()=>this.opts.id.current,r=>{this.root.titleId=r})}#e=oe(()=>({id:this.opts.id.current,role:"heading","aria-level":this.opts.level.current,[this.root.getBitsAttr("title")]:"",...this.root.sharedProps,...this.attachment}));get props(){return E(this.#e)}set props(e){Q(this.#e,e)}}class zk{static create(e){return new zk(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.root.descriptionId=this.opts.id.current,this.attachment=Bs(this.opts.ref,r=>{this.root.descriptionNode=r}),Mr.pre(()=>this.opts.id.current,r=>{this.root.descriptionId=r})}#e=oe(()=>({id:this.opts.id.current,[this.root.getBitsAttr("description")]:"",...this.root.sharedProps,...this.attachment}));get props(){return E(this.#e)}set props(e){Q(this.#e,e)}}class Uk{static create(e){return new Uk(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Bs(this.opts.ref,r=>{this.root.contentNode=r,this.root.contentId=r?.id})}#e=oe(()=>({open:this.root.opts.open.current}));get snippetProps(){return E(this.#e)}set snippetProps(e){Q(this.#e,e)}#t=oe(()=>({id:this.opts.id.current,role:this.root.opts.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-modal":"true","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.getBitsAttr("content")]:"",style:{pointerEvents:"auto",outline:this.root.opts.variant.current==="alert-dialog"?"none":void 0,"--bits-dialog-depth":this.root.depth,"--bits-dialog-nested-count":this.root.nestedOpenCount},tabindex:this.root.opts.variant.current==="alert-dialog"?-1:void 0,"data-nested-open":Df(this.root.nestedOpenCount>0),"data-nested":Df(this.root.parent!==null),...this.root.sharedProps,...this.attachment}));get props(){return E(this.#t)}set props(e){Q(this.#t,e)}get shouldRender(){return this.root.contentPresence.shouldRender}}class Hk{static create(e){return new Hk(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Bs(this.opts.ref,r=>this.root.overlayNode=r)}#e=oe(()=>({open:this.root.opts.open.current}));get snippetProps(){return E(this.#e)}set snippetProps(e){Q(this.#e,e)}#t=oe(()=>({id:this.opts.id.current,[this.root.getBitsAttr("overlay")]:"",style:{pointerEvents:"auto","--bits-dialog-depth":this.root.depth,"--bits-dialog-nested-count":this.root.nestedOpenCount},"data-nested-open":Df(this.root.nestedOpenCount>0),"data-nested":Df(this.root.parent!==null),...this.root.sharedProps,...this.attachment}));get props(){return E(this.#t)}set props(e){Q(this.#t,e)}get shouldRender(){return this.root.overlayPresence.shouldRender}}var SK=Ce("<div><!></div>");function kK(t,e){const n=sa();wt(e,!0);let r=ce(e,"id",19,()=>yl(n)),i=ce(e,"ref",15,null),s=ce(e,"level",3,2),o=Ni(e,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const a=$k.create({id:$e(()=>r()),level:$e(()=>s()),ref:$e(()=>i(),h=>i(h))}),l=oe(()=>gr(o,a.props));var c=ze(),u=Te(c);{var d=h=>{var p=ze(),m=Te(p);kt(m,()=>e.child,()=>({props:E(l)})),Y(h,p)},f=h=>{var p=SK();kr(p,()=>({...E(l)}));var m=ie(p);kt(m,()=>e.children??Bt),Y(h,p)};He(u,h=>{e.child?h(d):h(f,!1)})}Y(t,c),vt()}function EK(t,e){var n=ze(),r=Te(n);D9(r,()=>e.children,i=>{var s=ze(),o=Te(s);kt(o,()=>e.children??Bt),Y(i,s)}),Y(t,n)}const TK=new Gc("BitsConfig");function CK(){const t=new _K(null,{});return TK.getOr(t).opts}class _K{opts;constructor(e,n){const r=AK(e,n);this.opts={defaultPortalTo:r(i=>i.defaultPortalTo),defaultLocale:r(i=>i.defaultLocale)}}}function AK(t,e){return n=>$e(()=>{const i=n(e)?.current;if(i!==void 0)return i;if(t!==null)return n(t.opts)?.current})}function PK(t,e){return n=>{const r=CK();return $e(()=>{const i=n();if(i!==void 0)return i;const s=t(r).current;return s!==void 0?s:e})}}const IK=PK(t=>t.defaultPortalTo,"body");function ja(t,e){wt(e,!0);const n=IK(()=>e.to),r=Q7();let i=oe(s);function s(){if(!q8||e.disabled)return null;let d=null;return typeof n.current=="string"?d=document.querySelector(n.current):d=n.current,d}let o;function a(){o&&(gp(o),o=null)}Mr([()=>E(i),()=>e.disabled],([d,f])=>{if(!d||f){a();return}return o=Rb(EK,{target:d,props:{children:e.children},context:r}),()=>{a()}});var l=ze(),c=Te(l);{var u=d=>{var f=ze(),h=Te(f);kt(h,()=>e.children??Bt),Y(d,f)};He(c,d=>{e.disabled&&d(u)})}Y(t,l),vt()}function KA(t,e=500){let n=null;const r=(...i)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{t(...i)},e)};return r.destroy=()=>{n!==null&&(clearTimeout(n),n=null)},r}function K8(t,e){return t===e||t.contains(e)}function G8(t){return t?.ownerDocument??document}function OK(t,e){const{clientX:n,clientY:r}=t,i=e.getBoundingClientRect();return n<i.left||n>i.right||r<i.top||r>i.bottom}var Z8=["input:not([inert]):not([inert] *)","select:not([inert]):not([inert] *)","textarea:not([inert]):not([inert] *)","a[href]:not([inert]):not([inert] *)","button:not([inert]):not([inert] *)","[tabindex]:not(slot):not([inert]):not([inert] *)","audio[controls]:not([inert]):not([inert] *)","video[controls]:not([inert]):not([inert] *)",'[contenteditable]:not([contenteditable="false"]):not([inert]):not([inert] *)',"details>summary:first-of-type:not([inert]):not([inert] *)","details:not([inert]):not([inert] *)"],j0=Z8.join(","),X8=typeof Element>"u",ed=X8?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,q0=!X8&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},K0=function(e,n){var r;n===void 0&&(n=!0);var i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=i===""||i==="true",o=s||n&&e&&(typeof e.closest=="function"?e.closest("[inert]"):K0(e.parentNode));return o},MK=function(e){var n,r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return r===""||r==="true"},Q8=function(e,n,r){if(K0(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(j0));return n&&ed.call(e,j0)&&i.unshift(e),i=i.filter(r),i},G0=function(e,n,r){for(var i=[],s=Array.from(e);s.length;){var o=s.shift();if(!K0(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=G0(l,!0,r);r.flatten?i.push.apply(i,c):i.push({scopeParent:o,candidates:c})}else{var u=ed.call(o,j0);u&&r.filter(o)&&(n||!e.includes(o))&&i.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!K0(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var h=G0(d===!0?o.children:d.children,!0,r);r.flatten?i.push.apply(i,h):i.push({scopeParent:o,candidates:h})}else s.unshift.apply(s,o.children)}}return i},Y8=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},J8=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||MK(e))&&!Y8(e)?0:e.tabIndex},NK=function(e,n){var r=J8(e);return r<0&&n&&!Y8(e)?0:r},RK=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},eN=function(e){return e.tagName==="INPUT"},DK=function(e){return eN(e)&&e.type==="hidden"},LK=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return n},BK=function(e,n){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===n)return e[r]},FK=function(e){if(!e.name)return!0;var n=e.form||q0(e),r=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=r(window.CSS.escape(e.name));else try{i=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=BK(i,e.form);return!s||s===e},$K=function(e){return eN(e)&&e.type==="radio"},zK=function(e){return $K(e)&&!FK(e)},UK=function(e){var n,r=e&&q0(e),i=(n=r)===null||n===void 0?void 0:n.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&i;){var c,u,d;r=q0(i),i=(c=r)===null||c===void 0?void 0:c.host,s=!!((u=i)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(i))}}return s},GA=function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height;return r===0&&i===0},HK=function(e,n){var r=n.displayCheck,i=n.getShadowRoot;if(r==="full-native"&&"checkVisibility"in e){var s=e.checkVisibility({checkOpacity:!1,opacityProperty:!1,contentVisibilityAuto:!0,visibilityProperty:!0,checkVisibilityCSS:!0});return!s}if(getComputedStyle(e).visibility==="hidden")return!0;var o=ed.call(e,"details>summary:first-of-type"),a=o?e.parentElement:e;if(ed.call(a,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="full-native"||r==="legacy-full"){if(typeof i=="function"){for(var l=e;e;){var c=e.parentElement,u=q0(e);if(c&&!c.shadowRoot&&i(c)===!0)return GA(e);e.assignedSlot?e=e.assignedSlot:!c&&u!==e.ownerDocument?e=u.host:e=c}e=l}if(UK(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return GA(e);return!1},VK=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var i=n.children.item(r);if(i.tagName==="LEGEND")return ed.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},Z0=function(e,n){return!(n.disabled||DK(n)||HK(n,e)||LK(n)||VK(n))},vx=function(e,n){return!(zK(n)||J8(n)<0||!Z0(e,n))},WK=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},tN=function(e){var n=[],r=[];return e.forEach(function(i,s){var o=!!i.scopeParent,a=o?i.scopeParent:i,l=NK(a,o),c=o?tN(i.candidates):a;l===0?o?n.push.apply(n,c):n.push(a):r.push({documentOrder:s,tabIndex:l,item:i,isScope:o,content:c})}),r.sort(RK).reduce(function(i,s){return s.isScope?i.push.apply(i,s.content):i.push(s.content),i},[]).concat(n)},jK=function(e,n){n=n||{};var r;return n.getShadowRoot?r=G0([e],n.includeContainer,{filter:vx.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:WK}):r=Q8(e,n.includeContainer,vx.bind(null,n)),tN(r)},qK=function(e,n){n=n||{};var r;return n.getShadowRoot?r=G0([e],n.includeContainer,{filter:Z0.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):r=Q8(e,n.includeContainer,Z0.bind(null,n)),r},KK=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return ed.call(e,j0)===!1?!1:vx(n,e)},GK=Z8.concat("iframe:not([inert]):not([inert] *)").join(","),ZK=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return ed.call(e,GK)===!1?!1:Z0(n,e)};const XK="data-context-menu-trigger",QK="data-context-menu-content";jb({component:"menu",parts:["trigger","content","sub-trigger","item","group","group-heading","checkbox-group","checkbox-item","radio-group","radio-item","separator","sub-content","arrow"]});globalThis.bitsDismissableLayers??=new Map;class Vk{static create(e){return new Vk(e)}opts;#e;#t;#n={pointerdown:!1};#r=!1;#i=!1;#a=void 0;#s;#o=vn;constructor(e){this.opts=e,this.#t=e.interactOutsideBehavior,this.#e=e.onInteractOutside,this.#s=e.onFocusOutside,nt(()=>{this.#a=G8(this.opts.ref.current)});let n=vn;const r=()=>{this.#m(),globalThis.bitsDismissableLayers.delete(this),this.#d.destroy(),n()};Mr([()=>this.opts.enabled.current,()=>this.opts.ref.current],()=>{if(!(!this.opts.enabled.current||!this.opts.ref.current))return sK(1,()=>{this.opts.ref.current&&(globalThis.bitsDismissableLayers.set(this,this.#t),n(),n=this.#c())}),r}),gd(()=>{this.#m.destroy(),globalThis.bitsDismissableLayers.delete(this),this.#d.destroy(),this.#o(),n()})}#l=e=>{e.defaultPrevented||this.opts.ref.current&&Dk(()=>{!this.opts.ref.current||this.#f(e.target)||e.target&&!this.#i&&this.#s.current?.(e)})};#c(){return vp(Sr(this.#a,"pointerdown",vp(this.#h,this.#g),{capture:!0}),Sr(this.#a,"pointerdown",vp(this.#p,this.#d)),Sr(this.#a,"focusin",this.#l))}#u=e=>{let n=e;n.defaultPrevented&&(n=ZA(e)),this.#e.current(e)};#d=KA(e=>{if(!this.opts.ref.current){this.#o();return}const n=this.opts.isValidEvent.current(e,this.opts.ref.current)||eG(e,this.opts.ref.current);if(!this.#r||this.#y()||!n){this.#o();return}let r=e;if(r.defaultPrevented&&(r=ZA(r)),this.#t.current!=="close"&&this.#t.current!=="defer-otherwise-close"){this.#o();return}e.pointerType==="touch"?(this.#o(),this.#o=Sr(this.#a,"click",this.#u,{once:!0})):this.#e.current(r)},10);#h=e=>{this.#n[e.type]=!0};#p=e=>{this.#n[e.type]=!1};#g=()=>{this.opts.ref.current&&(this.#r=JK(this.opts.ref.current))};#f=e=>this.opts.ref.current?K8(this.opts.ref.current,e):!1;#m=KA(()=>{for(const e in this.#n)this.#n[e]=!1;this.#r=!1},20);#y(){return Object.values(this.#n).some(Boolean)}#w=()=>{this.#i=!0};#b=()=>{this.#i=!1};props={onfocuscapture:this.#w,onblurcapture:this.#b}}function YK(t=[...globalThis.bitsDismissableLayers]){return t.findLast(([e,{current:n}])=>n==="close"||n==="ignore")}function JK(t){const e=[...globalThis.bitsDismissableLayers],n=YK(e);if(n)return n[0].opts.ref.current===t;const[r]=e[0];return r.opts.ref.current===t}function eG(t,e){const n=t.target;if(!yK(n))return!1;const r=!!n.closest(`[${XK}]`);if("button"in t&&t.button>0&&!r)return!1;if("button"in t&&t.button===0&&r)return!0;const i=!!e.closest(`[${QK}]`);return r&&i?!1:G8(n).documentElement.contains(n)&&!K8(e,n)&&OK(t,e)}function ZA(t){const e=t.currentTarget,n=t.target;let r;t instanceof PointerEvent?r=new PointerEvent(t.type,t):r=new PointerEvent("pointerdown",t);let i=!1;return new Proxy(r,{get:(o,a)=>a==="currentTarget"?e:a==="target"?n:a==="preventDefault"?()=>{i=!0,typeof o.preventDefault=="function"&&o.preventDefault()}:a==="defaultPrevented"?i:a in o?o[a]:t[a]})}function nN(t,e){wt(e,!0);let n=ce(e,"interactOutsideBehavior",3,"close"),r=ce(e,"onInteractOutside",3,vn),i=ce(e,"onFocusOutside",3,vn),s=ce(e,"isValidEvent",3,()=>!1);const o=Vk.create({id:$e(()=>e.id),interactOutsideBehavior:$e(()=>n()),onInteractOutside:$e(()=>r()),enabled:$e(()=>e.enabled),onFocusOutside:$e(()=>i()),isValidEvent:$e(()=>s()),ref:e.ref});var a=ze(),l=Te(a);kt(l,()=>e.children??Bt,()=>({props:o.props})),Y(t,a),vt()}globalThis.bitsEscapeLayers??=new Map;class Wk{static create(e){return new Wk(e)}opts;domContext;constructor(e){this.opts=e,this.domContext=new Wb(this.opts.ref);let n=vn;Mr(()=>e.enabled.current,r=>(r&&(globalThis.bitsEscapeLayers.set(this,e.escapeKeydownBehavior),n=this.#e()),()=>{n(),globalThis.bitsEscapeLayers.delete(this)}))}#e=()=>Sr(this.domContext.getDocument(),"keydown",this.#t,{passive:!1});#t=e=>{if(e.key!==mK||!tG(this))return;const n=new KeyboardEvent(e.type,e);e.preventDefault();const r=this.opts.escapeKeydownBehavior.current;r!=="close"&&r!=="defer-otherwise-close"||this.opts.onEscapeKeydown.current(n)}}function tG(t){const e=[...globalThis.bitsEscapeLayers],n=e.findLast(([i,{current:s}])=>s==="close"||s==="ignore");if(n)return n[0]===t;const[r]=e[0];return r===t}function rN(t,e){wt(e,!0);let n=ce(e,"escapeKeydownBehavior",3,"close"),r=ce(e,"onEscapeKeydown",3,vn);Wk.create({escapeKeydownBehavior:$e(()=>n()),onEscapeKeydown:$e(()=>r()),enabled:$e(()=>e.enabled),ref:e.ref});var i=ze(),s=Te(i);kt(s,()=>e.children??Bt),Y(t,i),vt()}class jk{static instance;#e=Rs([]);#t=new WeakMap;#n=new WeakMap;static getInstance(){return this.instance||(this.instance=new jk),this.instance}register(e){const n=this.getActive();n&&n!==e&&n.pause();const r=document.activeElement;r&&r!==document.body&&this.#n.set(e,r),this.#e.current=this.#e.current.filter(i=>i!==e),this.#e.current.unshift(e)}unregister(e){this.#e.current=this.#e.current.filter(r=>r!==e);const n=this.getActive();n&&n.resume()}getActive(){return this.#e.current[0]}setFocusMemory(e,n){this.#t.set(e,n)}getFocusMemory(e){return this.#t.get(e)}isActiveScope(e){return this.getActive()===e}setPreFocusMemory(e,n){this.#n.set(e,n)}getPreFocusMemory(e){return this.#n.get(e)}clearPreFocusMemory(e){this.#n.delete(e)}}class qk{#e=!1;#t=null;#n=jk.getInstance();#r=[];#i;constructor(e){this.#i=e}get paused(){return this.#e}pause(){this.#e=!0}resume(){this.#e=!1}#a(){for(const e of this.#r)e();this.#r=[]}mount(e){this.#t&&this.unmount(),this.#t=e,this.#n.register(this),this.#l(),this.#s()}unmount(){this.#t&&(this.#a(),this.#o(),this.#n.unregister(this),this.#n.clearPreFocusMemory(this),this.#t=null)}#s(){if(!this.#t)return;const e=new CustomEvent("focusScope.onOpenAutoFocus",{bubbles:!1,cancelable:!0});this.#i.onOpenAutoFocus.current(e),e.defaultPrevented||requestAnimationFrame(()=>{if(!this.#t)return;const n=this.#u();n?(n.focus(),this.#n.setFocusMemory(this,n)):this.#t.focus()})}#o(){const e=new CustomEvent("focusScope.onCloseAutoFocus",{bubbles:!1,cancelable:!0});if(this.#i.onCloseAutoFocus.current?.(e),!e.defaultPrevented){const n=this.#n.getPreFocusMemory(this);if(n&&document.contains(n))try{n.focus()}catch{document.body.focus()}}}#l(){if(!this.#t||!this.#i.trap.current)return;const e=this.#t,n=e.ownerDocument,r=o=>{if(this.#e||!this.#n.isActiveScope(this))return;const a=o.target;if(!a)return;if(e.contains(a))this.#n.setFocusMemory(this,a);else{const c=this.#n.getFocusMemory(this);if(c&&e.contains(c)&&ZK(c))o.preventDefault(),c.focus();else{const u=this.#u(),d=this.#d()[0];(u||d||e).focus()}}},i=o=>{if(!this.#i.loop||this.#e||o.key!=="Tab"||!this.#n.isActiveScope(this))return;const a=this.#c();if(a.length<2)return;const l=a[0],c=a[a.length-1];!o.shiftKey&&n.activeElement===c?(o.preventDefault(),l.focus()):o.shiftKey&&n.activeElement===l&&(o.preventDefault(),c.focus())};this.#r.push(Sr(n,"focusin",r,{capture:!0}),Sr(e,"keydown",i));const s=new MutationObserver(()=>{const o=this.#n.getFocusMemory(this);if(o&&!e.contains(o)){const a=this.#u(),l=this.#d()[0],c=a||l;c?(c.focus(),this.#n.setFocusMemory(this,c)):e.focus()}});s.observe(e,{childList:!0,subtree:!0}),this.#r.push(()=>s.disconnect())}#c(){return this.#t?jK(this.#t,{includeContainer:!1,getShadowRoot:!0}):[]}#u(){return this.#c()[0]||null}#d(){return this.#t?qK(this.#t,{includeContainer:!1,getShadowRoot:!0}):[]}static use(e){let n=null;return Mr([()=>e.ref.current,()=>e.enabled.current],([r,i])=>{r&&i?(n||(n=new qk(e)),n.mount(r)):n&&(n.unmount(),n=null)}),gd(()=>{n?.unmount()}),{get props(){return{tabindex:-1}}}}}function iN(t,e){wt(e,!0);let n=ce(e,"enabled",3,!1),r=ce(e,"trapFocus",3,!1),i=ce(e,"loop",3,!1),s=ce(e,"onCloseAutoFocus",3,vn),o=ce(e,"onOpenAutoFocus",3,vn);const a=qk.use({enabled:$e(()=>n()),trap:$e(()=>r()),loop:i(),onCloseAutoFocus:$e(()=>s()),onOpenAutoFocus:$e(()=>o()),ref:e.ref});var l=ze(),c=Te(l);kt(c,()=>e.focusScope??Bt,()=>({props:a.props})),Y(t,l),vt()}globalThis.bitsTextSelectionLayers??=new Map;class Kk{static create(e){return new Kk(e)}opts;domContext;#e=vn;constructor(e){this.opts=e,this.domContext=new Wb(e.ref);let n=vn;Mr(()=>this.opts.enabled.current,r=>(r&&(globalThis.bitsTextSelectionLayers.set(this,this.opts.enabled),n(),n=this.#t()),()=>{n(),this.#r(),globalThis.bitsTextSelectionLayers.delete(this)}))}#t(){return vp(Sr(this.domContext.getDocument(),"pointerdown",this.#n),Sr(this.domContext.getDocument(),"pointerup",R8(this.#r,this.opts.onPointerUp.current)))}#n=e=>{const n=this.opts.ref.current,r=e.target;!qA(n)||!qA(r)||!this.opts.enabled.current||!rG(this)||!dK(n,r)||(this.opts.onPointerDown.current(e),!e.defaultPrevented&&(this.#e=nG(n,this.domContext.getDocument().body)))};#r=()=>{this.#e(),this.#e=vn}}const XA=t=>t.style.userSelect||t.style.webkitUserSelect;function nG(t,e){const n=XA(e),r=XA(t);return _g(e,"none"),_g(t,"text"),()=>{_g(e,n),_g(t,r)}}function _g(t,e){t.style.userSelect=e,t.style.webkitUserSelect=e}function rG(t){const e=[...globalThis.bitsTextSelectionLayers];if(!e.length)return!1;const n=e.at(-1);return n?n[0]===t:!1}function sN(t,e){wt(e,!0);let n=ce(e,"preventOverflowTextSelection",3,!0),r=ce(e,"onPointerDown",3,vn),i=ce(e,"onPointerUp",3,vn);Kk.create({id:$e(()=>e.id),onPointerDown:$e(()=>r()),onPointerUp:$e(()=>i()),enabled:$e(()=>e.enabled&&n()),ref:e.ref});var s=ze(),o=Te(s);kt(o,()=>e.children??Bt),Y(t,s),vt()}globalThis.bitsIdCounter??={current:0};function Gk(t="bits"){return globalThis.bitsIdCounter.current++,`${t}-${globalThis.bitsIdCounter.current}`}class iG{#e;#t=0;#n=ye();#r;constructor(e){this.#e=e}#i(){this.#t-=1,this.#r&&this.#t<=0&&(this.#r(),Q(this.#n,void 0),this.#r=void 0)}get(...e){return this.#t+=1,E(this.#n)===void 0&&(this.#r=y9(()=>{Q(this.#n,this.#e(...e),!0)})),nt(()=>()=>{this.#i()}),E(this.#n)}}const a0=new F8;let Ag=ye(null),qv=null,Nh=null,Rh=!1;const QA=$e(()=>{for(const t of a0.values())if(t)return!0;return!1});let Kv=null;const sG=new iG(()=>{function t(){document.body.setAttribute("style",E(Ag)??""),document.body.style.removeProperty("--scrollbar-width"),jA&&qv?.(),Q(Ag,null)}function e(){Nh!==null&&(window.clearTimeout(Nh),Nh=null)}function n(i,s){e(),Rh=!0,Kv=Date.now();const o=Kv,a=()=>{Nh=null,Kv===o&&(oN(a0)?Rh=!1:(Rh=!1,s()))},l=i===null?24:i;Nh=window.setTimeout(a,l)}function r(){E(Ag)===null&&a0.size===0&&!Rh&&Q(Ag,document.body.getAttribute("style"),!0)}return Mr(()=>QA.current,()=>{if(!QA.current)return;r(),Rh=!1;const i=getComputedStyle(document.documentElement),s=getComputedStyle(document.body),o=i.scrollbarGutter?.includes("stable")||s.scrollbarGutter?.includes("stable"),a=window.innerWidth-document.documentElement.clientWidth,c={padding:Number.parseInt(s.paddingRight??"0",10)+a,margin:Number.parseInt(s.marginRight??"0",10)};a>0&&!o&&(document.body.style.paddingRight=`${c.padding}px`,document.body.style.marginRight=`${c.margin}px`,document.body.style.setProperty("--scrollbar-width",`${a}px`)),document.body.style.overflow="hidden",jA&&(qv=Sr(document,"touchmove",u=>{u.target===document.documentElement&&(u.touches.length>1||u.preventDefault())},{passive:!1})),Dk(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})}),gd(()=>()=>{qv?.()}),{get lockMap(){return a0},resetBodyStyle:t,scheduleCleanupIfNoNewLocks:n,cancelPendingCleanup:e,ensureInitialStyleCaptured:r}});class oG{#e=Gk();#t;#n=()=>null;#r;locked;constructor(e,n=()=>null){this.#t=e,this.#n=n,this.#r=sG.get(),this.#r&&(this.#r.cancelPendingCleanup(),this.#r.ensureInitialStyleCaptured(),this.#r.lockMap.set(this.#e,this.#t??!1),this.locked=$e(()=>this.#r.lockMap.get(this.#e)??!1,r=>this.#r.lockMap.set(this.#e,r)),gd(()=>{if(this.#r.lockMap.delete(this.#e),oN(this.#r.lockMap))return;const r=this.#n();this.#r.scheduleCleanupIfNoNewLocks(r,()=>{this.#r.resetBodyStyle()})}))}}function oN(t){for(const[e,n]of t)if(n)return!0;return!1}function X0(t,e){wt(e,!0);let n=ce(e,"preventScroll",3,!0),r=ce(e,"restoreScrollDelay",3,null);n()&&new oG(n(),()=>r()),vt()}var aG=Ce("<div><!></div>");function lG(t,e){const n=sa();wt(e,!0);let r=ce(e,"id",19,()=>yl(n)),i=ce(e,"forceMount",3,!1),s=ce(e,"ref",15,null),o=Ni(e,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const a=Hk.create({id:$e(()=>r()),ref:$e(()=>s(),f=>s(f))}),l=oe(()=>gr(o,a.props));var c=ze(),u=Te(c);{var d=f=>{var h=ze(),p=Te(h);{var m=y=>{var b=ze(),x=Te(b);{let C=oe(()=>({props:gr(E(l)),...a.snippetProps}));kt(x,()=>e.child,()=>E(C))}Y(y,b)},g=y=>{var b=aG();kr(b,C=>({...C}),[()=>gr(E(l))]);var x=ie(b);kt(x,()=>e.children??Bt,()=>a.snippetProps),Y(y,b)};He(p,y=>{e.child?y(m):y(g,!1)})}Y(f,h)};He(u,f=>{(a.shouldRender||i())&&f(d)})}Y(t,c),vt()}var cG=Ce("<div><!></div>");function uG(t,e){const n=sa();wt(e,!0);let r=ce(e,"id",19,()=>yl(n)),i=ce(e,"ref",15,null),s=Ni(e,["$$slots","$$events","$$legacy","id","children","child","ref"]);const o=zk.create({id:$e(()=>r()),ref:$e(()=>i(),f=>i(f))}),a=oe(()=>gr(s,o.props));var l=ze(),c=Te(l);{var u=f=>{var h=ze(),p=Te(h);kt(p,()=>e.child,()=>({props:E(a)})),Y(f,h)},d=f=>{var h=cG();kr(h,()=>({...E(a)}));var p=ie(h);kt(p,()=>e.children??Bt),Y(f,h)};He(c,f=>{e.child?f(u):f(d,!1)})}Y(t,l),vt()}const dG=["top","right","bottom","left"],Bc=Math.min,as=Math.max,Q0=Math.round,Pg=Math.floor,Zo=t=>({x:t,y:t}),fG={left:"right",right:"left",bottom:"top",top:"bottom"},hG={start:"end",end:"start"};function xx(t,e,n){return as(t,Bc(e,n))}function al(t,e){return typeof t=="function"?t(e):t}function ll(t){return t.split("-")[0]}function ih(t){return t.split("-")[1]}function Zk(t){return t==="x"?"y":"x"}function Xk(t){return t==="y"?"height":"width"}const pG=new Set(["top","bottom"]);function Fo(t){return pG.has(ll(t))?"y":"x"}function Qk(t){return Zk(Fo(t))}function mG(t,e,n){n===void 0&&(n=!1);const r=ih(t),i=Qk(t),s=Xk(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Y0(o)),[o,Y0(o)]}function gG(t){const e=Y0(t);return[Sx(t),e,Sx(e)]}function Sx(t){return t.replace(/start|end/g,e=>hG[e])}const YA=["left","right"],JA=["right","left"],yG=["top","bottom"],bG=["bottom","top"];function wG(t,e,n){switch(t){case"top":case"bottom":return n?e?JA:YA:e?YA:JA;case"left":case"right":return e?yG:bG;default:return[]}}function vG(t,e,n,r){const i=ih(t);let s=wG(ll(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(Sx)))),s}function Y0(t){return t.replace(/left|right|bottom|top/g,e=>fG[e])}function xG(t){return{top:0,right:0,bottom:0,left:0,...t}}function aN(t){return typeof t!="number"?xG(t):{top:t,right:t,bottom:t,left:t}}function J0(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}function eP(t,e,n){let{reference:r,floating:i}=t;const s=Fo(e),o=Qk(e),a=Xk(o),l=ll(e),c=s==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,f=r[a]/2-i[a]/2;let h;switch(l){case"top":h={x:u,y:r.y-i.height};break;case"bottom":h={x:u,y:r.y+r.height};break;case"right":h={x:r.x+r.width,y:d};break;case"left":h={x:r.x-i.width,y:d};break;default:h={x:r.x,y:r.y}}switch(ih(e)){case"start":h[o]-=f*(n&&c?-1:1);break;case"end":h[o]+=f*(n&&c?-1:1);break}return h}const SG=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:d}=eP(c,r,l),f=r,h={},p=0;for(let m=0;m<a.length;m++){const{name:g,fn:y}=a[m],{x:b,y:x,data:C,reset:P}=await y({x:u,y:d,initialPlacement:r,placement:f,strategy:i,middlewareData:h,rects:c,platform:o,elements:{reference:t,floating:e}});u=b??u,d=x??d,h={...h,[g]:{...h[g],...C}},P&&p<=50&&(p++,typeof P=="object"&&(P.placement&&(f=P.placement),P.rects&&(c=P.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):P.rects),{x:u,y:d}=eP(c,f,l)),m=-1)}return{x:u,y:d,placement:f,strategy:i,middlewareData:h}};async function Qp(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=al(e,t),p=aN(h),g=a[f?d==="floating"?"reference":"floating":d],y=J0(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(g)))==null||n?g:g.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),b=d==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,x=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),C=await(s.isElement==null?void 0:s.isElement(x))?await(s.getScale==null?void 0:s.getScale(x))||{x:1,y:1}:{x:1,y:1},P=J0(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:x,strategy:l}):b);return{top:(y.top-P.top+p.top)/C.y,bottom:(P.bottom-y.bottom+p.bottom)/C.y,left:(y.left-P.left+p.left)/C.x,right:(P.right-y.right+p.right)/C.x}}const kG=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=al(t,e)||{};if(c==null)return{};const d=aN(u),f={x:n,y:r},h=Qk(i),p=Xk(h),m=await o.getDimensions(c),g=h==="y",y=g?"top":"left",b=g?"bottom":"right",x=g?"clientHeight":"clientWidth",C=s.reference[p]+s.reference[h]-f[h]-s.floating[p],P=f[h]-s.reference[h],S=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let _=S?S[x]:0;(!_||!await(o.isElement==null?void 0:o.isElement(S)))&&(_=a.floating[x]||s.floating[p]);const k=C/2-P/2,T=_/2-m[p]/2-1,O=Bc(d[y],T),M=Bc(d[b],T),L=O,F=_-m[p]-M,B=_/2-m[p]/2+k,R=xx(L,B,F),A=!l.arrow&&ih(i)!=null&&B!==R&&s.reference[p]/2-(B<L?O:M)-m[p]/2<0,N=A?B<L?B-L:B-F:0;return{[h]:f[h]+N,data:{[h]:R,centerOffset:B-R-N,...A&&{alignmentOffset:N}},reset:A}}}),EG=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...g}=al(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const y=ll(i),b=Fo(a),x=ll(a)===a,C=await(l.isRTL==null?void 0:l.isRTL(c.floating)),P=f||(x||!m?[Y0(a)]:gG(a)),S=p!=="none";!f&&S&&P.push(...vG(a,m,p,C));const _=[a,...P],k=await Qp(e,g),T=[];let O=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&T.push(k[y]),d){const B=mG(i,o,C);T.push(k[B[0]],k[B[1]])}if(O=[...O,{placement:i,overflows:T}],!T.every(B=>B<=0)){var M,L;const B=(((M=s.flip)==null?void 0:M.index)||0)+1,R=_[B];if(R&&(!(d==="alignment"?b!==Fo(R):!1)||O.every(z=>Fo(z.placement)===b?z.overflows[0]>0:!0)))return{data:{index:B,overflows:O},reset:{placement:R}};let A=(L=O.filter(N=>N.overflows[0]<=0).sort((N,z)=>N.overflows[1]-z.overflows[1])[0])==null?void 0:L.placement;if(!A)switch(h){case"bestFit":{var F;const N=(F=O.filter(z=>{if(S){const U=Fo(z.placement);return U===b||U==="y"}return!0}).map(z=>[z.placement,z.overflows.filter(U=>U>0).reduce((U,V)=>U+V,0)]).sort((z,U)=>z[1]-U[1])[0])==null?void 0:F[0];N&&(A=N);break}case"initialPlacement":A=a;break}if(i!==A)return{reset:{placement:A}}}return{}}}};function tP(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function nP(t){return dG.some(e=>t[e]>=0)}const TG=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=al(t,e);switch(r){case"referenceHidden":{const s=await Qp(e,{...i,elementContext:"reference"}),o=tP(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:nP(o)}}}case"escaped":{const s=await Qp(e,{...i,altBoundary:!0}),o=tP(s,n.floating);return{data:{escapedOffsets:o,escaped:nP(o)}}}default:return{}}}}},lN=new Set(["left","top"]);async function CG(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=ll(n),a=ih(n),l=Fo(n)==="y",c=lN.has(o)?-1:1,u=s&&l?-1:1,d=al(e,t);let{mainAxis:f,crossAxis:h,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof p=="number"&&(h=a==="end"?p*-1:p),l?{x:h*u,y:f*c}:{x:f*c,y:h*u}}const _G=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,l=await CG(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},AG=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:y,y:b}=g;return{x:y,y:b}}},...l}=al(t,e),c={x:n,y:r},u=await Qp(e,l),d=Fo(ll(i)),f=Zk(d);let h=c[f],p=c[d];if(s){const g=f==="y"?"top":"left",y=f==="y"?"bottom":"right",b=h+u[g],x=h-u[y];h=xx(b,h,x)}if(o){const g=d==="y"?"top":"left",y=d==="y"?"bottom":"right",b=p+u[g],x=p-u[y];p=xx(b,p,x)}const m=a.fn({...e,[f]:h,[d]:p});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[f]:s,[d]:o}}}}}},PG=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=al(t,e),u={x:n,y:r},d=Fo(i),f=Zk(d);let h=u[f],p=u[d];const m=al(a,e),g=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const x=f==="y"?"height":"width",C=s.reference[f]-s.floating[x]+g.mainAxis,P=s.reference[f]+s.reference[x]-g.mainAxis;h<C?h=C:h>P&&(h=P)}if(c){var y,b;const x=f==="y"?"width":"height",C=lN.has(ll(i)),P=s.reference[d]-s.floating[x]+(C&&((y=o.offset)==null?void 0:y[d])||0)+(C?0:g.crossAxis),S=s.reference[d]+s.reference[x]+(C?0:((b=o.offset)==null?void 0:b[d])||0)-(C?g.crossAxis:0);p<P?p=P:p>S&&(p=S)}return{[f]:h,[d]:p}}}},IG=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:l=()=>{},...c}=al(t,e),u=await Qp(e,c),d=ll(i),f=ih(i),h=Fo(i)==="y",{width:p,height:m}=s.floating;let g,y;d==="top"||d==="bottom"?(g=d,y=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(y=d,g=f==="end"?"top":"bottom");const b=m-u.top-u.bottom,x=p-u.left-u.right,C=Bc(m-u[g],b),P=Bc(p-u[y],x),S=!e.middlewareData.shift;let _=C,k=P;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(k=x),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(_=b),S&&!f){const O=as(u.left,0),M=as(u.right,0),L=as(u.top,0),F=as(u.bottom,0);h?k=p-2*(O!==0||M!==0?O+M:as(u.left,u.right)):_=m-2*(L!==0||F!==0?L+F:as(u.top,u.bottom))}await l({...e,availableWidth:k,availableHeight:_});const T=await o.getDimensions(a.floating);return p!==T.width||m!==T.height?{reset:{rects:!0}}:{}}}};function qb(){return typeof window<"u"}function sh(t){return cN(t)?(t.nodeName||"").toLowerCase():"#document"}function ds(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function aa(t){var e;return(e=(cN(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function cN(t){return qb()?t instanceof Node||t instanceof ds(t).Node:!1}function ao(t){return qb()?t instanceof Element||t instanceof ds(t).Element:!1}function Yo(t){return qb()?t instanceof HTMLElement||t instanceof ds(t).HTMLElement:!1}function rP(t){return!qb()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof ds(t).ShadowRoot}const OG=new Set(["inline","contents"]);function Vm(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=lo(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!OG.has(i)}const MG=new Set(["table","td","th"]);function NG(t){return MG.has(sh(t))}const RG=[":popover-open",":modal"];function Kb(t){return RG.some(e=>{try{return t.matches(e)}catch{return!1}})}const DG=["transform","translate","scale","rotate","perspective"],LG=["transform","translate","scale","rotate","perspective","filter"],BG=["paint","layout","strict","content"];function Yk(t){const e=Jk(),n=ao(t)?lo(t):t;return DG.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||LG.some(r=>(n.willChange||"").includes(r))||BG.some(r=>(n.contain||"").includes(r))}function FG(t){let e=Fc(t);for(;Yo(e)&&!Lf(e);){if(Yk(e))return e;if(Kb(e))return null;e=Fc(e)}return null}function Jk(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const $G=new Set(["html","body","#document"]);function Lf(t){return $G.has(sh(t))}function lo(t){return ds(t).getComputedStyle(t)}function Gb(t){return ao(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Fc(t){if(sh(t)==="html")return t;const e=t.assignedSlot||t.parentNode||rP(t)&&t.host||aa(t);return rP(e)?e.host:e}function uN(t){const e=Fc(t);return Lf(e)?t.ownerDocument?t.ownerDocument.body:t.body:Yo(e)&&Vm(e)?e:uN(e)}function Yp(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=uN(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=ds(i);if(s){const a=kx(o);return e.concat(o,o.visualViewport||[],Vm(i)?i:[],a&&n?Yp(a):[])}return e.concat(i,Yp(i,[],n))}function kx(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function dN(t){const e=lo(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Yo(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=Q0(n)!==s||Q0(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function eE(t){return ao(t)?t:t.contextElement}function ff(t){const e=eE(t);if(!Yo(e))return Zo(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=dN(e);let o=(s?Q0(n.width):n.width)/r,a=(s?Q0(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const zG=Zo(0);function fN(t){const e=ds(t);return!Jk()||!e.visualViewport?zG:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function UG(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==ds(t)?!1:e}function td(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=eE(t);let o=Zo(1);e&&(r?ao(r)&&(o=ff(r)):o=ff(t));const a=UG(s,n,r)?fN(s):Zo(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(s){const f=ds(s),h=r&&ao(r)?ds(r):r;let p=f,m=kx(p);for(;m&&r&&h!==p;){const g=ff(m),y=m.getBoundingClientRect(),b=lo(m),x=y.left+(m.clientLeft+parseFloat(b.paddingLeft))*g.x,C=y.top+(m.clientTop+parseFloat(b.paddingTop))*g.y;l*=g.x,c*=g.y,u*=g.x,d*=g.y,l+=x,c+=C,p=ds(m),m=kx(p)}}return J0({width:u,height:d,x:l,y:c})}function Zb(t,e){const n=Gb(t).scrollLeft;return e?e.left+n:td(aa(t)).left+n}function hN(t,e){const n=t.getBoundingClientRect(),r=n.left+e.scrollLeft-Zb(t,n),i=n.top+e.scrollTop;return{x:r,y:i}}function HG(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=aa(r),a=e?Kb(e.floating):!1;if(r===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=Zo(1);const u=Zo(0),d=Yo(r);if((d||!d&&!s)&&((sh(r)!=="body"||Vm(o))&&(l=Gb(r)),Yo(r))){const h=td(r);c=ff(r),u.x=h.x+r.clientLeft,u.y=h.y+r.clientTop}const f=o&&!d&&!s?hN(o,l):Zo(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:n.y*c.y-l.scrollTop*c.y+u.y+f.y}}function VG(t){return Array.from(t.getClientRects())}function WG(t){const e=aa(t),n=Gb(t),r=t.ownerDocument.body,i=as(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=as(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+Zb(t);const a=-n.scrollTop;return lo(r).direction==="rtl"&&(o+=as(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}const iP=25;function jG(t,e){const n=ds(t),r=aa(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const u=Jk();(!u||u&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}const c=Zb(r);if(c<=0){const u=r.ownerDocument,d=u.body,f=getComputedStyle(d),h=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,p=Math.abs(r.clientWidth-d.clientWidth-h);p<=iP&&(s-=p)}else c<=iP&&(s+=c);return{width:s,height:o,x:a,y:l}}const qG=new Set(["absolute","fixed"]);function KG(t,e){const n=td(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=Yo(t)?ff(t):Zo(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=i*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function sP(t,e,n){let r;if(e==="viewport")r=jG(t,n);else if(e==="document")r=WG(aa(t));else if(ao(e))r=KG(e,n);else{const i=fN(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return J0(r)}function pN(t,e){const n=Fc(t);return n===e||!ao(n)||Lf(n)?!1:lo(n).position==="fixed"||pN(n,e)}function GG(t,e){const n=e.get(t);if(n)return n;let r=Yp(t,[],!1).filter(a=>ao(a)&&sh(a)!=="body"),i=null;const s=lo(t).position==="fixed";let o=s?Fc(t):t;for(;ao(o)&&!Lf(o);){const a=lo(o),l=Yk(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&qG.has(i.position)||Vm(o)&&!l&&pN(t,o))?r=r.filter(u=>u!==o):i=a,o=Fc(o)}return e.set(t,r),r}function ZG(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?Kb(e)?[]:GG(e,this._c):[].concat(n),r],a=o[0],l=o.reduce((c,u)=>{const d=sP(e,u,i);return c.top=as(d.top,c.top),c.right=Bc(d.right,c.right),c.bottom=Bc(d.bottom,c.bottom),c.left=as(d.left,c.left),c},sP(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function XG(t){const{width:e,height:n}=dN(t);return{width:e,height:n}}function QG(t,e,n){const r=Yo(e),i=aa(e),s=n==="fixed",o=td(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Zo(0);function c(){l.x=Zb(i)}if(r||!r&&!s)if((sh(e)!=="body"||Vm(i))&&(a=Gb(e)),r){const h=td(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else i&&c();s&&!r&&i&&c();const u=i&&!r&&!s?hN(i,a):Zo(0),d=o.left+a.scrollLeft-l.x-u.x,f=o.top+a.scrollTop-l.y-u.y;return{x:d,y:f,width:o.width,height:o.height}}function Gv(t){return lo(t).position==="static"}function oP(t,e){if(!Yo(t)||lo(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return aa(t)===n&&(n=n.ownerDocument.body),n}function mN(t,e){const n=ds(t);if(Kb(t))return n;if(!Yo(t)){let i=Fc(t);for(;i&&!Lf(i);){if(ao(i)&&!Gv(i))return i;i=Fc(i)}return n}let r=oP(t,e);for(;r&&NG(r)&&Gv(r);)r=oP(r,e);return r&&Lf(r)&&Gv(r)&&!Yk(r)?n:r||FG(t)||n}const YG=async function(t){const e=this.getOffsetParent||mN,n=this.getDimensions,r=await n(t.floating);return{reference:QG(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function JG(t){return lo(t).direction==="rtl"}const eZ={convertOffsetParentRelativeRectToViewportRelativeRect:HG,getDocumentElement:aa,getClippingRect:ZG,getOffsetParent:mN,getElementRects:YG,getClientRects:VG,getDimensions:XG,getScale:ff,isElement:ao,isRTL:JG};function gN(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function tZ(t,e){let n=null,r;const i=aa(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:h}=c;if(a||e(),!f||!h)return;const p=Pg(d),m=Pg(i.clientWidth-(u+f)),g=Pg(i.clientHeight-(d+h)),y=Pg(u),x={rootMargin:-p+"px "+-m+"px "+-g+"px "+-y+"px",threshold:as(0,Bc(1,l))||1};let C=!0;function P(S){const _=S[0].intersectionRatio;if(_!==l){if(!C)return o();_?o(!1,_):r=setTimeout(()=>{o(!1,1e-7)},1e3)}_===1&&!gN(c,t.getBoundingClientRect())&&o(),C=!1}try{n=new IntersectionObserver(P,{...x,root:i.ownerDocument})}catch{n=new IntersectionObserver(P,x)}n.observe(t)}return o(!0),s}function nZ(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=eE(t),u=i||s?[...c?Yp(c):[],...Yp(e)]:[];u.forEach(y=>{i&&y.addEventListener("scroll",n,{passive:!0}),s&&y.addEventListener("resize",n)});const d=c&&a?tZ(c,n):null;let f=-1,h=null;o&&(h=new ResizeObserver(y=>{let[b]=y;b&&b.target===c&&h&&(h.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var x;(x=h)==null||x.observe(e)})),n()}),c&&!l&&h.observe(c),h.observe(e));let p,m=l?td(t):null;l&&g();function g(){const y=td(t);m&&!gN(m,y)&&n(),m=y,p=requestAnimationFrame(g)}return n(),()=>{var y;u.forEach(b=>{i&&b.removeEventListener("scroll",n),s&&b.removeEventListener("resize",n)}),d?.(),(y=h)==null||y.disconnect(),h=null,l&&cancelAnimationFrame(p)}}const rZ=_G,iZ=AG,sZ=EG,oZ=IG,aZ=TG,lZ=kG,cZ=PG,uZ=(t,e,n)=>{const r=new Map,i={platform:eZ,...n},s={...i.platform,_c:r};return SG(t,e,{...i,platform:s})};function au(t){return typeof t=="function"?t():t}function yN(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function aP(t,e){const n=yN(t);return Math.round(e*n)/n}function ey(t){return{[`--bits-${t}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${t}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${t}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${t}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${t}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function dZ(t){const e=t.whileElementsMounted,n=oe(()=>au(t.open)??!0),r=oe(()=>au(t.middleware)),i=oe(()=>au(t.transform)??!0),s=oe(()=>au(t.placement)??"bottom"),o=oe(()=>au(t.strategy)??"absolute"),a=oe(()=>au(t.sideOffset)??0),l=oe(()=>au(t.alignOffset)??0),c=t.reference;let u=ye(0),d=ye(0);const f=Rs(null);let h=ye(Zt(E(o))),p=ye(Zt(E(s))),m=ye(Zt({})),g=ye(!1);const y=oe(()=>{const _=f.current?aP(f.current,E(u)):E(u),k=f.current?aP(f.current,E(d)):E(d);return E(i)?{position:E(h),left:"0",top:"0",transform:`translate(${_}px, ${k}px)`,...f.current&&yN(f.current)>=1.5&&{willChange:"transform"}}:{position:E(h),left:`${_}px`,top:`${k}px`}});let b;function x(){c.current===null||f.current===null||uZ(c.current,f.current,{middleware:E(r),placement:E(s),strategy:E(o)}).then(_=>{if(!E(n)&&E(u)!==0&&E(d)!==0){const k=Math.max(Math.abs(E(a)),Math.abs(E(l)),15);if(_.x<=k&&_.y<=k)return}Q(u,_.x,!0),Q(d,_.y,!0),Q(h,_.strategy,!0),Q(p,_.placement,!0),Q(m,_.middlewareData,!0),Q(g,!0)})}function C(){typeof b=="function"&&(b(),b=void 0)}function P(){if(C(),e===void 0){x();return}c.current===null||f.current===null||(b=e(c.current,f.current,x))}function S(){E(n)||Q(g,!1)}return nt(x),nt(P),nt(S),nt(()=>C),{floating:f,reference:c,get strategy(){return E(h)},get placement(){return E(p)},get middlewareData(){return E(m)},get isPositioned(){return E(g)},get floatingStyles(){return E(y)},get update(){return x}}}const fZ={top:"bottom",right:"left",bottom:"top",left:"right"},tE=new Gc("Floating.Root"),lP=new Gc("Floating.Content"),nE=new Gc("Floating.Root");class ty{static create(e=!1){return e?nE.set(new ty):tE.set(new ty)}anchorNode=Rs(null);customAnchorNode=Rs(null);triggerNode=Rs(null);constructor(){nt(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}class ny{static create(e,n=!1){return n?lP.set(new ny(e,nE.get())):lP.set(new ny(e,tE.get()))}opts;root;contentRef=Rs(null);wrapperRef=Rs(null);arrowRef=Rs(null);contentAttachment=Bs(this.contentRef);wrapperAttachment=Bs(this.wrapperRef);arrowAttachment=Bs(this.arrowRef);arrowId=Rs(Gk());#e=oe(()=>{if(typeof this.opts.style=="string")return np(this.opts.style);if(!this.opts.style)return{}});#t=void 0;#n=new rK(()=>this.arrowRef.current??void 0);#r=oe(()=>this.#n?.width??0);#i=oe(()=>this.#n?.height??0);#a=oe(()=>this.opts.side?.current+(this.opts.align.current!=="center"?`-${this.opts.align.current}`:""));#s=oe(()=>Array.isArray(this.opts.collisionBoundary.current)?this.opts.collisionBoundary.current:[this.opts.collisionBoundary.current]);#o=oe(()=>E(this.#s).length>0);get hasExplicitBoundaries(){return E(this.#o)}set hasExplicitBoundaries(e){Q(this.#o,e)}#l=oe(()=>({padding:this.opts.collisionPadding.current,boundary:E(this.#s).filter(wK),altBoundary:this.hasExplicitBoundaries}));get detectOverflowOptions(){return E(this.#l)}set detectOverflowOptions(e){Q(this.#l,e)}#c=ye(void 0);#u=ye(void 0);#d=ye(void 0);#h=ye(void 0);#p=oe(()=>[rZ({mainAxis:this.opts.sideOffset.current+E(this.#i),alignmentAxis:this.opts.alignOffset.current}),this.opts.avoidCollisions.current&&iZ({mainAxis:!0,crossAxis:!1,limiter:this.opts.sticky.current==="partial"?cZ():void 0,...this.detectOverflowOptions}),this.opts.avoidCollisions.current&&sZ({...this.detectOverflowOptions}),oZ({...this.detectOverflowOptions,apply:({rects:e,availableWidth:n,availableHeight:r})=>{const{width:i,height:s}=e.reference;Q(this.#c,n,!0),Q(this.#u,r,!0),Q(this.#d,i,!0),Q(this.#h,s,!0)}}),this.arrowRef.current&&lZ({element:this.arrowRef.current,padding:this.opts.arrowPadding.current}),hZ({arrowWidth:E(this.#r),arrowHeight:E(this.#i)}),this.opts.hideWhenDetached.current&&aZ({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean));get middleware(){return E(this.#p)}set middleware(e){Q(this.#p,e)}floating;#g=oe(()=>pZ(this.floating.placement));get placedSide(){return E(this.#g)}set placedSide(e){Q(this.#g,e)}#f=oe(()=>mZ(this.floating.placement));get placedAlign(){return E(this.#f)}set placedAlign(e){Q(this.#f,e)}#m=oe(()=>this.floating.middlewareData.arrow?.x??0);get arrowX(){return E(this.#m)}set arrowX(e){Q(this.#m,e)}#y=oe(()=>this.floating.middlewareData.arrow?.y??0);get arrowY(){return E(this.#y)}set arrowY(e){Q(this.#y,e)}#w=oe(()=>this.floating.middlewareData.arrow?.centerOffset!==0);get cannotCenterArrow(){return E(this.#w)}set cannotCenterArrow(e){Q(this.#w,e)}#b=ye();get contentZIndex(){return E(this.#b)}set contentZIndex(e){Q(this.#b,e,!0)}#v=oe(()=>fZ[this.placedSide]);get arrowBaseSide(){return E(this.#v)}set arrowBaseSide(e){Q(this.#v,e)}#x=oe(()=>({id:this.opts.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${this.floating.middlewareData.transformOrigin?.x} ${this.floating.middlewareData.transformOrigin?.y}`,"--bits-floating-available-width":`${E(this.#c)}px`,"--bits-floating-available-height":`${E(this.#u)}px`,"--bits-floating-anchor-width":`${E(this.#d)}px`,"--bits-floating-anchor-height":`${E(this.#h)}px`,...this.floating.middlewareData.hide?.referenceHidden&&{visibility:"hidden","pointer-events":"none"},...E(this.#e)},dir:this.opts.dir.current,...this.wrapperAttachment}));get wrapperProps(){return E(this.#x)}set wrapperProps(e){Q(this.#x,e)}#S=oe(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:L8({...E(this.#e)}),...this.contentAttachment}));get props(){return E(this.#S)}set props(e){Q(this.#S,e)}#k=oe(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0}));get arrowStyle(){return E(this.#k)}set arrowStyle(e){Q(this.#k,e)}constructor(e,n){this.opts=e,this.root=n,e.customAnchor&&(this.root.customAnchorNode.current=e.customAnchor.current),Mr(()=>e.customAnchor.current,r=>{this.root.customAnchorNode.current=r}),this.floating=dZ({strategy:()=>this.opts.strategy.current,placement:()=>E(this.#a),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...r)=>nZ(...r,{animationFrame:this.#t?.current==="always"}),open:()=>this.opts.enabled.current,sideOffset:()=>this.opts.sideOffset.current,alignOffset:()=>this.opts.alignOffset.current}),nt(()=>{this.floating.isPositioned&&this.opts.onPlaced?.current()}),Mr(()=>this.contentRef.current,r=>{if(!r)return;const i=V8(r);this.contentZIndex=i.getComputedStyle(r).zIndex}),nt(()=>{this.floating.floating.current=this.wrapperRef.current})}}class ry{static create(e,n=!1){return n?new ry(e,nE.get()):new ry(e,tE.get())}opts;root;constructor(e,n){this.opts=e,this.root=n,e.virtualEl&&e.virtualEl.current?n.triggerNode=Cq(e.virtualEl.current):n.triggerNode=e.ref}}function hZ(t){return{name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:i}=e,o=i.arrow?.centerOffset!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=rE(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(i.arrow?.x??0)+a/2,h=(i.arrow?.y??0)+l/2;let p="",m="";return c==="bottom"?(p=o?d:`${f}px`,m=`${-l}px`):c==="top"?(p=o?d:`${f}px`,m=`${r.floating.height+l}px`):c==="right"?(p=`${-l}px`,m=o?d:`${h}px`):c==="left"&&(p=`${r.floating.width+l}px`,m=o?d:`${h}px`),{data:{x:p,y:m}}}}}function rE(t){const[e,n="center"]=t.split("-");return[e,n]}function pZ(t){return rE(t)[0]}function mZ(t){return rE(t)[1]}function bN(t,e){wt(e,!0);let n=ce(e,"tooltip",3,!1);ty.create(n());var r=ze(),i=Te(r);kt(i,()=>e.children??Bt),Y(t,r),vt()}function wN(t,e){wt(e,!0);let n=ce(e,"tooltip",3,!1);ry.create({id:$e(()=>e.id),virtualEl:$e(()=>e.virtualEl),ref:e.ref},n());var r=ze(),i=Te(r);kt(i,()=>e.children??Bt),Y(t,r),vt()}function gZ(t,e){wt(e,!0);let n=ce(e,"side",3,"bottom"),r=ce(e,"sideOffset",3,0),i=ce(e,"align",3,"center"),s=ce(e,"alignOffset",3,0),o=ce(e,"arrowPadding",3,0),a=ce(e,"avoidCollisions",3,!0),l=ce(e,"collisionBoundary",19,()=>[]),c=ce(e,"collisionPadding",3,0),u=ce(e,"hideWhenDetached",3,!1),d=ce(e,"onPlaced",3,()=>{}),f=ce(e,"sticky",3,"partial"),h=ce(e,"updatePositionStrategy",3,"optimized"),p=ce(e,"strategy",3,"fixed"),m=ce(e,"dir",3,"ltr"),g=ce(e,"style",19,()=>({})),y=ce(e,"wrapperId",19,Gk),b=ce(e,"customAnchor",3,null),x=ce(e,"tooltip",3,!1);const C=ny.create({side:$e(()=>n()),sideOffset:$e(()=>r()),align:$e(()=>i()),alignOffset:$e(()=>s()),id:$e(()=>e.id),arrowPadding:$e(()=>o()),avoidCollisions:$e(()=>a()),collisionBoundary:$e(()=>l()),collisionPadding:$e(()=>c()),hideWhenDetached:$e(()=>u()),onPlaced:$e(()=>d()),sticky:$e(()=>f()),updatePositionStrategy:$e(()=>h()),strategy:$e(()=>p()),dir:$e(()=>m()),style:$e(()=>g()),enabled:$e(()=>e.enabled),wrapperId:$e(()=>y()),customAnchor:$e(()=>b())},x()),P=oe(()=>gr(C.wrapperProps,{style:{pointerEvents:"auto"}}));var S=ze(),_=Te(S);kt(_,()=>e.content??Bt,()=>({props:C.props,wrapperProps:E(P)})),Y(t,S),vt()}function yZ(t,e){wt(e,!0),Vs(()=>{e.onPlaced?.()});var n=ze(),r=Te(n);kt(r,()=>e.content??Bt,()=>({props:{},wrapperProps:{}})),Y(t,n),vt()}function bZ(t,e){let n=ce(e,"isStatic",3,!1),r=Ni(e,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var i=ze(),s=Te(i);{var o=l=>{yZ(l,{get content(){return e.content},get onPlaced(){return e.onPlaced}})},a=l=>{gZ(l,qn({get content(){return e.content},get onPlaced(){return e.onPlaced}},()=>r))};He(s,l=>{n()?l(o):l(a,!1)})}Y(t,i)}var wZ=Ce("<!> <!>",1);function vN(t,e){wt(e,!0);let n=ce(e,"interactOutsideBehavior",3,"close"),r=ce(e,"trapFocus",3,!0),i=ce(e,"isValidEvent",3,()=>!1),s=ce(e,"customAnchor",3,null),o=ce(e,"isStatic",3,!1),a=ce(e,"tooltip",3,!1),l=ce(e,"contentPointerEvents",3,"auto"),c=Ni(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled","ref","tooltip","contentPointerEvents"]);bZ(t,{get isStatic(){return o()},get id(){return e.id},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get enabled(){return e.enabled},get tooltip(){return a()},content:(d,f)=>{let h=()=>f?.().props,p=()=>f?.().wrapperProps;var m=wZ(),g=Te(m);{var y=C=>{X0(C,{get preventScroll(){return e.preventScroll}})},b=C=>{var P=ze(),S=Te(P);{var _=k=>{X0(k,{get preventScroll(){return e.preventScroll}})};He(S,k=>{e.forceMount||k(_)},!0)}Y(C,P)};He(g,C=>{e.forceMount&&e.enabled?C(y):C(b,!1)})}var x=ve(g,2);iN(x,{get onOpenAutoFocus(){return e.onOpenAutoFocus},get onCloseAutoFocus(){return e.onCloseAutoFocus},get loop(){return e.loop},get enabled(){return e.enabled},get trapFocus(){return r()},get forceMount(){return e.forceMount},get ref(){return e.ref},focusScope:(P,S)=>{let _=()=>S?.().props;rN(P,{get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get enabled(){return e.enabled},get ref(){return e.ref},children:(k,T)=>{nN(k,{get id(){return e.id},get onInteractOutside(){return e.onInteractOutside},get onFocusOutside(){return e.onFocusOutside},get interactOutsideBehavior(){return n()},get isValidEvent(){return i()},get enabled(){return e.enabled},get ref(){return e.ref},children:(M,L)=>{let F=()=>L?.().props;sN(M,{get id(){return e.id},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get enabled(){return e.enabled},get ref(){return e.ref},children:(B,R)=>{var A=ze(),N=Te(A);{let z=oe(()=>({props:gr(c,h(),F(),_(),{style:{pointerEvents:l()}}),wrapperProps:p()}));kt(N,()=>e.popper??Bt,()=>E(z))}Y(B,A)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),Y(d,m)},$$slots:{content:!0}}),vt()}function xN(t,e){let n=ce(e,"interactOutsideBehavior",3,"close"),r=ce(e,"trapFocus",3,!0),i=ce(e,"isValidEvent",3,()=>!1),s=ce(e,"customAnchor",3,null),o=ce(e,"isStatic",3,!1),a=Ni(e,["$$slots","$$events","$$legacy","popper","open","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","ref","shouldRender"]);var l=ze(),c=Te(l);{var u=d=>{vN(d,qn({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get isStatic(){return o()},get enabled(){return e.open},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return n()},get loop(){return e.loop},get trapFocus(){return r()},get isValidEvent(){return i()},get onFocusOutside(){return e.onFocusOutside},forceMount:!1,get ref(){return e.ref}},()=>a))};He(c,d=>{e.shouldRender&&d(u)})}Y(t,l)}function SN(t,e){let n=ce(e,"interactOutsideBehavior",3,"close"),r=ce(e,"trapFocus",3,!0),i=ce(e,"isValidEvent",3,()=>!1),s=ce(e,"customAnchor",3,null),o=ce(e,"isStatic",3,!1),a=Ni(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);vN(t,qn({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get isStatic(){return o()},get enabled(){return e.enabled},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return n()},get loop(){return e.loop},get trapFocus(){return r()},get isValidEvent(){return i()},get onFocusOutside(){return e.onFocusOutside}},()=>a,{forceMount:!0}))}function cP(t,e){const[n,r]=t;let i=!1;const s=e.length;for(let o=0,a=s-1;o<s;a=o++){const[l,c]=e[o]??[0,0],[u,d]=e[a]??[0,0];c>=r!=d>=r&&n<=(u-l)*(r-c)/(d-c)+l&&(i=!i)}return i}function uP(t,e){return t[0]>=e.left&&t[0]<=e.right&&t[1]>=e.top&&t[1]<=e.bottom}function vZ(t,e){const n=t.left+t.width/2,r=t.top+t.height/2,i=e.left+e.width/2,s=e.top+e.height/2,o=i-n,a=s-r;return Math.abs(o)>Math.abs(a)?o>0?"right":"left":a>0?"bottom":"top"}class kN{#e;#t;#n=null;#r=null;constructor(e){this.#e=e,this.#t=e.buffer??1,Mr([e.triggerNode,e.contentNode,e.enabled],([n,r,i])=>{if(!n||!r||!i){this.#n=null,this.#r=null;return}const s=H8(n),o=d=>{this.#i(d,n,r)},a=d=>{const f=d.relatedTarget;df(f)&&r.contains(f)||(this.#n=[d.clientX,d.clientY],this.#r="content")},l=()=>{this.#n=null,this.#r=null},c=()=>{this.#n=null,this.#r=null},u=d=>{const f=d.relatedTarget;df(f)&&n.contains(f)||(this.#n=[d.clientX,d.clientY],this.#r="trigger")};return[Sr(s,"pointermove",o),Sr(n,"pointerleave",a),Sr(n,"pointerenter",l),Sr(r,"pointerenter",c),Sr(r,"pointerleave",u)].reduce((d,f)=>()=>{d(),f()},()=>{})})}#i(e,n,r){if(!this.#n||!this.#r)return;const i=[e.clientX,e.clientY],s=n.getBoundingClientRect(),o=r.getBoundingClientRect();if(this.#r==="content"&&uP(i,o)){this.#n=null,this.#r=null;return}if(this.#r==="trigger"&&uP(i,s)){this.#n=null,this.#r=null;return}const a=vZ(s,o),l=this.#a(s,o,a);if(l&&cP(i,l))return;const c=this.#r==="content"?o:s,u=this.#s(this.#n,c,a,this.#r);cP(i,u)||(this.#n=null,this.#r=null,this.#e.onPointerExit())}#a(e,n,r){const i=this.#t;switch(r){case"top":return[[Math.min(e.left,n.left)-i,e.top],[Math.min(e.left,n.left)-i,n.bottom],[Math.max(e.right,n.right)+i,n.bottom],[Math.max(e.right,n.right)+i,e.top]];case"bottom":return[[Math.min(e.left,n.left)-i,e.bottom],[Math.min(e.left,n.left)-i,n.top],[Math.max(e.right,n.right)+i,n.top],[Math.max(e.right,n.right)+i,e.bottom]];case"left":return[[e.left,Math.min(e.top,n.top)-i],[n.right,Math.min(e.top,n.top)-i],[n.right,Math.max(e.bottom,n.bottom)+i],[e.left,Math.max(e.bottom,n.bottom)+i]];case"right":return[[e.right,Math.min(e.top,n.top)-i],[n.left,Math.min(e.top,n.top)-i],[n.left,Math.max(e.bottom,n.bottom)+i],[e.right,Math.max(e.bottom,n.bottom)+i]]}}#s(e,n,r,i){const s=this.#t*4,[o,a]=e;switch(i==="trigger"?this.#o(r):r){case"top":return[[o-s,a+s],[o+s,a+s],[n.right+s,n.bottom],[n.right+s,n.top],[n.left-s,n.top],[n.left-s,n.bottom]];case"bottom":return[[o-s,a-s],[o+s,a-s],[n.right+s,n.top],[n.right+s,n.bottom],[n.left-s,n.bottom],[n.left-s,n.top]];case"left":return[[o+s,a-s],[o+s,a+s],[n.right,n.bottom+s],[n.left,n.bottom+s],[n.left,n.top-s],[n.right,n.top-s]];case"right":return[[o-s,a-s],[o-s,a+s],[n.left,n.bottom+s],[n.right,n.bottom+s],[n.right,n.top-s],[n.left,n.top-s]]}}#o(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"left":return"right";case"right":return"left"}}}const Ex=jb({component:"popover",parts:["root","trigger","content","close","overlay"]}),iE=new Gc("Popover.Root");class sE{static create(e){return iE.set(new sE(e))}opts;#e=ye(null);get contentNode(){return E(this.#e)}set contentNode(e){Q(this.#e,e,!0)}contentPresence;#t=ye(null);get triggerNode(){return E(this.#t)}set triggerNode(e){Q(this.#t,e,!0)}#n=ye(null);get overlayNode(){return E(this.#n)}set overlayNode(e){Q(this.#n,e,!0)}overlayPresence;#r=ye(!1);get openedViaHover(){return E(this.#r)}set openedViaHover(e){Q(this.#r,e,!0)}#i=ye(!1);get hasInteractedWithContent(){return E(this.#i)}set hasInteractedWithContent(e){Q(this.#i,e,!0)}#a=ye(!1);get hoverCooldown(){return E(this.#a)}set hoverCooldown(e){Q(this.#a,e,!0)}#s=ye(0);get closeDelay(){return E(this.#s)}set closeDelay(e){Q(this.#s,e,!0)}#o=null;#l=null;constructor(e){this.opts=e,this.contentPresence=new Xp({ref:$e(()=>this.contentNode),open:this.opts.open,onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),this.overlayPresence=new Xp({ref:$e(()=>this.overlayNode),open:this.opts.open}),Mr(()=>this.opts.open.current,n=>{n||(this.openedViaHover=!1,this.hasInteractedWithContent=!1,this.#c())})}setDomContext(e){this.#l=e}#c(){this.#o!==null&&this.#l&&(this.#l.clearTimeout(this.#o),this.#o=null)}toggleOpen(){this.#c(),this.opts.open.current=!this.opts.open.current}handleClose(){this.#c(),this.opts.open.current&&(this.opts.open.current=!1)}handleHoverOpen(){this.#c(),!this.opts.open.current&&(this.openedViaHover=!0,this.opts.open.current=!0)}handleHoverClose(){this.opts.open.current&&this.openedViaHover&&!this.hasInteractedWithContent&&(this.opts.open.current=!1)}handleDelayedHoverClose(){this.opts.open.current&&(!this.openedViaHover||this.hasInteractedWithContent||(this.#c(),this.closeDelay<=0?this.opts.open.current=!1:this.#l&&(this.#o=this.#l.setTimeout(()=>{this.openedViaHover&&!this.hasInteractedWithContent&&(this.opts.open.current=!1),this.#o=null},this.closeDelay))))}cancelDelayedClose(){this.#c()}markInteraction(){this.hasInteractedWithContent=!0,this.#c()}}class oE{static create(e){return new oE(e,iE.get())}opts;root;attachment;domContext;#e=null;#t=null;#n=ye(!1);constructor(e,n){this.opts=e,this.root=n,this.attachment=Bs(this.opts.ref,r=>this.root.triggerNode=r),this.domContext=new Wb(e.ref),this.root.setDomContext(this.domContext),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this),this.onpointerenter=this.onpointerenter.bind(this),this.onpointerleave=this.onpointerleave.bind(this),Mr(()=>this.opts.closeDelay.current,r=>{this.root.closeDelay=r})}#r(){this.#e!==null&&(this.domContext.clearTimeout(this.#e),this.#e=null)}#i(){this.#t!==null&&(this.domContext.clearTimeout(this.#t),this.#t=null)}#a(){this.#r(),this.#i()}onpointerenter(e){if(this.opts.disabled.current||!this.opts.openOnHover.current||W0(e)||(Q(this.#n,!0),this.#i(),this.root.cancelDelayedClose(),this.root.opts.open.current||this.root.hoverCooldown))return;const n=this.opts.openDelay.current;n<=0?this.root.handleHoverOpen():this.#e=this.domContext.setTimeout(()=>{this.root.handleHoverOpen(),this.#e=null},n)}onpointerleave(e){this.opts.disabled.current||this.opts.openOnHover.current&&(W0(e)||(Q(this.#n,!1),this.#r(),this.root.hoverCooldown=!1))}onclick(e){if(!this.opts.disabled.current&&e.button===0){if(this.#a(),E(this.#n)&&this.root.opts.open.current&&this.root.openedViaHover){this.root.openedViaHover=!1,this.root.hasInteractedWithContent=!0;return}E(this.#n)&&this.opts.openOnHover.current&&this.root.opts.open.current&&(this.root.hoverCooldown=!0),this.root.hoverCooldown&&!this.root.opts.open.current&&(this.root.hoverCooldown=!1),this.root.toggleOpen()}}onkeydown(e){this.opts.disabled.current||(e.key===W8||e.key===j8)&&(e.preventDefault(),this.#a(),this.root.toggleOpen())}#s(){if(this.root.opts.open.current&&this.root.contentNode?.id)return this.root.contentNode?.id}#o=oe(()=>({id:this.opts.id.current,"aria-haspopup":"dialog","aria-expanded":hK(this.root.opts.open.current),"data-state":Lk(this.root.opts.open.current),"aria-controls":this.#s(),[Ex.trigger]:"",disabled:this.opts.disabled.current,onkeydown:this.onkeydown,onclick:this.onclick,onpointerenter:this.onpointerenter,onpointerleave:this.onpointerleave,...this.attachment}));get props(){return E(this.#o)}set props(e){Q(this.#o,e)}}class aE{static create(e){return new aE(e,iE.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Bs(this.opts.ref,r=>this.root.contentNode=r),this.onpointerdown=this.onpointerdown.bind(this),this.onfocusin=this.onfocusin.bind(this),this.onpointerenter=this.onpointerenter.bind(this),this.onpointerleave=this.onpointerleave.bind(this),new kN({triggerNode:()=>this.root.triggerNode,contentNode:()=>this.root.contentNode,enabled:()=>this.root.opts.open.current&&this.root.openedViaHover&&!this.root.hasInteractedWithContent,onPointerExit:()=>{this.root.handleDelayedHoverClose()}})}onpointerdown(e){this.root.markInteraction()}onfocusin(e){const n=e.target;df(n)&&KK(n)&&this.root.markInteraction()}onpointerenter(e){W0(e)||this.root.cancelDelayedClose()}onpointerleave(e){W0(e)}onInteractOutside=e=>{if(this.opts.onInteractOutside.current(e),e.defaultPrevented||!df(e.target))return;const n=e.target.closest(Ex.selector("trigger"));if(!(n&&n===this.root.triggerNode)){if(this.opts.customAnchor.current){if(df(this.opts.customAnchor.current)){if(this.opts.customAnchor.current.contains(e.target))return}else if(typeof this.opts.customAnchor.current=="string"){const r=document.querySelector(this.opts.customAnchor.current);if(r&&r.contains(e.target))return}}this.root.handleClose()}};onEscapeKeydown=e=>{this.opts.onEscapeKeydown.current(e),!e.defaultPrevented&&this.root.handleClose()};get shouldRender(){return this.root.contentPresence.shouldRender}get shouldTrapFocus(){return!(this.root.openedViaHover&&!this.root.hasInteractedWithContent)}#e=oe(()=>({open:this.root.opts.open.current}));get snippetProps(){return E(this.#e)}set snippetProps(e){Q(this.#e,e)}#t=oe(()=>({id:this.opts.id.current,tabindex:-1,"data-state":Lk(this.root.opts.open.current),[Ex.content]:"",style:{pointerEvents:"auto"},onpointerdown:this.onpointerdown,onfocusin:this.onfocusin,onpointerenter:this.onpointerenter,onpointerleave:this.onpointerleave,...this.attachment}));get props(){return E(this.#t)}set props(e){Q(this.#t,e)}popperProps={onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown}}var xZ=Ce("<div><div><!></div></div>"),SZ=Ce("<div><div><!></div></div>");function kZ(t,e){const n=sa();wt(e,!0);let r=ce(e,"ref",15,null),i=ce(e,"id",19,()=>yl(n)),s=ce(e,"forceMount",3,!1),o=ce(e,"onOpenAutoFocus",3,vn),a=ce(e,"onCloseAutoFocus",3,vn),l=ce(e,"onEscapeKeydown",3,vn),c=ce(e,"onInteractOutside",3,vn),u=ce(e,"trapFocus",3,!0),d=ce(e,"preventScroll",3,!1),f=ce(e,"customAnchor",3,null),h=Ni(e,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onOpenAutoFocus","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","customAnchor"]);const p=aE.create({id:$e(()=>i()),ref:$e(()=>r(),S=>r(S)),onInteractOutside:$e(()=>c()),onEscapeKeydown:$e(()=>l()),customAnchor:$e(()=>f())}),m=oe(()=>gr(h,p.props)),g=oe(()=>u()&&p.shouldTrapFocus);function y(S){p.shouldTrapFocus||S.preventDefault(),o()(S)}var b=ze(),x=Te(b);{var C=S=>{SN(S,qn(()=>E(m),()=>p.popperProps,{get ref(){return p.opts.ref},get enabled(){return p.root.opts.open.current},get id(){return i()},get trapFocus(){return E(g)},get preventScroll(){return d()},loop:!0,forceMount:!0,get customAnchor(){return f()},onOpenAutoFocus:y,get onCloseAutoFocus(){return a()},get shouldRender(){return p.shouldRender},popper:(k,T)=>{let O=()=>T?.().props,M=()=>T?.().wrapperProps;const L=oe(()=>gr(O(),{style:ey("popover")}));var F=ze(),B=Te(F);{var R=N=>{var z=ze(),U=Te(z);{let V=oe(()=>({props:E(L),wrapperProps:M(),...p.snippetProps}));kt(U,()=>e.child,()=>E(V))}Y(N,z)},A=N=>{var z=xZ();kr(z,()=>({...M()}));var U=ie(z);kr(U,()=>({...E(L)}));var V=ie(U);kt(V,()=>e.children??Bt),Y(N,z)};He(B,N=>{e.child?N(R):N(A,!1)})}Y(k,F)},$$slots:{popper:!0}}))},P=S=>{var _=ze(),k=Te(_);{var T=O=>{xN(O,qn(()=>E(m),()=>p.popperProps,{get ref(){return p.opts.ref},get open(){return p.root.opts.open.current},get id(){return i()},get trapFocus(){return E(g)},get preventScroll(){return d()},loop:!0,forceMount:!1,get customAnchor(){return f()},onOpenAutoFocus:y,get onCloseAutoFocus(){return a()},get shouldRender(){return p.shouldRender},popper:(L,F)=>{let B=()=>F?.().props,R=()=>F?.().wrapperProps;const A=oe(()=>gr(B(),{style:ey("popover")}));var N=ze(),z=Te(N);{var U=q=>{var G=ze(),ne=Te(G);{let te=oe(()=>({props:E(A),wrapperProps:R(),...p.snippetProps}));kt(ne,()=>e.child,()=>E(te))}Y(q,G)},V=q=>{var G=SZ();kr(G,()=>({...R()}));var ne=ie(G);kr(ne,()=>({...E(A)}));var te=ie(ne);kt(te,()=>e.children??Bt),Y(q,G)};He(z,q=>{e.child?q(U):q(V,!1)})}Y(L,N)},$$slots:{popper:!0}}))};He(k,O=>{s()||O(T)},!0)}Y(S,_)};He(x,S=>{s()?S(C):S(P,!1)})}Y(t,b),vt()}var EZ=Ce("<button><!></button>");function TZ(t,e){const n=sa();wt(e,!0);let r=ce(e,"id",19,()=>yl(n)),i=ce(e,"ref",15,null),s=ce(e,"type",3,"button"),o=ce(e,"disabled",3,!1),a=ce(e,"openOnHover",3,!1),l=ce(e,"openDelay",3,700),c=ce(e,"closeDelay",3,300),u=Ni(e,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled","openOnHover","openDelay","closeDelay"]);const d=oE.create({id:$e(()=>r()),ref:$e(()=>i(),h=>i(h)),disabled:$e(()=>!!o()),openOnHover:$e(()=>a()),openDelay:$e(()=>l()),closeDelay:$e(()=>c())}),f=oe(()=>gr(u,d.props,{type:s()}));wN(t,{get id(){return r()},get ref(){return d.opts.ref},children:(h,p)=>{var m=ze(),g=Te(m);{var y=x=>{var C=ze(),P=Te(C);kt(P,()=>e.child,()=>({props:E(f)})),Y(x,C)},b=x=>{var C=EZ();kr(C,()=>({...E(f)}));var P=ie(C);kt(P,()=>e.children??Bt),Y(x,C)};He(g,x=>{e.child?x(y):x(b,!1)})}Y(h,m)},$$slots:{default:!0}}),vt()}function CZ(t,e){wt(e,!0);let n=ce(e,"open",15,!1),r=ce(e,"onOpenChange",3,vn),i=ce(e,"onOpenChangeComplete",3,vn);Bk.create({variant:$e(()=>"dialog"),open:$e(()=>n(),a=>{n(a),r()(a)}),onOpenChangeComplete:$e(()=>i())});var s=ze(),o=Te(s);kt(o,()=>e.children??Bt),Y(t,s),vt()}var _Z=Ce("<button><!></button>");function oh(t,e){const n=sa();wt(e,!0);let r=ce(e,"id",19,()=>yl(n)),i=ce(e,"ref",15,null),s=ce(e,"disabled",3,!1),o=Ni(e,["$$slots","$$events","$$legacy","children","child","id","ref","disabled"]);const a=Fk.create({variant:$e(()=>"close"),id:$e(()=>r()),ref:$e(()=>i(),h=>i(h)),disabled:$e(()=>!!s())}),l=oe(()=>gr(o,a.props));var c=ze(),u=Te(c);{var d=h=>{var p=ze(),m=Te(p);kt(m,()=>e.child,()=>({props:E(l)})),Y(h,p)},f=h=>{var p=_Z();kr(p,()=>({...E(l)}));var m=ie(p);kt(m,()=>e.children??Bt),Y(h,p)};He(u,h=>{e.child?h(d):h(f,!1)})}Y(t,c),vt()}var AZ=Ce("<!> <!>",1),PZ=Ce("<!> <div><!></div>",1);function IZ(t,e){const n=sa();wt(e,!0);let r=ce(e,"id",19,()=>yl(n)),i=ce(e,"ref",15,null),s=ce(e,"forceMount",3,!1),o=ce(e,"onCloseAutoFocus",3,vn),a=ce(e,"onOpenAutoFocus",3,vn),l=ce(e,"onEscapeKeydown",3,vn),c=ce(e,"onInteractOutside",3,vn),u=ce(e,"trapFocus",3,!0),d=ce(e,"preventScroll",3,!0),f=ce(e,"restoreScrollDelay",3,null),h=Ni(e,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onOpenAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const p=Uk.create({id:$e(()=>r()),ref:$e(()=>i(),x=>i(x))}),m=oe(()=>gr(h,p.props));var g=ze(),y=Te(g);{var b=x=>{iN(x,{get ref(){return p.opts.ref},loop:!0,get trapFocus(){return u()},get enabled(){return p.root.opts.open.current},get onOpenAutoFocus(){return a()},get onCloseAutoFocus(){return o()},focusScope:(P,S)=>{let _=()=>S?.().props;rN(P,qn(()=>E(m),{get enabled(){return p.root.opts.open.current},get ref(){return p.opts.ref},onEscapeKeydown:k=>{l()(k),!k.defaultPrevented&&p.root.handleClose()},children:(k,T)=>{nN(k,qn(()=>E(m),{get ref(){return p.opts.ref},get enabled(){return p.root.opts.open.current},onInteractOutside:O=>{c()(O),!O.defaultPrevented&&p.root.handleClose()},children:(O,M)=>{sN(O,qn(()=>E(m),{get ref(){return p.opts.ref},get enabled(){return p.root.opts.open.current},children:(L,F)=>{var B=ze(),R=Te(B);{var A=z=>{var U=AZ(),V=Te(U);{var q=ne=>{X0(ne,{get preventScroll(){return d()},get restoreScrollDelay(){return f()}})};He(V,ne=>{p.root.opts.open.current&&ne(q)})}var G=ve(V,2);{let ne=oe(()=>({props:gr(E(m),_()),...p.snippetProps}));kt(G,()=>e.child,()=>E(ne))}Y(z,U)},N=z=>{var U=PZ(),V=Te(U);X0(V,{get preventScroll(){return d()}});var q=ve(V,2);kr(q,ne=>({...ne}),[()=>gr(E(m),_())]);var G=ie(q);kt(G,()=>e.children??Bt),Y(z,U)};He(R,z=>{e.child?z(A):z(N,!1)})}Y(L,B)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}})};He(y,x=>{(p.shouldRender||s())&&x(b)})}Y(t,g),vt()}function OZ(t,e){wt(e,!0);let n=ce(e,"open",15,!1),r=ce(e,"onOpenChange",3,vn),i=ce(e,"onOpenChangeComplete",3,vn);sE.create({open:$e(()=>n(),s=>{n(s),r()(s)}),onOpenChangeComplete:$e(()=>i())}),bN(t,{children:(s,o)=>{var a=ze(),l=Te(a);kt(l,()=>e.children??Bt),Y(s,a)},$$slots:{default:!0}}),vt()}class Tx{#e;#t;#n=null;constructor(e,n){this.#t=e,this.#e=n,this.stop=this.stop.bind(this),this.start=this.start.bind(this),gd(this.stop)}#r(){this.#n!==null&&(window.clearTimeout(this.#n),this.#n=null)}stop(){this.#r()}start(...e){this.#r(),this.#n=window.setTimeout(()=>{this.#n=null,this.#t(...e)},this.#e)}}const EN=jb({component:"tooltip",parts:["content","trigger"]}),TN=new Gc("Tooltip.Provider"),lE=new Gc("Tooltip.Root");class cE{static create(e){return TN.set(new cE(e))}opts;#e=ye(!0);get isOpenDelayed(){return E(this.#e)}set isOpenDelayed(e){Q(this.#e,e,!0)}isPointerInTransit=Rs(!1);#t;#n=ye(null);constructor(e){this.opts=e,this.#t=new Tx(()=>{this.isOpenDelayed=!0},this.opts.skipDelayDuration.current)}#r=()=>{this.opts.skipDelayDuration.current!==0&&this.#t.start()};#i=()=>{this.#t.stop()};onOpen=e=>{E(this.#n)&&E(this.#n)!==e&&E(this.#n).handleClose(),this.#i(),this.isOpenDelayed=!1,Q(this.#n,e,!0)};onClose=e=>{E(this.#n)===e&&Q(this.#n,null),this.#r()};isTooltipOpen=e=>E(this.#n)===e}class uE{static create(e){return lE.set(new uE(e,TN.get()))}opts;provider;#e=oe(()=>this.opts.delayDuration.current??this.provider.opts.delayDuration.current);get delayDuration(){return E(this.#e)}set delayDuration(e){Q(this.#e,e)}#t=oe(()=>this.opts.disableHoverableContent.current??this.provider.opts.disableHoverableContent.current);get disableHoverableContent(){return E(this.#t)}set disableHoverableContent(e){Q(this.#t,e)}#n=oe(()=>this.opts.disableCloseOnTriggerClick.current??this.provider.opts.disableCloseOnTriggerClick.current);get disableCloseOnTriggerClick(){return E(this.#n)}set disableCloseOnTriggerClick(e){Q(this.#n,e)}#r=oe(()=>this.opts.disabled.current??this.provider.opts.disabled.current);get disabled(){return E(this.#r)}set disabled(e){Q(this.#r,e)}#i=oe(()=>this.opts.ignoreNonKeyboardFocus.current??this.provider.opts.ignoreNonKeyboardFocus.current);get ignoreNonKeyboardFocus(){return E(this.#i)}set ignoreNonKeyboardFocus(e){Q(this.#i,e)}#a=ye(null);get contentNode(){return E(this.#a)}set contentNode(e){Q(this.#a,e,!0)}contentPresence;#s=ye(null);get triggerNode(){return E(this.#s)}set triggerNode(e){Q(this.#s,e,!0)}#o=ye(!1);#l;#c=oe(()=>this.opts.open.current?E(this.#o)?"delayed-open":"instant-open":"closed");get stateAttr(){return E(this.#c)}set stateAttr(e){Q(this.#c,e)}constructor(e,n){this.opts=e,this.provider=n,this.#l=new Tx(()=>{Q(this.#o,!0),this.opts.open.current=!0},this.delayDuration??0),this.contentPresence=new Xp({open:this.opts.open,ref:$e(()=>this.contentNode),onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),Mr(()=>this.delayDuration,()=>{this.delayDuration!==void 0&&(this.#l=new Tx(()=>{Q(this.#o,!0),this.opts.open.current=!0},this.delayDuration))}),Mr(()=>this.opts.open.current,r=>{r?this.provider.onOpen(this):this.provider.onClose(this)},{lazy:!0})}handleOpen=()=>{this.#l.stop(),Q(this.#o,!1),this.opts.open.current=!0};handleClose=()=>{this.#l.stop(),this.opts.open.current=!1};#u=()=>{this.#l.stop();const e=!this.provider.isOpenDelayed,n=this.delayDuration??0;e||n===0?(Q(this.#o,n>0&&e,!0),this.opts.open.current=!0):this.#l.start()};onTriggerEnter=()=>{this.#u()};onTriggerLeave=()=>{this.disableHoverableContent?this.handleClose():this.#l.stop()}}class dE{static create(e){return new dE(e,lE.get())}opts;root;attachment;#e=Rs(!1);#t=ye(!1);#n=oe(()=>this.opts.disabled.current||this.root.disabled);domContext;#r=null;constructor(e,n){this.opts=e,this.root=n,this.domContext=new Wb(e.ref),this.attachment=Bs(this.opts.ref,r=>this.root.triggerNode=r)}#i=()=>{this.#r!==null&&(clearTimeout(this.#r),this.#r=null)};handlePointerUp=()=>{this.#e.current=!1};#a=()=>{E(this.#n)||(this.#e.current=!1)};#s=()=>{E(this.#n)||(this.#e.current=!0,this.domContext.getDocument().addEventListener("pointerup",()=>{this.handlePointerUp()},{once:!0}))};#o=e=>{if(!E(this.#n)&&e.pointerType!=="touch"){if(this.root.provider.isPointerInTransit.current){this.#i(),this.#r=window.setTimeout(()=>{this.root.provider.isPointerInTransit.current&&(this.root.provider.isPointerInTransit.current=!1,this.root.onTriggerEnter(),Q(this.#t,!0))},250);return}this.root.onTriggerEnter(),Q(this.#t,!0)}};#l=e=>{E(this.#n)||e.pointerType!=="touch"&&(E(this.#t)||(this.#i(),this.root.provider.isPointerInTransit.current=!1,this.root.onTriggerEnter(),Q(this.#t,!0)))};#c=()=>{E(this.#n)||(this.#i(),this.root.onTriggerLeave(),Q(this.#t,!1))};#u=e=>{this.#e.current||E(this.#n)||this.root.ignoreNonKeyboardFocus&&!bK(e.currentTarget)||this.root.handleOpen()};#d=()=>{E(this.#n)||this.root.handleClose()};#h=()=>{this.root.disableCloseOnTriggerClick||E(this.#n)||this.root.handleClose()};#p=oe(()=>({id:this.opts.id.current,"aria-describedby":this.root.opts.open.current?this.root.contentNode?.id:void 0,"data-state":this.root.stateAttr,"data-disabled":Df(E(this.#n)),"data-delay-duration":`${this.root.delayDuration}`,[EN.trigger]:"",tabindex:E(this.#n)?void 0:0,disabled:this.opts.disabled.current,onpointerup:this.#a,onpointerdown:this.#s,onpointerenter:this.#o,onpointermove:this.#l,onpointerleave:this.#c,onfocus:this.#u,onblur:this.#d,onclick:this.#h,...this.attachment}));get props(){return E(this.#p)}set props(e){Q(this.#p,e)}}class fE{static create(e){return new fE(e,lE.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=Bs(this.opts.ref,r=>this.root.contentNode=r),new kN({triggerNode:()=>this.root.triggerNode,contentNode:()=>this.root.contentNode,enabled:()=>this.root.opts.open.current&&!this.root.disableHoverableContent,onPointerExit:()=>{this.root.provider.isTooltipOpen(this.root)&&this.root.handleClose()}}),iK(()=>Sr(window,"scroll",r=>{const i=r.target;i&&i.contains(this.root.triggerNode)&&this.root.handleClose()}))}onInteractOutside=e=>{if(df(e.target)&&this.root.triggerNode?.contains(e.target)&&this.root.disableCloseOnTriggerClick){e.preventDefault();return}this.opts.onInteractOutside.current(e),!e.defaultPrevented&&this.root.handleClose()};onEscapeKeydown=e=>{this.opts.onEscapeKeydown.current?.(e),!e.defaultPrevented&&this.root.handleClose()};onOpenAutoFocus=e=>{e.preventDefault()};onCloseAutoFocus=e=>{e.preventDefault()};get shouldRender(){return this.root.contentPresence.shouldRender}#e=oe(()=>({open:this.root.opts.open.current}));get snippetProps(){return E(this.#e)}set snippetProps(e){Q(this.#e,e)}#t=oe(()=>({id:this.opts.id.current,"data-state":this.root.stateAttr,"data-disabled":Df(this.root.disabled),style:{outline:"none"},[EN.content]:"",...this.attachment}));get props(){return E(this.#t)}set props(e){Q(this.#t,e)}popperProps={onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown,onOpenAutoFocus:this.onOpenAutoFocus,onCloseAutoFocus:this.onCloseAutoFocus}}function Eu(t,e){wt(e,!0);let n=ce(e,"open",15,!1),r=ce(e,"onOpenChange",3,vn),i=ce(e,"onOpenChangeComplete",3,vn);uE.create({open:$e(()=>n(),s=>{n(s),r()(s)}),delayDuration:$e(()=>e.delayDuration),disableCloseOnTriggerClick:$e(()=>e.disableCloseOnTriggerClick),disableHoverableContent:$e(()=>e.disableHoverableContent),ignoreNonKeyboardFocus:$e(()=>e.ignoreNonKeyboardFocus),disabled:$e(()=>e.disabled),onOpenChangeComplete:$e(()=>i())}),bN(t,{tooltip:!0,children:(s,o)=>{var a=ze(),l=Te(a);kt(l,()=>e.children??Bt),Y(s,a)},$$slots:{default:!0}}),vt()}var MZ=Ce("<div><div><!></div></div>"),NZ=Ce("<div><div><!></div></div>");function Tu(t,e){const n=sa();wt(e,!0);let r=ce(e,"id",19,()=>yl(n)),i=ce(e,"ref",15,null),s=ce(e,"side",3,"top"),o=ce(e,"sideOffset",3,0),a=ce(e,"align",3,"center"),l=ce(e,"avoidCollisions",3,!0),c=ce(e,"arrowPadding",3,0),u=ce(e,"sticky",3,"partial"),d=ce(e,"hideWhenDetached",3,!1),f=ce(e,"collisionPadding",3,0),h=ce(e,"onInteractOutside",3,vn),p=ce(e,"onEscapeKeydown",3,vn),m=ce(e,"forceMount",3,!1),g=Ni(e,["$$slots","$$events","$$legacy","children","child","id","ref","side","sideOffset","align","avoidCollisions","arrowPadding","sticky","strategy","hideWhenDetached","collisionPadding","onInteractOutside","onEscapeKeydown","forceMount"]);const y=fE.create({id:$e(()=>r()),ref:$e(()=>i(),k=>i(k)),onInteractOutside:$e(()=>h()),onEscapeKeydown:$e(()=>p())}),b=oe(()=>({side:s(),sideOffset:o(),align:a(),avoidCollisions:l(),arrowPadding:c(),sticky:u(),hideWhenDetached:d(),collisionPadding:f(),strategy:e.strategy})),x=oe(()=>gr(g,E(b),y.props));var C=ze(),P=Te(C);{var S=k=>{{const T=(M,L)=>{let F=()=>L?.().props,B=()=>L?.().wrapperProps;const R=oe(()=>gr(F(),{style:ey("tooltip")}));var A=ze(),N=Te(A);{var z=V=>{var q=ze(),G=Te(q);{let ne=oe(()=>({props:E(R),wrapperProps:B(),...y.snippetProps}));kt(G,()=>e.child,()=>E(ne))}Y(V,q)},U=V=>{var q=MZ();kr(q,()=>({...B()}));var G=ie(q);kr(G,()=>({...E(R)}));var ne=ie(G);kt(ne,()=>e.children??Bt),Y(V,q)};He(N,V=>{e.child?V(z):V(U,!1)})}Y(M,A)};let O=oe(()=>y.root.disableHoverableContent?"none":"auto");SN(k,qn(()=>E(x),()=>y.popperProps,{get enabled(){return y.root.opts.open.current},get id(){return r()},trapFocus:!1,loop:!1,preventScroll:!1,forceMount:!0,get ref(){return y.opts.ref},tooltip:!0,get shouldRender(){return y.shouldRender},get contentPointerEvents(){return E(O)},popper:T,$$slots:{popper:!0}}))}},_=k=>{var T=ze(),O=Te(T);{var M=L=>{{const F=(R,A)=>{let N=()=>A?.().props,z=()=>A?.().wrapperProps;const U=oe(()=>gr(N(),{style:ey("tooltip")}));var V=ze(),q=Te(V);{var G=te=>{var Z=ze(),ae=Te(Z);{let _e=oe(()=>({props:E(U),wrapperProps:z(),...y.snippetProps}));kt(ae,()=>e.child,()=>E(_e))}Y(te,Z)},ne=te=>{var Z=NZ();kr(Z,()=>({...z()}));var ae=ie(Z);kr(ae,()=>({...E(U)}));var _e=ie(ae);kt(_e,()=>e.children??Bt),Y(te,Z)};He(q,te=>{e.child?te(G):te(ne,!1)})}Y(R,V)};let B=oe(()=>y.root.disableHoverableContent?"none":"auto");xN(L,qn(()=>E(x),()=>y.popperProps,{get open(){return y.root.opts.open.current},get id(){return r()},trapFocus:!1,loop:!1,preventScroll:!1,forceMount:!1,get ref(){return y.opts.ref},tooltip:!0,get shouldRender(){return y.shouldRender},get contentPointerEvents(){return E(B)},popper:F,$$slots:{popper:!0}}))}};He(O,L=>{m()||L(M)},!0)}Y(k,T)};He(P,k=>{m()?k(S):k(_,!1)})}Y(t,C),vt()}var RZ=Ce("<button><!></button>");function Cu(t,e){const n=sa();wt(e,!0);let r=ce(e,"id",19,()=>yl(n)),i=ce(e,"disabled",3,!1),s=ce(e,"type",3,"button"),o=ce(e,"ref",15,null),a=Ni(e,["$$slots","$$events","$$legacy","children","child","id","disabled","type","ref"]);const l=dE.create({id:$e(()=>r()),disabled:$e(()=>i()??!1),ref:$e(()=>o(),u=>o(u))}),c=oe(()=>gr(a,l.props,{type:s()}));wN(t,{get id(){return r()},get ref(){return l.opts.ref},tooltip:!0,children:(u,d)=>{var f=ze(),h=Te(f);{var p=g=>{var y=ze(),b=Te(y);kt(b,()=>e.child,()=>({props:E(c)})),Y(g,y)},m=g=>{var y=RZ();kr(y,()=>({...E(c)}));var b=ie(y);kt(b,()=>e.children??Bt),Y(g,y)};He(h,g=>{e.child?g(p):g(m,!1)})}Y(u,f)},$$slots:{default:!0}}),vt()}function DZ(t,e){wt(e,!0);let n=ce(e,"delayDuration",3,700),r=ce(e,"disableCloseOnTriggerClick",3,!1),i=ce(e,"disableHoverableContent",3,!1),s=ce(e,"disabled",3,!1),o=ce(e,"ignoreNonKeyboardFocus",3,!1),a=ce(e,"skipDelayDuration",3,300);cE.create({delayDuration:$e(()=>n()),disableCloseOnTriggerClick:$e(()=>r()),disableHoverableContent:$e(()=>i()),disabled:$e(()=>s()),ignoreNonKeyboardFocus:$e(()=>o()),skipDelayDuration:$e(()=>a())});var l=ze(),c=Te(l);kt(c,()=>e.children??Bt),Y(t,l),vt()}function dP(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function CN(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function LZ(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");dP(t.outputLen),dP(t.blockLen)}function iy(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function BZ(t,e){CN(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Zv=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const _N=t=>t instanceof Uint8Array,Xv=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),wo=(t,e)=>t<<32-e|t>>>e,FZ=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!FZ)throw new Error("Non little-endian hardware is not supported");function $Z(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function hE(t){if(typeof t=="string"&&(t=$Z(t)),!_N(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function zZ(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!_N(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let AN=class{clone(){return this._cloneInto()}};function UZ(t){const e=r=>t().update(hE(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function PN(t=32){if(Zv&&typeof Zv.getRandomValues=="function")return Zv.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function HZ(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}let VZ=class extends AN{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Xv(this.buffer)}update(e){iy(this);const{view:n,buffer:r,blockLen:i}=this;e=hE(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=Xv(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){iy(this),BZ(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;HZ(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Xv(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const WZ=(t,e,n)=>t&e^~t&n,jZ=(t,e,n)=>t&e^t&n^e&n,qZ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Fl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),$l=new Uint32Array(64);let KZ=class extends VZ{constructor(){super(64,32,8,!1),this.A=Fl[0]|0,this.B=Fl[1]|0,this.C=Fl[2]|0,this.D=Fl[3]|0,this.E=Fl[4]|0,this.F=Fl[5]|0,this.G=Fl[6]|0,this.H=Fl[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)$l[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=$l[d-15],h=$l[d-2],p=wo(f,7)^wo(f,18)^f>>>3,m=wo(h,17)^wo(h,19)^h>>>10;$l[d]=m+$l[d-7]+p+$l[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=wo(a,6)^wo(a,11)^wo(a,25),h=u+f+WZ(a,l,c)+qZ[d]+$l[d]|0,m=(wo(r,2)^wo(r,13)^wo(r,22))+jZ(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){$l.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Cx=UZ(()=>new KZ);const IN=BigInt(0),Xb=BigInt(1),GZ=BigInt(2),Qb=t=>t instanceof Uint8Array,ZZ=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Bf(t){if(!Qb(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=ZZ[t[n]];return e}function ON(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function pE(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Ff(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Zi(t){return pE(Bf(t))}function mE(t){if(!Qb(t))throw new Error("Uint8Array expected");return pE(Bf(Uint8Array.from(t).reverse()))}function $c(t,e){return Ff(t.toString(16).padStart(e*2,"0"))}function gE(t,e){return $c(t,e).reverse()}function XZ(t){return Ff(ON(t))}function li(t,e,n){let r;if(typeof e=="string")try{r=Ff(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Qb(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function nd(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!Qb(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function QZ(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function YZ(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function JZ(t){let e;for(e=0;t>IN;t>>=Xb,e+=1);return e}function eX(t,e){return t>>BigInt(e)&Xb}const tX=(t,e,n)=>t|(n?Xb:IN)<<BigInt(e),yE=t=>(GZ<<BigInt(t-1))-Xb,Qv=t=>new Uint8Array(t),fP=t=>Uint8Array.from(t);function MN(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Qv(t),i=Qv(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...d)=>n(i,r,...d),l=(d=Qv())=>{i=a(fP([0]),d),r=a(),d.length!==0&&(i=a(fP([1]),d),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<e;){r=a();const h=r.slice();f.push(h),d+=r.length}return nd(...f)};return(d,f)=>{o(),l(d);let h;for(;!(h=f(c()));)l();return o(),h}}const nX={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Wm(t,e,n={}){const r=(i,s,o)=>{const a=nX[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const rX=Object.freeze(Object.defineProperty({__proto__:null,bitGet:eX,bitLen:JZ,bitMask:yE,bitSet:tX,bytesToHex:Bf,bytesToNumberBE:Zi,bytesToNumberLE:mE,concatBytes:nd,createHmacDrbg:MN,ensureBytes:li,equalBytes:QZ,hexToBytes:Ff,hexToNumber:pE,numberToBytesBE:$c,numberToBytesLE:gE,numberToHexUnpadded:ON,numberToVarBytesBE:XZ,utf8ToBytes:YZ,validateObject:Wm},Symbol.toStringTag,{value:"Module"}));const Tr=BigInt(0),ir=BigInt(1),wu=BigInt(2),iX=BigInt(3),_x=BigInt(4),hP=BigInt(5),pP=BigInt(8);BigInt(9);BigInt(16);function Wr(t,e){const n=t%e;return n>=Tr?n:e+n}function sX(t,e,n){if(n<=Tr||e<Tr)throw new Error("Expected power/modulo > 0");if(n===ir)return Tr;let r=ir;for(;e>Tr;)e&ir&&(r=r*t%n),t=t*t%n,e>>=ir;return r}function ws(t,e,n){let r=t;for(;e-- >Tr;)r*=r,r%=n;return r}function Ax(t,e){if(t===Tr||e<=Tr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Wr(t,e),r=e,i=Tr,s=ir;for(;n!==Tr;){const a=r/n,l=r%n,c=i-s*a;r=n,n=l,i=s,s=c}if(r!==ir)throw new Error("invert: does not exist");return Wr(i,e)}function oX(t){const e=(t-ir)/wu;let n,r,i;for(n=t-ir,r=0;n%wu===Tr;n/=wu,r++);for(i=wu;i<t&&sX(i,e,t)!==t-ir;i++);if(r===1){const o=(t+ir)/_x;return function(l,c){const u=l.pow(c,o);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+ir)/wu;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=r,u=a.pow(a.mul(a.ONE,i),n),d=a.pow(l,s),f=a.pow(l,n);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let m=a.sqr(f);h<c&&!a.eql(m,a.ONE);h++)m=a.sqr(m);const p=a.pow(u,ir<<BigInt(c-h-1));u=a.sqr(p),d=a.mul(d,p),f=a.mul(f,u),c=h}return d}}function aX(t){if(t%_x===iX){const e=(t+ir)/_x;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%pP===hP){const e=(t-hP)/pP;return function(r,i){const s=r.mul(i,wu),o=r.pow(s,e),a=r.mul(i,o),l=r.mul(r.mul(a,wu),o),c=r.mul(a,r.sub(l,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return oX(t)}const lX=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function cX(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=lX.reduce((r,i)=>(r[i]="function",r),e);return Wm(t,n)}function uX(t,e,n){if(n<Tr)throw new Error("Expected power > 0");if(n===Tr)return t.ONE;if(n===ir)return e;let r=t.ONE,i=e;for(;n>Tr;)n&ir&&(r=t.mul(r,i)),i=t.sqr(i),n>>=ir;return r}function dX(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function NN(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function fX(t,e,n=!1,r={}){if(t<=Tr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=NN(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=aX(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:yE(i),ZERO:Tr,ONE:ir,create:l=>Wr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Tr<=l&&l<t},is0:l=>l===Tr,isOdd:l=>(l&ir)===ir,neg:l=>Wr(-l,t),eql:(l,c)=>l===c,sqr:l=>Wr(l*l,t),add:(l,c)=>Wr(l+c,t),sub:(l,c)=>Wr(l-c,t),mul:(l,c)=>Wr(l*c,t),pow:(l,c)=>uX(a,l,c),div:(l,c)=>Wr(l*Ax(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>Ax(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>dX(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?gE(l,s):$c(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?mE(l):Zi(l)}});return Object.freeze(a)}function RN(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function DN(t){const e=RN(t);return e+Math.ceil(e/2)}function hX(t,e,n=!1){const r=t.length,i=RN(e),s=DN(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Zi(t):mE(t),a=Wr(o,e-ir)+ir;return n?gE(a,i):$c(a,i)}const pX=BigInt(0),Yv=BigInt(1);function mX(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>pX;)s&Yv&&(o=o.add(a)),a=a.double(),s>>=Yv;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let d=0;d<o;d++){u=c,l.push(u);for(let f=1;f<a;f++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const d=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const m=p*l;let g=Number(o&d);o>>=h,g>l&&(g-=f,o+=Yv);const y=m,b=m+Math.abs(g)-1,x=p%2!==0,C=g<0;g===0?u=u.add(n(x,s[y])):c=c.add(n(C,s[b]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function LN(t){return cX(t.Fp),Wm(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...NN(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function gX(t){const e=LN(t);Wm(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:yX,hexToBytes:bX}=rX,_u={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=_u;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:yX(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=_u,n=typeof t=="string"?bX(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=_u._parseInt(n.subarray(2)),{d:o,l:a}=_u._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},$a=BigInt(0),Ts=BigInt(1);BigInt(2);const mP=BigInt(3);BigInt(4);function wX(t){const e=gX(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return nd(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1),g=n.fromBytes(m.subarray(0,n.BYTES)),y=n.fromBytes(m.subarray(n.BYTES,2*n.BYTES));return{x:g,y}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&$a<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Bf(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let x;try{x=typeof p=="bigint"?p:Zi(li("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(x=Wr(x,b)),a(x),x}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=x=>n.eql(x,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map(y=>y.pz));return m.map((y,b)=>y.toAffine(g[b])).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(li("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:x,py:C,pz:P}=m,S=n.eql(n.mul(g,P),n.mul(x,b)),_=n.eql(n.mul(y,P),n.mul(C,b));return S&&_}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,mP),{px:b,py:x,pz:C}=this;let P=n.ZERO,S=n.ZERO,_=n.ZERO,k=n.mul(b,b),T=n.mul(x,x),O=n.mul(C,C),M=n.mul(b,x);return M=n.add(M,M),_=n.mul(b,C),_=n.add(_,_),P=n.mul(m,_),S=n.mul(y,O),S=n.add(P,S),P=n.sub(T,S),S=n.add(T,S),S=n.mul(P,S),P=n.mul(M,P),_=n.mul(y,_),O=n.mul(m,O),M=n.sub(k,O),M=n.mul(m,M),M=n.add(M,_),_=n.add(k,k),k=n.add(_,k),k=n.add(k,O),k=n.mul(k,M),S=n.add(S,k),O=n.mul(x,C),O=n.add(O,O),k=n.mul(O,M),P=n.sub(P,k),_=n.mul(O,T),_=n.add(_,_),_=n.add(_,_),new d(P,S,_)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:x,py:C,pz:P}=m;let S=n.ZERO,_=n.ZERO,k=n.ZERO;const T=e.a,O=n.mul(e.b,mP);let M=n.mul(g,x),L=n.mul(y,C),F=n.mul(b,P),B=n.add(g,y),R=n.add(x,C);B=n.mul(B,R),R=n.add(M,L),B=n.sub(B,R),R=n.add(g,b);let A=n.add(x,P);return R=n.mul(R,A),A=n.add(M,F),R=n.sub(R,A),A=n.add(y,b),S=n.add(C,P),A=n.mul(A,S),S=n.add(L,F),A=n.sub(A,S),k=n.mul(T,R),S=n.mul(O,F),k=n.add(S,k),S=n.sub(L,k),k=n.add(L,k),_=n.mul(S,k),L=n.add(M,M),L=n.add(L,M),F=n.mul(T,F),R=n.mul(O,R),L=n.add(L,F),F=n.sub(M,F),F=n.mul(T,F),R=n.add(R,F),M=n.mul(L,R),_=n.add(_,M),M=n.mul(A,R),S=n.mul(B,S),S=n.sub(S,M),M=n.mul(B,L),k=n.mul(A,k),k=n.add(k,M),new d(S,_,k)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,g=>{const y=n.invertBatch(g.map(b=>b.pz));return g.map((b,x)=>b.toAffine(y[x])).map(d.fromAffine)})}multiplyUnsafe(m){const g=d.ZERO;if(m===$a)return g;if(a(m),m===Ts)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:x,k2neg:C,k2:P}=y.splitScalar(m),S=g,_=g,k=this;for(;x>$a||P>$a;)x&Ts&&(S=S.add(k)),P&Ts&&(_=_.add(k)),k=k.double(),x>>=Ts,P>>=Ts;return b&&(S=S.negate()),C&&(_=_.negate()),_=new d(n.mul(_.px,y.beta),_.py,_.pz),S.add(_)}multiply(m){a(m);let g=m,y,b;const{endo:x}=e;if(x){const{k1neg:C,k1:P,k2neg:S,k2:_}=x.splitScalar(g);let{p:k,f:T}=this.wNAF(P),{p:O,f:M}=this.wNAF(_);k=h.constTimeNegate(C,k),O=h.constTimeNegate(S,O),O=new d(n.mul(O.px,x.beta),O.py,O.pz),y=k.add(O),b=T.add(M)}else{const{p:C,f:P}=this.wNAF(g);y=C,b=P}return d.normalizeZ([y,b])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,x=(P,S)=>S===$a||S===Ts||!P.equals(b)?P.multiplyUnsafe(S):P.multiply(S),C=x(this,g).add(x(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,x=this.is0();m==null&&(m=x?n.ONE:n.inv(b));const C=n.mul(g,m),P=n.mul(y,m),S=n.mul(b,m);if(x)return{x:n.ZERO,y:n.ZERO};if(!n.eql(S,n.ONE))throw new Error("invZ was invalid");return{x:C,y:P}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===Ts)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===Ts?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return Bf(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=mX(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function vX(t){const e=LN(t);return Wm(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function xX(t){const e=vX(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(R){return $a<R&&R<n.ORDER}function a(R){return Wr(R,r)}function l(R){return Ax(R,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=wX({...e,toBytes(R,A,N){const z=A.toAffine(),U=n.toBytes(z.x),V=nd;return N?V(Uint8Array.from([A.hasEvenY()?2:3]),U):V(Uint8Array.from([4]),U,n.toBytes(z.y))},fromBytes(R){const A=R.length,N=R[0],z=R.subarray(1);if(A===i&&(N===2||N===3)){const U=Zi(z);if(!o(U))throw new Error("Point is not on curve");const V=d(U);let q=n.sqrt(V);const G=(q&Ts)===Ts;return(N&1)===1!==G&&(q=n.neg(q)),{x:U,y:q}}else if(A===s&&N===4){const U=n.fromBytes(z.subarray(0,n.BYTES)),V=n.fromBytes(z.subarray(n.BYTES,2*n.BYTES));return{x:U,y:V}}else throw new Error(`Point of length ${A} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=R=>Bf($c(R,e.nByteLength));function p(R){const A=r>>Ts;return R>A}function m(R){return p(R)?a(-R):R}const g=(R,A,N)=>Zi(R.slice(A,N));class y{constructor(A,N,z){this.r=A,this.s=N,this.recovery=z,this.assertValidity()}static fromCompact(A){const N=e.nByteLength;return A=li("compactSignature",A,N*2),new y(g(A,0,N),g(A,N,2*N))}static fromDER(A){const{r:N,s:z}=_u.toSig(li("DER",A));return new y(N,z)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(A){return new y(this.r,this.s,A)}recoverPublicKey(A){const{r:N,s:z,recovery:U}=this,V=_(li("msgHash",A));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const q=U===2||U===3?N+e.n:N;if(q>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const G=(U&1)===0?"02":"03",ne=c.fromHex(G+h(q)),te=l(q),Z=a(-V*te),ae=a(z*te),_e=c.BASE.multiplyAndAddUnsafe(ne,Z,ae);if(!_e)throw new Error("point at infinify");return _e.assertValidity(),_e}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Ff(this.toDERHex())}toDERHex(){return _u.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ff(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const b={isValidPrivateKey(R){try{return u(R),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const R=DN(e.n);return hX(e.randomBytes(R),e.n)},precompute(R=8,A=c.BASE){return A._setWindowSize(R),A.multiply(BigInt(3)),A}};function x(R,A=!0){return c.fromPrivateKey(R).toRawBytes(A)}function C(R){const A=R instanceof Uint8Array,N=typeof R=="string",z=(A||N)&&R.length;return A?z===i||z===s:N?z===2*i||z===2*s:R instanceof c}function P(R,A,N=!0){if(C(R))throw new Error("first arg must be private key");if(!C(A))throw new Error("second arg must be public key");return c.fromHex(A).multiply(u(R)).toRawBytes(N)}const S=e.bits2int||function(R){const A=Zi(R),N=R.length*8-e.nBitLength;return N>0?A>>BigInt(N):A},_=e.bits2int_modN||function(R){return a(S(R))},k=yE(e.nBitLength);function T(R){if(typeof R!="bigint")throw new Error("bigint expected");if(!($a<=R&&R<k))throw new Error(`bigint expected < 2^${e.nBitLength}`);return $c(R,e.nByteLength)}function O(R,A,N=M){if(["recovered","canonical"].some(Ee=>Ee in N))throw new Error("sign() legacy options not supported");const{hash:z,randomBytes:U}=e;let{lowS:V,prehash:q,extraEntropy:G}=N;V==null&&(V=!0),R=li("msgHash",R),q&&(R=li("prehashed msgHash",z(R)));const ne=_(R),te=u(A),Z=[T(te),T(ne)];if(G!=null){const Ee=G===!0?U(n.BYTES):G;Z.push(li("extraEntropy",Ee))}const ae=nd(...Z),_e=ne;function de(Ee){const Re=S(Ee);if(!f(Re))return;const je=l(Re),Ve=c.BASE.multiply(Re).toAffine(),Se=a(Ve.x);if(Se===$a)return;const Me=a(je*a(_e+Se*te));if(Me===$a)return;let Ne=(Ve.x===Se?0:2)|Number(Ve.y&Ts),Ke=Me;return V&&p(Me)&&(Ke=m(Me),Ne^=1),new y(Se,Ke,Ne)}return{seed:ae,k2sig:de}}const M={lowS:e.lowS,prehash:!1},L={lowS:e.lowS,prehash:!1};function F(R,A,N=M){const{seed:z,k2sig:U}=O(R,A,N),V=e;return MN(V.hash.outputLen,V.nByteLength,V.hmac)(z,U)}c.BASE._setWindowSize(8);function B(R,A,N,z=L){const U=R;if(A=li("msgHash",A),N=li("publicKey",N),"strict"in z)throw new Error("options.strict was renamed to lowS");const{lowS:V,prehash:q}=z;let G,ne;try{if(typeof U=="string"||U instanceof Uint8Array)try{G=y.fromDER(U)}catch(Ve){if(!(Ve instanceof _u.Err))throw Ve;G=y.fromCompact(U)}else if(typeof U=="object"&&typeof U.r=="bigint"&&typeof U.s=="bigint"){const{r:Ve,s:Se}=U;G=new y(Ve,Se)}else throw new Error("PARSE");ne=c.fromHex(N)}catch(Ve){if(Ve.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(V&&G.hasHighS())return!1;q&&(A=e.hash(A));const{r:te,s:Z}=G,ae=_(A),_e=l(Z),de=a(ae*_e),Ee=a(te*_e),Re=c.BASE.multiplyAndAddUnsafe(ne,de,Ee)?.toAffine();return Re?a(Re.x)===te:!1}return{CURVE:e,getPublicKey:x,getSharedSecret:P,sign:F,verify:B,ProjectivePoint:c,Signature:y,utils:b}}let BN=class extends AN{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,LZ(e);const r=hE(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return iy(this),this.iHash.update(e),this}digestInto(e){iy(this),CN(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const FN=(t,e,n)=>new BN(t,e).update(n).digest();FN.create=(t,e)=>new BN(t,e);function SX(t){return{hash:t,hmac:(e,...n)=>FN(t,e,zZ(...n)),randomBytes:PN}}function kX(t,e){const n=r=>xX({...t,...SX(r)});return Object.freeze({...n(e),create:n})}const Yb=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),sy=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),$N=BigInt(1),oy=BigInt(2),gP=(t,e)=>(t+e/oy)/e;function zN(t){const e=Yb,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=ws(u,n,e)*u%e,f=ws(d,n,e)*u%e,h=ws(f,oy,e)*c%e,p=ws(h,i,e)*h%e,m=ws(p,s,e)*p%e,g=ws(m,a,e)*m%e,y=ws(g,l,e)*g%e,b=ws(y,a,e)*m%e,x=ws(b,n,e)*u%e,C=ws(x,o,e)*p%e,P=ws(C,r,e)*c%e,S=ws(P,oy,e);if(!Px.eql(Px.sqr(S),t))throw new Error("Cannot find square root");return S}const Px=fX(Yb,void 0,void 0,{sqrt:zN}),ah=kX({a:BigInt(0),b:BigInt(7),Fp:Px,n:sy,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=sy,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-$N*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=gP(s*t,e),l=gP(-r*t,e);let c=Wr(t-a*n-l*i,e),u=Wr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},Cx),Jb=BigInt(0),UN=t=>typeof t=="bigint"&&Jb<t&&t<Yb,EX=t=>typeof t=="bigint"&&Jb<t&&t<sy,yP={};function ay(t,...e){let n=yP[t];if(n===void 0){const r=Cx(Uint8Array.from(t,i=>i.charCodeAt(0)));n=nd(r,r),yP[t]=n}return Cx(nd(n,...e))}const bE=t=>t.toRawBytes(!0).slice(1),Ix=t=>$c(t,32),Jv=t=>Wr(t,Yb),Jp=t=>Wr(t,sy),wE=ah.ProjectivePoint,TX=(t,e,n)=>wE.BASE.multiplyAndAddUnsafe(t,e,n);function Ox(t){let e=ah.utils.normPrivateKeyToScalar(t),n=wE.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Jp(-e),bytes:bE(n)}}function HN(t){if(!UN(t))throw new Error("bad x: need 0 < x < p");const e=Jv(t*t),n=Jv(e*t+BigInt(7));let r=zN(n);r%oy!==Jb&&(r=Jv(-r));const i=new wE(t,r,$N);return i.assertValidity(),i}function VN(...t){return Jp(Zi(ay("BIP0340/challenge",...t)))}function CX(t){return Ox(t).bytes}function _X(t,e,n=PN(32)){const r=li("message",t),{bytes:i,scalar:s}=Ox(e),o=li("auxRand",n,32),a=Ix(s^Zi(ay("BIP0340/aux",o))),l=ay("BIP0340/nonce",a,i,r),c=Jp(Zi(l));if(c===Jb)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=Ox(c),f=VN(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(Ix(Jp(d+f*s)),32),!WN(h,r,i))throw new Error("sign: Invalid signature produced");return h}function WN(t,e,n){const r=li("signature",t,64),i=li("message",e),s=li("publicKey",n,32);try{const o=HN(Zi(s)),a=Zi(r.subarray(0,32));if(!UN(a))return!1;const l=Zi(r.subarray(32,64));if(!EX(l))return!1;const c=VN(Ix(a),bE(o),i),u=TX(o,l,Jp(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const Ro={getPublicKey:CX,sign:_X,verify:WN,utils:{randomPrivateKey:ah.utils.randomPrivateKey,lift_x:HN,pointToBytes:bE,numberToBytesBE:$c,bytesToNumberBE:Zi,taggedHash:ay,mod:Wr}},e1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const vE=t=>t instanceof Uint8Array,t1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),vo=(t,e)=>t<<32-e|t>>>e,AX=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!AX)throw new Error("Non little-endian hardware is not supported");const PX=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ur(t){if(!vE(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=PX[t[n]];return e}function rd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function IX(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function em(t){if(typeof t=="string"&&(t=IX(t)),!vE(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function ew(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!vE(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class jN{clone(){return this._cloneInto()}}function qN(t){const e=r=>t().update(em(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function KN(t=32){if(e1&&typeof e1.getRandomValues=="function")return e1.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Mx(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function OX(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function GN(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function MX(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Mx(t.outputLen),Mx(t.blockLen)}function NX(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function RX(t,e){GN(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const $o={number:Mx,bool:OX,bytes:GN,hash:MX,exists:NX,output:RX};function DX(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}class LX extends jN{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=t1(this.buffer)}update(e){$o.exists(this);const{view:n,buffer:r,blockLen:i}=this;e=em(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=t1(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$o.exists(this),$o.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;DX(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=t1(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const BX=(t,e,n)=>t&e^~t&n,FX=(t,e,n)=>t&e^t&n^e&n,$X=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),zl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ul=new Uint32Array(64);class ZN extends LX{constructor(){super(64,32,8,!1),this.A=zl[0]|0,this.B=zl[1]|0,this.C=zl[2]|0,this.D=zl[3]|0,this.E=zl[4]|0,this.F=zl[5]|0,this.G=zl[6]|0,this.H=zl[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)Ul[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=Ul[d-15],h=Ul[d-2],p=vo(f,7)^vo(f,18)^f>>>3,m=vo(h,17)^vo(h,19)^h>>>10;Ul[d]=m+Ul[d-7]+p+Ul[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=vo(a,6)^vo(a,11)^vo(a,25),h=u+f+BX(a,l,c)+$X[d]+Ul[d]|0,m=(vo(r,2)^vo(r,13)^vo(r,22))+FX(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Ul.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class zX extends ZN{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Zc=qN(()=>new ZN);qN(()=>new zX);function lh(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function bl(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce((i,s)=>i?e(i,s.encode):s.encode,void 0),r=t.reduce((i,s)=>i?e(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function wl(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(lh(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function vl(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function tw(t,e="="){if(lh(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function XN(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function bP(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach(o=>{if(lh(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!==e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[l]?a=!1:r=l;else continue}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const QN=(t,e)=>e?QN(e,t%e):t,ly=(t,e)=>t+(e-QN(t,e));function Nx(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(ly(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${ly(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(lh(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function UX(t){return lh(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return bP(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(bP(e,t,2**8))}}}function Xc(t,e=!1){if(lh(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(ly(8,t)>32||ly(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Nx(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Nx(n,t,8,e))}}}function wP(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const HX=bl(Xc(4),wl("0123456789ABCDEF"),vl("")),VX=bl(Xc(5),wl("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),tw(5),vl(""));bl(Xc(5),wl("0123456789ABCDEFGHIJKLMNOPQRSTUV"),tw(5),vl(""));bl(Xc(5),wl("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),vl(""),XN(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Jo=bl(Xc(6),wl("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),tw(6),vl("")),WX=bl(Xc(6),wl("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),tw(6),vl("")),xE=t=>bl(UX(58),wl(t),vl("")),Rx=xE("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");xE("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");xE("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const vP=[0,2,3,5,6,7,9,10,11],jX={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=Rx.encode(r).padStart(vP[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),i=vP.indexOf(r.length),s=Rx.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(e)}},Dx=bl(wl("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),vl("")),xP=[996825010,642813549,513874426,1027748829,705979059];function Dh(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<xP.length;r++)(e>>r&1)===1&&(n^=xP[r]);return n}function SP(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Dh(i)^o>>5}i=Dh(i);for(let s=0;s<r;s++)i=Dh(i)^t.charCodeAt(s)&31;for(let s of e)i=Dh(i)^s;for(let s=0;s<6;s++)i=Dh(i);return i^=n,Dx.encode(Nx([i%2**30],30,5,!1))}function YN(t){const e=t==="bech32"?1:734539939,n=Xc(5),r=n.decode,i=n.encode,s=wP(r);function o(u,d,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof d}`);const h=u.length+7+d.length;if(f!==!1&&h>f)throw new TypeError(`Length ${h} exceeds limit ${f}`);return u=u.toLowerCase(),`${u}1${Dx.encode(d)}${SP(u,d,e)}`}function a(u,d=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||d!==!1&&u.length>d)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${d})`);const f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=f;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=u.slice(0,h),m=u.slice(h+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const g=Dx.decode(m).slice(0,-6),y=SP(p,g,e);if(!m.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:g}}const l=wP(a);function c(u){const{prefix:d,words:f}=a(u,!1);return{prefix:d,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const $f=YN("bech32");YN("bech32m");const qX={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},KX=bl(Xc(4),wl("0123456789abcdef"),vl(""),XN(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),GX={utf8:qX,hex:KX,base16:HX,base32:VX,base64:Jo,base64url:WX,base58:Rx,base58xmr:jX};`${Object.keys(GX).join(", ")}`;function n1(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function kP(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function ZX(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function zo(t,...e){if(!ZX(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}const hi=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),XX=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!XX)throw new Error("Non little-endian hardware is not supported");const QX=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Id(t){zo(t);let e="";for(let n=0;n<t.length;n++)e+=QX[t[n]];return e}const wa={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function EP(t){if(t>=wa._0&&t<=wa._9)return t-wa._0;if(t>=wa._A&&t<=wa._F)return t-(wa._A-10);if(t>=wa._a&&t<=wa._f)return t-(wa._a-10)}function JN(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=EP(t.charCodeAt(s)),a=EP(t.charCodeAt(s+1));if(o===void 0||a===void 0){const l=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function YX(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function JX(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const eQ=(t,e)=>(Object.assign(e,t),e),kc=16,tQ=283;function SE(t){return t<<1^tQ&-(t>>7)}function Xd(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=SE(t);return n}const Lx=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=SE(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),nQ=Lx.map((t,e)=>Lx.indexOf(e)),rQ=t=>t<<24|t>>>8,r1=t=>t<<8|t>>>24;function eR(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((c,u)=>e(t[u])),r=n.map(r1),i=r.map(r1),s=i.map(r1),o=new Uint32Array(256*256),a=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const d=c*256+u;o[d]=n[c]^r[u],a[d]=i[c]^s[u],l[d]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const kE=eR(Lx,t=>Xd(t,3)<<24|t<<16|t<<8|Xd(t,2)),tR=eR(nQ,t=>Xd(t,11)<<24|Xd(t,13)<<16|Xd(t,9)<<8|Xd(t,14)),iQ=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=SE(n))t[e]=n;return t})();function nR(t){zo(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=kE,r=hi(t),i=r.length,s=a=>Uo(n,a,a,a,a),o=new Uint32Array(e+28);o.set(r);for(let a=i;a<o.length;a++){let l=o[a-1];a%i===0?l=s(rQ(l))^iQ[a/i-1]:i>6&&a%i===4&&(l=s(l)),o[a]=o[a-i]^l}return o}function sQ(t){const e=nR(t),n=e.slice(),r=e.length,{sbox2:i}=kE,{T0:s,T1:o,T2:a,T3:l}=tR;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],d=Uo(i,u,u,u,u);n[c]=s[d&255]^o[d>>>8&255]^a[d>>>16&255]^l[d>>>24]}return n}function uc(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function Uo(t,e,n,r,i){return t[e&255|n&65280]|t[r>>>16&255|i>>>16&65280]<<16}function TP(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=kE;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const m=t[l++]^uc(o,a,e,n,r,i),g=t[l++]^uc(o,a,n,r,i,e),y=t[l++]^uc(o,a,r,i,e,n),b=t[l++]^uc(o,a,i,e,n,r);e=m,n=g,r=y,i=b}const u=t[l++]^Uo(s,e,n,r,i),d=t[l++]^Uo(s,n,r,i,e),f=t[l++]^Uo(s,r,i,e,n),h=t[l++]^Uo(s,i,e,n,r);return{s0:u,s1:d,s2:f,s3:h}}function oQ(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=tR;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const m=t[l++]^uc(o,a,e,i,r,n),g=t[l++]^uc(o,a,n,e,i,r),y=t[l++]^uc(o,a,r,n,e,i),b=t[l++]^uc(o,a,i,r,n,e);e=m,n=g,r=y,i=b}const u=t[l++]^Uo(s,e,i,r,n),d=t[l++]^Uo(s,n,e,i,r),f=t[l++]^Uo(s,r,n,e,i),h=t[l++]^Uo(s,i,r,n,e);return{s0:u,s1:d,s2:f,s3:h}}function rR(t,e){if(!e)return new Uint8Array(t);if(zo(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function aQ(t){if(zo(t),t.length%kc!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${kc}`)}function lQ(t,e,n){let r=t.length;const i=r%kc;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=hi(t);if(e){let l=kc-i;l||(l=kc),r=r+l}const o=rR(r,n),a=hi(o);return{b:s,o:a,out:o}}function cQ(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function uQ(t){const e=new Uint8Array(16),n=hi(e);e.set(t);const r=kc-t.length;for(let i=kc-r;i<kc;i++)e[i]=r;return n}const iR=eQ({blockSize:16,nonceLength:16},function(e,n,r={}){zo(e),zo(n,16);const i=!r.disablePadding;return{encrypt:(s,o)=>{const a=nR(e),{b:l,o:c,out:u}=lQ(s,i,o),d=hi(n);let f=d[0],h=d[1],p=d[2],m=d[3],g=0;for(;g+4<=l.length;)f^=l[g+0],h^=l[g+1],p^=l[g+2],m^=l[g+3],{s0:f,s1:h,s2:p,s3:m}=TP(a,f,h,p,m),c[g++]=f,c[g++]=h,c[g++]=p,c[g++]=m;if(i){const y=uQ(s.subarray(g*4));f^=y[0],h^=y[1],p^=y[2],m^=y[3],{s0:f,s1:h,s2:p,s3:m}=TP(a,f,h,p,m),c[g++]=f,c[g++]=h,c[g++]=p,c[g++]=m}return a.fill(0),u},decrypt:(s,o)=>{aQ(s);const a=sQ(e),l=hi(n),c=rR(s.length,o),u=hi(s),d=hi(c);let f=l[0],h=l[1],p=l[2],m=l[3];for(let g=0;g+4<=u.length;){const y=f,b=h,x=p,C=m;f=u[g+0],h=u[g+1],p=u[g+2],m=u[g+3];const{s0:P,s1:S,s2:_,s3:k}=oQ(a,f,h,p,m);d[g++]=P^y,d[g++]=S^b,d[g++]=_^x,d[g++]=k^C}return a.fill(0),cQ(c,i)}}}),sR=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),dQ=sR("expand 16-byte k"),fQ=sR("expand 32-byte k"),hQ=hi(dQ),oR=hi(fQ);oR.slice();function rn(t,e){return t<<e|t>>>32-e}function Bx(t){return t.byteOffset%4===0}const Ig=64,pQ=16,aR=2**32-1,CP=new Uint32Array;function mQ(t,e,n,r,i,s,o,a){const l=i.length,c=new Uint8Array(Ig),u=hi(c),d=Bx(i)&&Bx(s),f=d?hi(i):CP,h=d?hi(s):CP;for(let p=0;p<l;o++){if(t(e,n,r,u,o,a),o>=aR)throw new Error("arx: counter overflow");const m=Math.min(Ig,l-p);if(d&&m===Ig){const g=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let y=0,b;y<pQ;y++)b=g+y,h[b]=f[b]^u[y];p+=Ig;continue}for(let g=0,y;g<m;g++)y=p+g,s[y]=i[y]^c[g];p+=m}}function gQ(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=YX({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return n1(i),n1(o),kP(s),kP(n),(a,l,c,u,d=0)=>{zo(a),zo(l),zo(c);const f=c.length;if(u||(u=new Uint8Array(f)),zo(u),n1(d),d<0||d>=aR)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const h=[];let p=a.length,m,g;if(p===32)m=a.slice(),h.push(m),g=oR;else if(p===16&&n)m=new Uint8Array(32),m.set(a),m.set(a,16),g=hQ,h.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Bx(l)||(l=l.slice(),h.push(l));const y=hi(m);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,y,hi(l.subarray(0,16)),y),l=l.subarray(16)}const b=16-i;if(b!==l.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const C=new Uint8Array(12);C.set(l,s?0:12-l.length),l=C,h.push(l)}const x=hi(l);for(mQ(t,g,y,x,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function yQ(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],d=e[1],f=e[2],h=e[3],p=e[4],m=e[5],g=e[6],y=e[7],b=i,x=n[0],C=n[1],P=n[2],S=o,_=a,k=l,T=c,O=u,M=d,L=f,F=h,B=p,R=m,A=g,N=y,z=b,U=x,V=C,q=P;for(let ne=0;ne<s;ne+=2)S=S+O|0,z=rn(z^S,16),B=B+z|0,O=rn(O^B,12),S=S+O|0,z=rn(z^S,8),B=B+z|0,O=rn(O^B,7),_=_+M|0,U=rn(U^_,16),R=R+U|0,M=rn(M^R,12),_=_+M|0,U=rn(U^_,8),R=R+U|0,M=rn(M^R,7),k=k+L|0,V=rn(V^k,16),A=A+V|0,L=rn(L^A,12),k=k+L|0,V=rn(V^k,8),A=A+V|0,L=rn(L^A,7),T=T+F|0,q=rn(q^T,16),N=N+q|0,F=rn(F^N,12),T=T+F|0,q=rn(q^T,8),N=N+q|0,F=rn(F^N,7),S=S+M|0,q=rn(q^S,16),A=A+q|0,M=rn(M^A,12),S=S+M|0,q=rn(q^S,8),A=A+q|0,M=rn(M^A,7),_=_+L|0,z=rn(z^_,16),N=N+z|0,L=rn(L^N,12),_=_+L|0,z=rn(z^_,8),N=N+z|0,L=rn(L^N,7),k=k+F|0,U=rn(U^k,16),B=B+U|0,F=rn(F^B,12),k=k+F|0,U=rn(U^k,8),B=B+U|0,F=rn(F^B,7),T=T+O|0,V=rn(V^T,16),R=R+V|0,O=rn(O^R,12),T=T+O|0,V=rn(V^T,8),R=R+V|0,O=rn(O^R,7);let G=0;r[G++]=o+S|0,r[G++]=a+_|0,r[G++]=l+k|0,r[G++]=c+T|0,r[G++]=u+O|0,r[G++]=d+M|0,r[G++]=f+L|0,r[G++]=h+F|0,r[G++]=p+B|0,r[G++]=m+R|0,r[G++]=g+A|0,r[G++]=y+N|0,r[G++]=b+z|0,r[G++]=x+U|0,r[G++]=C+V|0,r[G++]=P+q|0}const lR=gQ(yQ,{counterRight:!1,counterLength:4,allowShortKeys:!1});class cR extends jN{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,$o.hash(e);const r=em(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return $o.exists(this),this.iHash.update(e),this}digestInto(e){$o.exists(this),$o.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const nw=(t,e,n)=>new cR(t,e).update(n).digest();nw.create=(t,e)=>new cR(t,e);function bQ(t,e,n){return $o.hash(t),nw(t,em(n),em(e))}const i1=new Uint8Array([0]),_P=new Uint8Array;function wQ(t,e,n,r=32){if($o.hash(t),$o.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=_P);const s=new Uint8Array(i*t.outputLen),o=nw.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)i1[0]=c+1,a.update(c===0?_P:l).update(n).update(i1).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),i1.fill(0),s.slice(0,r)}var vQ=Object.defineProperty,Bn=(t,e)=>{for(var n in e)vQ(t,n,{get:e[n],enumerable:!0})},Od=Symbol("verified"),xQ=t=>t instanceof Object;function EE(t){if(!xQ(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var SQ={};Bn(SQ,{Queue:()=>CQ,QueueNode:()=>uR,binarySearch:()=>TE,bytesToHex:()=>ur,hexToBytes:()=>rd,insertEventIntoAscendingList:()=>TQ,insertEventIntoDescendingList:()=>EQ,normalizeURL:()=>kQ,utf8Decoder:()=>qa,utf8Encoder:()=>co});var qa=new TextDecoder("utf-8"),co=new TextEncoder;function kQ(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.protocol==="http:"?e.protocol="ws:":e.protocol==="https:"&&(e.protocol="wss:"),e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function EQ(t,e){const[n,r]=TE(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at);return r||t.splice(n,0,e),t}function TQ(t,e){const[n,r]=TE(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at);return r||t.splice(n,0,e),t}function TE(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var uR=class{value;next=null;prev=null;constructor(t){this.value=t}},CQ=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new uR(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},_Q=class{generateSecretKey(){return Ro.utils.randomPrivateKey()}getPublicKey(e){return ur(Ro.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=ur(Ro.getPublicKey(n)),r.id=l0(r),r.sig=ur(Ro.sign(l0(r),n)),r[Od]=!0,r}verifyEvent(e){if(typeof e[Od]=="boolean")return e[Od];const n=l0(e);if(n!==e.id)return e[Od]=!1,!1;try{const r=Ro.verify(e.sig,n,e.pubkey);return e[Od]=r,r}catch{return e[Od]=!1,!1}}};function AQ(t){if(!EE(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function l0(t){let e=Zc(co.encode(AQ(t)));return ur(e)}var rw=new _Q,PQ=rw.generateSecretKey,iw=rw.getPublicKey,la=rw.finalizeEvent,CE=rw.verifyEvent,IQ={};Bn(IQ,{Application:()=>HY,BadgeAward:()=>FQ,BadgeDefinition:()=>DY,BlockedRelaysList:()=>yY,BlossomServerList:()=>EY,BookmarkList:()=>pY,Bookmarksets:()=>MY,Calendar:()=>ZY,CalendarEventRSVP:()=>XY,ChannelCreation:()=>gR,ChannelHideMessage:()=>wR,ChannelMessage:()=>bR,ChannelMetadata:()=>yR,ChannelMuteUser:()=>vR,ChatMessage:()=>$Q,ClassifiedListing:()=>jY,ClientAuth:()=>SR,Comment:()=>GQ,CommunitiesList:()=>mY,CommunityDefinition:()=>eJ,CommunityPostApproval:()=>nY,Contacts:()=>DQ,CreateOrUpdateProduct:()=>FY,CreateOrUpdateStall:()=>BY,Curationsets:()=>NY,Date:()=>KY,DirectMessageRelaysList:()=>SY,DraftClassifiedListing:()=>qY,DraftLong:()=>zY,Emojisets:()=>UY,EncryptedDirectMessage:()=>LQ,EventDeletion:()=>BQ,FavoriteRelays:()=>wY,FileMessage:()=>UQ,FileMetadata:()=>KQ,FileServerPreference:()=>kY,Followsets:()=>PY,ForumThread:()=>zQ,GenericRepost:()=>OE,Genericlists:()=>IY,GiftWrap:()=>xR,GroupMetadata:()=>tJ,HTTPAuth:()=>ME,Handlerinformation:()=>JY,Handlerrecommendation:()=>YY,Highlights:()=>cY,InterestsList:()=>vY,Interestsets:()=>LY,JobFeedback:()=>sY,JobRequest:()=>rY,JobResult:()=>iY,Label:()=>tY,LightningPubRPC:()=>CY,LiveChatMessage:()=>ZQ,LiveEvent:()=>VY,LongFormArticle:()=>$Y,Metadata:()=>NQ,Mutelist:()=>dY,NWCWalletInfo:()=>TY,NWCWalletRequest:()=>kR,NWCWalletResponse:()=>_Y,NormalVideo:()=>VQ,NostrConnect:()=>AY,OpenTimestamps:()=>jQ,Photo:()=>HQ,Pinlist:()=>fY,Poll:()=>qQ,PollResponse:()=>uY,PrivateDirectMessage:()=>mR,ProblemTracker:()=>YQ,ProfileBadges:()=>RY,PublicChatsList:()=>gY,Reaction:()=>IE,RecommendRelay:()=>RQ,RelayList:()=>hY,RelayReview:()=>QY,Relaysets:()=>OY,Report:()=>JQ,Reporting:()=>eY,Repost:()=>PE,Seal:()=>pR,SearchRelaysList:()=>bY,ShortTextNote:()=>hR,ShortVideo:()=>WQ,Time:()=>GY,UserEmojiList:()=>xY,UserStatuses:()=>WY,Voice:()=>XQ,VoiceComment:()=>QQ,Zap:()=>lY,ZapGoal:()=>oY,ZapRequest:()=>aY,classifyKind:()=>OQ,isAddressableKind:()=>AE,isEphemeralKind:()=>fR,isKind:()=>MQ,isRegularKind:()=>dR,isReplaceableKind:()=>_E});function dR(t){return t<1e4&&t!==0&&t!==3}function _E(t){return t===0||t===3||1e4<=t&&t<2e4}function fR(t){return 2e4<=t&&t<3e4}function AE(t){return 3e4<=t&&t<4e4}function OQ(t){return dR(t)?"regular":_E(t)?"replaceable":fR(t)?"ephemeral":AE(t)?"parameterized":"unknown"}function MQ(t,e){const n=e instanceof Array?e:[e];return EE(t)&&n.includes(t.kind)||!1}var NQ=0,hR=1,RQ=2,DQ=3,LQ=4,BQ=5,PE=6,IE=7,FQ=8,$Q=9,zQ=11,pR=13,mR=14,UQ=15,OE=16,HQ=20,VQ=21,WQ=22,gR=40,yR=41,bR=42,wR=43,vR=44,jQ=1040,xR=1059,qQ=1068,KQ=1063,GQ=1111,ZQ=1311,XQ=1222,QQ=1244,YQ=1971,JQ=1984,eY=1984,tY=1985,nY=4550,rY=5999,iY=6999,sY=7e3,oY=9041,aY=9734,lY=9735,cY=9802,uY=1018,dY=1e4,fY=10001,hY=10002,pY=10003,mY=10004,gY=10005,yY=10006,bY=10007,wY=10012,vY=10015,xY=10030,SY=10050,kY=10096,EY=10063,TY=13194,CY=21e3,SR=22242,kR=23194,_Y=23195,AY=24133,ME=27235,PY=3e4,IY=30001,OY=30002,MY=30003,NY=30004,RY=30008,DY=30009,LY=30015,BY=30017,FY=30018,$Y=30023,zY=30024,UY=30030,HY=30078,VY=30311,WY=30315,jY=30402,qY=30403,KY=31922,GY=31923,ZY=31924,XY=31925,QY=31987,YY=31989,JY=31990,eJ=34550,tJ=39e3,nJ={};Bn(nJ,{getHex64:()=>NE,getInt:()=>ER,getSubscriptionId:()=>rJ,matchEventId:()=>iJ,matchEventKind:()=>oJ,matchEventPubkey:()=>sJ});function NE(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function ER(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function rJ(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function iJ(t,e){return e===NE(t,"id")}function sJ(t,e){return e===NE(t,"pubkey")}function oJ(t,e){return e===ER(t,"kind")}var aJ={};Bn(aJ,{makeAuthEvent:()=>lJ});function lJ(t,e){return{kind:SR,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var cJ;try{cJ=WebSocket}catch{}var uJ;try{uJ=WebSocket}catch{}var cl={};Bn(cl,{BECH32_REGEX:()=>TR,Bech32MaxSize:()=>RE,NostrTypeGuard:()=>dJ,decode:()=>sw,decodeNostrURI:()=>hJ,encodeBytes:()=>aw,naddrEncode:()=>wJ,neventEncode:()=>bJ,noteEncode:()=>gJ,nprofileEncode:()=>yJ,npubEncode:()=>mJ,nsecEncode:()=>pJ});var dJ={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},RE=5e3,TR=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function fJ(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function hJ(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),sw(t)}catch{return{type:"invalid",data:null}}}function sw(t){let{prefix:e,words:n}=$f.decode(t,RE),r=new Uint8Array($f.fromWords(n));switch(e){case"nprofile":{let i=s1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ur(i[0][0]),relays:i[1]?i[1].map(s=>qa.decode(s)):[]}}}case"nevent":{let i=s1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ur(i[0][0]),relays:i[1]?i[1].map(s=>qa.decode(s)):[],author:i[2]?.[0]?ur(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(ur(i[3][0]),16):void 0}}}case"naddr":{let i=s1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:qa.decode(i[0][0]),pubkey:ur(i[2][0]),kind:parseInt(ur(i[3][0]),16),relays:i[1]?i[1].map(s=>qa.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:ur(r)};default:throw new Error(`unknown prefix ${e}`)}}function s1(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function pJ(t){return aw("nsec",t)}function mJ(t){return aw("npub",rd(t))}function gJ(t){return aw("note",rd(t))}function ow(t,e){let n=$f.toWords(e);return $f.encode(t,n,RE)}function aw(t,e){return ow(t,e)}function yJ(t){let e=DE({0:[rd(t.pubkey)],1:(t.relays||[]).map(n=>co.encode(n))});return ow("nprofile",e)}function bJ(t){let e;t.kind!==void 0&&(e=fJ(t.kind));let n=DE({0:[rd(t.id)],1:(t.relays||[]).map(r=>co.encode(r)),2:t.author?[rd(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return ow("nevent",n)}function wJ(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=DE({0:[co.encode(t.identifier)],1:(t.relays||[]).map(r=>co.encode(r)),2:[rd(t.pubkey)],3:[new Uint8Array(e)]});return ow("naddr",n)}function DE(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)})}),ew(...e)}var vJ={};Bn(vJ,{decrypt:()=>xJ,encrypt:()=>CR});function CR(t,e,n){const r=t instanceof Uint8Array?ur(t):t,i=ah.getSharedSecret(r,"02"+e),s=_R(i);let o=Uint8Array.from(KN(16)),a=co.encode(n),l=iR(s,o).encrypt(a),c=Jo.encode(new Uint8Array(l)),u=Jo.encode(new Uint8Array(o.buffer));return`${c}?iv=${u}`}function xJ(t,e,n){const r=t instanceof Uint8Array?ur(t):t;let[i,s]=n.split("?iv="),o=ah.getSharedSecret(r,"02"+e),a=_R(o),l=Jo.decode(s),c=Jo.decode(i),u=iR(a,l).decrypt(c);return qa.decode(u)}function _R(t){return t.slice(1,33)}var SJ={};Bn(SJ,{NIP05_REGEX:()=>LE,isNip05:()=>kJ,isValid:()=>CJ,queryProfile:()=>AR,searchDomain:()=>TJ,useFetchImplementation:()=>EJ});var LE=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,kJ=t=>LE.test(t||""),lw;try{lw=fetch}catch{}function EJ(t){lw=t}async function TJ(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await lw(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function AR(t){const e=t.match(LE);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await lw(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function CJ(t,e){const n=await AR(e);return n?n.pubkey===t:!1}var _J={};Bn(_J,{parse:()=>AJ});function AJ(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,d={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=d;continue}if(c==="reply"){e.reply=d;continue}if(c==="mention"){e.mentions.push(d);continue}n?r=d:n=d,e.mentions.push(d);continue}if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),e.mentions.forEach(i=>{if(i.author){let s=e.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),e}var PJ={};Bn(PJ,{fetchRelayInformation:()=>OJ,useFetchImplementation:()=>IJ});var PR;try{PR=fetch}catch{}function IJ(t){PR=t}async function OJ(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var MJ={};Bn(MJ,{fastEventHash:()=>OR,getPow:()=>IR,minePow:()=>NJ});function IR(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function NJ(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=OR(r),IR(r.id)>=e)break}return r}function OR(t){return ur(Zc(co.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var RJ={};Bn(RJ,{unwrapEvent:()=>qJ,unwrapManyEvents:()=>KJ,wrapEvent:()=>WR,wrapManyEvents:()=>jJ});var DJ={};Bn(DJ,{createRumor:()=>zR,createSeal:()=>UR,createWrap:()=>HR,unwrapEvent:()=>UE,unwrapManyEvents:()=>VR,wrapEvent:()=>cy,wrapManyEvents:()=>VJ});var LJ={};Bn(LJ,{decrypt:()=>zE,encrypt:()=>$E,getConversationKey:()=>BE,v2:()=>UJ});var MR=1,NR=65535;function BE(t,e){const n=ah.getSharedSecret(t,"02"+e).subarray(1,33);return bQ(Zc,n,"nip44-v2")}function RR(t,e){const n=wQ(Zc,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function FE(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function BJ(t){if(!Number.isSafeInteger(t)||t<MR||t>NR)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function FJ(t){const e=co.encode(t),n=e.length,r=BJ(n),i=new Uint8Array(FE(n)-n);return ew(r,e,i)}function $J(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<MR||e>NR||n.length!==e||t.length!==2+FE(e))throw new Error("invalid padding");return qa.decode(n)}function DR(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=ew(n,e);return nw(Zc,t,r)}function zJ(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=Jo.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function $E(t,e,n=KN(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=RR(e,n),o=FJ(t),a=lR(r,i,o),l=DR(s,a,n);return Jo.encode(ew(new Uint8Array([2]),n,a,l))}function zE(t,e){const{nonce:n,ciphertext:r,mac:i}=zJ(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=RR(e,n),l=DR(a,r,n);if(!JX(l,i))throw new Error("invalid MAC");const c=lR(s,o,r);return $J(c)}var UJ={utils:{getConversationKey:BE,calcPaddedLen:FE},encrypt:$E,decrypt:zE},HJ=2880*60,LR=()=>Math.round(Date.now()/1e3),BR=()=>Math.round(LR()-Math.random()*HJ),FR=(t,e)=>BE(t,e),$R=(t,e,n)=>$E(JSON.stringify(t),FR(e,n)),AP=(t,e)=>JSON.parse(zE(t.content,FR(e,t.pubkey)));function zR(t,e){const n={created_at:LR(),content:"",tags:[],...t,pubkey:iw(e)};return n.id=l0(n),n}function UR(t,e,n){return la({kind:pR,content:$R(t,e,n),created_at:BR(),tags:[]},e)}function HR(t,e){const n=PQ();return la({kind:xR,content:$R(t,n,e),created_at:BR(),tags:[["p",e]]},n)}function cy(t,e,n){const r=zR(t,e),i=UR(r,e,n);return HR(i,n)}function VJ(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=iw(e),i=[cy(t,e,r)];return n.forEach(s=>{i.push(cy(t,e,s))}),i}function UE(t,e){const n=AP(t,e);return AP(n,e)}function VR(t,e){let n=[];return t.forEach(r=>{n.push(UE(r,e))}),n.sort((r,i)=>r.created_at-i.created_at),n}function WJ(t,e,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:mR,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function WR(t,e,n,r,i){const s=WJ(e,n,r,i);return cy(s,t,e.publicKey)}function jJ(t,e,n,r,i){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:iw(t)},...e].map(o=>WR(t,o,n,r,i))}var qJ=UE,KJ=VR,GJ={};Bn(GJ,{finishRepostEvent:()=>ZJ,getRepostedEvent:()=>XJ,getRepostedEventPointer:()=>jR});function ZJ(t,e,n,r){let i;const s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===hR?i=PE:(i=OE,s.push(["k",String(e.kind)])),la({kind:i,tags:s,content:t.content===""||e.tags?.find(o=>o[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function jR(t){if(![PE,OE].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function XJ(t,{skipVerification:e}={}){const n=jR(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!CE(r)))return r}var QJ={};Bn(QJ,{NOSTR_URI_REGEX:()=>HE,parse:()=>JJ,test:()=>YJ});var HE=new RegExp(`nostr:(${TR.source})`);function YJ(t){return typeof t=="string"&&new RegExp(`^${HE.source}$`).test(t)}function JJ(t){const e=t.match(new RegExp(`^${HE.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:sw(e[1])}}var eee={};Bn(eee,{finishReactionEvent:()=>tee,getReactedEventPointer:()=>nee});function tee(t,e,n){const r=e.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return la({...t,kind:IE,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function nee(t){if(t.kind!==IE)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var ree={};Bn(ree,{parse:()=>see});var PP=/\W/m,IP=/[^\w\/] |[^\w\/]$|$|,| /m,iee=42;function*see(t){let e=[];if(typeof t!="string"){for(let s=0;s<t.tags.length;s++){const o=t.tags[s];o[0]==="emoji"&&o.length>=3&&e.push({type:"emoji",shortcode:o[1],url:o[2]})}t=t.content}const n=t.length;let r=0,i=0;e:for(;i<n;){const s=t.indexOf(":",i),o=t.indexOf("#",i);if(s===-1&&o===-1)break e;if(s===-1||o>=0&&o<s){if(o===0||t[o-1]===" "){const a=t.slice(o+1,o+iee).match(PP),l=a?o+1+a.index:n;yield{type:"text",text:t.slice(r,o)},yield{type:"hashtag",value:t.slice(o+1,l)},i=l,r=i;continue e}i=o+1;continue e}if(t.slice(s-5,s)==="nostr"){const a=t.slice(s+60).match(PP),l=a?s+60+a.index:n;try{let c,{data:u,type:d}=sw(t.slice(s+1,l));switch(d){case"npub":c={pubkey:u};break;case"note":c={id:u};break;case"nsec":i=l+1;continue;default:c=u}r!==s-5&&(yield{type:"text",text:t.slice(r,s-5)}),yield{type:"reference",pointer:c},i=l,r=i;continue e}catch{i=s+1;continue e}}else if(t.slice(s-5,s)==="https"||t.slice(s-4,s)==="http"){const a=t.slice(s+4).match(IP),l=a?s+4+a.index:n,c=t[s-1]==="s"?5:4;try{let u=new URL(t.slice(s-c,l));if(u.hostname.indexOf(".")===-1)throw new Error("invalid url");if(r!==s-c&&(yield{type:"text",text:t.slice(r,s-c)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(u.pathname)){yield{type:"image",url:u.toString()},i=l,r=i;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(u.pathname)){yield{type:"video",url:u.toString()},i=l,r=i;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(u.pathname)){yield{type:"audio",url:u.toString()},i=l,r=i;continue e}yield{type:"url",url:u.toString()},i=l,r=i;continue e}catch{i=l+1;continue e}}else if(t.slice(s-3,s)==="wss"||t.slice(s-2,s)==="ws"){const a=t.slice(s+4).match(IP),l=a?s+4+a.index:n,c=t[s-1]==="s"?3:2;try{let u=new URL(t.slice(s-c,l));if(u.hostname.indexOf(".")===-1)throw new Error("invalid ws url");r!==s-c&&(yield{type:"text",text:t.slice(r,s-c)}),yield{type:"relay",url:u.toString()},i=l,r=i;continue e}catch{i=l+1;continue e}}else{for(let a=0;a<e.length;a++){const l=e[a];if(t[s+l.shortcode.length+1]===":"&&t.slice(s+1,s+l.shortcode.length+1)===l.shortcode){r!==s&&(yield{type:"text",text:t.slice(r,s)}),yield l,i=s+l.shortcode.length+2,r=i;continue e}}i=s+1;continue e}}r!==n&&(yield{type:"text",text:t.slice(r)})}var oee={};Bn(oee,{channelCreateEvent:()=>aee,channelHideMessageEvent:()=>uee,channelMessageEvent:()=>cee,channelMetadataEvent:()=>lee,channelMuteUserEvent:()=>dee});var aee=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return la({kind:gR,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},lee=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return la({kind:yR,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},cee=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),la({kind:bR,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},uee=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return la({kind:wR,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},dee=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return la({kind:vR,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},fee={};Bn(fee,{EMOJI_SHORTCODE_REGEX:()=>qR,matchAll:()=>hee,regex:()=>VE,replaceAll:()=>pee});var qR=/:(\w+):/,VE=()=>new RegExp(`\\B${qR.source}\\B`,"g");function*hee(t){const e=t.matchAll(VE());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function pee(t,e){return t.replaceAll(VE(),(n,r)=>e({shortcode:n,name:r}))}var mee={};Bn(mee,{useFetchImplementation:()=>gee,validateGithub:()=>yee});var WE;try{WE=fetch}catch{}function gee(t){WE=t}async function yee(t,e,n){try{return await(await WE(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var bee={};Bn(bee,{makeNwcRequestEvent:()=>vee,parseConnectionString:()=>wee});function wee(t){const{host:e,pathname:n,searchParams:r}=new URL(t),i=n||e,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function vee(t,e,n){const i=CR(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:kR,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return la(s,e)}var xee={};Bn(xee,{normalizeIdentifier:()=>See});function See(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var kee={};Bn(kee,{getSatoshisAmountFromBolt11:()=>Pee,getZapEndpoint:()=>Tee,makeZapReceipt:()=>Aee,makeZapRequest:()=>Cee,useFetchImplementation:()=>Eee,validateZapRequest:()=>_ee});var jE;try{jE=fetch}catch{}function Eee(t){jE=t}async function Tee(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(r){let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else if(n){let{words:o}=$f.decode(n,1e3),a=$f.fromWords(o);e=qa.decode(a)}else return null;let s=await(await jE(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function Cee(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),_E(t.event.kind)){const n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(AE(t.event.kind)){let n=t.event.tags.find(([i,s])=>i==="d"&&s);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function _ee(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!EE(e))return"Zap request is not a valid Nostr event.";if(!CE(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function Aee({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}function Pee(t){if(t.length<50)return 0;t=t.substring(0,50);const e=t.lastIndexOf("1");if(e===-1)return 0;const n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const l=parseInt(r.substring(0,a));switch(i){case"m":return l*1e5;case"u":return l*100;case"n":return l/10;case"p":return l/1e4;default:return l*1e8}}var Iee={};Bn(Iee,{Negentropy:()=>GR,NegentropyStorageVector:()=>Nee,NegentropySync:()=>Ree});var o1=97,hf=32,KR=16,lu={Skip:0,Fingerprint:1,IdList:2},za=class{_raw;length;constructor(t){typeof t=="number"?(this._raw=new Uint8Array(t),this.length=0):t instanceof Uint8Array?(this._raw=new Uint8Array(t),this.length=t.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(t){if(t instanceof za&&(t=t.unwrap()),typeof t.length!="number")throw Error("bad length");const e=t.length+this.length;if(this.capacity<e){const n=this._raw,r=Math.max(this.capacity*2,e);this._raw=new Uint8Array(r),this._raw.set(n)}this._raw.set(t,this.length),this.length+=t.length}shift(){const t=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,t}shiftN(t=1){const e=this._raw.subarray(0,t);return this._raw=this._raw.subarray(t),this.length-=t,e}};function Og(t){let e=0;for(;;){if(t.length===0)throw Error("parse ends prematurely");let n=t.shift();if(e=e<<7|n&127,(n&128)===0)break}return e}function ka(t){if(t===0)return new za(new Uint8Array([0]));let e=[];for(;t!==0;)e.push(t&127),t>>>=7;e.reverse();for(let n=0;n<e.length-1;n++)e[n]|=128;return new za(new Uint8Array(e))}function Oee(t){return c0(t,1)[0]}function c0(t,e){if(t.length<e)throw Error("parse ends prematurely");return t.shiftN(e)}var Mee=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(hf)}add(t){let e=0,n=0,r=new DataView(this.buf.buffer),i=new DataView(t.buffer);for(let s=0;s<8;s++){let o=s*4,a=r.getUint32(o,!0),l=i.getUint32(o,!0),c=a;c+=e,c+=l,c>4294967295&&(n=1),r.setUint32(o,c&4294967295,!0),e=n,n=0}}negate(){let t=new DataView(this.buf.buffer);for(let n=0;n<8;n++){let r=n*4;t.setUint32(r,~t.getUint32(r,!0))}let e=new Uint8Array(hf);e[0]=1,this.add(e)}getFingerprint(t){let e=new za;return e.extend(this.buf),e.extend(ka(t)),Zc(e.unwrap()).subarray(0,KR)}},Nee=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(t,e){if(this.sealed)throw Error("already sealed");const n=JN(e);if(n.byteLength!==hf)throw Error("bad id size for added item");this.items.push({timestamp:t,id:n})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(a1);for(let t=1;t<this.items.length;t++)if(a1(this.items[t-1],this.items[t])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(t){if(this._checkSealed(),t>=this.items.length)throw Error("out of range");return this.items[t]}iterate(t,e,n){this._checkSealed(),this._checkBounds(t,e);for(let r=t;r<e&&n(this.items[r],r);++r);}findLowerBound(t,e,n){return this._checkSealed(),this._checkBounds(t,e),this._binarySearch(this.items,t,e,r=>a1(r,n)<0)}fingerprint(t,e){let n=new Mee;return n.setToZero(),this.iterate(t,e,r=>(n.add(r.id),!0)),n.getFingerprint(e-t)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(t,e){if(t>e||e>this.items.length)throw Error("bad range")}_binarySearch(t,e,n,r){let i=n-e;for(;i>0;){let s=e,o=Math.floor(i/2);s+=o,r(t[s])?(e=++s,i-=o+1):i=o}return e}},GR=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(t,e=6e4){if(e<4096)throw Error("frameSizeLimit too small");this.storage=t,this.frameSizeLimit=e,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(t,e){return{timestamp:t,id:e||new Uint8Array(0)}}initiate(){let t=new za;return t.extend(new Uint8Array([o1])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),t),Id(t.unwrap())}reconcile(t,e,n){const r=new za(JN(t));this.lastTimestampIn=this.lastTimestampOut=0;let i=new za;i.extend(new Uint8Array([o1]));let s=Oee(r);if(s<96||s>111)throw Error("invalid negentropy protocol version byte");if(s!==o1)throw Error("unsupported negentropy protocol version requested: "+(s-96));let o=this.storage.size(),a=this._bound(0),l=0,c=!1;for(;r.length!==0;){let u=new za,d=()=>{c&&(c=!1,u.extend(this.encodeBound(a)),u.extend(ka(lu.Skip)))},f=this.decodeBound(r),h=Og(r),p=l,m=this.storage.findLowerBound(l,o,f);if(h===lu.Skip)c=!0;else if(h===lu.Fingerprint){let g=c0(r,KR),y=this.storage.fingerprint(p,m);ZR(g,y)!==0?(d(),this.splitRange(p,m,f,u)):c=!0}else if(h===lu.IdList){let g=Og(r),y={};for(let b=0;b<g;b++){let x=c0(r,hf);y[Id(x)]=x}if(c=!0,this.storage.iterate(p,m,b=>{let x=b.id;const C=Id(x);return y[C]?delete y[Id(x)]:e?.(C),!0}),n)for(let b of Object.values(y))n(Id(b))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(i.length+u.length)){let g=this.storage.fingerprint(m,o);i.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),i.extend(ka(lu.Fingerprint)),i.extend(g);break}else i.extend(u);l=m,a=f}return i.length===1?null:Id(i.unwrap())}splitRange(t,e,n,r){let i=e-t,s=16;if(i<s*2)r.extend(this.encodeBound(n)),r.extend(ka(lu.IdList)),r.extend(ka(i)),this.storage.iterate(t,e,o=>(r.extend(o.id),!0));else{let o=Math.floor(i/s),a=i%s,l=t;for(let c=0;c<s;c++){let u=o+(c<a?1:0),d=this.storage.fingerprint(l,l+u);l+=u;let f;if(l===e)f=n;else{let h,p;this.storage.iterate(l-1,l+1,(m,g)=>(g===l-1?h=m:p=m,!0)),f=this.getMinimalBound(h,p)}r.extend(this.encodeBound(f)),r.extend(ka(lu.Fingerprint)),r.extend(d)}}}exceededFrameSizeLimit(t){return t>this.frameSizeLimit-200}decodeTimestampIn(t){let e=Og(t);return e=e===0?Number.MAX_VALUE:e-1,this.lastTimestampIn===Number.MAX_VALUE||e===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(e+=this.lastTimestampIn,this.lastTimestampIn=e,e)}decodeBound(t){let e=this.decodeTimestampIn(t),n=Og(t);if(n>hf)throw Error("bound key too long");let r=c0(t,n);return{timestamp:e,id:r}}encodeTimestampOut(t){if(t===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,ka(0);let e=t;return t-=this.lastTimestampOut,this.lastTimestampOut=e,ka(t+1)}encodeBound(t){let e=new za;return e.extend(this.encodeTimestampOut(t.timestamp)),e.extend(ka(t.id.length)),e.extend(t.id),e}getMinimalBound(t,e){if(e.timestamp!==t.timestamp)return this._bound(e.timestamp);{let n=0,r=e.id,i=t.id;for(let s=0;s<hf&&r[s]===i[s];s++)n++;return this._bound(e.timestamp,e.id.subarray(0,n+1))}}};function ZR(t,e){for(let n=0;n<t.byteLength;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}function a1(t,e){return t.timestamp===e.timestamp?ZR(t.id,e.id):t.timestamp-e.timestamp}var Ree=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(t,e,n,r={}){this.relay=t,this.storage=e,this.neg=new GR(e),this.onhave=r.onhave,this.onneed=r.onneed,this.filter=n,this.subscription=this.relay.prepareSubscription([{}],{label:r.label||"negentropy"}),this.subscription.oncustom=i=>{switch(i[0]){case"NEG-MSG":{i.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${i}`);try{const s=this.neg.reconcile(i[2],this.onhave,this.onneed);s?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${s}"]`):(this.close(),r.onclose?.())}catch(s){console.error("negentropy reconcile error:",s),r?.onclose?.(`reconcile error: ${s}`)}break}case"NEG-CLOSE":{const s=i[2];console.warn("negentropy error:",s),r.onclose?.(s);break}case"NEG-ERR":r.onclose?.()}}}async start(){const t=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${t}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},Dee={};Bn(Dee,{getToken:()=>Lee,hashPayload:()=>qE,unpackEventFromToken:()=>QR,validateEvent:()=>rD,validateEventKind:()=>JR,validateEventMethodTag:()=>tD,validateEventPayloadTag:()=>nD,validateEventTimestamp:()=>YR,validateEventUrlTag:()=>eD,validateToken:()=>Bee});var XR="Nostr ";async function Lee(t,e,n,r=!1,i){const s={kind:ME,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",qE(i)]);const o=await n(s);return(r?XR:"")+Jo.encode(co.encode(JSON.stringify(o)))}async function Bee(t,e,n){const r=await QR(t).catch(s=>{throw s});return await rD(r,e,n).catch(s=>{throw s})}async function QR(t){if(!t)throw new Error("Missing token");t=t.replace(XR,"");const e=qa.decode(Jo.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function YR(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function JR(t){return t.kind===ME}function eD(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function tD(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function qE(t){const e=Zc(co.encode(JSON.stringify(t)));return ur(e)}function nD(t,e){const n=t.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=qE(e);return n.length>0&&n[1]===r}async function rD(t,e,n,r){if(!CE(t))throw new Error("Invalid nostr event, signature invalid");if(!JR(t))throw new Error("Invalid nostr event, kind invalid");if(!YR(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!eD(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!tD(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!nD(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function Fee(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t;let a,l,c;const u=async(f=!0)=>{await l,c?.()};async function d(){if("serviceWorker"in navigator){if(a=await zb(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/ehagaki/sw.js",{scope:"/ehagaki/",type:"classic"})).catch(f=>{o?.(f)}),!a)return;c=()=>{a?.messageSkipWaiting()};{let f=!1;const h=()=>{f=!0,a?.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),n?.()};a.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"&&p.isExternal?h():!f&&r?.():p.isUpdate||r?.()}),a.addEventListener("waiting",h)}a.register({immediate:e}).then(f=>{s?s("/ehagaki/sw.js",f):i?.(f)}).catch(f=>{o?.(f)})}}return l=d(),u}function OP(t={}){const{immediate:e=!0,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t,a=io(!1),l=io(!1),c=Fee({immediate:e,onOfflineReady(){l.set(!0),r?.()},onNeedRefresh(){a.set(!0),n?.()},onRegistered:i,onRegisteredSW:s,onRegisterError:o});return{needRefresh:a,offlineReady:l,updateServiceWorker:c}}function W(t){if(!t)throw new Error("Assertion failed.")}const KE=t=>{const e=(t%360+360)%360;if(e===0||e===90||e===180||e===270)return e;throw new Error(`Invalid rotation ${t}.`)},Wn=t=>t&&t[t.length-1],zf=t=>t>=0&&t<2**32;class Ln{constructor(e){this.bytes=e,this.pos=0}seekToByte(e){this.pos=8*e}readBit(){const e=Math.floor(this.pos/8),n=this.bytes[e]??0,r=7-(this.pos&7),i=(n&1<<r)>>r;return this.pos++,i}readBits(e){if(e===1)return this.readBit();let n=0;for(let r=0;r<e;r++)n<<=1,n|=this.readBit();return n}writeBits(e,n){const r=this.pos+e;for(let i=this.pos;i<r;i++){const s=Math.floor(i/8);let o=this.bytes[s];const a=7-(i&7);o&=~(1<<a),o|=(n&1<<r-i-1)>>r-i-1<<a,this.bytes[s]=o}this.pos=r}readAlignedByte(){if(this.pos%8!==0)throw new Error("Bitstream is not byte-aligned.");const e=this.pos/8,n=this.bytes[e]??0;return this.pos+=8,n}skipBits(e){this.pos+=e}getBitsLeft(){return this.bytes.length*8-this.pos}clone(){const e=new Ln(this.bytes);return e.pos=this.pos,e}}const Qe=t=>{let e=0;for(;t.readBits(1)===0&&e<32;)e++;if(e>=32)throw new Error("Invalid exponential-Golomb code.");return(1<<e)-1+t.readBits(e)},Ka=t=>{const e=Qe(t);return(e&1)===0?-(e>>1):e+1>>1},fs=t=>t.constructor===Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t),jn=t=>t.constructor===DataView?t:ArrayBuffer.isView(t)?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(t),Fs=new TextDecoder,Ho=new TextEncoder,GE=t=>Object.fromEntries(Object.entries(t).map(([e,n])=>[n,e])),jm={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},uy=GE(jm),qm={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pq:16,hlg:18},dy=GE(qm),Km={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},fy=GE(Km),$ee=t=>!!t&&!!t.primaries&&!!t.transfer&&!!t.matrix&&t.fullRange!==void 0,cw=t=>t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer||ArrayBuffer.isView(t);class yd{constructor(){this.currentPromise=Promise.resolve(),this.pending=0}async acquire(){let e;const n=new Promise(i=>{let s=!1;e=()=>{s||(i(),this.pending--,s=!0)}}),r=this.currentPromise;return this.currentPromise=n,this.pending++,await r,e}}const MP=t=>[...t].map(e=>e.toString(16).padStart(2,"0")).join(""),NP=t=>(t=t>>1&1431655765|(t&1431655765)<<1,t=t>>2&858993459|(t&858993459)<<2,t=t>>4&252645135|(t&252645135)<<4,t=t>>8&16711935|(t&16711935)<<8,t=t>>16&65535|(t&65535)<<16,t>>>0),Gm=(t,e,n)=>{let r=0,i=t.length-1,s=-1;for(;r<=i;){const o=r+i>>1,a=n(t[o]);a===e?(s=o,i=o-1):a<e?r=o+1:i=o-1}return s},un=(t,e,n)=>{let r=0,i=t.length-1,s=-1;for(;r<=i;){const o=r+(i-r+1)/2|0;n(t[o])<=e?(s=o,r=o+1):i=o-1}return s},RP=(t,e,n)=>{const r=un(t,n(e),n);t.splice(r+1,0,e)},ci=()=>{let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}},iD=(t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n]))return t[n]},ZE=(t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n]))return n;return-1},zee=async function*(t){Symbol.iterator in t?yield*t[Symbol.iterator]():yield*t[Symbol.asyncIterator]()},Uee=t=>{if(!(Symbol.iterator in t)&&!(Symbol.asyncIterator in t))throw new TypeError("Argument must be an iterable or async iterable.")},zc=t=>{throw new Error(`Unexpected value: ${t}`)},uw=(t,e,n)=>{const r=t.getUint8(e),i=t.getUint8(e+1),s=t.getUint8(e+2);return n?r|i<<8|s<<16:r<<16|i<<8|s},Hee=(t,e,n)=>uw(t,e,n)<<8>>8,XE=(t,e,n,r)=>{n=n>>>0,n=n&16777215,r?(t.setUint8(e,n&255),t.setUint8(e+1,n>>>8&255),t.setUint8(e+2,n>>>16&255)):(t.setUint8(e,n>>>16&255),t.setUint8(e+1,n>>>8&255),t.setUint8(e+2,n&255))},Vee=(t,e,n,r)=>{n=zr(n,-8388608,8388607),n<0&&(n=n+16777216&16777215),XE(t,e,n,r)},DP=(t,e)=>({async next(){const n=await t.next();return n.done?{value:void 0,done:!0}:{value:e(n.value),done:!1}},return(){return t.return()},throw(n){return t.throw(n)},[Symbol.asyncIterator](){return this}}),zr=(t,e,n)=>Math.max(e,Math.min(n,t)),cs="und",tm=t=>{const e=Math.round(t);return Math.abs(t/e-1)<10*Number.EPSILON?e:t},sD=(t,e)=>Math.round(t/e)*e,Wee=t=>{let e=0;for(;t;)e++,t>>=1;return e},jee=/^[a-z]{3}$/,nm=t=>jee.test(t),dc=1e6*(1+Number.EPSILON),qee=(t,e)=>{const n=t<0?-1:1;t=Math.abs(t);let r=0,i=1,s=1,o=0,a=t;for(;;){const l=Math.floor(a),c=l*s+r,u=l*o+i;if(u>e)return{numerator:n*s,denominator:o};if(r=s,i=o,s=c,o=u,a=1/(a-l),!isFinite(a))break}return{numerator:n*s,denominator:o}};class dw{constructor(){this.currentPromise=Promise.resolve()}call(e){return this.currentPromise=this.currentPromise.then(e)}}let l1=null;const xp=()=>l1!==null?l1:l1=!!(typeof navigator<"u"&&(navigator.vendor?.match(/apple/i)||/AppleWebKit/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)||/\b(iPad|iPhone|iPod)\b/.test(navigator.userAgent)));let c1=null;const Uf=()=>c1!==null?c1:c1=typeof navigator<"u"&&navigator.userAgent?.includes("Firefox");let u1=null;const Fx=()=>u1!==null?u1:u1=!!(typeof navigator<"u"&&(navigator.vendor?.includes("Google Inc")||/Chrome/.test(navigator.userAgent)));let d1=null;const Kee=()=>{if(d1!==null)return d1;if(typeof navigator>"u")return null;const t=/\bChrome\/(\d+)/.exec(navigator.userAgent);return t?d1=Number(t[1]):null},zd=(t,e)=>t!==-1?t:e,LP=(t,e,n,r)=>t<=r&&n<=e,oD=function*(t){for(const e in t){const n=t[e];n!==void 0&&(yield{key:e,value:n})}},Gee=t=>{const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},aD=()=>{Symbol.dispose??=Symbol("Symbol.dispose")},lD=t=>typeof t=="number"&&!Number.isNaN(t);class pf{constructor(e,n){if(this.data=e,this.mimeType=n,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(typeof n!="string")throw new TypeError("mimeType must be a string.")}}class cD{constructor(e,n,r,i){if(this.data=e,this.mimeType=n,this.name=r,this.description=i,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(n!==void 0&&typeof n!="string")throw new TypeError("mimeType, when provided, must be a string.");if(r!==void 0&&typeof r!="string")throw new TypeError("name, when provided, must be a string.");if(i!==void 0&&typeof i!="string")throw new TypeError("description, when provided, must be a string.")}}const $x=t=>{if(!t||typeof t!="object")throw new TypeError("tags must be an object.");if(t.title!==void 0&&typeof t.title!="string")throw new TypeError("tags.title, when provided, must be a string.");if(t.description!==void 0&&typeof t.description!="string")throw new TypeError("tags.description, when provided, must be a string.");if(t.artist!==void 0&&typeof t.artist!="string")throw new TypeError("tags.artist, when provided, must be a string.");if(t.album!==void 0&&typeof t.album!="string")throw new TypeError("tags.album, when provided, must be a string.");if(t.albumArtist!==void 0&&typeof t.albumArtist!="string")throw new TypeError("tags.albumArtist, when provided, must be a string.");if(t.trackNumber!==void 0&&(!Number.isInteger(t.trackNumber)||t.trackNumber<=0))throw new TypeError("tags.trackNumber, when provided, must be a positive integer.");if(t.tracksTotal!==void 0&&(!Number.isInteger(t.tracksTotal)||t.tracksTotal<=0))throw new TypeError("tags.tracksTotal, when provided, must be a positive integer.");if(t.discNumber!==void 0&&(!Number.isInteger(t.discNumber)||t.discNumber<=0))throw new TypeError("tags.discNumber, when provided, must be a positive integer.");if(t.discsTotal!==void 0&&(!Number.isInteger(t.discsTotal)||t.discsTotal<=0))throw new TypeError("tags.discsTotal, when provided, must be a positive integer.");if(t.genre!==void 0&&typeof t.genre!="string")throw new TypeError("tags.genre, when provided, must be a string.");if(t.date!==void 0&&(!(t.date instanceof Date)||Number.isNaN(t.date.getTime())))throw new TypeError("tags.date, when provided, must be a valid Date.");if(t.lyrics!==void 0&&typeof t.lyrics!="string")throw new TypeError("tags.lyrics, when provided, must be a string.");if(t.images!==void 0){if(!Array.isArray(t.images))throw new TypeError("tags.images, when provided, must be an array.");for(const e of t.images){if(!e||typeof e!="object")throw new TypeError("Each image in tags.images must be an object.");if(!(e.data instanceof Uint8Array))throw new TypeError("Each image.data must be a Uint8Array.");if(typeof e.mimeType!="string")throw new TypeError("Each image.mimeType must be a string.");if(!["coverFront","coverBack","unknown"].includes(e.kind))throw new TypeError("Each image.kind must be 'coverFront', 'coverBack', or 'unknown'.")}}if(t.comment!==void 0&&typeof t.comment!="string")throw new TypeError("tags.comment, when provided, must be a string.");if(t.raw!==void 0){if(!t.raw||typeof t.raw!="object")throw new TypeError("tags.raw, when provided, must be an object.");for(const e of Object.values(t.raw))if(e!==null&&typeof e!="string"&&!(e instanceof Uint8Array)&&!(e instanceof pf)&&!(e instanceof cD))throw new TypeError("Each value in tags.raw must be a string, Uint8Array, RichImageData, AttachedFile, or null.")}},Qc={default:!0,forced:!1,original:!1,commentary:!1,hearingImpaired:!1,visuallyImpaired:!1},Zee=t=>{if(!t||typeof t!="object")throw new TypeError("disposition must be an object.");if(t.default!==void 0&&typeof t.default!="boolean")throw new TypeError("disposition.default must be a boolean.");if(t.forced!==void 0&&typeof t.forced!="boolean")throw new TypeError("disposition.forced must be a boolean.");if(t.original!==void 0&&typeof t.original!="boolean")throw new TypeError("disposition.original must be a boolean.");if(t.commentary!==void 0&&typeof t.commentary!="boolean")throw new TypeError("disposition.commentary must be a boolean.");if(t.hearingImpaired!==void 0&&typeof t.hearingImpaired!="boolean")throw new TypeError("disposition.hearingImpaired must be a boolean.");if(t.visuallyImpaired!==void 0&&typeof t.visuallyImpaired!="boolean")throw new TypeError("disposition.visuallyImpaired must be a boolean.")};const ea=["avc","hevc","vp9","av1","vp8"],Pi=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],Sp=["aac","opus","mp3","vorbis","flac"],ta=[...Sp,...Pi],hy=["webvtt"],py=[{maxMacroblocks:99,maxBitrate:64e3,maxDpbMbs:396,level:10},{maxMacroblocks:396,maxBitrate:192e3,maxDpbMbs:900,level:11},{maxMacroblocks:396,maxBitrate:384e3,maxDpbMbs:2376,level:12},{maxMacroblocks:396,maxBitrate:768e3,maxDpbMbs:2376,level:13},{maxMacroblocks:396,maxBitrate:2e6,maxDpbMbs:2376,level:20},{maxMacroblocks:792,maxBitrate:4e6,maxDpbMbs:4752,level:21},{maxMacroblocks:1620,maxBitrate:4e6,maxDpbMbs:8100,level:22},{maxMacroblocks:1620,maxBitrate:1e7,maxDpbMbs:8100,level:30},{maxMacroblocks:3600,maxBitrate:14e6,maxDpbMbs:18e3,level:31},{maxMacroblocks:5120,maxBitrate:2e7,maxDpbMbs:20480,level:32},{maxMacroblocks:8192,maxBitrate:2e7,maxDpbMbs:32768,level:40},{maxMacroblocks:8192,maxBitrate:5e7,maxDpbMbs:32768,level:41},{maxMacroblocks:8704,maxBitrate:5e7,maxDpbMbs:34816,level:42},{maxMacroblocks:22080,maxBitrate:135e6,maxDpbMbs:110400,level:50},{maxMacroblocks:36864,maxBitrate:24e7,maxDpbMbs:184320,level:51},{maxMacroblocks:36864,maxBitrate:24e7,maxDpbMbs:184320,level:52},{maxMacroblocks:139264,maxBitrate:24e7,maxDpbMbs:696320,level:60},{maxMacroblocks:139264,maxBitrate:48e7,maxDpbMbs:696320,level:61},{maxMacroblocks:139264,maxBitrate:8e8,maxDpbMbs:696320,level:62}],BP=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:35651584,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:35651584,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:35651584,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:186}],fc=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:35651584,maxBitrate:18e7,level:60},{maxPictureSize:35651584,maxBitrate:24e7,level:61},{maxPictureSize:35651584,maxBitrate:48e7,level:62}],FP=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:35651584,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:19}],$P=".01.01.01.01.00",zP=".0.110.01.01.01.0",Xee=(t,e,n,r)=>{if(t==="avc"){const s=Math.ceil(e/16)*Math.ceil(n/16),o=py.find(d=>s<=d.maxMacroblocks&&r<=d.maxBitrate)??Wn(py),a=o?o.level:0,l="64".padStart(2,"0"),c="00",u=a.toString(16).padStart(2,"0");return`avc1.${l}${c}${u}`}else if(t==="hevc"){const a=e*n,l=BP.find(u=>a<=u.maxPictureSize&&r<=u.maxBitrate)??Wn(BP);return`hev1.1.6.${l.tier}${l.level}.B0`}else{if(t==="vp8")return"vp8";if(t==="vp9"){const s=e*n;return`vp09.00.${(fc.find(l=>s<=l.maxPictureSize&&r<=l.maxBitrate)??Wn(fc)).level.toString().padStart(2,"0")}.08`}else if(t==="av1"){const s=e*n,o=FP.find(c=>s<=c.maxPictureSize&&r<=c.maxBitrate)??Wn(FP);return`av01.0.${o.level.toString().padStart(2,"0")}${o.tier}.08`}}throw new TypeError(`Unhandled codec '${t}'.`)},Qee=t=>{const e=t.split("."),i=(1<<7)+1,s=Number(e[1]),o=e[2],a=Number(o.slice(0,-1)),l=(s<<5)+a,c=o.slice(-1)==="H"?1:0,d=Number(e[3])===8?0:1,f=0,h=e[4]?Number(e[4]):0,p=e[5]?Number(e[5][0]):1,m=e[5]?Number(e[5][1]):1,g=e[5]?Number(e[5][2]):0,y=(c<<7)+(d<<6)+(f<<5)+(h<<4)+(p<<3)+(m<<2)+g;return[i,l,y,0]},QE=t=>{const{codec:e,codecDescription:n,colorSpace:r,avcCodecInfo:i,hevcCodecInfo:s,vp9CodecInfo:o,av1CodecInfo:a}=t;if(e==="avc"){if(W(t.avcType!==null),i){const l=new Uint8Array([i.avcProfileIndication,i.profileCompatibility,i.avcLevelIndication]);return`avc${t.avcType}.${MP(l)}`}if(!n||n.byteLength<4)throw new TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return`avc${t.avcType}.${MP(n.subarray(1,4))}`}else if(e==="hevc"){let l,c,u,d,f,h;if(s)l=s.generalProfileSpace,c=s.generalProfileIdc,u=NP(s.generalProfileCompatibilityFlags),d=s.generalTierFlag,f=s.generalLevelIdc,h=[...s.generalConstraintIndicatorFlags];else{if(!n||n.byteLength<23)throw new TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");const m=jn(n),g=m.getUint8(1);l=g>>6&3,c=g&31,u=NP(m.getUint32(2)),d=g>>5&1,f=m.getUint8(12),h=[];for(let y=0;y<6;y++)h.push(m.getUint8(6+y))}let p="hev1.";for(p+=["","A","B","C"][l]+c,p+=".",p+=u.toString(16).toUpperCase(),p+=".",p+=d===0?"L":"H",p+=f;h.length>0&&h[h.length-1]===0;)h.pop();return h.length>0&&(p+=".",p+=h.map(m=>m.toString(16).toUpperCase()).join(".")),p}else{if(e==="vp8")return"vp8";if(e==="vp9"){if(!o){const y=t.width*t.height;let b=Wn(fc).level;for(const x of fc)if(y<=x.maxPictureSize){b=x.level;break}return`vp09.00.${b.toString().padStart(2,"0")}.08`}const l=o.profile.toString().padStart(2,"0"),c=o.level.toString().padStart(2,"0"),u=o.bitDepth.toString().padStart(2,"0"),d=o.chromaSubsampling.toString().padStart(2,"0"),f=o.colourPrimaries.toString().padStart(2,"0"),h=o.transferCharacteristics.toString().padStart(2,"0"),p=o.matrixCoefficients.toString().padStart(2,"0"),m=o.videoFullRangeFlag.toString().padStart(2,"0");let g=`vp09.${l}.${c}.${u}.${d}`;return g+=`.${f}.${h}.${p}.${m}`,g.endsWith($P)&&(g=g.slice(0,-$P.length)),g}else if(e==="av1"){if(!a){const x=t.width*t.height;let C=Wn(fc).level;for(const P of fc)if(x<=P.maxPictureSize){C=P.level;break}return`av01.0.${C.toString().padStart(2,"0")}M.08`}const l=a.profile,c=a.level.toString().padStart(2,"0"),u=a.tier?"H":"M",d=a.bitDepth.toString().padStart(2,"0"),f=a.monochrome?"1":"0",h=100*a.chromaSubsamplingX+10*a.chromaSubsamplingY+1*(a.chromaSubsamplingX&&a.chromaSubsamplingY?a.chromaSamplePosition:0),p=r?.primaries?jm[r.primaries]:1,m=r?.transfer?qm[r.transfer]:1,g=r?.matrix?Km[r.matrix]:1,y=r?.fullRange?1:0;let b=`av01.${l}.${c}${u}.${d}`;return b+=`.${f}.${h.toString().padStart(3,"0")}`,b+=`.${p.toString().padStart(2,"0")}`,b+=`.${m.toString().padStart(2,"0")}`,b+=`.${g.toString().padStart(2,"0")}`,b+=`.${y}`,b.endsWith(zP)&&(b=b.slice(0,-zP.length)),b}}throw new TypeError(`Unhandled codec '${e}'.`)},Yee=(t,e,n)=>{if(t==="aac")return e>=2&&n<=24e3?"mp4a.40.29":n<=24e3?"mp4a.40.5":"mp4a.40.2";if(t==="mp3")return"mp3";if(t==="opus")return"opus";if(t==="vorbis")return"vorbis";if(t==="flac")return"flac";if(Pi.includes(t))return t;throw new TypeError(`Unhandled codec '${t}'.`)},YE=t=>{const{codec:e,codecDescription:n,aacCodecInfo:r}=t;if(e==="aac"){if(!r)throw new TypeError("AAC codec info must be provided.");if(r.isMpeg2)return"mp4a.67";{let i;return r.objectType!==null?i=r.objectType:i=JE(n).objectType,`mp4a.40.${i}`}}else{if(e==="mp3")return"mp3";if(e==="opus")return"opus";if(e==="vorbis")return"vorbis";if(e==="flac")return"flac";if(e&&Pi.includes(e))return e}throw new TypeError(`Unhandled codec '${e}'.`)},id=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Zm=[-1,1,2,3,4,5,6,8],JE=t=>{if(!t||t.byteLength<2)throw new TypeError("AAC description must be at least 2 bytes long.");const e=new Ln(t);let n=e.readBits(5);n===31&&(n=32+e.readBits(6));const r=e.readBits(4);let i=null;r===15?i=e.readBits(24):r<id.length&&(i=id[r]);const s=e.readBits(4);let o=null;return s>=1&&s<=7&&(o=Zm[s]),{objectType:n,frequencyIndex:r,sampleRate:i,channelConfiguration:s,numberOfChannels:o}},uD=t=>{let e=id.indexOf(t.sampleRate),n=null;e===-1&&(e=15,n=t.sampleRate);const r=Zm.indexOf(t.numberOfChannels);if(r===-1)throw new TypeError(`Unsupported number of channels: ${t.numberOfChannels}`);let i=13;t.objectType>=32&&(i+=6),e===15&&(i+=24);const s=Math.ceil(i/8),o=new Uint8Array(s),a=new Ln(o);return t.objectType<32?a.writeBits(5,t.objectType):(a.writeBits(5,31),a.writeBits(6,t.objectType-32)),a.writeBits(4,e),e===15&&a.writeBits(24,n),a.writeBits(4,r),o},fw=48e3,dD=/^pcm-([usf])(\d+)+(be)?$/,Yc=t=>{if(W(Pi.includes(t)),t==="ulaw")return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if(t==="alaw")return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};const e=dD.exec(t);W(e);let n;e[1]==="u"?n="unsigned":e[1]==="s"?n="signed":n="float";const r=Number(e[2])/8,i=e[3]!=="be",s=t==="pcm-u8"?2**7:0;return{dataType:n,sampleSize:r,littleEndian:i,silentValue:s}},fD=t=>t.startsWith("avc1")||t.startsWith("avc3")?"avc":t.startsWith("hev1")||t.startsWith("hvc1")?"hevc":t==="vp8"?"vp8":t.startsWith("vp09")?"vp9":t.startsWith("av01")?"av1":t.startsWith("mp4a.40")||t==="mp4a.67"?"aac":t==="mp3"||t==="mp4a.69"||t==="mp4a.6B"||t==="mp4a.6b"?"mp3":t==="opus"?"opus":t==="vorbis"?"vorbis":t==="flac"?"flac":t==="ulaw"?"ulaw":t==="alaw"?"alaw":dD.test(t)?t:t==="webvtt"?"webvtt":null,Jee=t=>t==="avc"?{avc:{format:"avc"}}:t==="hevc"?{hevc:{format:"hevc"}}:{},ete=t=>t==="aac"?{aac:{format:"aac"}}:t==="opus"?{opus:{format:"opus"}}:{},tte=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],nte=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,rte=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,ite=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,ste=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,ote=t=>{if(!t)throw new TypeError("Video chunk metadata must be provided.");if(typeof t!="object")throw new TypeError("Video chunk metadata must be an object.");if(!t.decoderConfig)throw new TypeError("Video chunk metadata must include a decoder configuration.");if(typeof t.decoderConfig!="object")throw new TypeError("Video chunk metadata decoder configuration must be an object.");if(typeof t.decoderConfig.codec!="string")throw new TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!tte.some(e=>t.decoderConfig.codec.startsWith(e)))throw new TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(t.decoderConfig.codedWidth)||t.decoderConfig.codedWidth<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(t.decoderConfig.codedHeight)||t.decoderConfig.codedHeight<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(t.decoderConfig.description!==void 0&&!cw(t.decoderConfig.description))throw new TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(t.decoderConfig.colorSpace!==void 0){const{colorSpace:e}=t.decoderConfig;if(typeof e!="object")throw new TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");const n=Object.keys(jm);if(e.primaries!=null&&!n.includes(e.primaries))throw new TypeError(`Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of ${n.join(", ")}.`);const r=Object.keys(qm);if(e.transfer!=null&&!r.includes(e.transfer))throw new TypeError(`Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of ${r.join(", ")}.`);const i=Object.keys(Km);if(e.matrix!=null&&!i.includes(e.matrix))throw new TypeError(`Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of ${i.join(", ")}.`);if(e.fullRange!=null&&typeof e.fullRange!="boolean")throw new TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(t.decoderConfig.codec.startsWith("avc1")||t.decoderConfig.codec.startsWith("avc3")){if(!nte.test(t.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(t.decoderConfig.codec.startsWith("hev1")||t.decoderConfig.codec.startsWith("hvc1")){if(!rte.test(t.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(t.decoderConfig.codec.startsWith("vp8")){if(t.decoderConfig.codec!=="vp8")throw new TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(t.decoderConfig.codec.startsWith("vp09")){if(!ite.test(t.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(t.decoderConfig.codec.startsWith("av01")&&!ste.test(t.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},ate=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],lte=t=>{if(!t)throw new TypeError("Audio chunk metadata must be provided.");if(typeof t!="object")throw new TypeError("Audio chunk metadata must be an object.");if(!t.decoderConfig)throw new TypeError("Audio chunk metadata must include a decoder configuration.");if(typeof t.decoderConfig!="object")throw new TypeError("Audio chunk metadata decoder configuration must be an object.");if(typeof t.decoderConfig.codec!="string")throw new TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!ate.some(e=>t.decoderConfig.codec.startsWith(e)))throw new TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(t.decoderConfig.sampleRate)||t.decoderConfig.sampleRate<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(t.decoderConfig.numberOfChannels)||t.decoderConfig.numberOfChannels<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(t.decoderConfig.description!==void 0&&!cw(t.decoderConfig.description))throw new TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(t.decoderConfig.codec.startsWith("mp4a")&&t.decoderConfig.codec!=="mp4a.69"&&t.decoderConfig.codec!=="mp4a.6B"&&t.decoderConfig.codec!=="mp4a.6b"){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(t.decoderConfig.codec))throw new TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.")}else if(t.decoderConfig.codec.startsWith("mp3")||t.decoderConfig.codec.startsWith("mp4a")){if(t.decoderConfig.codec!=="mp3"&&t.decoderConfig.codec!=="mp4a.69"&&t.decoderConfig.codec!=="mp4a.6B"&&t.decoderConfig.codec!=="mp4a.6b")throw new TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(t.decoderConfig.codec.startsWith("opus")){if(t.decoderConfig.codec!=="opus")throw new TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(t.decoderConfig.description&&t.decoderConfig.description.byteLength<18)throw new TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(t.decoderConfig.codec.startsWith("vorbis")){if(t.decoderConfig.codec!=="vorbis")throw new TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!t.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(t.decoderConfig.codec.startsWith("flac")){if(t.decoderConfig.codec!=="flac")throw new TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');if(!t.decoderConfig.description||t.decoderConfig.description.byteLength<42)throw new TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((t.decoderConfig.codec.startsWith("pcm")||t.decoderConfig.codec.startsWith("ulaw")||t.decoderConfig.codec.startsWith("alaw"))&&!Pi.includes(t.decoderConfig.codec))throw new TypeError(`Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM codecs (${Pi.join(", ")}).`)},cte=t=>{if(!t)throw new TypeError("Subtitle metadata must be provided.");if(typeof t!="object")throw new TypeError("Subtitle metadata must be an object.");if(!t.config)throw new TypeError("Subtitle metadata must include a config object.");if(typeof t.config!="object")throw new TypeError("Subtitle metadata config must be an object.");if(typeof t.config.description!="string")throw new TypeError("Subtitle metadata config description must be a string.")};class ute{constructor(e){this.mutex=new yd,this.firstMediaStreamTimestamp=null,this.trackTimestampInfo=new WeakMap,this.output=e}onTrackClose(e){}validateAndNormalizeTimestamp(e,n,r){n+=e.source._timestampOffset;let i=this.trackTimestampInfo.get(e);if(!i){if(!r)throw new Error("First packet must be a key packet.");i={maxTimestamp:n,maxTimestampBeforeLastKeyPacket:n},this.trackTimestampInfo.set(e,i)}if(n<0)throw new Error(`Timestamps must be non-negative (got ${n}s).`);if(r&&(i.maxTimestampBeforeLastKeyPacket=i.maxTimestamp),n<i.maxTimestampBeforeLastKeyPacket)throw new Error(`Timestamps cannot be smaller than the largest timestamp of the previous GOP (a GOP begins with a key packet and ends right before the next key packet). Got ${n}s, but largest timestamp is ${i.maxTimestampBeforeLastKeyPacket}s.`);return i.maxTimestamp=Math.max(i.maxTimestamp,n),n}}var Vo;(function(t){t[t.NON_IDR_SLICE=1]="NON_IDR_SLICE",t[t.SLICE_DPA=2]="SLICE_DPA",t[t.SLICE_DPB=3]="SLICE_DPB",t[t.SLICE_DPC=4]="SLICE_DPC",t[t.IDR=5]="IDR",t[t.SEI=6]="SEI",t[t.SPS=7]="SPS",t[t.PPS=8]="PPS",t[t.AUD=9]="AUD",t[t.SPS_EXT=13]="SPS_EXT"})(Vo||(Vo={}));var ui;(function(t){t[t.RASL_N=8]="RASL_N",t[t.RASL_R=9]="RASL_R",t[t.BLA_W_LP=16]="BLA_W_LP",t[t.RSV_IRAP_VCL23=23]="RSV_IRAP_VCL23",t[t.VPS_NUT=32]="VPS_NUT",t[t.SPS_NUT=33]="SPS_NUT",t[t.PPS_NUT=34]="PPS_NUT",t[t.AUD_NUT=35]="AUD_NUT",t[t.PREFIX_SEI_NUT=39]="PREFIX_SEI_NUT",t[t.SUFFIX_SEI_NUT=40]="SUFFIX_SEI_NUT"})(ui||(ui={}));const Xm=function*(t){let e=0,n=-1;for(;e<t.length-2;){const r=t.indexOf(0,e);if(r===-1||r>=t.length-2)break;e=r;let i=0;if(e+3<t.length&&t[e+1]===0&&t[e+2]===0&&t[e+3]===1?i=4:t[e+1]===0&&t[e+2]===1&&(i=3),i===0){e++;continue}n!==-1&&e>n&&(yield{offset:n,length:e-n}),n=e+i,e=n}n!==-1&&n<t.length&&(yield{offset:n,length:t.length-n})},hD=function*(t,e){let n=0;const r=new DataView(t.buffer,t.byteOffset,t.byteLength);for(;n+e<=t.length;){let i;e===1?i=r.getUint8(n):e===2?i=r.getUint16(n,!1):e===3?i=uw(r,n,!1):(W(e===4),i=r.getUint32(n,!1)),n+=e,yield{offset:n,length:i},n+=i}},pD=(t,e)=>{if(e.description){const i=(fs(e.description)[4]&3)+1;return hD(t,i)}else return Xm(t)},dte=function*(t){yield*Xm(t)},hw=t=>t&31,pw=t=>{const e=[],n=t.length;for(let r=0;r<n;r++)r+2<n&&t[r]===0&&t[r+1]===0&&t[r+2]===3?(e.push(0,0),r+=2):e.push(t[r]);return new Uint8Array(e)},f1=new Uint8Array([0,0,0,1]),fte=t=>{const e=t.reduce((i,s)=>i+f1.byteLength+s.byteLength,0),n=new Uint8Array(e);let r=0;for(const i of t)n.set(f1,r),r+=f1.byteLength,n.set(i,r),r+=i.byteLength;return n},mD=(t,e)=>{const n=t.reduce((s,o)=>s+e+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of t){const o=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(e){case 1:o.setUint8(i,s.byteLength);break;case 2:o.setUint16(i,s.byteLength,!1);break;case 3:XE(o,i,s.byteLength,!1);break;case 4:o.setUint32(i,s.byteLength,!1);break}i+=e,r.set(s,i),i+=s.byteLength}return r},hte=(t,e)=>{if(e.description){const i=(fs(e.description)[4]&3)+1;return mD(t,i)}else return fte(t)},eT=t=>{try{const e=[],n=[],r=[];for(const a of dte(t)){const l=t.subarray(a.offset,a.offset+a.length),c=hw(l[0]);c===Vo.SPS?e.push(l):c===Vo.PPS?n.push(l):c===Vo.SPS_EXT&&r.push(l)}if(e.length===0||n.length===0)return null;const i=e[0],s=tT(i);W(s!==null);const o=s.profileIdc===100||s.profileIdc===110||s.profileIdc===122||s.profileIdc===144;return{configurationVersion:1,avcProfileIndication:s.profileIdc,profileCompatibility:s.constraintFlags,avcLevelIndication:s.levelIdc,lengthSizeMinusOne:3,sequenceParameterSets:e,pictureParameterSets:n,chromaFormat:o?s.chromaFormatIdc:null,bitDepthLumaMinus8:o?s.bitDepthLumaMinus8:null,bitDepthChromaMinus8:o?s.bitDepthChromaMinus8:null,sequenceParameterSetExt:o?r:null}}catch(e){return console.error("Error building AVC Decoder Configuration Record:",e),null}},pte=t=>{const e=[];e.push(t.configurationVersion),e.push(t.avcProfileIndication),e.push(t.profileCompatibility),e.push(t.avcLevelIndication),e.push(252|t.lengthSizeMinusOne&3),e.push(224|t.sequenceParameterSets.length&31);for(const n of t.sequenceParameterSets){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}e.push(t.pictureParameterSets.length);for(const n of t.pictureParameterSets){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}if(t.avcProfileIndication===100||t.avcProfileIndication===110||t.avcProfileIndication===122||t.avcProfileIndication===144){W(t.chromaFormat!==null),W(t.bitDepthLumaMinus8!==null),W(t.bitDepthChromaMinus8!==null),W(t.sequenceParameterSetExt!==null),e.push(252|t.chromaFormat&3),e.push(248|t.bitDepthLumaMinus8&7),e.push(248|t.bitDepthChromaMinus8&7),e.push(t.sequenceParameterSetExt.length);for(const n of t.sequenceParameterSetExt){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}}return new Uint8Array(e)},mte=t=>{try{const e=jn(t);let n=0;const r=e.getUint8(n++),i=e.getUint8(n++),s=e.getUint8(n++),o=e.getUint8(n++),a=e.getUint8(n++)&3,l=e.getUint8(n++)&31,c=[];for(let h=0;h<l;h++){const p=e.getUint16(n,!1);n+=2,c.push(t.subarray(n,n+p)),n+=p}const u=e.getUint8(n++),d=[];for(let h=0;h<u;h++){const p=e.getUint16(n,!1);n+=2,d.push(t.subarray(n,n+p)),n+=p}const f={configurationVersion:r,avcProfileIndication:i,profileCompatibility:s,avcLevelIndication:o,lengthSizeMinusOne:a,sequenceParameterSets:c,pictureParameterSets:d,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if((i===100||i===110||i===122||i===144)&&n+4<=t.length){const h=e.getUint8(n++)&3,p=e.getUint8(n++)&7,m=e.getUint8(n++)&7,g=e.getUint8(n++);f.chromaFormat=h,f.bitDepthLumaMinus8=p,f.bitDepthChromaMinus8=m;const y=[];for(let b=0;b<g;b++){const x=e.getUint16(n,!1);n+=2,y.push(t.subarray(n,n+x)),n+=x}f.sequenceParameterSetExt=y}return f}catch(e){return console.error("Error deserializing AVC Decoder Configuration Record:",e),null}},tT=t=>{try{const e=new Ln(pw(t));if(e.skipBits(1),e.skipBits(2),e.readBits(5)!==7)return null;const r=e.readAlignedByte(),i=e.readAlignedByte(),s=e.readAlignedByte();Qe(e);let o=1,a=0,l=0,c=0;if((r===100||r===110||r===122||r===244||r===44||r===83||r===86||r===118||r===128)&&(o=Qe(e),o===3&&(c=e.readBits(1)),a=Qe(e),l=Qe(e),e.skipBits(1),e.readBits(1))){for(let M=0;M<(o!==3?8:12);M++)if(e.readBits(1)){const F=M<6?16:64;let B=8,R=8;for(let A=0;A<F;A++){if(R!==0){const N=Ka(e);R=(B+N+256)%256}B=R===0?B:R}}}Qe(e);const u=Qe(e);if(u===0)Qe(e);else if(u===1){e.skipBits(1),Ka(e),Ka(e);const O=Qe(e);for(let M=0;M<O;M++)Ka(e)}Qe(e),e.skipBits(1);const d=Qe(e),f=Qe(e),h=16*(d+1),p=16*(f+1);let m=h,g=p;const y=e.readBits(1);if(y||e.skipBits(1),e.skipBits(1),e.readBits(1)){const O=Qe(e),M=Qe(e),L=Qe(e),F=Qe(e);let B,R;if((c===0?o:0)===0)B=1,R=2-y;else{const N=o===3?1:2,z=o===1?2:1;B=N,R=z*(2-y)}m-=B*(O+M),g-=R*(L+F)}let x=2,C=2,P=2,S=0,_=null,k=null;if(e.readBits(1)){e.readBits(1)&&e.readBits(8)===255&&(e.skipBits(16),e.skipBits(16)),e.readBits(1)&&e.skipBits(1),e.readBits(1)&&(e.skipBits(3),S=e.readBits(1),e.readBits(1)&&(x=e.readBits(8),C=e.readBits(8),P=e.readBits(8))),e.readBits(1)&&(Qe(e),Qe(e)),e.readBits(1)&&(e.skipBits(32),e.skipBits(32),e.skipBits(1));const R=e.readBits(1);R&&UP(e);const A=e.readBits(1);A&&UP(e),(R||A)&&e.skipBits(1),e.skipBits(1),e.readBits(1)&&(e.skipBits(1),Qe(e),Qe(e),Qe(e),Qe(e),_=Qe(e),k=Qe(e))}if(_===null){W(k===null);const O=i&16;if((r===44||r===86||r===100||r===110||r===122||r===244)&&O)_=0,k=0;else{const M=d+1,L=f+1,F=(2-y)*L,B=py.find(A=>A.level>=s)??Wn(py),R=Math.min(Math.floor(B.maxDpbMbs/(M*F)),16);_=R,k=R}}return W(k!==null),{profileIdc:r,constraintFlags:i,levelIdc:s,frameMbsOnlyFlag:y,chromaFormatIdc:o,bitDepthLumaMinus8:a,bitDepthChromaMinus8:l,codedWidth:h,codedHeight:p,displayWidth:m,displayHeight:g,colourPrimaries:x,matrixCoefficients:P,transferCharacteristics:C,fullRangeFlag:S,numReorderFrames:_,maxDecFrameBuffering:k}}catch(e){return console.error("Error parsing AVC SPS:",e),null}},UP=t=>{const e=Qe(t);t.skipBits(4),t.skipBits(4);for(let n=0;n<=e;n++)Qe(t),Qe(t),t.skipBits(1);t.skipBits(5),t.skipBits(5),t.skipBits(5),t.skipBits(5)},gD=(t,e)=>{if(e.description){const i=(fs(e.description)[21]&3)+1;return hD(t,i)}else return Xm(t)},gte=function*(t){yield*Xm(t)},rm=t=>t>>1&63,yD=t=>{try{const e=new Ln(pw(t));e.skipBits(16),e.readBits(4);const n=e.readBits(3),r=e.readBits(1),{general_profile_space:i,general_tier_flag:s,general_profile_idc:o,general_profile_compatibility_flags:a,general_constraint_indicator_flags:l,general_level_idc:c}=yte(e,n);Qe(e);const u=Qe(e);let d=0;u===3&&(d=e.readBits(1));const f=Qe(e),h=Qe(e);let p=f,m=h;if(e.readBits(1)){const M=Qe(e),L=Qe(e),F=Qe(e),B=Qe(e);let R=1,A=1;const N=d===0?u:0;N===1?(R=2,A=2):N===2&&(R=2,A=1),p-=(M+L)*R,m-=(F+B)*A}const g=Qe(e),y=Qe(e);Qe(e);const x=e.readBits(1)?0:n;let C=0;for(let M=x;M<=n;M++)Qe(e),C=Qe(e),Qe(e);Qe(e),Qe(e),Qe(e),Qe(e),Qe(e),Qe(e),e.readBits(1)&&e.readBits(1)&&bte(e),e.skipBits(1),e.skipBits(1),e.readBits(1)&&(e.skipBits(4),e.skipBits(4),Qe(e),Qe(e),e.skipBits(1));const P=Qe(e);if(wte(e,P),e.readBits(1)){const M=Qe(e);for(let L=0;L<M;L++)Qe(e),e.skipBits(1)}e.skipBits(1),e.skipBits(1);let S=2,_=2,k=2,T=0,O=0;if(e.readBits(1)){const M=xte(e,n);S=M.colourPrimaries,_=M.transferCharacteristics,k=M.matrixCoefficients,T=M.fullRangeFlag,O=M.minSpatialSegmentationIdc}return{displayWidth:p,displayHeight:m,colourPrimaries:S,transferCharacteristics:_,matrixCoefficients:k,fullRangeFlag:T,maxDecFrameBuffering:C+1,spsMaxSubLayersMinus1:n,spsTemporalIdNestingFlag:r,generalProfileSpace:i,generalTierFlag:s,generalProfileIdc:o,generalProfileCompatibilityFlags:a,generalConstraintIndicatorFlags:l,generalLevelIdc:c,chromaFormatIdc:u,bitDepthLumaMinus8:g,bitDepthChromaMinus8:y,minSpatialSegmentationIdc:O}}catch(e){return console.error("Error parsing HEVC SPS:",e),null}},nT=t=>{try{const e=[],n=[],r=[],i=[];for(const c of gte(t)){const u=t.subarray(c.offset,c.offset+c.length),d=rm(u[0]);d===ui.VPS_NUT?e.push(u):d===ui.SPS_NUT?n.push(u):d===ui.PPS_NUT?r.push(u):(d===ui.PREFIX_SEI_NUT||d===ui.SUFFIX_SEI_NUT)&&i.push(u)}if(n.length===0||r.length===0)return null;const s=yD(n[0]);if(!s)return null;let o=0;if(r.length>0){const c=r[0],u=new Ln(pw(c));u.skipBits(16),Qe(u),Qe(u),u.skipBits(1),u.skipBits(1),u.skipBits(3),u.skipBits(1),u.skipBits(1),Qe(u),Qe(u),Ka(u),u.skipBits(1),u.skipBits(1),u.readBits(1)&&Qe(u),Ka(u),Ka(u),u.skipBits(1),u.skipBits(1),u.skipBits(1),u.skipBits(1);const d=u.readBits(1),f=u.readBits(1);!d&&!f?o=0:d&&!f?o=2:!d&&f?o=3:o=0}const a=[...e.length?[{arrayCompleteness:1,nalUnitType:ui.VPS_NUT,nalUnits:e}]:[],...n.length?[{arrayCompleteness:1,nalUnitType:ui.SPS_NUT,nalUnits:n}]:[],...r.length?[{arrayCompleteness:1,nalUnitType:ui.PPS_NUT,nalUnits:r}]:[],...i.length?[{arrayCompleteness:1,nalUnitType:rm(i[0][0]),nalUnits:i}]:[]];return{configurationVersion:1,generalProfileSpace:s.generalProfileSpace,generalTierFlag:s.generalTierFlag,generalProfileIdc:s.generalProfileIdc,generalProfileCompatibilityFlags:s.generalProfileCompatibilityFlags,generalConstraintIndicatorFlags:s.generalConstraintIndicatorFlags,generalLevelIdc:s.generalLevelIdc,minSpatialSegmentationIdc:s.minSpatialSegmentationIdc,parallelismType:o,chromaFormatIdc:s.chromaFormatIdc,bitDepthLumaMinus8:s.bitDepthLumaMinus8,bitDepthChromaMinus8:s.bitDepthChromaMinus8,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:s.spsMaxSubLayersMinus1+1,temporalIdNested:s.spsTemporalIdNestingFlag,lengthSizeMinusOne:3,arrays:a}}catch(e){return console.error("Error building HEVC Decoder Configuration Record:",e),null}},yte=(t,e)=>{const n=t.readBits(2),r=t.readBits(1),i=t.readBits(5);let s=0;for(let u=0;u<32;u++)s=s<<1|t.readBits(1);const o=new Uint8Array(6);for(let u=0;u<6;u++)o[u]=t.readBits(8);const a=t.readBits(8),l=[],c=[];for(let u=0;u<e;u++)l.push(t.readBits(1)),c.push(t.readBits(1));if(e>0)for(let u=e;u<8;u++)t.skipBits(2);for(let u=0;u<e;u++)l[u]&&t.skipBits(88),c[u]&&t.skipBits(8);return{general_profile_space:n,general_tier_flag:r,general_profile_idc:i,general_profile_compatibility_flags:s,general_constraint_indicator_flags:o,general_level_idc:a}},bte=t=>{for(let e=0;e<4;e++)for(let n=0;n<(e===3?2:6);n++)if(!t.readBits(1))Qe(t);else{const i=Math.min(64,1<<4+(e<<1));e>1&&Ka(t);for(let s=0;s<i;s++)Ka(t)}},wte=(t,e)=>{const n=[];for(let r=0;r<e;r++)n[r]=vte(t,r,e,n)},vte=(t,e,n,r)=>{let i=0,s=0,o=0;if(e!==0&&(s=t.readBits(1)),s){if(e===n){const l=Qe(t);o=e-(l+1)}else o=e-1;t.readBits(1),Qe(t);const a=r[o]??0;for(let l=0;l<=a;l++)t.readBits(1)||t.readBits(1);i=r[o]}else{const a=Qe(t),l=Qe(t);for(let c=0;c<a;c++)Qe(t),t.readBits(1);for(let c=0;c<l;c++)Qe(t),t.readBits(1);i=a+l}return i},xte=(t,e)=>{let n=2,r=2,i=2,s=0,o=0;return t.readBits(1)&&t.readBits(8)===255&&(t.readBits(16),t.readBits(16)),t.readBits(1)&&t.readBits(1),t.readBits(1)&&(t.readBits(3),s=t.readBits(1),t.readBits(1)&&(n=t.readBits(8),r=t.readBits(8),i=t.readBits(8))),t.readBits(1)&&(Qe(t),Qe(t)),t.readBits(1),t.readBits(1),t.readBits(1),t.readBits(1)&&(Qe(t),Qe(t),Qe(t),Qe(t)),t.readBits(1)&&(t.readBits(32),t.readBits(32),t.readBits(1)&&Qe(t),t.readBits(1)&&Ste(t,!0,e)),t.readBits(1)&&(t.readBits(1),t.readBits(1),t.readBits(1),o=Qe(t),Qe(t),Qe(t),Qe(t),Qe(t)),{colourPrimaries:n,transferCharacteristics:r,matrixCoefficients:i,fullRangeFlag:s,minSpatialSegmentationIdc:o}},Ste=(t,e,n)=>{let r=!1,i=!1,s=!1;r=t.readBits(1)===1,i=t.readBits(1)===1,(r||i)&&(s=t.readBits(1)===1,s&&(t.readBits(8),t.readBits(5),t.readBits(1),t.readBits(5)),t.readBits(4),t.readBits(4),s&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let o=0;o<=n;o++){const a=t.readBits(1)===1;let l=!0;a||(l=t.readBits(1)===1);let c=!1;l?Qe(t):c=t.readBits(1)===1;let u=1;c||(u=Qe(t)+1),r&&HP(t,u,s),i&&HP(t,u,s)}},HP=(t,e,n)=>{for(let r=0;r<e;r++)Qe(t),Qe(t),n&&(Qe(t),Qe(t)),t.readBits(1)},kte=t=>{const e=[];e.push(t.configurationVersion),e.push((t.generalProfileSpace&3)<<6|(t.generalTierFlag&1)<<5|t.generalProfileIdc&31),e.push(t.generalProfileCompatibilityFlags>>>24&255),e.push(t.generalProfileCompatibilityFlags>>>16&255),e.push(t.generalProfileCompatibilityFlags>>>8&255),e.push(t.generalProfileCompatibilityFlags&255),e.push(...t.generalConstraintIndicatorFlags),e.push(t.generalLevelIdc&255),e.push(240|t.minSpatialSegmentationIdc>>8&15),e.push(t.minSpatialSegmentationIdc&255),e.push(252|t.parallelismType&3),e.push(252|t.chromaFormatIdc&3),e.push(248|t.bitDepthLumaMinus8&7),e.push(248|t.bitDepthChromaMinus8&7),e.push(t.avgFrameRate>>8&255),e.push(t.avgFrameRate&255),e.push((t.constantFrameRate&3)<<6|(t.numTemporalLayers&7)<<3|(t.temporalIdNested&1)<<2|t.lengthSizeMinusOne&3),e.push(t.arrays.length&255);for(const n of t.arrays){e.push((n.arrayCompleteness&1)<<7|0|n.nalUnitType&63),e.push(n.nalUnits.length>>8&255),e.push(n.nalUnits.length&255);for(const r of n.nalUnits){e.push(r.length>>8&255),e.push(r.length&255);for(let i=0;i<r.length;i++)e.push(r[i])}}return new Uint8Array(e)},bD=t=>{const e=new Ln(t);if(e.readBits(2)!==2)return null;const r=e.readBits(1),s=(e.readBits(1)<<1)+r;if(s===3&&e.skipBits(1),e.readBits(1)===1||e.readBits(1)!==0||(e.skipBits(2),e.readBits(24)!==4817730))return null;let c=8;s>=2&&(c=e.readBits(1)?12:10);const u=e.readBits(3);let d=0,f=0;if(u!==7)if(f=e.readBits(1),s===1||s===3){const _=e.readBits(1),k=e.readBits(1);d=!_&&!k?3:_&&!k?2:1,e.skipBits(1)}else d=1;else d=3,f=1;const h=e.readBits(16),p=e.readBits(16),m=h+1,g=p+1,y=m*g;let b=Wn(fc).level;for(const S of fc)if(y<=S.maxPictureSize){b=S.level;break}return{profile:s,level:b,bitDepth:c,chromaSubsampling:d,videoFullRangeFlag:f,colourPrimaries:u===2?1:u===1?6:2,transferCharacteristics:u===2?1:u===1?6:2,matrixCoefficients:u===7?0:u===2?1:u===1?6:2}},wD=function*(t){const e=new Ln(t),n=()=>{let r=0;for(let i=0;i<8;i++){const s=e.readAlignedByte();if(r|=(s&127)<<i*7,!(s&128))break;if(i===7&&s&128)return null}return r>=2**32-1?null:r};for(;e.getBitsLeft()>=8;){e.skipBits(1);const r=e.readBits(4),i=e.readBits(1),s=e.readBits(1);e.skipBits(1),i&&e.skipBits(8);let o;if(s){const a=n();if(a===null)return;o=a}else o=Math.floor(e.getBitsLeft()/8);W(e.pos%8===0),yield{type:r,data:t.subarray(e.pos/8,e.pos/8+o)},e.skipBits(o*8)}},vD=t=>{for(const{type:e,data:n}of wD(t)){if(e!==1)continue;const r=new Ln(n),i=r.readBits(3);r.readBits(1);const s=r.readBits(1);let o=0,a=0,l=0;if(s)o=r.readBits(5);else{if(r.readBits(1)&&(r.skipBits(32),r.skipBits(32),r.readBits(1)))return null;const P=r.readBits(1);P&&(l=r.readBits(5),r.skipBits(32),r.skipBits(5),r.skipBits(5));const S=r.readBits(5);for(let _=0;_<=S;_++){r.skipBits(12);const k=r.readBits(5);if(_===0&&(o=k),k>7){const O=r.readBits(1);_===0&&(a=O)}if(P&&r.readBits(1)){const M=l+1;r.skipBits(M),r.skipBits(M),r.skipBits(1)}r.readBits(1)&&r.skipBits(4)}}const c=r.readBits(4),u=r.readBits(4),d=c+1;r.skipBits(d);const f=u+1;r.skipBits(f);let h=0;if(s?h=0:h=r.readBits(1),h&&(r.skipBits(4),r.skipBits(3)),r.skipBits(1),r.skipBits(1),r.skipBits(1),!s){r.skipBits(1),r.skipBits(1),r.skipBits(1),r.skipBits(1);const C=r.readBits(1);C&&(r.skipBits(1),r.skipBits(1));const P=r.readBits(1);let S=0;P?S=2:S=r.readBits(1),S>0&&(r.readBits(1)||r.skipBits(1)),C&&r.skipBits(3)}r.skipBits(1),r.skipBits(1),r.skipBits(1);const p=r.readBits(1);let m=8;i===2&&p?m=r.readBits(1)?12:10:i<=2&&(m=p?10:8);let g=0;i!==1&&(g=r.readBits(1));let y=1,b=1,x=0;return g||(i===0?(y=1,b=1):i===1?(y=0,b=0):m===12&&(y=r.readBits(1),y&&(b=r.readBits(1))),y&&b&&(x=r.readBits(2))),{profile:i,level:o,tier:a,bitDepth:m,monochrome:g,chromaSubsamplingX:y,chromaSubsamplingY:b,chromaSamplePosition:x}}return null},xD=t=>{const e=jn(t),n=e.getUint8(9),r=e.getUint16(10,!0),i=e.getUint32(12,!0),s=e.getInt16(16,!0),o=e.getUint8(18);let a=null;return o&&(a=t.subarray(19,21+n)),{outputChannelCount:n,preSkip:r,inputSampleRate:i,outputGain:s,channelMappingFamily:o,channelMappingTable:a}},Ete=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],Tte=t=>{const e=t[0]>>3;return{durationInSamples:Ete[e]}},Cte=t=>{if(t.length<7)throw new Error("Setup header is too short.");if(t[0]!==5)throw new Error("Wrong packet type in Setup header.");if(String.fromCharCode(...t.slice(1,7))!=="vorbis")throw new Error("Invalid packet signature in Setup header.");const n=t.length,r=new Uint8Array(n);for(let d=0;d<n;d++)r[d]=t[n-1-d];const i=new Ln(r);let s=0;for(;i.getBitsLeft()>97;)if(i.readBits(1)===1){s=i.pos;break}if(s===0)throw new Error("Invalid Setup header: framing bit not found.");let o=0,a=!1,l=0;for(;i.getBitsLeft()>=97;){const d=i.pos,f=i.readBits(8),h=i.readBits(16),p=i.readBits(16);if(f>63||h!==0||p!==0){i.pos=d;break}if(i.skipBits(1),o++,o>64)break;i.clone().readBits(6)+1===o&&(a=!0,l=o)}if(!a)throw new Error("Invalid Setup header: mode header not found.");if(l>63)throw new Error(`Unsupported mode count: ${l}.`);const c=l;i.pos=0,i.skipBits(s);const u=Array(c).fill(0);for(let d=c-1;d>=0;d--)i.skipBits(40),u[d]=i.readBits(1);return{modeBlockflags:u}},rT=(t,e,n)=>{switch(t){case"avc":{for(const r of pD(n,e)){const i=n[r.offset],s=hw(i);if(s>=Vo.NON_IDR_SLICE&&s<=Vo.SLICE_DPC)return"delta";if(s===Vo.IDR)return"key";if(s===Vo.SEI&&(!Fx()||Kee()>=144)){const o=n.subarray(r.offset,r.offset+r.length),a=pw(o);let l=1;do{let c=0;for(;;){const f=a[l++];if(f===void 0||(c+=f,f<255))break}let u=0;for(;;){const f=a[l++];if(f===void 0||(u+=f,f<255))break}if(c===6){const f=new Ln(a);f.pos=8*l;const h=Qe(f),p=f.readBits(1);if(h===0&&p===1)return"key"}l+=u}while(l<a.length-1)}}return"delta"}case"hevc":{for(const r of gD(n,e)){const i=rm(n[r.offset]);if(i<ui.BLA_W_LP)return"delta";if(i<=ui.RSV_IRAP_VCL23)return"key"}return"delta"}case"vp8":return(n[0]&1)===0?"key":"delta";case"vp9":{const r=new Ln(n);if(r.readBits(2)!==2)return null;const i=r.readBits(1);return(r.readBits(1)<<1)+i===3&&r.skipBits(1),r.readBits(1)?null:r.readBits(1)===0?"key":"delta"}case"av1":{let r=!1;for(const{type:i,data:s}of wD(n))if(i===1){const o=new Ln(s);o.skipBits(4),r=!!o.readBits(1)}else if(i===3||i===6||i===7){if(r)return"key";const o=new Ln(s);return o.readBits(1)?null:o.readBits(2)===0?"key":"delta"}return null}default:zc(t),W(!1)}};var mf;(function(t){t[t.STREAMINFO=0]="STREAMINFO",t[t.VORBIS_COMMENT=4]="VORBIS_COMMENT",t[t.PICTURE=6]="PICTURE"})(mf||(mf={}));const zx=(t,e)=>{const n=jn(t);let r=0;const i=n.getUint32(r,!0);r+=4;const s=Fs.decode(t.subarray(r,r+i));r+=i,i>0&&(e.raw??={},e.raw.vendor??=s);const o=n.getUint32(r,!0);r+=4;for(let a=0;a<o;a++){const l=n.getUint32(r,!0);r+=4;const c=Fs.decode(t.subarray(r,r+l));r+=l;const u=c.indexOf("=");if(u===-1)continue;const d=c.slice(0,u).toUpperCase(),f=c.slice(u+1);switch(e.raw??={},e.raw[d]??=f,d){case"TITLE":e.title??=f;break;case"DESCRIPTION":e.description??=f;break;case"ARTIST":e.artist??=f;break;case"ALBUM":e.album??=f;break;case"ALBUMARTIST":e.albumArtist??=f;break;case"COMMENT":e.comment??=f;break;case"LYRICS":e.lyrics??=f;break;case"TRACKNUMBER":{const h=f.split("/"),p=Number.parseInt(h[0],10),m=h[1]&&Number.parseInt(h[1],10);Number.isInteger(p)&&p>0&&(e.trackNumber??=p),m&&Number.isInteger(m)&&m>0&&(e.tracksTotal??=m)}break;case"TRACKTOTAL":{const h=Number.parseInt(f,10);Number.isInteger(h)&&h>0&&(e.tracksTotal??=h)}break;case"DISCNUMBER":{const h=f.split("/"),p=Number.parseInt(h[0],10),m=h[1]&&Number.parseInt(h[1],10);Number.isInteger(p)&&p>0&&(e.discNumber??=p),m&&Number.isInteger(m)&&m>0&&(e.discsTotal??=m)}break;case"DISCTOTAL":{const h=Number.parseInt(f,10);Number.isInteger(h)&&h>0&&(e.discsTotal??=h)}break;case"DATE":{const h=new Date(f);Number.isNaN(h.getTime())||(e.date??=h)}break;case"GENRE":e.genre??=f;break;case"METADATA_BLOCK_PICTURE":{const h=Gee(f),p=jn(h),m=p.getUint32(0,!1),g=p.getUint32(4,!1),y=String.fromCharCode(...h.subarray(8,8+g)),b=p.getUint32(8+g,!1),x=Fs.decode(h.subarray(12+g,12+g+b)),C=p.getUint32(g+b+28),P=h.subarray(g+b+32,g+b+32+C);e.images??=[],e.images.push({data:P,mimeType:y,kind:m===3?"coverFront":m===4?"coverBack":"unknown",name:void 0,description:x||void 0})}break}}};class Jc{constructor(e){this.input=e}}const SD=[],kD=[],Ux=[],Hx=[];const gs=new Uint8Array(0);class Mn{constructor(e,n,r,i,s=-1,o,a){if(this.data=e,this.type=n,this.timestamp=r,this.duration=i,this.sequenceNumber=s,e===gs&&o===void 0)throw new Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(o===void 0&&(o=e.byteLength),!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(n!=="key"&&n!=="delta")throw new TypeError('type must be either "key" or "delta".');if(!Number.isFinite(r))throw new TypeError("timestamp must be a number.");if(!Number.isFinite(i)||i<0)throw new TypeError("duration must be a non-negative number.");if(!Number.isFinite(s))throw new TypeError("sequenceNumber must be a number.");if(!Number.isInteger(o)||o<0)throw new TypeError("byteLength must be a non-negative integer.");if(a!==void 0&&(typeof a!="object"||!a))throw new TypeError("sideData, when provided, must be an object.");if(a?.alpha!==void 0&&!(a.alpha instanceof Uint8Array))throw new TypeError("sideData.alpha, when provided, must be a Uint8Array.");if(a?.alphaByteLength!==void 0&&(!Number.isInteger(a.alphaByteLength)||a.alphaByteLength<0))throw new TypeError("sideData.alphaByteLength, when provided, must be a non-negative integer.");this.byteLength=o,this.sideData=a??{},this.sideData.alpha&&this.sideData.alphaByteLength===void 0&&(this.sideData.alphaByteLength=this.sideData.alpha.byteLength)}get isMetadataOnly(){return this.data===gs}get microsecondTimestamp(){return Math.trunc(dc*this.timestamp)}get microsecondDuration(){return Math.trunc(dc*this.duration)}toEncodedVideoChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}alphaToEncodedVideoChunk(e=this.type){if(!this.sideData.alpha)throw new TypeError("This packet does not contain alpha side data.");if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.sideData.alpha,type:e,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}toEncodedAudioChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to an audio chunk.");if(typeof EncodedAudioChunk>"u")throw new Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}static fromEncodedChunk(e,n){if(!(e instanceof EncodedVideoChunk||e instanceof EncodedAudioChunk))throw new TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");const r=new Uint8Array(e.byteLength);return e.copyTo(r),new Mn(r,e.type,e.timestamp/1e6,(e.duration??0)/1e6,void 0,void 0,n)}clone(e){if(e!==void 0&&(typeof e!="object"||e===null))throw new TypeError("options, when provided, must be an object.");if(e?.data!==void 0&&!(e.data instanceof Uint8Array))throw new TypeError("options.data, when provided, must be a Uint8Array.");if(e?.type!==void 0&&e.type!=="key"&&e.type!=="delta")throw new TypeError('options.type, when provided, must be either "key" or "delta".');if(e?.timestamp!==void 0&&!Number.isFinite(e.timestamp))throw new TypeError("options.timestamp, when provided, must be a number.");if(e?.duration!==void 0&&!Number.isFinite(e.duration))throw new TypeError("options.duration, when provided, must be a number.");if(e?.sequenceNumber!==void 0&&!Number.isFinite(e.sequenceNumber))throw new TypeError("options.sequenceNumber, when provided, must be a number.");if(e?.sideData!==void 0&&(typeof e.sideData!="object"||e.sideData===null))throw new TypeError("options.sideData, when provided, must be an object.");return new Mn(e?.data??this.data,e?.type??this.type,e?.timestamp??this.timestamp,e?.duration??this.duration,e?.sequenceNumber??this.sequenceNumber,this.byteLength,e?.sideData??this.sideData)}}const _te=t=>{let r=t,i=4096,s=0,o=12,a=0;for(r<0&&(r=-r,s=128),r+=33,r>8191&&(r=8191);(r&i)!==i&&o>=5;)i>>=1,o--;return a=r>>o-4&15,~(s|o-5<<4|a)&255},Ate=t=>{let n=0,r=0,i=~t;i&128&&(i&=-129,n=-1),r=((i&240)>>4)+5;const s=(1<<r|(i&15)<<r-4|1<<r-5)-33;return n===0?s:-s},Pte=t=>{let n=2048,r=0,i=11,s=0,o=t;for(o<0&&(o=-o,r=128),o>4095&&(o=4095);(o&n)!==n&&i>=5;)n>>=1,i--;return s=o>>(i===4?1:i-4)&15,(r|i-4<<4|s)^85},Ite=t=>{let e=0,n=0,r=t^85;r&128&&(r&=-129,e=-1),n=((r&240)>>4)+4;let i=0;return n!==4?i=1<<n|(r&15)<<n-4|1<<n-5:i=r<<1|1,e===0?i:-i};aD();let VP=-1/0,WP=-1/0,im=null;typeof FinalizationRegistry<"u"&&(im=new FinalizationRegistry(t=>{const e=Date.now();t.type==="video"?(e-VP>=1e3&&(console.error("A VideoSample was garbage collected without first being closed. For proper resource management, make sure to call close() on all your VideoSamples as soon as you're done using them."),VP=e),typeof VideoFrame<"u"&&t.data instanceof VideoFrame&&t.data.close()):(e-WP>=1e3&&(console.error("An AudioSample was garbage collected without first being closed. For proper resource management, make sure to call close() on all your AudioSamples as soon as you're done using them."),WP=e),typeof AudioData<"u"&&t.data instanceof AudioData&&t.data.close())}));const ED=["I420","I420P10","I420P12","I420A","I420AP10","I420AP12","I422","I422P10","I422P12","I422A","I422AP10","I422AP12","I444","I444P10","I444P12","I444A","I444AP10","I444AP12","NV12","RGBA","RGBX","BGRA","BGRX"],Ote=new Set(ED);class _i{get displayWidth(){return this.rotation%180===0?this.codedWidth:this.codedHeight}get displayHeight(){return this.rotation%180===0?this.codedHeight:this.codedWidth}get microsecondTimestamp(){return Math.trunc(dc*this.timestamp)}get microsecondDuration(){return Math.trunc(dc*this.duration)}get hasAlpha(){return this.format&&this.format.includes("A")}constructor(e,n){if(this._closed=!1,e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer||ArrayBuffer.isView(e)){if(!n||typeof n!="object")throw new TypeError("init must be an object.");if(n.format===void 0||!Ote.has(n.format))throw new TypeError("init.format must be one of: "+ED.join(", "));if(!Number.isInteger(n.codedWidth)||n.codedWidth<=0)throw new TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(n.codedHeight)||n.codedHeight<=0)throw new TypeError("init.codedHeight must be a positive integer.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(n.timestamp))throw new TypeError("init.timestamp must be a number.");if(n.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=fs(e).slice(),this._layout=n.layout??Mte(n.format,n.codedWidth,n.codedHeight),this.format=n.format,this.codedWidth=n.codedWidth,this.codedHeight=n.codedHeight,this.rotation=n.rotation??0,this.timestamp=n.timestamp,this.duration=n.duration??0,this.colorSpace=new h1(n.colorSpace)}else if(typeof VideoFrame<"u"&&e instanceof VideoFrame){if(n?.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(n?.timestamp!==void 0&&!Number.isFinite(n?.timestamp))throw new TypeError("init.timestamp, when provided, must be a number.");if(n?.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=e,this._layout=null,this.format=e.format,this.codedWidth=e.displayWidth,this.codedHeight=e.displayHeight,this.rotation=n?.rotation??0,this.timestamp=n?.timestamp??e.timestamp/1e6,this.duration=n?.duration??(e.duration??0)/1e6,this.colorSpace=new h1(e.colorSpace)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof SVGImageElement<"u"&&e instanceof SVGImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){if(!n||typeof n!="object")throw new TypeError("init must be an object.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(n.timestamp))throw new TypeError("init.timestamp must be a number.");if(n.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");if(typeof VideoFrame<"u")return new _i(new VideoFrame(e,{timestamp:Math.trunc(n.timestamp*dc),duration:Math.trunc((n.duration??0)*dc)||void 0}),n);let r=0,i=0;if("naturalWidth"in e?(r=e.naturalWidth,i=e.naturalHeight):"videoWidth"in e?(r=e.videoWidth,i=e.videoHeight):"width"in e&&(r=Number(e.width),i=Number(e.height)),!r||!i)throw new TypeError("Could not determine dimensions.");const s=new OffscreenCanvas(r,i),o=s.getContext("2d",{alpha:Uf(),willReadFrequently:!0});W(o),o.drawImage(e,0,0),this._data=s,this._layout=null,this.format="RGBX",this.codedWidth=r,this.codedHeight=i,this.rotation=n.rotation??0,this.timestamp=n.timestamp,this.duration=n.duration??0,this.colorSpace=new h1({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}else throw new TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.");im?.register(this,{type:"video",data:this._data},this)}clone(){if(this._closed)throw new Error("VideoSample is closed.");return W(this._data!==null),cu(this._data)?new _i(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?(W(this._layout),new _i(this._data,{format:this.format,layout:this._layout,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})):new _i(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}close(){this._closed||(im?.unregister(this),cu(this._data)?this._data.close():this._data=null,this._closed=!0)}allocationSize(e={}){if(jP(e),this._closed)throw new Error("VideoSample is closed.");if(this.format===null)throw new Error("Cannot get allocation size when format is null. Sorry!");if(W(this._data!==null),!cu(this._data)&&(e.colorSpace||e.format&&e.format!==this.format||e.layout||e.rect)){const n=this.toVideoFrame(),r=n.allocationSize(e);return n.close(),r}return cu(this._data)?this._data.allocationSize(e):this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}async copyTo(e,n={}){if(!cw(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(jP(n),this._closed)throw new Error("VideoSample is closed.");if(this.format===null)throw new Error("Cannot copy video sample data when format is null. Sorry!");if(W(this._data!==null),!cu(this._data)&&(n.colorSpace||n.format&&n.format!==this.format||n.layout||n.rect)){const r=this.toVideoFrame(),i=await r.copyTo(e,n);return r.close(),i}if(cu(this._data))return this._data.copyTo(e,n);if(this._data instanceof Uint8Array)return W(this._layout),fs(e).set(this._data),this._layout;{const i=this._data.getContext("2d");W(i);const s=i.getImageData(0,0,this.codedWidth,this.codedHeight);return fs(e).set(s.data),[{offset:0,stride:4*this.codedWidth}]}}toVideoFrame(){if(this._closed)throw new Error("VideoSample is closed.");return W(this._data!==null),cu(this._data)?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0})}draw(e,n,r,i,s,o,a,l,c){let u=0,d=0,f=this.displayWidth,h=this.displayHeight,p=0,m=0,g=this.displayWidth,y=this.displayHeight;if(o!==void 0?(u=n,d=r,f=i,h=s,p=o,m=a,l!==void 0?(g=l,y=c):(g=f,y=h)):(p=n,m=r,i!==void 0&&(g=i,y=s)),!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(u))throw new TypeError("sx must be a number.");if(!Number.isFinite(d))throw new TypeError("sy must be a number.");if(!Number.isFinite(f)||f<0)throw new TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(h)||h<0)throw new TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(p))throw new TypeError("dx must be a number.");if(!Number.isFinite(m))throw new TypeError("dy must be a number.");if(!Number.isFinite(g)||g<0)throw new TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(y)||y<0)throw new TypeError("dHeight must be a non-negative number.");if(this._closed)throw new Error("VideoSample is closed.");({sx:u,sy:d,sWidth:f,sHeight:h}=this._rotateSourceRegion(u,d,f,h,this.rotation));const b=this.toCanvasImageSource();e.save();const x=p+g/2,C=m+y/2;e.translate(x,C),e.rotate(this.rotation*Math.PI/180);const P=this.rotation%180===0?1:g/y;e.scale(1/P,P),e.drawImage(b,u,d,f,h,-g/2,-y/2,g,y),e.restore()}drawWithFit(e,n){if(!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(!["fill","contain","cover"].includes(n.fit))throw new TypeError("options.fit must be 'fill', 'contain', or 'cover'.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180, or 270.");n.crop!==void 0&&sT(n.crop,"options.");const r=e.canvas.width,i=e.canvas.height,s=n.rotation??this.rotation,[o,a]=s%180===0?[this.codedWidth,this.codedHeight]:[this.codedHeight,this.codedWidth];n.crop&&iT(n.crop,o,a);let l,c,u,d;const{sx:f,sy:h,sWidth:p,sHeight:m}=this._rotateSourceRegion(n.crop?.left??0,n.crop?.top??0,n.crop?.width??o,n.crop?.height??a,s);if(n.fit==="fill")l=0,c=0,u=r,d=i;else{const[y,b]=n.crop?[n.crop.width,n.crop.height]:[o,a],x=n.fit==="contain"?Math.min(r/y,i/b):Math.max(r/y,i/b);u=y*x,d=b*x,l=(r-u)/2,c=(i-d)/2}e.save();const g=s%180===0?1:u/d;e.translate(r/2,i/2),e.rotate(s*Math.PI/180),e.scale(1/g,g),e.translate(-r/2,-i/2),e.drawImage(this.toCanvasImageSource(),f,h,p,m,l,c,u,d),e.restore()}_rotateSourceRegion(e,n,r,i,s){return s===90?[e,n,r,i]=[n,this.codedHeight-e-r,i,r]:s===180?[e,n]=[this.codedWidth-e-r,this.codedHeight-n-i]:s===270&&([e,n,r,i]=[this.codedWidth-n-i,e,i,r]),{sx:e,sy:n,sWidth:r,sHeight:i}}toCanvasImageSource(){if(this._closed)throw new Error("VideoSample is closed.");if(W(this._data!==null),this._data instanceof Uint8Array){const e=this.toVideoFrame();return queueMicrotask(()=>e.close()),e}else return this._data}setRotation(e){if(![0,90,180,270].includes(e))throw new TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}setDuration(e){if(!Number.isFinite(e)||e<0)throw new TypeError("newDuration must be a non-negative number.");this.duration=e}[Symbol.dispose](){this.close()}}class h1{constructor(e){this.primaries=e?.primaries??null,this.transfer=e?.transfer??null,this.matrix=e?.matrix??null,this.fullRange=e?.fullRange??null}toJSON(){return{primaries:this.primaries,transfer:this.transfer,matrix:this.matrix,fullRange:this.fullRange}}}const cu=t=>typeof VideoFrame<"u"&&t instanceof VideoFrame,iT=(t,e,n)=>{t.left=Math.min(t.left,e),t.top=Math.min(t.top,n),t.width=Math.min(t.width,e-t.left),t.height=Math.min(t.height,n-t.top),W(t.width>=0),W(t.height>=0)},sT=(t,e)=>{if(!t||typeof t!="object")throw new TypeError(e+"crop, when provided, must be an object.");if(!Number.isInteger(t.left)||t.left<0)throw new TypeError(e+"crop.left must be a non-negative integer.");if(!Number.isInteger(t.top)||t.top<0)throw new TypeError(e+"crop.top must be a non-negative integer.");if(!Number.isInteger(t.width)||t.width<0)throw new TypeError(e+"crop.width must be a non-negative integer.");if(!Number.isInteger(t.height)||t.height<0)throw new TypeError(e+"crop.height must be a non-negative integer.")},jP=t=>{if(!t||typeof t!="object")throw new TypeError("options must be an object.");if(t.colorSpace!==void 0&&!["display-p3","srgb"].includes(t.colorSpace))throw new TypeError("options.colorSpace, when provided, must be 'display-p3' or 'srgb'.");if(t.format!==void 0&&typeof t.format!="string")throw new TypeError("options.format, when provided, must be a string.");if(t.layout!==void 0){if(!Array.isArray(t.layout))throw new TypeError("options.layout, when provided, must be an array.");for(const e of t.layout){if(!e||typeof e!="object")throw new TypeError("Each entry in options.layout must be an object.");if(!Number.isInteger(e.offset)||e.offset<0)throw new TypeError("plane.offset must be a non-negative integer.");if(!Number.isInteger(e.stride)||e.stride<0)throw new TypeError("plane.stride must be a non-negative integer.")}}if(t.rect!==void 0){if(!t.rect||typeof t.rect!="object")throw new TypeError("options.rect, when provided, must be an object.");if(t.rect.x!==void 0&&(!Number.isInteger(t.rect.x)||t.rect.x<0))throw new TypeError("options.rect.x, when provided, must be a non-negative integer.");if(t.rect.y!==void 0&&(!Number.isInteger(t.rect.y)||t.rect.y<0))throw new TypeError("options.rect.y, when provided, must be a non-negative integer.");if(t.rect.width!==void 0&&(!Number.isInteger(t.rect.width)||t.rect.width<0))throw new TypeError("options.rect.width, when provided, must be a non-negative integer.");if(t.rect.height!==void 0&&(!Number.isInteger(t.rect.height)||t.rect.height<0))throw new TypeError("options.rect.height, when provided, must be a non-negative integer.")}},Mte=(t,e,n)=>{const r=Nte(t),i=[];let s=0;for(const o of r){const a=Math.ceil(e/o.widthDivisor),l=Math.ceil(n/o.heightDivisor),c=a*o.sampleBytes,u=c*l;i.push({offset:s,stride:c}),s+=u}return i},Nte=t=>{const e=(n,r,i,s,o)=>{const a=[{sampleBytes:n,widthDivisor:1,heightDivisor:1},{sampleBytes:r,widthDivisor:i,heightDivisor:s},{sampleBytes:r,widthDivisor:i,heightDivisor:s}];return o&&a.push({sampleBytes:n,widthDivisor:1,heightDivisor:1}),a};switch(t){case"I420":return e(1,1,2,2,!1);case"I420P10":case"I420P12":return e(2,2,2,2,!1);case"I420A":return e(1,1,2,2,!0);case"I420AP10":case"I420AP12":return e(2,2,2,2,!0);case"I422":return e(1,1,2,1,!1);case"I422P10":case"I422P12":return e(2,2,2,1,!1);case"I422A":return e(1,1,2,1,!0);case"I422AP10":case"I422AP12":return e(2,2,2,1,!0);case"I444":return e(1,1,1,1,!1);case"I444P10":case"I444P12":return e(2,2,1,1,!1);case"I444A":return e(1,1,1,1,!0);case"I444AP10":case"I444AP12":return e(2,2,1,1,!0);case"NV12":return[{sampleBytes:1,widthDivisor:1,heightDivisor:1},{sampleBytes:2,widthDivisor:2,heightDivisor:2}];case"RGBA":case"RGBX":case"BGRA":case"BGRX":return[{sampleBytes:4,widthDivisor:1,heightDivisor:1}];default:zc(t),W(!1)}},p1=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]);class Ds{get microsecondTimestamp(){return Math.trunc(dc*this.timestamp)}get microsecondDuration(){return Math.trunc(dc*this.duration)}constructor(e){if(this._closed=!1,Lh(e)){if(e.format===null)throw new TypeError("AudioData with null format is not supported.");this._data=e,this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=e.numberOfFrames,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp/1e6,this.duration=e.numberOfFrames/e.sampleRate}else{if(!e||typeof e!="object")throw new TypeError("Invalid AudioDataInit: must be an object.");if(!p1.has(e.format))throw new TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(e.sampleRate)||e.sampleRate<=0)throw new TypeError("Invalid AudioDataInit: sampleRate must be > 0.");if(!Number.isInteger(e.numberOfChannels)||e.numberOfChannels===0)throw new TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(e?.timestamp))throw new TypeError("init.timestamp must be a number.");const n=e.data.byteLength/(vu(e.format)*e.numberOfChannels);if(!Number.isInteger(n))throw new TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=n,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp,this.duration=n/e.sampleRate;let r;if(e.data instanceof ArrayBuffer)r=new Uint8Array(e.data);else if(ArrayBuffer.isView(e.data))r=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);else throw new TypeError("Invalid AudioDataInit: data is not a BufferSource.");const i=this.numberOfFrames*this.numberOfChannels*vu(this.format);if(r.byteLength<i)throw new TypeError("Invalid AudioDataInit: insufficient data size.");this._data=r}im?.register(this,{type:"audio",data:this._data},this)}allocationSize(e){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(e.format!==void 0&&!p1.has(e.format))throw new TypeError("Invalid format.");if(e.frameOffset!==void 0&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(e.frameCount!==void 0&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const n=e.format??this.format,r=e.frameOffset??0;if(r>=this.numberOfFrames)throw new RangeError("frameOffset out of range");const i=e.frameCount!==void 0?e.frameCount:this.numberOfFrames-r;if(i>this.numberOfFrames-r)throw new RangeError("frameCount out of range");const s=vu(n),o=Qd(n);if(o&&e.planeIndex>=this.numberOfChannels)throw new RangeError("planeIndex out of range");if(!o&&e.planeIndex!==0)throw new RangeError("planeIndex out of range");return(o?i:i*this.numberOfChannels)*s}copyTo(e,n){if(!cw(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(n.planeIndex)||n.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(n.format!==void 0&&!p1.has(n.format))throw new TypeError("Invalid format.");if(n.frameOffset!==void 0&&(!Number.isInteger(n.frameOffset)||n.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(n.frameCount!==void 0&&(!Number.isInteger(n.frameCount)||n.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const{planeIndex:r,format:i,frameCount:s,frameOffset:o}=n,a=this.format,l=i??this.format;if(!l)throw new Error("Destination format not determined");const c=this.numberOfFrames,u=this.numberOfChannels,d=o??0;if(d>=c)throw new RangeError("frameOffset out of range");const f=s!==void 0?s:c-d;if(f>c-d)throw new RangeError("frameCount out of range");const h=vu(l),p=Qd(l);if(p&&r>=u)throw new RangeError("planeIndex out of range");if(!p&&r!==0)throw new RangeError("planeIndex out of range");const g=(p?f:f*u)*h;if(e.byteLength<g)throw new RangeError("Destination buffer is too small");const y=jn(e),b=CD(l);if(Lh(this._data))xp()&&u>2&&l!==a?Rte(this._data,y,a,l,u,r,d,f):this._data.copyTo(e,{planeIndex:r,frameOffset:d,frameCount:f,format:l});else{const x=this._data,C=jn(x),P=TD(a),S=vu(a),_=Qd(a);for(let k=0;k<f;k++)if(p){const T=k*h;let O;_?O=(r*c+(k+d))*S:O=((k+d)*u+r)*S;const M=P(C,O);b(y,T,M)}else for(let T=0;T<u;T++){const M=(k*u+T)*h;let L;_?L=(T*c+(k+d))*S:L=((k+d)*u+T)*S;const F=P(C,L);b(y,M,F)}}}clone(){if(this._closed)throw new Error("AudioSample is closed.");if(Lh(this._data)){const e=new Ds(this._data.clone());return e.setTimestamp(this.timestamp),e}else return new Ds({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data})}close(){this._closed||(im?.unregister(this),Lh(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}toAudioData(){if(this._closed)throw new Error("AudioSample is closed.");if(Lh(this._data)){if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(Qd(this.format)){const e=this.allocationSize({planeIndex:0,format:this.format}),n=new ArrayBuffer(e*this.numberOfChannels);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(new Uint8Array(n,r*e,e),{planeIndex:r,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:n})}else{const e=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(e,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:e})}}else return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data.buffer instanceof ArrayBuffer?this._data.buffer:this._data.slice()})}toAudioBuffer(){if(this._closed)throw new Error("AudioSample is closed.");const e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),n=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(n,{planeIndex:r,format:"f32-planar"}),e.copyToChannel(n,r);return e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}[Symbol.dispose](){this.close()}static*_fromAudioBuffer(e,n){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const r=48e3*5,i=e.numberOfChannels,s=e.sampleRate,o=e.length,a=Math.floor(r/i);let l=0,c=o;for(;c>0;){const u=Math.min(a,c),d=new Float32Array(i*u);for(let f=0;f<i;f++)e.copyFromChannel(d.subarray(f*u,(f+1)*u),f,l);yield new Ds({format:"f32-planar",sampleRate:s,numberOfFrames:u,numberOfChannels:i,timestamp:n+l/s,data:d}),l+=u,c-=u}}static fromAudioBuffer(e,n){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const r=48e3*5,i=e.numberOfChannels,s=e.sampleRate,o=e.length,a=Math.floor(r/i);let l=0,c=o;const u=[];for(;c>0;){const d=Math.min(a,c),f=new Float32Array(i*d);for(let p=0;p<i;p++)e.copyFromChannel(f.subarray(p*d,(p+1)*d),p,l);const h=new Ds({format:"f32-planar",sampleRate:s,numberOfFrames:d,numberOfChannels:i,timestamp:n+l/s,data:f});u.push(h),l+=d,c-=d}return u}}const vu=t=>{switch(t){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":return 4;case"f32":case"f32-planar":return 4;default:throw new Error("Unknown AudioSampleFormat")}},Qd=t=>{switch(t){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},TD=t=>{switch(t){case"u8":case"u8-planar":return(e,n)=>(e.getUint8(n)-128)/128;case"s16":case"s16-planar":return(e,n)=>e.getInt16(n,!0)/32768;case"s32":case"s32-planar":return(e,n)=>e.getInt32(n,!0)/2147483648;case"f32":case"f32-planar":return(e,n)=>e.getFloat32(n,!0)}},CD=t=>{switch(t){case"u8":case"u8-planar":return(e,n,r)=>e.setUint8(n,zr((r+1)*127.5,0,255));case"s16":case"s16-planar":return(e,n,r)=>e.setInt16(n,zr(Math.round(r*32767),-32768,32767),!0);case"s32":case"s32-planar":return(e,n,r)=>e.setInt32(n,zr(Math.round(r*2147483647),-2147483648,2147483647),!0);case"f32":case"f32-planar":return(e,n,r)=>e.setFloat32(n,r,!0)}},Lh=t=>typeof AudioData<"u"&&t instanceof AudioData,Rte=(t,e,n,r,i,s,o,a)=>{const l=TD(n),c=CD(r),u=vu(n),d=vu(r),f=Qd(n);if(Qd(r))if(f){const p=new ArrayBuffer(a*u),m=jn(p);t.copyTo(p,{planeIndex:s,frameOffset:o,frameCount:a,format:n});for(let g=0;g<a;g++){const y=g*u,b=g*d,x=l(m,y);c(e,b,x)}}else{const p=new ArrayBuffer(a*i*u),m=jn(p);t.copyTo(p,{planeIndex:0,frameOffset:o,frameCount:a,format:n});for(let g=0;g<a;g++){const y=(g*i+s)*u,b=g*d,x=l(m,y);c(e,b,x)}}else if(f){const p=a*u,m=new ArrayBuffer(p),g=jn(m);for(let y=0;y<i;y++){t.copyTo(m,{planeIndex:y,frameOffset:o,frameCount:a,format:n});for(let b=0;b<a;b++){const x=b*u,C=(b*i+y)*d,P=l(g,x);c(e,C,P)}}}else{const p=new ArrayBuffer(a*i*u),m=jn(p);t.copyTo(p,{planeIndex:0,frameOffset:o,frameCount:a,format:n});for(let g=0;g<a;g++)for(let y=0;y<i;y++){const b=g*i+y,x=b*u,C=b*d,P=l(m,x);c(e,C,P)}}};const Md=t=>{if(!t||typeof t!="object")throw new TypeError("options must be an object.");if(t.metadataOnly!==void 0&&typeof t.metadataOnly!="boolean")throw new TypeError("options.metadataOnly, when defined, must be a boolean.");if(t.verifyKeyPackets!==void 0&&typeof t.verifyKeyPackets!="boolean")throw new TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(t.verifyKeyPackets&&t.metadataOnly)throw new TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},Ec=t=>{if(!lD(t))throw new TypeError("timestamp must be a number.")},m1=(t,e,n)=>n.verifyKeyPackets?e.then(async r=>{if(!r||r.type==="delta")return r;const i=await t.determinePacketType(r);return i&&(r.type=i),r}):e;class sm{constructor(e){if(!(e instanceof aT))throw new TypeError("track must be an InputTrack.");this._track=e}getFirstPacket(e={}){if(Md(e),this._track.input._disposed)throw new ss;return m1(this._track,this._track._backing.getFirstPacket(e),e)}getPacket(e,n={}){if(Ec(e),Md(n),this._track.input._disposed)throw new ss;return m1(this._track,this._track._backing.getPacket(e,n),n)}getNextPacket(e,n={}){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(Md(n),this._track.input._disposed)throw new ss;return m1(this._track,this._track._backing.getNextPacket(e,n),n)}async getKeyPacket(e,n={}){if(Ec(e),Md(n),this._track.input._disposed)throw new ss;if(!n.verifyKeyPackets)return this._track._backing.getKeyPacket(e,n);const r=await this._track._backing.getKeyPacket(e,n);return r&&(W(r.type==="key"),await this._track.determinePacketType(r)==="delta"?this.getKeyPacket(r.timestamp-1/this._track.timeResolution,n):r)}async getNextKeyPacket(e,n={}){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(Md(n),this._track.input._disposed)throw new ss;if(!n.verifyKeyPackets)return this._track._backing.getNextKeyPacket(e,n);const r=await this._track._backing.getNextKeyPacket(e,n);return r&&(W(r.type==="key"),await this._track.determinePacketType(r)==="delta"?this.getNextKeyPacket(r,n):r)}packets(e,n,r={}){if(e!==void 0&&!(e instanceof Mn))throw new TypeError("startPacket must be an EncodedPacket.");if(e!==void 0&&e.isMetadataOnly&&!r?.metadataOnly)throw new TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(n!==void 0&&!(n instanceof Mn))throw new TypeError("endPacket must be an EncodedPacket.");if(Md(r),this._track.input._disposed)throw new ss;const i=[];let{promise:s,resolve:o}=ci(),{promise:a,resolve:l}=ci(),c=!1,u=!1,d=null;const f=[],h=()=>Math.max(2,f.length);(async()=>{let m=e??await this.getFirstPacket(r);for(;m&&!u&&!this._track.input._disposed&&!(n&&m.sequenceNumber>=n?.sequenceNumber);){if(i.length>h()){({promise:a,resolve:l}=ci()),await a;continue}i.push(m),o(),{promise:s,resolve:o}=ci(),m=await this.getNextPacket(m,r)}c=!0,o()})().catch(m=>{d||(d=m,o())});const p=this._track;return{async next(){for(;;){if(p.input._disposed)throw new ss;if(u)return{value:void 0,done:!0};if(d)throw d;if(i.length>0){const m=i.shift(),g=performance.now();for(f.push(g);f.length>0&&g-f[0]>=1e3;)f.shift();return l(),{value:m,done:!1}}else{if(c)return{value:void 0,done:!0};await s}}},async return(){return u=!0,l(),o(),{value:void 0,done:!0}},async throw(m){throw m},[Symbol.asyncIterator](){return this}}}}class oT{constructor(e,n){this.onSample=e,this.onError=n}}class _D{mediaSamplesInRange(e=0,n=1/0){Ec(e),Ec(n);const r=[];let i=!1,s=null,{promise:o,resolve:a}=ci(),{promise:l,resolve:c}=ci(),u=!1,d=!1,f=!1,h=null;(async()=>{const g=await this._createDecoder(S=>{if(c(),S.timestamp>=n&&(d=!0),d){S.close();return}s&&(S.timestamp>e?(r.push(s),i=!0):s.close()),S.timestamp>=e&&(r.push(S),i=!0),s=i?null:S,r.length>0&&(a(),{promise:o,resolve:a}=ci())},S=>{h||(h=S,a())}),y=this._createPacketSink(),b=await y.getKeyPacket(e,{verifyKeyPackets:!0})??await y.getFirstPacket();let x=b;const P=y.packets(b??void 0,void 0);for(await P.next();x&&!d&&!this._track.input._disposed;){const S=qP(r.length);if(r.length+g.getDecodeQueueSize()>S){({promise:l,resolve:c}=ci()),await l;continue}g.decode(x);const _=await P.next();if(_.done)break;x=_.value}await P.return(),!f&&!this._track.input._disposed&&await g.flush(),g.close(),!i&&s&&r.push(s),u=!0,a()})().catch(g=>{h||(h=g,a())});const p=this._track,m=()=>{s?.close();for(const g of r)g.close()};return{async next(){for(;;){if(p.input._disposed)throw m(),new ss;if(f)return{value:void 0,done:!0};if(h)throw m(),h;if(r.length>0){const g=r.shift();return c(),{value:g,done:!1}}else if(!u)await o;else return{value:void 0,done:!0}}},async return(){return f=!0,d=!0,c(),a(),m(),{value:void 0,done:!0}},async throw(g){throw g},[Symbol.asyncIterator](){return this}}}mediaSamplesAtTimestamps(e){Uee(e);const n=zee(e),r=[],i=[];let{promise:s,resolve:o}=ci(),{promise:a,resolve:l}=ci(),c=!1,u=!1,d=null;const f=m=>{i.push(m),o(),{promise:s,resolve:o}=ci()};(async()=>{const m=await this._createDecoder(S=>{if(l(),u){S.close();return}let _=0;for(;r.length>0&&S.timestamp-r[0]>-1e-10;)_++,r.shift();if(_>0)for(let k=0;k<_;k++)f(k<_-1?S.clone():S);else S.close()},S=>{d||(d=S,o())}),g=this._createPacketSink();let y=null,b=null,x=-1;const C=async()=>{W(b);let S=b;for(m.decode(S);S.sequenceNumber<x;){const _=qP(i.length);for(;i.length+m.getDecodeQueueSize()>_&&!u;)({promise:a,resolve:l}=ci()),await a;if(u)break;const k=await g.getNextPacket(S);W(k),m.decode(k),S=k}x=-1},P=async()=>{await m.flush();for(let S=0;S<r.length;S++)f(null);r.length=0};for await(const S of n){if(Ec(S),u||this._track.input._disposed)break;const _=await g.getPacket(S),k=_&&await g.getKeyPacket(S,{verifyKeyPackets:!0});if(!k){x!==-1&&(await C(),await P()),f(null),y=null;continue}y&&(k.sequenceNumber!==b.sequenceNumber||_.timestamp<y.timestamp)&&(await C(),await P()),r.push(_.timestamp),x=Math.max(_.sequenceNumber,x),y=_,b=k}!u&&!this._track.input._disposed&&(x!==-1&&await C(),await P()),m.close(),c=!0,o()})().catch(m=>{d||(d=m,o())});const h=this._track,p=()=>{for(const m of i)m?.close()};return{async next(){for(;;){if(h.input._disposed)throw p(),new ss;if(u)return{value:void 0,done:!0};if(d)throw p(),d;if(i.length>0){const m=i.shift();return W(m!==void 0),l(),{value:m,done:!1}}else if(!c)await s;else return{value:void 0,done:!0}}},async return(){return u=!0,l(),o(),p(),{value:void 0,done:!0}},async throw(m){throw m},[Symbol.asyncIterator](){return this}}}}const qP=t=>t===0?40:8;class Dte extends oT{constructor(e,n,r,i,s,o){super(e,n),this.codec=r,this.decoderConfig=i,this.rotation=s,this.timeResolution=o,this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new dw,this.customDecoderQueueSize=0,this.inputTimestamps=[],this.sampleQueue=[],this.currentPacketIndex=0,this.raslSkipped=!1,this.alphaDecoder=null,this.alphaHadKeyframe=!1,this.colorQueue=[],this.alphaQueue=[],this.merger=null,this.mergerCreationFailed=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue=[],this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1;const a=SD.find(l=>l.supports(r,i));if(a)this.customDecoder=new a,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=l=>{if(!(l instanceof _i))throw new TypeError("The argument passed to onSample must be a VideoSample.");this.finalizeAndEmitSample(l)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const l=u=>{if(this.alphaQueue.length>0){const d=this.alphaQueue.shift();W(d!==void 0),this.mergeAlpha(u,d)}else this.colorQueue.push(u)};if(r==="avc"&&this.decoderConfig.description&&Fx()){const u=mte(fs(this.decoderConfig.description));if(u&&u.sequenceParameterSets.length>0){const d=tT(u.sequenceParameterSets[0]);d&&d.frameMbsOnlyFlag===0&&(this.decoderConfig={...this.decoderConfig,hardwareAcceleration:"prefer-software"})}}const c=new Error("Decoding error").stack;this.decoder=new VideoDecoder({output:u=>{try{l(u)}catch(d){this.onError(d)}},error:u=>{u.stack=c,this.onError(u)}}),this.decoder.configure(this.decoderConfig)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(W(this.decoder),Math.max(this.decoder.decodeQueueSize,this.alphaDecoder?.decodeQueueSize??0))}decode(e){if(this.codec==="hevc"&&this.currentPacketIndex>0&&!this.raslSkipped){if(this.hasHevcRaslPicture(e.data))return;this.raslSkipped=!0}if(this.customDecoder)this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--);else{if(W(this.decoder),xp()||RP(this.inputTimestamps,e.timestamp,n=>n),Fx()&&this.currentPacketIndex===0&&this.codec==="avc"){const n=[];for(const i of pD(e.data,this.decoderConfig)){const s=hw(e.data[i.offset]);s>=20&&s<=31||n.push(e.data.subarray(i.offset,i.offset+i.length))}const r=hte(n,this.decoderConfig);e=new Mn(r,e.type,e.timestamp,e.duration)}this.decoder.decode(e.toEncodedVideoChunk()),this.decodeAlphaData(e)}this.currentPacketIndex++}decodeAlphaData(e){if(!e.sideData.alpha||this.mergerCreationFailed){this.pushNullAlphaFrame();return}if(!this.merger)try{this.merger=new Lte}catch(r){console.error("Due to an error, only color data will be decoded.",r),this.mergerCreationFailed=!0,this.decodeAlphaData(e);return}if(!this.alphaDecoder){const r=s=>{if(this.alphaDecoderQueueSize--,this.colorQueue.length>0){const o=this.colorQueue.shift();W(o!==void 0),this.mergeAlpha(o,s)}else this.alphaQueue.push(s);for(this.decodedAlphaChunkCount++;this.nullAlphaFrameQueue.length>0&&this.nullAlphaFrameQueue[0]===this.decodedAlphaChunkCount;)if(this.nullAlphaFrameQueue.shift(),this.colorQueue.length>0){const o=this.colorQueue.shift();W(o!==void 0),this.mergeAlpha(o,null)}else this.alphaQueue.push(null)},i=new Error("Decoding error").stack;this.alphaDecoder=new VideoDecoder({output:s=>{try{r(s)}catch(o){this.onError(o)}},error:s=>{s.stack=i,this.onError(s)}}),this.alphaDecoder.configure(this.decoderConfig)}const n=rT(this.codec,this.decoderConfig,e.sideData.alpha);if(this.alphaHadKeyframe||(this.alphaHadKeyframe=n==="key"),this.alphaHadKeyframe){if(this.codec==="hevc"&&this.currentAlphaPacketIndex>0&&!this.alphaRaslSkipped){if(this.hasHevcRaslPicture(e.sideData.alpha)){this.pushNullAlphaFrame();return}this.alphaRaslSkipped=!0}this.currentAlphaPacketIndex++,this.alphaDecoder.decode(e.alphaToEncodedVideoChunk(n??e.type)),this.alphaDecoderQueueSize++}else this.pushNullAlphaFrame()}pushNullAlphaFrame(){this.alphaDecoderQueueSize===0?this.alphaQueue.push(null):this.nullAlphaFrameQueue.push(this.decodedAlphaChunkCount+this.alphaDecoderQueueSize)}hasHevcRaslPicture(e){for(const n of gD(e,this.decoderConfig)){const r=rm(e[n.offset]);if(r===ui.RASL_N||r===ui.RASL_R)return!0}return!1}sampleHandler(e){if(xp()){if(this.sampleQueue.length>0&&e.timestamp>=Wn(this.sampleQueue).timestamp){for(const n of this.sampleQueue)this.finalizeAndEmitSample(n);this.sampleQueue.length=0}RP(this.sampleQueue,e,n=>n.timestamp)}else{const n=this.inputTimestamps.shift();W(n!==void 0),e.setTimestamp(n),this.finalizeAndEmitSample(e)}}finalizeAndEmitSample(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}mergeAlpha(e,n){if(!n){const s=new _i(e);this.sampleHandler(s);return}W(this.merger),this.merger.update(e,n),e.close(),n.close();const r=new VideoFrame(this.merger.canvas,{timestamp:e.timestamp,duration:e.duration??void 0}),i=new _i(r);this.sampleHandler(i)}async flush(){if(this.customDecoder?await this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(W(this.decoder),await Promise.all([this.decoder.flush(),this.alphaDecoder?.flush()]),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.alphaHadKeyframe=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue.length=0,this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1),xp()){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}this.currentPacketIndex=0,this.raslSkipped=!1}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(W(this.decoder),this.decoder.close(),this.alphaDecoder?.close(),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.merger?.close());for(const e of this.sampleQueue)e.close();this.sampleQueue.length=0}}class Lte{constructor(){typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(300,150):this.canvas=document.createElement("canvas");const e=this.canvas.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=e,this.program=this.createProgram(),this.vao=this.createVAO(),this.colorTexture=this.createTexture(),this.alphaTexture=this.createTexture(),this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_colorTexture"),0),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_alphaTexture"),1)}createProgram(){const e=this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_colorTexture;
			uniform sampler2D u_alphaTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec3 color = texture(u_colorTexture, v_texCoord).rgb;
				float alpha = texture(u_alphaTexture, v_texCoord).r;
				fragColor = vec4(color, alpha);
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createShader(e,n){const r=this.gl.createShader(e);return this.gl.shaderSource(r,n),this.gl.compileShader(r),r}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const n=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(this.program,"a_position"),s=this.gl.getAttribLocation(this.program,"a_texCoord");return this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}update(e,n){(e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.alphaTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class Vx extends _D{constructor(e){if(!(e instanceof ch))throw new TypeError("videoTrack must be an InputVideoTrack.");super(),this._track=e}async _createDecoder(e,n){if(!await this._track.canDecode())throw new Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._track.codec,i=this._track.rotation,s=await this._track.getDecoderConfig(),o=this._track.timeResolution;return W(r&&s),new Dte(e,n,r,s,i,o)}_createPacketSink(){return new sm(this._track)}async getSample(e){Ec(e);for await(const n of this.mediaSamplesAtTimestamps([e]))return n;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,n=1/0){return this.mediaSamplesInRange(e,n)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class Bte{constructor(e,n={}){if(this._nextCanvasIndex=0,!(e instanceof ch))throw new TypeError("videoTrack must be an InputVideoTrack.");if(n&&typeof n!="object")throw new TypeError("options must be an object.");if(n.alpha!==void 0&&typeof n.alpha!="boolean")throw new TypeError("options.alpha, when provided, must be a boolean.");if(n.width!==void 0&&(!Number.isInteger(n.width)||n.width<=0))throw new TypeError("options.width, when defined, must be a positive integer.");if(n.height!==void 0&&(!Number.isInteger(n.height)||n.height<=0))throw new TypeError("options.height, when defined, must be a positive integer.");if(n.fit!==void 0&&!["fill","contain","cover"].includes(n.fit))throw new TypeError('options.fit, when provided, must be one of "fill", "contain", or "cover".');if(n.width!==void 0&&n.height!==void 0&&n.fit===void 0)throw new TypeError("When both options.width and options.height are provided, options.fit must also be provided.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180 or 270.");if(n.crop!==void 0&&sT(n.crop,"options."),n.poolSize!==void 0&&(typeof n.poolSize!="number"||!Number.isInteger(n.poolSize)||n.poolSize<0))throw new TypeError("poolSize must be a non-negative integer.");const r=n.rotation??e.rotation,[i,s]=r%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],o=n.crop;o&&iT(o,i,s);let[a,l]=o?[o.width,o.height]:[i,s];const c=a/l;n.width!==void 0&&n.height===void 0?(a=n.width,l=Math.round(a/c)):n.width===void 0&&n.height!==void 0?(l=n.height,a=Math.round(l*c)):n.width!==void 0&&n.height!==void 0&&(a=n.width,l=n.height),this._videoTrack=e,this._alpha=n.alpha??!1,this._width=a,this._height=l,this._rotation=r,this._crop=o,this._fit=n.fit??"fill",this._videoSampleSink=new Vx(e),this._canvasPool=Array.from({length:n.poolSize??0},()=>null)}_videoSampleToWrappedCanvas(e){let n=this._canvasPool[this._nextCanvasIndex],r=!1;n||(typeof document<"u"?(n=document.createElement("canvas"),n.width=this._width,n.height=this._height):n=new OffscreenCanvas(this._width,this._height),this._canvasPool.length>0&&(this._canvasPool[this._nextCanvasIndex]=n),r=!0),this._canvasPool.length>0&&(this._nextCanvasIndex=(this._nextCanvasIndex+1)%this._canvasPool.length);const i=n.getContext("2d",{alpha:this._alpha||Uf()});W(i),i.resetTransform(),r||(!this._alpha&&Uf()?(i.fillStyle="black",i.fillRect(0,0,this._width,this._height)):i.clearRect(0,0,this._width,this._height)),e.drawWithFit(i,{fit:this._fit,rotation:this._rotation,crop:this._crop});const s={canvas:n,timestamp:e.timestamp,duration:e.duration};return e.close(),s}async getCanvas(e){Ec(e);const n=await this._videoSampleSink.getSample(e);return n&&this._videoSampleToWrappedCanvas(n)}canvases(e=0,n=1/0){return DP(this._videoSampleSink.samples(e,n),r=>this._videoSampleToWrappedCanvas(r))}canvasesAtTimestamps(e){return DP(this._videoSampleSink.samplesAtTimestamps(e),n=>n&&this._videoSampleToWrappedCanvas(n))}}class Fte extends oT{constructor(e,n,r,i){super(e,n),this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new dw,this.customDecoderQueueSize=0,this.currentTimestamp=null;const s=a=>{(this.currentTimestamp===null||Math.abs(a.timestamp-this.currentTimestamp)>=a.duration)&&(this.currentTimestamp=a.timestamp);const l=this.currentTimestamp;if(this.currentTimestamp+=a.duration,a.numberOfFrames===0){a.close();return}const c=i.sampleRate;a.setTimestamp(Math.round(l*c)/c),e(a)},o=kD.find(a=>a.supports(r,i));if(o)this.customDecoder=new o,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=a=>{if(!(a instanceof Ds))throw new TypeError("The argument passed to onSample must be an AudioSample.");s(a)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const a=new Error("Decoding error").stack;this.decoder=new AudioDecoder({output:l=>{try{s(new Ds(l))}catch(c){this.onError(c)}},error:l=>{l.stack=a,this.onError(l)}}),this.decoder.configure(i)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(W(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(W(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}flush(){return this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(W(this.decoder),this.decoder.flush())}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(W(this.decoder),this.decoder.close())}}class $te extends oT{constructor(e,n,r){super(e,n),this.decoderConfig=r,this.currentTimestamp=null,W(Pi.includes(r.codec)),this.codec=r.codec;const{dataType:i,sampleSize:s,littleEndian:o}=Yc(this.codec);switch(this.inputSampleSize=s,s){case 1:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint8(l)-2**7:i==="signed"?this.readInputValue=(a,l)=>a.getInt8(l):i==="ulaw"?this.readInputValue=(a,l)=>Ate(a.getUint8(l)):i==="alaw"?this.readInputValue=(a,l)=>Ite(a.getUint8(l)):W(!1);break;case 2:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint16(l,o)-2**15:i==="signed"?this.readInputValue=(a,l)=>a.getInt16(l,o):W(!1);break;case 3:i==="unsigned"?this.readInputValue=(a,l)=>uw(a,l,o)-2**23:i==="signed"?this.readInputValue=(a,l)=>Hee(a,l,o):W(!1);break;case 4:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint32(l,o)-2**31:i==="signed"?this.readInputValue=(a,l)=>a.getInt32(l,o):i==="float"?this.readInputValue=(a,l)=>a.getFloat32(l,o):W(!1);break;case 8:i==="float"?this.readInputValue=(a,l)=>a.getFloat64(l,o):W(!1);break;default:zc(s),W(!1)}switch(s){case 1:i==="ulaw"||i==="alaw"?(this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(a,l,c)=>a.setInt16(l,c,!0)):(this.outputSampleSize=1,this.outputFormat="u8",this.writeOutputValue=(a,l,c)=>a.setUint8(l,c+2**7));break;case 2:this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(a,l,c)=>a.setInt16(l,c,!0);break;case 3:this.outputSampleSize=4,this.outputFormat="s32",this.writeOutputValue=(a,l,c)=>a.setInt32(l,c<<8,!0);break;case 4:this.outputSampleSize=4,i==="float"?(this.outputFormat="f32",this.writeOutputValue=(a,l,c)=>a.setFloat32(l,c,!0)):(this.outputFormat="s32",this.writeOutputValue=(a,l,c)=>a.setInt32(l,c,!0));break;case 8:this.outputSampleSize=4,this.outputFormat="f32",this.writeOutputValue=(a,l,c)=>a.setFloat32(l,c,!0);break;default:zc(s),W(!1)}}getDecodeQueueSize(){return 0}decode(e){const n=jn(e.data),r=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,i=r*this.decoderConfig.numberOfChannels*this.outputSampleSize,s=new ArrayBuffer(i),o=new DataView(s);for(let u=0;u<r*this.decoderConfig.numberOfChannels;u++){const d=u*this.inputSampleSize,f=u*this.outputSampleSize,h=this.readInputValue(n,d);this.writeOutputValue(o,f,h)}const a=r/this.decoderConfig.sampleRate;(this.currentTimestamp===null||Math.abs(e.timestamp-this.currentTimestamp)>=a)&&(this.currentTimestamp=e.timestamp);const l=this.currentTimestamp;this.currentTimestamp+=a;const c=new Ds({format:this.outputFormat,data:s,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:r,timestamp:l});this.onSample(c)}async flush(){}close(){}}class KP extends _D{constructor(e){if(!(e instanceof ca))throw new TypeError("audioTrack must be an InputAudioTrack.");super(),this._track=e}async _createDecoder(e,n){if(!await this._track.canDecode())throw new Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._track.codec,i=await this._track.getDecoderConfig();return W(r&&i),Pi.includes(i.codec)?new $te(e,n,i):new Fte(e,n,r,i)}_createPacketSink(){return new sm(this._track)}async getSample(e){Ec(e);for await(const n of this.mediaSamplesAtTimestamps([e]))return n;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,n=1/0){return this.mediaSamplesInRange(e,n)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class aT{constructor(e,n){this.input=e,this._backing=n}isVideoTrack(){return this instanceof ch}isAudioTrack(){return this instanceof ca}get id(){return this._backing.getId()}get internalCodecId(){return this._backing.getInternalCodecId()}get languageCode(){return this._backing.getLanguageCode()}get name(){return this._backing.getName()}get timeResolution(){return this._backing.getTimeResolution()}get disposition(){return this._backing.getDisposition()}getFirstTimestamp(){return this._backing.getFirstTimestamp()}computeDuration(){return this._backing.computeDuration()}async computePacketStats(e=1/0){const n=new sm(this);let r=1/0,i=-1/0,s=0,o=0;for await(const a of n.packets(void 0,void 0,{metadataOnly:!0})){if(s>=e&&a.timestamp>=i)break;r=Math.min(r,a.timestamp),i=Math.max(i,a.timestamp+a.duration),s++,o+=a.byteLength}return{packetCount:s,averagePacketRate:s?Number((s/(i-r)).toPrecision(16)):0,averageBitrate:s?Number((8*o/(i-r)).toPrecision(16)):0}}}class ch extends aT{constructor(e,n){super(e,n),this._backing=n}get type(){return"video"}get codec(){return this._backing.getCodec()}get codedWidth(){return this._backing.getCodedWidth()}get codedHeight(){return this._backing.getCodedHeight()}get rotation(){return this._backing.getRotation()}get displayWidth(){return this._backing.getRotation()%180===0?this._backing.getCodedWidth():this._backing.getCodedHeight()}get displayHeight(){return this._backing.getRotation()%180===0?this._backing.getCodedHeight():this._backing.getCodedWidth()}getColorSpace(){return this._backing.getColorSpace()}async hasHighDynamicRange(){const e=await this._backing.getColorSpace();return e.primaries==="bt2020"||e.primaries==="smpte432"||e.transfer==="pg"||e.transfer==="hlg"||e.matrix==="bt2020-ncl"}canBeTransparent(){return this._backing.canBeTransparent()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const n=this._backing.getCodec();return W(n!==null),SD.some(i=>i.supports(n,e))?!0:typeof VideoDecoder>"u"?!1:(await VideoDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("packet must not be metadata-only to determine its type.");if(this.codec===null)return null;const n=await this.getDecoderConfig();return W(n),rT(this.codec,n,e.data)}}class ca extends aT{constructor(e,n){super(e,n),this._backing=n}get type(){return"audio"}get codec(){return this._backing.getCodec()}get numberOfChannels(){return this._backing.getNumberOfChannels()}get sampleRate(){return this._backing.getSampleRate()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const n=this._backing.getCodec();return W(n!==null),kD.some(r=>r.supports(n,e))||e.codec.startsWith("pcm-")?!0:typeof AudioDecoder>"u"?!1:(await AudioDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");return this.codec===null?null:"key"}}const AD=t=>{let n=(t.hasVideo?"video/":t.hasAudio?"audio/":"application/")+(t.isQuickTime?"quicktime":"mp4");if(t.codecStrings.length>0){const r=[...new Set(t.codecStrings)];n+=`; codecs="${r.join(", ")}"`}return n};const Ua=8,Au=16,Yl=t=>{let e=rt(t);const n=Zr(t,4);let r=8;e===1&&(e=Zs(t),r=16);const s=e-r;return s<0?null:{name:n,totalSize:e,headerSize:r,contentSize:s}},uu=t=>Iu(t)/65536,g1=t=>Iu(t)/1073741824,y1=t=>{let e=0;for(let n=0;n<4;n++){e<<=7;const r=ht(t);if(e|=r&127,(r&128)===0)break}return e},xo=t=>{let e=Fr(t);return t.skip(2),e=Math.min(e,t.remainingLength),Fs.decode(St(t,e))},zte=t=>{const e=Yl(t);if(!e||e.name!=="data"||t.remainingLength<8)return null;const n=rt(t);t.skip(4);const r=St(t,e.contentSize-8);switch(n){case 1:return Fs.decode(r);case 2:return new TextDecoder("utf-16be").decode(r);case 13:return new pf(r,"image/jpeg");case 14:return new pf(r,"image/png");case 27:return new pf(r,"image/bmp");default:return r}};class Ute extends Jc{constructor(e){super(e),this.moovSlice=null,this.currentTrack=null,this.tracks=[],this.metadataPromise=null,this.movieTimescale=-1,this.movieDurationInTimescale=-1,this.isQuickTime=!1,this.metadataTags={},this.currentMetadataKeys=null,this.isFragmented=!1,this.fragmentTrackDefaults=[],this.currentFragment=null,this.lastReadFragment=null,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getTracks(){return await this.readMetadata(),this.tracks.map(e=>e.inputTrack)}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(n=>n.inputTrack.getCodecParameterString()));return AD({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some(n=>n.info?.type==="video"),hasAudio:this.tracks.some(n=>n.info?.type==="audio"),codecStrings:e.filter(Boolean)})}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,Ua,Au);if(n instanceof Promise&&(n=await n),!n)break;const r=e,i=Yl(n);if(!i)break;if(i.name==="ftyp"){const s=Zr(n,4);this.isQuickTime=s==="qt  "}else if(i.name==="moov"){let s=this.reader.requestSlice(n.filePos,i.contentSize);if(s instanceof Promise&&(s=await s),!s)break;this.moovSlice=s,this.readContiguousBoxes(this.moovSlice),this.tracks.sort((o,a)=>Number(a.disposition.default)-Number(o.disposition.default));for(const o of this.tracks){const a=o.editListPreviousSegmentDurations/this.movieTimescale;o.editListOffset-=Math.round(a*o.timescale)}break}e=r+i.totalSize}if(this.isFragmented&&this.reader.fileSize!==null){let n=this.reader.requestSlice(this.reader.fileSize-4,4);n instanceof Promise&&(n=await n),W(n);const r=rt(n),i=this.reader.fileSize-r;if(i>=0&&i<=this.reader.fileSize-Au){let s=this.reader.requestSliceRange(i,Ua,Au);if(s instanceof Promise&&(s=await s),s){const o=Yl(s);if(o&&o.name==="mfra"){let a=this.reader.requestSlice(s.filePos,o.contentSize);a instanceof Promise&&(a=await a),a&&this.readContiguousBoxes(a)}}}}})()}getSampleTableForTrack(e){if(e.sampleTable)return e.sampleTable;const n={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};e.sampleTable=n,W(this.moovSlice);const r=this.moovSlice.slice(e.sampleTableByteOffset);if(this.currentTrack=e,this.traverseBox(r),this.currentTrack=null,e.info?.type==="audio"&&e.info.codec&&Pi.includes(e.info.codec)&&n.sampleCompositionTimeOffsets.length===0){W(e.info?.type==="audio");const s=Yc(e.info.codec),o=[],a=[];for(let l=0;l<n.sampleToChunk.length;l++){const c=n.sampleToChunk[l],u=n.sampleToChunk[l+1],d=(u?u.startChunkIndex:n.chunkOffsets.length)-c.startChunkIndex;for(let f=0;f<d;f++){const h=c.startSampleIndex+f*c.samplesPerChunk,p=h+c.samplesPerChunk,m=un(n.sampleTimingEntries,h,k=>k.startIndex),g=n.sampleTimingEntries[m],y=un(n.sampleTimingEntries,p,k=>k.startIndex),b=n.sampleTimingEntries[y],x=g.startDecodeTimestamp+(h-g.startIndex)*g.delta,P=b.startDecodeTimestamp+(p-b.startIndex)*b.delta-x,S=Wn(o);S&&S.delta===P?S.count++:o.push({startIndex:c.startChunkIndex+f,startDecodeTimestamp:x,count:1,delta:P});const _=c.samplesPerChunk*s.sampleSize*e.info.numberOfChannels;a.push(_)}c.startSampleIndex=c.startChunkIndex,c.samplesPerChunk=1}n.sampleTimingEntries=o,n.sampleSizes=a}if(n.sampleCompositionTimeOffsets.length>0){n.presentationTimestamps=[];for(const s of n.sampleTimingEntries)for(let o=0;o<s.count;o++)n.presentationTimestamps.push({presentationTimestamp:s.startDecodeTimestamp+o*s.delta,sampleIndex:s.startIndex+o});for(const s of n.sampleCompositionTimeOffsets)for(let o=0;o<s.count;o++){const a=s.startIndex+o,l=n.presentationTimestamps[a];l&&(l.presentationTimestamp+=s.offset)}n.presentationTimestamps.sort((s,o)=>s.presentationTimestamp-o.presentationTimestamp),n.presentationTimestampIndexMap=Array(n.presentationTimestamps.length).fill(-1);for(let s=0;s<n.presentationTimestamps.length;s++)n.presentationTimestampIndexMap[n.presentationTimestamps[s].sampleIndex]=s}return n}async readFragment(e){if(this.lastReadFragment?.moofOffset===e)return this.lastReadFragment;let n=this.reader.requestSliceRange(e,Ua,Au);n instanceof Promise&&(n=await n),W(n);const r=Yl(n);W(r?.name==="moof");let i=this.reader.requestSlice(e,r.totalSize);i instanceof Promise&&(i=await i),W(i),this.traverseBox(i);const s=this.lastReadFragment;W(s&&s.moofOffset===e);for(const[,o]of s.trackData){const a=o.track,{fragmentPositionCache:l}=a;if(!o.startTimestampIsFinal){const u=a.fragmentLookupTable.find(d=>d.moofOffset===s.moofOffset);if(u)b1(o,u.timestamp);else{const d=un(l,s.moofOffset-1,f=>f.moofOffset);if(d!==-1){const f=l[d];b1(o,f.endTimestamp)}}o.startTimestampIsFinal=!0}const c=un(l,o.startTimestamp,u=>u.startTimestamp);(c===-1||l[c].moofOffset!==s.moofOffset)&&l.splice(c+1,0,{moofOffset:s.moofOffset,startTimestamp:o.startTimestamp,endTimestamp:o.endTimestamp})}return s}readContiguousBoxes(e){const n=e.filePos;for(;e.filePos-n<=e.length-Ua&&this.traverseBox(e););}*iterateContiguousBoxes(e){const n=e.filePos;for(;e.filePos-n<=e.length-Ua;){const r=e.filePos,i=Yl(e);if(!i)break;yield{boxInfo:i,slice:e},e.filePos=r+i.totalSize}}traverseBox(e){const n=e.filePos,r=Yl(e);if(!r)return!1;const i=e.filePos,s=n+r.totalSize;switch(r.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"mvhd":{const o=ht(e);e.skip(3),o===1?(e.skip(16),this.movieTimescale=rt(e),this.movieDurationInTimescale=Zs(e)):(e.skip(8),this.movieTimescale=rt(e),this.movieDurationInTimescale=rt(e))}break;case"trak":{const o={id:-1,demuxer:this,inputTrack:null,disposition:{...Qc},info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,internalCodecId:null,name:null,languageCode:cs,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:[],currentFragmentState:null,fragmentPositionCache:[],editListPreviousSegmentDurations:0,editListOffset:0};if(this.currentTrack=o,this.readContiguousBoxes(e.slice(i,r.contentSize)),o.id!==-1&&o.timescale!==-1&&o.info!==null){if(o.info.type==="video"&&o.info.width!==-1){const a=o;o.inputTrack=new ch(this.input,new Hte(a)),this.tracks.push(o)}else if(o.info.type==="audio"&&o.info.numberOfChannels!==-1){const a=o;o.inputTrack=new ca(this.input,new Vte(a)),this.tracks.push(o)}}this.currentTrack=null}break;case"tkhd":{const o=this.currentTrack;if(!o)break;const a=ht(e),c=!!(Wd(e)&1);if(o.disposition.default=c,a===0)e.skip(8),o.id=rt(e),e.skip(4),o.durationInMovieTimescale=rt(e);else if(a===1)e.skip(16),o.id=rt(e),e.skip(4),o.durationInMovieTimescale=Zs(e);else throw new Error(`Incorrect track header version ${a}.`);e.skip(16);const u=[uu(e),uu(e),g1(e),uu(e),uu(e),g1(e),uu(e),uu(e),g1(e)],d=KE(sD(Kte(u),90));W(d===0||d===90||d===180||d===270),o.rotation=d}break;case"elst":{const o=this.currentTrack;if(!o)break;const a=ht(e);e.skip(3);let l=!1,c=0;const u=rt(e);for(let d=0;d<u;d++){const f=a===1?Zs(e):rt(e),h=a===1?rre(e):Iu(e),p=uu(e);if(f!==0){if(l){console.warn("Unsupported edit list: multiple edits are not currently supported. Only using first edit.");break}if(h===-1){c+=f;continue}if(p!==1){console.warn("Unsupported edit list entry: media rate must be 1.");break}o.editListPreviousSegmentDurations=c,o.editListOffset=h,l=!0}}}break;case"mdhd":{const o=this.currentTrack;if(!o)break;const a=ht(e);e.skip(3),a===0?(e.skip(8),o.timescale=rt(e),o.durationInMediaTimescale=rt(e)):a===1&&(e.skip(16),o.timescale=rt(e),o.durationInMediaTimescale=Zs(e));let l=Fr(e);if(l>0){o.languageCode="";for(let c=0;c<3;c++)o.languageCode=String.fromCharCode(96+(l&31))+o.languageCode,l>>=5;nm(o.languageCode)||(o.languageCode=cs)}}break;case"hdlr":{const o=this.currentTrack;if(!o)break;e.skip(8);const a=Zr(e,4);a==="vide"?o.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcType:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:a==="soun"&&(o.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case"stbl":{const o=this.currentTrack;if(!o)break;o.sampleTableByteOffset=n,this.readContiguousBoxes(e.slice(i,r.contentSize))}break;case"stsd":{const o=this.currentTrack;if(!o||o.info===null||o.sampleTable)break;const a=ht(e);e.skip(3);const l=rt(e);for(let c=0;c<l;c++){const u=e.filePos,d=Yl(e);if(!d)break;o.internalCodecId=d.name;const f=d.name.toLowerCase();if(o.info.type==="video")f==="avc1"||f==="avc3"?(o.info.codec="avc",o.info.avcType=f==="avc1"?1:3):f==="hvc1"||f==="hev1"?o.info.codec="hevc":f==="vp08"?o.info.codec="vp8":f==="vp09"?o.info.codec="vp9":f==="av01"?o.info.codec="av1":console.warn(`Unsupported video codec (sample entry type '${d.name}').`),e.skip(24),o.info.width=Fr(e),o.info.height=Fr(e),e.skip(50),this.readContiguousBoxes(e.slice(e.filePos,u+d.totalSize-e.filePos));else{f==="mp4a"||(f==="opus"?o.info.codec="opus":f==="flac"?o.info.codec="flac":f==="twos"||f==="sowt"||f==="raw "||f==="in24"||f==="in32"||f==="fl32"||f==="fl64"||f==="lpcm"||f==="ipcm"||f==="fpcm"||(f==="ulaw"?o.info.codec="ulaw":f==="alaw"?o.info.codec="alaw":console.warn(`Unsupported audio codec (sample entry type '${d.name}').`))),e.skip(8);const h=Fr(e);e.skip(6);let p=Fr(e),m=Fr(e);e.skip(4);let g=rt(e)/65536;if(a===0&&h>0){if(h===1)e.skip(4),m=8*rt(e),e.skip(8);else if(h===2){e.skip(4),g=HD(e),p=rt(e),e.skip(4),m=rt(e);const y=rt(e);if(e.skip(8),f==="lpcm"){const b=m+7>>3,x=!!(y&1),C=!!(y&2),P=y&4?-1:0;m>0&&m<=64&&(x?m===32&&(o.info.codec=C?"pcm-f32be":"pcm-f32"):P&1<<b-1?b===1?o.info.codec="pcm-s8":b===2?o.info.codec=C?"pcm-s16be":"pcm-s16":b===3?o.info.codec=C?"pcm-s24be":"pcm-s24":b===4&&(o.info.codec=C?"pcm-s32be":"pcm-s32"):b===1&&(o.info.codec="pcm-u8")),o.info.codec===null&&console.warn("Unsupported PCM format.")}}}o.info.codec==="opus"&&(g=fw),o.info.numberOfChannels=p,o.info.sampleRate=g,f==="twos"?m===8?o.info.codec="pcm-s8":m===16?o.info.codec="pcm-s16be":(console.warn(`Unsupported sample size ${m} for codec 'twos'.`),o.info.codec=null):f==="sowt"?m===8?o.info.codec="pcm-s8":m===16?o.info.codec="pcm-s16":(console.warn(`Unsupported sample size ${m} for codec 'sowt'.`),o.info.codec=null):f==="raw "?o.info.codec="pcm-u8":f==="in24"?o.info.codec="pcm-s24be":f==="in32"?o.info.codec="pcm-s32be":f==="fl32"?o.info.codec="pcm-f32be":f==="fl64"?o.info.codec="pcm-f64be":f==="ipcm"?o.info.codec="pcm-s16be":f==="fpcm"&&(o.info.codec="pcm-f32be"),this.readContiguousBoxes(e.slice(e.filePos,u+d.totalSize-e.filePos))}}}break;case"avcC":{const o=this.currentTrack;if(!o)break;W(o.info),o.info.codecDescription=St(e,r.contentSize)}break;case"hvcC":{const o=this.currentTrack;if(!o)break;W(o.info),o.info.codecDescription=St(e,r.contentSize)}break;case"vpcC":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="video"),e.skip(4);const a=ht(e),l=ht(e),c=ht(e),u=c>>4,d=c>>1&7,f=c&1,h=ht(e),p=ht(e),m=ht(e);o.info.vp9CodecInfo={profile:a,level:l,bitDepth:u,chromaSubsampling:d,videoFullRangeFlag:f,colourPrimaries:h,transferCharacteristics:p,matrixCoefficients:m}}break;case"av1C":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="video"),e.skip(1);const a=ht(e),l=a>>5,c=a&31,u=ht(e),d=u>>7,f=u>>6&1,h=u>>5&1,p=u>>4&1,m=u>>3&1,g=u>>2&1,y=u&3,b=l===2&&f?h?12:10:f?10:8;o.info.av1CodecInfo={profile:l,level:c,tier:d,bitDepth:b,monochrome:p,chromaSubsamplingX:m,chromaSubsamplingY:g,chromaSamplePosition:y}}break;case"colr":{const o=this.currentTrack;if(!o||(W(o.info?.type==="video"),Zr(e,4)!=="nclx"))break;const l=Fr(e),c=Fr(e),u=Fr(e),d=!!(ht(e)&128);o.info.colorSpace={primaries:uy[l],transfer:dy[c],matrix:fy[u],fullRange:d}}break;case"wave":this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"esds":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),e.skip(4);const a=ht(e);W(a===3),y1(e),e.skip(2);const l=ht(e),c=(l&128)!==0,u=(l&64)!==0,d=(l&32)!==0;if(c&&e.skip(2),u){const g=ht(e);e.skip(g)}d&&e.skip(2);const f=ht(e);W(f===4);const h=y1(e),p=e.filePos,m=ht(e);if(m===64||m===103?(o.info.codec="aac",o.info.aacCodecInfo={isMpeg2:m===103,objectType:null}):m===105||m===107?o.info.codec="mp3":m===221?o.info.codec="vorbis":console.warn(`Unsupported audio codec (objectTypeIndication ${m}) - discarding track.`),e.skip(12),h>e.filePos-p){const g=ht(e);W(g===5);const y=y1(e);if(o.info.codecDescription=St(e,y),o.info.codec==="aac"){const b=JE(o.info.codecDescription);b.numberOfChannels!==null&&(o.info.numberOfChannels=b.numberOfChannels),b.sampleRate!==null&&(o.info.sampleRate=b.sampleRate)}}}break;case"enda":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),Fr(e)&255&&(o.info.codec==="pcm-s16be"?o.info.codec="pcm-s16":o.info.codec==="pcm-s24be"?o.info.codec="pcm-s24":o.info.codec==="pcm-s32be"?o.info.codec="pcm-s32":o.info.codec==="pcm-f32be"?o.info.codec="pcm-f32":o.info.codec==="pcm-f64be"&&(o.info.codec="pcm-f64"))}break;case"pcmC":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),e.skip(4);const l=!!(ht(e)&1),c=ht(e);o.info.codec==="pcm-s16be"?l?c===16?o.info.codec="pcm-s16":c===24?o.info.codec="pcm-s24":c===32?o.info.codec="pcm-s32":(console.warn(`Invalid ipcm sample size ${c}.`),o.info.codec=null):c===16?o.info.codec="pcm-s16be":c===24?o.info.codec="pcm-s24be":c===32?o.info.codec="pcm-s32be":(console.warn(`Invalid ipcm sample size ${c}.`),o.info.codec=null):o.info.codec==="pcm-f32be"&&(l?c===32?o.info.codec="pcm-f32":c===64?o.info.codec="pcm-f64":(console.warn(`Invalid fpcm sample size ${c}.`),o.info.codec=null):c===32?o.info.codec="pcm-f32be":c===64?o.info.codec="pcm-f64be":(console.warn(`Invalid fpcm sample size ${c}.`),o.info.codec=null));break}case"dOps":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),e.skip(1);const a=ht(e),l=Fr(e),c=rt(e),u=Xx(e),d=ht(e);let f;d!==0?f=St(e,2+a):f=new Uint8Array(0);const h=new Uint8Array(19+f.byteLength),p=new DataView(h.buffer);p.setUint32(0,1332770163,!1),p.setUint32(4,1214603620,!1),p.setUint8(8,1),p.setUint8(9,a),p.setUint16(10,l,!0),p.setUint32(12,c,!0),p.setInt16(16,u,!0),p.setUint8(18,d),h.set(f,19),o.info.codecDescription=h,o.info.numberOfChannels=a}break;case"dfLa":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),e.skip(4);const a=127,l=128,c=e.filePos;for(;e.filePos<s;){const p=ht(e),m=Wd(e);if((p&a)===mf.STREAMINFO){e.skip(10);const y=rt(e),b=y>>>12,x=(y>>9&7)+1;o.info.sampleRate=b,o.info.numberOfChannels=x,e.skip(20)}else e.skip(m);if(p&l)break}const u=e.filePos;e.filePos=c;const d=St(e,u-c),f=new Uint8Array(4+d.byteLength);new DataView(f.buffer).setUint32(0,1716281667,!1),f.set(d,4),o.info.codecDescription=f}break;case"stts":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=rt(e);let l=0,c=0;for(let u=0;u<a;u++){const d=rt(e),f=rt(e);o.sampleTable.sampleTimingEntries.push({startIndex:l,startDecodeTimestamp:c,count:d,delta:f}),l+=d,c+=d*f}}break;case"ctts":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=rt(e);let l=0;for(let c=0;c<a;c++){const u=rt(e),d=Iu(e);o.sampleTable.sampleCompositionTimeOffsets.push({startIndex:l,count:u,offset:d}),l+=u}}break;case"stsz":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=rt(e),l=rt(e);if(a===0)for(let c=0;c<l;c++){const u=rt(e);o.sampleTable.sampleSizes.push(u)}else o.sampleTable.sampleSizes.push(a)}break;case"stz2":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4),e.skip(3);const a=ht(e),l=rt(e),c=St(e,Math.ceil(l*a/8)),u=new Ln(c);for(let d=0;d<l;d++){const f=u.readBits(a);o.sampleTable.sampleSizes.push(f)}}break;case"stss":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4),o.sampleTable.keySampleIndices=[];const a=rt(e);for(let l=0;l<a;l++){const c=rt(e)-1;o.sampleTable.keySampleIndices.push(c)}o.sampleTable.keySampleIndices[0]!==0&&o.sampleTable.keySampleIndices.unshift(0)}break;case"stsc":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=rt(e);for(let c=0;c<a;c++){const u=rt(e)-1,d=rt(e),f=rt(e);o.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:u,samplesPerChunk:d,sampleDescriptionIndex:f})}let l=0;for(let c=0;c<o.sampleTable.sampleToChunk.length;c++)if(o.sampleTable.sampleToChunk[c].startSampleIndex=l,c<o.sampleTable.sampleToChunk.length-1){const d=o.sampleTable.sampleToChunk[c+1].startChunkIndex-o.sampleTable.sampleToChunk[c].startChunkIndex;l+=d*o.sampleTable.sampleToChunk[c].samplesPerChunk}}break;case"stco":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=rt(e);for(let l=0;l<a;l++){const c=rt(e);o.sampleTable.chunkOffsets.push(c)}}break;case"co64":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=rt(e);for(let l=0;l<a;l++){const c=Zs(e);o.sampleTable.chunkOffsets.push(c)}}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"mehd":{const o=ht(e);e.skip(3);const a=o===1?Zs(e):rt(e);this.movieDurationInTimescale=a}break;case"trex":{e.skip(4);const o=rt(e),a=rt(e),l=rt(e),c=rt(e),u=rt(e);this.fragmentTrackDefaults.push({trackId:o,defaultSampleDescriptionIndex:a,defaultSampleDuration:l,defaultSampleSize:c,defaultSampleFlags:u})}break;case"tfra":{const o=ht(e);e.skip(3);const a=rt(e),l=this.tracks.find(b=>b.id===a);if(!l)break;const c=rt(e),u=(c&48)>>4,d=(c&12)>>2,f=c&3,h=[ht,Fr,Wd,rt],p=h[u],m=h[d],g=h[f],y=rt(e);for(let b=0;b<y;b++){const x=o===1?Zs(e):rt(e),C=o===1?Zs(e):rt(e);p(e),m(e),g(e),l.fragmentLookupTable.push({timestamp:x,moofOffset:C})}l.fragmentLookupTable.sort((b,x)=>b.timestamp-x.timestamp);for(let b=0;b<l.fragmentLookupTable.length-1;b++){const x=l.fragmentLookupTable[b],C=l.fragmentLookupTable[b+1];x.timestamp===C.timestamp&&(l.fragmentLookupTable.splice(b+1,1),b--)}}break;case"moof":this.currentFragment={moofOffset:n,moofSize:r.totalSize,implicitBaseDataOffset:n,trackData:new Map},this.readContiguousBoxes(e.slice(i,r.contentSize)),this.lastReadFragment=this.currentFragment,this.currentFragment=null;break;case"traf":if(W(this.currentFragment),this.readContiguousBoxes(e.slice(i,r.contentSize)),this.currentTrack){const o=this.currentFragment.trackData.get(this.currentTrack.id);if(o){const{currentFragmentState:a}=this.currentTrack;W(a),a.startTimestamp!==null&&(b1(o,a.startTimestamp),o.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":{W(this.currentFragment),e.skip(1);const o=Wd(e),a=!!(o&1),l=!!(o&2),c=!!(o&8),u=!!(o&16),d=!!(o&32),f=!!(o&65536),h=!!(o&131072),p=rt(e),m=this.tracks.find(y=>y.id===p);if(!m)break;const g=this.fragmentTrackDefaults.find(y=>y.trackId===p);this.currentTrack=m,m.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:g?.defaultSampleDescriptionIndex??null,defaultSampleDuration:g?.defaultSampleDuration??null,defaultSampleSize:g?.defaultSampleSize??null,defaultSampleFlags:g?.defaultSampleFlags??null,startTimestamp:null},a?m.currentFragmentState.baseDataOffset=Zs(e):h&&(m.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),l&&(m.currentFragmentState.sampleDescriptionIndex=rt(e)),c&&(m.currentFragmentState.defaultSampleDuration=rt(e)),u&&(m.currentFragmentState.defaultSampleSize=rt(e)),d&&(m.currentFragmentState.defaultSampleFlags=rt(e)),f&&(m.currentFragmentState.defaultSampleDuration=0)}break;case"tfdt":{const o=this.currentTrack;if(!o)break;W(o.currentFragmentState);const a=ht(e);e.skip(3);const l=a===0?rt(e):Zs(e);o.currentFragmentState.startTimestamp=l}break;case"trun":{const o=this.currentTrack;if(!o)break;if(W(this.currentFragment),W(o.currentFragmentState),this.currentFragment.trackData.has(o.id)){console.warn("Can't have two trun boxes for the same track in one fragment. Ignoring...");break}const a=ht(e),l=Wd(e),c=!!(l&1),u=!!(l&4),d=!!(l&256),f=!!(l&512),h=!!(l&1024),p=!!(l&2048),m=rt(e);let g=o.currentFragmentState.baseDataOffset;c&&(g+=Iu(e));let y=null;u&&(y=rt(e));let b=g;if(m===0){this.currentFragment.implicitBaseDataOffset=b;break}let x=0;const C={track:o,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(o.id,C);for(let _=0;_<m;_++){let k;d?k=rt(e):(W(o.currentFragmentState.defaultSampleDuration!==null),k=o.currentFragmentState.defaultSampleDuration);let T;f?T=rt(e):(W(o.currentFragmentState.defaultSampleSize!==null),T=o.currentFragmentState.defaultSampleSize);let O;h?O=rt(e):(W(o.currentFragmentState.defaultSampleFlags!==null),O=o.currentFragmentState.defaultSampleFlags),_===0&&y!==null&&(O=y);let M=0;p&&(a===0?M=rt(e):M=Iu(e));const L=!(O&65536);C.samples.push({presentationTimestamp:x+M,duration:k,byteOffset:b,byteSize:T,isKeyFrame:L}),b+=T,x+=k}C.presentationTimestamps=C.samples.map((_,k)=>({presentationTimestamp:_.presentationTimestamp,sampleIndex:k})).sort((_,k)=>_.presentationTimestamp-k.presentationTimestamp);for(let _=0;_<C.presentationTimestamps.length;_++){const k=C.presentationTimestamps[_],T=C.samples[k.sampleIndex];if(C.firstKeyFrameTimestamp===null&&T.isKeyFrame&&(C.firstKeyFrameTimestamp=T.presentationTimestamp),_<C.presentationTimestamps.length-1){const O=C.presentationTimestamps[_+1];T.duration=O.presentationTimestamp-k.presentationTimestamp}}const P=C.samples[C.presentationTimestamps[0].sampleIndex],S=C.samples[Wn(C.presentationTimestamps).sampleIndex];C.startTimestamp=P.presentationTimestamp,C.endTimestamp=S.presentationTimestamp+S.duration,this.currentFragment.implicitBaseDataOffset=b}break;case"udta":{const o=this.iterateContiguousBoxes(e.slice(i,r.contentSize));for(const{boxInfo:a,slice:l}of o){if(a.name!=="meta"&&!this.currentTrack){const c=l.filePos;this.metadataTags.raw??={},a.name[0]==="Â©"?this.metadataTags.raw[a.name]??=xo(l):this.metadataTags.raw[a.name]??=St(l,a.contentSize),l.filePos=c}switch(a.name){case"meta":l.skip(-a.headerSize),this.traverseBox(l);break;case"Â©nam":case"name":this.currentTrack?this.currentTrack.name=Fs.decode(St(l,a.contentSize)):this.metadataTags.title??=xo(l);break;case"Â©des":this.currentTrack||(this.metadataTags.description??=xo(l));break;case"Â©ART":this.currentTrack||(this.metadataTags.artist??=xo(l));break;case"Â©alb":this.currentTrack||(this.metadataTags.album??=xo(l));break;case"albr":this.currentTrack||(this.metadataTags.albumArtist??=xo(l));break;case"Â©gen":this.currentTrack||(this.metadataTags.genre??=xo(l));break;case"Â©day":if(!this.currentTrack){const c=new Date(xo(l));Number.isNaN(c.getTime())||(this.metadataTags.date??=c)}break;case"Â©cmt":this.currentTrack||(this.metadataTags.comment??=xo(l));break;case"Â©lyr":this.currentTrack||(this.metadataTags.lyrics??=xo(l));break}}}break;case"meta":{if(this.currentTrack)break;const a=rt(e)!==0;this.currentMetadataKeys=new Map,a?this.readContiguousBoxes(e.slice(i,r.contentSize)):this.readContiguousBoxes(e.slice(i+4,r.contentSize-4)),this.currentMetadataKeys=null}break;case"keys":{if(!this.currentMetadataKeys)break;e.skip(4);const o=rt(e);for(let a=0;a<o;a++){const l=rt(e);e.skip(4);const c=Fs.decode(St(e,l-8));this.currentMetadataKeys.set(a+1,c)}}break;case"ilst":{if(!this.currentMetadataKeys)break;const o=this.iterateContiguousBoxes(e.slice(i,r.contentSize));for(const{boxInfo:a,slice:l}of o){let c=a.name;const u=(c.charCodeAt(0)<<24)+(c.charCodeAt(1)<<16)+(c.charCodeAt(2)<<8)+c.charCodeAt(3);this.currentMetadataKeys.has(u)&&(c=this.currentMetadataKeys.get(u));const d=zte(l);switch(this.metadataTags.raw??={},this.metadataTags.raw[c]??=d,c){case"Â©nam":case"titl":case"com.apple.quicktime.title":case"title":typeof d=="string"&&(this.metadataTags.title??=d);break;case"Â©des":case"desc":case"dscp":case"com.apple.quicktime.description":case"description":typeof d=="string"&&(this.metadataTags.description??=d);break;case"Â©ART":case"com.apple.quicktime.artist":case"artist":typeof d=="string"&&(this.metadataTags.artist??=d);break;case"Â©alb":case"albm":case"com.apple.quicktime.album":case"album":typeof d=="string"&&(this.metadataTags.album??=d);break;case"aART":case"album_artist":typeof d=="string"&&(this.metadataTags.albumArtist??=d);break;case"Â©cmt":case"com.apple.quicktime.comment":case"comment":typeof d=="string"&&(this.metadataTags.comment??=d);break;case"Â©gen":case"gnre":case"com.apple.quicktime.genre":case"genre":typeof d=="string"&&(this.metadataTags.genre??=d);break;case"Â©lyr":case"lyrics":typeof d=="string"&&(this.metadataTags.lyrics??=d);break;case"Â©day":case"rldt":case"com.apple.quicktime.creationdate":case"date":if(typeof d=="string"){const f=new Date(d);Number.isNaN(f.getTime())||(this.metadataTags.date??=f)}break;case"covr":case"com.apple.quicktime.artwork":d instanceof pf?(this.metadataTags.images??=[],this.metadataTags.images.push({data:d.data,kind:"coverFront",mimeType:d.mimeType})):d instanceof Uint8Array&&(this.metadataTags.images??=[],this.metadataTags.images.push({data:d,kind:"coverFront",mimeType:"image/*"}));break;case"track":if(typeof d=="string"){const f=d.split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(this.metadataTags.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(this.metadataTags.tracksTotal??=p)}break;case"trkn":if(d instanceof Uint8Array&&d.length>=6){const f=jn(d),h=f.getUint16(2,!1),p=f.getUint16(4,!1);h>0&&(this.metadataTags.trackNumber??=h),p>0&&(this.metadataTags.tracksTotal??=p)}break;case"disc":case"disk":if(d instanceof Uint8Array&&d.length>=6){const f=jn(d),h=f.getUint16(2,!1),p=f.getUint16(4,!1);h>0&&(this.metadataTags.discNumber??=h),p>0&&(this.metadataTags.discsTotal??=p)}break}}}break}return e.filePos=s,!0}}class PD{constructor(e){this.internalTrack=e,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.internalCodecId}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}getTimeResolution(){return this.internalTrack.timescale}getDisposition(){return this.internalTrack.disposition}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}async getFirstPacket(e){const n=await this.fetchPacketForSampleIndex(0,e);return n||!this.internalTrack.demuxer.isFragmented?n:this.performFragmentedLookup(null,r=>r.trackData.get(this.internalTrack.id)?{sampleIndex:0,correctSampleFound:!0}:{sampleIndex:-1,correctSampleFound:!1},-1/0,1/0,e)}mapTimestampIntoTimescale(e){return tm(e*this.internalTrack.timescale)+this.internalTrack.editListOffset}async getPacket(e,n){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=Wx(i,r),o=await this.fetchPacketForSampleIndex(s,n);return!GP(i)||!this.internalTrack.demuxer.isFragmented?o:this.performFragmentedLookup(null,a=>{const l=a.trackData.get(this.internalTrack.id);if(!l)return{sampleIndex:-1,correctSampleFound:!1};const c=un(l.presentationTimestamps,r,f=>f.presentationTimestamp),u=c!==-1?l.presentationTimestamps[c].sampleIndex:-1,d=c!==-1&&r<l.endTimestamp;return{sampleIndex:u,correctSampleFound:d}},r,r,n)}async getNextPacket(e,n){const r=this.packetToSampleIndex.get(e);if(r!==void 0)return this.fetchPacketForSampleIndex(r+1,n);const i=this.packetToFragmentLocation.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(i.fragment,s=>{if(s===i.fragment){const o=s.trackData.get(this.internalTrack.id);if(i.sampleIndex+1<o.samples.length)return{sampleIndex:i.sampleIndex+1,correctSampleFound:!0}}else if(s.trackData.get(this.internalTrack.id))return{sampleIndex:0,correctSampleFound:!0};return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,n)}async getKeyPacket(e,n){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=Wte(i,r),o=await this.fetchPacketForSampleIndex(s,n);return!GP(i)||!this.internalTrack.demuxer.isFragmented?o:this.performFragmentedLookup(null,a=>{const l=a.trackData.get(this.internalTrack.id);if(!l)return{sampleIndex:-1,correctSampleFound:!1};const c=ZE(l.presentationTimestamps,f=>l.samples[f.sampleIndex].isKeyFrame&&f.presentationTimestamp<=r),u=c!==-1?l.presentationTimestamps[c].sampleIndex:-1,d=c!==-1&&r<l.endTimestamp;return{sampleIndex:u,correctSampleFound:d}},r,r,n)}async getNextKeyPacket(e,n){const r=this.packetToSampleIndex.get(e);if(r!==void 0){const s=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),o=qte(s,r);return this.fetchPacketForSampleIndex(o,n)}const i=this.packetToFragmentLocation.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(i.fragment,s=>{if(s===i.fragment){const a=s.trackData.get(this.internalTrack.id).samples.findIndex((l,c)=>l.isKeyFrame&&c>i.sampleIndex);if(a!==-1)return{sampleIndex:a,correctSampleFound:!0}}else{const o=s.trackData.get(this.internalTrack.id);if(o&&o.firstKeyFrameTimestamp!==null){const a=o.samples.findIndex(l=>l.isKeyFrame);return W(a!==-1),{sampleIndex:a,correctSampleFound:!0}}}return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,n)}async fetchPacketForSampleIndex(e,n){if(e===-1)return null;const r=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),i=jte(r,e);if(!i)return null;let s;if(n.metadataOnly)s=gs;else{let c=this.internalTrack.demuxer.reader.requestSlice(i.sampleOffset,i.sampleSize);c instanceof Promise&&(c=await c),W(c),s=St(c,i.sampleSize)}const o=(i.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,a=i.duration/this.internalTrack.timescale,l=new Mn(s,i.isKeyFrame?"key":"delta",o,a,e,i.sampleSize);return this.packetToSampleIndex.set(l,e),l}async fetchPacketInFragment(e,n,r){if(n===-1)return null;const s=e.trackData.get(this.internalTrack.id).samples[n];W(s);let o;if(r.metadataOnly)o=gs;else{let u=this.internalTrack.demuxer.reader.requestSlice(s.byteOffset,s.byteSize);u instanceof Promise&&(u=await u),W(u),o=St(u,s.byteSize)}const a=(s.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,l=s.duration/this.internalTrack.timescale,c=new Mn(o,s.isKeyFrame?"key":"delta",a,l,e.moofOffset+n,s.byteSize);return this.packetToFragmentLocation.set(c,{fragment:e,sampleIndex:n}),c}async performFragmentedLookup(e,n,r,i,s){const o=this.internalTrack.demuxer;let a=null,l=null,c=-1;if(e){const{sampleIndex:g,correctSampleFound:y}=n(e);if(y)return this.fetchPacketInFragment(e,g,s);g!==-1&&(l=e,c=g)}const u=un(this.internalTrack.fragmentLookupTable,r,g=>g.timestamp),d=u!==-1?this.internalTrack.fragmentLookupTable[u]:null,f=un(this.internalTrack.fragmentPositionCache,r,g=>g.startTimestamp),h=f!==-1?this.internalTrack.fragmentPositionCache[f]:null,p=Math.max(d?.moofOffset??0,h?.moofOffset??0)||null;let m;for(e?p===null||e.moofOffset>=p?(m=e.moofOffset+e.moofSize,a=e):m=p:m=p??0;;){if(a){const x=a.trackData.get(this.internalTrack.id);if(x&&x.startTimestamp>i)break}let g=o.reader.requestSliceRange(m,Ua,Au);if(g instanceof Promise&&(g=await g),!g)break;const y=m,b=Yl(g);if(!b)break;if(b.name==="moof"){a=await o.readFragment(y);const{sampleIndex:x,correctSampleFound:C}=n(a);if(C)return this.fetchPacketInFragment(a,x,s);x!==-1&&(l=a,c=x)}m=y+b.totalSize}if(d&&(!l||l.moofOffset<d.moofOffset)){const g=this.internalTrack.fragmentLookupTable[u-1];W(!g||g.timestamp<d.timestamp);const y=g?.timestamp??-1/0;return this.performFragmentedLookup(null,n,y,i,s)}return l?this.fetchPacketInFragment(l,c,s):null}}class Hte extends PD{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return!1}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{if(this.internalTrack.info.codec==="vp9"&&!this.internalTrack.info.vp9CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.vp9CodecInfo=e&&bD(e.data)}else if(this.internalTrack.info.codec==="av1"&&!this.internalTrack.info.av1CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.av1CodecInfo=e&&vD(e.data)}return{codec:QE(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class Vte extends PD{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:YE(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const Wx=(t,e)=>{if(t.presentationTimestamps){const n=un(t.presentationTimestamps,e,r=>r.presentationTimestamp);return n===-1?-1:t.presentationTimestamps[n].sampleIndex}else{const n=un(t.sampleTimingEntries,e,i=>i.startDecodeTimestamp);if(n===-1)return-1;const r=t.sampleTimingEntries[n];return r.startIndex+Math.min(Math.floor((e-r.startDecodeTimestamp)/r.delta),r.count-1)}},Wte=(t,e)=>{if(!t.keySampleIndices)return Wx(t,e);if(t.presentationTimestamps){const n=un(t.presentationTimestamps,e,r=>r.presentationTimestamp);if(n===-1)return-1;for(let r=n;r>=0;r--){const i=t.presentationTimestamps[r].sampleIndex;if(Gm(t.keySampleIndices,i,o=>o)!==-1)return i}return-1}else{const n=Wx(t,e),r=un(t.keySampleIndices,n,i=>i);return t.keySampleIndices[r]??-1}},jte=(t,e)=>{const n=un(t.sampleTimingEntries,e,y=>y.startIndex),r=t.sampleTimingEntries[n];if(!r||r.startIndex+r.count<=e)return null;let s=r.startDecodeTimestamp+(e-r.startIndex)*r.delta;const o=un(t.sampleCompositionTimeOffsets,e,y=>y.startIndex),a=t.sampleCompositionTimeOffsets[o];a&&e-a.startIndex<a.count&&(s+=a.offset);const l=t.sampleSizes[Math.min(e,t.sampleSizes.length-1)],c=un(t.sampleToChunk,e,y=>y.startSampleIndex),u=t.sampleToChunk[c];W(u);const d=u.startChunkIndex+Math.floor((e-u.startSampleIndex)/u.samplesPerChunk),f=t.chunkOffsets[d],h=u.startSampleIndex+(d-u.startChunkIndex)*u.samplesPerChunk;let p=0,m=f;if(t.sampleSizes.length===1)m+=l*(e-h),p+=l*u.samplesPerChunk;else for(let y=h;y<h+u.samplesPerChunk;y++){const b=t.sampleSizes[y];y<e&&(m+=b),p+=b}let g=r.delta;if(t.presentationTimestamps){const y=t.presentationTimestampIndexMap[e];W(y!==void 0),y<t.presentationTimestamps.length-1&&(g=t.presentationTimestamps[y+1].presentationTimestamp-s)}return{presentationTimestamp:s,duration:g,sampleOffset:m,sampleSize:l,chunkOffset:f,chunkSize:p,isKeyFrame:t.keySampleIndices?Gm(t.keySampleIndices,e,y=>y)!==-1:!0}},qte=(t,e)=>{if(!t.keySampleIndices)return e+1;const n=un(t.keySampleIndices,e,r=>r);return t.keySampleIndices[n+1]??-1},b1=(t,e)=>{t.startTimestamp+=e,t.endTimestamp+=e;for(const n of t.samples)n.presentationTimestamp+=e;for(const n of t.presentationTimestamps)n.presentationTimestamp+=e},Kte=t=>{const[e,,,n]=t,r=Math.hypot(e,n),i=e/r,s=n/r,o=-Math.atan2(s,i)*(180/Math.PI);return Number.isFinite(o)?o:0},GP=t=>t.sampleSizes.length===0;var Oe;(function(t){t[t.EBML=440786851]="EBML",t[t.EBMLVersion=17030]="EBMLVersion",t[t.EBMLReadVersion=17143]="EBMLReadVersion",t[t.EBMLMaxIDLength=17138]="EBMLMaxIDLength",t[t.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",t[t.DocType=17026]="DocType",t[t.DocTypeVersion=17031]="DocTypeVersion",t[t.DocTypeReadVersion=17029]="DocTypeReadVersion",t[t.Void=236]="Void",t[t.Segment=408125543]="Segment",t[t.SeekHead=290298740]="SeekHead",t[t.Seek=19899]="Seek",t[t.SeekID=21419]="SeekID",t[t.SeekPosition=21420]="SeekPosition",t[t.Duration=17545]="Duration",t[t.Info=357149030]="Info",t[t.TimestampScale=2807729]="TimestampScale",t[t.MuxingApp=19840]="MuxingApp",t[t.WritingApp=22337]="WritingApp",t[t.Tracks=374648427]="Tracks",t[t.TrackEntry=174]="TrackEntry",t[t.TrackNumber=215]="TrackNumber",t[t.TrackUID=29637]="TrackUID",t[t.TrackType=131]="TrackType",t[t.FlagEnabled=185]="FlagEnabled",t[t.FlagDefault=136]="FlagDefault",t[t.FlagForced=21930]="FlagForced",t[t.FlagOriginal=21934]="FlagOriginal",t[t.FlagHearingImpaired=21931]="FlagHearingImpaired",t[t.FlagVisualImpaired=21932]="FlagVisualImpaired",t[t.FlagCommentary=21935]="FlagCommentary",t[t.FlagLacing=156]="FlagLacing",t[t.Name=21358]="Name",t[t.Language=2274716]="Language",t[t.LanguageBCP47=2274717]="LanguageBCP47",t[t.CodecID=134]="CodecID",t[t.CodecPrivate=25506]="CodecPrivate",t[t.CodecDelay=22186]="CodecDelay",t[t.SeekPreRoll=22203]="SeekPreRoll",t[t.DefaultDuration=2352003]="DefaultDuration",t[t.Video=224]="Video",t[t.PixelWidth=176]="PixelWidth",t[t.PixelHeight=186]="PixelHeight",t[t.AlphaMode=21440]="AlphaMode",t[t.Audio=225]="Audio",t[t.SamplingFrequency=181]="SamplingFrequency",t[t.Channels=159]="Channels",t[t.BitDepth=25188]="BitDepth",t[t.SimpleBlock=163]="SimpleBlock",t[t.BlockGroup=160]="BlockGroup",t[t.Block=161]="Block",t[t.BlockAdditions=30113]="BlockAdditions",t[t.BlockMore=166]="BlockMore",t[t.BlockAdditional=165]="BlockAdditional",t[t.BlockAddID=238]="BlockAddID",t[t.BlockDuration=155]="BlockDuration",t[t.ReferenceBlock=251]="ReferenceBlock",t[t.Cluster=524531317]="Cluster",t[t.Timestamp=231]="Timestamp",t[t.Cues=475249515]="Cues",t[t.CuePoint=187]="CuePoint",t[t.CueTime=179]="CueTime",t[t.CueTrackPositions=183]="CueTrackPositions",t[t.CueTrack=247]="CueTrack",t[t.CueClusterPosition=241]="CueClusterPosition",t[t.Colour=21936]="Colour",t[t.MatrixCoefficients=21937]="MatrixCoefficients",t[t.TransferCharacteristics=21946]="TransferCharacteristics",t[t.Primaries=21947]="Primaries",t[t.Range=21945]="Range",t[t.Projection=30320]="Projection",t[t.ProjectionType=30321]="ProjectionType",t[t.ProjectionPoseRoll=30325]="ProjectionPoseRoll",t[t.Attachments=423732329]="Attachments",t[t.AttachedFile=24999]="AttachedFile",t[t.FileDescription=18046]="FileDescription",t[t.FileName=18030]="FileName",t[t.FileMediaType=18016]="FileMediaType",t[t.FileData=18012]="FileData",t[t.FileUID=18094]="FileUID",t[t.Chapters=272869232]="Chapters",t[t.Tags=307544935]="Tags",t[t.Tag=29555]="Tag",t[t.Targets=25536]="Targets",t[t.TargetTypeValue=26826]="TargetTypeValue",t[t.TargetType=25546]="TargetType",t[t.TagTrackUID=25541]="TagTrackUID",t[t.TagEditionUID=25545]="TagEditionUID",t[t.TagChapterUID=25540]="TagChapterUID",t[t.TagAttachmentUID=25542]="TagAttachmentUID",t[t.SimpleTag=26568]="SimpleTag",t[t.TagName=17827]="TagName",t[t.TagLanguage=17530]="TagLanguage",t[t.TagString=17543]="TagString",t[t.TagBinary=17541]="TagBinary",t[t.ContentEncodings=28032]="ContentEncodings",t[t.ContentEncoding=25152]="ContentEncoding",t[t.ContentEncodingOrder=20529]="ContentEncodingOrder",t[t.ContentEncodingScope=20530]="ContentEncodingScope",t[t.ContentCompression=20532]="ContentCompression",t[t.ContentCompAlgo=16980]="ContentCompAlgo",t[t.ContentCompSettings=16981]="ContentCompSettings",t[t.ContentEncryption=20533]="ContentEncryption"})(Oe||(Oe={}));const Gte=[Oe.EBML,Oe.Segment],om=[Oe.SeekHead,Oe.Info,Oe.Cluster,Oe.Tracks,Oe.Cues,Oe.Attachments,Oe.Chapters,Oe.Tags],u0=[...Gte,...om],jx=8,Os=2,Ha=2*jx,ID=t=>{if(t.remainingLength<1)return null;const e=ht(t);if(t.skip(-1),e===0)return null;let n=1,r=128;for(;(e&r)===0;)n++,r>>=1;return t.remainingLength<n?null:n},rp=t=>{if(t.remainingLength<1)return null;const e=ht(t);if(e===0)return null;let n=1,r=128;for(;(e&r)===0;)n++,r>>=1;if(t.remainingLength<n-1)return null;let i=e&r-1;for(let s=1;s<n;s++)i*=256,i+=ht(t);return i},zt=(t,e)=>{if(e<1||e>8)throw new Error("Bad unsigned int size "+e);let n=0;for(let r=0;r<e;r++)n*=256,n+=ht(t);return n},Zte=(t,e)=>{if(e<1)throw new Error("Bad unsigned int size "+e);let n=0n;for(let r=0;r<e;r++)n<<=8n,n+=BigInt(ht(t));return n},lT=t=>{const e=ID(t);return e===null||t.remainingLength<e?null:zt(t,e)},OD=t=>{if(t.remainingLength<1)return null;if(ht(t)===255)return;t.skip(-1);const n=rp(t);if(n===null)return null;if(n!==72057594037927940)return n},Ra=t=>{W(t.remainingLength>=Os);const e=lT(t);if(e===null)return null;const n=OD(t);return n===null?null:{id:e,size:n}},Ud=(t,e)=>{const n=St(t,e);let r=0;for(;r<e&&n[r]!==0;)r+=1;return String.fromCharCode(...n.subarray(0,r))},Bh=(t,e)=>{const n=St(t,e);let r=0;for(;r<e&&n[r]!==0;)r+=1;return Fs.decode(n.subarray(0,r))},w1=(t,e)=>{if(e===0)return 0;if(e!==4&&e!==8)throw new Error("Bad float size "+e);return e===4?sre(t):HD(t)},qx=async(t,e,n,r)=>{const i=new Set(n);let s=e;for(;r===null||s<r;){let o=t.requestSliceRange(s,Os,Ha);if(o instanceof Promise&&(o=await o),!o)break;const a=Ra(o);if(!a)break;if(i.has(a.id))return{pos:s,found:!0};Xl(a.size),s=o.filePos+a.size}return{pos:r!==null&&r>s?r:s,found:!1}},MD=async(t,e,n,r)=>{const s=new Set(n);let o=e;for(;o<r;){let a=t.requestSliceRange(o,0,Math.min(65536,r-o));if(a instanceof Promise&&(a=await a),!a||a.length<jx)break;for(let l=0;l<a.length-jx;l++){a.filePos=o;const c=lT(a);if(c!==null&&s.has(c))return o;o++}}return null},So={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC"};function Xl(t){if(t===void 0)throw new Error("Undefined element size is used in a place where it is not supported.")}const Xte=t=>{let n=(t.hasVideo?"video/":t.hasAudio?"audio/":"application/")+(t.isWebM?"webm":"x-matroska");if(t.codecStrings.length>0){const r=[...new Set(t.codecStrings.filter(Boolean))];n+=`; codecs="${r.join(", ")}"`}return n};var Aa;(function(t){t[t.None=0]="None",t[t.Xiph=1]="Xiph",t[t.FixedSize=2]="FixedSize",t[t.Ebml=3]="Ebml"})(Aa||(Aa={}));var my;(function(t){t[t.Block=1]="Block",t[t.Private=2]="Private",t[t.Next=4]="Next"})(my||(my={}));var kp;(function(t){t[t.Zlib=0]="Zlib",t[t.Bzlib=1]="Bzlib",t[t.lzo1x=2]="lzo1x",t[t.HeaderStripping=3]="HeaderStripping"})(kp||(kp={}));const v1=[{id:Oe.SeekHead,flag:"seekHeadSeen"},{id:Oe.Info,flag:"infoSeen"},{id:Oe.Tracks,flag:"tracksSeen"},{id:Oe.Cues,flag:"cuesSeen"}],ND=10*2**20;class Qte extends Jc{constructor(e){super(e),this.readMetadataPromise=null,this.segments=[],this.currentSegment=null,this.currentTrack=null,this.currentCluster=null,this.currentBlock=null,this.currentBlockAdditional=null,this.currentCueTime=null,this.currentDecodingInstruction=null,this.currentTagTargetIsMovie=!0,this.currentSimpleTagName=null,this.currentAttachedFile=null,this.isWebM=!1,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getTracks(){return await this.readMetadata(),this.segments.flatMap(e=>e.tracks.map(n=>n.inputTrack))}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.getCodecParameterString()));return Xte({isWebM:this.isWebM,hasVideo:this.segments.some(r=>r.tracks.some(i=>i.info?.type==="video")),hasAudio:this.segments.some(r=>r.tracks.some(i=>i.info?.type==="audio")),codecStrings:n.filter(Boolean)})}async getMetadataTags(){await this.readMetadata();for(const n of this.segments)n.metadataTagsCollected||(this.reader.fileSize!==null&&await this.loadSegmentMetadata(n),n.metadataTagsCollected=!0);let e={};for(const n of this.segments)e={...e,...n.metadataTags};return e}readMetadata(){return this.readMetadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,Os,Ha);if(n instanceof Promise&&(n=await n),!n)break;const r=Ra(n);if(!r)break;const i=r.id;let s=r.size;const o=n.filePos;if(i===Oe.EBML){Xl(s);let a=this.reader.requestSlice(o,s);if(a instanceof Promise&&(a=await a),!a)break;this.readContiguousElements(a)}else if(i===Oe.Segment){if(await this.readSegment(o,s),s===void 0||this.reader.fileSize===null)break}else if(i===Oe.Cluster){if(this.reader.fileSize===null)break;s===void 0&&(s=(await qx(this.reader,o,u0,this.reader.fileSize)).pos-o);const a=Wn(this.segments);a&&(a.elementEndPos=o+s)}Xl(s),e=o+s}})()}async readSegment(e,n){this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,tagsSeen:!1,attachmentsSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:e,elementEndPos:n===void 0?null:e+n,clusterSeekStartPos:e,lastReadCluster:null,metadataTags:{},metadataTagsCollected:!1},this.segments.push(this.currentSegment);let r=e;for(;this.currentSegment.elementEndPos===null||r<this.currentSegment.elementEndPos;){let a=this.reader.requestSliceRange(r,Os,Ha);if(a instanceof Promise&&(a=await a),!a)break;const l=r,c=Ra(a);if(!c||!om.includes(c.id)&&c.id!==Oe.Void){const p=await MD(this.reader,l,om,Math.min(this.currentSegment.elementEndPos??1/0,l+ND));if(p){r=p;continue}else break}const{id:u,size:d}=c,f=a.filePos,h=v1.findIndex(p=>p.id===u);if(h!==-1){const p=v1[h].flag;this.currentSegment[p]=!0,Xl(d);let m=this.reader.requestSlice(f,d);m instanceof Promise&&(m=await m),m&&this.readContiguousElements(m)}else if(u===Oe.Tags||u===Oe.Attachments){u===Oe.Tags?this.currentSegment.tagsSeen=!0:this.currentSegment.attachmentsSeen=!0,Xl(d);let p=this.reader.requestSlice(f,d);p instanceof Promise&&(p=await p),p&&this.readContiguousElements(p)}else if(u===Oe.Cluster){this.currentSegment.clusterSeekStartPos=l;break}if(d===void 0)break;r=f+d}if(this.currentSegment.seekEntries.sort((a,l)=>a.segmentPosition-l.segmentPosition),this.reader.fileSize!==null)for(const a of this.currentSegment.seekEntries){const l=v1.find(p=>p.id===a.id);if(!l||this.currentSegment[l.flag])continue;let c=this.reader.requestSliceRange(e+a.segmentPosition,Os,Ha);if(c instanceof Promise&&(c=await c),!c)continue;const u=Ra(c);if(!u)continue;const{id:d,size:f}=u;if(d!==l.id)continue;Xl(f),this.currentSegment[l.flag]=!0;let h=this.reader.requestSlice(c.filePos,f);h instanceof Promise&&(h=await h),h&&this.readContiguousElements(h)}this.currentSegment.timestampScale===-1&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e9/1e6);for(const a of this.currentSegment.tracks)a.defaultDurationNs!==null&&(a.defaultDuration=this.currentSegment.timestampFactor*a.defaultDurationNs/1e9);this.currentSegment.tracks.sort((a,l)=>Number(l.disposition.default)-Number(a.disposition.default));const i=new Map(this.currentSegment.tracks.map(a=>[a.id,a]));for(const a of this.currentSegment.cuePoints){const l=i.get(a.trackId);l&&l.cuePoints.push(a)}for(const a of this.currentSegment.tracks){a.cuePoints.sort((l,c)=>l.time-c.time);for(let l=0;l<a.cuePoints.length-1;l++){const c=a.cuePoints[l],u=a.cuePoints[l+1];c.time===u.time&&(a.cuePoints.splice(l+1,1),l--)}}let s=null,o=-1/0;for(const a of this.currentSegment.tracks)a.cuePoints.length>o&&(o=a.cuePoints.length,s=a);for(const a of this.currentSegment.tracks)a.cuePoints.length===0&&(a.cuePoints=s.cuePoints);this.currentSegment=null}async readCluster(e,n){if(n.lastReadCluster?.elementStartPos===e)return n.lastReadCluster;let r=this.reader.requestSliceRange(e,Os,Ha);r instanceof Promise&&(r=await r),W(r);const i=e,s=Ra(r);W(s);const o=s.id;W(o===Oe.Cluster);let a=s.size;const l=r.filePos;a===void 0&&(a=(await qx(this.reader,l,u0,n.elementEndPos)).pos-l);let c=this.reader.requestSlice(l,a);c instanceof Promise&&(c=await c);const u={segment:n,elementStartPos:i,elementEndPos:l+a,dataStartPos:l,timestamp:-1,trackData:new Map};if(this.currentCluster=u,c){const d=this.readContiguousElements(c,u0);u.elementEndPos=d}for(const[,d]of u.trackData){const f=d.track;W(d.blocks.length>0);let h=!1;for(let y=0;y<d.blocks.length;y++){const b=d.blocks[y];b.timestamp+=u.timestamp,h||=b.lacing!==Aa.None}d.presentationTimestamps=d.blocks.map((y,b)=>({timestamp:y.timestamp,blockIndex:b})).sort((y,b)=>y.timestamp-b.timestamp);for(let y=0;y<d.presentationTimestamps.length;y++){const b=d.presentationTimestamps[y],x=d.blocks[b.blockIndex];if(d.firstKeyFrameTimestamp===null&&x.isKeyFrame&&(d.firstKeyFrameTimestamp=x.timestamp),y<d.presentationTimestamps.length-1){const C=d.presentationTimestamps[y+1];x.duration=C.timestamp-x.timestamp}else x.duration===0&&f.defaultDuration!=null&&x.lacing===Aa.None&&(x.duration=f.defaultDuration)}h&&(this.expandLacedBlocks(d.blocks,f),d.presentationTimestamps=d.blocks.map((y,b)=>({timestamp:y.timestamp,blockIndex:b})).sort((y,b)=>y.timestamp-b.timestamp));const p=d.blocks[d.presentationTimestamps[0].blockIndex],m=d.blocks[Wn(d.presentationTimestamps).blockIndex];d.startTimestamp=p.timestamp,d.endTimestamp=m.timestamp+m.duration;const g=un(f.clusterPositionCache,d.startTimestamp,y=>y.startTimestamp);(g===-1||f.clusterPositionCache[g].elementStartPos!==i)&&f.clusterPositionCache.splice(g+1,0,{elementStartPos:u.elementStartPos,startTimestamp:d.startTimestamp})}return n.lastReadCluster=u,u}getTrackDataInCluster(e,n){let r=e.trackData.get(n);if(!r){const i=e.segment.tracks.find(s=>s.id===n);if(!i)return null;r={track:i,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(n,r)}return r}expandLacedBlocks(e,n){for(let r=0;r<e.length;r++){const i=e[r];if(i.lacing===Aa.None)continue;i.decoded||(i.data=this.decodeBlockData(n,i.data),i.decoded=!0);const s=uo.tempFromBytes(i.data),o=[],a=ht(s)+1;switch(i.lacing){case Aa.Xiph:{let c=0;for(let u=0;u<a-1;u++){let d=0;for(;s.bufferPos<s.length;){const f=ht(s);if(d+=f,f<255){o.push(d),c+=d;break}}}o.push(s.length-(s.bufferPos+c))}break;case Aa.FixedSize:{const c=s.length-1,u=Math.floor(c/a);for(let d=0;d<a;d++)o.push(u)}break;case Aa.Ebml:{const c=rp(s);W(c!==null);let u=c;o.push(u);let d=u;for(let f=1;f<a-1;f++){const h=s.bufferPos,p=rp(s);W(p!==null);const m=p,y=(1<<(s.bufferPos-h)*7-1)-1,b=m-y;u+=b,o.push(u),d+=u}o.push(s.length-(s.bufferPos+d))}break;default:W(!1)}W(o.length===a),e.splice(r,1);const l=i.duration||a*(n.defaultDuration??0);for(let c=0;c<a;c++){const u=o[c],d=St(s,u),f=i.timestamp+l*c/a,h=l/a;e.splice(r+c,0,{timestamp:f,duration:h,isKeyFrame:i.isKeyFrame,data:d,lacing:Aa.None,decoded:!0,mainAdditional:i.mainAdditional})}r+=a,r--}}async loadSegmentMetadata(e){for(const n of e.seekEntries){if(!(n.id===Oe.Tags&&!e.tagsSeen)){if(!(n.id===Oe.Attachments&&!e.attachmentsSeen))continue}let r=this.reader.requestSliceRange(e.dataStartPos+n.segmentPosition,Os,Ha);if(r instanceof Promise&&(r=await r),!r)continue;const i=Ra(r);if(!i||i.id!==n.id)continue;const{size:s}=i;Xl(s),W(!this.currentSegment),this.currentSegment=e;let o=this.reader.requestSlice(r.filePos,s);o instanceof Promise&&(o=await o),o&&this.readContiguousElements(o),this.currentSegment=null,n.id===Oe.Tags?e.tagsSeen=!0:n.id===Oe.Attachments&&(e.attachmentsSeen=!0)}}readContiguousElements(e,n){for(;e.remainingLength>=Os;){const r=e.filePos;if(!this.traverseElement(e,n))return r}return e.filePos}traverseElement(e,n){const r=Ra(e);if(!r||n&&n.includes(r.id))return!1;const{id:i,size:s}=r,o=e.filePos;switch(Xl(s),i){case Oe.DocType:this.isWebM=Ud(e,s)==="webm";break;case Oe.Seek:{if(!this.currentSegment)break;const a={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(a),this.readContiguousElements(e.slice(o,s)),(a.id===-1||a.segmentPosition===-1)&&this.currentSegment.seekEntries.pop()}break;case Oe.SeekID:{const a=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!a)break;a.id=zt(e,s)}break;case Oe.SeekPosition:{const a=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!a)break;a.segmentPosition=zt(e,s)}break;case Oe.TimestampScale:{if(!this.currentSegment)break;this.currentSegment.timestampScale=zt(e,s),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale}break;case Oe.Duration:{if(!this.currentSegment)break;this.currentSegment.duration=w1(e,s)}break;case Oe.TrackEntry:{if(!this.currentSegment||(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusterPositionCache:[],cuePoints:[],disposition:{...Qc},inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,defaultDurationNs:null,name:null,languageCode:cs,decodingInstructions:[],info:null},this.readContiguousElements(e.slice(o,s)),!this.currentTrack))break;if(this.currentTrack.decodingInstructions.some(a=>a.data?.type!=="decompress"||a.scope!==my.Block||a.data.algorithm!==kp.HeaderStripping)&&(console.warn(`Track #${this.currentTrack.id} has an unsupported content encoding; dropping.`),this.currentTrack=null),this.currentTrack&&this.currentTrack.id!==-1&&this.currentTrack.codecId&&this.currentTrack.info){const a=this.currentTrack.codecId.indexOf("/"),l=a===-1?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,a);if(this.currentTrack.info.type==="video"&&this.currentTrack.info.width!==-1&&this.currentTrack.info.height!==-1){this.currentTrack.codecId===So.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===So.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):l===So.vp8?this.currentTrack.info.codec="vp8":l===So.vp9?this.currentTrack.info.codec="vp9":l===So.av1&&(this.currentTrack.info.codec="av1");const c=this.currentTrack,u=new ch(this.input,new Yte(c));this.currentTrack.inputTrack=u,this.currentSegment.tracks.push(this.currentTrack)}else if(this.currentTrack.info.type==="audio"&&this.currentTrack.info.numberOfChannels!==-1&&this.currentTrack.info.sampleRate!==-1){l===So.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2"),objectType:null},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===So.mp3?this.currentTrack.info.codec="mp3":l===So.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate,this.currentTrack.info.sampleRate=fw):l===So.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):l===So.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId==="A_PCM/INT/LIT"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32"):this.currentTrack.codecId==="A_PCM/INT/BIG"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16be":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24be":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32be"):this.currentTrack.codecId==="A_PCM/FLOAT/IEEE"&&(this.currentTrack.info.bitDepth===32?this.currentTrack.info.codec="pcm-f32":this.currentTrack.info.bitDepth===64&&(this.currentTrack.info.codec="pcm-f64"));const c=this.currentTrack,u=new ca(this.input,new Jte(c));this.currentTrack.inputTrack=u,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null}break;case Oe.TrackNumber:{if(!this.currentTrack)break;this.currentTrack.id=zt(e,s)}break;case Oe.TrackType:{if(!this.currentTrack)break;const a=zt(e,s);a===1?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null,alphaMode:!1}:a===2&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case Oe.FlagEnabled:{if(!this.currentTrack)break;zt(e,s)||(this.currentTrack=null)}break;case Oe.FlagDefault:{if(!this.currentTrack)break;this.currentTrack.disposition.default=!!zt(e,s)}break;case Oe.FlagForced:{if(!this.currentTrack)break;this.currentTrack.disposition.forced=!!zt(e,s)}break;case Oe.FlagOriginal:{if(!this.currentTrack)break;this.currentTrack.disposition.original=!!zt(e,s)}break;case Oe.FlagHearingImpaired:{if(!this.currentTrack)break;this.currentTrack.disposition.hearingImpaired=!!zt(e,s)}break;case Oe.FlagVisualImpaired:{if(!this.currentTrack)break;this.currentTrack.disposition.visuallyImpaired=!!zt(e,s)}break;case Oe.FlagCommentary:{if(!this.currentTrack)break;this.currentTrack.disposition.commentary=!!zt(e,s)}break;case Oe.CodecID:{if(!this.currentTrack)break;this.currentTrack.codecId=Ud(e,s)}break;case Oe.CodecPrivate:{if(!this.currentTrack)break;this.currentTrack.codecPrivate=St(e,s)}break;case Oe.DefaultDuration:{if(!this.currentTrack)break;this.currentTrack.defaultDurationNs=zt(e,s)}break;case Oe.Name:{if(!this.currentTrack)break;this.currentTrack.name=Bh(e,s)}break;case Oe.Language:{if(!this.currentTrack||this.currentTrack.languageCode!==cs)break;this.currentTrack.languageCode=Ud(e,s),nm(this.currentTrack.languageCode)||(this.currentTrack.languageCode=cs)}break;case Oe.LanguageBCP47:{if(!this.currentTrack)break;const l=Ud(e,s).split("-")[0];l?this.currentTrack.languageCode=l:this.currentTrack.languageCode=cs}break;case Oe.Video:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(o,s))}break;case Oe.PixelWidth:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.width=zt(e,s)}break;case Oe.PixelHeight:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.height=zt(e,s)}break;case Oe.AlphaMode:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.alphaMode=zt(e,s)===1}break;case Oe.Colour:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e.slice(o,s))}break;case Oe.MatrixCoefficients:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=zt(e,s),l=fy[a]??null;this.currentTrack.info.colorSpace.matrix=l}break;case Oe.Range:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=zt(e,s)===2}break;case Oe.TransferCharacteristics:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=zt(e,s),l=dy[a]??null;this.currentTrack.info.colorSpace.transfer=l}break;case Oe.Primaries:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=zt(e,s),l=uy[a]??null;this.currentTrack.info.colorSpace.primaries=l}break;case Oe.Projection:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(o,s))}break;case Oe.ProjectionPoseRoll:{if(this.currentTrack?.info?.type!=="video")break;const l=-w1(e,s);try{this.currentTrack.info.rotation=KE(l)}catch{}}break;case Oe.Audio:{if(this.currentTrack?.info?.type!=="audio")break;this.readContiguousElements(e.slice(o,s))}break;case Oe.SamplingFrequency:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.sampleRate=w1(e,s)}break;case Oe.Channels:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.numberOfChannels=zt(e,s)}break;case Oe.BitDepth:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.bitDepth=zt(e,s)}break;case Oe.CuePoint:{if(!this.currentSegment)break;this.readContiguousElements(e.slice(o,s)),this.currentCueTime=null}break;case Oe.CueTime:this.currentCueTime=zt(e,s);break;case Oe.CueTrackPositions:{if(this.currentCueTime===null)break;W(this.currentSegment);const a={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(a),this.readContiguousElements(e.slice(o,s)),(a.trackId===-1||a.clusterPosition===-1)&&this.currentSegment.cuePoints.pop()}break;case Oe.CueTrack:{const a=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!a)break;a.trackId=zt(e,s)}break;case Oe.CueClusterPosition:{const a=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!a)break;W(this.currentSegment),a.clusterPosition=this.currentSegment.dataStartPos+zt(e,s)}break;case Oe.Timestamp:{if(!this.currentCluster)break;this.currentCluster.timestamp=zt(e,s)}break;case Oe.SimpleBlock:{if(!this.currentCluster)break;const a=rp(e);if(a===null)break;const l=this.getTrackDataInCluster(this.currentCluster,a);if(!l)break;const c=Xx(e),u=ht(e),d=u>>1&3;let f=!!(u&128);l.track.info?.type==="audio"&&l.track.info.codec&&(f=!0);const h=St(e,s-(e.filePos-o)),p=l.track.decodingInstructions.length>0;l.blocks.push({timestamp:c,duration:0,isKeyFrame:f,data:h,lacing:d,decoded:!p,mainAdditional:null})}break;case Oe.BlockGroup:{if(!this.currentCluster)break;this.readContiguousElements(e.slice(o,s)),this.currentBlock=null}break;case Oe.Block:{if(!this.currentCluster)break;const a=rp(e);if(a===null)break;const l=this.getTrackDataInCluster(this.currentCluster,a);if(!l)break;const c=Xx(e),d=ht(e)>>1&3,f=St(e,s-(e.filePos-o)),h=l.track.decodingInstructions.length>0;this.currentBlock={timestamp:c,duration:0,isKeyFrame:!0,data:f,lacing:d,decoded:!h,mainAdditional:null},l.blocks.push(this.currentBlock)}break;case Oe.BlockAdditions:this.readContiguousElements(e.slice(o,s));break;case Oe.BlockMore:{if(!this.currentBlock)break;this.currentBlockAdditional={addId:1,data:null},this.readContiguousElements(e.slice(o,s)),this.currentBlockAdditional.data&&this.currentBlockAdditional.addId===1&&(this.currentBlock.mainAdditional=this.currentBlockAdditional.data),this.currentBlockAdditional=null}break;case Oe.BlockAdditional:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.data=St(e,s)}break;case Oe.BlockAddID:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.addId=zt(e,s)}break;case Oe.BlockDuration:{if(!this.currentBlock)break;this.currentBlock.duration=zt(e,s)}break;case Oe.ReferenceBlock:{if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1}break;case Oe.Tag:this.currentTagTargetIsMovie=!0,this.readContiguousElements(e.slice(o,s));break;case Oe.Targets:this.readContiguousElements(e.slice(o,s));break;case Oe.TargetTypeValue:zt(e,s)!==50&&(this.currentTagTargetIsMovie=!1);break;case Oe.TagTrackUID:case Oe.TagEditionUID:case Oe.TagChapterUID:case Oe.TagAttachmentUID:this.currentTagTargetIsMovie=!1;break;case Oe.SimpleTag:{if(!this.currentTagTargetIsMovie)break;this.currentSimpleTagName=null,this.readContiguousElements(e.slice(o,s))}break;case Oe.TagName:this.currentSimpleTagName=Bh(e,s);break;case Oe.TagString:{if(!this.currentSimpleTagName)break;const a=Bh(e,s);this.processTagValue(this.currentSimpleTagName,a)}break;case Oe.TagBinary:{if(!this.currentSimpleTagName)break;const a=St(e,s);this.processTagValue(this.currentSimpleTagName,a)}break;case Oe.AttachedFile:{if(!this.currentSegment)break;this.currentAttachedFile={fileUid:null,fileName:null,fileMediaType:null,fileData:null,fileDescription:null},this.readContiguousElements(e.slice(o,s));const a=this.currentSegment.metadataTags;if(this.currentAttachedFile.fileUid&&this.currentAttachedFile.fileData&&(a.raw??={},a.raw[this.currentAttachedFile.fileUid.toString()]=new cD(this.currentAttachedFile.fileData,this.currentAttachedFile.fileMediaType??void 0,this.currentAttachedFile.fileName??void 0,this.currentAttachedFile.fileDescription??void 0)),this.currentAttachedFile.fileMediaType?.startsWith("image/")&&this.currentAttachedFile.fileData){const l=this.currentAttachedFile.fileName;let c="unknown";if(l){const u=l.toLowerCase();u.startsWith("cover.")?c="coverFront":u.startsWith("back.")&&(c="coverBack")}a.images??=[],a.images.push({data:this.currentAttachedFile.fileData,mimeType:this.currentAttachedFile.fileMediaType,kind:c,name:this.currentAttachedFile.fileName??void 0,description:this.currentAttachedFile.fileDescription??void 0})}this.currentAttachedFile=null}break;case Oe.FileUID:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileUid=Zte(e,s)}break;case Oe.FileName:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileName=Bh(e,s)}break;case Oe.FileMediaType:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileMediaType=Ud(e,s)}break;case Oe.FileData:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileData=St(e,s)}break;case Oe.FileDescription:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileDescription=Bh(e,s)}break;case Oe.ContentEncodings:{if(!this.currentTrack)break;this.readContiguousElements(e.slice(o,s)),this.currentTrack.decodingInstructions.sort((a,l)=>l.order-a.order)}break;case Oe.ContentEncoding:this.currentDecodingInstruction={order:0,scope:my.Block,data:null},this.readContiguousElements(e.slice(o,s)),this.currentDecodingInstruction.data&&this.currentTrack.decodingInstructions.push(this.currentDecodingInstruction),this.currentDecodingInstruction=null;break;case Oe.ContentEncodingOrder:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.order=zt(e,s)}break;case Oe.ContentEncodingScope:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.scope=zt(e,s)}break;case Oe.ContentCompression:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decompress",algorithm:kp.Zlib,settings:null},this.readContiguousElements(e.slice(o,s))}break;case Oe.ContentCompAlgo:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.algorithm=zt(e,s)}break;case Oe.ContentCompSettings:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.settings=St(e,s)}break;case Oe.ContentEncryption:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decrypt"}}break}return e.filePos=o+s,!0}decodeBlockData(e,n){W(e.decodingInstructions.length>0);let r=n;for(const i of e.decodingInstructions)switch(W(i.data),i.data.type){case"decompress":switch(i.data.algorithm){case kp.HeaderStripping:if(i.data.settings&&i.data.settings.length>0){const s=i.data.settings,o=new Uint8Array(s.length+r.length);o.set(s,0),o.set(r,s.length),r=o}break}break}return r}processTagValue(e,n){if(!this.currentSegment?.metadataTags)return;const r=this.currentSegment.metadataTags;if(r.raw??={},r.raw[e]??=n,typeof n=="string")switch(e.toLowerCase()){case"title":r.title??=n;break;case"description":r.description??=n;break;case"artist":r.artist??=n;break;case"album":r.album??=n;break;case"album_artist":r.albumArtist??=n;break;case"genre":r.genre??=n;break;case"comment":r.comment??=n;break;case"lyrics":r.lyrics??=n;break;case"date":{const i=new Date(n);Number.isNaN(i.getTime())||(r.date??=i)}break;case"track_number":case"part_number":{const i=n.split("/"),s=Number.parseInt(i[0],10),o=i[1]&&Number.parseInt(i[1],10);Number.isInteger(s)&&s>0&&(r.trackNumber??=s),o&&Number.isInteger(o)&&o>0&&(r.tracksTotal??=o)}break;case"disc_number":case"disc":{const i=n.split("/"),s=Number.parseInt(i[0],10),o=i[1]&&Number.parseInt(i[1],10);Number.isInteger(s)&&s>0&&(r.discNumber??=s),o&&Number.isInteger(o)&&o>0&&(r.discsTotal??=o)}break}}}class RD{constructor(e){this.internalTrack=e,this.packetToClusterLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.codecId}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}getTimeResolution(){return this.internalTrack.segment.timestampFactor}getDisposition(){return this.internalTrack.disposition}async getFirstPacket(e){return this.performClusterLookup(null,n=>n.trackData.get(this.internalTrack.id)?{blockIndex:0,correctBlockFound:!0}:{blockIndex:-1,correctBlockFound:!1},-1/0,1/0,e)}intoTimescale(e){return tm(e*this.internalTrack.segment.timestampFactor)}async getPacket(e,n){const r=this.intoTimescale(e);return this.performClusterLookup(null,i=>{const s=i.trackData.get(this.internalTrack.id);if(!s)return{blockIndex:-1,correctBlockFound:!1};const o=un(s.presentationTimestamps,r,c=>c.timestamp),a=o!==-1?s.presentationTimestamps[o].blockIndex:-1,l=o!==-1&&r<s.endTimestamp;return{blockIndex:a,correctBlockFound:l}},r,r,n)}async getNextPacket(e,n){const r=this.packetToClusterLocation.get(e);if(r===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(r.cluster,i=>{if(i===r.cluster){const s=i.trackData.get(this.internalTrack.id);if(r.blockIndex+1<s.blocks.length)return{blockIndex:r.blockIndex+1,correctBlockFound:!0}}else if(i.trackData.get(this.internalTrack.id))return{blockIndex:0,correctBlockFound:!0};return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,n)}async getKeyPacket(e,n){const r=this.intoTimescale(e);return this.performClusterLookup(null,i=>{const s=i.trackData.get(this.internalTrack.id);if(!s)return{blockIndex:-1,correctBlockFound:!1};const o=ZE(s.presentationTimestamps,c=>s.blocks[c.blockIndex].isKeyFrame&&c.timestamp<=r),a=o!==-1?s.presentationTimestamps[o].blockIndex:-1,l=o!==-1&&r<s.endTimestamp;return{blockIndex:a,correctBlockFound:l}},r,r,n)}async getNextKeyPacket(e,n){const r=this.packetToClusterLocation.get(e);if(r===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(r.cluster,i=>{if(i===r.cluster){const o=i.trackData.get(this.internalTrack.id).blocks.findIndex((a,l)=>a.isKeyFrame&&l>r.blockIndex);if(o!==-1)return{blockIndex:o,correctBlockFound:!0}}else{const s=i.trackData.get(this.internalTrack.id);if(s&&s.firstKeyFrameTimestamp!==null){const o=s.blocks.findIndex(a=>a.isKeyFrame);return W(o!==-1),{blockIndex:o,correctBlockFound:!0}}}return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,n)}async fetchPacketInCluster(e,n,r){if(n===-1)return null;const s=e.trackData.get(this.internalTrack.id).blocks[n];W(s),s.decoded||(s.data=this.internalTrack.demuxer.decodeBlockData(this.internalTrack,s.data),s.decoded=!0);const o=r.metadataOnly?gs:s.data,a=s.timestamp/this.internalTrack.segment.timestampFactor,l=s.duration/this.internalTrack.segment.timestampFactor,c={};s.mainAdditional&&this.internalTrack.info?.type==="video"&&this.internalTrack.info.alphaMode&&(c.alpha=r.metadataOnly?gs:s.mainAdditional,c.alphaByteLength=s.mainAdditional.byteLength);const u=new Mn(o,s.isKeyFrame?"key":"delta",a,l,e.dataStartPos+n,s.data.byteLength,c);return this.packetToClusterLocation.set(u,{cluster:e,blockIndex:n}),u}async performClusterLookup(e,n,r,i,s){const{demuxer:o,segment:a}=this.internalTrack;let l=null,c=null,u=-1;if(e){const{blockIndex:y,correctBlockFound:b}=n(e);if(b)return this.fetchPacketInCluster(e,y,s);y!==-1&&(c=e,u=y)}const d=un(this.internalTrack.cuePoints,r,y=>y.time),f=d!==-1?this.internalTrack.cuePoints[d]:null,h=un(this.internalTrack.clusterPositionCache,r,y=>y.startTimestamp),p=h!==-1?this.internalTrack.clusterPositionCache[h]:null,m=Math.max(f?.clusterPosition??0,p?.elementStartPos??0)||null;let g;for(e?m===null||e.elementStartPos>=m?(g=e.elementEndPos,l=e):g=m:g=m??a.clusterSeekStartPos;a.elementEndPos===null||g<=a.elementEndPos-Os;){if(l){const k=l.trackData.get(this.internalTrack.id);if(k&&k.startTimestamp>i)break}let y=o.reader.requestSliceRange(g,Os,Ha);if(y instanceof Promise&&(y=await y),!y)break;const b=g,x=Ra(y);if(!x||!om.includes(x.id)&&x.id!==Oe.Void){const k=await MD(o.reader,b,om,Math.min(a.elementEndPos??1/0,b+ND));if(k){g=k;continue}else break}const C=x.id;let P=x.size;const S=y.filePos;if(C===Oe.Cluster){l=await o.readCluster(b,a),P=l.elementEndPos-S;const{blockIndex:k,correctBlockFound:T}=n(l);if(T)return this.fetchPacketInCluster(l,k,s);k!==-1&&(c=l,u=k)}P===void 0&&(W(C!==Oe.Cluster),P=(await qx(o.reader,S,u0,a.elementEndPos)).pos-S);const _=S+P;if(a.elementEndPos===null){let k=o.reader.requestSliceRange(_,Os,Ha);if(k instanceof Promise&&(k=await k),!k)break;if(lT(k)===Oe.Segment){a.elementEndPos=_;break}}g=_}if(f&&(!c||c.elementStartPos<f.clusterPosition)){const y=this.internalTrack.cuePoints[d-1];W(!y||y.time<f.time);const b=y?.time??-1/0;return this.performClusterLookup(null,n,b,i,s)}return c?this.fetchPacketInCluster(c,u,s):null}}class Yte extends RD{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.info.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return this.internalTrack.info.alphaMode}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{let e=null;return(this.internalTrack.info.codec==="vp9"||this.internalTrack.info.codec==="av1"||this.internalTrack.info.codec==="avc"&&!this.internalTrack.info.codecDescription||this.internalTrack.info.codec==="hevc"&&!this.internalTrack.info.codecDescription)&&(e=await this.getFirstPacket({})),{codec:QE({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcType:1,avcCodecInfo:this.internalTrack.info.codec==="avc"&&e?eT(e.data):null,hevcCodecInfo:this.internalTrack.info.codec==="hevc"&&e?nT(e.data):null,vp9CodecInfo:this.internalTrack.info.codec==="vp9"&&e?bD(e.data):null,av1CodecInfo:this.internalTrack.info.codec==="av1"&&e?vD(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class Jte extends RD{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:YE({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const Ep=4,ene=[44100,48e3,32e3],tne=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1,-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1,-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],nne=1483304551,rne=1231971951,ine=(t,e,n,r,i)=>e===0?0:e===1?Math.floor(144*n/(r<<t))+i:e===2?Math.floor(144*n/r)+i:(Math.floor(12*n/r)+i)*4,sne=(t,e)=>t===3?e===3?21:36:e===3?13:21,cT=(t,e)=>{const n=t>>>24,r=t>>>16&255,i=t>>>8&255,s=t&255;if(n!==255&&r!==255&&i!==255&&s!==255)return{header:null,bytesAdvanced:4};if(n!==255)return{header:null,bytesAdvanced:1};if((r&224)!==224)return{header:null,bytesAdvanced:1};let o=0,a=0;r&16?o=r&8?0:1:(o=1,a=1);const l=r>>3&3,c=r>>1&3,u=i>>4&15,d=(i>>2&3)%3,f=i>>1&1,h=s>>6&3,p=s>>4&3,m=s>>3&1,g=s>>2&1,y=s&3,b=tne[o*16*4+c*16+u];if(b===-1)return{header:null,bytesAdvanced:1};const x=b*1e3,C=ene[d]>>o+a,P=ine(o,c,x,C,f);if(e!==null&&e<P)return{header:null,bytesAdvanced:1};let S;return l===3?S=c===3?384:1152:c===3?S=384:c===2?S=1152:S=576,{header:{totalSize:P,mpegVersionId:l,layer:c,bitrate:x,frequencyIndex:d,sampleRate:C,channel:h,modeExtension:p,copyright:m,original:g,emphasis:y,audioSamplesInFrame:S},bytesAdvanced:1}},Kx=t=>{let e=2130706432,n=0;for(;e!==0;)n>>=1,n|=t&e,e>>=8;return n};var Yd;(function(t){t[t.Unsynchronisation=128]="Unsynchronisation",t[t.ExtendedHeader=64]="ExtendedHeader",t[t.ExperimentalIndicator=32]="ExperimentalIndicator",t[t.Footer=16]="Footer"})(Yd||(Yd={}));var Jd;(function(t){t[t.ISO_8859_1=0]="ISO_8859_1",t[t.UTF_16_WITH_BOM=1]="UTF_16_WITH_BOM",t[t.UTF_16_BE_NO_BOM=2]="UTF_16_BE_NO_BOM",t[t.UTF_8=3]="UTF_8"})(Jd||(Jd={}));const d0=128,gy=10,ef=["Blues","Classic rock","Country","Dance","Disco","Funk","Grunge","Hip-hop","Jazz","Metal","New age","Oldies","Other","Pop","Rhythm and blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death metal","Pranks","Soundtrack","Euro-techno","Ambient","Trip-hop","Vocal","Jazz & funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound clip","Gospel","Noise","Alternative rock","Bass","Soul","Punk","Space","Meditative","Instrumental pop","Instrumental rock","Ethnic","Gothic","Darkwave","Techno-industrial","Electronic","Pop-folk","Eurodance","Dream","Southern rock","Comedy","Cult","Gangsta","Top 40","Christian rap","Pop/funk","Jungle music","Native US","Cabaret","New wave","Psychedelic","Rave","Showtunes","Trailer","Lo-fi","Tribal","Acid punk","Acid jazz","Polka","Retro","Musical","Rock 'n' roll","Hard rock","Folk","Folk rock","National folk","Swing","Fast fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic rock","Progressive rock","Psychedelic rock","Symphonic rock","Slow rock","Big band","Chorus","Easy listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber music","Sonata","Symphony","Booty bass","Primus","Porn groove","Satire","Slow jam","Club","Tango","Samba","Folklore","Ballad","Power ballad","Rhythmic Soul","Freestyle","Duet","Punk rock","Drum solo","A cappella","Euro-house","Dance hall","Goa music","Drum & bass","Club-house","Hardcore techno","Terror","Indie","Britpop","Negerpunk","Polsk punk","Beat","Christian gangsta rap","Heavy metal","Black metal","Crossover","Contemporary Christian","Christian rock","Merengue","Salsa","Thrash metal","Anime","Jpop","Synthpop","Christmas","Art rock","Baroque","Bhangra","Big beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math rock","New romantic","Nu-breakz","Post-punk","Post-rock","Psytrance","Shoegaze","Space rock","Trop rock","World music","Neoclassical","Audiobook","Audio theatre","Neue Deutsche Welle","Podcast","Indie rock","G-Funk","Dubstep","Garage rock","Psybient"],one=(t,e)=>{const n=t.filePos;e.raw??={},e.raw.TAG??=St(t,d0-3),t.filePos=n;const r=Nd(t,30);r&&(e.title??=r);const i=Nd(t,30);i&&(e.artist??=i);const s=Nd(t,30);s&&(e.album??=s);const o=Nd(t,4),a=Number.parseInt(o,10);Number.isInteger(a)&&a>0&&(e.date??=new Date(a,0,1));const l=St(t,30);let c;if(l[28]===0&&l[29]!==0){const d=l[29];d>0&&(e.trackNumber??=d),t.skip(-30),c=Nd(t,28),t.skip(2)}else t.skip(-30),c=Nd(t,30);c&&(e.comment??=c);const u=ht(t);u<ef.length&&(e.genre??=ef[u])},Nd=(t,e)=>{const n=St(t,e),r=zd(n.indexOf(0),n.length),i=n.subarray(0,r);let s="";for(let o=0;o<i.length;o++)s+=String.fromCharCode(i[o]);return s.trimEnd()},yy=t=>{const e=t.filePos,n=Zr(t,3),r=ht(t),i=ht(t),s=ht(t),o=rt(t);if(n!=="ID3"||r===255||i===255||(o&2155905152)!==0)return t.filePos=e,null;const a=Kx(o);return{majorVersion:r,revision:i,flags:s,size:a}},DD=(t,e,n)=>{if(![2,3,4].includes(e.majorVersion)){console.warn(`Unsupported ID3v2 major version: ${e.majorVersion}`);return}const r=St(t,e.size),i=new ane(e,r);if(e.flags&Yd.Footer&&i.removeFooter(),e.flags&Yd.Unsynchronisation&&e.majorVersion===3&&i.ununsynchronizeAll(),e.flags&Yd.ExtendedHeader){const s=i.readU32();e.majorVersion===3?i.pos+=s:i.pos+=s-4}for(;i.pos<=i.bytes.length-i.frameHeaderSize();){const s=i.readId3V2Frame();if(!s)break;const o=i.pos,a=i.pos+s.size;let l=!1,c=!1,u=!1;if(e.majorVersion===3?(l=!!(s.flags&64),c=!!(s.flags&128)):e.majorVersion===4&&(l=!!(s.flags&4),c=!!(s.flags&8),u=!!(s.flags&2)||!!(e.flags&Yd.Unsynchronisation)),l){console.warn(`Skipping encrypted ID3v2 frame ${s.id}`),i.pos=a;continue}if(c){console.warn(`Skipping compressed ID3v2 frame ${s.id}`),i.pos=a;continue}switch(u&&i.ununsynchronizeRegion(i.pos,a),n.raw??={},s.id[0]==="T"?n.raw[s.id]??=i.readId3V2EncodingAndText(a):n.raw[s.id]??=i.readBytes(s.size),i.pos=o,s.id){case"TIT2":case"TT2":n.title??=i.readId3V2EncodingAndText(a);break;case"TIT3":case"TT3":n.description??=i.readId3V2EncodingAndText(a);break;case"TPE1":case"TP1":n.artist??=i.readId3V2EncodingAndText(a);break;case"TALB":case"TAL":n.album??=i.readId3V2EncodingAndText(a);break;case"TPE2":case"TP2":n.albumArtist??=i.readId3V2EncodingAndText(a);break;case"TRCK":case"TRK":{const f=i.readId3V2EncodingAndText(a).split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(n.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(n.tracksTotal??=p)}break;case"TPOS":case"TPA":{const f=i.readId3V2EncodingAndText(a).split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(n.discNumber??=h),p&&Number.isInteger(p)&&p>0&&(n.discsTotal??=p)}break;case"TCON":case"TCO":{const d=i.readId3V2EncodingAndText(a);let f=/^\((\d+)\)/.exec(d);if(f){const h=Number.parseInt(f[1]);if(ef[h]!==void 0){n.genre??=ef[h];break}}if(f=/^\d+$/.exec(d),f){const h=Number.parseInt(f[0]);if(ef[h]!==void 0){n.genre??=ef[h];break}}n.genre??=d}break;case"TDRC":case"TDAT":{const d=i.readId3V2EncodingAndText(a),f=new Date(d);Number.isNaN(f.getTime())||(n.date??=f)}break;case"TYER":case"TYE":{const d=i.readId3V2EncodingAndText(a),f=Number.parseInt(d,10);Number.isInteger(f)&&(n.date??=new Date(f,0,1))}break;case"USLT":case"ULT":{const d=i.readU8();i.pos+=3,i.readId3V2Text(d,a),n.lyrics??=i.readId3V2Text(d,a)}break;case"COMM":case"COM":{const d=i.readU8();i.pos+=3,i.readId3V2Text(d,a),n.comment??=i.readId3V2Text(d,a)}break;case"APIC":case"PIC":{const d=i.readId3V2TextEncoding();let f;if(e.majorVersion===2){const g=i.readAscii(3);f=g==="PNG"?"image/png":g==="JPG"?"image/jpeg":"image/*"}else f=i.readId3V2Text(d,a);const h=i.readU8(),p=i.readId3V2Text(d,a).trimEnd(),m=a-i.pos;if(m>=0){const g=i.readBytes(m);n.images||(n.images=[]),n.images.push({data:g,mimeType:f,kind:h===3?"coverFront":h===4?"coverBack":"unknown",description:p})}}break;default:i.pos+=s.size;break}i.pos=a}};class ane{constructor(e,n){this.header=e,this.bytes=n,this.pos=0,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength)}frameHeaderSize(){return this.header.majorVersion===2?6:10}ununsynchronizeAll(){const e=[];for(let n=0;n<this.bytes.length;n++){const r=this.bytes[n];e.push(r),r===255&&n!==this.bytes.length-1&&this.bytes[n]===0&&n++}this.bytes=new Uint8Array(e),this.view=new DataView(this.bytes.buffer)}ununsynchronizeRegion(e,n){const r=[];for(let o=e;o<n;o++){const a=this.bytes[o];r.push(a),a===255&&o!==n-1&&this.bytes[o+1]===0&&o++}const i=this.bytes.subarray(0,e),s=this.bytes.subarray(n);this.bytes=new Uint8Array(i.length+r.length+s.length),this.bytes.set(i,0),this.bytes.set(r,i.length),this.bytes.set(s,i.length+r.length),this.view=new DataView(this.bytes.buffer)}removeFooter(){this.bytes=this.bytes.subarray(0,this.bytes.length-gy),this.view=new DataView(this.bytes.buffer)}readBytes(e){const n=this.bytes.subarray(this.pos,this.pos+e);return this.pos+=e,n}readU8(){const e=this.view.getUint8(this.pos);return this.pos+=1,e}readU16(){const e=this.view.getUint16(this.pos,!1);return this.pos+=2,e}readU24(){const e=this.view.getUint16(this.pos,!1),n=this.view.getUint8(this.pos+1);return this.pos+=3,e*256+n}readU32(){const e=this.view.getUint32(this.pos,!1);return this.pos+=4,e}readAscii(e){let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(this.view.getUint8(this.pos+r));return this.pos+=e,n}readId3V2Frame(){if(this.header.majorVersion===2){const e=this.readAscii(3);if(e==="\0\0\0")return null;const n=this.readU24();return{id:e,size:n,flags:0}}else{const e=this.readAscii(4);if(e==="\0\0\0\0")return null;const n=this.readU32();let r=this.header.majorVersion===4?Kx(n):n;const i=this.readU16(),s=this.pos,o=a=>{const l=this.pos+a;if(l>this.bytes.length)return!1;if(l<=this.bytes.length-this.frameHeaderSize()){this.pos+=a;const c=this.readAscii(4);if(c!=="\0\0\0\0"&&!/[0-9A-Z]{4}/.test(c))return!1}return!0};if(!o(r)){const a=this.header.majorVersion===4?n:Kx(n);o(a)&&(r=a)}return this.pos=s,{id:e,size:r,flags:i}}}readId3V2TextEncoding(){const e=this.readU8();if(e>3)throw new Error(`Unsupported text encoding: ${e}`);return e}readId3V2Text(e,n){const r=this.pos,i=this.readBytes(n-this.pos);switch(e){case Jd.ISO_8859_1:{let s="";for(let o=0;o<i.length;o++){const a=i[o];if(a===0){this.pos=r+o+1;break}s+=String.fromCharCode(a)}return s}case Jd.UTF_16_WITH_BOM:if(i[0]===255&&i[1]===254){const s=new TextDecoder("utf-16le"),o=zd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(2,o))}else if(i[0]===254&&i[1]===255){const s=new TextDecoder("utf-16be"),o=zd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(2,o))}else{const s=zd(i.findIndex(o=>o===0),i.length);return this.pos=r+Math.min(s+1,i.length),Fs.decode(i.subarray(0,s))}case Jd.UTF_16_BE_NO_BOM:{const s=new TextDecoder("utf-16be"),o=zd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(0,o))}case Jd.UTF_8:{const s=zd(i.findIndex(o=>o===0),i.length);return this.pos=r+Math.min(s+1,i.length),Fs.decode(i.subarray(0,s))}}}readId3V2EncodingAndText(e){if(this.pos>=e)return"";const n=this.readId3V2TextEncoding();return this.readId3V2Text(n,e)}}const Gx=async(t,e,n)=>{let r=e;for(;n===null||r<n;){let i=t.requestSlice(r,Ep);if(i instanceof Promise&&(i=await i),!i)break;const s=rt(i),o=cT(s,t.fileSize!==null?t.fileSize-r:null);if(o.header)return{header:o.header,startPos:r};r+=o.bytesAdvanced}return null};class lne extends Jc{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.metadataTags=null,this.tracks=[],this.readingMutex=new yd,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();if(!this.firstFrameHeader)throw new Error("No valid MP3 frame found.");this.tracks=[new ca(this.input,new cne(this))]})()}async advanceReader(){if(this.lastLoadedPos===0)for(;;){let a=this.reader.requestSlice(this.lastLoadedPos,gy);if(a instanceof Promise&&(a=await a),!a){this.lastSampleLoaded=!0;return}const l=yy(a);if(!l)break;this.lastLoadedPos=a.filePos+l.size}const e=await Gx(this.reader,this.lastLoadedPos,this.reader.fileSize);if(!e){this.lastSampleLoaded=!0;return}const n=e.header;this.lastLoadedPos=e.startPos+n.totalSize-1;const r=sne(n.mpegVersionId,n.channel);let i=this.reader.requestSlice(e.startPos+r,4);if(i instanceof Promise&&(i=await i),i){const a=rt(i);if(a===nne||a===rne)return}this.firstFrameHeader||(this.firstFrameHeader=n),n.sampleRate!==this.firstFrameHeader.sampleRate&&console.warn(`MP3 changed sample rate mid-file: ${this.firstFrameHeader.sampleRate} Hz to ${n.sampleRate} Hz. Might be a bug, so please report this file.`);const s=n.audioSamplesInFrame/this.firstFrameHeader.sampleRate,o={timestamp:this.nextTimestampInSamples/this.firstFrameHeader.sampleRate,duration:s,dataStart:e.startPos,dataSize:n.totalSize};this.loadedSamples.push(o),this.nextTimestampInSamples+=n.audioSamplesInFrame}async getMimeType(){return"audio/mpeg"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return W(e),e.computeDuration()}async getMetadataTags(){const e=await this.readingMutex.acquire();try{if(await this.readMetadata(),this.metadataTags)return this.metadataTags;this.metadataTags={};let n=0,r=!1;for(;;){let i=this.reader.requestSlice(n,gy);if(i instanceof Promise&&(i=await i),!i)break;const s=yy(i);if(!s)break;r=!0;let o=this.reader.requestSlice(i.filePos,s.size);if(o instanceof Promise&&(o=await o),!o)break;DD(o,s,this.metadataTags),n=i.filePos+s.size}if(!r&&this.reader.fileSize!==null&&this.reader.fileSize>=d0){let i=this.reader.requestSlice(this.reader.fileSize-d0,d0);i instanceof Promise&&(i=await i),W(i),Zr(i,3)==="TAG"&&one(i,this.metadataTags)}return this.metadataTags}finally{e()}}}class cne{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return W(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return cs}getCodec(){return"mp3"}getInternalCodecId(){return null}getNumberOfChannels(){return W(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.channel===3?1:2}getSampleRate(){return W(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}getDisposition(){return{...Qc}}async getDecoderConfig(){return W(this.demuxer.firstFrameHeader),{codec:"mp3",numberOfChannels:this.demuxer.firstFrameHeader.channel===3?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}}async getPacketAtIndex(e,n){if(e===-1)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=gs;else{let s=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize);if(s instanceof Promise&&(s=await s),!s)return null;i=St(s,r.dataSize)}return new Mn(i,"key",r.timestamp,r.duration,e,r.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=Gm(this.demuxer.loadedSamples,e.timestamp,o=>o.timestamp);if(i===-1)throw new Error("Packet was not created from this track.");const s=i+1;for(;s>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(s,n)}finally{r()}}async getPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=un(this.demuxer.loadedSamples,e,s=>s.timestamp);if(i===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(i,n);if(i>=0&&i+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(i,n);await this.demuxer.advanceReader()}}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const LD=1399285583,une=79764919,BD=new Uint32Array(256);for(let t=0;t<256;t++){let e=t<<24;for(let n=0;n<8;n++)e=e&2147483648?e<<1^une:e<<1;BD[t]=e>>>0&4294967295}const dne=t=>{const e=jn(t),n=e.getUint32(22,!0);e.setUint32(22,0,!0);let r=0;for(let i=0;i<t.length;i++){const s=t[i];r=(r<<8^BD[r>>>24^s])>>>0}return e.setUint32(22,n,!0),r},fne=(t,e,n)=>{let r=0,i=null;if(t.length>0)if(e.codec==="vorbis"){W(e.vorbisInfo);const s=e.vorbisInfo.modeBlockflags.length,a=(1<<Wee(s-1))-1<<1,l=(t[0]&a)>>1;if(l>=e.vorbisInfo.modeBlockflags.length)throw new Error("Invalid mode number.");let c=n;const u=e.vorbisInfo.modeBlockflags[l];if(i=e.vorbisInfo.blocksizes[u],u===1){const d=(a|1)+1,f=t[0]&d?1:0;c=e.vorbisInfo.blocksizes[f]}r=c!==null?c+i>>2:0}else e.codec==="opus"&&(r=Tte(t).durationInSamples);return{durationInSamples:r,vorbisBlockSize:i}},hne=t=>{let e="audio/ogg";if(t.codecStrings){const n=[...new Set(t.codecStrings)];e+=`; codecs="${n.join(", ")}"`}return e};const Pu=27,gf=282,pne=gf+65025,Tp=t=>{const e=t.filePos;if(rf(t)!==LD)return null;t.skip(1);const r=ht(t),i=ire(t),s=rf(t),o=rf(t),a=rf(t),l=ht(t),c=new Uint8Array(l);for(let h=0;h<l;h++)c[h]=ht(t);const u=27+l,d=c.reduce((h,p)=>h+p,0),f=u+d;return{headerStartPos:e,totalSize:f,dataStartPos:e+u,dataSize:d,headerType:r,granulePosition:i,serialNumber:s,sequenceNumber:o,checksum:a,lacingValues:c}},mne=(t,e)=>{for(;t.filePos<e-3;){const n=rf(t),r=n&255,i=n>>>8&255,s=n>>>16&255,o=n>>>24&255,a=79;if(!(r!==a&&i!==a&&s!==a&&o!==a)){if(t.skip(-4),n===LD)return!0;t.skip(1)}}return!1};class gne extends Jc{constructor(e){super(e),this.metadataPromise=null,this.bitstreams=[],this.tracks=[],this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,Pu,gf);if(n instanceof Promise&&(n=await n),!n)break;const r=Tp(n);if(!r||!!!(r.headerType&2))break;this.bitstreams.push({serialNumber:r.serialNumber,bosPage:r,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),e=r.headerStartPos+r.totalSize}for(const n of this.bitstreams){const r=await this.readPacket(n.bosPage,0);r&&(r.data.byteLength>=7&&r.data[0]===1&&r.data[1]===118&&r.data[2]===111&&r.data[3]===114&&r.data[4]===98&&r.data[5]===105&&r.data[6]===115?await this.readVorbisMetadata(r,n):r.data.byteLength>=8&&r.data[0]===79&&r.data[1]===112&&r.data[2]===117&&r.data[3]===115&&r.data[4]===72&&r.data[5]===101&&r.data[6]===97&&r.data[7]===100&&await this.readOpusMetadata(r,n),n.codecInfo.codec!==null&&this.tracks.push(new ca(this.input,new yne(n,this))))}})()}async readVorbisMetadata(e,n){let r=await this.findNextPacketStart(e);if(!r)return;const i=await this.readPacket(r.startPage,r.startSegmentIndex);if(!i||(r=await this.findNextPacketStart(i),!r))return;const s=await this.readPacket(r.startPage,r.startSegmentIndex);if(!s||i.data[0]!==3||s.data[0]!==5)return;const o=[],a=d=>{for(;o.push(Math.min(255,d)),!(d<255);)d-=255};a(e.data.length),a(i.data.length);const l=new Uint8Array(1+o.length+e.data.length+i.data.length+s.data.length);l[0]=2,l.set(o,1),l.set(e.data,1+o.length),l.set(i.data,1+o.length+e.data.length),l.set(s.data,1+o.length+e.data.length+i.data.length),n.codecInfo.codec="vorbis",n.description=l,n.lastMetadataPacket=s;const c=jn(e.data);n.numberOfChannels=c.getUint8(11),n.sampleRate=c.getUint32(12,!0);const u=c.getUint8(28);n.codecInfo.vorbisInfo={blocksizes:[1<<(u&15),1<<(u>>4)],modeBlockflags:Cte(s.data).modeBlockflags},zx(i.data.subarray(7),this.metadataTags)}async readOpusMetadata(e,n){const r=await this.findNextPacketStart(e);if(!r)return;const i=await this.readPacket(r.startPage,r.startSegmentIndex);if(!i)return;n.codecInfo.codec="opus",n.description=e.data,n.lastMetadataPacket=i;const s=xD(e.data);n.numberOfChannels=s.outputChannelCount,n.sampleRate=fw,n.codecInfo.opusInfo={preSkip:s.preSkip},zx(i.data.subarray(8),this.metadataTags)}async readPacket(e,n){W(n<e.lacingValues.length);let r=0;for(let d=0;d<n;d++)r+=e.lacingValues[d];let i=e,s=r,o=n;const a=[];e:for(;;){let d=this.reader.requestSlice(i.dataStartPos,i.dataSize);d instanceof Promise&&(d=await d),W(d);const f=St(d,i.dataSize);for(;;){if(o===i.lacingValues.length){a.push(f.subarray(r,s));break}const p=i.lacingValues[o];if(s+=p,p<255){a.push(f.subarray(r,s));break e}o++}let h=i.headerStartPos+i.totalSize;for(;;){let p=this.reader.requestSliceRange(h,Pu,gf);if(p instanceof Promise&&(p=await p),!p)return null;const m=Tp(p);if(!m)return null;if(i=m,i.serialNumber===e.serialNumber)break;h=i.headerStartPos+i.totalSize}r=0,s=0,o=0}const l=a.reduce((d,f)=>d+f.length,0);if(l===0)return null;const c=new Uint8Array(l);let u=0;for(let d=0;d<a.length;d++){const f=a[d];c.set(f,u),u+=f.length}return{data:c,endPage:i,endSegmentIndex:o}}async findNextPacketStart(e){if(e.endSegmentIndex<e.endPage.lacingValues.length-1)return{startPage:e.endPage,startSegmentIndex:e.endSegmentIndex+1};if(!!(e.endPage.headerType&4))return null;let r=e.endPage.headerStartPos+e.endPage.totalSize;for(;;){let i=this.reader.requestSliceRange(r,Pu,gf);if(i instanceof Promise&&(i=await i),!i)return null;const s=Tp(i);if(!s)return null;if(s.serialNumber===e.endPage.serialNumber)return{startPage:s,startSegmentIndex:0};r=s.headerStartPos+s.totalSize}}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(n=>n.getCodecParameterString()));return hne({codecStrings:e.filter(Boolean)})}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}class yne{constructor(e,n){this.bitstream=e,this.demuxer=n,this.encodedPacketToMetadata=new WeakMap,this.sequentialScanCache=[],this.sequentialScanMutex=new yd,this.internalSampleRate=e.codecInfo.codec==="opus"?fw:e.sampleRate}getId(){return this.bitstream.serialNumber}getNumberOfChannels(){return this.bitstream.numberOfChannels}getSampleRate(){return this.bitstream.sampleRate}getTimeResolution(){return this.bitstream.sampleRate}getCodec(){return this.bitstream.codecInfo.codec}getInternalCodecId(){return null}async getDecoderConfig(){return W(this.bitstream.codecInfo.codec),{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:this.bitstream.description??void 0}}getName(){return null}getLanguageCode(){return cs}getDisposition(){return{...Qc}}async getFirstTimestamp(){return 0}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}granulePositionToTimestampInSamples(e){return this.bitstream.codecInfo.codec==="opus"?(W(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}createEncodedPacketFromOggPacket(e,n,r){if(!e)return null;const{durationInSamples:i,vorbisBlockSize:s}=fne(e.data,this.bitstream.codecInfo,n.vorbisLastBlocksize),o=new Mn(r.metadataOnly?gs:e.data,"key",Math.max(0,n.timestampInSamples)/this.internalSampleRate,i/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(o,{packet:e,timestampInSamples:n.timestampInSamples,durationInSamples:i,vorbisLastBlockSize:n.vorbisLastBlocksize,vorbisBlockSize:s}),o}async getFirstPacket(e){W(this.bitstream.lastMetadataPacket);const n=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!n)return null;let r=0;this.bitstream.codecInfo.codec==="opus"&&(W(this.bitstream.codecInfo.opusInfo),r-=this.bitstream.codecInfo.opusInfo.preSkip);const i=await this.demuxer.readPacket(n.startPage,n.startSegmentIndex);return this.createEncodedPacketFromOggPacket(i,{timestampInSamples:r,vorbisLastBlocksize:null},e)}async getNextPacket(e,n){const r=this.encodedPacketToMetadata.get(e);if(!r)throw new Error("Packet was not created from this track.");const i=await this.demuxer.findNextPacketStart(r.packet);if(!i)return null;const s=r.timestampInSamples+r.durationInSamples,o=await this.demuxer.readPacket(i.startPage,i.startSegmentIndex);return this.createEncodedPacketFromOggPacket(o,{timestampInSamples:s,vorbisLastBlocksize:r.vorbisBlockSize},n)}async getPacket(e,n){if(this.demuxer.reader.fileSize===null)return this.getPacketSequential(e,n);const r=tm(e*this.internalSampleRate);if(r===0)return this.getFirstPacket(n);if(r<0)return null;W(this.bitstream.lastMetadataPacket);const i=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!i)return null;let s=i.startPage,o=this.demuxer.reader.fileSize;const a=[s];e:for(;s.headerStartPos+s.totalSize<o;){const b=s.headerStartPos,x=Math.floor((b+o)/2);let C=x;for(;;){const P=Math.min(C+pne,o-Pu);let S=this.demuxer.reader.requestSlice(C,P-C);if(S instanceof Promise&&(S=await S),W(S),!mne(S,P)){o=x+Pu;continue e}let k=this.demuxer.reader.requestSliceRange(S.filePos,Pu,gf);k instanceof Promise&&(k=await k),W(k);const T=Tp(k);W(T);let O=!1;if(T.serialNumber===this.bitstream.serialNumber)O=!0;else{let L=this.demuxer.reader.requestSlice(T.headerStartPos,T.totalSize);L instanceof Promise&&(L=await L),W(L);const F=St(L,T.totalSize);O=dne(F)===T.checksum}if(!O){C=T.headerStartPos+4;continue}if(O&&T.serialNumber!==this.bitstream.serialNumber){C=T.headerStartPos+T.totalSize;continue}if(T.granulePosition===-1){C=T.headerStartPos+T.totalSize;continue}this.granulePositionToTimestampInSamples(T.granulePosition)>r?o=T.headerStartPos:(s=T,a.push(T));continue e}}let l=i.startPage;for(const b of a){if(b.granulePosition===s.granulePosition)break;(!l||b.headerStartPos>l.headerStartPos)&&(l=b)}let c=l;const u=[c];for(;!(c.serialNumber===this.bitstream.serialNumber&&c.granulePosition===s.granulePosition);){const b=c.headerStartPos+c.totalSize;let x=this.demuxer.reader.requestSliceRange(b,Pu,gf);x instanceof Promise&&(x=await x),W(x);const C=Tp(x);W(C),c=C,c.serialNumber===this.bitstream.serialNumber&&u.push(c)}W(c.granulePosition!==-1);let d=null,f,h,p=c,m=0;if(c.headerStartPos===i.startPage.headerStartPos)f=this.granulePositionToTimestampInSamples(0),h=!0,d=0;else{f=0,h=!1;for(let C=c.lacingValues.length-1;C>=0;C--)if(c.lacingValues[C]<255){d=C+1;break}if(d===null)throw new Error("Invalid page with granule position: no packets end on this page.");m=d-1;const b={data:gs,endPage:p,endSegmentIndex:m};if(await this.demuxer.findNextPacketStart(b)){const C=XP(u,c,d);W(C);const P=ZP(u,C.page,C.segmentIndex);P&&(c=P.page,d=P.segmentIndex)}else for(;;){const C=XP(u,c,d);if(!C)break;const P=ZP(u,C.page,C.segmentIndex);if(!P)break;if(c=P.page,d=P.segmentIndex,C.page.headerStartPos!==p.headerStartPos){p=C.page,m=C.segmentIndex;break}}}let g=null,y=null;for(;c!==null;){W(d!==null);const b=await this.demuxer.readPacket(c,d);if(!b)break;if(!(c.headerStartPos===i.startPage.headerStartPos&&d<i.startSegmentIndex)){let P=this.createEncodedPacketFromOggPacket(b,{timestampInSamples:f,vorbisLastBlocksize:y?.vorbisBlockSize??null},n);W(P);let S=this.encodedPacketToMetadata.get(P);if(W(S),!h&&b.endPage.headerStartPos===p.headerStartPos&&b.endSegmentIndex===m?(f=this.granulePositionToTimestampInSamples(c.granulePosition),h=!0,P=this.createEncodedPacketFromOggPacket(b,{timestampInSamples:f-S.durationInSamples,vorbisLastBlocksize:y?.vorbisBlockSize??null},n),W(P),S=this.encodedPacketToMetadata.get(P),W(S)):f+=S.durationInSamples,g=P,y=S,h&&(Math.max(f,0)>r||Math.max(S.timestampInSamples,0)===r))break}const C=await this.demuxer.findNextPacketStart(b);if(!C)break;c=C.startPage,d=C.startSegmentIndex}return g}async getPacketSequential(e,n){const r=await this.sequentialScanMutex.acquire();try{const i=tm(e*this.internalSampleRate);e=i/this.internalSampleRate;const s=un(this.sequentialScanCache,i,l=>l.timestampInSamples);let o;if(s!==-1){const l=this.sequentialScanCache[s];o=this.createEncodedPacketFromOggPacket(l.packet,{timestampInSamples:l.timestampInSamples,vorbisLastBlocksize:l.vorbisLastBlockSize},n)}else o=await this.getFirstPacket(n);let a=0;for(;o&&o.timestamp<e;){const l=await this.getNextPacket(o,n);if(!l||l.timestamp>e)break;if(o=l,a++,a===100){a=0;const c=this.encodedPacketToMetadata.get(o);W(c),this.sequentialScanCache.length>0&&W(Wn(this.sequentialScanCache).timestampInSamples<=c.timestampInSamples),this.sequentialScanCache.push(c)}}return o}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const ZP=(t,e,n)=>{let r=e,i=n;e:for(;;){for(i--,i;i>=0;i--)if(r.lacingValues[i]<255){i++;break e}if(W(i===-1),!(r.headerType&1)){i=0;break}const o=iD(t,a=>a.headerStartPos<r.headerStartPos);if(!o)return null;r=o,i=r.lacingValues.length}if(W(i!==-1),i===r.lacingValues.length){const s=t[t.indexOf(r)+1];W(s),r=s,i=0}return{page:r,segmentIndex:i}},XP=(t,e,n)=>{if(n>0)return{page:e,segmentIndex:n-1};const r=iD(t,i=>i.headerStartPos<e.headerStartPos);return r?{page:r,segmentIndex:r.lacingValues.length-1}:null};var Pa;(function(t){t[t.PCM=1]="PCM",t[t.IEEE_FLOAT=3]="IEEE_FLOAT",t[t.ALAW=6]="ALAW",t[t.MULAW=7]="MULAW",t[t.EXTENSIBLE=65534]="EXTENSIBLE"})(Pa||(Pa={}));class bne extends Jc{constructor(e){super(e),this.metadataPromise=null,this.dataStart=-1,this.dataSize=-1,this.audioInfo=null,this.tracks=[],this.lastKnownPacketIndex=0,this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=this.reader.requestSlice(0,12);e instanceof Promise&&(e=await e),W(e);const n=Zr(e,4),r=n!=="RIFX",i=n==="RF64",s=hc(e,r);let o=i?this.reader.fileSize:Math.min(s+8,this.reader.fileSize??1/0);if(Zr(e,4)!=="WAVE")throw new Error("Invalid WAVE file - wrong format");let l=0,c=null,u=e.filePos;for(;o===null||u<o;){let f=this.reader.requestSlice(u,8);if(f instanceof Promise&&(f=await f),!f)break;const h=Zr(f,4),p=hc(f,r),m=f.filePos;if(i&&l===0&&h!=="ds64")throw new Error('Invalid RF64 file: First chunk must be "ds64".');if(h==="fmt ")await this.parseFmtChunk(m,p,r);else if(h==="data"){if(c??=p,this.dataStart=f.filePos,this.dataSize=Math.min(c,(o??1/0)-this.dataStart),this.reader.fileSize===null)break}else if(h==="ds64"){let g=this.reader.requestSlice(m,p);if(g instanceof Promise&&(g=await g),!g)break;const y=JP(g,r);c=JP(g,r),o=Math.min(y+8,this.reader.fileSize??1/0)}else h==="LIST"?await this.parseListChunk(m,p,r):(h==="ID3 "||h==="id3 ")&&await this.parseId3Chunk(m,p);u=m+p+(p&1),l++}if(!this.audioInfo)throw new Error('Invalid WAVE file - missing "fmt " chunk');if(this.dataStart===-1)throw new Error('Invalid WAVE file - missing "data" chunk');const d=this.audioInfo.blockSizeInBytes;this.dataSize=Math.floor(this.dataSize/d)*d,this.tracks.push(new ca(this.input,new wne(this)))})()}async parseFmtChunk(e,n,r){let i=this.reader.requestSlice(e,n);if(i instanceof Promise&&(i=await i),!i)return;let s=Fh(i,r);const o=Fh(i,r),a=hc(i,r);i.skip(4);const l=Fh(i,r);let c;if(n===14?c=8:c=Fh(i,r),n>=18&&s!==357){const u=Fh(i,r),d=n-18;if(Math.min(d,u)>=22&&s===Pa.EXTENSIBLE){i.skip(6);const h=St(i,16);s=h[0]|h[1]<<8}}(s===Pa.MULAW||s===Pa.ALAW)&&(c=8),this.audioInfo={format:s,numberOfChannels:o,sampleRate:a,sampleSizeInBytes:Math.ceil(c/8),blockSizeInBytes:l}}async parseListChunk(e,n,r){let i=this.reader.requestSlice(e,n);if(i instanceof Promise&&(i=await i),!i)return;const s=Zr(i,4);if(s!=="INFO"&&s!=="INF0")return;let o=i.filePos;for(;o<=e+n-8;){i.filePos=o;const a=Zr(i,4),l=hc(i,r),c=St(i,l);let u=0;for(let f=0;f<c.length&&c[f]!==0;f++)u++;const d=String.fromCharCode(...c.subarray(0,u));switch(this.metadataTags.raw??={},this.metadataTags.raw[a]=d,a){case"INAM":case"TITL":this.metadataTags.title??=d;break;case"TIT3":this.metadataTags.description??=d;break;case"IART":this.metadataTags.artist??=d;break;case"IPRD":this.metadataTags.album??=d;break;case"IPRT":case"ITRK":case"TRCK":{const f=d.split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(this.metadataTags.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(this.metadataTags.tracksTotal??=p)}break;case"ICRD":case"IDIT":{const f=new Date(d);Number.isNaN(f.getTime())||(this.metadataTags.date??=f)}break;case"YEAR":{const f=Number.parseInt(d,10);Number.isInteger(f)&&f>0&&(this.metadataTags.date??=new Date(f,0,1))}break;case"IGNR":case"GENR":this.metadataTags.genre??=d;break;case"ICMT":case"CMNT":case"COMM":this.metadataTags.comment??=d;break}o+=8+l+(l&1)}}async parseId3Chunk(e,n){let r=this.reader.requestSlice(e,n);if(r instanceof Promise&&(r=await r),!r)return;const i=yy(r);if(i){const s=r.slice(e+10,i.size);DD(s,i,this.metadataTags)}}getCodec(){if(W(this.audioInfo),this.audioInfo.format===Pa.MULAW)return"ulaw";if(this.audioInfo.format===Pa.ALAW)return"alaw";if(this.audioInfo.format===Pa.PCM){if(this.audioInfo.sampleSizeInBytes===1)return"pcm-u8";if(this.audioInfo.sampleSizeInBytes===2)return"pcm-s16";if(this.audioInfo.sampleSizeInBytes===3)return"pcm-s24";if(this.audioInfo.sampleSizeInBytes===4)return"pcm-s32"}return this.audioInfo.format===Pa.IEEE_FLOAT&&this.audioInfo.sampleSizeInBytes===4?"pcm-f32":null}async getMimeType(){return"audio/wav"}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return W(e),e.computeDuration()}async getTracks(){return await this.readMetadata(),this.tracks}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}const Rd=2048;class wne{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return this.demuxer.getCodec()}getInternalCodecId(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.format}async getDecoderConfig(){const e=this.demuxer.getCodec();return e?(W(this.demuxer.audioInfo),{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}):null}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getNumberOfChannels(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}getSampleRate(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getTimeResolution(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return cs}getDisposition(){return{...Qc}}async getFirstTimestamp(){return 0}async getPacketAtIndex(e,n){W(this.demuxer.audioInfo);const r=e*Rd*this.demuxer.audioInfo.blockSizeInBytes;if(r>=this.demuxer.dataSize)return null;const i=Math.min(Rd*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-r);if(this.demuxer.reader.fileSize===null){let l=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,i);if(l instanceof Promise&&(l=await l),!l)return null}let s;if(n.metadataOnly)s=gs;else{let l=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,i);l instanceof Promise&&(l=await l),W(l),s=St(l,i)}const o=e*Rd/this.demuxer.audioInfo.sampleRate,a=i/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate;return this.demuxer.lastKnownPacketIndex=Math.max(e,o),new Mn(s,"key",o,a,e,i)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getPacket(e,n){W(this.demuxer.audioInfo);const r=Math.floor(Math.min(e*this.demuxer.audioInfo.sampleRate/Rd,(this.demuxer.dataSize-1)/(Rd*this.demuxer.audioInfo.blockSizeInBytes))),i=await this.getPacketAtIndex(r,n);if(i)return i;if(r===0)return null;W(this.demuxer.reader.fileSize===null);let s=await this.getPacketAtIndex(this.demuxer.lastKnownPacketIndex,n);for(;s;){const o=await this.getNextPacket(s,n);if(!o)break;s=o}return s}getNextPacket(e,n){W(this.demuxer.audioInfo);const r=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/Rd);return this.getPacketAtIndex(r+1,n)}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const by=7,zu=9,sd=t=>{const e=t.filePos,n=St(t,9),r=new Ln(n);if(r.readBits(12)!==4095||(r.skipBits(1),r.readBits(2)!==0))return null;const o=r.readBits(1),a=r.readBits(2)+1,l=r.readBits(4);if(l===15)return null;r.skipBits(1);const c=r.readBits(3);if(c===0)throw new Error("ADTS frames with channel configuration 0 are not supported.");r.skipBits(1),r.skipBits(1),r.skipBits(1),r.skipBits(1);const u=r.readBits(13);r.skipBits(11);const d=r.readBits(2)+1;if(d!==1)throw new Error("ADTS frames with more than one AAC frame are not supported.");let f=null;return o===1?t.filePos-=2:f=r.readBits(16),{objectType:a,samplingFrequencyIndex:l,channelConfiguration:c,frameLength:u,numberOfAacFrames:d,crcCheck:f,startPos:e}};const wy=1024;class vne extends Jc{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.tracks=[],this.readingMutex=new yd,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();W(this.firstFrameHeader),this.tracks=[new ca(this.input,new xne(this))]})()}async advanceReader(){let e=this.reader.requestSliceRange(this.lastLoadedPos,by,zu);if(e instanceof Promise&&(e=await e),!e){this.lastSampleLoaded=!0;return}const n=sd(e);if(!n){this.lastSampleLoaded=!0;return}if(this.reader.fileSize!==null&&n.startPos+n.frameLength>this.reader.fileSize){this.lastSampleLoaded=!0;return}this.firstFrameHeader||(this.firstFrameHeader=n);const r=id[n.samplingFrequencyIndex];W(r!==void 0);const i=wy/r,s={timestamp:this.nextTimestampInSamples/r,duration:i,dataStart:n.startPos,dataSize:n.frameLength};this.loadedSamples.push(s),this.nextTimestampInSamples+=wy,this.lastLoadedPos=n.startPos+n.frameLength}async getMimeType(){return"audio/aac"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return W(e),e.computeDuration()}async getMetadataTags(){return{}}}class xne{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return this.getSampleRate()/wy}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return cs}getCodec(){return"aac"}getInternalCodecId(){return W(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.objectType}getNumberOfChannels(){W(this.demuxer.firstFrameHeader);const e=Zm[this.demuxer.firstFrameHeader.channelConfiguration];return W(e!==void 0),e}getSampleRate(){W(this.demuxer.firstFrameHeader);const e=id[this.demuxer.firstFrameHeader.samplingFrequencyIndex];return W(e!==void 0),e}getDisposition(){return{...Qc}}async getDecoderConfig(){return W(this.demuxer.firstFrameHeader),{codec:`mp4a.40.${this.demuxer.firstFrameHeader.objectType}`,numberOfChannels:this.getNumberOfChannels(),sampleRate:this.getSampleRate()}}async getPacketAtIndex(e,n){if(e===-1)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=gs;else{let s=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize);if(s instanceof Promise&&(s=await s),!s)return null;i=St(s,r.dataSize)}return new Mn(i,"key",r.timestamp,r.duration,e,r.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=Gm(this.demuxer.loadedSamples,e.timestamp,o=>o.timestamp);if(i===-1)throw new Error("Packet was not created from this track.");const s=i+1;for(;s>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(s,n)}finally{r()}}async getPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=un(this.demuxer.loadedSamples,e,s=>s.timestamp);if(i===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(i,n);if(i>=0&&i+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(i,n);await this.demuxer.advanceReader()}}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const Sne=t=>t===0?null:t===1?192:t>=2&&t<=5?144*2**t:t===6?"uncommon-u8":t===7?"uncommon-u16":t>=8&&t<=15?2**t:null,kne=(t,e)=>{switch(t){case 0:return e;case 1:return 88200;case 2:return 176400;case 3:return 192e3;case 4:return 8e3;case 5:return 16e3;case 6:return 22050;case 7:return 24e3;case 8:return 32e3;case 9:return 44100;case 10:return 48e3;case 11:return 96e3;case 12:return"uncommon-u8";case 13:return"uncommon-u16";case 14:return"uncommon-u16-10";default:return null}},Ene=t=>{let e=0;const n=new Ln(St(t,1));for(;n.readBits(1)===1;)e++;if(e===0)return n.readBits(7);const r=[],i=e-1,s=new Ln(St(t,i)),o=8-e-1;for(let l=0;l<o;l++)r.unshift(n.readBits(1));for(let l=0;l<i;l++)for(let c=0;c<8;c++){const u=s.readBits(1);c<2||r.unshift(u)}return r.reduce((l,c,u)=>l|c<<u,0)},Tne=(t,e)=>{if(e==="uncommon-u16")return Fr(t)+1;if(e==="uncommon-u8")return ht(t)+1;if(typeof e=="number")return e;zc(e),W(!1)},Cne=(t,e)=>e==="uncommon-u16"?Fr(t):e==="uncommon-u16-10"?Fr(t)*10:e==="uncommon-u8"?ht(t):typeof e=="number"?e:null,_ne=t=>{let n=0;for(const r of t){n^=r;for(let i=0;i<8;i++)(n&128)!==0?n=n<<1^7:n<<=1,n&=255}return n};class Ane extends Jc{constructor(e){super(e),this.loadedSamples=[],this.metadataPromise=null,this.track=null,this.metadataTags={},this.audioInfo=null,this.lastLoadedPos=null,this.blockingBit=null,this.readingMutex=new yd,this.lastSampleLoaded=!1,this.reader=e._reader}async computeDuration(){return await this.readMetadata(),W(this.track),this.track.computeDuration()}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}async getTracks(){return await this.readMetadata(),W(this.track),[this.track]}async getMimeType(){return"audio/flac"}async readMetadata(){let e=4;return this.metadataPromise??=(async()=>{for(;this.reader.fileSize===null||e<this.reader.fileSize;){let n=this.reader.requestSlice(e,4);if(n instanceof Promise&&(n=await n),e+=4,n===null)throw new Error(`Metadata block at position ${e} is too small! Corrupted file.`);W(n);const r=ht(n),i=Wd(n),s=(r&128)!==0;switch(r&127){case mf.STREAMINFO:{let a=this.reader.requestSlice(e,i);if(a instanceof Promise&&(a=await a),W(a),a===null)throw new Error(`StreamInfo block at position ${e} is too small! Corrupted file.`);const l=St(a,34),c=new Ln(l),u=c.readBits(16),d=c.readBits(16),f=c.readBits(24),h=c.readBits(24),p=c.readBits(20),m=c.readBits(3)+1;c.readBits(5);const g=c.readBits(36);c.skipBits(128);const y=new Uint8Array(42);y.set(new Uint8Array([102,76,97,67]),0),y.set(new Uint8Array([128,0,0,34]),4),y.set(l,8),this.audioInfo={numberOfChannels:m,sampleRate:p,totalSamples:g,minimumBlockSize:u,maximumBlockSize:d,minimumFrameSize:f,maximumFrameSize:h,description:y},this.track=new ca(this.input,new Pne(this));break}case mf.VORBIS_COMMENT:{let a=this.reader.requestSlice(e,i);a instanceof Promise&&(a=await a),W(a),zx(St(a,i),this.metadataTags);break}case mf.PICTURE:{let a=this.reader.requestSlice(e,i);a instanceof Promise&&(a=await a),W(a);const l=rt(a),c=rt(a),u=Fs.decode(St(a,c)),d=rt(a),f=Fs.decode(St(a,d));a.skip(16);const h=rt(a),p=St(a,h);this.metadataTags.images??=[],this.metadataTags.images.push({data:p,mimeType:u,kind:l===3?"coverFront":l===4?"coverBack":"unknown",description:f});break}}if(e+=i,s){this.lastLoadedPos=e;break}}})()}async readNextFlacFrame({startPos:e,isFirstPacket:n}){W(this.audioInfo);const r=6,s=this.audioInfo.maximumFrameSize+16,o=await this.reader.requestSliceRange(e,this.audioInfo.minimumFrameSize,s);if(!o)return null;const a=this.readFlacFrameHeader({slice:o,isFirstPacket:n});if(!a)return null;for(o.filePos=e+this.audioInfo.minimumFrameSize;;){if(o.filePos>o.end-r)return{num:a.num,blockSize:a.blockSize,sampleRate:a.sampleRate,size:o.end-e,isLastFrame:!0};if(ht(o)===255){const c=o.filePos,u=ht(o),d=this.blockingBit===1?249:248;if(u!==d){o.filePos=c;continue}o.skip(-2);const f=o.filePos-e,h=this.readFlacFrameHeader({slice:o,isFirstPacket:!1});if(!h){o.filePos=c;continue}if(this.blockingBit===0){if(h.num-a.num!==1){o.filePos=c;continue}}else if(h.num-a.num!==a.blockSize){o.filePos=c;continue}return{num:a.num,blockSize:a.blockSize,sampleRate:a.sampleRate,size:f,isLastFrame:!1}}}}readFlacFrameHeader({slice:e,isFirstPacket:n}){const r=e.filePos,i=St(e,4),s=new Ln(i);if(s.readBits(15)!==32764)return null;if(this.blockingBit===null){W(n);const g=s.readBits(1);this.blockingBit=g}else if(this.blockingBit===1){if(W(!n),s.readBits(1)!==1)return null}else if(this.blockingBit===0){if(W(!n),s.readBits(1)!==0)return null}else throw new Error("Invalid blocking bit");const a=Sne(s.readBits(4));if(!a)return null;W(this.audioInfo);const l=kne(s.readBits(4),this.audioInfo.sampleRate);if(!l||(s.readBits(4),s.readBits(3),s.readBits(1)!==0))return null;const u=Ene(e),d=Tne(e,a),f=Cne(e,l);if(f===null||f!==this.audioInfo.sampleRate)return null;const h=e.filePos-r,p=ht(e);e.skip(-h),e.skip(-1);const m=_ne(St(e,h));return p!==m?null:{num:u,blockSize:d,sampleRate:f}}async advanceReader(){await this.readMetadata(),W(this.lastLoadedPos!==null),W(this.audioInfo);const e=this.lastLoadedPos,n=await this.readNextFlacFrame({startPos:e,isFirstPacket:this.loadedSamples.length===0});if(!n){this.lastSampleLoaded=!0;return}const r=this.loadedSamples[this.loadedSamples.length-1],s={blockOffset:r?r.blockOffset+r.blockSize:0,blockSize:n.blockSize,byteOffset:e,byteSize:n.size};if(this.lastLoadedPos=this.lastLoadedPos+n.size,this.loadedSamples.push(s),n.isLastFrame){this.lastSampleLoaded=!0;return}}}class Pne{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return"flac"}getInternalCodecId(){return null}getNumberOfChannels(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getSampleRate(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return cs}getTimeResolution(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getDisposition(){return{...Qc}}async getFirstTimestamp(){return 0}async getDecoderConfig(){return W(this.demuxer.audioInfo),{codec:"flac",numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate,description:this.demuxer.audioInfo.description}}async getPacket(e,n){if(W(this.demuxer.audioInfo),e<0)throw new Error("Timestamp cannot be negative");const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=un(this.demuxer.loadedSamples,e,l=>l.blockOffset/this.demuxer.audioInfo.sampleRate);if(i===-1){await this.demuxer.advanceReader();continue}const s=this.demuxer.loadedSamples[i],o=s.blockOffset/this.demuxer.audioInfo.sampleRate,a=s.blockSize/this.demuxer.audioInfo.sampleRate;if(o+a<=e){if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(this.demuxer.loadedSamples.length-1,n);await this.demuxer.advanceReader();continue}return this.getPacketAtIndex(i,n)}}finally{r()}}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=e.sequenceNumber+1;if(this.demuxer.lastSampleLoaded&&i>=this.demuxer.loadedSamples.length)return null;for(;i>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(i,n)}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}async getPacketAtIndex(e,n){const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=gs;else{let a=this.demuxer.reader.requestSlice(r.byteOffset,r.byteSize);if(a instanceof Promise&&(a=await a),!a)return null;i=St(a,r.byteSize)}W(this.demuxer.audioInfo);const s=r.blockOffset/this.demuxer.audioInfo.sampleRate,o=r.blockSize/this.demuxer.audioInfo.sampleRate;return new Mn(i,"key",s,o,e,r.byteSize)}async getFirstPacket(e){for(;this.demuxer.loadedSamples.length===0&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(0,e)}}const Ia=9e4,rs=188,Ine=t=>{let e="video/MP2T";const n=[...new Set(t.filter(Boolean))];return n.length>0&&(e+=`; codecs="${n.join(", ")}"`),e};const Hd="No PES packet found where one was expected.";class One extends Jc{constructor(e){super(e),this.metadataPromise=null,this.elementaryStreams=[],this.tracks=[],this.packetOffset=0,this.packetStride=-1,this.sectionEndPositions=[],this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{const e=rs+16+1;let n=this.reader.requestSlice(0,e);n instanceof Promise&&(n=await n),W(n);const r=St(n,e);if(r[0]===71&&r[rs]===71)this.packetOffset=0,this.packetStride=rs;else if(r[0]===71&&r[rs+16]===71)this.packetOffset=0,this.packetStride=rs+16;else if(r[4]===71&&r[4+rs]===71)this.packetOffset=4,this.packetStride=rs;else throw new Error("Unreachable.");let i=this.packetOffset,s=null,o=!1,a=!1;for(;;){const l=await this.readSection(i,!0,!a);if(!l)break;const c=3,u=32;if(l.pid===0&&!o){const f=new Ln(l.payload),h=f.readAlignedByte();f.skipBits(8*h),f.skipBits(14);const p=f.readBits(10);for(f.skipBits(40);8*(p+c)-f.pos>u;){const m=f.readBits(16);if(f.skipBits(3),m!==0){if(s!==null)throw new Error("Only files with a single program are supported.");s=f.readBits(13)}}if(s===null)throw new Error("Program Association Table must link to a Program Map Table.");o=!0}else if(l.pid===s&&!a){const f=new Ln(l.payload),h=f.readAlignedByte();f.skipBits(8*h),f.skipBits(12);const p=f.readBits(12);f.skipBits(43),f.readBits(13),f.skipBits(6);const m=f.readBits(10);for(f.skipBits(8*m);8*(p+c)-f.pos>u;){const g=f.readBits(8);f.skipBits(3);const y=f.readBits(13);f.skipBits(6);const b=f.readBits(10);f.skipBits(8*b);let x=null;switch(g){case 3:case 4:case 15:x={type:"audio",codec:g===15?"aac":"mp3",aacCodecInfo:null,numberOfChannels:-1,sampleRate:-1};break;case 27:case 36:x={type:"video",codec:g===27?"avc":"hevc",avcCodecInfo:null,hevcCodecInfo:null,colorSpace:{primaries:null,transfer:null,matrix:null,fullRange:null},width:-1,height:-1,reorderSize:-1};break}x&&this.elementaryStreams.push({demuxer:this,pid:y,streamType:g,initialized:!1,firstSection:null,info:x})}a=!0}else{const f=this.elementaryStreams.find(h=>h.pid===l.pid);if(f&&!f.initialized){const h=tf(l);if(!h)throw new Error(`Couldn't read first PES packet for Elementary Stream with PID ${f.pid}`);if(f.firstSection=l,f.info.type==="video")if(f.info.codec==="avc"){if(f.info.avcCodecInfo=eT(h.data),!f.info.avcCodecInfo)throw new Error("Invalid AVC video stream; could not extract AVCDecoderConfigurationRecord from first packet.");const p=f.info.avcCodecInfo.sequenceParameterSets[0];W(p);const m=tT(p);f.info.width=m.displayWidth,f.info.height=m.displayHeight,f.info.colorSpace={primaries:uy[m.colourPrimaries],transfer:dy[m.transferCharacteristics],matrix:fy[m.matrixCoefficients],fullRange:!!m.fullRangeFlag},f.info.reorderSize=m.maxDecFrameBuffering,f.initialized=!0}else if(f.info.codec==="hevc"){if(f.info.hevcCodecInfo=nT(h.data),!f.info.hevcCodecInfo)throw new Error("Invalid HEVC video stream; could not extract HVCDecoderConfigurationRecord from first packet.");const m=f.info.hevcCodecInfo.arrays.find(y=>y.nalUnitType===ui.SPS_NUT).nalUnits[0];W(m);const g=yD(m);f.info.width=g.displayWidth,f.info.height=g.displayHeight,f.info.colorSpace={primaries:uy[g.colourPrimaries],transfer:dy[g.transferCharacteristics],matrix:fy[g.matrixCoefficients],fullRange:!!g.fullRangeFlag},f.info.reorderSize=g.maxDecFrameBuffering,f.initialized=!0}else throw new Error("Unhandled.");else if(f.info.codec==="aac"){const p=uo.tempFromBytes(h.data),m=sd(p);if(!m)throw new Error("Invalid AAC audio stream; could not read ADTS frame header from first packet.");f.info.aacCodecInfo={isMpeg2:!1,objectType:m.objectType},f.info.numberOfChannels=Zm[m.channelConfiguration],f.info.sampleRate=id[m.samplingFrequencyIndex],f.initialized=!0}else if(f.info.codec==="mp3"){const p=rt(uo.tempFromBytes(h.data)),m=cT(p,h.data.byteLength);if(!m.header)throw new Error("Invalid MP3 audio stream; could not read frame header from first packet.");f.info.numberOfChannels=m.header.channel===3?1:2,f.info.sampleRate=m.header.sampleRate,f.initialized=!0}else throw new Error("Unhandled.")}}if(a&&this.elementaryStreams.every(f=>f.initialized))break;W(l.endPos!==null),i=l.endPos}for(const l of this.elementaryStreams)l.info.type==="video"?this.tracks.push(new ch(this.input,new Mne(l))):this.tracks.push(new ca(this.input,new Nne(l)))})()}async getTracks(){return await this.readMetadata(),this.tracks}async getMetadataTags(){return{}}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.getCodecParameterString()));return Ine(n)}async readSection(e,n,r=!1){let i=e,s=e;const o=[];let a=0,l=null,c=!0;for(;;){const d=await this.readPacket(s);if(s+=this.packetStride,!d)break;if(l){if(d.pid!==l.pid){if(r)break;continue}if(d.payloadUnitStartIndicator===1)break}else{if(d.payloadUnitStartIndicator===0)break;l=d}const f=!!(d.adaptationFieldControl&2),h=!!(d.adaptationFieldControl&1);let p=0;if(f&&(p=1+d.body[0]),h&&(p===0?(o.push(d.body),a+=d.body.byteLength):(o.push(d.body.subarray(p)),a+=d.body.byteLength-p)),i=s,!n&&a>=64){c=!1;break}if(Gm(this.sectionEndPositions,i,g=>g)!==-1){c=!1;break}}if(c){const d=un(this.sectionEndPositions,i,f=>f);this.sectionEndPositions.splice(d+1,0,i)}if(!l)return null;let u;if(o.length===1)u=o[0];else{const d=o.reduce((h,p)=>h+p.length,0);u=new Uint8Array(d);let f=0;for(const h of o)u.set(h,f),f+=h.length}return{startPos:e,endPos:n?i:null,pid:l.pid,payload:u}}async readPacketHeader(e){let n=this.reader.requestSlice(e,4);if(n instanceof Promise&&(n=await n),!n)return null;if(ht(n)!==71)throw new Error("Invalid TS packet sync byte. Likely an internal bug, please report this file.");const i=Fr(n),s=i>>14&1,o=i&8191,l=ht(n)>>4&3;return{payloadUnitStartIndicator:s,pid:o,adaptationFieldControl:l}}async readPacket(e){let n=this.reader.requestSlice(e,rs);if(n instanceof Promise&&(n=await n),!n)return null;const r=St(n,rs);if(r[0]!==71)throw new Error("Invalid TS packet sync byte. Likely an internal bug, please report this file.");const s=(r[1]<<8)+r[2],o=s>>14&1,a=s&8191,c=r[3]>>4&3;return{payloadUnitStartIndicator:o,pid:a,adaptationFieldControl:c,body:r.subarray(4)}}}const Vd=t=>{const e=new Ln(t.payload);if(e.readBits(24)!==1)return null;const r=e.readBits(8);if(e.skipBits(16),r===188||r===190||r===191||r===240||r===241||r===255||r===242||r===248)return null;e.skipBits(8);const i=e.readBits(2);e.skipBits(14);let s=0;if(i===2||i===3)e.skipBits(4),s+=e.readBits(3)*(1<<30),e.skipBits(1),s+=e.readBits(15)*32768,e.skipBits(1),s+=e.readBits(15);else throw new Error("PES packets without PTS are not currently supported. If you think this file should be supported, please report it.");return{sectionStartPos:t.startPos,sectionEndPos:t.endPos,pts:s}},tf=t=>{W(t.endPos!==null);const e=Vd(t);if(!e)return null;const n=new Ln(t.payload);n.skipBits(32);const r=n.readBits(16),i=6;n.skipBits(16);const s=n.readBits(8),o=n.pos+8*s;n.pos=o;const a=o/8;W(Number.isInteger(a));const l=t.payload.subarray(a,r>0?i+r:t.payload.byteLength);return{...e,data:l}};class FD{constructor(e){this.elementaryStream=e,this.referencePesPackets=[],this.endReferencePesPacketAdded=!1,this.packetBuffers=new WeakMap,this.packetSectionStarts=new WeakMap,this.mutex=new yd}getId(){return this.elementaryStream.pid}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.elementaryStream.streamType}getName(){return null}getLanguageCode(){return cs}getDisposition(){return Qc}getTimeResolution(){return Ia}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}createEncodedPacket(e,n,r){return new Mn(r.metadataOnly?gs:e.data,this.getPacketType(e.data),e.pts/Ia,Math.max(n/Ia,0),e.sequenceNumber,e.data.byteLength)}maybeInsertReferencePacket(e,n,r){if(r&&this.mutex.pending>0)return;const i=un(this.referencePesPackets,e.pts,s=>s.pts);if(i>=0){const s=this.referencePesPackets[i];if(e.sectionStartPos<=s.sectionStartPos||!n&&e.pts-s.pts<Ia/2)return!1;if(i<this.referencePesPackets.length-1){const o=this.referencePesPackets[i+1];if(o.sectionStartPos<e.sectionStartPos||!n&&o.pts-e.pts<Ia/2)return!1}}return this.referencePesPackets.splice(i+1,0,e),!0}async getFirstPacket(e){const n=this.elementaryStream.firstSection;W(n);const r=tf(n);W(r);const i=new nf(this,r,!0),s=new Mg(this,i),o=await s.readNext();if(!o)return null;const a=this.createEncodedPacket(o.packet,o.duration,e);return this.packetBuffers.set(a,s),this.packetSectionStarts.set(a,o.packet.sectionStartPos),a}async getNextPacket(e,n){let r=this.packetBuffers.get(e);if(r){const u=await r.readNext();if(!u)return null;this.packetBuffers.delete(e);const d=this.createEncodedPacket(u.packet,u.duration,n);return this.packetBuffers.set(d,r),this.packetSectionStarts.set(d,u.packet.sectionStartPos),d}const i=this.packetSectionStarts.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");const o=await this.elementaryStream.demuxer.readSection(i,!0);W(o);const a=tf(o);W(a);const l=new nf(this,a,!0);r=new Mg(this,l);const c=e.sequenceNumber;for(;;){const u=await r.readNext();if(!u)return null;if(u.packet.sequenceNumber>c){const d=this.createEncodedPacket(u.packet,u.duration,n);return this.packetBuffers.set(d,r),this.packetSectionStarts.set(d,u.packet.sectionStartPos),d}}}async getNextKeyPacket(e,n){let r=e;for(;;){if(r=await this.getNextPacket(r,n),!r)return null;if(r.type==="key")return r}}getPacket(e,n){return this.doPacketLookup(e,!1,n)}getKeyPacket(e,n){return this.doPacketLookup(e,!0,n)}async doPacketLookup(e,n,r){const i=tm(e*Ia),s=this.elementaryStream.demuxer,o=s.reader,a=await this.mutex.acquire();let l;try{if(this.referencePesPackets.length===0){const b=this.elementaryStream.firstSection;W(b);const x=Vd(b);W(x),this.maybeInsertReferencePacket(x,!1,!1),W(this.referencePesPackets.length===1)}let g=un(this.referencePesPackets,i,b=>b.pts);if(g===-1)return null;if(o.fileSize!==null&&g===this.referencePesPackets.length-1&&!this.endReferencePesPacketAdded){let b=o.fileSize-s.packetStride+s.packetOffset,x=await s.readPacketHeader(b);if(!x)return null;for(;x.pid!==this.elementaryStream.pid||x.payloadUnitStartIndicator===0;){b-=s.packetStride;const S=await s.readPacketHeader(b);if(!S)return null;x=S}const C=await s.readSection(b,!1);W(C);const P=Vd(C);if(!P)throw new Error(Hd);this.maybeInsertReferencePacket(P,!0,!1),this.endReferencePesPacketAdded=!0}for(g=un(this.referencePesPackets,i,b=>b.pts),W(g!==-1);o.fileSize!==null;){const b=this.referencePesPackets[g],x=this.referencePesPackets[g+1];if(i-b.pts<Ia||!x)break;let P=sD((b.sectionStartPos+x.sectionStartPos)/2,s.packetStride)+s.packetOffset,S=await s.readPacketHeader(P);for(W(S);P<x.sectionStartPos&&(S.pid!==this.elementaryStream.pid||S.payloadUnitStartIndicator===0);){P+=s.packetStride;const O=await s.readPacketHeader(P);if(!O)return null;S=O}if(P>=x.sectionStartPos)break;const _=await s.readSection(P,!1);W(_);const k=Vd(_);if(!k)throw new Error(Hd);if(!this.maybeInsertReferencePacket(k,!1,!1))break;k.pts<=i&&g++}l=this.referencePesPackets[g],W(l.pts<=i)}finally{a()}a();e:for(;;){let g=l.sectionStartPos+s.packetStride;for(;;){const x=await s.readPacketHeader(g);if(!x)break e;if(x.pid===this.elementaryStream.pid&&x.payloadUnitStartIndicator===1)break;g+=s.packetStride}const y=await s.readSection(g,!1);if(!y)break;const b=Vd(y);if(!b)throw new Error(Hd);if(b.pts>i)break;l=b,o.fileSize===null&&this.maybeInsertReferencePacket(b,!1,!0)}const c=this.getReorderSize();for(let g=0;g<c;g++){let y=l.sectionStartPos-s.packetStride;for(;;){const b=await s.readPacketHeader(y);if(!b)break;if(b.pid===this.elementaryStream.pid&&b.payloadUnitStartIndicator===1){const x=await s.readSection(y,!1);W(x);const C=Vd(x);if(!C)throw new Error(Hd);l=C;break}y-=s.packetStride}}const u=await s.readSection(l.sectionStartPos,!0);W(u);const d=tf(u);W(d);const f=new nf(this,d,!0),h=new Mg(this,f);for(;!((Wn(h.presentationOrderPackets)?.pts??-1/0)>=i||!await h.readNextDecodeOrderPacket()););const p=ZE(h.presentationOrderPackets,g=>g.pts<=i&&(!n||this.getPacketType(g.data)==="key"));if(p!==-1){const g=h.presentationOrderPackets[p],y=p===0?0:g.pts-h.presentationOrderPackets[p-1].pts;for(;h.decodeOrderPackets[0]!==g;)h.decodeOrderPackets.shift();h.lastDuration=y;const b=await h.readNext();W(b);const x=this.createEncodedPacket(b.packet,b.duration,r);return this.packetBuffers.set(x,h),this.packetSectionStarts.set(x,b.packet.sectionStartPos),x}if(!n)return null;let m=l.sectionStartPos;for(;;){m-=s.packetStride;const g=await s.readPacketHeader(m);if(!g)return null;if(g.pid!==this.elementaryStream.pid||g.payloadUnitStartIndicator!==1)continue;const y=await s.readSection(m,!0);W(y);const b=tf(y);if(!b)throw new Error(Hd);const x=new nf(this,b,!1);if(await this.markNextPacket(x),!x.suppliedPacket||this.getPacketType(x.suppliedPacket.data)!=="key")continue;x.uncapped=!0;const C=new Mg(this,x),P=await C.readNext();W(P);const S=this.createEncodedPacket(P.packet,P.duration,r);return this.packetBuffers.set(S,C),this.packetSectionStarts.set(S,P.packet.sectionStartPos),S}}}class Mne extends FD{constructor(e){super(e),this.elementaryStream=e,this.decoderConfig={codec:QE({width:this.elementaryStream.info.width,height:this.elementaryStream.info.height,codec:this.elementaryStream.info.codec,codecDescription:null,colorSpace:this.elementaryStream.info.colorSpace,avcType:1,avcCodecInfo:this.elementaryStream.info.avcCodecInfo,hevcCodecInfo:this.elementaryStream.info.hevcCodecInfo,vp9CodecInfo:null,av1CodecInfo:null}),codedWidth:this.elementaryStream.info.width,codedHeight:this.elementaryStream.info.height,colorSpace:this.elementaryStream.info.colorSpace}}getCodec(){return this.elementaryStream.info.codec}getCodedWidth(){return this.elementaryStream.info.width}getCodedHeight(){return this.elementaryStream.info.height}getRotation(){return 0}async getColorSpace(){return this.elementaryStream.info.colorSpace}async canBeTransparent(){return!1}async getDecoderConfig(){return this.decoderConfig}getPacketType(e){return rT(this.elementaryStream.info.codec,this.decoderConfig,e)??"key"}getReorderSize(){return this.elementaryStream.info.reorderSize}async markNextPacket(e){W(!e.suppliedPacket);const n=this.elementaryStream.info.codec,r=1024;if(n!=="avc"&&n!=="hevc")throw new Error("Unhandled.");let i=null;for(;;){let s=e.ensureBuffered(r);if(s instanceof Promise&&(s=await s),s===0)break;const o=e.currentPos,a=e.readBytes(s),l=a.byteLength;let c=0;for(;c<l;){const u=a.indexOf(0,c);if(u===-1||u>=l)break;c=u;const d=o+c;if(c+4>=l){e.seekTo(d);break}const f=a[c+1],h=a[c+2],p=a[c+3];let m=0,g=null;if(f===0&&h===0&&p===1?(m=4,g=a[c+4]):f===0&&h===1&&(m=3,g=p),m===0){c++;continue}const y=d;if(i===null){i=y,c+=m;continue}if(g!==null){const b=n==="avc"?hw(g):rm(g);if(n==="avc"?b===Vo.AUD:b===ui.AUD_NUT){const C=y-i;return e.seekTo(i),e.supplyPacket(C,0)}}c+=m}if(s<r)break}if(i!==null){const s=e.endPos-i;return e.seekTo(i),e.supplyPacket(s,0)}}}class Nne extends FD{constructor(e){super(e),this.elementaryStream=e}getCodec(){return this.elementaryStream.info.codec}getNumberOfChannels(){return this.elementaryStream.info.numberOfChannels}getSampleRate(){return this.elementaryStream.info.sampleRate}async getDecoderConfig(){return{codec:YE({codec:this.elementaryStream.info.codec,codecDescription:null,aacCodecInfo:this.elementaryStream.info.aacCodecInfo}),numberOfChannels:this.elementaryStream.info.numberOfChannels,sampleRate:this.elementaryStream.info.sampleRate}}getPacketType(e){return"key"}getReorderSize(){return 1}async markNextPacket(e){W(!e.suppliedPacket);const n=this.elementaryStream.info.codec,r=128;for(;;){let i=e.ensureBuffered(r);i instanceof Promise&&(i=await i);const s=e.currentPos;for(;e.currentPos-s<i;){const o=e.readU8();if(n==="aac"){if(o!==255)continue;e.skip(-1);const a=e.currentPos;let l=e.ensureBuffered(zu);if(l instanceof Promise&&(l=await l),l<zu)return;const c=e.readBytes(zu),u=sd(uo.tempFromBytes(c));if(u){e.seekTo(a);let d=e.ensureBuffered(u.frameLength);return d instanceof Promise&&(d=await d),e.supplyPacket(d,Math.round(wy*Ia/this.elementaryStream.info.sampleRate))}else e.seekTo(a+1)}else if(n==="mp3"){if(o!==255)continue;e.skip(-1);const a=e.currentPos;let l=e.ensureBuffered(Ep);if(l instanceof Promise&&(l=await l),l<Ep)return;const c=e.readBytes(Ep),u=jn(c).getUint32(0),d=cT(u,null);if(d.header){e.seekTo(a);let f=e.ensureBuffered(d.header.totalSize);f instanceof Promise&&(f=await f);const h=d.header.audioSamplesInFrame*Ia/this.elementaryStream.info.sampleRate;return e.supplyPacket(f,Math.round(h))}else e.seekTo(a+1)}else throw new Error("Unhandled.")}if(i<r)break}}}class nf{constructor(e,n,r){this.currentPos=0,this.pesPackets=[],this.currentPesPacketIndex=0,this.currentPesPacketPos=0,this.endPos=0,this.nextPts=0,this.suppliedPacket=null,this.backing=e,this.pid=e.elementaryStream.pid,this.demuxer=e.elementaryStream.demuxer,this.startingPesPacket=n,this.uncapped=r}clone(){const e=new nf(this.backing,this.startingPesPacket,!0);return e.currentPos=this.currentPos,e.pesPackets=[...this.pesPackets],e.currentPesPacketIndex=this.currentPesPacketIndex,e.currentPesPacketPos=this.currentPesPacketPos,e.endPos=this.endPos,e.nextPts=this.nextPts,e}ensureBuffered(e){const n=this.endPos-this.currentPos;return n>=e?e:this.bufferData(e-n).then(()=>Math.min(this.endPos-this.currentPos,e))}getCurrentPesPacket(){const e=this.pesPackets[this.currentPesPacketIndex];return W(e),e}async bufferData(e){const n=this.endPos+e;for(;this.endPos<n;){let r;if(this.pesPackets.length===0)r=this.startingPesPacket;else{let i=Wn(this.pesPackets).sectionEndPos;for(W(i!==null);;){const a=await this.demuxer.readPacketHeader(i);if(!a)return;if(a.pid===this.pid)break;i+=this.demuxer.packetStride}const s=await this.demuxer.readSection(i,!0);if(!s)return;const o=tf(s);if(!o)throw new Error(Hd);r=o}this.pesPackets.push(r),this.endPos+=r.data.byteLength,this.pesPackets.length===1&&(this.nextPts=r.pts)}}readBytes(e){const n=this.getCurrentPesPacket(),r=this.currentPos-this.currentPesPacketPos,i=r+e;if(this.currentPos+=e,i<=n.data.byteLength)return n.data.subarray(r,i);const s=new Uint8Array(e);s.set(n.data.subarray(r));let o=n.data.byteLength-r;for(;;){this.advanceCurrentPacket();const a=this.getCurrentPesPacket(),l=e-o;if(l<=a.data.byteLength){s.set(a.data.subarray(0,l),o);break}s.set(a.data,o),o+=a.data.byteLength}return s}readU8(){let e=this.getCurrentPesPacket();const n=this.currentPos-this.currentPesPacketPos;return this.currentPos++,n<e.data.byteLength?e.data[n]:(this.advanceCurrentPacket(),e=this.getCurrentPesPacket(),e.data[0])}seekTo(e){if(e!==this.currentPos){if(e<this.currentPos)for(;e<this.currentPesPacketPos;){this.currentPesPacketIndex--;const n=this.getCurrentPesPacket();this.currentPesPacketPos-=n.data.byteLength,this.nextPts=n.pts}else for(;;){const n=this.getCurrentPesPacket(),r=this.currentPesPacketPos+n.data.byteLength;if(e<r)break;this.currentPesPacketPos+=n.data.byteLength,this.currentPesPacketIndex++,this.nextPts=this.getCurrentPesPacket().pts}this.currentPos=e}}skip(e){this.seekTo(this.currentPos+e)}advanceCurrentPacket(){this.currentPesPacketPos+=this.getCurrentPesPacket().data.byteLength,this.currentPesPacketIndex++,this.nextPts=this.getCurrentPesPacket().pts}supplyPacket(e,n){const r=this.getCurrentPesPacket();if(!this.uncapped&&r!==this.startingPesPacket){this.suppliedPacket=null;return}this.backing.maybeInsertReferencePacket(r,!1,!0);const i=this.nextPts;this.nextPts+=n;const s=r.sectionStartPos,o=s+(this.currentPos-this.currentPesPacketPos),a=this.readBytes(e);this.suppliedPacket={pts:i,data:a,sequenceNumber:o,sectionStartPos:s},this.pesPackets.splice(0,this.currentPesPacketIndex),this.currentPesPacketIndex=0}}class Mg{constructor(e,n){this.decodeOrderPackets=[],this.reorderBuffer=[],this.presentationOrderPackets=[],this.reachedEnd=!1,this.lastDuration=0,this.backing=e,this.context=n,this.reorderSize=e.getReorderSize(),W(this.reorderSize>=0)}async readNext(){if(this.decodeOrderPackets.length===0&&!await this.readNextDecodeOrderPacket())return null;await this.ensureCurrentPacketHasNext();const e=this.decodeOrderPackets[0],n=this.presentationOrderPackets.indexOf(e);W(n!==-1);let r;for(n===this.presentationOrderPackets.length-1?r=this.lastDuration:(r=this.presentationOrderPackets[n+1].pts-e.pts,this.lastDuration=r),this.decodeOrderPackets.shift();this.presentationOrderPackets.length>0;){const i=this.presentationOrderPackets[0];if(this.decodeOrderPackets.includes(i))break;this.presentationOrderPackets.shift()}return{packet:e,duration:r}}async readNextDecodeOrderPacket(){if(this.reachedEnd)return!1;let e;return this.context.suppliedPacket?e=this.context.suppliedPacket:(await this.backing.markNextPacket(this.context),e=this.context.suppliedPacket),this.context.suppliedPacket=null,e?(this.decodeOrderPackets.push(e),this.processPacketThroughReorderBuffer(e),!0):(this.reachedEnd=!0,this.flushReorderBuffer(),!1)}async ensureCurrentPacketHasNext(){const e=this.decodeOrderPackets[0];for(W(e);;){const n=this.presentationOrderPackets.indexOf(e);if(n!==-1&&n<=this.presentationOrderPackets.length-2||!await this.readNextDecodeOrderPacket())break}}processPacketThroughReorderBuffer(e){if(this.reorderBuffer.push(e),this.reorderBuffer.length>=this.reorderSize){let n=0;for(let i=1;i<this.reorderBuffer.length;i++)this.reorderBuffer[i].pts<this.reorderBuffer[n].pts&&(n=i);const r=this.reorderBuffer.splice(n,1)[0];this.presentationOrderPackets.push(r)}}flushReorderBuffer(){this.reorderBuffer.sort((e,n)=>e.pts-n.pts),this.presentationOrderPackets.push(...this.reorderBuffer),this.reorderBuffer.length=0}}class xl{}class $D extends xl{async _getMajorBrand(e){let n=e._reader.requestSlice(0,12);return n instanceof Promise&&(n=await n),!n||(n.skip(4),Zr(n,4)!=="ftyp")?null:Zr(n,4)}_createDemuxer(e){return new Ute(e)}}class Rne extends $D{async _canReadInput(e){const n=await this._getMajorBrand(e);return!!n&&n!=="qt  "}get name(){return"MP4"}get mimeType(){return"video/mp4"}}class Dne extends $D{async _canReadInput(e){return await this._getMajorBrand(e)==="qt  "}get name(){return"QuickTime File Format"}get mimeType(){return"video/quicktime"}}class zD extends xl{async isSupportedEBMLOfDocType(e,n){let r=e._reader.requestSlice(0,Ha);if(r instanceof Promise&&(r=await r),!r)return!1;const i=ID(r);if(i===null||i<1||i>8||zt(r,i)!==Oe.EBML)return!1;const o=OD(r);if(typeof o!="number")return!1;let a=e._reader.requestSlice(r.filePos,o);if(a instanceof Promise&&(a=await a),!a)return!1;const l=r.filePos;for(;a.filePos<=l+o-Os;){const c=Ra(a);if(!c)break;const{id:u,size:d}=c,f=a.filePos;if(d===void 0)return!1;switch(u){case Oe.EBMLVersion:if(zt(a,d)!==1)return!1;break;case Oe.EBMLReadVersion:if(zt(a,d)!==1)return!1;break;case Oe.DocType:if(Ud(a,d)!==n)return!1;break;case Oe.DocTypeVersion:if(zt(a,d)>4)return!1;break}a.filePos=f+d}return!0}_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"matroska")}_createDemuxer(e){return new Qte(e)}get name(){return"Matroska"}get mimeType(){return"video/x-matroska"}}class Lne extends zD{_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"webm")}get name(){return"WebM"}get mimeType(){return"video/webm"}}class Bne extends xl{async _canReadInput(e){let n=e._reader.requestSlice(0,10);if(n instanceof Promise&&(n=await n),!n)return!1;let r=0,i=!1;for(;;){let c=e._reader.requestSlice(r,gy);if(c instanceof Promise&&(c=await c),!c)break;const u=yy(c);if(!u)break;i=!0,r=c.filePos+u.size}const s=await Gx(e._reader,r,r+4096);if(!s)return!1;if(i)return!0;r=s.startPos+s.header.totalSize;const o=await Gx(e._reader,r,r+Ep);if(!o)return!1;const a=s.header,l=o.header;return!(a.channel!==l.channel||a.sampleRate!==l.sampleRate)}_createDemuxer(e){return new lne(e)}get name(){return"MP3"}get mimeType(){return"audio/mpeg"}}class Fne extends xl{async _canReadInput(e){let n=e._reader.requestSlice(0,12);if(n instanceof Promise&&(n=await n),!n)return!1;const r=Zr(n,4);return r!=="RIFF"&&r!=="RIFX"&&r!=="RF64"?!1:(n.skip(4),Zr(n,4)==="WAVE")}_createDemuxer(e){return new bne(e)}get name(){return"WAVE"}get mimeType(){return"audio/wav"}}class $ne extends xl{async _canReadInput(e){let n=e._reader.requestSlice(0,4);return n instanceof Promise&&(n=await n),n?Zr(n,4)==="OggS":!1}_createDemuxer(e){return new gne(e)}get name(){return"Ogg"}get mimeType(){return"application/ogg"}}class zne extends xl{async _canReadInput(e){let n=e._reader.requestSlice(0,4);return n instanceof Promise&&(n=await n),n?Zr(n,4)==="fLaC":!1}get name(){return"FLAC"}get mimeType(){return"audio/flac"}_createDemuxer(e){return new Ane(e)}}class Une extends xl{async _canReadInput(e){let n=e._reader.requestSliceRange(0,by,zu);if(n instanceof Promise&&(n=await n),!n)return!1;const r=sd(n);if(!r||(n=e._reader.requestSliceRange(r.frameLength,by,zu),n instanceof Promise&&(n=await n),!n))return!1;const i=sd(n);return i?r.objectType===i.objectType&&r.samplingFrequencyIndex===i.samplingFrequencyIndex&&r.channelConfiguration===i.channelConfiguration:!1}_createDemuxer(e){return new vne(e)}get name(){return"ADTS"}get mimeType(){return"audio/aac"}}class Hne extends xl{async _canReadInput(e){const n=rs+16+1;let r=e._reader.requestSlice(0,n);if(r instanceof Promise&&(r=await r),!r)return!1;const i=St(r,n);return i[0]===71&&i[rs]===71||i[0]===71&&i[rs+16]===71?!0:i[4]===71&&i[4+rs]===71}_createDemuxer(e){return new One(e)}get name(){return"MPEG Transport Stream"}get mimeType(){return"video/MP2T"}}const Vne=new Rne,Wne=new Dne,jne=new zD,qne=new Lne,Kne=new Bne,Gne=new Fne,Zne=new $ne,Xne=new Une,Qne=new zne,Yne=new Hne,QP=[Vne,Wne,jne,qne,Gne,Zne,Qne,Kne,Xne,Yne];class UD{constructor(){this._disposed=!1,this._sizePromise=null,this.onread=null}async getSizeOrNull(){if(this._disposed)throw new ss;return this._sizePromise??=Promise.resolve(this._retrieveSize())}async getSize(){if(this._disposed)throw new ss;const e=await this.getSizeOrNull();if(e===null)throw new Error("Cannot determine the size of an unsized source.");return e}}class YP extends UD{constructor(e,n={}){if(!(e instanceof Blob))throw new TypeError("blob must be a Blob.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(n.maxCacheSize!==void 0&&(!lD(n.maxCacheSize)||n.maxCacheSize<0))throw new TypeError("options.maxCacheSize, when provided, must be a non-negative number.");super(),this._readers=new WeakMap,this._blob=e,this._orchestrator=new ere({maxCacheSize:n.maxCacheSize??8*2**20,maxWorkerCount:4,runWorker:this._runWorker.bind(this),prefetchProfile:Jne.fileSystem})}_retrieveSize(){const e=this._blob.size;return this._orchestrator.fileSize=e,e}_read(e,n){return this._orchestrator.read(e,n)}async _runWorker(e){let n=this._readers.get(e);for(n===void 0&&("stream"in this._blob&&!xp()?n=this._blob.slice(e.currentPos).stream().getReader():n=null,this._readers.set(e,n));e.currentPos<e.targetPos&&!e.aborted;)if(n){const{done:r,value:i}=await n.read();if(r)throw this._orchestrator.forgetWorker(e),new Error("Blob reader stopped unexpectedly before all requested data was read.");if(e.aborted)break;this.onread?.(e.currentPos,e.currentPos+i.length),this._orchestrator.supplyWorkerData(e,i)}else{const r=await this._blob.slice(e.currentPos,e.targetPos).arrayBuffer();if(e.aborted)break;this.onread?.(e.currentPos,e.currentPos+r.byteLength),this._orchestrator.supplyWorkerData(e,new Uint8Array(r))}e.running=!1,e.aborted&&await n?.cancel()}_dispose(){this._orchestrator.dispose()}}const Jne={fileSystem:(t,e)=>(t=Math.floor((t-65536)/65536)*65536,e=Math.ceil((e+65536)/65536)*65536,{start:t,end:e})};class ere{constructor(e){this.options=e,this.fileSize=null,this.nextAge=0,this.workers=[],this.cache=[],this.currentCacheSize=0,this.disposed=!1}read(e,n){W(this.fileSize!==null);const r=this.options.prefetchProfile(e,n,this.workers),i=Math.max(r.start,0),s=Math.min(r.end,this.fileSize);W(i<=e&&n<=s);let o=null;const a=un(this.cache,e,b=>b.start),l=a!==-1?this.cache[a]:null;l&&l.start<=e&&n<=l.end&&(l.age=this.nextAge++,o={bytes:l.bytes,view:l.view,offset:l.start});const c=un(this.cache,i,b=>b.start),u=o?null:new Uint8Array(n-e);let d=0,f=i;const h=[];if(c!==-1){for(let b=c;b<this.cache.length;b++){const x=this.cache[b];if(x.start>=s)break;if(x.end<=i)continue;const C=Math.max(i,x.start),P=Math.min(s,x.end);if(W(C<=P),f<C&&h.push({start:f,end:C}),f=P,u){const S=Math.max(e,x.start),_=Math.min(n,x.end);if(S<_){const k=S-e;u.set(x.bytes.subarray(S-x.start,_-x.start),k),k===d&&(d=_-e)}}x.age=this.nextAge++}f<s&&h.push({start:f,end:s})}else h.push({start:i,end:s});if(u&&d>=u.length&&(o={bytes:u,view:jn(u),offset:e}),h.length===0)return W(o),o;const{promise:p,resolve:m,reject:g}=ci(),y=[];for(const b of h){const x=Math.max(e,b.start),C=Math.min(n,b.end);x===b.start&&C===b.end?y.push(b):x<C&&y.push({start:x,end:C})}for(const b of h){const x=u&&{start:e,bytes:u,holes:y,resolve:m,reject:g};let C=!1;for(const P of this.workers)if(LP(b.start-131072,b.start,P.currentPos,P.targetPos)){P.targetPos=Math.max(P.targetPos,b.end),C=!0,x&&!P.pendingSlices.includes(x)&&P.pendingSlices.push(x),P.running||this.runWorker(P);break}if(!C){const P=this.createWorker(b.start,b.end);x&&(P.pendingSlices=[x]),this.runWorker(P)}}return o||(W(u),o=p.then(b=>({bytes:b,view:jn(b),offset:e}))),o}createWorker(e,n){const r={startPos:e,currentPos:e,targetPos:n,running:!1,aborted:this.disposed,pendingSlices:[],age:this.nextAge++};for(this.workers.push(r);this.workers.length>this.options.maxWorkerCount;){let i=0,s=this.workers[0];for(let o=1;o<this.workers.length;o++){const a=this.workers[o];a.age<s.age&&(i=o,s=a)}if(s.running&&s.pendingSlices.length>0)break;s.aborted=!0,this.workers.splice(i,1)}return r}runWorker(e){W(!e.running),W(e.currentPos<e.targetPos),e.running=!0,e.age=this.nextAge++,this.options.runWorker(e).catch(n=>{if(e.running=!1,e.pendingSlices.length>0)e.pendingSlices.forEach(r=>r.reject(n)),e.pendingSlices.length=0;else throw n})}supplyWorkerData(e,n){W(!e.aborted);const r=e.currentPos,i=r+n.length;this.insertIntoCache({start:r,end:i,bytes:n,view:jn(n),age:this.nextAge++}),e.currentPos+=n.length,e.targetPos=Math.max(e.targetPos,e.currentPos);for(let s=0;s<e.pendingSlices.length;s++){const o=e.pendingSlices[s],a=Math.max(r,o.start),l=Math.min(i,o.start+o.bytes.length);a<l&&o.bytes.set(n.subarray(a-r,l-r),a-o.start);for(let c=0;c<o.holes.length;c++){const u=o.holes[c];r<=u.start&&i>u.start&&(u.start=i),u.end<=u.start&&(o.holes.splice(c,1),c--)}o.holes.length===0&&(o.resolve(o.bytes),e.pendingSlices.splice(s,1),s--)}for(let s=0;s<this.workers.length;s++){const o=this.workers[s];e===o||o.running||LP(r,i,o.currentPos,o.targetPos)&&(this.workers.splice(s,1),s--)}}forgetWorker(e){const n=this.workers.indexOf(e);W(n!==-1),this.workers.splice(n,1)}insertIntoCache(e){if(this.options.maxCacheSize===0)return;let n=un(this.cache,e.start,r=>r.start)+1;if(n>0){const r=this.cache[n-1];if(r.end>=e.end)return;if(r.end>e.start){const i=new Uint8Array(e.end-r.start);i.set(r.bytes,0),i.set(e.bytes,e.start-r.start),this.currentCacheSize+=e.end-r.end,r.bytes=i,r.view=jn(i),r.end=e.end,n--,e=r}else this.cache.splice(n,0,e),this.currentCacheSize+=e.bytes.length}else this.cache.splice(n,0,e),this.currentCacheSize+=e.bytes.length;for(let r=n+1;r<this.cache.length;r++){const i=this.cache[r];if(e.end<=i.start)break;if(e.end>=i.end){this.cache.splice(r,1),this.currentCacheSize-=i.bytes.length,r--;continue}const s=new Uint8Array(i.end-e.start);s.set(e.bytes,0),s.set(i.bytes,i.start-e.start),this.currentCacheSize-=e.end-i.start,e.bytes=s,e.view=jn(s),e.end=i.end,this.cache.splice(r,1);break}for(;this.currentCacheSize>this.options.maxCacheSize;){let r=0,i=this.cache[0];for(let s=1;s<this.cache.length;s++){const o=this.cache[s];o.age<i.age&&(r=s,i=o)}if(this.currentCacheSize-i.bytes.length<=this.options.maxCacheSize)break;this.cache.splice(r,1),this.currentCacheSize-=i.bytes.length}}dispose(){for(const e of this.workers)e.aborted=!0;this.workers.length=0,this.cache.length=0,this.disposed=!0}}aD();class Zx{get disposed(){return this._disposed}constructor(e){if(this._demuxerPromise=null,this._format=null,this._disposed=!1,!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Array.isArray(e.formats)||e.formats.some(n=>!(n instanceof xl)))throw new TypeError("options.formats must be an array of InputFormat.");if(!(e.source instanceof UD))throw new TypeError("options.source must be a Source.");if(e.source._disposed)throw new Error("options.source must not be disposed.");this._formats=e.formats,this._source=e.source,this._reader=new tre(e.source)}_getDemuxer(){return this._demuxerPromise??=(async()=>{this._reader.fileSize=await this._source.getSizeOrNull();for(const e of this._formats)if(await e._canReadInput(this))return this._format=e,e._createDemuxer(this);throw new Error("Input has an unsupported or unrecognizable format.")})()}get source(){return this._source}async getFormat(){return await this._getDemuxer(),W(this._format),this._format}async computeDuration(){return(await this._getDemuxer()).computeDuration()}async getFirstTimestamp(){const e=await this.getTracks();if(e.length===0)return 0;const n=await Promise.all(e.map(r=>r.getFirstTimestamp()));return Math.min(...n)}async getTracks(){return(await this._getDemuxer()).getTracks()}async getVideoTracks(){return(await this.getTracks()).filter(n=>n.isVideoTrack())}async getAudioTracks(){return(await this.getTracks()).filter(n=>n.isAudioTrack())}async getPrimaryVideoTrack(){return(await this.getTracks()).find(n=>n.isVideoTrack())??null}async getPrimaryAudioTrack(){return(await this.getTracks()).find(n=>n.isAudioTrack())??null}async getMimeType(){return(await this._getDemuxer()).getMimeType()}async getMetadataTags(){return(await this._getDemuxer()).getMetadataTags()}dispose(){this._disposed||(this._disposed=!0,this._source._disposed=!0,this._source._dispose())}[Symbol.dispose](){this.dispose()}}class ss extends Error{constructor(e="Input has been disposed."){super(e),this.name="InputDisposedError"}}class tre{constructor(e){this.source=e}requestSlice(e,n){if(this.source._disposed)throw new ss;if(e<0||this.fileSize!==null&&e+n>this.fileSize)return null;const r=e+n,i=this.source._read(e,r);return i instanceof Promise?i.then(s=>s?new uo(s.bytes,s.view,s.offset,e,r):null):i?new uo(i.bytes,i.view,i.offset,e,r):null}requestSliceRange(e,n,r){if(this.source._disposed)throw new ss;if(e<0)return null;if(this.fileSize!==null)return this.requestSlice(e,zr(this.fileSize-e,n,r));{const i=this.requestSlice(e,r),s=o=>{if(o)return o;const a=c=>(W(c!==null),this.requestSlice(e,zr(c-e,n,r))),l=this.source._retrieveSize();return l instanceof Promise?l.then(a):a(l)};return i instanceof Promise?i.then(s):s(i)}}}class uo{constructor(e,n,r,i,s){this.bytes=e,this.view=n,this.offset=r,this.start=i,this.end=s,this.bufferPos=i-r}static tempFromBytes(e){return new uo(e,jn(e),0,0,e.length)}get length(){return this.end-this.start}get filePos(){return this.offset+this.bufferPos}set filePos(e){this.bufferPos=e-this.offset}get remainingLength(){return Math.max(this.end-this.filePos,0)}skip(e){this.bufferPos+=e}slice(e,n=this.end-e){if(e<this.start||e+n>this.end)throw new RangeError("Slicing outside of original slice.");return new uo(this.bytes,this.view,this.offset,e,e+n)}}const Ji=(t,e)=>{if(t.filePos<t.start||t.filePos+e>t.end)throw new RangeError(`Tried reading [${t.filePos}, ${t.filePos+e}), but slice is [${t.start}, ${t.end}). This is likely an internal error, please report it alongside the file that caused it.`)},St=(t,e)=>{Ji(t,e);const n=t.bytes.subarray(t.bufferPos,t.bufferPos+e);return t.bufferPos+=e,n},ht=t=>(Ji(t,1),t.view.getUint8(t.bufferPos++)),Fh=(t,e)=>{Ji(t,2);const n=t.view.getUint16(t.bufferPos,e);return t.bufferPos+=2,n},Fr=t=>{Ji(t,2);const e=t.view.getUint16(t.bufferPos,!1);return t.bufferPos+=2,e},Wd=t=>{Ji(t,3);const e=uw(t.view,t.bufferPos,!1);return t.bufferPos+=3,e},Xx=t=>{Ji(t,2);const e=t.view.getInt16(t.bufferPos,!1);return t.bufferPos+=2,e},hc=(t,e)=>{Ji(t,4);const n=t.view.getUint32(t.bufferPos,e);return t.bufferPos+=4,n},rt=t=>{Ji(t,4);const e=t.view.getUint32(t.bufferPos,!1);return t.bufferPos+=4,e},rf=t=>{Ji(t,4);const e=t.view.getUint32(t.bufferPos,!0);return t.bufferPos+=4,e},Iu=t=>{Ji(t,4);const e=t.view.getInt32(t.bufferPos,!1);return t.bufferPos+=4,e},nre=t=>{Ji(t,4);const e=t.view.getInt32(t.bufferPos,!0);return t.bufferPos+=4,e},JP=(t,e)=>{let n,r;return e?(n=hc(t,!0),r=hc(t,!0)):(r=hc(t,!1),n=hc(t,!1)),r*4294967296+n},Zs=t=>{const e=rt(t),n=rt(t);return e*4294967296+n},rre=t=>{const e=Iu(t),n=rt(t);return e*4294967296+n},ire=t=>{const e=rf(t);return nre(t)*4294967296+e},sre=t=>{Ji(t,4);const e=t.view.getFloat32(t.bufferPos,!1);return t.bufferPos+=4,e},HD=t=>{Ji(t,8);const e=t.view.getFloat64(t.bufferPos,!1);return t.bufferPos+=8,e},Zr=(t,e)=>{Ji(t,e);let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t.bytes[t.bufferPos++]);return n};const eI=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,ore=t=>{const e=Math.floor(t/36e5),n=Math.floor(t%(3600*1e3)/(60*1e3)),r=Math.floor(t%(60*1e3)/1e3),i=t%1e3;return e.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+"."+i.toString().padStart(3,"0")};class tI{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,Math.floor(e/2**32),!1),this.helperView.setUint32(4,e,!1),this.writer.write(this.helper.subarray(0,8))}writeAscii(e){for(let n=0;n<e.length;n++)this.helperView.setUint8(n%8,e.charCodeAt(n)),n%8===7&&this.writer.write(this.helper);e.length%8!==0&&this.writer.write(this.helper.subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.writer.getPos()),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.writer.write(e.contents);else{const n=this.writer.getPos();if(this.writeBoxHeader(e,0),e.contents&&this.writer.write(e.contents),e.children)for(const s of e.children)s&&this.writeBox(s);const r=this.writer.getPos(),i=e.size??r-n;this.writer.seek(n),this.writeBoxHeader(e,i),this.writer.seek(r)}}writeBoxHeader(e,n){this.writeU32(e.largeSize?1:n),this.writeAscii(e.type),e.largeSize&&this.writeU64(n)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){const n=this.offsets.get(e);W(n!==void 0);const r=this.writer.getPos();this.writer.seek(n),this.writeBox(e),this.writer.seek(r)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let n=this.measureBoxHeader(e);if(e.contents&&(n+=e.contents.byteLength),e.children)for(const r of e.children)r&&(n+=this.measureBox(r));return n}}}const Gt=new Uint8Array(8),na=new DataView(Gt.buffer),Xn=t=>[(t%256+256)%256],gt=t=>(na.setUint16(0,t,!1),[Gt[0],Gt[1]]),VD=t=>(na.setInt16(0,t,!1),[Gt[0],Gt[1]]),WD=t=>(na.setUint32(0,t,!1),[Gt[1],Gt[2],Gt[3]]),Ze=t=>(na.setUint32(0,t,!1),[Gt[0],Gt[1],Gt[2],Gt[3]]),rc=t=>(na.setInt32(0,t,!1),[Gt[0],Gt[1],Gt[2],Gt[3]]),od=t=>(na.setUint32(0,Math.floor(t/2**32),!1),na.setUint32(4,t,!1),[Gt[0],Gt[1],Gt[2],Gt[3],Gt[4],Gt[5],Gt[6],Gt[7]]),jD=t=>(na.setInt16(0,2**8*t,!1),[Gt[0],Gt[1]]),Da=t=>(na.setInt32(0,2**16*t,!1),[Gt[0],Gt[1],Gt[2],Gt[3]]),x1=t=>(na.setInt32(0,2**30*t,!1),[Gt[0],Gt[1],Gt[2],Gt[3]]),S1=(t,e)=>{const n=[];let r=t;do{let i=r&127;r>>=7,n.length>0&&(i|=128),n.push(i)}while(r>0||e);return n.reverse()},si=(t,e=!1)=>{const n=Array(t.length).fill(null).map((r,i)=>t.charCodeAt(i));return e&&n.push(0),n},uT=t=>{let e=null;for(const n of t)(!e||n.timestamp>e.timestamp)&&(e=n);return e},qD=t=>{const e=t*(Math.PI/180),n=Math.round(Math.cos(e)),r=Math.round(Math.sin(e));return[n,r,0,-r,n,0,0,0,1]},KD=qD(0),GD=t=>[Da(t[0]),Da(t[1]),x1(t[2]),Da(t[3]),Da(t[4]),x1(t[5]),Da(t[6]),Da(t[7]),x1(t[8])],yt=(t,e,n)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:n}),an=(t,e,n,r,i)=>yt(t,[Xn(e),WD(n),r??[]],i),are=t=>t.isQuickTime?yt("ftyp",[si("qt  "),Ze(512),si("qt  ")]):t.fragmented?yt("ftyp",[si("iso5"),Ze(512),si("iso5"),si("iso6"),si("mp41")]):yt("ftyp",[si("isom"),Ze(512),si("isom"),t.holdsAvc?si("avc1"):[],si("mp41")]),Ng=t=>({type:"mdat",largeSize:t}),lre=t=>({type:"free",size:t}),$h=t=>yt("moov",void 0,[cre(t.creationTime,t.trackDatas),...t.trackDatas.map(e=>ure(e,t.creationTime)),t.isFragmented?jre(t.trackDatas):null,iie(t)]),cre=(t,e)=>{const n=wr(Math.max(0,...e.filter(o=>o.samples.length>0).map(o=>{const a=uT(o.samples);return a.timestamp+a.duration})),Qx),r=Math.max(0,...e.map(o=>o.track.id))+1,i=!zf(t)||!zf(n),s=i?od:Ze;return an("mvhd",+i,0,[s(t),s(t),Ze(Qx),s(n),Da(1),jD(1),Array(10).fill(0),GD(KD),Array(24).fill(0),Ze(r)])},ure=(t,e)=>{const n=gie(t);return yt("trak",void 0,[dre(t,e),fre(t,e),n.name!==void 0?yt("udta",void 0,[yt("name",[...Ho.encode(n.name)])]):null])},dre=(t,e)=>{const n=uT(t.samples),r=wr(n?n.timestamp+n.duration:0,Qx),i=!zf(e)||!zf(r),s=i?od:Ze;let o;if(t.type==="video"){const l=t.track.metadata.rotation;o=qD(l??0)}else o=KD;let a=2;return t.track.metadata.disposition?.default!==!1&&(a|=1),an("tkhd",+i,a,[s(e),s(e),Ze(t.track.id),Ze(0),s(r),Array(8).fill(0),gt(0),gt(t.track.id),jD(t.type==="audio"?1:0),gt(0),GD(o),Da(t.type==="video"?t.info.width:0),Da(t.type==="video"?t.info.height:0)])},fre=(t,e)=>yt("mdia",void 0,[hre(t,e),dT(!0,pre[t.type],mre[t.type]),gre(t)]),hre=(t,e)=>{const n=uT(t.samples),r=wr(n?n.timestamp+n.duration:0,t.timescale),i=!zf(e)||!zf(r),s=i?od:Ze;return an("mdhd",+i,0,[s(e),s(e),Ze(t.timescale),s(r),gt(YD(t.track.metadata.languageCode??cs)),gt(0)])},pre={video:"vide",audio:"soun",subtitle:"text"},mre={video:"MediabunnyVideoHandler",audio:"MediabunnySoundHandler",subtitle:"MediabunnyTextHandler"},dT=(t,e,n,r="\0\0\0\0")=>an("hdlr",0,0,[t?si("mhlr"):Ze(0),si(e),si(r),Ze(0),Ze(0),si(n,!0)]),gre=t=>yt("minf",void 0,[vre[t.type](),xre(),Ere(t)]),yre=()=>an("vmhd",0,1,[gt(0),gt(0),gt(0),gt(0)]),bre=()=>an("smhd",0,0,[gt(0),gt(0)]),wre=()=>an("nmhd",0,0),vre={video:yre,audio:bre,subtitle:wre},xre=()=>yt("dinf",void 0,[Sre()]),Sre=()=>an("dref",0,0,[Ze(1)],[kre()]),kre=()=>an("url ",0,1),Ere=t=>{const e=t.compositionTimeOffsetTable.length>1||t.compositionTimeOffsetTable.some(n=>n.sampleCompositionTimeOffset!==0);return yt("stbl",void 0,[Tre(t),Fre(t),e?Vre(t):null,e?Wre(t):null,zre(t),Ure(t),Hre(t),$re(t)])},Tre=t=>{let e;if(t.type==="video")e=Cre(lie(t.track.source._codec,t.info.decoderConfig.codec),t);else if(t.type==="audio"){const n=QD(t.track.source._codec,t.muxer.isQuickTime);W(n),e=Ore(n,t)}else t.type==="subtitle"&&(e=Lre(die[t.track.source._codec],t));return W(e),an("stsd",0,0,[Ze(1)],[e])},Cre=(t,e)=>yt(t,[Array(6).fill(0),gt(1),gt(0),gt(0),Array(12).fill(0),gt(e.info.width),gt(e.info.height),Ze(4718592),Ze(4718592),Ze(0),gt(1),Array(32).fill(0),gt(24),VD(65535)],[cie[e.track.source._codec](e),$ee(e.info.decoderConfig.colorSpace)?_re(e):null]),_re=t=>yt("colr",[si("nclx"),gt(jm[t.info.decoderConfig.colorSpace.primaries]),gt(qm[t.info.decoderConfig.colorSpace.transfer]),gt(Km[t.info.decoderConfig.colorSpace.matrix]),Xn((t.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),Are=t=>t.info.decoderConfig&&yt("avcC",[...fs(t.info.decoderConfig.description)]),Pre=t=>t.info.decoderConfig&&yt("hvcC",[...fs(t.info.decoderConfig.description)]),nI=t=>{if(!t.info.decoderConfig)return null;const e=t.info.decoderConfig,n=e.codec.split("."),r=Number(n[1]),i=Number(n[2]),s=Number(n[3]),o=n[4]?Number(n[4]):1,a=n[8]?Number(n[8]):Number(e.colorSpace?.fullRange??0),l=(s<<4)+(o<<1)+a,c=n[5]?Number(n[5]):e.colorSpace?.primaries?jm[e.colorSpace.primaries]:2,u=n[6]?Number(n[6]):e.colorSpace?.transfer?qm[e.colorSpace.transfer]:2,d=n[7]?Number(n[7]):e.colorSpace?.matrix?Km[e.colorSpace.matrix]:2;return an("vpcC",1,0,[Xn(r),Xn(i),Xn(l),Xn(c),Xn(u),Xn(d),gt(0)])},Ire=t=>yt("av1C",Qee(t.info.decoderConfig.codec)),Ore=(t,e)=>{let n=0,r,i=16;if(Pi.includes(e.track.source._codec)){const s=e.track.source._codec,{sampleSize:o}=Yc(s);i=8*o,i>16&&(n=1)}return n===0?r=[Array(6).fill(0),gt(1),gt(n),gt(0),Ze(0),gt(e.info.numberOfChannels),gt(i),gt(0),gt(0),gt(e.info.sampleRate<2**16?e.info.sampleRate:0),gt(0)]:r=[Array(6).fill(0),gt(1),gt(n),gt(0),Ze(0),gt(e.info.numberOfChannels),gt(Math.min(i,16)),gt(0),gt(0),gt(e.info.sampleRate<2**16?e.info.sampleRate:0),gt(0),Ze(1),Ze(i/8),Ze(e.info.numberOfChannels*i/8),Ze(2)],yt(t,r,[uie(e.track.source._codec,e.muxer.isQuickTime)?.(e)??null])},k1=t=>{let e;switch(t.track.source._codec){case"aac":e=64;break;case"mp3":e=107;break;case"vorbis":e=221;break;default:throw new Error(`Unhandled audio codec: ${t.track.source._codec}`)}let n=[...Xn(e),...Xn(21),...WD(0),...Ze(0),...Ze(0)];if(t.info.decoderConfig.description){const r=fs(t.info.decoderConfig.description);n=[...n,...Xn(5),...S1(r.byteLength),...r]}return n=[...gt(1),...Xn(0),...Xn(4),...S1(n.length),...n,...Xn(6),...Xn(1),...Xn(2)],n=[...Xn(3),...S1(n.length),...n],an("esds",0,0,n)},Hl=t=>yt("wave",void 0,[Mre(t),Nre(t),yt("\0\0\0\0")]),Mre=t=>yt("frma",[si(QD(t.track.source._codec,t.muxer.isQuickTime))]),Nre=t=>{const{littleEndian:e}=Yc(t.track.source._codec);return yt("enda",[gt(+e)])},Rre=t=>{let e=t.info.numberOfChannels,n=3840,r=t.info.sampleRate,i=0,s=0,o=new Uint8Array(0);const a=t.info.decoderConfig?.description;if(a){W(a.byteLength>=18);const l=fs(a),c=xD(l);e=c.outputChannelCount,n=c.preSkip,r=c.inputSampleRate,i=c.outputGain,s=c.channelMappingFamily,c.channelMappingTable&&(o=c.channelMappingTable)}return yt("dOps",[Xn(0),Xn(e),gt(n),Ze(r),VD(i),Xn(s),...o])},Dre=t=>{const e=t.info.decoderConfig?.description;W(e);const n=fs(e);return an("dfLa",0,0,[...n.subarray(4)])},ko=t=>{const{littleEndian:e,sampleSize:n}=Yc(t.track.source._codec),r=+e;return an("pcmC",0,0,[Xn(r),Xn(8*n)])},Lre=(t,e)=>yt(t,[Array(6).fill(0),gt(1)],[fie[e.track.source._codec](e)]),Bre=t=>yt("vttC",[...Ho.encode(t.info.config.description)]),Fre=t=>an("stts",0,0,[Ze(t.timeToSampleTable.length),t.timeToSampleTable.map(e=>[Ze(e.sampleCount),Ze(e.sampleDelta)])]),$re=t=>{if(t.samples.every(n=>n.type==="key"))return null;const e=[...t.samples.entries()].filter(([,n])=>n.type==="key");return an("stss",0,0,[Ze(e.length),e.map(([n])=>Ze(n+1))])},zre=t=>an("stsc",0,0,[Ze(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(e=>[Ze(e.firstChunk),Ze(e.samplesPerChunk),Ze(1)])]),Ure=t=>{if(t.type==="audio"&&t.info.requiresPcmTransformation){const{sampleSize:e}=Yc(t.track.source._codec);return an("stsz",0,0,[Ze(e*t.info.numberOfChannels),Ze(t.samples.reduce((n,r)=>n+wr(r.duration,t.timescale),0))])}return an("stsz",0,0,[Ze(0),Ze(t.samples.length),t.samples.map(e=>Ze(e.size))])},Hre=t=>t.finalizedChunks.length>0&&Wn(t.finalizedChunks).offset>=2**32?an("co64",0,0,[Ze(t.finalizedChunks.length),t.finalizedChunks.map(e=>od(e.offset))]):an("stco",0,0,[Ze(t.finalizedChunks.length),t.finalizedChunks.map(e=>Ze(e.offset))]),Vre=t=>an("ctts",1,0,[Ze(t.compositionTimeOffsetTable.length),t.compositionTimeOffsetTable.map(e=>[Ze(e.sampleCount),rc(e.sampleCompositionTimeOffset)])]),Wre=t=>{let e=1/0,n=-1/0,r=1/0,i=-1/0;W(t.compositionTimeOffsetTable.length>0),W(t.samples.length>0);for(let o=0;o<t.compositionTimeOffsetTable.length;o++){const a=t.compositionTimeOffsetTable[o];e=Math.min(e,a.sampleCompositionTimeOffset),n=Math.max(n,a.sampleCompositionTimeOffset)}for(let o=0;o<t.samples.length;o++){const a=t.samples[o];r=Math.min(r,wr(a.timestamp,t.timescale)),i=Math.max(i,wr(a.timestamp+a.duration,t.timescale))}const s=Math.max(-e,0);return i>=2**31?null:an("cslg",0,0,[rc(s),rc(e),rc(n),rc(r),rc(i)])},jre=t=>yt("mvex",void 0,t.map(qre)),qre=t=>an("trex",0,0,[Ze(t.track.id),Ze(1),Ze(0),Ze(0),Ze(0)]),rI=(t,e)=>yt("moof",void 0,[Kre(t),...e.map(Gre)]),Kre=t=>an("mfhd",0,0,[Ze(t)]),ZD=t=>{let e=0,n=0;const r=0,i=0,s=t.type==="delta";return n|=+s,s?e|=1:e|=2,e<<24|n<<16|r<<8|i},Gre=t=>yt("traf",void 0,[Zre(t),Xre(t),Qre(t)]),Zre=t=>{W(t.currentChunk);let e=0;e|=8,e|=16,e|=32,e|=131072;const n=t.currentChunk.samples[1]??t.currentChunk.samples[0],r={duration:n.timescaleUnitsToNextSample,size:n.size,flags:ZD(n)};return an("tfhd",0,e,[Ze(t.track.id),Ze(r.duration),Ze(r.size),Ze(r.flags)])},Xre=t=>(W(t.currentChunk),an("tfdt",1,0,[od(wr(t.currentChunk.startTimestamp,t.timescale))])),Qre=t=>{W(t.currentChunk);const e=t.currentChunk.samples.map(m=>m.timescaleUnitsToNextSample),n=t.currentChunk.samples.map(m=>m.size),r=t.currentChunk.samples.map(ZD),i=t.currentChunk.samples.map(m=>wr(m.timestamp-m.decodeTimestamp,t.timescale)),s=new Set(e),o=new Set(n),a=new Set(r),l=new Set(i),c=a.size===2&&r[0]!==r[1],u=s.size>1,d=o.size>1,f=!c&&a.size>1,h=l.size>1||[...l].some(m=>m!==0);let p=0;return p|=1,p|=4*+c,p|=256*+u,p|=512*+d,p|=1024*+f,p|=2048*+h,an("trun",1,p,[Ze(t.currentChunk.samples.length),Ze(t.currentChunk.offset-t.currentChunk.moofOffset||0),c?Ze(r[0]):[],t.currentChunk.samples.map((m,g)=>[u?Ze(e[g]):[],d?Ze(n[g]):[],f?Ze(r[g]):[],h?rc(i[g]):[]])])},Yre=t=>yt("mfra",void 0,[...t.map(Jre),eie()]),Jre=(t,e)=>an("tfra",1,0,[Ze(t.track.id),Ze(63),Ze(t.finalizedChunks.length),t.finalizedChunks.map(r=>[od(wr(r.samples[0].timestamp,t.timescale)),od(r.moofOffset),Ze(e+1),Ze(1),Ze(1)])]),eie=()=>an("mfro",0,0,[Ze(0)]),tie=()=>yt("vtte"),nie=(t,e,n,r,i)=>yt("vttc",void 0,[i!==null?yt("vsid",[rc(i)]):null,n!==null?yt("iden",[...Ho.encode(n)]):null,e!==null?yt("ctim",[...Ho.encode(ore(e))]):null,r!==null?yt("sttg",[...Ho.encode(r)]):null,yt("payl",[...Ho.encode(t)])]),rie=t=>yt("vtta",[...Ho.encode(t)]),iie=t=>{const e=[],n=t.format._options.metadataFormat??"auto",r=t.output._metadataTags;if(n==="mdir"||n==="auto"&&!t.isQuickTime){const i=oie(r);i&&e.push(i)}else if(n==="mdta"){const i=aie(r);i&&e.push(i)}else(n==="udta"||n==="auto"&&t.isQuickTime)&&sie(e,t.output._metadataTags);return e.length===0?null:yt("udta",void 0,e)},sie=(t,e)=>{for(const{key:n,value:r}of oD(e))switch(n){case"title":t.push(Eo("Â©nam",r));break;case"description":t.push(Eo("Â©des",r));break;case"artist":t.push(Eo("Â©ART",r));break;case"album":t.push(Eo("Â©alb",r));break;case"albumArtist":t.push(Eo("albr",r));break;case"genre":t.push(Eo("Â©gen",r));break;case"date":t.push(Eo("Â©day",r.toISOString().slice(0,10)));break;case"comment":t.push(Eo("Â©cmt",r));break;case"lyrics":t.push(Eo("Â©lyr",r));break;case"raw":break;case"discNumber":case"discsTotal":case"trackNumber":case"tracksTotal":case"images":break;default:zc(n)}if(e.raw)for(const n in e.raw){const r=e.raw[n];r==null||n.length!==4||t.some(i=>i.type===n)||(typeof r=="string"?t.push(Eo(n,r)):r instanceof Uint8Array&&t.push(yt(n,Array.from(r))))}},Eo=(t,e)=>{const n=Ho.encode(e);return yt(t,[gt(n.length),gt(YD("und")),Array.from(n)])},iI={"image/jpeg":13,"image/png":14,"image/bmp":27},XD=(t,e)=>{const n=[];for(const{key:r,value:i}of oD(t))switch(r){case"title":n.push({key:e?"title":"Â©nam",value:Gs(i)});break;case"description":n.push({key:e?"description":"Â©des",value:Gs(i)});break;case"artist":n.push({key:e?"artist":"Â©ART",value:Gs(i)});break;case"album":n.push({key:e?"album":"Â©alb",value:Gs(i)});break;case"albumArtist":n.push({key:e?"album_artist":"aART",value:Gs(i)});break;case"comment":n.push({key:e?"comment":"Â©cmt",value:Gs(i)});break;case"genre":n.push({key:e?"genre":"Â©gen",value:Gs(i)});break;case"lyrics":n.push({key:e?"lyrics":"Â©lyr",value:Gs(i)});break;case"date":n.push({key:e?"date":"Â©day",value:Gs(i.toISOString().slice(0,10))});break;case"images":for(const s of i)s.kind==="coverFront"&&n.push({key:"covr",value:yt("data",[Ze(iI[s.mimeType]??0),Ze(0),Array.from(s.data)])});break;case"trackNumber":if(e){const s=t.tracksTotal!==void 0?`${i}/${t.tracksTotal}`:i.toString();n.push({key:"track",value:Gs(s)})}else n.push({key:"trkn",value:yt("data",[Ze(0),Ze(0),gt(0),gt(i),gt(t.tracksTotal??0),gt(0)])});break;case"discNumber":e||n.push({key:"disc",value:yt("data",[Ze(0),Ze(0),gt(0),gt(i),gt(t.discsTotal??0),gt(0)])});break;case"tracksTotal":case"discsTotal":break;case"raw":break;default:zc(r)}if(t.raw)for(const r in t.raw){const i=t.raw[r];i==null||!e&&r.length!==4||n.some(s=>s.key===r)||(typeof i=="string"?n.push({key:r,value:Gs(i)}):i instanceof Uint8Array?n.push({key:r,value:yt("data",[Ze(0),Ze(0),Array.from(i)])}):i instanceof pf&&n.push({key:r,value:yt("data",[Ze(iI[i.mimeType]??0),Ze(0),Array.from(i.data)])}))}return n},oie=t=>{const e=XD(t,!1);return e.length===0?null:an("meta",0,0,void 0,[dT(!1,"mdir","","appl"),yt("ilst",void 0,e.map(n=>yt(n.key,void 0,[n.value])))])},aie=t=>{const e=XD(t,!0);return e.length===0?null:yt("meta",void 0,[dT(!1,"mdta",""),an("keys",0,0,[Ze(e.length)],e.map(n=>yt("mdta",[...Ho.encode(n.key)]))),yt("ilst",void 0,e.map((n,r)=>{const i=String.fromCharCode(...Ze(r+1));return yt(i,void 0,[n.value])}))])},Gs=t=>yt("data",[Ze(1),Ze(0),...Ho.encode(t)]),lie=(t,e)=>{switch(t){case"avc":return e.startsWith("avc3")?"avc3":"avc1";case"hevc":return"hvc1";case"vp8":return"vp08";case"vp9":return"vp09";case"av1":return"av01"}},cie={avc:Are,hevc:Pre,vp8:nI,vp9:nI,av1:Ire},QD=(t,e)=>{switch(t){case"aac":return"mp4a";case"mp3":return"mp4a";case"opus":return"Opus";case"vorbis":return"mp4a";case"flac":return"fLaC";case"ulaw":return"ulaw";case"alaw":return"alaw";case"pcm-u8":return"raw ";case"pcm-s8":return"sowt"}if(e)switch(t){case"pcm-s16":return"sowt";case"pcm-s16be":return"twos";case"pcm-s24":return"in24";case"pcm-s24be":return"in24";case"pcm-s32":return"in32";case"pcm-s32be":return"in32";case"pcm-f32":return"fl32";case"pcm-f32be":return"fl32";case"pcm-f64":return"fl64";case"pcm-f64be":return"fl64"}else switch(t){case"pcm-s16":return"ipcm";case"pcm-s16be":return"ipcm";case"pcm-s24":return"ipcm";case"pcm-s24be":return"ipcm";case"pcm-s32":return"ipcm";case"pcm-s32be":return"ipcm";case"pcm-f32":return"fpcm";case"pcm-f32be":return"fpcm";case"pcm-f64":return"fpcm";case"pcm-f64be":return"fpcm"}},uie=(t,e)=>{switch(t){case"aac":return k1;case"mp3":return k1;case"opus":return Rre;case"vorbis":return k1;case"flac":return Dre}if(e)switch(t){case"pcm-s24":return Hl;case"pcm-s24be":return Hl;case"pcm-s32":return Hl;case"pcm-s32be":return Hl;case"pcm-f32":return Hl;case"pcm-f32be":return Hl;case"pcm-f64":return Hl;case"pcm-f64be":return Hl}else switch(t){case"pcm-s16":return ko;case"pcm-s16be":return ko;case"pcm-s24":return ko;case"pcm-s24be":return ko;case"pcm-s32":return ko;case"pcm-s32be":return ko;case"pcm-f32":return ko;case"pcm-f32be":return ko;case"pcm-f64":return ko;case"pcm-f64be":return ko}return null},die={webvtt:"wvtt"},fie={webvtt:Bre},YD=t=>{W(t.length===3);let e=0;for(let n=0;n<3;n++)e<<=5,e+=t.charCodeAt(n)-96;return e};class JD{constructor(){this.ensureMonotonicity=!1,this.trackedWrites=null,this.trackedStart=-1,this.trackedEnd=-1}start(){}maybeTrackWrites(e){if(!this.trackedWrites)return;let n=this.getPos();if(n<this.trackedStart){if(n+e.byteLength<=this.trackedStart)return;e=e.subarray(this.trackedStart-n),n=0}const r=n+e.byteLength-this.trackedStart;let i=this.trackedWrites.byteLength;for(;i<r;)i*=2;if(i!==this.trackedWrites.byteLength){const s=new Uint8Array(i);s.set(this.trackedWrites,0),this.trackedWrites=s}this.trackedWrites.set(e,n-this.trackedStart),this.trackedEnd=Math.max(this.trackedEnd,n+e.byteLength)}startTrackingWrites(){this.trackedWrites=new Uint8Array(2**10),this.trackedStart=this.getPos(),this.trackedEnd=this.trackedStart}stopTrackingWrites(){if(!this.trackedWrites)throw new Error("Internal error: Can't get tracked writes since nothing was tracked.");const n={data:this.trackedWrites.subarray(0,this.trackedEnd-this.trackedStart),start:this.trackedStart,end:this.trackedEnd};return this.trackedWrites=null,n}}const E1=2**16,T1=2**32;class eL extends JD{constructor(e){if(super(),this.pos=0,this.maxPos=0,this.target=e,this.supportsResize="resize"in new ArrayBuffer(0),this.supportsResize)try{this.buffer=new ArrayBuffer(E1,{maxByteLength:T1})}catch{this.buffer=new ArrayBuffer(E1),this.supportsResize=!1}else this.buffer=new ArrayBuffer(E1);this.bytes=new Uint8Array(this.buffer)}ensureSize(e){let n=this.buffer.byteLength;for(;n<e;)n*=2;if(n!==this.buffer.byteLength){if(n>T1)throw new Error(`ArrayBuffer exceeded maximum size of ${T1} bytes. Please consider using another target.`);if(this.supportsResize)this.buffer.resize(n);else{const r=new ArrayBuffer(n),i=new Uint8Array(r);i.set(this.bytes,0),this.buffer=r,this.bytes=i}}}write(e){this.maybeTrackWrites(e),this.ensureSize(this.pos+e.byteLength),this.bytes.set(e,this.pos),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength,this.maxPos=Math.max(this.maxPos,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){}async finalize(){this.ensureSize(this.pos),this.target.buffer=this.buffer.slice(0,Math.max(this.maxPos,this.pos))}async close(){}getSlice(e,n){return this.bytes.slice(e,n)}}class hie extends JD{constructor(e){super(),this.target=e,this.pos=0}write(e){this.maybeTrackWrites(e),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength}getPos(){return this.pos}seek(e){this.pos=e}async flush(){}async finalize(){}async close(){}}class fT{constructor(){this._output=null,this.onwrite=null}}class tL extends fT{constructor(){super(...arguments),this.buffer=null}_createWriter(){return new eL(this)}}class pie extends fT{_createWriter(){return new hie(this)}}const Qx=1e3,mie=2082844800,gie=t=>{const e={},n=t.track;return n.metadata.name!==void 0&&(e.name=n.metadata.name),e},wr=(t,e,n=!0)=>{const r=t*e;return n?Math.round(r):r};class yie extends ute{constructor(e,n){super(e),this.auxTarget=new tL,this.auxWriter=this.auxTarget._createWriter(),this.auxBoxWriter=new tI(this.auxWriter),this.mdat=null,this.ftypSize=null,this.trackDatas=[],this.allTracksKnown=ci(),this.creationTime=Math.floor(Date.now()/1e3)+mie,this.finalizedChunks=[],this.nextFragmentNumber=1,this.maxWrittenTimestamp=-1/0,this.format=n,this.writer=e._writer,this.boxWriter=new tI(this.writer),this.isQuickTime=n instanceof iL;const r=this.writer instanceof eL?"in-memory":!1;this.fastStart=n._options.fastStart??r,this.isFragmented=this.fastStart==="fragmented",(this.fastStart==="in-memory"||this.isFragmented)&&(this.writer.ensureMonotonicity=!0),this.minimumFragmentDuration=n._options.minimumFragmentDuration??1}async start(){const e=await this.mutex.acquire(),n=this.output._tracks.some(r=>r.type==="video"&&r.source._codec==="avc");if(this.format._options.onFtyp&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(are({isQuickTime:this.isQuickTime,holdsAvc:n,fragmented:this.isFragmented})),this.format._options.onFtyp){const{data:r,start:i}=this.writer.stopTrackingWrites();this.format._options.onFtyp(r,i)}if(this.ftypSize=this.writer.getPos(),this.fastStart!=="in-memory")if(this.fastStart==="reserve"){for(const r of this.output._tracks)if(r.metadata.maximumPacketCount===void 0)throw new Error("All tracks must specify maximumPacketCount in their metadata when using fastStart: 'reserve'.")}else this.isFragmented||(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=Ng(!0),this.boxWriter.writeBox(this.mdat));await this.writer.flush(),e()}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(n=>n.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map(n=>n.type==="video"||n.type==="audio"?n.info.decoderConfig.codec:{webvtt:"wvtt"}[n.track.source._codec]);return AD({isQuickTime:this.isQuickTime,hasVideo:this.trackDatas.some(n=>n.type==="video"),hasAudio:this.trackDatas.some(n=>n.type==="audio"),codecStrings:e})}getVideoTrackData(e,n,r){const i=this.trackDatas.find(c=>c.track===e);if(i)return i;ote(r),W(r),W(r.decoderConfig);const s={...r.decoderConfig};W(s.codedWidth!==void 0),W(s.codedHeight!==void 0);let o=!1;if(e.source._codec==="avc"&&!s.description){const c=eT(n.data);if(!c)throw new Error("Couldn't extract an AVCDecoderConfigurationRecord from the AVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.264) when not providing a description, or provide a description (must be an AVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in AVCC format.");s.description=pte(c),o=!0}else if(e.source._codec==="hevc"&&!s.description){const c=nT(n.data);if(!c)throw new Error("Couldn't extract an HEVCDecoderConfigurationRecord from the HEVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.265) when not providing a description, or provide a description (must be an HEVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in HEVC format.");s.description=kte(c),o=!0}const a=qee(1/(e.metadata.frameRate??57600),1e6).denominator,l={muxer:this,track:e,type:"video",info:{width:s.codedWidth,height:s.codedHeight,decoderConfig:s,requiresAnnexBTransformation:o},timescale:a,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(l),this.trackDatas.sort((c,u)=>c.track.id-u.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),l}getAudioTrackData(e,n,r){const i=this.trackDatas.find(l=>l.track===e);if(i)return i;lte(r),W(r),W(r.decoderConfig);const s={...r.decoderConfig};let o=!1;if(e.source._codec==="aac"&&!s.description){const l=sd(uo.tempFromBytes(n.data));if(!l)throw new Error("Couldn't parse ADTS header from the AAC packet. Make sure the packets are in ADTS format (as specified in ISO 13818-7) when not providing a description, or provide a description (must be an AudioSpecificConfig as specified in ISO 14496-3) and ensure the packets are raw AAC data.");const c=id[l.samplingFrequencyIndex],u=Zm[l.channelConfiguration];if(c===void 0||u===void 0)throw new Error("Invalid ADTS frame header.");s.description=uD({objectType:l.objectType,sampleRate:c,numberOfChannels:u}),o=!0}const a={muxer:this,track:e,type:"audio",info:{numberOfChannels:r.decoderConfig.numberOfChannels,sampleRate:r.decoderConfig.sampleRate,decoderConfig:s,requiresPcmTransformation:!this.isFragmented&&Pi.includes(e.source._codec),requiresAdtsStripping:o},timescale:r.decoderConfig.sampleRate,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(a),this.trackDatas.sort((l,c)=>l.track.id-c.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),a}getSubtitleTrackData(e,n){const r=this.trackDatas.find(s=>s.track===e);if(r)return r;cte(n),W(n),W(n.config);const i={muxer:this,track:e,type:"subtitle",info:{config:n.config},timescale:1e3,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[],lastCueEndTimestamp:0,cueQueue:[],nextSourceId:0,cueToSourceId:new WeakMap};return this.trackDatas.push(i),this.trackDatas.sort((s,o)=>s.track.id-o.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}async addEncodedVideoPacket(e,n,r){const i=await this.mutex.acquire();try{const s=this.getVideoTrackData(e,n,r);let o=n.data;if(s.info.requiresAnnexBTransformation){const c=[...Xm(o)].map(u=>o.subarray(u.offset,u.offset+u.length));if(c.length===0)throw new Error("Failed to transform packet data. Make sure all packets are provided in Annex B format, as specified in ITU-T-REC-H.264 and ITU-T-REC-H.265.");o=mD(c,4)}const a=this.validateAndNormalizeTimestamp(s.track,n.timestamp,n.type==="key"),l=this.createSampleForTrack(s,o,a,n.duration,n.type);await this.registerSample(s,l)}finally{i()}}async addEncodedAudioPacket(e,n,r){const i=await this.mutex.acquire();try{const s=this.getAudioTrackData(e,n,r);let o=n.data;if(s.info.requiresAdtsStripping){const c=sd(uo.tempFromBytes(o));if(!c)throw new Error("Expected ADTS frame, didn't get one.");const u=c.crcCheck===null?by:zu;o=o.subarray(u)}const a=this.validateAndNormalizeTimestamp(s.track,n.timestamp,n.type==="key"),l=this.createSampleForTrack(s,o,a,n.duration,n.type);s.info.requiresPcmTransformation&&await this.maybePadWithSilence(s,a),await this.registerSample(s,l)}finally{i()}}async maybePadWithSilence(e,n){const r=Wn(e.samples),i=r?r.timestamp+r.duration:0,s=n-i,o=wr(s,e.timescale);if(o>0){const{sampleSize:a,silentValue:l}=Yc(e.info.decoderConfig.codec),c=o*e.info.numberOfChannels,u=new Uint8Array(a*c).fill(l),d=this.createSampleForTrack(e,new Uint8Array(u.buffer),i,s,"key");await this.registerSample(e,d)}}async addSubtitleCue(e,n,r){const i=await this.mutex.acquire();try{const s=this.getSubtitleTrackData(e,r);this.validateAndNormalizeTimestamp(s.track,n.timestamp,!0),e.source._codec==="webvtt"&&(s.cueQueue.push(n),await this.processWebVTTCues(s,n.timestamp))}finally{i()}}async processWebVTTCues(e,n){for(;e.cueQueue.length>0;){const r=new Set([]);for(const c of e.cueQueue)W(c.timestamp<=n),W(e.lastCueEndTimestamp<=c.timestamp+c.duration),r.add(Math.max(c.timestamp,e.lastCueEndTimestamp)),r.add(c.timestamp+c.duration);const i=[...r].sort((c,u)=>c-u),s=i[0],o=i[1]??s;if(n<o)break;if(e.lastCueEndTimestamp<s){this.auxWriter.seek(0);const c=tie();this.auxBoxWriter.writeBox(c);const u=this.auxWriter.getSlice(0,this.auxWriter.getPos()),d=this.createSampleForTrack(e,u,e.lastCueEndTimestamp,s-e.lastCueEndTimestamp,"key");await this.registerSample(e,d),e.lastCueEndTimestamp=s}this.auxWriter.seek(0);for(let c=0;c<e.cueQueue.length;c++){const u=e.cueQueue[c];if(u.timestamp>=o)break;eI.lastIndex=0;const d=eI.test(u.text),f=u.timestamp+u.duration;let h=e.cueToSourceId.get(u);if(h===void 0&&o<f&&(h=e.nextSourceId++,e.cueToSourceId.set(u,h)),u.notes){const m=rie(u.notes);this.auxBoxWriter.writeBox(m)}const p=nie(u.text,d?s:null,u.identifier??null,u.settings??null,h??null);this.auxBoxWriter.writeBox(p),f===o&&e.cueQueue.splice(c--,1)}const a=this.auxWriter.getSlice(0,this.auxWriter.getPos()),l=this.createSampleForTrack(e,a,s,o-s,"key");await this.registerSample(e,l),e.lastCueEndTimestamp=o}}createSampleForTrack(e,n,r,i,s){return{timestamp:r,decodeTimestamp:r,duration:i,data:n,size:n.byteLength,type:s,timescaleUnitsToNextSample:wr(i,e.timescale)}}processTimestamps(e,n){if(e.timestampProcessingQueue.length===0)return;if(e.type==="audio"&&e.info.requiresPcmTransformation){let i=0;for(let s=0;s<e.timestampProcessingQueue.length;s++){const o=e.timestampProcessingQueue[s],a=wr(o.duration,e.timescale);i+=a}if(e.timeToSampleTable.length===0)e.timeToSampleTable.push({sampleCount:i,sampleDelta:1});else{const s=Wn(e.timeToSampleTable);s.sampleCount+=i}e.timestampProcessingQueue.length=0;return}const r=e.timestampProcessingQueue.map(i=>i.timestamp).sort((i,s)=>i-s);for(let i=0;i<e.timestampProcessingQueue.length;i++){const s=e.timestampProcessingQueue[i];s.decodeTimestamp=r[i],!this.isFragmented&&e.lastTimescaleUnits===null&&(s.decodeTimestamp=0);const o=wr(s.timestamp-s.decodeTimestamp,e.timescale),a=wr(s.duration,e.timescale);if(e.lastTimescaleUnits!==null){W(e.lastSample);const l=wr(s.decodeTimestamp,e.timescale,!1),c=Math.round(l-e.lastTimescaleUnits);if(W(c>=0),e.lastTimescaleUnits+=c,e.lastSample.timescaleUnitsToNextSample=c,!this.isFragmented){let u=Wn(e.timeToSampleTable);if(W(u),u.sampleCount===1){u.sampleDelta=c;const f=e.timeToSampleTable[e.timeToSampleTable.length-2];f&&f.sampleDelta===c&&(f.sampleCount++,e.timeToSampleTable.pop(),u=f)}else u.sampleDelta!==c&&(u.sampleCount--,e.timeToSampleTable.push(u={sampleCount:1,sampleDelta:c}));u.sampleDelta===a?u.sampleCount++:e.timeToSampleTable.push({sampleCount:1,sampleDelta:a});const d=Wn(e.compositionTimeOffsetTable);W(d),d.sampleCompositionTimeOffset===o?d.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:o})}}else e.lastTimescaleUnits=wr(s.decodeTimestamp,e.timescale,!1),this.isFragmented||(e.timeToSampleTable.push({sampleCount:1,sampleDelta:a}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:o}));e.lastSample=s}if(e.timestampProcessingQueue.length=0,W(e.lastSample),W(e.lastTimescaleUnits!==null),n!==void 0&&e.lastSample.timescaleUnitsToNextSample===0){W(n.type==="key");const i=wr(n.timestamp,e.timescale,!1),s=Math.round(i-e.lastTimescaleUnits);e.lastSample.timescaleUnitsToNextSample=s}}async registerSample(e,n){n.type==="key"&&this.processTimestamps(e,n),e.timestampProcessingQueue.push(n),this.isFragmented?(e.sampleQueue.push(n),await this.interleaveSamples()):this.fastStart==="reserve"?await this.registerSampleFastStartReserve(e,n):await this.addSampleToTrack(e,n)}async addSampleToTrack(e,n){if(!this.isFragmented&&(e.samples.push(n),this.fastStart==="reserve")){const i=e.track.metadata.maximumPacketCount;if(W(i!==void 0),e.samples.length>i)throw new Error(`Track #${e.track.id} has already reached the maximum packet count (${i}). Either add less packets or increase the maximum packet count.`)}let r=!1;if(!e.currentChunk)r=!0;else{e.currentChunk.startTimestamp=Math.min(e.currentChunk.startTimestamp,n.timestamp);const i=n.timestamp-e.currentChunk.startTimestamp;if(this.isFragmented){const s=this.trackDatas.every(o=>{if(e===o)return n.type==="key";const a=o.sampleQueue[0];return a?a.type==="key":o.track.source._closed});i>=this.minimumFragmentDuration&&s&&n.timestamp>this.maxWrittenTimestamp&&(r=!0,await this.finalizeFragment())}else r=i>=.5}r&&(e.currentChunk&&await this.finalizeCurrentChunk(e),e.currentChunk={startTimestamp:n.timestamp,samples:[],offset:null,moofOffset:null}),W(e.currentChunk),e.currentChunk.samples.push(n),this.isFragmented&&(this.maxWrittenTimestamp=Math.max(this.maxWrittenTimestamp,n.timestamp))}async finalizeCurrentChunk(e){if(W(!this.isFragmented),!e.currentChunk)return;e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk);let n=e.currentChunk.samples.length;if(e.type==="audio"&&e.info.requiresPcmTransformation&&(n=e.currentChunk.samples.reduce((r,i)=>r+wr(i.duration,e.timescale),0)),(e.compactlyCodedChunkTable.length===0||Wn(e.compactlyCodedChunkTable).samplesPerChunk!==n)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:n}),this.fastStart==="in-memory"){e.currentChunk.offset=0;return}e.currentChunk.offset=this.writer.getPos();for(const r of e.currentChunk.samples)W(r.data),this.writer.write(r.data),r.data=null;await this.writer.flush()}async interleaveSamples(e=!1){if(W(this.isFragmented),!(!e&&!this.allTracksAreKnown()))e:for(;;){let n=null,r=1/0;for(const s of this.trackDatas){if(!e&&s.sampleQueue.length===0&&!s.track.source._closed)break e;s.sampleQueue.length>0&&s.sampleQueue[0].timestamp<r&&(n=s,r=s.sampleQueue[0].timestamp)}if(!n)break;const i=n.sampleQueue.shift();await this.addSampleToTrack(n,i)}}async finalizeFragment(e=!0){W(this.isFragmented);const n=this.nextFragmentNumber++;if(n===1){this.format._options.onMoov&&this.writer.startTrackingWrites();const h=$h(this);if(this.boxWriter.writeBox(h),this.format._options.onMoov){const{data:p,start:m}=this.writer.stopTrackingWrites();this.format._options.onMoov(p,m)}}const r=this.trackDatas.filter(h=>h.currentChunk),i=rI(n,r),s=this.writer.getPos(),o=s+this.boxWriter.measureBox(i);let a=o+Ua,l=1/0;for(const h of r){h.currentChunk.offset=a,h.currentChunk.moofOffset=s;for(const p of h.currentChunk.samples)a+=p.size;l=Math.min(l,h.currentChunk.startTimestamp)}const c=a-o,u=c>=2**32;if(u)for(const h of r)h.currentChunk.offset+=Au-Ua;this.format._options.onMoof&&this.writer.startTrackingWrites();const d=rI(n,r);if(this.boxWriter.writeBox(d),this.format._options.onMoof){const{data:h,start:p}=this.writer.stopTrackingWrites();this.format._options.onMoof(h,p,l)}W(this.writer.getPos()===o),this.format._options.onMdat&&this.writer.startTrackingWrites();const f=Ng(u);f.size=c,this.boxWriter.writeBox(f),this.writer.seek(o+(u?Au:Ua));for(const h of r)for(const p of h.currentChunk.samples)this.writer.write(p.data),p.data=null;if(this.format._options.onMdat){const{data:h,start:p}=this.writer.stopTrackingWrites();this.format._options.onMdat(h,p)}for(const h of r)h.finalizedChunks.push(h.currentChunk),this.finalizedChunks.push(h.currentChunk),h.currentChunk=null;e&&await this.writer.flush()}async registerSampleFastStartReserve(e,n){if(this.allTracksAreKnown()){if(!this.mdat){const r=$h(this),s=this.boxWriter.measureBox(r)+this.computeSampleTableSizeUpperBound()+4096;W(this.ftypSize!==null),this.writer.seek(this.ftypSize+s),this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=Ng(!0),this.boxWriter.writeBox(this.mdat);for(const o of this.trackDatas){for(const a of o.sampleQueue)await this.addSampleToTrack(o,a);o.sampleQueue.length=0}}await this.addSampleToTrack(e,n)}else e.sampleQueue.push(n)}computeSampleTableSizeUpperBound(){W(this.fastStart==="reserve");let e=0;for(const n of this.trackDatas){const r=n.track.metadata.maximumPacketCount;W(r!==void 0),e+=8*Math.ceil(2/3*r),e+=4*r,e+=8*Math.ceil(2/3*r),e+=12*Math.ceil(2/3*r),e+=4*r,e+=8*r}return e}async onTrackClose(e){const n=await this.mutex.acquire();if(e.type==="subtitle"&&e.source._codec==="webvtt"){const r=this.trackDatas.find(i=>i.track===e);r&&await this.processWebVTTCues(r,1/0)}this.allTracksAreKnown()&&this.allTracksKnown.resolve(),this.isFragmented&&await this.interleaveSamples(),n()}async finalize(){const e=await this.mutex.acquire();this.allTracksKnown.resolve();for(const n of this.trackDatas)n.type==="subtitle"&&n.track.source._codec==="webvtt"&&await this.processWebVTTCues(n,1/0);if(this.isFragmented){await this.interleaveSamples(!0);for(const n of this.trackDatas)this.processTimestamps(n);await this.finalizeFragment(!1)}else for(const n of this.trackDatas)this.processTimestamps(n),await this.finalizeCurrentChunk(n);if(this.fastStart==="in-memory"){this.mdat=Ng(!1);let n;for(let i=0;i<2;i++){const s=$h(this),o=this.boxWriter.measureBox(s);n=this.boxWriter.measureBox(this.mdat);let a=this.writer.getPos()+o+n;for(const l of this.finalizedChunks){l.offset=a;for(const{data:c}of l.samples)W(c),a+=c.byteLength,n+=c.byteLength}if(a<2**32)break;n>=2**32&&(this.mdat.largeSize=!0)}this.format._options.onMoov&&this.writer.startTrackingWrites();const r=$h(this);if(this.boxWriter.writeBox(r),this.format._options.onMoov){const{data:i,start:s}=this.writer.stopTrackingWrites();this.format._options.onMoov(i,s)}this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat.size=n,this.boxWriter.writeBox(this.mdat);for(const i of this.finalizedChunks)for(const s of i.samples)W(s.data),this.writer.write(s.data),s.data=null;if(this.format._options.onMdat){const{data:i,start:s}=this.writer.stopTrackingWrites();this.format._options.onMdat(i,s)}}else if(this.isFragmented){const n=this.writer.getPos(),r=Yre(this.trackDatas);this.boxWriter.writeBox(r);const i=this.writer.getPos()-n;this.writer.seek(this.writer.getPos()-4),this.boxWriter.writeU32(i)}else{W(this.mdat);const n=this.boxWriter.offsets.get(this.mdat);W(n!==void 0);const r=this.writer.getPos()-n;if(this.mdat.size=r,this.mdat.largeSize=r>=2**32,this.boxWriter.patchBox(this.mdat),this.format._options.onMdat){const{data:s,start:o}=this.writer.stopTrackingWrites();this.format._options.onMdat(s,o)}const i=$h(this);if(this.fastStart==="reserve"){W(this.ftypSize!==null),this.writer.seek(this.ftypSize),this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(i);const s=this.boxWriter.offsets.get(this.mdat)-this.writer.getPos();this.boxWriter.writeBox(lre(s))}else this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(i);if(this.format._options.onMoov){const{data:s,start:o}=this.writer.stopTrackingWrites();this.format._options.onMoov(s,o)}}e()}}class nL{getSupportedVideoCodecs(){return this.getSupportedCodecs().filter(e=>ea.includes(e))}getSupportedAudioCodecs(){return this.getSupportedCodecs().filter(e=>ta.includes(e))}getSupportedSubtitleCodecs(){return this.getSupportedCodecs().filter(e=>hy.includes(e))}_codecUnsupportedHint(e){return""}}class rL extends nL{constructor(e={}){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(e.fastStart!==void 0&&![!1,"in-memory","reserve","fragmented"].includes(e.fastStart))throw new TypeError("options.fastStart, when provided, must be false, 'in-memory', 'reserve', or 'fragmented'.");if(e.minimumFragmentDuration!==void 0&&(!Number.isFinite(e.minimumFragmentDuration)||e.minimumFragmentDuration<0))throw new TypeError("options.minimumFragmentDuration, when provided, must be a non-negative number.");if(e.onFtyp!==void 0&&typeof e.onFtyp!="function")throw new TypeError("options.onFtyp, when provided, must be a function.");if(e.onMoov!==void 0&&typeof e.onMoov!="function")throw new TypeError("options.onMoov, when provided, must be a function.");if(e.onMdat!==void 0&&typeof e.onMdat!="function")throw new TypeError("options.onMdat, when provided, must be a function.");if(e.onMoof!==void 0&&typeof e.onMoof!="function")throw new TypeError("options.onMoof, when provided, must be a function.");if(e.metadataFormat!==void 0&&!["mdir","mdta","udta","auto"].includes(e.metadataFormat))throw new TypeError("options.metadataFormat, when provided, must be either 'auto', 'mdir', 'mdta', or 'udta'.");super(),this._options=e}getSupportedTrackCounts(){return{video:{min:0,max:4294967295},audio:{min:0,max:4294967295},subtitle:{min:0,max:4294967295},total:{min:1,max:4294967295}}}get supportsVideoRotationMetadata(){return!0}_createMuxer(e){return new yie(e,this)}}class hT extends rL{constructor(e){super(e)}get _name(){return"MP4"}get fileExtension(){return".mp4"}get mimeType(){return"video/mp4"}getSupportedCodecs(){return[...ea,...Sp,"pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be",...hy]}_codecUnsupportedHint(e){return new iL().getSupportedCodecs().includes(e)?" Switching to MOV will grant support for this codec.":""}}class iL extends rL{constructor(e){super(e)}get _name(){return"MOV"}get fileExtension(){return".mov"}get mimeType(){return"video/quicktime"}getSupportedCodecs(){return[...ea,...ta]}_codecUnsupportedHint(e){return new hT().getSupportedCodecs().includes(e)?" Switching to MP4 will grant support for this codec.":""}}const bie=t=>{if(!t||typeof t!="object")throw new TypeError("Encoding config must be an object.");if(!ea.includes(t.codec))throw new TypeError(`Invalid video codec '${t.codec}'. Must be one of: ${ea.join(", ")}.`);if(!(t.bitrate instanceof ho)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("config.bitrate must be a positive integer or a quality.");if(t.keyFrameInterval!==void 0&&(!Number.isFinite(t.keyFrameInterval)||t.keyFrameInterval<0))throw new TypeError("config.keyFrameInterval, when provided, must be a non-negative number.");if(t.sizeChangeBehavior!==void 0&&!["deny","passThrough","fill","contain","cover"].includes(t.sizeChangeBehavior))throw new TypeError("config.sizeChangeBehavior, when provided, must be 'deny', 'passThrough', 'fill', 'contain' or 'cover'.");if(t.onEncodedPacket!==void 0&&typeof t.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(t.onEncoderConfig!==void 0&&typeof t.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");sL(t.codec,t)},sL=(t,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.alpha!==void 0&&!["discard","keep"].includes(e.alpha))throw new TypeError("options.alpha, when provided, must be 'discard' or 'keep'.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.latencyMode!==void 0&&!["quality","realtime"].includes(e.latencyMode))throw new TypeError("latencyMode, when provided, must be 'quality' or 'realtime'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&fD(e.fullCodecString)!==t)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${t}).`);if(e.hardwareAcceleration!==void 0&&!["no-preference","prefer-hardware","prefer-software"].includes(e.hardwareAcceleration))throw new TypeError("hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.");if(e.scalabilityMode!==void 0&&typeof e.scalabilityMode!="string")throw new TypeError("scalabilityMode, when provided, must be a string.");if(e.contentHint!==void 0&&typeof e.contentHint!="string")throw new TypeError("contentHint, when provided, must be a string.")},Yx=t=>{const e=t.bitrate instanceof ho?t.bitrate._toVideoBitrate(t.codec,t.width,t.height):t.bitrate;return{codec:t.fullCodecString??Xee(t.codec,t.width,t.height,e),width:t.width,height:t.height,bitrate:e,bitrateMode:t.bitrateMode,alpha:t.alpha??"discard",framerate:t.framerate,latencyMode:t.latencyMode,hardwareAcceleration:t.hardwareAcceleration,scalabilityMode:t.scalabilityMode,contentHint:t.contentHint,...Jee(t.codec)}},wie=t=>{if(!t||typeof t!="object")throw new TypeError("Encoding config must be an object.");if(!ta.includes(t.codec))throw new TypeError(`Invalid audio codec '${t.codec}'. Must be one of: ${ta.join(", ")}.`);if(t.bitrate===void 0&&(!Pi.includes(t.codec)||t.codec==="flac"))throw new TypeError("config.bitrate must be provided for compressed audio codecs.");if(t.bitrate!==void 0&&!(t.bitrate instanceof ho)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("config.bitrate, when provided, must be a positive integer or a quality.");if(t.onEncodedPacket!==void 0&&typeof t.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(t.onEncoderConfig!==void 0&&typeof t.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");oL(t.codec,t)},oL=(t,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&fD(e.fullCodecString)!==t)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${t}).`)},Jx=t=>{const e=t.bitrate instanceof ho?t.bitrate._toAudioBitrate(t.codec):t.bitrate;return{codec:t.fullCodecString??Yee(t.codec,t.numberOfChannels,t.sampleRate),numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate,bitrate:e,bitrateMode:t.bitrateMode,...ete(t.codec)}};class ho{constructor(e){this._factor=e}_toVideoBitrate(e,n,r){const i=n*r,s={avc:1,hevc:.6,vp9:.6,av1:.4,vp8:1.2},o=1920*1080,a=3e6,l=Math.pow(i/o,.95),d=a*l*s[e]*this._factor;return Math.ceil(d/1e3)*1e3}_toAudioBitrate(e){if(Pi.includes(e)||e==="flac")return;const r={aac:128e3,opus:64e3,mp3:16e4,vorbis:64e3}[e];if(!r)throw new Error(`Unhandled codec: ${e}`);let i=r*this._factor;return e==="aac"?i=[96e3,128e3,16e4,192e3].reduce((o,a)=>Math.abs(a-i)<Math.abs(o-i)?a:o):e==="opus"||e==="vorbis"?i=Math.max(6e3,i):e==="mp3"&&(i=[8e3,16e3,24e3,32e3,4e4,48e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4].reduce((o,a)=>Math.abs(a-i)<Math.abs(o-i)?a:o)),Math.round(i/1e3)*1e3}}const sI=new ho(.3),oI=new ho(1),vy=new ho(2),vie=async(t,e={})=>{const{width:n=1280,height:r=720,bitrate:i=1e6,...s}=e;if(!ea.includes(t))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("width must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("height must be a positive integer.");if(!(i instanceof ho)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer or a quality.");sL(t,s);let o=null;return Ux.length>0&&(o??=Yx({codec:t,width:n,height:r,bitrate:i,framerate:void 0,...s}),Ux.some(c=>c.supports(t,o)))?!0:typeof VideoEncoder>"u"||(n%2===1||r%2===1)&&(t==="avc"||t==="hevc")||(o??=Yx({codec:t,width:n,height:r,bitrate:i,framerate:void 0,...s,alpha:"discard"}),!(await VideoEncoder.isConfigSupported(o)).supported)?!1:Uf()?new Promise(async c=>{try{const u=new VideoEncoder({output:()=>{},error:()=>c(!1)});u.configure(o);const d=new Uint8Array(n*r*4),f=new VideoFrame(d,{format:"RGBA",codedWidth:n,codedHeight:r,timestamp:0});u.encode(f),f.close(),await u.flush(),c(!0)}catch{c(!1)}}):!0},xie=async(t,e={})=>{const{numberOfChannels:n=2,sampleRate:r=48e3,bitrate:i=128e3,...s}=e;if(!ta.includes(t))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("numberOfChannels must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("sampleRate must be a positive integer.");if(!(i instanceof ho)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer.");oL(t,s);let o=null;return Hx.length>0&&(o??=Jx({codec:t,numberOfChannels:n,sampleRate:r,bitrate:i,...s}),Hx.some(l=>l.supports(t,o)))||Pi.includes(t)?!0:typeof AudioEncoder>"u"?!1:(o??=Jx({codec:t,numberOfChannels:n,sampleRate:r,bitrate:i,...s}),(await AudioEncoder.isConfigSupported(o)).supported===!0)},eS=async(t=ta,e)=>{const n=await Promise.all(t.map(r=>xie(r,e)));return t.filter((r,i)=>n[i])},Sie=async(t,e)=>{for(const n of t)if(await vie(n,e))return n;return null};class pT{constructor(){this._connectedTrack=null,this._closingPromise=null,this._closed=!1,this._timestampOffset=0}_ensureValidAdd(){if(!this._connectedTrack)throw new Error("Source is not connected to an output track.");if(this._connectedTrack.output.state==="canceled")throw new Error("Output has been canceled.");if(this._connectedTrack.output.state==="finalizing"||this._connectedTrack.output.state==="finalized")throw new Error("Output has been finalized.");if(this._connectedTrack.output.state==="pending")throw new Error("Output has not started.");if(this._closed)throw new Error("Source is closed.")}async _start(){}async _flushAndClose(e){}close(){if(this._closingPromise)return;const e=this._connectedTrack;if(!e)throw new Error("Cannot call close without connecting the source to an output track.");if(e.output.state==="pending")throw new Error("Cannot call close before output has been started.");this._closingPromise=(async()=>{await this._flushAndClose(!1),this._closed=!0,!(e.output.state==="finalizing"||e.output.state==="finalized")&&e.output._muxer.onTrackClose(e)})()}async _flushOrWaitForOngoingClose(e){return this._closingPromise??=(async()=>{await this._flushAndClose(e),this._closed=!0})()}}class mT extends pT{constructor(e){if(super(),this._connectedTrack=null,!ea.includes(e))throw new TypeError(`Invalid video codec '${e}'. Must be one of: ${ea.join(", ")}.`);this._codec=e}}class kie extends mT{constructor(e){super(e)}add(e,n){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedVideoPacket(this._connectedTrack,e,n)}}class Eie{constructor(e,n){this.source=e,this.encodingConfig=n,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastMultipleOfKeyFrameInterval=-1,this.codedWidth=null,this.codedHeight=null,this.resizeCanvas=null,this.customEncoder=null,this.customEncoderCallSerializer=new dw,this.customEncoderQueueSize=0,this.alphaEncoder=null,this.splitter=null,this.splitterCreationFailed=!1,this.alphaFrameQueue=[],this.error=null,this.errorNeedsNewStack=!0}async add(e,n,r){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.codedWidth!==null&&this.codedHeight!==null){if(e.codedWidth!==this.codedWidth||e.codedHeight!==this.codedHeight){const a=this.encodingConfig.sizeChangeBehavior??"deny";if(a!=="passThrough"){if(a==="deny")throw new Error(`Video sample size must remain constant. Expected ${this.codedWidth}x${this.codedHeight}, got ${e.codedWidth}x${e.codedHeight}. To allow the sample size to change over time, set \`sizeChangeBehavior\` to a value other than 'strict' in the encoding options.`);{let l=!1;this.resizeCanvas||(typeof document<"u"?(this.resizeCanvas=document.createElement("canvas"),this.resizeCanvas.width=this.codedWidth,this.resizeCanvas.height=this.codedHeight):this.resizeCanvas=new OffscreenCanvas(this.codedWidth,this.codedHeight),l=!0);const c=this.resizeCanvas.getContext("2d",{alpha:Uf()});W(c),l||(Uf()?(c.fillStyle="black",c.fillRect(0,0,this.codedWidth,this.codedHeight)):c.clearRect(0,0,this.codedWidth,this.codedHeight)),e.drawWithFit(c,{fit:a}),n&&e.close(),e=new _i(this.resizeCanvas,{timestamp:e.timestamp,duration:e.duration,rotation:e.rotation}),n=!0}}}}else this.codedWidth=e.codedWidth,this.codedHeight=e.codedHeight;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),W(this.encoderInitialized);const i=this.encodingConfig.keyFrameInterval??5,s=Math.floor(e.timestamp/i),o={...r,keyFrame:r?.keyFrame||i===0||s!==this.lastMultipleOfKeyFrameInterval};if(this.lastMultipleOfKeyFrameInterval=s,this.customEncoder){this.customEncoderQueueSize++;const a=e.clone(),l=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(a,o)).then(()=>this.customEncoderQueueSize--).catch(c=>this.error??=c).finally(()=>{a.close()});this.customEncoderQueueSize>=4&&await l}else{W(this.encoder);const a=e.toVideoFrame();if(!this.alphaEncoder)this.encoder.encode(a,o),a.close();else if(!!a.format&&!a.format.includes("A")||this.splitterCreationFailed)this.alphaFrameQueue.push(null),this.encoder.encode(a,o),a.close();else{const c=a.displayWidth,u=a.displayHeight;if(!this.splitter)try{this.splitter=new Tie(c,u)}catch(d){console.error("Due to an error, only color data will be encoded.",d),this.splitterCreationFailed=!0,this.alphaFrameQueue.push(null),this.encoder.encode(a,o),a.close()}if(this.splitter){const d=this.splitter.extractColor(a),f=this.splitter.extractAlpha(a);this.alphaFrameQueue.push(f),this.encoder.encode(d,o),d.close(),a.close()}}n&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(l=>this.encoder.addEventListener("dequeue",l,{once:!0}))}await this.muxer.mutex.currentPromise}finally{n&&e.close()}}ensureEncoder(e){const n=new Error;this.ensureEncoderPromise=(async()=>{const r=Yx({width:e.codedWidth,height:e.codedHeight,...this.encodingConfig,framerate:this.source._connectedTrack?.metadata.frameRate});this.encodingConfig.onEncoderConfig?.(r);const i=Ux.find(s=>s.supports(this.encodingConfig.codec,r));if(i)this.customEncoder=new i,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=r,this.customEncoder.onPacket=(s,o)=>{if(!(s instanceof Mn))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(o!==void 0&&(!o||typeof o!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(s,o),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,s,o).catch(a=>{this.error??=a,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else{if(typeof VideoEncoder>"u")throw new Error("VideoEncoder is not supported by this browser.");if(r.alpha="discard",this.encodingConfig.alpha==="keep"&&(r.latencyMode="quality"),(r.width%2===1||r.height%2===1)&&(this.encodingConfig.codec==="avc"||this.encodingConfig.codec==="hevc"))throw new Error(`The dimensions ${r.width}x${r.height} are not supported for codec '${this.encodingConfig.codec}'; both width and height must be even numbers. Make sure to round your dimensions to the nearest even number.`);if(!(await VideoEncoder.isConfigSupported(r)).supported)throw new Error(`This specific encoder configuration (${r.codec}, ${r.bitrate} bps, ${r.width}x${r.height}, hardware acceleration: ${r.hardwareAcceleration??"no-preference"}) is not supported by this browser. Consider using another codec or changing your video parameters.`);const a=[],l=[];let c=0,u=0;const d=(f,h,p)=>{const m={};if(h){const y=new Uint8Array(h.byteLength);h.copyTo(y),m.alpha=y}const g=Mn.fromEncodedChunk(f,m);this.encodingConfig.onEncodedPacket?.(g,p),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,g,p).catch(y=>{this.error??=y,this.errorNeedsNewStack=!1})};this.encoder=new VideoEncoder({output:(f,h)=>{if(!this.alphaEncoder){d(f,null,h);return}const p=this.alphaFrameQueue.shift();W(p!==void 0),p?(this.alphaEncoder.encode(p,{keyFrame:f.type==="key"}),u++,p.close(),a.push({chunk:f,meta:h})):u===0?d(f,null,h):(l.push(c+u),a.push({chunk:f,meta:h}))},error:f=>{f.stack=n.stack,this.error??=f}}),this.encoder.configure(r),this.encodingConfig.alpha==="keep"&&(this.alphaEncoder=new VideoEncoder({output:(f,h)=>{u--;const p=a.shift();for(W(p!==void 0),d(p.chunk,f,p.meta),c++;l.length>0&&l[0]===c;){l.shift();const m=a.shift();W(m!==void 0),d(m.chunk,null,m.meta)}},error:f=>{f.stack=n.stack,this.error??=f}}),this.alphaEncoder.configure(r))}W(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||(await this.encoder.flush(),await this.alphaEncoder?.flush()),this.encoder.state!=="closed"&&this.encoder.close(),this.alphaEncoder&&this.alphaEncoder.state!=="closed"&&this.alphaEncoder.close(),this.alphaFrameQueue.forEach(n=>n?.close()),this.splitter?.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class Tie{constructor(e,n){this.lastFrame=null,typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(e,n):(this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=n);const r=this.canvas.getContext("webgl2",{alpha:!0});if(!r)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=r,this.colorProgram=this.createColorProgram(),this.alphaProgram=this.createAlphaProgram(),this.vao=this.createVAO(),this.sourceTexture=this.createTexture(),this.alphaResolutionLocation=this.gl.getUniformLocation(this.alphaProgram,"u_resolution"),this.gl.useProgram(this.colorProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.colorProgram,"u_sourceTexture"),0),this.gl.useProgram(this.alphaProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.alphaProgram,"u_sourceTexture"),0)}createVertexShader(){return this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`)}createColorProgram(){const e=this.createVertexShader(),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec4 source = texture(u_sourceTexture, v_texCoord);
				fragColor = vec4(source.rgb, 1.0);
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createAlphaProgram(){const e=this.createVertexShader(),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			uniform vec2 u_resolution; // The width and height of the canvas
			in vec2 v_texCoord;
			out vec4 fragColor;

			// This function determines the value for a single byte in the YUV stream
			float getByteValue(float byteOffset) {
				float width = u_resolution.x;
				float height = u_resolution.y;

				float yPlaneSize = width * height;

				if (byteOffset < yPlaneSize) {
					// This byte is in the luma plane. Find the corresponding pixel coordinates to sample from
					float y = floor(byteOffset / width);
					float x = mod(byteOffset, width);
					
					// Add 0.5 to sample the center of the texel
					vec2 sampleCoord = (vec2(x, y) + 0.5) / u_resolution;
					
					// The luma value is the alpha from the source texture
					return texture(u_sourceTexture, sampleCoord).a;
				} else {
					// Write a fixed value for chroma and beyond
					return 128.0 / 255.0;
				}
			}
			
			void main() {
				// Each fragment writes 4 bytes (R, G, B, A)
				float pixelIndex = floor(gl_FragCoord.y) * u_resolution.x + floor(gl_FragCoord.x);
				float baseByteOffset = pixelIndex * 4.0;

				vec4 result;
				for (int i = 0; i < 4; i++) {
					float currentByteOffset = baseByteOffset + float(i);
					result[i] = getByteValue(currentByteOffset);
				}
				
				fragColor = result;
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createShader(e,n){const r=this.gl.createShader(e);return this.gl.shaderSource(r,n),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)||console.error("Shader compile error:",this.gl.getShaderInfoLog(r)),r}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const n=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(this.colorProgram,"a_position"),s=this.gl.getAttribLocation(this.colorProgram,"a_texCoord");return this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}updateTexture(e){this.lastFrame!==e&&((e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sourceTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.lastFrame=e)}extractColor(e){return this.updateTexture(e),this.gl.useProgram(this.colorProgram),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),new VideoFrame(this.canvas,{timestamp:e.timestamp,duration:e.duration??void 0,alpha:"discard"})}extractAlpha(e){this.updateTexture(e),this.gl.useProgram(this.alphaProgram),this.gl.uniform2f(this.alphaResolutionLocation,this.canvas.width,this.canvas.height),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const{width:n,height:r}=this.canvas,i=Math.ceil(n/2)*Math.ceil(r/2),s=n*r+i*2,o=Math.ceil(s/(n*4));let a=new Uint8Array(4*n*o);this.gl.readPixels(0,0,n,o,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),a=a.subarray(0,s),W(a[n*r]===128),W(a[a.length-1]===128);const l={format:"I420",codedWidth:n,codedHeight:r,timestamp:e.timestamp,duration:e.duration??void 0,transfer:[a.buffer]};return new VideoFrame(a,l)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class aI extends mT{constructor(e){bie(e),super(e.codec),this._encoder=new Eie(this,e)}add(e,n){if(!(e instanceof _i))throw new TypeError("videoSample must be a VideoSample.");return this._encoder.add(e,!1,n)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class gT extends pT{constructor(e){if(super(),this._connectedTrack=null,!ta.includes(e))throw new TypeError(`Invalid audio codec '${e}'. Must be one of: ${ta.join(", ")}.`);this._codec=e}}class Cie extends gT{constructor(e){super(e)}add(e,n){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedAudioPacket(this._connectedTrack,e,n)}}class _ie{constructor(e,n){this.source=e,this.encodingConfig=n,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastNumberOfChannels=null,this.lastSampleRate=null,this.isPcmEncoder=!1,this.outputSampleSize=null,this.writeOutputValue=null,this.customEncoder=null,this.customEncoderCallSerializer=new dw,this.customEncoderQueueSize=0,this.lastEndSampleIndex=null,this.error=null,this.errorNeedsNewStack=!0}async add(e,n){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.lastNumberOfChannels!==null&&this.lastSampleRate!==null){if(e.numberOfChannels!==this.lastNumberOfChannels||e.sampleRate!==this.lastSampleRate)throw new Error(`Audio parameters must remain constant. Expected ${this.lastNumberOfChannels} channels at ${this.lastSampleRate} Hz, got ${e.numberOfChannels} channels at ${e.sampleRate} Hz.`)}else this.lastNumberOfChannels=e.numberOfChannels,this.lastSampleRate=e.sampleRate;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),W(this.encoderInitialized);{const r=Math.round(e.timestamp*e.sampleRate),i=Math.round((e.timestamp+e.duration)*e.sampleRate);if(this.lastEndSampleIndex===null)this.lastEndSampleIndex=i;else{const s=r-this.lastEndSampleIndex;if(s>=64){const o=new Ds({data:new Float32Array(s*e.numberOfChannels),format:"f32-planar",sampleRate:e.sampleRate,numberOfChannels:e.numberOfChannels,numberOfFrames:s,timestamp:this.lastEndSampleIndex/e.sampleRate});await this.add(o,!0)}this.lastEndSampleIndex+=e.numberOfFrames}}if(this.customEncoder){this.customEncoderQueueSize++;const r=e.clone(),i=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(r)).then(()=>this.customEncoderQueueSize--).catch(s=>this.error??=s).finally(()=>{r.close()});this.customEncoderQueueSize>=4&&await i,await this.muxer.mutex.currentPromise}else if(this.isPcmEncoder)await this.doPcmEncoding(e,n);else{W(this.encoder);const r=e.toAudioData();this.encoder.encode(r),r.close(),n&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(i=>this.encoder.addEventListener("dequeue",i,{once:!0})),await this.muxer.mutex.currentPromise}}finally{n&&e.close()}}async doPcmEncoding(e,n){W(this.outputSampleSize),W(this.writeOutputValue);const{numberOfChannels:r,numberOfFrames:i,sampleRate:s,timestamp:o}=e,a=2048,l=[];for(let f=0;f<i;f+=a){const h=Math.min(a,e.numberOfFrames-f),p=h*r*this.outputSampleSize,m=new ArrayBuffer(p),g=new DataView(m);l.push({frameCount:h,view:g})}const c=e.allocationSize({planeIndex:0,format:"f32-planar"}),u=new Float32Array(c/Float32Array.BYTES_PER_ELEMENT);for(let f=0;f<r;f++){e.copyTo(u,{planeIndex:f,format:"f32-planar"});for(let h=0;h<l.length;h++){const{frameCount:p,view:m}=l[h];for(let g=0;g<p;g++)this.writeOutputValue(m,(g*r+f)*this.outputSampleSize,u[h*a+g])}}n&&e.close();const d={decoderConfig:{codec:this.encodingConfig.codec,numberOfChannels:r,sampleRate:s}};for(let f=0;f<l.length;f++){const{frameCount:h,view:p}=l[f],m=p.buffer,g=f*a,y=new Mn(new Uint8Array(m),"key",o+g/s,h/s);this.encodingConfig.onEncodedPacket?.(y,d),await this.muxer.addEncodedAudioPacket(this.source._connectedTrack,y,d)}}ensureEncoder(e){const n=new Error;this.ensureEncoderPromise=(async()=>{const{numberOfChannels:r,sampleRate:i}=e,s=Jx({numberOfChannels:r,sampleRate:i,...this.encodingConfig});this.encodingConfig.onEncoderConfig?.(s);const o=Hx.find(a=>a.supports(this.encodingConfig.codec,s));if(o)this.customEncoder=new o,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=s,this.customEncoder.onPacket=(a,l)=>{if(!(a instanceof Mn))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(l!==void 0&&(!l||typeof l!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(a,l),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,a,l).catch(c=>{this.error??=c,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else if(Pi.includes(this.encodingConfig.codec))this.initPcmEncoder();else{if(typeof AudioEncoder>"u")throw new Error("AudioEncoder is not supported by this browser.");if(!(await AudioEncoder.isConfigSupported(s)).supported)throw new Error(`This specific encoder configuration (${s.codec}, ${s.bitrate} bps, ${s.numberOfChannels} channels, ${s.sampleRate} Hz) is not supported by this browser. Consider using another codec or changing your audio parameters.`);this.encoder=new AudioEncoder({output:(l,c)=>{if(this.encodingConfig.codec==="aac"&&c?.decoderConfig){let d=!1;if(!c.decoderConfig.description||c.decoderConfig.description.byteLength<2?d=!0:d=JE(fs(c.decoderConfig.description)).objectType===0,d){const f=Number(Wn(s.codec.split(".")));c.decoderConfig.description=uD({objectType:f,numberOfChannels:c.decoderConfig.numberOfChannels,sampleRate:c.decoderConfig.sampleRate})}}const u=Mn.fromEncodedChunk(l);this.encodingConfig.onEncodedPacket?.(u,c),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,u,c).catch(d=>{this.error??=d,this.errorNeedsNewStack=!1})},error:l=>{l.stack=n.stack,this.error??=l}}),this.encoder.configure(s)}W(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}initPcmEncoder(){this.isPcmEncoder=!0;const e=this.encodingConfig.codec,{dataType:n,sampleSize:r,littleEndian:i}=Yc(e);switch(this.outputSampleSize=r,r){case 1:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint8(o,zr((a+1)*127.5,0,255)):n==="signed"?this.writeOutputValue=(s,o,a)=>{s.setInt8(o,zr(Math.round(a*128),-128,127))}:n==="ulaw"?this.writeOutputValue=(s,o,a)=>{const l=zr(Math.floor(a*32767),-32768,32767);s.setUint8(o,_te(l))}:n==="alaw"?this.writeOutputValue=(s,o,a)=>{const l=zr(Math.floor(a*32767),-32768,32767);s.setUint8(o,Pte(l))}:W(!1);break;case 2:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint16(o,zr((a+1)*32767.5,0,65535),i):n==="signed"?this.writeOutputValue=(s,o,a)=>s.setInt16(o,zr(Math.round(a*32767),-32768,32767),i):W(!1);break;case 3:n==="unsigned"?this.writeOutputValue=(s,o,a)=>XE(s,o,zr((a+1)*83886075e-1,0,16777215),i):n==="signed"?this.writeOutputValue=(s,o,a)=>Vee(s,o,zr(Math.round(a*8388607),-8388608,8388607),i):W(!1);break;case 4:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint32(o,zr((a+1)*21474836475e-1,0,4294967295),i):n==="signed"?this.writeOutputValue=(s,o,a)=>s.setInt32(o,zr(Math.round(a*2147483647),-2147483648,2147483647),i):n==="float"?this.writeOutputValue=(s,o,a)=>s.setFloat32(o,a,i):W(!1);break;case 8:n==="float"?this.writeOutputValue=(s,o,a)=>s.setFloat64(o,a,i):W(!1);break;default:zc(r),W(!1)}}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||await this.encoder.flush(),this.encoder.state!=="closed"&&this.encoder.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.isPcmEncoder?0:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class lI extends gT{constructor(e){wie(e),super(e.codec),this._encoder=new _ie(this,e)}add(e){if(!(e instanceof Ds))throw new TypeError("audioSample must be an AudioSample.");return this._encoder.add(e,!1)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class Aie extends pT{constructor(e){if(super(),this._connectedTrack=null,!hy.includes(e))throw new TypeError(`Invalid subtitle codec '${e}'. Must be one of: ${hy.join(", ")}.`);this._codec=e}}const Pie=["video","audio","subtitle"],C1=t=>{if(!t||typeof t!="object")throw new TypeError("metadata must be an object.");if(t.languageCode!==void 0&&!nm(t.languageCode))throw new TypeError("metadata.languageCode, when provided, must be a three-letter, ISO 639-2/T language code.");if(t.name!==void 0&&typeof t.name!="string")throw new TypeError("metadata.name, when provided, must be a string.");if(t.disposition!==void 0&&Zee(t.disposition),t.maximumPacketCount!==void 0&&(!Number.isInteger(t.maximumPacketCount)||t.maximumPacketCount<0))throw new TypeError("metadata.maximumPacketCount, when provided, must be a non-negative integer.")};class tS{constructor(e){if(this.state="pending",this._tracks=[],this._startPromise=null,this._cancelPromise=null,this._finalizePromise=null,this._mutex=new yd,this._metadataTags={},!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.format instanceof nL))throw new TypeError("options.format must be an OutputFormat.");if(!(e.target instanceof fT))throw new TypeError("options.target must be a Target.");if(e.target._output)throw new Error("Target is already used for another output.");e.target._output=this,this.format=e.format,this.target=e.target,this._writer=e.target._createWriter(),this._muxer=e.format._createMuxer(this)}addVideoTrack(e,n={}){if(!(e instanceof mT))throw new TypeError("source must be a VideoSource.");if(C1(n),n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError(`Invalid video rotation: ${n.rotation}. Has to be 0, 90, 180 or 270.`);if(!this.format.supportsVideoRotationMetadata&&n.rotation)throw new Error(`${this.format._name} does not support video rotation metadata.`);if(n.frameRate!==void 0&&(!Number.isFinite(n.frameRate)||n.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${n.frameRate}. Must be a positive number.`);this._addTrack("video",e,n)}addAudioTrack(e,n={}){if(!(e instanceof gT))throw new TypeError("source must be an AudioSource.");C1(n),this._addTrack("audio",e,n)}addSubtitleTrack(e,n={}){if(!(e instanceof Aie))throw new TypeError("source must be a SubtitleSource.");C1(n),this._addTrack("subtitle",e,n)}setMetadataTags(e){if($x(e),this.state!=="pending")throw new Error("Cannot set metadata tags after output has been started or canceled.");this._metadataTags=e}_addTrack(e,n,r){if(this.state!=="pending")throw new Error("Cannot add track after output has been started or canceled.");if(n._connectedTrack)throw new Error("Source is already used for a track.");const i=this.format.getSupportedTrackCounts(),s=this._tracks.reduce((c,u)=>c+(u.type===e?1:0),0),o=i[e].max;if(s===o)throw new Error(o===0?`${this.format._name} does not support ${e} tracks.`:`${this.format._name} does not support more than ${o} ${e} track${o===1?"":"s"}.`);const a=i.total.max;if(this._tracks.length===a)throw new Error(`${this.format._name} does not support more than ${a} tracks${a===1?"":"s"} in total.`);const l={id:this._tracks.length+1,output:this,type:e,source:n,metadata:r};if(l.type==="video"){const c=this.format.getSupportedVideoCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support video tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported video codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}else if(l.type==="audio"){const c=this.format.getSupportedAudioCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support audio tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported audio codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}else if(l.type==="subtitle"){const c=this.format.getSupportedSubtitleCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support subtitle tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported subtitle codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}this._tracks.push(l),n._connectedTrack=l}async start(){const e=this.format.getSupportedTrackCounts();for(const r of Pie){const i=this._tracks.reduce((o,a)=>o+(a.type===r?1:0),0),s=e[r].min;if(i<s)throw new Error(s===e[r].max?`${this.format._name} requires exactly ${s} ${r} track${s===1?"":"s"}.`:`${this.format._name} requires at least ${s} ${r} track${s===1?"":"s"}.`)}const n=e.total.min;if(this._tracks.length<n)throw new Error(n===e.total.max?`${this.format._name} requires exactly ${n} track${n===1?"":"s"}.`:`${this.format._name} requires at least ${n} track${n===1?"":"s"}.`);if(this.state==="canceled")throw new Error("Output has been canceled.");return this._startPromise?(console.warn("Output has already been started."),this._startPromise):this._startPromise=(async()=>{this.state="started",this._writer.start();const r=await this._mutex.acquire();await this._muxer.start();const i=this._tracks.map(s=>s.source._start());await Promise.all(i),r()})()}getMimeType(){return this._muxer.getMimeType()}async cancel(){if(this._cancelPromise)return console.warn("Output has already been canceled."),this._cancelPromise;if(this.state==="finalizing"||this.state==="finalized"){console.warn("Output has already been finalized.");return}return this._cancelPromise=(async()=>{this.state="canceled";const e=await this._mutex.acquire(),n=this._tracks.map(r=>r.source._flushOrWaitForOngoingClose(!0));await Promise.all(n),await this._writer.close(),e()})()}async finalize(){if(this.state==="pending")throw new Error("Cannot finalize before starting.");if(this.state==="canceled")throw new Error("Cannot finalize after canceling.");return this._finalizePromise?(console.warn("Output has already been finalized."),this._finalizePromise):this._finalizePromise=(async()=>{this.state="finalizing";const e=await this._mutex.acquire(),n=this._tracks.map(r=>r.source._flushOrWaitForOngoingClose(!1));await Promise.all(n),await this._muxer.finalize(),await this._writer.flush(),await this._writer.finalize(),this.state="finalized",e()})()}}const cI=t=>{if(t!==void 0&&(!t||typeof t!="object"))throw new TypeError("options.video, when provided, must be an object.");if(t?.discard!==void 0&&typeof t.discard!="boolean")throw new TypeError("options.video.discard, when provided, must be a boolean.");if(t?.forceTranscode!==void 0&&typeof t.forceTranscode!="boolean")throw new TypeError("options.video.forceTranscode, when provided, must be a boolean.");if(t?.codec!==void 0&&!ea.includes(t.codec))throw new TypeError(`options.video.codec, when provided, must be one of: ${ea.join(", ")}.`);if(t?.bitrate!==void 0&&!(t.bitrate instanceof ho)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("options.video.bitrate, when provided, must be a positive integer or a quality.");if(t?.width!==void 0&&(!Number.isInteger(t.width)||t.width<=0))throw new TypeError("options.video.width, when provided, must be a positive integer.");if(t?.height!==void 0&&(!Number.isInteger(t.height)||t.height<=0))throw new TypeError("options.video.height, when provided, must be a positive integer.");if(t?.fit!==void 0&&!["fill","contain","cover"].includes(t.fit))throw new TypeError("options.video.fit, when provided, must be one of 'fill', 'contain', or 'cover'.");if(t?.width!==void 0&&t.height!==void 0&&t.fit===void 0)throw new TypeError("When both options.video.width and options.video.height are provided, options.video.fit must also be provided.");if(t?.rotate!==void 0&&![0,90,180,270].includes(t.rotate))throw new TypeError("options.video.rotate, when provided, must be 0, 90, 180 or 270.");if(t?.allowRotationMetadata!==void 0&&typeof t.allowRotationMetadata!="boolean")throw new TypeError("options.video.allowRotationMetadata, when provided, must be a boolean.");if(t?.crop!==void 0&&sT(t.crop,"options.video."),t?.frameRate!==void 0&&(!Number.isFinite(t.frameRate)||t.frameRate<=0))throw new TypeError("options.video.frameRate, when provided, must be a finite positive number.");if(t?.alpha!==void 0&&!["discard","keep"].includes(t.alpha))throw new TypeError("options.video.alpha, when provided, must be either 'discard' or 'keep'.");if(t?.keyFrameInterval!==void 0&&(!Number.isFinite(t.keyFrameInterval)||t.keyFrameInterval<0))throw new TypeError("options.video.keyFrameInterval, when provided, must be a non-negative number.");if(t?.process!==void 0&&typeof t.process!="function")throw new TypeError("options.video.process, when provided, must be a function.");if(t?.processedWidth!==void 0&&(!Number.isInteger(t.processedWidth)||t.processedWidth<=0))throw new TypeError("options.video.processedWidth, when provided, must be a positive integer.");if(t?.processedHeight!==void 0&&(!Number.isInteger(t.processedHeight)||t.processedHeight<=0))throw new TypeError("options.video.processedHeight, when provided, must be a positive integer.");if(t?.hardwareAcceleration!==void 0&&!["no-preference","prefer-hardware","prefer-software"].includes(t.hardwareAcceleration))throw new TypeError("options.video.hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.")},uI=t=>{if(t!==void 0&&(!t||typeof t!="object"))throw new TypeError("options.audio, when provided, must be an object.");if(t?.discard!==void 0&&typeof t.discard!="boolean")throw new TypeError("options.audio.discard, when provided, must be a boolean.");if(t?.forceTranscode!==void 0&&typeof t.forceTranscode!="boolean")throw new TypeError("options.audio.forceTranscode, when provided, must be a boolean.");if(t?.codec!==void 0&&!ta.includes(t.codec))throw new TypeError(`options.audio.codec, when provided, must be one of: ${ta.join(", ")}.`);if(t?.bitrate!==void 0&&!(t.bitrate instanceof ho)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("options.audio.bitrate, when provided, must be a positive integer or a quality.");if(t?.numberOfChannels!==void 0&&(!Number.isInteger(t.numberOfChannels)||t.numberOfChannels<=0))throw new TypeError("options.audio.numberOfChannels, when provided, must be a positive integer.");if(t?.sampleRate!==void 0&&(!Number.isInteger(t.sampleRate)||t.sampleRate<=0))throw new TypeError("options.audio.sampleRate, when provided, must be a positive integer.");if(t?.process!==void 0&&typeof t.process!="function")throw new TypeError("options.audio.process, when provided, must be a function.");if(t?.processedNumberOfChannels!==void 0&&(!Number.isInteger(t.processedNumberOfChannels)||t.processedNumberOfChannels<=0))throw new TypeError("options.audio.processedNumberOfChannels, when provided, must be a positive integer.");if(t?.processedSampleRate!==void 0&&(!Number.isInteger(t.processedSampleRate)||t.processedSampleRate<=0))throw new TypeError("options.audio.processedSampleRate, when provided, must be a positive integer.")},_1=2,A1=48e3;class yT{static async init(e){const n=new yT(e);return await n._init(),n}constructor(e){if(this._addedCounts={video:0,audio:0,subtitle:0},this._totalTrackCount=0,this._trackPromises=[],this._executed=!1,this._synchronizer=new Oie,this._totalDuration=null,this._maxTimestamps=new Map,this._canceled=!1,this.onProgress=void 0,this._computeProgress=!1,this._lastProgress=0,this.isValid=!1,this.utilizedTracks=[],this.discardedTracks=[],!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.input instanceof Zx))throw new TypeError("options.input must be an Input.");if(!(e.output instanceof tS))throw new TypeError("options.output must be an Output.");if(e.output._tracks.length>0||Object.keys(e.output._metadataTags).length>0||e.output.state!=="pending")throw new TypeError("options.output must be fresh: no tracks or metadata tags added and not started.");if(typeof e.video!="function"&&cI(e.video),typeof e.audio!="function"&&uI(e.audio),e.trim!==void 0&&(!e.trim||typeof e.trim!="object"))throw new TypeError("options.trim, when provided, must be an object.");if(e.trim?.start!==void 0&&(!Number.isFinite(e.trim.start)||e.trim.start<0))throw new TypeError("options.trim.start, when provided, must be a non-negative number.");if(e.trim?.end!==void 0&&(!Number.isFinite(e.trim.end)||e.trim.end<0))throw new TypeError("options.trim.end, when provided, must be a non-negative number.");if(e.trim?.start!==void 0&&e.trim.end!==void 0&&e.trim.start>=e.trim.end)throw new TypeError("options.trim.start must be less than options.trim.end.");if(e.tags!==void 0&&(typeof e.tags!="object"||!e.tags)&&typeof e.tags!="function")throw new TypeError("options.tags, when provided, must be an object or a function.");if(typeof e.tags=="object"&&$x(e.tags),e.showWarnings!==void 0&&typeof e.showWarnings!="boolean")throw new TypeError("options.showWarnings, when provided, must be a boolean.");this._options=e,this.input=e.input,this.output=e.output;const{promise:n,resolve:r}=ci();this._started=n,this._start=r}async _init(){this._startTimestamp=this._options.trim?.start??Math.max(await this.input.getFirstTimestamp(),0),this._endTimestamp=this._options.trim?.end??1/0;const e=await this.input.getTracks(),n=this.output.format.getSupportedTrackCounts();let r=1,i=1;for(const c of e){let u;if(c.isVideoTrack()?this._options.video&&(typeof this._options.video=="function"?(u=await this._options.video(c,r),cI(u),r++):u=this._options.video):c.isAudioTrack()?this._options.audio&&(typeof this._options.audio=="function"?(u=await this._options.audio(c,i),uI(u),i++):u=this._options.audio):W(!1),u?.discard){this.discardedTracks.push({track:c,reason:"discarded_by_user"});continue}if(this._totalTrackCount===n.total.max){this.discardedTracks.push({track:c,reason:"max_track_count_reached"});continue}if(this._addedCounts[c.type]===n[c.type].max){this.discardedTracks.push({track:c,reason:"max_track_count_of_type_reached"});continue}c.isVideoTrack()?await this._processVideoTrack(c,u??{}):c.isAudioTrack()&&await this._processAudioTrack(c,u??{})}const s=await this.input.getMetadataTags();let o;if(this._options.tags){const c=typeof this._options.tags=="function"?await this._options.tags(s):this._options.tags;$x(c),o=c}else o=s;const a=(await this.input.getFormat()).mimeType===this.output.format.mimeType,l=s.raw===o.raw;if(s.raw&&l&&!a&&delete o.raw,this.output.setMetadataTags(o),this.isValid=this._totalTrackCount>=n.total.min&&this._addedCounts.video>=n.video.min&&this._addedCounts.audio>=n.audio.min&&this._addedCounts.subtitle>=n.subtitle.min,this._options.showWarnings??!0){const c=[],u=this.discardedTracks.filter(d=>d.reason!=="discarded_by_user");u.length>0&&c.push("Some tracks had to be discarded from the conversion:",u),this.isValid||c.push(`

`+this._getInvalidityExplanation().join("")),c.length>0&&console.warn(...c)}}_getInvalidityExplanation(){const e=[];if(this.discardedTracks.length===0)e.push("Due to missing tracks, this conversion cannot be executed.");else{const n=this.discardedTracks.every(r=>r.reason==="discarded_by_user"||r.reason==="no_encodable_target_codec");if(e.push("Due to discarded tracks, this conversion cannot be executed."),n){const r=this.discardedTracks.flatMap(i=>i.reason==="discarded_by_user"?[]:i.track.type==="video"?this.output.format.getSupportedVideoCodecs():i.track.type==="audio"?this.output.format.getSupportedAudioCodecs():this.output.format.getSupportedSubtitleCodecs());r.length===1?e.push(`
Tracks were discarded because your environment is not able to encode '${r[0]}'.`):e.push(`
Tracks were discarded because your environment is not able to encode any of the following codecs: ${r.map(i=>`'${i}'`).join(", ")}.`),r.includes("mp3")&&e.push(`
The @mediabunny/mp3-encoder extension package provides support for encoding MP3.`)}else e.push(`
Check the discardedTracks field for more info.`)}return e}async execute(){if(!this.isValid)throw new Error(`Cannot execute this conversion because its output configuration is invalid. Make sure to always check the isValid field before executing a conversion.
`+this._getInvalidityExplanation().join(""));if(this._executed)throw new Error("Conversion cannot be executed twice.");if(this._executed=!0,this.onProgress){this._computeProgress=!0,this._totalDuration=Math.min(await this.input.computeDuration()-this._startTimestamp,this._endTimestamp-this._startTimestamp);for(const e of this.utilizedTracks)this._maxTimestamps.set(e.id,0);this.onProgress?.(0)}await this.output.start(),this._start();try{await Promise.all(this._trackPromises)}catch(e){throw this._canceled||this.cancel(),e}if(this._canceled)throw new Iie;await this.output.finalize(),this._computeProgress&&this.onProgress?.(1)}async cancel(){if(!(this.output.state==="finalizing"||this.output.state==="finalized")){if(this._canceled){console.warn("Conversion already canceled.");return}this._canceled=!0,await this.output.cancel()}}async _processVideoTrack(e,n){const r=e.codec;if(!r){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let i;const s=KE(e.rotation+(n.rotate??0)),o=this.output.format.supportsVideoRotationMetadata&&(n.allowRotationMetadata??!0),[a,l]=s%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],c=n.crop;c&&iT(c,a,l);const[u,d]=c?[c.width,c.height]:[a,l];let f=u,h=d;const p=f/h,m=P=>Math.ceil(P/2)*2;n.width!==void 0&&n.height===void 0?(f=m(n.width),h=m(Math.round(f/p))):n.width===void 0&&n.height!==void 0?(h=m(n.height),f=m(Math.round(h*p))):n.width!==void 0&&n.height!==void 0&&(f=m(n.width),h=m(n.height));const g=await e.getFirstTimestamp(),y=!!n.forceTranscode||g<this._startTimestamp||!!n.frameRate||n.keyFrameInterval!==void 0||n.process!==void 0;let b=f!==u||h!==d||s!==0&&(!o||n.process!==void 0)||!!c;const x=n.alpha??"discard";let C=this.output.format.getSupportedVideoCodecs();if(!y&&!n.bitrate&&!b&&C.includes(r)&&(!n.codec||n.codec===r)){const P=new kie(r);i=P,this._trackPromises.push((async()=>{await this._started;const S=new sm(e),k={decoderConfig:await e.getDecoderConfig()??void 0},T=Number.isFinite(this._endTimestamp)?await S.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const O of S.packets(void 0,T,{verifyKeyPackets:!0})){if(this._canceled)return;const M=O.clone({timestamp:O.timestamp-this._startTimestamp,sideData:x==="discard"?{}:O.sideData});W(M.timestamp>=0),this._reportProgress(e.id,M.timestamp),await P.add(M,k),this._synchronizer.shouldWait(e.id,M.timestamp)&&await this._synchronizer.wait(M.timestamp)}P.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}n.codec&&(C=C.filter(O=>O===n.codec));const S=n.bitrate??vy,_=await Sie(C,{width:n.process&&n.processedWidth?n.processedWidth:f,height:n.process&&n.processedHeight?n.processedHeight:h,bitrate:S});if(!_){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}const k={codec:_,bitrate:S,keyFrameInterval:n.keyFrameInterval,sizeChangeBehavior:n.fit??"passThrough",alpha:x,hardwareAcceleration:n.hardwareAcceleration},T=new aI(k);if(i=T,!b){const O=new tS({format:new hT,target:new pie}),M=new aI(k);O.addVideoTrack(M),await O.start();const F=await new Vx(e).getSample(g);if(F)try{await M.add(F),F.close(),await O.finalize()}catch(B){console.info("Error when probing encoder support. Falling back to rerender path.",B),b=!0,O.cancel()}else await O.cancel()}b?this._trackPromises.push((async()=>{await this._started;const M=new Bte(e,{width:f,height:h,fit:n.fit??"fill",rotation:s,crop:n.crop,poolSize:1,alpha:x==="keep"}).canvases(this._startTimestamp,this._endTimestamp),L=n.frameRate;let F=null,B=null,R=null;const A=async N=>{W(F),W(L!==void 0);const z=Math.round((N-B)*L);for(let U=1;U<z;U++){const V=new _i(F,{timestamp:B+U/L,duration:1/L});await this._registerVideoSample(e,n,T,V),V.close()}};for await(const{canvas:N,timestamp:z,duration:U}of M){if(this._canceled)return;let V=Math.max(z-this._startTimestamp,0);if(R=V+U,L!==void 0){const G=Math.floor(V*L)/L;if(F!==null)if(G<=B){F=N,B=G;continue}else await A(G);V=G}const q=new _i(N,{timestamp:V,duration:L!==void 0?1/L:U});await this._registerVideoSample(e,n,T,q),q.close(),L!==void 0&&(F=N,B=V)}F&&(W(R!==null),W(L!==void 0),await A(Math.floor(R*L)/L)),T.close(),this._synchronizer.closeTrack(e.id)})()):this._trackPromises.push((async()=>{await this._started;const O=new Vx(e),M=n.frameRate;let L=null,F=null,B=null;const R=async A=>{W(L),W(M!==void 0);const N=Math.round((A-F)*M);for(let z=1;z<N;z++)L.setTimestamp(F+z/M),L.setDuration(1/M),await this._registerVideoSample(e,n,T,L);L.close()};for await(const A of O.samples(this._startTimestamp,this._endTimestamp)){if(this._canceled){A.close(),L?.close();return}let N=Math.max(A.timestamp-this._startTimestamp,0);if(B=N+A.duration,M!==void 0){const z=Math.floor(N*M)/M;if(L!==null)if(z<=F){L.close(),L=A,F=z;continue}else await R(z);N=z,A.setDuration(1/M)}A.setTimestamp(N),await this._registerVideoSample(e,n,T,A),M!==void 0?(L=A,F=N):A.close()}L&&(W(B!==null),W(M!==void 0),await R(Math.floor(B*M)/M)),T.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addVideoTrack(i,{frameRate:n.frameRate,languageCode:nm(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,disposition:e.disposition,rotation:b?0:s}),this._addedCounts.video++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerVideoSample(e,n,r,i){if(this._canceled)return;this._reportProgress(e.id,i.timestamp);let s;if(!n.process)s=[i];else{let o=n.process(i);o instanceof Promise&&(o=await o),Array.isArray(o)||(o=o===null?[]:[o]),s=o.map(a=>a instanceof _i?a:typeof VideoFrame<"u"&&a instanceof VideoFrame?new _i(a):new _i(a,{timestamp:i.timestamp,duration:i.duration}))}for(const o of s){if(this._canceled)break;await r.add(o),this._synchronizer.shouldWait(e.id,o.timestamp)&&await this._synchronizer.wait(o.timestamp)}for(const o of s)o!==i&&o.close()}async _processAudioTrack(e,n){const r=e.codec;if(!r){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let i;const s=e.numberOfChannels,o=e.sampleRate,a=await e.getFirstTimestamp();let l=n.numberOfChannels??s,c=n.sampleRate??o,u=l!==s||c!==o||a<this._startTimestamp,d=this.output.format.getSupportedAudioCodecs();if(!n.forceTranscode&&!n.bitrate&&!u&&d.includes(r)&&(!n.codec||n.codec===r)&&!n.process){const f=new Cie(r);i=f,this._trackPromises.push((async()=>{await this._started;const h=new sm(e),m={decoderConfig:await e.getDecoderConfig()??void 0},g=Number.isFinite(this._endTimestamp)?await h.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const y of h.packets(void 0,g)){if(this._canceled)return;const b=y.clone({timestamp:y.timestamp-this._startTimestamp});W(b.timestamp>=0),this._reportProgress(e.id,b.timestamp),await f.add(b,m),this._synchronizer.shouldWait(e.id,b.timestamp)&&await this._synchronizer.wait(b.timestamp)}f.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}let h=null;n.codec&&(d=d.filter(g=>g===n.codec));const p=n.bitrate??vy,m=await eS(d,{numberOfChannels:n.process&&n.processedNumberOfChannels?n.processedNumberOfChannels:l,sampleRate:n.process&&n.processedSampleRate?n.processedSampleRate:c,bitrate:p});if(!m.some(g=>Sp.includes(g))&&d.some(g=>Sp.includes(g))&&(l!==_1||c!==A1)){const y=(await eS(d,{numberOfChannels:_1,sampleRate:A1,bitrate:p})).find(b=>Sp.includes(b));y&&(u=!0,h=y,l=_1,c=A1)}else h=m[0]??null;if(h===null){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}if(u)i=this._resampleAudio(e,n,h,l,c,p);else{const g=new lI({codec:h,bitrate:p});i=g,this._trackPromises.push((async()=>{await this._started;const y=new KP(e);for await(const b of y.samples(void 0,this._endTimestamp)){if(this._canceled){b.close();return}b.setTimestamp(b.timestamp-this._startTimestamp),await this._registerAudioSample(e,n,g,b),b.close()}g.close(),this._synchronizer.closeTrack(e.id)})())}}this.output.addAudioTrack(i,{languageCode:nm(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,disposition:e.disposition}),this._addedCounts.audio++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerAudioSample(e,n,r,i){if(this._canceled)return;this._reportProgress(e.id,i.timestamp);let s;if(!n.process)s=[i];else{let o=n.process(i);if(o instanceof Promise&&(o=await o),Array.isArray(o)||(o=o===null?[]:[o]),!o.every(a=>a instanceof Ds))throw new TypeError("The audio process function must return an AudioSample, null, or an array of AudioSamples.");s=o}for(const o of s){if(this._canceled)break;await r.add(o),this._synchronizer.shouldWait(e.id,o.timestamp)&&await this._synchronizer.wait(o.timestamp)}for(const o of s)o!==i&&o.close()}_resampleAudio(e,n,r,i,s,o){const a=new lI({codec:r,bitrate:o});return this._trackPromises.push((async()=>{await this._started;const l=new Mie({targetNumberOfChannels:i,targetSampleRate:s,startTime:this._startTimestamp,endTime:this._endTimestamp,onSample:async d=>{await this._registerAudioSample(e,n,a,d),d.close()}}),u=new KP(e).samples(this._startTimestamp,this._endTimestamp);for await(const d of u){if(this._canceled){d.close();return}await l.add(d),d.close()}await l.finalize(),a.close(),this._synchronizer.closeTrack(e.id)})()),a}_reportProgress(e,n){if(!this._computeProgress)return;W(this._totalDuration!==null),this._maxTimestamps.set(e,Math.max(n,this._maxTimestamps.get(e)));const r=Math.min(...this._maxTimestamps.values()),i=zr(r/this._totalDuration,0,1);i!==this._lastProgress&&(this._lastProgress=i,this.onProgress?.(i))}}class Iie extends Error{constructor(e="Conversion has been canceled."){super(e),this.name="ConversionCanceledError"}}const dI=5;class Oie{constructor(){this.maxTimestamps=new Map,this.resolvers=[]}computeMinAndMaybeResolve(){let e=1/0;for(const[,n]of this.maxTimestamps)e=Math.min(e,n);for(let n=0;n<this.resolvers.length;n++){const r=this.resolvers[n];r.timestamp-e<dI&&(r.resolve(),this.resolvers.splice(n,1),n--)}return e}shouldWait(e,n){this.maxTimestamps.set(e,Math.max(n,this.maxTimestamps.get(e)??-1/0));const r=this.computeMinAndMaybeResolve();return n-r>=dI}wait(e){const{promise:n,resolve:r}=ci();return this.resolvers.push({timestamp:e,resolve:r}),n}closeTrack(e){this.maxTimestamps.delete(e),this.computeMinAndMaybeResolve()}}class Mie{constructor(e){this.sourceSampleRate=null,this.sourceNumberOfChannels=null,this.targetSampleRate=e.targetSampleRate,this.targetNumberOfChannels=e.targetNumberOfChannels,this.startTime=e.startTime,this.endTime=e.endTime,this.onSample=e.onSample,this.bufferSizeInFrames=Math.floor(this.targetSampleRate*5),this.bufferSizeInSamples=this.bufferSizeInFrames*this.targetNumberOfChannels,this.outputBuffer=new Float32Array(this.bufferSizeInSamples),this.bufferStartFrame=0,this.maxWrittenFrame=-1}doChannelMixerSetup(){W(this.sourceNumberOfChannels!==null);const e=this.sourceNumberOfChannels,n=this.targetNumberOfChannels;e===1&&n===2?this.channelMixer=(r,i)=>r[i*e]:e===1&&n===4?this.channelMixer=(r,i,s)=>r[i*e]*+(s<2):e===1&&n===6?this.channelMixer=(r,i,s)=>r[i*e]*+(s===2):e===2&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return .5*(r[s]+r[s+1])}:e===2&&n===4?this.channelMixer=(r,i,s)=>r[i*e+s]*+(s<2):e===2&&n===6?this.channelMixer=(r,i,s)=>r[i*e+s]*+(s<2):e===4&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return .25*(r[s]+r[s+1]+r[s+2]+r[s+3])}:e===4&&n===2?this.channelMixer=(r,i,s)=>{const o=i*e;return .5*(r[o+s]+r[o+s+2])}:e===4&&n===6?this.channelMixer=(r,i,s)=>{const o=i*e;return s<2?r[o+s]:s===2||s===3?0:r[o+s-2]}:e===6&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return Math.SQRT1_2*(r[s]+r[s+1])+r[s+2]+.5*(r[s+4]+r[s+5])}:e===6&&n===2?this.channelMixer=(r,i,s)=>{const o=i*e;return r[o+s]+Math.SQRT1_2*(r[o+2]+r[o+s+4])}:e===6&&n===4?this.channelMixer=(r,i,s)=>{const o=i*e;return s<2?r[o+s]+Math.SQRT1_2*r[o+2]:r[o+s+2]}:this.channelMixer=(r,i,s)=>s<e?r[i*e+s]:0}ensureTempBufferSize(e){let n=this.tempSourceBuffer.length;for(;n<e;)n*=2;if(n!==this.tempSourceBuffer.length){const r=new Float32Array(n);r.set(this.tempSourceBuffer),this.tempSourceBuffer=r}}async add(e){this.sourceSampleRate===null&&(this.sourceSampleRate=e.sampleRate,this.sourceNumberOfChannels=e.numberOfChannels,this.tempSourceBuffer=new Float32Array(this.sourceSampleRate*this.sourceNumberOfChannels),this.doChannelMixerSetup());const n=e.numberOfFrames*e.numberOfChannels;this.ensureTempBufferSize(n);const r=e.allocationSize({planeIndex:0,format:"f32"}),i=new Float32Array(this.tempSourceBuffer.buffer,0,r/4);e.copyTo(i,{planeIndex:0,format:"f32"});const s=e.timestamp-this.startTime,o=e.numberOfFrames/this.sourceSampleRate,a=Math.min(s+o,this.endTime-this.startTime),l=Math.floor(s*this.targetSampleRate),c=Math.ceil(a*this.targetSampleRate);for(let u=l;u<c;u++){if(u<this.bufferStartFrame)continue;for(;u>=this.bufferStartFrame+this.bufferSizeInFrames;)await this.finalizeCurrentBuffer(),this.bufferStartFrame+=this.bufferSizeInFrames;const d=u-this.bufferStartFrame;W(d<this.bufferSizeInFrames);const p=(u/this.targetSampleRate-s)*this.sourceSampleRate,m=Math.floor(p),g=Math.ceil(p),y=p-m;for(let b=0;b<this.targetNumberOfChannels;b++){let x=0,C=0;m>=0&&m<e.numberOfFrames&&(x=this.channelMixer(i,m,b)),g>=0&&g<e.numberOfFrames&&(C=this.channelMixer(i,g,b));const P=x+y*(C-x),S=d*this.targetNumberOfChannels+b;this.outputBuffer[S]+=P}this.maxWrittenFrame=Math.max(this.maxWrittenFrame,d)}}async finalizeCurrentBuffer(){if(this.maxWrittenFrame<0)return;const e=(this.maxWrittenFrame+1)*this.targetNumberOfChannels,n=new Float32Array(e);n.set(this.outputBuffer.subarray(0,e));const r=this.bufferStartFrame/this.targetSampleRate,i=new Ds({format:"f32",sampleRate:this.targetSampleRate,numberOfChannels:this.targetNumberOfChannels,timestamp:r,data:n});await this.onSample(i),this.outputBuffer.fill(0),this.maxWrittenFrame=-1}finalize(){return this.finalizeCurrentBuffer()}}const Rg=["wss://purplepag.es/","wss://directory.yabu.me/","wss://indexer.coracle.social/","wss://user.kindpag.es/"],Dg=["wss://relay.nostr.band/","wss://nos.lol/","wss://relay.damus.io/","wss://relay-jp.nostr.wirednet.jp/","wss://yabu.me/","wss://r.kojira.io/","wss://nrelay-jp.c-stellar.net/"],zh="https://nostr.build/api/v2/upload/files",fI=1024*1024*1024,mu={none:{skip:!0},low:{maxWidthOrHeight:2048,fileType:"image/webp",initialQuality:.95,useWebWorker:!0},medium:{maxWidthOrHeight:1024,fileType:"image/webp",initialQuality:.8,useWebWorker:!0},high:{maxWidthOrHeight:800,fileType:"image/webp",initialQuality:.5,useWebWorker:!0}},f0={none:{skip:!0},low:{crf:20,preset:"superfast",maxSize:1280,audioBitrate:"128k",mediabunnyVideoQuality:vy,mediabunnyAudioQuality:vy},medium:{crf:26,preset:"superfast",maxSize:640,audioBitrate:"64k",audioSampleRate:44100,mediabunnyVideoQuality:oI,mediabunnyAudioQuality:oI},high:{crf:28,preset:"medium",maxSize:320,audioBitrate:"32k",audioSampleRate:16e3,audioChannels:1,mediabunnyVideoQuality:sI,mediabunnyAudioQuality:sI}},nS=/(?:^|[\s\n\u3000])#([^\s\n\u3000#]+)/g,Nie=["http:","https:"],aL=[".png",".jpg",".jpeg",".gif",".webp",".svg"],lL=[".mp4",".webm",".mov",".avi",".mkv"],Rie=400,Die=10,hI=100,pI=1,Lie=10,Hr={LOCALE:"locale",UPLOAD_ENDPOINT:"uploadEndpoint",CLIENT_TAG_ENABLED:"clientTagEnabled",IMAGE_COMPRESSION_LEVEL:"imageCompressionLevel",VIDEO_COMPRESSION_LEVEL:"videoCompressionLevel",NOSTR_RELAYS:"nostr-relays-",DRAFTS:"nostr-drafts",HASHTAG_HISTORY:"hashtagHistory"},cL=20,Lg=50,Bie=1e3,uL=[{label:"share.yabu.me",url:"https://share.yabu.me/api/v2/media"},{label:"nostpic.com",url:"https://nostpic.com/api/v2/media"},{label:"nostrcheck.me",url:"https://nostrcheck.me/api/v2/media"},{label:"files.sovbit.host",url:"https://files.sovbit.host/api/v2/media"},{label:"nostr.build",url:"https://nostr.build/api/v2/nip96/upload"}];function bT(t){return t==="ja"?"https://share.yabu.me/api/v2/media":"https://nostrcheck.me/api/v2/media"}function Fie(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}function $ie(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}const cr={MIN_SCALE:1,MAX_SCALE:100,DEFAULT_SCALE:1,DOUBLE_CLICK_SCALE:2.5,RESET_THRESHOLD:1.3,ZOOM_DELTA:{IN:1.1,OUT:.9},THRESHOLD:.1,PINCH_MIN_DISTANCE:10},mI={FRICTION:.92,MIN_VELOCITY:.1},dL={EDITOR_FOCUS_DELAY:100,TRANSITION_DURATION:"0.3s"},zie={EDITOR:".tiptap-editor"},_o={URL_REGEX:/https?:\/\/[^\s\u3000]+/gi,DEBOUNCE_DELAY:300,ENABLE_HASHTAGS:!0,ENABLE_AUTO_LINK:!0,ENABLE_IMAGE_CONVERSION:!0,HASHTAG_CLASS:"hashtag",PLUGIN_KEYS:{HASHTAG_DECORATION:"hashtag-decoration",LINK_AND_IMAGE_CONVERSION:"link-and-image-conversion",CONTENT_UPDATE_TRACKER:"content-update-tracker"}},Uie=["balloonMessage.info.hello","balloonMessage.info.hello2","balloonMessage.info.welcome","balloonMessage.info.waited","balloonMessage.info.relax","balloonMessage.info.good_weather","balloonMessage.info.thwomp","balloonMessage.info.sleep_on_floor","balloonMessage.info.home_here","balloonMessage.info.donai","balloonMessage.info.kita_na","balloonMessage.info.no_licking","balloonMessage.info.not_thwomp","balloonMessage.info.kitte_origin","balloonMessage.info.normal_stamp","balloonMessage.info.backside_curious","balloonMessage.info.corner_weapon","balloonMessage.info.square_peace","balloonMessage.info.how_much_stamp","balloonMessage.info.cancellation_done","balloonMessage.info.want_to_roll","balloonMessage.info.want_candy","balloonMessage.info.tetris_gone","balloonMessage.info.comfy_here","balloonMessage.info.what_did_you_eat","balloonMessage.info.go_to_bed_early","balloonMessage.info.did_you_brush_teeth","balloonMessage.info.kit-ten_ketten","balloonMessage.info.such_is_life"],Hie=["balloonMessage.success.post_success","balloonMessage.success.sent","balloonMessage.success.to_everyone"],Vie="balloonMessage.error.post_error",P1={MAX_WAIT_TIME:15e3,RETRY_INTERVAL:1e3,TIMEOUT_MESSAGE:"Upload processing timeout"},Wie=/nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{10,}/,jie=/^nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58}$/,La={INDEXEDDB_NAME:"share-handler-db",INDEXEDDB_VERSION:1,STORE_NAME:"flags",REQUEST_TIMEOUT:3e3,SW_CONTROLLER_WAIT_TIMEOUT:100};class xy{static parseKind10002Tags(e){const n={};return e.filter(r=>Array.isArray(r)&&r.length>=2&&r[0]==="r").forEach(r=>{const i=r[1];if(!i||typeof i!="string")return;let s=!0,o=!0;r.length>2&&(r.length===3?r[2]==="read"?o=!1:r[2]==="write"&&(s=!1):(s=r.includes("read"),o=r.includes("write"))),n[i]={read:s,write:o}}),n}static parseKind3Content(e){try{const n=JSON.parse(e);return n&&typeof n=="object"&&!Array.isArray(n)?n:null}catch{return null}}static isValidRelayConfig(e){return e?Array.isArray(e)?e.every(n=>typeof n=="string"):typeof e=="object"?Object.entries(e).every(([n,r])=>typeof n=="string"&&r&&typeof r=="object"&&"read"in r&&"write"in r&&typeof r.read=="boolean"&&typeof r.write=="boolean"):!1:!1}}class ip{static normalizeRelayUrl(e){return e.endsWith("/")?e:e+"/"}static mergeRelayConfigs(...e){const n=new Set;return e.forEach(r=>{Array.isArray(r)?r.forEach(i=>n.add(this.normalizeRelayUrl(i))):typeof r=="object"&&Object.keys(r).forEach(i=>{n.add(this.normalizeRelayUrl(i))})}),Array.from(n)}static extractWriteRelays(e){return Array.isArray(e)?e.map(n=>this.normalizeRelayUrl(n)):typeof e=="object"?Object.keys(e).filter(n=>e[n]?.write!==!1).map(n=>this.normalizeRelayUrl(n)):[]}static extractAllRelays(e){return Array.isArray(e)?e.map(n=>this.normalizeRelayUrl(n)):typeof e=="object"?Object.keys(e).map(n=>this.normalizeRelayUrl(n)):[]}}class qie{constructor(e,n,r,i){this.localStorage=e,this.console=n,this.relayListUpdatedStore=r,this.pubkeyHex=i}setPubkey(e){this.pubkeyHex=e}save(e,n){try{const r=`nostr-relays-${e}`;if(n===null){if(this.localStorage.removeItem(r),this.console.log(`ãªã¬ã¼ãªã¹ããåé¤: ${e}`),typeof window<"u")try{OI(e,{})}catch{}return}if(!xy.isValidRelayConfig(n)){this.console.warn("ç¡å¹ãªãªã¬ã¼è¨­å®ã®ããä¿å­ãã¹ã­ãã:",n);return}if(this.localStorage.setItem(r,JSON.stringify(n)),typeof window<"u")try{OI(e,n)}catch(i){this.console.warn("ã¹ãã¢ã®æ´æ°ã«å¤±æ:",i)}this.relayListUpdatedStore&&this.relayListUpdatedStore.set(this.relayListUpdatedStore.value+1),this.console.log("ãªã¬ã¼ãªã¹ããã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){this.console.error("ãªã¬ã¼ãªã¹ãã®ä¿å­ã«å¤±æ:",r)}}get(e){try{const n=`nostr-relays-${e}`,r=this.localStorage.getItem(n);if(!r)return null;const i=JSON.parse(r);return xy.isValidRelayConfig(i)?i:null}catch(n){return this.console.error("ãªã¬ã¼ãªã¹ãã®åå¾ã«å¤±æ:",n),null}}clear(e){this.save(e,null)}}class Kie{constructor(e,n,r,i){this.rxNostr=e,this.console=n,this.setTimeoutFn=r,this.clearTimeoutFn=i}async fetchKind10002(e,n,r=3e3){return this.console.log(`Kind 10002åå¾è©¦è¡: ${e}`),new Promise(i=>{const s=M0();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=d=>{a||(a=!0,c(),i(d))};try{l=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:d=>{if(!a&&d.event?.kind===10002&&d.event.pubkey===e)try{const f=xy.parseKind10002Tags(d.event.tags);Object.keys(f).length>0&&(o=!0,this.console.log("Kind 10002ãããªã¬ã¼ãåå¾:",f),u({success:!0,relayConfig:f,source:"kind10002"}))}catch(f){this.console.error("Kind 10002ã®ãã¼ã¹ã¨ã©ã¼:",f)}},complete:()=>{a||(o||this.console.log("Kind 10002: EOSEåä¿¡ãã¤ãã³ããªã"),u({success:o,error:o?void 0:"not_found"}))},error:d=>{a||(this.console.error("Kind 10002åå¾ã¨ã©ã¼:",d),u({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[10002],until:Math.floor(Date.now()/1e3)}),s.over()}catch(d){this.console.error("Kind 10002ãªã¯ã¨ã¹ãä½æã¨ã©ã¼:",d),u({success:!1,error:"request_error"})}})}async fetchKind3(e,n,r=3e3){return this.console.log(`Kind 3åå¾è©¦è¡: ${e}`),new Promise(i=>{const s=M0();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=d=>{a||(a=!0,c(),i(d))};try{l=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:d=>{if(!a&&d.event?.kind===3&&d.event.pubkey===e){const f=xy.parseKind3Content(d.event.content);f&&(o=!0,this.console.log("Kind 3ãããªã¬ã¼ãåå¾:",f),u({success:!0,relayConfig:f,source:"kind3"}))}},complete:()=>{a||(o||this.console.log("Kind 3: EOSEåä¿¡ãã¤ãã³ããªã"),u({success:o,error:o?void 0:"not_found"}))},error:d=>{a||(this.console.error("Kind 3åå¾ã¨ã©ã¼:",d),u({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[3],until:Math.floor(Date.now()/1e3)}),s.over()}catch(d){this.console.error("Kind 3ãªã¯ã¨ã¹ãä½æã¨ã©ã¼:",d),u({success:!1,error:"request_error"})}})}}class Gie{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.console||(typeof window<"u"?window.console:{}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.relayListUpdatedStore||(typeof window<"u"?{value:0,set:l=>{}}:void 0);this.storage=new qie(r,i,a),this.networkFetcher=new Kie(e,i,s,o)}storage;networkFetcher;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}setBootstrapRelays(){try{this.rxNostr.use(M0(),{on:{relays:Rg}}).subscribe()}catch(e){console.error("Bootstrap relaysè¨­å®ã¨ã©ã¼:",e)}}useRelaysFromLocalStorageIfExists(e){const n=this.storage.get(e);if(n)try{return this.rxNostr.setDefaultRelays(n),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼ãªã¹ããä½¿ç¨:",n),!0}catch(r){return console.error("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼è¨­å®ã¨ã©ã¼:",r),this.storage.clear(e),!1}return!1}async fetchUserRelays(e,n={}){const r=n.timeoutMs||3e3;if(console.log(`ãªã¬ã¼åå¾éå§: ${e}`),!n.forceRemote){const o=this.storage.get(e);if(o)return this.rxNostr.setDefaultRelays(o),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ãããªã¬ã¼ãå¾©åãã¾ãã"),{success:!0,relayConfig:o,source:"localStorage"}}console.log("ãªã¢ã¼ããããªã¬ã¼æå ±ãåå¾ä¸­...");const i=await this.networkFetcher.fetchKind10002(e,Rg,r);if(i.success&&i.relayConfig)return this.rxNostr.setDefaultRelays(i.relayConfig),this.storage.save(e,i.relayConfig),console.log("Kind 10002ãããªã¬ã¼åå¾æå"),{success:!0,relayConfig:i.relayConfig,source:"kind10002"};const s=await this.networkFetcher.fetchKind3(e,Rg,r);return s.success&&s.relayConfig?(this.rxNostr.setDefaultRelays(s.relayConfig),this.storage.save(e,s.relayConfig),console.log("Kind 3ãããªã¬ã¼åå¾æå"),{success:!0,relayConfig:s.relayConfig,source:"kind3"}):(console.log("ãªã¢ã¼ãåå¾å¤±æããã©ã¼ã«ããã¯ãªã¬ã¼ãä½¿ç¨"),this.rxNostr.setDefaultRelays(Dg),console.log("ãã©ã¼ã«ããã¯ãªã¬ã¼ãè¨­å®:",Dg),this.storage.save(e,Dg),{success:!1,relayConfig:Dg,source:"fallback"})}getRelayListsForProfile(e,n=Rg){const r=this.storage.get(e);let i=[],s=[];return r?(i=ip.extractWriteRelays(r),s=ip.mergeRelayConfigs(r,n)):s=n.map(o=>ip.normalizeRelayUrl(o)),{writeRelays:i,additionalRelays:s}}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}loadRelayConfigForUI(e){const n=this.storage.get(e);if(!n)return null;const r=ip.extractWriteRelays(n);return{relayConfig:n,writeRelays:r}}}let gI=ye(Zt({info:null,visible:!1}));const sf={get value(){return E(gI)},set:t=>{Q(gI,t,!0)}};let I1=ye(!1);const on={get value(){return E(I1)},set:t=>{Q(I1,t,!0)},reset:()=>{Q(I1,!1)}};let Sy=null;function Zie(t){Sy=t}function Xie(){return Sy}let ky=null;function Qie(t){ky=t}function Yie(){return ky}function Jie(){on.set(!0),Sy&&Sy.abort(),ky&&ky.abort(),_p.set(0),Ap.set(0)}const Ey={type:"none",isAuthenticated:!1,pubkey:"",npub:"",nprofile:"",isValid:!1,isInitialized:!1,isExtensionLogin:!1};let Hf=ye(Zt({...Ey}));const jr={get value(){return E(Hf)||Ey},subscribe:t=>{nt(()=>{t(E(Hf)||Ey)})}};function wT(t){const n={...E(Hf),...t};n.isAuthenticated=n.type!=="none"&&n.isValid,n.isExtensionLogin=n.isAuthenticated&&n.type==="nostr-login"&&typeof window<"u"&&typeof window.nostr=="object"&&typeof window.nostr.signEvent=="function",Q(Hf,n,!0),console.log("[updateAuthState] èªè¨¼ç¶æãæ´æ°:",{type:n.type,isAuthenticated:n.isAuthenticated,isValid:n.isValid,pubkey:n.pubkey?n.pubkey.substring(0,8)+"...":"empty"})}function yI(t=!0){Q(Hf,{...Ey,isInitialized:t?E(Hf).isInitialized:!1},!0)}function ese(t,e,n){if(!t||!e||!n){console.warn("setNsecAuth: All parameters are required");return}wT({type:"nsec",pubkey:t,npub:e,nprofile:n,isValid:!0})}function bI(t,e,n,r){if(!t||!e||!n){console.warn("setNostrLoginAuth: All parameters are required");return}console.log("[setNostrLoginAuth] NostrLoginèªè¨¼ç¶æãæ´æ°:",{pubkey:t.substring(0,8)+"...",npub:e.substring(0,12)+"...",type:"nostr-login",nostrLoginAuthMethod:r}),wT({type:"nostr-login",pubkey:t,npub:e,nprofile:n,isValid:!0,nostrLoginAuthMethod:r})}function tse(){wT({isInitialized:!0})}const Ur=Zt({file:null,metadata:void 0,received:!1});function wI(t,e){Ur.file=t,Ur.metadata=e,Ur.received=!!t}function nse(){Ur.file=null,Ur.metadata=void 0,Ur.received=!1}const Uu=Zt({content:null,received:!1});function rse(t){Uu.content=t,Uu.received=!!t}function ise(){Uu.content=null,Uu.received=!1}function sse(){return Ur.file}function ose(){return Ur.metadata}let vI=ye(!1),xI=ye(!1),SI=ye(!1),kI=ye(!1);const Cp={get value(){return E(vI)},set:t=>{Q(vI,t,!0)}},Ty={get value(){return E(xI)},set:t=>{Q(xI,t,!0)}},vT={get value(){return E(SI)},set:t=>{Q(SI,t,!0)}},Uh={get value(){return E(kI)},set:t=>{Q(kI,t,!0)}};let EI=ye(!1),TI=ye(!1),CI=ye(null);const Bg={get value(){return E(EI)},set:t=>{Q(EI,t,!0)}},Dd={get value(){return E(TI)},set:t=>{Q(TI,t,!0)}},Fg={get value(){return E(CI)},set:t=>{Q(CI,t,!0)}},fL=(()=>{try{if(typeof OP=="function")return OP({onRegistered:t=>{console.log("SW registered successfully",t)},onRegisterError(t){console.warn("SW registration error",t)},onNeedRefresh(){console.log("SW needs refresh - showing prompt")},immediate:!0,onOfflineReady(){console.log("App ready to work offline")}})}catch(t){console.warn("Failed to initialize Service Worker:",t)}return{needRefresh:{subscribe:()=>{}},updateServiceWorker:()=>{}}})(),xT=fL.needRefresh,ase=fL.updateServiceWorker;let O1=ye(null);const hL={get value(){return E(O1)},set:t=>{Q(O1,t,!0)},subscribe:t=>{nt(()=>{t(E(O1))})}};let M1=ye(Zt({name:"",picture:"",npub:"",nprofile:""})),N1=ye(!1),R1=ye(!1);const ic={get value(){return E(M1)},set:t=>{Q(M1,t,!0)},subscribe:t=>{nt(()=>{t(E(M1))})}},jd={get value(){return E(N1)},set:t=>{Q(N1,t,!0)},subscribe:t=>{nt(()=>{t(E(N1))})}},Xs={get value(){return E(R1)},set:t=>{Q(R1,t,!0)},subscribe:t=>{nt(()=>{t(E(R1))})}};let D1=ye(!1);const lse={get value(){return E(D1)},set:t=>{Q(D1,t,!0)},subscribe:t=>{nt(()=>{t(E(D1))})}};let L1=ye(0);const _p={get value(){return E(L1)},set:t=>{Q(L1,t,!0)},subscribe:t=>{nt(()=>{t(E(L1))})}};let B1=ye(0);const Ap={get value(){return E(B1)},set:t=>{Q(B1,t,!0)},subscribe:t=>{nt(()=>{t(E(B1))})}};Zt({content:"",hashtags:[],tags:[]});let F1=ye(null);const cse={get value(){return E(F1)},set:t=>{Q(F1,t,!0)},subscribe:t=>{nt(()=>{t(E(F1))})}};let rS=null,$1=ye(Zt([])),z1=ye(null),_I=ye(!1),AI=ye(!1);const Pp={get value(){return E($1)},set:t=>{Q($1,t,!0)},subscribe:t=>{nt(()=>{t(E($1))})}},h0={get value(){return E(z1)},set:t=>{Q(z1,t,!0)},subscribe:t=>{nt(()=>{t(E(z1))})}},U1={get value(){return E(_I)},set:t=>{Q(_I,t,!0)}},PI={get value(){return E(AI)},set:t=>{Q(AI,t,!0)}};let p0=ye(0);const iS={get value(){return E(p0)},set:t=>{Q(p0,t,!0)},subscribe:t=>{nt(()=>{t(E(p0))})}};function use(t){rS=t}function II(t){if(!rS||!t){h0.set(null),Pp.set([]);return}const e=rS.loadRelayConfigForUI(t);if(!e){h0.set(null),Pp.set([]);return}h0.set(e.relayConfig),Pp.set(e.writeRelays)}function OI(t,e){if(!t)return;const n=`nostr-relays-${t}`;try{localStorage.setItem(n,JSON.stringify(e)),h0.set(e);const r=ip.extractWriteRelays(e);Pp.set(r),iS.set(E(p0)+1)}catch(r){console.error("ãªã¬ã¼è¨­å®ã®ä¿å­ã¨ã©ã¼:",r)}}let hr=Zt({showSecretKeyDialog:!1,pendingPost:"",showImageFullscreen:!1,fullscreenImageSrc:"",fullscreenImageAlt:"",showPopupModal:!1,popupX:0,popupY:0,popupMessage:""});const Ys={get value(){return hr},subscribe:t=>{nt(()=>{t(hr)})},showSecretKeyDialog:t=>{hr.pendingPost=t,hr.showSecretKeyDialog=!0},hideSecretKeyDialog:()=>{hr.showSecretKeyDialog=!1,hr.pendingPost=""},getPendingPost:()=>hr.pendingPost,showImageFullscreen:(t,e="")=>{hr.fullscreenImageSrc=t,hr.fullscreenImageAlt=e,hr.showImageFullscreen=!0},hideImageFullscreen:()=>{hr.showImageFullscreen=!1,hr.fullscreenImageSrc="",hr.fullscreenImageAlt=""},showPopupMessage:(t,e,n,r=1800)=>{hr.popupX=t,hr.popupY=e,hr.popupMessage=n,hr.showPopupModal=!0,setTimeout(()=>{hr.showPopupModal=!1},r)},hidePopupMessage:()=>{hr.showPopupModal=!1}};function MI(t,e=3e3){if(t===null){pL();return}sf.set({info:t,visible:!0})}function pL(){sf.set({info:null,visible:!1})}function dse(){Cp.set(!0)}function H1(){Cp.set(!1)}function fse(){Ty.set(!0)}function hse(){Ty.set(!1)}function pse(){vT.set(!0)}function mse(){vT.set(!1)}function gse(){ase(!0)}function yse(){return navigator.serviceWorker?.controller?new Promise(t=>{const e=new MessageChannel;if(e.port1.onmessage=n=>{n.data?.version?(hL.set(n.data.version),t(n.data.version)):t(null)},navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({type:"GET_VERSION"},[e.port2]);else{t(null);return}setTimeout(()=>t(null),2e3)}):Promise.resolve(null)}const Uc={setBodyStyle(t,e){document.body.style.setProperty(t,e)},querySelector(t){return document.querySelector(t)},querySelectorAll(t){return document.querySelectorAll(t)},focusElement(t){t.focus()}};function Hu(t,e){Uc.setBodyStyle(t,e)}function bse(){Hu("overflow",""),Hu("user-select",""),Hu("-webkit-user-select","")}function wse(){return document.activeElement}function vse(t){return t.classList?.contains?.("tiptap-editor")||!!t.closest?.(".tiptap-editor")}function xse(t){return["INPUT","TEXTAREA"].includes(t.tagName)||t.isContentEditable}function Sse(){const t=wse();t&&(vse(t)||xse(t))&&(t.blur?.(),document.body?.focus?.())}function so(){return typeof window<"u"&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0||navigator&&!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|Mobile/i))}function mL(){try{if(Sse(),so()){const t=document.querySelector(".tiptap-editor");t&&t.blur?.()}}catch{}}const kse={setTimeout:(t,e)=>setTimeout(t,e)};function Ese(t,e,n=kse){n.setTimeout(()=>{const r=Uc.querySelector(t);r&&Uc.focusElement(r)},e)}function Tse(t=200){if(!(typeof window>"u"||typeof navigator>"u"))if("vibrate"in navigator)try{navigator.vibrate(t)}catch{}else try{const e=document.getElementById("vibrateSwitch");e&&e.click()}catch{}}var Cse=1063;function _se(t){const e={content:t.content,created_at:Math.floor(Date.now()/1e3),kind:Cse,tags:[["url",t.url],["m",t.m],["x",t.x],["ox",t.ox]]};return t.size&&e.tags.push(["size",t.size]),t.dim&&e.tags.push(["dim",t.dim]),t.i&&e.tags.push(["i",t.i]),t.blurhash&&e.tags.push(["blurhash",t.blurhash]),t.thumb&&e.tags.push(["thumb",t.thumb]),t.image&&e.tags.push(["image",t.image]),t.summary&&e.tags.push(["summary",t.summary]),t.alt&&e.tags.push(["alt",t.alt]),t.fallback&&t.fallback.forEach(n=>e.tags.push(["fallback",n])),e}var gL=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],sp=t=>{let e=0;for(let n=0;n<t.length;n++){let r=t[n],i=gL.indexOf(r);e=e*83+i}return e},Hh=(t,e)=>{var n="";for(let r=1;r<=e;r++){let i=Math.floor(t)/Math.pow(83,e-r)%83;n+=gL[Math.floor(i)]}return n},yf=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},bf=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},Ase=t=>t<0?-1:1,wf=(t,e)=>Ase(t)*Math.pow(Math.abs(t),e),Cy=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},Pse=t=>{if(!t||t.length<6)throw new Cy("The blurhash string must be at least 6 characters");let e=sp(t[0]),n=Math.floor(e/9)+1,r=e%9+1;if(t.length!==4+2*r*n)throw new Cy(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*r*n}`)},Ise=t=>{let e=t>>16,n=t>>8&255,r=t&255;return[yf(e),yf(n),yf(r)]},Ose=(t,e)=>{let n=Math.floor(t/361),r=Math.floor(t/19)%19,i=t%19;return[wf((n-9)/9,2)*e,wf((r-9)/9,2)*e,wf((i-9)/9,2)*e]},Mse=(t,e,n,r)=>{Pse(t),r=r|1;let i=sp(t[0]),s=Math.floor(i/9)+1,o=i%9+1,a=(sp(t[1])+1)/166,l=new Array(o*s);for(let d=0;d<l.length;d++)if(d===0){let f=sp(t.substring(2,6));l[d]=Ise(f)}else{let f=sp(t.substring(4+d*2,6+d*2));l[d]=Ose(f,a*r)}let c=e*4,u=new Uint8ClampedArray(c*n);for(let d=0;d<n;d++)for(let f=0;f<e;f++){let h=0,p=0,m=0;for(let x=0;x<s;x++)for(let C=0;C<o;C++){let P=Math.cos(Math.PI*f*C/e)*Math.cos(Math.PI*d*x/n),S=l[C+x*o];h+=S[0]*P,p+=S[1]*P,m+=S[2]*P}let g=bf(h),y=bf(p),b=bf(m);u[4*f+0+d*c]=g,u[4*f+1+d*c]=y,u[4*f+2+d*c]=b,u[4*f+3+d*c]=255}return u},Nse=Mse,NI=4,Rse=(t,e,n,r)=>{let i=0,s=0,o=0,a=e*NI;for(let c=0;c<e;c++){let u=NI*c;for(let d=0;d<n;d++){let f=u+d*a,h=r(c,d);i+=h*yf(t[f]),s+=h*yf(t[f+1]),o+=h*yf(t[f+2])}}let l=1/(e*n);return[i*l,s*l,o*l]},Dse=t=>{let e=bf(t[0]),n=bf(t[1]),r=bf(t[2]);return(e<<16)+(n<<8)+r},Lse=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor(wf(t[0]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(wf(t[1]/e,.5)*9+9.5)))),i=Math.floor(Math.max(0,Math.min(18,Math.floor(wf(t[2]/e,.5)*9+9.5))));return n*19*19+r*19+i},Bse=(t,e,n,r,i)=>{if(r<1||r>9||i<1||i>9)throw new Cy("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new Cy("Width and height must match the pixels array");let s=[];for(let d=0;d<i;d++)for(let f=0;f<r;f++){let h=f==0&&d==0?1:2,p=Rse(t,e,n,(m,g)=>h*Math.cos(Math.PI*f*m/e)*Math.cos(Math.PI*d*g/n));s.push(p)}let o=s[0],a=s.slice(1),l="",c=r-1+(i-1)*9;l+=Hh(c,1);let u;if(a.length>0){let d=Math.max(...a.map(h=>Math.max(...h))),f=Math.floor(Math.max(0,Math.min(82,Math.floor(d*166-.5))));u=(f+1)/166,l+=Hh(f,1)}else u=1,l+=Hh(0,1);return l+=Hh(Dse(o),4),a.forEach(d=>{l+=Hh(Lse(d,u),2)}),l},Fse=Bse;async function yL(t){if(!t.url)throw new Error("url is required for imeta tag");if(!t.m)throw new Error("m (MIME type) is required for imeta tag");let e=t.dim;if(!e&&t.url)try{e=await new Promise(i=>{const s=new window.Image;s.onload=()=>{i(`${s.naturalWidth}x${s.naturalHeight}`)},s.onerror=()=>i(void 0),s.src=t.url})}catch{e=void 0}const n=_se({content:t.content||"",url:t.url,m:t.m,x:t.x||"",ox:t.ox||"",size:t.size,dim:e,blurhash:t.blurhash,thumb:t.thumb,image:t.image,summary:t.summary,alt:t.alt,fallback:t.fallback}),r=[`url ${t.url}`];for(const i of n.tags){const[s,...o]=i;s!=="url"&&(o.length===1?r.push(`${s} ${o[0]}`):o.length>1&&r.push(`${s} ${o.join(" ")}`))}return["imeta",...r]}async function $se(t){try{if(on.value)return null;const e=await new Promise((o,a)=>{const l=URL.createObjectURL(t),c=new window.Image;c.onload=()=>{URL.revokeObjectURL(l),o(c)},c.onerror=u=>{URL.revokeObjectURL(l),a(u)},c.src=l});if(on.value)return null;const n=document.createElement("canvas");n.width=Math.min(e.width,64),n.height=Math.min(e.height,64);const r=n.getContext("2d");if(!r)return null;r.drawImage(e,0,0,n.width,n.height);const i=r.getImageData(0,0,n.width,n.height);return Fse(i.data,i.width,i.height,4,4)}catch{return null}}async function zse(t){try{return URL.createObjectURL(t)}catch{return null}}async function Use(t){return await $se(t)}function bL(t){const e={};return t&&t.state&&t.state.doc&&t.state.doc.descendants(n=>{n.type?.name==="image"&&n.attrs?.src&&n.attrs?.blurhash&&!n.attrs?.isPlaceholder&&!n.attrs?.src?.startsWith("placeholder-")&&(e[n.attrs.src]=n.attrs.blurhash)}),e}function Hse(t,e,n,r){try{const i=Nse(t,n,r),s=e.getContext("2d");if(!s)return!1;const o=new ImageData(new Uint8ClampedArray(Array.from(i)),n,r);return s.putImageData(o,0,0),!0}catch(i){return console.warn("Failed to decode blurhash:",i),!1}}function wL(t){const e=t.split(".").pop()?.toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",svg:"image/svg+xml"}[e||""]||"image/jpeg"}async function Vse(t){try{const e=await fetch(t);if(!e.ok)return null;const n=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}catch(e){return console.warn("Failed to calculate image hash:",e),null}}const RI={maxWidth:780,maxHeight:240};function vL(t,e,n=RI.maxWidth,r=RI.maxHeight){if(t<=n&&e<=r)return{width:t,height:e,displayWidth:t,displayHeight:e};const i=t/e;let s,o;return t/n>e/r?(s=n,o=Math.round(n/i)):(o=r,s=Math.round(r*i)),{width:t,height:e,displayWidth:s,displayHeight:o}}function Wse(t){if(!t)return null;const e=t.match(/^(\d+)x(\d+)$/);return e?{width:parseInt(e[1],10),height:parseInt(e[2],10)}:null}function V1(){return{width:200,height:150,displayWidth:200,displayHeight:150}}function jse(t,e,n){return{start:{nodePos:n?.()},move:e,end:{nodeData:e?.nodeData||{pos:n?.()},dropX:0,dropY:0,target:null,dropPosition:null,...e}}[t]}function qse(t){return{start:"touch-image-drag-start",move:"touch-image-drag-move",end:"touch-image-drop"}[t]}function Vh(t,e,n){const r=qse(t),i=jse(t,e,n),s=new CustomEvent(r,{detail:i,bubbles:!0,cancelable:!0});window.dispatchEvent(s),document.dispatchEvent(new CustomEvent(r,{detail:s.detail}))}function Kse(t,e){return document.elementFromPoint(t,e)?.closest(".drop-zone-indicator")||null}function Gse(){Uc.querySelectorAll(".drop-zone-indicator").forEach(t=>{t.classList.remove("drop-zone-hover")})}function Zse(t){t?.classList.add("drop-zone-hover")}function Xse(t,e){Gse();const n=Kse(t,e);Zse(n)}function Qse(t,e=140){const n=Math.min(e,t.width||e),r=t.width>0?Math.round(t.height/t.width*n):n;return{width:n,height:r}}function Yse(t){if(!t)return null;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n&&n.drawImage(t,0,0),e}function Jse(t){if(!t)return null;const e=document.createElement("img");return e.src=t.src,e.alt=t.alt||"",e}function eoe(t,e,n){Object.assign(t.style,{width:`${e.width}px`,height:`${e.height}px`,left:`${n.x-e.width/2}px`,top:`${n.y-e.height/2}px`,transformOrigin:"center center",transition:"transform 120ms ease, opacity 120ms ease"})}function toe(t,e,n,r=!1){const i=t.getBoundingClientRect(),s=Qse(i);let o=null;if(r){const a=t.querySelector("canvas");a&&(o=Yse(a))}else{const a=t.querySelector("img");a&&(o=Jse(a))}return o?(eoe(o,s,{x:e,y:n}),o.classList.add("drag-preview"),document.body.appendChild(o),requestAnimationFrame(()=>{o.style.transform="scale(0.8) rotate(0deg)",o.style.opacity="0.95"}),o):null}function noe(t,e,n){if(!t)return;const r=t.getBoundingClientRect(),i=r.width||100,s=r.height||100;t.style.left=`${e-i/2}px`,t.style.top=`${n-s/2}px`}function W1(t){t?.parentNode?.removeChild(t)}function roe(t,e,n,r,i){const s=t-n,o=e-r;return s*s+o*o>i*i}function ioe(t,e,n,r){return!!(t||e||n&&!r)}function op(t){const e=t();if(e===void 0)return;so()&&mL();const n=new CustomEvent("select-image-node",{detail:{pos:e}});window.dispatchEvent(n),document.dispatchEvent(n)}function soe(t,e){const n=new CustomEvent("image-fullscreen-request",{detail:{src:t,alt:e}});window.dispatchEvent(n),document.dispatchEvent(n)}function ooe(t,e,n,r,i,s,o,a,l){return ioe(n,r,s,e)?(t.preventDefault(),!1):i?(t.preventDefault(),e||t.stopPropagation(),soe(o,a),!0):(op(l),t.preventDefault(),e||t.stopPropagation(),!0)}function aoe(t,e,n){return!!(t&&e&&n.displayWidth>0&&n.displayHeight>0)}function loe(t,e){t.width=e.displayWidth,t.height=e.displayHeight}function DI(t,e,n,r,i=!1){aoe(t,e,n)&&(loe(e,n),Hse(t,e,n.displayWidth,n.displayHeight))}const coe={getItem:t=>localStorage.getItem(t),setItem:(t,e)=>localStorage.setItem(t,e)},uoe={language:navigator.language},doe={location:{reload:()=>window.location.reload()}},foe={setTimeout:(t,e)=>setTimeout(t,e)};function hoe(t,e){if(t<=0)return 100;const n=e/t*100;return Number(n.toPrecision(2))}function poe(t,e){const n=t/1024>=1e3,r=i=>n?`${(i/1048576).toFixed(2)}MB`:`${Math.round(i/1024)}KB`;return`${r(t)} â ${r(e)}`}function moe(t,e,n,r,i,s){return{originalSize:t,compressedSize:e,wasCompressed:n,compressionRatio:hoe(t,e),sizeReduction:poe(t,e),originalFilename:r,compressedFilename:i,wasSkipped:s}}function goe(t){return t.wasCompressed||t.originalFilename!==t.compressedFilename||t.originalSize!==t.compressedSize||!!t.wasSkipped}function LI(t){if(!t||!goe(t))return null;const e=t.originalSize/1024>=1e3,n=r=>e?`${(r/1048576).toFixed(2)}MB`:`${Math.round(r/1024)}KB`;return{wasCompressed:t.wasCompressed,originalSize:n(t.originalSize),compressedSize:n(t.compressedSize),compressionRatio:t.compressionRatio,originalFilename:t.originalFilename,compressedFilename:t.compressedFilename,wasSkipped:t.wasSkipped}}function yoe(t){return Wie.test(t)}function boe(t){return jie.test(t)}function woe(t){return iw(t)}function voe(t){return{npub:cl.npubEncode(t),nprofile:cl.nprofileEncode({pubkey:t,relays:[]})}}function xoe(t){try{const{type:e,data:n}=cl.decode(t);if(e!=="nsec")return console.warn("ç¡å¹ãªnsecå½¢å¼ã§ã"),{hex:"",npub:"",nprofile:""};const r=woe(n),{npub:i,nprofile:s}=voe(r);return{hex:r,npub:i,nprofile:s}}catch{return{hex:"",npub:"",nprofile:""}}}function xL(t){try{return cl.npubEncode(t)}catch{return`npub1${t.slice(0,10)}...`}}function Soe(t,e=[],n=[]){try{const r=[];e.length>0&&r.push(e[0]);const i=3-r.length;if(i>0){const s=n.filter(o=>!r.includes(o));r.push(...s.slice(0,Math.min(i,2)))}return cl.nprofileEncode({pubkey:t,relays:r})}catch{return""}}async function SL(t,e=window.crypto.subtle){if(on.value)throw new Error("Upload aborted by user");const n=await t.arrayBuffer(),r=await e.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function koe(t,e){try{return await SL(t,e)}catch{return}}async function Eoe(t){return new Promise(e=>{if(!t.type.startsWith("image/")){e(null);return}const n=new Image,r=URL.createObjectURL(t);n.onload=()=>{try{const i=vL(n.naturalWidth,n.naturalHeight);URL.revokeObjectURL(r),e(i)}catch(i){console.error("Failed to calculate image display size:",i),URL.revokeObjectURL(r),e(null)}},n.onerror=()=>{URL.revokeObjectURL(r),e(null)},n.src=r})}function Toe(t,e){const r={"image/webp":".webp","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/avif":".avif","image/bmp":".bmp"}[e];return r?`${t.replace(/\.[^.]+$/,"")}${r}`:t}function Coe(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function _oe(t,e){const n=t.getItem(Hr.LOCALE),r=e.language;return n||(r&&r.startsWith("ja")?"ja":"en")}function Aoe(t,e,n){const r=e.getItem(Hr.UPLOAD_ENDPOINT);return r&&uL.some(i=>i.url===r)?r:n||bT(t)}function Poe(t){const e=t.getItem(Hr.CLIENT_TAG_ENABLED),n=e===null?!0:e==="true";return e===null&&t.setItem(Hr.CLIENT_TAG_ENABLED,"true"),n}function Ioe(t,e){return t.getItem(Hr.IMAGE_COMPRESSION_LEVEL)||e||"medium"}function Ooe(t={}){const{selectedEndpoint:e,selectedCompression:n,storage:r=coe,navigator:i=uoe}=t,s=_oe(r,i),o=Aoe(s,r,e),a=Poe(r),l=Ioe(r,n);return{endpoint:o,clientTagEnabled:a,compression:l}}function Moe(t,e,n={}){const{timeout:r=1e3,windowAdapter:i=doe,timeoutAdapter:s=foe}=n;e(!0),t(),s.setTimeout(()=>{i.location.reload()},r)}async function kL(t,e,n,r="readonly"){return new Promise(i=>{try{const s=indexedDB.open(t,e);s.onupgradeneeded=o=>{const a=o.target.result;a.objectStoreNames.contains(n)||a.createObjectStore(n,{keyPath:"id"})},s.onerror=()=>i(null),s.onsuccess=o=>{try{const a=o.target.result;if(!a.objectStoreNames.contains(n)){a.close(),i(null);return}const l=a.transaction([n],r),c=l.objectStore(n);i({db:a,transaction:l,store:c})}catch{i(null)}}}catch{i(null)}})}async function Noe(t,e,n,r){const i=await kL(t,e,n,"readonly");if(!i)return null;const{db:s,store:o}=i;return new Promise(a=>{const l=o.get(r);l.onsuccess=()=>{s.close(),a(l.result)},l.onerror=()=>{s.close(),a(null)}})}async function Roe(t,e,n,r){const i=await kL(t,e,n,"readwrite");if(!i)return!1;const{db:s,store:o}=i;return new Promise(a=>{const l=o.delete(r);l.onsuccess=()=>{s.close(),a(!0)},l.onerror=()=>{s.close(),a(!1)}})}function Doe(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function ST(t,e=La.REQUEST_TIMEOUT){if(!navigator.serviceWorker.controller)throw new Error("No ServiceWorker controller available");const n=new MessageChannel,r=Doe();return new Promise((i,s)=>{const o=setTimeout(()=>{n.port1.close(),s(new Error("ServiceWorker communication timeout"))},e);n.port1.onmessage=a=>{clearTimeout(o),n.port1.close();const{data:l}=a.data||{};i(l)},n.port1.addEventListener("error",a=>{clearTimeout(o),n.port1.close(),s(a)});try{if(navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({...t,requestId:r},[n.port2]);else throw new Error("ServiceWorker controller became unavailable")}catch(a){clearTimeout(o),n.port1.close(),s(a)}})}async function Loe(){if(!navigator.serviceWorker.controller)return new Promise((t,e)=>{const n=setTimeout(()=>{navigator.serviceWorker.removeEventListener("controllerchange",r),e(new Error("ServiceWorkerã³ã³ãã­ã¼ã©ã¼å¾æ©ã¿ã¤ã ã¢ã¦ã"))},La.REQUEST_TIMEOUT),r=()=>{clearTimeout(n),navigator.serviceWorker.removeEventListener("controllerchange",r),setTimeout(t,La.SW_CONTROLLER_WAIT_TIMEOUT)};navigator.serviceWorker.addEventListener("controllerchange",r)})}async function Boe(){const t=await Noe(La.INDEXEDDB_NAME,La.INDEXEDDB_VERSION,La.STORE_NAME,"sharedImageData");return t?.data?(await Roe(La.INDEXEDDB_NAME,La.INDEXEDDB_VERSION,La.STORE_NAME,"sharedImageData"),t.data.image?.arrayBuffer&&t.data.image._isFile?{image:new File([t.data.image.arrayBuffer],t.data.image.name||"shared-image",{type:t.data.image.type||"image/jpeg"}),metadata:t.data.metadata}:t.data):null}async function Foe(){try{const t=await ST({action:"getSharedImage"});return t&&t.image?t:null}catch(t){return console.error("Failed to send message to ServiceWorker:",t),null}}async function $oe(){try{try{await Promise.race([Loe(),new Promise((t,e)=>setTimeout(()=>e(new Error("SW controller timeout")),2e3))])}catch(t){console.warn("Service Worker controller not ready, trying alternatives:",t)}try{const t=await Foe();if(t)return console.log("Shared image retrieved via ServiceWorker MessageChannel"),t}catch(t){console.warn("Service Worker MessageChannel failed:",t)}try{const t=await Boe();if(t)return console.log("Shared image retrieved via IndexedDB fallback"),t}catch(t){console.warn("IndexedDB fallback failed:",t)}try{const t=await ST({action:"getSharedImageForce"},1e3),e=t&&t.image?t:null;if(e)return console.log("Shared image retrieved via forced Service Worker request"),e}catch(t){console.warn("Forced Service Worker request failed:",t)}return console.log("No shared image found through any method"),null}catch(t){return console.error("Error in getSharedImageWithFallback:",t),null}}async function zoe(){if(!("serviceWorker"in navigator))return{isReady:!1,hasController:!1,error:"Service Worker not supported"};const t=await navigator.serviceWorker.getRegistration(),e=!!navigator.serviceWorker.controller;return t?{isReady:t.active!==null,hasController:e}:{isReady:!1,hasController:e,error:"Service Worker not registered"}}async function Uoe(){try{const t=await ST({type:"PING_TEST"},3e3);return console.log("ServiceWorker communication test successful:",t),!0}catch(t){return console.warn("ServiceWorker communication test timeout"),console.error("ServiceWorker communication test error:",t),!1}}function j1(t){if(t.type.startsWith("touch")){const e=t,n=e.touches[0]||e.changedTouches[0];return{x:n.clientX,y:n.clientY}}else{const e=t;return{x:e.clientX,y:e.clientY}}}function Hoe(t,e,n,r,i){const s=window.innerWidth||document.documentElement.clientWidth||0,o=window.innerHeight||document.documentElement.clientHeight||0,a=0,l=s-a,c=o-a;return{x:Math.max(a,Math.min(l,t)),y:Math.max(a,Math.min(c,e))}}async function Voe(t,e){const n=[];if(on.value)throw new Error("Upload aborted by user");for(let r=0;r<t.length;r++){const i=t[r],[s,o]=await Promise.all([koe(i,e.crypto),e.getImageDimensions(i)]);n.push({file:i,index:r,ox:s,dimensions:o??void 0})}return n}function Woe(t){return t.map(e=>({caption:e.name,expiration:"",size:e.size,alt:e.name,media_type:void 0,content_type:e.type||"",no_transform:"true"}))}function BI(t,e){const n=[];for(let r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}class FI{static addCacheBuster(e){if(!e)return e;try{const n=new URL(e);return n.searchParams.set("cb",Date.now().toString()),n.toString()}catch{return e}}static addProfileMarker(e,n=!1,r=!0){if(!e)return e;try{const i=new URL(e);return i.searchParams.set("profile","true"),n&&r?i.searchParams.has("cb")&&i.searchParams.set("cb",Date.now().toString()):i.searchParams.delete("cb"),i.toString()}catch{return e}}}class joe{constructor(e={}){this.deps=e}createProfileData(e,n,r){const i=r?.profileRelays||[],s=r?.writeRelays||[],o=r?.forceRemote||!1;let a=e?.picture||"";if(a){o&&(a=FI.addCacheBuster(a));const l=this.deps.navigator?.onLine??!0;a=FI.addProfileMarker(a,o,l)}return{name:e?.name||"",picture:a,npub:xL(n),nprofile:Soe(n,i,s),profileRelays:i.length>0?i:void 0}}}class qoe{constructor(e,n,r){this.localStorage=e,this.console=n,this.profileDataFactory=r}save(e,n){try{if(n===null){this.localStorage.removeItem(`nostr-profile-${e}`);return}this.localStorage.setItem(`nostr-profile-${e}`,JSON.stringify(n)),this.console.log("ãã­ãã£ã¼ã«æå ±ãã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){this.console.error("ãã­ãã£ã¼ã«æå ±ã®ä¿å­ã«å¤±æ:",r)}}get(e){try{const n=this.localStorage.getItem(`nostr-profile-${e}`);if(!n)return null;const r=JSON.parse(n);return r.npub&&r.nprofile?{...r,profileRelays:r.profileRelays||void 0}:this.profileDataFactory.createProfileData(r,e,{forceRemote:!1})}catch(n){return this.console.error("ãã­ãã£ã¼ã«æå ±ã®åå¾ã«å¤±æ:",n),null}}clear(e){this.save(e,null)}}class Koe{constructor(e,n,r,i,s){this.rxNostr=e,this.profileDataFactory=n,this.setTimeoutFn=r,this.clearTimeoutFn=i,this.console=s}async fetchFromNetwork(e,n){n?.timeoutMs;const r=n?.additionalRelays??[];return new Promise(i=>{const s=M0();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=h=>{a||(a=!0,c(),i(h))},d=r.length>0?{on:{relays:r}}:void 0;l=(d?this.rxNostr.use(s,d):this.rxNostr.use(s)).subscribe({next:h=>{if(!a&&h.event?.kind===0&&h.event.pubkey===e){o=!0;try{const p=JSON.parse(h.event.content),m=[];if(h.from&&typeof h.from=="string"){const y=h.from.endsWith("/")?h.from:h.from+"/";m.push(y)}const g=this.profileDataFactory.createProfileData(p,e,{profileRelays:m,writeRelays:n?.writeRelays,forceRemote:n?.forceRemote});this.console.log("Kind 0ãããã­ãã£ã¼ã«æå ±ãåå¾:",g,"from relay:",h.from),u(g)}catch(p){this.console.error("Kind 0ã®ãã¼ã¹ã¨ã©ã¼:",p),u(null)}}},complete:()=>{if(!a&&!o){this.console.log("ãã­ãã£ã¼ã«åå¾EOSEãããã©ã«ããã­ãã£ã¼ã«ãä½¿ç¨");const h=this.profileDataFactory.createProfileData({},e,{writeRelays:n?.writeRelays,forceRemote:n?.forceRemote});u(h)}},error:h=>{a||(this.console.error("ãã­ãã£ã¼ã«åå¾ã¨ã©ã¼:",h),u(null))}}),s.emit({authors:[e],kinds:[0],until:Math.floor(Date.now()/1e3)}),s.over()})}}class Goe{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.navigator||(typeof window<"u"?window.navigator:{onLine:!0}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.console||(typeof window<"u"?window.console:{});this.profileDataFactory=new joe({navigator:i}),this.storage=new qoe(r,a,this.profileDataFactory),this.networkFetcher=new Koe(e,this.profileDataFactory,s,o,a)}storage;networkFetcher;profileDataFactory;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}async fetchProfileData(e,n){const r=this.networkFetcher.console;if(r.log(`ãã­ãã£ã¼ã«åå¾éå§: ${e}`),!n?.forceRemote){const s=this.storage.get(e);if(s)return r.log("ã­ã£ãã·ã¥ãããã­ãã£ã¼ã«ãå¾©å:",s),s}r.log("ãªã¢ã¼ããããã­ãã£ã¼ã«æå ±ãåå¾ä¸­...");const i=await this.networkFetcher.fetchFromNetwork(e,n);return i&&this.storage.save(e,i),i}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}getProfileDataFactory(){return this.profileDataFactory}}class Zoe{relayManager;profileManager;constructor(e,n,r){this.relayManager=n,this.profileManager=r}async initializeRelays(e){e?this.relayManager.useRelaysFromLocalStorageIfExists(e)||this.relayManager.setBootstrapRelays():this.relayManager.setBootstrapRelays()}async fetchRelays(e,n=!1){if(!n){const i=this.relayManager.getFromLocalStorage(e);if(i)return console.log("ã­ã£ãã·ã¥ãããªã¬ã¼ãªã¹ããå¾©å:",i),{success:!0,relayConfig:i,source:"localStorage"}}return await this.relayManager.fetchUserRelays(e,{forceRemote:n})}async fetchProfile(e,n=!1){if(!e)return null;n&&this.profileManager.saveToLocalStorage(e,null);const{writeRelays:r,additionalRelays:i}=this.relayManager.getRelayListsForProfile(e);return await this.profileManager.fetchProfileData(e,{forceRemote:n,writeRelays:r,additionalRelays:i})}async initializeForLogin(e){console.log(`ã­ã°ã¤ã³åæåéå§: ${e}`),await this.fetchRelays(e,!1);const n=await this.fetchProfile(e,!1);return console.log(`ã­ã°ã¤ã³åæåå®äº: ${e}`),n}async refreshRelaysAndProfile(e){console.log(`ãªã¬ã¼ã»ãã­ãã£ã¼ã«ååå¾éå§: ${e}`),await this.fetchRelays(e,!0);const n=await this.fetchProfile(e,!0);return console.log(`ãªã¬ã¼ã»ãã­ãã£ã¼ã«ååå¾å®äº: ${e}`),n}getRelayManager(){return this.relayManager}getProfileManager(){return this.profileManager}}function $r(t){this.content=t}$r.prototype={constructor:$r,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new $r(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new $r(n)},addToStart:function(t,e){return new $r([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new $r(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new $r(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=$r.from(t),t.size?new $r(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=$r.from(t),t.size?new $r(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=$r.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};$r.from=function(t){if(t instanceof $r)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new $r(e)};function EL(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=EL(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function TL(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=TL(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class Fe{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:s+=r),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new Fe(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new Fe(r,i)}cutByIndex(e,n){return e==n?Fe.empty:e==0&&n==this.content.length?this:new Fe(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new Fe(i,s)}addToStart(e){return new Fe([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Fe(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return EL(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return TL(this,e,n,r)}findIndex(e){if(e==0)return $g(0,e);if(e==this.size)return $g(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),s=r+i.nodeSize;if(s>=e)return s==e?$g(n+1,s):$g(n,r);r=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Fe.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fe(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Fe.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new Fe(n||e,r)}static from(e){if(!e)return Fe.empty;if(e instanceof Fe)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Fe([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fe.empty=new Fe([],0);const q1={index:0,offset:0};function $g(t,e){return q1.index=t,q1.offset=e,q1}function _y(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!_y(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!_y(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let _n=class sS{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&_y(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let i=r.create(n.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return sS.none;if(e instanceof sS)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}};_n.none=[];class Ay extends Error{}class it{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=_L(this.content,e+this.openStart,n);return r&&new it(r,this.openStart,this.openEnd)}removeBetween(e,n){return new it(CL(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return it.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new it(Fe.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new it(e,r,i)}}it.empty=new it(Fe.empty,0,0);function CL(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(CL(s.content,e-i-1,n-i-1)))}function _L(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=_L(o.content,e-s-1,n,o);return a&&t.replaceChild(i,o.copy(a))}function Xoe(t,e,n){if(n.openStart>t.depth)throw new Ay("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Ay("Inconsistent open depths");return AL(t,e,n,0)}function AL(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=AL(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Wu(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=Qoe(n,t);return Wu(s,IL(t,o,a,e,r))}else return Wu(s,Py(t,e,r))}function PL(t,e){if(!e.type.compatibleContent(t.type))throw new Ay("Cannot join "+e.type.name+" onto "+t.type.name)}function oS(t,e,n){let r=t.node(n);return PL(r,e.node(n)),r}function Vu(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Ip(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(Vu(t.nodeAfter,r),s++));for(let a=s;a<o;a++)Vu(i.child(a),r);e&&e.depth==n&&e.textOffset&&Vu(e.nodeBefore,r)}function Wu(t,e){return t.type.checkContent(e),t.copy(e)}function IL(t,e,n,r,i){let s=t.depth>i&&oS(t,e,i+1),o=r.depth>i&&oS(n,r,i+1),a=[];return Ip(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(PL(s,o),Vu(Wu(s,IL(t,e,n,r,i+1)),a)):(s&&Vu(Wu(s,Py(t,e,i+1)),a),Ip(e,n,i,a),o&&Vu(Wu(o,Py(n,r,i+1)),a)),Ip(r,null,i,a),new Fe(a)}function Py(t,e,n){let r=[];if(Ip(null,t,n,r),t.depth>n){let i=oS(t,e,n+1);Vu(Wu(i,Py(t,e,n+1)),r)}return Ip(e,null,n,r),new Fe(r)}function Qoe(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(Fe.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class am{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return _n.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new Iy(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new am(n,r,s)}static resolveCached(e,n){let r=$I.get(e);if(r)for(let s=0;s<r.elts.length;s++){let o=r.elts[s];if(o.pos==n)return o}else $I.set(e,r=new Yoe);let i=r.elts[r.i]=am.resolve(e,n);return r.i=(r.i+1)%Joe,i}}class Yoe{constructor(){this.elts=[],this.i=0}}const Joe=12,$I=new WeakMap;class Iy{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const eae=Object.create(null);let Tc=class aS{constructor(e,n,r,i=_n.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||Fe.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&_y(this.attrs,n||e.defaultAttrs||eae)&&_n.sameSet(this.marks,r||_n.none)}copy(e=null){return e==this.content?this:new aS(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new aS(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return it.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new it(c,i.depth-o,s.depth-o)}replace(e,n,r){return Xoe(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return am.resolveCached(this,e)}resolveNoCache(e){return am.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),OL(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=Fe.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=_n.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!_n.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=Fe.fromJSON(e,n.content),s=e.nodeType(n.type).create(n.attrs,i,r);return s.type.checkAttrs(s.attrs),s}};Tc.prototype.text=void 0;class Oy extends Tc{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):OL(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Oy(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Oy(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function OL(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class ad{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new tae(e,n);if(r.next==null)return ad.empty;let i=ML(r);r.next&&r.err("Unexpected trailing text");let s=lae(aae(i));return cae(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return Fe.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let f=s(d,a.concat(u));if(f)return f}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}ad.empty=new ad(!0);class tae{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function ML(t){let e=[];do e.push(nae(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function nae(t){let e=[];do e.push(rae(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function rae(t){let e=oae(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=iae(t,e);else break;return e}function zI(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function iae(t,e){let n=zI(t),r=n;return t.eat(",")&&(t.next!="}"?r=zI(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function sae(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function oae(t){if(t.eat("(")){let e=ML(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=sae(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function aae(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function NL(t,e){return e-t}function UI(t,e){let n=[];return r(e),n.sort(NL);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function lae(t){let e=Object.create(null);return n(UI(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);UI(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new ad(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(NL);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function cae(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function RL(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function DL(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function LL(t,e,n,r){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${n} of type ${i}`);for(let i in t){let s=t[i];s.validate&&s.validate(e[i])}}function BL(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new dae(t,r,e[r]);return n}let HI=class FL{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=BL(e,r.attrs),this.defaultAttrs=RL(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ad.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:DL(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Tc(this,this.computeAttrs(e),Fe.from(n),_n.setFrom(r))}createChecked(e=null,n,r){return n=Fe.from(n),this.checkContent(n),new Tc(this,this.computeAttrs(e),n,_n.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=Fe.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(Fe.empty,!0);return s?new Tc(this,e,n.append(s),_n.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){LL(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:_n.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new FL(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function uae(t,e,n){let r=n.split("|");return i=>{let s=i===null?"null":typeof i;if(r.indexOf(s)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${s}`)}}class dae{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?uae(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class mw{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=BL(e,i.attrs),this.excluded=null;let s=RL(this.attrs);this.instance=s?new _n(this,s):null}create(e=null){return!e&&this.instance?this.instance:new _n(this,DL(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new mw(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){LL(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class $L{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let i in e)n[i]=e[i];n.nodes=$r.from(e.nodes),n.marks=$r.from(e.marks||{}),this.nodes=HI.compile(this.spec.nodes,this),this.marks=mw.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=r[o]||(r[o]=ad.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?VI(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:VI(this,o.split(" "))}this.nodeFromJSON=i=>Tc.fromJSON(this,i),this.markFromJSON=i=>_n.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof HI){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new Oy(r,r.defaultAttrs,e,_n.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function VI(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function fae(t){return t.tag!=null}function hae(t){return t.style!=null}class Cc{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(i=>{if(fae(i))this.tags.push(i);else if(hae(i)){let s=/[^=]*/.exec(i.style)[0];r.indexOf(s)<0&&r.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,n={}){let r=new jI(this,n,!1);return r.addAll(e,_n.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new jI(this,n,!0);return r.addAll(e,_n.none,n.from,n.to),it.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(gae(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=qI(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=qI(o)),o.node||o.ignore||o.mark||(o.node=i)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Cc(e,Cc.schemaRules(e)))}}const zL={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},pae={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},UL={ol:!0,ul:!0},lm=1,lS=2,Op=4;function WI(t,e,n){return e!=null?(e?lm:0)|(e==="full"?lS:0):t&&t.whitespace=="pre"?lm|lS:n&~Op}class zg{constructor(e,n,r,i,s,o){this.type=e,this.attrs=n,this.marks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=_n.none,this.match=s||(o&Op?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Fe.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&lm)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=Fe.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Fe.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!zL.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class jI{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let i=n.topNode,s,o=WI(null,n.preserveWhitespace,0)|(r?Op:0);i?s=new zg(i.type,i.attrs,_n.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new zg(null,null,_n.none,!0,null,o):s=new zg(e.schema.topNodeType,null,_n.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,i=this.top,s=i.options&lS?"full":this.localPreserveWS||(i.options&lm)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(s)if(s==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;UL.hasOwnProperty(o)&&this.parser.normalizeLists&&mae(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:pae.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(zL.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let d=l&&l.skip?n:this.readStyles(e,n);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=r.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,i){let s,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(s=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,n,r,i){let s=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,n);this.findAtPoint(e,s)}findPlace(e,n,r){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)n=this.enterInner(i[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(n=this.enterInner(s,null,n))}let i=this.findPlace(e,n,r);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=_n.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):KI(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,n,r,i){let s=this.findPlace(e.create(n),r,!1);return s&&(s=this.enterInner(e,n,r,!0,i)),s}enterInner(e,n,r,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=WI(e,s,o.options);o.options&Op&&o.content.length==0&&(a|=Op);let l=_n.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):KI(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new zg(e,n,l,i,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=lm)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function mae(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&UL.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function gae(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function qI(t){let e={};for(let n in t)e[n]=t[n];return e}function KI(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class bd{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=K1(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=m0(K1(n),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&m0(K1(r),i(e,n),null,e.attrs)}static renderSpec(e,n,r=null,i){return m0(e,n,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new bd(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=GI(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return GI(e.marks)}}function GI(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function K1(t){return t.document||window.document}const ZI=new WeakMap;function yae(t){let e=ZI.get(t);return e===void 0&&ZI.set(t,e=bae(t)),e}function bae(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)n(r[i]);else for(let i in r)n(r[i])}return n(t),e}function m0(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(s=yae(r))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));let a,l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let f=d.indexOf(" ");f>0?l.setAttributeNS(d.slice(0,f),d.slice(f+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let f=e[d];if(f===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:h,contentDOM:p}=m0(t,f,n,r);if(l.appendChild(h),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const HL=65535,VL=Math.pow(2,16);function wae(t,e){return t+e*VL}function XI(t){return t&HL}function vae(t){return(t-(t&HL))/VL}const WL=1,jL=2,g0=4,qL=8;class cS{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&qL)>0}get deletedBefore(){return(this.delInfo&(WL|g0))>0}get deletedAfter(){return(this.delInfo&(jL|g0))>0}get deletedAcross(){return(this.delInfo&g0)>0}}class ls{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ls.empty)return ls.empty}recover(e){let n=0,r=XI(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+vae(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let f=c?e==l?-1:e==d?1:n:n,h=l+i+(f<0?0:u);if(r)return h;let p=e==(n<0?l:d)?null:wae(a/3,e-l),m=e==l?jL:e==d?WL:g0;return(n<0?e!=l:e!=d)&&(m|=qL),new cS(h,m,p)}i+=u-c}return r?e+i:new cS(e+i,0,null)}touches(e,n){let r=0,i=XI(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new ls(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ls.empty:new ls(e<0?[0,-e,0]:[0,0,e])}}ls.empty=new ls([]);class cm{constructor(e,n,r=0,i=e?e.length:0){this.mirror=n,this.from=r,this.to=i,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new cm(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let i=e.getMirror(n);this.appendMap(e._maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e._maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new cm;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new cS(e,i,null)}}const G1=Object.create(null);class gi{getMap(){return ls.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=G1[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in G1)throw new RangeError("Duplicate use of step JSON ID "+e);return G1[e]=n,n.prototype.jsonID=e,n}}class dr{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new dr(e,null)}static fail(e){return new dr(null,e)}static fromReplace(e,n,r,i){try{return dr.ok(e.replace(n,r,i))}catch(s){if(s instanceof Ay)return dr.fail(s.message);throw s}}}function kT(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(kT(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return Fe.fromArray(r)}class pc extends gi{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new it(kT(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return dr.fromReplace(e,this.from,this.to,s)}invert(){return new oo(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new pc(n.pos,r.pos,this.mark)}merge(e){return e instanceof pc&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new pc(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new pc(n.from,n.to,e.markFromJSON(n.mark))}}gi.jsonID("addMark",pc);class oo extends gi{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new it(kT(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return dr.fromReplace(e,this.from,this.to,r)}invert(){return new pc(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new oo(n.pos,r.pos,this.mark)}merge(e){return e instanceof oo&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new oo(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new oo(n.from,n.to,e.markFromJSON(n.mark))}}gi.jsonID("removeMark",oo);class mc extends gi{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return dr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return dr.fromReplace(e,this.pos,this.pos+1,new it(Fe.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new mc(this.pos,n.marks[i]);return new mc(this.pos,this.mark)}}return new ld(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new mc(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new mc(n.pos,e.markFromJSON(n.mark))}}gi.jsonID("addNodeMark",mc);class ld extends gi{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return dr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return dr.fromReplace(e,this.pos,this.pos+1,new it(Fe.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new mc(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ld(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new ld(n.pos,e.markFromJSON(n.mark))}}gi.jsonID("removeNodeMark",ld);class xr extends gi{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&uS(e,this.from,this.to)?dr.fail("Structure replace would overwrite content"):dr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ls([this.from,this.to-this.from,this.slice.size])}invert(e){return new xr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new xr(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof xr)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?it.empty:new it(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new xr(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?it.empty:new it(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new xr(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new xr(n.from,n.to,it.fromJSON(e,n.slice),!!n.structure)}}gi.jsonID("replace",xr);class Pr extends gi{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(uS(e,this.from,this.gapFrom)||uS(e,this.gapTo,this.to)))return dr.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return dr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?dr.fromReplace(e,this.from,this.to,r):dr.fail("Content does not fit in gap")}getMap(){return new ls([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Pr(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new Pr(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Pr(n.from,n.to,n.gapFrom,n.gapTo,it.fromJSON(e,n.slice),n.insert,!!n.structure)}}gi.jsonID("replaceAround",Pr);function uS(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function xae(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!r.isInSet(d)&&u.type.allowsMarkType(r.type)){let f=Math.max(c,e),h=Math.min(c+l.nodeSize,n),p=r.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==f&&o.mark.eq(d[m])?o.to=h:i.push(o=new oo(f,h,d[m])));a&&a.to==f?a.to=h:s.push(a=new pc(f,h,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function Sae(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof mw){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let d=l[u],f;for(let h=0;h<i.length;h++){let p=i[h];p.step==s-1&&d.eq(i[h].style)&&(f=p)}f?(f.to=c,f.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new oo(o.from,o.to,o.style)))}function ET(t,e,n,r=n.contentMatch,i=!0){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=r.matchType(c.type);if(!d)o.push(new xr(a,u,it.empty));else{r=d;for(let f=0;f<c.marks.length;f++)n.allowsMarkType(c.marks[f].type)||t.step(new oo(a,u,c.marks[f]));if(i&&c.isText&&n.whitespace!="pre"){let f,h=/\r?\n|\r/g,p;for(;f=h.exec(c.text);)p||(p=new it(Fe.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new xr(a+f.index,a+f.index+f[0].length,p))}}a=u}if(!r.validEnd){let l=r.fillBefore(Fe.empty,!0);t.replace(a,a,new it(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function kae(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function uh(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,i=0,s=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+i,l=t.$to.indexAfter(r)-s;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!kae(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function Eae(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=Fe.empty,d=0;for(let p=s,m=!1;p>n;p--)m||r.index(p)>0?(m=!0,u=Fe.from(r.node(p).copy(u)),d++):l--;let f=Fe.empty,h=0;for(let p=s,m=!1;p>n;p--)m||i.after(p+1)<i.end(p)?(m=!0,f=Fe.from(i.node(p).copy(f)),h++):c++;t.step(new Pr(l,c,o,a,new it(u.append(f),d,h),u.size-d,!0))}function TT(t,e,n=null,r=t){let i=Tae(t,e),s=i&&Cae(r,e);return s?i.map(QI).concat({type:e,attrs:n}).concat(s.map(QI)):null}function QI(t){return{type:t,attrs:null}}function Tae(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function Cae(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function _ae(t,e,n){let r=Fe.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Fe.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new Pr(i,s,i,s,new it(r,0,0),n.length,!0))}function Aae(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(r,l)&&Pae(t.doc,t.mapping.slice(s).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let h=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);h&&!p?c=!1:!h&&p&&(c=!0)}c===!1&&GL(t,o,a,s),ET(t,t.mapping.slice(s).map(a,1),r,void 0,c===null);let u=t.mapping.slice(s),d=u.map(a,1),f=u.map(a+o.nodeSize,1);return t.step(new Pr(d,f,d+1,f-1,new it(Fe.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&KL(t,o,a,s),!1}})}function KL(t,e,n,r){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=t.mapping.slice(r).map(n+1+s+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function GL(t,e,n,r){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+s);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function Pae(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function Iae(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Pr(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new it(Fe.from(o),0,0),1,!0))}function el(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let d=i.node(c),f=i.index(c);if(d.type.spec.isolating)return!1;let h=d.content.cutByIndex(f,d.childCount),p=r&&r[u+1];p&&(h=h.replaceChild(0,p.type.create(p.attrs)));let m=r&&r[u]||d;if(!d.canReplace(f+1,d.childCount)||!m.type.validContent(h))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function Oae(t,e,n=1,r){let i=t.doc.resolve(e),s=Fe.empty,o=Fe.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=Fe.from(i.node(a).copy(s));let u=r&&r[c];o=Fe.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new xr(e,e,new it(s.append(o),n,n),!0))}function eu(t,e){let n=t.resolve(e),r=n.index();return ZL(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Mae(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==r?t.type.schema.nodes.text:s.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(s.marks))return!1}return n.validEnd}function ZL(t,e){return!!(t&&e&&!t.isLeaf&&Mae(t,e))}function gw(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let s,o,a=r.index(i);if(i==r.depth?(s=r.nodeBefore,o=r.nodeAfter):n>0?(s=r.node(i+1),a++,o=r.node(i).maybeChild(a)):(s=r.node(i).maybeChild(a-1),o=r.node(i+1)),s&&!s.isTextblock&&ZL(s,o)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=n<0?r.before(i):r.after(i)}}function Nae(t,e,n){let r=null,{linebreakReplacement:i}=t.doc.type.schema,s=t.doc.resolve(e-n),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?r=!1:!u&&d&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);GL(t,u.node(),u.before(),a)}o.inlineContent&&ET(t,e+n-1,o,s.node().contentMatchAt(s.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new xr(c,l.map(e+n,-1),it.empty,!0)),r===!0){let u=t.doc.resolve(c);KL(t,u.node(),u.before(),t.steps.length)}return t}function Rae(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function XL(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let d=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function yw(t,e,n=e,r=it.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return QL(i,s,r)?new xr(e,n,r):new Dae(i,s,r).fit()}function QL(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class Dae{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=Fe.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Fe.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new it(s,o,a);return e>-1?new Pr(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new xr(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let s=n.firstChild;if(n.childCount>1&&(i=0),s.type.spec.isolating&&i<=r){e=r;break}n=s.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let i,s=null;r?(s=Z1(this.unplaced.content,r-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(n==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Fe.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:r,frontierDepth:a,parent:s,inject:d};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=Z1(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new it(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=Z1(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new it(ap(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new it(ap(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:f}=this.frontier[n];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let h=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(YL(m.mark(f.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?h:-1)))}let p=c==a.childCount;p||(h=-1),this.placed=lp(this.placed,n,Fe.from(u)),this.frontier[n].match=d,p&&h<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<h;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?it.empty:new it(ap(o.content,e-1,1),e-1,h<0?o.openEnd:e-1):new it(ap(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!X1(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=X1(e,n,i,r,s);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=X1(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=lp(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=lp(this.placed,this.depth,Fe.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Fe.empty,!0);n.childCount&&(this.placed=lp(this.placed,this.frontier.length,n))}}function ap(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(ap(t.firstChild.content,e-1,n)))}function lp(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(lp(t.lastChild.content,e-1,n)))}function Z1(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function YL(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,YL(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Fe.empty,!0)))),t.copy(r)}function X1(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!Lae(n,s.content,o)?a:null}function Lae(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function Bae(t){return t.spec.defining||t.spec.definingForContent}function Fae(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(QL(i,s,r))return t.step(new xr(e,n,r));let o=e5(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let f=i.depth,h=i.pos-1;f>0;f--,h--){let p=i.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(f)>-1?a=f:i.before(f)==h&&o.splice(1,0,-f)}let l=o.indexOf(a),c=[],u=r.openStart;for(let f=r.content,h=0;;h++){let p=f.firstChild;if(c.push(p),h==r.openStart)break;f=p.content}for(let f=u-1;f>=0;f--){let h=c[f],p=Bae(h.type);if(p&&!h.sameMarkup(i.node(Math.abs(a)-1)))u=f;else if(p||!h.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let h=(f+u+1)%(r.openStart+1),p=c[h];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let b=i.node(g-1),x=i.index(g-1);if(b.canReplaceWith(x,x,p.type,p.marks))return t.replace(i.before(g),y?s.after(g):n,new it(JL(r.content,0,r.openStart,h),h,r.openEnd))}}let d=t.steps.length;for(let f=o.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>d));f--){let h=o[f];h<0||(e=i.before(h),n=s.after(h))}}function JL(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(JL(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(Fe.empty,!0))}return t}function $ae(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=Rae(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new it(Fe.from(r),0,0))}function zae(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=e5(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function e5(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class vf extends gi{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return dr.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return dr.fromReplace(e,this.pos,this.pos+1,new it(Fe.from(i),0,n.isLeaf?0:1))}getMap(){return ls.empty}invert(e){return new vf(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new vf(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new vf(n.pos,n.attr,n.value)}}gi.jsonID("attr",vf);class um extends gi{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return dr.ok(r)}getMap(){return ls.empty}invert(e){return new um(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new um(n.attr,n.value)}}gi.jsonID("docAttr",um);let Vf=class extends Error{};Vf=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Vf.prototype=Object.create(Error.prototype);Vf.prototype.constructor=Vf;Vf.prototype.name="TransformError";class t5{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new cm}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Vf(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=it.empty){let i=yw(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new it(Fe.from(r),0,0))}delete(e,n){return this.replace(e,n,it.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return Fae(this,e,n,r),this}replaceRangeWith(e,n,r){return $ae(this,e,n,r),this}deleteRange(e,n){return zae(this,e,n),this}lift(e,n){return Eae(this,e,n),this}join(e,n=1){return Nae(this,e,n),this}wrap(e,n){return _ae(this,e,n),this}setBlockType(e,n=e,r,i=null){return Aae(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i){return Iae(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new vf(e,n,r)),this}setDocAttribute(e,n){return this.step(new um(e,n)),this}addNodeMark(e,n){return this.step(new mc(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof _n)n.isInSet(r.marks)&&this.step(new ld(e,n));else{let i=r.marks,s,o=[];for(;s=n.isInSet(i);)o.push(new ld(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return Oae(this,e,n,r),this}addMark(e,n,r){return xae(this,e,n,r),this}removeMark(e,n,r){return Sae(this,e,n,r),this}clearIncompatible(e,n,r){return ET(this,e,n,r),this}}const Q1=Object.create(null);class Dt{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new Uae(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=it.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?it.empty:n),a==0&&e3(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),e3(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new Et(e):qd(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?qd(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):qd(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new hs(e.node(0))}static atStart(e){return qd(e,e,0,0,1)||new hs(e)}static atEnd(e){return qd(e,e,e.content.size,e.childCount,-1)||new hs(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Q1[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Q1)throw new RangeError("Duplicate use of selection JSON ID "+e);return Q1[e]=n,n.prototype.jsonID=e,n}getBookmark(){return Et.between(this.$anchor,this.$head).getBookmark()}}Dt.prototype.visible=!0;class Uae{constructor(e,n){this.$from=e,this.$to=n}}let YI=!1;function JI(t){!YI&&!t.parent.inlineContent&&(YI=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class Et extends Dt{constructor(e,n=e){JI(e),JI(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return Dt.near(r);let i=e.resolve(n.map(this.anchor));return new Et(i.parent.inlineContent?i:r,r)}replace(e,n=it.empty){if(super.replace(e,n),n==it.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof Et&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new bw(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Et(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=Dt.findFrom(n,r,!0)||Dt.findFrom(n,-r,!0);if(s)n=s.$head;else return Dt.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(Dt.findFrom(e,-r,!0)||Dt.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new Et(e,n)}}Dt.jsonID("text",Et);class bw{constructor(e,n){this.anchor=e,this.head=n}map(e){return new bw(e.map(this.anchor),e.map(this.head))}resolve(e){return Et.between(e.resolve(this.anchor),e.resolve(this.head))}}class ut extends Dt{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?Dt.near(s):new ut(s)}content(){return new it(Fe.from(this.node),0,0)}eq(e){return e instanceof ut&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new CT(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ut(e.resolve(n.anchor))}static create(e,n){return new ut(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}ut.prototype.visible=!1;Dt.jsonID("node",ut);class CT{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new bw(r,r):new CT(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&ut.isSelectable(r)?new ut(n):Dt.near(n)}}class hs extends Dt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=it.empty){if(n==it.empty){e.delete(0,e.doc.content.size);let r=Dt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new hs(e)}map(e){return new hs(e)}eq(e){return e instanceof hs}getBookmark(){return Hae}}Dt.jsonID("all",hs);const Hae={map(){return this},resolve(t){return new hs(t)}};function qd(t,e,n,r,i,s=!1){if(e.inlineContent)return Et.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&ut.isSelectable(a))return ut.create(t,n-(i<0?a.nodeSize:0))}else{let l=qd(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function e3(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof xr||i instanceof Pr))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(Dt.near(t.doc.resolve(o),n))}const t3=1,Ug=2,n3=4;class Vae extends t5{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|t3)&~Ug,this.storedMarks=null,this}get selectionSet(){return(this.updated&t3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Ug,this}ensureMarks(e){return _n.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ug)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Ug,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||_n.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(Dt.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=n3,this}get scrolledIntoView(){return(this.updated&n3)>0}}function r3(t,e){return!e||!t?t:t.bind(e)}class cp{constructor(e,n,r){this.name=e,this.init=r3(n.init,r),this.apply=r3(n.apply,r)}}const Wae=[new cp("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new cp("selection",{init(t,e){return t.selection||Dt.atStart(e.doc)},apply(t){return t.selection}}),new cp("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new cp("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class Y1{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Wae.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new cp(r.key,r.spec.state,r))})}}class of{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new of(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new Vae(this)}static create(e){let n=new Y1(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new of(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new Y1(this.schema,e.plugins),r=n.fields,i=new of(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new Y1(e.schema,e.plugins),s=new of(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=Tc.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=Dt.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function n5(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=n5(i,e,{})),n[r]=i}return n}class Jt{constructor(e){this.spec=e,this.props={},e.props&&n5(e.props,this,this.props),this.key=e.key?e.key.key:r5("plugin")}getState(e){return e[this.key]}}const J1=Object.create(null);function r5(t){return t in J1?t+"$"+ ++J1[t]:(J1[t]=0,t+"$")}class Sn{constructor(e="key"){this.key=r5(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const _T=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function i5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const s5=(t,e,n)=>{let r=i5(t,n);if(!r)return!1;let i=AT(r);if(!i){let o=r.blockRange(),a=o&&uh(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(p5(t,i,e,-1))return!0;if(r.parent.content.size==0&&(Wf(s,"end")||ut.isSelectable(s)))for(let o=r.depth;;o--){let a=yw(t.doc,r.before(o),r.after(o),it.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Wf(s,"end")?Dt.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):ut.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1},jae=(t,e,n)=>{let r=i5(t,n);if(!r)return!1;let i=AT(r);return i?o5(t,i,e):!1},qae=(t,e,n)=>{let r=l5(t,n);if(!r)return!1;let i=PT(r);return i?o5(t,i,e):!1};function o5(t,e,n){let r=e.nodeBefore,i=r,s=e.pos-1;for(;!i.isTextblock;s--){if(i.type.spec.isolating)return!1;let u=i.lastChild;if(!u)return!1;i=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=yw(t.doc,s,l,it.empty);if(!c||c.from!=s||c instanceof xr&&c.slice.size>=l-s)return!1;if(n){let u=t.tr.step(c);u.setSelection(Et.create(u.doc,s)),n(u.scrollIntoView())}return!0}function Wf(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const a5=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=AT(r)}let o=s&&s.nodeBefore;return!o||!ut.isSelectable(o)?!1:(e&&e(t.tr.setSelection(ut.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function AT(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function l5(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const c5=(t,e,n)=>{let r=l5(t,n);if(!r)return!1;let i=PT(r);if(!i)return!1;let s=i.nodeAfter;if(p5(t,i,e,1))return!0;if(r.parent.content.size==0&&(Wf(s,"start")||ut.isSelectable(s))){let o=yw(t.doc,r.before(),r.after(),it.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Wf(s,"start")?Dt.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):ut.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},u5=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=PT(r)}let o=s&&s.nodeAfter;return!o||!ut.isSelectable(o)?!1:(e&&e(t.tr.setSelection(ut.create(t.doc,s.pos)).scrollIntoView()),!0)};function PT(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const Kae=(t,e)=>{let n=t.selection,r=n instanceof ut,i;if(r){if(n.node.isTextblock||!eu(t.doc,n.from))return!1;i=n.from}else if(i=gw(t.doc,n.from,-1),i==null)return!1;if(e){let s=t.tr.join(i);r&&s.setSelection(ut.create(s.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},Gae=(t,e)=>{let n=t.selection,r;if(n instanceof ut){if(n.node.isTextblock||!eu(t.doc,n.to))return!1;r=n.to}else if(r=gw(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},Zae=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&uh(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},d5=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function IT(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const Xae=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=IT(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(Dt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},f5=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof hs||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=IT(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(Et.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},h5=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(el(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&uh(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function Qae(t){return(e,n)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof ut&&e.selection.node.isBlock)return!r.parentOffset||!el(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let s=[],o,a,l=!1,c=!1;for(let h=r.depth;;h--)if(r.node(h).isBlock){l=r.end(h)==r.pos+(r.depth-h),c=r.start(h)==r.pos-(r.depth-h),a=IT(r.node(h-1).contentMatchAt(r.indexAfter(h-1))),s.unshift(l&&a?{type:a}:null),o=h;break}else{if(h==1)return!1;s.unshift(null)}let u=e.tr;(e.selection instanceof Et||e.selection instanceof hs)&&u.deleteSelection();let d=u.mapping.map(r.pos),f=el(u.doc,d,s.length,s);if(f||(s[0]=a?{type:a}:null,f=el(u.doc,d,s.length,s)),!f)return!1;if(u.split(d,s.length,s),!l&&c&&r.node(o).type!=a){let h=u.mapping.map(r.before(o)),p=u.doc.resolve(h);a&&r.node(o-1).canReplaceWith(p.index(),p.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const Yae=Qae(),Jae=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(ut.create(t.doc,i))),!0)};function ele(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||eu(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function p5(t,e,n,r){let i=e.nodeBefore,s=e.nodeAfter,o,a,l=i.type.spec.isolating||s.type.spec.isolating;if(!l&&ele(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(n){let h=e.pos+s.nodeSize,p=Fe.empty;for(let y=o.length-1;y>=0;y--)p=Fe.from(o[y].create(null,p));p=Fe.from(i.copy(p));let m=t.tr.step(new Pr(e.pos-1,h,e.pos,h,new it(p,1,0),o.length,!0)),g=m.doc.resolve(h+2*o.length);g.nodeAfter&&g.nodeAfter.type==i.type&&eu(m.doc,g.pos)&&m.join(g.pos),n(m.scrollIntoView())}return!0}let u=s.type.spec.isolating||r>0&&l?null:Dt.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),f=d&&uh(d);if(f!=null&&f>=e.depth)return n&&n(t.tr.lift(d,f).scrollIntoView()),!0;if(c&&Wf(s,"start",!0)&&Wf(i,"end")){let h=i,p=[];for(;p.push(h),!h.isTextblock;)h=h.lastChild;let m=s,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(h.canReplace(h.childCount,h.childCount,m.content)){if(n){let y=Fe.empty;for(let x=p.length-1;x>=0;x--)y=Fe.from(p[x].copy(y));let b=t.tr.step(new Pr(e.pos-p.length,e.pos+s.nodeSize,e.pos+g,e.pos+s.nodeSize-g,new it(y,p.length,0),0,!0));n(b.scrollIntoView())}return!0}}return!1}function m5(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(Et.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const tle=m5(-1),nle=m5(1);function rle(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&TT(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function i3(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[s];n.doc.nodesBetween(o,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let u=n.doc.resolve(c),d=u.index();i=u.parent.canReplaceWith(d,d+1,t)}})}if(!i)return!1;if(r){let s=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];s.setBlockType(a,l,t,e)}r(s.scrollIntoView())}return!0}}function OT(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}OT(_T,s5,a5);OT(_T,c5,u5);OT(d5,f5,h5,Yae);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function ile(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s);if(!o)return!1;let a=r?n.tr:null;return sle(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function sle(t,e,n,r=null){let i=!1,s=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);s=new Iy(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Iy(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=TT(s,n,r,e);return a?(t&&ole(t,e,a,i,n),!0):!1}function ole(t,e,n,r,i){let s=Fe.empty;for(let u=n.length-1;u>=0;u--)s=Fe.from(n[u].type.create(n[u].attrs,s));t.step(new Pr(e.start-(r?2:0),e.end,e.start,e.end,new it(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,f=!0;u<d;u++,f=!1)!f&&el(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function ale(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?lle(e,n,t,s):cle(e,n,s):!0:!1}}function lle(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new Pr(s-1,o,s,o,new it(Fe.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Iy(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=uh(r);if(a==null)return!1;i.lift(r,a);let l=i.doc.resolve(i.mapping.map(s,-1)-1);return eu(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function cle(t,e,n){let r=t.tr,i=n.parent;for(let h=n.end,p=n.endIndex-1,m=n.startIndex;p>m;p--)h-=i.child(p).nodeSize,r.delete(h-1,h+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?Fe.empty:Fe.from(i))))return!1;let d=s.pos,f=d+o.nodeSize;return r.step(new Pr(d-(a?1:0),f+(l?1:0),d+1,f-1,new it((a?Fe.empty:Fe.from(i.copy(Fe.empty))).append(l?Fe.empty:Fe.from(i.copy(Fe.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function ule(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=Fe.from(c?t.create():null),d=new it(Fe.from(t.create(null,Fe.from(a.type.create(null,u)))),c?3:1,0),f=s.start,h=s.end;n(e.tr.step(new Pr(f-(c?3:1),h,f,h,d,1,!0)).scrollIntoView())}return!0}}const Kr=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},jf=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let dS=null;const Oa=function(t,e,n){let r=dS||(dS=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},dle=function(){dS=null},cd=function(t,e,n,r){return n&&(s3(t,e,n,r,-1)||s3(t,e,n,r,1))},fle=/^(img|br|input|textarea|hr)$/i;function s3(t,e,n,r,i){for(var s;;){if(t==n&&e==r)return!0;if(e==(i<0?0:Ns(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Qm(t)||fle.test(t.nodeName)||t.contentEditable=="false")return!1;e=Kr(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else t=o,e=i<0?Ns(t):0}else return!1}}function Ns(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function hle(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Ns(t)}else if(t.parentNode&&!Qm(t))e=Kr(t),t=t.parentNode;else return null}}function ple(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Qm(t))e=Kr(t)+1,t=t.parentNode;else return null}}function mle(t,e,n){for(let r=e==0,i=e==Ns(t);r||i;){if(t==n)return!0;let s=Kr(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==Ns(t)}}function Qm(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const ww=function(t){return t.focusNode&&cd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function xu(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function gle(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function yle(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(Ns(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(Ns(r.startContainer),r.startOffset)}}}const ra=typeof navigator<"u"?navigator:null,o3=typeof document<"u"?document:null,tu=ra&&ra.userAgent||"",fS=/Edge\/(\d+)/.exec(tu),g5=/MSIE \d/.exec(tu),hS=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(tu),Xi=!!(g5||hS||fS),_c=g5?document.documentMode:hS?+hS[1]:fS?+fS[1]:0,$s=!Xi&&/gecko\/(\d+)/i.test(tu);$s&&+(/Firefox\/(\d+)/.exec(tu)||[0,0])[1];const pS=!Xi&&/Chrome\/(\d+)/.exec(tu),Cr=!!pS,y5=pS?+pS[1]:0,Jr=!Xi&&!!ra&&/Apple Computer/.test(ra.vendor),qf=Jr&&(/Mobile\/\w+/.test(tu)||!!ra&&ra.maxTouchPoints>2),Ps=qf||(ra?/Mac/.test(ra.platform):!1),b5=ra?/Win/.test(ra.platform):!1,Ga=/Android \d/.test(tu),Ym=!!o3&&"webkitFontSmoothing"in o3.documentElement.style,ble=Ym?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function wle(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function va(t,e){return typeof t=="number"?t:t[e]}function vle(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function a3(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=jf(o);continue}let a=o,l=a==s.body,c=l?wle(s):vle(a),u=0,d=0;if(e.top<c.top+va(r,"top")?d=-(c.top-e.top+va(i,"top")):e.bottom>c.bottom-va(r,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+va(i,"top")-c.top:e.bottom-c.bottom+va(i,"bottom")),e.left<c.left+va(r,"left")?u=-(c.left-e.left+va(i,"left")):e.right>c.right-va(r,"right")&&(u=e.right-c.right+va(i,"right")),u||d)if(l)s.defaultView.scrollBy(u,d);else{let h=a.scrollLeft,p=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let m=a.scrollLeft-h,g=a.scrollTop-p;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}let f=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:jf(o)}}function xle(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:w5(t.dom)}}function w5(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=jf(r));return e}function Sle({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;v5(n,r==0?0:r-e)}function v5(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let Ld=null;function kle(t){if(t.setActive)return t.setActive();if(Ld)return t.focus(Ld);let e=w5(t);t.focus(Ld==null?{get preventScroll(){return Ld={preventScroll:!0},!0}}:void 0),Ld||(Ld=!1,v5(e,0))}function x5(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,d=0;u;u=u.nextSibling,d++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=Oa(u).getClientRects();else continue;for(let h=0;h<f.length;h++){let p=f[h];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<r){n=u,r=m,i=m&&n.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&m&&(s=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(s=d+1)}}return!n&&l&&(n=l,i=c,r=0),n&&n.nodeType==3?Ele(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:x5(n,i)}function Ele(t,e){let n=t.nodeValue.length,r=document.createRange(),i;for(let s=0;s<n;s++){r.setEnd(t,s+1),r.setStart(t,s);let o=Ql(r,1);if(o.top!=o.bottom&&MT(e,o)){i={node:t,offset:s+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),i||{node:t,offset:0}}function MT(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Tle(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function Cle(t,e,n){let{node:r,offset:i}=x5(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function _le(t,e,n,r){let i=-1;for(let s=e,o=!1;s!=t.dom;){let a=t.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?i=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function S5(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(MT(e,c))return S5(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function Ale(t,e){let n=t.dom.ownerDocument,r,i=0,s=yle(n,e.left,e.top);s&&({node:r,offset:i}=s);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!MT(e,c)||(o=S5(t.dom,e,c),!o))return null}if(Jr)for(let c=o;r&&c;c=jf(c))c.draggable&&(r=void 0);if(o=Tle(o,e),r){if($s&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let u=r.childNodes[i],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&i++}let c;Ym&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=_le(t,r,i,e))}a==null&&(a=Cle(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function l3(t){return t.top<t.bottom||t.left<t.right}function Ql(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(l3(r))return r}return Array.prototype.find.call(n,l3)||t.getBoundingClientRect()}const Ple=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function k5(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=Ym||$s;if(r.nodeType==3)if(o&&(Ple.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=Ql(Oa(r,i,i),n);if($s&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=Ql(Oa(r,i-1,i-1),-1);if(c.top==l.top){let u=Ql(Oa(r,i,i+1),-1);if(u.top!=l.top)return Wh(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,Wh(Ql(Oa(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==Ns(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return e2(l.getBoundingClientRect(),!1)}if(s==null&&i<Ns(r)){let l=r.childNodes[i];if(l.nodeType==1)return e2(l.getBoundingClientRect(),!0)}return e2(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==Ns(r))){let l=r.childNodes[i-1],c=l.nodeType==3?Oa(l,Ns(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Wh(Ql(c,1),!1)}if(s==null&&i<Ns(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Oa(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Wh(Ql(c,-1),!0)}return Wh(Ql(r.nodeType==3?Oa(r):r,-n),n>=0)}function Wh(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function e2(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function E5(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function Ile(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return E5(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=k5(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Oa(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const Ole=/[\u0590-\u08ac]/;function Mle(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return a?!Ole.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:E5(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=t.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",n,"character");let h=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:p,focusOffset:m}=t.domSelectionRange(),g=p&&!h.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==m;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return f!=null&&(a.caretBidiLevel=f),g}):r.pos==r.start()||r.pos==r.end()}let c3=null,u3=null,d3=!1;function Nle(t,e,n){return c3==e&&u3==n?d3:(c3=e,u3=n,d3=n=="up"||n=="down"?Ile(t,e,n):Mle(t,e,n))}const zs=0,f3=1,Ou=2,ia=3;class Jm{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=zs,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>Kr(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof C5){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof T5&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?Kr(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?Kr(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let d=a;d>0;d--){let f=this.children[d-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){i=Kr(f.dom)+1;break}e-=f.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=Kr(d.dom);break}n+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let h=0,p=0;h<this.children.length;h++){let m=this.children[h],g=p+m.size;if(s>p&&o<g)return m.setSelection(e-p-m.border,n-p-m.border,r,i);p=g}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),d=!1;if(($s||Jr)&&e==n){let{node:h,offset:p}=a;if(h.nodeType==3){if(d=!!(p&&h.nodeValue[p-1]==`
`),d&&p==h.nodeValue.length)for(let m=h,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:Kr(g)+1});break}let y=m.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let m=h.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if($s&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let h=u.focusNode.childNodes[u.focusOffset];h&&h.contentEditable=="false"&&(i=!0)}if(!(i||d&&Jr)&&cd(a.node,a.offset,u.anchorNode,u.anchorOffset)&&cd(l.node,l.offset,u.focusNode,u.focusOffset))return;let f=!1;if((c.extend||e==n)&&!(d&&$s)){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>n){let p=a;a=l,l=p}let h=document.createRange();h.setEnd(l.node,l.offset),h.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(h)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?Ou:f3,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=ia:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?Ou:ia}r=o}this.dirty=Ou}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Ou:f3;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class T5 extends Jm{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==zs&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class Rle extends Jm{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class ud extends Jm{constructor(e,n,r,i,s){super(e,[],r,i),this.mark=n,this.spec=s}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=bd.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new ud(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&ia||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ia&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=zs){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=zs}}slice(e,n,r){let i=ud.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=gS(s,n,o,r)),e>0&&(s=gS(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Ac extends Jm{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,d=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=bd.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!d&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let f=u;return u=P5(u,r,n),c?l=new Dle(e,n,r,i,u,d||null,f,c,s,o+1):n.isText?new vw(e,n,r,i,u,f,s):new Ac(e,n,r,i,u,d||null,f,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Fe.empty)}return e}matchesNode(e,n,r){return this.dirty==zs&&e.eq(this.node)&&My(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new Ble(this,o&&o.node,e);zle(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e,u):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?_n.none:this.node.child(u).marks,r,e,u),l.placeWidget(c,e,i)},(c,u,d,f)=>{l.syncToMarks(c.marks,r,e,f);let h;l.findNodeMatch(c,u,d,f)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(h=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,d,h,e)||l.updateNextNode(c,u,d,e,f,i)||l.addNode(c,u,d,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e,0),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Ou)&&(o&&this.protectLocalComposition(e,o),_5(this.contentDOM,this.children,e),qf&&Ule(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof Et)||r<n||i>n+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=Hle(this.node.content,o,r-n,i-n);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new Rle(this,s,n,i);e.input.compositionNodes.push(o),this.children=gS(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==ia||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=zs}updateOuterDeco(e){if(My(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=A5(this.dom,this.nodeDOM,mS(this.outerDeco,this.node,n),mS(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function h3(t,e,n,r,i){P5(r,e,t);let s=new Ac(void 0,t,e,n,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class vw extends Ac{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==ia||this.dirty!=zs&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=zs||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=zs,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new vw(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=ia)}get domAtom(){return!1}isText(e){return this.node.text==e}}class C5 extends Jm{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==zs&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class Dle extends Ac{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==ia)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function _5(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=p3(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof ud){let l=r?r.previousSibling:t.lastChild;_5(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=p3(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const Mp=function(t){t&&(this.nodeName=t)};Mp.prototype=Object.create(null);const Mu=[new Mp];function mS(t,e,n){if(t.length==0)return Mu;let r=n?Mu[0]:new Mp,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new Mp(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new Mp(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function A5(t,e,n,r){if(n==Mu&&r==Mu)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Mu[0]),i=l}Lle(i,a||Mu[0],o)}return i}function Lle(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function P5(t,e,n){return A5(t,t,Mu,mS(e,n,t.nodeType!=1))}function My(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function p3(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Ble{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Fle(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r,i){let s=0,o=this.stack.length>>1,a=Math.min(o,e.length);for(;s<a&&(s==o-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<o;)this.destroyRest(),this.top.dirty=zs,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<e.length;){this.stack.push(this.top,this.index+1);let l=-1,c=this.top.children.length;i<this.preMatch.index&&(c=Math.min(this.index+3,c));for(let u=this.index;u<c;u++){let d=this.top.children[u];if(d.matchesMark(e[o])&&!this.isLocked(d.dom)){l=u;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let u=ud.create(this.top,e[o],n,r);this.top.children.splice(this.index,0,u),this.top=u,this.changed=!0}this.index=0,o++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==ia&&o.dom==o.contentDOM&&(o.dirty=Ou),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Ac){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,d,f=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=ia&&My(n,l.outerDeco));if(!f&&l.update(e,n,r,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(d=this.recreateWrapper(l,e,n,r,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=Ou,d.updateChildren(i,o+1),d.dirty=zs),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,i,s,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!My(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=Ac.create(this.top,n,r,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,i,s){let o=Ac.create(this.top,e,n,r,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new T5(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof ud;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof vw)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Jr||Cr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new C5(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function Fle(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof ud)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function $le(t,e){return t.type.side-e.type.side}function zle(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<i.length&&i[o].to==s;){let g=i[o++];g.widget&&(u?(d||(d=[u])).push(g):u=g)}if(u)if(d){d.sort($le);for(let g=0;g<d.length;g++)n(d[g],c,!!l)}else n(u,c,!!l);let f,h;if(l)h=-1,f=l,l=null;else if(c<t.childCount)h=c,f=t.child(c++);else break;for(let g=0;g<a.length;g++)a[g].to<=s&&a.splice(g--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+f.nodeSize;if(f.isText){let g=p;o<i.length&&i[o].from<g&&(g=i[o].from);for(let y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<p&&(l=f.cut(g-s),f=f.cut(0,g-s),p=g,h=-1)}else for(;o<i.length&&i[o].to<p;)o++;let m=f.isInline&&!f.isLeaf?a.filter(g=>!g.inline):a.slice();r(f,m,e.forChild(s,f),h),s=p}}function Ule(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Hle(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function gS(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function NT(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(ww(n)){for(l=o;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&ut.isSelectable(d)&&i.parent&&!(d.isInline&&mle(n.focusNode,n.focusOffset,i.dom))){let f=i.posBefore;c=new ut(o==f?a:r.resolve(f))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let d=o,f=o;for(let h=0;h<n.rangeCount;h++){let p=n.getRangeAt(h);d=Math.min(d,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=f==t.state.selection.anchor?[f,d]:[d,f],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let d=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=RT(t,u,a,d)}return c}function I5(t){return t.editable?t.hasFocus():M5(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function tl(t,e=!1){let n=t.state.selection;if(O5(t,n),!!I5(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Cr){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&cd(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)Wle(t);else{let{anchor:r,head:i}=n,s,o;m3&&!(n instanceof Et)&&(n.$from.parent.inlineContent||(s=g3(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=g3(t,n.to))),t.docView.setSelection(r,i,t,e),m3&&(s&&y3(s),o&&y3(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Vle(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const m3=Jr||Cr&&y5<63;function g3(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(Jr&&i&&i.contentEditable=="false")return t2(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return t2(i);if(s)return t2(s)}}function t2(t){return t.contentEditable="true",Jr&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function y3(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Vle(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!I5(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function Wle(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,Kr(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Xi&&_c<=11&&(n.disabled=!0,n.disabled=!1)}function O5(t,e){if(e instanceof ut){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(b3(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else b3(t)}function b3(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function RT(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||Et.between(e,n,r)}function w3(t){return t.editable&&!t.hasFocus()?!1:M5(t)}function M5(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function jle(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return cd(e.node,e.offset,n.anchorNode,n.anchorOffset)}function yS(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&Dt.findFrom(s,e)}function Jl(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function v3(t,e,n){let r=t.state.selection;if(r instanceof Et)if(n.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return Jl(t,new Et(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=yS(t.state,e);return i&&i instanceof ut?Jl(t,i):!1}else if(!(Ps&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?ut.isSelectable(s)?Jl(t,new ut(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):Ym?Jl(t,new Et(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof ut&&r.node.isInline)return Jl(t,new Et(e>0?r.$to:r.$from));{let i=yS(t.state,e);return i?Jl(t,i):!1}}}function Ny(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Np(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Bd(t,e){return e<0?qle(t):Kle(t)}function qle(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for($s&&n.nodeType==1&&r<Ny(n)&&Np(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Np(a,-1))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(N5(n))break;{let a=n.previousSibling;for(;a&&Np(a,-1);)i=n.parentNode,s=Kr(a),a=a.previousSibling;if(a)n=a,r=Ny(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?bS(t,n,r):i&&bS(t,i,s)}function Kle(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=Ny(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Np(a,1))s=n,o=++r;else break}else{if(N5(n))break;{let a=n.nextSibling;for(;a&&Np(a,1);)s=a.parentNode,o=Kr(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=Ny(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&bS(t,s,o)}function N5(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Gle(t,e){for(;t&&e==t.childNodes.length&&!Qm(t);)e=Kr(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function Zle(t,e){for(;t&&!e&&!Qm(t);)e=Kr(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function bS(t,e,n){if(e.nodeType!=3){let s,o;(o=Gle(e,n))?(e=o,n=0):(s=Zle(e,n))&&(e=s,n=s.nodeValue.length)}let r=t.domSelection();if(!r)return;if(ww(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&tl(t)},50)}function x3(t,e){let n=t.state.doc.resolve(e);if(!(Cr||b5)&&n.parent.inlineContent){let i=t.coordsAtPos(e);if(e>n.start()){let s=t.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<n.end()){let s=t.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function S3(t,e,n){let r=t.state.selection;if(r instanceof Et&&!r.empty||n.indexOf("s")>-1||Ps&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=yS(t.state,e);if(o&&o instanceof ut)return Jl(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof hs?Dt.near(o,e):Dt.findFrom(o,e);return a?Jl(t,a):!1}return!1}function k3(t,e){if(!(t.state.selection instanceof Et))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function E3(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function Xle(t){if(!Jr||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;E3(t,r,"true"),setTimeout(()=>E3(t,r,"false"),20)}return!1}function Qle(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function Yle(t,e){let n=e.keyCode,r=Qle(e);if(n==8||Ps&&n==72&&r=="c")return k3(t,-1)||Bd(t,-1);if(n==46&&!e.shiftKey||Ps&&n==68&&r=="c")return k3(t,1)||Bd(t,1);if(n==13||n==27)return!0;if(n==37||Ps&&n==66&&r=="c"){let i=n==37?x3(t,t.state.selection.from)=="ltr"?-1:1:-1;return v3(t,i,r)||Bd(t,i)}else if(n==39||Ps&&n==70&&r=="c"){let i=n==39?x3(t,t.state.selection.from)=="ltr"?1:-1:1;return v3(t,i,r)||Bd(t,i)}else{if(n==38||Ps&&n==80&&r=="c")return S3(t,-1,r)||Bd(t,-1);if(n==40||Ps&&n==78&&r=="c")return Xle(t)||S3(t,1,r)||Bd(t,1);if(r==(Ps?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function DT(t,e){t.someProp("transformCopied",h=>{e=h(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let h=r.firstChild;n.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let o=t.someProp("clipboardSerializer")||bd.fromSchema(t.state.schema),a=$5(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=F5[c.nodeName.toLowerCase()]);){for(let h=u.length-1;h>=0;h--){let p=a.createElement(u[h]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",h=>h(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:f,slice:e}}function R5(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",f=>{e=f(e,s||r,t)}),s)return a=new it(Fe.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{a=f(a,t,!0)}),a;let d=t.someProp("clipboardTextParser",f=>f(e,i,r,t));if(d)a=d;else{let f=i.marks(),{schema:h}=t.state,p=bd.fromSchema(h);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(h.text(m,f)))})}}else t.someProp("transformPastedHTML",d=>{n=d(n,t)}),o=nce(n),Ym&&rce(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||Cc.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!Jle.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)a=ice(T3(a,+u[1],+u[2]),u[4]);else if(a=it.maxOpen(ece(a.content,i),!0),a.openStart||a.openEnd){let d=0,f=0;for(let h=a.content.firstChild;d<a.openStart&&!h.type.spec.isolating;d++,h=h.firstChild);for(let h=a.content.lastChild;f<a.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);a=T3(a,d,f)}return t.someProp("transformPasted",d=>{a=d(a,t,l)}),a}const Jle=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function ece(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&L5(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=B5(o[o.length-1],s.length));let u=D5(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return Fe.from(o)}return t}function D5(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Fe.from(t));return t}function L5(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=L5(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(Fe.from(D5(n,t,i+1))))}}function B5(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,B5(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Fe.empty,!0);return t.copy(n.append(r))}function wS(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),i<r-1&&(a=wS(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Fe.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function T3(t,e,n){return e<t.openStart&&(t=new it(wS(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new it(wS(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const F5={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let C3=null;function $5(){return C3||(C3=document.implementation.createHTMLDocument("title"))}let n2=null;function tce(t){let e=window.trustedTypes;return e?(n2||(n2=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),n2.createHTML(t)):t}function nce(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=$5().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&F5[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=tce(t),i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function rce(t){let e=t.querySelectorAll(Cr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent=="Â "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function ice(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=Fe.from(l.create(r[a+1],i)),s++,o++}return new it(i,s,o)}const Ii={},Oi={},sce={touchstart:!0,touchmove:!0};class oce{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function ace(t){for(let e in Ii){let n=Ii[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{cce(t,r)&&!LT(t,r)&&(t.editable||!(r.type in Oi))&&n(t,r)},sce[e]?{passive:!0}:void 0)}Jr&&t.dom.addEventListener("input",()=>null),vS(t)}function gc(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function lce(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function vS(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>LT(t,r))})}function LT(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function cce(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function uce(t,e){!LT(t,e)&&Ii[e.type]&&(t.editable||!(e.type in Oi))&&Ii[e.type](t,e)}Oi.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!U5(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Ga&&Cr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),qf&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,xu(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||Yle(t,n)?n.preventDefault():gc(t,"key")};Oi.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Oi.keypress=(t,e)=>{let n=e;if(U5(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ps&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof Et)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode),s=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,i,s))&&t.dispatch(s()),n.preventDefault()}};function xw(t){return{left:t.clientX,top:t.clientY}}function dce(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function BT(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function xf(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function fce(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&ut.isSelectable(r)?(xf(t,new ut(n)),!0):!1}function hce(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof ut&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(ut.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(xf(t,ut.create(t.state.doc,i)),!0):!1}function pce(t,e,n,r,i){return BT(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?hce(t,n):fce(t,n))}function mce(t,e,n,r){return BT(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function gce(t,e,n,r){return BT(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||yce(t,n,r)}function yce(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(xf(t,Et.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)xf(t,Et.create(r,a+1,a+1+o.content.size));else if(ut.isSelectable(o))xf(t,ut.create(r,a));else continue;return!0}}function FT(t){return Ry(t)}const z5=Ps?"metaKey":"ctrlKey";Ii.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=FT(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&dce(n,t.input.lastClick)&&!n[z5]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s,button:n.button};let o=t.posAtCoords(xw(n));o&&(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new bce(t,o,n,!!r)):(s=="doubleClick"?mce:gce)(t,o.pos,o.inside,n)?n.preventDefault():gc(t,"pointer"))};class bce{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[z5],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof ut&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&$s&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),gc(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>tl(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(xw(e))),this.updateAllowDefault(e),this.allowDefault||!n?gc(this.view,"pointer"):pce(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Jr&&this.mightDrag&&!this.mightDrag.node.isAtom||Cr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(xf(this.view,Dt.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):gc(this.view,"pointer")}move(e){this.updateAllowDefault(e),gc(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ii.touchstart=t=>{t.input.lastTouch=Date.now(),FT(t),gc(t,"pointer")};Ii.touchmove=t=>{t.input.lastTouch=Date.now(),gc(t,"pointer")};Ii.contextmenu=t=>FT(t);function U5(t,e){return t.composing?!0:Jr&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const wce=Ga?5e3:-1;Oi.compositionstart=Oi.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof Et&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||Cr&&b5&&vce(t)))t.markCursor=t.state.storedMarks||n.marks(),Ry(t,!0),t.markCursor=null;else if(Ry(t,!e.selection.empty),$s&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}H5(t,wce)};function vce(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Oi.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,H5(t,20))};function H5(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Ry(t),e))}function V5(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=Sce());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function xce(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=hle(e.focusNode,e.focusOffset),r=ple(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let i=r.pmViewDesc,s=t.domObserver.lastChangedTextNode;if(n==s||r==s)return s;if(!i||!i.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function Sce(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Ry(t,e=!1){if(!(Ga&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),V5(t),e||t.docView&&t.docView.dirty){let n=NT(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function kce(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const dm=Xi&&_c<15||qf&&ble<604;Ii.copy=Oi.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=dm?null:n.clipboardData,o=r.content(),{dom:a,text:l}=DT(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):kce(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Ece(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function Tce(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?fm(t,r.value,null,i,e):fm(t,r.textContent,r.innerHTML,i,e)},50)}function fm(t,e,n,r,i){let s=R5(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,s||it.empty)))return!0;if(!s)return!1;let o=Ece(s),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function W5(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Oi.paste=(t,e)=>{let n=e;if(t.composing&&!Ga)return;let r=dm?null:n.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&fm(t,W5(r),r.getData("text/html"),i,n)?n.preventDefault():Tce(t,n)};class j5{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const Cce=Ps?"altKey":"ctrlKey";function q5(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[Cce]}Ii.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(xw(n)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof ut?i.to-1:i.to))){if(r&&r.mightDrag)o=ut.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let d=t.docView.nearestDesc(n.target,!0);d&&d.node.type.spec.draggable&&d!=t.docView&&(o=ut.create(t.state.doc,d.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=DT(t,a);(!n.dataTransfer.files.length||!Cr||y5>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(dm?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",dm||n.dataTransfer.setData("text/plain",c),t.dragging=new j5(u,q5(t,n),o)};Ii.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Oi.dragover=Oi.dragenter=(t,e)=>e.preventDefault();Oi.drop=(t,e)=>{try{_ce(t,e,t.dragging)}finally{t.dragging=null}};function _ce(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(xw(e));if(!r)return;let i=t.state.doc.resolve(r.pos),s=n&&n.slice;s?t.someProp("transformPasted",h=>{s=h(s,t,!1)}):s=R5(t,W5(e.dataTransfer),dm?null:e.dataTransfer.getData("text/html"),!1,i);let o=!!(n&&q5(t,e));if(t.someProp("handleDrop",h=>h(t,e,s||it.empty,o))){e.preventDefault();return}if(!s)return;e.preventDefault();let a=s?XL(t.state.doc,i.pos,s):i.pos;a==null&&(a=i.pos);let l=t.state.tr;if(o){let{node:h}=n;h?h.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,d=l.doc;if(u?l.replaceRangeWith(c,c,s.content.firstChild):l.replaceRange(c,c,s),l.doc.eq(d))return;let f=l.doc.resolve(c);if(u&&ut.isSelectable(s.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(s.content.firstChild))l.setSelection(new ut(f));else{let h=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((p,m,g,y)=>h=y),l.setSelection(RT(t,f,l.doc.resolve(h)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Ii.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&tl(t)},20))};Ii.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ii.beforeinput=(t,e)=>{if(Cr&&Ga&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,xu(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Oi)Ii[t]=Oi[t];function hm(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Dy{constructor(e,n){this.toDOM=e,this.spec=n||ju,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new mr(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Dy&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&hm(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Pc{constructor(e,n){this.attrs=e,this.spec=n||ju}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new mr(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Pc&&hm(this.attrs,e.attrs)&&hm(this.spec,e.spec)}static is(e){return e.type instanceof Pc}destroy(){}}class $T{constructor(e,n){this.attrs=e,this.spec=n||ju}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new mr(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof $T&&hm(this.attrs,e.attrs)&&hm(this.spec,e.spec)}destroy(){}}class mr{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new mr(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new mr(e,e,new Dy(n,r))}static inline(e,n,r,i){return new mr(e,n,new Pc(r,i))}static node(e,n,r,i){return new mr(e,n,new $T(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Pc}get widget(){return this.type instanceof Dy}}const Kd=[],ju={};class wn{constructor(e,n){this.local=e.length?e:Kd,this.children=n.length?n:Kd}static create(e,n){return n.length?Ly(n,e,0,ju):oi}find(e,n,r){let i=[];return this.findInner(e??0,n??1e9,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==oi||e.maps.length==0?this:this.mapInner(e,n,0,0,r||ju)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?Ace(this.children,o||[],e,n,r,i,s):o?new wn(o.sort(qu),Kd):oi}add(e,n){return n.length?this==oi?wn.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(u=G5(n,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,Ly(u,a,c+1,ju)),s+=3}});let o=K5(s?Z5(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new wn(o.length?this.local.concat(o).sort(qu):this.local,i||this.children)}remove(e){return e.length==0||this==oi?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=oi?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new wn(i,r):oi}forChild(e,n){if(this==oi)return this;if(n.isLeaf)return wn.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof Pc){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new wn(i.sort(qu),Kd);return r?new sc([a,r]):a}return r||oi}eq(e){if(this==e)return!0;if(!(e instanceof wn)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return zT(this.localsInner(e))}localsInner(e){if(this==oi)return Kd;if(e.inlineContent||!this.local.some(Pc.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Pc||n.push(this.local[r]);return n}forEachSet(e){e(this)}}wn.empty=new wn([],[]);wn.removeOverlap=zT;const oi=wn.empty;class sc{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,ju));return sc.from(r)}forChild(e,n){if(n.isLeaf)return wn.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=oi&&(s instanceof sc?r=r.concat(s.members):r.push(s))}return sc.from(r)}eq(e){if(!(e instanceof sc)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?zT(r?n:n.sort(qu)):Kd}static from(e){switch(e.length){case 0:return oi;case 1:return e[0];default:return new sc(e.every(n=>n instanceof wn)?e:e.reduce((n,r)=>n.concat(r instanceof wn?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function Ace(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let d=0;n.maps[c].forEach((f,h,p,m)=>{let g=m-p-(h-f);for(let y=0;y<a.length;y+=3){let b=a[y+1];if(b<0||f>b+u-d)continue;let x=a[y]+u-d;h>=x?a[y+1]=f<=x?-2:-1:f>=u&&g&&(a[y]+=g,a[y+1]+=g)}d+=g}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),d=u-i;if(d<0||d>=r.content.size){l=!0;continue}let f=n.map(t[c+1]+s,-1),h=f-i,{index:p,offset:m}=r.content.findIndex(d),g=r.maybeChild(p);if(g&&m==d&&m+g.nodeSize==h){let y=a[c+2].mapInner(n,g,u+1,t[c]+s+1,o);y!=oi?(a[c]=d,a[c+1]=h,a[c+2]=y):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=Pce(a,t,e,n,i,s,o),u=Ly(c,r,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,f=0;d<u.children.length;d+=3){let h=u.children[d];for(;f<a.length&&a[f]<h;)f+=3;a.splice(f,0,u.children[d],u.children[d+1],u.children[d+2])}}return new wn(e.sort(qu),a)}function K5(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new mr(i.from+e,i.to+e,i.type))}return n}function Pce(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(r,i,c);d?n.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function G5(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function Z5(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Ly(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=G5(t,a,l+n);if(c){s=!0;let u=Ly(c,a,n+l+1,r);u!=oi&&i.push(l,l+a.nodeSize,u)}});let o=K5(s?Z5(t):t,-n).sort(qu);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new wn(o,i):oi}function qu(t,e){return t.from-e.from||t.to-e.to}function zT(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),_3(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),_3(e,i,r.copy(s.from,r.to)));break}}}return e}function _3(t,e,n){for(;e<t.length&&qu(n,t[e])>0;)e++;t.splice(e,0,n)}function r2(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=oi&&e.push(r)}),t.cursorWrapper&&e.push(wn.create(t.state.doc,[t.cursorWrapper.deco])),sc.from(e)}const Ice={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Oce=Xi&&_c<=11;class Mce{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Nce{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Mce,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);Xi&&_c<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():Jr&&e.composing&&r.some(i=>i.type=="childList"&&i.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),Oce&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Ice)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(w3(this.view)){if(this.suppressingSelectionUpdates)return tl(this.view);if(Xi&&_c<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&cd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=jf(s))n.add(s);for(let s=e.anchorNode;s;s=jf(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&w3(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let d=this.registerMutation(n[u],l);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if($s&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,f]=u;d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let f of u){let h=f.parentNode;h&&h.nodeName=="LI"&&(!d||Lce(e,d)!=h)&&f.remove()}}}else if((Cr||Jr)&&l.some(u=>u.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let u of l)if(u.nodeName=="BR"&&u.parentNode){let d=u.nextSibling;d&&d.nodeType==1&&d.contentEditable=="false"&&u.parentNode.removeChild(u)}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&ww(r)&&(c=NT(e))&&c.eq(Dt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,tl(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),Rce(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,Bce(e,l)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||tl(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];n.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(Xi&&_c<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:f}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f)}let o=i&&i.parentNode==e.target?Kr(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?Kr(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let A3=new WeakMap,P3=!1;function Rce(t){if(!A3.has(t)&&(A3.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=$s,P3)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),P3=!0}}function I3(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return cd(o.node,o.offset,i,s)&&([n,r,i,s]=[i,s,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}}function Dce(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return I3(t,i)}let n;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?I3(t,n):null}function Lce(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function Bce(t,e){var n;let{focusNode:r,focusOffset:i}=t.domSelectionRange();for(let s of e)if(((n=s.parentNode)===null||n===void 0?void 0:n.nodeName)=="TR"){let o=s.nextSibling;for(;o&&o.nodeName!="TD"&&o.nodeName!="TH";)o=o.nextSibling;if(o){let a=o;for(;;){let l=a.firstChild;if(!l||l.nodeType!=1||l.contentEditable=="false"||/^(BR|IMG)$/.test(l.nodeName))break;a=l}a.insertBefore(s,a.firstChild),r==s&&t.domSelection().collapse(s,i)}else s.parentNode.removeChild(s)}}function Fce(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],ww(l)||c.push({node:l.focusNode,offset:l.focusOffset})),Cr&&t.input.lastKeyCode===8)for(let g=s;g>i;g--){let y=r.childNodes[g-1],b=y.pmViewDesc;if(y.nodeName=="BR"&&!b){s=g;break}if(!b||b.size)break}let d=t.state.doc,f=t.someProp("domParser")||Cc.fromSchema(t.state.schema),h=d.resolve(o),p=null,m=f.parse(r,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:i,to:s,preserveWhitespace:h.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:$ce,context:h});if(c&&c[0].pos!=null){let g=c[0].pos,y=c[1]&&c[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:m,sel:p,from:o,to:a}}function $ce(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Jr&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Jr&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const zce=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Uce(t,e,n,r,i){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let _=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,k=NT(t,_);if(k&&!t.state.selection.eq(k)){if(Cr&&Ga&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",O=>O(t,xu(13,"Enter"))))return;let T=t.state.tr.setSelection(k);_=="pointer"?T.setMeta("pointer",!0):_=="key"&&T.scrollIntoView(),s&&T.setMeta("composition",s),t.dispatch(T)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=Fce(t,e,n),u=t.state.doc,d=u.slice(c.from,c.to),f,h;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,h="end"):(f=t.state.selection.from,h="start"),t.input.lastKeyCode=null;let p=Wce(d.content,c.doc.content,c.from,f,h);if(p&&t.input.domChangeCount++,(qf&&t.input.lastIOSEnter>Date.now()-225||Ga)&&i.some(_=>_.nodeType==1&&!zce.test(_.nodeName))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",_=>_(t,xu(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!p)if(r&&l instanceof Et&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let _=O3(t,t.state.doc,c.sel);if(_&&!_.eq(t.state.selection)){let k=t.state.tr.setSelection(_);s&&k.setMeta("composition",s),t.dispatch(k)}}return}t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof Et&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),Xi&&_c<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" Â "&&(p.start--,p.endA--,p.endB--);let m=c.doc.resolveNoCache(p.start-c.from),g=c.doc.resolveNoCache(p.endB-c.from),y=u.resolve(p.start),b=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=p.endA;if((qf&&t.input.lastIOSEnter>Date.now()-225&&(!b||i.some(_=>_.nodeName=="DIV"||_.nodeName=="P"))||!b&&m.pos<c.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&m.pos<g.pos&&!/\S/.test(c.doc.textBetween(m.pos,g.pos,"","")))&&t.someProp("handleKeyDown",_=>_(t,xu(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>p.start&&Vce(u,p.start,p.endA,m,g)&&t.someProp("handleKeyDown",_=>_(t,xu(8,"Backspace")))){Ga&&Cr&&t.domObserver.suppressSelectionUpdates();return}Cr&&p.endB==p.start&&(t.input.lastChromeDelete=Date.now()),Ga&&!b&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,g=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(_){return _(t,xu(13,"Enter"))})},20));let x=p.start,C=p.endA,P=_=>{let k=_||t.state.tr.replace(x,C,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let T=O3(t,k.doc,c.sel);T&&!(Cr&&t.composing&&T.empty&&(p.start!=p.endB||t.input.lastChromeDelete<Date.now()-100)&&(T.head==x||T.head==k.mapping.map(C)-1)||Xi&&T.empty&&T.head==x)&&k.setSelection(T)}return s&&k.setMeta("composition",s),k.scrollIntoView()},S;if(b)if(m.pos==g.pos){Xi&&_c<=11&&m.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>tl(t),20));let _=P(t.state.tr.delete(x,C)),k=u.resolve(p.start).marksAcross(u.resolve(p.endA));k&&_.ensureMarks(k),t.dispatch(_)}else if(p.endA==p.endB&&(S=Hce(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start())))){let _=P(t.state.tr);S.type=="add"?_.addMark(x,C,S.mark):_.removeMark(x,C,S.mark),t.dispatch(_)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let _=m.parent.textBetween(m.parentOffset,g.parentOffset),k=()=>P(t.state.tr.insertText(_,x,C));t.someProp("handleTextInput",T=>T(t,x,C,_,k))||t.dispatch(k())}else t.dispatch(P());else t.dispatch(P())}function O3(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:RT(t,e.resolve(n.anchor),e.resolve(n.head))}function Hce(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(Fe.from(c).eq(t))return{mark:a,type:o}}function Vce(t,e,n,r,i){if(n-e<=i.pos-r.pos||i2(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(!r.parent.isTextblock){let a=s.nodeAfter;return a!=null&&n==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(i2(s,!0,!0));return!o.parent.isTextblock||o.pos>n||i2(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function i2(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function Wce(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}if(o<s&&t.size<e.size){let l=r<=s&&r>=o?s-r:0;s-=l,s&&s<e.size&&M3(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=r<=s&&r>=a?s-r:0;s-=l,s&&s<t.size&&M3(t.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function M3(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class X5{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new oce,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(B3),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=D3(this),R3(this),this.nodeViews=L3(this),this.docView=h3(this.state.doc,N3(this),r2(this),this.dom,this),this.domObserver=new Nce(this,(r,i,s,o)=>Uce(this,r,i,s,o)),this.domObserver.start(),ace(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&vS(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(B3),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(V5(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let h=L3(this);qce(h,this.nodeViews)&&(this.nodeViews=h,s=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&vS(this),this.editable=D3(this),R3(this);let l=r2(this),c=N3(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(i.selection))&&(o=!0);let f=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&xle(this);if(o){this.domObserver.stop();let h=d&&(Xi||Cr)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&jce(i.selection,e.selection);if(d){let p=Cr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=xce(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=h3(e.doc,c,l,this.dom,this)),p&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(h=!0)}h||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&jle(this))?tl(this,h):(O5(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&Sle(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof ut){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&a3(this,n.getBoundingClientRect(),e)}else a3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let s=r.from+(this.state.doc.content.size-n.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==r.node&&(i=s)}this.dragging=new j5(e.slice,e.move,i<0?void 0:ut.create(this.state.doc,i))}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(Xi){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&kle(this.dom),tl(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Ale(this,e)}coordsAtPos(e,n=1){return k5(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return Nle(this,n||this.state,e)}pasteHTML(e,n){return fm(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return fm(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return DT(this,e)}destroy(){this.docView&&(lce(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],r2(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,dle())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return uce(this,e)}domSelectionRange(){let e=this.domSelection();return e?Jr&&this.root.nodeType===11&&gle(this.dom.ownerDocument)==this.dom&&Dce(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}X5.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function N3(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[mr.node(0,t.state.doc.content.size,e)]}function R3(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:mr.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function D3(t){return!t.someProp("editable",e=>e(t.state)===!1)}function jce(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function L3(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function qce(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function B3(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Hc={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},By={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Kce=typeof navigator<"u"&&/Mac/.test(navigator.platform),Gce=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Gr=0;Gr<10;Gr++)Hc[48+Gr]=Hc[96+Gr]=String(Gr);for(var Gr=1;Gr<=24;Gr++)Hc[Gr+111]="F"+Gr;for(var Gr=65;Gr<=90;Gr++)Hc[Gr]=String.fromCharCode(Gr+32),By[Gr]=String.fromCharCode(Gr);for(var s2 in Hc)By.hasOwnProperty(s2)||(By[s2]=Hc[s2]);function Zce(t){var e=Kce&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||Gce&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?By:Hc)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const Xce=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Qce=typeof navigator<"u"&&/Win/.test(navigator.platform);function Yce(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))Xce?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function Jce(t){let e=Object.create(null);for(let n in t)e[Yce(n)]=t[n];return e}function o2(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function eue(t){return new Jt({props:{handleKeyDown:Q5(t)}})}function Q5(t){let e=Jce(t);return function(n,r){let i=Zce(r),s,o=e[o2(i,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[o2(i,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(Qce&&r.ctrlKey&&r.altKey)&&(s=Hc[r.keyCode])&&s!=i){let a=e[o2(s,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}var tue=Object.defineProperty,UT=(t,e)=>{for(var n in e)tue(t,n,{get:e[n],enumerable:!0})};function Sw(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}var kw=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:i}=n,s=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([o,a])=>[o,(...c)=>{const u=a(...c)(s);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(i),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o=[],a=!!t,l=t||i.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(l),o.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(n).map(([d,f])=>[d,(...p)=>{const m=this.buildProps(l,e),g=f(...p)(m);return o.push(g),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,r=!1,i=t||n.tr,s=this.buildProps(i,r);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...s,dispatch:void 0})])),chain:()=>this.createChain(i,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o={tr:t,editor:r,view:s,state:Sw({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},Y5={};UT(Y5,{blur:()=>nue,clearContent:()=>rue,clearNodes:()=>iue,command:()=>sue,createParagraphNear:()=>oue,cut:()=>aue,deleteCurrentNode:()=>lue,deleteNode:()=>cue,deleteRange:()=>uue,deleteSelection:()=>due,enter:()=>fue,exitCode:()=>hue,extendMarkRange:()=>pue,first:()=>mue,focus:()=>yue,forEach:()=>bue,insertContent:()=>wue,insertContentAt:()=>Sue,joinBackward:()=>Tue,joinDown:()=>Eue,joinForward:()=>Cue,joinItemBackward:()=>_ue,joinItemForward:()=>Aue,joinTextblockBackward:()=>Pue,joinTextblockForward:()=>Iue,joinUp:()=>kue,keyboardShortcut:()=>Mue,lift:()=>Nue,liftEmptyBlock:()=>Rue,liftListItem:()=>Due,newlineInCode:()=>Lue,resetAttributes:()=>Bue,scrollIntoView:()=>Fue,selectAll:()=>$ue,selectNodeBackward:()=>zue,selectNodeForward:()=>Uue,selectParentNode:()=>Hue,selectTextblockEnd:()=>Vue,selectTextblockStart:()=>Wue,setContent:()=>jue,setMark:()=>dde,setMeta:()=>fde,setNode:()=>hde,setNodeSelection:()=>pde,setTextDirection:()=>mde,setTextSelection:()=>gde,sinkListItem:()=>yde,splitBlock:()=>bde,splitListItem:()=>wde,toggleList:()=>vde,toggleMark:()=>xde,toggleNode:()=>Sde,toggleWrap:()=>kde,undoInputRule:()=>Ede,unsetAllMarks:()=>Tde,unsetMark:()=>Cde,unsetTextDirection:()=>_de,updateAttributes:()=>Ade,wrapIn:()=>Pde,wrapInList:()=>Ide});var nue=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())==null||n.removeAllRanges())}),!0),rue=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),iue=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),f=c.resolve(u.map(l+a.nodeSize)),h=d.blockRange(f);if(!h)return;const p=uh(h);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(h.start,m)}(p||p===0)&&e.lift(h,p)})}),!0},sue=t=>e=>t(e),oue=()=>({state:t,dispatch:e})=>f5(t,e),aue=(t,e)=>({editor:n,tr:r})=>{const{state:i}=n,s=i.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,s.content),r.setSelection(new Et(r.doc.resolve(Math.max(o-1,0)))),!0},lue=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===r.type){if(e){const a=i.before(s),l=i.after(s);t.delete(a,l).scrollIntoView()}return!0}return!1};function fr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var cue=t=>({tr:e,state:n,dispatch:r})=>{const i=fr(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},uue=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},due=()=>({state:t,dispatch:e})=>_T(t,e),fue=()=>({commands:t})=>t.keyboardShortcut("Enter"),hue=()=>({state:t,dispatch:e})=>Xae(t,e);function HT(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Fy(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:HT(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function J5(t,e,n={}){return t.find(r=>r.type===e&&Fy(Object.fromEntries(Object.keys(n).map(i=>[i,r.attrs[i]])),n))}function F3(t,e,n={}){return!!J5(t,e,n)}function VT(t,e,n){var r;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(n=n||((r=i.node.marks[0])==null?void 0:r.attrs),!J5([...i.node.marks],e,n)))return;let o=i.index,a=t.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&F3([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&F3([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Sl(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var pue=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=Sl(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const d=VT(l,s,e);if(d&&d.from<=c&&d.to>=u){const f=Et.create(o,d.from,d.to);n.setSelection(f)}}return!0},mue=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function e6(t){return t instanceof Et}function Nu(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function t6(t,e=null){if(!e)return null;const n=Dt.atStart(t),r=Dt.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?Et.create(t,Nu(0,i,s),Nu(t.content.size,i,s)):Et.create(t,Nu(e,i,s),Nu(e,i,s))}function xS(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function pm(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function gue(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var yue=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(pm()||xS())&&r.dom.focus(),gue()&&!pm()&&!xS()&&r.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};try{if(r.hasFocus()&&t===null||t===!1)return!0}catch{return!1}if(s&&t===null&&!e6(n.state.selection))return o(),!0;const a=t6(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},bue=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),wue=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),n6=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&n6(r)}return t};function Hg(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return n6(n)}function mm(t,e,n){if(t instanceof Tc||t instanceof Fe)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,i=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return Fe.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(s){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),mm("",e,n)}if(i){if(n.errorOnInvalidContent){let o=!1,a="";const l=new $L({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?Cc.fromSchema(l).parseSlice(Hg(t),n.parseOptions):Cc.fromSchema(l).parse(Hg(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=Cc.fromSchema(e);return n.slice?s.parseSlice(Hg(t),n.parseOptions).content:s.parse(Hg(t),n.parseOptions)}return mm("",e,n)}function vue(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof xr||i instanceof Pr))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(Dt.near(t.doc.resolve(o),n))}var xue=t=>!("type"in t),Sue=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{var o;if(i){n={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{mm(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=mm(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,h=!0;if((xue(a)?a:[a]).forEach(g=>{g.check(),f=f?g.isText&&g.marks.length===0:!1,h=h?g.isBlock:!1}),u===d&&h){const{parent:g}=r.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(f){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Fe){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;r.insertText(m,u,d)}else{m=a;const g=r.doc.resolve(u),y=g.node(),b=g.parentOffset===0,x=y.isText||y.isTextblock,C=y.content.size>0;b&&x&&C&&(u=Math.max(0,u-1)),r.replaceWith(u,d,m)}n.updateSelection&&vue(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:m}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:m})}return!0},kue=()=>({state:t,dispatch:e})=>Kae(t,e),Eue=()=>({state:t,dispatch:e})=>Gae(t,e),Tue=()=>({state:t,dispatch:e})=>s5(t,e),Cue=()=>({state:t,dispatch:e})=>c5(t,e),_ue=()=>({state:t,dispatch:e,tr:n})=>{try{const r=gw(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Aue=()=>({state:t,dispatch:e,tr:n})=>{try{const r=gw(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Pue=()=>({state:t,dispatch:e})=>jae(t,e),Iue=()=>({state:t,dispatch:e})=>qae(t,e);function r6(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Oue(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))pm()||r6()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}var Mue=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=Oue(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l?.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function Vc(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?fr(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(d,f)=>{if(d.isText)return;const h=Math.max(r,f),p=Math.min(i,f+d.nodeSize);a.push({node:d,from:h,to:p})});const l=i-r,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>Fy(d.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((d,f)=>d+f.to-f.from,0)>=l}var Nue=(t,e={})=>({state:n,dispatch:r})=>{const i=fr(t,n.schema);return Vc(n,i,e)?Zae(n,r):!1},Rue=()=>({state:t,dispatch:e})=>h5(t,e),Due=t=>({state:e,dispatch:n})=>{const r=fr(t,e.schema);return ale(r)(e,n)},Lue=()=>({state:t,dispatch:e})=>d5(t,e);function Ew(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function $3(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}var Bue=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=Ew(typeof t=="string"?t:t.name,r.schema);if(!a)return!1;a==="node"&&(s=fr(t,r.schema)),a==="mark"&&(o=Sl(t,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&n.setNodeMarkup(d,void 0,$3(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&(l=!0,i&&n.addMark(d,d+u.nodeSize,o.create($3(f.attrs,e))))})})}),l},Fue=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),$ue=()=>({tr:t,dispatch:e})=>{if(e){const n=new hs(t.doc);t.setSelection(n)}return!0},zue=()=>({state:t,dispatch:e})=>a5(t,e),Uue=()=>({state:t,dispatch:e})=>u5(t,e),Hue=()=>({state:t,dispatch:e})=>Jae(t,e),Vue=()=>({state:t,dispatch:e})=>nle(t,e),Wue=()=>({state:t,dispatch:e})=>tle(t,e);function SS(t,e,n={},r={}){return mm(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var jue=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(r.preserveWhitespace!=="full"){const c=SS(t,i.schema,r,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return o&&s.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:r,errorOnInvalidContent:e??i.options.enableContentCheck})};function i6(t,e){const n=Sl(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function WT(t,e){const n=new t5(t);return e.forEach(r=>{r.steps.forEach(i=>{n.step(i)})}),n}function que(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Kue(t,e){const n=[];return t.descendants((r,i)=>{e(r)&&n.push({node:r,pos:i})}),n}function s6(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(i,s)=>{n(i)&&r.push({node:i,pos:s})}),r}function Gue(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Tw(t){return e=>Gue(e.$from,t)}function pt(t,e,n){return t.config[e]===void 0&&t.parent?pt(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?pt(t.parent,e,n):null}):t.config[e]}function jT(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},r=pt(e,"addExtensions",n);return r?[e,...jT(r())]:e}).flat(10)}function qT(t,e){const n=bd.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}function o6(t){return typeof t=="function"}function bn(t,e=void 0,...n){return o6(t)?e?t.bind(e)(...n):t(...n):t}function Zue(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Kf(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function a6(t){const e=[],{nodeExtensions:n,markExtensions:r}=Kf(t),i=[...n,...r],s={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1},o=n.filter(c=>c.name!=="text").map(c=>c.name),a=r.map(c=>c.name),l=[...o,...a];return t.forEach(c=>{const u={name:c.name,options:c.options,storage:c.storage,extensions:i},d=pt(c,"addGlobalAttributes",u);if(!d)return;d().forEach(h=>{let p;Array.isArray(h.types)?p=h.types:h.types==="*"?p=l:h.types==="nodes"?p=o:h.types==="marks"?p=a:p=[],p.forEach(m=>{Object.entries(h.attributes).forEach(([g,y])=>{e.push({type:m,name:g,attribute:{...s,...y}})})})})}),i.forEach(c=>{const u={name:c.name,options:c.options,storage:c.storage},d=pt(c,"addAttributes",u);if(!d)return;const f=d();Object.entries(f).forEach(([h,p])=>{const m={...s,...p};typeof m?.default=="function"&&(m.default=m.default()),m?.isRequired&&m?.default===void 0&&delete m.default,e.push({type:c.name,name:h,attribute:m})})}),e}function Yn(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(u=>!l.includes(u));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),a.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),r[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[i]=s}),r},{})}function Gf(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>Yn(n,r),{})}function Xue(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function z3(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):Xue(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function U3(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&Zue(n)?!1:n!=null))}function H3(t){var e,n;const r={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(r.default=t.attribute.default),((n=t?.attribute)==null?void 0:n.validate)!==void 0&&(r.validate=t.attribute.validate),[t.name,r]}function Que(t,e){var n;const r=a6(t),{nodeExtensions:i,markExtensions:s}=Kf(t),o=(n=i.find(c=>pt(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(i.map(c=>{const u=r.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((y,b)=>{const x=pt(b,"extendNodeSchema",d);return{...y,...x?x(c):{}}},{}),h=U3({...f,content:bn(pt(c,"content",d)),marks:bn(pt(c,"marks",d)),group:bn(pt(c,"group",d)),inline:bn(pt(c,"inline",d)),atom:bn(pt(c,"atom",d)),selectable:bn(pt(c,"selectable",d)),draggable:bn(pt(c,"draggable",d)),code:bn(pt(c,"code",d)),whitespace:bn(pt(c,"whitespace",d)),linebreakReplacement:bn(pt(c,"linebreakReplacement",d)),defining:bn(pt(c,"defining",d)),isolating:bn(pt(c,"isolating",d)),attrs:Object.fromEntries(u.map(H3))}),p=bn(pt(c,"parseHTML",d));p&&(h.parseDOM=p.map(y=>z3(y,u)));const m=pt(c,"renderHTML",d);m&&(h.toDOM=y=>m({node:y,HTMLAttributes:Gf(y,u)}));const g=pt(c,"renderText",d);return g&&(h.toText=g),[c.name,h]})),l=Object.fromEntries(s.map(c=>{const u=r.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((g,y)=>{const b=pt(y,"extendMarkSchema",d);return{...g,...b?b(c):{}}},{}),h=U3({...f,inclusive:bn(pt(c,"inclusive",d)),excludes:bn(pt(c,"excludes",d)),group:bn(pt(c,"group",d)),spanning:bn(pt(c,"spanning",d)),code:bn(pt(c,"code",d)),attrs:Object.fromEntries(u.map(H3))}),p=bn(pt(c,"parseHTML",d));p&&(h.parseDOM=p.map(g=>z3(g,u)));const m=pt(c,"renderHTML",d);return m&&(h.toDOM=g=>m({mark:g,HTMLAttributes:Gf(g,u)})),[c.name,h]}));return new $L({topNode:o,nodes:a,marks:l})}function Yue(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}function Rp(t){return t.sort((n,r)=>{const i=pt(n,"priority")||100,s=pt(r,"priority")||100;return i>s?-1:i<s?1:0})}function l6(t){const e=Rp(jT(t)),n=Yue(e.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}function c6(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,i,(l,c,u,d)=>{var f;l.isBlock&&c>r&&(a+=s);const h=o?.[l.type.name];if(h)return u&&(a+=h({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(f=l?.text)==null?void 0:f.slice(Math.max(r,c)-c,i-c))}),a}function Jue(t,e){const n={from:0,to:t.content.size};return c6(t,n,e)}function u6(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function ede(t,e){const n=fr(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function d6(t,e){const n=Ew(typeof e=="string"?e:e.name,t.schema);return n==="node"?ede(t,e):n==="mark"?i6(t,e):{}}function tde(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function nde(t){const e=tde(t);return e.length===1?e:e.filter((n,r)=>!e.filter((s,o)=>o!==r).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function KT(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),f=e.invert().map(u);r.push({oldRange:{from:d,to:f},newRange:{from:c,to:u}})})}),nde(r)}function GT(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t),o=VT(s,i.type);o&&r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{!i||i?.nodeSize===void 0||r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}var rde=(t,e,n,r=20)=>{const i=t.doc.resolve(n);let s=r,o=null;for(;s>0&&o===null;){const a=i.node(s);a?.type.name===e?o=a:s-=1}return[o,s]};function jh(t,e){return e.nodes[t]||e.marks[t]||null}function y0(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}var ide=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)==null?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";n+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,r-s))}),n};function kS(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?Sl(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>Fy(d.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:f})=>{const h=d.pos,p=f.pos;t.doc.nodesBetween(h,p,(m,g)=>{if(s&&m.inlineContent&&!m.type.allowsMarkType(s))return!1;if(!m.isText&&!m.marks.length)return;const y=Math.max(h,g),b=Math.min(p,g+m.nodeSize),x=b-y;o+=x,a.push(...m.marks.map(C=>({mark:C,from:y,to:b})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>Fy(d.mark.attrs,n,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,f)=>d+f.to-f.from,0);return(l>0?l+c:l)>=o}function sde(t,e,n={}){if(!e)return Vc(t,null,n)||kS(t,null,n);const r=Ew(e,t.schema);return r==="node"?Vc(t,e,n):r==="mark"?kS(t,e,n):!1}var ode=(t,e)=>{const{$from:n,$to:r,$anchor:i}=t.selection;if(e){const s=Tw(a=>a.type.name===e)(t.selection);if(!s)return!1;const o=t.doc.resolve(s.pos+1);return i.pos+1===o.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)},ade=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function V3(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function W3(t,e){const{nodeExtensions:n}=Kf(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=bn(pt(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function Cw(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!=null?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(s=>{i!==!1&&(Cw(s,{ignoreWhitespace:n,checkChildren:e})||(i=!1))}),i}return!1}function f6(t){return t instanceof ut}var h6=class p6{constructor(e){this.position=e}static fromJSON(e){return new p6(e.position)}toJSON(){return{position:this.position}}};function lde(t,e){const n=e.mapping.mapResult(t.position);return{position:new h6(n.pos),mapResult:n}}function cde(t){return new h6(t)}function ude(t,e,n){var r;const{selection:i}=e;let s=null;if(e6(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!=null?r:s.marks();return s.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,f)=>{if(c)return!1;if(u.isInline){const h=!f||f.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(n));c=h&&p}return!c}),c})}var dde=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=Sl(t,r.schema);if(i)if(o){const c=i6(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(u,d,(f,h)=>{const p=Math.max(h,u),m=Math.min(h+f.nodeSize,d);f.marks.find(y=>y.type===l)?f.marks.forEach(y=>{l===y.type&&n.addMark(p,m,l.create({...y.attrs,...e}))}):n.addMark(p,m,l.create(e))})});return ude(r,n,l)},fde=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),hde=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=fr(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>i3(s,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>i3(s,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},pde=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=Nu(t,0,r.content.size),s=ut.create(r,i);e.setSelection(s)}return!0},mde=(t,e)=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=r;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&n.doc.nodesBetween(o,a,(l,c)=>{l.isText||n.setNodeMarkup(c,void 0,{...l.attrs,dir:t})}),!0},gde=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=Et.atStart(r).from,a=Et.atEnd(r).to,l=Nu(i,o,a),c=Nu(s,o,a),u=Et.create(r,l,c);e.setSelection(u)}return!0},yde=t=>({state:e,dispatch:n})=>{const r=fr(t,e.schema);return ule(r)(e,n)};function j3(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(r)}}var bde=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=y0(c,a.node().type.name,a.node().attrs);if(s instanceof ut&&s.node.isBlock)return!a.parentOffset||!el(o,a.pos)?!1:(r&&(t&&j3(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:que(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=d&&f?[{type:f,attrs:u}]:void 0,p=el(e.doc,e.mapping.map(a.pos),1,h);if(!h&&!p&&el(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(p=!0,h=f?[{type:f,attrs:u}]:void 0),r){if(p&&(s instanceof Et&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,h),f&&!d&&!a.parentOffset&&a.parent.type!==f)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}t&&j3(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},wde=(t,e={})=>({tr:n,state:r,dispatch:i,editor:s})=>{var o;const a=fr(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const f=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Fe.empty;const b=l.index(-1)?1:l.index(-2)?2:3;for(let k=l.depth-b;k>=l.depth-3;k-=1)y=Fe.from(l.node(k).copy(y));const x=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,C={...y0(f,l.node().type.name,l.node().attrs),...e},P=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(C))||void 0;y=y.append(Fe.from(a.createAndFill(null,P)||void 0));const S=l.before(l.depth-(b-1));n.replace(S,l.after(-x),new it(y,4-b,0));let _=-1;n.doc.nodesBetween(S,n.doc.content.size,(k,T)=>{if(_>-1)return!1;k.isTextblock&&k.content.size===0&&(_=T+1)}),_>-1&&n.setSelection(Et.near(n.doc.resolve(_))),n.scrollIntoView()}return!0}const h=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...y0(f,d.type.name,d.attrs),...e},m={...y0(f,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const g=h?[{type:a,attrs:p},{type:h,attrs:m}]:[{type:a,attrs:p}];if(!el(n.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:b}=r,{splittableMarks:x}=s.extensionManager,C=b||y.$to.parentOffset&&y.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!C||!i)return!0;const P=C.filter(S=>x.includes(S.type.name));n.ensureMarks(P)}return!0},a2=(t,e)=>{const n=Tw(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&eu(t.doc,n.pos)&&t.join(n.pos),!0},l2=(t,e)=>{const n=Tw(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&eu(t.doc,r)&&t.join(r),!0},vde=(t,e,n,r={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:f}=i.extensionManager,h=fr(t,o.schema),p=fr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:b}=m,x=y.blockRange(b),C=g||m.$to.parentOffset&&m.$from.marks();if(!x)return!1;const P=Tw(S=>W3(S.type.name,d))(m);if(x.depth>=1&&P&&x.depth-P.depth<=1){if(P.node.type===h)return c.liftListItem(p);if(W3(P.node.type.name,d)&&h.validContent(P.node.content)&&a)return l().command(()=>(s.setNodeMarkup(P.pos,h),!0)).command(()=>a2(s,h)).command(()=>l2(s,h)).run()}return!n||!C||!a?l().command(()=>u().wrapInList(h,r)?!0:c.clearNodes()).wrapInList(h,r).command(()=>a2(s,h)).command(()=>l2(s,h)).run():l().command(()=>{const S=u().wrapInList(h,r),_=C.filter(k=>f.includes(k.type.name));return s.ensureMarks(_),S?!0:c.clearNodes()}).wrapInList(h,r).command(()=>a2(s,h)).command(()=>l2(s,h)).run()},xde=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=Sl(t,r.schema);return kS(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},Sde=(t,e,n={})=>({state:r,commands:i})=>{const s=fr(t,r.schema),o=fr(e,r.schema),a=Vc(r,s,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...n})},kde=(t,e={})=>({state:n,commands:r})=>{const i=fr(t,n.schema);return Vc(n,i,e)?r.lift(i):r.wrapIn(i,e)},Ede=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},Tde=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},Cde=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=Sl(t,r.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:f,to:h}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=VT(c,l,p);m&&(f=m.from,h=m.to),n.removeMark(f,h,l)}else d.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,l)});return n.removeStoredMark(l),!0},_de=t=>({tr:e,state:n,dispatch:r})=>{const{selection:i}=n;let s,o;return typeof t=="number"?(s=t,o=t):t&&"from"in t&&"to"in t?(s=t.from,o=t.to):(s=i.from,o=i.to),r&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},Ade=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=Ew(typeof t=="string"?t:t.name,r.schema);if(!a)return!1;a==="node"&&(s=fr(t,r.schema)),a==="mark"&&(o=Sl(t,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let f,h,p,m;n.selection.empty?r.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),f=y,h=g)}):r.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),f=y,h=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&n.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(b=>{if(o===b.type&&(l=!0,i)){const x=Math.max(y,u),C=Math.min(y+g.nodeSize,d);n.addMark(x,C,o.create({...b.attrs,...e}))}}))}),h&&(f!==void 0&&i&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(g=>{o===g.type&&i&&n.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},Pde=(t,e={})=>({state:n,dispatch:r})=>{const i=fr(t,n.schema);return rle(i,e)(n,r)},Ide=(t,e={})=>({state:n,dispatch:r})=>{const i=fr(t,n.schema);return ile(i,e)(n,r)},Ode=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(r=>r.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(r=>r!==e):delete this.callbacks[t]),this}once(t,e){const n=(...r)=>{this.off(t,n),e.apply(this,r)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},_w=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},Mde=(t,e)=>{if(HT(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Vg(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const d=ide(c)+s;return o.forEach(f=>{if(u)return;const h=Mde(d,f.find);if(!h)return;const p=l.state.tr,m=Sw({state:l.state,transaction:p}),g={from:r-(h[0].length-s.length),to:i},{commands:y,chain:b,can:x}=new kw({editor:n,state:m});f.handler({state:m,range:g,match:h,commands:y,chain:b,can:x})===null||!p.steps.length||(f.undoable&&p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function Nde(t){const{editor:e,rules:n}=t,r=new Jt({state:{init(){return null},apply(i,s,o){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=qT(Fe.from(u),o.schema);const{from:d}=l,f=d+u.length;Vg({editor:e,from:d,to:f,text:u,rules:n,plugin:r})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return Vg({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&Vg({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?Vg({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function Rde(t){return Object.prototype.toString.call(t).slice(8,-1)}function Wg(t){return Rde(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function m6(t,e){const n={...t};return Wg(t)&&Wg(e)&&Object.keys(e).forEach(r=>{Wg(e[r])&&Wg(t[r])?n[r]=m6(t[r],e[r]):n[r]=e[r]}),n}var ZT=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...bn(pt(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...bn(pt(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>m6(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},wd=class g6 extends ZT{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new g6(n)}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===n.name))return!1;const l=o.find(c=>c?.type.name===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function Dde(t){return typeof t=="number"}var Lde=class{constructor(t){this.find=t.find,this.handler=t.handler}},Bde=(t,e,n)=>{if(HT(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(i=>{const s=[i.text];return s.index=i.index,s.input=t,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function Fde(t){const{editor:e,state:n,from:r,to:i,rule:s,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new kw({editor:e,state:n}),d=[];return n.doc.nodesBetween(r,i,(h,p)=>{var m,g,y,b,x;if((g=(m=h.type)==null?void 0:m.spec)!=null&&g.code||!(h.isText||h.isTextblock||h.isInline))return;const C=(x=(b=(y=h.content)==null?void 0:y.size)!=null?b:h.nodeSize)!=null?x:0,P=Math.max(r,p),S=Math.min(i,p+C);if(P>=S)return;const _=h.isText?h.text||"":h.textBetween(P-p,S-p,void 0,"ï¿¼");Bde(_,s.find,o).forEach(T=>{if(T.index===void 0)return;const O=P+T.index+1,M=O+T[0].length,L={from:n.tr.mapping.map(O),to:n.tr.mapping.map(M)},F=s.handler({state:n,range:L,match:T,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(F)})}),d.every(h=>h!==null)}var jg=null,$de=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function zde(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:f,rule:h,pasteEvt:p})=>{const m=u.tr,g=Sw({state:u,transaction:m});if(!(!Fde({editor:e,state:g,from:Math.max(d-1,0),to:f.b-1,rule:h,pasteEvent:p,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return n.map(u=>new Jt({view(d){const f=p=>{var m;r=(m=d.dom.parentElement)!=null&&m.contains(p.target)?d.dom.parentElement:null,r&&(jg=e)},h=()=>{jg&&(jg=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",h),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",h)}}},props:{handleDOMEvents:{drop:(d,f)=>{if(s=r===d.dom.parentElement,a=f,!s){const h=jg;h?.isEditable&&setTimeout(()=>{const p=h.state.selection;p&&h.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,f)=>{var h;const p=(h=f.clipboardData)==null?void 0:h.getData("text/html");return o=f,i=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(d,f,h)=>{const p=d[0],m=p.getMeta("uiEvent")==="paste"&&!i,g=p.getMeta("uiEvent")==="drop"&&!s,y=p.getMeta("applyPasteRules"),b=!!y;if(!m&&!g&&!b)return;if(b){let{text:P}=y;typeof P=="string"?P=P:P=qT(Fe.from(P),h.schema);const{from:S}=y,_=S+P.length,k=$de(P);return l({rule:u,state:h,from:S,to:{b:_},pasteEvt:k})}const x=f.doc.content.findDiffStart(h.doc.content),C=f.doc.content.findDiffEnd(h.doc.content);if(!(!Dde(x)||!C||x===C.b))return l({rule:u,state:h,from:x,to:C,pasteEvt:o})}}))}var Aw=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=l6(t),this.schema=Que(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:jh(e.name,this.schema)},r=pt(e,"addCommands",n);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this;return Rp([...this.extensions].reverse()).flatMap(r=>{const i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:jh(r.name,this.schema)},s=[],o=pt(r,"addKeyboardShortcuts",i);let a={};if(r.type==="mark"&&pt(r,"exitable",i)&&(a.ArrowRight=()=>wd.handleExit({editor:t,mark:r})),o){const f=Object.fromEntries(Object.entries(o()).map(([h,p])=>[h,()=>p({editor:t})]));a={...a,...f}}const l=eue(a);s.push(l);const c=pt(r,"addInputRules",i);if(V3(r,t.options.enableInputRules)&&c){const f=c();if(f&&f.length){const h=Nde({editor:t,rules:f}),p=Array.isArray(h)?h:[h];s.push(...p)}}const u=pt(r,"addPasteRules",i);if(V3(r,t.options.enablePasteRules)&&u){const f=u();if(f&&f.length){const h=zde({editor:t,rules:f});s.push(...h)}}const d=pt(r,"addProseMirrorPlugins",i);if(d){const f=d();s.push(...f)}return s})}get attributes(){return a6(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Kf(this.extensions);return Object.fromEntries(e.filter(n=>!!pt(n,"addNodeView")).map(n=>{const r=this.attributes.filter(l=>l.type===n.name),i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:fr(n.name,this.schema)},s=pt(n,"addNodeView",i);if(!s)return[];const o=s();if(!o)return[];const a=(l,c,u,d,f)=>{const h=Gf(l,r);return o({node:l,view:c,getPos:u,decorations:d,innerDecorations:f,editor:t,extension:n,HTMLAttributes:h})};return[n.name,a]}))}dispatchTransaction(t){const{editor:e}=this;return Rp([...this.extensions].reverse()).reduceRight((r,i)=>{const s={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:e,type:jh(i.name,this.schema)},o=pt(i,"dispatchTransaction",s);return o?a=>{o.call(s,{transaction:a,next:r})}:r},t)}transformPastedHTML(t){const{editor:e}=this;return Rp([...this.extensions]).reduce((r,i)=>{const s={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:e,type:jh(i.name,this.schema)},o=pt(i,"transformPastedHTML",s);return o?(a,l)=>{const c=r(a,l);return o.call(s,c)}:r},t||(r=>r))}get markViews(){const{editor:t}=this,{markExtensions:e}=Kf(this.extensions);return Object.fromEntries(e.filter(n=>!!pt(n,"addMarkView")).map(n=>{const r=this.attributes.filter(a=>a.type===n.name),i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Sl(n.name,this.schema)},s=pt(n,"addMarkView",i);if(!s)return[];const o=(a,l,c)=>{const u=Gf(a,r);return s()({mark:a,view:l,inline:c,editor:t,extension:n,HTMLAttributes:u,updateAttributes:d=>{nfe(a,t,d)}})};return[n.name,o]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:jh(e.name,this.schema)};e.type==="mark"&&((n=bn(pt(e,"keepOnSplit",r)))==null||n)&&this.splittableMarks.push(e.name);const i=pt(e,"onBeforeCreate",r),s=pt(e,"onCreate",r),o=pt(e,"onUpdate",r),a=pt(e,"onSelectionUpdate",r),l=pt(e,"onTransaction",r),c=pt(e,"onFocus",r),u=pt(e,"onBlur",r),d=pt(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};Aw.resolve=l6;Aw.sort=Rp;Aw.flatten=jT;var Ude={};UT(Ude,{ClipboardTextSerializer:()=>b6,Commands:()=>w6,Delete:()=>v6,Drop:()=>x6,Editable:()=>S6,FocusEvents:()=>E6,Keymap:()=>T6,Paste:()=>C6,Tabindex:()=>_6,TextDirection:()=>A6,focusEventsPluginKey:()=>k6});var pn=class y6 extends ZT{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new y6(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},b6=pn.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Jt({key:new Sn("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=u6(n);return c6(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),w6=pn.create({name:"commands",addCommands(){return{...Y5}}}),v6=pn.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=WT(t.before,[t,...e]);KT(u).forEach(h=>{u.mapping.mapResult(h.oldRange.from).deletedAfter&&u.mapping.mapResult(h.oldRange.to).deletedBefore&&u.before.nodesBetween(h.oldRange.from,h.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=h.oldRange.from<=m&&g<=h.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:h.oldRange,newRange:h.newRange,partial:!y,editor:this.editor,transaction:t,combinedTransform:u})})});const f=u.mapping;u.steps.forEach((h,p)=>{var m,g;if(h instanceof oo){const y=f.slice(p).map(h.from,-1),b=f.slice(p).map(h.to),x=f.invert().map(y,-1),C=f.invert().map(b),P=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(_=>_.eq(h.mark)),S=(g=u.doc.nodeAt(b))==null?void 0:g.marks.some(_=>_.eq(h.mark));this.editor.emit("delete",{type:"mark",mark:h.mark,from:h.from,to:h.to,deletedRange:{from:x,to:C},newRange:{from:y,to:b},partial:!!(S||P),editor:this.editor,transaction:t,combinedTransform:u})}})};(i=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||i?setTimeout(s,0):s()}}),x6=pn.create({name:"drop",addProseMirrorPlugins(){return[new Jt({key:new Sn("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),S6=pn.create({name:"editable",addProseMirrorPlugins(){return[new Jt({key:new Sn("editable"),props:{editable:()=>this.editor.options.editable}})]}}),k6=new Sn("focusEvents"),E6=pn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Jt({key:k6,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),T6=pn.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:f,parent:h}=d,p=d.parent.isTextblock&&f>0?a.doc.resolve(f-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Dt.atStart(c).from===f;return!u||!h.type.isTextblock||h.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return pm()||r6()?s:i},addProseMirrorPlugins(){return[new Jt({key:new Sn("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(m=>m.getMeta("composition")))return;const r=t.some(m=>m.docChanged)&&!e.doc.eq(n.doc),i=t.some(m=>m.getMeta("preventClearDocument"));if(!r||i)return;const{empty:s,from:o,to:a}=e.selection,l=Dt.atStart(e.doc).from,c=Dt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!Cw(n.doc))return;const f=n.tr,h=Sw({state:n,transaction:f}),{commands:p}=new kw({editor:this.editor,state:h});if(p.clearNodes(),!!f.steps.length)return f}})]}}),C6=pn.create({name:"paste",addProseMirrorPlugins(){return[new Jt({key:new Sn("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),_6=pn.create({name:"tabindex",addProseMirrorPlugins(){return[new Jt({key:new Sn("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),A6=pn.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Kf(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Jt({key:new Sn("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),Hde=class up{constructor(e,n,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You canât set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new up(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new up(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new up(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const i=n.isBlock&&!n.isTextblock,s=n.isAtom&&!n.isText,o=n.isInline,a=this.pos+r+(s?0:1);if(a<0||a>this.resolvedPos.doc.nodeSize-2)return;const l=this.resolvedPos.doc.resolve(a);if(!i&&!o&&l.depth<=this.depth)return;const c=new up(l,this.editor,i,i||o?n:null);i&&(c.actualDepth=this.depth+1),e.push(c)}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(n).length>0){const s=i.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==n[l])break}}else r=i;i=i.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(n);return this.children.forEach(o=>{r&&i.length>0||(o.node.type.name===e&&s.every(l=>n[l]===o.node.attrs[l])&&i.push(o),!(r&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,n,r))))}),i}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},Vde=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function Wde(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var jde=class extends Ode{constructor(e={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:i})=>{throw i},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:lde,createMappablePosition:cde},this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:i,slice:s,moved:o})=>this.options.onDrop(i,s,o)),this.on("paste",({event:i,slice:s})=>this.options.onPaste(i,s)),this.on("delete",this.options.onDelete);const n=this.createDoc(),r=t6(n,this.options.autofocus);this.editorState=of.create({doc:n,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(e){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(e),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const e=this.editorView.dom;e?.editor&&delete e.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(e){console.warn("Failed to remove CSS element:",e)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=Wde(Vde,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:e=>{this.editorState=e},dispatch:e=>{this.dispatchTransaction(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(e,n)=>{if(this.editorView)return this.editorView[n];if(n==="state")return this.editorState;if(n in e)return Reflect.get(e,n);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${n}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(e,n){const r=o6(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,n;const i=[...this.options.enableCoreExtensions?[S6,b6.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)==null?void 0:e.clipboardTextSerializer)==null?void 0:n.blockSeparator}),w6,E6,T6,_6,x6,C6,v6,A6.configure({direction:this.options.textDirection})].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s?.type));this.extensionManager=new Aw(i,this)}createCommandManager(){this.commandManager=new kw({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let e;try{e=SS(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(n){if(!(n instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(n.message))throw n;this.emit("contentError",{editor:this,error:n,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),e=SS(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return e}createView(e){const{editorProps:n,enableExtensionDispatchTransaction:r}=this.options,i=n.dispatchTransaction||this.dispatchTransaction.bind(this),s=r?this.extensionManager.dispatchTransaction(i):i,o=n.transformPastedHTML,a=this.extensionManager.transformPastedHTML(o);this.editorView=new X5(e,{...n,attributes:{role:"textbox",...n?.attributes},dispatchTransaction:s,transformPastedHTML:a,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const l=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(l),this.prependClass(),this.injectCSS();const c=this.view.dom;c.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(u=>{var d;return(d=this.capturedTransaction)==null?void 0:d.step(u)});return}const{state:n,transactions:r}=this.state.applyTransaction(e),i=!this.state.selection.eq(n.selection),s=r.includes(e),o=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),!s)return;this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e,appendedTransactions:r.slice(1)}),i&&this.emit("selectionUpdate",{editor:this,transaction:e});const a=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),l=a?.getMeta("focus"),c=a?.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:a}),c&&this.emit("blur",{editor:this,event:c.event,transaction:a}),!(e.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||o.doc.eq(n.doc))&&this.emit("update",{editor:this,transaction:e,appendedTransactions:r.slice(1)})}getAttributes(e){return d6(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return sde(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return qT(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return Jue(this.state.doc,{blockSeparator:n,textSerializers:{...u6(this.schema),...r}})}get isEmpty(){return Cw(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var e,n;return(n=(e=this.editorView)==null?void 0:e.isDestroyed)!=null?n:!0}$node(e,n){var r;return((r=this.$doc)==null?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new Hde(n,this)}get $doc(){return this.$pos(0)}};function Zf(t){return new _w({find:t.find,handler:({state:e,range:n,match:r})=>{const i=bn(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(GT(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(m=>m===t.type&&m!==h.mark.type)).filter(h=>h.to>c).length)return null;u<n.to&&s.delete(u,n.to),c>n.from&&s.delete(n.from+l,c);const f=n.from+l+o.length;s.addMark(n.from+l,f,t.type.create(i||{})),s.removeStoredMark(t.type)}},undoable:t.undoable})}function P6(t){return new _w({find:t.find,handler:({state:e,range:n,match:r})=>{const i=bn(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;const l=t.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const d=r[0][r[0].length-1];s.insertText(d,o+r[0].length-1),s.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;s.insert(c,t.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()},undoable:t.undoable})}function ES(t){return new _w({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=bn(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)},undoable:t.undoable})}function Xf(t){return new _w({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const s=bn(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&TT(l,t.type,s);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:f}=e,{splittableMarks:h}=t.editor.extensionManager,p=f||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(g=>h.includes(g.type.name));o.ensureMarks(m)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(d,s).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&eu(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)},undoable:t.undoable})}var qde=t=>"touches"in t,Kde=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.clientX-this.startX,c=a.clientY-this.startY;this.handleResize(l,c)},this.handleTouchMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.touches[0];if(!l)return;const c=l.clientX-this.startX,u=l.clientY-this.startY;this.handleResize(c,u)},this.handleMouseUp=()=>{if(!this.isResizing)return;const a=this.element.offsetWidth,l=this.element.offsetHeight;this.onCommit(a,l),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!1)};var e,n,r,i,s,o;this.node=t.node,this.editor=t.editor,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(e=t.options)!=null&&e.min&&(this.minSize={...this.minSize,...t.options.min}),(n=t.options)!=null&&n.max&&(this.maxSize=t.options.max),(r=t?.options)!=null&&r.directions&&(this.directions=t.options.directions),(i=t.options)!=null&&i.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(s=t.options)!=null&&s.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),(o=t.options)!=null&&o.createCustomHandle&&(this.createCustomHandle=t.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){var t;return(t=this.contentElement)!=null?t:null}handleEditorUpdate(){const t=this.editor.isEditable;t!==this.lastEditableState&&(this.lastEditableState=t,t?t&&this.handleMap.size===0&&this.attachHandles():this.removeHandles())}update(t,e,n){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,e,n):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const e=document.createElement("div");return e.dataset.resizeHandle=t,e.style.position="absolute",this.classNames.handle&&(e.className=this.classNames.handle),e}positionHandle(t,e){const n=e.includes("top"),r=e.includes("bottom"),i=e.includes("left"),s=e.includes("right");n&&(t.style.top="0"),r&&(t.style.bottom="0"),i&&(t.style.left="0"),s&&(t.style.right="0"),(e==="top"||e==="bottom")&&(t.style.left="0",t.style.right="0"),(e==="left"||e==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{let e;this.createCustomHandle?e=this.createCustomHandle(t):e=this.createHandle(t),e instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${t}") did not return an HTMLElement. Falling back to default handle.`),e=this.createHandle(t)),this.createCustomHandle||this.positionHandle(e,t),e.addEventListener("mousedown",n=>this.handleResizeStart(n,t)),e.addEventListener("touchstart",n=>this.handleResizeStart(n,t)),this.handleMap.set(t,e),this.wrapper.appendChild(e)})}removeHandles(){this.handleMap.forEach(t=>t.remove()),this.handleMap.clear()}applyInitialSize(){const t=this.node.attrs.width,e=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,e?(this.element.style.height=`${e}px`,this.initialHeight=e):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=e,qde(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,e){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:r,height:i}=this.calculateNewDimensions(this.activeHandle,t,e),s=this.applyConstraints(r,i,n);this.element.style.width=`${s.width}px`,this.element.style.height=`${s.height}px`,this.onResize&&this.onResize(s.width,s.height)}calculateNewDimensions(t,e,n){let r=this.startWidth,i=this.startHeight;const s=t.includes("right"),o=t.includes("left"),a=t.includes("bottom"),l=t.includes("top");return s?r=this.startWidth+e:o&&(r=this.startWidth-e),a?i=this.startHeight+n:l&&(i=this.startHeight-n),(t==="right"||t==="left")&&(r=this.startWidth+(s?e:-e)),(t==="top"||t==="bottom")&&(i=this.startHeight+(a?n:-n)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(r,i,t):{width:r,height:i}}applyConstraints(t,e,n){var r,i,s,o;if(!n){let c=Math.max(this.minSize.width,t),u=Math.max(this.minSize.height,e);return(r=this.maxSize)!=null&&r.width&&(c=Math.min(this.maxSize.width,c)),(i=this.maxSize)!=null&&i.height&&(u=Math.min(this.maxSize.height,u)),{width:c,height:u}}let a=t,l=e;return a<this.minSize.width&&(a=this.minSize.width,l=a/this.aspectRatio),l<this.minSize.height&&(l=this.minSize.height,a=l*this.aspectRatio),(s=this.maxSize)!=null&&s.width&&a>this.maxSize.width&&(a=this.maxSize.width,l=a/this.aspectRatio),(o=this.maxSize)!=null&&o.height&&l>this.maxSize.height&&(l=this.maxSize.height,a=l*this.aspectRatio),{width:a,height:l}}applyAspectRatio(t,e,n){const r=n==="left"||n==="right",i=n==="top"||n==="bottom";return r?{width:t,height:t/this.aspectRatio}:i?{width:e*this.aspectRatio,height:e}:{width:t,height:t/this.aspectRatio}}};function Gde(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof ut){const s=r.index();return r.parent.canReplaceWith(s,s+1,e)}let i=r.depth;for(;i>=0;){const s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}function Zde(t){return t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}var Xde={};UT(Xde,{createAtomBlockMarkdownSpec:()=>Qde,createBlockMarkdownSpec:()=>Yde,createInlineMarkdownSpec:()=>tfe,parseAttributes:()=>XT,parseIndentedBlocks:()=>TS,renderNestedMarkdownContent:()=>YT,serializeAttributes:()=>QT});function XT(t){if(!t?.trim())return{};const e={},n=[],r=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),i=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(o)).forEach(([,c,u])=>{var d;const f=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),h=n[f];h&&(e[c]=h.slice(1,-1))});const l=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function QT(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?e.push(n):r!==!1&&r!=null&&e.push(`${n}="${String(r)}"`))}),e.join(" ")}function Qde(t){const{nodeName:e,name:n,parseAttributes:r=XT,serializeAttributes:i=QT,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=t,l=n||e,c=u=>{if(!a)return u;const d={};return a.forEach(f=>{f in u&&(d[f]=u[f])}),d};return{parseMarkdown:(u,d)=>{const f={...s,...u.attributes};return d.createNode(e,f,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const f=new RegExp(`^:::${l}(?:\\s|$)`,"m"),h=(d=u.match(f))==null?void 0:d.index;return h!==void 0?h:-1},tokenize(u,d,f){const h=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(h);if(!p)return;const m=p[1]||"",g=r(m);if(!o.find(b=>!(b in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),f=i(d),h=f?` {${f}}`:"";return`:::${l}${h} :::`}}}function Yde(t){const{nodeName:e,name:n,getContent:r,parseAttributes:i=XT,serializeAttributes:s=QT,defaultAttributes:o={},content:a="block",allowedAttributes:l}=t,c=n||e,u=d=>{if(!l)return d;const f={};return l.forEach(h=>{h in d&&(f[h]=d[h])}),f};return{parseMarkdown:(d,f)=>{let h;if(r){const m=r(d);h=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?h=f.parseChildren(d.tokens||[]):h=f.parseInline(d.tokens||[]);const p={...o,...d.attributes};return f.createNode(e,p,h)},markdownTokenizer:{name:e,level:"block",start(d){var f;const h=new RegExp(`^:::${c}`,"m"),p=(f=d.match(h))==null?void 0:f.index;return p!==void 0?p:-1},tokenize(d,f,h){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,b=""]=g,x=i(b);let C=1;const P=y.length;let S="";const _=/^:::([\w-]*)(\s.*)?/gm,k=d.slice(P);for(_.lastIndex=0;;){const T=_.exec(k);if(T===null)break;const O=T.index,M=T[1];if(!((p=T[2])!=null&&p.endsWith(":::"))){if(M)C+=1;else if(C-=1,C===0){const L=k.slice(0,O);S=L.trim();const F=d.slice(0,P+O+T[0].length);let B=[];if(S)if(a==="block")for(B=h.blockTokens(L),B.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=h.inlineTokens(R.text))});B.length>0;){const R=B[B.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))B.pop();else break}else B=h.inlineTokens(S);return{type:e,raw:F,attributes:x,content:S,tokens:B}}}}}},renderMarkdown:(d,f)=>{const h=u(d.attrs||{}),p=s(h),m=p?` {${p}}`:"",g=f.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function Jde(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(t);for(;r!==null;){const[,i,s,o]=r;e[i]=s||o,r=n.exec(t)}return e}function efe(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function tfe(t){const{nodeName:e,name:n,getContent:r,parseAttributes:i=Jde,serializeAttributes:s=efe,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=t,c=n||e,u=f=>{if(!l)return f;const h={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in f){const y=f[m];if(g!==void 0&&y===g)return;h[m]=y}}),h},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(f,h)=>{const p={...o,...f.attributes};if(a)return h.createNode(e,p);const m=r?r(f):f.content||"";return m?h.createNode(e,p,[h.createTextNode(m)]):h.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(f){const h=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=f.match(h),m=p?.index;return m!==void 0?m:-1},tokenize(f,h,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=f.match(m);if(!g)return;let y="",b="";if(a){const[,C]=g;b=C}else{const[,C,P]=g;b=C,y=P||""}const x=i(b.trim());return{type:e,raw:g[0],content:y.trim(),attributes:x}}},renderMarkdown:f=>{let h="";r?h=r(f):f.content&&f.content.length>0&&(h=f.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(f.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${h}[/${c}]`}}}function TS(t,e,n){var r,i,s,o;const a=t.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const f=a[u],h=f.match(e.itemPattern);if(!h){if(l.length>0)break;if(f.trim()===""){u+=1,c=`${c}${f}
`;continue}else return}const p=e.extractItemData(h),{indentLevel:m,mainContent:g}=p;c=`${c}${f}
`;const y=[g];for(u+=1;u<a.length;){const P=a[u];if(P.trim()===""){const _=a.slice(u+1).findIndex(O=>O.trim()!=="");if(_===-1)break;if((((i=(r=a[u+1+_].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:i.length)||0)>m){y.push(P),c=`${c}${P}
`,u+=1;continue}else break}if((((o=(s=P.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(P),c=`${c}${P}
`,u+=1;else break}let b;const x=y.slice(1);if(x.length>0){const P=x.map(S=>S.slice(m+d)).join(`
`);P.trim()&&(e.customNestedParser?b=e.customNestedParser(P):b=n.blockTokens(P))}const C=e.createToken(p,b);l.push(C)}if(l.length!==0)return{items:l,raw:c}}function YT(t,e,n,r){if(!t||!Array.isArray(t.content))return"";const i=typeof n=="function"?n(r):n,[s,...o]=t.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(f=>f?e.indent(f):"").join(`
`);l.push(d)}}),l.join(`
`)}function nfe(t,e,n={}){const{state:r}=e,{doc:i,tr:s}=r,o=t;i.descendants((a,l)=>{const c=s.mapping.map(l),u=s.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(h=>{if(h!==o)return!1;d=h}),!d)return;let f=!1;if(Object.keys(n).forEach(h=>{n[h]!==d.attrs[h]&&(f=!0)}),f){const h=t.type.create({...t.attrs,...n});s.removeMark(c,u,t.type),s.addMark(c,u,h)}}),s.docChanged&&e.view.dispatch(s)}var Ri=class I6 extends ZT{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new I6(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},rfe=class{constructor(t,e,n){this.isDragging=!1,this.component=t,this.editor=e.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=e.extension,this.node=e.node,this.decorations=e.decorations,this.innerDecorations=e.innerDecorations,this.view=e.view,this.HTMLAttributes=e.HTMLAttributes,this.getPos=e.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(t){var e,n,r,i,s,o,a;const{view:l}=this.editor,c=t.target,u=c.nodeType===3?(e=c.parentElement)==null?void 0:e.closest("[data-drag-handle]"):c.closest("[data-drag-handle]");if(!this.dom||(n=this.contentDOM)!=null&&n.contains(c)||!u)return;let d=0,f=0;if(this.dom!==u){const b=this.dom.getBoundingClientRect(),x=u.getBoundingClientRect(),C=(i=t.offsetX)!=null?i:(r=t.nativeEvent)==null?void 0:r.offsetX,P=(o=t.offsetY)!=null?o:(s=t.nativeEvent)==null?void 0:s.offsetY;d=x.x-b.x+C,f=x.y-b.y+P}const h=this.dom.cloneNode(!0);try{const b=this.dom.getBoundingClientRect();h.style.width=`${Math.round(b.width)}px`,h.style.height=`${Math.round(b.height)}px`,h.style.boxSizing="border-box",h.style.pointerEvents="none"}catch{}let p=null;try{p=document.createElement("div"),p.style.position="absolute",p.style.top="-9999px",p.style.left="-9999px",p.style.pointerEvents="none",p.appendChild(h),document.body.appendChild(p),(a=t.dataTransfer)==null||a.setDragImage(h,d,f)}finally{p&&setTimeout(()=>{try{p?.remove()}catch{}},0)}const m=this.getPos();if(typeof m!="number")return;const g=ut.create(l.state.doc,m),y=l.state.tr.setSelection(g);l.dispatch(y)}stopEvent(t){var e;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:t});const n=t.target;if(!(this.dom.contains(n)&&!((e=this.contentDOM)!=null&&e.contains(n))))return!1;const i=t.type.startsWith("drag"),s=t.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable)&&!s&&!i)return!0;const{isEditable:a}=this.editor,{isDragging:l}=this,c=!!this.node.type.spec.draggable,u=ut.isSelectable(this.node),d=t.type==="copy",f=t.type==="paste",h=t.type==="cut",p=t.type==="mousedown";if(!c&&u&&i&&t.target===this.dom&&t.preventDefault(),c&&i&&!l&&t.target===this.dom)return t.preventDefault(),!1;if(c&&a&&!l&&p){const m=n.closest("[data-drag-handle]");m&&(this.dom===m||this.dom.contains(m))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(l||s||d||f||h||p&&u)}ignoreMutation(t){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:t}):this.node.isLeaf||this.node.isAtom?!0:t.type==="selection"||this.dom.contains(t.target)&&t.type==="childList"&&(pm()||xS())&&this.editor.isFocused&&[...Array.from(t.addedNodes),...Array.from(t.removedNodes)].every(n=>n.isContentEditable)?!1:this.contentDOM===t.target&&t.type==="attributes"?!0:!this.contentDOM.contains(t.target)}updateAttributes(t){this.editor.commands.command(({tr:e})=>{const n=this.getPos();return typeof n!="number"?!1:(e.setNodeMarkup(n,void 0,{...this.node.attrs,...t}),!0)})}deleteNode(){const t=this.getPos();if(typeof t!="number")return;const e=t+this.node.nodeSize;this.editor.commands.deleteRange({from:t,to:e})}};function dd(t){return new Lde({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:i})=>{const s=bn(t.getAttributes,void 0,r,i);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),f=d+a.length;if(GT(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===t.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;f<n.to&&o.delete(f,n.to),d>n.from&&o.delete(n.from+u,d),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}class ife extends jde{contentElement=null}const sfe=t=>{const e=new ife(t);return pM(e,n=>(e.on("transaction",()=>{n(e)}),()=>{e.destroy()}))};class ofe{component;props;dom;constructor(e,{element:n,props:r}){this.component=e,this.props=r,this.dom=n,this.dom.classList.add("svelte-renderer")}updateProps(e){Object.assign(this.props,e)}updateAttributes(e){Object.keys(e).forEach(n=>{this.dom.setAttribute(n,e[n])})}destroy(){gp(this.component)}}const O6="TipTapNodeView",afe=(t,e)=>{if(!t)throw new Error(e)};class lfe extends rfe{mount(){const e=this.component,n=Zt({editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(a={})=>this.updateAttributes(a),deleteNode:()=>this.deleteNode()});this.contentDOMElement=this.node.isLeaf?null:document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");const r=this.options.context||new F8;r.set(O6,{onDragStart:this.onDragStart.bind(this)});const i=this.options.as??(this.node.isInline?"span":"div"),s=document.createElement(i);s.classList.add(`node-${this.node.type.name}`),this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate);const o=Rb(e,{target:s,props:n,context:r});this.renderer=new ofe(o,{element:s,props:n}),this.appendContendDom(),this.updateElementAttributes()}appendContendDom(){const e=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&e&&!e.contains(this.contentDOMElement)&&e.appendChild(this.contentDOMElement)}get dom(){return afe(this.renderer.dom.firstElementChild?.hasAttribute("data-node-view-wrapper"),"Please use the NodeViewWrapper component for your node view."),this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection,r=this.getPos();if(typeof r=="number")if(e<=r&&n>=r+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n,r){const i=s=>{this.renderer.updateProps(s),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(typeof this.options.update=="function"){const s=this.node,o=this.decorations,a=this.innerDecorations;return this.node=e,this.decorations=n,this.innerDecorations=r,this.options.update({oldNode:s,oldDecorations:o,oldInnerDecorations:a,newNode:e,newDecorations:n,newInnerDecorations:r,updateProps:()=>i({node:e,decorations:n,innerDecorations:r})})}return e.type!==this.node.type?!1:(e===this.node&&this.decorations===n&&this.innerDecorations===r||(this.node=e,this.decorations=n,this.innerDecorations=r,i({node:e,decorations:n,innerDecorations:r})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.dom.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.dom.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const n=this.editor.extensionManager.attributes,r=Gf(this.node,n);e=this.options.attrs({node:this.node,HTMLAttributes:r})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}const M6=(t,e)=>n=>new lfe(t,n,e);var cfe=Ce("<div></div> <!>",1);function ufe(t,e){wt(e,!0);const n=ce(e,"editor",7);let r;Vs(async()=>{await Dc(),r&&n()?.options.element&&(n().contentElement||(r.append(...Array.from(n().options.element?.childNodes||[])),n().setOptions({element:r}),n().contentElement=r))}),_f(()=>{if(!n()||(n().contentElement=null,!n().options.element?.firstChild))return;const c=document.createElement("div");c.append(...Array.from(n().options.element?.childNodes||[])),n().setOptions({element:c})});var s=cfe(),o=Te(s);Ar(o,c=>r=c,()=>r);var a=ve(o,2);{var l=c=>{var u=ze(),d=Te(u);kt(d,()=>e.children),Y(c,u)};He(a,c=>{e.children&&c(l)})}Ge(()=>Qo(o,1,lM(e.class))),Y(t,s),vt()}function N6(t,e){wt(e,!0);const n=ce(e,"as",3,"div"),r=Ni(e,["$$slots","$$events","$$legacy","as","children"]),{onDragStart:i}=W2(O6);let s;Vs(async()=>{await Dc(),s.style.whiteSpace="normal"});var o=ze(),a=Te(o);$9(a,n,!1,(l,c)=>{Ar(l,h=>s=h,()=>s),kr(l,()=>({"data-node-view-wrapper":"",role:"none",...r,ondragstart:i}));var u=ze(),d=Te(u);{var f=h=>{var p=ze(),m=Te(p);kt(m,()=>e.children),Y(h,p)};He(d,h=>{e.children&&h(f)})}Y(c,u)}),Y(t,o),vt()}class Dp{static isValidNsec(e){return boe(e)}static derivePublicKey(e){return xoe(e)}static pubkeyToNpub(e){try{return e?xL(e):""}catch(n){return console.error("pubkeyããnpubã¸ã®å¤æã¨ã©ã¼:",n),""}}}class dfe{constructor(e,n,r){this.localStorage=e,this.console=n,this.secretKeyStore=r}saveToStorage(e){if(!e?.trim())return{success:!1,error:{type:"validation",message:"Key cannot be empty"}};try{const n=e.trim();return this.localStorage.setItem("nostr-secret-key",n),this.secretKeyStore.set(n),{success:!0}}catch(n){const r={type:"storage",message:"éµã®ä¿å­ã«å¤±æãã¾ãã",originalError:n};return this.console.error("éµã®ä¿å­ã«å¤±æ:",n),{success:!1,error:r}}}loadFromStorage(){let e=this.secretKeyStore.value;if(e)return e;try{return e=this.localStorage.getItem("nostr-secret-key"),e&&this.secretKeyStore.set(e),e}catch(n){return this.console.error("éµã®èª­ã¿è¾¼ã¿ã«å¤±æ:",n),null}}getFromStore(){return this.secretKeyStore.value}hasStoredKey(){try{return!!this.localStorage.getItem("nostr-secret-key")}catch(e){return this.console.error("ã¹ãã¬ã¼ã¸ã¢ã¯ã»ã¹ã¨ã©ã¼:",e),!1}}}class ffe{constructor(e){this.window=e}isWindowNostrAvailable(){return typeof this.window<"u"&&"nostr"in this.window&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}async getPublicKeyFromWindowNostr(){if(!this.isWindowNostrAvailable()||!this.window?.nostr)return{success:!1,error:{type:"validation",message:"window.nostr is not available"}};try{return{success:!0,pubkey:await this.window.nostr.getPublicKey()}}catch(e){const n={type:"network",message:"window.nostrããå¬ééµã®åå¾ã«å¤±æãã¾ãã",originalError:e};return console.error("window.nostrããå¬ééµã®åå¾ã«å¤±æ:",e),{success:!1,error:n}}}}class R6{constructor(e={}){this.deps=e,this._nsecStore.subscribe(n=>this.updateFromNsec(n))}_nsecStore=io("");_dataStore=io({hex:"",npub:"",nprofile:""});_isValidStore=io(!1);_isNostrLoginStore=io(!1);nsec={subscribe:this._nsecStore.subscribe};data={subscribe:this._dataStore.subscribe};isValid={subscribe:this._isValidStore.subscribe};isNostrLogin={subscribe:this._isNostrLoginStore.subscribe};hex=Ja(this._dataStore,e=>e.hex);npub=Ja(this._dataStore,e=>e.npub);nprofile=Ja(this._dataStore,e=>e.nprofile);setNsec(e){const n=e?.trim()||"";this._nsecStore.set(n),this._isNostrLoginStore.set(!1)}setNostrLoginAuth(e){if(e.type==="logout"){this.clear();return}if(!e.pubkey){console.warn("NostrLoginAuth: pubkey is required for login/signup");return}try{const n=e.npub||cl.npubEncode(e.pubkey),r=cl.nprofileEncode({pubkey:e.pubkey,relays:[]});let i;if(this.deps.localStorage&&typeof this.deps.localStorage.getItem=="function")try{const s=this.deps.localStorage.getItem("__nostrlogin_accounts");if(s){const o=JSON.parse(s);if(Array.isArray(o)){const a=o.find(l=>l?.pubkey===e.pubkey);if(a?.authMethod){const l=a.authMethod;(l==="connect"||l==="extension"||l==="local")&&(i=l)}}}}catch(s){console.warn("Failed to get authMethod from localStorage:",s)}this._dataStore.set({hex:e.pubkey,npub:n,nprofile:r}),this._isValidStore.set(!0),this._isNostrLoginStore.set(!0),this._nsecStore.set(""),this.deps.setNostrLoginAuthFn?this.deps.setNostrLoginAuthFn(e.pubkey,n,r,i):setTimeout(()=>{this.deps.setNostrLoginAuthFn&&this.deps.setNostrLoginAuthFn(e.pubkey,n,r,i)},10),console.log("[PublicKeyState] NostrLoginèªè¨¼ç¶æãè¨­å®:",{pubkey:e.pubkey,npub:n,type:e.type,authMethod:i})}catch(n){console.error("Failed to set NostrLogin auth:",n),this.clear()}}updateFromNsec(e){if(!e||!Dp.isValidNsec(e)){this._resetState();return}try{const n=Dp.derivePublicKey(e);n.hex?(this._dataStore.set(n),this._isValidStore.set(!0)):this._resetState()}catch(n){console.error("Failed to derive public key from nsec:",n),this._resetState()}}_resetState(){this._dataStore.set({hex:"",npub:"",nprofile:""}),this._isValidStore.set(!1)}clear(){this._nsecStore.set(""),this._isNostrLoginStore.set(!1),this.deps.clearAuthStateFn&&this.deps.clearAuthStateFn()}get currentIsValid(){return xc(this._isValidStore)}get currentHex(){return xc(this.hex)}get currentIsNostrLogin(){return xc(this._isNostrLoginStore)}}class D6{storage;externalAuth;constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.console||(typeof window<"u"?window.console:{}),i=e.secretKeyStore||{value:null,set:()=>{}},s=e.window||(typeof window<"u"?window:void 0);this.storage=new dfe(n,r,i),this.externalAuth=new ffe(s)}isValidNsec(e){return Dp.isValidNsec(e)}derivePublicKey(e){return Dp.derivePublicKey(e)}pubkeyToNpub(e){return Dp.pubkeyToNpub(e)}saveToStorage(e){return this.storage.saveToStorage(e)}loadFromStorage(){return this.storage.loadFromStorage()}getFromStore(){return this.storage.getFromStore()}hasStoredKey(){return this.storage.hasStoredKey()}isWindowNostrAvailable(){return this.externalAuth.isWindowNostrAvailable()}async getPublicKeyFromWindowNostr(){return await this.externalAuth.getPublicKeyFromWindowNostr()}getStorage(){return this.storage}getExternalAuth(){return this.externalAuth}}const CS=new D6;let L6=Zt({content:"",hashtags:[],tags:[]});const oc=L6;function q3(){return G7(L6)}Zt({});let qh=Zt({});const _S={get value(){return qh},set:t=>{Object.assign(qh,t)},update:t=>{const e=t(qh);Object.assign(qh,e)},subscribe:t=>(nt(()=>{t(qh)}),()=>{})};let Kh=ye(!1);const AS={get value(){return E(Kh)},set:t=>{Q(Kh,t,!0)},toggle:()=>{Q(Kh,!E(Kh))},reset:()=>{Q(Kh,!1)}};let Gh=ye(!1),c2=ye("");const Ku={get value(){return E(Gh)},set:t=>{Q(Gh,t,!0)},toggle:()=>{Q(Gh,!E(Gh))},reset:()=>{Q(Gh,!1)}},Sf={get value(){return E(c2)},set:t=>{Q(c2,t,!0)},reset:()=>{Q(c2,"")}},K3=["client","eHagaki","31990:ec42c765418b3db9c85abff3a88f4a3bbe57535eebbdc54522041fa5328c0600:1754918316480","wss://relay.nostr.band"];function hfe(){try{const t=localStorage.getItem("clientTagEnabled");return(t===null?!0:t==="true")?[...K3]:null}catch{return[...K3]}}function pfe(t){return encodeURI(t.trim())}function mfe(t){return Nie.includes(t)}function gfe(t){const e=t.toLowerCase();return aL.some(n=>e.endsWith(n))}function yfe(t){const e=t.toLowerCase();return lL.some(n=>e.endsWith(n))}function B6(t){try{const e=pfe(t),n=new URL(e);return mfe(n.protocol)?n.href:null}catch{return null}}function F6(t){const e=B6(t);if(!e)return null;try{const n=new URL(e);return gfe(n.pathname)?e:null}catch{return null}}function bfe(t){const e=B6(t);if(!e)return null;try{const n=new URL(e);return yfe(n.pathname)?e:null}catch{return null}}function $6(t){return t.replace(/\r\n/g,`
`).replace(/\r/g,`
`)}function wfe(t){return!t||/[\s\n\u3000]/.test(t)}function vfe(t){const e=/([.,;:!?ï¼ãããããã\]}>ï¼]){2,}$/,n=t.match(e);if(n){const r=n[0];return{cleanUrl:t.slice(0,-r.length),trailingChars:r}}return{cleanUrl:t,trailingChars:""}}function xfe(t){const{cleanUrl:e}=vfe(t);return{cleanUrl:e,actualLength:e.length}}function Sfe(t){if(t.childCount===1){const e=t.firstChild;return e?.type.name==="paragraph"&&e.content.size===0}return t.childCount===0}function kfe(t){return Sfe(t.doc)}function Efe(t,e){return t.type.name==="paragraph"&&t.content.size===e&&t.textContent.trim().length===e}function Tfe(t){const e=[];return t.descendants(n=>{if(n.type.name==="paragraph"){const r=n.textContent;e.push(r)}else if(n.type.name==="image"){const r=n.attrs?.src;r&&e.push(r)}else if(n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}}),e}function Cfe(t){if(!t)return null;try{const e=typeof t=="function"?t():t;return e?.state?.doc??e?.view?.state?.doc??null}catch{return null}}function z6(t){const e=Cfe(t);return e?Tfe(e).join(`
`):""}function _fe(t,e,n){if(t===e)return null;let r=t;if(n){const i=n.resolve(t);i.parent.type.name==="paragraph"&&(r=i.after())}return r<e?{insertPos:r,deleteStart:e+1,deleteEnd:e+2}:r>e+1?{insertPos:r-1,deleteStart:e,deleteEnd:e+1}:null}function Afe(t,e,n){return n.insertPos<n.deleteStart?t.insert(n.insertPos,e).delete(n.deleteStart,n.deleteEnd):t.delete(n.deleteStart,n.deleteEnd).insert(n.insertPos,e)}function u2(t,e,n){const{tr:r,doc:i,schema:s}=t.state,o=e.pos,a=_fe(n,o,i);if(!a)return!0;const l=s.nodes.image.create(e.attrs);try{const c=Afe(r,l,a);return t.dispatch(c),!0}catch(c){return console.error("Error moving image:",c),!1}}function G3(t){t.dispatch(t.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null}))}function JT(t,e,n){if(!t)return;t.state.doc.descendants((i,s)=>{if(e(i,s))return n(i,s),!1})}function Pfe(t,e,n,r){t.update(i=>{const s={...i};return e&&delete s[e],s})}function d2(t,e,n,r,i=!1){n&&(Pfe(r,t),JT(n,(s,o)=>{const a=s.type?.name;return(e&&a==="video"||!e&&a==="image")&&(s.attrs?.src===t||s.attrs?.id===t)},(s,o)=>{const a=n.state.tr.delete(o,o+s.nodeSize);n.view.dispatch(a),i&&console.log("[uploadHelper] Deleted placeholder:",t)}))}function U6(t,e=!1){if(!t)return;const{state:n}=t,{doc:r}=n,i=n.tr;let s=0;const o=[];r.descendants((a,l)=>{const c=a.type?.name,u=a.attrs?.isPlaceholder===!0||a.attrs?.src?.startsWith("placeholder-")||a.attrs?.src?.startsWith("blob:");(c==="image"||c==="video")&&u&&o.push({pos:l,size:a.nodeSize})}),o.reverse().forEach(({pos:a,size:l})=>{i.delete(a,a+l),s++}),s>0&&(t.view.dispatch(i),e&&console.log(`[editorUtils] Deleted ${s} placeholder(s)`))}function PS(t){if(!t||!t.types)return!1;try{return Array.from(t.types).some(e=>e==="application/x-tiptap-node")}catch{return!1}}function H6(t){if(!t)return!1;try{return Array.from(t.types).includes("Files")||t.files&&t.files.length>0}catch{return!!(t.files&&t.files.length>0)}}function Ife(t){let e=ye(!1);function n(s){const o=s.dataTransfer,a=PS(o);H6(o)&&!a?(s.preventDefault(),E(e)||(Q(e,!0),t.classList.add("drag-over"))):E(e)&&(Q(e,!1),t.classList.remove("drag-over"))}function r(s){E(e)&&(Q(e,!1),t.classList.remove("drag-over"))}async function i(s){Q(e,!1),t.classList.remove("drag-over");const o=s.dataTransfer;PS(o)||o?.files&&o.files.length>0&&typeof t.__uploadFiles=="function"&&(s.preventDefault(),t.__uploadFiles(o.files))}return t.addEventListener("dragover",n),t.addEventListener("dragleave",r),t.addEventListener("drop",i),{destroy(){t.removeEventListener("dragover",n),t.removeEventListener("dragleave",r),t.removeEventListener("drop",i)}}}function Ofe(t,e){const n=Ife(t);function r(o){const a=o.dataTransfer,l=PS(a);H6(a)&&!l?e.dragOver(!0):e.dragOver(!1)}function i(o){e.dragOver(!1)}function s(o){e.dragOver(!1)}return t.addEventListener("dragover",r),t.addEventListener("dragleave",i),t.addEventListener("drop",s),{destroy(){n?.destroy?.(),t.removeEventListener("dragover",r),t.removeEventListener("dragleave",i),t.removeEventListener("drop",s)}}}function Mfe(t){function e(n){if(!n.clipboardData)return;const r=[];for(const i of n.clipboardData.items)if(i.kind==="file"&&i.type.startsWith("image/")){const s=i.getAsFile();s&&r.push(s)}r.length>0&&(n.preventDefault(),t.__uploadFiles?.(r))}return t.addEventListener("paste",e),{destroy(){t.removeEventListener("paste",e)}}}function Nfe(t){function e(r){const i=r.target;if(i&&i.closest('.editor-image-button[data-dragging="true"]')){const s=r.touches[0],o=120,a=Uc.querySelector(".tiptap-editor");if(a){const l=a.getBoundingClientRect(),c=s.clientY<l.top+o,u=s.clientY>l.bottom-o;if(!c&&!u)return r.preventDefault(),!1}}}function n(r){const i=Uc.querySelectorAll(".drop-zone-indicator");i.forEach(s=>{s.classList.remove("drop-zone-hover"),s.classList.add("drop-zone-fade-out")}),setTimeout(()=>{i.forEach(s=>{s.parentNode&&s.parentNode.removeChild(s)})},300)}return t.addEventListener("touchmove",e),t.addEventListener("touchend",n),{destroy(){t.removeEventListener("touchmove",e),t.removeEventListener("touchend",n)}}}function Rfe(t){function e(n){if((n.ctrlKey||n.metaKey)&&(n.key==="Enter"||n.key==="NumpadEnter")){n.preventDefault();const r=t.__currentEditor,i=typeof r=="function"?r():r,s=t.__hasStoredKey,o=typeof s=="function"?s():s,a=t.__postStatus,l=typeof a=="function"?a():a,c=i?z6(i):"";!l?.sending&&c.trim()&&o&&t.__submitPost?.()}}return t.addEventListener("keydown",e),{destroy(){t.removeEventListener("keydown",e)}}}function Dfe(t){let e=!1;return t?.descendants(n=>{n.type?.name==="image"&&(e=!0)}),e}function Lfe(t){let e=!1;return t?.descendants(n=>{n.type?.name==="video"&&(e=!0)}),e}function Bfe(t){return Dfe(t)||Lfe(t)}function Ffe(t){const{currentEditor:e,editorContainerEl:n,callbacks:r}=t,i=a=>{const c=a.detail.plainText,u=e?Bfe(e.state?.doc):!1;r.onContentUpdate?.(c,u)},s=a=>{const l=a;r.onImageFullscreenRequest?.(l.detail.src,l.detail.alt||"")},o=a=>{const c=a?.detail?.pos;if(c!=null&&!(!e||!e.view)){try{"ontouchstart"in window||navigator.maxTouchPoints>0||e.view.focus();const u=ut.create(e.state.doc,c);e.view.dispatch(e.state.tr.setSelection(u).scrollIntoView())}catch(u){console.warn("select-image-node handler failed:",u)}r.onSelectImageNode?.(c)}};return window.addEventListener("editor-content-changed",i),window.addEventListener("image-fullscreen-request",s),window.addEventListener("select-image-node",o),n&&(n.addEventListener("image-fullscreen-request",s),n.addEventListener("select-image-node",o)),{handleContentUpdate:i,handleImageFullscreenRequest:s,handleSelectImageNode:o}}function $fe(t,e){window.removeEventListener("editor-content-changed",t.handleContentUpdate),window.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),window.removeEventListener("select-image-node",t.handleSelectImageNode),e&&(e.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),e.removeEventListener("select-image-node",t.handleSelectImageNode))}function V6(t){const e=[],n=nS.source;return t.descendants((r,i)=>{if(!r.isText||!r.text)return;const s=r.text,o=new RegExp(n,"g");let a;for(;(a=o.exec(s))!==null;){const l=a[0].indexOf("#");if(l===-1)continue;const c=i+a.index+l,u=c+1+a[1].length;e.push({from:c,to:u,hashtag:a[1]})}}),e}function zfe(t){const e=[],n=new Set;nS.lastIndex=0;let r;for(;(r=nS.exec(t))!==null;){const i=r[1];i&&i.trim()&&(n.has(i)||(n.add(i),e.push(i)))}return e}function Ufe(t){const e=V6(t),n=[],r=new Set;for(const i of e)r.has(i.hashtag)||(r.add(i.hashtag),n.push(i.hashtag));return n}function Hfe(t){Array.isArray(oc.hashtags)&&[...oc.hashtags];let e,n;typeof t=="string"?(n=t,e=zfe(n)):(e=Ufe(t),n=t.textContent);const r=e.map(i=>["t",i.toLowerCase()]);oc.content=n,oc.hashtags=e,oc.tags=r}function Z3(t){const n=V6(t).map(({from:r,to:i})=>mr.inline(r,i,{class:_o.HASHTAG_CLASS}));return wn.create(t,n)}function Vfe(t,e,n,r,i,s){const o=e.doc.resolve(i),a=o.parent,l=a.type.name==="paragraph"&&a.textContent.trim().length===0,c=Efe(a,s-i),u=kfe(e),d=n.create({src:r,alt:"Image"});if(l||c){const f=o.depth,h=o.start(f),p=o.end(f);return u||e.doc.childCount===1&&c?t.delete(0,e.doc.content.size).insert(0,d):t.replaceWith(h,p,d)}return t.replaceWith(i,s,d)}function Wfe(t,e,n){const r=t.schema.marks.link,i=t.schema.nodes.image;if(!r)return null;let s=t.tr,o=!1;const a=[];e&&t.doc.descendants((l,c)=>{if(!l.isText)return;l.marks.find(d=>d.type===r)&&a.push({type:"removeMark",from:c,to:c+l.nodeSize})}),t.doc.descendants((l,c)=>{if(!l.isTextblock||l.childCount===0)return;let u="";const d=[];if(l.forEach((h,p)=>{h.isText&&h.text&&(d.push({textOffset:u.length,docPos:c+1+p}),u+=h.text)}),!u)return;let f;for(;(f=_o.URL_REGEX.exec(u))!==null;){if(typeof f.index!="number")continue;const h=f.index,p=f[0],m=h>0?u[h-1]:void 0;if(!wfe(m))continue;const{cleanUrl:g,actualLength:y}=xfe(p),b=h+y,x=c+1+h,C=c+1+b;if(n){const P=F6(g);if(P&&i){a.push({type:"replaceImage",from:x,to:C,imageUrl:P});break}}if(e){if(g.length<8||!/^https?:\/\/[a-zA-Z0-9]/.test(g))continue;try{const S=new URL(g).hostname;if(S.length>0&&S.includes(".")){const _=S.split("."),k=_[_.length-1];if(k&&k.length>=2){const T=r.create({href:g});a.push({type:"addMark",from:x,to:C,mark:T})}}}catch{continue}}}}),a.sort((l,c)=>c.from-l.from);for(const l of a)l.type==="removeMark"?(s=s.removeMark(l.from,l.to,r),o=!0):l.type==="addMark"&&l.mark?(s=s.addMark(l.from,l.to,l.mark),o=!0):l.type==="replaceImage"&&l.imageUrl&&(s=Vfe(s,t,i,l.imageUrl,l.from,l.to),o=!0);return o&&s.docChanged?s:null}const jfe=pn.create({name:"contentTracking",addOptions(){return{debounceDelay:_o.DEBOUNCE_DELAY,enableHashtags:_o.ENABLE_HASHTAGS,enableAutoLink:_o.ENABLE_AUTO_LINK,enableImageConversion:_o.ENABLE_IMAGE_CONVERSION}},addStorage(){return{updateTimeout:null}},addProseMirrorPlugins(){const t=this.storage,e=this.options;return[...e.enableHashtags?[new Jt({key:new Sn(_o.PLUGIN_KEYS.HASHTAG_DECORATION),state:{init:(n,{doc:r})=>Z3(r),apply(n,r){return n.docChanged?Z3(n.doc):r.map(n.mapping,n.doc)}},props:{decorations(n){return this.getState(n)}}})]:[],...e.enableAutoLink||e.enableImageConversion?[new Jt({key:new Sn(_o.PLUGIN_KEYS.LINK_AND_IMAGE_CONVERSION),appendTransaction:(n,r,i)=>{if(!n.some(l=>l.docChanged))return null;const o=!n.some(l=>l.getMeta("paste")),a=Wfe(i,e.enableAutoLink??!0,o&&(e.enableImageConversion??!0));return a&&a.setMeta("addToHistory",!1),a}})]:[],new Jt({key:new Sn(_o.PLUGIN_KEYS.CONTENT_UPDATE_TRACKER),state:{init:()=>null,apply(n){return n.docChanged&&(t.updateTimeout&&clearTimeout(t.updateTimeout),t.updateTimeout=setTimeout(()=>{Hfe(n.doc),window.dispatchEvent(new CustomEvent("editor-content-changed",{detail:{plainText:n.doc.textContent}}))},e.debounceDelay??_o.DEBOUNCE_DELAY)),null}}})]},onDestroy(){this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout)}});function X3(t){return t.split(/[\n ]+/).map(e=>e.trim()).filter(Boolean).map(e=>{const n=F6(e);if(n)return{url:n,type:"image"};const r=bfe(e);return r?{url:r,type:"video"}:null}).filter(e=>e!==null)}function qfe(t,e){const n=e.parent;return n.type.name==="paragraph"&&n.textContent.trim().length===0}function Kfe(t){const{selection:e}=t,n=t.doc.resolve(e.from);if(qfe(e,n)){const r=n.depth,i=n.start(r),s=n.end(r);return{start:i,end:s}}return null}function Q3(t,e){return t.map((n,r)=>{const i=Date.now();if(n.type==="image")return e.nodes.image.create({src:n.url,alt:"Pasted image"});{const s=`pasted-video-${i}-${r}`;return e.nodes.video.create({src:n.url,id:s})}})}function Y3(t){const e=t.doc;if(!e)return t;const n=[];return e.descendants((r,i)=>{if(r.type.name==="paragraph"&&r.textContent.trim().length===0){if(e.childCount===1&&e.firstChild===r)return;let s=!1;r.descendants(o=>o.type&&(o.type.name==="image"||o.type.name==="video")?(s=!0,!1):!0),s||n.push([i,i+r.nodeSize])}}),n.sort((r,i)=>i[0]-r[0]),n.forEach(([r,i])=>{t=t.delete(r,i)}),t}const Gfe=pn.create({name:"mediaPaste",addProseMirrorPlugins(){return[new Jt({key:new Sn("image-paste"),props:{handlePaste:(t,e)=>{const n=e.clipboardData?.getData("text/plain")||"",r=X3(n);if(r.length>0){e.preventDefault();const{state:i,dispatch:s}=t,{tr:o,selection:a,schema:l}=i,c=Q3(r,l);let u=o;const d=Kfe(i);if(d&&c.length>0){u=u.replaceWith(d.start,d.end,c[0]);let f=d.start+c[0].nodeSize;for(let h=1;h<c.length;h++)u=u.insert(f,c[h]),f+=c[h].nodeSize}else{let f=a.from;c.forEach(h=>{u=u.insert(f,h),f+=h.nodeSize})}return u=Y3(u),s(u),!0}return!1},handleTextInput:(t,e,n,r)=>{if(r.includes(`
`)||r.length>20){const i=X3(r);if(i.length>0){const{state:s,dispatch:o}=t,{tr:a,schema:l}=s,c=Q3(i,l);let u=a;u=u.delete(e,n);let d=e;return c.forEach(f=>{u=u.insert(d,f),d+=f.nodeSize}),u=Y3(u),o(u),!0}}return!1}}})]}}),Zfe=pn.create({name:"imageDragDrop",addProseMirrorPlugins(){const t=new Sn("image-drag-drop"),e=new Sn("drop-zone-indicator");return[new Jt({key:t,state:{init:()=>({isDragging:!1,draggedNodePos:null,autoScrollInterval:null}),apply:(n,r)=>{const i=n.getMeta("imageDrag");return i?i.isDragging===!1&&r.autoScrollInterval?(clearInterval(r.autoScrollInterval),{...r,...i,autoScrollInterval:null}):{...r,...i}:r}},props:{handleDrop:(n,r,i,s)=>{const o=r.dataTransfer?.getData("application/x-tiptap-node");if(!s&&o)try{const a=JSON.parse(o);if(a.type==="image"){r.preventDefault();const l=n.posAtCoords({left:r.clientX,top:r.clientY});if(l&&typeof a.pos=="number")return G3(n),u2(n,a,l.pos),!0}}catch(a){console.warn("Failed to parse drag data:",a)}return!1},handleDOMEvents:{dragstart:(n,r)=>so()?(r.preventDefault(),!0):!1,dragover:(n,r)=>so()?(r.preventDefault(),!0):!1,drop:(n,r)=>so()?(r.preventDefault(),!0):!1}},view:n=>{let r=null;const i=(c,u)=>{r&&(cancelAnimationFrame(r),r=null);const d=n.dom;if(!d)return;const f=d.getBoundingClientRect(),h=hI;let p=0;c==="up"?p=u-f.top:p=f.bottom-u;const m=Math.max(0,Math.min(1,p/h)),g=pI+(Lie-pI)*(1-m),y=()=>{const b=d.scrollTop,x=d.scrollHeight,C=d.clientHeight;if(c==="up"&&b>0){const P=Math.max(0,b-g);d.scrollTop=P,P>0&&(r=requestAnimationFrame(y))}else if(c==="down"&&b<x-C){const P=Math.min(x-C,b+g);d.scrollTop=P,P<x-C&&(r=requestAnimationFrame(y))}};r=requestAnimationFrame(y)},s=()=>{r&&(cancelAnimationFrame(r),r=null)},o=c=>{const{nodeData:u,dropPosition:d,dropX:f,dropY:h}=c.detail;if(s(),n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null})),u&&u.type==="image"){let p;typeof d=="number"?p=d:p=n.posAtCoords({left:f,top:h})?.pos||u.pos,typeof u.pos=="number"&&u2(n,u,p)}},a=c=>{const{nodePos:u}=c.detail;n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!0,draggedNodePos:u}))},l=c=>{const{touchY:u}=c.detail;if(typeof u!="number"||!t.getState(n.state)?.isDragging)return;const f=n.dom;if(!f)return;const h=f.getBoundingClientRect(),p=hI;u<h.top+p?i("up",u):u>h.bottom-p?i("down",u):s()};return window.addEventListener("touch-image-drop",o),window.addEventListener("touch-image-drag-start",a),window.addEventListener("touch-image-drag-move",l),{destroy(){s(),window.removeEventListener("touch-image-drop",o),window.removeEventListener("touch-image-drag-start",a),window.removeEventListener("touch-image-drag-move",l)}}}}),new Jt({key:e,state:{init(){return wn.empty},apply(n,r,i,s){if(!so())return wn.empty;const o=t.getState(s);if(!o?.isDragging)return wn.empty;const a=[],l=s.doc;let c=!1;if(typeof o.draggedNodePos=="number"){const u=l.firstChild;u&&u.type.name==="image"&&u.attrs&&o.draggedNodePos===0&&(c=!0)}return c||a.push(mr.widget(0,()=>{const u=document.createElement("div");u.className="drop-zone-indicator drop-zone-top",u.setAttribute("data-drop-pos","0");const d=document.createElement("div");return d.className="drop-zone-bar",u.appendChild(d),u},{side:-1})),l.descendants((u,d)=>{if(u.type.name==="paragraph"||u.type.name==="image"){const f=d+u.nodeSize;if(typeof o.draggedNodePos=="number"&&f===o.draggedNodePos)return;o.draggedNodePos!==d&&a.push(mr.widget(f,()=>{const h=document.createElement("div");h.className="drop-zone-indicator drop-zone-between",h.setAttribute("data-drop-pos",f.toString());const p=document.createElement("div");return p.className="drop-zone-bar",h.appendChild(p),h},{side:1}))}}),wn.create(l,a)}},props:{decorations(n){return this.getState(n)}}})]},addStorage(){return{moveImageNode:(t,e,n)=>(G3(t),u2(t,e,n))}}}),Xfe=pn.create({name:"smartBackspace",addProseMirrorPlugins(){return[new Jt({key:new Sn("smart-backspace"),props:{handleKeyDown(t,e){if(e.key!=="Backspace"||so()&&document.activeElement!==t.dom)return!1;const{state:n}=t,{selection:r,doc:i}=n;if(r.empty&&r.from===1){const s=i.firstChild,o=i.childCount>1?i.child(1):null;if(s&&s.type.name==="paragraph"&&s.content.size===0&&o&&o.type.name==="image")return t.dispatch(n.tr.delete(0,s.nodeSize)),!0}return!1}}})]}});var Qfe=Ce('<div class="loader-container svelte-11vtpur"><div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div></div>'),Yfe=Ce('<div class="placeholder-image svelte-11vtpur" aria-hidden="true"></div>'),Jfe=Ce('<span class="placeholder-text loading-text svelte-11vtpur"> </span>'),ehe=Ce("<div><!> <!> <!></div>");function Ic(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ce(e,"text",3,!1),o=ce(e,"showImage",3,!1),a=ce(e,"showLoader",3,!1),l=ce(e,"customClass",3,""),c=oe(()=>typeof s()=="string"?s():s()===!0?n()("loadingPlaceholder.loading"):"");var u=ehe(),d=ie(u);{var f=y=>{var b=Qfe();Y(y,b)};He(d,y=>{a()&&y(f)})}var h=ve(d,2);{var p=y=>{var b=Yfe();Y(y,b)};He(h,y=>{o()&&y(p)})}var m=ve(h,2);{var g=y=>{var b=Jfe(),x=ie(b);Ge(()=>Be(x,E(c))),Y(y,b)};He(m,y=>{E(c)&&y(g)})}Ge(()=>{Qo(u,1,`loading-placeholder ${l()??""}`,"svelte-11vtpur"),fn(u,"aria-label",E(c))}),Y(t,u),vt(),i()}var the=Ce("<button><!></button>");function Lt(t,e){wt(e,!0);let n=ce(e,"className",3,""),r=ce(e,"disabled",3,!1),i=ce(e,"type",3,"button"),s=ce(e,"ariaLabel",3,""),o=ce(e,"style",3,""),a=ce(e,"variant",3,"default"),l=ce(e,"shape",3,"rounded"),c=ce(e,"onClick",3,void 0),u=ce(e,"selected",3,!1),d=Ni(e,["$$slots","$$events","$$legacy","className","disabled","type","ariaLabel","style","variant","shape","children","onClick","selected"]);function f(m){c()&&c()(m)}var h=the();kr(h,()=>({type:i(),class:`${n()} ${a()} ${l()} ${u()?"selected":""}`,disabled:r(),"aria-label":s(),style:o(),onclick:f,...d}),void 0,void 0,void 0,"svelte-1klcfz0");var p=ie(h);kt(p,()=>e.children??Bt),Y(t,h),vt()}function nhe(t,e={}){const{collapseEmptyLines:n=!1,maxConsecutiveEmptyLines:r=2}=e;let i=$6(t);if(n){const o=new RegExp(`\\n{${r+2},}`,"g");i=i.replace(o,`
`.repeat(r+1))}let s=i.split(`
`);return s.length>0&&s[s.length-1]===""&&(s=s.slice(0,-1)),s.length===1&&s[0]===""&&(s=[]),{normalized:i,lines:s}}function rhe(t){return t.join(`
`)}async function Pw(t,e="",n,r){const i=n??navigator;try{if(i?.clipboard&&typeof i.clipboard.writeText=="function"){await i.clipboard.writeText(t),console.log(`${e} copied to clipboard`);return}}catch(s){console.error(`Failed to copy ${e}:`,s),await J3(t,e,r);return}await J3(t,e,r)}async function J3(t,e="",n){const r=n??window;try{const i=r&&r.document||document,s=i.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-9999px",s.style.top="0",s.setAttribute("readonly","true"),i.body.appendChild(s),s.focus(),s.select();const o=i.execCommand&&i.execCommand("copy");if(i.body.removeChild(s),o)console.log(`${e} copied to clipboard (fallback)`);else throw new Error("fallback_copy_failed")}catch(i){console.warn(`Failed to copy ${e} (both clipboard API and fallback failed):`,i)}}var ihe=Ce('<video controls playsinline="" autoplay loop preload="metadata"><track kind="captions"/> </video>',2),she=Ce('<div class="close-icon svg-icon svelte-gkj9ee"></div>'),ohe=Ce('<div class="copy-icon svg-icon"></div>'),ahe=Ce('<div class="video-node-container svelte-gkj9ee"><div class="video-wrapper svelte-gkj9ee" data-video-node="" role="button" tabindex="0"><!></div> <!> <!></div>');function lhe(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ye(void 0),o=ye(!1),a=ye(void 0),l=oe(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src?.startsWith("placeholder-")||e.node.attrs.src?.startsWith("blob:")||!e.node.attrs.src),c=oe(()=>e.node.attrs.id||(typeof e.getPos=="function"?(e.getPos()??"unknown").toString():"unknown"));function u(){Q(o,!0)}function d(){E(l)||console.error("Failed to load video:",e.node.attrs.src)}function f(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}function h(_){E(l)||f()||_.target!==E(s)&&(_.stopPropagation(),_.preventDefault(),op(e.getPos))}function p(_){if(!E(l)&&!f()&&_.button!==2){if(E(s)){const k=E(s).getBoundingClientRect(),T=_.clientY,O=k.bottom;if(T>O-48)return}_.stopPropagation(),op(e.getPos)}}function m(_){(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),op(e.getPos))}function g(_){_.stopPropagation(),e.deleteNode()}let y=0,b={x:0,y:0};const x=200,C=10;function P(_){if(E(l)||_.touches.length!==1)return;y=Date.now();const k=_.touches[0];b={x:k.clientX,y:k.clientY}}function S(_){if(E(l)||f())return;if(Date.now()-y<x&&_.changedTouches.length===1){const O=_.changedTouches[0],M={x:O.clientX,y:O.clientY};if(Math.sqrt(Math.pow(M.x-b.x,2)+Math.pow(M.y-b.y,2))<C){if(E(s)){const F=E(s).getBoundingClientRect(),B=O.clientY,R=F.bottom;if(B>R-48)return}_.stopPropagation(),op(e.getPos)}}}Vs(()=>(E(s)&&(E(s).addEventListener("touchstart",P,{passive:!1}),E(s).addEventListener("touchend",S,{passive:!1})),()=>{E(s)&&(E(s).removeEventListener("touchstart",P),E(s).removeEventListener("touchend",S))})),N6(t,{children:(_,k)=>{var T=ahe(),O=ie(T);O.__click=h,O.__keydown=m;var M=ie(O);{var L=A=>{{let N=oe(()=>n()("videoNode.uploading"));Ic(A,{get text(){return E(N)},showLoader:!0})}},F=A=>{var N=ihe();N.muted=!0;let z;N.__click=p,N.__touchstart=P,N.__touchend=S;var U=ve(ie(N));Ar(N,V=>Q(s,V),()=>E(s)),Ge(V=>{fn(N,"src",e.node.attrs.src),z=Qo(N,1,"editor-video svelte-gkj9ee",null,z,{loaded:E(o)}),fn(N,"data-node-id",E(c)),Be(U,` ${V??""}`)},[()=>n()("videoNode.not_supported")]),Is("loadeddata",N,u),Is("error",N,d),Y(A,N)};He(M,A=>{E(l)?A(L):A(F,!1)})}Ar(O,A=>Q(a,A),()=>E(a));var B=ve(O,2);{let A=oe(()=>n()("videoContextMenu.delete"));Lt(B,{variant:"close",shape:"circle",className:"video-close-button",get ariaLabel(){return E(A)},onClick:g,children:(N,z)=>{var U=she();Y(N,U)},$$slots:{default:!0}})}var R=ve(B,2);{let A=oe(()=>n()("videoContextMenu.copyUrl"));Lt(R,{variant:"copy",shape:"circle",className:"video-copy-button",get ariaLabel(){return E(A)},onClick:N=>{N.stopPropagation(),Pw(e.node.attrs.src,"video URL");const z={x:N.clientX,y:N.clientY};Ys.showPopupMessage(z.x,z.y,n()("videoContextMenu.copySuccess"))},children:(N,z)=>{var U=ohe();Y(N,U)},$$slots:{default:!0}})}Y(_,T)},$$slots:{default:!0}}),vt(),i()}Mi(["click","keydown","touchstart","touchend"]);const che=Ri.create({name:"video",group:"block",draggable:!1,addAttributes(){return{src:{default:null},isPlaceholder:{default:!1}}},parseHTML(){return[{tag:"video[src]"}]},renderHTML({HTMLAttributes:t}){return["video",Yn(t,{controls:!0})]},addNodeView(){return M6(lhe)}});function uhe(t){const e=[];return t.content.forEach(n=>{if(n.type.name==="paragraph"){let r="";n.content.forEach(i=>{i.isText&&(r+=i.text||"")}),e.push(r)}else if(n.type.name==="image"||n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}else n.isTextblock&&e.push(n.textContent)}),e}const dhe=pn.create({name:"clipboardExtension",addProseMirrorPlugins(){return[new Jt({key:new Sn("clipboardExtension"),props:{handlePaste(t,e,n){const{state:r,dispatch:i}=t,{clipboardData:s}=e;if(!s||s.files&&s.files.length>0)return!1;const a=s.getData("text/plain");if(!a)return!1;const l=s.types.includes("text/html");let c=!1;if(l){const g=s.getData("text/html");if(g.includes("<strong>")||g.includes("<b>")||g.includes("<em>")||g.includes("<i>")||g.includes("<a ")||g.includes("<a>"))return!1;c=g.includes('data-block="true"')&&g.includes("data-editor=")}const{lines:u}=nhe(a,{collapseEmptyLines:c,maxConsecutiveEmptyLines:1});if(u.length===0)return!1;const d=u.join(`
`),f=r.schema.text(d),h=Fe.from(f),p=new it(h,0,0),m=r.tr.replaceSelection(p).setMeta("paste",!0).setMeta("uiEvent","paste").setMeta("addToHistory",!0);return i(m),!0},clipboardTextSerializer(t){const e=uhe(t);return rhe(e)}}})]}}),eO=typeof navigator<"u"&&/android/i.test(navigator.userAgent),fhe=4e3,hhe=pn.create({name:"androidCompositionFix",addStorage(){return{keepAliveInterval:null,isComposing:!1}},onCreate(){if(!eO)return;const t=this.editor,e=this.storage,n=()=>{e.isComposing=!0,e.keepAliveInterval&&clearInterval(e.keepAliveInterval),e.keepAliveInterval=setInterval(()=>{if(e.isComposing&&t.view.composing){const i=new CompositionEvent("compositionupdate",{bubbles:!0,cancelable:!0,data:""});t.view.dom.dispatchEvent(i)}},fhe)},r=()=>{e.isComposing=!1,e.keepAliveInterval&&(clearInterval(e.keepAliveInterval),e.keepAliveInterval=null)};t.view.dom.addEventListener("compositionstart",n),t.view.dom.addEventListener("compositionend",r),this.__compositionStartHandler=n,this.__compositionEndHandler=r},onDestroy(){if(!eO)return;const t=this.storage;t.keepAliveInterval&&(clearInterval(t.keepAliveInterval),t.keepAliveInterval=null);const e=this.__compositionStartHandler,n=this.__compositionEndHandler;this.editor?.view?.dom&&(e&&this.editor.view.dom.removeEventListener("compositionstart",e),n&&this.editor.view.dom.removeEventListener("compositionend",n))}});function phe(t){var e;const{char:n,allowSpaces:r,allowToIncludeChar:i,allowedPrefixes:s,startOfLine:o,$position:a}=t,l=r&&!i,c=Zde(n),u=new RegExp(`\\s${c}$`),d=o?"^":"",f=i?"":c,h=l?new RegExp(`${d}${c}.*?(?=\\s${f}|$)`,"gm"):new RegExp(`${d}(?:^)?${c}[^\\s${f}]*`,"gm"),p=((e=a.nodeBefore)==null?void 0:e.isText)&&a.nodeBefore.text;if(!p)return null;const m=a.pos-p.length,g=Array.from(p.matchAll(h)).pop();if(!g||g.input===void 0||g.index===void 0)return null;const y=g.input.slice(Math.max(0,g.index-1),g.index),b=new RegExp(`^[${s?.join("")}\0]?$`).test(y);if(s!==null&&!b)return null;const x=m+g.index;let C=x+g[0].length;return l&&u.test(p.slice(C-1,C+1))&&(g[0]+=" ",C+=1),x<a.pos&&C>=a.pos?{range:{from:x,to:C},query:g[0].slice(n.length),text:g[0]}:null}var mhe=new Sn("suggestion");function ghe({pluginKey:t=mhe,editor:e,char:n="@",allowSpaces:r=!1,allowToIncludeChar:i=!1,allowedPrefixes:s=[" "],startOfLine:o=!1,decorationTag:a="span",decorationClass:l="suggestion",decorationContent:c="",decorationEmptyClass:u="is-empty",command:d=()=>null,items:f=()=>[],render:h=()=>({}),allow:p=()=>!0,findSuggestionMatch:m=phe,shouldShow:g}){let y;const b=h?.(),x=()=>{const _=e.state.selection.$anchor.pos,k=e.view.coordsAtPos(_),{top:T,right:O,bottom:M,left:L}=k;try{return new DOMRect(L,T,O-L,M-T)}catch{return null}},C=(_,k)=>k?()=>{const T=t.getState(e.state),O=T?.decorationId,M=_.dom.querySelector(`[data-decoration-id="${O}"]`);return M?.getBoundingClientRect()||null}:x;function P(_,k){var T;try{const M=t.getState(_.state),L=M?.decorationId?_.dom.querySelector(`[data-decoration-id="${M.decorationId}"]`):null,F={editor:e,range:M?.range||{from:0,to:0},query:M?.query||null,text:M?.text||null,items:[],command:B=>d({editor:e,range:M?.range||{from:0,to:0},props:B}),decorationNode:L,clientRect:C(_,L)};(T=b?.onExit)==null||T.call(b,F)}catch{}const O=_.state.tr.setMeta(k,{exit:!0});_.dispatch(O)}const S=new Jt({key:t,view(){return{update:async(_,k)=>{var T,O,M,L,F,B,R;const A=(T=this.key)==null?void 0:T.getState(k),N=(O=this.key)==null?void 0:O.getState(_.state),z=A.active&&N.active&&A.range.from!==N.range.from,U=!A.active&&N.active,V=A.active&&!N.active,q=!U&&!V&&A.query!==N.query,G=U||z&&q,ne=q||z,te=V||z&&q;if(!G&&!ne&&!te)return;const Z=te&&!G?A:N,ae=_.dom.querySelector(`[data-decoration-id="${Z.decorationId}"]`);y={editor:e,range:Z.range,query:Z.query,text:Z.text,items:[],command:_e=>d({editor:e,range:Z.range,props:_e}),decorationNode:ae,clientRect:C(_,ae)},G&&((M=b?.onBeforeStart)==null||M.call(b,y)),ne&&((L=b?.onBeforeUpdate)==null||L.call(b,y)),(ne||G)&&(y.items=await f({editor:e,query:Z.query})),te&&((F=b?.onExit)==null||F.call(b,y)),ne&&((B=b?.onUpdate)==null||B.call(b,y)),G&&((R=b?.onStart)==null||R.call(b,y))},destroy:()=>{var _;y&&((_=b?.onExit)==null||_.call(b,y))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(_,k,T,O){const{isEditable:M}=e,{composing:L}=e.view,{selection:F}=_,{empty:B,from:R}=F,A={...k},N=_.getMeta(t);if(N&&N.exit)return A.active=!1,A.decorationId=null,A.range={from:0,to:0},A.query=null,A.text=null,A;if(A.composing=L,M&&(B||e.view.composing)){(R<k.range.from||R>k.range.to)&&!L&&!k.composing&&(A.active=!1);const z=m({char:n,allowSpaces:r,allowToIncludeChar:i,allowedPrefixes:s,startOfLine:o,$position:F.$from}),U=`id_${Math.floor(Math.random()*4294967295)}`;z&&p({editor:e,state:O,range:z.range,isActive:k.active})&&(!g||g({editor:e,range:z.range,query:z.query,text:z.text,transaction:_}))?(A.active=!0,A.decorationId=k.decorationId?k.decorationId:U,A.range=z.range,A.query=z.query,A.text=z.text):A.active=!1}else A.active=!1;return A.active||(A.decorationId=null,A.range={from:0,to:0},A.query=null,A.text=null),A}},props:{handleKeyDown(_,k){var T,O,M,L;const{active:F,range:B}=S.getState(_.state);if(!F)return!1;if(k.key==="Escape"||k.key==="Esc"){const A=S.getState(_.state),N=(T=y?.decorationNode)!=null?T:null,z=N??(A?.decorationId?_.dom.querySelector(`[data-decoration-id="${A.decorationId}"]`):null);if(((O=b?.onKeyDown)==null?void 0:O.call(b,{view:_,event:k,range:A.range}))||!1)return!0;const V={editor:e,range:A.range,query:A.query,text:A.text,items:[],command:q=>d({editor:e,range:A.range,props:q}),decorationNode:z,clientRect:z?()=>z.getBoundingClientRect()||null:null};return(M=b?.onExit)==null||M.call(b,V),P(_,t),!0}return((L=b?.onKeyDown)==null?void 0:L.call(b,{view:_,event:k,range:B}))||!1},decorations(_){const{active:k,range:T,decorationId:O,query:M}=S.getState(_);if(!k)return null;const L=!M?.length,F=[l];return L&&F.push(u),wn.create(_.doc,[mr.inline(T.from,T.to,{nodeName:a,class:F.join(" "),"data-decoration-id":O,"data-decoration-content":c})])}}});return S}var yhe=ghe,bhe=Ce('<li role="option"><span class="hashtag-prefix svelte-17vo95w">#</span> </li>'),whe=Ce('<ul class="hashtag-suggestion-list svelte-17vo95w" role="listbox"></ul>');function vhe(t,e){wt(e,!0);let n=ye(0);function r(){e.items.length>0&&Q(n,(E(n)+1)%e.items.length)}function i(){e.items.length>0&&Q(n,(E(n)-1+e.items.length)%e.items.length)}function s(){const d=e.items[E(n)];return d!==void 0?(e.onSelect(d),!0):!1}function o(){Q(n,0)}var a={moveDown:r,moveUp:i,confirmSelection:s,resetIndex:o},l=ze(),c=Te(l);{var u=d=>{var f=whe();Ma(f,22,()=>e.items,h=>h,(h,p,m)=>{var g=bhe();let y;g.__mousedown=x=>{x.preventDefault(),e.onSelect(p)};var b=ve(ie(g),1,!0);Ge(()=>{y=Qo(g,1,"hashtag-suggestion-item svelte-17vo95w",null,y,{selected:E(m)===E(n)}),fn(g,"aria-selected",E(m)===E(n)),Be(b,p)}),Is("mouseenter",g,()=>{Q(n,E(m),!0)}),Y(h,g)}),Y(d,f)};He(c,d=>{e.items.length>0&&d(u)})}return Y(t,l),vt(a)}Mi(["mousedown"]);const xhe=50,tO=5,She=100;function W6(){try{const t=localStorage.getItem(Hr.HASHTAG_HISTORY);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e.filter(n=>typeof n?.tag=="string"&&typeof n?.lastUsed=="number"):[]}catch{return[]}}function khe(t){try{localStorage.setItem(Hr.HASHTAG_HISTORY,JSON.stringify(t))}catch{}}function Ehe(t){if(!t.length)return;const e=Date.now(),n=W6();for(const r of t){if(!r||r.length>She)continue;const i=r.toLowerCase(),s=n.findIndex(o=>o.tag.toLowerCase()===i);s>=0?n[s].lastUsed=e:n.push({tag:r,lastUsed:e})}n.sort((r,i)=>i.lastUsed-r.lastUsed),khe(n.slice(0,xhe))}function The(t){const e=W6();if(!e.length)return[];if(!t)return e.sort((s,o)=>o.lastUsed-s.lastUsed).slice(0,tO).map(s=>s.tag);const n=t.toLowerCase(),r=[],i=[];for(const s of e){const o=s.tag.toLowerCase();o.startsWith(n)?r.push(s):o.includes(n)&&i.push(s)}return r.sort((s,o)=>o.lastUsed-s.lastUsed),i.sort((s,o)=>o.lastUsed-s.lastUsed),[...r,...i].slice(0,tO).map(s=>s.tag)}const Che=pn.create({name:"hashtagSuggestion",addProseMirrorPlugins(){return[yhe({editor:this.editor,char:"#",allowSpaces:!1,allowedPrefixes:[" ",`
`,"	","ã"],items:({query:t})=>The(t),render:()=>{let t=null,e=null,n=[],r=null;function i(){return t??{}}function s(){!e||!r||(t&&(gp(t),t=null),n.length&&(t=Rb(vhe,{target:e,props:{items:n,onSelect:r}})))}function o(c){if(!e||!c)return;const u=c();if(!u)return;const d=window.innerHeight,f=200,h=d-u.bottom;e.style.left=`${Math.max(0,u.left)}px`,h<f&&u.top>f?e.style.top=`${u.top-f-4}px`:e.style.top=`${u.bottom+4}px`}function a(){const c=document.createElement("div");return c.style.position="fixed",c.style.zIndex="9999",document.body.appendChild(c),c}function l(){t&&(gp(t),t=null),e&&(e.remove(),e=null),n=[],r=null}return{onStart(c){n=c.items??[],r=c.command,n.length&&(e=a(),s(),requestAnimationFrame(()=>o(c.clientRect)))},onUpdate(c){if(n=c.items??[],r=c.command,!n.length){t&&(gp(t),t=null);return}e||(e=a()),s(),i().resetIndex?.(),requestAnimationFrame(()=>o(c.clientRect))},onKeyDown(c){if(!n.length)return!1;const u=i();switch(c.event.key){case"ArrowDown":return u.moveDown?.(),!0;case"ArrowUp":return u.moveUp?.(),!0;case"Enter":case"Tab":return u.confirmSelection?.()??!1;default:return!1}},onExit(){l()}}},command:({editor:t,range:e,props:n})=>{t.chain().focus().deleteRange(e).insertContent("#"+n+" ").run()}})]}});var $y=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...r}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,r,n]},_he=/^\s*>\s$/,Ahe=Ri.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return $y("blockquote",{...Yn(this.options.HTMLAttributes,t),children:$y("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=">",r=[];return t.content.forEach(i=>{const a=e.renderChildren([i]).split(`
`).map(l=>l.trim()===""?n:`${n} ${l}`);r.push(a.join(`
`))}),r.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Xf({find:_he,type:this.type})]}}),Phe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Ihe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Ohe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Mhe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Nhe=wd.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return $y("strong",{...Yn(this.options.HTMLAttributes,t),children:$y("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Zf({find:Phe,type:this.type}),Zf({find:Ohe,type:this.type})]},addPasteRules(){return[dd({find:Ihe,type:this.type}),dd({find:Mhe,type:this.type})]}}),Rhe=/(^|[^`])`([^`]+)`(?!`)$/,Dhe=/(^|[^`])`([^`]+)`(?!`)/g,Lhe=wd.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Zf({find:Rhe,type:this.type})]},addPasteRules(){return[dd({find:Dhe,type:this.type})]}}),f2=4,Bhe=/^```([a-z]+)?[\s\n]$/,Fhe=/^~~~([a-z]+)?[\s\n]$/,$he=Ri.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:f2,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const s=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Yn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let r="";const i=((n=t.attrs)==null?void 0:n.language)||"";return t.content?r=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):r=`\`\`\`${i}

\`\`\``,r},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:f2,{state:r}=t,{selection:i}=r,{$from:s,empty:o}=i;if(s.parent.type!==this.type)return!1;const a=" ".repeat(n);return o?t.commands.insertContent(a):t.commands.command(({tr:l})=>{const{from:c,to:u}=i,h=r.doc.textBetween(c,u,`
`,`
`).split(`
`).map(p=>a+p).join(`
`);return l.replaceWith(c,u,r.schema.text(h)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:f2,{state:r}=t,{selection:i}=r,{$from:s,empty:o}=i;return s.parent.type!==this.type?!1:o?t.commands.command(({tr:a})=>{var l;const{pos:c}=s,u=s.start(),d=s.end(),h=r.doc.textBetween(u,d,`
`,`
`).split(`
`);let p=0,m=0;const g=c-u;for(let S=0;S<h.length;S+=1){if(m+h[S].length>=g){p=S;break}m+=h[S].length+1}const b=((l=h[p].match(/^ */))==null?void 0:l[0])||"",x=Math.min(b.length,n);if(x===0)return!0;let C=u;for(let S=0;S<p;S+=1)C+=h[S].length+1;return a.delete(C,C+x),c-C<=x&&a.setSelection(Et.create(a.doc,C)),!0}):t.commands.command(({tr:a})=>{const{from:l,to:c}=i,f=r.doc.textBetween(l,c,`
`,`
`).split(`
`).map(h=>{var p;const m=((p=h.match(/^ */))==null?void 0:p[0])||"",g=Math.min(m.length,n);return h.slice(g)}).join(`
`);return a.replaceWith(l,c,r.schema.text(f)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(Dt.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[ES({find:Bhe,type:this.type,getAttributes:t=>({language:t[1]})}),ES({find:Fhe,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Jt({key:new Sn("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i?.mode;if(!n||!s)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(Et.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),zhe=Ri.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),Uhe=Ri.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Yn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(f=>a.includes(f.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Hhe=Ri.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Yn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const r=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,i="#".repeat(r);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>ES({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),Vhe=Ri.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Yn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!Gde(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:r}=n,i=t();return f6(n)?i.insertContentAt(r.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:s,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(Et.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(ut.create(o.doc,l.pos)):o.setSelection(Et.create(o.doc,l.pos));else{const u=s.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,d=u?.create();d&&(o.insert(c,d),o.setSelection(Et.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[P6({find:/^(?:---|â-|___\s|\*\*\*\s)$/,type:this.type})]}}),Whe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,jhe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,qhe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Khe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Ghe=wd.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Yn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Zf({find:Whe,type:this.type}),Zf({find:qhe,type:this.type})]},addPasteRules(){return[dd({find:jhe,type:this.type}),dd({find:Khe,type:this.type})]}});const Zhe="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Xhe="ÎµÎ»1Ï2Ð±Ð³1ÐµÐ»3Ð´ÐµÑÐ¸4ÐµÑ2ÐºÐ°ÑÐ¾Ð»Ð¸Ðº6Ð¾Ð¼3Ð¼ÐºÐ´2Ð¾Ð½1ÑÐºÐ²Ð°6Ð¾Ð½Ð»Ð°Ð¹Ð½5ÑÐ³3ÑÑÑ2Ñ2ÑÐ°Ð¹Ñ3ÑÐ±3ÑÐºÑ3ÒÐ°Ð·3Õ°Õ¡Õµ3××©×¨××5×§××3Ø§Ø¨ÙØ¸Ø¨Ù5Ø±Ø§ÙÙÙ5ÙØ§Ø±Ø¯Ù4Ø¨Ø­Ø±ÙÙ5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙØ¯ÙØ©6Ø¹ÙÙØ§Ù5ÙØºØ±Ø¨5ÙØ§Ø±Ø§Øª5ÛØ±Ø§Ù5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙØªÙ3Ú¾Ø§Ø±Øª5ØªÙÙØ³4Ø³ÙØ¯Ø§Ù3Ø±ÙØ©5Ø´Ø¨ÙØ©4Ø¹Ø±Ø§Ù2Ø¨2ÙØ§Ù4ÙÙØ³Ø·ÙÙ6ÙØ·Ø±3ÙØ§Ø«ÙÙÙÙ6ÙÙ3ÙØµØ±2ÙÙØ³ÙØ§5ÙØ±ÙØªØ§ÙÙØ§7ÙØ¹4ÙÙØ±Ø§Ù5Ù¾Ø§Ú©Ø³ØªØ§Ù7ÚØ§Ø±Øª4à¤à¥à¤®3à¤¨à¥à¤3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥à¤¤5à¤¸à¤à¤à¤ à¤¨5à¦¬à¦¾à¦à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®à®¨à¯à®¤à®¿à®¯à®¾6à®²à®à¯à®à¯6à®à®¿à®à¯à®à®ªà¯à®ªà¯à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´5à¶½à¶à¶à·4à¸à¸­à¸¡3à¹à¸à¸¢3àº¥àº²àº§3áá2ã¿ããª3ã¢ãã¾ã³4ã¯ã©ã¦ã4ã°ã¼ã°ã«4ã³ã 2ã¹ãã¢3ã»ã¼ã«3ãã¡ãã·ã§ã³6ãã¤ã³ã4ä¸ç2ä¸­ä¿¡1å½1å1æç½3äºé©¬é3ä¼ä¸2ä½å±±2ä¿¡æ¯2å¥åº·2å«å¦2å¬å¸1ç2å°æ¹¾1ç£2åå1åº1æ 2åé0å¤§éåº5å¨çº¿2å¤§æ¿2å¤©ä¸»æ3å¨±ä¹2å®¶é»2å¹¿ä¸2å¾®å2æå2æç±ä½ 3ææº2æè2æ¿å¡1åº2æ°å å¡2é»2æ¶å°2æ¸ç±2æºæ2æ·¡é©¬é¡3æ¸¸æ2æ¾³é2ç¹ç2ç§»å¨2ç»ç»æºæ4ç½å1åº1ç«1ç»2èé2è°·æ­2è´­ç©2éè²©2éå¢2é»è¨çç§4é£å©æµ¦3é£å2é¤å2é¦æ ¼éæ3æ¸¯2ë·ë·1ì»´2ì¼ì±2íêµ­2",IS="numeric",OS="ascii",MS="alpha",Lp="asciinumeric",dp="alphanumeric",NS="domain",j6="emoji",Qhe="scheme",Yhe="slashscheme",h2="whitespace";function Jhe(t,e){return t in e||(e[t]=[]),e[t]}function Ru(t,e,n){e[IS]&&(e[Lp]=!0,e[dp]=!0),e[OS]&&(e[Lp]=!0,e[MS]=!0),e[Lp]&&(e[dp]=!0),e[MS]&&(e[dp]=!0),e[dp]&&(e[NS]=!0),e[j6]&&(e[NS]=!0);for(const r in e){const i=Jhe(r,n);i.indexOf(t)<0&&i.push(t)}}function epe(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Vi(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Vi.groups={};Vi.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(t))return s}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let i=0;i<t.length;i++)this.tt(t[i],e,n,r)},tr(t,e,n,r){r=r||Vi.groups;let i;return e&&e.j?i=e:(i=new Vi(e),n&&r&&Ru(e,n,r)),this.jr.push([t,i]),i},ts(t,e,n,r){let i=this;const s=t.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(t[o]);return i.tt(t[s-1],e,n,r)},tt(t,e,n,r){r=r||Vi.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const s=e;let o,a=i.go(t);if(a?(o=new Vi,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Vi,s){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(epe(o.t,r),n);Ru(s,l,r)}else n&&Ru(s,n,r);o.t=s}return i.j[t]=o,o}};const Rt=(t,e,n,r,i)=>t.ta(e,n,r,i),Gn=(t,e,n,r,i)=>t.tr(e,n,r,i),nO=(t,e,n,r,i)=>t.ts(e,n,r,i),Ue=(t,e,n,r,i)=>t.tt(e,n,r,i),Ea="WORD",RS="UWORD",q6="ASCIINUMERICAL",K6="ALPHANUMERICAL",gm="LOCALHOST",DS="TLD",LS="UTLD",b0="SCHEME",Gd="SLASH_SCHEME",eC="NUM",BS="WS",tC="NL",Bp="OPENBRACE",Fp="CLOSEBRACE",zy="OPENBRACKET",Uy="CLOSEBRACKET",Hy="OPENPAREN",Vy="CLOSEPAREN",Wy="OPENANGLEBRACKET",jy="CLOSEANGLEBRACKET",qy="FULLWIDTHLEFTPAREN",Ky="FULLWIDTHRIGHTPAREN",Gy="LEFTCORNERBRACKET",Zy="RIGHTCORNERBRACKET",Xy="LEFTWHITECORNERBRACKET",Qy="RIGHTWHITECORNERBRACKET",Yy="FULLWIDTHLESSTHAN",Jy="FULLWIDTHGREATERTHAN",eb="AMPERSAND",tb="APOSTROPHE",nb="ASTERISK",ec="AT",rb="BACKSLASH",ib="BACKTICK",sb="CARET",ac="COLON",nC="COMMA",ob="DOLLAR",Ao="DOT",ab="EQUALS",rC="EXCLAMATION",Ss="HYPHEN",$p="PERCENT",lb="PIPE",cb="PLUS",ub="POUND",zp="QUERY",iC="QUOTE",G6="FULLWIDTHMIDDLEDOT",sC="SEMI",Po="SLASH",Up="TILDE",db="UNDERSCORE",Z6="EMOJI",fb="SYM";var X6=Object.freeze({__proto__:null,ALPHANUMERICAL:K6,AMPERSAND:eb,APOSTROPHE:tb,ASCIINUMERICAL:q6,ASTERISK:nb,AT:ec,BACKSLASH:rb,BACKTICK:ib,CARET:sb,CLOSEANGLEBRACKET:jy,CLOSEBRACE:Fp,CLOSEBRACKET:Uy,CLOSEPAREN:Vy,COLON:ac,COMMA:nC,DOLLAR:ob,DOT:Ao,EMOJI:Z6,EQUALS:ab,EXCLAMATION:rC,FULLWIDTHGREATERTHAN:Jy,FULLWIDTHLEFTPAREN:qy,FULLWIDTHLESSTHAN:Yy,FULLWIDTHMIDDLEDOT:G6,FULLWIDTHRIGHTPAREN:Ky,HYPHEN:Ss,LEFTCORNERBRACKET:Gy,LEFTWHITECORNERBRACKET:Xy,LOCALHOST:gm,NL:tC,NUM:eC,OPENANGLEBRACKET:Wy,OPENBRACE:Bp,OPENBRACKET:zy,OPENPAREN:Hy,PERCENT:$p,PIPE:lb,PLUS:cb,POUND:ub,QUERY:zp,QUOTE:iC,RIGHTCORNERBRACKET:Zy,RIGHTWHITECORNERBRACKET:Qy,SCHEME:b0,SEMI:sC,SLASH:Po,SLASH_SCHEME:Gd,SYM:fb,TILDE:Up,TLD:DS,UNDERSCORE:db,UTLD:LS,UWORD:RS,WORD:Ea,WS:BS});const xa=/[a-z]/,Zh=new RegExp("\\p{L}","u"),p2=new RegExp("\\p{Emoji}","u"),Sa=/\d/,m2=/\s/,rO="\r",g2=`
`,tpe="ï¸",npe="â",y2="ï¿¼";let qg=null,Kg=null;function rpe(t=[]){const e={};Vi.groups=e;const n=new Vi;qg==null&&(qg=iO(Zhe)),Kg==null&&(Kg=iO(Xhe)),Ue(n,"'",tb),Ue(n,"{",Bp),Ue(n,"}",Fp),Ue(n,"[",zy),Ue(n,"]",Uy),Ue(n,"(",Hy),Ue(n,")",Vy),Ue(n,"<",Wy),Ue(n,">",jy),Ue(n,"ï¼",qy),Ue(n,"ï¼",Ky),Ue(n,"ã",Gy),Ue(n,"ã",Zy),Ue(n,"ã",Xy),Ue(n,"ã",Qy),Ue(n,"ï¼",Yy),Ue(n,"ï¼",Jy),Ue(n,"&",eb),Ue(n,"*",nb),Ue(n,"@",ec),Ue(n,"`",ib),Ue(n,"^",sb),Ue(n,":",ac),Ue(n,",",nC),Ue(n,"$",ob),Ue(n,".",Ao),Ue(n,"=",ab),Ue(n,"!",rC),Ue(n,"-",Ss),Ue(n,"%",$p),Ue(n,"|",lb),Ue(n,"+",cb),Ue(n,"#",ub),Ue(n,"?",zp),Ue(n,'"',iC),Ue(n,"/",Po),Ue(n,";",sC),Ue(n,"~",Up),Ue(n,"_",db),Ue(n,"\\",rb),Ue(n,"ã»",G6);const r=Gn(n,Sa,eC,{[IS]:!0});Gn(r,Sa,r);const i=Gn(r,xa,q6,{[Lp]:!0}),s=Gn(r,Zh,K6,{[dp]:!0}),o=Gn(n,xa,Ea,{[OS]:!0});Gn(o,Sa,i),Gn(o,xa,o),Gn(i,Sa,i),Gn(i,xa,i);const a=Gn(n,Zh,RS,{[MS]:!0});Gn(a,xa),Gn(a,Sa,s),Gn(a,Zh,a),Gn(s,Sa,s),Gn(s,xa),Gn(s,Zh,s);const l=Ue(n,g2,tC,{[h2]:!0}),c=Ue(n,rO,BS,{[h2]:!0}),u=Gn(n,m2,BS,{[h2]:!0});Ue(n,y2,u),Ue(c,g2,l),Ue(c,y2,u),Gn(c,m2,u),Ue(u,rO),Ue(u,g2),Gn(u,m2,u),Ue(u,y2,u);const d=Gn(n,p2,Z6,{[j6]:!0});Ue(d,"#"),Gn(d,p2,d),Ue(d,tpe,d);const f=Ue(d,npe);Ue(f,"#"),Gn(f,p2,d);const h=[[xa,o],[Sa,i]],p=[[xa,null],[Zh,a],[Sa,s]];for(let m=0;m<qg.length;m++)Vl(n,qg[m],DS,Ea,h);for(let m=0;m<Kg.length;m++)Vl(n,Kg[m],LS,RS,p);Ru(DS,{tld:!0,ascii:!0},e),Ru(LS,{utld:!0,alpha:!0},e),Vl(n,"file",b0,Ea,h),Vl(n,"mailto",b0,Ea,h),Vl(n,"http",Gd,Ea,h),Vl(n,"https",Gd,Ea,h),Vl(n,"ftp",Gd,Ea,h),Vl(n,"ftps",Gd,Ea,h),Ru(b0,{scheme:!0,ascii:!0},e),Ru(Gd,{slashscheme:!0,ascii:!0},e),t=t.sort((m,g)=>m[0]>g[0]?1:-1);for(let m=0;m<t.length;m++){const g=t[m][0],b=t[m][1]?{[Qhe]:!0}:{[Yhe]:!0};g.indexOf("-")>=0?b[NS]=!0:xa.test(g)?Sa.test(g)?b[Lp]=!0:b[OS]=!0:b[IS]=!0,nO(n,g,g,b)}return nO(n,"localhost",gm,{ascii:!0}),n.jd=new Vi(fb),{start:n,tokens:Object.assign({groups:e},X6)}}function Q6(t,e){const n=ipe(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,i=[];let s=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,d=-1,f=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(d=0,f=0,u=a):d>=0&&(d+=n[o].length,f++),c+=n[o].length,s+=n[o].length,o++;s-=d,o-=f,c-=d,i.push({t:u.t,v:e.slice(s-c,s),s:s-c,e:s})}return i}function ipe(t){const e=[],n=t.length;let r=0;for(;r<n;){let i=t.charCodeAt(r),s,o=i<55296||i>56319||r+1===n||(s=t.charCodeAt(r+1))<56320||s>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function Vl(t,e,n,r,i){let s;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?s=t.j[l]:(s=new Vi(r),s.jr=i.slice(),t.j[l]=s),t=s}return s=new Vi(n),s.jr=i.slice(),t.j[e[o-1]]=s,s}function iO(t){const e=[],n=[];let r=0,i="0123456789";for(;r<t.length;){let s=0;for(;i.indexOf(t[r+s])>=0;)s++;if(s>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+s),10);o>0;o--)n.pop();r+=s}else n.push(t[r]),r++}return e}const ym={defaultProtocol:"http",events:null,format:sO,formatHref:sO,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function oC(t,e=null){let n=Object.assign({},ym);t&&(n=Object.assign(n,t instanceof oC?t.o:t));const r=n.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=i}oC.prototype={o:ym,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:ym[t],typeof i=="function"&&r&&(i=i(e,n))):typeof i=="function"&&r&&(i=i(e,n.t,n)),i)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function sO(t){return t}function Y6(t,e){this.t="token",this.v=t,this.tk=e}Y6.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"â¦":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=ym.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),i=t.get("tagName",n,e),s=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),d=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:i,attributes:o,content:s,eventListeners:d}}};function Iw(t,e){class n extends Y6{constructor(i,s){super(i,s),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const oO=Iw("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),aO=Iw("text"),spe=Iw("nl"),Gg=Iw("url",{isLink:!0,toHref(t=ym.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==gm&&t[1].t===ac}}),vs=t=>new Vi(t);function ope({groups:t}){const e=t.domain.concat([eb,nb,ec,rb,ib,sb,ob,ab,Ss,eC,$p,lb,cb,ub,Po,fb,Up,db]),n=[tb,ac,nC,Ao,rC,$p,zp,iC,sC,Wy,jy,Bp,Fp,Uy,zy,Hy,Vy,qy,Ky,Gy,Zy,Xy,Qy,Yy,Jy],r=[eb,tb,nb,rb,ib,sb,ob,ab,Ss,Bp,Fp,$p,lb,cb,ub,zp,Po,fb,Up,db],i=vs(),s=Ue(i,Up);Rt(s,r,s),Rt(s,t.domain,s);const o=vs(),a=vs(),l=vs();Rt(i,t.domain,o),Rt(i,t.scheme,a),Rt(i,t.slashscheme,l),Rt(o,r,s),Rt(o,t.domain,o);const c=Ue(o,ec);Ue(s,ec,c),Ue(a,ec,c),Ue(l,ec,c);const u=Ue(s,Ao);Rt(u,r,s),Rt(u,t.domain,s);const d=vs();Rt(c,t.domain,d),Rt(d,t.domain,d);const f=Ue(d,Ao);Rt(f,t.domain,d);const h=vs(oO);Rt(f,t.tld,h),Rt(f,t.utld,h),Ue(c,gm,h);const p=Ue(d,Ss);Ue(p,Ss,p),Rt(p,t.domain,d),Rt(h,t.domain,d),Ue(h,Ao,f),Ue(h,Ss,p);const m=Ue(h,ac);Rt(m,t.numeric,oO);const g=Ue(o,Ss),y=Ue(o,Ao);Ue(g,Ss,g),Rt(g,t.domain,o),Rt(y,r,s),Rt(y,t.domain,o);const b=vs(Gg);Rt(y,t.tld,b),Rt(y,t.utld,b),Rt(b,t.domain,o),Rt(b,r,s),Ue(b,Ao,y),Ue(b,Ss,g),Ue(b,ec,c);const x=Ue(b,ac),C=vs(Gg);Rt(x,t.numeric,C);const P=vs(Gg),S=vs();Rt(P,e,P),Rt(P,n,S),Rt(S,e,P),Rt(S,n,S),Ue(b,Po,P),Ue(C,Po,P);const _=Ue(a,ac),k=Ue(l,ac),T=Ue(k,Po),O=Ue(T,Po);Rt(a,t.domain,o),Ue(a,Ao,y),Ue(a,Ss,g),Rt(l,t.domain,o),Ue(l,Ao,y),Ue(l,Ss,g),Rt(_,t.domain,P),Ue(_,Po,P),Ue(_,zp,P),Rt(O,t.domain,P),Rt(O,e,P),Ue(O,Po,P);const M=[[Bp,Fp],[zy,Uy],[Hy,Vy],[Wy,jy],[qy,Ky],[Gy,Zy],[Xy,Qy],[Yy,Jy]];for(let L=0;L<M.length;L++){const[F,B]=M[L],R=Ue(P,F);Ue(S,F,R),Ue(R,B,P);const A=vs(Gg);Rt(R,e,A);const N=vs();Rt(R,n),Rt(A,e,A),Rt(A,n,N),Rt(N,e,A),Rt(N,n,N),Ue(A,B,P),Ue(N,B,P)}return Ue(i,gm,b),Ue(i,tC,spe),{start:i,tokens:X6}}function ape(t,e,n){let r=n.length,i=0,s=[],o=[];for(;i<r;){let a=t,l=null,c=null,u=0,d=null,f=-1;for(;i<r&&!(l=a.go(n[i].t));)o.push(n[i++]);for(;i<r&&(c=l||a.go(n[i].t));)l=null,a=c,a.accepts()?(f=0,d=a):f>=0&&f++,i++,u++;if(f<0)i-=u,i<r&&(o.push(n[i]),i++);else{o.length>0&&(s.push(b2(aO,e,o)),o=[]),i-=f,u-=f;const h=d.t,p=n.slice(i-u,i);s.push(b2(h,e,p))}}return o.length>0&&s.push(b2(aO,e,o)),s}function b2(t,e,n){const r=n[0].s,i=n[n.length-1].e,s=e.slice(r,i);return new t(s,n)}const lpe=typeof console<"u"&&console&&console.warn||(()=>{}),cpe="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Dn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function upe(){return Vi.groups={},Dn.scanner=null,Dn.parser=null,Dn.tokenQueue=[],Dn.pluginQueue=[],Dn.customSchemes=[],Dn.initialized=!1,Dn}function lO(t,e=!1){if(Dn.initialized&&lpe(`linkifyjs: already initialized - will not register custom scheme "${t}" ${cpe}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Dn.customSchemes.push([t,e])}function dpe(){Dn.scanner=rpe(Dn.customSchemes);for(let t=0;t<Dn.tokenQueue.length;t++)Dn.tokenQueue[t][1]({scanner:Dn.scanner});Dn.parser=ope(Dn.scanner.tokens);for(let t=0;t<Dn.pluginQueue.length;t++)Dn.pluginQueue[t][1]({scanner:Dn.scanner,parser:Dn.parser});return Dn.initialized=!0,Dn}function aC(t){return Dn.initialized||dpe(),ape(Dn.parser.start,t,Q6(Dn.scanner.start,t))}aC.scan=Q6;function J6(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new oC(n),i=aC(t),s=[];for(let o=0;o<i.length;o++){const a=i[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&s.push(a.toFormattedObject(r))}return s}var lC="[\0- Â áá â-\u2029âã]",fpe=new RegExp(lC),hpe=new RegExp(`${lC}$`),ppe=new RegExp(lC,"g");function mpe(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function gpe(t){return new Jt({key:new Sn("autolink"),appendTransaction:(e,n,r)=>{const i=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=r,a=WT(n.doc,[...e]);if(KT(a).forEach(({newRange:c})=>{const u=s6(r.doc,c,h=>h.isTextblock);let d,f;if(u.length>1)d=u[0],f=r.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const h=r.doc.textBetween(c.from,c.to," "," ");if(!hpe.test(h))return;d=u[0],f=r.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&f){const h=f.split(fpe).filter(Boolean);if(h.length<=0)return!1;const p=h[h.length-1],m=d.pos+f.lastIndexOf(p);if(!p)return!1;const g=aC(p).map(y=>y.toObject(t.defaultProtocol));if(!mpe(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:m+y.start+1,to:m+y.end+1})).filter(y=>r.schema.marks.code?!r.doc.rangeHasMark(y.from,y.to,r.schema.marks.code):!0).filter(y=>t.validate(y.value)).filter(y=>t.shouldAutoLink(y.value)).forEach(y=>{GT(y.from,y.to,r.doc).some(b=>b.mark.type===t.type)||o.addMark(y.from,y.to,t.type.create({href:y.href}))})}}),!!o.steps.length)return o}})}function ype(t){return new Jt({key:new Sn("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,s;if(r.button!==0||!e.editable)return!1;let o=null;if(r.target instanceof HTMLAnchorElement)o=r.target;else{const l=r.target;if(!l)return!1;const c=t.editor.view.dom;o=l.closest("a"),o&&!c.contains(o)&&(o=null)}if(!o)return!1;let a=!1;if(t.enableClickSelection&&(a=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const l=d6(e.state,t.type.name),c=(i=o.href)!=null?i:l.href,u=(s=o.target)!=null?s:l.target;c&&(window.open(c,u),a=!0)}return a}}})}function bpe(t){return new Jt({key:new Sn("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{shouldAutoLink:i}=t,{state:s}=e,{selection:o}=s,{empty:a}=o;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=J6(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||i!==void 0&&!i(c.value)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function du(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const i=typeof r=="string"?r:r.scheme;i&&n.push(i)}),!t||t.replace(ppe,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var eB=wd.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){lO(t);return}lO(t.scheme,t.optionalSlashes)})},onDestroy(){upe()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!du(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),n=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||n&&!t.includes("@"))return!0;const i=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(i)||!/\./.test(i))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!du(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!du(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Yn(this.options.HTMLAttributes,t),0]:["a",Yn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n;const r=((n=t.attrs)==null?void 0:n.href)||"";return`[${e.renderChildren(t)}](${r})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!du(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!du(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[dd({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,i=J6(t).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:o=>!!du(o,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(s=>{this.options.shouldAutoLink(s.value)&&e.push({text:s.value,data:{href:s.href},index:s.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(gpe({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:i=>!!du(i,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),t.push(ype({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(bpe({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),wpe=eB,vpe=Object.defineProperty,xpe=(t,e)=>{for(var n in e)vpe(t,n,{get:e[n],enumerable:!0})},Spe="listItem",cO="textStyle",uO=/^\s*([-+*])\s$/,tB=Ri.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Spe,this.editor.getAttributes(cO)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=Xf({find:uO,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Xf({find:uO,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(cO),editor:this.editor})),[t]}}),nB=Ri.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))n=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const o=t.tokens.slice(1),a=e.parseChildren(o);n.push(...a)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>YT(t,e,r=>{var i,s;return r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${(((s=(i=r.meta)==null?void 0:i.parentAttrs)==null?void 0:s.start)||1)+r.index}. `:"- "},n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),kpe={};xpe(kpe,{findListItemPos:()=>eg,getNextListDepth:()=>cC,handleBackspace:()=>FS,handleDelete:()=>$S,hasListBefore:()=>rB,hasListItemAfter:()=>Epe,hasListItemBefore:()=>iB,listItemHasSubList:()=>sB,nextListIsDeeper:()=>oB,nextListIsHigher:()=>aB});var eg=(t,e)=>{const{$from:n}=e.selection,r=fr(t,e.schema);let i=null,s=n.depth,o=n.pos,a=null;for(;s>0&&a===null;)i=n.node(s),i.type===r?a=s:(s-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},cC=(t,e)=>{const n=eg(t,e);if(!n)return!1;const[,r]=rde(e,t,n.$pos.pos+4);return r},rB=(t,e,n)=>{const{$anchor:r}=t.selection,i=Math.max(0,r.pos-2),s=t.doc.resolve(i).node();return!(!s||!n.includes(s.type.name))},iB=(t,e)=>{var n;const{$anchor:r}=e.selection,i=e.doc.resolve(r.pos-2);return!(i.index()===0||((n=i.nodeBefore)==null?void 0:n.type.name)!==t)},sB=(t,e,n)=>{if(!n)return!1;const r=fr(t,e.schema);let i=!1;return n.descendants(s=>{s.type===r&&(i=!0)}),i},FS=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!Vc(t.state,e)&&rB(t.state,e,n)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((f,h)=>{f.type.name===e&&c.push({node:f,pos:h})});const u=c.at(-1);if(!u)return!1;const d=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!Vc(t.state,e)||!ade(t.state))return!1;const r=eg(e,t.state);if(!r)return!1;const s=t.state.doc.resolve(r.$pos.pos-2).node(r.depth),o=sB(e,t.state,s);return iB(e,t.state)&&!o?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},oB=(t,e)=>{const n=cC(t,e),r=eg(t,e);return!r||!n?!1:n>r.depth},aB=(t,e)=>{const n=cC(t,e),r=eg(t,e);return!r||!n?!1:n<r.depth},$S=(t,e)=>{if(!Vc(t.state,e)||!ode(t.state,e))return!1;const{selection:n}=t.state,{$from:r,$to:i}=n;return!n.empty&&r.sameParent(i)?!1:oB(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():aB(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},Epe=(t,e)=>{var n;const{$anchor:r}=e.selection,i=e.doc.resolve(r.pos-r.parentOffset-2);return!(i.index()===i.parent.childCount-1||((n=i.nodeAfter)==null?void 0:n.type.name)!==t)},lB=pn.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&$S(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&$S(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&FS(t,n,r)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&FS(t,n,r)&&(e=!0)}),e}}}}),dO=/^(\s*)(\d+)\.\s+(.*)$/,Tpe=/^\s/;function Cpe(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n],s=i.match(dO);if(!s)break;const[,o,a,l]=s,c=o.length;let u=l,d=n+1;const f=[i];for(;d<t.length;){const h=t[d];if(h.match(dO))break;if(h.trim()==="")f.push(h),u+=`
`,d+=1;else if(h.match(Tpe))f.push(h),u+=`
${h.slice(c+2)}`,d+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:f.join(`
`)}),r=d,n=d}return[e,r]}function cB(t,e,n){var r;const i=[];let s=0;for(;s<t.length;){const o=t[s];if(o.indent===e){const a=o.content.split(`
`),l=((r=a[0])==null?void 0:r.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const h=n.blockTokens(u);c.push(...h)}let d=s+1;const f=[];for(;d<t.length&&t[d].indent>e;)f.push(t[d]),d+=1;if(f.length>0){const h=Math.min(...f.map(m=>m.indent)),p=cB(f,h,n);c.push({type:"list",ordered:!0,start:f[0].number,items:p,raw:f.map(m=>m.raw).join(`
`)})}i.push({type:"list_item",raw:o.raw,tokens:c}),s=d}else s+=1}return i}function _pe(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const r=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")r.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const s=e.parseChildren([i]);r.push({type:"paragraph",content:s})}else{const s=e.parseChildren([i]);s.length>0&&r.push(...s)}}),{type:"listItem",content:r}})}var Ape="listItem",fO="textStyle",hO=/^(\d+)\.\s$/,uB=Ri.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",Yn(this.options.HTMLAttributes,n),0]:["ol",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,r=t.items?_pe(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e?.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var r;const i=t.split(`
`),[s,o]=Cpe(i);if(s.length===0)return;const a=cB(s,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((r=s[0])==null?void 0:r.number)||1,items:a,raw:i.slice(0,o).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Ape,this.editor.getAttributes(fO)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=Xf({find:hO,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Xf({find:hO,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(fO)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),Ppe=/^\s*(\[([( |x])?\])\s$/,Ipe=Ri.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Yn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const r=e.parseChildren(t.nestedTokens);n.push(...r)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const i=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return YT(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const i=document.createElement("li"),s=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=d=>{var f,h;a.ariaLabel=((h=(f=this.options.a11y)==null?void 0:f.checkboxLabel)==null?void 0:h.call(f,d,a.checked))||`Task item checkbox for ${d.textContent||"empty task item"}`};c(t),s.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",d=>d.preventDefault()),a.addEventListener("change",d=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:f}=d.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:h})=>{const p=n();if(typeof p!="number")return!1;const m=h.doc.nodeAt(p);return h.setNodeMarkup(p,void 0,{...m?.attrs,checked:f}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,f)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([d,f])=>{i.setAttribute(d,f)}),i.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,s.append(a,o),i.append(s,l),Object.entries(e).forEach(([d,f])=>{i.setAttribute(d,f)});let u=new Set(Object.keys(e));return{dom:i,contentDOM:l,update:d=>{if(d.type!==this.type)return!1;i.dataset.checked=d.attrs.checked,a.checked=d.attrs.checked,c(d);const f=r.extensionManager.attributes,h=Gf(d,f),p=new Set(Object.keys(h)),m=this.options.HTMLAttributes;return u.forEach(g=>{p.has(g)||(g in m?i.setAttribute(g,m[g]):i.removeAttribute(g))}),Object.entries(h).forEach(([g,y])=>{y==null?g in m?i.setAttribute(g,m[g]):i.removeAttribute(g):i.setAttribute(g,y)}),u=p,!0}}}},addInputRules(){return[Xf({find:Ppe,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),Ope=Ri.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Yn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const r=s=>{const o=TS(s,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:r},n);return o?[{type:"taskList",raw:o.raw,items:o.items}]:n.blockTokens(s)},i=TS(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:s=>({indentLevel:s[1].length,mainContent:s[4],checked:s[3].toLowerCase()==="x"}),createToken:(s,o)=>({type:"taskItem",raw:"",mainContent:s.mainContent,indentLevel:s.indentLevel,checked:s.checked,text:s.mainContent,tokens:n.inlineTokens(s.mainContent),nestedTokens:o}),customNestedParser:r},n);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});pn.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(tB.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(nB.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(lB.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(uB.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(Ipe.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(Ope.configure(this.options.taskList)),t}});var pO="&nbsp;",Mpe="Â ",Npe=Ri.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Yn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];if(n.length===1&&n[0].type==="image")return e.parseChildren([n[0]]);const r=e.parseInline(n);return r.length===1&&r[0].type==="text"&&(r[0].text===pO||r[0].text===Mpe)?e.createNode("paragraph",void 0,[]):e.createNode("paragraph",void 0,r)},renderMarkdown:(t,e)=>{if(!t)return"";const n=Array.isArray(t.content)?t.content:[];return n.length===0?pO:e.renderChildren(n)},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Rpe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Dpe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Lpe=wd.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Zf({find:Rpe,type:this.type})]},addPasteRules(){return[dd({find:Dpe,type:this.type})]}}),Bpe=Ri.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),Fpe=wd.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Yn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const s=i[2].trim();return{type:"underline",raw:i[0],text:s,tokens:n.inlineTokens(s)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function $pe(t={}){return new Jt({view(e){return new zpe(e,t)}})}class zpe{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,i=this.editorView.dom,s=i.getBoundingClientRect(),o=s.width/i.offsetWidth,a=s.height/i.offsetHeight;if(n){let d=e.nodeBefore,f=e.nodeAfter;if(d||f){let h=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(h){let p=h.getBoundingClientRect(),m=d?p.bottom:p.top;d&&f&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*a;r={left:p.left,right:p.right,top:m-g,bottom:m+g}}}}if(!r){let d=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;r={left:d.left-f,right:d.left+f,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),f=d.width/l.offsetWidth,h=d.height/l.offsetHeight;c=d.left-l.scrollLeft*f,u=d.top-l.scrollTop*h}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n,e):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=XL(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class Vn extends Dt{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Vn.valid(r)?new Vn(r):Dt.near(r)}content(){return it.empty}eq(e){return e instanceof Vn&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Vn(e.resolve(n.pos))}getBookmark(){return new uC(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!Upe(e)||!Hpe(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Vn.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(Vn.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!ut.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(Vn.valid(a))return a}return null}}}Vn.prototype.visible=!1;Vn.findFrom=Vn.findGapCursorFrom;Dt.jsonID("gapcursor",Vn);class uC{constructor(e){this.pos=e}map(e){return new uC(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Vn.valid(n)?new Vn(n):Dt.near(n)}}function dB(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function Upe(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||dB(i.type))return!0;if(i.inlineContent)return!1}}return!0}function Hpe(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||dB(i.type))return!0;if(i.inlineContent)return!1}}return!0}function Vpe(){return new Jt({props:{decorations:Kpe,createSelectionBetween(t,e,n){return e.pos==n.pos&&Vn.valid(n)?new Vn(n):null},handleClick:jpe,handleKeyDown:Wpe,handleDOMEvents:{beforeinput:qpe}}})}const Wpe=Q5({ArrowLeft:Zg("horiz",-1),ArrowRight:Zg("horiz",1),ArrowUp:Zg("vert",-1),ArrowDown:Zg("vert",1)});function Zg(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof Et){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=Vn.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new Vn(c))),!0):!1}}function jpe(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Vn.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&ut.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Vn(r))),!0)}function qpe(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Vn))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=Fe.empty;for(let o=r.length-1;o>=0;o--)i=Fe.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new it(i,0,0));return s.setSelection(Et.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function Kpe(t){if(!(t.selection instanceof Vn))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",wn.create(t.doc,[mr.widget(t.selection.head,e,{key:"gapcursor"})])}var hb=200,Ir=function(){};Ir.prototype.append=function(e){return e.length?(e=Ir.from(e),!this.length&&e||e.length<hb&&this.leafAppend(e)||this.length<hb&&e.leafPrepend(this)||this.appendInner(e)):this};Ir.prototype.prepend=function(e){return e.length?Ir.from(e).append(this):this};Ir.prototype.appendInner=function(e){return new Gpe(this,e)};Ir.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Ir.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Ir.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Ir.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Ir.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};Ir.from=function(e){return e instanceof Ir?e:e&&e.length?new fB(e):Ir.empty};var fB=(function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=hb)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=hb)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(Ir);Ir.empty=new fB([]);var Gpe=(function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(Ir);const Zpe=500;class to{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((d,f)=>{if(!d.step){i||(i=this.remapping(r,f+1),s=i.maps.length),s--,u.push(d);return}if(i){u.push(new Io(d.map));let h=d.step.map(i.slice(s)),p;h&&o.maybeStep(h).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new Io(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(d.step);if(d.selection)return a=i?d.selection.map(i.slice(s)):d.selection,l=new to(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let d=e.steps[u].invert(e.docs[u]),f=new Io(e.mapping.maps[u],d,n),h;(h=l&&l.merge(f))&&(f=h,u?s.pop():a=a.slice(0,a.length-1)),s.push(f),n&&(o++,n=void 0),i||(l=f)}let c=o-r.depth;return c>Qpe&&(a=Xpe(a,c),o-=c),new to(a.append(s),o)}remapping(e,n){let r=new cm;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new to(this.items.append(e.map(n=>new Io(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(f=>{f.selection&&a--},i);let l=n;this.items.forEach(f=>{let h=s.getMirror(--l);if(h==null)return;o=Math.min(o,h);let p=s.maps[h];if(f.step){let m=e.steps[h].invert(e.docs[h]),g=f.selection&&f.selection.map(s.slice(l+1,h));g&&a++,r.push(new Io(p,m,g))}else r.push(new Io(p))},i);let c=[];for(let f=n;f<o;f++)c.push(new Io(s.maps[f]));let u=this.items.slice(0,i).append(c).append(r),d=new to(u,a);return d.emptyItemCount()>Zpe&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let d=new Io(c.invert(),l,u),f,h=i.length-1;(f=i.length&&i[h].merge(d))?i[h]=f:i.push(d)}}else o.map&&r--},this.items.length,0),new to(Ir.from(i.reverse()),s)}}to.empty=new to(Ir.empty,0);function Xpe(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class Io{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Io(n.getMap().invert(),n,this.selection)}}}class tc{constructor(e,n,r,i,s){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const Qpe=20;function Ype(t,e,n,r){let i=n.getMeta(Gu),s;if(i)return i.historyState;n.getMeta(tme)&&(t=new tc(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Gu))return o.getMeta(Gu).redo?new tc(t.done.addTransform(n,void 0,r,w0(e)),t.undone,mO(n.mapping.maps),t.prevTime,t.prevComposition):new tc(t.done,t.undone.addTransform(n,void 0,r,w0(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!Jpe(n,t.prevRanges)),c=o?w2(t.prevRanges,n.mapping):mO(n.mapping.maps);return new tc(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,w0(e)),to.empty,c,n.time,a??t.prevComposition)}else return(s=n.getMeta("rebased"))?new tc(t.done.rebased(n,s),t.undone.rebased(n,s),w2(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new tc(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),w2(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function Jpe(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function mO(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,i,s,o)=>e.push(s,o));return e}function w2(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function eme(t,e,n){let r=w0(e),i=Gu.get(e).spec.config,s=(n?t.undone:t.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(n?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),l=new tc(n?a:s.remaining,n?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(Gu,{redo:n,historyState:l})}let v2=!1,gO=null;function w0(t){let e=t.plugins;if(gO!=e){v2=!1,gO=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){v2=!0;break}}return v2}const Gu=new Sn("history"),tme=new Sn("closeHistory");function nme(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Jt({key:Gu,state:{init(){return new tc(to.empty,to.empty,null,0,-1)},apply(e,n,r){return Ype(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?pB:r=="historyRedo"?mB:null;return!i||!e.editable?!1:(n.preventDefault(),i(e.state,e.dispatch))}}}})}function hB(t,e){return(n,r)=>{let i=Gu.getState(n);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(r){let s=eme(i,n,t);s&&r(e?s.scrollIntoView():s)}return!0}}const pB=hB(!1,!0),mB=hB(!0,!0);pn.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new Jt({key:new Sn("characterCount"),appendTransaction:(e,n,r)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const s=this.storage.characters({node:r.doc});if(s>i){const o=s-i,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const i=this.storage.characters({node:n.doc}),s=this.storage.characters({node:e.doc});if(s<=r||i>r&&s>r&&s<=i)return!0;if(i>r&&s>r&&s>i||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=s-r,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>r)}})]}});var rme=pn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[$pe(this.options)]}}),ime=pn.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new Jt({key:new Sn("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:i}=e,s=[];if(!n||!r)return wn.create(t,[]);let o=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(i>=c&&i<=c+l.nodeSize-1))return!1;o+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(i>=c&&i<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";s.push(mr.node(c,c+l.nodeSize,{class:this.options.className}))}),wn.create(t,s)}}})]}}),sme=pn.create({name:"gapCursor",addProseMirrorPlugins(){return[Vpe()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=bn(pt(t,"allowGapCursor",n)))!=null?e:null}}}),yO="placeholder";function ome(t){return t.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").replace(/^[0-9-]+/,"").replace(/^-+/,"").toLowerCase()}var ame=pn.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",dataAttribute:yO,placeholder:"Write something â¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){const t=this.options.dataAttribute?`data-${ome(this.options.dataAttribute)}`:`data-${yO}`;return[new Jt({key:new Sn("placeholder"),props:{decorations:({doc:e,selection:n})=>{const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:i}=n,s=[];if(!r)return null;const o=this.editor.isEmpty;return e.descendants((a,l)=>{const c=i>=l&&i<=l+a.nodeSize,u=!a.isLeaf&&Cw(a);if((c||!this.options.showOnlyCurrent)&&u){const d=[this.options.emptyNodeClass];o&&d.push(this.options.emptyEditorClass);const f=mr.node(l,l+a.nodeSize,{class:d.join(" "),[t]:typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:l,hasAnchor:c}):this.options.placeholder});s.push(f)}return this.options.includeChildren}),wn.create(e,s)}}})]}});pn.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new Jt({key:new Sn("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||f6(n.selection)||t.view.dragging?null:wn.create(n.doc,[mr.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function bO({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var lme=pn.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new Sn(this.name),n=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(n).includes(i.name));return[new Jt({key:e,appendTransaction:(i,s,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),d=a.content.size,f=c.nodes[n];if(u)return l.insert(d,f.create())},state:{init:(i,s)=>{const o=s.tr.doc.lastChild;return!bO({node:o,types:r})},apply:(i,s)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return s;const o=i.doc.lastChild;return!bO({node:o,types:r})}}})]}}),cme=pn.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>pB(t,e),redo:()=>({state:t,dispatch:e})=>mB(t,e)}},addProseMirrorPlugins(){return[nme(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),ume=pn.create({name:"starterKit",addExtensions(){var t,e,n,r;const i=[];return this.options.bold!==!1&&i.push(Nhe.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(Ahe.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(tB.configure(this.options.bulletList)),this.options.code!==!1&&i.push(Lhe.configure(this.options.code)),this.options.codeBlock!==!1&&i.push($he.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(zhe.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(rme.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(sme.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(Uhe.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(Hhe.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(cme.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(Vhe.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(Ghe.configure(this.options.italic)),this.options.listItem!==!1&&i.push(nB.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(lB.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(eB.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(uB.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(Npe.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(Lpe.configure(this.options.strike)),this.options.text!==!1&&i.push(Bpe.configure(this.options.text)),this.options.underline!==!1&&i.push(Fpe.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&i.push(lme.configure((r=this.options)==null?void 0:r.trailingNode)),i}}),dme=ume,fme=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,hme=Ri.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",Yn(this.options.HTMLAttributes,t)]},parseMarkdown:(t,e)=>e.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var e,n,r,i,s,o;const a=(n=(e=t.attrs)==null?void 0:e.src)!=null?n:"",l=(i=(r=t.attrs)==null?void 0:r.alt)!=null?i:"",c=(o=(s=t.attrs)==null?void 0:s.title)!=null?o:"";return c?`![${l}](${a} "${c}")`:`![${l}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u")return null;const{directions:t,minWidth:e,minHeight:n,alwaysPreserveAspectRatio:r}=this.options.resize;return({node:i,getPos:s,HTMLAttributes:o,editor:a})=>{const l=document.createElement("img");Object.entries(o).forEach(([d,f])=>{if(f!=null)switch(d){case"width":case"height":break;default:l.setAttribute(d,f);break}}),l.src=o.src;const c=new Kde({element:l,editor:a,node:i,getPos:s,onResize:(d,f)=>{l.style.width=`${d}px`,l.style.height=`${f}px`},onCommit:(d,f)=>{const h=s();h!==void 0&&this.editor.chain().setNodeSelection(h).updateAttributes(this.name,{width:d,height:f}).run()},onUpdate:(d,f,h)=>d.type===i.type,options:{directions:t,min:{width:e,height:n},preserveAspectRatio:r===!0}}),u=c.dom;return u.style.visibility="hidden",u.style.pointerEvents="none",l.onload=()=>{u.style.visibility="",u.style.pointerEvents=""},c}},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[P6({find:fme,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),pme=hme,Br=[];for(var x2=0;x2<256;++x2)Br.push((x2+256).toString(16).slice(1));function mme(t,e=0){return(Br[t[e+0]]+Br[t[e+1]]+Br[t[e+2]]+Br[t[e+3]]+"-"+Br[t[e+4]]+Br[t[e+5]]+"-"+Br[t[e+6]]+Br[t[e+7]]+"-"+Br[t[e+8]]+Br[t[e+9]]+"-"+Br[t[e+10]]+Br[t[e+11]]+Br[t[e+12]]+Br[t[e+13]]+Br[t[e+14]]+Br[t[e+15]]).toLowerCase()}var Xg,gme=new Uint8Array(16);function yme(){if(!Xg&&(Xg=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Xg))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Xg(gme)}var bme=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const wO={randomUUID:bme};function wme(t,e,n){if(wO.randomUUID&&!t)return wO.randomUUID();t=t||{};var r=t.random||(t.rng||yme)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,mme(r)}function vme(t){const e=new Set,n=new Set;return t.forEach(r=>{e.has(r)?n.add(r):e.add(r)}),Array.from(n)}var xme=pn.create({name:"uniqueID",priority:1e4,addOptions(){return{attributeName:"id",types:[],generateID:()=>wme(),filterTransaction:null,updateDocument:!0}},addGlobalAttributes(){return[{types:this.options.types,attributes:{[this.options.attributeName]:{default:null,parseHTML:t=>t.getAttribute(`data-${this.options.attributeName}`),renderHTML:t=>t[this.options.attributeName]?{[`data-${this.options.attributeName}`]:t[this.options.attributeName]}:{}}}}]},onCreate(){var t;if(!this.options.updateDocument)return;const e=this.editor.extensionManager.extensions.find(a=>a.name==="collaboration"),n=this.editor.extensionManager.extensions.find(a=>a.name==="collaborationCaret"),i=[e,n].filter(Boolean).find(a=>{var l;return(l=a?.options)==null?void 0:l.provider}),s=(t=i?.options)==null?void 0:t.provider,o=()=>{const{view:a,state:l}=this.editor,{tr:c,doc:u}=l,{types:d,attributeName:f,generateID:h}=this.options;Kue(u,m=>d.includes(m.type.name)&&m.attrs[f]===null).forEach(({node:m,pos:g})=>{c.setNodeMarkup(g,void 0,{...m.attrs,[f]:h({node:m,pos:g})})}),c.setMeta("addToHistory",!1),a.dispatch(c),s&&s.off("synced",o)};if(i){if(!s)return o();s.on("synced",o)}else return o()},addProseMirrorPlugins(){if(!this.options.updateDocument)return[];let t=null,e=!1;return[new Jt({key:new Sn("uniqueID"),appendTransaction:(n,r,i)=>{const s=n.some(m=>m.docChanged)&&!r.doc.eq(i.doc),o=this.options.filterTransaction&&n.some(m=>{var g,y;return!((y=(g=this.options).filterTransaction)!=null&&y.call(g,m))});if(n.find(m=>m.getMeta("y-sync$"))||!s||o)return;const{tr:l}=i,{types:c,attributeName:u,generateID:d}=this.options,f=WT(r.doc,n),{mapping:h}=f;if(KT(f).forEach(({newRange:m})=>{const g=s6(i.doc,m,b=>c.includes(b.type.name)),y=g.map(({node:b})=>b.attrs[u]).filter(b=>b!==null);g.forEach(({node:b,pos:x},C)=>{var P;const S=(P=l.doc.nodeAt(x))==null?void 0:P.attrs[u];if(S===null){l.setNodeMarkup(x,void 0,{...b.attrs,[u]:d({node:b,pos:x})});return}const _=g[C+1];if(_&&b.content.size===0){const M=l.doc.nodeAt(_.pos);if(M?.attrs[u]&&M.attrs[u]!==S)return;l.setNodeMarkup(_.pos,void 0,{..._.node.attrs,[u]:S}),y[C+1]=S;const L=d({node:b,pos:x});return l.setNodeMarkup(x,void 0,{...b.attrs,[u]:L}),y[C]=L,l}const k=vme(y),{deleted:T}=h.invert().mapResult(x);T&&k.includes(S)&&l.setNodeMarkup(x,void 0,{...b.attrs,[u]:d({node:b,pos:x})})})}),!!l.steps.length)return l.setStoredMarks(i.tr.storedMarks),l.setMeta("__uniqueIDTransaction",!0),l},view(n){const r=i=>{var s;t=(s=n.dom.parentElement)!=null&&s.contains(i.target)?n.dom.parentElement:null};return window.addEventListener("dragstart",r),{destroy(){window.removeEventListener("dragstart",r)}}},props:{handleDOMEvents:{drop:(n,r)=>{var i,s;return(t!==n.dom.parentElement||((i=r.dataTransfer)==null?void 0:i.effectAllowed)==="copyMove"||((s=r.dataTransfer)==null?void 0:s.effectAllowed)==="copy")&&(t=null,e=!0),!1},paste:()=>(e=!0,!1)},transformPasted:n=>{if(!e)return n;const{types:r,attributeName:i}=this.options,s=o=>{const a=[];return o.forEach(l=>{if(l.isText){a.push(l);return}if(!r.includes(l.type.name)){a.push(l.copy(s(l.content)));return}const c=l.type.create({...l.attrs,[i]:null},s(l.content),l.marks);a.push(c)}),Fe.from(a)};return e=!1,new it(s(n.content),n.openStart,n.openEnd)}}})]}}),Sme=xme,kme=Ce("<canvas></canvas>"),Eme=Ce('<img draggable="false" style="z-index:2; position:relative;"/>'),Tme=Ce('<div class="copy-icon svg-icon svelte-4wwag0"></div>'),Cme=Ce('<div class="close-icon svg-icon svelte-4wwag0"></div>'),_me=Ce('<div class="image-node-container svelte-4wwag0"><button type="button" class="editor-image-button svelte-4wwag0" tabindex="0"><!> <!></button> <!> <!></div>');function Ame(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=kO,o=EO,a=ye(!1),l=ye(!1),c=ye(void 0),u=ye(void 0);const d=so(),f=400;let h=oe(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src&&e.node.attrs.src.startsWith("placeholder-")),p=oe(()=>!E(h)&&e.node.attrs.src&&!e.node.attrs.src.startsWith("placeholder-")),m=oe(()=>e.node.attrs.blurhash&&(E(h)||!E(a)||E(l))),g=ye(null);const y=!1;nt(()=>{const R=e.node.attrs.src;if(!R)return;const A=_S.value[R];if(A){Q(g,A,!0);return}const N=Wse(e.node.attrs.dim);if(N){const z=vL(N.width,N.height);Q(g,z,!0),_S.update(U=>({...U,[R]:z}))}else E(h)&&Q(g,V1(),!0)});function b(R,A=!1){ooe(R,A,s.isDragging,E(h),e.selected,o.justSelected,e.node.attrs.src,e.node.attrs.alt||"Image",e.getPos)&&!e.selected&&(o.justSelectedTimeout&&clearTimeout(o.justSelectedTimeout),o.justSelected=!0,o.justSelectedTimeout=setTimeout(()=>{o.justSelected=!1,o.justSelectedTimeout=null},f))}function x(){s.isDragging=!0,Vh("start",{},e.getPos),s.preview=toe(s.startTarget,s.startPos.x,s.startPos.y,E(h))}function C(){s.longPressTimeout&&(clearTimeout(s.longPressTimeout),s.longPressTimeout=null),s.startTarget=null}function P(R,A,N){C(),s.startPos={x:A,y:N},s.startTarget=R,s.longPressTimeout=setTimeout(()=>{x()},Rie)}function S(){Q(a,!0),Q(l,!0),setTimeout(()=>{Q(l,!1)},400)}function _(){Q(a,!1)}function k(R){b(R,!1)}function T(R,A){if(R==="start"){const N=A;if(!N?.dataTransfer&&!d)return;if(d){A?.preventDefault();return}N?.dataTransfer&&(N.dataTransfer.setData("application/x-tiptap-node",JSON.stringify({type:"image",attrs:e.node.attrs,pos:e.getPos()})),N.dataTransfer.effectAllowed="move"),s.isDragging=!0,Vh("start")}else s.isDragging=!1,W1(s.preview),Vh("end")}function O(R){if(R.touches.length!==1)return;mL();const A=j1(R);P(R.currentTarget,A.x,A.y)}function M(R){if(R.touches.length!==1){C();return}const A=j1(R);if(!s.isDragging&&s.longPressTimeout&&roe(A.x,A.y,s.startPos.x,s.startPos.y,Die)){C();return}s.isDragging&&(R.preventDefault(),noe(s.preview,A.x,A.y),Xse(A.x,A.y),Vh("move",{touchX:A.x,touchY:A.y,nodePos:e.getPos()}))}function L(R){if(s.longPressTimeout&&(C(),!s.isDragging)){b(R,!0);return}if(!s.isDragging)return;R.preventDefault();const A=j1(R),N=document.elementFromPoint(A.x,A.y);if(N){const U=N.closest(".drop-zone-indicator")?.getAttribute("data-drop-pos");Vh("end",{nodeData:{type:"image",attrs:e.node.attrs,pos:e.getPos()},dropX:A.x,dropY:A.y,target:N,dropPosition:U?parseInt(U,10):null})}s.isDragging=!1,W1(s.preview),s.preview=null}function F(R){R.preventDefault()}function B(R){R.stopPropagation(),e.deleteNode()}Vs(()=>{e.node.attrs.blurhash&&E(c)&&DI(e.node.attrs.blurhash,E(c),E(g)||V1(),E(h),y),d&&E(u)&&(E(u).addEventListener("touchstart",O,{passive:!1}),E(u).addEventListener("touchmove",M,{passive:!1}),E(u).addEventListener("touchend",L,{passive:!1}))}),nt(()=>{e.node.attrs.blurhash&&E(c)&&DI(e.node.attrs.blurhash,E(c),E(g)||V1(),E(h),y)}),_f(()=>{C(),o.justSelectedTimeout&&clearTimeout(o.justSelectedTimeout),W1(s.preview),d&&E(u)&&(E(u).removeEventListener("touchstart",O),E(u).removeEventListener("touchmove",M),E(u).removeEventListener("touchend",L)),Object.assign(kO,{isDragging:!1,longPressTimeout:null,startTarget:null,preview:null}),Object.assign(EO,{justSelected:!1,justSelectedTimeout:null}),Q(c,void 0)}),N6(t,{children:(R,A)=>{var N=_me(),z=ie(N);z.__click=k;var U=ie(z);{var V=Z=>{var ae=kme();let _e;Ar(ae,de=>Q(c,de),()=>E(c)),Ge(()=>_e=Qo(ae,1,"blurhash-canvas svelte-4wwag0",null,_e,{"is-placeholder":E(h),"fade-out":E(a)&&E(l)&&E(p)})),Y(Z,ae)};He(U,Z=>{E(m)&&Z(V)})}var q=ve(U,2);{var G=Z=>{var ae=Eme();let _e;ae.__contextmenu=F,Ge(()=>{fn(ae,"src",e.node?.attrs?.src),fn(ae,"alt",e.node?.attrs?.alt||""),_e=Qo(ae,1,"editor-image svelte-4wwag0",null,_e,{"image-loading":!E(a)})}),Is("load",ae,S),Is("error",ae,_),Y(Z,ae)};He(q,Z=>{E(p)&&Z(G)})}Ar(z,Z=>Q(u,Z),()=>E(u));var ne=ve(z,2);{let Z=oe(()=>n()("imageContextMenu.copyUrl"));Lt(ne,{variant:"copy",shape:"circle",className:"image-copy-button",get ariaLabel(){return E(Z)},onClick:ae=>{ae.stopPropagation(),Pw(e.node.attrs.src,"image URL");const _e={x:ae.clientX,y:ae.clientY};Ys.showPopupMessage(_e.x,_e.y,n()("imageContextMenu.copySuccess"))},children:(ae,_e)=>{var de=Tme();Y(ae,de)},$$slots:{default:!0}})}var te=ve(ne,2);{let Z=oe(()=>n()("imageContextMenu.delete"));Lt(te,{variant:"close",shape:"circle",className:"image-close-button",get ariaLabel(){return E(Z)},onClick:B,children:(ae,_e)=>{var de=Cme();Y(ae,de)},$$slots:{default:!0}})}Ge(()=>{fn(z,"data-dragging",s.isDragging),fn(z,"aria-label",e.node?.attrs?.alt||"Image"),fn(z,"draggable",!d)}),Is("dragstart",z,Z=>T("start",Z)),Is("dragend",z,()=>T("end")),Is("dragover",z,function(...Z){(d?ae=>ae.preventDefault():void 0)?.apply(this,Z)}),Is("drop",z,function(...Z){(d?ae=>ae.preventDefault():void 0)?.apply(this,Z)}),Y(R,N)},$$slots:{default:!0}}),vt(),i()}Mi(["click","contextmenu"]);const vO=new Set(["image","video"]),xO=".node-image.is-node-focused, .node-video.is-node-focused",Pme=pn.create({name:"gapCursorFocusReset",onSelectionUpdate(){const{state:t,view:e}=this.editor,n=t.selection,r=i=>{e.dom.querySelectorAll(xO).forEach(s=>{i&&s===i||s.classList.remove("is-node-focused")})};if(n instanceof ut&&vO.has(n.node.type.name)){const i=e.nodeDOM(n.from),s=i?.matches(".node-image, .node-video")?i:i?.closest(".node-image, .node-video");if(s){r(s),s.classList.add("is-node-focused");return}}if(n instanceof Vn){r();return}r()},onCreate(){const t=e=>{const{view:n}=this.editor,r=e.target;if(n.dom.contains(r))return;n.dom.querySelectorAll(xO).forEach(o=>{o.classList.remove("is-node-focused")});const{state:i}=n,{selection:s}=i;if(s instanceof ut&&vO.has(s.node.type.name)){const o=i.doc.content.size,a=i.doc.resolve(o),l=i.tr.setSelection(Et.near(a)).setMeta("addToHistory",!1);n.dispatch(l)}};document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),this.editor.__outsideClickHandler=t},onDestroy(){const t=this.editor.__outsideClickHandler;t&&(document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t),delete this.editor.__outsideClickHandler)}});function Ime(t){const{placeholderText:e,onSubmitPost:n,onUpdate:r,onCreate:i,onDestroy:s}=t;return sfe({extensions:[dme.configure({paragraph:{HTMLAttributes:{class:"editor-paragraph"}},undoRedo:{depth:100,newGroupDelay:500},dropcursor:{color:"dodgerblue",width:5},link:!1}),wpe.extend({renderHTML({mark:a,HTMLAttributes:l}){return["a",{...l,href:a.attrs.href},0]}}).configure({HTMLAttributes:{class:"preview-link",rel:null,target:"_blank"},autolink:!1,linkOnPaste:!1,defaultProtocol:"https",isAllowedUri:(a,l)=>{if(!l.defaultValidate(a)||a.startsWith("./")||a.startsWith("../"))return!1;try{const c=new URL(a,`${l.defaultProtocol}://`);return l.protocols.includes(c.protocol.replace(":",""))}catch{return!1}},shouldAutoLink:a=>{if(a.length<8)return!1;try{return new URL(a).hostname.length>0&&/^https?:\/\/[a-zA-Z0-9]/.test(a)}catch{return!1}},protocols:[{scheme:"http",optionalSlashes:!1},{scheme:"https",optionalSlashes:!1}]}),pme.configure({HTMLAttributes:{class:"editor-image"},allowBase64:!1}).extend({addAttributes(){return{src:{default:null},blurhash:{default:null},isPlaceholder:{default:null},dim:{default:null},alt:{default:null}}},addNodeView(){return M6(Ame)}}),Sme.configure({types:["image","video"],attributeName:"id"}),ime.configure({className:"is-node-focused",mode:"all"}),Pme,jfe,Che,che,dhe,Gfe,Zfe,Xfe,hhe,ame.configure({placeholder:e,emptyEditorClass:"is-editor-empty",showOnlyWhenEditable:!0,showOnlyCurrent:!1,includeChildren:!1})],enablePasteRules:["clipboardExtension"],content:{type:"doc",content:[{type:"paragraph"}]},editorProps:{attributes:{class:"tiptap-editor"},handleClickOn(a,l,c,u,d,f){let h=d.target;for(;h&&h!==a.dom;){if(h.tagName==="A"&&h.hasAttribute("href"))return d.ctrlKey||d.metaKey?!1:(d.preventDefault(),!0);h=h.parentElement}return!1},handleKeyDown:(a,l)=>(l.ctrlKey||l.metaKey)&&(l.key==="Enter"||l.key==="NumpadEnter")?(l.preventDefault(),n(),!0):!1},onCreate({editor:a}){window.__currentEditor=a,i?.(a)},onUpdate(){r?.()},onDestroy(){delete window.__currentEditor,s?.()}})}function Ome(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function Mme(t,e,n,r,i,s,o=!1){const a=[],l=new s,c=Date.now();if(!n)return a;const u=n.state,d=u.selection,f=d instanceof ut&&d.node?.type?.name==="image";o&&console.log("[dev] insertPlaceholdersIntoEditor:",{fileCount:t.length,isImageNodeSelected:f,selectionType:d.constructor.name,selectionFrom:d.from,selectionTo:d.to,docSize:u.doc.content.size});const h=u.doc.childCount===1&&u.doc.firstChild?.type.name==="paragraph"&&u.doc.firstChild.content.size===0;let p=u.tr,m=f?d.to:d.from;return t.forEach((g,y)=>{const b=g.type.startsWith("video/"),x=l.validateMediaFile(g);if(!x.isValid){r(x.errorMessage||"postComponent.upload_failed");return}const C=`placeholder-${c}-${y}-${Ome()}`,P=e[y],S=P?.ox,_=P?.dimensions;try{let k;if(b){const T={src:C,isPlaceholder:!0};k=u.schema.nodes.video.create(T)}else{const T={src:C,isPlaceholder:!0};_&&(T.dim=`${_.width}x${_.height}`,i.update(O=>({...O,[C]:_}))),k=u.schema.nodes.image.create(T)}h&&y===0?(p=p.replaceWith(0,u.doc.content.size,k),m=k.nodeSize):(p=p.insert(m,k),m+=k.nodeSize),a.push({file:g,placeholderId:C,ox:S,dimensions:_})}catch(k){o&&console.error("[uploadHelper] failed to insert media node",{placeholderId:C,file:g.name,isVideo:b,error:k,insertPos:m,docSize:u.doc.content.size}),r(b?"åç»ã®æ¿å¥ã«å¤±æãã¾ãã":"ç»åã®æ¿å¥ã«å¤±æãã¾ãã")}}),a.length>0&&n.view.dispatch(p),a}async function Nme(t,e,n,r=!1){if(on.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted before blurhash generation");return}const i=new n,s=t.map(async o=>{if(on.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted during blurhash generation");return}try{const a=await i.generateBlurhashForFile(o.file);if(on.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted after blurhash generation");return}a&&(o.blurhash=a,e&&JT(e,(l,c)=>{const u=l.type?.name,d=o.file.type.startsWith("video/")&&u==="video",f=!o.file.type.startsWith("video/")&&u==="image";return(d||f)&&(l.attrs?.src===o.placeholderId||l.attrs?.id===o.placeholderId)},(l,c)=>{const u=e.state.tr.setNodeMarkup(c,void 0,{...l.attrs,blurhash:a});e.view.dispatch(u)}))}catch(a){r&&console.warn("[uploadHelper] blurhash generation failed",{file:o.file.name,error:a})}});await Promise.all(s)}async function Rme(t,e,n,r,i,s,o,a,l,c,u=!1){const d=[],f={};let h="";const p=[...e];for(let m=0;m<t.length;m++){const g=t[m];if(u&&console.log("[uploadHelper] Processing result",m,":",{success:g.success,url:g.url,filename:g.filename,sizeInfo:g.sizeInfo,aborted:g.aborted}),g.aborted){const y=p.shift();if(y){const b=y.file.type.startsWith("video/");d2(y.placeholderId,b,n,s,u)}continue}if(g.success&&g.url){let y,b=-1;if(g.sizeInfo&&g.sizeInfo.originalFilename&&(b=p.findIndex(x=>x.file.name===g.sizeInfo.originalFilename),b!==-1&&(y=p[b])),!y&&p.length>0&&(y=p[0],b=0),y&&b!==-1&&n){p.splice(b,1);const x=y.file.type.startsWith("video/");if(u&&console.log("[uploadHelper] Replacing placeholder",{placeholderId:y.placeholderId,url:g.url,isVideo:x}),JT(n,(C,P)=>{const S=C.type?.name;return(x&&S==="video"||!x&&S==="image")&&C.attrs?.src===y.placeholderId},(C,P)=>{if(x){const S={...C.attrs,src:g.url,isPlaceholder:!1},_=n.state.tr.setNodeMarkup(P,void 0,S);n.view.dispatch(_)}else{const S={...C.attrs,src:g.url,isPlaceholder:!1,blurhash:y.blurhash??void 0};y.dimensions&&(S.dim=`${y.dimensions.width}x${y.dimensions.height}`);const _=n.state.tr.setNodeMarkup(P,void 0,S);n.view.dispatch(_),s.update(k=>{const T={...k};return delete T[y.placeholderId],y.dimensions&&(T[g.url]=y.dimensions),T})}}),!x){const C=g.nip94||{},P=C.blurhash??C.b??void 0;P&&g.url&&(f[g.url]=P);const S=C.ox??C.o??void 0,_=C.x??void 0;if(S&&g.url?r[g.url]=S:y.ox&&g.url&&(r[g.url]=y.ox),g.url)if(_)i[g.url]=_;else try{const k=await l(g.url);k&&(i[g.url]=k)}catch(k){u&&console.warn("[uploadHelper] failed to calculate x hash (fallback)",{url:g.url,error:k})}}}}else if(!g.success){d.push(g);const y=p.shift();if(y){const b=y.file.type.startsWith("video/");d2(y.placeholderId,b,n,s,u)}}}for(const m of p){const g=m.file.type.startsWith("video/");d2(m.placeholderId,g,n,s,u)}return d.length&&(h=d.length===1?d[0].error||"postComponent.upload_failed":`${d.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`),{failedResults:d,errorMessage:h,imageServerBlurhashMap:f}}let Dme=Zt({value:""}),SO=ye(null);const dC={get value(){return E(SO)},set:t=>{Q(SO,t,!0)}};let An=Zt({content:"",canPost:!1,isUploading:!1,uploadErrorMessage:"",postStatus:{sending:!1,success:!1,error:!1,message:""},hasImage:!1});const kO=Zt({isDragging:!1,startPos:{x:0,y:0},longPressTimeout:null,startTarget:null,preview:null}),EO=Zt({justSelected:!1,justSelectedTimeout:null});function Lme(t,e){return!!t.trim()||e}function Bme(t,e=!1){An.content=t,An.hasImage=e,An.canPost=Lme(t,e)}function Ta(t){An.postStatus=t}function Fme(){An.content="",An.canPost=!1,An.uploadErrorMessage="",An.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1},An.hasImage=!1}function $me(){An.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1}}let zS;function zme(t){zS=t}async function Ume(){zS&&await zS()}function Hme(t){const{placeholderText:e,editorContainerEl:n,hasStoredKey:r,submitPost:i,uploadFiles:s,eventCallbacks:o}=t;Dme.value=e;const a=Ime({placeholderText:e,onSubmitPost:i,onCreate:d=>{dC.set(d)}});let l=null;const c=a.subscribe(d=>{l=d}),u=Ffe({currentEditor:l,editorContainerEl:n,callbacks:o});return zme(i),n&&Object.assign(n,{__uploadFiles:s,__currentEditor:()=>l,__hasStoredKey:()=>r,__postStatus:()=>An.postStatus,__submitPost:i}),{editor:a,unsubscribe:c,handlers:u}}function Vme(t){const{unsubscribe:e,handlers:n,currentEditor:r,editorContainerEl:i}=t;$fe(n,i),e(),r?.destroy?.(),i&&(delete i.__uploadFiles,delete i.__currentEditor,delete i.__hasStoredKey,delete i.__postStatus,delete i.__submitPost)}class Wme{allowedOrigins;console;windowObj;constructor(e={}){this.allowedOrigins=e.allowedOrigins||[],this.console=e.console||(typeof console<"u"?console:{log:()=>{},warn:()=>{},error:()=>{}}),this.windowObj=e.window||(typeof window<"u"?window:void 0)}isInIframe(){if(!this.windowObj)return!1;try{return this.windowObj.self!==this.windowObj.top}catch{return!0}}getParentOrigin(){if(!this.windowObj||!this.isInIframe())return null;try{return this.windowObj.parent.location.origin}catch{if(this.windowObj.document&&this.windowObj.document.referrer)try{return new URL(this.windowObj.document.referrer).origin}catch(n){return this.console.warn("è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ãåå¾ã§ãã¾ããã§ãã:",n),null}return null}}isOriginAllowed(e){return e?this.allowedOrigins.length===0?!0:this.allowedOrigins.includes(e):!1}sendMessageToParent(e){if(!this.windowObj||!this.isInIframe())return!1;const n=this.getParentOrigin();if(!n)return this.console.warn("è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ãç¹å®ã§ããªããããpostMessageãéä¿¡ã§ãã¾ãã"),!1;if(!this.isOriginAllowed(n))return this.console.warn(`è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ ${n} ã¯è¨±å¯ããã¦ãã¾ãã`),!1;try{return this.windowObj.parent.postMessage(e,n),this.console.log(`è¦ªã¦ã£ã³ãã¦ (${n}) ã«ã¡ãã»ã¼ã¸ãéä¿¡ãã¾ãã:`,e),!0}catch(r){return this.console.error("postMessageã®éä¿¡ã«å¤±æãã¾ãã:",r),!1}}notifyPostSuccess(){return this.sendMessageToParent({type:"POST_SUCCESS",timestamp:Date.now()})}notifyPostError(e){return this.sendMessageToParent({type:"POST_ERROR",timestamp:Date.now(),error:e})}setAllowedOrigins(e){this.allowedOrigins=e}addAllowedOrigin(e){this.allowedOrigins.includes(e)||this.allowedOrigins.push(e)}}const jme=new Wme;function qme(t){if(!t.endsWith(`
`))return t;const r=[...aL,...lL].map(s=>s.replace(".","\\.")).join("|");return new RegExp(`(https?://[^\\s\\n]+(?:${r}))\\n$`,"i").test(t)?t.slice(0,-1):t}class Kme{static validatePost(e,n,r){return e.trim()?r?n?{valid:!0}:{valid:!1,error:"login_required"}:{valid:!1,error:"nostr_not_ready"}:{valid:!1,error:"empty_content"}}}class TO{static async buildEvent(e,n,r,i,s,o,a,l,c){const u=Array.isArray(r)&&r.length?[...r]:Array.isArray(n)?n.map(h=>["t",h.toLowerCase()]):[],d=u.some(h=>h[0]==="t"&&h[1]==="nsfw");if((l||d)&&(c&&c.trim()?u.push(["content-warning",c.trim()]):u.push(["content-warning"]),l&&!d&&u.push(["t","nsfw"])),a){const h=a();h&&u.push(h)}if(s&&o){for(const[h,p]of Object.entries(s))if(h&&p&&p.m){const m=await o({url:h,...p});u.push(m)}}const f={kind:1,content:e,tags:u,created_at:Math.floor(Date.now()/1e3)};return i&&(f.pubkey=i),f}}class Gme{constructor(e,n){this.rxNostr=e,this.console=n}sendEvent(e,n){return new Promise(r=>{let i=!1,s=!1,o=null;const a=()=>{try{o?.unsubscribe()}catch{}},l={next:c=>{this.console.log(`ãªã¬ã¼ ${c.from} ã¸ã®éä¿¡çµæ:`,c.ok?"æå":"å¤±æ"),c.ok&&!i&&(s=!0,i=!0,a(),r({success:!0}))},error:c=>{this.console.error("éä¿¡ã¨ã©ã¼:",c),i||(i=!0,a(),r({success:!1,error:"post_error"}))},complete:()=>{!i&&!s&&(i=!0,a(),r({success:!1,error:"post_error"}))}};o=this.rxNostr.send(e,n?{signer:n}:void 0).subscribe(l),setTimeout(()=>{i||(i=!0,a(),r(s?{success:!0}:{success:!1,error:"post_error"}))},1e4)})}}class Zme{constructor(e,n={}){this.deps=n,e&&this.setRxNostr(e),this.deps.console=n.console||(typeof window<"u"?window.console:{}),this.deps.createImetaTagFn=n.createImetaTagFn||yL,this.deps.getClientTagFn=n.getClientTagFn||hfe,this.deps.seckeySignerFn=n.seckeySignerFn||cx,this.deps.extractContentWithImagesFn=n.extractContentWithImagesFn||z6,this.deps.extractImageBlurhashMapFn=n.extractImageBlurhashMapFn||bL,this.deps.resetEditorStateFn=n.resetEditorStateFn||Fme,this.deps.resetPostStatusFn=n.resetPostStatusFn||$me,this.deps.iframeMessageService=n.iframeMessageService||jme,this.deps.hashtagPinStore=n.hashtagPinStore||AS,this.deps.saveHashtagsToHistoryFn=n.saveHashtagsToHistoryFn||Ehe}rxNostr=null;eventSender=null;setRxNostr(e){this.rxNostr=e,this.eventSender=new Gme(e,this.deps.console||console)}validatePost(e){const n=this.deps.authStateStore||{value:jr.value};return Kme.validatePost(e,n.value.isAuthenticated,!!this.rxNostr)}async submitPost(e,n){const r=qme(e),i=this.validatePost(r);if(!i.valid)return this.deps.iframeMessageService?.notifyPostError(i.error),{success:!1,error:i.error};if(!this.eventSender)return this.deps.iframeMessageService?.notifyPostError("nostr_not_ready"),{success:!1,error:"nostr_not_ready"};try{const s=this.deps.authStateStore||{value:jr.value},o=this.deps.hashtagStore||oc,{hashtags:a,tags:l}=this.getHashtagArrays(o),c=this.deps.keyManager||CS,u=this.deps.window||(typeof window<"u"?window:void 0),d=Ku.value,f=Sf.value,h=s.value;if(h.type==="nostr-login"&&c.isWindowNostrAvailable()&&u?.nostr)try{const x=h.pubkey;if(!x)return this.deps.iframeMessageService?.notifyPostError("pubkey_not_found"),{success:!1,error:"pubkey_not_found"};const C=await TO.buildEvent(r,a,l,x,n,this.deps.createImetaTagFn,this.deps.getClientTagFn,d,f);if(typeof u.nostr.signEvent=="function"){const P=await u.nostr.signEvent(C);this.deps.console?.log("ç½²åæ¸ã¿ã¤ãã³ã:",P);const S=await this.eventSender.sendEvent(P);return S.success?(this.deps.saveHashtagsToHistoryFn?.(a),this.deps.iframeMessageService?.notifyPostSuccess()):this.deps.iframeMessageService?.notifyPostError(S.error),S}else return this.deps.iframeMessageService?.notifyPostError("nostr_sign_event_not_supported"),{success:!1,error:"nostr_sign_event_not_supported"}}catch(x){return this.deps.console?.error("window.nostrã§ã®æç¨¿ã¨ã©ã¼:",x),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}const m=c.getFromStore()||c.loadFromStorage();if(!m)return this.deps.iframeMessageService?.notifyPostError("key_not_found"),{success:!1,error:"key_not_found"};const g=await TO.buildEvent(r,a,l,void 0,n,this.deps.createImetaTagFn,this.deps.getClientTagFn,d,f),y=this.deps.seckeySignerFn?this.deps.seckeySignerFn(m):cx(m),b=await this.eventSender.sendEvent(g,y);return b.success?(this.deps.saveHashtagsToHistoryFn?.(a),this.deps.iframeMessageService?.notifyPostSuccess()):this.deps.iframeMessageService?.notifyPostError(b.error),b}catch(s){return this.deps.console?.error("æç¨¿ã¨ã©ã¼:",s),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}}getEventSender(){return this.eventSender}getHashtagArrays(e){const n=e||oc,r=this.deps.hashtagSnapshotFn;if(r){const i=r(n);return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}if(n===oc)try{const i=q3();return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}catch(i){this.deps.console?.warn("hashtag_snapshot_failed",i)}return{hashtags:Array.isArray(n?.hashtags)?[...n.hashtags]:[],tags:Array.isArray(n?.tags)?n.tags.map(i=>[...i]):[]}}preparePostContent(e){return this.deps.extractContentWithImagesFn(e)||""}prepareImageBlurhashMap(e,n,r){const i=this.deps.extractImageBlurhashMapFn(e),s={};for(const[o,a]of Object.entries(i))s[o]={m:wL(o),blurhash:a,ox:n[o],x:r[o]};return s}async performPostSubmission(e,n,r,i,s,o){const a=this.preparePostContent(e),l=this.prepareImageBlurhashMap(e,n,r);i?.();try{const c=await this.submitPost(a,l);c.success?s?.():o?.(c.error||"post_error")}catch{o?.("post_error")}}applyEmptyStateToEditor(e){e.chain().clearContent().run()}resetPostContent(e){this.applyEmptyStateToEditor(e),this.deps.resetEditorStateFn?.(),this.deps.resetPostStatusFn?.(),Ku.reset(),Sf.reset()}clearContentAfterSuccess(e){const n=this.deps.hashtagPinStore.value,r=n?q3():null;if(this.applyEmptyStateToEditor(e),Ku.reset(),Sf.reset(),n&&r&&r.hashtags.length>0){const i=" "+r.hashtags.map(s=>"#"+s).join(" ");e.commands.insertContent(i),e.commands.focus("start")}}}function Xme(t,e){return e.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}}))})),Object.freeze(t)}function gB(t,e){return new Promise((function(n,r){let i;return Qme(t).then((function(s){try{return i=s,n(new Blob([e.slice(0,2),i,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}}),r)}))}const Qme=t=>new Promise(((e,n)=>{const r=new FileReader;r.addEventListener("load",(({target:{result:i}})=>{const s=new DataView(i);let o=0;if(s.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=s.getUint16(o);if(a===65498)break;const l=s.getUint16(o+2);if(a===65505&&s.getUint32(o+4)===1165519206){const c=o+10;let u;switch(s.getUint16(c)){case 18761:u=!0;break;case 19789:u=!1;break;default:return n("TIFF header contains invalid endian")}if(s.getUint16(c+2,u)!==42)return n("TIFF header contains invalid version");const d=s.getUint32(c+4,u),f=c+d+2+12*s.getUint16(c+d,u);for(let h=c+d+2;h<f;h+=12)if(s.getUint16(h,u)==274){if(s.getUint16(h+2,u)!==3)return n("Orientation data type is invalid");if(s.getUint32(h+4,u)!==1)return n("Orientation data count is invalid");s.setUint16(h+8,1,u);break}return e(i.slice(o,o+2+l))}o+=2+l}return e(new Blob)})),r.readAsArrayBuffer(t)}));var pb={},Yme={get exports(){return pb},set exports(t){pb=t}};(function(t){var e,n,r={};Yme.exports=r,r.parse=function(i,s){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,c={},u=new Uint8Array(i),d=u.length-4;a(u,d)!=101010256;)d--;l=d,l+=4;var f=o(u,l+=4);o(u,l+=2);var h=a(u,l+=2),p=a(u,l+=4);l+=4,l=p;for(var m=0;m<f;m++){a(u,l),l+=4,l+=4,l+=4,a(u,l+=4),h=a(u,l+=4);var g=a(u,l+=4),y=o(u,l+=4),b=o(u,l+2),x=o(u,l+4);l+=6;var C=a(u,l+=8);l+=4,l+=y+b+x,r._readLocal(u,C,c,h,g,s)}return c},r._readLocal=function(i,s,o,a,l,c){var u=r.bin.readUshort,d=r.bin.readUint;d(i,s),u(i,s+=4),u(i,s+=2);var f=u(i,s+=2);d(i,s+=2),d(i,s+=4),s+=4;var h=u(i,s+=8),p=u(i,s+=2);s+=2;var m=r.bin.readUTF8(i,s,h);if(s+=h,s+=p,c)o[m]={size:l,csize:a};else{var g=new Uint8Array(i.buffer,s);if(f==0)o[m]=new Uint8Array(g.buffer.slice(s,s+a));else{if(f!=8)throw"unknown compression method: "+f;var y=new Uint8Array(l);r.inflateRaw(g,y),o[m]=y}}},r.inflateRaw=function(i,s){return r.F.inflate(i,s)},r.inflate=function(i,s){return i[0],i[1],r.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-6),s)},r.deflate=function(i,s){s==null&&(s={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*i.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(i,a,o,s.level);var l=r.adler(i,0,i.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(i,s){s==null&&(s={level:6});var o=new Uint8Array(50+Math.floor(1.1*i.length)),a=r.F.deflateRaw(i,o,a,s.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(i,s){s==null&&(s=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,c={};for(var u in i){var d=!r._noNeed(u)&&!s,f=i[u],h=r.crc.crc(f,0,f.length);c[u]={cpr:d,usize:f.length,crc:h,file:d?r.deflateRaw(f):f}}for(var u in c)o+=c[u].file.length+30+46+2*r.bin.sizeUTF8(u);o+=22;var p=new Uint8Array(o),m=0,g=[];for(var u in c){var y=c[u];g.push(m),m=r._writeHeader(p,m,u,y,0)}var b=0,x=m;for(var u in c)y=c[u],g.push(m),m=r._writeHeader(p,m,u,y,1,g[b++]);var C=m-x;return a(p,m,101010256),m+=4,l(p,m+=4,b),l(p,m+=2,b),a(p,m+=2,C),a(p,m+=4,x),m+=4,m+=2,p.buffer},r._noNeed=function(i){var s=i.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(s)!=-1},r._writeHeader=function(i,s,o,a,l,c){var u=r.bin.writeUint,d=r.bin.writeUshort,f=a.file;return u(i,s,l==0?67324752:33639248),s+=4,l==1&&(s+=2),d(i,s,20),d(i,s+=2,0),d(i,s+=2,a.cpr?8:0),u(i,s+=2,0),u(i,s+=4,a.crc),u(i,s+=4,f.length),u(i,s+=4,a.usize),d(i,s+=4,r.bin.sizeUTF8(o)),d(i,s+=2,0),s+=2,l==1&&(s+=2,s+=2,u(i,s+=6,c),s+=4),s+=r.bin.writeUTF8(i,s,o),l==0&&(i.set(f,s),s+=f.length),s},r.crc={table:(function(){for(var i=new Uint32Array(256),s=0;s<256;s++){for(var o=s,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;i[s]=o}return i})(),update:function(i,s,o,a){for(var l=0;l<a;l++)i=r.crc.table[255&(i^s[o+l])]^i>>>8;return i},crc:function(i,s,o){return 4294967295^r.crc.update(4294967295,i,s,o)}},r.adler=function(i,s,o){for(var a=1,l=0,c=s,u=s+o;c<u;){for(var d=Math.min(c+5552,u);c<d;)l+=a+=i[c++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(i,s){return i[s]|i[s+1]<<8},writeUshort:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255},readUint:function(i,s){return 16777216*i[s+3]+(i[s+2]<<16|i[s+1]<<8|i[s])},writeUint:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255,i[s+2]=o>>16&255,i[s+3]=o>>24&255},readASCII:function(i,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(i[s+l]);return a},writeASCII:function(i,s,o){for(var a=0;a<o.length;a++)i[s+a]=o.charCodeAt(a)},pad:function(i){return i.length<2?"0"+i:i},readUTF8:function(i,s,o){for(var a,l="",c=0;c<o;c++)l+="%"+r.bin.pad(i[s+c].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(i,s,o)}return a},writeUTF8:function(i,s,o){for(var a=o.length,l=0,c=0;c<a;c++){var u=o.charCodeAt(c);if((4294967168&u)==0)i[s+l]=u,l++;else if((4294965248&u)==0)i[s+l]=192|u>>6,i[s+l+1]=128|u>>0&63,l+=2;else if((4294901760&u)==0)i[s+l]=224|u>>12,i[s+l+1]=128|u>>6&63,i[s+l+2]=128|u>>0&63,l+=3;else{if((4292870144&u)!=0)throw"e";i[s+l]=240|u>>18,i[s+l+1]=128|u>>12&63,i[s+l+2]=128|u>>6&63,i[s+l+3]=128|u>>0&63,l+=4}}return l},sizeUTF8:function(i){for(var s=i.length,o=0,a=0;a<s;a++){var l=i.charCodeAt(a);if((4294967168&l)==0)o++;else if((4294965248&l)==0)o+=2;else if((4294901760&l)==0)o+=3;else{if((4292870144&l)!=0)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(i,s,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],c=r.F.U,u=r.F._goodIndex;r.F._hash;var d=r.F._putsE,f=0,h=o<<3,p=0,m=i.length;if(a==0){for(;f<m;)d(s,h,f+(M=Math.min(65535,m-f))==m?1:0),h=r.F._copyExact(i,f,M,s,h+8),f+=M;return h>>>3}var g=c.lits,y=c.strt,b=c.prev,x=0,C=0,P=0,S=0,_=0,k=0;for(m>2&&(y[k=r.F._hash(i,0)]=0),f=0;f<m;f++){if(_=k,f+1<m-2){k=r.F._hash(i,f+1);var T=f+1&32767;b[T]=y[k],y[k]=T}if(p<=f){(x>14e3||C>26697)&&m-f>100&&(p<f&&(g[x]=f-p,x+=2,p=f),h=r.F._writeBlock(f==m-1||p==m?1:0,g,x,S,i,P,f-P,s,h),x=C=S=0,P=f);var O=0;f<m-2&&(O=r.F._bestMatch(i,f,b,_,Math.min(l[2],m-f),l[3]));var M=O>>>16,L=65535&O;if(O!=0){L=65535&O;var F=u(M=O>>>16,c.of0);c.lhst[257+F]++;var B=u(L,c.df0);c.dhst[B]++,S+=c.exb[F]+c.dxb[B],g[x]=M<<23|f-p,g[x+1]=L<<16|F<<8|B,x+=2,p=f+M}else c.lhst[i[f]]++;C++}}for(P==f&&i.length!=0||(p<f&&(g[x]=f-p,x+=2,p=f),h=r.F._writeBlock(1,g,x,S,i,P,f-P,s,h),x=0,C=0,x=C=S=0,P=f);(7&h)!=0;)h++;return h>>>3},r.F._bestMatch=function(i,s,o,a,l,c){var u=32767&s,d=o[u],f=u-d+32768&32767;if(d==u||a!=r.F._hash(i,s-f))return 0;for(var h=0,p=0,m=Math.min(32767,s);f<=m&&--c!=0&&d!=u;){if(h==0||i[s+h]==i[s+h-f]){var g=r.F._howLong(i,s,f);if(g>h){if(p=f,(h=g)>=l)break;f+2<g&&(g=f+2);for(var y=0,b=0;b<g-2;b++){var x=s-f+b+32768&32767,C=x-o[x]+32768&32767;C>y&&(y=C,d=x)}}}f+=(u=d)-(d=o[u])+32768&32767}return h<<16|p},r.F._howLong=function(i,s,o){if(i[s]!=i[s-o]||i[s+1]!=i[s+1-o]||i[s+2]!=i[s+2-o])return 0;var a=s,l=Math.min(i.length,s+258);for(s+=3;s<l&&i[s]==i[s-o];)s++;return s-a},r.F._hash=function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(i,s,o,a,l,c,u,d,f){var h,p,m,g,y,b,x,C,P,S=r.F.U,_=r.F._putsF,k=r.F._putsE;S.lhst[256]++,p=(h=r.F.getTrees())[0],m=h[1],g=h[2],y=h[3],b=h[4],x=h[5],C=h[6],P=h[7];var T=32+((f+3&7)==0?0:8-(f+3&7))+(u<<3),O=a+r.F.contSize(S.fltree,S.lhst)+r.F.contSize(S.fdtree,S.dhst),M=a+r.F.contSize(S.ltree,S.lhst)+r.F.contSize(S.dtree,S.dhst);M+=14+3*x+r.F.contSize(S.itree,S.ihst)+(2*S.ihst[16]+3*S.ihst[17]+7*S.ihst[18]);for(var L=0;L<286;L++)S.lhst[L]=0;for(L=0;L<30;L++)S.dhst[L]=0;for(L=0;L<19;L++)S.ihst[L]=0;var F=T<O&&T<M?0:O<M?1:2;if(_(d,f,i),_(d,f+1,F),f+=3,F==0){for(;(7&f)!=0;)f++;f=r.F._copyExact(l,c,u,d,f)}else{var B,R;if(F==1&&(B=S.fltree,R=S.fdtree),F==2){r.F.makeCodes(S.ltree,p),r.F.revCodes(S.ltree,p),r.F.makeCodes(S.dtree,m),r.F.revCodes(S.dtree,m),r.F.makeCodes(S.itree,g),r.F.revCodes(S.itree,g),B=S.ltree,R=S.dtree,k(d,f,y-257),k(d,f+=5,b-1),k(d,f+=5,x-4),f+=4;for(var A=0;A<x;A++)k(d,f+3*A,S.itree[1+(S.ordr[A]<<1)]);f+=3*x,f=r.F._codeTiny(C,S.itree,d,f),f=r.F._codeTiny(P,S.itree,d,f)}for(var N=c,z=0;z<o;z+=2){for(var U=s[z],V=U>>>23,q=N+(8388607&U);N<q;)f=r.F._writeLit(l[N++],B,d,f);if(V!=0){var G=s[z+1],ne=G>>16,te=G>>8&255,Z=255&G;k(d,f=r.F._writeLit(257+te,B,d,f),V-S.of0[te]),f+=S.exb[te],_(d,f=r.F._writeLit(Z,R,d,f),ne-S.df0[Z]),f+=S.dxb[Z],N+=V}}f=r.F._writeLit(256,B,d,f)}return f},r.F._copyExact=function(i,s,o,a,l){var c=l>>>3;return a[c]=o,a[c+1]=o>>>8,a[c+2]=255-a[c],a[c+3]=255-a[c+1],c+=4,a.set(new Uint8Array(i.buffer,s,o),c),l+(o+4<<3)},r.F.getTrees=function(){for(var i=r.F.U,s=r.F._hufTree(i.lhst,i.ltree,15),o=r.F._hufTree(i.dhst,i.dtree,15),a=[],l=r.F._lenCodes(i.ltree,a),c=[],u=r.F._lenCodes(i.dtree,c),d=0;d<a.length;d+=2)i.ihst[a[d]]++;for(d=0;d<c.length;d+=2)i.ihst[c[d]]++;for(var f=r.F._hufTree(i.ihst,i.itree,7),h=19;h>4&&i.itree[1+(i.ordr[h-1]<<1)]==0;)h--;return[s,o,f,l,u,h,a,c]},r.F.getSecond=function(i){for(var s=[],o=0;o<i.length;o+=2)s.push(i[o+1]);return s},r.F.nonZero=function(i){for(var s="",o=0;o<i.length;o+=2)i[o+1]!=0&&(s+=(o>>1)+",");return s},r.F.contSize=function(i,s){for(var o=0,a=0;a<s.length;a++)o+=s[a]*i[1+(a<<1)];return o},r.F._codeTiny=function(i,s,o,a){for(var l=0;l<i.length;l+=2){var c=i[l],u=i[l+1];a=r.F._writeLit(c,s,o,a);var d=c==16?2:c==17?3:7;c>15&&(r.F._putsE(o,a,u,d),a+=d)}return a},r.F._lenCodes=function(i,s){for(var o=i.length;o!=2&&i[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=i[a+1],c=a+3<o?i[a+3]:-1,u=a+5<o?i[a+5]:-1,d=a==0?-1:i[a-1];if(l==0&&c==l&&u==l){for(var f=a+5;f+2<o&&i[f+2]==l;)f+=2;(h=Math.min(f+1-a>>>1,138))<11?s.push(17,h-3):s.push(18,h-11),a+=2*h-2}else if(l==d&&c==l&&u==l){for(f=a+5;f+2<o&&i[f+2]==l;)f+=2;var h=Math.min(f+1-a>>>1,6);s.push(16,h-3),a+=2*h-2}else s.push(l,0)}return o>>>1},r.F._hufTree=function(i,s,o){var a=[],l=i.length,c=s.length,u=0;for(u=0;u<c;u+=2)s[u]=0,s[u+1]=0;for(u=0;u<l;u++)i[u]!=0&&a.push({lit:u,f:i[u]});var d=a.length,f=a.slice(0);if(d==0)return 0;if(d==1){var h=a[0].lit;return f=h==0?1:0,s[1+(h<<1)]=1,s[1+(f<<1)]=1,1}a.sort((function(C,P){return C.f-P.f}));var p=a[0],m=a[1],g=0,y=1,b=2;for(a[0]={lit:-1,f:p.f+m.f,l:p,r:m,d:0};y!=d-1;)p=g!=y&&(b==d||a[g].f<a[b].f)?a[g++]:a[b++],m=g!=y&&(b==d||a[g].f<a[b].f)?a[g++]:a[b++],a[y++]={lit:-1,f:p.f+m.f,l:p,r:m};var x=r.F.setDepth(a[y-1],0);for(x>o&&(r.F.restrictDepth(f,o,x),x=o),u=0;u<d;u++)s[1+(f[u].lit<<1)]=f[u].d;return x},r.F.setDepth=function(i,s){return i.lit!=-1?(i.d=s,s):Math.max(r.F.setDepth(i.l,s+1),r.F.setDepth(i.r,s+1))},r.F.restrictDepth=function(i,s,o){var a=0,l=1<<o-s,c=0;for(i.sort((function(d,f){return f.d==d.d?d.f-f.f:f.d-d.d})),a=0;a<i.length&&i[a].d>s;a++){var u=i[a].d;i[a].d=s,c+=l-(1<<o-u)}for(c>>>=o-s;c>0;)(u=i[a].d)<s?(i[a].d++,c-=1<<s-u-1):a++;for(;a>=0;a--)i[a].d==s&&c<0&&(i[a].d--,c++);c!=0&&console.log("debt left")},r.F._goodIndex=function(i,s){var o=0;return s[16|o]<=i&&(o|=16),s[8|o]<=i&&(o|=8),s[4|o]<=i&&(o|=4),s[2|o]<=i&&(o|=2),s[1|o]<=i&&(o|=1),o},r.F._writeLit=function(i,s,o,a){return r.F._putsF(o,a,s[i<<1]),a+s[1+(i<<1)]},r.F.inflate=function(i,s){var o=Uint8Array;if(i[0]==3&&i[1]==0)return s||new o(0);var a=r.F,l=a._bitsF,c=a._bitsE,u=a._decodeTiny,d=a.makeCodes,f=a.codes2map,h=a._get17,p=a.U,m=s==null;m&&(s=new o(i.length>>>2<<3));for(var g,y,b=0,x=0,C=0,P=0,S=0,_=0,k=0,T=0,O=0;b==0;)if(b=l(i,O,1),x=l(i,O+1,2),O+=3,x!=0){if(m&&(s=r.F._check(s,T+(1<<17))),x==1&&(g=p.flmap,y=p.fdmap,_=511,k=31),x==2){C=c(i,O,5)+257,P=c(i,O+5,5)+1,S=c(i,O+10,4)+4,O+=14;for(var M=0;M<38;M+=2)p.itree[M]=0,p.itree[M+1]=0;var L=1;for(M=0;M<S;M++){var F=c(i,O+3*M,3);p.itree[1+(p.ordr[M]<<1)]=F,F>L&&(L=F)}O+=3*S,d(p.itree,L),f(p.itree,L,p.imap),g=p.lmap,y=p.dmap,O=u(p.imap,(1<<L)-1,C+P,i,O,p.ttree);var B=a._copyOut(p.ttree,0,C,p.ltree);_=(1<<B)-1;var R=a._copyOut(p.ttree,C,P,p.dtree);k=(1<<R)-1,d(p.ltree,B),f(p.ltree,B,g),d(p.dtree,R),f(p.dtree,R,y)}for(;;){var A=g[h(i,O)&_];O+=15&A;var N=A>>>4;if(!(N>>>8))s[T++]=N;else{if(N==256)break;var z=T+N-254;if(N>264){var U=p.ldef[N-257];z=T+(U>>>3)+c(i,O,7&U),O+=7&U}var V=y[h(i,O)&k];O+=15&V;var q=V>>>4,G=p.ddef[q],ne=(G>>>4)+l(i,O,15&G);for(O+=15&G,m&&(s=r.F._check(s,T+(1<<17)));T<z;)s[T]=s[T++-ne],s[T]=s[T++-ne],s[T]=s[T++-ne],s[T]=s[T++-ne];T=z}}}else{(7&O)!=0&&(O+=8-(7&O));var te=4+(O>>>3),Z=i[te-4]|i[te-3]<<8;m&&(s=r.F._check(s,T+Z)),s.set(new o(i.buffer,i.byteOffset+te,Z),T),O=te+Z<<3,T+=Z}return s.length==T?s:s.slice(0,T)},r.F._check=function(i,s){var o=i.length;if(s<=o)return i;var a=new Uint8Array(Math.max(o<<1,s));return a.set(i,0),a},r.F._decodeTiny=function(i,s,o,a,l,c){for(var u=r.F._bitsE,d=r.F._get17,f=0;f<o;){var h=i[d(a,l)&s];l+=15&h;var p=h>>>4;if(p<=15)c[f]=p,f++;else{var m=0,g=0;p==16?(g=3+u(a,l,2),l+=2,m=c[f-1]):p==17?(g=3+u(a,l,3),l+=3):p==18&&(g=11+u(a,l,7),l+=7);for(var y=f+g;f<y;)c[f]=m,f++}}return l},r.F._copyOut=function(i,s,o,a){for(var l=0,c=0,u=a.length>>>1;c<o;){var d=i[c+s];a[c<<1]=0,a[1+(c<<1)]=d,d>l&&(l=d),c++}for(;c<u;)a[c<<1]=0,a[1+(c<<1)]=0,c++;return l},r.F.makeCodes=function(i,s){for(var o,a,l,c,u=r.F.U,d=i.length,f=u.bl_count,h=0;h<=s;h++)f[h]=0;for(h=1;h<d;h+=2)f[i[h]]++;var p=u.next_code;for(o=0,f[0]=0,a=1;a<=s;a++)o=o+f[a-1]<<1,p[a]=o;for(l=0;l<d;l+=2)(c=i[l+1])!=0&&(i[l]=p[c],p[c]++)},r.F.codes2map=function(i,s,o){for(var a=i.length,l=r.F.U.rev15,c=0;c<a;c+=2)if(i[c+1]!=0)for(var u=c>>1,d=i[c+1],f=u<<4|d,h=s-d,p=i[c]<<h,m=p+(1<<h);p!=m;)o[l[p]>>>15-s]=f,p++},r.F.revCodes=function(i,s){for(var o=r.F.U.rev15,a=15-s,l=0;l<i.length;l+=2){var c=i[l]<<s-i[l+1];i[l]=o[c]>>>a}},r.F._putsE=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8},r.F._putsF=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8,i[a+2]|=o>>>16},r.F._bitsE=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8)>>>(7&s)&(1<<o)-1},r.F._bitsF=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)&(1<<o)-1},r.F._get17=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)},r.F._get25=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16|i[3+(s>>>3)]<<24)>>>(7&s)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),(function(){for(var i=r.F.U,s=0;s<32768;s++){var o=s;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,i.rev15[s]=(o>>>16|o<<16)>>>17}function a(l,c,u){for(;c--!=0;)l.push(0,u)}for(s=0;s<32;s++)i.ldef[s]=i.of0[s]<<3|i.exb[s],i.ddef[s]=i.df0[s]<<4|i.dxb[s];a(i.fltree,144,8),a(i.fltree,112,9),a(i.fltree,24,7),a(i.fltree,8,8),r.F.makeCodes(i.fltree,9),r.F.codes2map(i.fltree,9,i.flmap),r.F.revCodes(i.fltree,9),a(i.fdtree,32,5),r.F.makeCodes(i.fdtree,5),r.F.codes2map(i.fdtree,5,i.fdmap),r.F.revCodes(i.fdtree,5),a(i.itree,19,0),a(i.ltree,286,0),a(i.dtree,30,0),a(i.ttree,320,0)})()})();var Jme=Xme({__proto__:null,default:pb},[pb]);const Qs=(function(){var t={nextZero(u,d){for(;u[d]!=0;)d++;return d},readUshort:(u,d)=>u[d]<<8|u[d+1],writeUshort(u,d,f){u[d]=f>>8&255,u[d+1]=255&f},readUint:(u,d)=>16777216*u[d]+(u[d+1]<<16|u[d+2]<<8|u[d+3]),writeUint(u,d,f){u[d]=f>>24&255,u[d+1]=f>>16&255,u[d+2]=f>>8&255,u[d+3]=255&f},readASCII(u,d,f){let h="";for(let p=0;p<f;p++)h+=String.fromCharCode(u[d+p]);return h},writeASCII(u,d,f){for(let h=0;h<f.length;h++)u[d+h]=f.charCodeAt(h)},readBytes(u,d,f){const h=[];for(let p=0;p<f;p++)h.push(u[d+p]);return h},pad:u=>u.length<2?`0${u}`:u,readUTF8(u,d,f){let h,p="";for(let m=0;m<f;m++)p+=`%${t.pad(u[d+m].toString(16))}`;try{h=decodeURIComponent(p)}catch{return t.readASCII(u,d,f)}return h}};function e(u,d,f,h){const p=d*f,m=s(h),g=Math.ceil(d*m/8),y=new Uint8Array(4*p),b=new Uint32Array(y.buffer),{ctype:x}=h,{depth:C}=h,P=t.readUshort;if(x==6){const U=p<<2;if(C==8)for(var S=0;S<U;S+=4)y[S]=u[S],y[S+1]=u[S+1],y[S+2]=u[S+2],y[S+3]=u[S+3];if(C==16)for(S=0;S<U;S++)y[S]=u[S<<1]}else if(x==2){const U=h.tabs.tRNS;if(U==null){if(C==8)for(S=0;S<p;S++){var _=3*S;b[S]=255<<24|u[_+2]<<16|u[_+1]<<8|u[_]}if(C==16)for(S=0;S<p;S++)_=6*S,b[S]=255<<24|u[_+4]<<16|u[_+2]<<8|u[_]}else{var k=U[0];const V=U[1],q=U[2];if(C==8)for(S=0;S<p;S++){var T=S<<2;_=3*S,b[S]=255<<24|u[_+2]<<16|u[_+1]<<8|u[_],u[_]==k&&u[_+1]==V&&u[_+2]==q&&(y[T+3]=0)}if(C==16)for(S=0;S<p;S++)T=S<<2,_=6*S,b[S]=255<<24|u[_+4]<<16|u[_+2]<<8|u[_],P(u,_)==k&&P(u,_+2)==V&&P(u,_+4)==q&&(y[T+3]=0)}}else if(x==3){const U=h.tabs.PLTE,V=h.tabs.tRNS,q=V?V.length:0;if(C==1)for(var O=0;O<f;O++){var M=O*g,L=O*d;for(S=0;S<d;S++){T=L+S<<2;var F=3*(B=u[M+(S>>3)]>>7-((7&S)<<0)&1);y[T]=U[F],y[T+1]=U[F+1],y[T+2]=U[F+2],y[T+3]=B<q?V[B]:255}}if(C==2)for(O=0;O<f;O++)for(M=O*g,L=O*d,S=0;S<d;S++)T=L+S<<2,F=3*(B=u[M+(S>>2)]>>6-((3&S)<<1)&3),y[T]=U[F],y[T+1]=U[F+1],y[T+2]=U[F+2],y[T+3]=B<q?V[B]:255;if(C==4)for(O=0;O<f;O++)for(M=O*g,L=O*d,S=0;S<d;S++)T=L+S<<2,F=3*(B=u[M+(S>>1)]>>4-((1&S)<<2)&15),y[T]=U[F],y[T+1]=U[F+1],y[T+2]=U[F+2],y[T+3]=B<q?V[B]:255;if(C==8)for(S=0;S<p;S++){var B;T=S<<2,F=3*(B=u[S]),y[T]=U[F],y[T+1]=U[F+1],y[T+2]=U[F+2],y[T+3]=B<q?V[B]:255}}else if(x==4){if(C==8)for(S=0;S<p;S++){T=S<<2;var R=u[A=S<<1];y[T]=R,y[T+1]=R,y[T+2]=R,y[T+3]=u[A+1]}if(C==16)for(S=0;S<p;S++){var A;T=S<<2,R=u[A=S<<2],y[T]=R,y[T+1]=R,y[T+2]=R,y[T+3]=u[A+2]}}else if(x==0)for(k=h.tabs.tRNS?h.tabs.tRNS:-1,O=0;O<f;O++){const U=O*g,V=O*d;if(C==1)for(var N=0;N<d;N++){var z=(R=255*(u[U+(N>>>3)]>>>7-(7&N)&1))==255*k?0:255;b[V+N]=z<<24|R<<16|R<<8|R}else if(C==2)for(N=0;N<d;N++)z=(R=85*(u[U+(N>>>2)]>>>6-((3&N)<<1)&3))==85*k?0:255,b[V+N]=z<<24|R<<16|R<<8|R;else if(C==4)for(N=0;N<d;N++)z=(R=17*(u[U+(N>>>1)]>>>4-((1&N)<<2)&15))==17*k?0:255,b[V+N]=z<<24|R<<16|R<<8|R;else if(C==8)for(N=0;N<d;N++)z=(R=u[U+N])==k?0:255,b[V+N]=z<<24|R<<16|R<<8|R;else if(C==16)for(N=0;N<d;N++)R=u[U+(N<<1)],z=P(u,U+(N<<1))==k?0:255,b[V+N]=z<<24|R<<16|R<<8|R}return y}function n(u,d,f,h){const p=s(u),m=Math.ceil(f*p/8),g=new Uint8Array((m+1+u.interlace)*h);return d=u.tabs.CgBI?i(d,g):r(d,g),u.interlace==0?d=o(d,u,0,f,h):u.interlace==1&&(d=(function(b,x){const C=x.width,P=x.height,S=s(x),_=S>>3,k=Math.ceil(C*S/8),T=new Uint8Array(P*k);let O=0;const M=[0,0,4,0,2,0,1],L=[0,4,0,2,0,1,0],F=[8,8,8,4,4,2,2],B=[8,8,4,4,2,2,1];let R=0;for(;R<7;){const N=F[R],z=B[R];let U=0,V=0,q=M[R];for(;q<P;)q+=N,V++;let G=L[R];for(;G<C;)G+=z,U++;const ne=Math.ceil(U*S/8);o(b,x,O,U,V);let te=0,Z=M[R];for(;Z<P;){let ae=L[R],_e=O+te*ne<<3;for(;ae<C;){var A;if(S==1&&(A=(A=b[_e>>3])>>7-(7&_e)&1,T[Z*k+(ae>>3)]|=A<<7-((7&ae)<<0)),S==2&&(A=(A=b[_e>>3])>>6-(7&_e)&3,T[Z*k+(ae>>2)]|=A<<6-((3&ae)<<1)),S==4&&(A=(A=b[_e>>3])>>4-(7&_e)&15,T[Z*k+(ae>>1)]|=A<<4-((1&ae)<<2)),S>=8){const de=Z*k+ae*_;for(let Ee=0;Ee<_;Ee++)T[de+Ee]=b[(_e>>3)+Ee]}_e+=S,ae+=z}te++,Z+=N}U*V!=0&&(O+=V*(1+ne)),R+=1}return T})(d,u)),d}function r(u,d){return i(new Uint8Array(u.buffer,2,u.length-6),d)}var i=(function(){const u={H:{}};return u.H.N=function(d,f){const h=Uint8Array;let p,m,g=0,y=0,b=0,x=0,C=0,P=0,S=0,_=0,k=0;if(d[0]==3&&d[1]==0)return f||new h(0);const T=u.H,O=T.b,M=T.e,L=T.R,F=T.n,B=T.A,R=T.Z,A=T.m,N=f==null;for(N&&(f=new h(d.length>>>2<<5));g==0;)if(g=O(d,k,1),y=O(d,k+1,2),k+=3,y!=0){if(N&&(f=u.H.W(f,_+(1<<17))),y==1&&(p=A.J,m=A.h,P=511,S=31),y==2){b=M(d,k,5)+257,x=M(d,k+5,5)+1,C=M(d,k+10,4)+4,k+=14;let U=1;for(var z=0;z<38;z+=2)A.Q[z]=0,A.Q[z+1]=0;for(z=0;z<C;z++){const G=M(d,k+3*z,3);A.Q[1+(A.X[z]<<1)]=G,G>U&&(U=G)}k+=3*C,F(A.Q,U),B(A.Q,U,A.u),p=A.w,m=A.d,k=L(A.u,(1<<U)-1,b+x,d,k,A.v);const V=T.V(A.v,0,b,A.C);P=(1<<V)-1;const q=T.V(A.v,b,x,A.D);S=(1<<q)-1,F(A.C,V),B(A.C,V,p),F(A.D,q),B(A.D,q,m)}for(;;){const U=p[R(d,k)&P];k+=15&U;const V=U>>>4;if(!(V>>>8))f[_++]=V;else{if(V==256)break;{let q=_+V-254;if(V>264){const ae=A.q[V-257];q=_+(ae>>>3)+M(d,k,7&ae),k+=7&ae}const G=m[R(d,k)&S];k+=15&G;const ne=G>>>4,te=A.c[ne],Z=(te>>>4)+O(d,k,15&te);for(k+=15&te;_<q;)f[_]=f[_++-Z],f[_]=f[_++-Z],f[_]=f[_++-Z],f[_]=f[_++-Z];_=q}}}}else{(7&k)!=0&&(k+=8-(7&k));const U=4+(k>>>3),V=d[U-4]|d[U-3]<<8;N&&(f=u.H.W(f,_+V)),f.set(new h(d.buffer,d.byteOffset+U,V),_),k=U+V<<3,_+=V}return f.length==_?f:f.slice(0,_)},u.H.W=function(d,f){const h=d.length;if(f<=h)return d;const p=new Uint8Array(h<<1);return p.set(d,0),p},u.H.R=function(d,f,h,p,m,g){const y=u.H.e,b=u.H.Z;let x=0;for(;x<h;){const C=d[b(p,m)&f];m+=15&C;const P=C>>>4;if(P<=15)g[x]=P,x++;else{let S=0,_=0;P==16?(_=3+y(p,m,2),m+=2,S=g[x-1]):P==17?(_=3+y(p,m,3),m+=3):P==18&&(_=11+y(p,m,7),m+=7);const k=x+_;for(;x<k;)g[x]=S,x++}}return m},u.H.V=function(d,f,h,p){let m=0,g=0;const y=p.length>>>1;for(;g<h;){const b=d[g+f];p[g<<1]=0,p[1+(g<<1)]=b,b>m&&(m=b),g++}for(;g<y;)p[g<<1]=0,p[1+(g<<1)]=0,g++;return m},u.H.n=function(d,f){const h=u.H.m,p=d.length;let m,g,y,b;const x=h.j;for(var C=0;C<=f;C++)x[C]=0;for(C=1;C<p;C+=2)x[d[C]]++;const P=h.K;for(m=0,x[0]=0,g=1;g<=f;g++)m=m+x[g-1]<<1,P[g]=m;for(y=0;y<p;y+=2)b=d[y+1],b!=0&&(d[y]=P[b],P[b]++)},u.H.A=function(d,f,h){const p=d.length,m=u.H.m.r;for(let g=0;g<p;g+=2)if(d[g+1]!=0){const y=g>>1,b=d[g+1],x=y<<4|b,C=f-b;let P=d[g]<<C;const S=P+(1<<C);for(;P!=S;)h[m[P]>>>15-f]=x,P++}},u.H.l=function(d,f){const h=u.H.m.r,p=15-f;for(let m=0;m<d.length;m+=2){const g=d[m]<<f-d[m+1];d[m]=h[g]>>>p}},u.H.M=function(d,f,h){h<<=7&f;const p=f>>>3;d[p]|=h,d[p+1]|=h>>>8},u.H.I=function(d,f,h){h<<=7&f;const p=f>>>3;d[p]|=h,d[p+1]|=h>>>8,d[p+2]|=h>>>16},u.H.e=function(d,f,h){return(d[f>>>3]|d[1+(f>>>3)]<<8)>>>(7&f)&(1<<h)-1},u.H.b=function(d,f,h){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)&(1<<h)-1},u.H.Z=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)},u.H.i=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16|d[3+(f>>>3)]<<24)>>>(7&f)},u.H.m=(function(){const d=Uint16Array,f=Uint32Array;return{K:new d(16),j:new d(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new d(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new f(32),J:new d(512),_:[],h:new d(32),$:[],w:new d(32768),C:[],v:[],d:new d(32768),D:[],u:new d(512),Q:[],r:new d(32768),s:new f(286),Y:new f(30),a:new f(19),t:new f(15e3),k:new d(65536),g:new d(32768)}})(),(function(){const d=u.H.m;for(var f=0;f<32768;f++){let p=f;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,d.r[f]=(p>>>16|p<<16)>>>17}function h(p,m,g){for(;m--!=0;)p.push(0,g)}for(f=0;f<32;f++)d.q[f]=d.S[f]<<3|d.T[f],d.c[f]=d.p[f]<<4|d.z[f];h(d._,144,8),h(d._,112,9),h(d._,24,7),h(d._,8,8),u.H.n(d._,9),u.H.A(d._,9,d.J),u.H.l(d._,9),h(d.$,32,5),u.H.n(d.$,5),u.H.A(d.$,5,d.h),u.H.l(d.$,5),h(d.Q,19,0),h(d.C,286,0),h(d.D,30,0),h(d.v,320,0)})(),u.H.N})();function s(u){return[1,null,3,1,2,null,4][u.ctype]*u.depth}function o(u,d,f,h,p){let m=s(d);const g=Math.ceil(h*m/8);let y,b;m=Math.ceil(m/8);let x=u[f],C=0;if(x>1&&(u[f]=[0,0,1][x-2]),x==3)for(C=m;C<g;C++)u[C+1]=u[C+1]+(u[C+1-m]>>>1)&255;for(let P=0;P<p;P++)if(y=f+P*g,b=y+P+1,x=u[b-1],C=0,x==0)for(;C<g;C++)u[y+C]=u[b+C];else if(x==1){for(;C<m;C++)u[y+C]=u[b+C];for(;C<g;C++)u[y+C]=u[b+C]+u[y+C-m]}else if(x==2)for(;C<g;C++)u[y+C]=u[b+C]+u[y+C-g];else if(x==3){for(;C<m;C++)u[y+C]=u[b+C]+(u[y+C-g]>>>1);for(;C<g;C++)u[y+C]=u[b+C]+(u[y+C-g]+u[y+C-m]>>>1)}else{for(;C<m;C++)u[y+C]=u[b+C]+a(0,u[y+C-g],0);for(;C<g;C++)u[y+C]=u[b+C]+a(u[y+C-m],u[y+C-g],u[y+C-m-g])}return u}function a(u,d,f){const h=u+d-f,p=h-u,m=h-d,g=h-f;return p*p<=m*m&&p*p<=g*g?u:m*m<=g*g?d:f}function l(u,d,f){f.width=t.readUint(u,d),d+=4,f.height=t.readUint(u,d),d+=4,f.depth=u[d],d++,f.ctype=u[d],d++,f.compress=u[d],d++,f.filter=u[d],d++,f.interlace=u[d],d++}function c(u,d,f,h,p,m,g,y,b){const x=Math.min(d,p),C=Math.min(f,m);let P=0,S=0;for(let R=0;R<C;R++)for(let A=0;A<x;A++)if(g>=0&&y>=0?(P=R*d+A<<2,S=(y+R)*p+g+A<<2):(P=(-y+R)*d-g+A<<2,S=R*p+A<<2),b==0)h[S]=u[P],h[S+1]=u[P+1],h[S+2]=u[P+2],h[S+3]=u[P+3];else if(b==1){var _=u[P+3]*.00392156862745098,k=u[P]*_,T=u[P+1]*_,O=u[P+2]*_,M=h[S+3]*(1/255),L=h[S]*M,F=h[S+1]*M,B=h[S+2]*M;const N=1-_,z=_+M*N,U=z==0?0:1/z;h[S+3]=255*z,h[S+0]=(k+L*N)*U,h[S+1]=(T+F*N)*U,h[S+2]=(O+B*N)*U}else if(b==2)_=u[P+3],k=u[P],T=u[P+1],O=u[P+2],M=h[S+3],L=h[S],F=h[S+1],B=h[S+2],_==M&&k==L&&T==F&&O==B?(h[S]=0,h[S+1]=0,h[S+2]=0,h[S+3]=0):(h[S]=k,h[S+1]=T,h[S+2]=O,h[S+3]=_);else if(b==3){if(_=u[P+3],k=u[P],T=u[P+1],O=u[P+2],M=h[S+3],L=h[S],F=h[S+1],B=h[S+2],_==M&&k==L&&T==F&&O==B)continue;if(_<220&&M>20)return!1}return!0}return{decode:function(d){const f=new Uint8Array(d);let h=8;const p=t,m=p.readUshort,g=p.readUint,y={tabs:{},frames:[]},b=new Uint8Array(f.length);let x,C=0,P=0;const S=[137,80,78,71,13,10,26,10];for(var _=0;_<8;_++)if(f[_]!=S[_])throw"The input is not a PNG file!";for(;h<f.length;){const R=p.readUint(f,h);h+=4;const A=p.readASCII(f,h,4);if(h+=4,A=="IHDR")l(f,h,y);else if(A=="iCCP"){for(var k=h;f[k]!=0;)k++;p.readASCII(f,h,k-h),f[k+1];const N=f.slice(k+2,h+R);let z=null;try{z=r(N)}catch{z=i(N)}y.tabs[A]=z}else if(A=="CgBI")y.tabs[A]=f.slice(h,h+4);else if(A=="IDAT"){for(_=0;_<R;_++)b[C+_]=f[h+_];C+=R}else if(A=="acTL")y.tabs[A]={num_frames:g(f,h),num_plays:g(f,h+4)},x=new Uint8Array(f.length);else if(A=="fcTL"){P!=0&&((B=y.frames[y.frames.length-1]).data=n(y,x.slice(0,P),B.rect.width,B.rect.height),P=0);const N={x:g(f,h+12),y:g(f,h+16),width:g(f,h+4),height:g(f,h+8)};let z=m(f,h+22);z=m(f,h+20)/(z==0?100:z);const U={rect:N,delay:Math.round(1e3*z),dispose:f[h+24],blend:f[h+25]};y.frames.push(U)}else if(A=="fdAT"){for(_=0;_<R-4;_++)x[P+_]=f[h+_+4];P+=R-4}else if(A=="pHYs")y.tabs[A]=[p.readUint(f,h),p.readUint(f,h+4),f[h+8]];else if(A=="cHRM")for(y.tabs[A]=[],_=0;_<8;_++)y.tabs[A].push(p.readUint(f,h+4*_));else if(A=="tEXt"||A=="zTXt"){y.tabs[A]==null&&(y.tabs[A]={});var T=p.nextZero(f,h),O=p.readASCII(f,h,T-h),M=h+R-T-1;if(A=="tEXt")F=p.readASCII(f,T+1,M);else{var L=r(f.slice(T+2,T+2+M));F=p.readUTF8(L,0,L.length)}y.tabs[A][O]=F}else if(A=="iTXt"){y.tabs[A]==null&&(y.tabs[A]={}),T=0,k=h,T=p.nextZero(f,k),O=p.readASCII(f,k,T-k);const N=f[k=T+1];var F;f[k+1],k+=2,T=p.nextZero(f,k),p.readASCII(f,k,T-k),k=T+1,T=p.nextZero(f,k),p.readUTF8(f,k,T-k),M=R-((k=T+1)-h),N==0?F=p.readUTF8(f,k,M):(L=r(f.slice(k,k+M)),F=p.readUTF8(L,0,L.length)),y.tabs[A][O]=F}else if(A=="PLTE")y.tabs[A]=p.readBytes(f,h,R);else if(A=="hIST"){const N=y.tabs.PLTE.length/3;for(y.tabs[A]=[],_=0;_<N;_++)y.tabs[A].push(m(f,h+2*_))}else if(A=="tRNS")y.ctype==3?y.tabs[A]=p.readBytes(f,h,R):y.ctype==0?y.tabs[A]=m(f,h):y.ctype==2&&(y.tabs[A]=[m(f,h),m(f,h+2),m(f,h+4)]);else if(A=="gAMA")y.tabs[A]=p.readUint(f,h)/1e5;else if(A=="sRGB")y.tabs[A]=f[h];else if(A=="bKGD")y.ctype==0||y.ctype==4?y.tabs[A]=[m(f,h)]:y.ctype==2||y.ctype==6?y.tabs[A]=[m(f,h),m(f,h+2),m(f,h+4)]:y.ctype==3&&(y.tabs[A]=f[h]);else if(A=="IEND")break;h+=R,p.readUint(f,h),h+=4}var B;return P!=0&&((B=y.frames[y.frames.length-1]).data=n(y,x.slice(0,P),B.rect.width,B.rect.height)),y.data=n(y,b,y.width,y.height),delete y.compress,delete y.interlace,delete y.filter,y},toRGBA8:function(d){const f=d.width,h=d.height;if(d.tabs.acTL==null)return[e(d.data,f,h,d).buffer];const p=[];d.frames[0].data==null&&(d.frames[0].data=d.data);const m=f*h*4,g=new Uint8Array(m),y=new Uint8Array(m),b=new Uint8Array(m);for(let C=0;C<d.frames.length;C++){const P=d.frames[C],S=P.rect.x,_=P.rect.y,k=P.rect.width,T=P.rect.height,O=e(P.data,k,T,d);if(C!=0)for(var x=0;x<m;x++)b[x]=g[x];if(P.blend==0?c(O,k,T,g,f,h,S,_,0):P.blend==1&&c(O,k,T,g,f,h,S,_,1),p.push(g.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)c(y,k,T,g,f,h,S,_,0);else if(P.dispose==2)for(x=0;x<m;x++)g[x]=b[x]}}return p},_paeth:a,_copyTile:c,_bin:t}})();(function(){const{_copyTile:t}=Qs,{_bin:e}=Qs,n=Qs._paeth;var r={table:(function(){const k=new Uint32Array(256);for(let T=0;T<256;T++){let O=T;for(let M=0;M<8;M++)1&O?O=3988292384^O>>>1:O>>>=1;k[T]=O}return k})(),update(k,T,O,M){for(let L=0;L<M;L++)k=r.table[255&(k^T[O+L])]^k>>>8;return k},crc:(k,T,O)=>4294967295^r.update(4294967295,k,T,O)};function i(k,T,O,M){T[O]+=k[0]*M>>4,T[O+1]+=k[1]*M>>4,T[O+2]+=k[2]*M>>4,T[O+3]+=k[3]*M>>4}function s(k){return Math.max(0,Math.min(255,k))}function o(k,T){const O=k[0]-T[0],M=k[1]-T[1],L=k[2]-T[2],F=k[3]-T[3];return O*O+M*M+L*L+F*F}function a(k,T,O,M,L,F,B){B==null&&(B=1);const R=M.length,A=[];for(var N=0;N<R;N++){const Z=M[N];A.push([Z>>>0&255,Z>>>8&255,Z>>>16&255,Z>>>24&255])}for(N=0;N<R;N++){let Z=4294967295;for(var z=0,U=0;U<R;U++){var V=o(A[N],A[U]);U!=N&&V<Z&&(Z=V,z=U)}}const q=new Uint32Array(L.buffer),G=new Int16Array(T*O*4),ne=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(N=0;N<ne.length;N++)ne[N]=255*((ne[N]+.5)/16-.5);for(let Z=0;Z<O;Z++)for(let ae=0;ae<T;ae++){var te;N=4*(Z*T+ae),B!=2?te=[s(k[N]+G[N]),s(k[N+1]+G[N+1]),s(k[N+2]+G[N+2]),s(k[N+3]+G[N+3])]:(V=ne[4*(3&Z)+(3&ae)],te=[s(k[N]+V),s(k[N+1]+V),s(k[N+2]+V),s(k[N+3]+V)]),z=0;let _e=16777215;for(U=0;U<R;U++){const Re=o(te,A[U]);Re<_e&&(_e=Re,z=U)}const de=A[z],Ee=[te[0]-de[0],te[1]-de[1],te[2]-de[2],te[3]-de[3]];B==1&&(ae!=T-1&&i(Ee,G,N+4,7),Z!=O-1&&(ae!=0&&i(Ee,G,N+4*T-4,3),i(Ee,G,N+4*T,5),ae!=T-1&&i(Ee,G,N+4*T+4,1))),F[N>>2]=z,q[N>>2]=M[z]}}function l(k,T,O,M,L){L==null&&(L={});const{crc:F}=r,B=e.writeUint,R=e.writeUshort,A=e.writeASCII;let N=8;const z=k.frames.length>1;let U,V=!1,q=33+(z?20:0);if(L.sRGB!=null&&(q+=13),L.pHYs!=null&&(q+=21),L.iCCP!=null&&(U=pako.deflate(L.iCCP),q+=21+U.length+4),k.ctype==3){for(var G=k.plte.length,ne=0;ne<G;ne++)k.plte[ne]>>>24!=255&&(V=!0);q+=8+3*G+4+(V?8+1*G+4:0)}for(var te=0;te<k.frames.length;te++)z&&(q+=38),q+=(de=k.frames[te]).cimg.length+12,te!=0&&(q+=4);q+=12;const Z=new Uint8Array(q),ae=[137,80,78,71,13,10,26,10];for(ne=0;ne<8;ne++)Z[ne]=ae[ne];if(B(Z,N,13),N+=4,A(Z,N,"IHDR"),N+=4,B(Z,N,T),N+=4,B(Z,N,O),N+=4,Z[N]=k.depth,N++,Z[N]=k.ctype,N++,Z[N]=0,N++,Z[N]=0,N++,Z[N]=0,N++,B(Z,N,F(Z,N-17,17)),N+=4,L.sRGB!=null&&(B(Z,N,1),N+=4,A(Z,N,"sRGB"),N+=4,Z[N]=L.sRGB,N++,B(Z,N,F(Z,N-5,5)),N+=4),L.iCCP!=null){const Ee=13+U.length;B(Z,N,Ee),N+=4,A(Z,N,"iCCP"),N+=4,A(Z,N,"ICC profile"),N+=11,N+=2,Z.set(U,N),N+=U.length,B(Z,N,F(Z,N-(Ee+4),Ee+4)),N+=4}if(L.pHYs!=null&&(B(Z,N,9),N+=4,A(Z,N,"pHYs"),N+=4,B(Z,N,L.pHYs[0]),N+=4,B(Z,N,L.pHYs[1]),N+=4,Z[N]=L.pHYs[2],N++,B(Z,N,F(Z,N-13,13)),N+=4),z&&(B(Z,N,8),N+=4,A(Z,N,"acTL"),N+=4,B(Z,N,k.frames.length),N+=4,B(Z,N,L.loop!=null?L.loop:0),N+=4,B(Z,N,F(Z,N-12,12)),N+=4),k.ctype==3){for(B(Z,N,3*(G=k.plte.length)),N+=4,A(Z,N,"PLTE"),N+=4,ne=0;ne<G;ne++){const Ee=3*ne,Re=k.plte[ne],je=255&Re,Ve=Re>>>8&255,Se=Re>>>16&255;Z[N+Ee+0]=je,Z[N+Ee+1]=Ve,Z[N+Ee+2]=Se}if(N+=3*G,B(Z,N,F(Z,N-3*G-4,3*G+4)),N+=4,V){for(B(Z,N,G),N+=4,A(Z,N,"tRNS"),N+=4,ne=0;ne<G;ne++)Z[N+ne]=k.plte[ne]>>>24&255;N+=G,B(Z,N,F(Z,N-G-4,G+4)),N+=4}}let _e=0;for(te=0;te<k.frames.length;te++){var de=k.frames[te];z&&(B(Z,N,26),N+=4,A(Z,N,"fcTL"),N+=4,B(Z,N,_e++),N+=4,B(Z,N,de.rect.width),N+=4,B(Z,N,de.rect.height),N+=4,B(Z,N,de.rect.x),N+=4,B(Z,N,de.rect.y),N+=4,R(Z,N,M[te]),N+=2,R(Z,N,1e3),N+=2,Z[N]=de.dispose,N++,Z[N]=de.blend,N++,B(Z,N,F(Z,N-30,30)),N+=4);const Ee=de.cimg;B(Z,N,(G=Ee.length)+(te==0?0:4)),N+=4;const Re=N;A(Z,N,te==0?"IDAT":"fdAT"),N+=4,te!=0&&(B(Z,N,_e++),N+=4),Z.set(Ee,N),N+=G,B(Z,N,F(Z,Re,N-Re)),N+=4}return B(Z,N,0),N+=4,A(Z,N,"IEND"),N+=4,B(Z,N,F(Z,N-4,4)),N+=4,Z.buffer}function c(k,T,O){for(let M=0;M<k.frames.length;M++){const L=k.frames[M];L.rect.width;const F=L.rect.height,B=new Uint8Array(F*L.bpl+F);L.cimg=h(L.img,F,L.bpp,L.bpl,B,T,O)}}function u(k,T,O,M,L){const F=L[0],B=L[1],R=L[2],A=L[3],N=L[4],z=L[5];let U=6,V=8,q=255;for(var G=0;G<k.length;G++){const Ke=new Uint8Array(k[G]);for(var ne=Ke.length,te=0;te<ne;te+=4)q&=Ke[te+3]}const Z=q!=255,ae=(function(Ae,we,We,et,at,Pt){const Ot=[];for(var Tt=0;Tt<Ae.length;Tt++){const ln=new Uint8Array(Ae[Tt]),$t=new Uint32Array(ln.buffer);var Mt;let en=0,Tn=0,Nn=we,Xt=We,jt=et?1:0;if(Tt!=0){const tn=Pt||et||Tt==1||Ot[Tt-2].dispose!=0?1:2;let Qt=0,zn=1e9;for(let yi=0;yi<tn;yi++){var Ft=new Uint8Array(Ae[Tt-1-yi]);const ys=new Uint32Array(Ae[Tt-1-yi]);let It=we,Fn=We,or=-1,bi=-1;for(let er=0;er<We;er++)for(let wi=0;wi<we;wi++)$t[Ut=er*we+wi]!=ys[Ut]&&(wi<It&&(It=wi),wi>or&&(or=wi),er<Fn&&(Fn=er),er>bi&&(bi=er));or==-1&&(It=Fn=or=bi=0),at&&((1&It)==1&&It--,(1&Fn)==1&&Fn--);const ar=(or-It+1)*(bi-Fn+1);ar<zn&&(zn=ar,Qt=yi,en=It,Tn=Fn,Nn=or-It+1,Xt=bi-Fn+1)}Ft=new Uint8Array(Ae[Tt-1-Qt]),Qt==1&&(Ot[Tt-1].dispose=2),Mt=new Uint8Array(Nn*Xt*4),t(Ft,we,We,Mt,Nn,Xt,-en,-Tn,0),jt=t(ln,we,We,Mt,Nn,Xt,-en,-Tn,3)?1:0,jt==1?f(ln,we,We,Mt,{x:en,y:Tn,width:Nn,height:Xt}):t(ln,we,We,Mt,Nn,Xt,-en,-Tn,0)}else Mt=ln.slice(0);Ot.push({rect:{x:en,y:Tn,width:Nn,height:Xt},img:Mt,blend:jt,dispose:0})}if(et)for(Tt=0;Tt<Ot.length;Tt++){if((Pn=Ot[Tt]).blend==1)continue;const ln=Pn.rect,$t=Ot[Tt-1].rect,en=Math.min(ln.x,$t.x),Tn=Math.min(ln.y,$t.y),Nn={x:en,y:Tn,width:Math.max(ln.x+ln.width,$t.x+$t.width)-en,height:Math.max(ln.y+ln.height,$t.y+$t.height)-Tn};Ot[Tt-1].dispose=1,Tt-1!=0&&d(Ae,we,We,Ot,Tt-1,Nn,at),d(Ae,we,We,Ot,Tt,Nn,at)}let En=0;if(Ae.length!=1)for(var Ut=0;Ut<Ot.length;Ut++){var Pn;En+=(Pn=Ot[Ut]).rect.width*Pn.rect.height}return Ot})(k,T,O,F,B,R),_e={},de=[],Ee=[];if(M!=0){const Ke=[];for(te=0;te<ae.length;te++)Ke.push(ae[te].img.buffer);const Ae=(function(at){let Pt=0;for(var Ot=0;Ot<at.length;Ot++)Pt+=at[Ot].byteLength;const Tt=new Uint8Array(Pt);let Mt=0;for(Ot=0;Ot<at.length;Ot++){const Ft=new Uint8Array(at[Ot]),En=Ft.length;for(let Ut=0;Ut<En;Ut+=4){let Pn=Ft[Ut],ln=Ft[Ut+1],$t=Ft[Ut+2];const en=Ft[Ut+3];en==0&&(Pn=ln=$t=0),Tt[Mt+Ut]=Pn,Tt[Mt+Ut+1]=ln,Tt[Mt+Ut+2]=$t,Tt[Mt+Ut+3]=en}Mt+=En}return Tt.buffer})(Ke),we=m(Ae,M);for(te=0;te<we.plte.length;te++)de.push(we.plte[te].est.rgba);let We=0;for(te=0;te<ae.length;te++){const et=(je=ae[te]).img.length;var Re=new Uint8Array(we.inds.buffer,We>>2,et>>2);Ee.push(Re);const at=new Uint8Array(we.abuf,We,et);z&&a(je.img,je.rect.width,je.rect.height,de,at,Re),je.img.set(at),We+=et}}else for(G=0;G<ae.length;G++){var je=ae[G];const Ke=new Uint32Array(je.img.buffer);var Ve=je.rect.width;for(ne=Ke.length,Re=new Uint8Array(ne),Ee.push(Re),te=0;te<ne;te++){const Ae=Ke[te];if(te!=0&&Ae==Ke[te-1])Re[te]=Re[te-1];else if(te>Ve&&Ae==Ke[te-Ve])Re[te]=Re[te-Ve];else{let we=_e[Ae];if(we==null&&(_e[Ae]=we=de.length,de.push(Ae),de.length>=300))break;Re[te]=we}}}const Se=de.length;for(Se<=256&&N==0&&(V=Se<=2?1:Se<=4?2:Se<=16?4:8,V=Math.max(V,A)),G=0;G<ae.length;G++){(je=ae[G]).rect.x,je.rect.y,Ve=je.rect.width;const Ke=je.rect.height;let Ae=je.img;new Uint32Array(Ae.buffer);let we=4*Ve,We=4;if(Se<=256&&N==0){we=Math.ceil(V*Ve/8);var Me=new Uint8Array(we*Ke);const et=Ee[G];for(let at=0;at<Ke;at++){te=at*we;const Pt=at*Ve;if(V==8)for(var Ne=0;Ne<Ve;Ne++)Me[te+Ne]=et[Pt+Ne];else if(V==4)for(Ne=0;Ne<Ve;Ne++)Me[te+(Ne>>1)]|=et[Pt+Ne]<<4-4*(1&Ne);else if(V==2)for(Ne=0;Ne<Ve;Ne++)Me[te+(Ne>>2)]|=et[Pt+Ne]<<6-2*(3&Ne);else if(V==1)for(Ne=0;Ne<Ve;Ne++)Me[te+(Ne>>3)]|=et[Pt+Ne]<<7-1*(7&Ne)}Ae=Me,U=3,We=1}else if(Z==0&&ae.length==1){Me=new Uint8Array(Ve*Ke*3);const et=Ve*Ke;for(te=0;te<et;te++){const at=3*te,Pt=4*te;Me[at]=Ae[Pt],Me[at+1]=Ae[Pt+1],Me[at+2]=Ae[Pt+2]}Ae=Me,U=2,We=3,we=3*Ve}je.img=Ae,je.bpl=we,je.bpp=We}return{ctype:U,depth:V,plte:de,frames:ae}}function d(k,T,O,M,L,F,B){const R=Uint8Array,A=Uint32Array,N=new R(k[L-1]),z=new A(k[L-1]),U=L+1<k.length?new R(k[L+1]):null,V=new R(k[L]),q=new A(V.buffer);let G=T,ne=O,te=-1,Z=-1;for(let _e=0;_e<F.height;_e++)for(let de=0;de<F.width;de++){const Ee=F.x+de,Re=F.y+_e,je=Re*T+Ee,Ve=q[je];Ve==0||M[L-1].dispose==0&&z[je]==Ve&&(U==null||U[4*je+3]!=0)||(Ee<G&&(G=Ee),Ee>te&&(te=Ee),Re<ne&&(ne=Re),Re>Z&&(Z=Re))}te==-1&&(G=ne=te=Z=0),B&&((1&G)==1&&G--,(1&ne)==1&&ne--),F={x:G,y:ne,width:te-G+1,height:Z-ne+1};const ae=M[L];ae.rect=F,ae.blend=1,ae.img=new Uint8Array(F.width*F.height*4),M[L-1].dispose==0?(t(N,T,O,ae.img,F.width,F.height,-F.x,-F.y,0),f(V,T,O,ae.img,F)):t(V,T,O,ae.img,F.width,F.height,-F.x,-F.y,0)}function f(k,T,O,M,L){t(k,T,O,M,L.width,L.height,-L.x,-L.y,2)}function h(k,T,O,M,L,F,B){const R=[];let A,N=[0,1,2,3,4];F!=-1?N=[F]:(T*M>5e5||O==1)&&(N=[0]),B&&(A={level:0});const z=Jme;for(var U=0;U<N.length;U++){for(let G=0;G<T;G++)p(L,k,G,M,O,N[U]);R.push(z.deflate(L,A))}let V,q=1e9;for(U=0;U<R.length;U++)R[U].length<q&&(V=U,q=R[U].length);return R[V]}function p(k,T,O,M,L,F){const B=O*M;let R=B+O;if(k[R]=F,R++,F==0)if(M<500)for(var A=0;A<M;A++)k[R+A]=T[B+A];else k.set(new Uint8Array(T.buffer,B,M),R);else if(F==1){for(A=0;A<L;A++)k[R+A]=T[B+A];for(A=L;A<M;A++)k[R+A]=T[B+A]-T[B+A-L]+256&255}else if(O==0){for(A=0;A<L;A++)k[R+A]=T[B+A];if(F==2)for(A=L;A<M;A++)k[R+A]=T[B+A];if(F==3)for(A=L;A<M;A++)k[R+A]=T[B+A]-(T[B+A-L]>>1)+256&255;if(F==4)for(A=L;A<M;A++)k[R+A]=T[B+A]-n(T[B+A-L],0,0)+256&255}else{if(F==2)for(A=0;A<M;A++)k[R+A]=T[B+A]+256-T[B+A-M]&255;if(F==3){for(A=0;A<L;A++)k[R+A]=T[B+A]+256-(T[B+A-M]>>1)&255;for(A=L;A<M;A++)k[R+A]=T[B+A]+256-(T[B+A-M]+T[B+A-L]>>1)&255}if(F==4){for(A=0;A<L;A++)k[R+A]=T[B+A]+256-n(0,T[B+A-M],0)&255;for(A=L;A<M;A++)k[R+A]=T[B+A]+256-n(T[B+A-L],T[B+A-M],T[B+A-L-M])&255}}}function m(k,T){const O=new Uint8Array(k),M=O.slice(0),L=new Uint32Array(M.buffer),F=g(M,T),B=F[0],R=F[1],A=O.length,N=new Uint8Array(A>>2);let z;if(O.length<2e7)for(var U=0;U<A;U+=4)z=y(B,V=O[U]*(1/255),q=O[U+1]*(1/255),G=O[U+2]*(1/255),ne=O[U+3]*(1/255)),N[U>>2]=z.ind,L[U>>2]=z.est.rgba;else for(U=0;U<A;U+=4){var V=O[U]*.00392156862745098,q=O[U+1]*(1/255),G=O[U+2]*(1/255),ne=O[U+3]*(1/255);for(z=B;z.left;)z=b(z.est,V,q,G,ne)<=0?z.left:z.right;N[U>>2]=z.ind,L[U>>2]=z.est.rgba}return{abuf:M.buffer,inds:N,plte:R}}function g(k,T,O){O==null&&(O=1e-4);const M=new Uint32Array(k.buffer),L={i0:0,i1:k.length,bst:null,est:null,tdst:0,left:null,right:null};L.bst=P(k,L.i0,L.i1),L.est=S(L.bst);const F=[L];for(;F.length<T;){let R=0,A=0;for(var B=0;B<F.length;B++)F[B].est.L>R&&(R=F[B].est.L,A=B);if(R<O)break;const N=F[A],z=x(k,M,N.i0,N.i1,N.est.e,N.est.eMq255);if(N.i0>=z||N.i1<=z){N.est.L=0;continue}const U={i0:N.i0,i1:z,bst:null,est:null,tdst:0,left:null,right:null};U.bst=P(k,U.i0,U.i1),U.est=S(U.bst);const V={i0:z,i1:N.i1,bst:null,est:null,tdst:0,left:null,right:null};for(V.bst={R:[],m:[],N:N.bst.N-U.bst.N},B=0;B<16;B++)V.bst.R[B]=N.bst.R[B]-U.bst.R[B];for(B=0;B<4;B++)V.bst.m[B]=N.bst.m[B]-U.bst.m[B];V.est=S(V.bst),N.left=U,N.right=V,F[A]=U,F.push(V)}for(F.sort(((R,A)=>A.bst.N-R.bst.N)),B=0;B<F.length;B++)F[B].ind=B;return[L,F]}function y(k,T,O,M,L){if(k.left==null)return k.tdst=(function(U,V,q,G,ne){const te=V-U[0],Z=q-U[1],ae=G-U[2],_e=ne-U[3];return te*te+Z*Z+ae*ae+_e*_e})(k.est.q,T,O,M,L),k;const F=b(k.est,T,O,M,L);let B=k.left,R=k.right;F>0&&(B=k.right,R=k.left);const A=y(B,T,O,M,L);if(A.tdst<=F*F)return A;const N=y(R,T,O,M,L);return N.tdst<A.tdst?N:A}function b(k,T,O,M,L){const{e:F}=k;return F[0]*T+F[1]*O+F[2]*M+F[3]*L-k.eMq}function x(k,T,O,M,L,F){for(M-=4;O<M;){for(;C(k,O,L)<=F;)O+=4;for(;C(k,M,L)>F;)M-=4;if(O>=M)break;const B=T[O>>2];T[O>>2]=T[M>>2],T[M>>2]=B,O+=4,M-=4}for(;C(k,O,L)>F;)O-=4;return O+4}function C(k,T,O){return k[T]*O[0]+k[T+1]*O[1]+k[T+2]*O[2]+k[T+3]*O[3]}function P(k,T,O){const M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],L=[0,0,0,0],F=O-T>>2;for(let B=T;B<O;B+=4){const R=k[B]*.00392156862745098,A=k[B+1]*(1/255),N=k[B+2]*(1/255),z=k[B+3]*(1/255);L[0]+=R,L[1]+=A,L[2]+=N,L[3]+=z,M[0]+=R*R,M[1]+=R*A,M[2]+=R*N,M[3]+=R*z,M[5]+=A*A,M[6]+=A*N,M[7]+=A*z,M[10]+=N*N,M[11]+=N*z,M[15]+=z*z}return M[4]=M[1],M[8]=M[2],M[9]=M[6],M[12]=M[3],M[13]=M[7],M[14]=M[11],{R:M,m:L,N:F}}function S(k){const{R:T}=k,{m:O}=k,{N:M}=k,L=O[0],F=O[1],B=O[2],R=O[3],A=M==0?0:1/M,N=[T[0]-L*L*A,T[1]-L*F*A,T[2]-L*B*A,T[3]-L*R*A,T[4]-F*L*A,T[5]-F*F*A,T[6]-F*B*A,T[7]-F*R*A,T[8]-B*L*A,T[9]-B*F*A,T[10]-B*B*A,T[11]-B*R*A,T[12]-R*L*A,T[13]-R*F*A,T[14]-R*B*A,T[15]-R*R*A],z=N,U=_;let V=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,G=0;if(M!=0)for(let te=0;te<16&&(V=U.multVec(z,V),G=Math.sqrt(U.dot(V,V)),V=U.sml(1/G,V),!(te!=0&&Math.abs(G-q)<1e-9));te++)q=G;const ne=[L*A,F*A,B*A,R*A];return{Cov:N,q:ne,e:V,L:q,eMq255:U.dot(U.sml(255,ne),V),eMq:U.dot(V,ne),rgba:(Math.round(255*ne[3])<<24|Math.round(255*ne[2])<<16|Math.round(255*ne[1])<<8|Math.round(255*ne[0])<<0)>>>0}}var _={multVec:(k,T)=>[k[0]*T[0]+k[1]*T[1]+k[2]*T[2]+k[3]*T[3],k[4]*T[0]+k[5]*T[1]+k[6]*T[2]+k[7]*T[3],k[8]*T[0]+k[9]*T[1]+k[10]*T[2]+k[11]*T[3],k[12]*T[0]+k[13]*T[1]+k[14]*T[2]+k[15]*T[3]],dot:(k,T)=>k[0]*T[0]+k[1]*T[1]+k[2]*T[2]+k[3]*T[3],sml:(k,T)=>[k*T[0],k*T[1],k*T[2],k*T[3]]};Qs.encode=function(T,O,M,L,F,B,R){L==null&&(L=0),R==null&&(R=!1);const A=u(T,O,M,L,[!1,!1,!1,0,R,!1]);return c(A,-1),l(A,O,M,F,B)},Qs.encodeLL=function(T,O,M,L,F,B,R,A){const N={ctype:0+(L==1?0:2)+(F==0?0:4),depth:B,frames:[]},z=(L+F)*B,U=z*O;for(let V=0;V<T.length;V++)N.frames.push({rect:{x:0,y:0,width:O,height:M},img:new Uint8Array(T[V]),blend:0,dispose:1,bpp:Math.ceil(z/8),bpl:Math.ceil(U/8)});return c(N,0,!0),l(N,O,M,R,A)},Qs.encode.compress=u,Qs.encode.dither=a,Qs.quantize=m,Qs.quantize.getKDtree=g,Qs.quantize.getNearest=y})();const yB={toArrayBuffer(t,e){const n=t.width,r=t.height,i=n<<2,s=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(s.data.buffer),a=(32*n+31)/32<<2,l=a*r,c=122+l,u=new ArrayBuffer(c),d=new DataView(u),f=1<<20;let h,p,m,g,y=f,b=0,x=0,C=0;function P(k){d.setUint16(x,k,!0),x+=2}function S(k){d.setUint32(x,k,!0),x+=4}function _(k){x+=k}P(19778),S(c),_(4),S(122),S(108),S(n),S(-r>>>0),P(1),P(32),S(3),S(l),S(2835),S(2835),_(8),S(16711680),S(65280),S(255),S(4278190080),S(1466527264),(function k(){for(;b<r&&y>0;){for(g=122+b*a,h=0;h<i;)y--,p=o[C++],m=p>>>24,d.setUint32(g+h,p<<8|m),h+=4;b++}C<o.length?(y=f,setTimeout(k,yB._dly)):e(u)})()},toBlob(t,e){this.toArrayBuffer(t,(n=>{e(new Blob([n],{type:"image/bmp"}))}))},_dly:9};var Wi={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},ege={[Wi.CHROME]:16384,[Wi.FIREFOX]:11180,[Wi.DESKTOP_SAFARI]:16384,[Wi.IE]:8192,[Wi.IOS]:4096,[Wi.ETC]:8192};const fC=typeof window<"u",bB=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,mb=fC&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),tge=(fC||bB)&&(mb&&mb.getOriginalSymbol(window,"File")||typeof File<"u"&&File),wB=(fC||bB)&&(mb&&mb.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function hC(t,e,n=Date.now()){return new Promise((r=>{const i=t.split(","),s=i[0].match(/:(.*?);/)[1],o=globalThis.atob(i[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const c=new Blob([l],{type:s});c.name=e,c.lastModified=n,r(c)}))}function vB(t){return new Promise(((e,n)=>{const r=new wB;r.onload=()=>e(r.result),r.onerror=i=>n(i),r.readAsDataURL(t)}))}function xB(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=i=>n(i),r.src=t}))}function Du(){if(Du.cachedResult!==void 0)return Du.cachedResult;let t=Wi.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Wi.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Wi.IOS:/Safari/i.test(e)?t=Wi.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Wi.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Wi.IE),Du.cachedResult=t,Du.cachedResult}function SB(t,e){const n=Du(),r=ege[n];let i=t,s=e,o=i*s;const a=i>s?s/i:i/s;for(;o>r*r;){const l=(r+i)/2,c=(r+s)/2;l<c?(s=c,i=c*a):(s=l*a,i=l),o=i*s}return{width:i,height:s}}function Ow(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function kB(t,e){const{width:n,height:r}=SB(t.width,t.height),[i,s]=Ow(n,r);return e&&/jpe?g/.test(e)&&(s.fillStyle="white",s.fillRect(0,0,i.width,i.height)),s.drawImage(t,0,0,i.width,i.height),i}function v0(){return v0.cachedResult!==void 0||(v0.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),v0.cachedResult}function gb(t,e={}){return new Promise((function(n,r){let i,s;var o=function(){try{return s=kB(i,e.fileType||t.type),n([i,s])}catch(l){return r(l)}},a=function(l){try{var c=function(u){try{throw u}catch(d){return r(d)}};try{let u;return vB(t).then((function(d){try{return u=d,xB(u).then((function(f){try{return i=f,(function(){try{return o()}catch(h){return r(h)}})()}catch(h){return c(h)}}),c)}catch(f){return c(f)}}),c)}catch(u){c(u)}}catch(u){return r(u)}};try{if(v0()||[Wi.DESKTOP_SAFARI,Wi.MOBILE_SAFARI].includes(Du()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then((function(l){try{return i=l,o()}catch{return a()}}),a)}catch{a()}}))}function yb(t,e,n,r,i=1){return new Promise((function(s,o){let a;if(e==="image/png"){let c,u,d;return c=t.getContext("2d"),{data:u}=c.getImageData(0,0,t.width,t.height),d=Qs.encode([u.buffer],t.width,t.height,4096*i),a=new Blob([d],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let c=function(){return l.call(this)};if(e==="image/bmp")return new Promise((u=>yB.toBlob(t,u))).then((function(u){try{return a=u,a.name=n,a.lastModified=r,c.call(this)}catch(d){return o(d)}}).bind(this),o);{let u=function(){return c.call(this)};if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:i}).then((function(d){try{return a=d,a.name=n,a.lastModified=r,u.call(this)}catch(f){return o(f)}}).bind(this),o);{let d;return d=t.toDataURL(e,i),hC(d,n,r).then((function(f){try{return a=f,u.call(this)}catch(h){return o(h)}}).bind(this),o)}}}function l(){return s(a)}}))}function Mo(t){t.width=0,t.height=0}function af(){return new Promise((function(t,e){let n,r,i,s;return af.cachedResult!==void 0?t(af.cachedResult):hC("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(o){try{return n=o,gb(n).then((function(a){try{return r=a[1],yb(r,n.type,n.name,n.lastModified).then((function(l){try{return i=l,Mo(r),gb(i).then((function(c){try{return s=c[0],af.cachedResult=s.width===1&&s.height===2,t(af.cachedResult)}catch(u){return e(u)}}),e)}catch(c){return e(c)}}),e)}catch(l){return e(l)}}),e)}catch(a){return e(a)}}),e)}))}function EB(t){return new Promise(((e,n)=>{const r=new wB;r.onload=i=>{const s=new DataView(i.target.result);if(s.getUint16(0,!1)!=65496)return e(-2);const o=s.byteLength;let a=2;for(;a<o;){if(s.getUint16(a+2,!1)<=8)return e(-1);const l=s.getUint16(a,!1);if(a+=2,l==65505){if(s.getUint32(a+=2,!1)!=1165519206)return e(-1);const c=s.getUint16(a+=6,!1)==18761;a+=s.getUint32(a+4,c);const u=s.getUint16(a,c);a+=2;for(let d=0;d<u;d++)if(s.getUint16(a+12*d,c)==274)return e(s.getUint16(a+12*d+8,c))}else{if((65280&l)!=65280)break;a+=s.getUint16(a,!1)}}return e(-1)},r.onerror=i=>n(i),r.readAsArrayBuffer(t)}))}function TB(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:i}=e;let s,o=t;return isFinite(i)&&(n>i||r>i)&&([o,s]=Ow(n,r),n>r?(o.width=i,o.height=r/n*i):(o.width=n/r*i,o.height=i),s.drawImage(t,0,0,o.width,o.height),Mo(t)),o}function CB(t,e){const{width:n}=t,{height:r}=t,[i,s]=Ow(n,r);switch(e>4&&e<9?(i.width=r,i.height=n):(i.width=n,i.height=r),e){case 2:s.transform(-1,0,0,1,n,0);break;case 3:s.transform(-1,0,0,-1,n,r);break;case 4:s.transform(1,0,0,-1,0,r);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,r,0);break;case 7:s.transform(0,-1,-1,0,r,n);break;case 8:s.transform(0,-1,1,0,0,n)}return s.drawImage(t,0,0,n,r),Mo(t),i}function CO(t,e,n=0){return new Promise((function(r,i){let s,o,a,l,c,u,d,f,h,p,m,g,y,b,x,C,P,S,_,k;function T(M=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;s+=M,e.onProgress(Math.min(s,100))}function O(M){if(e.signal&&e.signal.aborted)throw e.signal.reason;s=Math.min(Math.max(M,s),100),e.onProgress(s)}return s=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,T(),gb(t,e).then((function(M){try{return[,l]=M,T(),c=TB(l,e),T(),new Promise((function(L,F){var B;if(!(B=e.exifOrientation))return EB(t).then((function(A){try{return B=A,R.call(this)}catch(N){return F(N)}}).bind(this),F);function R(){return L(B)}return R.call(this)})).then((function(L){try{return u=L,T(),af().then((function(F){try{return d=F?c:CB(c,u),T(),f=e.initialQuality||1,h=e.fileType||t.type,yb(d,h,t.name,t.lastModified,f).then((function(B){try{{let A=function(){if(o--&&(x>a||x>y)){let z,U;return z=k?.95*_.width:_.width,U=k?.95*_.height:_.height,[P,S]=Ow(z,U),S.drawImage(_,0,0,z,U),f*=h==="image/png"?.85:.95,yb(P,h,t.name,t.lastModified,f).then((function(V){try{return C=V,Mo(_),_=P,x=C.size,O(Math.min(99,Math.floor((b-x)/(b-a)*100))),A}catch(q){return i(q)}}),i)}return[1]},N=function(){return Mo(_),Mo(P),Mo(c),Mo(d),Mo(l),O(100),r(C)};if(p=B,T(),m=p.size>a,g=p.size>t.size,!m&&!g)return O(100),r(p);var R;return y=t.size,b=p.size,x=b,_=d,k=!e.alwaysKeepResolution&&m,(R=(function(z){for(;z;){if(z.then)return void z.then(R,i);try{if(z.pop){if(z.length)return z.pop()?N.call(this):z;z=A}else z=z.call(this)}catch(U){return i(U)}}}).bind(this))(A)}}catch(A){return i(A)}}).bind(this),i)}catch(B){return i(B)}}).bind(this),i)}catch(F){return i(F)}}).bind(this),i)}catch(L){return i(L)}}).bind(this),i)}))}const nge=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let S2;function rge(t,e){return new Promise(((n,r)=>{S2||(S2=(function(o){const a=[];return a.push(o),URL.createObjectURL(new Blob(a))})(nge));const i=new Worker(S2);i.addEventListener("message",(function(o){if(e.signal&&e.signal.aborted)i.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void i.terminate();n(o.data.file),i.terminate()}else e.onProgress(o.data.progress)})),i.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",(()=>{r(e.signal.reason),i.terminate()})),i.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})}))}function ii(t,e){return new Promise((function(n,r){let i,s,o,a,l,c;if(i={...e},o=0,{onProgress:a}=i,i.maxSizeMB=i.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof i.useWebWorker!="boolean"||i.useWebWorker,delete i.useWebWorker,i.onProgress=h=>{o=h,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof tge))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(c=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||c)return CO(t,i).then((function(h){try{return s=h,f.call(this)}catch(p){return r(p)}}).bind(this),r);var u=(function(){try{return f.call(this)}catch(h){return r(h)}}).bind(this),d=function(h){try{return CO(t,i).then((function(p){try{return s=p,u()}catch(m){return r(m)}}),r)}catch(p){return r(p)}};try{return i.libURL=i.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",rge(t,i).then((function(h){try{return s=h,u()}catch{return d()}}),d)}catch{d()}function f(){try{s.name=t.name,s.lastModified=t.lastModified}catch{}try{i.preserveExif&&t.type==="image/jpeg"&&(!i.fileType||i.fileType&&i.fileType===t.type)&&(s=gB(t,s))}catch{}return n(s)}}))}ii.getDataUrlFromFile=vB,ii.getFilefromDataUrl=hC,ii.loadImage=xB,ii.drawImageInCanvas=kB,ii.drawFileInCanvas=gb,ii.canvasToFile=yb,ii.getExifOrientation=EB,ii.handleMaxWidthOrHeight=TB,ii.followExifOrientation=CB,ii.cleanupCanvasMemory=Mo,ii.isAutoOrientationInBrowser=af,ii.approximateBelowMaximumCanvasSizeOfBrowser=SB,ii.copyExifWithoutOrientation=gB,ii.getBrowserName=Du,ii.version="2.0.2";function Oo(t,...e){}function Js(t,...e){}function _B(t,e,n){if(t.size>=e.size)return{file:e,wasCompressed:!1};const r=e.name.replace(/\.[^.]+$/,"");return{file:new File([t],`${r}_compressed.mp4`,{type:"video/mp4"}),wasCompressed:!0}}function ige(t,e,n){return on.value?(n&&n(0),{file:t,wasCompressed:!1,wasSkipped:!0,aborted:!0}):null}function sge(t,e){return!!(!t||typeof t=="object"&&t&&"skip"in t&&t.skip)}function oge(t,e=200*1024){return t.size<=e}function age(t){return t.type.startsWith("video/")}class AB{onProgress;context;constructor(e){this.context=e}setProgressCallback(e){this.onProgress=e}checkAbort(e){return ige(e,this.context,this.onProgress)}resetProgress(){this.onProgress&&this.onProgress(0)}updateProgress(e){this.onProgress&&this.onProgress(Math.round(e))}log(...e){Oo(this.context,...e)}}async function lge(){if(!(typeof VideoEncoder<"u"&&typeof VideoDecoder<"u")||/Android.*Firefox/.test(navigator.userAgent))return!1;try{const r=(await eS()).includes("opus");return Oo("MediaBunnyCompression","MediaBunny supported - Video encoding available, Opus codec available:",r),!0}catch{return!0}}async function cge(){if(typeof AudioEncoder>"u")return!1;try{const t={codec:"opus",sampleRate:48e3,numberOfChannels:2,bitrate:128e3};return(await AudioEncoder.isConfigSupported(t)).supported||!1}catch{return!1}}async function uge(t,e,n){if(typeof AudioEncoder>"u")return!1;try{const r={codec:"opus",sampleRate:t,numberOfChannels:e,bitrate:n};return(await AudioEncoder.isConfigSupported(r)).supported||!1}catch{return!1}}function Xh(t,e,n=!1){if(t)try{t.dispose()}catch{}if(e&&n)try{e.finalize()}catch{}}class dge extends AB{constructor(e,n,r){super("MediaBunnyCompression"),this.parseAudioBitrate=e,this.mergeVideoAndAudioWithFFmpeg=n,this.compressWithFFmpeg=r}abortController=null;abort(){this.log("Abort requested"),this.resetProgress(),this.abortController&&(this.log("Aborting Mediabunny conversion"),this.abortController.abort(),this.abortController=null)}async cleanup(){this.abortController=null}async findSupportedOpusConfig(e,n,r,i){const s=Math.max(i,64e3),o=Array.from(new Set([r,48e3,24e3,e.sampleRate])).filter(l=>Number.isFinite(l)&&l>0),a=[{sampleRate:r,bitrate:i},...o.map(l=>({sampleRate:l,bitrate:s}))];for(const{sampleRate:l,bitrate:c}of a){if(!Number.isFinite(l)||l<=0||!Number.isFinite(c)||c<=0)continue;const u=Math.round(l),d=Math.round(c),f=await uge(u,n,d);if(this.log("Opus encoding support probe:",{trackId:e.id,codec:e.codec,targetChannels:n,sampleRate:u,bitrate:d,supported:f}),f)return{sampleRate:u,bitrate:d}}return null}async validateMediabunnyAudioConfig(e,n,r){const i=new Map;let s=await cge(),o=r?null:this.parseAudioBitrate(n?.audioBitrate),a=r?null:typeof n?.audioSampleRate=="number"?n.audioSampleRate:null;if(this.log("Opus encoding supported (global check):",s),s&&e.length>0)for(const l of e){const c=n.audioChannels??l.numberOfChannels,u=n.audioSampleRate??l.sampleRate,d=r?64e3:this.parseAudioBitrate(n.audioBitrate)??128e3,f=await this.findSupportedOpusConfig(l,c,u,d);if(!f){s=!1,this.log("Opus encoder does not support requested settings; will copy audio track as-is via Mediabunny.",{trackId:l.id,preferredSampleRate:u,preferredBitrate:d,targetChannels:c});break}i.set(l.id,{sampleRate:f.sampleRate,bitrate:f.bitrate,channels:c}),(f.sampleRate!==u||f.bitrate!==d)&&this.log("Adjusted Mediabunny audio target due to encoder support limitations.",{trackId:l.id,preferredSampleRate:u,preferredBitrate:d,resolvedSampleRate:f.sampleRate,resolvedBitrate:f.bitrate}),r||(a=f.sampleRate,o=f.bitrate)}return{canEncodeOpus:s,audioConfigByTrack:i,desiredAudioSampleRate:a,desiredAudioBitrate:o}}buildConversionOptions(e,n,r,i,s,o,a,l){return{input:e,output:n,video:u=>{const d={codec:"avc",...o?{bitrate:o}:{}},f=r.maxSize;return typeof f=="number"&&Number.isFinite(f)&&(u.displayWidth>u.displayHeight?d.width=Math.min(u.displayWidth,f):d.height=Math.min(u.displayHeight,f),this.log("Applying video resize:",{originalWidth:u.displayWidth,originalHeight:u.displayHeight,maxSize:f,targetWidth:d.width,targetHeight:d.height,bitrate:o||"custom"})),d},audio:a?i&&s?{codec:"opus",bitrate:s,forceTranscode:!0}:u=>{const d=l.get(u.id),f=d?.channels??r.audioChannels??u.numberOfChannels,h=d?.sampleRate??r.audioSampleRate??u.sampleRate;this.log("Configuring audio track for compression:",{inputCodec:u.codec,inputChannels:u.numberOfChannels,inputSampleRate:u.sampleRate,targetChannels:f,targetSampleRate:h});const p=d?.bitrate??this.parseAudioBitrate(r.audioBitrate)??128e3;return{codec:"opus",forceTranscode:!0,...typeof f=="number"?{numberOfChannels:f}:{},...typeof h=="number"?{sampleRate:h}:{},bitrate:p}}:u=>{this.log("Copying audio track as-is (Opus encoding not supported):",{trackId:u.id,codec:u.codec,channels:u.numberOfChannels,sampleRate:u.sampleRate})},showWarnings:!1}}validateConversion(e,n,r,i){if(e.discardedTracks.length>0){this.log("Discarded tracks:",e.discardedTracks.map(o=>({type:o.track.type,reason:o.reason})));const s=e.discardedTracks.filter(o=>o.track.type==="video"||o.track.type==="audio");if(s.length>0&&(console.warn("[MediaBunnyCompression] Important tracks discarded:",s.map(a=>({type:a.track.type,reason:a.reason,codec:a.track.type==="audio"?a.track.codec:void 0}))),s.some(a=>a.track.type==="audio"&&a.reason==="no_encodable_target_codec")&&i))throw Js(this.context,"Mediabunny cannot encode audio for this environment, falling back to FFmpeg."),Xh(n,r,!0),new Error("mediabunny-unsupported-audio-codec")}return e.isValid?null:(Js(this.context,"Conversion is not valid:",e.discardedTracks),Xh(n,r,!0),{file:new File([],""),wasCompressed:!1,wasSkipped:!0})}async executeConversion(e,n){const r=new Promise(i=>{this.abortController.signal.addEventListener("abort",()=>{this.log("Mediabunny conversion aborted"),e.cancel().then(i)})});return await Promise.race([e.execute(),r]),this.checkAbort(n)}async compressWithMediabunny(e,n){let r=null,i=null,s=null;const o=typeof n?.mediabunnyAudioQuality<"u",a=n?.mediabunnyAudioQuality,l=n?.mediabunnyVideoQuality??n?.mediabunnyAudioQuality;try{this.log("Starting Mediabunny compression"),this.abortController=new AbortController,r=new Zx({source:new YP(e),formats:QP}),s=new tL,i=new tS({target:s,format:new hT({fastStart:"in-memory"})});const c=await r.getAudioTracks(),u=c.length>0;this.log("Input audio tracks:",c.length),c.length>0&&this.log("First audio track codec:",c[0].codec);const d=await this.validateMediabunnyAudioConfig(c,n,o);let{canEncodeOpus:f,audioConfigByTrack:h,desiredAudioSampleRate:p,desiredAudioBitrate:m}=d;const g=this.buildConversionOptions(r,i,n,o,a,l,f,h),y=await yT.init(g),b=this.validateConversion(y,r,i,f);if(b)return this.abortController=null,b;y.onProgress=_=>{this.onProgress&&this.onProgress(Math.round(_*100))};const x=await this.executeConversion(y,e);if(x)return Xh(r,null),this.abortController=null,x;const C=s.buffer;if(!C)throw new Error("Output buffer is null");let P=new Blob([C],{type:"video/mp4"});if(Xh(r,null),!f&&u){this.log("Attempting to mux original audio track via FFmpeg copy");const _=await this.mergeVideoAndAudioWithFFmpeg(P,e),k=this.checkAbort(e);if(k)return this.abortController=null,k;if(!_)return Js(this.context,"Audio mux failed; falling back to FFmpeg compression."),this.abortController=null,await this.compressWithFFmpeg(e,n);P=_,this.log("Successfully muxed original audio track.")}const S=_B(P,e,this.context);if(!S.wasCompressed)return this.abortController=null,S;if(f&&u&&(m||p)){if(!(await this.verifyMediabunnyAudio(S.file,p,m)).passed)return this.abortController=null,await this.compressWithFFmpeg(e,n)}else!f&&u&&this.log("Audio was copied as-is, skipping audio verification");return this.onProgress&&this.onProgress(100),this.abortController=null,S}catch(c){Xh(r,null);const u=this.checkAbort(e);return u?(this.abortController=null,u):(console.error("[MediaBunnyCompression] Mediabunny compression failed:",c),this.abortController=null,{file:e,wasCompressed:!1,wasSkipped:!0})}}async verifyMediabunnyAudio(e,n,r){const i=typeof r=="number"&&Number.isFinite(r),s=typeof n=="number"&&Number.isFinite(n);if(!i&&!s)return{passed:!0};let o=null;try{o=new Zx({source:new YP(e),formats:QP});const a=await o.getAudioTracks();if(a.length===0)return Js(this.context,"Mediabunny output lost audio track; falling back to FFmpeg"),{passed:!1};const l=a[0],c=await l.computePacketStats(120),u=l.sampleRate,d=c.averageBitrate;if(this.log("Mediabunny audio verification:",{expectedBitrate:r,actualBitrate:d,expectedSampleRate:n,actualSampleRate:u}),s&&Math.abs(u-n)>1)return Js(this.context,"Audio sample rate mismatch detected, falling back to FFmpeg"),{passed:!1};if(i){const f=r*1.25;if(!Number.isFinite(d)||d>f)return Js(this.context,"Audio bitrate exceeds expected range, falling back to FFmpeg",{actualBitrate:d,allowedUpperBitrate:f}),{passed:!1}}return{passed:!0}}catch(a){return Js(this.context,"Audio verification error, falling back to FFmpeg:",a),{passed:!1}}finally{o?.dispose()}}}var yn;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(yn||(yn={}));const fge=(()=>{let t=0;return()=>t++})(),hge=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),pge=new Error("called FFmpeg.terminate()");class mge{#e=null;#t={};#n={};#r=[];#i=[];loaded=!1;#a=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:n,data:r}})=>{switch(n){case yn.LOAD:this.loaded=!0,this.#t[e](r);break;case yn.MOUNT:case yn.UNMOUNT:case yn.EXEC:case yn.FFPROBE:case yn.WRITE_FILE:case yn.READ_FILE:case yn.DELETE_FILE:case yn.RENAME:case yn.CREATE_DIR:case yn.LIST_DIR:case yn.DELETE_DIR:this.#t[e](r);break;case yn.LOG:this.#r.forEach(i=>i(r));break;case yn.PROGRESS:this.#i.forEach(i=>i(r));break;case yn.ERROR:this.#n[e](r);break}delete this.#t[e],delete this.#n[e]})};#s=({type:e,data:n},r=[],i)=>this.#e?new Promise((s,o)=>{const a=fge();this.#e&&this.#e.postMessage({id:a,type:e,data:n},r),this.#t[a]=s,this.#n[a]=o,i?.addEventListener("abort",()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(hge);on(e,n){e==="log"?this.#r.push(n):e==="progress"&&this.#i.push(n)}off(e,n){e==="log"?this.#r=this.#r.filter(r=>r!==n):e==="progress"&&(this.#i=this.#i.filter(r=>r!==n))}load=({classWorkerURL:e,...n}={},{signal:r}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/ehagaki/assets/worker-DYSz7Krg.js",import.meta.url),{type:"module"}),this.#a()),this.#s({type:yn.LOAD,data:n},void 0,r));exec=(e,n=-1,{signal:r}={})=>this.#s({type:yn.EXEC,data:{args:e,timeout:n}},void 0,r);ffprobe=(e,n=-1,{signal:r}={})=>this.#s({type:yn.FFPROBE,data:{args:e,timeout:n}},void 0,r);terminate=()=>{const e=Object.keys(this.#n);for(const n of e)this.#n[n](pge),delete this.#n[n],delete this.#t[n];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,n,{signal:r}={})=>{const i=[];return n instanceof Uint8Array&&i.push(n.buffer),this.#s({type:yn.WRITE_FILE,data:{path:e,data:n}},i,r)};mount=(e,n,r)=>{const i=[];return this.#s({type:yn.MOUNT,data:{fsType:e,options:n,mountPoint:r}},i)};unmount=e=>{const n=[];return this.#s({type:yn.UNMOUNT,data:{mountPoint:e}},n)};readFile=(e,n="binary",{signal:r}={})=>this.#s({type:yn.READ_FILE,data:{path:e,encoding:n}},void 0,r);deleteFile=(e,{signal:n}={})=>this.#s({type:yn.DELETE_FILE,data:{path:e}},void 0,n);rename=(e,n,{signal:r}={})=>this.#s({type:yn.RENAME,data:{oldPath:e,newPath:n}},void 0,r);createDir=(e,{signal:n}={})=>this.#s({type:yn.CREATE_DIR,data:{path:e}},void 0,n);listDir=(e,{signal:n}={})=>this.#s({type:yn.LIST_DIR,data:{path:e}},void 0,n);deleteDir=(e,{signal:n}={})=>this.#s({type:yn.DELETE_DIR,data:{path:e}},void 0,n)}var _O;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(_O||(_O={}));const gge=t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{const{result:i}=r;i instanceof ArrayBuffer?e(new Uint8Array(i)):e(new Uint8Array)},r.onerror=i=>{n(Error(`File could not be read! Code=${i?.target?.error?.code||-1}`))},r.readAsArrayBuffer(t)}),k2=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await gge(t);else return new Uint8Array;return new Uint8Array(e)};class yge extends AB{ffmpeg=null;isLoaded=!1;loadPromise=null;isCompressing=!1;constructor(){super("FFmpegCompression")}abort(){if(this.log("Abort requested"),this.resetProgress(),this.ffmpeg&&this.isCompressing){this.log("Terminating FFmpeg");try{this.ffmpeg.terminate()}catch(e){Js(this.context,"Error terminating FFmpeg:",e)}}}async loadFFmpeg(){if(!this.isLoaded)return this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{this.log("Loading FFmpeg from node_modules"),this.ffmpeg=new mge,this.ffmpeg.on("log",({message:e})=>{console.log("[FFmpeg]",e)}),this.ffmpeg.on("progress",({progress:e})=>{this.updateProgress(e*100)});try{const e="/ehagaki/",n=new URL(e,window.location.origin).href,r=new URL("ffmpeg-core/ffmpeg-core.js",n).href,i=new URL("ffmpeg-core/ffmpeg-core.wasm",n).href;this.log("Base URL:",n),this.log("Core URL:",r),this.log("WASM URL:",i),await this.ffmpeg.load({coreURL:r,wasmURL:i}),this.isLoaded=!0,this.log("FFmpeg loaded successfully")}catch(e){throw Js(this.context,"Failed to load FFmpeg:",e),e}})(),this.loadPromise)}async mergeVideoAndAudioWithFFmpeg(e,n){const r="mediabunny-video.mp4",i="mediabunny-audio-source.mp4",s="mediabunny-merged.mp4",o=async a=>{if(!a)return;const l=[r,i,s];for(const c of l)try{await a.deleteFile(c)}catch{}};try{if(on.value)return this.log("Abort detected before audio mux"),null;await this.loadFFmpeg();const a=this.ffmpeg;if(!a)return Js(this.context,"FFmpeg instance unavailable for audio mux"),null;await a.writeFile(r,await k2(e)),await a.writeFile(i,await k2(n));const l=["-i",r,"-i",i,"-map","0:v:0","-map","1:a:0","-c:v","copy","-c:a","copy","-movflags","+faststart","-shortest","-y",s];if(this.log("Executing FFmpeg audio mux with args:",l),this.isCompressing=!0,await a.exec(l),on.value)return this.log("Abort detected during audio mux"),await o(a),null;const c=await a.readFile(s),u=new Blob([c],{type:"video/mp4"});return await o(a),u}catch(a){return on.value?this.log("Audio mux aborted, returning null"):Js(this.context,"Failed to mux audio with FFmpeg copy:",a),await o(this.ffmpeg),null}finally{this.isCompressing=!1}}buildFFmpegArgs(e,n,r){const i=["-i",e,"-c:v","libx264","-crf",String(r.crf),"-preset",r.preset,"-c:a","aac","-b:a",r.audioBitrate||"128k"];if(r.audioSampleRate&&i.push("-ar",String(r.audioSampleRate)),r.audioChannels&&i.push("-ac",String(r.audioChannels)),r.maxSize){const s=`scale='if(gte(iw,ih),min(${r.maxSize},iw),-2)':'if(lt(iw,ih),min(${r.maxSize},ih),-2)'`;i.push("-vf",s)}return i.push("-movflags","+faststart","-y",n),i}async compressWithFFmpeg(e,n){try{this.log("Loading FFmpeg..."),await this.loadFFmpeg();const r=this.checkAbort(e);if(r)return r;if(!this.ffmpeg)throw new Error("FFmpeg not loaded");const i="input.mp4",s="output.mp4";await this.ffmpeg.writeFile(i,await k2(e));const o=this.buildFFmpegArgs(i,s,n),a=this.checkAbort(e);if(a)return await this.ffmpeg.deleteFile(i),a;this.log("Starting compression with args:",o),this.isCompressing=!0;try{await this.ffmpeg.exec(o)}catch(u){if(on.value)this.log("Compression aborted during execution");else throw console.error("[FFmpegCompression] FFmpeg execution error:",u),u}finally{this.isCompressing=!1}if(on.value){this.log("Cleaning up after abort");try{await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s)}catch{}return{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}}const l=await this.ffmpeg.readFile(s),c=new Blob([l],{type:"video/mp4"});return await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s),_B(c,e,this.context)}catch(r){return this.isCompressing=!1,on.value?(this.log("Compression aborted, using original file"),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}):(console.error("[FFmpegCompression] Compression failed:",r),{file:e,wasCompressed:!1,wasSkipped:!0})}}async cleanup(){if(this.ffmpeg&&this.isLoaded)try{this.isLoaded=!1,this.ffmpeg=null,this.loadPromise=null}catch(e){console.error("[FFmpegCompression] Cleanup error:",e)}}}class AO{constructor(e){this.localStorage=e,this.ffmpegCompression=new yge,this.mediabunnyCompression=new dge(this.parseAudioBitrate.bind(this),this.ffmpegCompression.mergeVideoAndAudioWithFFmpeg.bind(this.ffmpegCompression),this.ffmpegCompression.compressWithFFmpeg.bind(this.ffmpegCompression))}context="VideoCompressionService";mediabunnyCompression;ffmpegCompression;useMediabunny=null;mediabunnyCheckPromise=null;onProgress;async checkMediaBunnySupport(){return this.useMediabunny!==null?this.useMediabunny:this.mediabunnyCheckPromise?this.mediabunnyCheckPromise:(this.mediabunnyCheckPromise=(async()=>{const e=await lge();return this.useMediabunny=e,Oo(this.context,`Using ${e?"Mediabunny":"FFmpeg"} for compression`),e})(),this.mediabunnyCheckPromise)}abort(){Oo(this.context,"Abort requested"),this.onProgress&&this.onProgress(0),this.mediabunnyCompression.abort(),this.ffmpegCompression.abort()}setProgressCallback(e){this.onProgress=e,this.mediabunnyCompression.setProgressCallback(e),this.ffmpegCompression.setProgressCallback(e)}getCompressionOptions(){const e=this.localStorage.getItem("videoCompressionLevel")||"medium",n=f0[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n||null}hasCompressionSettings(){return this.getCompressionOptions()!==null}parseAudioBitrate(e){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const n=Number.parseInt(e,10);if(Number.isFinite(n)&&n>0)return n*1e3}return null}async compress(e){if(!age(e))return Oo(this.context,"Skipping non-video file"),{file:e,wasCompressed:!1};if(oge(e))return Oo(this.context,"Skipping small video file"),{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(sge(n,this.context))return{file:e,wasCompressed:!1,wasSkipped:!0};if(on.value)return Oo(this.context,"Compression aborted"),this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0};try{if(await this.checkMediaBunnySupport()){Oo(this.context,"Attempting compression with MediaBunny");const i=await this.mediabunnyCompression.compressWithMediabunny(e,n);return!i.wasCompressed&&!i.wasSkipped?(Oo(this.context,"MediaBunny failed, falling back to FFmpeg"),await this.ffmpegCompression.compressWithFFmpeg(e,n)):i}else return Oo(this.context,"Using FFmpeg for compression"),await this.ffmpegCompression.compressWithFFmpeg(e,n)}catch(r){return console.error("[VideoCompressionService] Compression failed:",r),{file:e,wasCompressed:!1,wasSkipped:!0}}}async cleanup(){await this.ffmpegCompression.cleanup(),await this.mediabunnyCompression.cleanup()}}var Fd=Symbol("verified"),bge=t=>t instanceof Object;function wge(t){if(!bge(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}new TextDecoder("utf-8");var PB=new TextEncoder,vge=class{generateSecretKey(){return Ro.utils.randomPrivateKey()}getPublicKey(t){return ur(Ro.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=ur(Ro.getPublicKey(e)),n.id=E2(n),n.sig=ur(Ro.sign(E2(n),e)),n[Fd]=!0,n}verifyEvent(t){if(typeof t[Fd]=="boolean")return t[Fd];const e=E2(t);if(e!==t.id)return t[Fd]=!1,!1;try{const n=Ro.verify(t.sig,e,t.pubkey);return t[Fd]=n,n}catch{return t[Fd]=!1,!1}}};function xge(t){if(!wge(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function E2(t){let e=Zc(PB.encode(xge(t)));return ur(e)}var Mw=new vge;Mw.generateSecretKey;Mw.getPublicKey;Mw.finalizeEvent;Mw.verifyEvent;var Sge=27235,kge="Nostr ";async function Ege(t,e,n,r=!1,i){const s={kind:Sge,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""},o=await n(s);return(r?kge:"")+Jo.encode(PB.encode(JSON.stringify(o)))}const pC=io([]);function Tge(){return window.location.port==="4173"||window.location.hostname==="localhost"}function IB(){return Tge()}function Cge(...t){const e=t.map(n=>typeof n=="object"?JSON.stringify(n):String(n)).join(" ");pC.update(n=>[e,...n].slice(0,250))}const _ge=console.log;typeof window<"u"&&(window.__originalConsoleLog=_ge);async function Age(t){let e=[];t?e=t:pC.subscribe(r=>e=r)();const n=e?.join(`
`)??"";n&&Pw(n,"dev log",navigator,window)}typeof window<"u"&&(window.showSwUpdateModalDebug=()=>{xT.set(!0),console.log("SWæ´æ°ãã¿ã³ãå¼·å¶è¡¨ç¤ºãã¾ããï¼è¨­å®ãã¿ã³ã©ã³ãï¼SettingsDialogåï¼")});IB()&&(window.testDevLog=()=>{console.log("ãã¹ãç¨ã­ã°åºå:",new Date().toISOString()),Cge("ç´æ¥devLogã«è¿½å :",Math.random())},window.showPostSuccessDebug=()=>{An.postStatus={...An.postStatus,success:!0,error:!1,message:"post_success",completed:!0}},window.showPostErrorDebug=()=>{An.postStatus={...An.postStatus,success:!1,error:!0,message:"post_error",completed:!1}});class Pge{constructor(e){this.document=e}mimeSupportCache={};webpQualitySupport;async canEncodeWebpWithQuality(){if(this.webpQualitySupport!==void 0)return this.webpQualitySupport;try{if(!this.document)return this.webpQualitySupport=!1;const e=this.document.createElement("canvas");e.width=2,e.height=2;const n=e.getContext("2d");if(!n)return this.webpQualitySupport=!1;n.fillStyle="#f00",n.fillRect(0,0,2,2);const r=e.toDataURL("image/webp",.2),i=e.toDataURL("image/webp",.9),s=r.startsWith("data:image/webp")&&i.startsWith("data:image/webp")&&r.length!==i.length;return this.webpQualitySupport=s,s}catch{return this.webpQualitySupport=!1,!1}}canEncodeMimeType(e){if(!e)return!1;if(e in this.mimeSupportCache)return this.mimeSupportCache[e];try{if(!this.document)return this.mimeSupportCache[e]=!1;const n=this.document.createElement("canvas");n.width=2,n.height=2;const r=n.getContext("2d");if(!r)return this.mimeSupportCache[e]=!1;r.fillStyle="#000",r.fillRect(0,0,2,2);const i=n.toDataURL(e),s=typeof i=="string"&&i.startsWith(`data:${e}`);return this.mimeSupportCache[e]=s,s}catch{return this.mimeSupportCache[e]=!1,!1}}}class PO{constructor(e,n){this.mimeSupport=e,this.localStorage=n}onProgress;abort(){this.onProgress&&this.onProgress(0)}setProgressCallback(e){this.onProgress=e}getCompressionOptions(){const e=this.localStorage.getItem("imageCompressionLevel")||"medium",n=mu[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n?{...n,preserveExif:!1}:null}hasCompressionSettings(){return this.getCompressionOptions()!==null}async compress(e){if(on.value)return{file:e,wasCompressed:!1,aborted:!0};if(!e.type.startsWith("image/"))return{file:e,wasCompressed:!1};if(e.size<=20*1024)return{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(!n)return{file:e,wasCompressed:!1,wasSkipped:!0};let r={...n,onProgress:s=>{this.onProgress&&this.onProgress(Math.round(s*100))}};if(r.fileType==="image/webp"&&(await this.mimeSupport.canEncodeWebpWithQuality()||(r.fileType=e.type==="image/png"?"image/png":"image/jpeg")),on.value)return{file:e,wasCompressed:!1,aborted:!0};let i=r.fileType||e.type;this.mimeSupport.canEncodeMimeType(i)||(i=e.type,delete r.fileType);try{const s=await ii(e,r);if(on.value)return this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0};if(s.size>=e.size)return{file:e,wasCompressed:!1};const o=r.fileType||s.type||i||e.type,a=Toe(e.name,o),l=new File([s],a,{type:o});return{file:l,wasCompressed:!0}}catch(s){return on.value?(this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0}):(console.warn("[ImageCompressionService] Compression failed:",s),{file:e,wasCompressed:!1,wasSkipped:!0})}}}class Ige{async waitForWindowNostr(e=3e3,n=100){const r=Date.now();for(;Date.now()-r<e;){const i=window?.nostr;if(i?.signEvent)return i;await new Promise(s=>setTimeout(s,n))}return null}async buildAuthHeader(e,n="POST"){const r=CS.getFromStore()||CS.loadFromStorage();let i;if(r)i=s=>cx(r).signEvent(s);else{let s=window?.nostr;if(s?.signEvent||(s=await this.waitForWindowNostr()),s?.signEvent)i=o=>s.signEvent(o);else throw new Error("Authentication required")}return await Ege(e,n,i,!0)}}class OB{constructor(e={localStorage:window.localStorage,fetch:window.fetch.bind(window),crypto:window.crypto.subtle,document:window.document,window,navigator:window.navigator},n,r,i,s){this.dependencies=e,this.mimeSupport=s||new Pge(e.document),this.imageCompressionService=r||new PO(this.mimeSupport,e.localStorage),this.videoCompressionService=i||new AO(e.localStorage),this.authService=n||new Ige,this.videoCompressionService instanceof AO&&!Xie()&&(Zie(this.videoCompressionService),console.log("[FileUploadManager] VideoCompressionService registered to store")),this.imageCompressionService instanceof PO&&!Yie()&&(Qie(this.imageCompressionService),console.log("[FileUploadManager] ImageCompressionService registered to store"))}imageCompressionService;videoCompressionService;mimeSupport;authService;validateImageFile(e){return e.type.startsWith("image/")?e.size>fI?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}:{isValid:!1,errorMessage:"only_images_allowed"}}validateMediaFile(e){const n=e.type.startsWith("image/"),r=e.type.startsWith("video/");return!n&&!r?{isValid:!1,errorMessage:"only_images_or_videos_allowed"}:e.size>fI?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}}async generateBlurhashForFile(e){return await Use(e)}async createPlaceholderUrl(e){return await zse(e)}getUploadEndpoint(e){const n=this.dependencies.localStorage.getItem("uploadEndpoint"),r=i=>i&&i.trim().length>0?i:void 0;return r(n)??r(e)??zh}async pollUploadStatus(e,n,r=P1.MAX_WAIT_TIME){const i=Date.now();for(;;){if(on.value)throw new Error("Upload aborted by user");if(Date.now()-i>r)throw new Error(P1.TIMEOUT_MESSAGE);const s=await this.dependencies.fetch(e,{method:"GET",headers:{Authorization:n}});if(!s.ok)throw new Error(`Unexpected status code ${s.status} while polling processing_url`);let o=null;try{o=await s.json()}catch{o=null}if(s.status===201&&o)return o;if(o?.status==="processing"){await new Promise(a=>setTimeout(a,P1.RETRY_INTERVAL));continue}if(o?.status==="success")return o;if(o?.status==="error")throw new Error(o?.message||"File processing failed");if(s.status===200)return o;throw new Error("Unexpected processing status")}}async uploadFile(e,n=zh,r=!1,i,s){let o;try{if(!e)return{success:!1,error:"No file selected"};let a;try{a=await SL(e,this.dependencies.crypto)}catch{a=void 0}const l=e.size;if(on.value)return r&&console.log("[FileUploadManager] Upload aborted before compression"),{success:!1,error:"Upload aborted by user",aborted:!0};const c=e.type.startsWith("video/"),u=c?this.videoCompressionService:this.imageCompressionService;c&&s?.onVideoCompressionProgress&&this.videoCompressionService.setProgressCallback(s.onVideoCompressionProgress),!c&&s?.onImageCompressionProgress&&this.imageCompressionService.setProgressCallback(s.onImageCompressionProgress);const{file:d,wasCompressed:f,wasSkipped:h,aborted:p}=await u.compress(e);if(c?this.videoCompressionService.setProgressCallback(void 0):this.imageCompressionService.setProgressCallback(void 0),p)return r&&console.log("[FileUploadManager] Upload aborted by user"),{success:!1,error:"Upload aborted by user",aborted:!0};const m=d.size,g=c?this.videoCompressionService.hasCompressionSettings():this.imageCompressionService.hasCompressionSettings();o=moe(l,m,g||f,e.name,d.name,h);const y=this.getUploadEndpoint(n),b=await this.authService.buildAuthHeader(y,"POST"),x=new FormData;x.append("file",d),i?.caption&&x.append("caption",String(i.caption)),i?.expiration!==void 0&&x.append("expiration",String(i.expiration)),x.append("size",String(d.size)),i?.alt&&x.append("alt",String(i.alt)),i?.media_type&&x.append("media_type",String(i.media_type)),x.append("content_type",i?.content_type?String(i.content_type):d.type||""),x.append("no_transform",i?.no_transform?String(i.no_transform):"true");const C=await this.dependencies.fetch(y,{method:"POST",headers:{Authorization:b},body:x});if(on.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};if(!C.ok){const _=await C.text().catch(()=>"Unknown error");return{success:!1,error:`Upload failed: ${C.status} ${C.statusText} - ${_}`,sizeInfo:o}}let P;try{P=await C.json()}catch(_){return r&&console.error("[dev] JSON parse error:",_),{success:!1,error:"Could not parse upload response",sizeInfo:o}}if((C.status===200||C.status===202)&&P.processing_url)try{const _=await this.authService.buildAuthHeader(P.processing_url,"GET");if(P=await this.pollUploadStatus(P.processing_url,_),on.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0}}catch(_){return{success:!1,error:_ instanceof Error?_.message:String(_),sizeInfo:o}}const S={};if(P?.nip94_event?.tags&&Array.isArray(P.nip94_event.tags))for(const _ of P.nip94_event.tags){if(!Array.isArray(_)||_.length<2)continue;const k=String(_[0]),T=_.slice(1).join(" ");k in S||(S[k]=T)}if(P.status==="success"&&P.nip94_event?.tags){const _=P.nip94_event.tags.find(k=>k[0]==="url");if(_?.[1])return{success:!0,url:_[1],sizeInfo:o,nip94:S}}return{success:!1,error:P.message||"Could not extract URL from response",sizeInfo:o,nip94:Object.keys(S).length?S:void 0}}catch(a){if(on.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};r&&console.error("[dev] Upload error:",a);const l=a instanceof Error?a.message:String(a);return l.includes("aborted by user")?{success:!1,error:l,sizeInfo:o,aborted:!0}:{success:!1,error:l.includes("Failed to fetch")?`${l} (Service Workerãç»åã¢ããã­ã¼ãããã­ãã¯ãã¦ããå¯è½æ§ãããã¾ã)`:l}}}async uploadMultipleFiles(e,n=zh,r,i=!1,s,o){if(!e?.length)return[];const a=new Array(e.length);let l=0,c=0,u=0;const d=()=>r?.({completed:l,failed:c,aborted:u,total:e.length,inProgress:l+c+u<e.length});d();for(let f=0;f<e.length;f++){if(on.value){for(let p=f;p<e.length;p++)a[p]={success:!1,aborted:!0},u++;d();break}const h=e[f];try{const p=s?s[f]:void 0,m=await this.uploadFile(h,n,i,p,o);a[f]=m,m.success?l++:m.aborted?u++:c++,d()}catch(p){a[f]={success:!1,error:p instanceof Error?p.message:String(p)},c++,d()}}return a}async uploadFileWithCallbacks(e,n=zh,r,i=!1,s){r?.onProgress?.({completed:0,failed:0,aborted:0,total:1,inProgress:!0});try{const o=await this.uploadFile(e,n,i,s,r);if(r?.onProgress?.({completed:o.success?1:0,failed:!o.success&&!o.aborted?1:0,aborted:o.aborted?1:0,total:1,inProgress:!1}),o.success&&o.sizeInfo&&!o.aborted){const a=LI(o.sizeInfo);a&&MI(a)}return o}catch(o){return r?.onProgress?.({completed:0,failed:1,aborted:0,total:1,inProgress:!1}),{success:!1,error:o instanceof Error?o.message:String(o)}}}async uploadMultipleFilesWithCallbacks(e,n=zh,r,i){if(!e?.length)return[];r?.onProgress?.({completed:0,failed:0,aborted:0,total:e.length,inProgress:!0});const s=await this.uploadMultipleFiles(e,n,r?.onProgress,!1,i,r);if(!on.value){const o=s.find(a=>a.success&&a.sizeInfo);if(o?.sizeInfo){const a=LI(o.sizeInfo);a&&MI(a)}}return s}async getSharedImageFromServiceWorker(){if(!this.dependencies.navigator?.serviceWorker?.controller)return null;try{const e=new MessageChannel,n=new Promise(r=>{e.port1.onmessage=i=>{i.data?.type==="SHARED_IMAGE"?r(i.data.data):r(null)},setTimeout(()=>r(null),3e3)});return this.dependencies.navigator.serviceWorker.controller.postMessage({action:"getSharedImage"},[e.port2]),await n}catch(e){return console.error("Service Workerããã®å±æç»ååå¾ã«å¤±æ:",e),null}}checkIfOpenedFromShare(){return this.dependencies.window?.location?new URLSearchParams(this.dependencies.window.location.search).get("shared")==="true":!1}async processSharedImageOnLaunch(){try{const e=await this.getSharedImageFromServiceWorker();return e?.image?{success:!0,data:e,fromServiceWorker:!0}:{success:!1,error:"å±æç»åãè¦ã¤ããã¾ãã"}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}}class Oge{dependencies;devMode;fileUploadManager;constructor(e,n){this.dependencies=e,this.devMode=n,this.fileUploadManager=new this.dependencies.FileUploadManager}async uploadFiles(e,n,r,i){try{if(e.length===1)return[await this.fileUploadManager.uploadFileWithCallbacks(e[0],n,r,this.devMode,i?.[0])];if(e.length>1)return await this.fileUploadManager.uploadMultipleFilesWithCallbacks(e,n,r,i)}catch(s){if(this.devMode){const a=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";console.error(`${a} [uploadHelper] Upload error:`,s)}throw s}return null}}function T2(t,e,n,r,i,s=!1,o=!1){return r(!1),o&&n&&U6(n,s),i?.onProgress&&i.onProgress({completed:0,failed:0,aborted:t.length,total:t.length,inProgress:!1}),{placeholderMap:o?[]:e,results:null,imageOxMap:{},imageXMap:{},failedResults:[],errorMessage:"Upload aborted by user"}}const MB=()=>({localStorage:window.localStorage,crypto:window.crypto.subtle,tick:Dc,FileUploadManager:OB,getImageDimensions:Eoe,extractImageBlurhashMap:bL,calculateImageHash:Vse,getMimeTypeFromUrl:wL,createImetaTag:async t=>await yL(t),imageSizeMapStore:_S});async function Mge({files:t,currentEditor:e,fileInput:n,uploadCallbacks:r,showUploadError:i,updateUploadState:s,devMode:o,dependencies:a=MB()}){const l=Array.from(t),c=a.localStorage.getItem("uploadEndpoint")||"",u={},d={},h=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:0,total:l.length,inProgress:!0}),on.reset();const p=new Oge(a,o);let m;try{m=await Voe(l,a)}catch(S){if(S instanceof Error&&S.message==="Upload aborted by user")return s(!1),r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:l.length,total:l.length,inProgress:!1}),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:"Upload aborted by user"};throw S}if(on.value)return T2(l,[],e,s,r,o,!1);let g=Mme(l,m,e,i,a.imageSizeMapStore,a.FileUploadManager,o);if(g.length===0)return{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:""};if(on.value||(s(!0,""),await Nme(g,e,a.FileUploadManager,o),on.value))return T2(l,g,e,s,r,o,!0);const y=g.map(S=>S.file);let b=null;try{const S=Woe(y);b=await p.uploadFiles(y,c,r,S)}catch(S){const _=S instanceof Error?S.message:String(S);i(_,5e3),b=null}finally{s(!1)}if(on.value)return n&&(n.value=""),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:"Upload aborted by user"};await a.tick();const x=[];let C="",P={};if(b&&g.length>0){const S=await Rme(b,g,e,u,d,a.imageSizeMapStore,a.extractImageBlurhashMap,a.getMimeTypeFromUrl,a.calculateImageHash,a.createImetaTag,o);x.push(...S.failedResults),C=S.errorMessage,P=S.imageServerBlurhashMap,g=[]}if(o&&e)try{const S=a.extractImageBlurhashMap(e),_=new Set([...Object.keys(S),...Object.keys(P)]);await Promise.all(Array.from(_).map(async T=>{if(!d[T]){const O=await a.calculateImageHash(T);O&&(d[T]=O)}}));const k=await Promise.all(Array.from(_).map(async T=>{const O=P[T]??S[T],M=a.getMimeTypeFromUrl(T),L=u[T],F=d[T];return(await a.createImetaTag({url:T,m:M,blurhash:O,ox:L,x:F})).join(" ")}))}catch(S){console.warn(`${h} [dev] imetaã¿ã°çæå¤±æ`,S)}return n&&(n.value=""),{placeholderMap:g,results:b,imageOxMap:u,imageXMap:d,failedResults:x,errorMessage:C}}function Nge(t){const{onUploadProgress:e,videoCompressionProgressStore:n,imageCompressionProgressStore:r}=t;return e?{onProgress:e,onVideoCompressionProgress:i=>{n.set(i)},onImageCompressionProgress:i=>{r.set(i)}}:void 0}function IO(t,e=3e3,n){n.updateUploadState(!1,t),setTimeout(()=>n.updateUploadState(!1,""),e)}async function Rge(t){const{files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,updateUploadState:s,devMode:o,imageOxMap:a,imageXMap:l,dependencies:c=MB(),getUploadFailedText:u}=t;if(!e||e.length===0)return;const d=await Mge({files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,showUploadError:(f,h)=>IO(f,h,{updateUploadState:s}),updateUploadState:s,devMode:o,dependencies:c});Object.assign(a,d.imageOxMap),Object.assign(l,d.imageXMap),d.failedResults?.length&&IO(d.errorMessage||(d.failedResults.length===1?d.failedResults[0].error||u("postComponent.upload_failed"):`${d.failedResults.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`),5e3,{updateUploadState:s}),r&&(r.value="")}async function Dge(t){const{files:e,currentEditor:n,fileInput:r,onUploadProgress:i,updateUploadState:s,imageOxMap:o,imageXMap:a,videoCompressionProgressStore:l,imageCompressionProgressStore:c,getUploadFailedText:u,dependencies:d}=t,f=Nge({onUploadProgress:i,videoCompressionProgressStore:l,imageCompressionProgressStore:c});await Rge({files:e,currentEditor:n,fileInput:r,uploadCallbacks:f,updateUploadState:s,devMode:!1,imageOxMap:o,imageXMap:a,dependencies:d,getUploadFailedText:u})}var Lge=Ce('<div class="popup-modal svelte-1lheb99" role="dialog" aria-modal="true" tabindex="0"><div class="popup-body svelte-1lheb99" role="document"><span class="info-icon svg-icon svelte-1lheb99" aria-hidden="true"></span> <div class="popup-children svelte-1lheb99"><!></div></div></div>');function mC(t,e){wt(e,!0);let n=ce(e,"show",3,!1),r=ce(e,"x",3,0),i=ce(e,"y",3,0),s=ce(e,"onClose",3,void 0),o=ce(e,"children",3,void 0);function a(){try{s()&&s()()}catch{}}function l(g){g.key==="Escape"&&a()}Vs(()=>{window.addEventListener("keydown",l)}),_f(()=>{window.removeEventListener("keydown",l)});let c=ye(void 0);nt(()=>{n()&&E(c)&&(async()=>(await Dc(),E(c).parentElement!==document.body&&document.body.appendChild(E(c))))()}),_f(()=>{if(E(c)&&E(c).parentElement===document.body)try{document.body.removeChild(E(c))}catch{}});let u=ye(0),d=ye(0);nt(()=>{Q(u,r()),Q(d,i())});const f=10;nt(()=>{n()&&E(c)&&(async()=>{if(await Dc(),E(c).parentElement===document.body){const g=E(c).getBoundingClientRect(),y=g.width,b=g.height,x=window.innerWidth,C=window.innerHeight;let P=r(),S=i();P+y+f>x&&(P=x-y-f),P-f<0&&(P=f),S+b+f>C&&(S=C-b-f),S-f<0&&(S=f),Q(u,P,!0),Q(d,S,!0)}})()});var h=ze(),p=Te(h);{var m=g=>{var y=Lge();y.__click=P=>P.stopPropagation?.(),y.__keydown=P=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),a())};var b=ie(y),x=ve(ie(b),2),C=ie(x);kt(C,()=>o()??Bt),Ar(y,P=>Q(c,P),()=>E(c)),Ge(()=>lc(y,`left: ${E(u)??""}px; top: ${E(d)??""}px;`)),Y(g,y)};He(p,g=>{n()&&g(m)})}Y(t,h),vt()}Mi(["click","keydown"]);var Bge=Ce("<div><!></div>"),Fge=Ce('<!> <!> <div class="dialog-content svelte-omvxe3"><!></div> <!>',1),$ge=Ce("<!> <!>",1);function dh(t,e){wt(e,!0);let n=ce(e,"open",15,!1),r=ce(e,"contentClass",3,""),i=ce(e,"footerVariant",3,"default");function s(c){c||e.onOpenChange?.(!1)}function o(c){c.preventDefault()}var a=ze(),l=Te(a);_t(l,()=>CZ,(c,u)=>{u(c,{onOpenChange:s,get open(){return n()},set open(d){n(d)},children:(d,f)=>{var h=ze(),p=Te(h);_t(p,()=>ja,(m,g)=>{g(m,{children:(y,b)=>{var x=$ge(),C=Te(x);_t(C,()=>lG,(S,_)=>{_(S,{class:"dialog-overlay"})});var P=ve(C,2);_t(P,()=>IZ,(S,_)=>{_(S,{get class(){return`dialog ${r()??""}`},preventScroll:!1,onCloseAutoFocus:o,children:(k,T)=>{var O=Fge(),M=Te(O);_t(M,()=>kK,(N,z)=>{z(N,{class:"visually-hidden",children:(U,V)=>{var q=Yt();Ge(()=>Be(q,e.title)),Y(U,q)},$$slots:{default:!0}})});var L=ve(M,2);_t(L,()=>uG,(N,z)=>{z(N,{class:"visually-hidden",children:(U,V)=>{var q=Yt();Ge(()=>Be(q,e.description)),Y(U,q)},$$slots:{default:!0}})});var F=ve(L,2),B=ie(F);kt(B,()=>e.children??Bt);var R=ve(F,2);{var A=N=>{var z=Bge();let U;var V=ie(z);kt(V,()=>e.footer),Ge(()=>U=Qo(z,1,"dialog-footer svelte-omvxe3",null,U,{"close-button-footer":i()==="close-button"})),Y(N,z)};He(R,N=>{e.footer&&N(A)})}Y(k,O)},$$slots:{default:!0}})}),Y(y,x)},$$slots:{default:!0}})}),Y(d,h)},$$slots:{default:!0}})}),Y(t,a),vt()}function fh(t,e,n=!0){if(typeof window>"u"||!(typeof n=="function"?n():n))return;let i=null,s=!1;const o=a=>{t()&&a.state?.modalId!==i&&e()};nt(()=>{const a=t();if(a&&!s){i=`modal-${Coe()}`,history.pushState({modalId:i},"",window.location.href),s=!0;return}if(!a&&s){const l=history.state?.modalId===i;i=null,s=!1,l&&history.back()}}),Vs(()=>{window.addEventListener("popstate",o)}),_f(()=>{window.removeEventListener("popstate",o),s&&history.state?.modalId===i&&history.back()})}var zge=Ce('<div class="confirm-dialog-message svelte-1efofyg"> </div>'),Uge=Ce('<div class="confirm-dialog-content svelte-1efofyg"><!> <div class="confirm-dialog-buttons svelte-1efofyg"><!> <!></div></div>');function NB(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ce(e,"open",15,!1),o=ce(e,"confirmVariant",3,"danger"),a=ce(e,"confirmDisabled",3,!1),l=ce(e,"autofocusConfirm",3,!1),c=ce(e,"contentClass",3,"confirm-dialog"),u=ce(e,"addToHistory",3,!1);const d=oe(()=>e.confirmLabel||n()("common.ok")),f=oe(()=>e.cancelLabel||n()("common.cancel")),h=oe(()=>e.title||n()("common.confirm"));function p(){s(!1),e.onCancel?.()}function m(){e.onConfirm(),s(!1)}fh(()=>s(),p,()=>u()),dh(t,{onOpenChange:g=>!g&&p(),get title(){return E(h)},get description(){return e.description},get contentClass(){return c()},get open(){return s()},set open(g){s(g)},children:(g,y)=>{var b=Uge(),x=ie(b);{var C=F=>{var B=ze(),R=Te(B);kt(R,()=>e.children),Y(F,B)},P=F=>{var B=zge(),R=ie(B);Ge(()=>Be(R,e.description)),Y(F,B)};He(x,F=>{e.children?F(C):F(P,!1)})}var S=ve(x,2),_=ie(S);{var k=F=>{var B=ze(),R=Te(B);kt(R,()=>e.renderConfirm),Y(F,B)},T=F=>{Lt(F,{className:"btn-confirm",get variant(){return o()},shape:"square",onClick:m,get disabled(){return a()},get autofocus(){return l()},children:(B,R)=>{var A=Yt();Ge(()=>Be(A,E(d))),Y(B,A)},$$slots:{default:!0}})};He(_,F=>{e.renderConfirm?F(k):F(T,!1)})}var O=ve(_,2);{var M=F=>{var B=ze(),R=Te(B);kt(R,()=>e.renderCancel),Y(F,B)},L=F=>{var B=ze(),R=Te(B);{const A=(N,z)=>{Lt(N,qn(()=>z?.().props,{className:"btn-cancel",variant:"secondary",shape:"square",onClick:p,children:(V,q)=>{var G=Yt();Ge(()=>Be(G,E(f))),Y(V,G)},$$slots:{default:!0}}))};_t(R,()=>oh,(N,z)=>{z(N,{child:A,$$slots:{child:!0}})})}Y(F,B)};He(O,F=>{e.renderCancel?F(M):F(L,!1)})}Y(g,b)},$$slots:{default:!0}}),vt(),i()}function Hge(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ce(e,"show",15,!1);{let o=oe(()=>n()("postComponent.warning")),a=oe(()=>n()("postComponent.secret_key_detected")),l=oe(()=>n()("postComponent.post")),c=oe(()=>n()("postComponent.cancel"));NB(t,{get title(){return E(o)},get description(){return E(a)},get confirmLabel(){return E(l)},get cancelLabel(){return E(c)},confirmVariant:"danger",get onConfirm(){return e.onConfirm},get onCancel(){return e.onCancel},contentClass:"secretkey-warning-dialog",addToHistory:!1,get open(){return s()},set open(u){s(u)}})}vt(),i()}function Vge(t,e,n){const r=t.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{centerX:i.x,centerY:i.y,offsetX:e-r.left-i.x,offsetY:n-r.top-i.y}}function Wge(t,e){return{x:t.x-e.x,y:t.y-e.y}}function jge(t,e,n){const r=e.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{scale:n,offsetX:t.clientX-r.left-i.x,offsetY:t.clientY-r.top-i.y}}function qge({scale:t,translate:e,useTransition:n},r){const i=r??document.querySelector(".image-container");i&&(i.style.transition=n?`transform ${dL.TRANSITION_DURATION} ease`:"none",i.style.transform=`scale(${t}) translate(${e.x/t}px, ${e.y/t}px)`,i.style.transformOrigin="center")}function Kge(t,e,n,r){const i=r??document.querySelector(".image-container");i&&(i.style.transition="none",i.style.transform=`scale(${t}) translate(${e/t}px, ${n/t}px)`)}function fu(t,e){const n=e??document.querySelector(".image-container");n&&(n.style.cursor=t>cr.DEFAULT_SCALE?"grab":"default")}function Qh(t,e){const n=e??document.querySelector(".fullscreen-overlay");n&&(n.style.cursor=t>cr.DEFAULT_SCALE?"grab":"default")}function Wl(t){is.setTransition(t)}function OO(t){const e=t?"":"none";Hu("user-select",e),Hu("-webkit-user-select",e)}function bm(t){t!==null&&clearTimeout(t)}function MO(t,e){if(t&&e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i={imageWidth:n.width,imageHeight:n.height,containerWidth:r.width,containerHeight:r.height};is.setBoundaryConstraints(i)}}function Qg(t,e,n,r,i){t!==null&&cancelAnimationFrame(t),e!==null&&cancelAnimationFrame(e),t=null,e=null,is.reset(),is.setBoundaryConstraints(null),n.isDragging=!1,r.isPinching=!1,bm(i),bse()}function Gge(t,e,n,r,i,s,o){if(!s)return{isDoubleTap:!1,newLastTapTime:t,newLastTapPosition:e,newTapTimeoutId:n};const a=Date.now(),l=e?Math.sqrt(Math.pow(r-e.x,2)+Math.pow(i-e.y,2)):0;if(a-t<200&&l<50&&n!==null)return bm(n),o(r,i),{isDoubleTap:!0,newLastTapTime:0,newLastTapPosition:null,newTapTimeoutId:null};const c=a,u={x:r,y:i};bm(n);const d=window.setTimeout(()=>{},300);return{isDoubleTap:!1,newLastTapTime:c,newLastTapPosition:u,newTapTimeoutId:d}}function NO(t,e,n,r,i,s,o,a,l,c){let u={...n},d=r,f=i,h=s;const p=Gge(r,i,s,o,a,l,c);return d=p.newLastTapTime,f=p.newLastTapPosition,h=p.newTapTimeoutId,p.isDoubleTap&&l?{newDragState:u,newLastTapTime:d,newLastTapPosition:f,newTapTimeoutId:h}:(t>cr.DEFAULT_SCALE&&(u.start={x:o,y:a},u.startTranslate={...e}),{newDragState:u,newLastTapTime:d,newLastTapPosition:f,newTapTimeoutId:h})}function RO(t,e,n,r,i,s,o,a){let l={...t},c=!1;return r&&(l.start?Math.sqrt(Math.pow(e-l.start.x,2)+Math.pow(n-l.start.y,2)):0)>i&&(c=!0,!l.isDragging&&s>cr.DEFAULT_SCALE&&(o(l.start.x,l.start.y),l.isDragging=!0)),l.isDragging&&a(e,n),{newDragState:l,touchMoved:c}}function DO(t,e,n,r,i){e&&Date.now()-n<200&&!r||i()}function US(t,e,n){return Math.max(e,Math.min(n,t))}function Zge(t,e,n){return Math.abs(t-e)<n}function Xge(t,e,n){const r=e.x-t.x,i=e.y-t.y;return{x:r/n*16,y:i/n*16}}function Qge(t,e,n,r,i,s,o){s!==null&&cancelAnimationFrame(s);let a={...t},l={...e};const c=mI.FRICTION,u=mI.MIN_VELOCITY;function d(){if(a.x*=c,a.y*=c,Math.abs(a.x)<u&&Math.abs(a.y)<u){o(null),i();return}l.x+=a.x,l.y+=a.y,l=is.applyBoundaryConstraints(l,n),r(l),o(requestAnimationFrame(d))}o(requestAnimationFrame(d))}let Rn=Zt({scale:cr.DEFAULT_SCALE,translate:{x:0,y:0},useTransition:!0}),HS=null;function LO(t,e){if(!HS)return t;const{imageWidth:n,imageHeight:r,containerWidth:i}=HS,s=n*e,o=r*e;let a=t.x,l=t.y;if(s>i){const d=(s-i)/2,f=-d;a=US(a,f,d)}else a=0;const c=o/2,u=-c;return l=US(l,u,c),{x:a,y:l}}const is={get state(){return Rn},reset(){Rn.scale=cr.DEFAULT_SCALE,Rn.translate={x:0,y:0},Rn.useTransition=!0},setDirectState(t){Rn.scale=t.scale,Rn.translate={...t.translate},Rn.useTransition=t.useTransition??Rn.useTransition},zoom(t){const e=US(t.scale,cr.MIN_SCALE,cr.MAX_SCALE);if(Zge(e,cr.DEFAULT_SCALE,cr.THRESHOLD)){this.reset();return}const n=e/Rn.scale;Rn.translate.x=Rn.translate.x*n-t.offsetX*(n-1),Rn.translate.y=Rn.translate.y*n-t.offsetY*(n-1),Rn.scale=e},zoomToPoint(t,e=0,n=0){if(Rn.scale>=cr.RESET_THRESHOLD){this.reset();return}const r=t/Rn.scale;Rn.translate.x=Rn.translate.x*r-e*(r-1),Rn.translate.y=Rn.translate.y*r-n*(r-1),Rn.scale=t},drag(t,e,n){const r={x:n.x+t,y:n.y+e},i=LO(r,Rn.scale);Rn.translate.x=i.x,Rn.translate.y=i.y},setTransition(t){Rn.useTransition=t},setBoundaryConstraints(t){HS=t},applyBoundaryConstraints(t,e){return LO(t,e)}};function Yge(){return{isDragging:!1,start:{x:0,y:0},startTranslate:{x:0,y:0}}}function Jge(){return{isPinching:!1,initialDistance:0,initialScale:1,centerX:0,centerY:0}}var e0e=Ce('<span class="svg-icon close-icon svelte-128lph0"></span>'),t0e=Ce('<div class="fullscreen-overlay svelte-128lph0" tabindex="0" role="dialog" aria-label="ç»åå¨ç»é¢è¡¨ç¤º"><div class="close-button-container svelte-128lph0"><!></div> <div class="image-container svelte-128lph0"><img class="fullscreen-image svelte-128lph0" draggable="false"/></div></div>');function n0e(t,e){wt(e,!0);let n=ce(e,"src",3,""),r=ce(e,"alt",3,""),i=ce(e,"show",15,!1),s=ce(e,"onClose",3,()=>{}),o=ye(void 0),a=ye(void 0),l=ye(void 0),c=is.state,u=Yge(),d=Jge(),f=null,h=null,p=null,m=!1,g=0,y=null,b=null,x=0,C=!1,P=10,S=0,_={x:0,y:0},k={x:0,y:0};nt(()=>{c=is.state,qge({scale:c.scale,translate:c.translate,useTransition:c.useTransition??!1},E(l))});function T(Se){if(Se.preventDefault(),!E(l)||!E(a))return;const Me=Se.deltaY>0?cr.ZOOM_DELTA.OUT:cr.ZOOM_DELTA.IN,Ne=c.scale*Me,Ke=jge(Se,E(a),Ne);is.zoom(Ke),fu(c.scale,E(l)),Qh(c.scale,E(a))}function O(Se,Me){Wl(!0),setTimeout(()=>{if(c.scale>=cr.RESET_THRESHOLD)is.reset();else{const Ne=Se!==void 0&&Me!==void 0&&E(a)?Vge(E(a),Se,Me):{offsetX:0,offsetY:0};is.zoomToPoint(cr.DOUBLE_CLICK_SCALE,Ne.offsetX,Ne.offsetY)}fu(c.scale,E(l))},100)}function M(Se){R(),O(Se.clientX,Se.clientY)}function L(Se,Me){c.scale<=cr.DEFAULT_SCALE||(u.isDragging=!0,u.start={x:Se,y:Me},u.startTranslate={...c.translate},S=Date.now(),_={x:Se,y:Me},k={x:0,y:0},E(l)&&(E(l).style.cursor="grabbing",Wl(!1)),E(a)&&(E(a).style.cursor="grabbing"),OO(!1))}function F(Se,Me){u.isDragging&&(f!==null&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{const Ne=Wge({x:Se,y:Me},u.start);is.drag(Ne.x,Ne.y,u.startTranslate);const Ke=Date.now(),Ae=Ke-S;Ae>0&&(k=Xge(_,{x:Se,y:Me},Ae)),S=Ke,_={x:Se,y:Me}}))}function B(){u.isDragging&&(u.isDragging=!1,f!==null&&(cancelAnimationFrame(f),f=null),so()?Qge(k,c.translate,c.scale,Se=>{is.setDirectState({...c,translate:Se,useTransition:!1})},()=>{Wl(!0),fu(c.scale,E(l)),Qh(c.scale,E(a))},p,Se=>{p=Se}):(fu(c.scale,E(l)),Qh(c.scale,E(a)),setTimeout(()=>Wl(!0),50)),OO(!0))}function R(){u.isDragging&&B()}function A(Se){const[Me,Ne]=[Se.touches[0],Se.touches[1]],Ke=Me.clientX-Ne.clientX,Ae=Me.clientY-Ne.clientY,we=Math.sqrt(Ke*Ke+Ae*Ae);we>cr.PINCH_MIN_DISTANCE&&(d.isPinching=!0,d.initialDistance=we,d.initialScale=c.scale,d.centerX=(Me.clientX+Ne.clientX)/2,d.centerY=(Me.clientY+Ne.clientY)/2,Wl(!1))}function N(Se){!d.isPinching||!E(a)||(h!==null&&cancelAnimationFrame(h),h=requestAnimationFrame(()=>{const[Me,Ne]=[Se.touches[0],Se.touches[1]],Ke=Me.clientX-Ne.clientX,Ae=Me.clientY-Ne.clientY,we=Math.sqrt(Ke*Ke+Ae*Ae);if(we>cr.PINCH_MIN_DISTANCE){const We=we/d.initialDistance,et=Math.max(cr.MIN_SCALE,Math.min(cr.MAX_SCALE,d.initialScale*We));if(!E(a))return;const at=E(a).getBoundingClientRect(),Pt=at.width/2,Ot=at.height/2,Tt=d.centerX-at.left-Pt,Mt=d.centerY-at.top-Ot,Ft=et/c.scale,En=c.translate.x*Ft-Tt*(Ft-1),Ut=c.translate.y*Ft-Mt*(Ft-1);Kge(et,En,Ut,E(l))}}))}function z(){if(d.isPinching){if(h!==null&&(cancelAnimationFrame(h),h=null),d.isPinching=!1,E(l)){const Se=E(l).style.transform,Me=Se.match(/scale\(([^)]+)\)/),Ne=Se.match(/translate\(([^,]+)px,\s*([^)]+)px\)/);if(Me&&Ne){const Ke=parseFloat(Me[1]),Ae=parseFloat(Ne[1])*Ke,we=parseFloat(Ne[2])*Ke;is.setDirectState({scale:Ke,translate:{x:Ae,y:we},useTransition:!0})}}Wl(!0),fu(c.scale,E(l))}}function U(Se){if(!Se.target?.closest(".close-button-container"))if(Se.preventDefault(),p!==null&&(cancelAnimationFrame(p),p=null,Wl(!0),fu(c.scale,E(l)),Qh(c.scale,E(a))),Se.touches.length===1){const Me=Se.touches[0],Ne=NO(c.scale,c.translate,u,g,b,y,Me.clientX,Me.clientY,!0,(Ke,Ae)=>O(Ke,Ae));u=Ne.newDragState,g=Ne.newLastTapTime,b=Ne.newLastTapPosition,y=Ne.newTapTimeoutId}else Se.touches.length===2&&(B(),bm(y),A(Se))}function V(Se){if(Se.preventDefault(),Se.touches.length===1){const Me=Se.touches[0],Ne=RO(u,Me.clientX,Me.clientY,!0,P,c.scale,L,F);u=Ne.newDragState,C=Ne.touchMoved}else Se.touches.length===2&&d.isPinching&&N(Se)}function q(Se){Se.preventDefault(),Se.touches.length===0?(DO(u,!0,x,C,B),z()):Se.touches.length===1&&d.isPinching&&z()}function G(Se){if(Se.target?.closest(".close-button-container"))return;p!==null&&(cancelAnimationFrame(p),p=null,Wl(!0),fu(c.scale,E(l)),Qh(c.scale,E(a)));const Me=NO(c.scale,c.translate,u,g,b,y,Se.clientX,Se.clientY,!1,(Ne,Ke)=>O(Ne,Ke));u=Me.newDragState,g=Me.newLastTapTime,b=Me.newLastTapPosition,y=Me.newTapTimeoutId,L(Se.clientX,Se.clientY)}function ne(Se){u.isDragging&&(Se.preventDefault(),u=RO(u,Se.clientX,Se.clientY,!1,P,c.scale,L,F).newDragState)}function te(){DO(u,!1,x,C,B)}function Z(Se){Se.key==="Escape"&&_e()}function ae(Se){i()&&m&&(Se.preventDefault(),Qg(f,h,u,d,g),f=null,h=null,g=0,y=null,i(!1),s()())}function _e(){Qg(f,h,u,d,g),f=null,h=null,g=0,y=null,i(!1),s()(),m&&(m=!1,history.back()),so()||Ese(zie.EDITOR,dL.EDITOR_FOCUS_DELAY)}nt(()=>{i()?(Qg(f,h,u,d,g),f=null,h=null,g=0,y=null,Hu("overflow","hidden"),m||(history.pushState({imageFullscreen:!0},"",""),m=!0),E(o)&&E(o).complete&&MO(E(o),E(a))):(Hu("overflow",""),m=!1)});function de(){const Se=[{event:"mousemove",handler:ne,target:document},{event:"mouseup",handler:te,target:document},{event:"popstate",handler:ae,target:window}];return Se.forEach(({event:Me,handler:Ne,target:Ke})=>Ke.addEventListener(Me,Ne)),Se}function Ee(Se){Se.forEach(({event:Me,handler:Ne,target:Ke})=>Ke.removeEventListener(Me,Ne))}Vs(()=>{const Se=de();return()=>{Ee(Se),bm(y)}}),_f(()=>{Qg(f,h,u,d,g),m=!1,b=null});var Re=ze(),je=Te(Re);{var Ve=Se=>{var Me=t0e();Me.__keydown=Z,Me.__mousedown=G,Me.__touchstart=U,Me.__touchmove=V,Me.__touchend=q;var Ne=ie(Me),Ke=ie(Ne);Lt(Ke,{variant:"close",shape:"circle",onClick:_e,ontouchstart:We=>We.stopPropagation(),ontouchend:We=>{We.stopPropagation(),We.preventDefault(),setTimeout(()=>_e(),50)},ariaLabel:"Close fullscreen image",children:(We,et)=>{var at=e0e();Y(We,at)},$$slots:{default:!0}});var Ae=ve(Ne,2),we=ie(Ae);we.__dblclick=M,Ar(we,We=>Q(o,We),()=>E(o)),Ar(Ae,We=>Q(l,We),()=>E(l)),Ar(Me,We=>Q(a,We),()=>E(a)),Ge(()=>{fn(we,"src",n()),fn(we,"alt",r())}),Is("wheel",Me,T),Is("load",we,We=>MO(E(o),E(a))),Y(Se,Me)};He(je,Se=>{i()&&Se(Ve)})}Y(t,Re),vt()}Mi(["keydown","mousedown","touchstart","touchmove","touchend","dblclick"]);var r0e=Ce('<div class="upload-error svelte-8mn1et"> </div>'),i0e=Ce('<div class="copy-success-message"> </div>'),s0e=Ce('<div class="post-container svelte-8mn1et"><div aria-label="ãã­ã¹ãå¥åã¨ãªã¢" role="textbox" tabindex="0"><!></div> <input type="file" accept="image/*,video/*" multiple style="display: none;"/> <!></div> <!> <!> <!>',1);function o0e(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ye(null),o=ye(null),a=ye(!1),l=ye(void 0),c=ye(void 0),u=Zt({}),d=Zt({}),f=oe(()=>An.postStatus),h=oe(()=>An.uploadErrorMessage),p=null,m=null,g=oe(()=>Ys.value),y=oe(()=>E(g).showSecretKeyDialog),b=oe(()=>E(g).showImageFullscreen),x=oe(()=>E(g).fullscreenImageSrc),C=oe(()=>E(g).fullscreenImageAlt),P=oe(()=>E(g).showPopupModal),S=oe(()=>E(g).popupX),_=oe(()=>E(g).popupY),k=oe(()=>E(g).popupMessage);nt(()=>{e.rxNostr&&(E(c)?E(c).setRxNostr(e.rxNostr):Q(c,new Zme(e.rxNostr),!0))});async function T(we){!we||we.length===0||await Dge({files:we,currentEditor:E(o),fileInput:E(l),onUploadProgress:e.onUploadProgress,updateUploadState:(We,et)=>{An.isUploading=We,An.uploadErrorMessage=et||""},imageOxMap:u,imageXMap:d,videoCompressionProgressStore:_p,imageCompressionProgressStore:Ap,getUploadFailedText:We=>n()(We)})}Vs(()=>{const we=n()("postComponent.enter_your_text")||"ãã­ã¹ããå¥åãã¦ãã ãã";m=Hme({placeholderText:we,editorContainerEl:p,currentEditor:E(o),hasStoredKey:e.hasStoredKey,submitPost:R,uploadFiles:et=>{T(et)},eventCallbacks:{onContentUpdate:Bme,onImageFullscreenRequest:(et,at)=>{Ys.showImageFullscreen(et,at)},onSelectImageNode:et=>{}}}),Q(s,m.editor,!0),E(s).subscribe(et=>{Q(o,et,!0),dC.set(et)});const We=et=>{const at=et,{src:Pt,alt:Ot}=at.detail;Ys.showImageFullscreen(Pt,Ot)};return window.addEventListener("image-fullscreen-request",We),()=>{window.removeEventListener("image-fullscreen-request",We),m&&Vme({unsubscribe:m.unsubscribe,handlers:m.handlers,currentEditor:E(o),editorContainerEl:p})}});function O(we){const We=we.target;We?.files?.length&&T(We.files)}async function M(we){await T(we)}function L(we){if(!E(o)||!we)return;const We=E(o),at=we.split(`
`).map(Pt=>({type:"paragraph",content:Pt?[{type:"text",text:Pt}]:void 0}));We.commands.setContent({type:"doc",content:at}),We.commands.focus("end")}function F(we){!E(o)||!we||(E(o).commands.setContent(we),E(o).commands.focus("end"))}function B(){return E(o)?E(o).getHTML():""}async function R(){if(!E(c)||!E(o))return;const we=E(c).preparePostContent(E(o));if(yoe(we)){Ys.showSecretKeyDialog(we);return}await E(c).performPostSubmission(E(o),u,d,()=>Ta({sending:!0,success:!1,error:!1,message:"",completed:!1}),()=>{Ta({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),N(),e.onPostSuccess?.()},We=>Ta({sending:!1,success:!1,error:!0,message:We||"postComponent.post_error",completed:!1}))}function A(){E(c)&&E(o)&&E(c).resetPostContent(E(o))}function N(){E(c)&&E(o)&&E(c).clearContentAfterSuccess(E(o))}function z(){Uc.querySelector(".tiptap-editor")?.focus()}async function U(){const we=Ys.getPendingPost();if(Ys.hideSecretKeyDialog(),E(c)&&E(o)){const We=E(c).prepareImageBlurhashMap(E(o),u,d);Ta({sending:!0,success:!1,error:!1,message:"",completed:!1});try{const et=await E(c).submitPost(we,We);et.success?(Ta({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),N(),e.onPostSuccess?.()):Ta({sending:!1,success:!1,error:!0,message:et.error||"postComponent.post_error",completed:!1})}catch{Ta({sending:!1,success:!1,error:!0,message:"postComponent.post_error",completed:!1})}}}function V(){Ys.hideSecretKeyDialog()}function q(){Ys.hideImageFullscreen(),so()||setTimeout(()=>{Uc.querySelector(".tiptap-editor")?.focus()},150)}nt(()=>{E(o)&&E(c)&&E(c).preparePostContent(E(o))!==An.content&&E(f).error&&Ta({...E(f),error:!1,message:""})});function G(){E(l)?.click()}var ne={uploadFiles:M,insertTextContent:L,loadDraftContent:F,getEditorHtml:B,submitPost:R,resetPostContent:A,clearContentAfterSuccess:N,focusEditor:z,openFileDialog:G},te=s0e(),Z=Te(te),ae=ie(Z);let _e;var de=ie(ae);{var Ee=we=>{ufe(we,{get editor(){return E(o)},class:"editor-content"})};He(de,we=>{E(s)&&E(o)&&we(Ee)})}Sg(ae,(we,We)=>Ofe?.(we,We),()=>({dragOver:we=>Q(a,we,!0)})),Sg(ae,we=>Mfe?.(we)),Sg(ae,we=>Nfe?.(we)),Sg(ae,we=>Rfe?.(we)),Ar(ae,we=>p=we,()=>p);var Re=ve(ae,2);Re.__change=O,Ar(Re,we=>Q(l,we),()=>E(l));var je=ve(Re,2);{var Ve=we=>{var We=r0e(),et=ie(We);Ge(()=>Be(et,E(h))),Y(we,We)};He(je,we=>{E(h)&&we(Ve)})}var Se=ve(Z,2);Hge(Se,{onConfirm:U,onCancel:V,get show(){return E(y)},set show(we){Q(y,we)}});var Me=ve(Se,2);n0e(Me,{get src(){return E(x)},get alt(){return E(C)},onClose:q,get show(){return E(b)},set show(we){Q(b,we)}});var Ne=ve(Me,2);{var Ke=we=>{mC(we,{get show(){return E(P)},get x(){return E(S)},get y(){return E(_)},onClose:()=>Ys.hidePopupMessage(),children:(We,et)=>{var at=i0e(),Pt=ie(at);Ge(()=>Be(Pt,E(k))),Y(We,at)},$$slots:{default:!0}})};He(Ne,we=>{E(P)&&we(Ke)})}Ge(()=>_e=Qo(ae,1,"editor-container svelte-8mn1et",null,_e,{"drag-over":E(a)})),Y(t,te);var Ae=vt(ne);return i(),Ae}Mi(["change"]);var a0e=Ce('<input type="radio" style="display: none;"/> <!>',1);function BO(t,e){wt(e,!0);let n=ce(e,"checked",3,!1),r=ce(e,"disabled",3,!1),i=ce(e,"variant",3,"default"),s=ce(e,"shape",3,"rounded"),o=ce(e,"className",3,""),a=ce(e,"ariaLabel",3,""),l=ce(e,"style",3,""),c;function u(){!r()&&c&&c.click()}function d(){e.onChange&&e.onChange(e.value)}var f=a0e(),h=Te(f);h.__change=d,Ar(h,m=>c=m,()=>c);var p=ve(h,2);Lt(p,{get variant(){return i()},get shape(){return s()},get className(){return o()},get ariaLabel(){return a()},get style(){return l()},get disabled(){return r()},get selected(){return n()},onClick:u,children:(m,g)=>{var y=ze(),b=Te(y);kt(b,()=>e.children??Bt),Y(m,y)},$$slots:{default:!0}}),Ge(()=>{fM(h,e.value),fn(h,"name",e.name),W9(h,n()),h.disabled=r()}),Y(t,f),vt()}Mi(["change"]);var l0e={203:(t,e)=>{function n(T){if(!Number.isSafeInteger(T))throw new Error(`Wrong integer: ${T}`)}function r(...T){const O=(F,B)=>R=>F(B(R)),M=Array.from(T).reverse().reduce(((F,B)=>F?O(F,B.encode):B.encode),void 0),L=T.reduce(((F,B)=>F?O(F,B.decode):B.decode),void 0);return{encode:M,decode:L}}function i(T){return{encode:O=>{if(!Array.isArray(O)||O.length&&typeof O[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return O.map((M=>{if(n(M),M<0||M>=T.length)throw new Error(`Digit index outside alphabet: ${M} (alphabet: ${T.length})`);return T[M]}))},decode:O=>{if(!Array.isArray(O)||O.length&&typeof O[0]!="string")throw new Error("alphabet.decode input should be array of strings");return O.map((M=>{if(typeof M!="string")throw new Error(`alphabet.decode: not string element=${M}`);const L=T.indexOf(M);if(L===-1)throw new Error(`Unknown letter: "${M}". Allowed: ${T}`);return L}))}}}function s(T=""){if(typeof T!="string")throw new Error("join separator should be string");return{encode:O=>{if(!Array.isArray(O)||O.length&&typeof O[0]!="string")throw new Error("join.encode input should be array of strings");for(let M of O)if(typeof M!="string")throw new Error(`join.encode: non-string input=${M}`);return O.join(T)},decode:O=>{if(typeof O!="string")throw new Error("join.decode input should be string");return O.split(T)}}}function o(T,O="="){if(n(T),typeof O!="string")throw new Error("padding chr should be string");return{encode(M){if(!Array.isArray(M)||M.length&&typeof M[0]!="string")throw new Error("padding.encode input should be array of strings");for(let L of M)if(typeof L!="string")throw new Error(`padding.encode: non-string input=${L}`);for(;M.length*T%8;)M.push(O);return M},decode(M){if(!Array.isArray(M)||M.length&&typeof M[0]!="string")throw new Error("padding.encode input should be array of strings");for(let F of M)if(typeof F!="string")throw new Error(`padding.decode: non-string input=${F}`);let L=M.length;if(L*T%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;L>0&&M[L-1]===O;L--)if(!((L-1)*T%8))throw new Error("Invalid padding: string has too much padding");return M.slice(0,L)}}}function a(T){if(typeof T!="function")throw new Error("normalize fn should be function");return{encode:O=>O,decode:O=>T(O)}}function l(T,O,M){if(O<2)throw new Error(`convertRadix: wrong from=${O}, base cannot be less than 2`);if(M<2)throw new Error(`convertRadix: wrong to=${M}, base cannot be less than 2`);if(!Array.isArray(T))throw new Error("convertRadix: data should be array");if(!T.length)return[];let L=0;const F=[],B=Array.from(T);for(B.forEach((R=>{if(n(R),R<0||R>=O)throw new Error(`Wrong integer: ${R}`)}));;){let R=0,A=!0;for(let N=L;N<B.length;N++){const z=B[N],U=O*R+z;if(!Number.isSafeInteger(U)||O*R/O!==R||U-z!=O*R)throw new Error("convertRadix: carry overflow");if(R=U%M,B[N]=Math.floor(U/M),!Number.isSafeInteger(B[N])||B[N]*M+R!==U)throw new Error("convertRadix: carry overflow");A&&(B[N]?A=!1:L=N)}if(F.push(R),A)break}for(let R=0;R<T.length-1&&T[R]===0;R++)F.push(0);return F.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const c=(T,O)=>O?c(O,T%O):T,u=(T,O)=>T+(O-c(T,O));function d(T,O,M,L){if(!Array.isArray(T))throw new Error("convertRadix2: data should be array");if(O<=0||O>32)throw new Error(`convertRadix2: wrong from=${O}`);if(M<=0||M>32)throw new Error(`convertRadix2: wrong to=${M}`);if(u(O,M)>32)throw new Error(`convertRadix2: carry overflow from=${O} to=${M} carryBits=${u(O,M)}`);let F=0,B=0;const R=2**M-1,A=[];for(const N of T){if(n(N),N>=2**O)throw new Error(`convertRadix2: invalid data word=${N} from=${O}`);if(F=F<<O|N,B+O>32)throw new Error(`convertRadix2: carry overflow pos=${B} from=${O}`);for(B+=O;B>=M;B-=M)A.push((F>>B-M&R)>>>0);F&=2**B-1}if(F=F<<M-B&R,!L&&B>=O)throw new Error("Excess padding");if(!L&&F)throw new Error(`Non-zero padding: ${F}`);return L&&B>0&&A.push(F>>>0),A}function f(T){return n(T),{encode:O=>{if(!(O instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return l(Array.from(O),256,T)},decode:O=>{if(!Array.isArray(O)||O.length&&typeof O[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(l(O,T,256))}}}function h(T,O=!1){if(n(T),T<=0||T>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,T)>32||u(T,8)>32)throw new Error("radix2: carry overflow");return{encode:M=>{if(!(M instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return d(Array.from(M),8,T,!O)},decode:M=>{if(!Array.isArray(M)||M.length&&typeof M[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(d(M,T,8,O))}}}function p(T){if(typeof T!="function")throw new Error("unsafeWrapper fn should be function");return function(...O){try{return T.apply(null,O)}catch{}}}function m(T,O){if(n(T),typeof O!="function")throw new Error("checksum fn should be function");return{encode(M){if(!(M instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const L=O(M).slice(0,T),F=new Uint8Array(M.length+T);return F.set(M),F.set(L,M.length),F},decode(M){if(!(M instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const L=M.slice(0,-T),F=O(L).slice(0,T),B=M.slice(-T);for(let R=0;R<T;R++)if(F[R]!==B[R])throw new Error("Invalid checksum");return L}}}e.utils={alphabet:i,chain:r,checksum:m,radix:f,radix2:h,join:s,padding:o},e.base16=r(h(4),i("0123456789ABCDEF"),s("")),e.base32=r(h(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),e.base32hex=r(h(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),e.base32crockford=r(h(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((T=>T.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),e.base64url=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const g=T=>r(f(58),i(T),s(""));e.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(T){let O="";for(let M=0;M<T.length;M+=8){const L=T.subarray(M,M+8);O+=e.base58.encode(L).padStart(y[L.length],"1")}return O},decode(T){let O=[];for(let M=0;M<T.length;M+=11){const L=T.slice(M,M+11),F=y.indexOf(L.length),B=e.base58.decode(L);for(let R=0;R<B.length-F;R++)if(B[R]!==0)throw new Error("base58xmr: wrong padding");O=O.concat(Array.from(B.slice(B.length-F)))}return Uint8Array.from(O)}},e.base58check=T=>r(m(4,(O=>T(T(O)))),e.base58);const b=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),x=[996825010,642813549,513874426,1027748829,705979059];function C(T){const O=T>>25;let M=(33554431&T)<<5;for(let L=0;L<x.length;L++)(O>>L&1)==1&&(M^=x[L]);return M}function P(T,O,M=1){const L=T.length;let F=1;for(let B=0;B<L;B++){const R=T.charCodeAt(B);if(R<33||R>126)throw new Error(`Invalid prefix (${T})`);F=C(F)^R>>5}F=C(F);for(let B=0;B<L;B++)F=C(F)^31&T.charCodeAt(B);for(let B of O)F=C(F)^B;for(let B=0;B<6;B++)F=C(F);return F^=M,b.encode(d([F%2**30],30,5,!1))}function S(T){const O=T==="bech32"?1:734539939,M=h(5),L=M.decode,F=M.encode,B=p(L);function R(A,N=90){if(typeof A!="string")throw new Error("bech32.decode input should be string, not "+typeof A);if(A.length<8||N!==!1&&A.length>N)throw new TypeError(`Wrong string length: ${A.length} (${A}). Expected (8..${N})`);const z=A.toLowerCase();if(A!==z&&A!==A.toUpperCase())throw new Error("String must be lowercase or uppercase");const U=(A=z).lastIndexOf("1");if(U===0||U===-1)throw new Error('Letter "1" must be present between prefix and data only');const V=A.slice(0,U),q=A.slice(U+1);if(q.length<6)throw new Error("Data must be at least 6 characters long");const G=b.decode(q).slice(0,-6),ne=P(V,G,O);if(!q.endsWith(ne))throw new Error(`Invalid checksum in ${A}: expected "${ne}"`);return{prefix:V,words:G}}return{encode:function(A,N,z=90){if(typeof A!="string")throw new Error("bech32.encode prefix should be string, not "+typeof A);if(!Array.isArray(N)||N.length&&typeof N[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof N);const U=A.length+7+N.length;if(z!==!1&&U>z)throw new TypeError(`Length ${U} exceeds limit ${z}`);return`${A=A.toLowerCase()}1${b.encode(N)}${P(A,N,O)}`},decode:R,decodeToBytes:function(A){const{prefix:N,words:z}=R(A,!1);return{prefix:N,words:z,bytes:L(z)}},decodeUnsafe:p(R),fromWords:L,fromWordsUnsafe:B,toWords:F}}e.bech32=S("bech32"),e.bech32m=S("bech32m"),e.utf8={encode:T=>new TextDecoder().decode(T),decode:T=>new TextEncoder().encode(T)},e.hex=r(h(4),i("0123456789abcdef"),s(""),a((T=>{if(typeof T!="string"||T.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof T} with length ${T.length}`);return T.toLowerCase()})));const _={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},k=`Invalid encoding type. Available types: ${Object.keys(_).join(", ")}`;e.bytesToString=(T,O)=>{if(typeof T!="string"||!_.hasOwnProperty(T))throw new TypeError(k);if(!(O instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return _[T].encode(O)},e.str=e.bytesToString,e.stringToBytes=(T,O)=>{if(!_.hasOwnProperty(T))throw new TypeError(k);if(typeof O!="string")throw new TypeError("stringToBytes() expects string");return _[T].decode(O)},e.bytes=e.stringToBytes},806:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([t.id,`.zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

/* Color Classes Generator */
[class*="zap-amount-"] .zap-sender {
  border-radius: 6px;
}

[class*="zap-amount-"] .zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

[class*="zap-amount-"] .zap-details {
  padding-top: 8px;
  padding-bottom: 8px;
}

/* Amount-based Styles */
.zap-amount-100 .zap-sender {
  background-color: var(--zap-100);
}

.zap-amount-200 .zap-sender {
  background-color: var(--zap-200);
}

.zap-amount-500 .zap-sender {
  background-color: var(--zap-500);
}

.zap-amount-1k .zap-sender {
  background-color: var(--zap-1k);
}

.zap-amount-2k .zap-sender {
  background-color: var(--zap-2k);
}

.zap-amount-5k .zap-sender {
  background-color: var(--zap-5k);
}

.zap-amount-10k .zap-sender {
  background-color: var(--zap-10k);
}

/* Details Background Colors */
.zap-amount-100 .zap-details {
  background-color: var(--zap-100-light);
}

.zap-amount-200 .zap-details {
  background-color: var(--zap-200-light);
}

.zap-amount-500 .zap-details {
  background-color: var(--zap-500-light);
}

.zap-amount-1k .zap-details {
  background-color: var(--zap-1k-light);
}

.zap-amount-2k .zap-details {
  background-color: var(--zap-2k-light);
}

.zap-amount-5k .zap-details {
  background-color: var(--zap-5k-light);
}

.zap-amount-10k .zap-details {
  background-color: var(--zap-10k-light);
}

/* Dark Text Colors */
.zap-amount-100,
.zap-amount-2k,
.zap-amount-5k,
.zap-amount-10k {
  .zap-amount {
    color: var(--text-light);
  }

  .sender-name {
    color: var(--text-light-secondary);
  }

  .sender-pubkey {
    color: var(--text-light-tertiary);
  }

  .zap-comment {
    color: var(--text-light);
  }
}

/* Light Text Colors */
.zap-amount-200,
.zap-amount-500,
.zap-amount-1k {
  .zap-amount {
    color: var(--text-dark);
  }

  .sender-name {
    color: var(--text-dark-secondary);
  }

  .sender-pubkey {
    color: var(--text-dark-tertiary);
  }

  .zap-comment {
    color: var(--text-dark);
  }
}`,""]);const a=o},540:(t,e,n)=>{n.r(e),n.d(e,{default:()=>c});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(806),l=o()(i());l.i(a.A),l.push([t.id,`/* styles.css */

:host {
  --main-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  --main-text: Black;
  --pubkey-text: #888;
  --custom-title-text: #555;
  --stats-item-text: #333;
  --name-text: #444;
  --dialog-bg: #ffffff;
  --zap-stats-bg: #edf2f7;
  --hover-bg: #edf2f7;
  --border: #ddd;
  --skeleton: #fdfdfd;
  --skeleton2: #e2e5ec;
  --zap-stats-skeleton-bg: #bbc5cf;
  --new-mark: #22c55e;

  /* Zap Amount Colors */
  --zap-100: #1565c0;
  --zap-200: #00b8d4;
  --zap-500: #00bfa5;
  --zap-1k: #ffb300;
  --zap-2k: #e65100;
  --zap-5k: #c2185b;
  --zap-10k: #d00000;

  /* Light Variants */
  --zap-100-light: #1e88e5;
  --zap-200-light: #00e5ff;
  --zap-500-light: #1de9b6;
  --zap-1k-light: #ffca28;
  --zap-2k-light: #f57c00;
  --zap-5k-light: #e91e63;
  --zap-10k-light: #e62117;

  /* Text Colors */
  --text-light: #ffffff;
  --text-light-secondary: rgba(255, 255, 255, 0.9);
  --text-light-tertiary: rgba(255, 255, 255, 0.5);
  --text-dark: #000000;
  --text-dark-secondary: rgba(0, 0, 0, 0.7);
  --text-dark-tertiary: rgba(0, 0, 0, 0.5);
}

* {
  box-sizing: border-box;
}

button {
  color: var(--main-text);
  background: none;
  border: none;
  cursor: pointer;
}

.dialog {
  font-family: var(--main-font);
  color: var(--main-text);
  font-size: medium;
  font-weight: normal;
  max-height: 700px;
  height: 100dvh;
  width: 360px;
  margin: auto;
  padding: 0;
  border: none;
  border-radius: 10px;
  background: var(--dialog-bg);
  display: flex;
  flex-direction: column;
}

.close-dialog-button {
  color: var(--custom-title-text);
  font-size: 16px;
  font-weight: 500;
  position: absolute;
  right: 0;
  width: 2.625rem;
  height: 2.625rem;
  border: none;
  border-radius: 50%;
  background: none;
  cursor: pointer;
  padding: 10px;
  text-align: center;
}

.close-dialog-button:hover {
  background-color: var(--hover-bg);
}

.dialog-title {
  height: 42px;
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;

  & a {
    font-size: 0.9rem;
    font-weight: normal;
    color: var(--pubkey-text);
    text-decoration: none;
    cursor: pointer;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
  }

  & a:hover {
    text-decoration: underline;
  }
}

.dialog-title.custom-title a {
  color: var(--custom-title-text);
  font-weight: 600;
  font-size: 1rem;
}

.zap-stats {
  min-height: 80px;
  padding: 6px 14px;
  background: var(--zap-stats-bg);
  border-radius: 6px;
  display: grid;
  grid-template-columns: 90px 1fr 40px;
  grid-template-rows: repeat(3, 1fr);
  gap: 4px;
  margin: 0 8px;

  .stats-item {
    height: 23px;
    color: var(--stats-item-text);
    font-size: 0.9rem;

    .number {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .number.skeleton {
      width: 100%;
      background: linear-gradient(90deg,
          var(--skeleton) 0%,
          var(--zap-stats-skeleton-bg) 50%,
          var(--skeleton) 100%);
      background-size: 200% 100%;
    }
  }
}

.stats-item:nth-child(3n + 1) {
  justify-content: flex-start;
}

.stats-item:nth-child(3n + 2),
.stats-item:nth-child(3n + 3) {
  justify-content: flex-end;
}

.text-muted {
  margin-right: 16px;
  opacity: 0.4;
}

.dialog-zap-list {
  list-style-type: none;
  margin: 10px 0;
  padding: 0 6px;
  flex: 1;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: smooth;

  /* ã¹ã¯ã­ã¼ã«ãã¼ã®ã¹ã¿ã¤ãªã³ã° */
  &::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 3px;
  }

  &::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    transition: background 0.2s;
  }

  &::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.2);
  }

  /* Firefoxç¨ã®ã¹ã¯ã­ã¼ã«ãã¼ã¹ã¿ã¤ã« */
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
}

.zap-list-item {
  display: flex;
  flex-direction: column;
  border-top: 1px solid var(--border);
  padding: 4px 0;
}

.zap-content {
  display: flex;
  flex-direction: column;
}

.reference-container {
  display: flex;
  flex-direction: column;
}

.zap-sender {
  gap: 12px;
  height: 46px;
  justify-content: space-between;
  padding: 6px;
}

.sender-icon {
  flex-shrink: 0;

  & img {
    width: 100%;
    height: 100%;
    border-radius: 4px;
    object-fit: cover;
    object-position: center;
  }
}

.sender-icon.is-new::before {
  content: "";
  position: absolute;
  top: -4px;
  left: -4px;
  width: 8px;
  height: 8px;
  background-color: var(--new-mark);
  border: 1px solid #fff;
  border-radius: 50%;
  z-index: 1;
  animation: pulse 2500ms cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  50% {
    opacity: 0.3;
  }
}

.sender-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  overflow: hidden;
  min-width: 0;
}

.sender-name {
  font-size: 0.9375rem;
  font-weight: bold;
  color: var(--name-text);
}

.sender-pubkey {
  font-size: 0.625rem;
  color: var(--pubkey-text);
  margin-top: -1px;
}

.zap-amount {
  font-size: 0.8rem;
  white-space: nowrap;
  flex-shrink: 0;

  .number {
    font-size: 1.4rem;
    font-weight: 500;
    text-align: right;
  }
}

.zap-details {
  padding: 2px 8px;
  border-radius: 0 0 6px 6px;
  margin: 0;
}

.zap-comment {
  font-size: 0.9375rem;
  margin: 0;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  max-width: 100%;
}

.no-zaps-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

.no-zaps-message {
  text-align: center;
  color: var(--pubkey-text);
  font-size: 1.8rem;
  font-weight: 700;
}

.zap-reference {
  padding: 2px 0 2px 12px;
  margin: 0;
  font-size: 0.875rem;
  color: var(--pubkey-text);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.reference-arrow {
  flex-shrink: 0;

  img {
    height: 16px;
    width: auto;
  }
}

.reference-text {
  font-size: 0.75rem;
  margin: 0 2px;
  flex-grow: 1;
}

.reference-link {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 1.5rem;
  width: 2.6rem;
  text-decoration: none;
  border-left: 1px solid var(--border);
  flex-shrink: 0;

  & img {
    height: 20px;
    width: auto;
  }
}

.zap-placeholder-name {
  height: 30px;
  width: 140px;
}

.zap-placeholder-name.skeleton {
  width: 120px;
  height: 19px;
  margin: 2px 0;
}

.skeleton {
  color: transparent;
  border-radius: 2px;
  background: linear-gradient(90deg,
      var(--skeleton) 0%,
      var(--skeleton2) 50%,
      var(--skeleton) 100%);
  background-size: 200% 100%;
  animation: loading-animation 3.5s infinite;
  opacity: 0.7;
}

@keyframes loading-animation {
  0% {
    background-position: 200% 0;
  }

  100% {
    background-position: -200% 0;
  }
}

/* å±éã®ãã­ã¹ããªã¼ãã¼ãã­ã¼å¦ç */
.dialog-title,
.sender-name,
.sender-pubkey,
.reference-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* å±éã®ãã¬ãã¯ã¹ããã¯ã¹è¨­å® */
.zap-sender,
.stats-item,
.zap-details,
.reference-link,
.zap-reference {
  display: flex;
  align-items: center;
}

/* å±éã®ã¢ã¤ã³ã³ãµã¤ãº */
.zap-placeholder-icon,
.sender-icon {
  width: 32px;
  height: 32px;
  border-radius: 4px;
  position: relative;
}

.load-more-trigger {
  height: 40px;
  margin: 10px 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--zap-stats-bg);
  border-top: 3px solid var(--pubkey-text);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}`,""]);const c=l},314:t=>{t.exports=function(e){var n=[];return n.toString=function(){return this.map((function(r){var i="",s=r[5]!==void 0;return r[4]&&(i+="@supports (".concat(r[4],") {")),r[2]&&(i+="@media ".concat(r[2]," {")),s&&(i+="@layer".concat(r[5].length>0?" ".concat(r[5]):""," {")),i+=e(r),s&&(i+="}"),r[2]&&(i+="}"),r[4]&&(i+="}"),i})).join("")},n.i=function(r,i,s,o,a){typeof r=="string"&&(r=[[null,r,void 0]]);var l={};if(s)for(var c=0;c<this.length;c++){var u=this[c][0];u!=null&&(l[u]=!0)}for(var d=0;d<r.length;d++){var f=[].concat(r[d]);s&&l[f[0]]||(a!==void 0&&(f[5]===void 0||(f[1]="@layer".concat(f[5].length>0?" ".concat(f[5]):""," {").concat(f[1],"}")),f[5]=a),i&&(f[2]&&(f[1]="@media ".concat(f[2]," {").concat(f[1],"}")),f[2]=i),o&&(f[4]?(f[1]="@supports (".concat(f[4],") {").concat(f[1],"}"),f[4]=o):f[4]="".concat(o)),n.push(f))}},n}},601:t=>{t.exports=function(e){return e[1]}},705:(t,e,n)=>{const{bech32:r,hex:i,utf8:s}=n(203),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},d=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],f={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},h=BigInt("2100000000000000000"),p=BigInt(1e11),m={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},g={};for(let P=0,S=Object.keys(m);P<S.length;P++){const _=S[P],k=m[S[P]].toString();g[k]=_}const y={1:P=>i.encode(r.fromWordsUnsafe(P)),16:P=>i.encode(r.fromWordsUnsafe(P)),13:P=>s.encode(r.fromWordsUnsafe(P)),19:P=>i.encode(r.fromWordsUnsafe(P)),23:P=>i.encode(r.fromWordsUnsafe(P)),27:P=>i.encode(r.fromWordsUnsafe(P)),6:x,24:x,3:function(P){const S=[];let _,k,T,O,M,L=r.fromWordsUnsafe(P);for(;L.length>0;)_=i.encode(L.slice(0,33)),k=i.encode(L.slice(33,41)),T=parseInt(i.encode(L.slice(41,45)),16),O=parseInt(i.encode(L.slice(45,49)),16),M=parseInt(i.encode(L.slice(49,51)),16),L=L.slice(51),S.push({pubkey:_,short_channel_id:k,fee_base_msat:T,fee_proportional_millionths:O,cltv_expiry_delta:M});return S},5:function(P){const S=P.slice().reverse().map((T=>[!!(1&T),!!(2&T),!!(4&T),!!(8&T),!!(16&T)])).reduce(((T,O)=>T.concat(O)),[]);for(;S.length<2*d.length;)S.push(!1);const _={};d.forEach(((T,O)=>{let M;M=S[2*O]?"required":S[2*O+1]?"supported":"unsupported",_[T]=M}));const k=S.slice(2*d.length);return _.extra_bits={start_bit:2*d.length,bits:k,has_required:k.reduce(((T,O,M)=>M%2!=0?T||!1:T||O),!1)},_}};function b(P){return S=>({tagCode:parseInt(P),words:r.encode("unknown",S,Number.MAX_SAFE_INTEGER)})}function x(P){return P.reverse().reduce(((S,_,k)=>S+_*Math.pow(32,k)),0)}function C(P,S){let _,k;if(P.slice(-1).match(/^[munp]$/))_=P.slice(-1),k=P.slice(0,-1);else{if(P.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");k=P}if(!k.match(/^\d+$/))throw new Error("Not a valid human readable amount");const T=BigInt(k),O=_?T*p/f[_]:T*p;if(_==="p"&&T%BigInt(10)!==BigInt(0)||O>h)throw new Error("Amount is outside of valid range");return S?O.toString():O}t.exports={decode:function(P,S){if(typeof P!="string")throw new Error("Lightning Payment Request must be string");if(P.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const _=[],k=r.decode(P,Number.MAX_SAFE_INTEGER);P=P.toLowerCase();const T=k.prefix;let O=k.words,M=P.slice(T.length+1),L=O.slice(-104);O=O.slice(0,-104);let F=T.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(F&&!F[2]&&(F=T.match(/^ln(\S+)$/)),!F)throw new Error("Not a proper lightning payment request");_.push({name:"lightning_network",letters:"ln"});const B=F[1];let R;if(S){if(S.bech32===void 0||S.pubKeyHash===void 0||S.scriptHash===void 0||!Array.isArray(S.validWitnessVersions))throw new Error("Invalid network");R=S}else switch(B){case o.bech32:R=o;break;case a.bech32:R=a;break;case l.bech32:R=l;break;case c.bech32:R=c;break;case u.bech32:R=u}if(!R||R.bech32!==B)throw new Error("Unknown coin bech32 prefix");_.push({name:"coin_network",letters:B,value:R});const A=F[2];let N;A?(N=C(A+F[3],!0),_.push({name:"amount",letters:F[2]+F[3],value:N})):N=null,_.push({name:"separator",letters:"1"});const z=x(O.slice(0,7));let U,V,q,G;for(O=O.slice(7),_.push({name:"timestamp",letters:M.slice(0,7),value:z}),M=M.slice(7);O.length>0;){const Z=O[0].toString();U=g[Z]||"unknown_tag",V=y[Z]||b(Z),O=O.slice(1),q=x(O.slice(0,2)),O=O.slice(2),G=O.slice(0,q),O=O.slice(q),_.push({name:U,tag:M[0],letters:M.slice(0,3+q),value:V(G)}),M=M.slice(3+q)}_.push({name:"signature",letters:M.slice(0,104),value:i.encode(r.fromWordsUnsafe(L))}),M=M.slice(104),_.push({name:"checksum",letters:M});let ne={paymentRequest:P,sections:_,get expiry(){let Z=_.find((ae=>ae.name==="expiry"));if(Z)return te("timestamp")+Z.value},get route_hints(){return _.filter((Z=>Z.name==="route_hint")).map((Z=>Z.value))}};for(let Z in m)Z!=="route_hint"&&Object.defineProperty(ne,Z,{get:()=>te(Z)});return ne;function te(Z){let ae=_.find((_e=>_e.name===Z));return ae?ae.value:void 0}},hrpToMillisat:C}},0:(t,e,n)=>{var r=n(540);r&&r.__esModule&&(r=r.default),t.exports=typeof r=="string"?r:r.toString()}},FO={};function fi(t){var e=FO[t];if(e!==void 0)return e.exports;var n=FO[t]={id:t,exports:{}};return l0e[t](n,n.exports,fi),n.exports}fi.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return fi.d(e,{a:e}),e},fi.d=(t,e)=>{for(var n in e)fi.o(e,n)&&!fi.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},fi.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),fi.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var ua={};fi.d(ua,{vQ:()=>xt,ZM:()=>km,yk:()=>ft,h0:()=>Bu,n_:()=>G$,Xz:()=>nve,Uv:()=>Em,fU:()=>Tm,Dw:()=>Bo});var VS={};fi.r(VS),fi.d(VS,{OG:()=>wC,My:()=>Qf,Ph:()=>Ki,lX:()=>yC,Id:()=>fd,fg:()=>$B,qj:()=>di,aT:()=>wm,lq:()=>Oc,z:()=>bC,Q5:()=>vm});var WS={};fi.r(WS),fi.d(WS,{Relay:()=>ZF,SimplePool:()=>Ebe,finalizeEvent:()=>po,fj:()=>HF,generateSecretKey:()=>_F,getEventHash:()=>Hp,getFilterLimit:()=>gbe,getPublicKey:()=>IC,kinds:()=>AF,matchFilter:()=>zF,matchFilters:()=>UF,mergeFilters:()=>mbe,nip04:()=>YF,nip05:()=>t$,nip10:()=>r$,nip11:()=>i$,nip13:()=>s$,nip18:()=>l$,nip19:()=>XF,nip21:()=>u$,nip25:()=>d$,nip27:()=>f$,nip28:()=>h$,nip30:()=>p$,nip39:()=>g$,nip42:()=>jF,nip44:()=>y$,nip47:()=>S$,nip57:()=>k$,nip59:()=>E$,nip98:()=>N$,parseReferences:()=>Nbe,serializeEvent:()=>CF,sortEvents:()=>J0e,utils:()=>kF,validateEvent:()=>$w,verifiedSymbol:()=>nc,verifyEvent:()=>yh});var c0e=fi(705);function $O(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function RB(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function u0e(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");$O(t.outputLen),$O(t.blockLen)}function bb(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function d0e(t,e){RB(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const C2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,DB=t=>t instanceof Uint8Array,_2=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),To=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function gC(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!DB(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class LB{clone(){return this._cloneInto()}}function f0e(t){const e=r=>t().update(gC(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function BB(t=32){if(C2&&typeof C2.getRandomValues=="function")return C2.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class h0e extends LB{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=_2(this.buffer)}update(e){bb(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=gC(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=_2(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){bb(this),d0e(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;(function(d,f,h,p){if(typeof d.setBigUint64=="function")return d.setBigUint64(f,h,p);const m=BigInt(32),g=BigInt(4294967295),y=Number(h>>m&g),b=Number(h&g),x=p?4:0,C=p?0:4;d.setUint32(f+x,y,p),d.setUint32(f+C,b,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=_2(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const p0e=(t,e,n)=>t&e^t&n^e&n,m0e=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),jl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ql=new Uint32Array(64);class g0e extends h0e{constructor(){super(64,32,8,!1),this.A=0|jl[0],this.B=0|jl[1],this.C=0|jl[2],this.D=0|jl[3],this.E=0|jl[4],this.F=0|jl[5],this.G=0|jl[6],this.H=0|jl[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let f=0;f<16;f++,n+=4)ql[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=ql[f-15],p=ql[f-2],m=To(h,7)^To(h,18)^h>>>3,g=To(p,17)^To(p,19)^p>>>10;ql[f]=g+ql[f-7]+m+ql[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=u+(To(a,6)^To(a,11)^To(a,25))+((d=a)&l^~d&c)+m0e[f]+ql[f]|0,p=(To(r,2)^To(r,13)^To(r,22))+p0e(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var d;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){ql.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const jS=f0e((()=>new g0e)),y0e=(BigInt(0),BigInt(1)),b0e=BigInt(2),Nw=t=>t instanceof Uint8Array,w0e=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Qf(t){if(!Nw(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=w0e[t[n]];return e}function FB(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function wm(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Ki(t){return FB(Qf(t))}function yC(t){if(!Nw(t))throw new Error("Uint8Array expected");return FB(Qf(Uint8Array.from(t).reverse()))}function Oc(t,e){return wm(t.toString(16).padStart(2*e,"0"))}function bC(t,e){return Oc(t,e).reverse()}function di(t,e,n){let r;if(typeof e=="string")try{r=wm(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else{if(!Nw(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function fd(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!Nw(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}const wC=t=>(b0e<<BigInt(t-1))-y0e,A2=t=>new Uint8Array(t),zO=t=>Uint8Array.from(t);function $B(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=A2(t),i=A2(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=A2())=>{i=a(zO([0]),u),r=a(),u.length!==0&&(i=a(zO([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){r=a();const f=r.slice();d.push(f),u+=r.length}return fd(...d)};return(u,d)=>{let f;for(o(),l(u);!(f=d(c()));)l();return o(),f}}const v0e={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function vm(t,e,n={}){const r=(i,s,o)=>{const a=v0e[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0||a(l,t)))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const vr=BigInt(0),nr=BigInt(1),hu=BigInt(2),x0e=BigInt(3),P2=BigInt(4),UO=BigInt(5),HO=BigInt(8);BigInt(9),BigInt(16);function qr(t,e){const n=t%e;return n>=vr?n:e+n}function S0e(t,e,n){if(n<=vr||e<vr)throw new Error("Expected power/modulo > 0");if(n===nr)return vr;let r=nr;for(;e>vr;)e&nr&&(r=r*t%n),t=t*t%n,e>>=nr;return r}function xs(t,e,n){let r=t;for(;e-- >vr;)r*=r,r%=n;return r}function qS(t,e){if(t===vr||e<=vr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=qr(t,e),r=e,i=vr,s=nr;for(;n!==vr;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==nr)throw new Error("invert: does not exist");return qr(i,e)}function k0e(t){if(t%P2===x0e){const e=(t+nr)/P2;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%HO===UO){const e=(t-UO)/HO;return function(n,r){const i=n.mul(r,hu),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,hu),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return(function(e){const n=(e-nr)/hu;let r,i,s;for(r=e-nr,i=0;r%hu===vr;r/=hu,i++);for(s=hu;s<e&&S0e(s,n,e)!==e-nr;s++);if(i===1){const a=(e+nr)/P2;return function(l,c){const u=l.pow(c,a);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const o=(r+nr)/hu;return function(a,l){if(a.pow(l,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,u=a.pow(a.mul(a.ONE,s),r),d=a.pow(l,o),f=a.pow(l,r);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let m=a.sqr(f);h<c&&!a.eql(m,a.ONE);h++)m=a.sqr(m);const p=a.pow(u,nr<<BigInt(c-h-1));u=a.sqr(p),d=a.mul(d,p),f=a.mul(f,u),c=h}return d}})(t)}const E0e=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function zB(t,e){const n=e!==void 0?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function UB(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function VO(t){const e=UB(t);return e+Math.ceil(e/2)}class HB extends LB{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,u0e(e);const r=gC(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return bb(this),this.iHash.update(e),this}digestInto(e){bb(this),RB(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const VB=(t,e,n)=>new HB(t,e).update(n).digest();VB.create=(t,e)=>new HB(t,e);const T0e=BigInt(0),I2=BigInt(1);function WB(t){return vm(t.Fp,E0e.reduce(((e,n)=>(e[n]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),vm(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...zB(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:C0e,aT:_0e}=VS,Lu={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=Lu;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(r[0]===0&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:C0e(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Lu,n=typeof t=="string"?_0e(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=Lu._parseInt(n.subarray(2)),{d:o,l:a}=Lu._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>8&Number.parseInt(c[0],16)?"00"+c:c,n=c=>{const u=c.toString(16);return 1&u.length?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Va=BigInt(0),Cs=BigInt(1),WO=(BigInt(2),BigInt(3));BigInt(4);function A0e(t){const e=(function(p){const m=WB(p);vm(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:g,Fp:y,a:b}=m;if(g){if(!y.eql(b,y.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof g!="object"||typeof g.beta!="bigint"||typeof g.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})})(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return fd(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1);return{x:n.fromBytes(m.subarray(0,n.BYTES)),y:n.fromBytes(m.subarray(n.BYTES,2*n.BYTES))}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Va<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Qf(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(2*g,"0")}let x;try{x=typeof p=="bigint"?p:Ki(di("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(x=qr(x,b)),a(x),x}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=x=>n.eql(x,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map((y=>y.pz)));return m.map(((y,b)=>y.toAffine(g[b]))).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(di("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:x,py:C,pz:P}=m,S=n.eql(n.mul(g,P),n.mul(x,b)),_=n.eql(n.mul(y,P),n.mul(C,b));return S&&_}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,WO),{px:b,py:x,pz:C}=this;let P=n.ZERO,S=n.ZERO,_=n.ZERO,k=n.mul(b,b),T=n.mul(x,x),O=n.mul(C,C),M=n.mul(b,x);return M=n.add(M,M),_=n.mul(b,C),_=n.add(_,_),P=n.mul(m,_),S=n.mul(y,O),S=n.add(P,S),P=n.sub(T,S),S=n.add(T,S),S=n.mul(P,S),P=n.mul(M,P),_=n.mul(y,_),O=n.mul(m,O),M=n.sub(k,O),M=n.mul(m,M),M=n.add(M,_),_=n.add(k,k),k=n.add(_,k),k=n.add(k,O),k=n.mul(k,M),S=n.add(S,k),O=n.mul(x,C),O=n.add(O,O),k=n.mul(O,M),P=n.sub(P,k),_=n.mul(O,T),_=n.add(_,_),_=n.add(_,_),new d(P,S,_)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:x,py:C,pz:P}=m;let S=n.ZERO,_=n.ZERO,k=n.ZERO;const T=e.a,O=n.mul(e.b,WO);let M=n.mul(g,x),L=n.mul(y,C),F=n.mul(b,P),B=n.add(g,y),R=n.add(x,C);B=n.mul(B,R),R=n.add(M,L),B=n.sub(B,R),R=n.add(g,b);let A=n.add(x,P);return R=n.mul(R,A),A=n.add(M,F),R=n.sub(R,A),A=n.add(y,b),S=n.add(C,P),A=n.mul(A,S),S=n.add(L,F),A=n.sub(A,S),k=n.mul(T,R),S=n.mul(O,F),k=n.add(S,k),S=n.sub(L,k),k=n.add(L,k),_=n.mul(S,k),L=n.add(M,M),L=n.add(L,M),F=n.mul(T,F),R=n.mul(O,R),L=n.add(L,F),F=n.sub(M,F),F=n.mul(T,F),R=n.add(R,F),M=n.mul(L,R),_=n.add(_,M),M=n.mul(A,R),S=n.mul(B,S),S=n.sub(S,M),M=n.mul(B,L),k=n.mul(A,k),k=n.add(k,M),new d(S,_,k)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,(g=>{const y=n.invertBatch(g.map((b=>b.pz)));return g.map(((b,x)=>b.toAffine(y[x]))).map(d.fromAffine)}))}multiplyUnsafe(m){const g=d.ZERO;if(m===Va)return g;if(a(m),m===Cs)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:x,k2neg:C,k2:P}=y.splitScalar(m),S=g,_=g,k=this;for(;x>Va||P>Va;)x&Cs&&(S=S.add(k)),P&Cs&&(_=_.add(k)),k=k.double(),x>>=Cs,P>>=Cs;return b&&(S=S.negate()),C&&(_=_.negate()),_=new d(n.mul(_.px,y.beta),_.py,_.pz),S.add(_)}multiply(m){a(m);let g,y,b=m;const{endo:x}=e;if(x){const{k1neg:C,k1:P,k2neg:S,k2:_}=x.splitScalar(b);let{p:k,f:T}=this.wNAF(P),{p:O,f:M}=this.wNAF(_);k=h.constTimeNegate(C,k),O=h.constTimeNegate(S,O),O=new d(n.mul(O.px,x.beta),O.py,O.pz),g=k.add(O),y=T.add(M)}else{const{p:C,f:P}=this.wNAF(b);g=C,y=P}return d.normalizeZ([g,y])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,x=(P,S)=>S!==Va&&S!==Cs&&P.equals(b)?P.multiply(S):P.multiplyUnsafe(S),C=x(this,g).add(x(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,x=this.is0();m==null&&(m=x?n.ONE:n.inv(b));const C=n.mul(g,m),P=n.mul(y,m),S=n.mul(b,m);if(x)return{x:n.ZERO,y:n.ZERO};if(!n.eql(S,n.ONE))throw new Error("invZ was invalid");return{x:C,y:P}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===Cs)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===Cs?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return Qf(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=(function(p,m){const g=(b,x)=>{const C=x.negate();return b?C:x},y=b=>({windows:Math.ceil(m/b)+1,windowSize:2**(b-1)});return{constTimeNegate:g,unsafeLadder(b,x){let C=p.ZERO,P=b;for(;x>T0e;)x&I2&&(C=C.add(P)),P=P.double(),x>>=I2;return C},precomputeWindow(b,x){const{windows:C,windowSize:P}=y(x),S=[];let _=b,k=_;for(let T=0;T<C;T++){k=_,S.push(k);for(let O=1;O<P;O++)k=k.add(_),S.push(k);_=k.double()}return S},wNAF(b,x,C){const{windows:P,windowSize:S}=y(b);let _=p.ZERO,k=p.BASE;const T=BigInt(2**b-1),O=2**b,M=BigInt(b);for(let L=0;L<P;L++){const F=L*S;let B=Number(C&T);C>>=M,B>S&&(B-=O,C+=I2);const R=F,A=F+Math.abs(B)-1,N=L%2!=0,z=B<0;B===0?k=k.add(g(N,x[R])):_=_.add(g(z,x[A]))}return{p:_,f:k}},wNAFCached(b,x,C,P){const S=b._WINDOW_SIZE||1;let _=x.get(b);return _||(_=this.precomputeWindow(b,S),S!==1&&x.set(b,P(_))),this.wNAF(S,_,C)}}})(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function P0e(t){const e=(function(T){const O=WB(T);return vm(O,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...O})})(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(T){return qr(T,r)}function a(T){return qS(T,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:d}=A0e({...e,toBytes(T,O,M){const L=O.toAffine(),F=n.toBytes(L.x),B=fd;return M?B(Uint8Array.from([O.hasEvenY()?2:3]),F):B(Uint8Array.from([4]),F,n.toBytes(L.y))},fromBytes(T){const O=T.length,M=T[0],L=T.subarray(1);if(O!==i||M!==2&&M!==3){if(O===s&&M===4)return{x:n.fromBytes(L.subarray(0,n.BYTES)),y:n.fromBytes(L.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${O} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const B=Ki(L);if(!(Va<(F=B)&&F<n.ORDER))throw new Error("Point is not on curve");const R=u(B);let A=n.sqrt(R);return!(1&~M)!=((A&Cs)===Cs)&&(A=n.neg(A)),{x:B,y:A}}var F}}),f=T=>Qf(Oc(T,e.nByteLength));function h(T){return T>r>>Cs}const p=(T,O,M)=>Ki(T.slice(O,M));class m{constructor(O,M,L){this.r=O,this.s=M,this.recovery=L,this.assertValidity()}static fromCompact(O){const M=e.nByteLength;return O=di("compactSignature",O,2*M),new m(p(O,0,M),p(O,M,2*M))}static fromDER(O){const{r:M,s:L}=Lu.toSig(di("DER",O));return new m(M,L)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(O){return new m(this.r,this.s,O)}recoverPublicKey(O){const{r:M,s:L,recovery:F}=this,B=x(di("msgHash",O));if(F==null||![0,1,2,3].includes(F))throw new Error("recovery id invalid");const R=F===2||F===3?M+e.n:M;if(R>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const A=1&F?"03":"02",N=l.fromHex(A+f(R)),z=a(R),U=o(-B*z),V=o(L*z),q=l.BASE.multiplyAndAddUnsafe(N,U,V);if(!q)throw new Error("point at infinify");return q.assertValidity(),q}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return wm(this.toDERHex())}toDERHex(){return Lu.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return wm(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}const g={isValidPrivateKey(T){try{return c(T),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const T=VO(e.n);return(function(O,M,L=!1){const F=O.length,B=UB(M),R=VO(M);if(F<16||F<R||F>1024)throw new Error(`expected ${R}-1024 bytes of input, got ${F}`);const A=qr(L?Ki(O):yC(O),M-nr)+nr;return L?bC(A,B):Oc(A,B)})(e.randomBytes(T),e.n)},precompute:(T=8,O=l.BASE)=>(O._setWindowSize(T),O.multiply(BigInt(3)),O)};function y(T){const O=T instanceof Uint8Array,M=typeof T=="string",L=(O||M)&&T.length;return O?L===i||L===s:M?L===2*i||L===2*s:T instanceof l}const b=e.bits2int||function(T){const O=Ki(T),M=8*T.length-e.nBitLength;return M>0?O>>BigInt(M):O},x=e.bits2int_modN||function(T){return o(b(T))},C=wC(e.nBitLength);function P(T){if(typeof T!="bigint")throw new Error("bigint expected");if(!(Va<=T&&T<C))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Oc(T,e.nByteLength)}function S(T,O,M=_){if(["recovered","canonical"].some((G=>G in M)))throw new Error("sign() legacy options not supported");const{hash:L,randomBytes:F}=e;let{lowS:B,prehash:R,extraEntropy:A}=M;B==null&&(B=!0),T=di("msgHash",T),R&&(T=di("prehashed msgHash",L(T)));const N=x(T),z=c(O),U=[P(z),P(N)];if(A!=null){const G=A===!0?F(n.BYTES):A;U.push(di("extraEntropy",G))}const V=fd(...U),q=N;return{seed:V,k2sig:function(G){const ne=b(G);if(!d(ne))return;const te=a(ne),Z=l.BASE.multiply(ne).toAffine(),ae=o(Z.x);if(ae===Va)return;const _e=o(te*o(q+ae*z));if(_e===Va)return;let de=(Z.x===ae?0:2)|Number(Z.y&Cs),Ee=_e;return B&&h(_e)&&(Ee=(function(Re){return h(Re)?o(-Re):Re})(_e),de^=1),new m(ae,Ee,de)}}}const _={lowS:e.lowS,prehash:!1},k={lowS:e.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(T,O=!0){return l.fromPrivateKey(T).toRawBytes(O)},getSharedSecret:function(T,O,M=!0){if(y(T))throw new Error("first arg must be private key");if(!y(O))throw new Error("second arg must be public key");return l.fromHex(O).multiply(c(T)).toRawBytes(M)},sign:function(T,O,M=_){const{seed:L,k2sig:F}=S(T,O,M),B=e;return $B(B.hash.outputLen,B.nByteLength,B.hmac)(L,F)},verify:function(T,O,M,L=k){const F=T;if(O=di("msgHash",O),M=di("publicKey",M),"strict"in L)throw new Error("options.strict was renamed to lowS");const{lowS:B,prehash:R}=L;let A,N;try{if(typeof F=="string"||F instanceof Uint8Array)try{A=m.fromDER(F)}catch(Z){if(!(Z instanceof Lu.Err))throw Z;A=m.fromCompact(F)}else{if(typeof F!="object"||typeof F.r!="bigint"||typeof F.s!="bigint")throw new Error("PARSE");{const{r:Z,s:ae}=F;A=new m(Z,ae)}}N=l.fromHex(M)}catch(Z){if(Z.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(B&&A.hasHighS())return!1;R&&(O=e.hash(O));const{r:z,s:U}=A,V=x(O),q=a(U),G=o(V*q),ne=o(z*q),te=l.BASE.multiplyAndAddUnsafe(N,G,ne)?.toAffine();return!!te&&o(te.x)===z},ProjectivePoint:l,Signature:m,utils:g}}function I0e(t){return{hash:t,hmac:(e,...n)=>VB(t,e,(function(...r){const i=new Uint8Array(r.reduce(((o,a)=>o+a.length),0));let s=0;return r.forEach((o=>{if(!DB(o))throw new Error("Uint8Array expected");i.set(o,s),s+=o.length})),i})(...n)),randomBytes:BB}}const Rw=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),wb=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),jB=BigInt(1),vb=BigInt(2),jO=(t,e)=>(t+e/vb)/e;function qB(t){const e=Rw,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=xs(u,n,e)*u%e,f=xs(d,n,e)*u%e,h=xs(f,vb,e)*c%e,p=xs(h,i,e)*h%e,m=xs(p,s,e)*p%e,g=xs(m,a,e)*m%e,y=xs(g,l,e)*g%e,b=xs(y,a,e)*m%e,x=xs(b,n,e)*u%e,C=xs(x,o,e)*p%e,P=xs(C,r,e)*c%e,S=xs(P,vb,e);if(!KS.eql(KS.sqr(S),t))throw new Error("Cannot find square root");return S}const KS=(function(t,e,n=!1,r={}){if(t<=vr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=zB(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=k0e(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:wC(i),ZERO:vr,ONE:nr,create:l=>qr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("Invalid field element: expected bigint, got "+typeof l);return vr<=l&&l<t},is0:l=>l===vr,isOdd:l=>(l&nr)===nr,neg:l=>qr(-l,t),eql:(l,c)=>l===c,sqr:l=>qr(l*l,t),add:(l,c)=>qr(l+c,t),sub:(l,c)=>qr(l-c,t),mul:(l,c)=>qr(l*c,t),pow:(l,c)=>(function(u,d,f){if(f<vr)throw new Error("Expected power > 0");if(f===vr)return u.ONE;if(f===nr)return d;let h=u.ONE,p=d;for(;f>vr;)f&nr&&(h=u.mul(h,p)),p=u.sqr(p),f>>=nr;return h})(a,l,c),div:(l,c)=>qr(l*qS(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>qS(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>(function(c,u){const d=new Array(u.length),f=u.reduce(((p,m,g)=>c.is0(m)?p:(d[g]=p,c.mul(p,m))),c.ONE),h=c.inv(f);return u.reduceRight(((p,m,g)=>c.is0(m)?p:(d[g]=c.mul(p,d[g]),c.mul(p,m))),h),d})(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?bC(l,s):Oc(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?yC(l):Ki(l)}});return Object.freeze(a)})(Rw,void 0,void 0,{sqrt:qB}),hh=(function(t,e){const n=r=>P0e({...t,...I0e(r)});return Object.freeze({...n(e),create:n})})({a:BigInt(0),b:BigInt(7),Fp:KS,n:wb,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=wb,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-jB*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=jO(s*t,e),l=jO(-r*t,e);let c=qr(t-a*n-l*i,e),u=qr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},jS),Dw=BigInt(0),KB=t=>typeof t=="bigint"&&Dw<t&&t<Rw,qO={};function xb(t,...e){let n=qO[t];if(n===void 0){const r=jS(Uint8Array.from(t,(i=>i.charCodeAt(0))));n=fd(r,r),qO[t]=n}return jS(fd(n,...e))}const vC=t=>t.toRawBytes(!0).slice(1),GS=t=>Oc(t,32),O2=t=>qr(t,Rw),xm=t=>qr(t,wb),xC=hh.ProjectivePoint;function ZS(t){let e=hh.utils.normPrivateKeyToScalar(t),n=xC.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:xm(-e),bytes:vC(n)}}function GB(t){if(!KB(t))throw new Error("bad x: need 0 < x < p");const e=O2(t*t);let n=qB(O2(e*t+BigInt(7)));n%vb!==Dw&&(n=O2(-n));const r=new xC(t,n,jB);return r.assertValidity(),r}function ZB(...t){return xm(Ki(xb("BIP0340/challenge",...t)))}function O0e(t){return ZS(t).bytes}function M0e(t,e,n=BB(32)){const r=di("message",t),{bytes:i,scalar:s}=ZS(e),o=di("auxRand",n,32),a=GS(s^Ki(xb("BIP0340/aux",o))),l=xb("BIP0340/nonce",a,i,r),c=xm(Ki(l));if(c===Dw)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=ZS(c),f=ZB(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(GS(xm(d+f*s)),32),!XB(h,r,i))throw new Error("sign: Invalid signature produced");return h}function XB(t,e,n){const r=di("signature",t,64),i=di("message",e),s=di("publicKey",n,32);try{const u=GB(Ki(s)),d=Ki(r.subarray(0,32));if(!KB(d))return!1;const f=Ki(r.subarray(32,64));if(!(typeof(c=f)=="bigint"&&Dw<c&&c<wb))return!1;const h=ZB(GS(d),vC(u),i),p=(o=u,a=f,l=xm(-h),xC.BASE.multiplyAndAddUnsafe(o,a,l));return!(!p||!p.hasEvenY()||p.toAffine().x!==d)}catch{return!1}var o,a,l,c}const Do={getPublicKey:O0e,sign:M0e,verify:XB,utils:{randomPrivateKey:hh.utils.randomPrivateKey,lift_x:GB,pointToBytes:vC,numberToBytesBE:Oc,bytesToNumberBE:Ki,taggedHash:xb,mod:qr}},M2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,SC=t=>t instanceof Uint8Array,N2=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Co=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");const N0e=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function pr(t){if(!SC(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=N0e[t[n]];return e}function Yf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Sm(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!SC(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function Lw(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!SC(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}class QB{clone(){return this._cloneInto()}}function YB(t){const e=r=>t().update(Sm(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function JB(t=32){if(M2&&typeof M2.getRandomValues=="function")return M2.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function R2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function KO(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const R0e={number:R2,bool:function(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)},bytes:KO,hash:function(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");R2(t.outputLen),R2(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){KO(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},Wo=R0e;class D0e extends QB{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=N2(this.buffer)}update(e){Wo.exists(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=Sm(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=N2(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Wo.exists(this),Wo.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;(function(d,f,h,p){if(typeof d.setBigUint64=="function")return d.setBigUint64(f,h,p);const m=BigInt(32),g=BigInt(4294967295),y=Number(h>>m&g),b=Number(h&g),x=p?4:0,C=p?0:4;d.setUint32(f+x,y,p),d.setUint32(f+C,b,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=N2(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const L0e=(t,e,n)=>t&e^t&n^e&n,B0e=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Kl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Gl=new Uint32Array(64);class eF extends D0e{constructor(){super(64,32,8,!1),this.A=0|Kl[0],this.B=0|Kl[1],this.C=0|Kl[2],this.D=0|Kl[3],this.E=0|Kl[4],this.F=0|Kl[5],this.G=0|Kl[6],this.H=0|Kl[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let f=0;f<16;f++,n+=4)Gl[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Gl[f-15],p=Gl[f-2],m=Co(h,7)^Co(h,18)^h>>>3,g=Co(p,17)^Co(p,19)^p>>>10;Gl[f]=g+Gl[f-7]+m+Gl[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=u+(Co(a,6)^Co(a,11)^Co(a,25))+((d=a)&l^~d&c)+B0e[f]+Gl[f]|0,p=(Co(r,2)^Co(r,13)^Co(r,22))+L0e(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var d;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Gl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class F0e extends eF{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const vd=YB((()=>new eF));YB((()=>new F0e));function ph(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function nl(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce(((i,s)=>i?e(i,s.encode):s.encode),void 0),r=t.reduce(((i,s)=>i?e(i,s.decode):s.decode),void 0);return{encode:n,decode:r}}function rl(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map((n=>{if(ph(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]}))},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map((n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r}))}}}function il(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function Sb(t,e="="){if(ph(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function tF(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function GO(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((o=>{if(ph(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)}));;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!=e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");a&&(s[l]?a=!1:r=l)}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const nF=(t,e)=>e?nF(e,t%e):t,kb=(t,e)=>t+(e-nF(t,e));function XS(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(kb(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${kb(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(ph(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function $0e(t){return ph(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return GO(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(GO(e,t,256))}}}function Mc(t,e=!1){if(ph(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(kb(8,t)>32||kb(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return XS(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(XS(n,t,8,e))}}}function ZO(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}nl(Mc(4),rl("0123456789ABCDEF"),il(""));nl(Mc(5),rl("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Sb(5),il(""));const Wc=(nl(Mc(5),rl("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Sb(5),il("")),nl(Mc(5),rl("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),il(""),tF((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),nl(Mc(6),rl("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Sb(6),il("")));nl(Mc(6),rl("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Sb(6),il(""));const QS=t=>nl($0e(58),rl(t),il(""));QS("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");QS("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),QS("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const YS=nl(rl("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),il("")),XO=[996825010,642813549,513874426,1027748829,705979059];function Yh(t){const e=t>>25;let n=(33554431&t)<<5;for(let r=0;r<XO.length;r++)(e>>r&1)==1&&(n^=XO[r]);return n}function QO(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Yh(i)^o>>5}i=Yh(i);for(let s=0;s<r;s++)i=Yh(i)^31&t.charCodeAt(s);for(let s of e)i=Yh(i)^s;for(let s=0;s<6;s++)i=Yh(i);return i^=n,YS.encode(XS([i%2**30],30,5,!1))}function rF(t){const e=t==="bech32"?1:734539939,n=Mc(5),r=n.decode,i=n.encode,s=ZO(r);function o(a,l=90){if(typeof a!="string")throw new Error("bech32.decode input should be string, not "+typeof a);if(a.length<8||l!==!1&&a.length>l)throw new TypeError(`Wrong string length: ${a.length} (${a}). Expected (8..${l})`);const c=a.toLowerCase();if(a!==c&&a!==a.toUpperCase())throw new Error("String must be lowercase or uppercase");const u=(a=c).lastIndexOf("1");if(u===0||u===-1)throw new Error('Letter "1" must be present between prefix and data only');const d=a.slice(0,u),f=a.slice(u+1);if(f.length<6)throw new Error("Data must be at least 6 characters long");const h=YS.decode(f).slice(0,-6),p=QO(d,h,e);if(!f.endsWith(p))throw new Error(`Invalid checksum in ${a}: expected "${p}"`);return{prefix:d,words:h}}return{encode:function(a,l,c=90){if(typeof a!="string")throw new Error("bech32.encode prefix should be string, not "+typeof a);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof l);const u=a.length+7+l.length;if(c!==!1&&u>c)throw new TypeError(`Length ${u} exceeds limit ${c}`);return`${a=a.toLowerCase()}1${YS.encode(l)}${QO(a,l,e)}`},decode:o,decodeToBytes:function(a){const{prefix:l,words:c}=o(a,!1);return{prefix:l,words:c,bytes:r(c)}},decodeUnsafe:ZO(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const Jf=rF("bech32");rF("bech32m");nl(Mc(4),rl("0123456789abcdef"),il(""),tF((t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));function D2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function YO(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function iF(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function xn(t,...e){if(!iF(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function eh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function kC(t,e){xn(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const EC=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),Ht=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Bw=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function jc(t){if(typeof t=="string")t=(function(e){if(typeof e!="string")throw new Error("string expected, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t);else{if(!iF(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function TC(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const mh=(t,e)=>(Object.assign(e,t),e);function JS(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const Ba=16,CC=new Uint8Array(16),Lo=Ht(CC),_s=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class sF{constructor(e,n){this.blockLen=Ba,this.outputLen=Ba,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,xn(e=jc(e),16);const r=Bw(e);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const l=[];for(let y=0;y<128;y++)l.push({s0:_s(i),s1:_s(s),s2:_s(o),s3:_s(a)}),{s0:i,s1:s,s2:o,s3:a}={s3:(d=o)<<31|(f=a)>>>1,s2:(u=s)<<31|d>>>1,s1:(c=i)<<31|u>>>1,s0:c>>>1^225<<24&-(1&f)};var c,u,d,f;const h=(y=>y>65536?8:y>1024?4:2)(n||1024);if(![1,2,4,8].includes(h))throw new Error(`ghash: wrong window size=${h}, should be 2, 4 or 8`);this.W=h;const p=128/h,m=this.windowSize=2**h,g=[];for(let y=0;y<p;y++)for(let b=0;b<m;b++){let x=0,C=0,P=0,S=0;for(let _=0;_<h;_++){if(!(b>>>h-_-1&1))continue;const{s0:k,s1:T,s2:O,s3:M}=l[h*y+_];x^=k,C^=T,P^=O,S^=M}g.push({s0:x,s1:C,s2:P,s3:S})}this.t=g}_updateBlock(e,n,r,i){e^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let l=0,c=0,u=0,d=0;const f=(1<<s)-1;let h=0;for(const p of[e,n,r,i])for(let m=0;m<4;m++){const g=p>>>8*m&255;for(let y=8/s-1;y>=0;y--){const b=g>>>s*y&f,{s0:x,s1:C,s2:P,s3:S}=o[h*a+b];l^=x,c^=C,u^=P,d^=S,h+=1}}this.s0=l,this.s1=c,this.s2=u,this.s3=d}update(e){e=jc(e),eh(this);const n=Ht(e),r=Math.floor(e.length/Ba),i=e.length%Ba;for(let s=0;s<r;s++)this._updateBlock(n[4*s+0],n[4*s+1],n[4*s+2],n[4*s+3]);return i&&(CC.set(e.subarray(r*Ba)),this._updateBlock(Lo[0],Lo[1],Lo[2],Lo[3]),Lo.fill(0)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){eh(this),kC(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Ht(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e}digest(){const e=new Uint8Array(Ba);return this.digestInto(e),this.destroy(),e}}class z0e extends sF{constructor(e,n){const r=(function(i){i.reverse();const s=1&i[15];let o=0;for(let a=0;a<i.length;a++){const l=i[a];i[a]=l>>>1|o,o=(1&l)<<7}return i[0]^=225&-s,i})((e=jc(e)).slice());super(r,n),r.fill(0)}update(e){e=jc(e),eh(this);const n=Ht(e),r=e.length%Ba,i=Math.floor(e.length/Ba);for(let s=0;s<i;s++)this._updateBlock(_s(n[4*s+3]),_s(n[4*s+2]),_s(n[4*s+1]),_s(n[4*s+0]));return r&&(CC.set(e.subarray(i*Ba)),this._updateBlock(_s(Lo[3]),_s(Lo[2]),_s(Lo[1]),_s(Lo[0])),Lo.fill(0)),this}digestInto(e){eh(this),kC(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Ht(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e.reverse()}}function oF(t){const e=(r,i)=>t(i,r.length).update(jc(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,i)=>t(r,i),e}const JO=oF(((t,e)=>new sF(t,e))),U0e=oF(((t,e)=>new z0e(t,e))),Qi=16,Yg=new Uint8Array(Qi);function _C(t){return t<<1^283&-(t>>7)}function lf(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=_C(t);return n}const ek=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=_C(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),H0e=ek.map(((t,e)=>ek.indexOf(e))),L2=t=>t<<8|t>>>24;function aF(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((c,u)=>e(t[u]))),r=n.map(L2),i=r.map(L2),s=i.map(L2),o=new Uint32Array(65536),a=new Uint32Array(65536),l=new Uint16Array(65536);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const d=256*c+u;o[d]=n[c]^r[u],a[d]=i[c]^s[u],l[d]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const AC=aF(ek,(t=>lf(t,3)<<24|t<<16|t<<8|lf(t,2))),lF=aF(H0e,(t=>lf(t,11)<<24|lf(t,13)<<16|lf(t,9)<<8|lf(t,14))),V0e=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=_C(n))t[e]=n;return t})();function qc(t){xn(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=AC,r=Ht(t),i=r.length,s=l=>jo(n,l,l,l,l),o=new Uint32Array(e+28);o.set(r);for(let l=i;l<o.length;l++){let c=o[l-1];l%i==0?c=s((a=c)<<24|a>>>8)^V0e[l/i-1]:i>6&&l%i==4&&(c=s(c)),o[l]=o[l-i]^c}var a;return o}function cF(t){const e=qc(t),n=e.slice(),r=e.length,{sbox2:i}=AC,{T0:s,T1:o,T2:a,T3:l}=lF;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],d=jo(i,u,u,u,u);n[c]=s[255&d]^o[d>>>8&255]^a[d>>>16&255]^l[d>>>24]}return n}function yc(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function jo(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function Us(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=AC;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const d=t[l++]^yc(o,a,e,n,r,i),f=t[l++]^yc(o,a,n,r,i,e),h=t[l++]^yc(o,a,r,i,e,n),p=t[l++]^yc(o,a,i,e,n,r);e=d,n=f,r=h,i=p}return{s0:t[l++]^jo(s,e,n,r,i),s1:t[l++]^jo(s,n,r,i,e),s2:t[l++]^jo(s,r,i,e,n),s3:t[l++]^jo(s,i,e,n,r)}}function uF(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=lF;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const d=t[l++]^yc(o,a,e,i,r,n),f=t[l++]^yc(o,a,n,e,i,r),h=t[l++]^yc(o,a,r,n,e,i),p=t[l++]^yc(o,a,i,r,n,e);e=d,n=f,r=h,i=p}return{s0:t[l++]^jo(s,e,i,r,n),s1:t[l++]^jo(s,n,e,i,r),s2:t[l++]^jo(s,r,n,e,i),s3:t[l++]^jo(s,i,r,n,e)}}function gh(t,e){if(!e)return new Uint8Array(t);if(xn(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function W0e(t,e,n,r){xn(e,Qi),xn(n);const i=n.length;r=gh(i,r);const s=e,o=Ht(s);let{s0:a,s1:l,s2:c,s3:u}=Us(t,o[0],o[1],o[2],o[3]);const d=Ht(n),f=Ht(r);for(let p=0;p+4<=d.length;p+=4){f[p+0]=d[p+0]^a,f[p+1]=d[p+1]^l,f[p+2]=d[p+2]^c,f[p+3]=d[p+3]^u;let m=1;for(let g=s.length-1;g>=0;g--)m=m+(255&s[g])|0,s[g]=255&m,m>>>=8;({s0:a,s1:l,s2:c,s3:u}=Us(t,o[0],o[1],o[2],o[3]))}const h=Qi*Math.floor(d.length/4);if(h<i){const p=new Uint32Array([a,l,c,u]),m=EC(p);for(let g=h,y=0;g<i;g++,y++)r[g]=n[g]^m[y]}return r}function fp(t,e,n,r,i){xn(n,Qi),xn(r),i=gh(r.length,i);const s=n,o=Ht(s),a=Bw(s),l=Ht(r),c=Ht(i),u=e?0:12,d=r.length;let f=a.getUint32(u,e),{s0:h,s1:p,s2:m,s3:g}=Us(t,o[0],o[1],o[2],o[3]);for(let b=0;b+4<=l.length;b+=4)c[b+0]=l[b+0]^h,c[b+1]=l[b+1]^p,c[b+2]=l[b+2]^m,c[b+3]=l[b+3]^g,f=f+1>>>0,a.setUint32(u,f,e),{s0:h,s1:p,s2:m,s3:g}=Us(t,o[0],o[1],o[2],o[3]);const y=Qi*Math.floor(l.length/4);if(y<d){const b=new Uint32Array([h,p,m,g]),x=EC(b);for(let C=y,P=0;C<d;C++,P++)i[C]=r[C]^x[P]}return i}mh({blockSize:16,nonceLength:16},(function(t,e){function n(r,i){const s=qc(t),o=e.slice(),a=W0e(s,o,r,i);return s.fill(0),o.fill(0),a}return xn(t),xn(e,Qi),{encrypt:(r,i)=>n(r,i),decrypt:(r,i)=>n(r,i)}}));function dF(t){if(xn(t),t.length%Qi!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function fF(t,e,n){let r=t.length;const i=r%Qi;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=Ht(t);if(e){let a=Qi-i;a||(a=Qi),r+=a}const o=gh(r,n);return{b:s,o:Ht(o),out:o}}function hF(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function pF(t){const e=new Uint8Array(16),n=Ht(e);e.set(t);const r=Qi-t.length;for(let i=Qi-r;i<Qi;i++)e[i]=r;return n}mh({blockSize:16},(function(t,e={}){xn(t);const n=!e.disablePadding;return{encrypt:(r,i)=>{xn(r);const{b:s,o,out:a}=fF(r,n,i),l=qc(t);let c=0;for(;c+4<=s.length;){const{s0:u,s1:d,s2:f,s3:h}=Us(l,s[c+0],s[c+1],s[c+2],s[c+3]);o[c++]=u,o[c++]=d,o[c++]=f,o[c++]=h}if(n){const u=pF(r.subarray(4*c)),{s0:d,s1:f,s2:h,s3:p}=Us(l,u[0],u[1],u[2],u[3]);o[c++]=d,o[c++]=f,o[c++]=h,o[c++]=p}return l.fill(0),a},decrypt:(r,i)=>{dF(r);const s=cF(t),o=gh(r.length,i),a=Ht(r),l=Ht(o);for(let c=0;c+4<=a.length;){const{s0:u,s1:d,s2:f,s3:h}=uF(s,a[c+0],a[c+1],a[c+2],a[c+3]);l[c++]=u,l[c++]=d,l[c++]=f,l[c++]=h}return s.fill(0),hF(o,n)}}}));const mF=mh({blockSize:16,nonceLength:16},(function(t,e,n={}){xn(t),xn(e,16);const r=!n.disablePadding;return{encrypt:(i,s)=>{const o=qc(t),{b:a,o:l,out:c}=fF(i,r,s),u=Ht(e);let d=u[0],f=u[1],h=u[2],p=u[3],m=0;for(;m+4<=a.length;)d^=a[m+0],f^=a[m+1],h^=a[m+2],p^=a[m+3],{s0:d,s1:f,s2:h,s3:p}=Us(o,d,f,h,p),l[m++]=d,l[m++]=f,l[m++]=h,l[m++]=p;if(r){const g=pF(i.subarray(4*m));d^=g[0],f^=g[1],h^=g[2],p^=g[3],{s0:d,s1:f,s2:h,s3:p}=Us(o,d,f,h,p),l[m++]=d,l[m++]=f,l[m++]=h,l[m++]=p}return o.fill(0),c},decrypt:(i,s)=>{dF(i);const o=cF(t),a=Ht(e),l=gh(i.length,s),c=Ht(i),u=Ht(l);let d=a[0],f=a[1],h=a[2],p=a[3];for(let m=0;m+4<=c.length;){const g=d,y=f,b=h,x=p;d=c[m+0],f=c[m+1],h=c[m+2],p=c[m+3];const{s0:C,s1:P,s2:S,s3:_}=uF(o,d,f,h,p);u[m++]=C^g,u[m++]=P^y,u[m++]=S^b,u[m++]=_^x}return o.fill(0),hF(l,r)}}}));mh({blockSize:16,nonceLength:16},(function(t,e){function n(r,i,s){const o=qc(t),a=r.length;s=gh(a,s);const l=Ht(r),c=Ht(s),u=i?c:l,d=Ht(e);let f=d[0],h=d[1],p=d[2],m=d[3];for(let y=0;y+4<=l.length;){const{s0:b,s1:x,s2:C,s3:P}=Us(o,f,h,p,m);c[y+0]=l[y+0]^b,c[y+1]=l[y+1]^x,c[y+2]=l[y+2]^C,c[y+3]=l[y+3]^P,f=u[y++],h=u[y++],p=u[y++],m=u[y++]}const g=Qi*Math.floor(l.length/4);if(g<a){({s0:f,s1:h,s2:p,s3:m}=Us(o,f,h,p,m));const y=EC(new Uint32Array([f,h,p,m]));for(let b=g,x=0;b<a;b++,x++)s[b]=r[b]^y[x];y.fill(0)}return o.fill(0),s}return xn(t),xn(e,16),{encrypt:(r,i)=>n(r,!0,i),decrypt:(r,i)=>n(r,!1,i)}}));function gF(t,e,n,r,i){const s=t.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=Bw(o);return i&&JS(a,0,BigInt(8*i.length),e),JS(a,8,BigInt(8*r.length),e),s.update(o),s.digest()}mh({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(xn(e),e.length===0)throw new Error("aes/gcm: empty nonce");const r=16;function i(o,a,l){const c=gF(JO,!1,o,l,n);for(let u=0;u<a.length;u++)c[u]^=a[u];return c}function s(){const o=qc(t),a=Yg.slice(),l=Yg.slice();if(fp(o,!1,l,l,a),e.length===12)l.set(e);else{const c=Yg.slice();JS(Bw(c),8,BigInt(8*e.length),!1),JO.create(a).update(e).update(c).digestInto(l)}return{xk:o,authKey:a,counter:l,tagMask:fp(o,!1,l,Yg)}}return{encrypt:o=>{xn(o);const{xk:a,authKey:l,counter:c,tagMask:u}=s(),d=new Uint8Array(o.length+r);fp(a,!1,c,o,d);const f=i(l,u,d.subarray(0,d.length-r));return d.set(f,o.length),a.fill(0),d},decrypt:o=>{if(xn(o),o.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:a,authKey:l,counter:c,tagMask:u}=s(),d=o.subarray(0,-16),f=o.subarray(-16);if(!TC(i(l,u,d),f))throw new Error("aes/gcm: invalid ghash tag");const h=fp(a,!1,c,d);return l.fill(0),u.fill(0),a.fill(0),h}}}));const Jg=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};mh({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=Jg("AAD",0,68719476736),i=Jg("plaintext",0,2**36),s=Jg("nonce",12,12),o=Jg("ciphertext",16,2**36+16);function a(){const u=t.length;if(u!==16&&u!==24&&u!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${u} bytes`);const d=qc(t),f=new Uint8Array(u),h=new Uint8Array(16),p=Ht(e);let m=0,g=p[0],y=p[1],b=p[2],x=0;for(const C of[h,f].map(Ht)){const P=Ht(C);for(let S=0;S<P.length;S+=2){const{s0:_,s1:k}=Us(d,m,g,y,b);P[S+0]=_,P[S+1]=k,m=++x}}return d.fill(0),{authKey:h,encKey:qc(f)}}function l(u,d,f){const h=gF(U0e,!0,d,f,n);for(let x=0;x<12;x++)h[x]^=e[x];h[15]&=127;const p=Ht(h);let m=p[0],g=p[1],y=p[2],b=p[3];return{s0:m,s1:g,s2:y,s3:b}=Us(u,m,g,y,b),p[0]=m,p[1]=g,p[2]=y,p[3]=b,h}function c(u,d,f){let h=d.slice();return h[15]|=128,fp(u,!0,h,f)}return xn(e),s(e.length),n&&(xn(n),r(n.length)),{encrypt:u=>{xn(u),i(u.length);const{encKey:d,authKey:f}=a(),h=l(d,f,u),p=new Uint8Array(u.length+16);return p.set(h,u.length),p.set(c(d,h,u)),d.fill(0),f.fill(0),p},decrypt:u=>{xn(u),o(u.length);const d=u.subarray(-16),{encKey:f,authKey:h}=a(),p=c(f,d,u.subarray(0,-16)),m=l(f,h,p);if(f.fill(0),h.fill(0),!TC(d,m))throw new Error("invalid polyval tag");return p}}}));const Lr=(t,e)=>255&t[e++]|(255&t[e++])<<8;class j0e{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,xn(e=jc(e),32);const n=Lr(e,0),r=Lr(e,2),i=Lr(e,4),s=Lr(e,6),o=Lr(e,8),a=Lr(e,10),l=Lr(e,12),c=Lr(e,14);this.r[0]=8191&n,this.r[1]=8191&(n>>>13|r<<3),this.r[2]=7939&(r>>>10|i<<6),this.r[3]=8191&(i>>>7|s<<9),this.r[4]=255&(s>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|a<<2),this.r[7]=8065&(a>>>11|l<<5),this.r[8]=8191&(l>>>8|c<<8),this.r[9]=c>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Lr(e,16+2*u)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],l=o[1],c=o[2],u=o[3],d=o[4],f=o[5],h=o[6],p=o[7],m=o[8],g=o[9],y=Lr(e,n+0),b=Lr(e,n+2),x=Lr(e,n+4),C=Lr(e,n+6),P=Lr(e,n+8),S=Lr(e,n+10),_=Lr(e,n+12),k=Lr(e,n+14);let T=s[0]+(8191&y),O=s[1]+(8191&(y>>>13|b<<3)),M=s[2]+(8191&(b>>>10|x<<6)),L=s[3]+(8191&(x>>>7|C<<9)),F=s[4]+(8191&(C>>>4|P<<12)),B=s[5]+(P>>>1&8191),R=s[6]+(8191&(P>>>14|S<<2)),A=s[7]+(8191&(S>>>11|_<<5)),N=s[8]+(8191&(_>>>8|k<<8)),z=s[9]+(k>>>5|i),U=0,V=U+T*a+O*(5*g)+M*(5*m)+L*(5*p)+F*(5*h);U=V>>>13,V&=8191,V+=B*(5*f)+R*(5*d)+A*(5*u)+N*(5*c)+z*(5*l),U+=V>>>13,V&=8191;let q=U+T*l+O*a+M*(5*g)+L*(5*m)+F*(5*p);U=q>>>13,q&=8191,q+=B*(5*h)+R*(5*f)+A*(5*d)+N*(5*u)+z*(5*c),U+=q>>>13,q&=8191;let G=U+T*c+O*l+M*a+L*(5*g)+F*(5*m);U=G>>>13,G&=8191,G+=B*(5*p)+R*(5*h)+A*(5*f)+N*(5*d)+z*(5*u),U+=G>>>13,G&=8191;let ne=U+T*u+O*c+M*l+L*a+F*(5*g);U=ne>>>13,ne&=8191,ne+=B*(5*m)+R*(5*p)+A*(5*h)+N*(5*f)+z*(5*d),U+=ne>>>13,ne&=8191;let te=U+T*d+O*u+M*c+L*l+F*a;U=te>>>13,te&=8191,te+=B*(5*g)+R*(5*m)+A*(5*p)+N*(5*h)+z*(5*f),U+=te>>>13,te&=8191;let Z=U+T*f+O*d+M*u+L*c+F*l;U=Z>>>13,Z&=8191,Z+=B*a+R*(5*g)+A*(5*m)+N*(5*p)+z*(5*h),U+=Z>>>13,Z&=8191;let ae=U+T*h+O*f+M*d+L*u+F*c;U=ae>>>13,ae&=8191,ae+=B*l+R*a+A*(5*g)+N*(5*m)+z*(5*p),U+=ae>>>13,ae&=8191;let _e=U+T*p+O*h+M*f+L*d+F*u;U=_e>>>13,_e&=8191,_e+=B*c+R*l+A*a+N*(5*g)+z*(5*m),U+=_e>>>13,_e&=8191;let de=U+T*m+O*p+M*h+L*f+F*d;U=de>>>13,de&=8191,de+=B*u+R*c+A*l+N*a+z*(5*g),U+=de>>>13,de&=8191;let Ee=U+T*g+O*m+M*p+L*h+F*f;U=Ee>>>13,Ee&=8191,Ee+=B*d+R*u+A*c+N*l+z*a,U+=Ee>>>13,Ee&=8191,U=(U<<2)+U|0,U=U+V|0,V=8191&U,U>>>=13,q+=U,s[0]=V,s[1]=q,s[2]=G,s[3]=ne,s[4]=te,s[5]=Z,s[6]=ae,s[7]=_e,s[8]=de,s[9]=Ee}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(1^i)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+n[0];e[0]=65535&o;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=65535&o}update(e){eh(this);const{buffer:n,blockLen:r}=this,i=(e=jc(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0);else for(;r<=i-s;s+=r)this.process(e,s)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){eh(this),kC(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}(function(t){const e=(r,i)=>t(i).update(jc(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e})((t=>new j0e(t)));const yF=t=>Uint8Array.from(t.split("").map((e=>e.charCodeAt(0)))),q0e=yF("expand 16-byte k"),K0e=yF("expand 32-byte k"),G0e=Ht(q0e),bF=Ht(K0e);bF.slice();function lt(t,e){return t<<e|t>>>32-e}function B2(t){return t.byteOffset%4==0}const e4=2**32-1,t4=new Uint32Array;function wF(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=(function(a,l){if(l==null||typeof l!="object")throw new Error("options must be defined");return Object.assign(a,l)})({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return D2(i),D2(o),YO(s),YO(n),(a,l,c,u,d=0)=>{xn(a),xn(l),xn(c);const f=c.length;if(u||(u=new Uint8Array(f)),xn(u),D2(d),d<0||d>=e4)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const h=[];let p,m,g=a.length;if(g===32)p=a.slice(),h.push(p),m=bF;else{if(g!==16||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);p=new Uint8Array(32),p.set(a),p.set(a,16),m=G0e,h.push(p)}B2(l)||(l=l.slice(),h.push(l));const y=Ht(p);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,y,Ht(l.subarray(0,16)),y),l=l.subarray(16)}const b=16-i;if(b!==l.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const C=new Uint8Array(12);C.set(l,s?0:12-l.length),l=C,h.push(l)}const x=Ht(l);for(!(function(C,P,S,_,k,T,O,M){const L=k.length,F=new Uint8Array(64),B=Ht(F),R=B2(k)&&B2(T),A=R?Ht(k):t4,N=R?Ht(T):t4;for(let z=0;z<L;O++){if(C(P,S,_,B,O,M),O>=e4)throw new Error("arx: counter overflow");const U=Math.min(64,L-z);if(R&&U===64){const V=z/4;if(z%4!=0)throw new Error("arx: invalid block position");for(let q,G=0;G<16;G++)q=V+G,N[q]=A[q]^B[G];z+=64}else{for(let V,q=0;q<U;q++)V=z+q,T[V]=k[V]^F[q];z+=U}}})(t,m,y,x,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function vF(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],d=e[1],f=e[2],h=e[3],p=e[4],m=e[5],g=e[6],y=e[7],b=i,x=n[0],C=n[1],P=n[2],S=o,_=a,k=l,T=c,O=u,M=d,L=f,F=h,B=p,R=m,A=g,N=y,z=b,U=x,V=C,q=P;for(let ne=0;ne<s;ne+=2)S=S+O|0,z=lt(z^S,16),B=B+z|0,O=lt(O^B,12),S=S+O|0,z=lt(z^S,8),B=B+z|0,O=lt(O^B,7),_=_+M|0,U=lt(U^_,16),R=R+U|0,M=lt(M^R,12),_=_+M|0,U=lt(U^_,8),R=R+U|0,M=lt(M^R,7),k=k+L|0,V=lt(V^k,16),A=A+V|0,L=lt(L^A,12),k=k+L|0,V=lt(V^k,8),A=A+V|0,L=lt(L^A,7),T=T+F|0,q=lt(q^T,16),N=N+q|0,F=lt(F^N,12),T=T+F|0,q=lt(q^T,8),N=N+q|0,F=lt(F^N,7),S=S+M|0,q=lt(q^S,16),A=A+q|0,M=lt(M^A,12),S=S+M|0,q=lt(q^S,8),A=A+q|0,M=lt(M^A,7),_=_+L|0,z=lt(z^_,16),N=N+z|0,L=lt(L^N,12),_=_+L|0,z=lt(z^_,8),N=N+z|0,L=lt(L^N,7),k=k+F|0,U=lt(U^k,16),B=B+U|0,F=lt(F^B,12),k=k+F|0,U=lt(U^k,8),B=B+U|0,F=lt(F^B,7),T=T+O|0,V=lt(V^T,16),R=R+V|0,O=lt(O^R,12),T=T+O|0,V=lt(V^T,8),R=R+V|0,O=lt(O^R,7);let G=0;r[G++]=o+S|0,r[G++]=a+_|0,r[G++]=l+k|0,r[G++]=c+T|0,r[G++]=u+O|0,r[G++]=d+M|0,r[G++]=f+L|0,r[G++]=h+F|0,r[G++]=p+B|0,r[G++]=m+R|0,r[G++]=g+A|0,r[G++]=y+N|0,r[G++]=b+z|0,r[G++]=x+U|0,r[G++]=C+V|0,r[G++]=P+q|0}const xF=wF(vF,{counterRight:!1,counterLength:4,allowShortKeys:!1});wF(vF,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let i=t[0],s=t[1],o=t[2],a=t[3],l=e[0],c=e[1],u=e[2],d=e[3],f=e[4],h=e[5],p=e[6],m=e[7],g=n[0],y=n[1],b=n[2],x=n[3];for(let P=0;P<20;P+=2)i=i+l|0,g=lt(g^i,16),f=f+g|0,l=lt(l^f,12),i=i+l|0,g=lt(g^i,8),f=f+g|0,l=lt(l^f,7),s=s+c|0,y=lt(y^s,16),h=h+y|0,c=lt(c^h,12),s=s+c|0,y=lt(y^s,8),h=h+y|0,c=lt(c^h,7),o=o+u|0,b=lt(b^o,16),p=p+b|0,u=lt(u^p,12),o=o+u|0,b=lt(b^o,8),p=p+b|0,u=lt(u^p,7),a=a+d|0,x=lt(x^a,16),m=m+x|0,d=lt(d^m,12),a=a+d|0,x=lt(x^a,8),m=m+x|0,d=lt(d^m,7),i=i+c|0,x=lt(x^i,16),p=p+x|0,c=lt(c^p,12),i=i+c|0,x=lt(x^i,8),p=p+x|0,c=lt(c^p,7),s=s+u|0,g=lt(g^s,16),m=m+g|0,u=lt(u^m,12),s=s+u|0,g=lt(g^s,8),m=m+g|0,u=lt(u^m,7),o=o+d|0,y=lt(y^o,16),f=f+y|0,d=lt(d^f,12),o=o+d|0,y=lt(y^o,8),f=f+y|0,d=lt(d^f,7),a=a+l|0,b=lt(b^a,16),h=h+b|0,l=lt(l^h,12),a=a+l|0,b=lt(b^a,8),h=h+b|0,l=lt(l^h,7);let C=0;r[C++]=i,r[C++]=s,r[C++]=o,r[C++]=a,r[C++]=g,r[C++]=y,r[C++]=b,r[C++]=x},allowShortKeys:!1});class SF extends QB{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Wo.hash(e);const r=Sm(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Wo.exists(this),this.iHash.update(e),this}digestInto(e){Wo.exists(this),Wo.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Fw=(t,e,n)=>new SF(t,e).update(n).digest();function Z0e(t,e,n){return Wo.hash(t),Fw(t,Sm(n),Sm(e))}Fw.create=(t,e)=>new SF(t,e);const F2=new Uint8Array([0]),n4=new Uint8Array;function X0e(t,e,n,r=32){if(Wo.hash(t),Wo.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=n4);const s=new Uint8Array(i*t.outputLen),o=Fw.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)F2[0]=c+1,a.update(c===0?n4:l).update(n).update(F2).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),F2.fill(0),s.slice(0,r)}var Q0e=Object.defineProperty,Jn=(t,e)=>{for(var n in e)Q0e(t,n,{get:e[n],enumerable:!0})},nc=Symbol("verified"),Y0e=t=>t instanceof Object;function $w(t){if(!Y0e(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function J0e(t){return t.sort(((e,n)=>e.created_at!==n.created_at?n.created_at-e.created_at:e.id.localeCompare(n.id)))}var kF={};Jn(kF,{Queue:()=>TF,QueueNode:()=>EF,binarySearch:()=>PC,insertEventIntoAscendingList:()=>tye,insertEventIntoDescendingList:()=>eye,normalizeURL:()=>cf,utf8Decoder:()=>Za,utf8Encoder:()=>fo});var Za=new TextDecoder("utf-8"),fo=new TextEncoder;function cf(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function eye(t,e){const[n,r]=PC(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at));return r||t.splice(n,0,e),t}function tye(t,e){const[n,r]=PC(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at));return r||t.splice(n,0,e),t}function PC(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var EF=class{value;next=null;prev=null;constructor(t){this.value=t}},TF=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new EF(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function CF(t){if(!$w(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Hp(t){return pr(vd(fo.encode(CF(t))))}var zw=new class{generateSecretKey(){return Do.utils.randomPrivateKey()}getPublicKey(t){return pr(Do.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=pr(Do.getPublicKey(e)),n.id=Hp(n),n.sig=pr(Do.sign(Hp(n),e)),n[nc]=!0,n}verifyEvent(t){if(typeof t[nc]=="boolean")return t[nc];const e=Hp(t);if(e!==t.id)return t[nc]=!1,!1;try{const n=Do.verify(t.sig,e,t.pubkey);return t[nc]=n,n}catch{return t[nc]=!1,!1}}},_F=zw.generateSecretKey,IC=zw.getPublicKey,po=zw.finalizeEvent,yh=zw.verifyEvent,AF={};function PF(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function OC(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function IF(t){return 2e4<=t&&t<3e4}function MC(t){return 3e4<=t&&t<4e4}function nye(t){return PF(t)?"regular":OC(t)?"replaceable":IF(t)?"ephemeral":MC(t)?"parameterized":"unknown"}function rye(t,e){const n=e instanceof Array?e:[e];return $w(t)&&n.includes(t.kind)||!1}Jn(AF,{Application:()=>rbe,BadgeAward:()=>uye,BadgeDefinition:()=>Xye,BlockedRelaysList:()=>Rye,BookmarkList:()=>Oye,Bookmarksets:()=>Kye,Calendar:()=>ube,CalendarEventRSVP:()=>dbe,ChannelCreation:()=>MF,ChannelHideMessage:()=>DF,ChannelMessage:()=>RF,ChannelMetadata:()=>NF,ChannelMuteUser:()=>LF,ClassifiedListing:()=>obe,ClientAuth:()=>FF,CommunitiesList:()=>Mye,CommunityDefinition:()=>pbe,CommunityPostApproval:()=>vye,Contacts:()=>aye,CreateOrUpdateProduct:()=>Jye,CreateOrUpdateStall:()=>Yye,Curationsets:()=>Gye,Date:()=>lbe,DirectMessageRelaysList:()=>Fye,DraftClassifiedListing:()=>abe,DraftLong:()=>tbe,Emojisets:()=>nbe,EncryptedDirectMessage:()=>lye,EventDeletion:()=>cye,FileMetadata:()=>pye,FileServerPreference:()=>$ye,Followsets:()=>Wye,GenericRepost:()=>fye,Genericlists:()=>jye,GiftWrap:()=>BF,HTTPAuth:()=>DC,Handlerinformation:()=>hbe,Handlerrecommendation:()=>fbe,Highlights:()=>_ye,InterestsList:()=>Lye,Interestsets:()=>Qye,JobFeedback:()=>kye,JobRequest:()=>xye,JobResult:()=>Sye,Label:()=>wye,LightningPubRPC:()=>Uye,LiveChatMessage:()=>mye,LiveEvent:()=>ibe,LongFormArticle:()=>ebe,Metadata:()=>iye,Mutelist:()=>Aye,NWCWalletInfo:()=>zye,NWCWalletRequest:()=>$F,NWCWalletResponse:()=>Hye,NostrConnect:()=>Vye,OpenTimestamps:()=>hye,Pinlist:()=>Pye,PrivateDirectMessage:()=>dye,ProblemTracker:()=>gye,ProfileBadges:()=>Zye,PublicChatsList:()=>Nye,Reaction:()=>RC,RecommendRelay:()=>oye,RelayList:()=>Iye,Relaysets:()=>qye,Report:()=>yye,Reporting:()=>bye,Repost:()=>NC,Seal:()=>OF,SearchRelaysList:()=>Dye,ShortTextNote:()=>sye,Time:()=>cbe,UserEmojiList:()=>Bye,UserStatuses:()=>sbe,Zap:()=>Cye,ZapGoal:()=>Eye,ZapRequest:()=>Tye,classifyKind:()=>nye,isEphemeralKind:()=>IF,isKind:()=>rye,isParameterizedReplaceableKind:()=>MC,isRegularKind:()=>PF,isReplaceableKind:()=>OC});var iye=0,sye=1,oye=2,aye=3,lye=4,cye=5,NC=6,RC=7,uye=8,OF=13,dye=14,fye=16,MF=40,NF=41,RF=42,DF=43,LF=44,hye=1040,BF=1059,pye=1063,mye=1311,gye=1971,yye=1984,bye=1984,wye=1985,vye=4550,xye=5999,Sye=6999,kye=7e3,Eye=9041,Tye=9734,Cye=9735,_ye=9802,Aye=1e4,Pye=10001,Iye=10002,Oye=10003,Mye=10004,Nye=10005,Rye=10006,Dye=10007,Lye=10015,Bye=10030,Fye=10050,$ye=10096,zye=13194,Uye=21e3,FF=22242,$F=23194,Hye=23195,Vye=24133,DC=27235,Wye=3e4,jye=30001,qye=30002,Kye=30003,Gye=30004,Zye=30008,Xye=30009,Qye=30015,Yye=30017,Jye=30018,ebe=30023,tbe=30024,nbe=30030,rbe=30078,ibe=30311,sbe=30315,obe=30402,abe=30403,lbe=31922,cbe=31923,ube=31924,dbe=31925,fbe=31989,hbe=31990,pbe=34550;function zF(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}function UF(t,e){for(let n=0;n<t.length;n++)if(zF(t[n],e))return!0;return!1}function mbe(...t){let e={};for(let n=0;n<t.length;n++){let r=t[n];Object.entries(r).forEach((([i,s])=>{if(i==="kinds"||i==="ids"||i==="authors"||i[0]==="#"){e[i]=e[i]||[];for(let o=0;o<s.length;o++){let a=s[o];e[i].includes(a)||e[i].push(a)}}})),r.limit&&(!e.limit||r.limit>e.limit)&&(e.limit=r.limit),r.until&&(!e.until||r.until>e.until)&&(e.until=r.until),r.since&&(!e.since||r.since<e.since)&&(e.since=r.since)}return e}function gbe(t){if(t.ids&&!t.ids.length||t.kinds&&!t.kinds.length||t.authors&&!t.authors.length)return 0;for(const[e,n]of Object.entries(t))if(e[0]==="#"&&Array.isArray(n)&&!n.length)return 0;return Math.min(Math.max(0,t.limit??1/0),t.ids?.length??1/0,t.authors?.length&&t.kinds?.every((e=>OC(e)))?t.authors.length*t.kinds.length:1/0,t.authors?.length&&t.kinds?.every((e=>MC(e)))&&t["#d"]?.length?t.authors.length*t.kinds.length*t["#d"].length:1/0)}var HF={};function Uw(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function VF(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function WF(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function ybe(t,e){return e===Uw(t,"id")}function bbe(t,e){return e===Uw(t,"pubkey")}function wbe(t,e){return e===VF(t,"kind")}Jn(HF,{getHex64:()=>Uw,getInt:()=>VF,getSubscriptionId:()=>WF,matchEventId:()=>ybe,matchEventKind:()=>wbe,matchEventPubkey:()=>bbe});var jF={};function qF(t,e){return{kind:FF,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function vbe(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}Jn(jF,{makeAuthEvent:()=>qF});var KF,xbe=t=>(t[nc]=!0,!0),LC=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new TF;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=cf(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new LC(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await vbe();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=WF(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=Uw(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&UF(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t(qF(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new Sbe(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},Sbe=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{KF=WebSocket}catch{}var GF,ZF=class extends LC{constructor(t){super(t,{verifyEvent:yh,websocketImplementation:KF})}static async connect(t){const e=new ZF(t);return await e.connect(),e}},kbe=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=cf(t);let n=this.relays.get(t);return n||(n=new LC(t,{verifyEvent:this.trustedRelayURLs.has(t)?xbe:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(cf).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(d,f)=>{let h=this.seenOn.get(f);h||(h=new Set,this.seenOn.set(f,h)),h.add(d)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=d=>{s[d]=!0,s.filter((f=>f)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(d,f)=>{o(d),a[d]=f,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=d=>{if(e.alreadyHaveEvent?.(d))return!0;const f=n.has(d);return n.add(d),f},u=Promise.all(Object.entries(t).map((async(d,f,h)=>{if(h.indexOf(d)!==f)return void l(f,"duplicate url");let p,[m,g]=d;m=cf(m);try{p=await this.ensureRelay(m,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(b){return void l(f,b?.message||String(b))}let y=p.subscribe(g,{...e,oneose:()=>o(f),onclose:b=>l(f,b),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)})));return{async close(){await u,r.forEach((d=>{d.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(cf).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{GF=WebSocket}catch{}var Ebe=class extends kbe{constructor(){super({verifyEvent:yh,websocketImplementation:GF})}},XF={};Jn(XF,{BECH32_REGEX:()=>QF,Bech32MaxSize:()=>BC,NostrTypeGuard:()=>Tbe,decode:()=>tg,encodeBytes:()=>Vw,naddrEncode:()=>Obe,neventEncode:()=>Ibe,noteEncode:()=>Abe,nprofileEncode:()=>Pbe,npubEncode:()=>_be,nsecEncode:()=>Cbe});var Tbe={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},BC=5e3,QF=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function tg(t){let{prefix:e,words:n}=Jf.decode(t,BC),r=new Uint8Array(Jf.fromWords(n));switch(e){case"nprofile":{let i=$2(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:pr(i[0][0]),relays:i[1]?i[1].map((s=>Za.decode(s))):[]}}}case"nevent":{let i=$2(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:pr(i[0][0]),relays:i[1]?i[1].map((s=>Za.decode(s))):[],author:i[2]?.[0]?pr(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(pr(i[3][0]),16):void 0}}}case"naddr":{let i=$2(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Za.decode(i[0][0]),pubkey:pr(i[2][0]),kind:parseInt(pr(i[3][0]),16),relays:i[1]?i[1].map((s=>Za.decode(s))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:pr(r)};default:throw new Error(`unknown prefix ${e}`)}}function $2(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function Cbe(t){return Vw("nsec",t)}function _be(t){return Vw("npub",Yf(t))}function Abe(t){return Vw("note",Yf(t))}function Hw(t,e){let n=Jf.toWords(e);return Jf.encode(t,n,BC)}function Vw(t,e){return Hw(t,e)}function Pbe(t){return Hw("nprofile",FC({0:[Yf(t.pubkey)],1:(t.relays||[]).map((e=>fo.encode(e)))}))}function Ibe(t){let e;return t.kind!==void 0&&(e=(function(n){const r=new Uint8Array(4);return r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=255&n,r})(t.kind)),Hw("nevent",FC({0:[Yf(t.id)],1:(t.relays||[]).map((n=>fo.encode(n))),2:t.author?[Yf(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function Obe(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),Hw("naddr",FC({0:[fo.encode(t.identifier)],1:(t.relays||[]).map((n=>fo.encode(n))),2:[Yf(t.pubkey)],3:[new Uint8Array(e)]}))}function FC(t){let e=[];return Object.entries(t).reverse().forEach((([n,r])=>{r.forEach((i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)}))})),Lw(...e)}var Mbe=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function Nbe(t){let e=[];for(let n of t.content.matchAll(Mbe))if(n[2])try{let{type:r,data:i}=tg(n[1]);switch(r){case"npub":e.push({text:n[0],profile:{pubkey:i,relays:[]}});break;case"nprofile":e.push({text:n[0],profile:i});break;case"note":e.push({text:n[0],event:{id:i,relays:[]}});break;case"nevent":e.push({text:n[0],event:i});break;case"naddr":e.push({text:n[0],address:i})}}catch{}else if(n[3]){let r=parseInt(n[3],10),i=t.tags[r];if(!i)continue;switch(i[0]){case"p":e.push({text:n[0],profile:{pubkey:i[1],relays:i[2]?[i[2]]:[]}});break;case"e":e.push({text:n[0],event:{id:i[1],relays:i[2]?[i[2]]:[]}});break;case"a":try{let[s,o,a]=i[1].split(":");e.push({text:n[0],address:{identifier:a,pubkey:o,kind:parseInt(s,10),relays:i[2]?[i[2]]:[]}})}catch{}}}return e}var YF={};async function JF(t,e,n){const r=t instanceof Uint8Array?pr(t):t,i=e$(hh.getSharedSecret(r,"02"+e));let s=Uint8Array.from(JB(16)),o=fo.encode(n),a=mF(i,s).encrypt(o);return`${Wc.encode(new Uint8Array(a))}?iv=${Wc.encode(new Uint8Array(s.buffer))}`}async function Rbe(t,e,n){const r=t instanceof Uint8Array?pr(t):t;let[i,s]=n.split("?iv="),o=e$(hh.getSharedSecret(r,"02"+e)),a=Wc.decode(s),l=Wc.decode(i),c=mF(o,a).decrypt(l);return Za.decode(c)}function e$(t){return t.slice(1,33)}Jn(YF,{decrypt:()=>Rbe,encrypt:()=>JF});var t$={};Jn(t$,{NIP05_REGEX:()=>$C,isNip05:()=>Dbe,isValid:()=>Fbe,queryProfile:()=>n$,searchDomain:()=>Bbe,useFetchImplementation:()=>Lbe});var Ww,$C=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Dbe=t=>$C.test(t||"");try{Ww=fetch}catch{}function Lbe(t){Ww=t}async function Bbe(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Ww(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function n$(t){const e=t.match($C);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Ww(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function Fbe(t,e){const n=await n$(e);return!!n&&n.pubkey===t}var r$={};function $be(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,d={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=d;continue}if(c==="reply"){e.reply=d;continue}if(c==="mention"){e.mentions.push(d);continue}n?r=d:n=d,e.mentions.push(d)}else{if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}s[0]==="p"&&s[1]&&e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find((a=>a.pubkey===i.author));o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach((a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)})),o.relays=i.relays)}})),e.mentions.forEach((i=>{if(i.author){let s=e.profiles.find((o=>o.pubkey===i.author));s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach((o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)})),s.relays=i.relays)}})),e}Jn(r$,{parse:()=>$be});var i$={};Jn(i$,{fetchRelayInformation:()=>Ube,useFetchImplementation:()=>zbe});function zbe(t){}async function Ube(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var s$={};function o$(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r!==0){e+=Math.clz32(r);break}e+=32}return e}function Hbe(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=a$(r),o$(r.id)>=e)break}return r}function a$(t){return pr(vd(fo.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}Jn(s$,{fastEventHash:()=>a$,getPow:()=>o$,minePow:()=>Hbe});var l$={};function Vbe(t,e,n,r){return po({kind:NC,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function c$(t){if(t.kind!==NC)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0?{id:e[1],relays:[e[2],n?.[2]].filter((r=>typeof r=="string")),author:n?.[1]}:void 0}function Wbe(t,{skipVerification:e}={}){const n=c$(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}return r.id===n.id&&(e||yh(r))?r:void 0}Jn(l$,{finishRepostEvent:()=>Vbe,getRepostedEvent:()=>Wbe,getRepostedEventPointer:()=>c$});var u$={};Jn(u$,{NOSTR_URI_REGEX:()=>jw,parse:()=>qbe,test:()=>jbe});var jw=new RegExp(`nostr:(${QF.source})`);function jbe(t){return typeof t=="string"&&new RegExp(`^${jw.source}$`).test(t)}function qbe(t){const e=t.match(new RegExp(`^${jw.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:tg(e[1])}}var d$={};function Kbe(t,e,n){const r=e.tags.filter((i=>i.length>=2&&(i[0]==="e"||i[0]==="p")));return po({...t,kind:RC,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function Gbe(t){if(t.kind!==RC)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0&&n!==void 0?{id:e[1],relays:[e[2],n[2]].filter((r=>r!==void 0)),author:n[1]}:void 0}Jn(d$,{finishReactionEvent:()=>Kbe,getReactedEventPointer:()=>Gbe});var f$={};Jn(f$,{matchAll:()=>Zbe,regex:()=>zC,replaceAll:()=>Xbe});var zC=()=>new RegExp(`\\b${jw.source}\\b`,"g");function*Zbe(t){const e=t.matchAll(zC());for(const n of e)try{const[r,i]=n;yield{uri:r,value:i,decoded:tg(i),start:n.index,end:n.index+r.length}}catch{}}function Xbe(t,e){return t.replaceAll(zC(),((n,r)=>e({uri:n,value:r,decoded:tg(r)})))}var h$={};Jn(h$,{channelCreateEvent:()=>Qbe,channelHideMessageEvent:()=>ewe,channelMessageEvent:()=>Jbe,channelMetadataEvent:()=>Ybe,channelMuteUserEvent:()=>twe});var Qbe=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return po({kind:MF,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Ybe=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return po({kind:NF,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Jbe=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),po({kind:RF,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},ewe=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return po({kind:DF,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},twe=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return po({kind:LF,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},p$={};Jn(p$,{EMOJI_SHORTCODE_REGEX:()=>m$,matchAll:()=>nwe,regex:()=>UC,replaceAll:()=>rwe});var m$=/:(\w+):/,UC=()=>new RegExp(`\\B${m$.source}\\B`,"g");function*nwe(t){const e=t.matchAll(UC());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function rwe(t,e){return t.replaceAll(UC(),((n,r)=>e({shortcode:n,name:r})))}var HC,g$={};Jn(g$,{useFetchImplementation:()=>iwe,validateGithub:()=>swe});try{HC=fetch}catch{}function iwe(t){HC=t}async function swe(t,e,n){try{return await(await HC(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var y$={};Jn(y$,{decrypt:()=>qC,encrypt:()=>jC,getConversationKey:()=>VC,v2:()=>awe});var b$=1,w$=65535;function VC(t,e){const n=hh.getSharedSecret(t,"02"+e).subarray(1,33);return Z0e(vd,n,"nip44-v2")}function v$(t,e){const n=X0e(vd,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function WC(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function owe(t){const e=fo.encode(t),n=e.length;return Lw((function(r){if(!Number.isSafeInteger(r)||r<b$||r>w$)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const i=new Uint8Array(2);return new DataView(i.buffer).setUint16(0,r,!1),i})(n),e,new Uint8Array(WC(n)-n))}function x$(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=Lw(n,e);return Fw(vd,t,r)}function jC(t,e,n=JB(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=v$(e,n),o=owe(t),a=xF(r,i,o),l=x$(s,a,n);return Wc.encode(Lw(new Uint8Array([2]),n,a,l))}function qC(t,e){const{nonce:n,ciphertext:r,mac:i}=(function(l){if(typeof l!="string")throw new Error("payload must be a valid string");const c=l.length;if(c<132||c>87472)throw new Error("invalid payload length: "+c);if(l[0]==="#")throw new Error("unknown encryption version");let u;try{u=Wc.decode(l)}catch(h){throw new Error("invalid base64: "+h.message)}const d=u.length;if(d<99||d>65603)throw new Error("invalid data length: "+d);const f=u[0];if(f!==2)throw new Error("unknown encryption version "+f);return{nonce:u.subarray(1,33),ciphertext:u.subarray(33,-32),mac:u.subarray(-32)}})(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=v$(e,n);if(!TC(x$(a,r,n),i))throw new Error("invalid MAC");return(function(l){const c=new DataView(l.buffer).getUint16(0),u=l.subarray(2,2+c);if(c<b$||c>w$||u.length!==c||l.length!==2+WC(c))throw new Error("invalid padding");return Za.decode(u)})(xF(s,o,r))}var awe={utils:{getConversationKey:VC,calcPaddedLen:WC},encrypt:jC,decrypt:qC},S$={};function lwe(t){const{pathname:e,searchParams:n}=new URL(t),r=e,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function cwe(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},i=await JF(e,t,JSON.stringify(r)),s={kind:$F,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return po(s,e)}Jn(S$,{makeNwcRequestEvent:()=>cwe,parseConnectionString:()=>lwe});var KC,k$={};Jn(k$,{getZapEndpoint:()=>dwe,makeZapReceipt:()=>pwe,makeZapRequest:()=>fwe,useFetchImplementation:()=>uwe,validateZapRequest:()=>hwe});try{KC=fetch}catch{}function uwe(t){KC=t}async function dwe(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=Jf.decode(n,1e3),a=Jf.fromWords(o);e=Za.decode(a)}else{if(!r)return null;{let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}}let i=await KC(e),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function fwe({profile:t,event:e,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function hwe(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!$w(e))return"Zap request is not a valid Nostr event.";if(!yh(e))return"Invalid signature on zap request.";let n=e.tags.find((([i,s])=>i==="p"&&s));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([i,s])=>i==="e"&&s));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([i,s])=>i==="relays"&&s))?null:"Zap request doesn't have a 'relays' tag."}function pwe({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter((([a])=>a==="e"||a==="p"||a==="a")),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}var E$={};Jn(E$,{createRumor:()=>P$,createSeal:()=>I$,createWrap:()=>O$,unwrapEvent:()=>M$,unwrapManyEvents:()=>gwe,wrapEvent:()=>tk,wrapManyEvents:()=>mwe});var T$=()=>Math.round(Date.now()/1e3),C$=()=>Math.round(T$()-172800*Math.random()),_$=(t,e)=>VC(t,e),A$=(t,e,n)=>jC(JSON.stringify(t),_$(e,n)),r4=(t,e)=>JSON.parse(qC(t.content,_$(e,t.pubkey)));function P$(t,e){const n={created_at:T$(),content:"",tags:[],...t,pubkey:IC(e)};return n.id=Hp(n),n}function I$(t,e,n){return po({kind:OF,content:A$(t,e,n),created_at:C$(),tags:[]},e)}function O$(t,e){const n=_F();return po({kind:BF,content:A$(t,n,e),created_at:C$(),tags:[["p",e]]},n)}function tk(t,e,n){return O$(I$(P$(t,e),e,n),n)}function mwe(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=IC(e),i=[tk(t,e,r)];return n.forEach((s=>{i.push(tk(t,e,s))})),i}function M$(t,e){const n=r4(t,e);return r4(n,e)}function gwe(t,e){let n=[];return t.forEach((r=>{n.push(M$(r,e))})),n.sort(((r,i)=>r.created_at-i.created_at)),n}var N$={};Jn(N$,{getToken:()=>ywe,hashPayload:()=>GC,unpackEventFromToken:()=>D$,validateEvent:()=>U$,validateEventKind:()=>B$,validateEventMethodTag:()=>$$,validateEventPayloadTag:()=>z$,validateEventTimestamp:()=>L$,validateEventUrlTag:()=>F$,validateToken:()=>bwe});var R$="Nostr ";async function ywe(t,e,n,r=!1,i){const s={kind:DC,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",GC(i)]);const o=await n(s);return(r?R$:"")+Wc.encode(fo.encode(JSON.stringify(o)))}async function bwe(t,e,n){const r=await D$(t).catch((i=>{throw i}));return await U$(r,e,n).catch((i=>{throw i}))}async function D$(t){if(!t)throw new Error("Missing token");t=t.replace(R$,"");const e=Za.decode(Wc.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function L$(t){return!!t.created_at&&Math.round(new Date().getTime()/1e3)-t.created_at<60}function B$(t){return t.kind===DC}function F$(t,e){const n=t.tags.find((r=>r[0]==="u"));return!!n&&n.length>0&&n[1]===e}function $$(t,e){const n=t.tags.find((r=>r[0]==="method"));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function GC(t){return pr(vd(fo.encode(JSON.stringify(t))))}function z$(t,e){const n=t.tags.find((i=>i[0]==="payload"));if(!n)return!1;const r=GC(e);return n.length>0&&n[1]===r}async function U$(t,e,n,r){if(!yh(t))throw new Error("Invalid nostr event, signature invalid");if(!B$(t))throw new Error("Invalid nostr event, kind invalid");if(!L$(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!F$(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!$$(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!z$(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const xt={LIBRARIES:{decodeBolt11:c0e.decode,NostrTools:WS},DEFAULT_OPTIONS:{theme:"light",colorMode:!0},BATCH_SIZE:5,REQ_CONFIG:{INITIAL_LOAD_COUNT:15,ADDITIONAL_LOAD_COUNT:20},LOAD_TIMEOUT:1e4,BUFFER_INTERVAL:500,BUFFER_MIN_INTERVAL:100,INFINITE_SCROLL:{ROOT_MARGIN:"400px",THRESHOLD:.1,DEBOUNCE_TIME:500,RETRY_DELAY:500},ZAP_CONFIG:{DEFAULT_LIMIT:1,DEFAULT_COLOR_MODE:!0,ERRORS:{DIALOG_NOT_FOUND:"Zap dialog not found",BUTTON_NOT_FOUND:"Fetch button not found",DECODE_FAILED:"Failed to decode identifier"}},ZAP_AMOUNT_CONFIG:{DEFAULT_COLOR_MODE:!0,THRESHOLDS:[{value:1e4,className:"zap-amount-10k"},{value:5e3,className:"zap-amount-5k"},{value:2e3,className:"zap-amount-2k"},{value:1e3,className:"zap-amount-1k"},{value:500,className:"zap-amount-500"},{value:200,className:"zap-amount-200"},{value:100,className:"zap-amount-100"}],DEFAULT_CLASS:"default-color",DISABLED_CLASS:""},DIALOG_CONFIG:{DEFAULT_TITLE:"To ",NO_ZAPS_MESSAGE:"No Zaps yet!<br>Send the first Zap!",DEFAULT_NO_ZAPS_DELAY:1500,ZAP_LIST:{INITIAL_BATCH:30,REMAINING_BATCH:30,PROFILE_BATCH:30,MIN_HEIGHT:"100px"}},REQUEST_CONFIG:{METADATA_TIMEOUT:2e4,REQUEST_TIMEOUT:2e3,CACHE_DURATION:3e5},PROFILE_CONFIG:{BATCH_SIZE:20,BATCH_DELAY:100,RELAYS:["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine","wss://directory.yabu.me"]},BATCH_CONFIG:{REFERENCE_PROCESSOR:{BATCH_SIZE:20,BATCH_DELAY:100},SUPPORTED_EVENT_KINDS:[1,30023,30030,30009,40,42,31990]},BATCH_PROCESSOR_CONFIG:{DEFAULT_BATCH_SIZE:20,DEFAULT_BATCH_DELAY:100,DEFAULT_MAX_CACHE_AGE:18e5,DEFAULT_RELAY_URLS:[],TIMEOUT_DURATION:500}};class km{constructor(e,n,r=null){this.identifier=e,this.relayUrls=n,this.isColorModeEnabled=r===null?xt.ZAP_CONFIG.DEFAULT_COLOR_MODE:String(r).toLowerCase()==="true"}static determineColorMode(e){if(!e||!e.hasAttribute("data-zap-color-mode"))return xt.ZAP_CONFIG.DEFAULT_COLOR_MODE;const n=e.getAttribute("data-zap-color-mode");return n.toLowerCase()!=="true"&&n.toLowerCase()!=="false"||n.toLowerCase()==="true"}static fromButton(e){if(!e)throw new Error(xt.ZAP_CONFIG.ERRORS.BUTTON_NOT_FOUND);const n=km.determineColorMode(e);return new km(e.getAttribute("data-nzv-id"),e.getAttribute("data-relay-urls").split(","),n)}}class ul{constructor(e=1e3){this.cache=new Map,this.maxSize=e,this.accessOrder=new Map}set(e,n){if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const r=this.accessOrder.keys().next().value;this.cache.delete(r),this.accessOrder.delete(r)}return this.cache.set(e,n),this.accessOrder.delete(e),this.accessOrder.set(e,Date.now()),n}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.accessOrder.set(e,Date.now()),n}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}}class ZC extends ul{#e=new Map;setProfile(e,n){if(!e||!n)return;const r=this.get(e);r&&r._eventCreatedAt&&n._eventCreatedAt&&!(n._eventCreatedAt>r._eventCreatedAt)||(this.set(e,n),this.#t(e,n))}#t(e,n){this.#e.forEach((r=>{try{r(e,n)}catch{}}))}subscribe(e){if(typeof e!="function")return null;const n=Math.random().toString(36).substr(2,9);return this.#e.set(n,e),()=>this.#e.delete(n)}clearSubscriptions(){this.#e.clear()}}class wwe extends ul{#e=new Map;initializeView(e){this.#e.set(e,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,batchProcessing:!1})}getViewState(e){return this.#e.get(e)||this.initializeView(e)}updateViewState(e,n){const r=this.getViewState(e);return this.#e.set(e,{...r,...n}),this.#e.get(e)}getEvents(e){return this.get(e)||[]}setEvents(e,n,r=!1){const i=r?this.getEvents(e):[],s=new Map(n.map((a=>[a.id,a]))),o=[...i.filter((a=>!s.has(a.id))),...n];this.set(e,o)}addEvent(e,n){if(!n?.id)return!1;const r=this.getEvents(e);return!this.#t(r,n)&&(r.push(n),r.sort(((i,s)=>s.created_at-i.created_at)),this.setEvents(e,r,!0),!0)}#t(e,n){return e.some((r=>r.id===n.id||r.kind===n.kind&&r.pubkey===n.pubkey&&r.content===n.content&&r.created_at===n.created_at))}}class vwe extends ul{#e=new Map;#t=new Map;async getOrFetch(e,n){const r=this.get(e);if(r)return r;const i=this.#e.get(e);if(i)return i;const s=n().then((o=>(o&&this.set(e,o),this.#e.delete(e),o))).catch((o=>(this.#e.delete(e),null)));return this.#e.set(e,s),s}clearPendingFetches(){this.#e.clear()}setComponent(e,n){this.#t.set(e,n)}getComponent(e){return this.#t.get(e)}clearComponents(){this.#t.clear()}clear(){super.clear(),this.clearPendingFetches(),this.clearComponents()}}class xwe extends ul{#e=new Map;#t=new Map;setCached(e,n,r){const i=`${e}:${n}`;this.set(i,{stats:r,timestamp:Date.now()}),this.updateViewStats(e,r)}getCached(e,n){const r=`${e}:${n}`;return this.get(r)}updateViewStats(e,n){n&&this.#e.set(e,{...n,lastUpdate:Date.now()})}getViewStats(e){return this.#e.get(e)}clearViewStats(e){this.#e.delete(e)}setNoZapsState(e,n){this.#t.set(e,n)}hasNoZaps(e){return this.#t.get(e)||!1}clearNoZapsState(e){this.#t.delete(e)}clear(){super.clear(),this.#e.clear(),this.#t.clear()}}class Swe extends ul{hasDecoded(e){return this.has(e)}setDecoded(e,n){this.set(e,n)}getDecoded(e){return this.get(e)}}class kwe extends ul{initializeLoadState(e){const n={isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,currentCount:0};return this.set(e,n),n}getLoadState(e){return this.has(e)?this.get(e):this.initializeLoadState(e)}updateLoadState(e,n){const r={...this.getLoadState(e),...n};return this.set(e,r),r}canLoadMore(e){const n=this.getLoadState(e);return n&&!n.isLoading&&n.lastEventTime}updateLoadProgress(e,n){const r=this.getLoadState(e);return r.currentCount+=n,this.updateLoadState(e,{currentCount:r.currentCount}),r.currentCount}}class Ewe extends ul{setZapInfo(e,n){this.set(e,n)}getZapInfo(e){return this.get(e)}clearZapInfo(e){this.delete(e)}}class Twe extends ZC{setImage(e,n){e&&n&&this.set(e,{image:n,timestamp:Date.now()})}getImage(e){return this.get(e)?.image}hasImage(e){return this.has(e)}clearExpired(e=36e5){const n=Date.now();for(const[r,i]of this.cache.entries())n-i.timestamp>e&&this.delete(r)}}class Cwe extends ZC{#e=new Map;setNip05(e,n){e&&this.set(e,{value:n,timestamp:Date.now(),verified:!0})}getNip05(e){return this.get(e)?.value}setPendingVerification(e,n){this.#e.set(e,n)}getPendingVerification(e){return this.#e.get(e)}deletePendingVerification(e){this.#e.delete(e)}clearPendingVerifications(){this.#e.clear()}clear(){super.clear(),this.clearPendingVerifications()}}class Vp{static#e=null;#t=null;#n={};constructor(){if(Vp.#e)return Vp.#e;this.profileCache=new ZC,this.zapEventCache=new wwe,this.referenceCache=new vwe,this.statsCache=new xwe,this.decodedCache=new Swe,this.loadStateCache=new kwe,this.zapInfoCache=new Ewe,this.imageCache=new Twe,this.nip05Cache=new Cwe,this.nip05PendingCache=new ul,this.#n=["zapInfo","uiComponent","decoded","nip05","nip05PendingFetches","zapLoadStates","imageCache","isEventIdentifier"].reduce(((e,n)=>(e[n]=new ul,e)),{}),this.viewStats=new Map,this.viewStates=new Map,Vp.#e=this}setProfile(e,n){return this.profileCache.setProfile(e,n)}getProfile(e){return this.profileCache.get(e)}subscribeToProfileUpdates(e){return this.profileCache.subscribe(e)}initializeZapView(e){return this.zapEventCache.initializeView(e)}getZapEvents(e){return this.zapEventCache.getEvents(e)}setZapEvents(e,n,r){return this.zapEventCache.setEvents(e,n,r)}addZapEvent(e,n){return this.zapEventCache.addEvent(e,n)}getZapViewState(e){return this.zapEventCache.getViewState(e)}updateZapViewState(e,n){return this.zapEventCache.updateViewState(e,n)}setReference(e,n){return this.referenceCache.set(e,n)}getReference(e){return this.referenceCache.get(e)}getOrFetchReference(e,n){return this.referenceCache.getOrFetch(e,n)}getReferenceComponent(e){return this.referenceCache.getComponent(e)}setReferenceComponent(e,n){return this.referenceCache.setComponent(e,n)}getCachedStats(e,n){return this.statsCache.getCached(e,n)}updateStatsCache(e,n,r){this.statsCache.setCached(e,n,r),this.statsCache.updateViewStats(e,r)}getViewStats(e){return this.statsCache.getViewStats(e)}setNoZapsState(e,n){return this.statsCache.setNoZapsState(e,n)}hasNoZaps(e){return this.statsCache.hasNoZaps(e)}async processCachedData(e,n){this.setRelayUrls(n.relayUrls);const r=this.getZapEvents(e),i=r.some((s=>this.getReference(s.id)));return{stats:(await Promise.all([this.getCachedStats(e,n.identifier)]))[0],hasEnoughCachedEvents:r.length>=xt.REQ_CONFIG.INITIAL_LOAD_COUNT,hasReferences:i}}hasDecoded(e){return this.decodedCache.hasDecoded(e)}setDecoded(e,n){return this.decodedCache.setDecoded(e,n)}getDecoded(e){return this.decodedCache.getDecoded(e)}initializeLoadState(e){return this.loadStateCache.initializeLoadState(e)}getLoadState(e){return this.loadStateCache.getLoadState(e)}updateLoadState(e,n){return this.loadStateCache.updateLoadState(e,n)}canLoadMore(e){return this.loadStateCache.canLoadMore(e)}updateLoadProgress(e,n){return this.loadStateCache.updateLoadProgress(e,n)}setZapInfo(e,n){return this.zapInfoCache.setZapInfo(e,n)}getZapInfo(e){return this.zapInfoCache.getZapInfo(e)}clearZapInfo(e){return this.zapInfoCache.clearZapInfo(e)}setImageCache(e,n){return this.imageCache.setImage(e,n)}getImageCache(e){return this.imageCache.getImage(e)}hasImageCache(e){return this.imageCache.hasImage(e)}setNip05(e,n){return this.nip05Cache.setNip05(e,n)}getNip05(e){return this.nip05Cache.getNip05(e)}setNip05PendingFetch(e,n){this.nip05Cache.setPendingVerification(e,n)}getNip05PendingFetch(e){return this.nip05Cache.getPendingVerification(e)}deleteNip05PendingFetch(e){this.nip05Cache.deletePendingVerification(e)}getOrCreateViewState(e,n={}){return this.viewStates.has(e)||this.viewStates.set(e,{currentStats:null,...n}),this.viewStates.get(e)}getViewState(e){return this.getOrCreateViewState(e)}updateViewState(e,n){const r=this.getOrCreateViewState(e);return this.viewStates.set(e,{...r,...n}),this.viewStates.get(e)}setCacheItem(e,n,r){const i=this.#n[e];return i&&n!==void 0?i.set(n,r):null}getCacheItem(e,n){const r=this.#n[e];return r&&n!==void 0?r.get(n):null}setRelayUrls(e){this.#t=e}getRelayUrls(){return this.#t}clearAll(){this.profileCache.clear(),this.profileCache.clearSubscriptions(),this.zapEventCache.clear(),this.referenceCache.clear(),this.referenceCache.clearPendingFetches(),this.referenceCache.clearComponents(),this.statsCache.clear(),this.decodedCache.clear(),this.loadStateCache.clear(),this.zapInfoCache.clear(),this.imageCache.clear(),this.nip05Cache.clear(),this.nip05Cache.clearPendingVerifications(),Object.values(this.#n).forEach((e=>e.clear())),this.viewStats.clear(),this.viewStates.clear()}}const ft=new Vp,i4="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDYuMzMgMjA2LjMzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICA8ZGVmcz4KICAgICAgPHN0eWxlPgogICAgICAgICAuY2xzLTEgewogICAgICAgICAgICBmaWxsOiBub25lOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTIgewogICAgICAgICAgICBmaWxsOiAjZmZmOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTMgewogICAgICAgICAgICBmaWxsOiAjNjY2OwogICAgICAgICB9CiAgICAgIDwvc3R5bGU+CiAgIDwvZGVmcz4KICAgPHBhdGggY2xhc3M9ImNscy0yIgogICAgICBkPSJtMjA2LjMzIDEzNC4zOWMwIDIwLjcxIDAgMzEuMDctMy41MyA0Mi4yMi00LjQzIDEyLjE3LTE0LjAyIDIxLjc2LTI2LjE5IDI2LjE5LTExLjE1IDMuNTMtMjEuNSAzLjUzLTQyLjIyIDMuNTNoLTYyLjQ2Yy0yMC43MSAwLTMxLjA2IDAtNDIuMjEtMy41My0xMi4xNy00LjQzLTIxLjc2LTE0LjAyLTI2LjE5LTI2LjE5LTMuNTMtMTEuMTUtMy41My0yMS41LTMuNTMtNDIuMjJ2LTYyLjQ2YzAtMjAuNzEgMC0zMS4wNyAzLjUzLTQyLjIyIDQuNDMtMTIuMTcgMTQuMDItMjEuNzYgMjYuMTktMjYuMTkgMTEuMTUtMy41MiAyMS41LTMuNTIgNDIuMjEtMy41Mmg2Mi40NmMyMC43MSAwIDMxLjA3IDAgNDIuMjIgMy41MiAxMi4xNyA0LjQzIDIxLjc2IDE0LjAyIDI2LjE5IDI2LjE5IDMuNTMgMTEuMTUgMy41MyAyMS41IDMuNTMgNDIuMjJ6IiAvPgogICA8cGF0aCBjbGFzcz0iY2xzLTMiCiAgICAgIGQ9Im0xODUuOTggOTEuMXY4My4yM2MwIDMuMTMtMi41NCA1LjY3LTUuNjcgNS42N2gtNjguMDRjLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNS41YzAuMzEtMTkgMi4zMi0zNy4yIDYuNTQtNDUuNDggMi41My00Ljk4IDYuNy03LjY5IDExLjQ5LTkuMTQgOS4wNS0yLjcyIDI0LjkzLTAuODYgMzEuNjctMS4xOCAwIDAgMjAuMzYgMC44MSAyMC4zNi0xMC43MiAwLTkuMjgtOS4xLTguNTUtOS4xLTguNTUtMTAuMDMgMC4yNi0xNy42Ny0wLjQyLTIyLjYyLTIuMzctOC4yOS0zLjI2LTguNTctOS4yNC04LjYtMTEuMjQtMC40MS0yMy4xLTM0LjQ3LTI1Ljg3LTY0LjQ4LTIwLjE0LTMyLjgxIDYuMjQgMC4zNiA1My4yNyAwLjM2IDExNi4wNXY4LjM4Yy0wLjA2IDMuMDgtMi41NSA1LjU3LTUuNjUgNS41N2gtMzMuNjljLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNDMuOTVjMC0zLjEzIDIuNTQtNS42NyA1LjY3LTUuNjdoMzEuNjdjMy4xMyAwIDUuNjcgMi41NCA1LjY3IDUuNjcgMCA0LjY1IDUuMjMgNy4yNCA5LjAxIDQuNTMgMTEuMzktOC4xNiAyNi4wMS0xMi41MSA0Mi4zNy0xMi41MSAzNi42NSAwIDY0LjM2IDIxLjM2IDY0LjM2IDY4LjY5em0tNjAuODQtMTYuODljMC02LjctNS40My0xMi4xMy0xMi4xMy0xMi4xM3MtMTIuMTMgNS40My0xMi4xMyAxMi4xMyA1LjQzIDEyLjEzIDEyLjEzIDEyLjEzIDEyLjEzLTUuNDMgMTIuMTMtMTIuMTN6IiAvPgo8L3N2Zz4=",_we=t=>typeof t=="string"&&t.length>0,Awe=t=>{try{return window.NostrTools.nip19.decode(t)}catch{return null}},Pwe=(t,e,n)=>{const r={npub:()=>({kinds:[9735],"#p":[e]}),note:()=>({kinds:[9735],"#e":[e]}),nprofile:()=>({kinds:[9735],"#p":[e.pubkey]}),nevent:()=>({kinds:[9735],"#e":[e.id]}),naddr:()=>({kinds:[9735],"#a":[`${e.kind}:${e.pubkey}:${e.identifier}`]})}[t];if(!r)return null;const i=r();return i.limit=n?xt.REQ_CONFIG.ADDITIONAL_LOAD_COUNT:xt.REQ_CONFIG.INITIAL_LOAD_COUNT,n&&(i.until=n),{req:i}};function s4(t,e=null){const n=`${t}:${e}`;if(ft.hasDecoded(n))return ft.getDecoded(n);if(!_we(t))throw new Error(xt.ZAP_CONFIG.ERRORS.DECODE_FAILED);const r=Awe(t);if(!r)return null;const i=Pwe(r.type,r.data,e);return i&&ft.setDecoded(n,i),i}function H$(t){return t?.display_name||t?.name||"nameless"}async function Iwe(t,e){if(!t||!e)return null;try{return(await window.NostrTools.nip05.queryProfile(t))?.pubkey===e?t:null}catch{return null}}function x0(t){return new Intl.NumberFormat().format(t)}function V$(t){if(!t||typeof t!="string")return"unknown";try{return`${window.NostrTools.nip19.decode(t).type.toLowerCase()}1${t.slice(5,11)}...${t.slice(-4)}`}catch{return"unknown"}}function kf(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function Owe(t){try{return window.NostrTools.nip19.npubEncode(t)}catch{return null}}function th(t){if(!t||typeof t!="string")return!1;const e=`isEventIdentifier:${t}`,n=ft.getCacheItem("isEventIdentifier",e);if(n!==void 0)return n;const r=t.startsWith("note1")||t.startsWith("nevent1")||t.startsWith("naddr1");return ft.setCacheItem("isEventIdentifier",e,r),r}async function Mwe(t){const{pubkey:e,content:n}=(function(i){const s=i.tags.find((o=>o[0]==="description"))?.[1];if(!s)return{pubkey:null,content:""};try{const o=Nwe(s);let a;try{a=JSON.parse(o)}catch{const c=o.match(/"pubkey"\s*:\s*"([^"]+)"|"content"\s*:\s*"([^"]+)"/g);if(!c)throw new Error("Invalid JSON structure");a={},c.forEach((u=>{const[d,f]=u.split(":").map((h=>h.trim().replace(/"/g,"")));a[d]=f}))}let l=null;return a.pubkey&&(l=typeof a.pubkey=="string"?a.pubkey:String(a.pubkey)),{pubkey:l,content:typeof a.content=="string"?a.content.trim():""}}catch{return{pubkey:null,content:""}}})(t),r=await(async function(i){const s=i.tags.find((o=>o[0].toLowerCase()==="bolt11"))?.[1];if(!s)return"Amount: Unknown";try{const o=window.decodeBolt11(s),a=o.sections.find((l=>l.name==="amount"))?.value;return a?`${x0(Math.floor(a/1e3))} sats`:"Amount: Unknown"}catch{return"Amount: Unknown"}})(t);return{pubkey:e,content:n,satsText:r}}function o4(t){try{return window.NostrTools.nip19.decode(t)}catch{return null}}function Nwe(t){return t.replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/\\\\/g,"\\").replace(/\\(?!(["\\\/bfnrt]|u[0-9a-fA-F]{4}))/g,"").replace(/\\+(["\\/bfnrt])/g,"\\$1").replace(/\\u(?![0-9a-fA-F]{4})/g,"")}class Rwe{constructor(e){this.root=e}displayStats(e){requestAnimationFrame((()=>{const n=this.root?.querySelector(".zap-stats");if(n)try{let r;r=e?e.skeleton?this.#e():e.error?this.createTimeoutStats():this.createNormalStats(e):this.createTimeoutStats(),n.innerHTML=r}catch{n.innerHTML=this.createTimeoutStats()}}))}#e(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
    `}createTimeoutStats(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number text-muted">nostr.band</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number text-muted">Stats</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number text-muted">Unavailable</span></div>
      <div class="stats-item">sats</div>
    `}createNormalStats(e){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number">${x0(e.count)}</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number">${x0(Math.floor(e.msats/1e3))}</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number">${x0(Math.floor(e.maxMsats/1e3))}</span></div>
      <div class="stats-item">sats</div>
    `}}class XC{constructor(e={}){this._validateOptions(e),this._initializeProperties(e)}_validateOptions(e){if(!e.pool?.ensureRelay)throw new Error("Invalid pool object: ensureRelay method is required")}_initializeProperties(e){this.pool=e.pool,this.batchSize=e.batchSize||xt.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_SIZE,this.batchDelay=e.batchDelay||xt.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_DELAY,this.relayUrls=e.relayUrls||xt.BATCH_PROCESSOR_CONFIG.DEFAULT_RELAY_URLS,this.batchQueue=new Set,this.pendingFetches=new Map,this.resolvers=new Map,this.processingItems=new Set,this.batchTimer=null,this.eventCache=new Map,this.maxCacheAge=e.maxCacheAge||xt.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}getOrCreateFetchPromise(e){if(this.pendingFetches.has(e))return this.pendingFetches.get(e);const n=new Promise((r=>{this.resolvers.set(e,r)}));return this.pendingFetches.set(e,n),this.batchQueue.add(e),this._scheduleBatchProcess(),n}_scheduleBatchProcess(){this.batchTimer||(this.batchTimer=setTimeout((()=>{this.batchTimer=null,this._processBatchQueue()}),this.batchDelay))}async _processBatchQueue(){if(this.batchQueue.size===0)return;const e=this._getBatchItems();await this._processBatch(e),this.batchQueue.size>0&&this._scheduleBatchProcess()}_getBatchItems(){const e=Array.from(this.batchQueue).slice(0,this.batchSize);return e.forEach((n=>{this.batchQueue.delete(n),this.processingItems.add(n)})),e}async _processBatch(e){try{await this.onBatchProcess(e)}catch(n){this._handleBatchError(e,n)}finally{this._cleanupBatchItems(e)}}_handleBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanupBatchItems(e){e.forEach((n=>{this.processingItems.delete(n),this.pendingFetches.delete(n),this.resolvers.delete(n)}))}resolveItem(e,n){const r=this.resolvers.get(e);r&&(r(n),this.resolvers.delete(e))}async onBatchProcess(e){throw new Error("onBatchProcess must be implemented by derived class")}onBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanup(e,n,r,i){clearTimeout(e),n&&n.close(),r.forEach((s=>{!i.has(s)&&this.resolvers.has(s)&&this.resolveItem(s,null)}))}_getSubscriptionPool(){return this.pool}async _createSubscriptionPromise(e,n,r,i){if(n?.length)return new Promise((s=>{const o=new Set,a=xt.BATCH_PROCESSOR_CONFIG.TIMEOUT_DURATION;let l,c,u=!1;const d=()=>{u||(u=!0,l&&clearTimeout(l),c&&c.close(),e.forEach((f=>{o.has(f)||this.resolveItem(f,null)})),s())};c=this.pool.subscribeMany(n,r,{onevent:f=>{try{u||(i(f,o),o.size===e.length&&d())}catch{}},oneose:()=>{setTimeout(d,100)},onerror:f=>{}}),l=setTimeout((()=>{u||d()}),a)}));e.forEach((s=>this.resolveItem(s,null)))}setRelayUrls(e){this.relayUrls=Array.isArray(e)?e:[]}getCachedItem(e){const n=this.eventCache.get(e);return this._isValidCache(n)?n.event:(this.eventCache.delete(e),null)}_isValidCache(e){return!!e&&Date.now()-e.timestamp<=this.maxCacheAge}setCachedItem(e,n){this.eventCache.set(e,{event:n,timestamp:Date.now()})}}class Dwe extends XC{constructor(e={}){super(e)}async onBatchProcess(e){if(!e?.length)return;const n=[{ids:e.slice(0,this.batchSize)}];await this._createSubscriptionPromise(e,this.relayUrls,n,((r,i)=>{if(e.includes(r.id)){const s=this.getCachedItem(r.id);(!s||r.created_at>s.created_at)&&(this.setCachedItem(r.id,r),this.resolveItem(r.id,r),i.add(r.id))}}))}}class Lwe extends XC{constructor(e={}){super(e)}_parseAtagValue(e){const n=e.split(":");return n.length!==3?null:{kind:parseInt(n[0]),pubkey:n[1],identifier:n[2]}}async onBatchProcess(e){if(!e?.length)return;const n=[],r={kinds:[],authors:[],"#d":[]};if(e.slice(0,this.batchSize).forEach((s=>{const o=this._parseAtagValue(s);o?(r.kinds.push(o.kind),r.authors.push(o.pubkey),r["#d"].push(o.identifier),n.push(s)):this.resolveItem(s,null)})),n.length===0)return;const i=[r];await this._createSubscriptionPromise(n,this.relayUrls,i,((s,o)=>{const a=n.find((l=>{const c=this._parseAtagValue(l);return c&&s.kind===c.kind&&s.pubkey===c.pubkey&&s.tags.some((u=>u[0]==="d"&&u[1]===c.identifier))}));if(a){const l=this.getCachedItem(a);(!l||s.created_at>l.created_at)&&(this.setCachedItem(a,s),this.resolveItem(a,s),o.add(a))}}))}}class Bwe extends XC{constructor(e={}){const{simplePool:n,config:r}=e;super({pool:n,batchSize:r.BATCH_SIZE||xt.PROFILE_CONFIG.BATCH_SIZE,batchDelay:r.BATCH_DELAY||xt.PROFILE_CONFIG.BATCH_DELAY,relayUrls:r.RELAYS||xt.PROFILE_CONFIG.RELAYS,maxCacheAge:xt.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}),this.config=r}async onBatchProcess(e){if(!this.config.RELAYS?.length)throw new Error("No relays configured for profile fetch");const n=e.filter((o=>{const a=this.getCachedItem(o);return!a||(this.resolveItem(o,a),!1)}));if(n.length===0)return;const r=[{kinds:[0],authors:n}],i=new Map,s=(o,a)=>{const l=i.get(o.pubkey);(!l||o.created_at>l.created_at)&&(i.set(o.pubkey,o),this.setCachedItem(o.pubkey,o)),a.add(o.pubkey)};try{await this._createSubscriptionPromise(n,this.config.RELAYS,r,s),n.forEach((o=>{const a=i.get(o);this.resolveItem(o,a||null)}))}catch(o){this.onBatchError(e,o)}}}var gu=Symbol("verified");function Fwe(t){if(!(t instanceof Object)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var $we=new TextEncoder;function hp(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}var zwe=class{value;next=null;prev=null;constructor(t){this.value=t}},Uwe=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new zwe(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function z2(t){return pr(vd($we.encode((function(e){if(!Fwe(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])})(t))))}var e0=new class{generateSecretKey(){return Do.utils.randomPrivateKey()}getPublicKey(t){return pr(Do.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=pr(Do.getPublicKey(e)),n.id=z2(n),n.sig=pr(Do.sign(z2(n),e)),n[gu]=!0,n}verifyEvent(t){if(typeof t[gu]=="boolean")return t[gu];const e=z2(t);if(e!==t.id)return t[gu]=!1,!1;try{const n=Do.verify(t.sig,e,t.pubkey);return t[gu]=n,n}catch{return t[gu]=!1,!1}}},Hwe=(e0.generateSecretKey,e0.getPublicKey,e0.finalizeEvent,e0.verifyEvent);function Vwe(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}async function Wwe(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}var W$,jwe=t=>(t[gu]=!0,!0),j$=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Uwe;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=hp(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new j$(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Wwe();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=(function(n){let r=n.slice(0,22).indexOf('"EVENT"');if(r===-1)return null;let i=n.slice(r+7+1).indexOf('"');if(i===-1)return null;let s=r+7+1+i,o=n.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return n.slice(s+1,a)})(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=(function(s,o){let a=o.length+3,l=s.indexOf(`"${o}":`)+a,c=s.slice(l).indexOf('"')+l+1;return s.slice(c,c+64)})(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&(function(s,o){for(let a=0;a<s.length;a++)if(Vwe(s[a],o))return!0;return!1})(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t((function(r,i){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",i]],content:""}})(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new qwe(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},qwe=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}},Kwe=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=hp(t);let n=this.relays.get(t);return n||(n=new j$(t,{verifyEvent:this.trustedRelayURLs.has(t)?jwe:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(hp).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(d,f)=>{let h=this.seenOn.get(f);h||(h=new Set,this.seenOn.set(f,h)),h.add(d)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=d=>{s[d]=!0,s.filter((f=>f)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(d,f)=>{o(d),a[d]=f,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=d=>{if(e.alreadyHaveEvent?.(d))return!0;const f=n.has(d);return n.add(d),f},u=Promise.all(Object.entries(t).map((async(d,f,h)=>{if(h.indexOf(d)!==f)return void l(f,"duplicate url");let p,[m,g]=d;m=hp(m);try{p=await this.ensureRelay(m,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(b){return void l(f,b?.message||String(b))}let y=p.subscribe(g,{...e,oneose:()=>o(f),onclose:b=>l(f,b),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)})));return{async close(){await u,r.forEach((d=>{d.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(hp).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{W$=WebSocket}catch{}var q$=class extends Kwe{constructor(){super({verifyEvent:Hwe,websocketImplementation:W$})}};class Wp{static instance=null;#e;#t;#n=!0;#r;constructor(){return Wp.instance?Wp.instance:(this.#i(),Wp.instance=this,this)}#i(){if(this.#e=xt.PROFILE_CONFIG,this.#t=new q$,!this.#t?.ensureRelay)throw new Error("Failed to initialize SimplePool");this.#r=new Bwe({simplePool:this.#t,config:{...this.#e,RELAYS:this.#e.RELAYS||[]}})}get isInitialized(){return this.#n}async fetchProfiles(e){if(!Array.isArray(e)||e.length===0)return[];const n=Date.now(),r=new Array(e.length),i=e.reduce(((s,o,a)=>{const l=ft.getProfile(o);return this.#a(l,n)?r[a]=l:s.push({index:a,pubkey:o}),s}),[]);return i.length>0&&await this.#o(i,r,e),r}async processBatchProfiles(e){const n=this.#s(e);if(n.length!==0)try{await Promise.all([this.fetchProfiles(n),...n.map((r=>this.verifyNip05Async(r)))])}catch{}}async verifyNip05Async(e){const n=ft.getNip05(e);if(n!==void 0)return n;const r=ft.getNip05PendingFetch(e);if(r)return r;const i=this.#c(e);return ft.setNip05PendingFetch(e,i),i}getNip05(e){return ft.getNip05(e)}clearCache(){ft.clearAll(),this.#r.clearPendingFetches()}#a(e,n){return e&&e._lastUpdated&&n-e._lastUpdated<18e5}#s(e){return[...new Set(e?.map((n=>n?.pubkey))?.filter((n=>n&&typeof n=="string"&&n.length===64)))]}async#o(e,n,r){if(!e.length)return;const i=Date.now(),s=e.filter((({pubkey:a})=>a&&typeof a=="string"&&a.length===64));if(s.length===0)return;const o=await Promise.all(s.map((({pubkey:a})=>this.#l(a,i))));s.forEach((({index:a},l)=>{a>=0&&a<n.length&&(n[a]=o[l],r[a]&&ft.setProfile(r[a],o[l]))}))}async#l(e,n){if(!e||typeof e!="string"||e.length!==64)return this.#u();try{const r={kinds:[0],authors:[e],limit:1},i=await this.#r.getOrCreateFetchPromise(e,r);if(!i?.content)return this.#u();let s;try{s=JSON.parse(i.content)}catch{return this.#u()}return{...s,name:H$(s)||"nameless",_lastUpdated:n,_eventCreatedAt:i.created_at}}catch{return this.#u()}}async#c(e){try{const[n]=await this.fetchProfiles([e]);if(!n?.nip05)return ft.setNip05(e,null),null;const r=await Promise.race([Iwe(n.nip05,e),new Promise(((s,o)=>setTimeout((()=>o(new Error("NIP-05 timeout"))),5e3)))]);if(!r)return ft.setNip05(e,null),null;const i=kf(r.startsWith("_@")?r.slice(1):r);return ft.setNip05(e,i),i}catch{return ft.setNip05(e,null),null}finally{ft.deleteNip05PendingFetch(e)}}#u(){return{name:"anonymous",display_name:"anonymous"}}}const Em=new Wp;class Gwe{async loadAndUpdate(e,n){if(e)try{const r=n.querySelector(".sender-name"),i=n.querySelector(".zap-placeholder-name"),s=n.querySelector(".sender-icon"),o=s?.querySelector(".zap-placeholder-icon"),a=n.querySelector(".sender-pubkey");let l=ft.getProfile(e);const c=l?H$(l)||"nameless":"anonymous",u=l?.picture?(function(d){if(!d||typeof d!="string")return null;try{const f=new URL(d);return["http:","https:"].includes(f.protocol)?f.href:null}catch{return null}})(l.picture):null;this.#e(i,r,c),this.#n(o,s,u,c),this.#r(a,e)}catch{this.#i(n)}}#e(e,n,r){e?e.replaceWith(Object.assign(document.createElement("span"),{className:"sender-name",textContent:r})):n&&(n.textContent=r)}#t(e,n="anonymous user's icon"){const r=`https://robohash.org/${e}.png?set=set5&bgset=bg2&size=128x128`,i=ft.getImageCache(r),s=Object.assign(document.createElement("img"),{alt:n,loading:"lazy",className:"profile-icon"});if(i)return s.src=r,s;const o=new Image;return o.onerror=()=>{s.src=i4,ft.setImageCache(r,i4)},o.onload=()=>{ft.setImageCache(r,o)},o.src=r,s.src=r,s}#n(e,n,r,i){if(e&&n){const s=o=>{e.remove();const a=n.querySelector("img"),l=n.querySelector("a");a&&a.remove(),l&&l.remove();const c=o==="robohash"?this.#t(n.closest("[data-pubkey]")?.dataset.pubkey,`${kf(i)}'s icon`):Object.assign(document.createElement("img"),{src:o,alt:`${kf(i)}'s icon`,loading:"lazy",className:"profile-icon"}),u=n.closest("[data-pubkey]")?.dataset.pubkey;if(u){const d=(function(h,p=[]){try{return window.NostrTools.nip19.nprofileEncode({pubkey:h,relays:p})}catch{return null}})(u),f=Object.assign(document.createElement("a"),{href:`https://njump.me/${d}`,target:"_blank",rel:"noopener noreferrer"});f.appendChild(c),n.appendChild(f)}else n.appendChild(c)};if(r){const o=new Image;o.onload=()=>{ft.setImageCache(r,o),s(r)},o.onerror=()=>{s("robohash")},o.src=r}else s("robohash")}}#r(e,n){if(e&&!e.getAttribute("data-nip05-updated")){const r=Em.getNip05(n);r?(e.textContent=r,e.setAttribute("data-nip05-updated","true")):Em.verifyNip05Async(n).then((i=>{i&&(e.textContent=i,e.setAttribute("data-nip05-updated","true"))}))}}#i(e){const n=e.querySelector(".zap-placeholder-icon");if(n){const r=n.parentElement,i=e.closest("[data-pubkey]")?.dataset.pubkey;n.remove(),r.appendChild(this.#t(i))}}async updateProfileElement(e,n){if(!e||!n)return;const r=e.querySelector(".sender-icon img, .zap-placeholder-icon");if(r)if(n.picture){const s=document.createElement("img");s.alt=n.name||"Profile Picture",s.width=32,s.height=32,s.className="profile-icon",s.onerror=()=>{const o=e.getAttribute("data-pubkey");if(o){const a=this.#t(o,n.name||"anonymous user");s.parentElement&&s.parentElement.replaceChild(a,s)}},s.src=n.picture,r.parentElement&&r.parentElement.replaceChild(s,r)}else{const s=e.getAttribute("data-pubkey");if(s){const o=this.#t(s,n.name||"anonymous user");r.parentElement&&r.parentElement.replaceChild(o,r)}}const i=e.querySelector(".sender-name, .zap-placeholder-name");if(i&&(i.textContent=n.display_name||n.name||"anonymous",i.className="sender-name"),n.nip05){const s=e.getAttribute("data-pubkey");if(s){const o=e.querySelector('[data-nip05-target="true"]');o&&await this.updateNip05Display(s,o)}}}}class ji{static#e={1:"content",30023:"title",30030:"title",30009:"name",40:"content",42:"name",31990:"alt"};static#t={UI_COMPONENTS:"Failed to create UI components:",ZAP_ITEM:"Failed to create zap item HTML:",REFERENCE:"Reference component creation failed:"};static createUIComponents(e,n,r){try{const i=this.viewConfigs?.get(n),s=r||i?.identifier,o=th(s)?null:this.#o(e);return{iconComponent:this.#n(),nameComponent:this.#c(e),pubkeyComponent:this.#u(e,s),referenceComponent:this.#d(o)}}catch{return this.#r()}}static#n(){return'<div class="zap-placeholder-icon skeleton"></div>'}static#r(){return{iconComponent:'<div class="zap-placeholder-icon skeleton"></div>',nameComponent:'<div class="zap-placeholder-name skeleton"></div>',pubkeyComponent:"",referenceComponent:""}}static createReferenceComponent(e){return this.#d(this.#o({reference:e}))}static addReferenceToElement(e,n){if(!this.#i(e,n))return;const r=e.querySelector(".zap-content");this.#a(r,n)}static#i(e,n){return e&&n&&e.querySelector(".zap-content")}static#a(e,n){e.querySelectorAll(".zap-reference").forEach((i=>i.remove()));const r=this.createReferenceComponent({reference:n});e.insertAdjacentHTML("beforeend",r)}static getDialogTemplate(){return`
      <dialog class="dialog">
        <h2 class="dialog-title"><a href="#" target="_blank"></a></h2>
        <button class="close-dialog-button">X</button>
        <div class="zap-stats"></div>
        <ul class="dialog-zap-list"></ul>
      </dialog>
    `}static createZapItemHTML(e,n,r,i){try{const s=this.createUIComponents(e,r,i);return this.#s(e,n,s)}catch{return""}}static createNoZapsMessageHTML(e){return`
      <div class="no-zaps-container">
        <div class="no-zaps-message">${e}</div>
      </div>
    `}static#s(e,n,r){const[i,s]=e.satsText.split(" "),o=(a=e.created_at,Math.floor(Date.now()/1e3)-a<86400);var a;return`
      <div class="zap-content">
        <div class="zap-sender${e.comment?" with-comment":""}" data-pubkey="${e.pubkey}">
          <div class="sender-icon${o?" is-new":""}">
            ${r.iconComponent}
          </div>
          <div class="sender-info">
            ${r.nameComponent}
            ${r.pubkeyComponent}
          </div>
          <div class="zap-amount ${n}"><span class="number">${i}</span> ${s}</div>
        </div>
        ${e.comment?`<div class="zap-details"><span class="zap-comment">${kf(e.comment)}</span></div>`:""}
        ${r.referenceComponent}
      </div>
    `}static#o(e){if(!e)return null;if(this.#l(e))return e;if(e.reference&&typeof e.reference=="object"){if(e.reference.reference&&this.#l(e.reference.reference))return e.reference.reference;if(this.#l(e.reference))return e.reference}return null}static#l(e){return e&&typeof e=="object"&&"id"in e&&"tags"in e&&Array.isArray(e.tags)&&"content"in e&&"kind"in e}static#c({senderName:e}){return e?`<span class="sender-name">${kf(e)}</span>`:'<div class="zap-placeholder-name skeleton"></div>'}static#u({pubkey:e,displayIdentifier:n,reference:r},i){const s=!th(i),o=`class="sender-pubkey" data-pubkey="${e}"`;return r&&s?`<span ${o}>${n}</span>`:`<span ${o} data-nip05-target="true">${n}</span>`}static#d(e){if(!this.#l(e))return"";const n=e.id,r=ft.getReferenceComponent(n);if(r)return r;try{const i=this.#h(e),s=this.#g(e),o=this.#f(i,s);return ft.setReferenceComponent(n,o),o}catch{return""}}static#h(e){if(!e?.tags)return"";if(e.kind===31990)return this.#p(e)||"";const n=Array.isArray(e.tags)?e.tags.find((r=>Array.isArray(r)&&r[0]==="d")):null;return n?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.naddrEncode({kind:r,pubkey:i,identifier:s,relays:o})}catch{return null}})(e.kind,e.pubkey,n[1])}`:e.id?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.neventEncode({id:r,kind:i,pubkey:s,relays:o})}catch{return null}})(e.id,e.kind,e.pubkey)}`:""}static#p(e){const n=e.tags.filter((i=>i[0]==="r"));return(n.find((i=>!i.includes("source")))||n[0])?.[1]}static#g(e){if(!e)return"";const n=ji.#e[e.kind];if(n){const r=e.tags.find((i=>Array.isArray(i)&&i[0]===n));if(r&&r[1])return r[1]}if(e.kind===40)try{return JSON.parse(e.content).name||e.content}catch{}return e.content||""}static#f(e,n){return`
      <div class="zap-reference">
        <div class="reference-arrow">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aCBkPSJtNTYwLTEyMC01Ny01NyAxNDQtMTQzSDIwMHYtNDgwaDgwdjQwMGgzNjdMNTAzLTU0NGw1Ni01NyAyNDEgMjQxLTI0MCAyNDBaIiAvPg0KPC9zdmc+" alt="Reference" width="18" height="18" />
        </div>
        <div class="reference-text">${kf(n)}</div>
        <a href="${e}" target="_blank" class="reference-link">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aA0KICAgICAgICBkPSJNNDQwLTI4MEgyODBxLTgzIDAtMTQxLjUtNTguNVQ4MC00ODBxMC04MyA1OC41LTE0MS41VDI4MC02ODBoMTYwdjgwSDI4MHEtNTAgMC04NSAzNXQtMzUgODVxMCA1MCAzNSA4NXQ4NSAzNWgxNjB2ODBaTTMyMC00NDB2LTgwaDMyMHY4MEgzMjBabTIwMCAxNjB2LTgwaDE2MHE1MCAwIDg1LTM1dDM1LTg1cTAtNTAtMzUtODV0LTg1LTM1SDUyMHYtODBoMTYwcTgzIDAgMTQxLjUgNTguNVQ4ODAtNDgwcTAgODMtNTguNSAxNDEuNVQ2ODAtMjgwSDUyMFoiIC8+DQo8L3N2Zz4=" alt="Quick Reference" width="16" height="16" />
        </a>
      </div>
    `}static ZapInfo=class{#m;constructor(e){this.#m=e}static async createFromEvent(e,n={}){return await new ji.ZapInfo(e).extractInfo(n)}static getAmountColorClass(e,n){return(n===void 0?xt.ZAP_AMOUNT_CONFIG.DEFAULT_COLOR_MODE:n)?this.#y(e):xt.ZAP_AMOUNT_CONFIG.DISABLED_CLASS}static#y(e){const{THRESHOLDS:n,DEFAULT_CLASS:r}=xt.ZAP_AMOUNT_CONFIG;return n.find((i=>e>=i.value))?.className||r}async extractInfo(e={}){const n=this.#m.id,r=ft.getZapInfo(n);if(r)return r.colorClass=ji.ZapInfo.getAmountColorClass(r.satsAmount,e.isColorModeEnabled),r;try{const{pubkey:s,content:o,satsText:a}=await Mwe(this.#m),l=parseInt(a.replace(/,/g,"").split(" ")[0],10),c=typeof s=="string"?s:null,u=this.#m.reference||null,d={satsText:a,satsAmount:l,comment:o||"",pubkey:c||"",created_at:this.#m.created_at,displayIdentifier:c?V$(Owe(c)):"anonymous",senderName:null,senderIcon:null,reference:u,colorClass:ji.ZapInfo.getAmountColorClass(l,e?.isColorModeEnabled)};return ft.setZapInfo(n,d),d}catch{const o={satsText:"Amount: Unknown",satsAmount:0,comment:"",pubkey:"",created_at:this.#m.created_at,displayIdentifier:"anonymous",senderName:"anonymous",senderIcon:i,reference:null};return ft.setZapInfo(n,o),o}var i}static async batchExtractInfo(e,n=!0){const r=new Map;return await Promise.all(e.map((async i=>{const s=new ji.ZapInfo(i),o=await s.extractInfo({isColorModeEnabled:n});r.set(i.id,o)}))),r}};static viewConfigs=new Map}class Zwe{constructor(e,n){this.viewId=e,this.config=n}async createListItem(e){const n=await ji.ZapInfo.createFromEvent(e,{isColorModeEnabled:this.config?.isColorModeEnabled}),r=document.createElement("li");return r.className=`zap-list-item ${n.colorClass}${n.comment?" with-comment":""}`,r.setAttribute("data-pubkey",n.pubkey),e?.id&&r.setAttribute("data-event-id",e.id),r.innerHTML=ji.createZapItemHTML(n,n.colorClass,this.viewId),r.setAttribute("data-timestamp",e.created_at.toString()),{li:r,zapInfo:n}}}class Xwe{constructor(e,n,r,i){if(!e)throw new Error("shadowRoot is required");if(!i)throw new Error("config is required");this.shadowRoot=e,this.profileUI=n,this.viewId=r,this.config=i,this.itemBuilder=new Zwe(r,this.config),this.profileUpdateUnsubscribe=null,this.#h()}destroy(){this.profileUpdateUnsubscribe&&(this.profileUpdateUnsubscribe(),this.profileUpdateUnsubscribe=null);const e=this.#e(".dialog-zap-list");e&&(e.innerHTML="")}#e(e){return this.shadowRoot.querySelector(e)}getElementByEventId(e){return this.#e(`.zap-list-item[data-event-id="${e}"]`)}async#t(e){const n=this.#e(".dialog-zap-list");if(n)try{return this.#r(n),await e(n)}catch{n.children.length===0&&this.showNoZapsMessage()}}#n(e,n){const r=e.querySelector(".load-more-trigger");r&&r.remove(),Array.from(n.children).forEach((i=>{const s=i.getAttribute("data-event-id"),o=parseInt(i.getAttribute("data-timestamp"));let a=null;const l=Array.from(e.children);for(let c=0;c<l.length;c++)if(o>parseInt(l[c].getAttribute("data-timestamp"))){a=l[c];break}e.querySelector(`.zap-list-item[data-event-id="${s}"]`)||(a?e.insertBefore(i,a):e.appendChild(i))})),r&&e.appendChild(r)}#r(e){const n=e.querySelector(".no-zaps-message");n&&n.remove()}async#i(e,n){return this.#t((async r=>{const{li:i,zapInfo:s}=await this.itemBuilder.createListItem(e);return n(r,i),await this.#f(s.pubkey,i),{li:i,zapInfo:s}}))}async renderZapListFromCache(e){if(!e?.length)return ft.setNoZapsState(this.viewId,!1),this.showNoZapsMessage();await this.#t((async n=>{const{initialBatch:r,remainingBatch:i}=this.#a(e),{fragment:s,profileUpdates:o}=await this.#s(r);this.#n(n,s),i.length>0?this.#o(i,n,o):await this.#g(o)}))}#a(e){const n=this.#y(e),r=xt.DIALOG_CONFIG.ZAP_LIST.INITIAL_BATCH;return{initialBatch:n.slice(0,r),remainingBatch:n.slice(r)}}async#s(e){const n=document.createDocumentFragment(),r=[];for(const i of e){const{li:s,zapInfo:o}=await this.itemBuilder.createListItem(i);this.#w(i.id,s),n.appendChild(s),o.pubkey&&r.push({pubkey:o.pubkey,element:s})}return{fragment:n,profileUpdates:r}}#o(e,n,r){if(!e.length)return;const i=xt.DIALOG_CONFIG.ZAP_LIST.REMAINING_BATCH;let s=0;const o=async()=>{if(s>=e.length)return void await this.#g(r);const a=e.slice(s,s+i);await this.#l(a,n,r),s+=i,setTimeout((()=>o()),0)};requestIdleCallback((()=>o()))}async#l(e,n,r){const i=document.createDocumentFragment();await Promise.all(e.map((async o=>{const{li:a,zapInfo:l}=await this.itemBuilder.createListItem(o);this.#w(o.id,a),i.appendChild(a),l.pubkey&&r.push({pubkey:l.pubkey,element:a})})));const s=n.querySelector(".load-more-trigger");s&&s.remove(),n.appendChild(i),s&&n.appendChild(s),await new Promise((o=>requestAnimationFrame(o)))}async prependZap(e){return this.#i(e,((n,r)=>n.prepend(r)))}async appendZap(e){return this.#i(e,((n,r)=>{const i=this.#d(n,e.created_at);i?n.insertBefore(r,i):n.appendChild(r)}))}async replacePlaceholderWithZap(e,n){const r=this.#e(`[data-index="${n}"]`);if(this.#b(r))try{const{zapInfo:i}=await this.itemBuilder.createListItem(e);this.#v(r,i,e.id),await this.#f(i.pubkey,r)}catch{r.remove()}}async showNoZapsMessage(){const e=this.#e(".dialog-zap-list");if(e){if(ft.hasNoZaps(this.viewId))return void this.#u(e);await this.#c()||(this.#u(e),ft.setNoZapsState(this.viewId,!0))}}async#c(){const e=this.config.noZapsDelay||xt.DIALOG_CONFIG.DEFAULT_NO_ZAPS_DELAY;await new Promise((r=>setTimeout(r,e)));const n=ft.getZapEvents(this.viewId);return!!n?.length&&(await this.renderZapListFromCache(n),!0)}#u(e){const n=this.config.noZapsMessage||xt.DIALOG_CONFIG.NO_ZAPS_MESSAGE;e.innerHTML=ji.createNoZapsMessageHTML(n),e.style.minHeight=xt.DIALOG_CONFIG.ZAP_LIST.MIN_HEIGHT}async batchUpdate(e,n={}){const r=this.#e(".dialog-zap-list");if(r)try{const i=new Map(Array.from(r.querySelectorAll(".zap-list-item")).map((c=>[c.getAttribute("data-event-id"),c]))),s=this.#y(e),o=th(this.config.identifier),a=s.filter((c=>{const u=i.get(c.id);return o?!u:!u||c.reference&&!u.querySelector(".zap-reference")}));if(a.length===0&&!n.isFullUpdate)return;const l=document.createDocumentFragment();for(const c of a){const{li:u,zapInfo:d}=await this.itemBuilder.createListItem(c);!o&&c.reference&&this.updateZapReference(c),l.appendChild(u),d.pubkey&&await this.#f(d.pubkey,u)}this.#n(r,l)}catch{}}#d(e,n){return Array.from(e.children).find((r=>{const i=parseInt(r.getAttribute("data-timestamp")||"0");return n>i}))}updateZapReference(e){if(e?.id&&e?.reference)try{const n=this.getElementByEventId(e.id);if(!n)return;ji.addReferenceToElement(n,e.reference),ft.setReference(e.id,e.reference)}catch{}}#h(){this.profileUpdateUnsubscribe=ft.subscribeToProfileUpdates(this.#p.bind(this))}async#p(e,n){const r=this.shadowRoot.querySelectorAll(`[data-pubkey="${e}"]`);await Promise.allSettled(Array.from(r).map((i=>this.profileUI.updateProfileElement(i,n))))}async#g(e){const n=xt.DIALOG_CONFIG.ZAP_LIST.PROFILE_BATCH;for(let r=0;r<e.length;r+=n){const i=e.slice(r,r+n);await Promise.all(i.map((({pubkey:s,element:o})=>this.#f(s,o)))),await new Promise((s=>requestAnimationFrame(s)))}}async#f(e,n){e&&await this.#m(e,n)}async#m(e,n){if(e&&n)try{await this.profileUI.loadAndUpdate(e,n)}catch{}}#y(e){return[...new Map(e.map((n=>[n.id,n]))).values()].sort(((n,r)=>r.created_at-n.created_at))}#w(e,n){if(th(this.config.identifier))return;const r=ft.getReference(e);r&&ji.addReferenceToElement(n,r)}#b(e){return e&&e.classList.contains("placeholder")}#v(e,n,r){const i=this.itemBuilder.getAmountColorClass(n.satsAmount);e.className=`zap-list-item ${i}${n.comment?" with-comment":""}`,e.setAttribute("data-pubkey",n.pubkey),e.setAttribute("data-event-id",r),e.innerHTML=ji.createZapItemHTML(n,i,this.viewId),e.removeAttribute("data-index")}}var Qwe=fi(0),Ywe=fi.n(Qwe);const Tm=new class{#e=new Map;#t=new Map;constructor(){}async getZapStats(t,e){const n=await this.#n(e,t);if(n)return n;const r=await this.fetchStats(t);return r&&ft.updateStatsCache(e,t,r),r}async fetchStats(t){try{const e=await this._fetchFromApi(t);return this._formatStats(e)||this.createTimeoutError()}catch(e){return this.handleFetchError(e)}}createTimeoutError(){return{error:!0,timeout:!0}}handleFetchError(t){return{error:!0,timeout:t.message==="STATS_TIMEOUT"}}async _fetchFromApi(t){const e=o4(t);if(!e)return null;const n=`https://api.nostr.band/v0/stats/${e.type==="npub"||e.type==="nprofile"?"profile":"event"}/${t}`,r=new AbortController,i=setTimeout((()=>r.abort()),xt.REQUEST_CONFIG.REQUEST_TIMEOUT);try{return await(await fetch(n,{signal:r.signal})).json()}catch(s){throw s.name==="AbortError"?new Error("STATS_TIMEOUT"):s}finally{clearTimeout(i)}}_formatStats(t){if(!t?.stats)return null;const e=Object.values(t.stats)[0];return e?{count:parseInt(e.zaps_received?.count||e.zaps?.count||0,10),msats:parseInt(e.zaps_received?.msats||e.zaps?.msats||0,10),maxMsats:parseInt(e.zaps_received?.max_msats||e.zaps?.max_msats||0,10)}:null}async initializeStats(t,e,n=!1){if(n&&this.displayStats({skeleton:!0},e),this.#t.has(e))return this.#t.get(e);if(o4(t)?.type==="naddr"){const s=this.createTimeoutError();return this.displayStats(s,e),this.#e.set(e,s),s}const i=(async()=>{try{const s=await this.getZapStats(t,e);return s&&(this.displayStats(s,e),this.#e.set(e,s)),s}catch{return null}finally{this.#t.delete(e)}})();return this.#t.set(e,i),i}async#n(t,e){const n=ft.getCachedStats(t,e),r=Date.now();return n&&r-n.timestamp<xt.REQUEST_CONFIG.CACHE_DURATION?n.stats:null}getCurrentStats(t){return this.#e.get(t)}async handleZapEvent(t,e,n){if(t?.isRealTimeEvent)try{const r=t.tags.find((l=>l[0].toLowerCase()==="bolt11"))?.[1],i=this.extractAmountFromBolt11(r);if(i<=0)return;const s=ft.getViewStats(e),o={count:s?.count||0,msats:s?.msats||0,maxMsats:s?.maxMsats||0},a={count:o.count+1,msats:o.msats+i,maxMsats:Math.max(o.maxMsats,i)};ft.updateStatsCache(e,n,a),this.#e.set(e,a),await this.displayStats(a,e),t.isStatsCalculated=!0,t.amountMsats=i}catch{}}extractAmountFromBolt11(t){try{const e=window.decodeBolt11(t);return parseInt(e.sections.find((n=>n.name==="amount"))?.value??"0",10)}catch{return 0}}async displayStats(t,e){try{await eve(t,e)}catch{}}},Bu=new class{#e;#t;#n;#r;#i;#a;#s;constructor(){this.#e=new q$,this.#o(),this.#l()}#o(){this.#n=new Map,this.#r=new Map,this.#i=new Map,this.#t=!1}#l(){const t={pool:this.#e,batchSize:xt.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_SIZE,batchDelay:xt.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_DELAY};this.#a=new Dwe(t),this.#s=new Lwe(t)}#c(t){this.#n.has(t)||this.#n.set(t,{zap:null}),this.#r.has(t)||this.#r.set(t,{isZapClosed:!1})}#u(t,e,n,r){this.#n.get(t).zap=this.#e.subscribeMany(e.relayUrls,[n.req],r)}#d(t){return t&&t.id&&Array.isArray(t.tags)}#h(t,e){return t&&this.#i.delete(t),null}async connectToRelays(t){this.#t||([this.#a,this.#s].forEach((e=>e.setRelayUrls(t))),this.#t=!0)}subscribeToZaps(t,e,n,r){try{this.#p(n),this.#c(t),this.#r.get(t).isZapClosed=!1,this.#u(t,e,n,this.#g(r))}catch(i){this.#f("Subscription error",i)}}#p(t){if(!t?.req?.kinds||!Array.isArray(t.req.kinds))throw new Error("Invalid subscription settings")}async fetchReference(t,e,n){try{if(!this.#d(e))return null;const r=e.tags.find((l=>Array.isArray(l)&&l[0]===n));if(!r)return null;const i=n==="e"?r[1]:`${r[1]}`,s=ft.getReference(i);if(s)return s;const o=this.#i.get(i);if(o)return o;const a=n==="e"?this.#a:this.#s;try{const l=await a.getOrCreateFetchPromise(i);return l&&ft.setReference(i,l),this.#i.delete(i),l}finally{this.#i.delete(i)}}catch(r){return this.#h(e?.id,r)}}#g(t){const e=Math.floor(Date.now()/1e3);return{...t,onevent:n=>{n.isRealTimeEvent=n.created_at>=e,t.onevent(n)},oneose:t.oneose}}#f(t,e){throw e}get zapPool(){return this.#e}},{zapPool:Q2e}=Bu,Bo=new class{constructor(){this.viewConfigs=new Map,this.configStore=new Map,this.observers=new Map,this.#e=new Map,this.#t=new Map}#e;#t;setZapListUI(t){this.zapListUI=t}setViewConfig(t,e){this.viewConfigs.set(t,e),ji.viewConfigs.set(t,e),ft.initializeZapView(t)}getViewConfig(t){return this.viewConfigs.get(t)}async updateEventReference(t,e){try{const n=this.getViewConfig(e);if(!n?.relayUrls?.length||th(n?.identifier||""))return!1;const r=await this._fetchEventReference(t,n);return!!r&&(t.reference=r,!0)}catch{return!1}}async _fetchEventReference(t,e){const n=async()=>{if(!t?.tags||!Array.isArray(t.tags))return null;try{if(t.tags.find((s=>Array.isArray(s)&&s[0]==="a"))?.[1])return await Bu.fetchReference(e.relayUrls,t,"a");const i=t.tags.find((s=>Array.isArray(s)&&s[0]==="e"));return i?.[1]&&/^[0-9a-f]{64}$/.test(i[1].toLowerCase())?await Bu.fetchReference(e.relayUrls,t,"e"):null}catch{return null}};try{return await ft.getOrFetchReference(t.id,n)}catch{return null}}async updateEventReferenceBatch(t,e){const n=this.getViewConfig(e);if(!n?.relayUrls?.length||th(n?.identifier||""))return;const r=t.map((i=>this.updateEventReference(i,e)));await Promise.allSettled(r)}updateUIReferences(t){this.zapListUI&&t.forEach((e=>{e.reference&&this.zapListUI.updateZapReference(e)}))}async initializeSubscriptions(t,e){try{if(!this._isValidFilter(t))throw new Error("Invalid filter settings");const n=s4(t.identifier);if(!n)throw new Error(xt.ZAP_CONFIG.ERRORS.DECODE_FAILED);this._initializeLoadState(e),this._showInitialLoadingSpinner(e);const{batchEvents:r,lastEventTime:i}=await this._collectInitialEvents(e,t,n);r?.length>0&&this._processBatchEvents(r,e).catch(console.error),await this.finalizeInitialization(e,i)}catch(n){throw n}}_showInitialLoadingSpinner(t){const e=this._getListElement(t);if(e){const n=this._createLoadTrigger();e.appendChild(n)}}async finalizeInitialization(t,e){const n=ft.getZapEvents(t),r=this._getListElement(t),i=ft.updateLoadState(t,{isInitialFetchComplete:!0,lastEventTime:e});await Promise.all([i,n.length===0?this.zapListUI?.showNoZapsMessage():null,n.length>=xt.REQ_CONFIG.INITIAL_LOAD_COUNT?this.setupInfiniteScroll(t):null]),r?.querySelector(".load-more-trigger")?.remove()}_initializeLoadState(t){ft.updateLoadState(t,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1})}_isValidFilter(t){return t&&t.relayUrls&&Array.isArray(t.relayUrls)&&t.relayUrls.length>0&&t.identifier}setupInfiniteScroll(t){try{this._cleanupInfiniteScroll(t);const e=this._getListElement(t);if(!e)return;const n=this._createLoadTrigger();e.appendChild(n),this._observeLoadTrigger(n,t,e)}catch{}}_createLoadTrigger(){const t=document.createElement("div");t.className="load-more-trigger";const e=document.createElement("div");return e.className="loading-spinner",t.appendChild(e),t}_observeLoadTrigger(t,e,n){const r=new IntersectionObserver((i=>this._handleIntersection(i[0],e)),{root:n,rootMargin:xt.INFINITE_SCROLL.ROOT_MARGIN,threshold:xt.INFINITE_SCROLL.THRESHOLD});r.observe(t),this.observers.set(e,r)}async _handleIntersection(t,e){t.isIntersecting&&(ft.getLoadState(e).isLoading?setTimeout((()=>{t.isIntersecting&&this._handleIntersection(t,e)}),xt.INFINITE_SCROLL.RETRY_DELAY):this.loadMoreZaps(e).then((n=>{n===0&&this._cleanupInfiniteScroll(e)})).catch((n=>{this._cleanupInfiniteScroll(e)})))}_cleanupInfiniteScroll(t){const e=this.observers.get(t);if(!e)return;e.disconnect(),this._getListElement(t)?.querySelector(".load-more-trigger")?.remove(),this.observers.delete(t)}_getListElement(t){return document.querySelector(`nzv-dialog[data-view-id="${t}"]`)?.shadowRoot?.querySelector(".dialog-zap-list")}async loadMoreZaps(t){const e=ft.getLoadState(t),n=this.getViewConfig(t);if(!this._canLoadMore(e,n))return 0;e.isLoading=!0;try{const r=await this._executeLoadMore(t,e,n);if(r>0){const i=ft.getZapEvents(t).slice(-r);await this.updateEventReferenceBatch(i,t),this.updateUIReferences(i)}return r}finally{e.isLoading=!1}}async _executeLoadMore(t,e,n){const r=s4(n.identifier,e.lastEventTime);if(!r)return 0;const i=[],s=setTimeout((()=>{i.length===0&&this._cleanupInfiniteScroll(t)}),xt.LOAD_TIMEOUT);try{return await this._collectEvents(t,n,r,i,xt.REQ_CONFIG.ADDITIONAL_LOAD_COUNT,e),i.length>0&&await this._processBatchEvents(i,t),i.length}catch{return 0}finally{clearTimeout(s)}}async _collectEvents(t,e,n,r,i,s){return new Promise(((o,a)=>{const l=setTimeout((()=>a(new Error("Load timeout"))),xt.LOAD_TIMEOUT);Bu.subscribeToZaps(t,e,n,{onevent:c=>{c.created_at<s.lastEventTime&&(r.push(c),s.lastEventTime=Math.min(s.lastEventTime,c.created_at),r.length>=i&&(clearTimeout(l),o()))},oneose:()=>{clearTimeout(l),o()}})}))}async _collectInitialEvents(t,e,n){const r=[];let i=null;return new Promise((s=>{const o=this._setupBufferInterval(r,t),a=Bu.subscribeToZaps(t,e,n,{onevent:l=>{const c=this._handleInitialEvent(l,r,i,t);c!==null&&(i=c)},oneose:()=>{clearInterval(o),s({batchEvents:[...r],lastEventTime:i})}});this.#e.set(t,{zap:a})}))}_handleInitialEvent(t,e,n,r){const i=Math.min(n||t.created_at,t.created_at);if(ft.addZapEvent(r,t)){if(e.push(t),this.updateEventReference(t,r).then((s=>{s&&this.zapListUI&&t.reference&&this.zapListUI.updateZapReference(t)})),t.isRealTimeEvent){const s=this.getViewConfig(r);Tm.handleZapEvent(t,r,s?.identifier),this.zapListUI&&this.zapListUI.prependZap(t).catch(console.error)}e.length>=xt.BATCH_SIZE&&this.zapListUI&&this.zapListUI.batchUpdate(ft.getZapEvents(r)).catch(console.error)}return i}async _processBatchEvents(t,e){if(t?.length){t.sort(((n,r)=>r.created_at-n.created_at)),t.forEach((n=>ft.addZapEvent(e,n)));try{await Promise.all([Em.processBatchProfiles(t)])}catch{}await this._updateUI(t,e)}}async _updateUI(t,e){this.zapListUI&&await this.zapListUI.batchUpdate(t,{isFullUpdate:!0})}_setupBufferInterval(t,e){let n=0;const r=xt.BUFFER_MIN_INTERVAL;return setInterval((()=>{const i=Date.now();t.length>0&&i-n>=r&&this.zapListUI&&(this.zapListUI.batchUpdate(ft.getZapEvents(e),{isBufferUpdate:!0}).catch(console.error),n=i)}),xt.BUFFER_INTERVAL)}_canLoadMore(t,e){return e&&!t.isLoading&&t.lastEventTime}unsubscribe(t){try{const e=this.#e.get(t);e?.zap&&(e.zap(),e.zap=null),this.#t.set(t,{isZapClosed:!0}),this._cleanupInfiniteScroll(t)}catch{}}};class Jwe extends HTMLElement{#e;#t;constructor(){super(),this.attachShadow({mode:"open"}),this.#e={isInitialized:!1,theme:xt.DEFAULT_OPTIONS.theme},this.popStateHandler=e=>{e.preventDefault(),this.#o(".dialog")?.open&&this.closeDialog()}}async connectedCallback(){if(this.viewId=this.getAttribute("data-view-id"),this.viewId){this.#t=this.#n();try{await this.#t,this.#e.isInitialized=!0;const e=Bo.getViewConfig(this.viewId);if(!e)throw new Error("Config is required for initialization");if(await this.#r(e),this.getAttribute("data-nzv-id")){const n=await Tm.getCurrentStats(this.viewId);n&&this.statsUI.displayStats(n)}this.#e.isInitialized=!0,this.dispatchEvent(new CustomEvent("dialog-initialized",{detail:{viewId:this.viewId}}))}catch{}}}async#n(){return new Promise((e=>{const n=document.createElement("template");n.innerHTML=ji.getDialogTemplate(),this.shadowRoot.appendChild(n.content.cloneNode(!0)),this.#i(),queueMicrotask((()=>e()))}))}async#r(e){const n=document.createElement("style");n.textContent=Ywe(),this.shadowRoot.appendChild(n),this.statsUI=new Rwe(this.shadowRoot),this.profileUI=new Gwe,this.zapListUI=new Xwe(this.shadowRoot,this.profileUI,this.viewId,e),Bo.setZapListUI(this.zapListUI);const r=ft.getZapEvents(this.viewId);r?.length?await this.zapListUI.renderZapListFromCache(r):this.zapListUI.showNoZapsMessage();const i=this.getAttribute("data-nzv-id");if(i){const s=await ft.getCachedStats(this.viewId,i);if(s?.stats)this.statsUI.displayStats(s.stats);else{const o=await Tm.getCurrentStats(this.viewId);o&&this.statsUI.displayStats(o)}}}static get observedAttributes(){return["data-theme"]}#i(){const e=this.#o(".dialog");this.#o(".close-dialog-button").addEventListener("click",(()=>this.closeDialog())),e.addEventListener("click",(n=>{n.target===e&&this.closeDialog()})),e.addEventListener("cancel",(n=>{n.preventDefault(),this.closeDialog()})),document.addEventListener("keydown",(n=>{if(e?.open){if(n.key==="Escape")this.closeDialog();else if(n.key===" "){n.preventDefault();const r=this.#o(".dialog-zap-list");r&&(r.scrollTop+=.8*r.clientHeight)}}}))}attributeChangedCallback(e,n,r){n!==r&&e==="data-theme"&&this.#a(r)}#a(e){ft.updateThemeState(this.viewId,{theme:e}).isInitialized&&this.#s()}#s(){const e=ft.getThemeState(this.viewId).theme==="dark"?"dark-theme":"light-theme";this.shadowRoot.host.classList.add(e)}async showDialog(){await this.#t;const e=this.#o(".dialog");e&&!e.open&&this.#e.isInitialized&&(window.addEventListener("popstate",this.popStateHandler),e.showModal(),queueMicrotask((()=>{document.activeElement&&document.activeElement.blur()})),this.#l())}closeDialog(){const e=this.#o(".dialog");e?.open&&(this.zapListUI?.destroy(),Bo.unsubscribe(this.viewId),e.close(),this.remove(),window.removeEventListener("popstate",this.popStateHandler))}displayZapStats(e){this.statsUI.displayStats(e)}#o(e){return this.shadowRoot.querySelector(e)}#l(){const e=this.getAttribute("data-view-id"),n=document.querySelector(`button[data-zap-view-id="${e}"]`);if(!n)return;const r=this.#o(".dialog-title"),i=this.#o(".dialog-title a");if(!i||!r)return;const s=n.getAttribute("data-title"),o=n.getAttribute("data-nzv-id");i.href=o?`https://njump.me/${o}`:"#",s?.trim()?(i.textContent=s,r.classList.add("custom-title")):(i.textContent=xt.DIALOG_CONFIG.DEFAULT_TITLE+V$(o),r.classList.remove("custom-title"))}getOperations(){if(!this.#e.isInitialized)return null;const e={closeDialog:()=>this.closeDialog(),showDialog:()=>this.showDialog()};return this.#e.isInitialized&&Object.assign(e,{prependZap:n=>this.zapListUI?.prependZap(n),displayZapStats:n=>this.statsUI?.displayStats(n),showNoZapsMessage:()=>this.zapListUI?.showNoZapsMessage()}),e}async waitForInitialization(){return this.#t}}customElements.define("nzv-dialog",Jwe);const Eb={create:async(t,e)=>{if(!t||!e)return Promise.reject(new Error("Invalid viewId or config"));Bo.setViewConfig(t,e);const n=document.querySelector(`nzv-dialog[data-view-id="${t}"]`);if(n)return n;const r=document.createElement("nzv-dialog");r.setAttribute("data-view-id",t),r.setAttribute("data-config",JSON.stringify(e));const i=document.querySelector(`button[data-zap-view-id="${t}"]`);return i?.getAttribute("data-nzv-id")&&r.setAttribute("data-nzv-id",i.getAttribute("data-nzv-id")),document.body.appendChild(r),await r.waitForInitialization(),r},get:t=>document.querySelector(`nzv-dialog[data-view-id="${t}"]`),execute:(t,e,...n)=>{const r=Eb.get(t),i=r?.getOperations();return i?i[e]?.(...n)??null:null}},eve=(t,e)=>Eb.execute(e,"displayZapStats",t);async function tve(t,e){try{const n=km.fromButton(t);if(!n)throw new Error("Failed to create config from button");if(Bo.setViewConfig(e,n),!await(async function(i){try{const s=Bo.getViewConfig(i);if(!s)throw new Error(`View configuration not found for viewId: ${i}`);return Bo.setViewConfig(i,s),await Eb.create(i,s)}catch{return null}})(e))throw new Error(xt.ZAP_CONFIG.ERRORS.DIALOG_NOT_FOUND);await(async function(i){try{const s=Eb.get(i);if(!s)throw new Error("Dialog not found");await s.waitForInitialization();const o=s.getOperations();if(!o?.showDialog)throw new Error("Basic dialog operations not available");o.showDialog()}catch{}})(e),setTimeout((async()=>{if(await(async function(i,s){const o=ft.getZapEvents(i);if(o.length>0){const l=[...new Set(o.map((c=>c.pubkey)))];Em.fetchProfiles(l)}const{hasEnoughCachedEvents:a}=await ft.processCachedData(i,s);return a&&Bo.setupInfiniteScroll(i),a})(e,n),!t.hasAttribute("data-initialized")){const i=t.getAttribute("data-nzv-id");await Promise.all([Bu.connectToRelays(n.relayUrls),Bo.initializeSubscriptions(n,e),i?Tm.initializeStats(i,e,!0):Promise.resolve()]),t.setAttribute("data-initialized","true")}}),0)}catch{}}function K$(){Object.entries(xt.LIBRARIES).forEach((([t,e])=>{window[t]=e})),document.querySelectorAll("button[data-nzv-id]").forEach(((t,e)=>{if(t.hasAttribute("data-zap-view-id"))return;const n=`nostr-zap-view-${e}`;t.setAttribute("data-zap-view-id",n),t.hasAttribute("data-zap-color-mode")||t.setAttribute("data-zap-color-mode",xt.ZAP_CONFIG.DEFAULT_COLOR_MODE),t.addEventListener("click",(()=>tve(t,n)))}))}function G$(t={}){Object.assign(xt,t),typeof window<"u"&&K$()}function nve(t={}){return G$(t)}typeof window<"u"&&document.addEventListener("DOMContentLoaded",K$);ua.vQ;ua.ZM;ua.yk;ua.h0;ua.n_;var rve=ua.Xz;ua.Uv;ua.fU;ua.Dw;var a4={},l4;function ive(){if(l4)return a4;l4=1;var t=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof TA<"u"?TA:{};function e(v){return v&&v.__esModule?v.default:v}var n={},r={},i=t.parcelRequire1faa;i==null&&(i=function(v){if(v in n)return n[v].exports;if(v in r){var w=r[v];delete r[v];var I={id:v,exports:{}};return n[v]=I,w.call(I.exports,I,I.exports),I.exports}var D=new Error("Cannot find module '"+v+"'");throw D.code="MODULE_NOT_FOUND",D},i.register=function(w,I){r[w]=I},t.parcelRequire1faa=i),i.register("58QMB",function(v,w){(function(){function I(K,J){var le,me=Object.keys(J);for(le=0;le<me.length;le++)K=K.replace(new RegExp("\\{"+me[le]+"\\}","gi"),J[me[le]]);return K}function D(K){var J,le,me;if(!K)throw new Error("cannot create a random attribute name for an undefined object");J="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",le="";do for(le="",me=0;me<12;me++)le+=J[Math.floor(Math.random()*J.length)];while(K[le]);return le}function $(K){var J={left:"start",right:"end",center:"middle",start:"start",end:"end"};return J[K]||J.start}function H(K){var J={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return J[K]||J.alphabetic}var X,j,fe,be,he;he=(function(K,J){var le,me,ke,Pe={};for(K=K.split(","),J=J||10,le=0;le<K.length;le+=2)me="&"+K[le+1]+";",ke=parseInt(K[le],J),Pe[me]="&#"+ke+";";return Pe["\\xa0"]="&#160;",Pe})("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),X={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},fe=function(K,J){this.__root=K,this.__ctx=J},fe.prototype.addColorStop=function(K,J){var le,me,ke=this.__ctx.__createElement("stop");ke.setAttribute("offset",K),J.indexOf("rgba")!==-1?(le=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,me=le.exec(J),ke.setAttribute("stop-color",I("rgb({r},{g},{b})",{r:me[1],g:me[2],b:me[3]})),ke.setAttribute("stop-opacity",me[4])):ke.setAttribute("stop-color",J),this.__root.appendChild(ke)},be=function(K,J){this.__root=K,this.__ctx=J},j=function(K){var J,le={width:500,height:500,enableMirroring:!1};if(arguments.length>1?(J=le,J.width=arguments[0],J.height=arguments[1]):J=K||le,!(this instanceof j))return new j(J);this.width=J.width||le.width,this.height=J.height||le.height,this.enableMirroring=J.enableMirroring!==void 0?J.enableMirroring:le.enableMirroring,this.canvas=this,this.__document=J.document||document,J.ctx?this.__ctx=J.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)},j.prototype.__createElement=function(K,J,le){J===void 0&&(J={});var me,ke,Pe=this.__document.createElementNS("http://www.w3.org/2000/svg",K),qe=Object.keys(J);for(le&&(Pe.setAttribute("fill","none"),Pe.setAttribute("stroke","none")),me=0;me<qe.length;me++)ke=qe[me],Pe.setAttribute(ke,J[ke]);return Pe},j.prototype.__setDefaultStyles=function(){var K,J,le=Object.keys(X);for(K=0;K<le.length;K++)J=le[K],this[J]=X[J].canvas},j.prototype.__applyStyleState=function(K){var J,le,me=Object.keys(K);for(J=0;J<me.length;J++)le=me[J],this[le]=K[le]},j.prototype.__getStyleState=function(){var K,J,le={},me=Object.keys(X);for(K=0;K<me.length;K++)J=me[K],le[J]=this[J];return le},j.prototype.__applyStyleToCurrentElement=function(K){var J=this.__currentElement,le=this.__currentElementsToStyle;le&&(J.setAttribute(K,""),J=le.element,le.children.forEach(function(dn){dn.setAttribute(K,"")}));var me,ke,Pe,qe,Le,st,tt=Object.keys(X);for(me=0;me<tt.length;me++)if(ke=X[tt[me]],Pe=this[tt[me]],ke.apply){if(Pe instanceof be){if(Pe.__ctx)for(;Pe.__ctx.__defs.childNodes.length;)qe=Pe.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[qe]=qe,this.__defs.appendChild(Pe.__ctx.__defs.childNodes[0]);J.setAttribute(ke.apply,I("url(#{id})",{id:Pe.__root.getAttribute("id")}))}else if(Pe instanceof fe)J.setAttribute(ke.apply,I("url(#{id})",{id:Pe.__root.getAttribute("id")}));else if(ke.apply.indexOf(K)!==-1&&ke.svg!==Pe)if(ke.svgAttr!=="stroke"&&ke.svgAttr!=="fill"||Pe.indexOf("rgba")===-1){var Je=ke.svgAttr;if(tt[me]==="globalAlpha"&&(Je=K+"-"+ke.svgAttr,J.getAttribute(Je)))continue;J.setAttribute(Je,Pe)}else{Le=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,st=Le.exec(Pe),J.setAttribute(ke.svgAttr,I("rgb({r},{g},{b})",{r:st[1],g:st[2],b:st[3]}));var ot=st[4],dt=this.globalAlpha;dt!=null&&(ot*=dt),J.setAttribute(ke.svgAttr+"-opacity",ot)}}},j.prototype.__closestGroupOrSvg=function(K){return K=K||this.__currentElement,K.nodeName==="g"||K.nodeName==="svg"?K:this.__closestGroupOrSvg(K.parentNode)},j.prototype.getSerializedSvg=function(K){var J,le,me,ke,Pe,qe,Le=new XMLSerializer().serializeToString(this.__root);if(qe=/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi,qe.test(Le)&&(Le=Le.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),K)for(J=Object.keys(he),le=0;le<J.length;le++)me=J[le],ke=he[me],Pe=new RegExp(me,"gi"),Pe.test(Le)&&(Le=Le.replace(Pe,ke));return Le},j.prototype.getSvg=function(){return this.__root},j.prototype.save=function(){var K=this.__createElement("g"),J=this.__closestGroupOrSvg();this.__groupStack.push(J),J.appendChild(K),this.__currentElement=K,this.__stack.push(this.__getStyleState())},j.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var K=this.__stack.pop();this.__applyStyleState(K)},j.prototype.__addTransform=function(K){var J=this.__closestGroupOrSvg();if(J.childNodes.length>0){this.__currentElement.nodeName==="path"&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:J,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var le=this.__createElement("g");J.appendChild(le),this.__currentElement=le}var me=this.__currentElement.getAttribute("transform");me?me+=" ":me="",me+=K,this.__currentElement.setAttribute("transform",me)},j.prototype.scale=function(K,J){J===void 0&&(J=K),this.__addTransform(I("scale({x},{y})",{x:K,y:J}))},j.prototype.rotate=function(K){var J=180*K/Math.PI;this.__addTransform(I("rotate({angle},{cx},{cy})",{angle:J,cx:0,cy:0}))},j.prototype.translate=function(K,J){this.__addTransform(I("translate({x},{y})",{x:K,y:J}))},j.prototype.transform=function(K,J,le,me,ke,Pe){this.__addTransform(I("matrix({a},{b},{c},{d},{e},{f})",{a:K,b:J,c:le,d:me,e:ke,f:Pe}))},j.prototype.beginPath=function(){var K,J;this.__currentDefaultPath="",this.__currentPosition={},K=this.__createElement("path",{},!0),J=this.__closestGroupOrSvg(),J.appendChild(K),this.__currentElement=K},j.prototype.__applyCurrentDefaultPath=function(){var K=this.__currentElement;K.nodeName==="path"?K.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",K.nodeName)},j.prototype.__addPathCommand=function(K){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=K},j.prototype.moveTo=function(K,J){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.__currentPosition={x:K,y:J},this.__addPathCommand(I("M {x} {y}",{x:K,y:J}))},j.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},j.prototype.lineTo=function(K,J){this.__currentPosition={x:K,y:J},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(I("L {x} {y}",{x:K,y:J})):this.__addPathCommand(I("M {x} {y}",{x:K,y:J}))},j.prototype.bezierCurveTo=function(K,J,le,me,ke,Pe){this.__currentPosition={x:ke,y:Pe},this.__addPathCommand(I("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:K,cp1y:J,cp2x:le,cp2y:me,x:ke,y:Pe}))},j.prototype.quadraticCurveTo=function(K,J,le,me){this.__currentPosition={x:le,y:me},this.__addPathCommand(I("Q {cpx} {cpy} {x} {y}",{cpx:K,cpy:J,x:le,y:me}))};var ge=function(K){var J=Math.sqrt(K[0]*K[0]+K[1]*K[1]);return[K[0]/J,K[1]/J]};j.prototype.arcTo=function(K,J,le,me,ke){var Pe=this.__currentPosition&&this.__currentPosition.x,qe=this.__currentPosition&&this.__currentPosition.y;if(Pe!==void 0&&qe!==void 0){if(ke<0)throw new Error("IndexSizeError: The radius provided ("+ke+") is negative.");if(Pe===K&&qe===J||K===le&&J===me||ke===0)return void this.lineTo(K,J);var Le=ge([Pe-K,qe-J]),st=ge([le-K,me-J]);if(Le[0]*st[1]==Le[1]*st[0])return void this.lineTo(K,J);var tt=Le[0]*st[0]+Le[1]*st[1],Je=Math.acos(Math.abs(tt)),ot=ge([Le[0]+st[0],Le[1]+st[1]]),dt=ke/Math.sin(Je/2),dn=K+dt*ot[0],re=J+dt*ot[1],se=[-Le[1],Le[0]],ee=[st[1],-st[0]],pe=function(Xe){var Ie=Xe[0];return Xe[1]>=0?Math.acos(Ie):-Math.acos(Ie)},xe=pe(se),De=pe(ee);this.lineTo(dn+se[0]*ke,re+se[1]*ke),this.arc(dn,re,ke,xe,De)}},j.prototype.stroke=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},j.prototype.fill=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},j.prototype.rect=function(K,J,le,me){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.moveTo(K,J),this.lineTo(K+le,J),this.lineTo(K+le,J+me),this.lineTo(K,J+me),this.lineTo(K,J),this.closePath()},j.prototype.fillRect=function(K,J,le,me){var ke,Pe;ke=this.__createElement("rect",{x:K,y:J,width:le,height:me,"shape-rendering":"crispEdges"},!0),Pe=this.__closestGroupOrSvg(),Pe.appendChild(ke),this.__currentElement=ke,this.__applyStyleToCurrentElement("fill")},j.prototype.strokeRect=function(K,J,le,me){var ke,Pe;ke=this.__createElement("rect",{x:K,y:J,width:le,height:me},!0),Pe=this.__closestGroupOrSvg(),Pe.appendChild(ke),this.__currentElement=ke,this.__applyStyleToCurrentElement("stroke")},j.prototype.__clearCanvas=function(){for(var K=this.__closestGroupOrSvg(),J=K.getAttribute("transform"),le=this.__root.childNodes[1],me=le.childNodes,ke=me.length-1;ke>=0;ke--)me[ke]&&le.removeChild(me[ke]);this.__currentElement=le,this.__groupStack=[],J&&this.__addTransform(J)},j.prototype.clearRect=function(K,J,le,me){if(K===0&&J===0&&le===this.width&&me===this.height)return void this.__clearCanvas();var ke,Pe=this.__closestGroupOrSvg();ke=this.__createElement("rect",{x:K,y:J,width:le,height:me,fill:"#FFFFFF"},!0),Pe.appendChild(ke)},j.prototype.createLinearGradient=function(K,J,le,me){var ke=this.__createElement("linearGradient",{id:D(this.__ids),x1:K+"px",x2:le+"px",y1:J+"px",y2:me+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(ke),new fe(ke,this)},j.prototype.createRadialGradient=function(K,J,le,me,ke,Pe){var qe=this.__createElement("radialGradient",{id:D(this.__ids),cx:me+"px",cy:ke+"px",r:Pe+"px",fx:K+"px",fy:J+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(qe),new fe(qe,this)},j.prototype.__parseFont=function(){var K=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i,J=K.exec(this.font),le={style:J[1]||"normal",size:J[4]||"10px",family:J[6]||"sans-serif",weight:J[3]||"normal",decoration:J[2]||"normal",href:null};return this.__fontUnderline==="underline"&&(le.decoration="underline"),this.__fontHref&&(le.href=this.__fontHref),le},j.prototype.__wrapTextLink=function(K,J){if(K.href){var le=this.__createElement("a");return le.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",K.href),le.appendChild(J),le}return J},j.prototype.__applyText=function(K,J,le,me){var ke=this.__parseFont(),Pe=this.__closestGroupOrSvg(),qe=this.__createElement("text",{"font-family":ke.family,"font-size":ke.size,"font-style":ke.style,"font-weight":ke.weight,"text-decoration":ke.decoration,x:J,y:le,"text-anchor":$(this.textAlign),"dominant-baseline":H(this.textBaseline)},!0);qe.appendChild(this.__document.createTextNode(K)),this.__currentElement=qe,this.__applyStyleToCurrentElement(me),Pe.appendChild(this.__wrapTextLink(ke,qe))},j.prototype.fillText=function(K,J,le){this.__applyText(K,J,le,"fill")},j.prototype.strokeText=function(K,J,le){this.__applyText(K,J,le,"stroke")},j.prototype.measureText=function(K){return this.__ctx.font=this.font,this.__ctx.measureText(K)},j.prototype.arc=function(K,J,le,me,ke,Pe){if(me!==ke){me%=2*Math.PI,ke%=2*Math.PI,me===ke&&(ke=(ke+2*Math.PI-.001*(Pe?-1:1))%(2*Math.PI));var qe=K+le*Math.cos(ke),Le=J+le*Math.sin(ke),st=K+le*Math.cos(me),tt=J+le*Math.sin(me),Je=Pe?0:1,ot=0,dt=ke-me;dt<0&&(dt+=2*Math.PI),ot=Pe?dt>Math.PI?0:1:dt>Math.PI?1:0,this.lineTo(st,tt),this.__addPathCommand(I("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:le,ry:le,xAxisRotation:0,largeArcFlag:ot,sweepFlag:Je,endX:qe,endY:Le})),this.__currentPosition={x:qe,y:Le}}},j.prototype.clip=function(){var K=this.__closestGroupOrSvg(),J=this.__createElement("clipPath"),le=D(this.__ids),me=this.__createElement("g");this.__applyCurrentDefaultPath(),K.removeChild(this.__currentElement),J.setAttribute("id",le),J.appendChild(this.__currentElement),this.__defs.appendChild(J),K.setAttribute("clip-path",I("url(#{id})",{id:le})),K.appendChild(me),this.__currentElement=me},j.prototype.drawImage=function(){var K,J,le,me,ke,Pe,qe,Le,st,tt,Je,ot,dt,dn,re=Array.prototype.slice.call(arguments),se=re[0],ee=0,pe=0;if(re.length===3)K=re[1],J=re[2],ke=se.width,Pe=se.height,le=ke,me=Pe;else if(re.length===5)K=re[1],J=re[2],le=re[3],me=re[4],ke=se.width,Pe=se.height;else{if(re.length!==9)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);ee=re[1],pe=re[2],ke=re[3],Pe=re[4],K=re[5],J=re[6],le=re[7],me=re[8]}qe=this.__closestGroupOrSvg(),this.__currentElement;var xe="translate("+K+", "+J+")";if(se instanceof j){if(Le=se.getSvg().cloneNode(!0),Le.childNodes&&Le.childNodes.length>1){for(st=Le.childNodes[0];st.childNodes.length;)dn=st.childNodes[0].getAttribute("id"),this.__ids[dn]=dn,this.__defs.appendChild(st.childNodes[0]);if(tt=Le.childNodes[1]){var De,Xe=tt.getAttribute("transform");De=Xe?Xe+" "+xe:xe,tt.setAttribute("transform",De),qe.appendChild(tt)}}}else se.nodeName!=="CANVAS"&&se.nodeName!=="IMG"||(Je=this.__createElement("image"),Je.setAttribute("width",le),Je.setAttribute("height",me),Je.setAttribute("preserveAspectRatio","none"),Je.setAttribute("opacity",this.globalAlpha),(ee||pe||ke!==se.width||Pe!==se.height)&&(ot=this.__document.createElement("canvas"),ot.width=le,ot.height=me,dt=ot.getContext("2d"),dt.drawImage(se,ee,pe,ke,Pe,0,0,le,me),se=ot),Je.setAttribute("transform",xe),Je.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",se.nodeName==="CANVAS"?se.toDataURL():se.originalSrc),qe.appendChild(Je))},j.prototype.createPattern=function(K,J){var le,me=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),ke=D(this.__ids);return me.setAttribute("id",ke),me.setAttribute("width",K.width),me.setAttribute("height",K.height),K.nodeName==="CANVAS"||K.nodeName==="IMG"?(le=this.__document.createElementNS("http://www.w3.org/2000/svg","image"),le.setAttribute("width",K.width),le.setAttribute("height",K.height),le.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",K.nodeName==="CANVAS"?K.toDataURL():K.getAttribute("src")),me.appendChild(le),this.__defs.appendChild(me)):K instanceof j&&(me.appendChild(K.__root.childNodes[1]),this.__defs.appendChild(me)),new be(me,this)},j.prototype.setLineDash=function(K){K&&K.length>0?this.lineDash=K.join(","):this.lineDash=null},j.prototype.drawFocusRing=function(){},j.prototype.createImageData=function(){},j.prototype.getImageData=function(){},j.prototype.putImageData=function(){},j.prototype.globalCompositeOperation=function(){},j.prototype.setTransform=function(){},typeof window=="object"&&(window.C2S=j),typeof v.exports=="object"&&(v.exports=j)})(),(function(){function I(re,se,ee){this.mode=qe.MODE_8BIT_BYTE,this.data=re,this.parsedData=[];for(var pe=0,xe=this.data.length;pe<xe;pe++){var De=[],Xe=this.data.charCodeAt(pe);se?De[0]=Xe:Xe>65536?(De[0]=240|(1835008&Xe)>>>18,De[1]=128|(258048&Xe)>>>12,De[2]=128|(4032&Xe)>>>6,De[3]=128|63&Xe):Xe>2048?(De[0]=224|(61440&Xe)>>>12,De[1]=128|(4032&Xe)>>>6,De[2]=128|63&Xe):Xe>128?(De[0]=192|(1984&Xe)>>>6,De[1]=128|63&Xe):De[0]=Xe,this.parsedData.push(De)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),ee||this.parsedData.length==this.data.length||(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function D(re,se){this.typeNumber=re,this.errorCorrectLevel=se,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function $(re,se){if(re.length==he)throw new Error(re.length+"/"+se);for(var ee=0;ee<re.length&&re[ee]==0;)ee++;this.num=new Array(re.length-ee+se);for(var pe=0;pe<re.length-ee;pe++)this.num[pe]=re[pe+ee]}function H(re,se){this.totalCount=re,this.dataCount=se}function X(){this.buffer=[],this.length=0}function j(){var re=!1,se=navigator.userAgent;if(/android/i.test(se)){re=!0;var ee=se.toString().match(/android ([0-9]\.[0-9])/i);ee&&ee[1]&&(re=parseFloat(ee[1]))}return re}function fe(re,se){for(var ee=se.correctLevel,pe=1,xe=be(re),De=0,Xe=dt.length;De<Xe;De++){var Ie=0;switch(ee){case Le.L:Ie=dt[De][0];break;case Le.M:Ie=dt[De][1];break;case Le.Q:Ie=dt[De][2];break;case Le.H:Ie=dt[De][3]}if(xe<=Ie)break;pe++}if(pe>dt.length)throw new Error("Too long data. the CorrectLevel."+["M","L","H","Q"][ee]+" limit length is "+Ie);return se.version!=0&&(pe<=se.version?(pe=se.version,se.runVersion=pe):(console.warn("QR Code version "+se.version+" too small, run version use "+pe),se.runVersion=pe)),pe}function be(re){var se=encodeURI(re).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return se.length+(se.length!=re.length?3:0)}var he,ge,K=typeof t=="object"&&t&&t.Object===Object&&t,J=typeof self=="object"&&self&&self.Object===Object&&self,le=K||J||Function("return this")(),me=w&&!w.nodeType&&w,ke=me&&!0&&v&&!v.nodeType&&v,Pe=le.QRCode;I.prototype={getLength:function(re){return this.parsedData.length},write:function(re){for(var se=0,ee=this.parsedData.length;se<ee;se++)re.put(this.parsedData[se],8)}},D.prototype={addData:function(re,se,ee){var pe=new I(re,se,ee);this.dataList.push(pe),this.dataCache=null},isDark:function(re,se){if(re<0||this.moduleCount<=re||se<0||this.moduleCount<=se)throw new Error(re+","+se);return this.modules[re][se][0]},getEye:function(re,se){if(re<0||this.moduleCount<=re||se<0||this.moduleCount<=se)throw new Error(re+","+se);var ee=this.modules[re][se];if(ee[1]){var pe="P"+ee[1]+"_"+ee[2];return ee[2]=="A"&&(pe="A"+ee[1]),{isDark:ee[0],type:pe}}return null},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(re,se){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var ee=0;ee<this.moduleCount;ee++){this.modules[ee]=new Array(this.moduleCount);for(var pe=0;pe<this.moduleCount;pe++)this.modules[ee][pe]=[]}this.setupPositionProbePattern(0,0,"TL"),this.setupPositionProbePattern(this.moduleCount-7,0,"BL"),this.setupPositionProbePattern(0,this.moduleCount-7,"TR"),this.setupPositionAdjustPattern("A"),this.setupTimingPattern(),this.setupTypeInfo(re,se),this.typeNumber>=7&&this.setupTypeNumber(re),this.dataCache==null&&(this.dataCache=D.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,se)},setupPositionProbePattern:function(re,se,ee){for(var pe=-1;pe<=7;pe++)if(!(re+pe<=-1||this.moduleCount<=re+pe))for(var xe=-1;xe<=7;xe++)se+xe<=-1||this.moduleCount<=se+xe||(0<=pe&&pe<=6&&(xe==0||xe==6)||0<=xe&&xe<=6&&(pe==0||pe==6)||2<=pe&&pe<=4&&2<=xe&&xe<=4?(this.modules[re+pe][se+xe][0]=!0,this.modules[re+pe][se+xe][2]=ee,this.modules[re+pe][se+xe][1]=pe==-0||xe==-0||pe==6||xe==6?"O":"I"):this.modules[re+pe][se+xe][0]=!1)},getBestMaskPattern:function(){for(var re=0,se=0,ee=0;ee<8;ee++){this.makeImpl(!0,ee);var pe=tt.getLostPoint(this);(ee==0||re>pe)&&(re=pe,se=ee)}return se},createMovieClip:function(re,se,ee){var pe=re.createEmptyMovieClip(se,ee);this.make();for(var xe=0;xe<this.modules.length;xe++)for(var De=1*xe,Xe=0;Xe<this.modules[xe].length;Xe++){var Ie=1*Xe,ue=this.modules[xe][Xe][0];ue&&(pe.beginFill(0,100),pe.moveTo(Ie,De),pe.lineTo(Ie+1,De),pe.lineTo(Ie+1,De+1),pe.lineTo(Ie,De+1),pe.endFill())}return pe},setupTimingPattern:function(){for(var re=8;re<this.moduleCount-8;re++)this.modules[re][6][0]==null&&(this.modules[re][6][0]=re%2==0);for(var se=8;se<this.moduleCount-8;se++)this.modules[6][se][0]==null&&(this.modules[6][se][0]=se%2==0)},setupPositionAdjustPattern:function(re){for(var se=tt.getPatternPosition(this.typeNumber),ee=0;ee<se.length;ee++)for(var pe=0;pe<se.length;pe++){var xe=se[ee],De=se[pe];if(this.modules[xe][De][0]==null)for(var Xe=-2;Xe<=2;Xe++)for(var Ie=-2;Ie<=2;Ie++)Xe==-2||Xe==2||Ie==-2||Ie==2||Xe==0&&Ie==0?(this.modules[xe+Xe][De+Ie][0]=!0,this.modules[xe+Xe][De+Ie][2]=re,this.modules[xe+Xe][De+Ie][1]=Xe==-2||Ie==-2||Xe==2||Ie==2?"O":"I"):this.modules[xe+Xe][De+Ie][0]=!1}},setupTypeNumber:function(re){for(var se=tt.getBCHTypeNumber(this.typeNumber),ee=0;ee<18;ee++){var pe=!re&&(se>>ee&1)==1;this.modules[Math.floor(ee/3)][ee%3+this.moduleCount-8-3][0]=pe}for(var ee=0;ee<18;ee++){var pe=!re&&(se>>ee&1)==1;this.modules[ee%3+this.moduleCount-8-3][Math.floor(ee/3)][0]=pe}},setupTypeInfo:function(re,se){for(var ee=this.errorCorrectLevel<<3|se,pe=tt.getBCHTypeInfo(ee),xe=0;xe<15;xe++){var De=!re&&(pe>>xe&1)==1;xe<6?this.modules[xe][8][0]=De:xe<8?this.modules[xe+1][8][0]=De:this.modules[this.moduleCount-15+xe][8][0]=De}for(var xe=0;xe<15;xe++){var De=!re&&(pe>>xe&1)==1;xe<8?this.modules[8][this.moduleCount-xe-1][0]=De:xe<9?this.modules[8][15-xe-1+1][0]=De:this.modules[8][15-xe-1][0]=De}this.modules[this.moduleCount-8][8][0]=!re},mapData:function(re,se){for(var ee=-1,pe=this.moduleCount-1,xe=7,De=0,Xe=this.moduleCount-1;Xe>0;Xe-=2)for(Xe==6&&Xe--;;){for(var Ie=0;Ie<2;Ie++)if(this.modules[pe][Xe-Ie][0]==null){var ue=!1;De<re.length&&(ue=(re[De]>>>xe&1)==1);var gn=tt.getMask(se,pe,Xe-Ie);gn&&(ue=!ue),this.modules[pe][Xe-Ie][0]=ue,xe--,xe==-1&&(De++,xe=7)}if((pe+=ee)<0||this.moduleCount<=pe){pe-=ee,ee=-ee;break}}}},D.PAD0=236,D.PAD1=17,D.createData=function(re,se,ee){for(var pe=H.getRSBlocks(re,se),xe=new X,De=0;De<ee.length;De++){var Xe=ee[De];xe.put(Xe.mode,4),xe.put(Xe.getLength(),tt.getLengthInBits(Xe.mode,re)),Xe.write(xe)}for(var Ie=0,De=0;De<pe.length;De++)Ie+=pe[De].dataCount;if(xe.getLengthInBits()>8*Ie)throw new Error("code length overflow. ("+xe.getLengthInBits()+">"+8*Ie+")");for(xe.getLengthInBits()+4<=8*Ie&&xe.put(0,4);xe.getLengthInBits()%8!=0;)xe.putBit(!1);for(;!(xe.getLengthInBits()>=8*Ie||(xe.put(D.PAD0,8),xe.getLengthInBits()>=8*Ie));)xe.put(D.PAD1,8);return D.createBytes(xe,pe)},D.createBytes=function(re,se){for(var ee=0,pe=0,xe=0,De=new Array(se.length),Xe=new Array(se.length),Ie=0;Ie<se.length;Ie++){var ue=se[Ie].dataCount,gn=se[Ie].totalCount-ue;pe=Math.max(pe,ue),xe=Math.max(xe,gn),De[Ie]=new Array(ue);for(var Ct=0;Ct<De[Ie].length;Ct++)De[Ie][Ct]=255&re.buffer[Ct+ee];ee+=ue;var tr=tt.getErrorCorrectPolynomial(gn),mt=new $(De[Ie],tr.getLength()-1),$i=mt.mod(tr);Xe[Ie]=new Array(tr.getLength()-1);for(var Ct=0;Ct<Xe[Ie].length;Ct++){var Ei=Ct+$i.getLength()-Xe[Ie].length;Xe[Ie][Ct]=Ei>=0?$i.get(Ei):0}}for(var ga=0,Ct=0;Ct<se.length;Ct++)ga+=se[Ct].totalCount;for(var ts=new Array(ga),Rr=0,Ct=0;Ct<pe;Ct++)for(var Ie=0;Ie<se.length;Ie++)Ct<De[Ie].length&&(ts[Rr++]=De[Ie][Ct]);for(var Ct=0;Ct<xe;Ct++)for(var Ie=0;Ie<se.length;Ie++)Ct<Xe[Ie].length&&(ts[Rr++]=Xe[Ie][Ct]);return ts};for(var qe={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Le={L:1,M:0,Q:3,H:2},st={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},tt={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(re){for(var se=re<<10;tt.getBCHDigit(se)-tt.getBCHDigit(tt.G15)>=0;)se^=tt.G15<<tt.getBCHDigit(se)-tt.getBCHDigit(tt.G15);return(re<<10|se)^tt.G15_MASK},getBCHTypeNumber:function(re){for(var se=re<<12;tt.getBCHDigit(se)-tt.getBCHDigit(tt.G18)>=0;)se^=tt.G18<<tt.getBCHDigit(se)-tt.getBCHDigit(tt.G18);return re<<12|se},getBCHDigit:function(re){for(var se=0;re!=0;)se++,re>>>=1;return se},getPatternPosition:function(re){return tt.PATTERN_POSITION_TABLE[re-1]},getMask:function(re,se,ee){switch(re){case st.PATTERN000:return(se+ee)%2==0;case st.PATTERN001:return se%2==0;case st.PATTERN010:return ee%3==0;case st.PATTERN011:return(se+ee)%3==0;case st.PATTERN100:return(Math.floor(se/2)+Math.floor(ee/3))%2==0;case st.PATTERN101:return se*ee%2+se*ee%3==0;case st.PATTERN110:return(se*ee%2+se*ee%3)%2==0;case st.PATTERN111:return(se*ee%3+(se+ee)%2)%2==0;default:throw new Error("bad maskPattern:"+re)}},getErrorCorrectPolynomial:function(re){for(var se=new $([1],0),ee=0;ee<re;ee++)se=se.multiply(new $([1,Je.gexp(ee)],0));return se},getLengthInBits:function(re,se){if(1<=se&&se<10)switch(re){case qe.MODE_NUMBER:return 10;case qe.MODE_ALPHA_NUM:return 9;case qe.MODE_8BIT_BYTE:case qe.MODE_KANJI:return 8;default:throw new Error("mode:"+re)}else if(se<27)switch(re){case qe.MODE_NUMBER:return 12;case qe.MODE_ALPHA_NUM:return 11;case qe.MODE_8BIT_BYTE:return 16;case qe.MODE_KANJI:return 10;default:throw new Error("mode:"+re)}else{if(!(se<41))throw new Error("type:"+se);switch(re){case qe.MODE_NUMBER:return 14;case qe.MODE_ALPHA_NUM:return 13;case qe.MODE_8BIT_BYTE:return 16;case qe.MODE_KANJI:return 12;default:throw new Error("mode:"+re)}}},getLostPoint:function(re){for(var se=re.getModuleCount(),ee=0,pe=0;pe<se;pe++)for(var xe=0;xe<se;xe++){for(var De=0,Xe=re.isDark(pe,xe),Ie=-1;Ie<=1;Ie++)if(!(pe+Ie<0||se<=pe+Ie))for(var ue=-1;ue<=1;ue++)xe+ue<0||se<=xe+ue||Ie==0&&ue==0||Xe==re.isDark(pe+Ie,xe+ue)&&De++;De>5&&(ee+=3+De-5)}for(var pe=0;pe<se-1;pe++)for(var xe=0;xe<se-1;xe++){var gn=0;re.isDark(pe,xe)&&gn++,re.isDark(pe+1,xe)&&gn++,re.isDark(pe,xe+1)&&gn++,re.isDark(pe+1,xe+1)&&gn++,gn!=0&&gn!=4||(ee+=3)}for(var pe=0;pe<se;pe++)for(var xe=0;xe<se-6;xe++)re.isDark(pe,xe)&&!re.isDark(pe,xe+1)&&re.isDark(pe,xe+2)&&re.isDark(pe,xe+3)&&re.isDark(pe,xe+4)&&!re.isDark(pe,xe+5)&&re.isDark(pe,xe+6)&&(ee+=40);for(var xe=0;xe<se;xe++)for(var pe=0;pe<se-6;pe++)re.isDark(pe,xe)&&!re.isDark(pe+1,xe)&&re.isDark(pe+2,xe)&&re.isDark(pe+3,xe)&&re.isDark(pe+4,xe)&&!re.isDark(pe+5,xe)&&re.isDark(pe+6,xe)&&(ee+=40);for(var Ct=0,xe=0;xe<se;xe++)for(var pe=0;pe<se;pe++)re.isDark(pe,xe)&&Ct++;return ee+=Math.abs(100*Ct/se/se-50)/5*10}},Je={glog:function(re){if(re<1)throw new Error("glog("+re+")");return Je.LOG_TABLE[re]},gexp:function(re){for(;re<0;)re+=255;for(;re>=256;)re-=255;return Je.EXP_TABLE[re]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},ot=0;ot<8;ot++)Je.EXP_TABLE[ot]=1<<ot;for(var ot=8;ot<256;ot++)Je.EXP_TABLE[ot]=Je.EXP_TABLE[ot-4]^Je.EXP_TABLE[ot-5]^Je.EXP_TABLE[ot-6]^Je.EXP_TABLE[ot-8];for(var ot=0;ot<255;ot++)Je.LOG_TABLE[Je.EXP_TABLE[ot]]=ot;$.prototype={get:function(re){return this.num[re]},getLength:function(){return this.num.length},multiply:function(re){for(var se=new Array(this.getLength()+re.getLength()-1),ee=0;ee<this.getLength();ee++)for(var pe=0;pe<re.getLength();pe++)se[ee+pe]^=Je.gexp(Je.glog(this.get(ee))+Je.glog(re.get(pe)));return new $(se,0)},mod:function(re){if(this.getLength()-re.getLength()<0)return this;for(var se=Je.glog(this.get(0))-Je.glog(re.get(0)),ee=new Array(this.getLength()),pe=0;pe<this.getLength();pe++)ee[pe]=this.get(pe);for(var pe=0;pe<re.getLength();pe++)ee[pe]^=Je.gexp(Je.glog(re.get(pe))+se);return new $(ee,0).mod(re)}},H.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],H.getRSBlocks=function(re,se){var ee=H.getRsBlockTable(re,se);if(ee==he)throw new Error("bad rs block @ typeNumber:"+re+"/errorCorrectLevel:"+se);for(var pe=ee.length/3,xe=[],De=0;De<pe;De++)for(var Xe=ee[3*De+0],Ie=ee[3*De+1],ue=ee[3*De+2],gn=0;gn<Xe;gn++)xe.push(new H(Ie,ue));return xe},H.getRsBlockTable=function(re,se){switch(se){case Le.L:return H.RS_BLOCK_TABLE[4*(re-1)+0];case Le.M:return H.RS_BLOCK_TABLE[4*(re-1)+1];case Le.Q:return H.RS_BLOCK_TABLE[4*(re-1)+2];case Le.H:return H.RS_BLOCK_TABLE[4*(re-1)+3];default:return he}},X.prototype={get:function(re){var se=Math.floor(re/8);return(this.buffer[se]>>>7-re%8&1)==1},put:function(re,se){for(var ee=0;ee<se;ee++)this.putBit((re>>>se-ee-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(re){var se=Math.floor(this.length/8);this.buffer.length<=se&&this.buffer.push(0),re&&(this.buffer[se]|=128>>>this.length%8),this.length++}};var dt=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],dn=(function(){return typeof CanvasRenderingContext2D<"u"})()?(function(){function re(){if(this._htOption.drawer=="svg"){var De=this._oContext.getSerializedSvg(!0);this.dataURL=De,this._el.innerHTML=De}else try{var Xe=this._elCanvas.toDataURL("image/png");this.dataURL=Xe}catch(Ie){console.error(Ie)}this._htOption.onRenderingEnd&&(this.dataURL||console.error("Can not get base64 data, please check: 1. Published the page and image to the server 2. The image request support CORS 3. Configured `crossOrigin:'anonymous'` option"),this._htOption.onRenderingEnd(this._htOption,this.dataURL))}function se(De,Xe){var Ie=this;if(Ie._fFail=Xe,Ie._fSuccess=De,Ie._bSupportDataURI===null){var ue=document.createElement("img"),gn=function(){Ie._bSupportDataURI=!1,Ie._fFail&&Ie._fFail.call(Ie)},Ct=function(){Ie._bSupportDataURI=!0,Ie._fSuccess&&Ie._fSuccess.call(Ie)};return ue.onabort=gn,ue.onerror=gn,ue.onload=Ct,void(ue.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}Ie._bSupportDataURI===!0&&Ie._fSuccess?Ie._fSuccess.call(Ie):Ie._bSupportDataURI===!1&&Ie._fFail&&Ie._fFail.call(Ie)}if(le._android&&le._android<=2.1){var ee=1/window.devicePixelRatio,pe=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(De,Xe,Ie,ue,gn,Ct,tr,mt,$i){if("nodeName"in De&&/img/i.test(De.nodeName))for(var Ei=arguments.length-1;Ei>=1;Ei--)arguments[Ei]=arguments[Ei]*ee;else mt===void 0&&(arguments[1]*=ee,arguments[2]*=ee,arguments[3]*=ee,arguments[4]*=ee);pe.apply(this,arguments)}}var xe=function(De,Xe){this._bIsPainted=!1,this._android=j(),this._el=De,this._htOption=Xe,this._htOption.drawer=="svg"?(this._oContext={},this._elCanvas={}):(this._elCanvas=document.createElement("canvas"),this._el.appendChild(this._elCanvas),this._oContext=this._elCanvas.getContext("2d")),this._bSupportDataURI=null,this.dataURL=null};return xe.prototype.draw=function(De){function Xe(){ue.quietZone>0&&ue.quietZoneColor&&(mt.lineWidth=0,mt.fillStyle=ue.quietZoneColor,mt.fillRect(0,0,$i._elCanvas.width,ue.quietZone),mt.fillRect(0,ue.quietZone,ue.quietZone,$i._elCanvas.height-2*ue.quietZone),mt.fillRect($i._elCanvas.width-ue.quietZone,ue.quietZone,ue.quietZone,$i._elCanvas.height-2*ue.quietZone),mt.fillRect(0,$i._elCanvas.height-ue.quietZone,$i._elCanvas.width,ue.quietZone))}function Ie(ga){function ts(Ks){var Dr=Math.round(ue.width/3.5),Ui=Math.round(ue.height/3.5);Dr!==Ui&&(Dr=Ui),ue.logoMaxWidth?Dr=Math.round(ue.logoMaxWidth):ue.logoWidth&&(Dr=Math.round(ue.logoWidth)),ue.logoMaxHeight?Ui=Math.round(ue.logoMaxHeight):ue.logoHeight&&(Ui=Math.round(ue.logoHeight));var Nl,Rl;Ks.naturalWidth===void 0?(Nl=Ks.width,Rl=Ks.height):(Nl=Ks.naturalWidth,Rl=Ks.naturalHeight),(ue.logoMaxWidth||ue.logoMaxHeight)&&(ue.logoMaxWidth&&Nl<=Dr&&(Dr=Nl),ue.logoMaxHeight&&Rl<=Ui&&(Ui=Rl),Nl<=Dr&&Rl<=Ui&&(Dr=Nl,Ui=Rl));var vv=(ue.width+2*ue.quietZone-Dr)/2,xv=(ue.height+ue.titleHeight+2*ue.quietZone-Ui)/2,L_=Math.min(Dr/Nl,Ui/Rl),Sv=Nl*L_,kv=Rl*L_;(ue.logoMaxWidth||ue.logoMaxHeight)&&(Dr=Sv,Ui=kv,vv=(ue.width+2*ue.quietZone-Dr)/2,xv=(ue.height+ue.titleHeight+2*ue.quietZone-Ui)/2),ue.logoBackgroundTransparent||(mt.fillStyle=ue.logoBackgroundColor,mt.fillRect(vv,xv,Dr,Ui));var y7=mt.imageSmoothingQuality,b7=mt.imageSmoothingEnabled;mt.imageSmoothingEnabled=!0,mt.imageSmoothingQuality="high",mt.drawImage(Ks,vv+(Dr-Sv)/2,xv+(Ui-kv)/2,Sv,kv),mt.imageSmoothingEnabled=b7,mt.imageSmoothingQuality=y7,Xe(),_d._bIsPainted=!0,_d.makeImage()}ue.onRenderingStart&&ue.onRenderingStart(ue);for(var Rr=0;Rr<gn;Rr++)for(var zi=0;zi<gn;zi++){var Ml=zi*Ct+ue.quietZone,ou=Rr*tr+ue.quietZone,Ch=ga.isDark(Rr,zi),ni=ga.getEye(Rr,zi),Kn=ue.dotScale;mt.lineWidth=0;var lr,ri;ni?(lr=ue[ni.type]||ue[ni.type.substring(0,2)]||ue.colorDark,ri=ue.colorLight):ue.backgroundImage?(ri="rgba(0,0,0,0)",Rr==6?ue.autoColor?(lr=ue.timing_H||ue.timing||ue.autoColorDark,ri=ue.autoColorLight):lr=ue.timing_H||ue.timing||ue.colorDark:zi==6?ue.autoColor?(lr=ue.timing_V||ue.timing||ue.autoColorDark,ri=ue.autoColorLight):lr=ue.timing_V||ue.timing||ue.colorDark:ue.autoColor?(lr=ue.autoColorDark,ri=ue.autoColorLight):lr=ue.colorDark):(lr=Rr==6?ue.timing_H||ue.timing||ue.colorDark:zi==6&&(ue.timing_V||ue.timing)||ue.colorDark,ri=ue.colorLight),mt.strokeStyle=Ch?lr:ri,mt.fillStyle=Ch?lr:ri,ni?(Kn=ni.type=="AO"?ue.dotScaleAO:ni.type=="AI"?ue.dotScaleAI:1,ue.backgroundImage&&ue.autoColor?(lr=(ni.type=="AO"?ue.AI:ue.AO)||ue.autoColorDark,ri=ue.autoColorLight):lr=(ni.type=="AO"?ue.AI:ue.AO)||lr,Ch=ni.isDark,mt.fillRect(Ml+Ct*(1-Kn)/2,ue.titleHeight+ou+tr*(1-Kn)/2,Ct*Kn,tr*Kn)):Rr==6?(Kn=ue.dotScaleTiming_H,mt.fillRect(Ml+Ct*(1-Kn)/2,ue.titleHeight+ou+tr*(1-Kn)/2,Ct*Kn,tr*Kn)):zi==6?(Kn=ue.dotScaleTiming_V,mt.fillRect(Ml+Ct*(1-Kn)/2,ue.titleHeight+ou+tr*(1-Kn)/2,Ct*Kn,tr*Kn)):(ue.backgroundImage,mt.fillRect(Ml+Ct*(1-Kn)/2,ue.titleHeight+ou+tr*(1-Kn)/2,Ct*Kn,tr*Kn)),ue.dotScale==1||ni||(mt.strokeStyle=ue.colorLight)}if(ue.title&&(mt.fillStyle=ue.titleBackgroundColor,mt.fillRect(ue.quietZone,ue.quietZone,ue.width,ue.titleHeight),mt.font=ue.titleFont,mt.fillStyle=ue.titleColor,mt.textAlign="center",mt.fillText(ue.title,this._elCanvas.width/2,+ue.quietZone+ue.titleTop)),ue.subTitle&&(mt.font=ue.subTitleFont,mt.fillStyle=ue.subTitleColor,mt.fillText(ue.subTitle,this._elCanvas.width/2,+ue.quietZone+ue.subTitleTop)),ue.logo){var ya=new Image,_d=this;ya.onload=function(){ts(ya)},ya.onerror=function(Ks){console.error(Ks)},ue.crossOrigin!=null&&(ya.crossOrigin=ue.crossOrigin),ya.originalSrc=ue.logo,ya.src=ue.logo}else Xe(),this._bIsPainted=!0,this.makeImage()}var ue=this._htOption,gn=De.getModuleCount(),Ct=Math.round(ue.width/gn),tr=Math.round((ue.height-ue.titleHeight)/gn);Ct<=1&&(Ct=1),tr<=1&&(tr=1),ue.width=Ct*gn,ue.height=tr*gn+ue.titleHeight,ue.quietZone=Math.round(ue.quietZone),this._elCanvas.width=ue.width+2*ue.quietZone,this._elCanvas.height=ue.height+2*ue.quietZone,this._htOption.drawer!="canvas"&&(this._oContext=new C2S(this._elCanvas.width,this._elCanvas.height)),this.clear();var mt=this._oContext;mt.lineWidth=0,mt.fillStyle=ue.colorLight,mt.fillRect(0,0,this._elCanvas.width,this._elCanvas.height),mt.clearRect(ue.quietZone,ue.quietZone,ue.width,ue.titleHeight);var $i=this;if(ue.backgroundImage){var Ei=new Image;Ei.onload=function(){mt.globalAlpha=1,mt.globalAlpha=ue.backgroundImageAlpha;var ga=mt.imageSmoothingQuality,ts=mt.imageSmoothingEnabled;mt.imageSmoothingEnabled=!0,mt.imageSmoothingQuality="high",mt.drawImage(Ei,0,ue.titleHeight,ue.width+2*ue.quietZone,ue.height+2*ue.quietZone-ue.titleHeight),mt.imageSmoothingEnabled=ts,mt.imageSmoothingQuality=ga,mt.globalAlpha=1,Ie.call($i,De)},ue.crossOrigin!=null&&(Ei.crossOrigin=ue.crossOrigin),Ei.originalSrc=ue.backgroundImage,Ei.src=ue.backgroundImage}else Ie.call($i,De)},xe.prototype.makeImage=function(){this._bIsPainted&&se.call(this,re)},xe.prototype.isPainted=function(){return this._bIsPainted},xe.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},xe.prototype.remove=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1,this._el.innerHTML=""},xe.prototype.round=function(De){return De&&Math.floor(1e3*De)/1e3},xe})():(function(){var re=function(se,ee){this._el=se,this._htOption=ee};return re.prototype.draw=function(se){var ee=this._htOption,pe=this._el,xe=se.getModuleCount(),De=Math.round(ee.width/xe),Xe=Math.round((ee.height-ee.titleHeight)/xe);De<=1&&(De=1),Xe<=1&&(Xe=1),this._htOption.width=De*xe,this._htOption.height=Xe*xe+ee.titleHeight,this._htOption.quietZone=Math.round(this._htOption.quietZone);var Ie=[],ue="",gn=Math.round(De*ee.dotScale),Ct=Math.round(Xe*ee.dotScale);gn<4&&(gn=4,Ct=4);var tr=ee.colorDark,mt=ee.colorLight;if(ee.backgroundImage){ee.autoColor?(ee.colorDark="rgba(0, 0, 0, .6);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#99000000', EndColorStr='#99000000');",ee.colorLight="rgba(255, 255, 255, .7);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#B2FFFFFF', EndColorStr='#B2FFFFFF');"):ee.colorLight="rgba(0,0,0,0)";var $i='<div style="display:inline-block; z-index:-10;position:absolute;"><img src="'+ee.backgroundImage+'" widht="'+(ee.width+2*ee.quietZone)+'" height="'+(ee.height+2*ee.quietZone)+'" style="opacity:'+ee.backgroundImageAlpha+";filter:alpha(opacity="+100*ee.backgroundImageAlpha+'); "/></div>';Ie.push($i)}if(ee.quietZone&&(ue="display:inline-block; width:"+(ee.width+2*ee.quietZone)+"px; height:"+(ee.width+2*ee.quietZone)+"px;background:"+ee.quietZoneColor+"; text-align:center;"),Ie.push('<div style="font-size:0;'+ue+'">'),Ie.push('<table  style="font-size:0;border:0;border-collapse:collapse; margin-top:'+ee.quietZone+'px;" border="0" cellspacing="0" cellspadding="0" align="center" valign="middle">'),Ie.push('<tr height="'+ee.titleHeight+'" align="center"><td style="border:0;border-collapse:collapse;margin:0;padding:0" colspan="'+xe+'">'),ee.title){var Ei=ee.titleColor,ga=ee.titleFont;Ie.push('<div style="width:100%;margin-top:'+ee.titleTop+"px;color:"+Ei+";font:"+ga+";background:"+ee.titleBackgroundColor+'">'+ee.title+"</div>")}ee.subTitle&&Ie.push('<div style="width:100%;margin-top:'+(ee.subTitleTop-ee.titleTop)+"px;color:"+ee.subTitleColor+"; font:"+ee.subTitleFont+'">'+ee.subTitle+"</div>"),Ie.push("</td></tr>");for(var ts=0;ts<xe;ts++){Ie.push('<tr style="border:0; padding:0; margin:0;" height="7">');for(var Rr=0;Rr<xe;Rr++){var zi=se.isDark(ts,Rr),Ml=se.getEye(ts,Rr);if(Ml){zi=Ml.isDark;var ou=Ml.type,Ch=ee[ou]||ee[ou.substring(0,2)]||tr;Ie.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+De+"px;height:"+Xe+'px;"><span style="width:'+De+"px;height:"+Xe+"px;background-color:"+(zi?Ch:mt)+';display:inline-block"></span></td>')}else{var ni=ee.colorDark;ts==6?(ni=ee.timing_H||ee.timing||tr,Ie.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+De+"px;height:"+Xe+"px;background-color:"+(zi?ni:mt)+';"></td>')):Rr==6?(ni=ee.timing_V||ee.timing||tr,Ie.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+De+"px;height:"+Xe+"px;background-color:"+(zi?ni:mt)+';"></td>')):Ie.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+De+"px;height:"+Xe+'px;"><div style="display:inline-block;width:'+gn+"px;height:"+Ct+"px;background-color:"+(zi?ni:ee.colorLight)+';"></div></td>')}}Ie.push("</tr>")}if(Ie.push("</table>"),Ie.push("</div>"),ee.logo){var Kn=new Image;ee.crossOrigin!=null&&(Kn.crossOrigin=ee.crossOrigin),Kn.src=ee.logo;var lr=ee.width/3.5,ri=ee.height/3.5;lr!=ri&&(lr=ri),ee.logoWidth&&(lr=ee.logoWidth),ee.logoHeight&&(ri=ee.logoHeight);var ya="position:relative; z-index:1;display:table-cell;top:-"+((ee.height-ee.titleHeight)/2+ri/2+ee.quietZone)+"px;text-align:center; width:"+lr+"px; height:"+ri+"px;line-height:"+lr+"px; vertical-align: middle;";ee.logoBackgroundTransparent||(ya+="background:"+ee.logoBackgroundColor),Ie.push('<div style="'+ya+'"><img  src="'+ee.logo+'"  style="max-width: '+lr+"px; max-height: "+ri+'px;" /> <div style=" display: none; width:1px;margin-left: -1px;"></div></div>')}ee.onRenderingStart&&ee.onRenderingStart(ee),pe.innerHTML=Ie.join("");var _d=pe.childNodes[0],Ks=(ee.width-_d.offsetWidth)/2,Dr=(ee.height-_d.offsetHeight)/2;Ks>0&&Dr>0&&(_d.style.margin=Dr+"px "+Ks+"px"),this._htOption.onRenderingEnd&&this._htOption.onRenderingEnd(this._htOption,null)},re.prototype.clear=function(){this._el.innerHTML=""},re})();ge=function(re,se){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:Le.H,dotScale:1,dotScaleTiming:1,dotScaleTiming_H:he,dotScaleTiming_V:he,dotScaleA:1,dotScaleAO:he,dotScaleAI:he,quietZone:0,quietZoneColor:"rgba(0,0,0,0)",title:"",titleFont:"normal normal bold 16px Arial",titleColor:"#000000",titleBackgroundColor:"#ffffff",titleHeight:0,titleTop:30,subTitle:"",subTitleFont:"normal normal normal 14px Arial",subTitleColor:"#4F4F4F",subTitleTop:60,logo:he,logoWidth:he,logoHeight:he,logoMaxWidth:he,logoMaxHeight:he,logoBackgroundColor:"#ffffff",logoBackgroundTransparent:!1,PO:he,PI:he,PO_TL:he,PI_TL:he,PO_TR:he,PI_TR:he,PO_BL:he,PI_BL:he,AO:he,AI:he,timing:he,timing_H:he,timing_V:he,backgroundImage:he,backgroundImageAlpha:1,autoColor:!1,autoColorDark:"rgba(0, 0, 0, .6)",autoColorLight:"rgba(255, 255, 255, .7)",onRenderingStart:he,onRenderingEnd:he,version:0,tooltip:!1,binary:!1,drawer:"canvas",crossOrigin:null,utf8WithoutBOM:!0},typeof se=="string"&&(se={text:se}),se)for(var ee in se)this._htOption[ee]=se[ee];this._htOption.title||this._htOption.subTitle||(this._htOption.titleHeight=0),(this._htOption.version<0||this._htOption.version>40)&&(console.warn("QR Code version '"+this._htOption.version+"' is invalidate, reset to 0"),this._htOption.version=0),(this._htOption.dotScale<0||this._htOption.dotScale>1)&&(console.warn(this._htOption.dotScale+" , is invalidate, dotScale must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScale=1),(this._htOption.dotScaleTiming<0||this._htOption.dotScaleTiming>1)&&(console.warn(this._htOption.dotScaleTiming+" , is invalidate, dotScaleTiming must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming=1),this._htOption.dotScaleTiming_H?(this._htOption.dotScaleTiming_H<0||this._htOption.dotScaleTiming_H>1)&&(console.warn(this._htOption.dotScaleTiming_H+" , is invalidate, dotScaleTiming_H must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_H=1):this._htOption.dotScaleTiming_H=this._htOption.dotScaleTiming,this._htOption.dotScaleTiming_V?(this._htOption.dotScaleTiming_V<0||this._htOption.dotScaleTiming_V>1)&&(console.warn(this._htOption.dotScaleTiming_V+" , is invalidate, dotScaleTiming_V must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_V=1):this._htOption.dotScaleTiming_V=this._htOption.dotScaleTiming,(this._htOption.dotScaleA<0||this._htOption.dotScaleA>1)&&(console.warn(this._htOption.dotScaleA+" , is invalidate, dotScaleA must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleA=1),this._htOption.dotScaleAO?(this._htOption.dotScaleAO<0||this._htOption.dotScaleAO>1)&&(console.warn(this._htOption.dotScaleAO+" , is invalidate, dotScaleAO must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAO=1):this._htOption.dotScaleAO=this._htOption.dotScaleA,this._htOption.dotScaleAI?(this._htOption.dotScaleAI<0||this._htOption.dotScaleAI>1)&&(console.warn(this._htOption.dotScaleAI+" , is invalidate, dotScaleAI must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAI=1):this._htOption.dotScaleAI=this._htOption.dotScaleA,(this._htOption.backgroundImageAlpha<0||this._htOption.backgroundImageAlpha>1)&&(console.warn(this._htOption.backgroundImageAlpha+" , is invalidate, backgroundImageAlpha must between 0 and 1, now reset to 1. "),this._htOption.backgroundImageAlpha=1),this._htOption.height=this._htOption.height+this._htOption.titleHeight,typeof re=="string"&&(re=document.getElementById(re)),(!this._htOption.drawer||this._htOption.drawer!="svg"&&this._htOption.drawer!="canvas")&&(this._htOption.drawer="canvas"),this._android=j(),this._el=re,this._oQRCode=null,this._htOption._element=re;var pe={};for(var ee in this._htOption)pe[ee]=this._htOption[ee];this._oDrawing=new dn(this._el,pe),this._htOption.text&&this.makeCode(this._htOption.text)},ge.prototype.makeCode=function(re){this._oQRCode=new D(fe(re,this._htOption),this._htOption.correctLevel),this._oQRCode.addData(re,this._htOption.binary,this._htOption.utf8WithoutBOM),this._oQRCode.make(),this._htOption.tooltip&&(this._el.title=re),this._oDrawing.draw(this._oQRCode)},ge.prototype.makeImage=function(){typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},ge.prototype.clear=function(){this._oDrawing.remove()},ge.prototype.resize=function(re,se){this._oDrawing._htOption.width=re,this._oDrawing._htOption.height=se,this._oDrawing.draw(this._oQRCode)},ge.prototype.noConflict=function(){return le.QRCode===this&&(le.QRCode=Pe),ge},ge.CorrectLevel=Le,ke?((ke.exports=ge).QRCode=ge,me.QRCode=ge):le.QRCode=ge}).call(this)});var s=i("58QMB");var o={};const a=BigInt(0),l=BigInt(1),c=BigInt(2),u=BigInt(3),d=BigInt(8),f=Object.freeze({a,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),h=(v,w)=>(v+w/c)/w,p={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(v){const{n:w}=f,I=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),D=-l*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),$=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),H=I,X=BigInt("0x100000000000000000000000000000000"),j=h(H*v,w),fe=h(-D*v,w);let be=de(v-j*I-fe*$,w),he=de(-j*D-fe*H,w);const ge=be>X,K=he>X;if(ge&&(be=w-be),K&&(he=w-he),be>X||he>X)throw new Error("splitScalarEndo: Endomorphism failed, k="+v);return{k1neg:ge,k1:be,k2neg:K,k2:he}}},m=32,g=32,y=32,b=m+1,x=2*m+1;function C(v){const{a:w,b:I}=f,D=de(v*v),$=de(D*v);return de($+w*v+I)}const P=f.a===a;class S extends Error{constructor(w){super(w)}}function _(v){if(!(v instanceof k))throw new TypeError("JacobianPoint expected")}class k{constructor(w,I,D){this.x=w,this.y=I,this.z=D}static fromAffine(w){if(!(w instanceof M))throw new TypeError("JacobianPoint#fromAffine: expected Point");return w.equals(M.ZERO)?k.ZERO:new k(w.x,w.y,l)}static toAffineBatch(w){const I=Ve(w.map(D=>D.z));return w.map((D,$)=>D.toAffine(I[$]))}static normalizeZ(w){return k.toAffineBatch(w).map(k.fromAffine)}equals(w){_(w);const{x:I,y:D,z:$}=this,{x:H,y:X,z:j}=w,fe=de($*$),be=de(j*j),he=de(I*be),ge=de(H*fe),K=de(de(D*j)*be),J=de(de(X*$)*fe);return he===ge&&K===J}negate(){return new k(this.x,de(-this.y),this.z)}double(){const{x:w,y:I,z:D}=this,$=de(w*w),H=de(I*I),X=de(H*H),j=w+H,fe=de(c*(de(j*j)-$-X)),be=de(u*$),he=de(be*be),ge=de(he-c*fe),K=de(be*(fe-ge)-d*X),J=de(c*I*D);return new k(ge,K,J)}add(w){_(w);const{x:I,y:D,z:$}=this,{x:H,y:X,z:j}=w;if(H===a||X===a)return this;if(I===a||D===a)return w;const fe=de($*$),be=de(j*j),he=de(I*be),ge=de(H*fe),K=de(de(D*j)*be),J=de(de(X*$)*fe),le=de(ge-he),me=de(J-K);if(le===a)return me===a?this.double():k.ZERO;const ke=de(le*le),Pe=de(le*ke),qe=de(he*ke),Le=de(me*me-Pe-c*qe),st=de(me*(qe-Le)-K*Pe),tt=de($*j*le);return new k(Le,st,tt)}subtract(w){return this.add(w.negate())}multiplyUnsafe(w){const I=k.ZERO;if(typeof w=="bigint"&&w===a)return I;let D=_e(w);if(D===l)return this;if(!P){let ge=I,K=this;for(;D>a;)D&l&&(ge=ge.add(K)),K=K.double(),D>>=l;return ge}let{k1neg:$,k1:H,k2neg:X,k2:j}=p.splitScalar(D),fe=I,be=I,he=this;for(;H>a||j>a;)H&l&&(fe=fe.add(he)),j&l&&(be=be.add(he)),he=he.double(),H>>=l,j>>=l;return $&&(fe=fe.negate()),X&&(be=be.negate()),be=new k(de(be.x*p.beta),be.y,be.z),fe.add(be)}precomputeWindow(w){const I=P?128/w+1:256/w+1,D=[];let $=this,H=$;for(let X=0;X<I;X++){H=$,D.push(H);for(let j=1;j<2**(w-1);j++)H=H.add($),D.push(H);$=H.double()}return D}wNAF(w,I){!I&&this.equals(k.BASE)&&(I=M.BASE);const D=I&&I._WINDOW_SIZE||1;if(256%D)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let $=I&&O.get(I);$||($=this.precomputeWindow(D),I&&D!==1&&($=k.normalizeZ($),O.set(I,$)));let H=k.ZERO,X=k.BASE;const j=1+(P?128/D:256/D),fe=2**(D-1),be=BigInt(2**D-1),he=2**D,ge=BigInt(D);for(let K=0;K<j;K++){const J=K*fe;let le=Number(w&be);w>>=ge,le>fe&&(le-=he,w+=l);const me=J,ke=J+Math.abs(le)-1,Pe=K%2!==0,qe=le<0;le===0?X=X.add(T(Pe,$[me])):H=H.add(T(qe,$[ke]))}return{p:H,f:X}}multiply(w,I){let D=_e(w),$,H;if(P){const{k1neg:X,k1:j,k2neg:fe,k2:be}=p.splitScalar(D);let{p:he,f:ge}=this.wNAF(j,I),{p:K,f:J}=this.wNAF(be,I);he=T(X,he),K=T(fe,K),K=new k(de(K.x*p.beta),K.y,K.z),$=he.add(K),H=ge.add(J)}else{const{p:X,f:j}=this.wNAF(D,I);$=X,H=j}return k.normalizeZ([$,H])[0]}toAffine(w){const{x:I,y:D,z:$}=this,H=this.equals(k.ZERO);w==null&&(w=H?d:je($));const X=w,j=de(X*X),fe=de(j*X),be=de(I*j),he=de(D*fe),ge=de($*X);if(H)return M.ZERO;if(ge!==l)throw new Error("invZ was invalid");return new M(be,he)}}k.BASE=new k(f.Gx,f.Gy,l),k.ZERO=new k(a,l,a);function T(v,w){const I=w.negate();return v?I:w}const O=new WeakMap;class M{constructor(w,I){this.x=w,this.y=I}_setWindowSize(w){this._WINDOW_SIZE=w,O.delete(this)}hasEvenY(){return this.y%c===a}static fromCompressedHex(w){const I=w.length===32,D=Z(I?w:w.subarray(1));if(!We(D))throw new Error("Point is not on curve");const $=C(D);let H=Re($);const X=(H&l)===l;I?X&&(H=de(-H)):(w[0]&1)===1!==X&&(H=de(-H));const j=new M(D,H);return j.assertValidity(),j}static fromUncompressedHex(w){const I=Z(w.subarray(1,m+1)),D=Z(w.subarray(m+1,m*2+1)),$=new M(I,D);return $.assertValidity(),$}static fromHex(w){const I=ae(w),D=I.length,$=I[0];if(D===m)return this.fromCompressedHex(I);if(D===b&&($===2||$===3))return this.fromCompressedHex(I);if(D===x&&$===4)return this.fromUncompressedHex(I);throw new Error(`Point.fromHex: received invalid point. Expected 32-${b} compressed bytes or ${x} uncompressed bytes, not ${D}`)}static fromPrivateKey(w){return M.BASE.multiply(at(w))}static fromSignature(w,I,D){const{r:$,s:H}=Ot(I);if(![0,1,2,3].includes(D))throw new Error("Cannot recover: invalid recovery bit");const X=Me(ae(w)),{n:j}=f,fe=D===2||D===3?$+j:$,be=je(fe,j),he=de(-X*be,j),ge=de(H*be,j),K=D&1?"03":"02",J=M.fromHex(K+V(fe)),le=M.BASE.multiplyAndAddUnsafe(J,he,ge);if(!le)throw new Error("Cannot recover signature: point at infinify");return le.assertValidity(),le}toRawBytes(w=!1){return te(this.toHex(w))}toHex(w=!1){const I=V(this.x);return w?`${this.hasEvenY()?"02":"03"}${I}`:`04${I}${V(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const w="Point is not on elliptic curve",{x:I,y:D}=this;if(!We(I)||!We(D))throw new Error(w);const $=de(D*D),H=C(I);if(de($-H)!==a)throw new Error(w)}equals(w){return this.x===w.x&&this.y===w.y}negate(){return new M(this.x,de(-this.y))}double(){return k.fromAffine(this).double().toAffine()}add(w){return k.fromAffine(this).add(k.fromAffine(w)).toAffine()}subtract(w){return this.add(w.negate())}multiply(w){return k.fromAffine(this).multiply(w,this).toAffine()}multiplyAndAddUnsafe(w,I,D){const $=k.fromAffine(this),H=I===a||I===l||this!==M.BASE?$.multiplyUnsafe(I):$.multiply(I),X=k.fromAffine(w).multiplyUnsafe(D),j=H.add(X);return j.equals(k.ZERO)?void 0:j.toAffine()}}M.BASE=new M(f.Gx,f.Gy),M.ZERO=new M(a,a);function L(v){return Number.parseInt(v[0],16)>=8?"00"+v:v}function F(v){if(v.length<2||v[0]!==2)throw new Error(`Invalid signature integer tag: ${z(v)}`);const w=v[1],I=v.subarray(2,w+2);if(!w||I.length!==w)throw new Error("Invalid signature integer: wrong length");if(I[0]===0&&I[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:Z(I),left:v.subarray(w+2)}}function B(v){if(v.length<2||v[0]!=48)throw new Error(`Invalid signature tag: ${z(v)}`);if(v[1]!==v.length-2)throw new Error("Invalid signature: incorrect length");const{data:w,left:I}=F(v.subarray(2)),{data:D,left:$}=F(I);if($.length)throw new Error(`Invalid signature: left bytes after parsing: ${z($)}`);return{r:w,s:D}}class R{constructor(w,I){this.r=w,this.s=I,this.assertValidity()}static fromCompact(w){const I=w instanceof Uint8Array,D="Signature.fromCompact";if(typeof w!="string"&&!I)throw new TypeError(`${D}: Expected string or Uint8Array`);const $=I?z(w):w;if($.length!==128)throw new Error(`${D}: Expected 64-byte hex`);return new R(ne($.slice(0,64)),ne($.slice(64,128)))}static fromDER(w){const I=w instanceof Uint8Array;if(typeof w!="string"&&!I)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:D,s:$}=B(I?w:te(w));return new R(D,$)}static fromHex(w){return this.fromDER(w)}assertValidity(){const{r:w,s:I}=this;if(!we(w))throw new Error("Invalid Signature: r must be 0 < r < n");if(!we(I))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const w=f.n>>l;return this.s>w}normalizeS(){return this.hasHighS()?new R(this.r,de(-this.s,f.n)):this}toDERRawBytes(){return te(this.toDERHex())}toDERHex(){const w=L(G(this.s)),I=L(G(this.r)),D=w.length/2,$=I.length/2,H=G(D),X=G($);return`30${G($+D+4)}02${X}${I}02${H}${w}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return te(this.toCompactHex())}toCompactHex(){return V(this.r)+V(this.s)}}function A(...v){if(!v.every(D=>D instanceof Uint8Array))throw new Error("Uint8Array list expected");if(v.length===1)return v[0];const w=v.reduce((D,$)=>D+$.length,0),I=new Uint8Array(w);for(let D=0,$=0;D<v.length;D++){const H=v[D];I.set(H,$),$+=H.length}return I}const N=Array.from({length:256},(v,w)=>w.toString(16).padStart(2,"0"));function z(v){if(!(v instanceof Uint8Array))throw new Error("Expected Uint8Array");let w="";for(let I=0;I<v.length;I++)w+=N[v[I]];return w}const U=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function V(v){if(typeof v!="bigint")throw new Error("Expected bigint");if(!(a<=v&&v<U))throw new Error("Expected number 0 <= n < 2^256");return v.toString(16).padStart(64,"0")}function q(v){const w=te(V(v));if(w.length!==32)throw new Error("Error: expected 32 bytes");return w}function G(v){const w=v.toString(16);return w.length&1?`0${w}`:w}function ne(v){if(typeof v!="string")throw new TypeError("hexToNumber: expected string, got "+typeof v);return BigInt(`0x${v}`)}function te(v){if(typeof v!="string")throw new TypeError("hexToBytes: expected string, got "+typeof v);if(v.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+v.length);const w=new Uint8Array(v.length/2);for(let I=0;I<w.length;I++){const D=I*2,$=v.slice(D,D+2),H=Number.parseInt($,16);if(Number.isNaN(H)||H<0)throw new Error("Invalid byte sequence");w[I]=H}return w}function Z(v){return ne(z(v))}function ae(v){return v instanceof Uint8Array?Uint8Array.from(v):te(v)}function _e(v){if(typeof v=="number"&&Number.isSafeInteger(v)&&v>0)return BigInt(v);if(typeof v=="bigint"&&we(v))return v;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function de(v,w=f.P){const I=v%w;return I>=a?I:w+I}function Ee(v,w){const{P:I}=f;let D=v;for(;w-- >a;)D*=D,D%=I;return D}function Re(v){const{P:w}=f,I=BigInt(6),D=BigInt(11),$=BigInt(22),H=BigInt(23),X=BigInt(44),j=BigInt(88),fe=v*v*v%w,be=fe*fe*v%w,he=Ee(be,u)*be%w,ge=Ee(he,u)*be%w,K=Ee(ge,c)*fe%w,J=Ee(K,D)*K%w,le=Ee(J,$)*J%w,me=Ee(le,X)*le%w,ke=Ee(me,j)*me%w,Pe=Ee(ke,X)*le%w,qe=Ee(Pe,u)*be%w,Le=Ee(qe,H)*J%w,st=Ee(Le,I)*fe%w,tt=Ee(st,c);if(tt*tt%w!==v)throw new Error("Cannot find square root");return tt}function je(v,w=f.P){if(v===a||w<=a)throw new Error(`invert: expected positive integers, got n=${v} mod=${w}`);let I=de(v,w),D=w,$=a,H=l;for(;I!==a;){const j=D/I,fe=D%I,be=$-H*j;D=I,I=fe,$=H,H=be}if(D!==l)throw new Error("invert: does not exist");return de($,w)}function Ve(v,w=f.P){const I=new Array(v.length),D=v.reduce((H,X,j)=>X===a?H:(I[j]=H,de(H*X,w)),l),$=je(D,w);return v.reduceRight((H,X,j)=>X===a?H:(I[j]=de(H*I[j],w),de(H*X,w)),$),I}function Se(v){const w=v.length*8-g*8,I=Z(v);return w>0?I>>BigInt(w):I}function Me(v,w=!1){const I=Se(v);if(w)return I;const{n:D}=f;return I>=D?I-D:I}let Ne,Ke;class Ae{constructor(w,I){if(this.hashLen=w,this.qByteLen=I,typeof w!="number"||w<2)throw new Error("hashLen must be a number");if(typeof I!="number"||I<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(w).fill(1),this.k=new Uint8Array(w).fill(0),this.counter=0}hmac(...w){return At.hmacSha256(this.k,...w)}hmacSync(...w){return Ke(this.k,...w)}checkSync(){if(typeof Ke!="function")throw new S("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(w=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),w),this.v=await this.hmac(this.v),w.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),w),this.v=await this.hmac(this.v))}reseedSync(w=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),w),this.v=this.hmacSync(this.v),w.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),w),this.v=this.hmacSync(this.v))}async generate(){this.incr();let w=0;const I=[];for(;w<this.qByteLen;){this.v=await this.hmac(this.v);const D=this.v.slice();I.push(D),w+=this.v.length}return A(...I)}generateSync(){this.checkSync(),this.incr();let w=0;const I=[];for(;w<this.qByteLen;){this.v=this.hmacSync(this.v);const D=this.v.slice();I.push(D),w+=this.v.length}return A(...I)}}function we(v){return a<v&&v<f.n}function We(v){return a<v&&v<f.P}function et(v,w,I,D=!0){const{n:$}=f,H=Me(v,!0);if(!we(H))return;const X=je(H,$),j=M.BASE.multiply(H),fe=de(j.x,$);if(fe===a)return;const be=de(X*de(w+I*fe,$),$);if(be===a)return;let he=new R(fe,be),ge=(j.x===he.r?0:2)|Number(j.y&l);return D&&he.hasHighS()&&(he=he.normalizeS(),ge^=1),{sig:he,recovery:ge}}function at(v){let w;if(typeof v=="bigint")w=v;else if(typeof v=="number"&&Number.isSafeInteger(v)&&v>0)w=BigInt(v);else if(typeof v=="string"){if(v.length!==2*g)throw new Error("Expected 32 bytes of private key");w=ne(v)}else if(v instanceof Uint8Array){if(v.length!==g)throw new Error("Expected 32 bytes of private key");w=Z(v)}else throw new TypeError("Expected valid private key");if(!we(w))throw new Error("Expected private key: 0 < key < n");return w}function Pt(v){return v instanceof M?(v.assertValidity(),v):M.fromHex(v)}function Ot(v){if(v instanceof R)return v.assertValidity(),v;try{return R.fromDER(v)}catch{return R.fromCompact(v)}}function Tt(v,w=!1){return M.fromPrivateKey(v).toRawBytes(w)}function Mt(v){const w=v instanceof Uint8Array,I=typeof v=="string",D=(w||I)&&v.length;return w?D===b||D===x:I?D===b*2||D===x*2:v instanceof M}function Ft(v,w,I=!1){if(Mt(v))throw new TypeError("getSharedSecret: first arg must be private key");if(!Mt(w))throw new TypeError("getSharedSecret: second arg must be public key");const D=Pt(w);return D.assertValidity(),D.multiply(at(v)).toRawBytes(I)}function En(v){const w=v.length>m?v.slice(0,m):v;return Z(w)}function Ut(v){const w=En(v),I=de(w,f.n);return Pn(I<a?w:I)}function Pn(v){return q(v)}function ln(v,w,I){if(v==null)throw new Error(`sign: expected valid message hash, not "${v}"`);const D=ae(v),$=at(w),H=[Pn($),Ut(D)];if(I!=null){I===!0&&(I=At.randomBytes(m));const fe=ae(I);if(fe.length!==m)throw new Error(`sign: Expected ${m} bytes of extra data`);H.push(fe)}const X=A(...H),j=En(D);return{seed:X,m:j,d:$}}function $t(v,w){const{sig:I,recovery:D}=v,{der:$,recovered:H}=Object.assign({canonical:!0,der:!0},w),X=$?I.toDERRawBytes():I.toCompactRawBytes();return H?[X,D]:X}function en(v,w,I={}){const{seed:D,m:$,d:H}=ln(v,w,I.extraEntropy),X=new Ae(y,g);X.reseedSync(D);let j;for(;!(j=et(X.generateSync(),$,H,I.canonical));)X.reseedSync();return $t(j,I)}const Tn={strict:!0};function Nn(v,w,I,D=Tn){let $;try{$=Ot(v),w=ae(w)}catch{return!1}const{r:H,s:X}=$;if(D.strict&&$.hasHighS())return!1;const j=Me(w);let fe;try{fe=Pt(I)}catch{return!1}const{n:be}=f,he=je(X,be),ge=de(j*he,be),K=de(H*he,be),J=M.BASE.multiplyAndAddUnsafe(fe,ge,K);return J?de(J.x,be)===H:!1}function Xt(v){return de(Z(v),f.n)}class jt{constructor(w,I){this.r=w,this.s=I,this.assertValidity()}static fromHex(w){const I=ae(w);if(I.length!==64)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${I.length}`);const D=Z(I.subarray(0,32)),$=Z(I.subarray(32,64));return new jt(D,$)}assertValidity(){const{r:w,s:I}=this;if(!We(w)||!we(I))throw new Error("Invalid signature")}toHex(){return V(this.r)+V(this.s)}toRawBytes(){return te(this.toHex())}}function tn(v){return M.fromPrivateKey(v).toRawX()}class Qt{constructor(w,I,D=At.randomBytes()){if(w==null)throw new TypeError(`sign: Expected valid message, not "${w}"`);this.m=ae(w);const{x:$,scalar:H}=this.getScalar(at(I));if(this.px=$,this.d=H,this.rand=ae(D),this.rand.length!==32)throw new TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(w){const I=M.fromPrivateKey(w),D=I.hasEvenY()?w:f.n-w;return{point:I,scalar:D,x:I.toRawX()}}initNonce(w,I){return q(w^Z(I))}finalizeNonce(w){const I=de(Z(w),f.n);if(I===a)throw new Error("sign: Creation of signature failed. k is zero");const{point:D,x:$,scalar:H}=this.getScalar(I);return{R:D,rx:$,k:H}}finalizeSig(w,I,D,$){return new jt(w.x,de(I+D*$,f.n)).toRawBytes()}error(){throw new Error("sign: Invalid signature produced")}async calc(){const{m:w,d:I,px:D,rand:$}=this,H=At.taggedHash,X=this.initNonce(I,await H(er.aux,$)),{R:j,rx:fe,k:be}=this.finalizeNonce(await H(er.nonce,X,D,w)),he=Xt(await H(er.challenge,fe,D,w)),ge=this.finalizeSig(j,be,he,I);return await Fn(ge,w,D)||this.error(),ge}calcSync(){const{m:w,d:I,px:D,rand:$}=this,H=At.taggedHashSync,X=this.initNonce(I,H(er.aux,$)),{R:j,rx:fe,k:be}=this.finalizeNonce(H(er.nonce,X,D,w)),he=Xt(H(er.challenge,fe,D,w)),ge=this.finalizeSig(j,be,he,I);return or(ge,w,D)||this.error(),ge}}async function zn(v,w,I){return new Qt(v,w,I).calc()}function yi(v,w,I){return new Qt(v,w,I).calcSync()}function ys(v,w,I){const D=v instanceof jt,$=D?v:jt.fromHex(v);return D&&$.assertValidity(),{...$,m:ae(w),P:Pt(I)}}function It(v,w,I,D){const $=M.BASE.multiplyAndAddUnsafe(w,at(I),de(-D,f.n));return!(!$||!$.hasEvenY()||$.x!==v)}async function Fn(v,w,I){try{const{r:D,s:$,m:H,P:X}=ys(v,w,I),j=Xt(await At.taggedHash(er.challenge,q(D),X.toRawX(),H));return It(D,X,$,j)}catch{return!1}}function or(v,w,I){try{const{r:D,s:$,m:H,P:X}=ys(v,w,I),j=Xt(At.taggedHashSync(er.challenge,q(D),X.toRawX(),H));return It(D,X,$,j)}catch(D){if(D instanceof S)throw D;return!1}}const bi={Signature:jt,getPublicKey:tn,sign:zn,verify:Fn,signSync:yi,verifySync:or};M.BASE._setWindowSize(8);const ar={node:o,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},er={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},wi={},At={bytesToHex:z,hexToBytes:te,concatBytes:A,mod:de,invert:je,isValidPrivateKey(v){try{return at(v),!0}catch{return!1}},_bigintTo32Bytes:q,_normalizePrivateKey:at,hashToPrivateKey:v=>{v=ae(v);const w=g+8;if(v.length<w||v.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const I=de(Z(v),f.n-l)+l;return q(I)},randomBytes:(v=32)=>{if(ar.web)return ar.web.getRandomValues(new Uint8Array(v));if(ar.node){const{randomBytes:w}=ar.node;return Uint8Array.from(w(v))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>At.hashToPrivateKey(At.randomBytes(g+8)),precompute(v=8,w=M.BASE){const I=w===M.BASE?w:new M(w.x,w.y);return I._setWindowSize(v),I.multiply(u),I},sha256:async(...v)=>{if(ar.web){const w=await ar.web.subtle.digest("SHA-256",A(...v));return new Uint8Array(w)}else if(ar.node){const{createHash:w}=ar.node,I=w("sha256");return v.forEach(D=>I.update(D)),Uint8Array.from(I.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(v,...w)=>{if(ar.web){const I=await ar.web.subtle.importKey("raw",v,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),D=A(...w),$=await ar.web.subtle.sign("HMAC",I,D);return new Uint8Array($)}else if(ar.node){const{createHmac:I}=ar.node,D=I("sha256",v);return w.forEach($=>D.update($)),Uint8Array.from(D.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(v,...w)=>{let I=wi[v];if(I===void 0){const D=await At.sha256(Uint8Array.from(v,$=>$.charCodeAt(0)));I=A(D,D),wi[v]=I}return At.sha256(I,...w)},taggedHashSync:(v,...w)=>{if(typeof Ne!="function")throw new S("sha256Sync is undefined, you need to set it");let I=wi[v];if(I===void 0){const D=Ne(Uint8Array.from(v,$=>$.charCodeAt(0)));I=A(D,D),wi[v]=I}return Ne(I,...w)},_JacobianPoint:k};Object.defineProperties(At,{sha256Sync:{configurable:!1,get(){return Ne},set(v){Ne||(Ne=v)}},hmacSha256Sync:{configurable:!1,get(){return Ke},set(v){Ke||(Ke=v)}}});var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.sha224=Nr.sha256=void 0;var da={};Object.defineProperty(da,"__esModule",{value:!0}),da.SHA2=void 0;var qt={};Object.defineProperty(qt,"__esModule",{value:!0}),qt.output=qt.exists=qt.hash=qt.bytes=qt.bool=qt.number=void 0;function xd(v){if(!Number.isSafeInteger(v)||v<0)throw new Error(`Wrong positive integer: ${v}`)}qt.number=xd;function ng(v){if(typeof v!="boolean")throw new Error(`Expected boolean, not ${v}`)}qt.bool=ng;function bh(v,...w){if(!(v instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length>0&&!w.includes(v.length))throw new TypeError(`Expected Uint8Array of length ${w}, not of length=${v.length}`)}qt.bytes=bh;function kl(v){if(typeof v!="function"||typeof v.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xd(v.outputLen),xd(v.blockLen)}qt.hash=kl;function wh(v,w=!0){if(v.destroyed)throw new Error("Hash instance has been destroyed");if(w&&v.finished)throw new Error("Hash#digest() has already been called")}qt.exists=wh;function rg(v,w){bh(v);const I=w.outputLen;if(v.length<I)throw new Error(`digestInto() expects output buffer of length at least ${I}`)}qt.output=rg;const Gw={number:xd,bool:ng,bytes:bh,hash:kl,exists:wh,output:rg};qt.default=Gw;var Ye={};Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.randomBytes=Ye.wrapConstructorWithOpts=Ye.wrapConstructor=Ye.checkOpts=Ye.Hash=Ye.concatBytes=Ye.toBytes=Ye.utf8ToBytes=Ye.asyncLoop=Ye.nextTick=Ye.hexToBytes=Ye.bytesToHex=Ye.isLE=Ye.rotr=Ye.createView=Ye.u32=Ye.u8=void 0;var fa={};Object.defineProperty(fa,"__esModule",{value:!0}),fa.crypto=void 0,fa.crypto={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};const Zw=v=>new Uint8Array(v.buffer,v.byteOffset,v.byteLength);Ye.u8=Zw;const Xw=v=>new Uint32Array(v.buffer,v.byteOffset,Math.floor(v.byteLength/4));Ye.u32=Xw;const Nt=v=>new DataView(v.buffer,v.byteOffset,v.byteLength);Ye.createView=Nt;const kn=(v,w)=>v<<32-w|v>>>w;if(Ye.rotr=kn,Ye.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!Ye.isLE)throw new Error("Non little-endian hardware is not supported");const nn=Array.from({length:256},(v,w)=>w.toString(16).padStart(2,"0"));function In(v){if(!(v instanceof Uint8Array))throw new Error("Uint8Array expected");let w="";for(let I=0;I<v.length;I++)w+=nn[v[I]];return w}Ye.bytesToHex=In;function mn(v){if(typeof v!="string")throw new TypeError("hexToBytes: expected string, got "+typeof v);if(v.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const w=new Uint8Array(v.length/2);for(let I=0;I<w.length;I++){const D=I*2,$=v.slice(D,D+2),H=Number.parseInt($,16);if(Number.isNaN(H)||H<0)throw new Error("Invalid byte sequence");w[I]=H}return w}Ye.hexToBytes=mn;const On=async()=>{};Ye.nextTick=On;async function Cn(v,w,I){let D=Date.now();for(let $=0;$<v;$++){I($);const H=Date.now()-D;H>=0&&H<w||(await(0,Ye.nextTick)(),D+=H)}}Ye.asyncLoop=Cn;function Un(v){if(typeof v!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof v}`);return new TextEncoder().encode(v)}Ye.utf8ToBytes=Un;function Hn(v){if(typeof v=="string"&&(v=Un(v)),!(v instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof v})`);return v}Ye.toBytes=Hn;function mo(...v){if(!v.every(D=>D instanceof Uint8Array))throw new Error("Uint8Array list expected");if(v.length===1)return v[0];const w=v.reduce((D,$)=>D+$.length,0),I=new Uint8Array(w);for(let D=0,$=0;D<v.length;D++){const H=v[D];I.set(H,$),$+=H.length}return I}Ye.concatBytes=mo;class ha{clone(){return this._cloneInto()}}Ye.Hash=ha;const pa=v=>Object.prototype.toString.call(v)==="[object Object]"&&v.constructor===Object;function El(v,w){if(w!==void 0&&(typeof w!="object"||!pa(w)))throw new TypeError("Options should be object or undefined");return Object.assign(v,w)}Ye.checkOpts=El;function Tl(v){const w=D=>v().update(Hn(D)).digest(),I=v();return w.outputLen=I.outputLen,w.blockLen=I.blockLen,w.create=()=>v(),w}Ye.wrapConstructor=Tl;function nu(v){const w=(D,$)=>v($).update(Hn(D)).digest(),I=v({});return w.outputLen=I.outputLen,w.blockLen=I.blockLen,w.create=D=>v(D),w}Ye.wrapConstructorWithOpts=nu;function Di(v=32){if(fa.crypto.web)return fa.crypto.web.getRandomValues(new Uint8Array(v));if(fa.crypto.node)return new Uint8Array(fa.crypto.node.randomBytes(v).buffer);throw new Error("The environment doesn't have randomBytes function")}Ye.randomBytes=Di;function Ws(v,w,I,D){if(typeof v.setBigUint64=="function")return v.setBigUint64(w,I,D);const $=BigInt(32),H=BigInt(4294967295),X=Number(I>>$&H),j=Number(I&H),fe=D?4:0,be=D?0:4;v.setUint32(w+fe,X,D),v.setUint32(w+be,j,D)}class Cl extends Ye.Hash{constructor(w,I,D,$){super(),this.blockLen=w,this.outputLen=I,this.padOffset=D,this.isLE=$,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(w),this.view=(0,Ye.createView)(this.buffer)}update(w){qt.default.exists(this);const{view:I,buffer:D,blockLen:$}=this;w=(0,Ye.toBytes)(w);const H=w.length;for(let X=0;X<H;){const j=Math.min($-this.pos,H-X);if(j===$){const fe=(0,Ye.createView)(w);for(;$<=H-X;X+=$)this.process(fe,X);continue}D.set(w.subarray(X,X+j),this.pos),this.pos+=j,X+=j,this.pos===$&&(this.process(I,0),this.pos=0)}return this.length+=w.length,this.roundClean(),this}digestInto(w){qt.default.exists(this),qt.default.output(w,this),this.finished=!0;const{buffer:I,view:D,blockLen:$,isLE:H}=this;let{pos:X}=this;I[X++]=128,this.buffer.subarray(X).fill(0),this.padOffset>$-X&&(this.process(D,0),X=0);for(let ge=X;ge<$;ge++)I[ge]=0;Ws(D,$-8,BigInt(this.length*8),H),this.process(D,0);const j=(0,Ye.createView)(w),fe=this.outputLen;if(fe%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const be=fe/4,he=this.get();if(be>he.length)throw new Error("_sha2: outputLen bigger than state");for(let ge=0;ge<be;ge++)j.setUint32(4*ge,he[ge],H)}digest(){const{buffer:w,outputLen:I}=this;this.digestInto(w);const D=w.slice(0,I);return this.destroy(),D}_cloneInto(w){w||(w=new this.constructor),w.set(...this.get());const{blockLen:I,buffer:D,length:$,finished:H,destroyed:X,pos:j}=this;return w.length=$,w.pos=j,w.finished=H,w.destroyed=X,$%I&&w.buffer.set(D),w}}da.SHA2=Cl;const ru=(v,w,I)=>v&w^~v&I,_l=(v,w,I)=>v&w^v&I^w&I,Al=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vi=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),es=new Uint32Array(64);class Sd extends da.SHA2{constructor(){super(64,32,8,!1),this.A=vi[0]|0,this.B=vi[1]|0,this.C=vi[2]|0,this.D=vi[3]|0,this.E=vi[4]|0,this.F=vi[5]|0,this.G=vi[6]|0,this.H=vi[7]|0}get(){const{A:w,B:I,C:D,D:$,E:H,F:X,G:j,H:fe}=this;return[w,I,D,$,H,X,j,fe]}set(w,I,D,$,H,X,j,fe){this.A=w|0,this.B=I|0,this.C=D|0,this.D=$|0,this.E=H|0,this.F=X|0,this.G=j|0,this.H=fe|0}process(w,I){for(let ge=0;ge<16;ge++,I+=4)es[ge]=w.getUint32(I,!1);for(let ge=16;ge<64;ge++){const K=es[ge-15],J=es[ge-2],le=(0,Ye.rotr)(K,7)^(0,Ye.rotr)(K,18)^K>>>3,me=(0,Ye.rotr)(J,17)^(0,Ye.rotr)(J,19)^J>>>10;es[ge]=me+es[ge-7]+le+es[ge-16]|0}let{A:D,B:$,C:H,D:X,E:j,F:fe,G:be,H:he}=this;for(let ge=0;ge<64;ge++){const K=(0,Ye.rotr)(j,6)^(0,Ye.rotr)(j,11)^(0,Ye.rotr)(j,25),J=he+K+ru(j,fe,be)+Al[ge]+es[ge]|0,me=((0,Ye.rotr)(D,2)^(0,Ye.rotr)(D,13)^(0,Ye.rotr)(D,22))+_l(D,$,H)|0;he=be,be=fe,fe=j,j=X+J|0,X=H,H=$,$=D,D=J+me|0}D=D+this.A|0,$=$+this.B|0,H=H+this.C|0,X=X+this.D|0,j=j+this.E|0,fe=fe+this.F|0,be=be+this.G|0,he=he+this.H|0,this.set(D,$,H,X,j,fe,be,he)}roundClean(){es.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class vh extends Sd{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}Nr.sha256=(0,Ye.wrapConstructor)(()=>new Sd),Nr.sha224=(0,Ye.wrapConstructor)(()=>new vh);function js(v){if(!Number.isSafeInteger(v))throw new Error(`Wrong integer: ${v}`)}function xi(...v){const w=($,H)=>X=>$(H(X)),I=Array.from(v).reverse().reduce(($,H)=>$?w($,H.encode):H.encode,void 0),D=v.reduce(($,H)=>$?w($,H.decode):H.decode,void 0);return{encode:I,decode:D}}function Si(v){return{encode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return w.map(I=>{if(js(I),I<0||I>=v.length)throw new Error(`Digit index outside alphabet: ${I} (alphabet: ${v.length})`);return v[I]})},decode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="string")throw new Error("alphabet.decode input should be array of strings");return w.map(I=>{if(typeof I!="string")throw new Error(`alphabet.decode: not string element=${I}`);const D=v.indexOf(I);if(D===-1)throw new Error(`Unknown letter: "${I}". Allowed: ${v}`);return D})}}}function Li(v=""){if(typeof v!="string")throw new Error("join separator should be string");return{encode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="string")throw new Error("join.encode input should be array of strings");for(let I of w)if(typeof I!="string")throw new Error(`join.encode: non-string input=${I}`);return w.join(v)},decode:w=>{if(typeof w!="string")throw new Error("join.decode input should be string");return w.split(v)}}}function go(v,w="="){if(js(v),typeof w!="string")throw new Error("padding chr should be string");return{encode(I){if(!Array.isArray(I)||I.length&&typeof I[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of I)if(typeof D!="string")throw new Error(`padding.encode: non-string input=${D}`);for(;I.length*v%8;)I.push(w);return I},decode(I){if(!Array.isArray(I)||I.length&&typeof I[0]!="string")throw new Error("padding.encode input should be array of strings");for(let $ of I)if(typeof $!="string")throw new Error(`padding.decode: non-string input=${$}`);let D=I.length;if(D*v%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;D>0&&I[D-1]===w;D--)if(!((D-1)*v%8))throw new Error("Invalid padding: string has too much padding");return I.slice(0,D)}}}function ig(v){if(typeof v!="function")throw new Error("normalize fn should be function");return{encode:w=>w,decode:w=>v(w)}}function sg(v,w,I){if(w<2)throw new Error(`convertRadix: wrong from=${w}, base cannot be less than 2`);if(I<2)throw new Error(`convertRadix: wrong to=${I}, base cannot be less than 2`);if(!Array.isArray(v))throw new Error("convertRadix: data should be array");if(!v.length)return[];let D=0;const $=[],H=Array.from(v);for(H.forEach(X=>{if(js(X),X<0||X>=w)throw new Error(`Wrong integer: ${X}`)});;){let X=0,j=!0;for(let fe=D;fe<H.length;fe++){const be=H[fe],he=w*X+be;if(!Number.isSafeInteger(he)||w*X/w!==X||he-be!==w*X)throw new Error("convertRadix: carry overflow");if(X=he%I,H[fe]=Math.floor(he/I),!Number.isSafeInteger(H[fe])||H[fe]*I+X!==he)throw new Error("convertRadix: carry overflow");if(j)H[fe]?j=!1:D=fe;else continue}if($.push(X),j)break}for(let X=0;X<v.length-1&&v[X]===0;X++)$.push(0);return $.reverse()}const og=(v,w)=>w?og(w,v%w):v,kd=(v,w)=>v+(w-og(v,w));function xh(v,w,I,D){if(!Array.isArray(v))throw new Error("convertRadix2: data should be array");if(w<=0||w>32)throw new Error(`convertRadix2: wrong from=${w}`);if(I<=0||I>32)throw new Error(`convertRadix2: wrong to=${I}`);if(kd(w,I)>32)throw new Error(`convertRadix2: carry overflow from=${w} to=${I} carryBits=${kd(w,I)}`);let $=0,H=0;const X=2**I-1,j=[];for(const fe of v){if(js(fe),fe>=2**w)throw new Error(`convertRadix2: invalid data word=${fe} from=${w}`);if($=$<<w|fe,H+w>32)throw new Error(`convertRadix2: carry overflow pos=${H} from=${w}`);for(H+=w;H>=I;H-=I)j.push(($>>H-I&X)>>>0);$&=2**H-1}if($=$<<I-H&X,!D&&H>=w)throw new Error("Excess padding");if(!D&&$)throw new Error(`Non-zero padding: ${$}`);return D&&H>0&&j.push($>>>0),j}function ag(v){return js(v),{encode:w=>{if(!(w instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return sg(Array.from(w),256,v)},decode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(sg(w,v,256))}}}function qs(v,w=!1){if(js(v),v<=0||v>32)throw new Error("radix2: bits should be in (0..32]");if(kd(8,v)>32||kd(v,8)>32)throw new Error("radix2: carry overflow");return{encode:I=>{if(!(I instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return xh(Array.from(I),8,v,!w)},decode:I=>{if(!Array.isArray(I)||I.length&&typeof I[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(xh(I,v,8,w))}}}function lg(v){if(typeof v!="function")throw new Error("unsafeWrapper fn should be function");return function(...w){try{return v.apply(null,w)}catch{}}}function cg(v,w){if(js(v),typeof w!="function")throw new Error("checksum fn should be function");return{encode(I){if(!(I instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const D=w(I).slice(0,v),$=new Uint8Array(I.length+v);return $.set(I),$.set(D,I.length),$},decode(I){if(!(I instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const D=I.slice(0,-v),$=w(D).slice(0,v),H=I.slice(-v);for(let X=0;X<v;X++)if($[X]!==H[X])throw new Error("Invalid checksum");return D}}}const Ed={alphabet:Si,chain:xi,checksum:cg,radix:ag,radix2:qs,join:Li,padding:go},Qw=xi(qs(4),Si("0123456789ABCDEF"),Li("")),Yw=xi(qs(5),Si("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),go(5),Li(""));xi(qs(5),Si("0123456789ABCDEFGHIJKLMNOPQRSTUV"),go(5),Li("")),xi(qs(5),Si("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Li(""),ig(v=>v.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Sh=xi(qs(6),Si("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),go(6),Li("")),tz=xi(qs(6),Si("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),go(6),Li("")),Jw=v=>xi(ag(58),Si(v),Li("")),ug=Jw("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Jw("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Jw("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const QC=[0,2,3,5,6,7,9,10,11],nz={encode(v){let w="";for(let I=0;I<v.length;I+=8){const D=v.subarray(I,I+8);w+=ug.encode(D).padStart(QC[D.length],"1")}return w},decode(v){let w=[];for(let I=0;I<v.length;I+=11){const D=v.slice(I,I+11),$=QC.indexOf(D.length),H=ug.decode(D);for(let X=0;X<H.length-$;X++)if(H[X]!==0)throw new Error("base58xmr: wrong padding");w=w.concat(Array.from(H.slice(H.length-$)))}return Uint8Array.from(w)}},rz=v=>xi(cg(4,w=>v(v(w))),ug),ev=xi(Si("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Li("")),YC=[996825010,642813549,513874426,1027748829,705979059];function kh(v){const w=v>>25;let I=(v&33554431)<<5;for(let D=0;D<YC.length;D++)(w>>D&1)===1&&(I^=YC[D]);return I}function JC(v,w,I=1){const D=v.length;let $=1;for(let H=0;H<D;H++){const X=v.charCodeAt(H);if(X<33||X>126)throw new Error(`Invalid prefix (${v})`);$=kh($)^X>>5}$=kh($);for(let H=0;H<D;H++)$=kh($)^v.charCodeAt(H)&31;for(let H of w)$=kh($)^H;for(let H=0;H<6;H++)$=kh($);return $^=I,ev.encode(xh([$%2**30],30,5,!1))}function e_(v){const w=v==="bech32"?1:734539939,I=qs(5),D=I.decode,$=I.encode,H=lg(D);function X(he,ge,K=90){if(typeof he!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof he}`);if(!Array.isArray(ge)||ge.length&&typeof ge[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof ge}`);const J=he.length+7+ge.length;if(K!==!1&&J>K)throw new TypeError(`Length ${J} exceeds limit ${K}`);return he=he.toLowerCase(),`${he}1${ev.encode(ge)}${JC(he,ge,w)}`}function j(he,ge=90){if(typeof he!="string")throw new Error(`bech32.decode input should be string, not ${typeof he}`);if(he.length<8||ge!==!1&&he.length>ge)throw new TypeError(`Wrong string length: ${he.length} (${he}). Expected (8..${ge})`);const K=he.toLowerCase();if(he!==K&&he!==he.toUpperCase())throw new Error("String must be lowercase or uppercase");he=K;const J=he.lastIndexOf("1");if(J===0||J===-1)throw new Error('Letter "1" must be present between prefix and data only');const le=he.slice(0,J),me=he.slice(J+1);if(me.length<6)throw new Error("Data must be at least 6 characters long");const ke=ev.decode(me).slice(0,-6),Pe=JC(le,ke,w);if(!me.endsWith(Pe))throw new Error(`Invalid checksum in ${he}: expected "${Pe}"`);return{prefix:le,words:ke}}const fe=lg(j);function be(he){const{prefix:ge,words:K}=j(he,!1);return{prefix:ge,words:K,bytes:D(K)}}return{encode:X,decode:j,decodeToBytes:be,decodeUnsafe:fe,fromWords:D,fromWordsUnsafe:H,toWords:$}}const Bi=e_("bech32");e_("bech32m");const iz={encode:v=>new TextDecoder().decode(v),decode:v=>new TextEncoder().encode(v)},sz=xi(qs(4),Si("0123456789abcdef"),Li(""),ig(v=>{if(typeof v!="string"||v.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof v} with length ${v.length}`);return v.toLowerCase()}));`${Object.keys({utf8:iz,hex:sz,base16:Qw,base32:Yw,base64:Sh,base64url:tz,base58:ug,base58xmr:nz}).join(", ")}`;var Eh={};Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.wordlist=void 0,Eh.wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);var ti={};Object.defineProperty(ti,"__esModule",{value:!0}),ti.mnemonicToSeedSync=ti.mnemonicToSeed=ti.validateMnemonic=ti.entropyToMnemonic=ti.mnemonicToEntropy=ti.generateMnemonic=void 0;var iu={};Object.defineProperty(iu,"__esModule",{value:!0}),iu.pbkdf2Async=iu.pbkdf2=void 0;var ma={};Object.defineProperty(ma,"__esModule",{value:!0}),ma.hmac=void 0;class t_ extends Ye.Hash{constructor(w,I){super(),this.finished=!1,this.destroyed=!1,qt.default.hash(w);const D=(0,Ye.toBytes)(I);if(this.iHash=w.create(),typeof this.iHash.update!="function")throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const $=this.blockLen,H=new Uint8Array($);H.set(D.length>$?w.create().update(D).digest():D);for(let X=0;X<H.length;X++)H[X]^=54;this.iHash.update(H),this.oHash=w.create();for(let X=0;X<H.length;X++)H[X]^=106;this.oHash.update(H),H.fill(0)}update(w){return qt.default.exists(this),this.iHash.update(w),this}digestInto(w){qt.default.exists(this),qt.default.bytes(w,this.outputLen),this.finished=!0,this.iHash.digestInto(w),this.oHash.update(w),this.oHash.digestInto(w),this.destroy()}digest(){const w=new Uint8Array(this.oHash.outputLen);return this.digestInto(w),w}_cloneInto(w){w||(w=Object.create(Object.getPrototypeOf(this),{}));const{oHash:I,iHash:D,finished:$,destroyed:H,blockLen:X,outputLen:j}=this;return w.finished=$,w.destroyed=H,w.blockLen=X,w.outputLen=j,w.oHash=I._cloneInto(w.oHash),w.iHash=D._cloneInto(w.iHash),w}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const oz=(v,w,I)=>new t_(v,w).update(I).digest();ma.hmac=oz,ma.hmac.create=(v,w)=>new t_(v,w);function n_(v,w,I,D){qt.default.hash(v);const $=(0,Ye.checkOpts)({dkLen:32,asyncTick:10},D),{c:H,dkLen:X,asyncTick:j}=$;if(qt.default.number(H),qt.default.number(X),qt.default.number(j),H<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const fe=(0,Ye.toBytes)(w),be=(0,Ye.toBytes)(I),he=new Uint8Array(X),ge=ma.hmac.create(v,fe),K=ge._cloneInto().update(be);return{c:H,dkLen:X,asyncTick:j,DK:he,PRF:ge,PRFSalt:K}}function r_(v,w,I,D,$){return v.destroy(),w.destroy(),D&&D.destroy(),$.fill(0),I}function az(v,w,I,D){const{c:$,dkLen:H,DK:X,PRF:j,PRFSalt:fe}=n_(v,w,I,D);let be;const he=new Uint8Array(4),ge=(0,Ye.createView)(he),K=new Uint8Array(j.outputLen);for(let J=1,le=0;le<H;J++,le+=j.outputLen){const me=X.subarray(le,le+j.outputLen);ge.setInt32(0,J,!1),(be=fe._cloneInto(be)).update(he).digestInto(K),me.set(K.subarray(0,me.length));for(let ke=1;ke<$;ke++){j._cloneInto(be).update(K).digestInto(K);for(let Pe=0;Pe<me.length;Pe++)me[Pe]^=K[Pe]}}return r_(j,fe,X,be,K)}iu.pbkdf2=az;async function lz(v,w,I,D){const{c:$,dkLen:H,asyncTick:X,DK:j,PRF:fe,PRFSalt:be}=n_(v,w,I,D);let he;const ge=new Uint8Array(4),K=(0,Ye.createView)(ge),J=new Uint8Array(fe.outputLen);for(let le=1,me=0;me<H;le++,me+=fe.outputLen){const ke=j.subarray(me,me+fe.outputLen);K.setInt32(0,le,!1),(he=be._cloneInto(he)).update(ge).digestInto(J),ke.set(J.subarray(0,ke.length)),await(0,Ye.asyncLoop)($-1,X,Pe=>{fe._cloneInto(he).update(J).digestInto(J);for(let qe=0;qe<ke.length;qe++)ke[qe]^=J[qe]})}return r_(fe,be,j,he,J)}iu.pbkdf2Async=lz;var ki={};Object.defineProperty(ki,"__esModule",{value:!0}),ki.sha384=ki.sha512_256=ki.sha512_224=ki.sha512=ki.SHA512=void 0;var bt={};Object.defineProperty(bt,"__esModule",{value:!0}),bt.add=bt.toBig=bt.split=bt.fromBig=void 0;const dg=BigInt(2**32-1),tv=BigInt(32);function nv(v,w=!1){return w?{h:Number(v&dg),l:Number(v>>tv&dg)}:{h:Number(v>>tv&dg)|0,l:Number(v&dg)|0}}bt.fromBig=nv;function i_(v,w=!1){let I=new Uint32Array(v.length),D=new Uint32Array(v.length);for(let $=0;$<v.length;$++){const{h:H,l:X}=nv(v[$],w);[I[$],D[$]]=[H,X]}return[I,D]}bt.split=i_;const cz=(v,w)=>BigInt(v>>>0)<<tv|BigInt(w>>>0);bt.toBig=cz;const uz=(v,w,I)=>v>>>I,dz=(v,w,I)=>v<<32-I|w>>>I,fz=(v,w,I)=>v>>>I|w<<32-I,hz=(v,w,I)=>v<<32-I|w>>>I,pz=(v,w,I)=>v<<64-I|w>>>I-32,mz=(v,w,I)=>v>>>I-32|w<<64-I,gz=(v,w)=>w,yz=(v,w)=>v,bz=(v,w,I)=>v<<I|w>>>32-I,wz=(v,w,I)=>w<<I|v>>>32-I,vz=(v,w,I)=>w<<I-32|v>>>64-I,xz=(v,w,I)=>v<<I-32|w>>>64-I;function s_(v,w,I,D){const $=(w>>>0)+(D>>>0);return{h:v+I+($/2**32|0)|0,l:$|0}}bt.add=s_;const Sz=(v,w,I)=>(v>>>0)+(w>>>0)+(I>>>0),kz=(v,w,I,D)=>w+I+D+(v/2**32|0)|0,Ez=(v,w,I,D)=>(v>>>0)+(w>>>0)+(I>>>0)+(D>>>0),Tz=(v,w,I,D,$)=>w+I+D+$+(v/2**32|0)|0,Cz=(v,w,I,D,$)=>(v>>>0)+(w>>>0)+(I>>>0)+(D>>>0)+($>>>0),_z=(v,w,I,D,$,H)=>w+I+D+$+H+(v/2**32|0)|0,Az={fromBig:nv,split:i_,toBig:bt.toBig,shrSH:uz,shrSL:dz,rotrSH:fz,rotrSL:hz,rotrBH:pz,rotrBL:mz,rotr32H:gz,rotr32L:yz,rotlSH:bz,rotlSL:wz,rotlBH:vz,rotlBL:xz,add:s_,add3L:Sz,add3H:kz,add4L:Ez,add4H:Tz,add5H:_z,add5L:Cz};bt.default=Az;const[Pz,Iz]=bt.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(v=>BigInt(v))),Pl=new Uint32Array(80),Il=new Uint32Array(80);class Th extends da.SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:w,Al:I,Bh:D,Bl:$,Ch:H,Cl:X,Dh:j,Dl:fe,Eh:be,El:he,Fh:ge,Fl:K,Gh:J,Gl:le,Hh:me,Hl:ke}=this;return[w,I,D,$,H,X,j,fe,be,he,ge,K,J,le,me,ke]}set(w,I,D,$,H,X,j,fe,be,he,ge,K,J,le,me,ke){this.Ah=w|0,this.Al=I|0,this.Bh=D|0,this.Bl=$|0,this.Ch=H|0,this.Cl=X|0,this.Dh=j|0,this.Dl=fe|0,this.Eh=be|0,this.El=he|0,this.Fh=ge|0,this.Fl=K|0,this.Gh=J|0,this.Gl=le|0,this.Hh=me|0,this.Hl=ke|0}process(w,I){for(let Le=0;Le<16;Le++,I+=4)Pl[Le]=w.getUint32(I),Il[Le]=w.getUint32(I+=4);for(let Le=16;Le<80;Le++){const st=Pl[Le-15]|0,tt=Il[Le-15]|0,Je=bt.default.rotrSH(st,tt,1)^bt.default.rotrSH(st,tt,8)^bt.default.shrSH(st,tt,7),ot=bt.default.rotrSL(st,tt,1)^bt.default.rotrSL(st,tt,8)^bt.default.shrSL(st,tt,7),dt=Pl[Le-2]|0,dn=Il[Le-2]|0,re=bt.default.rotrSH(dt,dn,19)^bt.default.rotrBH(dt,dn,61)^bt.default.shrSH(dt,dn,6),se=bt.default.rotrSL(dt,dn,19)^bt.default.rotrBL(dt,dn,61)^bt.default.shrSL(dt,dn,6),ee=bt.default.add4L(ot,se,Il[Le-7],Il[Le-16]),pe=bt.default.add4H(ee,Je,re,Pl[Le-7],Pl[Le-16]);Pl[Le]=pe|0,Il[Le]=ee|0}let{Ah:D,Al:$,Bh:H,Bl:X,Ch:j,Cl:fe,Dh:be,Dl:he,Eh:ge,El:K,Fh:J,Fl:le,Gh:me,Gl:ke,Hh:Pe,Hl:qe}=this;for(let Le=0;Le<80;Le++){const st=bt.default.rotrSH(ge,K,14)^bt.default.rotrSH(ge,K,18)^bt.default.rotrBH(ge,K,41),tt=bt.default.rotrSL(ge,K,14)^bt.default.rotrSL(ge,K,18)^bt.default.rotrBL(ge,K,41),Je=ge&J^~ge&me,ot=K&le^~K&ke,dt=bt.default.add5L(qe,tt,ot,Iz[Le],Il[Le]),dn=bt.default.add5H(dt,Pe,st,Je,Pz[Le],Pl[Le]),re=dt|0,se=bt.default.rotrSH(D,$,28)^bt.default.rotrBH(D,$,34)^bt.default.rotrBH(D,$,39),ee=bt.default.rotrSL(D,$,28)^bt.default.rotrBL(D,$,34)^bt.default.rotrBL(D,$,39),pe=D&H^D&j^H&j,xe=$&X^$&fe^X&fe;Pe=me|0,qe=ke|0,me=J|0,ke=le|0,J=ge|0,le=K|0,{h:ge,l:K}=bt.default.add(be|0,he|0,dn|0,re|0),be=j|0,he=fe|0,j=H|0,fe=X|0,H=D|0,X=$|0;const De=bt.default.add3L(re,ee,xe);D=bt.default.add3H(De,dn,se,pe),$=De|0}({h:D,l:$}=bt.default.add(this.Ah|0,this.Al|0,D|0,$|0)),{h:H,l:X}=bt.default.add(this.Bh|0,this.Bl|0,H|0,X|0),{h:j,l:fe}=bt.default.add(this.Ch|0,this.Cl|0,j|0,fe|0),{h:be,l:he}=bt.default.add(this.Dh|0,this.Dl|0,be|0,he|0),{h:ge,l:K}=bt.default.add(this.Eh|0,this.El|0,ge|0,K|0),{h:J,l:le}=bt.default.add(this.Fh|0,this.Fl|0,J|0,le|0),{h:me,l:ke}=bt.default.add(this.Gh|0,this.Gl|0,me|0,ke|0),{h:Pe,l:qe}=bt.default.add(this.Hh|0,this.Hl|0,Pe|0,qe|0),this.set(D,$,H,X,j,fe,be,he,ge,K,J,le,me,ke,Pe,qe)}roundClean(){Pl.fill(0),Il.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}ki.SHA512=Th;class Oz extends Th{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class Mz extends Th{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class Nz extends Th{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}ki.sha512=(0,Ye.wrapConstructor)(()=>new Th),ki.sha512_224=(0,Ye.wrapConstructor)(()=>new Oz),ki.sha512_256=(0,Ye.wrapConstructor)(()=>new Mz),ki.sha384=(0,Ye.wrapConstructor)(()=>new Nz);const Rz=v=>v[0]==="ãããããã";function o_(v){if(typeof v!="string")throw new TypeError(`Invalid mnemonic type: ${typeof v}`);return v.normalize("NFKD")}function rv(v){const w=o_(v),I=w.split(" ");if(![12,15,18,21,24].includes(I.length))throw new Error("Invalid mnemonic");return{nfkd:w,words:I}}function a_(v){qt.default.bytes(v,16,20,24,28,32)}function Dz(v,w=128){if(qt.default.number(w),w%32!==0||w>256)throw new TypeError("Invalid entropy");return u_((0,Ye.randomBytes)(w/8),v)}ti.generateMnemonic=Dz;const Lz=v=>{const w=8-v.length/4;return new Uint8Array([(0,Nr.sha256)(v)[0]>>w<<w])};function l_(v){if(!Array.isArray(v)||v.length!==2048||typeof v[0]!="string")throw new Error("Worlist: expected array of 2048 strings");return v.forEach(w=>{if(typeof w!="string")throw new Error(`Wordlist: non-string element: ${w}`)}),Ed.chain(Ed.checksum(1,Lz),Ed.radix2(11,!0),Ed.alphabet(v))}function c_(v,w){const{words:I}=rv(v),D=l_(w).decode(I);return a_(D),D}ti.mnemonicToEntropy=c_;function u_(v,w){return a_(v),l_(w).encode(v).join(Rz(w)?"ã":" ")}ti.entropyToMnemonic=u_;function Bz(v,w){try{c_(v,w)}catch{return!1}return!0}ti.validateMnemonic=Bz;const d_=v=>o_(`mnemonic${v}`);function Fz(v,w=""){return(0,iu.pbkdf2Async)(ki.sha512,rv(v).nfkd,d_(w),{c:2048,dkLen:64})}ti.mnemonicToSeed=Fz;function $z(v,w=""){return(0,iu.pbkdf2)(ki.sha512,rv(v).nfkd,d_(w),{c:2048,dkLen:64})}ti.mnemonicToSeedSync=$z;var Td={};Object.defineProperty(Td,"__esModule",{value:!0}),Td.ripemd160=Td.RIPEMD160=void 0;const zz=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),f_=Uint8Array.from({length:16},(v,w)=>w),Uz=f_.map(v=>(9*v+5)%16);let iv=[f_],sv=[Uz];for(let v=0;v<4;v++)for(let w of[iv,sv])w.push(w[v].map(I=>zz[I]));const h_=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(v=>new Uint8Array(v)),Hz=iv.map((v,w)=>v.map(I=>h_[w][I])),Vz=sv.map((v,w)=>v.map(I=>h_[w][I])),Wz=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),jz=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),fg=(v,w)=>v<<w|v>>>32-w;function p_(v,w,I,D){return v===0?w^I^D:v===1?w&I|~w&D:v===2?(w|~I)^D:v===3?w&D|I&~D:w^(I|~D)}const hg=new Uint32Array(16);class m_ extends da.SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:w,h1:I,h2:D,h3:$,h4:H}=this;return[w,I,D,$,H]}set(w,I,D,$,H){this.h0=w|0,this.h1=I|0,this.h2=D|0,this.h3=$|0,this.h4=H|0}process(w,I){for(let J=0;J<16;J++,I+=4)hg[J]=w.getUint32(I,!0);let D=this.h0|0,$=D,H=this.h1|0,X=H,j=this.h2|0,fe=j,be=this.h3|0,he=be,ge=this.h4|0,K=ge;for(let J=0;J<5;J++){const le=4-J,me=Wz[J],ke=jz[J],Pe=iv[J],qe=sv[J],Le=Hz[J],st=Vz[J];for(let tt=0;tt<16;tt++){const Je=fg(D+p_(J,H,j,be)+hg[Pe[tt]]+me,Le[tt])+ge|0;D=ge,ge=be,be=fg(j,10)|0,j=H,H=Je}for(let tt=0;tt<16;tt++){const Je=fg($+p_(le,X,fe,he)+hg[qe[tt]]+ke,st[tt])+K|0;$=K,K=he,he=fg(fe,10)|0,fe=X,X=Je}}this.set(this.h1+j+he|0,this.h2+be+K|0,this.h3+ge+$|0,this.h4+D+X|0,this.h0+H+fe|0)}roundClean(){hg.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}Td.RIPEMD160=m_,Td.ripemd160=(0,Ye.wrapConstructor)(()=>new m_),At.hmacSha256Sync=(v,...w)=>(0,ma.hmac)(Nr.sha256,v,At.concatBytes(...w));const ov=rz(Nr.sha256);function g_(v){return BigInt(`0x${(0,Ye.bytesToHex)(v)}`)}function qz(v){return(0,Ye.hexToBytes)(v.toString(16).padStart(64,"0"))}const Kz=(0,Ye.utf8ToBytes)("Bitcoin seed"),av={private:76066276,public:76067358},lv=2147483648,Gz=v=>(0,Td.ripemd160)((0,Nr.sha256)(v)),Zz=v=>(0,Ye.createView)(v).getUint32(0,!1),pg=v=>{if(!Number.isSafeInteger(v)||v<0||v>2**32-1)throw new Error(`Invalid number=${v}. Should be from 0 to 2 ** 32 - 1`);const w=new Uint8Array(4);return(0,Ye.createView)(w).setUint32(0,v,!1),w};class su{constructor(w){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!w||typeof w!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=w.versions||av,this.depth=w.depth||0,this.chainCode=w.chainCode,this.index=w.index||0,this.parentFingerprint=w.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(w.publicKey&&w.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(w.privateKey){if(!At.isValidPrivateKey(w.privateKey))throw new Error("Invalid private key");this.privKey=typeof w.privateKey=="bigint"?w.privateKey:g_(w.privateKey),this.privKeyBytes=qz(this.privKey),this.pubKey=Tt(w.privateKey,!0)}else if(w.publicKey)this.pubKey=M.fromHex(w.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=Gz(this.pubKey)}get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return Zz(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const w=this.privateKey;if(!w)throw new Error("No private key");return ov.encode(this.serialize(this.versions.private,(0,Ye.concatBytes)(new Uint8Array([0]),w)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return ov.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(w,I=av){if((0,qt.bytes)(w),8*w.length<128||8*w.length>512)throw new Error(`HDKey: wrong seed length=${w.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const D=(0,ma.hmac)(ki.sha512,Kz,w);return new su({versions:I,chainCode:D.slice(32),privateKey:D.slice(0,32)})}static fromExtendedKey(w,I=av){const D=ov.decode(w),$=(0,Ye.createView)(D),H=$.getUint32(0,!1),X={versions:I,depth:D[4],parentFingerprint:$.getUint32(5,!1),index:$.getUint32(9,!1),chainCode:D.slice(13,45)},j=D.slice(45),fe=j[0]===0;if(H!==I[fe?"private":"public"])throw new Error("Version mismatch");return fe?new su({...X,privateKey:j.slice(1)}):new su({...X,publicKey:j})}static fromJSON(w){return su.fromExtendedKey(w.xpriv)}derive(w){if(!/^[mM]'?/.test(w))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(w))return this;const I=w.replace(/^[mM]'?\//,"").split("/");let D=this;for(const $ of I){const H=/^(\d+)('?)$/.exec($);if(!H||H.length!==3)throw new Error(`Invalid child index: ${$}`);let X=+H[1];if(!Number.isSafeInteger(X)||X>=lv)throw new Error("Invalid index");H[2]==="'"&&(X+=lv),D=D.deriveChild(X)}return D}deriveChild(w){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let I=pg(w);if(w>=lv){const j=this.privateKey;if(!j)throw new Error("Could not derive hardened child key");I=(0,Ye.concatBytes)(new Uint8Array([0]),j,I)}else I=(0,Ye.concatBytes)(this.pubKey,I);const D=(0,ma.hmac)(ki.sha512,this.chainCode,I),$=g_(D.slice(0,32)),H=D.slice(32);if(!At.isValidPrivateKey($))throw new Error("Tweak bigger than curve order");const X={versions:this.versions,chainCode:H,depth:this.depth+1,parentFingerprint:this.fingerprint,index:w};try{if(this.privateKey){const j=At.mod(this.privKey+$,f.n);if(!At.isValidPrivateKey(j))throw new Error("The tweak was out of range or the resulted private key is invalid");X.privateKey=j}else{const j=M.fromHex(this.pubKey).add(M.fromPrivateKey($));if(j.equals(M.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");X.publicKey=j.toRawBytes(!0)}return new su(X)}catch{return this.deriveChild(w+1)}}sign(w){if(!this.privateKey)throw new Error("No privateKey set!");return(0,qt.bytes)(w,32),en(w,this.privKey,{canonical:!0,der:!1})}verify(w,I){if((0,qt.bytes)(w,32),(0,qt.bytes)(I,64),!this.publicKey)throw new Error("No publicKey set!");let D;try{D=R.fromCompact(I)}catch{return!1}return Nn(D,w,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(w,I){if(!this.chainCode)throw new Error("No chainCode set");return(0,qt.bytes)(I,33),(0,Ye.concatBytes)(pg(w),new Uint8Array([this.depth]),pg(this.parentFingerprint),pg(this.index),this.chainCode,I)}}var Xz=Object.defineProperty,Fi=(v,w)=>{for(var I in w)Xz(v,I,{get:w[I],enumerable:!0})};function Qz(){return At.bytesToHex(At.randomPrivateKey())}function y_(v){return At.bytesToHex(bi.getPublicKey(v))}var Yz={};Fi(Yz,{insertEventIntoAscendingList:()=>eU,insertEventIntoDescendingList:()=>Jz,normalizeURL:()=>cv,utf8Decoder:()=>Ol,utf8Encoder:()=>yo});var Ol=new TextDecoder("utf-8"),yo=new TextEncoder;function cv(v){let w=new URL(v);return w.pathname=w.pathname.replace(/\/+/g,"/"),w.pathname.endsWith("/")&&(w.pathname=w.pathname.slice(0,-1)),(w.port==="80"&&w.protocol==="ws:"||w.port==="443"&&w.protocol==="wss:")&&(w.port=""),w.searchParams.sort(),w.hash="",w.toString()}function Jz(v,w){let I=0,D=v.length-1,$,H=I;if(D<0)H=0;else if(w.created_at<v[D].created_at)H=D+1;else if(w.created_at>=v[I].created_at)H=I;else for(;;){if(D<=I+1){H=D;break}if($=Math.floor(I+(D-I)/2),v[$].created_at>w.created_at)I=$;else if(v[$].created_at<w.created_at)D=$;else{H=$;break}}return v[H]?.id!==w.id?[...v.slice(0,H),w,...v.slice(H)]:v}function eU(v,w){let I=0,D=v.length-1,$,H=I;if(D<0)H=0;else if(w.created_at>v[D].created_at)H=D+1;else if(w.created_at<=v[I].created_at)H=I;else for(;;){if(D<=I+1){H=D;break}if($=Math.floor(I+(D-I)/2),v[$].created_at<w.created_at)I=$;else if(v[$].created_at>w.created_at)D=$;else{H=$;break}}return v[H]?.id!==w.id?[...v.slice(0,H),w,...v.slice(H)]:v}function tU(v,w){let I=v;return I.pubkey=y_(w),I.id=uv(I),I.sig=iU(I,w),I}function nU(v){if(!dv(v))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,v.pubkey,v.created_at,v.kind,v.tags,v.content])}function uv(v){let w=(0,Nr.sha256)(yo.encode(nU(v)));return At.bytesToHex(w)}var rU=v=>v instanceof Object;function dv(v){if(!rU(v)||typeof v.kind!="number"||typeof v.content!="string"||typeof v.created_at!="number"||typeof v.pubkey!="string"||!v.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(v.tags))return!1;for(let w=0;w<v.tags.length;w++){let I=v.tags[w];if(!Array.isArray(I))return!1;for(let D=0;D<I.length;D++)if(typeof I[D]=="object")return!1}return!0}function b_(v){return bi.verifySync(v.sig,uv(v),v.pubkey)}function iU(v,w){return At.bytesToHex(bi.signSync(uv(v),w))}function sU(v,w){if(v.ids&&v.ids.indexOf(w.id)===-1&&!v.ids.some(I=>w.id.startsWith(I))||v.kinds&&v.kinds.indexOf(w.kind)===-1||v.authors&&v.authors.indexOf(w.pubkey)===-1&&!v.authors.some(I=>w.pubkey.startsWith(I)))return!1;for(let I in v)if(I[0]==="#"){let D=I.slice(1),$=v[`#${D}`];if($&&!w.tags.find(([H,X])=>H===I.slice(1)&&$.indexOf(X)!==-1))return!1}return!(v.since&&w.created_at<v.since||v.until&&w.created_at>=v.until)}function oU(v,w){for(let I=0;I<v.length;I++)if(sU(v[I],w))return!0;return!1}var aU={};Fi(aU,{getHex64:()=>mg,getInt:()=>w_,getSubscriptionId:()=>v_,matchEventId:()=>lU,matchEventKind:()=>uU,matchEventPubkey:()=>cU});function mg(v,w){let I=w.length+3,D=v.indexOf(`"${w}":`)+I,$=v.slice(D).indexOf('"')+D+1;return v.slice($,$+64)}function w_(v,w){let I=w.length,D=v.indexOf(`"${w}":`)+I+3,$=v.slice(D),H=Math.min($.indexOf(","),$.indexOf("}"));return parseInt($.slice(0,H),10)}function v_(v){let w=v.slice(0,22).indexOf('"EVENT"');if(w===-1)return null;let I=v.slice(w+7+1).indexOf('"');if(I===-1)return null;let D=w+7+1+I,$=v.slice(D+1,80).indexOf('"');if($===-1)return null;let H=D+1+$;return v.slice(D+1,H)}function lU(v,w){return w===mg(v,"id")}function cU(v,w){return w===mg(v,"pubkey")}function uU(v,w){return w===w_(v,"kind")}var x_=()=>({connect:[],disconnect:[],error:[],notice:[],auth:[]});function dU(v,w={}){let{listTimeout:I=3e3,getTimeout:D=3e3,countTimeout:$=3e3}=w;var H,X={},j=x_(),fe={},be={},he;async function ge(){return he||(he=new Promise((Pe,qe)=>{try{H=new WebSocket(v)}catch(Je){qe(Je)}H.onopen=()=>{j.connect.forEach(Je=>Je()),Pe()},H.onerror=()=>{he=void 0,j.error.forEach(Je=>Je()),qe()},H.onclose=async()=>{he=void 0,j.disconnect.forEach(Je=>Je())};let Le=[],st;H.onmessage=Je=>{Le.push(Je.data),st||(st=setInterval(tt,0))};function tt(){if(Le.length===0){clearInterval(st),st=null;return}var Je=Le.shift();if(!Je)return;let ot=v_(Je);if(ot){let dt=X[ot];if(dt&&dt.alreadyHaveEvent&&dt.alreadyHaveEvent(mg(Je,"id"),v))return}try{let dt=JSON.parse(Je);switch(dt[0]){case"EVENT":{let ee=dt[1],pe=dt[2];dv(pe)&&X[ee]&&(X[ee].skipVerification||b_(pe))&&oU(X[ee].filters,pe)&&(X[ee],(fe[ee]?.event||[]).forEach(xe=>xe(pe)));return}case"COUNT":let dn=dt[1],re=dt[2];X[dn]&&(fe[dn]?.count||[]).forEach(ee=>ee(re));return;case"EOSE":{let ee=dt[1];ee in fe&&(fe[ee].eose.forEach(pe=>pe()),fe[ee].eose=[]);return}case"OK":{let ee=dt[1],pe=dt[2],xe=dt[3]||"";ee in be&&(pe?be[ee].ok.forEach(De=>De()):be[ee].failed.forEach(De=>De(xe)),be[ee].ok=[],be[ee].failed=[]);return}case"NOTICE":let se=dt[1];j.notice.forEach(ee=>ee(se));return;case"AUTH":{let ee=dt[1];j.auth?.forEach(pe=>pe(ee));return}}}catch{return}}}),he)}function K(){return H?.readyState===1}async function J(){K()||await ge()}async function le(Pe){let qe=JSON.stringify(Pe);if(!(!K()&&(await new Promise(Le=>setTimeout(Le,1e3)),!K())))try{H.send(qe)}catch(Le){console.log(Le)}}const me=(Pe,{verb:qe="REQ",skipVerification:Le=!1,alreadyHaveEvent:st=null,id:tt=Math.random().toString().slice(2)}={})=>{let Je=tt;return X[Je]={id:Je,filters:Pe,skipVerification:Le,alreadyHaveEvent:st},le([qe,Je,...Pe]),{sub:(ot,dt={})=>me(ot||Pe,{skipVerification:dt.skipVerification||Le,alreadyHaveEvent:dt.alreadyHaveEvent||st,id:Je}),unsub:()=>{delete X[Je],delete fe[Je],le(["CLOSE",Je])},on:(ot,dt)=>{fe[Je]=fe[Je]||{event:[],count:[],eose:[]},fe[Je][ot].push(dt)},off:(ot,dt)=>{let dn=fe[Je],re=dn[ot].indexOf(dt);re>=0&&dn[ot].splice(re,1)}}};function ke(Pe,qe){if(!Pe.id)throw new Error(`event ${Pe} has no id`);let Le=Pe.id;return le([qe,Pe]),{on:(st,tt)=>{be[Le]=be[Le]||{ok:[],failed:[]},be[Le][st].push(tt)},off:(st,tt)=>{let Je=be[Le];if(!Je)return;let ot=Je[st].indexOf(tt);ot>=0&&Je[st].splice(ot,1)}}}return{url:v,sub:me,on:(Pe,qe)=>{j[Pe].push(qe),Pe==="connect"&&H?.readyState===1&&qe()},off:(Pe,qe)=>{let Le=j[Pe].indexOf(qe);Le!==-1&&j[Pe].splice(Le,1)},list:(Pe,qe)=>new Promise(Le=>{let st=me(Pe,qe),tt=[],Je=setTimeout(()=>{st.unsub(),Le(tt)},I);st.on("eose",()=>{st.unsub(),clearTimeout(Je),Le(tt)}),st.on("event",ot=>{tt.push(ot)})}),get:(Pe,qe)=>new Promise(Le=>{let st=me([Pe],qe),tt=setTimeout(()=>{st.unsub(),Le(null)},D);st.on("event",Je=>{st.unsub(),clearTimeout(tt),Le(Je)})}),count:Pe=>new Promise(qe=>{let Le=me(Pe,{...me,verb:"COUNT"}),st=setTimeout(()=>{Le.unsub(),qe(null)},$);Le.on("count",tt=>{Le.unsub(),clearTimeout(st),qe(tt)})}),publish(Pe){return ke(Pe,"EVENT")},auth(Pe){return ke(Pe,"AUTH")},connect:J,close(){j=x_(),fe={},be={},H.readyState===WebSocket.OPEN&&H?.close()},get status(){return H?.readyState??3}}}var S_=class{_conn;_seenOn={};eoseSubTimeout;getTimeout;constructor(v={}){this._conn={},this.eoseSubTimeout=v.eoseSubTimeout||3400,this.getTimeout=v.getTimeout||3400}close(v){v.forEach(w=>{let I=this._conn[cv(w)];I&&I.close()})}async ensureRelay(v){const w=cv(v);this._conn[w]||(this._conn[w]=dU(w,{getTimeout:this.getTimeout*.9,listTimeout:this.getTimeout*.9}));const I=this._conn[w];return await I.connect(),I}sub(v,w,I){let D=new Set,$={...I||{}};$.alreadyHaveEvent=(K,J)=>{if(I?.alreadyHaveEvent?.(K,J))return!0;let le=this._seenOn[K]||new Set;return le.add(J),this._seenOn[K]=le,D.has(K)};let H=[],X=new Set,j=new Set,fe=v.length,be=!1,he=setTimeout(()=>{be=!0;for(let K of j.values())K()},this.eoseSubTimeout);v.forEach(async K=>{let J;try{J=await this.ensureRelay(K)}catch{me();return}if(!J)return;let le=J.sub(w,$);le.on("event",ke=>{D.add(ke.id);for(let Pe of X.values())Pe(ke)}),le.on("eose",()=>{be||me()}),H.push(le);function me(){if(fe--,fe===0){clearTimeout(he);for(let ke of j.values())ke()}}});let ge={sub(K,J){return H.forEach(le=>le.sub(K,J)),ge},unsub(){H.forEach(K=>K.unsub())},on(K,J){K==="event"?X.add(J):K==="eose"&&j.add(J)},off(K,J){K==="event"?X.delete(J):K==="eose"&&j.delete(J)}};return ge}get(v,w,I){return new Promise(D=>{let $=this.sub(v,[w],I),H=setTimeout(()=>{$.unsub(),D(null)},this.getTimeout);$.on("event",X=>{D(X),clearTimeout(H),$.unsub()})})}list(v,w,I){return new Promise(D=>{let $=[],H=this.sub(v,w,I);H.on("event",X=>{$.push(X)}),H.on("eose",()=>{H.unsub(),D($)})})}publish(v,w){const I=v.map(async $=>{let H;try{return H=await this.ensureRelay($),H.publish(w)}catch{return{on(){},off(){}}}}),D=new Map;return{on($,H){v.forEach(async(X,j)=>{let fe=await I[j],be=()=>H(X);D.set(H,be),fe.on($,be)})},off($,H){v.forEach(async(X,j)=>{let fe=D.get(H);fe&&(await I[j]).off($,fe)})}}}seenOn(v){return Array.from(this._seenOn[v]?.values?.()||[])}},fv={};Fi(fv,{decode:()=>gg,naddrEncode:()=>yU,neventEncode:()=>gU,noteEncode:()=>pU,nprofileEncode:()=>mU,npubEncode:()=>hU,nrelayEncode:()=>bU,nsecEncode:()=>fU});var Cd=5e3;function gg(v){let{prefix:w,words:I}=Bi.decode(v,Cd),D=new Uint8Array(Bi.fromWords(I));switch(w){case"nprofile":{let $=yg(D);if(!$[0]?.[0])throw new Error("missing TLV 0 for nprofile");if($[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:At.bytesToHex($[0][0]),relays:$[1]?$[1].map(H=>Ol.decode(H)):[]}}}case"nevent":{let $=yg(D);if(!$[0]?.[0])throw new Error("missing TLV 0 for nevent");if($[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if($[2]&&$[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");return{type:"nevent",data:{id:At.bytesToHex($[0][0]),relays:$[1]?$[1].map(H=>Ol.decode(H)):[],author:$[2]?.[0]?At.bytesToHex($[2][0]):void 0}}}case"naddr":{let $=yg(D);if(!$[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!$[2]?.[0])throw new Error("missing TLV 2 for naddr");if($[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!$[3]?.[0])throw new Error("missing TLV 3 for naddr");if($[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ol.decode($[0][0]),pubkey:At.bytesToHex($[2][0]),kind:parseInt(At.bytesToHex($[3][0]),16),relays:$[1]?$[1].map(H=>Ol.decode(H)):[]}}}case"nrelay":{let $=yg(D);if(!$[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Ol.decode($[0][0])}}case"nsec":case"npub":case"note":return{type:w,data:At.bytesToHex(D)};default:throw new Error(`unknown prefix ${w}`)}}function yg(v){let w={},I=v;for(;I.length>0;){let D=I[0],$=I[1],H=I.slice(2,2+$);I=I.slice(2+$),!(H.length<$)&&(w[D]=w[D]||[],w[D].push(H))}return w}function fU(v){return hv("nsec",v)}function hU(v){return hv("npub",v)}function pU(v){return hv("note",v)}function hv(v,w){let I=At.hexToBytes(w),D=Bi.toWords(I);return Bi.encode(v,D,Cd)}function mU(v){let w=bg({0:[At.hexToBytes(v.pubkey)],1:(v.relays||[]).map(D=>yo.encode(D))}),I=Bi.toWords(w);return Bi.encode("nprofile",I,Cd)}function gU(v){let w=bg({0:[At.hexToBytes(v.id)],1:(v.relays||[]).map(D=>yo.encode(D)),2:v.author?[At.hexToBytes(v.author)]:[]}),I=Bi.toWords(w);return Bi.encode("nevent",I,Cd)}function yU(v){let w=new ArrayBuffer(4);new DataView(w).setUint32(0,v.kind,!1);let I=bg({0:[yo.encode(v.identifier)],1:(v.relays||[]).map($=>yo.encode($)),2:[At.hexToBytes(v.pubkey)],3:[new Uint8Array(w)]}),D=Bi.toWords(I);return Bi.encode("naddr",D,Cd)}function bU(v){let w=bg({0:[yo.encode(v)]}),I=Bi.toWords(w);return Bi.encode("nrelay",I,Cd)}function bg(v){let w=[];return Object.entries(v).forEach(([I,D])=>{D.forEach($=>{let H=new Uint8Array($.length+2);H.set([parseInt(I)],0),H.set([$.length],1),H.set($,2),w.push(H)})}),At.concatBytes(...w)}var wU={};Fi(wU,{decrypt:()=>xU,encrypt:()=>vU});async function vU(v,w,I){const D=Ft(v,"02"+w),$=k_(D);let H=Uint8Array.from((0,Ye.randomBytes)(16)),X=yo.encode(I),j=await crypto.subtle.importKey("raw",$,{name:"AES-CBC"},!1,["encrypt"]),fe=await crypto.subtle.encrypt({name:"AES-CBC",iv:H},j,X),be=Sh.encode(new Uint8Array(fe)),he=Sh.encode(new Uint8Array(H.buffer));return`${be}?iv=${he}`}async function xU(v,w,I){let[D,$]=I.split("?iv="),H=Ft(v,"02"+w),X=k_(H),j=await crypto.subtle.importKey("raw",X,{name:"AES-CBC"},!1,["decrypt"]),fe=Sh.decode(D),be=Sh.decode($),he=await crypto.subtle.decrypt({name:"AES-CBC",iv:be},j,fe);return Ol.decode(he)}function k_(v){return v.slice(1,33)}var SU={};Fi(SU,{queryProfile:()=>TU,searchDomain:()=>EU,useFetchImplementation:()=>kU});var wg;try{wg=fetch}catch{}function kU(v){wg=v}async function EU(v,w=""){try{return(await(await wg(`https://${v}/.well-known/nostr.json?name=${w}`)).json()).names}catch{return{}}}async function TU(v){let[w,I]=v.split("@");if(I||(I=w,w="_"),!w.match(/^[A-Za-z0-9-_.]+$/)||!I.includes("."))return null;let D;try{D=await(await wg(`https://${I}/.well-known/nostr.json?name=${w}`)).json()}catch{return null}if(!D?.names?.[w])return null;let $=D.names[w],H=D.relays?.[$]||[];return{pubkey:$,relays:H}}var CU={};Fi(CU,{generateSeedWords:()=>AU,privateKeyFromSeedWords:()=>_U,validateWords:()=>PU});function _U(v,w){let D=su.fromMasterSeed((0,ti.mnemonicToSeedSync)(v,w)).derive("m/44'/1237'/0'/0/0").privateKey;if(!D)throw new Error("could not derive private key");return At.bytesToHex(D)}function AU(){return(0,ti.generateMnemonic)(Eh.wordlist)}function PU(v){return(0,ti.validateMnemonic)(v,Eh.wordlist)}var IU={};Fi(IU,{parse:()=>OU});function OU(v){const w={reply:void 0,root:void 0,mentions:[],profiles:[]},I=[];for(const D of v.tags)D[0]==="e"&&D[1]&&I.push(D),D[0]==="p"&&D[1]&&w.profiles.push({pubkey:D[1],relays:D[2]?[D[2]]:[]});for(let D=0;D<I.length;D++){const $=I[D],[H,X,j,fe]=$,be={id:X,relays:j?[j]:[]},he=D===0,ge=D===I.length-1;if(fe==="root"){w.root=be;continue}if(fe==="reply"){w.reply=be;continue}if(fe==="mention"){w.mentions.push(be);continue}if(he){w.root=be;continue}if(ge){w.reply=be;continue}w.mentions.push(be)}return w}var MU={};Fi(MU,{getPow:()=>NU});function NU(v){return RU(At.hexToBytes(v))}function RU(v){let w,I,D;for(I=0,w=0;I<v.length&&(D=DU(v[I]),w+=D,D===8);I++);return w}function DU(v){let w=0;if(v===0)return 8;for(;v>>=1;)w++;return 7-w}var LU={};Fi(LU,{BECH32_REGEX:()=>E_,NOSTR_URI_REGEX:()=>vg,parse:()=>FU,test:()=>BU});var E_=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/,vg=new RegExp(`nostr:(${E_.source})`);function BU(v){return typeof v=="string"&&new RegExp(`^${vg.source}$`).test(v)}function FU(v){const w=v.match(new RegExp(`^${vg.source}$`));if(!w)throw new Error(`Invalid Nostr URI: ${v}`);return{uri:w[0],value:w[1],decoded:gg(w[1])}}var $U={};Fi($U,{createDelegation:()=>zU,getDelegator:()=>UU});function zU(v,w){let I=[];(w.kind||-1)>=0&&I.push(`kind=${w.kind}`),w.until&&I.push(`created_at<${w.until}`),w.since&&I.push(`created_at>${w.since}`);let D=I.join("&");if(D==="")throw new Error("refusing to create a delegation without any conditions");let $=(0,Nr.sha256)(yo.encode(`nostr:delegation:${w.pubkey}:${D}`)),H=At.bytesToHex(bi.signSync($,v));return{from:y_(v),to:w.pubkey,cond:D,sig:H}}function UU(v){let w=v.tags.find(j=>j[0]==="delegation"&&j.length>=4);if(!w)return null;let I=w[1],D=w[2],$=w[3],H=D.split("&");for(let j=0;j<H.length;j++){let[fe,be,he]=H[j].split(/\b/);if(!(fe==="kind"&&be==="="&&v.kind===parseInt(he))){if(fe==="created_at"&&be==="<"&&v.created_at<parseInt(he))continue;if(fe==="created_at"&&be===">"&&v.created_at>parseInt(he))continue;return null}}let X=(0,Nr.sha256)(yo.encode(`nostr:delegation:${v.pubkey}:${D}`));return bi.verifySync($,X,I)?I:null}var HU={};Fi(HU,{matchAll:()=>VU,regex:()=>pv,replaceAll:()=>WU});var pv=()=>new RegExp(`\\b${vg.source}\\b`,"g");function*VU(v){const w=v.matchAll(pv());for(const I of w){const[D,$]=I;yield{uri:D,value:$,decoded:gg($),start:I.index,end:I.index+D.length}}}function WU(v,w){return v.replaceAll(pv(),(I,D)=>w({uri:I,value:D,decoded:gg(D)}))}var jU={};Fi(jU,{useFetchImplementation:()=>qU,validateGithub:()=>KU});var mv;try{mv=fetch}catch{}function qU(v){mv=v}async function KU(v,w,I){try{return await(await mv(`https://gist.github.com/${w}/${I}/raw`)).text()===`Verifying that I control the following Nostr public key: ${v}`}catch{return!1}}var GU={};Fi(GU,{authenticate:()=>ZU});var ZU=async({challenge:v,relay:w,sign:I})=>{const D={kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",w.url],["challenge",v]],content:""},$=w.auth(await I(D));return new Promise((H,X)=>{$.on("ok",function j(){$.off("ok",j),H()}),$.on("failed",function j(fe){$.off("failed",j),X(fe)})})},gv={};Fi(gv,{getZapEndpoint:()=>QU,makeZapReceipt:()=>e7,makeZapRequest:()=>YU,useFetchImplementation:()=>XU,validateZapRequest:()=>JU});var yv;try{yv=fetch}catch{}function XU(v){yv=v}async function QU(v){try{let w="",{lud06:I,lud16:D}=JSON.parse(v.content);if(I){let{words:X}=Bi.decode(I,1e3),j=Bi.fromWords(X);w=Ol.decode(j)}else if(D){let[X,j]=D.split("@");w=`https://${j}/.well-known/lnurlp/${X}`}else return null;let H=await(await yv(w)).json();if(H.allowsNostr&&H.nostrPubkey)return H.callback}catch{}return null}function YU({profile:v,event:w,amount:I,relays:D,comment:$=""}){if(!I)throw new Error("amount not given");if(!v)throw new Error("profile not given");let H={kind:9734,created_at:Math.round(Date.now()/1e3),content:$,tags:[["p",v],["amount",I.toString()],["relays",...D]]};return w&&H.tags.push(["e",w]),H}function JU(v){let w;try{w=JSON.parse(v)}catch{return"Invalid zap request JSON."}if(!dv(w))return"Zap request is not a valid Nostr event.";if(!b_(w))return"Invalid signature on zap request.";let I=w.tags.find(([H,X])=>H==="p"&&X);if(!I)return"Zap request doesn't have a 'p' tag.";if(!I[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let D=w.tags.find(([H,X])=>H==="e"&&X);return D&&!D[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":w.tags.find(([H,X])=>H==="relays"&&X)?null:"Zap request doesn't have a 'relays' tag."}function e7({zapRequest:v,preimage:w,bolt11:I,paidAt:D}){let H=JSON.parse(v).tags.filter(([j])=>j==="e"||j==="p"||j==="a"),X={kind:9735,created_at:Math.round(D.getTime()/1e3),content:"",tags:[...H,["bolt11",I],["description",v]]};return w&&X.tags.push(["preimage",w]),X}At.hmacSha256Sync=(v,...w)=>(0,ma.hmac)(Nr.sha256,v,At.concatBytes(...w)),At.sha256Sync=(...v)=>(0,Nr.sha256)(At.concatBytes(...v));const t7=v=>fv.decode(v).data,T_=v=>fv.decode(v).data;let C_={};const n7=async v=>{if(C_[v])return C_[v];const w=new S_,I=["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine"];try{return await w.get(I,{authors:[v],kinds:[0]})}catch{throw new Error("failed to fetch user profile :(")}finally{w.close(I)}},r7=v=>JSON.parse(v.content),i7=async v=>{const w=await gv.getZapEndpoint(v);if(!w)throw new Error("failed to retrieve zap endpoint :(");return w},s7=async(v,w)=>{if(__()&&!w)try{return await window.nostr.signEvent(v)}catch{}return tU(v,Qz())},o7=async({profile:v,nip19Target:w,amount:I,relays:D,comment:$,anon:H})=>{const X=gv.makeZapRequest({profile:v,event:w&&w.startsWith("note")?T_(w):void 0,amount:I,relays:D,comment:$}),j=w&&w.startsWith("naddr")?T_(w):void 0;if(j){const fe=j.relays?j.relays.reduce((be,he)=>`${he},${be}`,""):"";X.tags.push(["a",`${j.kind}:${j.pubkey}:${j.identifier}`,fe])}return(!__()||H)&&X.tags.push(["anon"]),s7(X,H)},a7=async({zapEndpoint:v,amount:w,comment:I,authorId:D,nip19Target:$,normalizedRelays:H,anon:X})=>{const j=await o7({profile:D,nip19Target:$,amount:w,relays:H,comment:I,anon:X});let fe=`${v}?amount=${w}&nostr=${encodeURIComponent(JSON.stringify(j))}`;I&&(fe=`${fe}&comment=${encodeURIComponent(I)}`);const be=await fetch(fe),{pr:he,reason:ge,status:K}=await be.json();if(he)return he;throw K==="ERROR"?new Error(ge??"Unable to fetch invoice"):new Error("Unable to fetch invoice")},__=()=>window!==void 0&&window.nostr!==void 0,l7=({relays:v,invoice:w,onSuccess:I})=>{const D=new S_,$=Array.from(new Set([...v,"wss://relay.nostr.band"])),H=()=>{D&&D.close($)},X=Math.round(Date.now()/1e3),j=setInterval(()=>{D.sub($,[{kinds:[9735],since:X}]).on("event",be=>{be.tags.find(he=>he[0]==="bolt11"&&he[1]===w)&&(I(),H(),clearInterval(j))})},5e3);return()=>{H(),clearInterval(j)}},A_="nostrZap.",P_="lightningUri",I_=()=>typeof localStorage<"u",c7=v=>{if(I_())return localStorage.getItem(`${A_}${v}`)},u7=(v,w)=>{I_()&&localStorage.setItem(`${A_}${v}`,w)},d7=()=>c7(P_),f7=v=>u7(P_,v);let bv=null;const h7=v=>{v=v.replace(/^#/,""),v.length===3&&(v=v.split("").map(H=>H+H).join(""));const w=parseInt(v,16),I=w>>16&255,D=w>>8&255,$=w&255;return{r:I,g:D,b:$}},p7=({r:v,g:w,b:I})=>(v*299+w*587+I*114)/1e3,O_=v=>{const w=h7(v);return p7(w)<128?"#fff":"#000"},wv=v=>{const w=document.createElement("dialog");return w.classList.add("nostr-zap-dialog"),w.innerHTML=v,w.addEventListener("click",function({clientX:I,clientY:D}){const{left:$,right:H,top:X,bottom:j}=w.getBoundingClientRect();I===0&&D===0||(I<$||I>H||D<X||D>j)&&w.close()}),bv.appendChild(w),w},m7=({dialogHeader:v,invoice:w,relays:I,buttonColor:D})=>{const $=d7(),X=wv(`
        <button class="close-button">X</button>
        ${v}
        <div class="qrcode">
          <div class="overlay">copied invoice to clipboard</div>
        </div>
        <p>click QR code to copy invoice</p>
        <select name="lightning-wallet">
          ${[{label:"Default Wallet",value:"lightning:"},{label:"Strike",value:"strike:lightning:"},{label:"Cash App",value:"https://cash.app/launch/lightning/"},{label:"Muun",value:"muun:"},{label:"Blue Wallet",value:"bluewallet:lightning:"},{label:"Wallet of Satoshi",value:"walletofsatoshi:lightning:"},{label:"Zebedee",value:"zebedee:lightning:"},{label:"Zeus LN",value:"zeusln:lightning:"},{label:"Phoenix",value:"phoenix://"},{label:"Breez",value:"breez:"},{label:"Bitcoin Beach",value:"bitcoinbeach://"},{label:"Blixt",value:"blixtwallet:lightning:"},{label:"River",value:"river://"}].map(({label:K,value:J})=>`<option value="${J}" ${$===J?"selected":""}>${K}</option>`).join("")}
        </select>
        <button class="cta-button"
          ${D?`style="background-color: ${D}; color: ${O_(D)}"`:""} 
        >Open Wallet</button>
      `),j=X.querySelector(".qrcode"),fe=X.querySelector('select[name="lightning-wallet"]'),be=X.querySelector(".cta-button"),he=j.querySelector(".overlay"),ge=l7({relays:I,invoice:w,onSuccess:()=>{X.close()}});return new(e(s))(j,{text:w,quietZone:10}),j.addEventListener("click",function(){navigator.clipboard.writeText(w),he.classList.add("show"),setTimeout(()=>he.classList.remove("show"),2e3)}),be.addEventListener("click",function(){f7(fe.value),window.location.href=`${fe.value}${w}`}),X.addEventListener("close",function(){ge(),X.remove()}),X.querySelector(".close-button").addEventListener("click",function(){X.close()}),X},g7=async({npub:v,nip19Target:w,relays:I,buttonColor:D,anon:$})=>{const H=ot=>`${ot.substring(0,12)}...${ot.substring(ot.length-12)}`,X=I?I.split(","):["wss://relay.nostr.band","wss://relay.damus.io","wss://nos.lol"],j=t7(v),fe=n7(j),be="https://pbs.twimg.com/profile_images/1604195803748306944/LxHDoJ7P_400x400.jpg",he=async()=>{const{picture:ot,display_name:dt,name:dn}=r7(await fe);return`
      <h2>${dt||dn}</h2>
        <img
          src="${ot||be}"
          width="80"
          height="80"
          alt="nostr user avatar"
        />
      <p>${H(w||v)}</p>
    `},ge=wv(`
      <button class="close-button">X</button>
      <div class="dialog-header-container">
        <h2 class="skeleton-placeholder"></h2>
          <img
            src="${be}"
            width="80"
            height="80"
            alt="placeholder avatar"
          />
        <p class="skeleton-placeholder"></p>
      </div>
      <div class="preset-zap-options-container">
        <button data-value="21">21 â¡ï¸</button>
        <button data-value="69">69 â¡ï¸</button>
        <button data-value="420">420 â¡ï¸</button>
        <button data-value="1337">1337 â¡ï¸</button>
        <button data-value="5000">5k â¡ï¸</button>
        <button data-value="10000">10k â¡ï¸</button>
        <button data-value="21000">21k â¡ï¸</button>
        <button data-value="1000000">1M â¡ï¸</button>
      </div>
      <form>
        <input name="amount" type="number" placeholder="amount in sats" required />
        <input name="comment" placeholder="optional comment" />
        <button class="cta-button" 
          ${D?`style="background-color: ${D}; color: ${O_(D)}"`:""} 
          type="submit" disabled>Zap</button>
      </form>
    `),K=ge.querySelector(".preset-zap-options-container"),J=ge.querySelector("form"),le=ge.querySelector('input[name="amount"]'),me=ge.querySelector('input[name="comment"]'),ke=ge.querySelector('button[type="submit"]'),Pe=ge.querySelector(".dialog-header-container"),qe=ot=>{ge.close(),M_(ot,v).showModal()};he().then(ot=>{Pe.innerHTML=ot,ke.disabled=!1}).catch(qe);const Le=()=>{ke.disabled=!0,ke.innerHTML='<div class="spinner">Loading</div>'},st=()=>{ke.disabled=!1,ke.innerHTML="Zap"},tt=ot=>{le.value=ot};ge.addEventListener("close",function(){st(),J.reset()}),ge.querySelector(".close-button").addEventListener("click",function(){ge.close()}),K.addEventListener("click",function(ot){ot.target.matches("button")&&(tt(ot.target.getAttribute("data-value")),le.focus())});const Je=fe.then(i7);return J.addEventListener("submit",async function(ot){ot.preventDefault(),Le();const dt=Number(le.value)*1e3,dn=me.value;try{const re=await a7({zapEndpoint:await Je,amount:dt,comment:dn,authorId:j,nip19Target:w,normalizedRelays:X,anon:$}),se=async()=>{const ee=m7({dialogHeader:await he(),invoice:re,relays:X,buttonColor:D}),pe=ee.querySelector(".cta-button");ge.close(),ee.showModal(),pe.focus()};if(window.webln)try{await window.webln.enable(),await window.webln.sendPayment(re),ge.close()}catch{se()}else se()}catch(re){qe(re)}}),ge},M_=(v,w)=>{const I=wv(`
    <button class="close-button">X</button>
    <p class="error-message">${v}</p>
    <a href="https://nosta.me/${w}" target="_blank">
      <button class="cta-button">View Nostr Profile</button>
    </a>
  `);return I.addEventListener("close",function(){I.remove()}),I.querySelector(".close-button").addEventListener("click",function(){I.close()}),I},N_=async({npub:v,noteId:w,naddr:I,relays:D,cachedAmountDialog:$,buttonColor:H,anon:X})=>{let j=$;try{return j||(j=await g7({npub:v,nip19Target:I||w,relays:D,buttonColor:H,anon:X})),j.showModal(),window.matchMedia("(max-height: 932px)").matches||j.querySelector('input[name="amount"]').focus(),j}catch(fe){j&&j.close(),M_(fe,v).showModal()}},R_=v=>{let w=null,I=null;v.addEventListener("click",async function(){const D=v.getAttribute("data-npub"),$=v.getAttribute("data-note-id"),H=v.getAttribute("data-naddr"),X=v.getAttribute("data-relays"),j=v.getAttribute("data-button-color"),fe=v.getAttribute("data-anon")==="true";I&&(I.npub!==D||I.noteId!==$||I.naddr!==H||I.relays!==X||I.buttonColor!==j||I.anon!==fe)&&(w=null),I={npub:D,noteId:$,naddr:H,relays:X,buttonColor:j,anon:fe},w=await N_({npub:D,noteId:$,naddr:H,relays:X,cachedAmountDialog:w,buttonColor:j,anon:fe})})},D_=v=>{document.querySelectorAll(v||"[data-npub]").forEach(R_)};return(()=>{const v=document.createElement("style");v.innerHTML=`
      .nostr-zap-dialog {
        width: 424px;
        min-width: 376px;
        margin: auto;
        box-sizing: content-box;
        border: none;
        border-radius: 10px;
        padding: 36px;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        background-color: white;
      }
      .nostr-zap-dialog[open],
      .nostr-zap-dialog form {
        display: block;
        max-width: fit-content;
      }
      .nostr-zap-dialog form {
        padding: 0;
        width: 100%;
      }
      .nostr-zap-dialog img {
        display: inline;
        border-radius: 50%;
      }
      .nostr-zap-dialog h2 {
        font-size: 1.5em;
        font-weight: bold;
        color: black;
      }
      .nostr-zap-dialog p {
        font-size: 1em;
        font-weight: normal;
        color: black;
      }
      .nostr-zap-dialog h2,
      .nostr-zap-dialog p,
      .nostr-zap-dialog .skeleton-placeholder {
        margin: 4px;
        word-wrap: break-word;
      }
      .nostr-zap-dialog button {
        background-color: inherit;
        padding: 12px 0;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid rgb(226, 232, 240);
        width: 100px;
        max-width: 100px;
        max-height: 52px;
        white-space: nowrap;
        color: black;
        box-sizing: border-box;
      }
      .nostr-zap-dialog button:hover {
        background-color: #edf2f7;
      }
      .nostr-zap-dialog button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .nostr-zap-dialog .cta-button {
        background-color: #7f00ff;
        color: #fff;
        width: 100%;
        max-width: 100%;
        margin-top: 16px;
      }
      .nostr-zap-dialog .cta-button:hover {
        background-color: indigo;
      }
      .nostr-zap-dialog .close-button {
        background-color: inherit;
        color: black;
        border-radius: 50%;
        width: 42px;
        height: 42px;
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 12px;
        border: none;
      }
      .nostr-zap-dialog .preset-zap-options-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin: 24px 0 8px 0;
        height: 120px;
      }
      .nostr-zap-dialog input {
        padding: 12px;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        width: 100%;
        max-width: 100%;
        background-color: #f7fafc;
        color: #1a202c;
        box-shadow: none;
        box-sizing: border-box;
        margin-bottom: 16px;
        border: 1px solid lightgray;
      }
      .nostr-zap-dialog .spinner {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .nostr-zap-dialog .spinner:after {
        content: " ";
        display: block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 4px solid #fff;
        border-color: #fff transparent #fff transparent;
        animation: nostr-zap-dialog-spinner 1.2s linear infinite;
        margin-left: 8px;
      }
      .nostr-zap-dialog .error-message {
        text-align: left;
        color: red;
        margin-top: 8px;
      }
      .nostr-zap-dialog .qrcode {
        position: relative;
        display: inline-block;
        margin-top: 24px;
      }
      .nostr-zap-dialog .qrcode .overlay {
        position: absolute;
        color: white;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(127, 17, 224, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }
      .nostr-zap-dialog .qrcode .overlay.show {
        opacity: 1;
      }
      @keyframes nostr-zap-dialog-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes nostr-zap-dialog-skeleton-pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.8;
        }
        100% {
          opacity: 0.6;
        }
      }
      .nostr-zap-dialog .skeleton-placeholder {
        animation-name: nostr-zap-dialog-skeleton-pulse;
        animation-duration: 1.5s;
        animation-iteration-count: infinite;
        animation-timing-function: ease-in-out;
        background-color: #e8e8e8;
        border-radius: 4px;
        margin: 4px auto;
      }
      .nostr-zap-dialog p.skeleton-placeholder {
        height: 20px;
        width: 200px;
      }
      .nostr-zap-dialog h2.skeleton-placeholder {
        height: 28px;
        width: 300px;
      }
      .nostr-zap-dialog select[name="lightning-wallet"] {
        appearance: none;
        background-color: white;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%232D3748" width="24" height="24" viewBox="0 0 24 24"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" /></svg>');
        background-repeat: no-repeat;
        background-position: right 0.7rem center;
        background-size: 16px;
        border: 1px solid #CBD5E0;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: 0.25rem;
        width: 100%;
        margin-top: 24px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        cursor: pointer;
      }
      .nostr-zap-dialog select[name="lightning-wallet"]:focus {
        outline: none;
        border-color: #4FD1C5;
        box-shadow: 0 0 0 2px #4FD1C5;
      }
      @media only screen and (max-width: 480px) {
        .nostr-zap-dialog {
          padding: 18px;
        }

        .nostr-zap-dialog button {
          width: 92px;
          max-width: 92px;
        }
      }
      @media only screen and (max-width: 413px) {
        .nostr-zap-dialog {
          min-width: 324px;
        }
        .nostr-zap-dialog button {
          width: 78px;
          max-width: 78px;
        }
      }
  `;const w=document.createElement("div");document.body.appendChild(w),bv=w.attachShadow({mode:"open"}),bv.appendChild(v)})(),D_(),window.nostrZap={init:N_,initTarget:R_,initTargets:D_},a4}ive();var sve=Ce('<div class="info-icon svg-icon svelte-24l4z1"></div>'),ove=Ce('<div class="popover-body svelte-24l4z1"><div class="popover-children svelte-24l4z1"><!></div></div>'),ave=Ce("<!> <!>",1);function nk(t,e){let n=ce(e,"side",3,"top"),r=ce(e,"sideOffset",3,0),i=ce(e,"ariaLabel",3,"æå ±ãè¡¨ç¤º");var s=ze(),o=Te(s);_t(o,()=>OZ,(a,l)=>{l(a,{children:(c,u)=>{var d=ave(),f=Te(d);_t(f,()=>TZ,(p,m)=>{m(p,{class:"info-trigger",get"aria-label"(){return i()},children:(g,y)=>{var b=sve();Y(g,b)},$$slots:{default:!0}})});var h=ve(f,2);_t(h,()=>ja,(p,m)=>{m(p,{children:(g,y)=>{var b=ze(),x=Te(b);_t(x,()=>kZ,(C,P)=>{P(C,{get side(){return n()},get sideOffset(){return r()},class:"popover-content",trapFocus:!1,onCloseAutoFocus:S=>S.preventDefault(),children:(S,_)=>{var k=ove(),T=ie(k),O=ie(T);kt(O,()=>e.children??Bt),Y(S,k)},$$slots:{default:!0}})}),Y(g,b)},$$slots:{default:!0}})}),Y(c,d)},$$slots:{default:!0}})}),Y(t,s)}var lve=Ce('<div class="xmark-icon svg-icon svelte-1koizbb" aria-label="éãã"></div>'),cve=Ce('<div class="help-icon svg-icon" aria-label="Help"></div>'),uve=Ce('<div class="github-icon svg-icon svelte-1koizbb" aria-label="GitHub"></div>'),dve=Ce('<div class="rotate-right-icon svg-icon svelte-1koizbb"></div> <span class="btn-text"> </span>',1),fve=Ce('<div class="setting-section sw-update-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label sw-update-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><!></div></div></div>'),hve=Ce('<div class="lang-icon-btn svg-icon svelte-1koizbb"></div> <span class="btn-text"> </span>',1),pve=Ce('<table class="popover-table svelte-1koizbb"><thead class="svelte-1koizbb"><tr class="svelte-1koizbb"><th class="svelte-1koizbb"> </th><th class="svelte-1koizbb"> </th><th class="svelte-1koizbb"> </th></tr></thead><tbody class="svelte-1koizbb"><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr></tbody></table>'),mve=Ce('<div class="radio-pair svelte-1koizbb"></div>'),gve=Ce('<table class="popover-table svelte-1koizbb"><thead class="svelte-1koizbb"><tr class="svelte-1koizbb"><th class="svelte-1koizbb"> </th><th class="svelte-1koizbb"> </th></tr></thead><tbody class="svelte-1koizbb"><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr></tbody></table>'),yve=Ce('<div class="radio-pair svelte-1koizbb"></div>'),bve=Ce("<option> </option>"),wve=Ce('<div class="rotate-right-icon svg-icon svelte-1koizbb"></div> <span class="btn-text"> </span>',1),vve=Ce('<li class="svelte-1koizbb"> </li>'),xve=Ce('<ul class="svelte-1koizbb"></ul>'),Sve=Ce('<span style="color: #888;"> </span>'),kve=Ce('<div class="relay-list svelte-1koizbb"><!></div>'),Eve=Ce('<div class="settings-header svelte-1koizbb"><div class="first-row svelte-1koizbb"><div class="site-title svelte-1koizbb"><span class="site-name svelte-1koizbb">eHagaki</span> <span class="cache-version svelte-1koizbb"> </span></div> <div class="author-info svelte-1koizbb"><span> </span><a href="https://lokuyow.github.io/" target="_blank" class="svelte-1koizbb"> </a></div></div> <div class="second-row svelte-1koizbb"><!> <!> <div><div class="zap-view-btn-group svelte-1koizbb"><button class="zap-btn svelte-1koizbb" data-npub="npub1a3pvwe2p3v7mnjz6hle63r628wl9w567aw7u23fzqs062v5vqcqqu3sgh3" data-note-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-relays="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">Support</button> <span class="divider svelte-1koizbb"></span> <button class="view-btn svelte-1koizbb" data-title="Thanks for the Support!" data-nzv-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-zap-color-mode="true" data-relay-urls="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">View</button></div></div></div></div> <div class="modal-body svelte-1koizbb"><!> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb">Language/è¨èª</span> <div class="setting-control svelte-1koizbb"><!></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><div class="setting-label-wrapper svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <!></div> <div class="setting-control radio-group svelte-1koizbb"></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><div class="setting-label-wrapper svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <!></div> <div class="setting-control radio-group svelte-1koizbb"></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><select class="svelte-1koizbb"></select></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><label class="toggle-switch svelte-1koizbb"><input type="checkbox" class="svelte-1koizbb"/> <span class="slider svelte-1koizbb"></span></label></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><!></div></div> <div class="setting-info svelte-1koizbb"><button type="button" class="relay-toggle-label svelte-1koizbb" style="cursor:pointer; background:none; border:none; padding:0; font: inherit;"><span class="relay-toggle-icon svelte-1koizbb" aria-label="toggle"><!></span> </button> <!></div></div></div>',1);function Tve(t,e){const n=sa();wt(e,!0);const r=()=>Qn(yr,"$_",o),i=()=>Qn(ms,"$locale",o),s=()=>Qn(xT,"$swNeedRefresh",o),[o,a]=ei();let l=ce(e,"show",15,!1),c=ce(e,"onRefreshRelaysAndProfile",3,()=>{}),u=ce(e,"selectedCompression",3,"medium"),d=ce(e,"onSelectedCompressionChange",3,void 0),f=ce(e,"selectedEndpoint",3,""),h=ce(e,"onSelectedEndpointChange",3,void 0),p=ce(e,"onOpenWelcomeDialog",3,void 0);function m(){l(!1),e.onClose?.()}fh(()=>l(),m,!0);let g=oe(()=>Fie(r())),y=oe(()=>$ie(r())),b=oe(()=>BI(E(g),2)),x=oe(()=>BI(E(y),2)),C=ye(!0),P=ye(""),S=ye("medium"),_=ye(""),k=ye(!1);nt(()=>{E(k)||(Q(P,u()),Q(_,f()))});let T=oe(()=>hL.value),O=oe(()=>Pp.value),M=oe(()=>U1.value),L=oe(()=>PI.value);nt(()=>{const A=u();A!==void 0&&A!==""&&Q(P,A,!0)}),nt(()=>{d()&&E(P)!==u()&&d()(E(P))}),nt(()=>{const A=f();A!==void 0&&A!==""&&Q(_,A,!0)}),nt(()=>{h()&&E(_)!==f()&&h()(E(_))}),nt(()=>{E(k)&&E(P)&&localStorage.setItem(Hr.IMAGE_COMPRESSION_LEVEL,E(P))}),nt(()=>{E(k)&&E(S)&&localStorage.setItem(Hr.VIDEO_COMPRESSION_LEVEL,E(S))}),nt(()=>{E(k)&&E(_)&&localStorage.setItem(Hr.UPLOAD_ENDPOINT,E(_))}),nt(()=>{E(k)&&localStorage.setItem(Hr.CLIENT_TAG_ENABLED,E(C)?"true":"false")});function F(){Moe(gse,A=>PI.set(A),{timeout:Bie})}function B(){const A=Ooe({selectedEndpoint:f(),selectedCompression:u()});Q(_,A.endpoint,!0),Q(C,A.clientTagEnabled,!0),Q(P,A.compression,!0);const N=localStorage.getItem(Hr.VIDEO_COMPRESSION_LEVEL);N?N==="skip"?(Q(S,"none"),localStorage.setItem(Hr.VIDEO_COMPRESSION_LEVEL,"none")):Q(S,N,!0):(Q(S,"medium"),localStorage.setItem(Hr.VIDEO_COMPRESSION_LEVEL,"medium")),Q(k,!0)}Vs(()=>{B(),yse(),jr.value?.pubkey&&jr.value?.isAuthenticated&&II(jr.value.pubkey)}),nt(()=>{if(!l()){U1.set(!1);return}jr.value?.pubkey&&jr.value?.isAuthenticated&&II(jr.value.pubkey),(async()=>(await Dc(),rve(),window.nostrZap?.initTargets()))()}),nt(()=>{i()&&!localStorage.getItem(Hr.UPLOAD_ENDPOINT)&&Q(_,bT(i()),!0)});function R(){ms.set(i()==="ja"?"en":"ja")}{const A=U=>{var V=ze(),q=Te(V);{const G=(ne,te)=>{Lt(ne,qn(()=>te?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(ae,_e)=>{var de=lve();Y(ae,de)},$$slots:{default:!0}}))};_t(q,()=>oh,(ne,te)=>{te(ne,{child:G,$$slots:{child:!0}})})}Y(U,V)};let N=oe(()=>r()("settings")||"è¨­å®"),z=oe(()=>r()("settingsDialog.image_quality_setting"));dh(t,{onOpenChange:U=>!U&&m(),get title(){return E(N)},get description(){return E(z)},contentClass:"settings-dialog",footerVariant:"close-button",get open(){return l()},set open(U){l(U)},footer:A,children:(U,V)=>{var q=Eve(),G=Te(q),ne=ie(G),te=ie(ne),Z=ve(ie(te),2),ae=ie(Z),_e=ve(te,2),de=ie(_e),Ee=ie(de),Re=ve(de),je=ie(Re),Ve=ve(ne,2),Se=ie(Ve);Lt(Se,{shape:"circle",variant:"default",className:"help-btn",onClick:()=>{m(),p()?.()},ariaLabel:"Help",children:(Nt,kn)=>{var nn=cve();Y(Nt,nn)},$$slots:{default:!0}});var Me=ve(Se,2);Lt(Me,{shape:"circle",variant:"default",className:"github-link-btn",onClick:()=>window.open("https://github.com/Lokuyow/ehagaki","_blank"),ariaLabel:"GitHub Repository",children:(Nt,kn)=>{var nn=uve();Y(Nt,nn)},$$slots:{default:!0}});var Ne=ve(G,2),Ke=ie(Ne);{var Ae=Nt=>{var kn=fve(),nn=ie(kn),In=ie(nn),mn=ie(In),On=ve(In,2),Cn=ie(On);{let Un=oe(()=>E(L)?"loading":""),Hn=oe(()=>r()("settingsDialog.update_app")||"ã¢ããªãæ´æ°");Lt(Cn,{variant:"primary",shape:"rounded",get className(){return`sw-update-btn ${E(Un)??""}`},onClick:F,get disabled(){return E(L)},get ariaLabel(){return E(Hn)},children:(mo,ha)=>{var pa=ze(),El=Te(pa);{var Tl=Di=>{{let Ws=oe(()=>r()("settingsDialog.updating")||"æ´æ°ä¸­...");Ic(Di,{showLoader:!0,get text(){return E(Ws)}})}},nu=Di=>{var Ws=dve(),Cl=Te(Ws),ru=ve(Cl,2),_l=ie(ru);Ge((Al,vi)=>{fn(Cl,"aria-label",Al),Be(_l,vi)},[()=>r()("settingsDialog.refresh")||"æ´æ°",()=>r()("settingsDialog.update_app")||"æ´æ°"]),Y(Di,Ws)};He(El,Di=>{E(L)?Di(Tl):Di(nu,!1)})}Y(mo,pa)},$$slots:{default:!0}})}Ge(Un=>Be(mn,Un),[()=>r()("settingsDialog.sw_update_available")||"ã¢ããªã®æ´æ°ãããã¾ã"]),Y(Nt,kn)};He(Ke,Nt=>{s()&&Nt(Ae)})}var we=ve(Ke,2),We=ie(we),et=ve(ie(We),2),at=ie(et);Lt(at,{variant:"default",shape:"rounded",className:"lang-btn",onClick:R,children:(Nt,kn)=>{var nn=hve(),In=Te(nn),mn=ve(In,2),On=ie(mn);Ge((Cn,Un)=>{fn(In,"aria-label",Cn),Be(On,Un)},[()=>r()("settingsDialog.change")||"å¤æ´",()=>r()("settingsDialog.change")||"å¤æ´"]),Y(Nt,nn)},$$slots:{default:!0}});var Pt=ve(we,2),Ot=ie(Pt),Tt=ie(Ot),Mt=ie(Tt),Ft=ie(Mt),En=ve(Mt,2);nk(En,{side:"top",ariaLabel:"ç»åå§ç¸®è¨­å®ã®èª¬æ",children:(Nt,kn)=>{var nn=pve(),In=ie(nn),mn=ie(In),On=ie(mn),Cn=ie(On),Un=ve(On),Hn=ie(Un),mo=ve(Un),ha=ie(mo),pa=ve(In),El=ie(pa),Tl=ie(El),nu=ie(Tl),Di=ve(Tl),Ws=ie(Di),Cl=ve(Di),ru=ie(Cl),_l=ve(El),Al=ie(_l),vi=ie(Al),es=ve(Al),Sd=ie(es),vh=ve(es),js=ie(vh),xi=ve(_l),Si=ie(xi),Li=ie(Si),go=ve(Si),ig=ie(go),sg=ve(go),og=ie(sg);Ge((kd,xh,ag,qs,lg,cg,Ed,Qw,Yw)=>{Be(Cn,kd),Be(Hn,xh),Be(ha,ag),Be(nu,qs),Be(Ws,`${mu.low.maxWidthOrHeight}px`),Be(ru,`${lg??""}%`),Be(vi,cg),Be(Sd,`${mu.medium.maxWidthOrHeight}px`),Be(js,`${Ed??""}%`),Be(Li,Qw),Be(ig,`${mu.high.maxWidthOrHeight}px`),Be(og,`${Yw??""}%`)},[()=>r()("settingsDialog.info_header_setting"),()=>r()("settingsDialog.info_header_pixels"),()=>r()("settingsDialog.info_header_quality"),()=>r()("settingsDialog.quality_high"),()=>Math.round(mu.low.initialQuality*100),()=>r()("settingsDialog.quality_medium"),()=>Math.round(mu.medium.initialQuality*100),()=>r()("settingsDialog.quality_low"),()=>Math.round(mu.high.initialQuality*100)]),Y(Nt,nn)},$$slots:{default:!0}});var Ut=ve(Tt,2);Ma(Ut,21,()=>E(b),pu,(Nt,kn)=>{var nn=mve();Ma(nn,21,()=>E(kn),pu,(In,mn)=>{{let On=oe(()=>E(P)===E(mn).value);BO(In,{get value(){return E(mn).value},name:"compression",get checked(){return E(On)},variant:"default",shape:"rounded",onChange:Cn=>Q(P,Cn,!0),get ariaLabel(){return E(mn).label},children:(Cn,Un)=>{var Hn=Yt();Ge(()=>Be(Hn,E(mn).label)),Y(Cn,Hn)},$$slots:{default:!0}})}}),Y(Nt,nn)});var Pn=ve(Pt,2),ln=ie(Pn),$t=ie(ln),en=ie($t),Tn=ie(en),Nn=ve(en,2);nk(Nn,{side:"top",ariaLabel:"åç»å§ç¸®è¨­å®ã®èª¬æ",children:(Nt,kn)=>{var nn=gve(),In=ie(nn),mn=ie(In),On=ie(mn),Cn=ie(On),Un=ve(On),Hn=ie(Un),mo=ve(In),ha=ie(mo),pa=ie(ha),El=ie(pa),Tl=ve(pa),nu=ie(Tl),Di=ve(ha),Ws=ie(Di),Cl=ie(Ws),ru=ve(Ws),_l=ie(ru),Al=ve(Di),vi=ie(Al),es=ie(vi),Sd=ve(vi),vh=ie(Sd);Ge((js,xi,Si,Li,go)=>{Be(Cn,js),Be(Hn,xi),Be(El,Si),Be(nu,`${f0.low.maxSize??""}px`),Be(Cl,Li),Be(_l,`${f0.medium.maxSize??""}px`),Be(es,go),Be(vh,`${f0.high.maxSize??""}px`)},[()=>r()("settingsDialog.info_header_setting"),()=>r()("settingsDialog.info_header_pixels"),()=>r()("settingsDialog.quality_high"),()=>r()("settingsDialog.quality_medium"),()=>r()("settingsDialog.quality_low")]),Y(Nt,nn)},$$slots:{default:!0}});var Xt=ve($t,2);Ma(Xt,21,()=>E(x),pu,(Nt,kn)=>{var nn=yve();Ma(nn,21,()=>E(kn),pu,(In,mn)=>{{let On=oe(()=>E(S)===E(mn).value);BO(In,{get value(){return E(mn).value},name:"videoCompression",get checked(){return E(On)},variant:"default",shape:"rounded",onChange:Cn=>Q(S,Cn,!0),get ariaLabel(){return E(mn).label},children:(Cn,Un)=>{var Hn=Yt();Ge(()=>Be(Hn,E(mn).label)),Y(Cn,Hn)},$$slots:{default:!0}})}}),Y(Nt,nn)});var jt=ve(Pn,2),tn=ie(jt),Qt=ie(tn),zn=ie(Qt),yi=ve(Qt,2),ys=ie(yi);Ma(ys,21,()=>uL,pu,(Nt,kn)=>{var nn=bve(),In=ie(nn),mn={};Ge(()=>{Be(In,E(kn).label),mn!==(mn=E(kn).url)&&(nn.value=(nn.__value=E(kn).url)??"")}),Y(Nt,nn)});var It=ve(jt,2),Fn=ie(It),or=ie(Fn),bi=ie(or),ar=ve(or,2),er=ie(ar),wi=ie(er),At=ve(It,2),Nr=ie(At),da=ie(Nr),qt=ie(da),xd=ve(da,2),ng=ie(xd);{let Nt=oe(()=>r()("settingsDialog.refresh_relays_and_profile")||"ååå¾");Lt(ng,{variant:"default",shape:"rounded",className:"refresh-relays-profile-btn",onClick:()=>c()&&c()(),get ariaLabel(){return E(Nt)},children:(kn,nn)=>{var In=wve(),mn=Te(In),On=ve(mn,2),Cn=ie(On);Ge((Un,Hn)=>{fn(mn,"aria-label",Un),Be(Cn,Hn)},[()=>r()("settingsDialog.refresh")||"æ´æ°",()=>r()("settingsDialog.refresh")||"æ´æ°"]),Y(kn,In)},$$slots:{default:!0}})}var bh=ve(Nr,2),kl=ie(bh);kl.__click=()=>U1.set(!E(M));var wh=ie(kl),rg=ie(wh);{var Gw=Nt=>{var kn=Yt("â¼");Y(Nt,kn)},Ye=Nt=>{var kn=Yt("â¶");Y(Nt,kn)};He(rg,Nt=>{E(M)?Nt(Gw):Nt(Ye,!1)})}var fa=ve(wh),Zw=ve(kl,2);{var Xw=Nt=>{var kn=kve(),nn=ie(kn);{var In=On=>{var Cn=xve();Ma(Cn,21,()=>E(O),pu,(Un,Hn)=>{var mo=vve(),ha=ie(mo);Ge(()=>Be(ha,E(Hn))),Y(Un,mo)}),Y(On,Cn)},mn=On=>{var Cn=Sve(),Un=ie(Cn);Ge(Hn=>Be(Un,Hn),[()=>r()("settingsDialog.no_relay_info")||"ãªã¬ã¼æå ±ãªã"]),Y(On,Cn)};He(nn,On=>{E(O).length>0?On(In):On(mn,!1)})}Y(Nt,kn)};He(Zw,Nt=>{E(M)&&Nt(Xw)})}Ge((Nt,kn,nn,In,mn,On,Cn,Un,Hn)=>{Be(ae,E(T)?`v${E(T)}`:""),Be(Ee,Nt),Be(je,kn),Be(Ft,nn),Be(Tn,In),Be(zn,mn),fn(ys,"id",`${n}-endpoint`),Be(bi,On),fn(er,"for",`${n}-client-tag`),fn(wi,"id",`${n}-client-tag`),Be(qt,Cn),fn(kl,"aria-pressed",E(M)),fn(kl,"aria-label",Un),Be(fa,` ${Hn??""}`)},[()=>r()("settingsDialog.author_info")||"å¶ä½ï¼",()=>r()("settingsDialog.author_name")||" Lokuyow",()=>r()("settingsDialog.image_quality_setting"),()=>r()("settingsDialog.video_quality_setting"),()=>r()("settingsDialog.upload_destination")||"ã¢ããã­ã¼ãå",()=>r()("settingsDialog.client_tag_label")||"æç¨¿è©³ç´°ã«ã¯ã©ã¤ã¢ã³ãåãã¤ããï¼Client tagï¼",()=>r()("settingsDialog.refresh_relays_and_profile")||"ãªã¬ã¼ãªã¹ãã»ãã­ãã£ã¼ã«ååå¾",()=>r()("settingsDialog.toggle_write_relays_list")||"æç¨¿åãªã¬ã¼ã®è¡¨ç¤ºåæ¿",()=>r()("settingsDialog.write_relays_list")||"æ¸ãè¾¼ã¿åãªã¬ã¼ãªã¹ã"]),V9(ys,()=>E(_),Nt=>Q(_,Nt)),G9(wi,()=>E(C),Nt=>Q(C,Nt)),Y(U,q)},$$slots:{footer:!0,default:!0}})}vt(),a()}Mi(["click"]);var Cve=Ce('<div class="xmark-icon svg-icon svelte-1fu8q0k" aria-label="éãã"></div>'),_ve=Ce('<img class="profile-image svelte-1fu8q0k"/>'),Ave=Ce('<div class="profile-image-placeholder svg-icon svelte-1fu8q0k" aria-label="Profile image placeholder"></div>'),Pve=Ce('<div class="profile-info-row svelte-1fu8q0k"><div class="profile-info-content svelte-1fu8q0k"><span class="profile-info-text svelte-1fu8q0k"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-1fu8q0k" aria-label="Copy npub"></div></button></div></div>'),Ive=Ce('<div class="profile-info-row svelte-1fu8q0k"><div class="profile-info-content svelte-1fu8q0k"><span class="profile-info-text svelte-1fu8q0k"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-1fu8q0k" aria-label="Copy nprofile"></div></button></div></div>'),Ove=Ce('<div class="profile-info-label svelte-1fu8q0k"> </div> <span class="profile-info-text"><!></span>',1),Mve=Ce('<div class="profile-container svelte-1fu8q0k"><div class="profile-summary svelte-1fu8q0k"><div class="profile-image-container svelte-1fu8q0k"><!></div> <div class="profile-name svelte-1fu8q0k"> </div></div> <div class="nostr-ids svelte-1fu8q0k"><div class="profile-info-label svelte-1fu8q0k"> </div> <div class="profile-info-container svelte-1fu8q0k"><!> <!></div></div> <div class="auth-controls svelte-1fu8q0k"><div class="auth-container svelte-1fu8q0k"><!></div> <!></div></div>'),Nve=Ce('<div class="copy-success-message"> </div>'),Rve=Ce("<!> <!>",1);function Dve(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ce(e,"show",15,!1),o=ce(e,"isLoggingOut",3,!1);function a(){s(!1),e.onClose?.()}fh(()=>s(),a,!0);let l=oe(()=>ic.value),c=oe(()=>jr.value),u=ye(Zt(ic.value)),d=ye(!1),f=ye(0),h=ye(0);nt(()=>{!o()&&E(l)&&Q(u,E(l),!0)});function p(){e.onLogout?.()}async function m(x,C,P){try{await Pw(x,C,navigator,window);const S=Hoe(P.clientX,P.clientY);Q(f,S.x,!0),Q(h,S.y,!0),Q(d,!0),setTimeout(()=>{Q(d,!1)},1800)}catch(S){console.warn("Copy failed:",S)}}var g=Rve(),y=Te(g);{const x=S=>{var _=ze(),k=Te(_);{const T=(O,M)=>{Lt(O,qn(()=>M?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(F,B)=>{var R=Cve();Y(F,R)},$$slots:{default:!0}}))};_t(k,()=>oh,(O,M)=>{M(O,{child:T,$$slots:{child:!0}})})}Y(S,_)};let C=oe(()=>n()("profileDialog.title")),P=oe(()=>n()("profileDialog.npub"));dh(y,{onOpenChange:S=>!S&&a(),get title(){return E(C)},get description(){return E(P)},contentClass:"profile-dialog",footerVariant:"close-button",get open(){return s()},set open(S){s(S)},footer:x,children:(S,_)=>{var k=Mve(),T=ie(k),O=ie(T),M=ie(O);{var L=Ee=>{var Re=_ve();Ge(()=>{fn(Re,"src",E(u).picture),fn(Re,"alt",E(u).name||"Profile")}),Y(Ee,Re)},F=Ee=>{var Re=Ave();Y(Ee,Re)};He(M,Ee=>{E(u).picture?Ee(L):Ee(F,!1)})}var B=ve(O,2),R=ie(B),A=ve(T,2),N=ie(A),z=ie(N),U=ve(N,2),V=ie(U);{var q=Ee=>{var Re=Pve(),je=ie(Re),Ve=ie(je),Se=ie(Ve),Me=ve(Ve,2);Me.__click=Ne=>m(E(u).npub,"npub",Ne),Ge(Ne=>{Be(Se,E(u).npub),fn(Me,"aria-label",Ne)},[()=>n()("profileDialog.copy_npub")]),Y(Ee,Re)};He(V,Ee=>{E(u).npub&&Ee(q)})}var G=ve(V,2);{var ne=Ee=>{var Re=Ive(),je=ie(Re),Ve=ie(je),Se=ie(Ve),Me=ve(Ve,2);Me.__click=Ne=>m(E(u).nprofile,"nprofile",Ne),Ge(Ne=>{Be(Se,E(u).nprofile),fn(Me,"aria-label",Ne)},[()=>n()("profileDialog.copy_nprofile")]),Y(Ee,Re)};He(G,Ee=>{E(u).nprofile&&Ee(ne)})}var te=ve(A,2),Z=ie(te),ae=ie(Z);{var _e=Ee=>{var Re=Ove(),je=Te(Re),Ve=ie(je),Se=ve(je,2),Me=ie(Se);{var Ne=Ae=>{var we=Yt();Ge(We=>Be(we,We),[()=>n()("profileDialog.login_method_nsec")]),Y(Ae,we)},Ke=Ae=>{var we=ze(),We=Te(we);{var et=at=>{var Pt=ze(),Ot=Te(Pt);{var Tt=Ft=>{var En=Yt();Ge(Ut=>Be(En,Ut),[()=>n()("profileDialog.login_method_nostr_login_connect")]),Y(Ft,En)},Mt=Ft=>{var En=ze(),Ut=Te(En);{var Pn=$t=>{var en=Yt();Ge(Tn=>Be(en,Tn),[()=>n()("profileDialog.login_method_nostr_login_extension")]),Y($t,en)},ln=$t=>{var en=ze(),Tn=Te(en);{var Nn=jt=>{var tn=Yt();Ge(Qt=>Be(tn,Qt),[()=>n()("profileDialog.login_method_nostr_login_local")]),Y(jt,tn)},Xt=jt=>{var tn=Yt();Ge(Qt=>Be(tn,Qt),[()=>n()("profileDialog.login_method_nostr_login_connect")]),Y(jt,tn)};He(Tn,jt=>{E(c)?.nostrLoginAuthMethod==="local"?jt(Nn):jt(Xt,!1)},!0)}Y($t,en)};He(Ut,$t=>{E(c)?.nostrLoginAuthMethod==="extension"?$t(Pn):$t(ln,!1)},!0)}Y(Ft,En)};He(Ot,Ft=>{E(c)?.nostrLoginAuthMethod==="connect"?Ft(Tt):Ft(Mt,!1)})}Y(at,Pt)};He(We,at=>{E(c)?.type==="nostr-login"&&at(et)},!0)}Y(Ae,we)};He(Me,Ae=>{E(c)?.type==="nsec"?Ae(Ne):Ae(Ke,!1)})}Ge(Ae=>Be(Ve,Ae),[()=>n()("profileDialog.login_method")]),Y(Ee,Re)};He(ae,Ee=>{(E(c)?.type==="nsec"||E(c)?.type==="nostr-login")&&Ee(_e)})}var de=ve(Z,2);{let Ee=oe(()=>o()?"loading":"");Lt(de,{onClick:p,get className(){return`logout-btn ${E(Ee)??""}`},variant:"danger",shape:"square",get disabled(){return o()},children:(Re,je)=>{var Ve=ze(),Se=Te(Ve);{var Me=Ke=>{Ic(Ke,{text:!0,showLoader:!0})},Ne=Ke=>{var Ae=Yt();Ge(we=>Be(Ae,we),[()=>n()("logoutDialog.logout")]),Y(Ke,Ae)};He(Se,Ke=>{o()?Ke(Me):Ke(Ne,!1)})}Y(Re,Ve)},$$slots:{default:!0}})}Ge((Ee,Re)=>{Be(R,Ee),Be(z,Re)},[()=>E(u).name||n()("profileDialog.anonymous"),()=>n()("profileDialog.npub")]),Y(S,k)},$$slots:{footer:!0,default:!0}})}var b=ve(y,2);mC(b,{get show(){return E(d)},get x(){return E(f)},get y(){return E(h)},onClose:()=>Q(d,!1),children:(x,C)=>{var P=Nve(),S=ie(P);Ge(_=>Be(S,_),[()=>n()("imageContextMenu.copySuccess")]),Y(x,P)},$$slots:{default:!0}}),Y(t,g),vt(),i()}Mi(["click"]);var Lve=Ce('<div><span style="word-break:break-all"> </span></div>'),Bve=Ce('<div><span style="word-break:break-all"> </span></div>'),Fve=Ce('<div class="toast npub-toast svelte-1179qet"><!> <!></div>'),$ve=Ce('<div class="xmark-icon svg-icon svelte-1179qet" aria-label="éãã"></div>'),zve=Ce('<img src="./icons/nostr-login.svg" alt="nostr-login" class="nostr-login-icon svelte-1179qet"/> <span class="btn-text svelte-1179qet">Nostr Login</span>',1),Uve=Ce('<!> <div class="divider svelte-1179qet"><span class="svelte-1179qet"> </span></div> <h3 class="svelte-1179qet"> </h3> <form class="svelte-1179qet"><input type="text" name="username" autocomplete="username" style="display: none;" aria-hidden="true"/> <input type="password" placeholder="nsec1â¦" class="secret-input svelte-1179qet" id="secretKey" name="secretKey" autocomplete="current-password" required minlength="63" maxlength="63"/> <div class="dialog-buttons svelte-1179qet"><!> <!></div></form>',1),Hve=Ce("<!> <!>",1);function Vve(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ce(e,"show",15,!1),o=ce(e,"secretKey",15),a=ce(e,"isLoadingNostrLogin",3,!1);function l(){s(!1),e.onClose?.()}fh(()=>s(),l,!0);const c=new R6;let u=ye(null);nt(()=>{o()!==void 0&&(c.setNsec(o()),E(u)&&(o()||E(u).setCustomValidity("")))});let d=ye(!1),f=ye(""),h=ye("");nt(()=>{c.isValid.subscribe(S=>Q(d,S,!0))}),nt(()=>{c.npub.subscribe(S=>Q(f,S,!0))}),nt(()=>{c.nprofile.subscribe(S=>Q(h,S,!0))});function p(){if(E(u)){const S=E(u).validity,_=E(u).value??"";if(S.valueMissing){E(u).setCustomValidity(n()("loginDialog.secret_required")),E(u).reportValidity();return}if(!_.startsWith("nsec1")){E(u).setCustomValidity(n()("loginDialog.secret_must_start_nsec1")),E(u).reportValidity();return}if(_.length!==63){_.length<63?E(u).setCustomValidity(n()("loginDialog.secret_too_short")):E(u).setCustomValidity(n()("loginDialog.secret_too_long")),E(u).reportValidity();return}if(!E(d)){E(u).setCustomValidity(n()("loginDialog.invalid_secret")),E(u).reportValidity();return}E(u).setCustomValidity("")}e.onSave?.()}function m(){o(""),E(u)&&E(u).setCustomValidity("")}function g(){e.onNostrLogin?.()}function y(S){S.preventDefault(),p()}var b=Hve(),x=Te(b);{var C=S=>{var _=Fve(),k=ie(_);{var T=L=>{var F=Lve(),B=ie(F),R=ie(B);Ge(()=>Be(R,E(f))),Y(L,F)};He(k,L=>{E(f)&&L(T)})}var O=ve(k,2);{var M=L=>{var F=Bve(),B=ie(F),R=ie(B);Ge(()=>Be(R,E(h))),Y(L,F)};He(O,L=>{E(h)&&L(M)})}Y(S,_)};He(x,S=>{(E(f)||E(h))&&S(C)})}var P=ve(x,2);{const S=T=>{var O=ze(),M=Te(O);{const L=(F,B)=>{Lt(F,qn(()=>B?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(A,N)=>{var z=$ve();Y(A,z)},$$slots:{default:!0}}))};_t(M,()=>oh,(F,B)=>{B(F,{child:L,$$slots:{child:!0}})})}Y(T,O)};let _=oe(()=>n()("loginDialog.input_secret")),k=oe(()=>n()("loginDialog.hint_input_secret"));dh(P,{onOpenChange:T=>!T&&l(),get title(){return E(_)},get description(){return E(k)},contentClass:"login-dialog",footerVariant:"close-button",get open(){return s()},set open(T){s(T)},footer:S,children:(T,O)=>{var M=Uve(),L=Te(M);{let ne=oe(()=>a()?"loading":"");Lt(L,{variant:"default",shape:"rounded",get className(){return`nostr-login-button ${E(ne)??""}`},onClick:g,get disabled(){return a()},children:(te,Z)=>{var ae=ze(),_e=Te(ae);{var de=Re=>{Ic(Re,{text:!0,showLoader:!0,customClass:"nostr-login-placeholder"})},Ee=Re=>{var je=zve();Y(Re,je)};He(_e,Re=>{a()?Re(de):Re(Ee,!1)})}Y(te,ae)},$$slots:{default:!0}})}var F=ve(L,2),B=ie(F),R=ie(B),A=ve(F,2),N=ie(A),z=ve(A,2),U=ve(ie(z),2);U.__keydown=ne=>{ne.key==="Enter"&&p()},U.__input=()=>{E(u)&&E(u).setCustomValidity("")},Ar(U,ne=>Q(u,ne),()=>E(u));var V=ve(U,2),q=ie(V);Lt(q,{variant:"warning",shape:"square",type:"button",onClick:m,className:"clear-btn",children:(ne,te)=>{var Z=Yt();Ge(ae=>Be(Z,ae),[()=>n()("loginDialog.clear")]),Y(ne,Z)},$$slots:{default:!0}});var G=ve(q,2);Lt(G,{variant:"primary",shape:"square",type:"submit",className:"save-btn",children:(ne,te)=>{var Z=Yt();Ge(ae=>Be(Z,ae),[()=>n()("loginDialog.save")]),Y(ne,Z)},$$slots:{default:!0}}),Ge((ne,te,Z)=>{Be(R,ne),Be(N,te),fn(U,"title",Z)},[()=>n()("loginDialog.or"),()=>n()("loginDialog.input_secret"),()=>n()("loginDialog.hint_input_secret")]),Is("submit",z,y),K9(U,o),Y(T,M)},$$slots:{footer:!0,default:!0}})}Y(t,b),vt(),i()}Mi(["keydown","input"]);var Wve=Ce('<div class="welcome-content svelte-1ghzzk4"><div class="title-section svelte-1ghzzk4"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-1ghzzk4"/> <h2 class="svelte-1ghzzk4"> </h2></div> <p class="svelte-1ghzzk4"> </p> <pre class="features svelte-1ghzzk4"> </pre></div>');function jve(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ce(e,"show",15,!1);function o(){s(!1),e.onClose?.()}fh(()=>s(),o,!0);{const a=u=>{var d=ze(),f=Te(d);{const h=(p,m)=>{Lt(p,qn(()=>m?.().props,{variant:"primary",shape:"square",className:"get-started-btn",children:(y,b)=>{var x=Yt();Ge(C=>Be(x,C),[()=>n()("welcomeDialog.get_started")]),Y(y,x)},$$slots:{default:!0}}))};_t(f,()=>oh,(p,m)=>{m(p,{child:h,$$slots:{child:!0}})})}Y(u,d)};let l=oe(()=>n()("welcomeDialog.title")),c=oe(()=>n()("welcomeDialog.description"));dh(t,{onOpenChange:u=>!u&&o(),get title(){return E(l)},get description(){return E(c)},contentClass:"welcome-dialog",get open(){return s()},set open(u){s(u)},footer:a,children:(u,d)=>{var f=Wve(),h=ie(f),p=ve(ie(h),2),m=ie(p),g=ve(h,2),y=ie(g),b=ve(g,2),x=ie(b);Ge((C,P,S)=>{Be(m,C),Be(y,P),Be(x,S)},[()=>n()("welcomeDialog.title"),()=>n()("welcomeDialog.description"),()=>n()("welcomeDialog.features")]),Y(u,f)},$$slots:{footer:!0,default:!0}})}vt(),i()}function qw(){const t=localStorage.getItem(Hr.DRAFTS);if(!t)return[];try{return JSON.parse(t).sort((n,r)=>r.timestamp-n.timestamp)}catch{return[]}}function Kw(t){localStorage.setItem(Hr.DRAFTS,JSON.stringify(t))}function Z$(t){const e=document.createElement("div");e.innerHTML=t;const n=e.querySelector("img")!==null,r=e.querySelector("video")!==null,o=(e.textContent||e.innerText||"").split(`
`).filter(h=>h.trim())[0]||"",a=xc(ms)||"en",l=xc(yr);let c="[ç»å]",u="[åç»]";try{c=l("draft.media.image")||(a.startsWith("ja")?"[ç»å]":"[Image]"),u=l("draft.media.video")||(a.startsWith("ja")?"[åç»]":"[Video]")}catch{c=a.startsWith("ja")?"[ç»å]":"[Image]",u=a.startsWith("ja")?"[åç»]":"[Video]"}const d=[];n&&d.push(c),r&&d.push(u);const f=d.join("");if(o){if(f){const h=`${o} ${f}`;if(h.length>Lg){const p=Lg-f.length-2;return p>0?`${o.substring(0,p)}â¦ ${f}`:f}return h}return o.length>Lg?o.substring(0,Lg)+"â¦":o}if(f)return f;try{return l("draft.no_content")||(a.startsWith("ja")?"(åå®¹ãªã)":"(No content)")}catch{return a.startsWith("ja")?"(åå®¹ãªã)":"(No content)"}}function X$(){return`draft_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function qve(t){const e=qw();if(e.length>=cL)return{success:!1,needsConfirmation:!0,drafts:e};const r=[{id:X$(),content:t,preview:Z$(t),timestamp:Date.now()},...e];return Kw(r),{success:!0,needsConfirmation:!1,drafts:r}}function Kve(t){const n=qw().slice(0,cL-1),i=[{id:X$(),content:t,preview:Z$(t),timestamp:Date.now()},...n];return Kw(i),i}function Gve(t){const n=qw().filter(r=>r.id!==t);return Kw(n),n}function Zve(){return Kw([]),[]}function Xve(t){const e=Date.now(),n=e-t,r=60*1e3,i=60*r,s=24*i,o=xc(ms)||"en",a=xc(yr),l=new Intl.RelativeTimeFormat(o,{numeric:"auto"});if(n<r)try{return a("draft.time.now")}catch{return o.startsWith("ja")?"ä»":"Now"}else if(n<i){const c=Math.floor(n/r);return o.startsWith("en")?`${c}m ago`:l.format(-c,"minute")}else if(n<s){const c=Math.floor(n/i);return o.startsWith("en")?`${c}h ago`:l.format(-c,"hour")}else{const c=new Date(t),u=365*s;return e-t<u?new Intl.DateTimeFormat(o,{month:"numeric",day:"numeric"}).format(c):new Intl.DateTimeFormat(o,{year:"numeric",month:"numeric",day:"numeric"}).format(c)}}var Qve=Ce('<div class="xmark-icon svg-icon svelte-y19p5z"></div>'),Yve=Ce('<div class="trash-icon svg-icon svelte-y19p5z"></div> <span class="delete-all-label"> </span>',1),Jve=Ce('<div class="empty-message svelte-y19p5z"> </div>'),e1e=Ce('<div class="trash-icon svg-icon svelte-y19p5z"></div>'),t1e=Ce('<li class="draft-item svelte-y19p5z"><button type="button" class="draft-content svelte-y19p5z"><span class="draft-preview svelte-y19p5z"> </span> <span class="draft-timestamp svelte-y19p5z"> </span></button> <!></li>'),n1e=Ce('<ul class="draft-list svelte-y19p5z"></ul>'),r1e=Ce('<div class="dialog-heading-container svelte-y19p5z"><div class="dialog-heading-wrapper svelte-y19p5z"><h3 class="dialog-heading svelte-y19p5z"> </h3> <!></div> <!></div> <div class="draft-list-container svelte-y19p5z"><!></div>',1);function i1e(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ce(e,"show",15,!1),o=ye(Zt([]));function a(){s(!1),e.onClose?.()}fh(()=>s(),a,!0),nt(()=>{s()&&Q(o,qw(),!0)});function l(d){e.onApplyDraft(d.content),a()}function c(d){Q(o,Gve(d),!0)}function u(){Q(o,Zve(),!0)}{const d=p=>{var m=ze(),g=Te(m);{const y=(b,x)=>{let C=()=>x?.().props;{let P=oe(()=>n()("global.close")||"éãã");Lt(b,qn(C,{className:"modal-close",variant:"default",shape:"square",get ariaLabel(){return E(P)},children:(S,_)=>{var k=Qve();Ge(T=>fn(k,"aria-label",T),[()=>n()("global.close")||"éãã"]),Y(S,k)},$$slots:{default:!0}}))}};_t(g,()=>oh,(b,x)=>{x(b,{child:y,$$slots:{child:!0}})})}Y(p,m)};let f=oe(()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§"),h=oe(()=>n()("draft.list_description")||"ä¿å­ããä¸æ¸ããé¸æãã¦å¾©å");dh(t,{onOpenChange:p=>!p&&a(),get title(){return E(f)},get description(){return E(h)},contentClass:"draft-list-dialog",footerVariant:"close-button",get open(){return s()},set open(p){s(p)},footer:d,children:(p,m)=>{var g=r1e(),y=Te(g),b=ie(y),x=ie(b),C=ie(x),P=ve(x,2);{let M=oe(()=>n()("draft.info")||"ä¸æ¸ãæå ±");nk(P,{side:"bottom",sideOffset:8,get ariaLabel(){return E(M)},children:(L,F)=>{var B=Yt();Ge(R=>Be(B,R),[()=>n()("draft.info")||"ä¸æ¸ãã¯ãã©ã¦ã¶ã«ä¿å­ããã¾ãããã©ã¦ã¶ã®ãã¼ã¿ãåé¤ããããã­ã°ã¢ã¦ãããã¨ä¸æ¸ãã¯åé¤ããã¾ãã"]),Y(L,B)},$$slots:{default:!0}})}var S=ve(b,2);{let M=oe(()=>n()("draft.delete_all")||"å¨ã¦åé¤");Lt(S,{className:"delete-all-button",variant:"default",shape:"rounded",get ariaLabel(){return E(M)},onClick:u,children:(L,F)=>{var B=Yve(),R=ve(Te(B),2),A=ie(R);Ge(N=>Be(A,N),[()=>n()("draft.delete_all")||"å¨ã¦åé¤"]),Y(L,B)},$$slots:{default:!0}})}var _=ve(y,2),k=ie(_);{var T=M=>{var L=Jve(),F=ie(L);Ge(B=>Be(F,B),[()=>n()("draft.no_drafts")||"ä¸æ¸ããããã¾ãã"]),Y(M,L)},O=M=>{var L=n1e();Ma(L,21,()=>E(o),F=>F.id,(F,B)=>{var R=t1e(),A=ie(R);A.__click=()=>l(E(B));var N=ie(A),z=ie(N),U=ve(N,2),V=ie(U),q=ve(A,2);{let G=oe(()=>n()("draft.delete")||"åé¤");Lt(q,{className:"delete-button",variant:"default",shape:"square",get ariaLabel(){return E(G)},onClick:()=>c(E(B).id),children:(ne,te)=>{var Z=e1e();Y(ne,Z)},$$slots:{default:!0}})}Ge(G=>{Be(z,E(B).preview),Be(V,G)},[()=>Xve(E(B).timestamp)]),Y(F,R)}),Y(M,L)};He(k,M=>{E(o).length===0?M(T):M(O,!1)})}Ge(M=>Be(C,M),[()=>n()("draft.title")||"ä¸æ¸ã"]),Y(p,g)},$$slots:{footer:!0,default:!0}})}vt(),i()}Mi(["click"]);class Tb{static createMergedOptions(e){return{theme:"default",noBanner:!0,methods:"connect, extension, local",perms:"get_public_key,sign_event:1,sign_event:27235",startScreen:"welcome",...e}}static processBunkers(e){return Array.isArray(e)?e.join(","):void 0}static async npubToPubkey(e){try{if(!e)return{success:!1,error:{type:"decode",message:"npub is empty or null"}};const n=cl.decode(e);return n.type==="npub"?{success:!0,pubkey:n.data}:{success:!1,error:{type:"decode",message:"Invalid npub format"}}}catch(n){return{success:!1,error:{type:"decode",message:"Failed to decode npub",originalError:n}}}}static getCurrentUserFromWindow(e){try{const n=e.nostrLogin;if(n&&n.pubkey)return{pubkey:n.pubkey,npub:n.npub}}catch{return null}return null}static getNostrLoginAuthMethod(e,n){try{const r=n.getItem("__nostrlogin_accounts");if(!r)return;const i=JSON.parse(r);if(!Array.isArray(i))return;const s=i.find(a=>a?.pubkey===e);if(!s||!s.authMethod)return;const o=s.authMethod;return o==="connect"||o==="extension"||o==="local"?o:void 0}catch{return}}}class s1e{constructor(e,n,r){this.console=e,this.getAuthHandler=n,this.isLoggingOut=r}async handleAuthCallback(e,n){const r=this.getAuthHandler();if(!(!r||this.isLoggingOut()))try{if(!e){r({type:"logout"});return}const i=await Tb.npubToPubkey(e);if(!i.success||!i.pubkey){this.console.warn("NostrLogin: Failed to get pubkey from npub",i.error);return}const s=n?.type||"login";r({type:s,pubkey:i.pubkey,npub:e,otpData:n?.otpData})}catch(i){this.console.error("NostrLogin auth callback error:",i)}}}class o1e{constructor(e,n,r){this.console=e,this.importNostrLogin=n,this.authHandler=r}async initialize(e){try{const r=(await this.importNostrLogin()).init;if(!r)throw new TypeError("nostr-login: init function is missing");const i=Tb.createMergedOptions(e),s=this.authHandler.handleAuthCallback.bind(this.authHandler),o=i.bunkers!==void 0?Tb.processBunkers(i.bunkers):void 0,a={...i,bunkers:o,startScreen:i.startScreen,onAuth:s};return await Promise.resolve(r(a)),this.console.log("nostr-loginåæåå®äº"),{success:!0}}catch(n){const r={type:"initialization",message:"Failed to initialize nostr-login",originalError:n};return this.console.error("nostr-loginåæåã¨ã©ã¼:",n),{success:!1,error:r}}}}class a1e{constructor(e){this.importNostrLogin=e}async launch(e){try{const{launch:n}=await this.importNostrLogin();return await n(e||"welcome"),{success:!0}}catch(n){return{success:!1,error:{type:"launch",message:"Failed to launch nostr-login",originalError:n}}}}}class l1e{constructor(e,n){this.document=e,this.setTimeout=n}logout(e){e(!0);try{const n=new Event("nlLogout");this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlLogout event:",n)}try{this.setTimeout(()=>{e(!1)},100)}catch(n){console.error("Failed to set logout flag timeout:",n),e(!1)}}setDarkMode(e){try{const n=new CustomEvent("nlDarkMode",{detail:e});this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlDarkMode event:",n)}}}class c1e{initialized=!1;authHandler=null;isLoggingOutFlag=!1;initPromise=null;resolvedPromise=null;initializer;launcher;eventEmitter;authCallbackHandler;windowObj;documentObj;consoleObj;setTimeoutFn;constructor(e={}){this.windowObj=e.window||(typeof window<"u"?window:{}),this.documentObj=e.document||(typeof window<"u"?window.document:{}),this.consoleObj=e.console||(typeof window<"u"?window.console:{}),this.setTimeoutFn=e.setTimeout||(typeof window<"u"&&window.setTimeout?window.setTimeout.bind(window):(()=>{}));const n=e.importNostrLogin||(()=>zb(()=>import("./index.esm-ocKONXP9.js"),[]));this.authCallbackHandler=new s1e(this.consoleObj,()=>this.authHandler,()=>this.isLoggingOutFlag),this.initializer=new o1e(this.consoleObj,n,this.authCallbackHandler),this.launcher=new a1e(n),this.eventEmitter=new l1e(this.documentObj,this.setTimeoutFn)}init(e={}){return this.initPromise!==null?this.initPromise:this.initialized?this.resolvedPromise:(this.initPromise=new Promise((n,r)=>{this.initializer.initialize(e).then(i=>{if(i.success)this.initialized=!0,this.resolvedPromise=this.initPromise,n();else{this._resetInitializationState();const s=i.error?.message||"Initialization failed",o=i.error?.originalError;o instanceof Error?r(o):r(new Error(s))}}).catch(i=>{this._resetInitializationState(),r(i)})}),this.initPromise)}_resetInitializationState(){this.initialized=!1,this.initPromise=null,this.resolvedPromise=null}setAuthHandler(e){this.authHandler=e}async showLogin(e){if(!this._ensureInitialized())throw new Error("nostr-login is not initialized");const n=await this.launcher.launch(e);if(!n.success)throw n.error?.originalError instanceof Error?n.error.originalError:new Error(n.error?.message||"Failed to launch login")}logout(){try{if(!this._ensureInitialized())return;this.eventEmitter.logout(e=>{this.isLoggingOutFlag=e})}catch(e){this.consoleObj.error("NostrLogin logout error:",e)}}setDarkMode(e){this._ensureInitialized()&&this.eventEmitter.setDarkMode(e)}getCurrentUser(){return this.initialized?Tb.getCurrentUserFromWindow(this.windowObj):null}_ensureInitialized(){return this.initialized?!0:(this.consoleObj.warn("nostr-loginãåæåããã¦ãã¾ãã"),!1)}get isInitialized(){return this.initialized}getInitializer(){return this.initializer}getLauncher(){return this.launcher}getEventEmitter(){return this.eventEmitter}getAuthCallbackHandler(){return this.authCallbackHandler}}const c4=new c1e;class Cb{static isValidSecretKey(e,n){return n.isValidNsec(e)}static hasRequiredPubkey(e){return e.type!=="logout"&&!!e.pubkey}static isLogoutAuth(e){return e.type==="logout"}}class u1e{constructor(e,n,r){this.keyManager=e,this.setNsecAuth=n,this.console=r}async authenticate(e){if(!Cb.isValidSecretKey(e,this.keyManager))return{success:!1,error:"invalid_secret"};const{success:n}=this.keyManager.saveToStorage(e);if(!n)return{success:!1,error:"error_saving"};try{const r=this.keyManager.derivePublicKey(e);return r.hex?(this.setNsecAuth(r.hex,r.npub,r.nprofile),{success:!0,pubkeyHex:r.hex}):{success:!1,error:"derivation_failed"}}catch(r){return this.console.error("nsecèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",r),{success:!1,error:"authentication_error"}}}}class d1e{constructor(e,n){this.publicKeyState=e,this.console=n}async authenticate(e){if(Cb.isLogoutAuth(e))return{success:!0};if(!Cb.hasRequiredPubkey(e))return this.console.warn("NostrLoginAuth: pubkey is required for login/signup"),{success:!1,error:"missing_pubkey"};try{return this.publicKeyState.setNostrLoginAuth(e),{success:!0,pubkeyHex:e.pubkey}}catch(n){return this.console.error("nostr-loginèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",n),{success:!1,error:"nostr_login_error"}}}}class f1e{constructor(e){this.window=e}async waitForExternalAuth(e=5e3){const n=Date.now(),r=100;return new Promise(i=>{const s=()=>{if(this.isWindowNostrAvailable()){i(!0);return}if(Date.now()-n>=e){i(!1);return}setTimeout(s,r)};s()})}isWindowNostrAvailable(){return typeof this.window<"u"&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}}class h1e{constructor(e,n){this.navigator=e,this.console=n}async clearProfileImageCache(){try{if(!this.hasServiceWorker())return;const e=new MessageChannel;return new Promise((n,r)=>{e.port1.onmessage=i=>{i.data.success?(this.console.log("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ãã¯ãªã¢ãã¾ãã"),n()):(this.console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢å¤±æ:",i.data.error),r(new Error(i.data.error)))},this.navigator.serviceWorker.controller?this.navigator.serviceWorker.controller.postMessage({action:"clearProfileCache"},[e.port2]):r(new Error("Service worker controller is null."))})}catch(e){this.console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}}hasServiceWorker(){return"serviceWorker"in this.navigator&&!!this.navigator.serviceWorker.controller}}class p1e{constructor(e){this.localStorage=e}getStoredNostrLoginData(){try{const e=this.localStorage.getItem("__nostrlogin_nip46");if(!e)return null;const n=JSON.parse(e);return n?.pubkey?{pubkey:n.pubkey,npub:n.npub}:null}catch{return null}}}class m1e{constructor(e,n,r,i,s,o,a){this.keyManager=e,this.publicKeyState=n,this.nostrLoginManager=r,this.externalAuthWaiter=i,this.storageManager=s,this.setNsecAuth=o,this.console=a}async initialize(e){try{const n=await this.checkNsecAuth();if(n.hasAuth)return n;await this.externalAuthWaiter.waitForExternalAuth(100);const r=await this.checkNostrLoginAuth(e);if(r.hasAuth)return r}catch(n){this.console.error("nostr-loginåæåå¤±æ:",n)}return{hasAuth:!1}}async checkNsecAuth(){const e=this.keyManager.loadFromStorage();if(!e)return{hasAuth:!1};this.publicKeyState.setNsec(e);try{const n=this.keyManager.derivePublicKey(e);return n.hex?(this.setNsecAuth(n.hex,n.npub,n.nprofile),{hasAuth:!0,pubkeyHex:n.hex,isNostrLogin:!1}):(this.keyManager.saveToStorage(""),{hasAuth:!1})}catch{return this.keyManager.saveToStorage(""),{hasAuth:!1}}}async checkNostrLoginAuth(e){await this.nostrLoginManager.init(e),await new Promise(i=>setTimeout(i,100));const n=this.nostrLoginManager.getCurrentUser();if(n?.pubkey)return this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:n.pubkey,npub:n.npub}),{hasAuth:!0,pubkeyHex:n.pubkey,isNostrLogin:!0};const r=this.storageManager.getStoredNostrLoginData();return r?.pubkey?(this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:r.pubkey,npub:r.npub}),{hasAuth:!0,pubkeyHex:r.pubkey,isNostrLogin:!0}):{hasAuth:!1}}}class g1e{publicKeyState;nsecAuthenticator;nostrLoginAuthenticator;profileCacheCleaner;authInitializer;nostrLoginMgr;keyManager;nostrLoginOptions={theme:"default",noBanner:!0,methods:"connect, extension, local"};constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.keyManager||new D6({secretKeyStore:e.secretKeyStore||cse,setNostrLoginAuthFn:e.setNostrLoginAuth||bI,clearAuthStateFn:e.clearAuthState||yI,localStorage:n}),i=e.window||(typeof window<"u"?window:{}),s=e.navigator||(typeof window<"u"?window.navigator:{}),o=e.console||(typeof window<"u"?window.console:{}),a=e.setNsecAuth||ese;this.nostrLoginMgr=e.nostrLoginManager||c4,this.publicKeyState=new R6({setNostrLoginAuthFn:e.setNostrLoginAuth||bI,clearAuthStateFn:e.clearAuthState||yI,localStorage:n}),this.nsecAuthenticator=new u1e(r,a,o),this.nostrLoginAuthenticator=new d1e(this.publicKeyState,o),this.profileCacheCleaner=new h1e(s,o);const l=new f1e(i),c=new p1e(n);this.authInitializer=new m1e(r,this.publicKeyState,this.nostrLoginMgr,l,c,a,o),this.keyManager=r}async authenticateWithNsec(e){return await this.nsecAuthenticator.authenticate(e)}async authenticateWithNostrLogin(e){return Cb.isLogoutAuth(e)?(this.logout(),{success:!0}):await this.nostrLoginAuthenticator.authenticate(e)}async showNostrLoginDialog(){const e=c4;if(!e.isInitialized)throw new Error("nostr-login is not initialized");try{await e.showLogin()}catch(n){if(!(n instanceof Error&&n.message==="Cancelled"))throw console.error("nostr-loginã§ã¨ã©ã¼:",n),n}}logout(){try{if(this.publicKeyState.currentIsNostrLogin&&this.nostrLoginMgr.isInitialized)try{this.nostrLoginMgr.logout()}catch(e){console.error("nostr-loginã­ã°ã¢ã¦ãä¸­ã«ã¨ã©ã¼:",e)}try{const e=localStorage.getItem("firstVisit");localStorage.clear(),e&&localStorage.setItem("firstVisit",e)}catch(e){console.error("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}this.profileCacheCleaner.clearProfileImageCache().catch(e=>{console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}),setTimeout(()=>{try{typeof window<"u"&&window.location&&typeof window.location.replace=="function"?window.location.replace(window.location.pathname):typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(e){console.error("ãã¼ã¸ãªã­ã¼ãä¸­ã«ã¨ã©ã¼:",e)}},500)}catch(e){console.error("ã­ã°ã¢ã¦ãå¦çä¸­ã«äºæããªãã¨ã©ã¼:",e),setTimeout(()=>{try{typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(n){console.error("ãã¼ã¸ãªã­ã¼ãä¸­ã«ã¨ã©ã¼:",n)}},2e3)}}async initializeAuth(){return await this.authInitializer.initialize(this.nostrLoginOptions)}getPublicKeyState(){return this.publicKeyState}setNostrLoginHandler(e){this.nostrLoginMgr.setAuthHandler(e)}markAuthInitialized(){tse()}getNsecAuthenticator(){return this.nsecAuthenticator}getNostrLoginAuthenticator(){return this.nostrLoginAuthenticator}getProfileCacheCleaner(){return this.profileCacheCleaner}getAuthInitializer(){return this.authInitializer}}const Zl=new g1e;var y1e=Ce('<div><div class="balloon-message svelte-kfz10i"> </div></div>');function b1e(t,e){let n=ce(e,"type",3,"success"),r=ce(e,"message",3,"");var i=y1e(),s=ie(i),o=ie(s);Ge(()=>{Qo(i,1,`balloon-message-wrapper ${n()??""}`,"svelte-kfz10i"),Be(o,r())}),Y(t,i)}class Q${constructor(e){this.$_=e}showTimeout=null;lastMessageTime=0;debounceDelay=500;getRandomInfoMessage(){const e=Uie,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getRandomSuccessMessage(){const e=Hie,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getErrorMessage(){return this.$_(Vie)??""}createMessage(e,n,r=!1){const i=Date.now();if(!r&&i-this.lastMessageTime<this.debounceDelay)return{type:e,message:""};this.lastMessageTime=i;let s=n;if(!s)switch(e){case"info":s=this.getRandomInfoMessage();break;case"success":s=this.getRandomSuccessMessage();break;case"error":s=this.getErrorMessage();break;default:s=""}return{type:e,message:s}}scheduleHide(e,n=3e3){this.showTimeout&&clearTimeout(this.showTimeout),this.showTimeout=setTimeout(e,n)}cancelScheduledHide(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}createMessageImmediate(e,n){return this.createMessage(e,n,!0)}dispose(){this.cancelScheduledHide(),this.lastMessageTime=0}}var w1e=Ce('<div class="trash-icon svg-icon svelte-1dq5yfg"></div>'),v1e=Ce("<!> <!>",1),x1e=Ce('<div class="list-icon svg-icon svelte-1dq5yfg"></div>'),S1e=Ce("<!> <!>",1),k1e=Ce('<div class="floppy-disk-icon svg-icon svelte-1dq5yfg"></div>'),E1e=Ce("<!> <!>",1),T1e=Ce('<div class="copy-success-message"> </div>'),C1e=Ce('<div class="header-container svelte-1dq5yfg"><div class="header-left svelte-1dq5yfg"><a href="https://lokuyow.github.io/ehagaki/" class="site-icon-link svelte-1dq5yfg" aria-label="ehagaki"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-1dq5yfg"/></a> <!></div> <div class="post-actions svelte-1dq5yfg"><div class="buttons-container svelte-1dq5yfg"><!> <!> <!></div></div></div>  <label id="vibrateSwitch" style="display: none;" aria-hidden="true"><input type="checkbox" checked/></label> <!>',1);function _1e(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ce(e,"balloonMessage",3,null),o=ye(!1),a=ye(0),l=ye(0);function c(V){if(e.onSaveDraft()){const ne=V.currentTarget.getBoundingClientRect();Q(a,ne.left+ne.width/2),Q(l,ne.bottom+8),Q(o,!0),setTimeout(()=>{Q(o,!1)},2e3)}}let u=null;nt(()=>{n()&&!u&&(u=new Q$(n()))});let d=oe(()=>An.postStatus),f=oe(()=>An.isUploading),h=oe(()=>An.canPost),p=ye(null),m=ye(!1);function g(){u&&!E(m)&&(Q(p,u.createMessage("success"),!0),Q(m,!0),u.scheduleHide(()=>{Q(p,null),Q(m,!1),Ta({...An.postStatus,success:!1,message:"",completed:!1})},3e3))}nt(()=>{E(d).success&&E(d).completed&&!E(p)&&!E(m)&&g()}),nt(()=>{(!E(d).success||!E(d).completed)&&(E(p)||E(m))&&(Q(p,null),Q(m,!1),u&&u.cancelScheduledHide())});let y=oe(()=>E(d).error&&u!==null?u.createMessage("error"):null),b=ye(null);const x=typeof window<"u"&&(window.location.port==="4173"||window.location.hostname==="localhost");let C=ye(null);nt(()=>{if(typeof window<"u"&&u){const V=new URLSearchParams(window.location.search),q=V.get("error");if(q&&V.get("shared")==="true"){if(["processing-error","no-image","upload-failed","network-error","client-error"].includes(q)){setTimeout(()=>{const te=new URL(window.location.href);te.searchParams.delete("error"),te.searchParams.delete("shared"),window.history.replaceState({},"",te.toString())},1e3);return}let ne="";switch(q){case"messaging-error":ne="Service Workerã¨ã®éä¿¡ã§ã¨ã©ã¼ãçºçãã¾ããããã¼ã¸ãæ´æ°ãã¦ããä¸åº¦ãè©¦ããã ããã";break;case"window-error":ne="æ°ããã¦ã£ã³ãã¦ã®ä½æã«å¤±æãã¾ãã";break;default:setTimeout(()=>{const te=new URL(window.location.href);te.searchParams.delete("error"),te.searchParams.delete("shared"),window.history.replaceState({},"",te.toString())},1e3);return}Q(C,{type:"error",message:ne},!0),setTimeout(()=>{const te=new URL(window.location.href);te.searchParams.delete("error"),te.searchParams.delete("shared"),window.history.replaceState({},"",te.toString()),setTimeout(()=>{Q(C,null)},5e3)},1e3)}}}),x&&(window.showInfoBalloonDebug=V=>{Q(b,{type:"info",message:V},!0)},window.hideInfoBalloonDebug=()=>{Q(b,null)});let P=oe(()=>E(C)||(x?E(b)||s()||E(y)||E(p):s()||E(y)||E(p)));nt(()=>()=>{u&&u.dispose()});let S=ye(void 0);nt(()=>{E(S)&&E(S).setAttribute("switch","")});var _=C1e(),k=Te(_),T=ie(k),O=ve(ie(T),2);{var M=V=>{b1e(V,{get type(){return E(P).type},get message(){return E(P).message}})};He(O,V=>{E(P)&&V(M)})}var L=ve(T,2),F=ie(L),B=ie(F);_t(B,()=>Eu,(V,q)=>{q(V,{delayDuration:500,children:(G,ne)=>{var te=v1e(),Z=Te(te);{const _e=(de,Ee)=>{let Re=()=>Ee?.().props;const je=oe(()=>{const{onclick:Ve,...Se}=Re();return{tooltipOnclick:Ve,restProps:Se}});{let Ve=oe(()=>!E(h)||E(d).sending||E(f)),Se=oe(()=>n()("postComponent.clear_editor"));Lt(de,qn({variant:"header",shape:"square",className:"clear-button",get disabled(){return E(Ve)},onClick:Me=>{e.onResetPostContent(),typeof E(je).tooltipOnclick=="function"&&E(je).tooltipOnclick(Me)},get ariaLabel(){return E(Se)}},()=>E(je).restProps,{children:(Me,Ne)=>{var Ke=w1e();Y(Me,Ke)},$$slots:{default:!0}}))}};_t(Z,()=>Cu,(de,Ee)=>{Ee(de,{child:_e,$$slots:{child:!0}})})}var ae=ve(Z,2);_t(ae,()=>ja,(_e,de)=>{de(_e,{children:(Ee,Re)=>{var je=ze(),Ve=Te(je);_t(Ve,()=>Tu,(Se,Me)=>{Me(Se,{sideOffset:8,class:"tooltip-content",children:(Ne,Ke)=>{var Ae=Yt();Ge(we=>Be(Ae,we),[()=>n()("postComponent.clear_editor")]),Y(Ne,Ae)},$$slots:{default:!0}})}),Y(Ee,je)},$$slots:{default:!0}})}),Y(G,te)},$$slots:{default:!0}})});var R=ve(B,2);_t(R,()=>Eu,(V,q)=>{q(V,{delayDuration:500,children:(G,ne)=>{var te=S1e(),Z=Te(te);{const _e=(de,Ee)=>{let Re=()=>Ee?.().props;const je=oe(()=>{const{onclick:Ve,...Se}=Re();return{tooltipOnclick:Ve,restProps:Se}});{let Ve=oe(()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§");Lt(de,qn({variant:"header",shape:"square",className:"draft-list-button",onClick:Se=>{e.onShowDraftList(),typeof E(je).tooltipOnclick=="function"&&E(je).tooltipOnclick(Se)},get ariaLabel(){return E(Ve)}},()=>E(je).restProps,{children:(Se,Me)=>{var Ne=x1e();Y(Se,Ne)},$$slots:{default:!0}}))}};_t(Z,()=>Cu,(de,Ee)=>{Ee(de,{child:_e,$$slots:{child:!0}})})}var ae=ve(Z,2);_t(ae,()=>ja,(_e,de)=>{de(_e,{children:(Ee,Re)=>{var je=ze(),Ve=Te(je);_t(Ve,()=>Tu,(Se,Me)=>{Me(Se,{sideOffset:8,class:"tooltip-content",children:(Ne,Ke)=>{var Ae=Yt();Ge(we=>Be(Ae,we),[()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§"]),Y(Ne,Ae)},$$slots:{default:!0}})}),Y(Ee,je)},$$slots:{default:!0}})}),Y(G,te)},$$slots:{default:!0}})});var A=ve(R,2);_t(A,()=>Eu,(V,q)=>{q(V,{delayDuration:500,children:(G,ne)=>{var te=E1e(),Z=Te(te);{const _e=(de,Ee)=>{let Re=()=>Ee?.().props;const je=oe(()=>{const{onclick:Ve,...Se}=Re();return{tooltipOnclick:Ve,restProps:Se}});{let Ve=oe(()=>!E(h)||E(d).sending||E(f)),Se=oe(()=>n()("draft.save")||"ä¸æ¸ãä¿å­");Lt(de,qn({variant:"header",shape:"square",className:"draft-save-button",get disabled(){return E(Ve)},onClick:Me=>{c(Me),typeof E(je).tooltipOnclick=="function"&&E(je).tooltipOnclick(Me)},get ariaLabel(){return E(Se)}},()=>E(je).restProps,{children:(Me,Ne)=>{var Ke=k1e();Y(Me,Ke)},$$slots:{default:!0}}))}};_t(Z,()=>Cu,(de,Ee)=>{Ee(de,{child:_e,$$slots:{child:!0}})})}var ae=ve(Z,2);_t(ae,()=>ja,(_e,de)=>{de(_e,{children:(Ee,Re)=>{var je=ze(),Ve=Te(je);_t(Ve,()=>Tu,(Se,Me)=>{Me(Se,{sideOffset:8,class:"tooltip-content",children:(Ne,Ke)=>{var Ae=Yt();Ge(we=>Be(Ae,we),[()=>n()("draft.save")||"ä¸æ¸ãä¿å­"]),Y(Ne,Ae)},$$slots:{default:!0}})}),Y(Ee,je)},$$slots:{default:!0}})}),Y(G,te)},$$slots:{default:!0}})});var N=ve(k,2),z=ie(N);Ar(z,V=>Q(S,V),()=>E(S));var U=ve(N,2);mC(U,{get show(){return E(o)},get x(){return E(a)},get y(){return E(l)},onClose:()=>Q(o,!1),children:(V,q)=>{var G=T1e(),ne=ie(G);Ge(te=>Be(ne,te),[()=>n()("draft.saved")]),Y(V,G)},$$slots:{default:!0}}),Y(t,_),vt(),i()}var A1e=Ce('<li class="svelte-1ldno5o"> </li>'),P1e=Ce('<button type="button" class="floating-dev-console-log svelte-1ldno5o" title="ã¿ããã§å¨ã³ãã¼" aria-label="éçºèã­ã°ãã³ãã¼"><ul class="svelte-1ldno5o"></ul></button>'),I1e=Ce('<div class="shared-image-error svelte-1ldno5o"><div class="error-text svelte-1ldno5o"> </div></div>'),O1e=Ce('<div class="stop-icon svg-icon"></div>'),M1e=Ce('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> </div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),N1e=Ce('<div class="stop-icon svg-icon"></div>'),R1e=Ce('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> </div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),D1e=Ce('<div class="stop-icon svg-icon"></div>'),L1e=Ce('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> <!> <!></div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),B1e=Ce('<div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> <!> <!></div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div>'),F1e=Ce(" <br/> <!>",1),$1e=Ce('<div class="image-size-info svelte-1ldno5o"><div class="size-label svelte-1ldno5o"> </div> <div class="size-details svelte-1ldno5o"><!></div></div>'),z1e=Ce('<!> <div class="footer-center svelte-1ldno5o"><!></div>',1);function U1e(t,e){wt(e,!0);const n=()=>Qn(pC,"$devLog",i),r=()=>Qn(yr,"$_",i),[i,s]=ei();let o=ye(!1),a=ye(null);nt(()=>{if(typeof window<"u"){const V=new URLSearchParams(window.location.search),q=V.get("error");if(q&&V.get("shared")==="true"){const G=()=>{const ne=localStorage.getItem("sharedImageProcessed")==="1",ae=!new URLSearchParams(window.location.search).get("error");return ne||ae};if(G()){console.log("Shared image was processed successfully, ignoring error parameter");return}setTimeout(()=>{if(G()){console.log("Shared image processing detected after delay, not showing error");return}let ne="";switch(q){case"processing-error":ne="å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼ãçºçãã¾ãã";break;case"no-image":ne="å±æç»åãè¦ã¤ããã¾ããã§ãã";break;case"upload-failed":ne="ç»åã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã";break;case"network-error":ne="ãããã¯ã¼ã¯ã¨ã©ã¼ãçºçãã¾ãã";break;case"client-error":ne="ç»åå±æå¦çã§ã¨ã©ã¼ãçºçãã¾ãã";break;default:return}Q(a,ne,!0),setTimeout(()=>{const te=new URL(window.location.href);te.searchParams.delete("error"),te.searchParams.delete("shared"),window.history.replaceState({},"",te.toString()),setTimeout(()=>{Q(a,null)},5e3)},1e3)},100)}}});async function l(V){try{V?.preventDefault()}catch{}try{const q=[...n()].reverse();await Age(q),(q?.length??0)>0&&(Q(o,!0),setTimeout(()=>Q(o,!1),1500))}catch(q){console.warn("dev log copy failed:",q)}}let c=ce(e,"uploadProgress",31,()=>Zt({total:0,completed:0,failed:0,aborted:0,inProgress:!1})),u=oe(()=>_p.value),d=oe(()=>Ap.value),f=ye(null),h=ye(0),p=null;nt(()=>{E(u)>0&&E(u)<100?E(f)||(Q(f,Date.now(),!0),O({imageSizeInfoOnly:!0}),p=window.setInterval(()=>{E(f)&&Q(h,Math.floor((Date.now()-E(f))/1e3),!0)},1e3)):(p!==null&&(clearInterval(p),p=null),Q(f,null),Q(h,0))}),nt(()=>{E(d)>0&&E(d)<100?E(f)||(Q(f,Date.now(),!0),O({imageSizeInfoOnly:!0}),p=window.setInterval(()=>{E(f)&&Q(h,Math.floor((Date.now()-E(f))/1e3),!0)},1e3)):(p!==null&&(clearInterval(p),p=null),Q(f,null),Q(h,0))});let m=oe(()=>sf.value.info),g=oe(()=>sf.value.visible),y=ye(!1);nt(()=>{c().inProgress&&!E(y)&&O({imageSizeInfoOnly:!0}),Q(y,c().inProgress,!0)});function b(V){if(V<60)return`${V}s`;const q=Math.floor(V/60),G=V%60;return`${q}m ${G}s`}function x(){_p.set(0),Ap.set(0),p!==null&&(clearInterval(p),p=null),Q(f,null),Q(h,0),c({total:0,completed:0,failed:0,aborted:0,inProgress:!1});const q=dC.value;q&&U6(q,!1),Jie()}function C(){x()}function P(){x()}function S(V){if(!V)return"";const q=V.match(/\.([a-zA-Z0-9]+)$/);if(!q)return"";const G=q[1].toUpperCase();return G==="JPEG"?"JPG":G}function _(){return typeof window>"u"?"medium":localStorage.getItem("videoCompressionLevel")||"medium"}function k(V){switch(V){case"none":return r()("settingsDialog.quality_lossless");case"low":return r()("footerInfoDisplay.videoQualityLevel.high");case"medium":return r()("footerInfoDisplay.videoQualityLevel.medium");case"high":return r()("footerInfoDisplay.videoQualityLevel.low");default:return r()("footerInfoDisplay.videoQualityLevel.medium")}}function T(V){c(V),!V.inProgress&&V.total>0&&setTimeout(()=>{c({total:0,completed:0,failed:0,aborted:0,inProgress:!1})},1e3)}function O(V){if(V?.imageSizeInfoOnly){sf.set({info:null,visible:!1});return}c({total:0,completed:0,failed:0,aborted:0,inProgress:!1}),_p.set(0),Ap.set(0),p!==null&&(clearInterval(p),p=null),Q(f,null),Q(h,0),sf.set({info:null,visible:!1}),Q(a,null)}let M=oe(()=>E(a)!==null||E(d)>0&&E(d)<100||E(u)>0&&E(u)<100||c().inProgress||c().total>0||E(g)&&E(m)!==null);var L={updateProgress:T,reset:O},F=z1e(),B=Te(F);{var R=V=>{var q=P1e();q.__click=l,q.__touchend=l;var G=ie(q);Ma(G,5,()=>[...n()].reverse(),pu,(ne,te)=>{var Z=A1e(),ae=ie(Z);Ge(()=>Be(ae,E(te))),Y(ne,Z)}),Y(V,q)};He(B,V=>{IB()&&n().length&&V(R)})}var A=ve(B,2),N=ie(A);{var z=V=>{var q=ze(),G=Te(q);{var ne=Z=>{var ae=I1e(),_e=ie(ae),de=ie(_e);Ge(()=>Be(de,E(a))),Y(Z,ae)},te=Z=>{var ae=ze(),_e=Te(ae);{var de=Re=>{var je=M1e(),Ve=ie(je);Lt(Ve,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"å§ç¸®ä¸­æ­¢",onClick:P,children:(we,We)=>{var et=O1e();Y(we,et)},$$slots:{default:!0}});var Se=ve(Ve,2),Me=ie(Se),Ne=ie(Me),Ke=ve(Me,2),Ae=ie(Ke);Ge((we,We)=>{Be(Ne,`${we??""}: ${E(d)??""}%
                        (${We??""})`),lc(Ae,`width: ${E(d)??""}%`)},[()=>r()("imageCompression.compressing"),()=>b(E(h))]),Y(Re,je)},Ee=Re=>{var je=ze(),Ve=Te(je);{var Se=Ne=>{var Ke=R1e(),Ae=ie(Ke);Lt(Ae,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"å§ç¸®ä¸­æ­¢",onClick:C,children:(Ot,Tt)=>{var Mt=N1e();Y(Ot,Mt)},$$slots:{default:!0}});var we=ve(Ae,2),We=ie(we),et=ie(We),at=ve(We,2),Pt=ie(at);Ge((Ot,Tt,Mt)=>{Be(et,`${Ot??""}${Tt??""}: ${E(u)??""}%
                        (${Mt??""})`),lc(Pt,`width: ${E(u)??""}%`)},[()=>k(_()),()=>r()("videoQualityLabelSuffix"),()=>b(E(h))]),Y(Ne,Ke)},Me=Ne=>{var Ke=ze(),Ae=Te(Ke);{var we=et=>{var at=ze(),Pt=Te(at);{var Ot=Mt=>{var Ft=L1e(),En=ie(Ft);Lt(En,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"ã¢ããã­ã¼ãä¸­æ­¢",onClick:P,children:(tn,Qt)=>{var zn=D1e();Y(tn,zn)},$$slots:{default:!0}});var Ut=ve(En,2),Pn=ie(Ut),ln=ie(Pn),$t=ve(ln);{var en=tn=>{var Qt=Yt();Ge(zn=>Be(Qt,`(${zn??""}: ${c().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),Y(tn,Qt)};He($t,tn=>{c().failed>0&&tn(en)})}var Tn=ve($t,2);{var Nn=tn=>{var Qt=Yt();Ge(zn=>Be(Qt,`(${zn??""}: ${c().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),Y(tn,Qt)};He(Tn,tn=>{c().aborted>0&&tn(Nn)})}var Xt=ve(Pn,2),jt=ie(Xt);Ge((tn,Qt)=>{Be(ln,`${tn??""}: ${c().completed??""}/${c().total??""} `),lc(jt,`width: ${Qt??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>c().total>0?Math.round(c().completed/c().total*100):0]),Y(Mt,Ft)},Tt=Mt=>{var Ft=B1e(),En=ie(Ft),Ut=ie(En),Pn=ve(Ut);{var ln=Xt=>{var jt=Yt();Ge(tn=>Be(jt,`(${tn??""}: ${c().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),Y(Xt,jt)};He(Pn,Xt=>{c().failed>0&&Xt(ln)})}var $t=ve(Pn,2);{var en=Xt=>{var jt=Yt();Ge(tn=>Be(jt,`(${tn??""}: ${c().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),Y(Xt,jt)};He($t,Xt=>{c().aborted>0&&Xt(en)})}var Tn=ve(En,2),Nn=ie(Tn);Ge((Xt,jt)=>{Be(Ut,`${Xt??""}: ${c().completed??""}/${c().total??""} `),lc(Nn,`width: ${jt??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>c().total>0?Math.round(c().completed/c().total*100):0]),Y(Mt,Ft)};He(Pt,Mt=>{c().inProgress?Mt(Ot):Mt(Tt,!1)})}Y(et,at)},We=et=>{var at=ze(),Pt=Te(at);{var Ot=Tt=>{var Mt=$1e(),Ft=ie(Mt),En=ie(Ft),Ut=ve(Ft,2),Pn=ie(Ut);{var ln=$t=>{var en=F1e(),Tn=Te(en),Nn=ve(Tn,2),Xt=ve(Nn);{var jt=Qt=>{var zn=Yt();Ge(yi=>Be(zn,yi),[()=>r()("footerInfoDisplay.no_compression")||"å§ç¸®ãªã"]),Y(Qt,zn)},tn=Qt=>{var zn=ze(),yi=Te(zn);{var ys=Fn=>{var or=Yt();Ge(()=>Be(or,`${E(m).compressedSize??""}
                            (${E(m).compressionRatio??""}%)`)),Y(Fn,or)},It=Fn=>{var or=Yt();Ge(()=>Be(or,`${E(m).compressedSize??""}
                            (${E(m).compressionRatio??""}%)`)),Y(Fn,or)};He(yi,Fn=>{E(m).wasCompressed?Fn(ys):Fn(It,!1)},!0)}Y(Qt,zn)};He(Xt,Qt=>{E(m).wasSkipped?Qt(jt):Qt(tn,!1)})}Ge((Qt,zn)=>{Be(Tn,`${Qt??""}
                        ${E(m).originalSize??""}`),Be(Nn,` â ${zn??""} `)},[()=>S(E(m).originalFilename),()=>S(E(m).compressedFilename)]),Y($t,en)};He(Pn,$t=>{E(m).originalFilename&&E(m).compressedFilename&&$t(ln)})}Ge($t=>Be(En,`${$t??""}:`),[()=>r()("footerInfoDisplay.data_size")]),Y(Tt,Mt)};He(Pt,Tt=>{E(g)&&E(m)&&Tt(Ot)},!0)}Y(et,at)};He(Ae,et=>{c().inProgress||c().total>0?et(we):et(We,!1)},!0)}Y(Ne,Ke)};He(Ve,Ne=>{E(u)>0&&E(u)<100?Ne(Se):Ne(Me,!1)},!0)}Y(Re,je)};He(_e,Re=>{E(d)>0&&E(d)<100?Re(de):Re(Ee,!1)},!0)}Y(Z,ae)};He(G,Z=>{E(a)?Z(ne):Z(te,!1)})}Y(V,q)};He(N,V=>{E(M)&&V(z)})}Y(t,F);var U=vt(L);return s(),U}Mi(["click","touchend"]);var H1e=Ce("<img/>"),V1e=Ce('<div class="profile-picture default svg-icon svelte-whjdpq" aria-label="User"></div>'),W1e=Ce('<div class="update-indicator svelte-whjdpq"></div>'),j1e=Ce('<div class="settings-icon svg-icon svelte-whjdpq" aria-label="Settings"></div> <!>',1),q1e=Ce('<div class="footer-bar svelte-whjdpq"><!> <!> <!></div>');function K1e(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=oe(()=>ic.value),o=oe(()=>Xs.value),a=oe(()=>jd.value),l=ye(void 0),c=ye(!1);const u=()=>E(s)?.name?E(s).name:E(s)?.npub?E(s).npub:"User";function d(k){console.log("ãã­ãã£ã¼ã«ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãã:",k),Q(c,!0),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&console.log("Service Workerã«ããã­ã£ãã·ã¥å¦çã®å¯è½æ§ãããã¾ã")}function f(k){if(!k)return!1;try{return new URL(k,location.href).origin===location.origin}catch{return!1}}let h=ye(!1);nt(()=>{E(s)?.picture?(Q(c,!1),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&E(s).picture.includes("profile=true")&&console.log("Service Workerã§ãã­ãã£ã¼ã«ç»åãã­ã£ãã·ã¥å¦çäºå®:",E(s).picture),Q(h,f(E(s).picture),!0)):Q(h,!1)});function p(k){E(l)?.updateProgress(k)}function m(){E(l)?.reset()}var g={isSameOriginPictureUrl:f,updateProgress:p,reset:m},y=q1e(),b=ie(y);{var x=k=>{Lt(k,{shape:"circle",className:"profile-display loading",disabled:!0,children:(T,O)=>{Ic(T,{showLoader:!0})},$$slots:{default:!0}})},C=k=>{var T=ze(),O=Te(T);{var M=F=>{Lt(F,{shape:"circle",className:"profile-display loading",disabled:!0,children:(B,R)=>{Ic(B,{showLoader:!0})},$$slots:{default:!0}})},L=F=>{var B=ze(),R=Te(B);{var A=z=>{{let U=oe(()=>`profile-display${E(o)?" loading":""}`);Lt(z,{variant:"default",shape:"circle",get className(){return E(U)},get disabled(){return E(o)},onClick:()=>{E(o)||e.onOpenLogoutDialog()},children:(V,q)=>{var G=ze(),ne=Te(G);{var te=ae=>{Ic(ae,{showLoader:!0})},Z=ae=>{var _e=ze(),de=Te(_e);{var Ee=je=>{var Ve=H1e();kr(Ve,Se=>({src:E(s).picture,alt:Se,class:"profile-picture",loading:"lazy",...E(h)?{crossorigin:"anonymous",referrerpolicy:"no-referrer"}:{},onerror:d}),[u],void 0,void 0,"svelte-whjdpq"),Y(je,Ve)},Re=je=>{var Ve=V1e();Y(je,Ve)};He(de,je=>{E(s)?.picture&&!E(c)?je(Ee):je(Re,!1)},!0)}Y(ae,_e)};He(ne,ae=>{E(o)?ae(te):ae(Z,!1)})}Y(V,G)},$$slots:{default:!0}})}},N=z=>{var U=ze(),V=Te(U);{var q=G=>{Lt(G,{className:"login-btn",variant:"primary",shape:"pill",get onClick(){return e.onShowLoginDialog},children:(ne,te)=>{var Z=Yt();Ge(ae=>Be(Z,ae),[()=>n()("app.login")]),Y(ne,Z)},$$slots:{default:!0}})};He(V,G=>{!E(o)&&!e.isAuthenticated&&G(q)},!0)}Y(z,U)};He(R,z=>{e.isAuthenticated&&(E(a)||E(o))?z(A):z(N,!1)},!0)}Y(F,B)};He(O,F=>{e.isAuthenticated&&E(o)?F(M):F(L,!1)},!0)}Y(k,T)};He(b,k=>{e.isAuthInitialized?k(C,!1):k(x)})}var P=ve(b,2);Ar(U1e(P,{}),k=>Q(l,k,!0),()=>E(l));var S=ve(P,2);{let k=oe(()=>e.swNeedRefresh?"has-update":"");Lt(S,{variant:"default",shape:"circle",get className(){return`settings-btn ${E(k)??""}`},get onClick(){return e.onOpenSettingsDialog},ariaLabel:"è¨­å®",children:(T,O)=>{var M=j1e(),L=ve(Te(M),2);{var F=B=>{var R=W1e();Y(B,R)};He(L,B=>{e.swNeedRefresh&&B(F)})}Y(T,M)},$$slots:{default:!0}})}Y(t,y);var _=vt(g);return i(),_}const Y$=66,G1e=50,Z1e=50,X1e=100;let u4=ye(!1);const Q1e={get value(){return E(u4)},set:t=>{Q(u4,t,!0),typeof document<"u"&&document.documentElement.style.setProperty("--reason-input-height",t?`${Z1e}px`:"0px")}};let J$=ye(Y$),d4=ye(0);const ez={get value(){return E(J$)}};function Y1e(){if(typeof window>"u"||!window.visualViewport)return;let t=null;function e(){t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{const n=window.visualViewport;if(!n)return;const r=n.height+(n.offsetTop||0),i=Math.max(0,window.innerHeight-r),s=i>X1e;Q(J$,s?i:Y$,!0),Q(d4,s?i:0,!0);const o=document.documentElement;o.style.setProperty("--keyboard-height",`${E(d4)}px`),o.style.setProperty("--visible-viewport-height",`${n.height}px`)})}return e(),window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e),()=>{window.visualViewport?.removeEventListener("resize",e),window.visualViewport?.removeEventListener("scroll",e),t&&cancelAnimationFrame(t),t=null}}var J1e=Ce('<div class="image-icon svg-icon svelte-hsi6z2"></div>'),e2e=Ce("<!> <!>",1),t2e=Ce('<div class="plane-icon svg-icon svelte-hsi6z2"></div>'),n2e=Ce("<!> <!>",1),r2e=Ce('<div class="content-warning-icon svg-icon svelte-hsi6z2"></div>'),i2e=Ce("<!> <!>",1),s2e=Ce('<div class="thumbtack-icon svg-icon svelte-hsi6z2"></div>'),o2e=Ce('<div class="thumbtack-slash-icon svg-icon svelte-hsi6z2"></div>'),a2e=Ce('<div class="hashtag-pin-group svelte-hsi6z2"><div class="hashtag-icon svg-icon svelte-hsi6z2"></div> <!></div>'),l2e=Ce("<!> <!>",1),c2e=Ce('<div class="footer-button-bar svelte-hsi6z2"><div class="button-container svelte-hsi6z2"><div class="button-group-left svelte-hsi6z2"><!></div> <div class="button-group-center svelte-hsi6z2"><!></div> <div class="button-group-right svelte-hsi6z2"><!> <!></div></div></div>');function u2e(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=ye(!1);nt(()=>jr.subscribe(O=>{Q(s,O&&O.isAuthenticated,!0)}));let o=oe(()=>An.postStatus),a=oe(()=>An.isUploading),l=oe(()=>An.canPost),c=ye(!1);nt(()=>{E(o).sending?Q(c,!0):E(c)&&setTimeout(()=>{Q(c,!1)},400)});let u=oe(()=>Ku.value);function d(){Ku.toggle(),Ku.value||Sf.reset()}let f=oe(()=>AS.value);function h(){AS.toggle()}let p=oe(()=>ez.value);function m(T){T.preventDefault()}nt(()=>Y1e());var g=c2e(),y=ie(g);y.__mousedown=m,y.__touchstart=m;var b=ie(y),x=ie(b);_t(x,()=>Eu,(T,O)=>{O(T,{delayDuration:500,children:(M,L)=>{var F=e2e(),B=Te(F);{const A=(N,z)=>{let U=()=>z?.().props;const V=oe(()=>{const{onclick:q,...G}=U();return{tooltipOnclick:q,restProps:G}});{let q=oe(()=>!E(s)||E(o).sending||E(a)),G=oe(()=>n()("postComponent.upload_image"));Lt(N,qn({variant:"footer",shape:"square",className:"image-button",get disabled(){return E(q)},onClick:ne=>{e.onUploadImage?.(),typeof E(V).tooltipOnclick=="function"&&E(V).tooltipOnclick(ne)},get ariaLabel(){return E(G)}},()=>E(V).restProps,{children:(ne,te)=>{var Z=J1e();Y(ne,Z)},$$slots:{default:!0}}))}};_t(B,()=>Cu,(N,z)=>{z(N,{child:A,$$slots:{child:!0}})})}var R=ve(B,2);_t(R,()=>ja,(A,N)=>{N(A,{children:(z,U)=>{var V=ze(),q=Te(V);_t(q,()=>Tu,(G,ne)=>{ne(G,{sideOffset:8,class:"tooltip-content",children:(te,Z)=>{var ae=Yt();Ge(_e=>Be(ae,_e),[()=>n()("keyboardButtonBar.upload_image_tooltip")]),Y(te,ae)},$$slots:{default:!0}})}),Y(z,V)},$$slots:{default:!0}})}),Y(M,F)},$$slots:{default:!0}})});var C=ve(b,2),P=ie(C);_t(P,()=>Eu,(T,O)=>{O(T,{delayDuration:500,children:(M,L)=>{var F=n2e(),B=Te(F);{const A=(N,z)=>{let U=()=>z?.().props;const V=oe(()=>{const{onclick:q,...G}=U();return{tooltipOnclick:q,restProps:G}});{let q=oe(()=>E(c)?"loading":""),G=oe(()=>!E(l)||E(o).sending||E(a)||!E(s)||E(o).completed),ne=oe(()=>n()("postComponent.post"));Lt(N,qn({variant:"primary",shape:"square",get className(){return`post-button ${E(q)??""}`},get disabled(){return E(G)},onClick:te=>{Tse(30),Ume(),typeof E(V).tooltipOnclick=="function"&&E(V).tooltipOnclick(te)},get ariaLabel(){return E(ne)}},()=>E(V).restProps,{children:(te,Z)=>{var ae=ze(),_e=Te(ae);{var de=Re=>{Ic(Re,{showLoader:!0,text:!1,customClass:"post-button-loading"})},Ee=Re=>{var je=t2e();Y(Re,je)};He(_e,Re=>{E(c)?Re(de):Re(Ee,!1)})}Y(te,ae)},$$slots:{default:!0}}))}};_t(B,()=>Cu,(N,z)=>{z(N,{child:A,$$slots:{child:!0}})})}var R=ve(B,2);_t(R,()=>ja,(A,N)=>{N(A,{children:(z,U)=>{var V=ze(),q=Te(V);_t(q,()=>Tu,(G,ne)=>{ne(G,{sideOffset:8,class:"tooltip-content",children:(te,Z)=>{var ae=Yt();Ge(_e=>Be(ae,_e),[()=>n()("keyboardButtonBar.post_tooltip")]),Y(te,ae)},$$slots:{default:!0}})}),Y(z,V)},$$slots:{default:!0}})}),Y(M,F)},$$slots:{default:!0}})});var S=ve(C,2),_=ie(S);_t(_,()=>Eu,(T,O)=>{O(T,{delayDuration:500,children:(M,L)=>{var F=i2e(),B=Te(F);{const A=(N,z)=>{let U=()=>z?.().props;const V=oe(()=>{const{onclick:q,...G}=U();return{tooltipOnclick:q,restProps:G}});{let q=oe(()=>n()("keyboardButtonBar.content_warning_toggle"));Lt(N,qn({variant:"footer",shape:"square",get selected(){return E(u)},onClick:G=>{d(),typeof E(V).tooltipOnclick=="function"&&E(V).tooltipOnclick(G)},get ariaLabel(){return E(q)}},()=>E(V).restProps,{children:(G,ne)=>{var te=r2e();Y(G,te)},$$slots:{default:!0}}))}};_t(B,()=>Cu,(N,z)=>{z(N,{child:A,$$slots:{child:!0}})})}var R=ve(B,2);_t(R,()=>ja,(A,N)=>{N(A,{children:(z,U)=>{var V=ze(),q=Te(V);_t(q,()=>Tu,(G,ne)=>{ne(G,{sideOffset:8,class:"tooltip-content",children:(te,Z)=>{var ae=Yt();Ge(_e=>Be(ae,_e),[()=>n()("keyboardButtonBar.content_warning_tooltip")]),Y(te,ae)},$$slots:{default:!0}})}),Y(z,V)},$$slots:{default:!0}})}),Y(M,F)},$$slots:{default:!0}})});var k=ve(_,2);_t(k,()=>Eu,(T,O)=>{O(T,{delayDuration:500,children:(M,L)=>{var F=l2e(),B=Te(F);{const A=(N,z)=>{let U=()=>z?.().props;const V=oe(()=>{const{onclick:q,...G}=U();return{tooltipOnclick:q,restProps:G}});{let q=oe(()=>n()("keyboardButtonBar.hashtag_pin_toggle"));Lt(N,qn({variant:"footer",shape:"square",get selected(){return E(f)},onClick:G=>{h(),typeof E(V).tooltipOnclick=="function"&&E(V).tooltipOnclick(G)},get ariaLabel(){return E(q)}},()=>E(V).restProps,{children:(G,ne)=>{var te=a2e(),Z=ve(ie(te),2);{var ae=de=>{var Ee=s2e();Y(de,Ee)},_e=de=>{var Ee=o2e();Y(de,Ee)};He(Z,de=>{E(f)?de(ae):de(_e,!1)})}Y(G,te)},$$slots:{default:!0}}))}};_t(B,()=>Cu,(N,z)=>{z(N,{child:A,$$slots:{child:!0}})})}var R=ve(B,2);_t(R,()=>ja,(A,N)=>{N(A,{children:(z,U)=>{var V=ze(),q=Te(V);_t(q,()=>Tu,(G,ne)=>{ne(G,{sideOffset:8,class:"tooltip-content",children:(te,Z)=>{var ae=Yt();Ge(_e=>Be(ae,_e),[()=>n()("keyboardButtonBar.hashtag_pin_tooltip")]),Y(te,ae)},$$slots:{default:!0}})}),Y(z,V)},$$slots:{default:!0}})}),Y(M,F)},$$slots:{default:!0}})}),Ge(()=>lc(g,`bottom: ${E(p)??""}px;`)),Y(t,g),vt(),i()}Mi(["mousedown","touchstart"]);var d2e=Ce('<div class="reason-input-container svelte-7w6hzc"><input id="content-warning-reason-input" type="text" class="reason-input svelte-7w6hzc"/></div>');function f2e(t,e){wt(e,!0);const n=()=>Qn(yr,"$_",r),[r,i]=ei();let s=oe(()=>Ku.value),o=oe(()=>Sf.value),a=oe(()=>E(s));nt(()=>{Q1e.set(E(a))});let l=oe(()=>ez.value+G1e);function c(h){const p=h.target;Sf.set(p.value)}var u=ze(),d=Te(u);{var f=h=>{var p=d2e(),m=ie(p);m.__change=c,m.__input=c,Ge((g,y)=>{lc(p,`bottom: ${E(l)??""}px;`),fn(m,"placeholder",g),fM(m,E(o)),fn(m,"aria-label",y)},[()=>n()("postComponent.content_warning_reason_placeholder"),()=>n()("postComponent.content_warning_reason_label")]),Y(h,p)};He(d,h=>{E(a)&&h(f)})}Y(t,u),vt(),i()}Mi(["change","input"]);class h2e{fileUploadManager;isProcessingSharedImage=!1;constructor(e){this.fileUploadManager=new OB(e),this.setupServiceWorkerListeners()}setupServiceWorkerListeners(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}handleServiceWorkerMessage(e){const{data:n,type:r}=e.data||{};r==="SHARED_IMAGE"&&n?.image&&wI(n.image,n.metadata)}checkIfOpenedFromShareInternal(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).get("shared")==="true"}async checkForSharedImageOnLaunch(){if(this.isProcessingSharedImage)return{success:!1,error:"æ¢ã«å¦çä¸­ã§ã"};if(!this.checkIfOpenedFromShareInternal())return{success:!1,error:"å±æçµç±ã§ã®èµ·åã§ã¯ããã¾ãã"};this.isProcessingSharedImage=!0;try{const e=await this.fileUploadManager.processSharedImageOnLaunch();return e.success&&e.data&&wI(e.data.image,e.data.metadata),e}finally{this.isProcessingSharedImage=!1}}async getSharedImageFromServiceWorker(){return await this.fileUploadManager.getSharedImageFromServiceWorker()}checkIfOpenedFromShare(){return this.fileUploadManager.checkIfOpenedFromShare()}isProcessing(){return this.isProcessingSharedImage}getSharedImageFile(){return sse()}getSharedImageMetadata(){return ose()}clearSharedImage(){nse()}}let U2=null;function p2e(){return U2||(U2=new h2e),U2}function f4(){return p2e().checkIfOpenedFromShare()}function m2e(){if(typeof window>"u"||!window.location)return null;const e=new URLSearchParams(window.location.search).get("content");if(!e)return null;try{const n=decodeURIComponent(e);return $6(n)}catch(n){return console.error("URLã¯ã¨ãªãã©ã¡ã¼ã¿ã®ãã³ã¼ãã«å¤±æ:",n),null}}function g2e(){if(typeof window>"u"||!window.location)return;const t=new URLSearchParams(window.location.search),e=[];let n=!1;if(t.has("content")){const i=t.get("content");(!i||i.trim()==="")&&(n=!0),t.delete("content"),n=!0}const r=[];if(t.forEach((i,s)=>{e.includes(s)||(r.push(s),n=!0)}),r.forEach(i=>t.delete(i)),n){const i=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",i)}}function y2e(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).has("content")}var b2e=Ce('<main class="svelte-1n46o8q"><div class="main-content svelte-1n46o8q"><!> <!></div> <!> <!> <!> <!> <!> <!> <!> <!> <!></main>');function w2e(t,e){wt(e,!0);const n=()=>Qn(ms,"$locale",s),r=()=>Qn(yr,"$_",s),i=()=>Qn(xT,"$swNeedRefresh",s),[s,o]=ei();let a=ye(""),l=ye("");const c=Zl.getPublicKeyState();nt(()=>{c.setNsec(E(l))}),nt(()=>{Cp.value&&(Q(l,""),Q(a,""))});let u=oe(()=>jr.value?.isAuthenticated??!1),d=oe(()=>jr.value?.isInitialized??!1),f=!1,h="";if(!f){const Ae=localStorage.getItem("nsec"),we=localStorage.getItem("__nostrlogin_nip46");if(!Ae){if(we)try{const We=JSON.parse(we);We?.pubkey&&(h=We.pubkey)}catch{}}f=!0}let p=ye(void 0),m,g=ye(!1),y=ye(void 0),b=ye(void 0),x=ye(!1);async function C(Ae){Q(p,AV({verifier:$W}),!0);const we=new Goe(E(p)),We=new Gie(E(p),{relayListUpdatedStore:{value:iS.value,set:et=>iS.set(et)}});m=new Zoe(E(p),We,we),use(We),await m.initializeRelays(Ae)}async function P(Ae){const we=await Zl.authenticateWithNostrLogin(Ae);if(!we.success){console.error("nostr-loginèªè¨¼å¤±æ:",we.error);return}if(we.pubkeyHex){Q(g,!0),Xs.set(!0),H1();try{await C();const We=await m.initializeForLogin(we.pubkeyHex);We&&(ic.set(We),jd.set(!0)),Xs.set(!1)}catch(We){console.error("nostr-loginèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",We),Xs.set(!1)}finally{Q(g,!1)}}}async function S(){const Ae=await Zl.authenticateWithNsec(E(l));if(!Ae.success){Q(a,Ae.error||"authentication_error",!0);return}Xs.set(!0),H1(),Q(a,"");try{if(Ae.pubkeyHex){const we=await m.initializeForLogin(Ae.pubkeyHex);we&&(ic.set(we),jd.set(!0)),Xs.set(!1)}else Xs.set(!1)}catch{Xs.set(!1)}}function _(){Q(x,!0),Zl.logout(),ic.set({name:"",picture:"",npub:"",nprofile:""}),jd.set(!1),E(y)?.resetPostContent&&E(y).resetPostContent(),pL(),Q(l,""),Q(a,"")}async function k(){Q(g,!0);try{await Zl.showNostrLoginDialog()}catch(Ae){Ae instanceof Error&&Ae.message==="Cancelled"||console.error("nostr-loginã§ã¨ã©ã¼:",Ae)}finally{Q(g,!1)}}nt(()=>{n()&&localStorage.setItem("locale",n())}),nt(()=>{const Ae=jr.value?.pubkey;Ae&&jr.value?.isAuthenticated&&m&&m.getRelayManager().loadRelayConfigForUI(Ae)});let T=ye(!1);const O=localStorage.getItem("sharedImageProcessed")==="1";Vs(()=>((async()=>{const we=localStorage.getItem("locale");if(we&&we!==n()&&ms.set(we),await Sq(),Q(T,!0),Zl.setNostrLoginHandler(P),f4()){const et=await zoe(),at=await Uoe();(!et.isReady||!et.hasController||!at)&&console.warn("Service Worker not ready for shared image processing:",et)}if((async()=>{try{const et=await Zl.initializeAuth();if(et.hasAuth&&et.pubkeyHex){await C(et.pubkeyHex);const at=await m.initializeForLogin(et.pubkeyHex);at&&(ic.set(at),jd.set(!0)),Xs.set(!1)}else await C(),Xs.set(!1)}catch(et){console.error("èªè¨¼åæåä¸­ã«ã¨ã©ã¼:",et),await C(),Xs.set(!1)}finally{Zl.markAuthInitialized()}})(),f4()&&!O)try{const et=await $oe();if(et?.image)Ur.file=et.image,Ur.metadata=et.metadata,Ur.received=!0,localStorage.setItem("sharedImageProcessed","1");else{console.warn("No shared image data received");const Pt=new URLSearchParams(window.location.search).get("error");Pt&&console.error("Shared image processing failed with error parameter:",{error:Pt,location:window.location.href})}}catch(et){console.error("å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼:",et)}if(localStorage.getItem("firstVisit")!=="1"?(Uh.set(!0),localStorage.setItem("firstVisit","1")):setTimeout(()=>{E(y)?.focusEditor()},300),y2e()){const et=m2e();et&&rse(et)}g2e()})(),_e=document.visibilityState==="hidden",document.addEventListener("visibilitychange",Ee),()=>{document.removeEventListener("visibilitychange",Ee)})),nt(()=>{Ur.received&&Ur.file&&E(y)&&(E(y).uploadFiles([Ur.file]),Ur.file=null,Ur.metadata=void 0,Ur.received=!1,localStorage.setItem("sharedImageProcessed","1"),setTimeout(()=>localStorage.removeItem("sharedImageProcessed"),500))}),nt(()=>{Uu.received&&Uu.content&&E(y)&&(E(y).insertTextContent(Uu.content),ise())});function M(Ae){lse.set(Ae)}function L(Ae){E(b)&&E(b).updateProgress(Ae)}function F(){E(b)?.reset&&E(b).reset(),localStorage.removeItem("sharedImageProcessed")}function B(){E(y)?.resetPostContent()}function R(){if(!E(y)?.getEditorHtml)return!1;const Ae=E(y).getEditorHtml();if(!Ae||Ae==="<p></p>")return!1;const we=qve(Ae);return we.needsConfirmation?(Fg.set(Ae),Dd.set(!0),!1):we.success}function A(){const Ae=Fg.value;Ae&&Kve(Ae),Fg.set(null),Dd.set(!1)}function N(){Fg.set(null),Dd.set(!1)}let z=ye(!1);nt(()=>{Q(z,Dd.value,!0)}),nt(()=>{!E(z)&&Dd.value&&Dd.set(!1)});function U(){Bg.set(!0)}function V(Ae){E(y)?.loadDraftContent(Ae)}let q=null;async function G(){if(!E(u)||!jr.value.pubkey)return;m||await C(jr.value.pubkey);const Ae=await m.refreshRelaysAndProfile(jr.value.pubkey);Ae&&(ic.set(Ae),jd.set(!0))}let ne=ye(!1),te=ye(null),Z=ye(!1);nt(()=>{r()&&!q&&(q=new Q$(r()))}),nt(()=>{E(T)&&q&&!E(ne)&&!E(Z)&&(ae(),Q(Z,!0))});function ae(){!q||E(ne)||(Q(te,q.createMessage("info"),!0),Q(ne,!0),q.scheduleHide(()=>{Q(ne,!1),Q(te,null)},3e3))}let _e=!1,de=0;function Ee(){const Ae=Date.now();if(Ae-de<1e3){_e=document.visibilityState==="hidden";return}document.visibilityState==="visible"&&_e&&E(T)&&q&&!E(ne)&&(ae(),de=Ae),_e=document.visibilityState==="hidden"}let Re=ye(Zt(localStorage.getItem("imageCompressionLevel")||"medium"));function je(Ae){Q(Re,Ae,!0)}let Ve=ye(Zt(localStorage.getItem("uploadEndpoint")||bT(n())));function Se(Ae){Q(Ve,Ae,!0)}nt(()=>()=>{q&&q.dispose()});var Me=ze(),Ne=Te(Me);{var Ke=Ae=>{var we=ze(),We=Te(we);_t(We,()=>DZ,(et,at)=>{at(et,{children:(Pt,Ot)=>{var Tt=b2e(),Mt=ie(Tt),Ft=ie(Mt);{let It=oe(()=>E(ne)&&E(te)?E(te):null);_1e(Ft,{onResetPostContent:B,onSaveDraft:R,onShowDraftList:U,get balloonMessage(){return E(It)}})}var En=ve(Ft,2);Ar(o0e(En,{get rxNostr(){return E(p)},get hasStoredKey(){return E(u)},onPostSuccess:F,onUploadStatusChange:M,onUploadProgress:L}),It=>Q(y,It,!0),()=>E(y));var Ut=ve(Mt,2);f2e(Ut,{});var Pn=ve(Ut,2);u2e(Pn,{onUploadImage:()=>E(y)?.openFileDialog()});var ln=ve(Pn,2);Ar(K1e(ln,{get isAuthenticated(){return E(u)},get isAuthInitialized(){return E(d)},get swNeedRefresh(){return i()},get onShowLoginDialog(){return dse},get onOpenSettingsDialog(){return pse},get onOpenLogoutDialog(){return fse}}),It=>Q(b,It,!0),()=>E(b));var $t=ve(ln,2);{var en=It=>{Vve(It,{get show(){return Cp.value},get onClose(){return H1},onSave:S,onNostrLogin:k,get isLoadingNostrLogin(){return E(g)},get secretKey(){return E(l)},set secretKey(Fn){Q(l,Fn,!0)}})};He($t,It=>{Cp.value&&It(en)})}var Tn=ve($t,2);{var Nn=It=>{Dve(It,{get show(){return Ty.value},get onClose(){return hse},onLogout:_,get isLoggingOut(){return E(x)}})};He(Tn,It=>{Ty.value&&It(Nn)})}var Xt=ve(Tn,2);{var jt=It=>{jve(It,{get show(){return Uh.value},onClose:()=>Uh.set(!1)})};He(Xt,It=>{Uh.value&&It(jt)})}var tn=ve(Xt,2);{var Qt=It=>{i1e(It,{get show(){return Bg.value},onClose:()=>Bg.set(!1),onApplyDraft:V})};He(tn,It=>{Bg.value&&It(Qt)})}var zn=ve(tn,2);{var yi=It=>{{let Fn=oe(()=>r()("common.confirm")),or=oe(()=>r()("draft.limit_reached")),bi=oe(()=>r()("common.ok")),ar=oe(()=>r()("common.cancel"));NB(It,{get title(){return E(Fn)},get description(){return E(or)},get confirmLabel(){return E(bi)},get cancelLabel(){return E(ar)},confirmVariant:"danger",onConfirm:A,onCancel:N,get open(){return E(z)},set open(er){Q(z,er,!0)}})}};He(zn,It=>{E(z)&&It(yi)})}var ys=ve(zn,2);Tve(ys,{get show(){return vT.value},get onClose(){return mse},onRefreshRelaysAndProfile:G,get selectedCompression(){return E(Re)},onSelectedCompressionChange:je,get selectedEndpoint(){return E(Ve)},onSelectedEndpointChange:Se,onOpenWelcomeDialog:()=>Uh.set(!0)}),Y(Pt,Tt)},$$slots:{default:!0}})}),Y(Ae,we)};He(Ne,Ae=>{n()&&E(T)&&Ae(Ke)})}Y(t,Me),vt(),o()}Rb(w2e,{target:document.getElementById("app")});
