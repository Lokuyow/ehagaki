(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const pA=!1;var mf=Array.isArray,HM=Array.prototype.indexOf,Nb=Array.from,Ld=Object.defineProperty,Zl=Object.getOwnPropertyDescriptor,gA=Object.getOwnPropertyDescriptors,mA=Object.prototype,FM=Array.prototype,dp=Object.getPrototypeOf,c2=Object.isExtensible;const xi=()=>{};function Pb(t){for(var e=0;e<t.length;e++)t[e]()}function zM(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}const ni=2,Rb=4,Db=8,Mc=16,io=32,bl=64,yA=128,Si=256,$d=512,ur=1024,_i=2048,wa=4096,Ri=8192,vl=16384,Bb=32768,yf=65536,u2=1<<17,jM=1<<18,bf=1<<19,VM=1<<20,J0=1<<21,Ub=1<<22,Ya=1<<23,qs=Symbol("$state"),qM=Symbol("legacy props"),WM=Symbol(""),Hb=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function KM(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Fb(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function GM(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function ZM(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function YM(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function JM(t){throw new Error("https://svelte.dev/e/effect_orphan")}function XM(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function QM(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function eL(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function tL(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function nL(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const hp=1,pp=2,bA=4,rL=8,iL=16,sL=1,oL=4,aL=8,lL=16,cL=1,uL=2,Mn=Symbol(),fL="http://www.w3.org/1999/xhtml",dL="http://www.w3.org/2000/svg",hL="@attach";function pL(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let gL=!1;function vA(t){return t===this.v}function zb(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function wA(t){return!zb(t,this.v)}let mL=!1;const yL=[];function bL(t,e=!1,n=!1){return yd(t,new Map,"",yL,null,n)}function yd(t,e,n,r,i=null,s=!1){if(typeof t=="object"&&t!==null){var o=e.get(t);if(o!==void 0)return o;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(mf(t)){var a=Array(t.length);e.set(t,a),i!==null&&e.set(i,a);for(var l=0;l<t.length;l+=1){var c=t[l];l in t&&(a[l]=yd(c,e,n,r,null,s))}return a}if(dp(t)===mA){a={},e.set(t,a),i!==null&&e.set(i,a);for(var u in t)a[u]=yd(t[u],e,n,r,null,s);return a}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return yd(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let pr=null;function Nd(t){pr=t}function vL(t){return wL().get(t)}function un(t,e=!1,n){pr={p:pr,c:null,e:null,s:t,x:null,l:null}}function fn(t){var e=pr,n=e.e;if(n!==null){e.e=null;for(var r of n)DA(r)}return t!==void 0&&(e.x=t),pr=e.p,t??{}}function EA(){return!0}function wL(t){return pr===null&&Fb(),pr.c??=new Map(EL(pr)||void 0)}function EL(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}const xL=new WeakMap;function SL(t){var e=Ct;if(e===null)return Ot.f|=Ya,t;if((e.f&Bb)===0){if((e.f&yA)===0)throw!e.parent&&t instanceof Error&&xA(t),t;e.b.error(t)}else jb(t,e)}function jb(t,e){for(;e!==null;){if((e.f&yA)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t instanceof Error&&xA(t),t}function xA(t){const e=xL.get(t);e&&(Ld(t,"message",{value:e.message}),Ld(t,"stack",{value:e.stack}))}let Fu=[],X0=[];function SA(){var t=Fu;Fu=[],Pb(t)}function AL(){var t=X0;X0=[],Pb(t)}function gp(t){Fu.length===0&&queueMicrotask(SA),Fu.push(t)}function _L(){Fu.length>0&&SA(),X0.length>0&&AL()}function kL(){for(var t=Ct.b;t!==null&&!t.has_pending_snippet();)t=t.parent;return t===null&&KM(),t}function mp(t){var e=ni|_i,n=Ot!==null&&(Ot.f&ni)!==0?Ot:null;return Ct===null||n!==null&&(n.f&Si)!==0?e|=Si:Ct.f|=bf,{ctx:pr,deps:null,effects:null,equals:vA,f:e,fn:t,reactions:null,rv:0,v:Mn,wv:0,parent:n??Ct,ac:null}}function CL(t,e){let n=Ct;n===null&&GM();var r=n.b,i=void 0,s=lc(Mn),o=null,a=!Ot;return HL(()=>{try{var l=t();o&&Promise.resolve(l).catch(()=>{})}catch(h){l=Promise.reject(h)}var c=()=>l;i=o?.then(c,c)??Promise.resolve(l),o=i;var u=Yt,f=r.pending;a&&(r.update_pending_count(1),f||u.increment());const d=(h,p=void 0)=>{o=null,f||u.activate(),p?p!==Hb&&(s.f|=Ya,zu(s,p)):((s.f&Ya)!==0&&(s.f^=Ya),zu(s,h)),a&&(r.update_pending_count(-1),f||u.decrement()),TA()};if(i.then(d,h=>d(null,h||"unknown")),u)return()=>{queueMicrotask(()=>u.neuter())}}),new Promise(l=>{function c(u){function f(){u===i?l(s):c(i)}u.then(f,f)}c(i)})}function Qe(t){const e=mp(t);return jA(e),e}function AA(t){const e=mp(t);return e.equals=wA,e}function _A(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)qr(e[n])}}function TL(t){for(var e=t.parent;e!==null;){if((e.f&ni)===0)return e;e=e.parent}return null}function Vb(t){var e,n=Ct;ca(TL(t));try{_A(t),e=KA(t)}finally{ca(n)}return e}function kA(t){var e=Vb(t);if(t.equals(e)||(t.v=e,t.wv=qA()),!El){var n=(qo||(t.f&Si)!==0)&&t.deps!==null?wa:ur;Hr(t,n)}}function CA(t,e,n){const r=mp;if(e.length===0){n(t.map(r));return}var i=Yt,s=Ct,o=IL(),a=kL();Promise.all(e.map(l=>CL(l))).then(l=>{i?.activate(),o();try{n([...t.map(r),...l])}catch(c){(s.f&vl)===0&&jb(c,s)}i?.deactivate(),TA()}).catch(l=>{a.error(l)})}function IL(){var t=Ct,e=Ot,n=pr,r=Yt;return function(){ca(t),ps(e),Nd(n),r?.activate()}}function TA(){ca(null),ps(null),Nd(null)}const nm=new Set;let Yt=null,bd=null,f2=new Set,Pd=[];function IA(){const t=Pd.shift();Pd.length>0&&queueMicrotask(IA),t()}let sl=[],yp=null,Q0=!1,vd=!1;class oc{current=new Map;#e=new Map;#t=new Set;#n=0;#s=null;#r=!1;#o=[];#i=[];#a=[];#l=[];#u=[];#c=[];#f=[];skipped_effects=new Set;process(e){sl=[],bd=null;for(const i of e)this.#m(i);if(this.#o.length===0&&this.#n===0){this.#h();var n=this.#a,r=this.#l;this.#a=[],this.#l=[],this.#u=[],bd=Yt,Yt=null,d2(n),d2(r),Yt===null?Yt=this:nm.delete(this),this.#s?.resolve()}else this.#d(this.#a),this.#d(this.#l),this.#d(this.#u);for(const i of this.#o)Jl(i);for(const i of this.#i)Jl(i);this.#o=[],this.#i=[]}#m(e){e.f^=ur;for(var n=e.first;n!==null;){var r=n.f,i=(r&(io|bl))!==0,s=i&&(r&ur)!==0,o=s||(r&Ri)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){if(i)n.f^=ur;else if((r&Rb)!==0)this.#l.push(n);else if((r&ur)===0)if((r&Ub)!==0){var a=n.b?.pending?this.#i:this.#o;a.push(n)}else Sp(n)&&((n.f&Mc)!==0&&this.#u.push(n),Jl(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)n=c.next,c=c.parent}}#d(e){for(const n of e)((n.f&_i)!==0?this.#c:this.#f).push(n),Hr(n,ur);e.length=0}capture(e,n){this.#e.has(e)||this.#e.set(e,n),this.current.set(e,e.v)}activate(){Yt=this}deactivate(){Yt=null,bd=null;for(const e of f2)if(f2.delete(e),e(),Yt!==null)break}neuter(){this.#r=!0}flush(){sl.length>0?OA():this.#h(),Yt===this&&(this.#n===0&&nm.delete(this),this.deactivate())}#h(){if(!this.#r)for(const e of this.#t)e();this.#t.clear()}increment(){this.#n+=1}decrement(){if(this.#n-=1,this.#n===0){for(const e of this.#c)Hr(e,_i),ac(e);for(const e of this.#f)Hr(e,wa),ac(e);this.#a=[],this.#l=[],this.flush()}else this.deactivate()}add_callback(e){this.#t.add(e)}settled(){return(this.#s??=zM()).promise}static ensure(){if(Yt===null){const e=Yt=new oc;nm.add(Yt),vd||oc.enqueue(()=>{Yt===e&&e.flush()})}return Yt}static enqueue(e){Pd.length===0&&queueMicrotask(IA),Pd.unshift(e)}}function OL(t){var e=vd;vd=!0;try{for(var n;;){if(_L(),sl.length===0&&(Yt?.flush(),sl.length===0))return yp=null,n;OA()}}finally{vd=e}}function OA(){var t=Yl;Q0=!0;try{var e=0;for(m2(!0);sl.length>0;){var n=oc.ensure();if(e++>1e3){var r,i;ML()}n.process(sl),Qo.clear()}}finally{Q0=!1,m2(t),yp=null}}function ML(){try{XM()}catch(t){jb(t,yp)}}let Ra=null;function d2(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(vl|Ri))===0&&Sp(r)&&(Ra=[],Jl(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?HA(r):r.fn=null),Ra?.length>0)){Qo.clear();for(const i of Ra)Jl(i);Ra=[]}}Ra=null}}function ac(t){for(var e=yp=t;e.parent!==null;){e=e.parent;var n=e.f;if(Q0&&e===Ct&&(n&Mc)!==0)return;if((n&(bl|io))!==0){if((n&ur)===0)return;e.f^=ur}}sl.push(e)}const Qo=new Map;function lc(t,e){var n={f:0,v:t,reactions:null,equals:vA,rv:0,wv:0};return n}function Se(t,e){const n=lc(t);return jA(n),n}function MA(t,e=!1,n=!0){const r=lc(t);return e||(r.equals=wA),r}function se(t,e,n=!1){Ot!==null&&(!ts||(Ot.f&u2)!==0)&&EA()&&(Ot.f&(ni|Mc|Ub|u2))!==0&&!Ws?.includes(t)&&nL();let r=n?Et(e):e;return zu(t,r)}function zu(t,e){if(!t.equals(e)){var n=t.v;El?Qo.set(t,e):Qo.set(t,n),t.v=e;var r=oc.ensure();r.capture(t,n),(t.f&ni)!==0&&((t.f&_i)!==0&&Vb(t),Hr(t,(t.f&Si)===0?ur:wa)),t.wv=qA(),LA(t,_i),Ct!==null&&(Ct.f&ur)!==0&&(Ct.f&(io|bl))===0&&(hi===null?jL([t]):hi.push(t))}return e}function Fo(t){se(t,t.v+1)}function LA(t,e){var n=t.reactions;if(n!==null)for(var r=n.length,i=0;i<r;i++){var s=n[i],o=s.f,a=(o&_i)===0;a&&Hr(s,e),(o&ni)!==0?LA(s,wa):a&&((o&Mc)!==0&&Ra!==null&&Ra.push(s),ac(s))}}function Et(t){if(typeof t!="object"||t===null||qs in t)return t;const e=dp(t);if(e!==mA&&e!==FM)return t;var n=new Map,r=mf(t),i=Se(0),s=Ks,o=a=>{if(Ks===s)return a();var l=Ot,c=Ks;ps(null),b2(s);var u=a();return ps(l),b2(c),u};return r&&n.set("length",Se(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&eL();var u=n.get(l);return u===void 0?u=o(()=>{var f=Se(c.value);return n.set(l,f),f}):se(u,c.value,!0),!0},deleteProperty(a,l){var c=n.get(l);if(c===void 0){if(l in a){const u=o(()=>Se(Mn));n.set(l,u),Fo(i)}}else se(c,Mn),Fo(i);return!0},get(a,l,c){if(l===qs)return t;var u=n.get(l),f=l in a;if(u===void 0&&(!f||Zl(a,l)?.writable)&&(u=o(()=>{var h=Et(f?a[l]:Mn),p=Se(h);return p}),n.set(l,u)),u!==void 0){var d=$(u);return d===Mn?void 0:d}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=$(u))}else if(c===void 0){var f=n.get(l),d=f?.v;if(f!==void 0&&d!==Mn)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return c},has(a,l){if(l===qs)return!0;var c=n.get(l),u=c!==void 0&&c.v!==Mn||Reflect.has(a,l);if(c!==void 0||Ct!==null&&(!u||Zl(a,l)?.writable)){c===void 0&&(c=o(()=>{var d=u?Et(a[l]):Mn,h=Se(d);return h}),n.set(l,c));var f=$(c);if(f===Mn)return!1}return u},set(a,l,c,u){var f=n.get(l),d=l in a;if(r&&l==="length")for(var h=c;h<f.v;h+=1){var p=n.get(h+"");p!==void 0?se(p,Mn):h in a&&(p=o(()=>Se(Mn)),n.set(h+"",p))}if(f===void 0)(!d||Zl(a,l)?.writable)&&(f=o(()=>Se(void 0)),se(f,Et(c)),n.set(l,f));else{d=f.v!==Mn;var g=o(()=>Et(c));se(f,g)}var m=Reflect.getOwnPropertyDescriptor(a,l);if(m?.set&&m.set.call(u,c),!d){if(r&&typeof l=="string"){var v=n.get("length"),x=Number(l);Number.isInteger(x)&&x>=v.v&&se(v,x+1)}Fo(i)}return!0},ownKeys(a){$(i);var l=Reflect.ownKeys(a).filter(f=>{var d=n.get(f);return d===void 0||d.v!==Mn});for(var[c,u]of n)u.v!==Mn&&!(c in a)&&l.push(c);return l},setPrototypeOf(){tL()}})}function h2(t){try{if(t!==null&&typeof t=="object"&&qs in t)return t[qs]}catch{}return t}function LL(t,e){return Object.is(h2(t),h2(e))}var p2,$A,NA,PA;function $L(){if(p2===void 0){p2=window,$A=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;NA=Zl(e,"firstChild").get,PA=Zl(e,"nextSibling").get,c2(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),c2(n)&&(n.__t=void 0)}}function wl(t=""){return document.createTextNode(t)}function Rd(t){return NA.call(t)}function bp(t){return PA.call(t)}function pe(t,e){return Rd(t)}function vt(t,e){{var n=Rd(t);return n instanceof Comment&&n.data===""?bp(n):n}}function Me(t,e=1,n=!1){let r=t;for(;e--;)r=bp(r);return r}function NL(t){t.textContent=""}function RA(){return!1}function PL(t,e){if(e){const n=document.body;t.autofocus=!0,gp(()=>{document.activeElement===n&&t.focus()})}}let g2=!1;function RL(){g2||(g2=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function vp(t){var e=Ot,n=Ct;ps(null),ca(null);try{return t()}finally{ps(e),ca(n)}}function qb(t,e,n,r=n){t.addEventListener(e,()=>vp(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),RL()}function DL(t){Ct===null&&Ot===null&&JM(),Ot!==null&&(Ot.f&Si)!==0&&Ct===null&&YM(),El&&ZM()}function BL(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function so(t,e,n,r=!0){var i=Ct;i!==null&&(i.f&Ri)!==0&&(t|=Ri);var s={ctx:pr,deps:null,nodes_start:null,nodes_end:null,f:t|_i,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Jl(s),s.f|=Bb}catch(l){throw qr(s),l}else e!==null&&ac(s);if(r){var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes_start===null&&o.first===o.last&&(o.f&bf)===0&&(o=o.first),o!==null&&(o.parent=i,i!==null&&BL(o,i),Ot!==null&&(Ot.f&ni)!==0&&(t&bl)===0)){var a=Ot;(a.effects??=[]).push(o)}}return s}function Wb(t){const e=so(Db,null,!1);return Hr(e,ur),e.teardown=t,e}function qe(t){DL();var e=Ct.f,n=!Ot&&(e&io)!==0&&(e&Bb)===0;if(n){var r=pr;(r.e??=[]).push(t)}else return DA(t)}function DA(t){return so(Rb|VM,t,!1)}function UL(t){oc.ensure();const e=so(bl|bf,t,!0);return(n={})=>new Promise(r=>{n.outro?Ep(e,()=>{qr(e),r(void 0)}):(qr(e),r(void 0))})}function vf(t){return so(Rb,t,!1)}function HL(t){return so(Ub|bf,t,!0)}function wp(t,e=0){return so(Db|e,t,!0)}function Je(t,e=[],n=[]){CA(e,n,r=>{so(Db,()=>t(...r.map($)),!0)})}function Lc(t,e=0){var n=so(Mc|e,t,!0);return n}function to(t,e=!0){return so(io|bf,t,!0,e)}function BA(t){var e=t.teardown;if(e!==null){const n=El,r=Ot;y2(!0),ps(null);try{e.call(null)}finally{y2(n),ps(r)}}}function UA(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&vp(()=>{i.abort(Hb)});var r=n.next;(n.f&bl)!==0?n.parent=null:qr(n,e),n=r}}function FL(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&io)===0&&qr(e),e=n}}function qr(t,e=!0){var n=!1;(e||(t.f&jM)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(zL(t.nodes_start,t.nodes_end),n=!0),UA(t,e&&!n),Dd(t,0),Hr(t,vl);var r=t.transitions;if(r!==null)for(const s of r)s.stop();BA(t);var i=t.parent;i!==null&&i.first!==null&&HA(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function zL(t,e){for(;t!==null;){var n=t===e?null:bp(t);t.remove(),t=n}}function HA(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Ep(t,e){var n=[];Kb(t,n,!0),FA(n,()=>{qr(t),e&&e()})}function FA(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var i of t)i.out(r)}else e()}function Kb(t,e,n){if((t.f&Ri)===0){if(t.f^=Ri,t.transitions!==null)for(const o of t.transitions)(o.is_global||n)&&e.push(o);for(var r=t.first;r!==null;){var i=r.next,s=(r.f&yf)!==0||(r.f&io)!==0;Kb(r,e,s?n:!1),r=i}}}function xp(t){zA(t,!0)}function zA(t,e){if((t.f&Ri)!==0){t.f^=Ri,(t.f&ur)===0&&(Hr(t,_i),ac(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&yf)!==0||(n.f&io)!==0;zA(n,i?e:!1),n=r}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}let Yl=!1;function m2(t){Yl=t}let El=!1;function y2(t){El=t}let Ot=null,ts=!1;function ps(t){Ot=t}let Ct=null;function ca(t){Ct=t}let Ws=null;function jA(t){Ot!==null&&(Ws===null?Ws=[t]:Ws.push(t))}let xr=null,Jr=0,hi=null;function jL(t){hi=t}let VA=1,ju=0,Ks=ju;function b2(t){Ks=t}let qo=!1;function qA(){return++VA}function Sp(t){var e=t.f;if((e&_i)!==0)return!0;if((e&wa)!==0){var n=t.deps,r=(e&Si)!==0;if(n!==null){var i,s,o=(e&$d)!==0,a=r&&Ct!==null&&!qo,l=n.length;if((o||a)&&(Ct===null||(Ct.f&vl)===0)){var c=t,u=c.parent;for(i=0;i<l;i++)s=n[i],(o||!s?.reactions?.includes(c))&&(s.reactions??=[]).push(c);o&&(c.f^=$d),a&&u!==null&&(u.f&Si)===0&&(c.f^=Si)}for(i=0;i<l;i++)if(s=n[i],Sp(s)&&kA(s),s.wv>t.wv)return!0}(!r||Ct!==null&&!qo)&&Hr(t,ur)}return!1}function WA(t,e,n=!0){var r=t.reactions;if(r!==null&&!Ws?.includes(t))for(var i=0;i<r.length;i++){var s=r[i];(s.f&ni)!==0?WA(s,e,!1):e===s&&(n?Hr(s,_i):(s.f&ur)!==0&&Hr(s,wa),ac(s))}}function KA(t){var e=xr,n=Jr,r=hi,i=Ot,s=qo,o=Ws,a=pr,l=ts,c=Ks,u=t.f;xr=null,Jr=0,hi=null,qo=(u&Si)!==0&&(ts||!Yl||Ot===null),Ot=(u&(io|bl))===0?t:null,Ws=null,Nd(t.ctx),ts=!1,Ks=++ju,t.ac!==null&&(vp(()=>{t.ac.abort(Hb)}),t.ac=null);try{t.f|=J0;var f=t.fn,d=f(),h=t.deps;if(xr!==null){var p;if(Dd(t,Jr),h!==null&&Jr>0)for(h.length=Jr+xr.length,p=0;p<xr.length;p++)h[Jr+p]=xr[p];else t.deps=h=xr;if(!qo||(u&ni)!==0&&t.reactions!==null)for(p=Jr;p<h.length;p++)(h[p].reactions??=[]).push(t)}else h!==null&&Jr<h.length&&(Dd(t,Jr),h.length=Jr);if(EA()&&hi!==null&&!ts&&h!==null&&(t.f&(ni|wa|_i))===0)for(p=0;p<hi.length;p++)WA(hi[p],t);return i!==null&&i!==t&&(ju++,hi!==null&&(r===null?r=hi:r.push(...hi))),(t.f&Ya)!==0&&(t.f^=Ya),d}catch(g){return SL(g)}finally{t.f^=J0,xr=e,Jr=n,hi=r,Ot=i,qo=s,Ws=o,Nd(a),ts=l,Ks=c}}function VL(t,e){let n=e.reactions;if(n!==null){var r=HM.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}n===null&&(e.f&ni)!==0&&(xr===null||!xr.includes(e))&&(Hr(e,wa),(e.f&(Si|$d))===0&&(e.f^=$d),_A(e),Dd(e,0))}function Dd(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)VL(t,n[r])}function Jl(t){var e=t.f;if((e&vl)===0){Hr(t,ur);var n=Ct,r=Yl;Ct=t,Yl=!0;try{(e&Mc)!==0?FL(t):UA(t),BA(t);var i=KA(t);t.teardown=typeof i=="function"?i:null,t.wv=VA;var s;pA&&mL&&(t.f&_i)!==0&&t.deps}finally{Yl=r,Ct=n}}}async function ua(){await Promise.resolve(),OL()}function $(t){var e=t.f,n=(e&ni)!==0;if(Ot!==null&&!ts){var r=Ct!==null&&(Ct.f&vl)!==0;if(!r&&!Ws?.includes(t)){var i=Ot.deps;if((Ot.f&J0)!==0)t.rv<ju&&(t.rv=ju,xr===null&&i!==null&&i[Jr]===t?Jr++:xr===null?xr=[t]:(!qo||!xr.includes(t))&&xr.push(t));else{(Ot.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[Ot]:s.includes(Ot)||s.push(Ot)}}}else if(n&&t.deps===null&&t.effects===null){var o=t,a=o.parent;a!==null&&(a.f&Si)===0&&(o.f^=Si)}if(El){if(Qo.has(t))return Qo.get(t);if(n){o=t;var l=o.v;return((o.f&ur)===0&&o.reactions!==null||GA(o))&&(l=Vb(o)),Qo.set(o,l),l}}else n&&(o=t,Sp(o)&&kA(o));if((t.f&Ya)!==0)throw t.v;return t.v}function GA(t){if(t.v===Mn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(Qo.has(e)||(e.f&ni)!==0&&GA(e))return!0;return!1}function Ea(t){var e=ts;try{return ts=!0,t()}finally{ts=e}}const qL=-7169;function Hr(t,e){t.f=t.f&qL|e}function WL(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(qs in t)ey(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&qs in n&&ey(n)}}}function ey(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{ey(t[r],e)}catch{}const n=dp(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=gA(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}function KL(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const GL=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function ZL(t){return GL.includes(t)}const YL={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function JL(t){return t=t.toLowerCase(),YL[t]??t}const XL=["touchstart","touchmove"];function QL(t){return XL.includes(t)}const ZA=new Set,ty=new Set;function YA(t,e,n,r={}){function i(s){if(r.capture||fu.call(e,s),!s.cancelBubble)return vp(()=>n?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?gp(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function Ni(t,e,n,r,i){var s={capture:r,passive:i},o=YA(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Wb(()=>{e.removeEventListener(t,o,s)})}function Ci(t){for(var e=0;e<t.length;e++)ZA.add(t[e]);for(var n of ty)n(t)}let v2=null;function fu(t){var e=this,n=e.ownerDocument,r=t.type,i=t.composedPath?.()||[],s=i[0]||t.target;v2=t;var o=0,a=v2===t&&t.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=i.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=i[o]||t.target,s!==e){Ld(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=Ot,f=Ct;ps(null),ca(null);try{for(var d,h=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var g=s["__"+r];if(g!=null&&(!s.disabled||t.target===s))if(mf(g)){var[m,...v]=g;m.apply(s,[t,...v])}else g.call(s,t)}catch(x){d?h.push(x):d=x}if(t.cancelBubble||p===e||p===null)break;s=p}if(d){for(let x of h)queueMicrotask(()=>{throw x});throw d}}finally{t.__root=e,delete t.currentTarget,ps(u),ca(f)}}}function e$(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Vu(t,e){var n=Ct;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function je(t,e){var n=(e&cL)!==0,r=(e&uL)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=e$(s?t:"<!>"+t),n||(i=Rd(i)));var o=r||$A?document.importNode(i,!0):i.cloneNode(!0);if(n){var a=Rd(o),l=o.lastChild;Vu(a,l)}else Vu(o,o);return o}}function Wn(t=""){{var e=wl(t+"");return Vu(e,e),e}}function Xt(){var t=document.createDocumentFragment(),e=document.createComment(""),n=wl();return t.append(e,n),Vu(e,n),t}function we(t,e){t!==null&&t.before(e)}function Ye(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function JA(t,e){return t$(t,e)}const Ol=new Map;function t$(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:o=!0}){$L();var a=new Set,l=f=>{for(var d=0;d<f.length;d++){var h=f[d];if(!a.has(h)){a.add(h);var p=QL(h);e.addEventListener(h,fu,{passive:p});var g=Ol.get(h);g===void 0?(document.addEventListener(h,fu,{passive:p}),Ol.set(h,1)):Ol.set(h,g+1)}}};l(Nb(ZA)),ty.add(l);var c=void 0,u=UL(()=>{var f=n??e.appendChild(wl());return to(()=>{if(s){un({});var d=pr;d.c=s}i&&(r.$$events=i),c=t(f,r)||{},s&&fn()}),()=>{for(var d of a){e.removeEventListener(d,fu);var h=Ol.get(d);--h===0?(document.removeEventListener(d,fu),Ol.delete(d)):Ol.set(d,h)}ty.delete(l),f!==n&&f.parentNode?.removeChild(f)}});return ny.set(c,u),c}let ny=new WeakMap;function n$(t,e){const n=ny.get(t);return n?(ny.delete(t),n(e)):Promise.resolve()}function rt(t,e,n=!1){var r=t,i=null,s=null,o=Mn,a=n?yf:0,l=!1;const c=(h,p=!0)=>{l=!0,d(p,h)};var u=null;function f(){u!==null&&(u.lastChild.remove(),r.before(u),u=null);var h=o?i:s,p=o?s:i;h&&xp(h),p&&Ep(p,()=>{o?s=null:i=null})}const d=(h,p)=>{if(o!==(o=h)){var g=RA(),m=r;if(g&&(u=document.createDocumentFragment(),u.append(m=wl())),o?i??=p&&to(()=>p(m)):s??=p&&to(()=>p(m)),g){var v=Yt,x=o?i:s,C=o?s:i;x&&v.skipped_effects.delete(x),C&&v.skipped_effects.add(C),v.add_callback(f)}else f()}};Lc(()=>{l=!1,e(c),l||d(null,null)},a)}function du(t,e){return e}function r$(t,e,n){for(var r=t.items,i=[],s=e.length,o=0;o<s;o++)Kb(e[o].e,i,!0);var a=s>0&&i.length===0&&n!==null;if(a){var l=n.parentNode;NL(l),l.append(n),r.clear(),Yi(t,e[0].prev,e[s-1].next)}FA(i,()=>{for(var c=0;c<s;c++){var u=e[c];a||(r.delete(u.k),Yi(t,u.prev,u.next)),qr(u.e,!a)}})}function Hl(t,e,n,r,i,s=null){var o=t,a={flags:e,items:new Map,first:null},l=(e&bA)!==0;if(l){var c=t;o=c.appendChild(wl())}var u=null,f=!1,d=new Map,h=AA(()=>{var v=n();return mf(v)?v:v==null?[]:Nb(v)}),p,g;function m(){i$(g,p,a,d,o,i,e,r,n),s!==null&&(p.length===0?u?xp(u):u=to(()=>s(o)):u!==null&&Ep(u,()=>{u=null}))}Lc(()=>{g??=Ct,p=$(h);var v=p.length;if(!(f&&v===0)){f=v===0;var x,C,N,O;if(RA()){var A=new Set,P=Yt;for(C=0;C<v;C+=1){N=p[C],O=r(N,C);var S=a.items.get(O)??d.get(O);S?(e&(hp|pp))!==0&&XA(S,N,C,e):(x=QA(null,a,null,null,N,O,C,i,e,n,!0),d.set(O,x)),A.add(O)}for(const[E,_]of a.items)A.has(E)||P.skipped_effects.add(_.e);P.add_callback(m)}else m();$(h)}})}function i$(t,e,n,r,i,s,o,a,l){var c=(o&rL)!==0,u=(o&(hp|pp))!==0,f=e.length,d=n.items,h=n.first,p=h,g,m=null,v,x=[],C=[],N,O,A,P;if(c)for(P=0;P<f;P+=1)N=e[P],O=a(N,P),A=d.get(O),A!==void 0&&(A.a?.measure(),(v??=new Set).add(A));for(P=0;P<f;P+=1){if(N=e[P],O=a(N,P),A=d.get(O),A===void 0){var S=r.get(O);if(S!==void 0){r.delete(O),d.set(O,S);var E=m?m.next:p;Yi(n,m,S),Yi(n,S,E),rm(S,E,i),m=S}else{var _=p?p.e.nodes_start:i;m=QA(_,n,m,m===null?n.first:m.next,N,O,P,s,o,l)}d.set(O,m),x=[],C=[],p=m.next;continue}if(u&&XA(A,N,P,o),(A.e.f&Ri)!==0&&(xp(A.e),c&&(A.a?.unfix(),(v??=new Set).delete(A))),A!==p){if(g!==void 0&&g.has(A)){if(x.length<C.length){var k=C[0],D;m=k.prev;var U=x[0],B=x[x.length-1];for(D=0;D<x.length;D+=1)rm(x[D],k,i);for(D=0;D<C.length;D+=1)g.delete(C[D]);Yi(n,U.prev,B.next),Yi(n,m,U),Yi(n,B,k),p=k,m=B,P-=1,x=[],C=[]}else g.delete(A),rm(A,p,i),Yi(n,A.prev,A.next),Yi(n,A,m===null?n.first:m.next),Yi(n,m,A),m=A;continue}for(x=[],C=[];p!==null&&p.k!==O;)(p.e.f&Ri)===0&&(g??=new Set).add(p),C.push(p),p=p.next;if(p===null)continue;A=p}x.push(A),m=A,p=A.next}if(p!==null||g!==void 0){for(var M=g===void 0?[]:Nb(g);p!==null;)(p.e.f&Ri)===0&&M.push(p),p=p.next;var T=M.length;if(T>0){var L=(o&bA)!==0&&f===0?i:null;if(c){for(P=0;P<T;P+=1)M[P].a?.measure();for(P=0;P<T;P+=1)M[P].a?.fix()}r$(n,M,L)}}c&&gp(()=>{if(v!==void 0)for(A of v)A.a?.apply()}),t.first=n.first&&n.first.e,t.last=m&&m.e;for(var q of r.values())qr(q.e);r.clear()}function XA(t,e,n,r){(r&hp)!==0&&zu(t.v,e),(r&pp)!==0?zu(t.i,n):t.i=n}function QA(t,e,n,r,i,s,o,a,l,c,u){var f=(l&hp)!==0,d=(l&iL)===0,h=f?d?MA(i,!1,!1):lc(i):i,p=(l&pp)===0?o:lc(o),g={i:p,v:h,k:s,a:null,e:null,prev:n,next:r};try{if(t===null){var m=document.createDocumentFragment();m.append(t=wl())}return g.e=to(()=>a(t,h,p,c),gL),g.e.prev=n&&n.e,g.e.next=r&&r.e,n===null?u||(e.first=g):(n.next=g,n.e.next=g.e),r!==null&&(r.prev=g,r.e.prev=g.e),g}finally{}}function rm(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==null&&s!==r;){var o=bp(s);i.before(s),s=o}}function Yi(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function cc(t,e,...n){var r=t,i=xi,s;Lc(()=>{i!==(i=e())&&(s&&(qr(s),s=null),s=to(()=>i(r,...n)))},yf)}function s$(t,e,n,r,i,s){var o,a,l=null,c=t,u;Lc(()=>{const f=e()||null;var d=f==="svg"?dL:null;f!==o&&(u&&(f===null?Ep(u,()=>{u=null,a=null}):f===a?xp(u):qr(u)),f&&f!==a&&(u=to(()=>{if(l=d?document.createElementNS(d,f):document.createElement(f),Vu(l,l),r){var h=l.appendChild(wl());r(l,h)}Ct.nodes_end=l,c.before(l)})),o=f,o&&(a=o))},yf)}function Yf(t,e,n){vf(()=>{var r=Ea(()=>e(t,n?.())||{});if(n&&r?.update){var i=!1,s={};wp(()=>{var o=n();WL(o),i&&zb(s,o)&&(s=o,r.update(o))}),i=!0}if(r?.destroy)return()=>r.destroy()})}function o$(t,e){var n=void 0,r;Lc(()=>{n!==(n=e())&&(r&&(qr(r),r=null),n&&(r=to(()=>{vf(()=>n(t))})))})}function e_(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=e_(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function a$(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=e_(t))&&(r&&(r+=" "),r+=e);return r}function t_(t){return typeof t=="object"?a$(t):t??""}const w2=[...` 	
\r\f \v\uFEFF`];function l$(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,o=0;(o=r.indexOf(i,o))>=0;){var a=o+s;(o===0||w2.includes(r[o-1]))&&(a===r.length||w2.includes(r[a]))?r=(o===0?"":r.substring(0,o))+r.substring(a+1):o=a}}return r===""?null:r}function E2(t,e=!1){var n=e?" !important;":";",r="";for(var i in t){var s=t[i];s!=null&&s!==""&&(r+=" "+i+": "+s+n)}return r}function im(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function c$(t,e){if(e){var n="",r,i;if(Array.isArray(e)?(r=e[0],i=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,o=0,a=!1,l=[];r&&l.push(...Object.keys(r).map(im)),i&&l.push(...Object.keys(i).map(im));var c=0,u=-1;const g=t.length;for(var f=0;f<g;f++){var d=t[f];if(a?d==="/"&&t[f-1]==="*"&&(a=!1):s?s===d&&(s=!1):d==="/"&&t[f+1]==="*"?a=!0:d==='"'||d==="'"?s=d:d==="("?o++:d===")"&&o--,!a&&s===!1&&o===0){if(d===":"&&u===-1)u=f;else if(d===";"||f===g-1){if(u!==-1){var h=im(t.substring(c,u).trim());if(!l.includes(h)){d!==";"&&f++;var p=t.substring(c,f).trim();n+=" "+p+";"}}c=f+1,u=-1}}}}return r&&(n+=E2(r)),i&&(n+=E2(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function ri(t,e,n,r,i,s){var o=t.__className;if(o!==n||o===void 0){var a=l$(n,r,s);a==null?t.removeAttribute("class"):e?t.className=a:t.setAttribute("class",a),t.__className=n}else if(s&&i!==s)for(var l in s){var c=!!s[l];(i==null||c!==!!i[l])&&t.classList.toggle(l,c)}return s}function sm(t,e={},n,r){for(var i in n){var s=n[i];e[i]!==s&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,s,r))}}function Wo(t,e,n,r){var i=t.__style;if(i!==e){var s=c$(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(sm(t,n?.[0],r[0]),sm(t,n?.[1],r[1],"important")):sm(t,n,r));return r}function Bd(t,e,n=!1){if(t.multiple){if(e==null)return;if(!mf(e))return pL();for(var r of t.options)r.selected=e.includes(Eu(r));return}for(r of t.options){var i=Eu(r);if(LL(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function n_(t){var e=new MutationObserver(()=>{Bd(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Wb(()=>{e.disconnect()})}function om(t,e,n=e){var r=!0;qb(t,"change",i=>{var s=i?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(s),Eu);else{var a=t.querySelector(s)??t.querySelector("option:not([disabled])");o=a&&Eu(a)}n(o)}),vf(()=>{var i=e();if(Bd(t,i,r),r&&i===void 0){var s=t.querySelector(":checked");s!==null&&(i=Eu(s),n(i))}t.__value=i,r=!1}),n_(t)}function Eu(t){return"__value"in t?t.__value:t.value}const Yc=Symbol("class"),Jc=Symbol("style"),r_=Symbol("is custom element"),i_=Symbol("is html");function u$(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function an(t,e,n,r){var i=o_(t);i[e]!==(i[e]=n)&&(e==="loading"&&(t[WM]=n),n==null?t.removeAttribute(e):typeof n!="string"&&a_(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function f$(t,e,n,r,i=!1){var s=o_(t),o=s[r_],a=!s[i_],l=e||{},c=t.tagName==="OPTION";for(var u in e)u in n||(n[u]=null);n.class?n.class=t_(n.class):(r||n[Yc])&&(n.class=null),n[Jc]&&(n.style??=null);var f=a_(t);for(const x in n){let C=n[x];if(c&&x==="value"&&C==null){t.value=t.__value="",l[x]=C;continue}if(x==="class"){var d=t.namespaceURI==="http://www.w3.org/1999/xhtml";ri(t,d,C,r,e?.[Yc],n[Yc]),l[x]=C,l[Yc]=n[Yc];continue}if(x==="style"){Wo(t,C,e?.[Jc],n[Jc]),l[x]=C,l[Jc]=n[Jc];continue}var h=l[x];if(!(C===h&&!(C===void 0&&t.hasAttribute(x)))){l[x]=C;var p=x[0]+x[1];if(p!=="$$")if(p==="on"){const N={},O="$$"+x;let A=x.slice(2);var g=ZL(A);if(KL(A)&&(A=A.slice(0,-7),N.capture=!0),!g&&h){if(C!=null)continue;t.removeEventListener(A,l[O],N),l[O]=null}if(C!=null)if(g)t[`__${A}`]=C,Ci([A]);else{let P=function(S){l[x].call(this,S)};l[O]=YA(A,t,P,N)}else g&&(t[`__${A}`]=void 0)}else if(x==="style")an(t,x,C);else if(x==="autofocus")PL(t,!!C);else if(!o&&(x==="__value"||x==="value"&&C!=null))t.value=t.__value=C;else if(x==="selected"&&c)u$(t,C);else{var m=x;a||(m=JL(m));var v=m==="defaultValue"||m==="defaultChecked";if(C==null&&!o&&!v)if(s[x]=null,m==="value"||m==="checked"){let N=t;const O=e===void 0;if(m==="value"){let A=N.defaultValue;N.removeAttribute(m),N.defaultValue=A,N.value=N.__value=O?A:null}else{let A=N.defaultChecked;N.removeAttribute(m),N.defaultChecked=A,N.checked=O?A:!1}}else t.removeAttribute(x);else v||f.includes(m)&&(o||typeof C!="string")?(t[m]=C,m in s&&(s[m]=Mn)):typeof C!="function"&&an(t,m,C)}}}return l}function s_(t,e,n=[],r=[],i,s=!1){CA(n,r,o=>{var a=void 0,l={},c=t.nodeName==="SELECT",u=!1;if(Lc(()=>{var d=e(...o.map($)),h=f$(t,a,d,i,s);u&&c&&"value"in d&&Bd(t,d.value);for(let g of Object.getOwnPropertySymbols(l))d[g]||qr(l[g]);for(let g of Object.getOwnPropertySymbols(d)){var p=d[g];g.description===hL&&(!a||p!==a[g])&&(l[g]&&qr(l[g]),l[g]=to(()=>o$(t,()=>p))),h[g]=p}a=h}),c){var f=t;vf(()=>{Bd(f,a.value,!0),n_(f)})}u=!0})}function o_(t){return t.__attributes??={[r_]:t.nodeName.includes("-"),[i_]:t.namespaceURI===fL}}var x2=new Map;function a_(t){var e=t.getAttribute("is")||t.nodeName,n=x2.get(e);if(n)return n;x2.set(e,n=[]);for(var r,i=t,s=Element.prototype;s!==i;){r=gA(i);for(var o in r)r[o].set&&n.push(o);i=dp(i)}return n}function d$(t,e,n=e){var r=new WeakSet;qb(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=am(t)?lm(s):s,n(s),Yt!==null&&r.add(Yt),await ua(),s!==(s=e())){var o=t.selectionStart,a=t.selectionEnd;t.value=s??"",a!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(a,t.value.length))}}),Ea(e)==null&&t.value&&(n(am(t)?lm(t.value):t.value),Yt!==null&&r.add(Yt)),wp(()=>{var i=e();if(t===document.activeElement){var s=bd??Yt;if(r.has(s))return}am(t)&&i===lm(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function h$(t,e,n=e){qb(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),Ea(e)==null&&n(t.checked),wp(()=>{var r=e();t.checked=!!r})}function am(t){var e=t.type;return e==="number"||e==="range"}function lm(t){return t===""?null:+t}function S2(t,e){return t===e||t?.[qs]===e}function Rn(t={},e,n,r){return vf(()=>{var i,s;return wp(()=>{i=s,s=[],Ea(()=>{t!==n(...s)&&(e(t,...s),i&&S2(n(...i),t)&&e(null,...i))})}),()=>{gp(()=>{s&&S2(n(...s),t)&&e(null,...s)})}}),t}function Gb(t,e,n){if(t==null)return e(void 0),n&&n(void 0),xi;const r=Ea(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const Ml=[];function l_(t,e){return{subscribe:Ei(t,e).subscribe}}function Ei(t,e=xi){let n=null;const r=new Set;function i(a){if(zb(t,a)&&(t=a,n)){const l=!Ml.length;for(const c of r)c[1](),Ml.push(c,t);if(l){for(let c=0;c<Ml.length;c+=2)Ml[c][0](Ml[c+1]);Ml.length=0}}}function s(a){i(a(t))}function o(a,l=xi){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,s)||xi),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function Gs(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return l_(n,(o,a)=>{let l=!1;const c=[];let u=0,f=xi;const d=()=>{if(u)return;f();const p=e(r?c[0]:c,o,a);s?o(p):f=typeof p=="function"?p:xi},h=i.map((p,g)=>Gb(p,m=>{c[g]=m,u&=~(1<<g),l&&d()},()=>{u|=1<<g}));return l=!0,d(),function(){Pb(h),f(),l=!1}})}function Ja(t){let e;return Gb(t,n=>e=n)(),e}let Jf=!1,ry=Symbol();function _n(t,e,n){const r=n[e]??={store:null,source:MA(void 0),unsubscribe:xi};if(r.store!==t&&!(ry in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=xi;else{var i=!0;r.unsubscribe=Gb(t,s=>{i?r.source.v=s:se(r.source,s)}),i=!1}return t&&ry in n?Ja(t):$(r.source)}function ii(){const t={};function e(){Wb(()=>{for(var n in t)t[n].unsubscribe();Ld(t,ry,{enumerable:!1,value:!0})})}return[t,e]}function p$(t){var e=Jf;try{return Jf=!1,[t(),Jf]}finally{Jf=e}}const g$={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function m$(t,e,n){return new Proxy({props:t,exclude:e},g$)}function dt(t,e,n,r){var i=(n&aL)!==0,s=(n&lL)!==0,o=r,a=!0,l=()=>(a&&(a=!1,o=s?Ea(r):r),o),c;if(i){var u=qs in t||qM in t;c=Zl(t,e)?.set??(u&&e in t?x=>t[e]=x:void 0)}var f,d=!1;i?[f,d]=p$(()=>t[e]):f=t[e],f===void 0&&r!==void 0&&(f=l(),c&&(QM(),c(f)));var h;if(h=()=>{var x=t[e];return x===void 0?l():(a=!0,x)},(n&oL)===0)return h;if(c){var p=t.$$legacy;return(function(x,C){return arguments.length>0?((!C||p||d)&&c(C?h():x),x):h()})}var g=!1,m=((n&sL)!==0?mp:AA)(()=>(g=!1,h()));i&&$(m);var v=Ct;return(function(x,C){if(arguments.length>0){const N=C?$(m):i?Et(x):x;return se(m,N),g=!0,o!==void 0&&(o=N),x}return El&&g||(v.f&vl)!==0?m.v:$(m)})}function Ti(t){pr===null&&Fb(),qe(()=>{const e=Ea(t);if(typeof e=="function")return e})}function ol(t){pr===null&&Fb(),Ti(()=>()=>Ea(t))}const y$="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(y$);var b$=Object.defineProperty,v$=(t,e,n)=>e in t?b$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ke=(t,e,n)=>(v$(t,typeof e!="symbol"?e+"":e,n),n);let wf=class extends Error{},A2=class extends wf{constructor(e){super(`RxNostrWebSocketError: WebSocket was closed with code ${e} by relay.`),this.code=e,this.name="RxNostrWebSocketError"}},wd=class extends wf{constructor(e){super(`RxNostrInvalidUsageError: ${e}`),this.name="RxNostrInvalidUsageError"}},cm=class extends wf{constructor(e){super(`RxNostrEnvironmentError: ${e}`),this.name="RxNostrEnvironmentError"}},c_=class extends wf{constructor(){super("RxNostrLogicError: This is rx-nostr's internal bug. Please report to the author of the library."),this.name="RxNostrLogicError"}},$s=class extends wf{constructor(){super("RxNostrAlreadyDisposedError: Attempted to access a disposed resource."),this.name="RxNostrAlreadyDisposedError"}};const Ef=(t,e)=>({...e,...t});function w$(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function um(t){throw t}function E$(t){return{async signEvent(e){var n,r;const i={...e,pubkey:e.pubkey??await((n=window?.nostr)==null?void 0:n.getPublicKey())??um(new cm("window.nostr.getPublicKey() is not found")),tags:[...e.tags??[]],created_at:e.created_at??Math.floor(Date.now()/1e3)};return w$(i)?i:await((r=window?.nostr)==null?void 0:r.signEvent(i))??um(new cm("window.nostr.signEvent() is not found"))},getPublicKey(){var e;return((e=window?.nostr)==null?void 0:e.getPublicKey())??um(new cm("window.nostr.getPublicKey() is not found"))}}}const x$=t=>Ef(t,{signer:E$(),connectionStrategy:"lazy",retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},disconnectTimeout:1e4,eoseTimeout:30*1e3,okTimeout:30*1e3,authTimeout:30*1e3,skipVerify:!1,skipValidateFilterMatching:!1,skipExpirationCheck:!1,skipFetchNip11:!1});function S$(t){return"length"in t?t.map(_2):[_2(t)]}function _2(t){return{...t,since:t.since?k2(t.since):void 0,until:t.until?k2(t.until):void 0}}function k2(t){return typeof t=="number"?t:t()}async function A$(t){try{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws(s?):/,"http$1:"),await(await fetch(e.toString(),{headers:{Accept:"application/nostr+json"}})).json()}catch{return{}}}function C2(t,e){try{return t()}catch(n){return e instanceof Function?e(n):e}}function Ps(t){let e="";try{e=t.trim();const n=new URL(e);n.hash="",n.pathname=C2(()=>decodeURI(n.pathname),n.pathname),n.pathname=n.pathname.replace(/\/$/,""),n.hostname=n.hostname.replace(/\.$/,""),n.searchParams.sort(),n.search=C2(()=>decodeURIComponent(n.search),n.search);let r=n.toString();return n.search||(r=r.replace(/\/$/,"")),r}catch{return e}}let Ed=class u_ extends Map{constructor(e){if(super(),!!e)for(const[n,r]of Object.entries(e))this.set(Ps(n),r)}get(e){return super.get(Ps(e))}getMany(e){const n=[];for(const r of new Set(e.map(Ps))){const i=this.get(r);i!==void 0&&n.push(i)}return n}set(e,n){return super.set(Ps(e),n)}has(e){return super.has(Ps(e))}delete(e){return super.delete(Ps(e))}toObject(){const e={};for(const[n,r]of this.entries())e[n]=r;return e}toKeys(){return[...super.keys()]}toValues(){return[...super.values()]}copy(){return new u_(this.toObject())}},Ud=class{static async getValue(e,n,r){if(!(r!=null&&r.skipCache)){const i=await this.cache.get(e);if(i)return n(i)}if(!(r!=null&&r.skipFetch)){const i=await this.fetch(e);if(i)return n(i)}return n(this.default)}static get(e){const n=this.cache.get(e);if(n&&!(n instanceof Promise))return n}static async fetch(e){const n=A$(e);return this.cache.set(e,n),n.then(r=>{this.cache.set(e,r)}),n}static async getOrFetch(e){return this.cache.get(e)??this.fetch(e)}static set(e,n){this.cache.set(e,n)}static getDefault(){return this.default}static setDefault(e){this.default=e}static forget(e){this.cache.delete(e)}static forgetAll(){this.cache.clear()}};Ke(Ud,"cache",new Ed),Ke(Ud,"default",{});/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */new Uint8Array(new Uint32Array([287454020]).buffer)[0];function _$(t,e,n){return Array.isArray(e)?e.some(r=>T2(t,r)):T2(t,e)}function T2(t,e,n){const{sinceInclusive:r,untilInclusive:i}=Ef({},{sinceInclusive:!0,untilInclusive:!0});if(e.ids&&e.ids.every(s=>!t.id.startsWith(s))||e.kinds&&!e.kinds.includes(t.kind)||e.authors&&e.authors.every(s=>!t.pubkey.startsWith(s))||e.since&&(r&&!(e.since<=t.created_at)||!r&&!(e.since<t.created_at))||e.until&&(i&&!(t.created_at<=e.until)||!i&&!(t.created_at<e.until)))return!1;for(const[s,o]of Object.entries(e)){if(!s.startsWith("#")||!Array.isArray(o))continue;const a=s.slice(1);if(!t.tags.find(([l,c])=>a===l&&o.includes(c)))return!1}return!0}function k$(t,e){const n=t.tags.find(r=>r[0]==="expiration");if(!n)return!1;try{const r=Number(n[1]);return Number.isInteger(r)?r<=(e??Math.floor(Date.now()/1e3)):!1}catch{return!1}}var iy=function(t,e){return iy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},iy(t,e)};function oo(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");iy(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function C$(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}function f_(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function uc(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function fc(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function dc(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Xl(t){return this instanceof Xl?(this.v=t,this):new Xl(t)}function T$(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(h){return new Promise(function(p,g){s.push([d,h,p,g])>1||a(d,h)})})}function a(d,h){try{l(r[d](h))}catch(p){f(s[0][3],p)}}function l(d){d.value instanceof Xl?Promise.resolve(d.value.v).then(c,u):f(s[0][2],d)}function c(d){a("next",d)}function u(d){a("throw",d)}function f(d,h){d(h),s.shift(),s.length&&a(s[0][0],s[0][1])}}function I$(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof uc=="function"?uc(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function bn(t){return typeof t=="function"}function Ap(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var fm=Ap(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Hd(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var xf=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=uc(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(bn(u))try{u()}catch(g){s=g instanceof fm?g.errors:[g]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var d=uc(f),h=d.next();!h.done;h=d.next()){var p=h.value;try{I2(p)}catch(g){s=s??[],g instanceof fm?s=dc(dc([],fc(s)),fc(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}}if(s)throw new fm(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)I2(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Hd(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Hd(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),d_=xf.EMPTY;function h_(t){return t instanceof xf||t&&"closed"in t&&bn(t.remove)&&bn(t.add)&&bn(t.unsubscribe)}function I2(t){bn(t)?t():t.unsubscribe()}var O$={Promise:void 0},M$={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,dc([t,e],fc(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function p_(t){M$.setTimeout(function(){throw t})}function sy(){}function xd(t){t()}var Zb=(function(t){oo(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,h_(n)&&n.add(r)):r.destination=N$,r}return e.create=function(n,r,i){return new Fd(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(xf),L$=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Xf(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Xf(r)}else Xf(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Xf(n)}},t})(),Fd=(function(t){oo(e,t);function e(n,r,i){var s=t.call(this)||this,o;return bn(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new L$(o),s}return e})(Zb);function Xf(t){p_(t)}function $$(t){throw t}var N$={closed:!0,next:sy,error:$$,complete:sy},Yb=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function ao(t){return t}function P$(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return g_(t)}function g_(t){return t.length===0?ao:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var Wr=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=D$(e)?e:new Fd(e,n,r);return xd(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=O2(n),new n(function(i,s){var o=new Fd({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Yb]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return g_(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=O2(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function O2(t){var e;return(e=t??O$.Promise)!==null&&e!==void 0?e:Promise}function R$(t){return t&&bn(t.next)&&bn(t.error)&&bn(t.complete)}function D$(t){return t&&t instanceof Zb||R$(t)&&h_(t)}function B$(t){return bn(t?.lift)}function gr(t){return function(e){if(B$(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Xn(t,e,n,r,i){return new U$(t,e,n,r,i)}var U$=(function(t){oo(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(Zb),H$=Ap(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),sn=(function(t){oo(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new M2(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new H$},e.prototype.next=function(n){var r=this;xd(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=uc(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;xd(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;xd(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?d_:(this.currentObservers=null,a.push(n),new xf(function(){r.currentObservers=null,Hd(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Wr;return n.source=this,n},e.create=function(n,r){return new M2(n,r)},e})(Wr),M2=(function(t){oo(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:d_},e})(sn),F$=(function(t){oo(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(sn),z$={now:function(){return Date.now()}},j$=(function(t){oo(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(xf),oy={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=oy.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,dc([t,e],fc(n))):setInterval.apply(void 0,dc([t,e],fc(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},V$=(function(t){oo(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),oy.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&oy.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Hd(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(j$),L2=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=z$.now,t})(),q$=(function(t){oo(e,t);function e(n,r){r===void 0&&(r=L2.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(L2),m_=new q$(V$),W$=m_,Sf=new Wr(function(t){return t.complete()});function K$(t){return t&&bn(t.schedule)}function Jb(t){return t[t.length-1]}function G$(t){return bn(Jb(t))?t.pop():void 0}function Xb(t){return K$(Jb(t))?t.pop():void 0}function Z$(t,e){return typeof Jb(t)=="number"?t.pop():e}var y_=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function b_(t){return bn(t?.then)}function v_(t){return bn(t[Yb])}function w_(t){return Symbol.asyncIterator&&bn(t?.[Symbol.asyncIterator])}function E_(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Y$(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var x_=Y$();function S_(t){return bn(t?.[x_])}function A_(t){return T$(this,arguments,function(){var e,n,r,i;return f_(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Xl(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,Xl(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Xl(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function __(t){return bn(t?.getReader)}function bs(t){if(t instanceof Wr)return t;if(t!=null){if(v_(t))return J$(t);if(y_(t))return X$(t);if(b_(t))return Q$(t);if(w_(t))return k_(t);if(S_(t))return e6(t);if(__(t))return t6(t)}throw E_(t)}function J$(t){return new Wr(function(e){var n=t[Yb]();if(bn(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function X$(t){return new Wr(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function Q$(t){return new Wr(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,p_)})}function e6(t){return new Wr(function(e){var n,r;try{for(var i=uc(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function k_(t){return new Wr(function(e){n6(t,e).catch(function(n){return e.error(n)})})}function t6(t){return k_(A_(t))}function n6(t,e){var n,r,i,s;return C$(this,void 0,void 0,function(){var o,a;return f_(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=I$(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function hs(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function C_(t,e){return e===void 0&&(e=0),gr(function(n,r){n.subscribe(Xn(r,function(i){return hs(r,t,function(){return r.next(i)},e)},function(){return hs(r,t,function(){return r.complete()},e)},function(i){return hs(r,t,function(){return r.error(i)},e)}))})}function T_(t,e){return e===void 0&&(e=0),gr(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function r6(t,e){return bs(t).pipe(T_(e),C_(e))}function i6(t,e){return bs(t).pipe(T_(e),C_(e))}function s6(t,e){return new Wr(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function o6(t,e){return new Wr(function(n){var r;return hs(n,e,function(){r=t[x_](),hs(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return bn(r?.return)&&r.return()}})}function I_(t,e){if(!t)throw new Error("Iterable cannot be null");return new Wr(function(n){hs(n,e,function(){var r=t[Symbol.asyncIterator]();hs(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function a6(t,e){return I_(A_(t),e)}function l6(t,e){if(t!=null){if(v_(t))return r6(t,e);if(y_(t))return s6(t,e);if(b_(t))return i6(t,e);if(w_(t))return I_(t,e);if(S_(t))return o6(t,e);if(__(t))return a6(t,e)}throw E_(t)}function Af(t,e){return e?l6(t,e):bs(t)}function O_(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Xb(t);return Af(t,n)}var Qb=Ap(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function M_(t,e){return new Promise(function(n,r){var i=new Fd({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new Qb)}});t.subscribe(i)})}function L_(t){return t instanceof Date&&!isNaN(t)}var $_=Ap(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function N_(t,e){var n=L_(t)?{first:t}:typeof t=="number"?{each:t}:t,r=n.first,i=n.each,s=n.with,o=s===void 0?c6:s,a=n.scheduler,l=a===void 0?m_:a,c=n.meta,u=c===void 0?null:c;if(r==null&&i==null)throw new TypeError("No timeout provided.");return gr(function(f,d){var h,p,g=null,m=0,v=function(x){p=hs(d,l,function(){try{h.unsubscribe(),bs(o({meta:u,lastValue:g,seen:m})).subscribe(d)}catch(C){d.error(C)}},x)};h=f.subscribe(Xn(d,function(x){p?.unsubscribe(),m++,d.next(g=x),i>0&&v(i)},void 0,void 0,function(){p!=null&&p.closed||p==null||p.unsubscribe(),g=null})),!m&&v(r!=null?typeof r=="number"?r:+r-l.now():i)})}function c6(t){throw new $_(t)}function ea(t,e){return gr(function(n,r){var i=0;n.subscribe(Xn(r,function(s){r.next(t.call(e,s,i++))}))})}var u6=Array.isArray;function f6(t,e){return u6(e)?t.apply(void 0,dc([],fc(e))):t(e)}function d6(t){return ea(function(e){return f6(t,e)})}var h6=Array.isArray,p6=Object.getPrototypeOf,g6=Object.prototype,m6=Object.keys;function y6(t){if(t.length===1){var e=t[0];if(h6(e))return{args:e,keys:null};if(b6(e)){var n=m6(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function b6(t){return t&&typeof t=="object"&&p6(t)===g6}function v6(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function w6(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Xb(t),r=G$(t),i=y6(t),s=i.args,o=i.keys;if(s.length===0)return Af([],n);var a=new Wr(E6(s,n,o?function(l){return v6(o,l)}:ao));return r?a.pipe(d6(r)):a}function E6(t,e,n){return n===void 0&&(n=ao),function(r){$2(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(u){$2(e,function(){var f=Af(t[u],e),d=!1;f.subscribe(Xn(r,function(h){s[u]=h,d||(d=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function $2(t,e,n){t?hs(n,t,e):e()}function x6(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,f=!1,d=function(){f&&!l.length&&!c&&e.complete()},h=function(g){return c<r?p(g):l.push(g)},p=function(g){c++;var m=!1;bs(n(g,u++)).subscribe(Xn(e,function(v){e.next(v)},function(){m=!0},void 0,function(){if(m)try{c--;for(var v=function(){var x=l.shift();o?hs(e,o,function(){return p(x)}):p(x)};l.length&&c<r;)v();d()}catch(x){e.error(x)}}))};return t.subscribe(Xn(e,h,function(){f=!0,d()})),function(){}}function zd(t,e,n){return n===void 0&&(n=1/0),bn(e)?zd(function(r,i){return ea(function(s,o){return e(r,s,i,o)})(bs(t(r,i)))},n):(typeof e=="number"&&(n=e),gr(function(r,i){return x6(r,i,t,n)}))}function P_(t){return t===void 0&&(t=1/0),zd(ao,t)}function N2(t,e,n){return t===void 0&&(t=0),n===void 0&&(n=W$),new Wr(function(r){var i=L_(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){r.closed||(r.next(s++),r.complete())},i)})}function S6(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Xb(t),r=Z$(t,1/0),i=t;return i.length?i.length===1?bs(i[0]):P_(r)(Af(i,n)):Sf}function vi(t,e){return gr(function(n,r){var i=0;n.subscribe(Xn(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function R_(t){return gr(function(e,n){var r=null,i=!1,s;r=e.subscribe(Xn(n,void 0,void 0,function(o){s=bs(t(o,R_(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function A6(t){return gr(function(e,n){var r=!1;e.subscribe(Xn(n,function(i){r=!0,n.next(i)},function(){r||n.next(t),n.complete()}))})}function _6(t){return t<=0?function(){return Sf}:gr(function(e,n){var r=0;e.subscribe(Xn(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function k6(t,e){return e===void 0&&(e=ao),t=t??C6,gr(function(n,r){var i,s=!0;n.subscribe(Xn(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function C6(t,e){return t===e}function T6(t){return t===void 0&&(t=I6),gr(function(e,n){var r=!1;e.subscribe(Xn(n,function(i){r=!0,n.next(i)},function(){return r?n.complete():n.error(t())}))})}function I6(){return new Qb}function dm(t){return gr(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function ay(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?vi(function(i,s){return t(i,s,r)}):ao,_6(1),n?A6(e):T6(function(){return new Qb}))}}function O6(t,e){return gr(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Xn(r,function(l){i?.unsubscribe();var c=0,u=s++;bs(t(l,u)).subscribe(i=Xn(r,function(f){return r.next(e?e(l,f,u,c++):f)},function(){i=null,a()}))},function(){o=!0,a()}))})}function M6(){return O6(ao)}function Xc(t){return gr(function(e,n){bs(t).subscribe(Xn(n,function(){return n.complete()},sy)),!n.closed&&e.subscribe(n)})}function L6(t,e){return gr(function(n,r){var i=0;n.subscribe(Xn(r,function(s){var o=t(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function Qf(t,e,n){var r=bn(t)||e||n?{next:t,error:e,complete:n}:t;return r?gr(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Xn(s,function(l){var c;(c=r.next)===null||c===void 0||c.call(r,l),s.next(l)},function(){var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),s.complete()},function(l){var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),s.error(l)},function(){var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):ao}function $6(t){return zd((e,n)=>Af(t(e,n)).pipe(zd(r=>r?O_(e):Sf)))}function P2(t){return P$(N_(t),R_(e=>{if(e instanceof $_)return Sf;throw e}))}function hm(t,e){const{not:n}=Ef(e,{not:!1});return vi(r=>N6(r.subId===t,n))}function N6(t,e){return!t&&e||t&&!e}let P6=class{constructor(e){Ke(this,"relay"),Ke(this,"config"),Ke(this,"authenticator"),Ke(this,"ongoings",new Set),Ke(this,"authResult$",new sn),Ke(this,"disposed",!1),this.relay=e.relay,this.config=e.config,this.authenticator=e.authenticator;const n=this.relay.getOKObservable().subscribe(i=>{const{eventId:s,ok:o}=i;this.ongoings.has(s)&&(this.ongoings.delete(s),this.authResult$.next(o),o||(n.unsubscribe(),r.unsubscribe()))}),r=this.relay.getAUTHObservable().subscribe(({challenge:i})=>{this.challenge(i)})}getAuthResultObservable(){return this.authResult$.asObservable()}async challenge(e){try{const n=await this.signer.signEvent({kind:22242,content:"",tags:[["relay",this.relay.url],["challenge",e]]});this.ongoings.add(n.id),this.relay.send(["AUTH",n])}catch{}}get signer(){return this.authenticator.signer??this.config.signer}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.authResult$];for(const n of e)n.complete()}},D_=class extends F${constructor(e){super(e??0)}increment(){this.next(this.getValue()+1)}decrement(){this.next(this.getValue()-1)}next(e){typeof e=="number"?super.next(e):super.next(e(this.getValue()))}},R6=class extends sn{waitNext(){return M_(this.pipe(ay(null,void 0)))}},D6=class{constructor(e){Ke(this,"relay"),Ke(this,"authProxy"),Ke(this,"pubs",new Map),Ke(this,"authRequiredPubs",new Set),Ke(this,"count$",new D_(0)),Ke(this,"ok$",new sn),Ke(this,"disposed",!1);var n;this.relay=e.relay,this.authProxy=e.authProxy,this.relay.getReconnectedObservable().subscribe(r=>{for(const[i,s]of r)i==="EVENT"&&this.pubs.has(s.id)&&this.sendEVENT(s)}),this.relay.getOKObservable().subscribe(async r=>{const{eventId:i,notice:s}=r;this.pubs.get(i)&&(this.authProxy&&s!=null&&s.startsWith("auth-required:")?(this.authRequiredPubs.add(i),this.ok$.next({...r,done:!1})):(this.ok$.next({...r,done:!0}),this.confirmOK(i)))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{if(r)for(const i of this.authRequiredPubs){const s=this.pubs.get(i);s&&this.sendEVENT(s)}else for(const i of this.authRequiredPubs)this.confirmOK(i);this.authRequiredPubs.clear()})}async publish(e){if(!this.disposed)return this.pubs.has(e.id)||(this.pubs.set(e.id,e),this.count$.increment()),this.sendEVENT(e)}confirmOK(e){this.disposed||this.pubs.has(e)||(this.pubs.delete(e),this.count$.decrement())}getOkAgainstEventObservable(){return this.ok$.asObservable()}getLogicalConnectionSizeObservable(){return this.count$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.count$,this.ok$];for(const n of e)n.complete()}sendEVENT(e){return this.relay.send(["EVENT",e])}};const R2={OPEN:1};let B6=class{constructor(e,n){Ke(this,"socket",null),Ke(this,"buffer",[]),Ke(this,"unsent",[]),Ke(this,"reconnected$",new sn),Ke(this,"outgoing$",new sn),Ke(this,"message$",new sn),Ke(this,"error$",new sn),Ke(this,"retryTimer",null),Ke(this,"sendAttempted$",new R6),Ke(this,"isFirstTry",!0),Ke(this,"maybeDown",!1),Ke(this,"disposed",!1),Ke(this,"state$",new sn),Ke(this,"_state","initialized"),this.url=e,this.config=n,n.skipFetchNip11||Ud.getOrFetch(e),this.setState("initialized")}get state(){return this._state}setState(e){this._state=e,this.state$.next(e)}connectManually(){this.connect()}connect(e){if(this.state==="terminated")return;const n=typeof e=="number";(this.state==="initialized"||this.state==="dormant"||this.state==="error"||this.state==="rejected"||n)&&(this.socket=this.createSocket(e??0))}createSocket(e){const n=this.isFirstTry;this.isFirstTry=!1;let r=!1;const i=e>0,s=this.state==="error"||this.state==="rejected";i?this.setState("retrying"):this.setState("connecting");const o=async()=>{if(this.state==="terminated"){u?.close(Rl.RX_NOSTR_DISPOSED);return}this.setState("connected"),r=!0,(i||s)&&(this.reconnected$.next(this.unsent),this.unsent=[]);try{for(const f of this.buffer)this.send(f)}catch(f){this.error$.next(f)}finally{this.buffer=[]}},a=({data:f})=>{if(this.state!=="terminated")try{this.message$.next(this.pack(JSON.parse(f)))}catch(d){this.error$.next(d)}},l=({code:f})=>{var d;if(u?.removeEventListener("open",o),u?.removeEventListener("message",a),u?.removeEventListener("close",l),this.socket===u&&(this.socket=null),this.state==="terminated"||f===Rl.RX_NOSTR_DISPOSED){this.unsent=[],this.buffer=[];return}if(f===Rl.RX_NOSTR_IDLE)this.setState("dormant"),this.buffer.length>0&&this.connect();else if(f===Rl.DONT_RETRY)this.unsent=[],this.buffer=[],this.error$.next(new A2(f)),this.setState("rejected");else{n&&!r&&(this.maybeDown=!0),this.unsent.push(...this.buffer),this.buffer=[],this.error$.next(new A2(f));const h=e+1;this.config.retry.strategy!=="off"&&!(this.config.retry.polite&&this.maybeDown)&&h<=this.config.retry.maxCount?(this.setState("waiting-for-retrying"),(d=this.retryTimer)==null||d.unsubscribe(),this.retryTimer=U6(this.config.retry,h).subscribe(()=>{this.disposed||this.connect(h)})):this.setState("error")}},c=this.config.websocketCtor??globalThis.WebSocket;if(!c)throw new wd("WebSocket constructor is missing");const u=(()=>{try{return new c(this.url)}catch{return l({code:0}),null}})();return u?.addEventListener("open",o),u?.addEventListener("message",a),u?.addEventListener("close",l),u}pack(e){const n=e[0],r=this.url;switch(n){case"EVENT":return{from:r,type:n,message:e,subId:e[1],event:e[2]};case"EOSE":return{from:r,type:n,message:e,subId:e[1]};case"OK":return{from:r,type:n,message:e,eventId:e[1],ok:e[2],notice:e[3]};case"CLOSED":return{from:r,type:n,message:e,subId:e[1],notice:e[2]};case"NOTICE":return{from:r,type:n,message:e,notice:e[1]};case"AUTH":return{from:r,type:n,message:e,challenge:e[1]};case"COUNT":return{from:r,type:n,message:e,subId:e[1],count:e[2]};default:return{from:r,type:"unknown",message:e}}}disconnect(e){var n;((n=this.socket)==null?void 0:n.readyState)===R2.OPEN&&this.socket.close(e)}send(e){const n=this.sendAttempted$.waitNext();switch(this.state){case"terminated":case"rejected":return this.sendAttempted$.next(),n;case"initialized":case"connecting":case"dormant":return this.buffer.push(e),this.connect(),n;case"connected":{if(!this.socket)throw new c_;return this.socket.readyState===R2.OPEN?(this.outgoing$.next({to:this.url,message:e}),this.socket.send(JSON.stringify(e)),this.sendAttempted$.next(),n):(this.buffer.push(e),n)}case"waiting-for-retrying":case"retrying":case"error":return this.sendAttempted$.next(),this.unsent.push(e),n}}getEVENTObservable(){return this.message$.pipe(vi(e=>e.type==="EVENT"))}getEOSEObservable(){return this.message$.pipe(vi(e=>e.type==="EOSE"))}getCLOSEDObservable(){return this.message$.pipe(vi(e=>e.type==="CLOSED"))}getOKObservable(){return this.message$.pipe(vi(e=>e.type==="OK"))}getAUTHObservable(){return this.message$.pipe(vi(e=>e.type==="AUTH"))}getAllMessageObservable(){return this.message$.asObservable()}getOutgoingMessageObservable(){return this.outgoing$.asObservable()}getReconnectedObservable(){return this.reconnected$.asObservable()}getConnectionStateObservable(){return this.state$.pipe(k6(),ea(e=>({from:this.url,state:e})))}getErrorObservable(){return this.error$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){var e,n;if(this.disposed)return;this.disposed=!0,this.setState("terminated"),(e=this.retryTimer)==null||e.unsubscribe(),(n=this.socket)==null||n.close(Rl.RX_NOSTR_DISPOSED),this.socket=null;const r=[this.state$,this.outgoing$,this.message$,this.error$,this.reconnected$,this.sendAttempted$];for(const i of r)i.complete()}};function U6(t,e){switch(t.strategy){case"exponential":{const n=Math.max(t.initialDelay*2**(e-1)+(Math.random()-.5)*1e3,1e3);return N2(n)}case"immediately":return O_(0);case"linear":return N2(t.interval);case"off":return Sf}}const Rl={DONT_RETRY:4e3,RX_NOSTR_IDLE:4537,RX_NOSTR_DISPOSED:4538};let H6=class{constructor(e){Ke(this,"relay"),Ke(this,"authProxy"),Ke(this,"config"),Ke(this,"subs",new Map),Ke(this,"authRequiredSubs",new Set),Ke(this,"fin$",new sn),Ke(this,"disposed",!1),Ke(this,"queue");var n;this.relay=e.relay,this.authProxy=e.authProxy,this.config=e.config,this.queue=new F6(this.relay.url,this.config),this.queue.getActivationObservable().subscribe(r=>{for(const{req:i}of r)this.sendREQ(i)}),this.relay.getReconnectedObservable().subscribe(()=>{for(const{req:r}of this.queue.ongoings)this.sendREQ(r)}),this.relay.getEOSEObservable().subscribe(({subId:r})=>{var i;(i=this.subs.get(r))!=null&&i.autoclose&&this.unsubscribe(r)}),this.relay.getCLOSEDObservable().subscribe(async({subId:r,notice:i})=>{this.subs.get(r)&&(this.authProxy&&i!=null&&i.startsWith("auth-required:")?this.authRequiredSubs.add(r):this.fin(r))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{var i;if(r)for(const s of this.authRequiredSubs){const o=(i=this.subs.get(s))==null?void 0:i.req;o&&this.sendREQ(o)}else for(const s of this.authRequiredSubs)this.fin(s);this.authRequiredSubs.clear()})}subscribe(e,n){if(this.disposed)return;const r=e[1],i={subId:r,req:e,autoclose:n};this.subs.set(r,i),this.queue.enqueue(i)}unsubscribe(e){this.disposed||(this.subs.has(e)&&this.sendCLOSE(e),this.fin(e))}isOngoingOrQueued(e){return this.subs.has(e)}getEventObservable(){return this.relay.getEVENTObservable().pipe(vi(({subId:e,event:n})=>{var r;const i=(r=this.subs.get(e))==null?void 0:r.filters;return i?this.config.skipValidateFilterMatching||_$(n,i):!1}))}getFinObservable(){return this.fin$.asObservable()}getLogicalConnectionSizeObservable(){return this.queue.getSizeObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.fin$];for(const n of e)n.complete();this.queue.dispose()}sendREQ([,e,...n]){const r=S$(n),i=this.subs.get(e);i&&(i.filters=r,this.relay.send(["REQ",e,...r]))}sendCLOSE(e){this.relay.send(["CLOSE",e])}fin(e){this.subs.delete(e),this.queue.drop(e),this.fin$.next({from:this.relay.url,subId:e})}},F6=class{constructor(e,n){Ke(this,"_queuings",[]),Ke(this,"_ongoings",[]),Ke(this,"activated$",new sn),Ke(this,"count$",new D_),this.url=e,this.config=n}get queuings(){return this._queuings}set queuings(e){this._queuings=e}get ongoings(){return this._ongoings}set ongoings(e){this._ongoings=e}enqueue(e){this.queuings=[...this.queuings,e],this.count$.increment(),this.shift()}drop(e){const n=(a,l)=>{const c=a.length,u=a.filter(d=>d.subId!==l),f=c-u.length;return[u,f]},[r,i]=n(this.queuings,e),[s,o]=n(this.ongoings,e);this.queuings=r,this.ongoings=s,this.count$.next(a=>a-(i+o)),this.shift()}getActivationObservable(){return this.activated$.asObservable()}getSizeObservable(){return this.count$.asObservable()}dispose(){const e=[this.activated$,this.count$];for(const n of e)n.complete()}async shift(){const e=await this.capacity(),n=[...this.ongoings,...this.queuings],r=n.slice(0,e),i=n.slice(e),s=this.queuings.slice(0,e-this.ongoings.length);this.ongoings=r,this.queuings=i,s.length>0&&this.activated$.next(s)}async capacity(){return await Ud.getValue(this.url,e=>{var n;return(n=e.limitation)==null?void 0:n.max_subscriptions},{skipFetch:this.config.skipFetchNip11})??1/0}},z6=class{constructor(e,n){Ke(this,"relay"),Ke(this,"pubProxy"),Ke(this,"subProxy"),Ke(this,"defaultSubscriptionIds",new Set),Ke(this,"communicating",!1),Ke(this,"strategy","lazy"),Ke(this,"disconnectTimeout"),Ke(this,"disconnectTimer"),Ke(this,"isDefaultRelay",!1),Ke(this,"disposed",!1),Ke(this,"_url"),this._url=Ps(e);const r=j6(e,n),i=new B6(this.url,n),s=r?new P6({relay:i,config:n,authenticator:r}):null,o=new D6({relay:i,authProxy:s}),a=new H6({relay:i,authProxy:s,config:n});this.relay=i,this.pubProxy=o,this.subProxy=a,this.disconnectTimeout=n.disconnectTimeout,w6([this.pubProxy.getLogicalConnectionSizeObservable(),this.subProxy.getLogicalConnectionSizeObservable()]).pipe(ea(([l,c])=>l+c)).subscribe(l=>{this.communicating=l>0,this.resetConnection()})}get url(){return this._url}setConnectionStrategy(e){this.disposed||(this.strategy=e,this.resetConnection())}resetConnection(){let e=this.strategy;switch(this.isDefaultRelay||(e="lazy"),e){case"lazy":{const n=()=>{this.communicating||this.relay.disconnect(Rl.RX_NOSTR_IDLE)};this.disconnectTimeout>0?(this.disconnectTimeout&&(clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0),this.disconnectTimer=setTimeout(n,this.disconnectTimeout)):n();break}case"lazy-keep":break;case"aggressive":{(this.connectionState==="initialized"||this.connectionState==="dormant")&&this.relay.connectManually();break}}}markAsDefault(e){if(!this.disposed){if(this.isDefaultRelay=e,!this.isDefaultRelay){for(const n of this.defaultSubscriptionIds)this.subProxy.unsubscribe(n);this.defaultSubscriptionIds.clear()}this.resetConnection()}}async publish(e){if(!this.disposed)return this.pubProxy.publish(e)}confirmOK(e){this.disposed||this.pubProxy.confirmOK(e)}subscribe(e,n){if(this.disposed)return;const{mode:r,overwrite:i,autoclose:s}=Ef(n??{},{overwrite:!1,autoclose:!1,mode:"default"}),[,o]=e;r==="default"&&!this.isDefaultRelay||!i&&this.subProxy.isOngoingOrQueued(o)||(r==="default"&&this.defaultSubscriptionIds.add(o),this.subProxy.subscribe(e,s))}unsubscribe(e){this.disposed||(this.defaultSubscriptionIds.delete(e),this.subProxy.unsubscribe(e))}getEventObservable(){if(this.disposed)throw new $s;return this.subProxy.getEventObservable()}getFinObservable(){if(this.disposed)throw new $s;return this.subProxy.getFinObservable()}getOkAgainstEventObservable(){if(this.disposed)throw new $s;return this.pubProxy.getOkAgainstEventObservable()}getAllMessageObservable(){if(this.disposed)throw new $s;return this.relay.getAllMessageObservable()}getOutgoingMessageObservable(){if(this.disposed)throw new $s;return this.relay.getOutgoingMessageObservable()}getConnectionStateObservable(){if(this.disposed)throw new $s;return this.relay.getConnectionStateObservable()}get connectionState(){return this.relay.state}getErrorObservable(){if(this.disposed)throw new $s;return this.relay.getErrorObservable().pipe(ea(e=>({from:this.url,reason:e})))}connectManually(){this.relay.connectManually()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){this.disposed||(this.disposed=!0,this.disconnectTimer&&clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0,this.relay.dispose(),this.pubProxy.dispose(),this.subProxy.dispose())}};function j6(t,e){const n=e.authenticator;if(!n)return;const r=n instanceof Function?n(t):n;return r==="auto"?{}:r}function V6(t,e){return t.filter(n=>!e.includes(n))}function q6(t){const{rxReq:e,index:n}=t,{rxReqId:r,strategy:i}=e;return`${r}:${i==="backward"?n:0}`}function W6(t){const{rxReq:e,filters:n,index:r}=t;return["REQ",q6({rxReq:e,index:r}),...n]}function D2(t){if(Array.isArray(t)){const e=t.map(n=>{let r="",i=!1,s=!1;if(typeof n=="string")r=n,i=!0,s=!0;else if(Array.isArray(n)){const o=n[2];r=n[1],i=!o||o==="read",s=!o||o==="write"}else r=n.url,i=n.read,s=n.write;return{url:r,read:i,write:s}});return Object.fromEntries(e.map(n=>[n.url,n]))}else{const e=Object.entries(t).map(([n,r])=>({url:n,...r}));return Object.fromEntries(e.map(n=>[n.url,n]))}}function B2(t,e){const n=new Set;if(e!=null&&e.on){const r=e.on;if(!r.defaultReadRelays&&!r.defaultWriteRelays&&!r.relays)return;const i=t.getDefaultRelays();if(r.defaultReadRelays)for(const{url:s}of Object.values(i).filter(o=>o.read))n.add(s);if(r.defaultWriteRelays)for(const{url:s}of Object.values(i).filter(o=>o.write))n.add(s);if(r.relays)for(const s of r.relays)n.add(Ps(s));return[...n]}else if(e!=null&&e.relays){for(const r of e.relays)n.add(Ps(r));return[...n]}else return}function K6(t){return new G6(x$(t??{}))}let G6=class{constructor(e){Ke(this,"connections",new Ed),Ke(this,"defaultRelays",new Ed),Ke(this,"defaultSubscriptions",new Map),Ke(this,"event$",new sn),Ke(this,"fin$",new sn),Ke(this,"ok$",new sn),Ke(this,"all$",new sn),Ke(this,"error$",new sn),Ke(this,"connectionState$",new sn),Ke(this,"outgoing$",new sn),Ke(this,"dispose$",new sn),Ke(this,"disposed",!1),this.config=e}get defaultReadables(){const e=[];for(const{url:n,read:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}get defaultWritables(){const e=[];for(const{url:n,write:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}getDefaultRelays(){if(this.disposed)throw new $s;return this.defaultRelays.toObject()}getDefaultRelay(e){return this.defaultRelays.get(e)}setDefaultRelays(e){if(this.disposed)throw new $s;const n=new Ed(D2(e)),r=[];for(const{read:i,url:s}of n.values()){const o=this.ensureNostrConnection(s);o.setConnectionStrategy(this.config.connectionStrategy),i&&r.push(o)}this.updateDefaultSubscriptions(r),this.defaultRelays=n}ensureNostrConnection(e){let n=this.connections.get(e);return n||(n=new z6(e,this.config),this.attachNostrConnection(n),this.connections.set(e,n),n)}attachNostrConnection(e){e.getEventObservable().subscribe(this.event$),e.getFinObservable().subscribe(this.fin$),e.getOkAgainstEventObservable().subscribe(this.ok$),e.getAllMessageObservable().subscribe(this.all$),e.getConnectionStateObservable().subscribe(this.connectionState$),e.getErrorObservable().subscribe(this.error$),e.getOutgoingMessageObservable().subscribe(this.outgoing$)}updateDefaultSubscriptions(e){const n=V6(this.defaultReadables,e);for(const r of n)r.markAsDefault(!1);for(const r of e){r.markAsDefault(!0);for(const{req:i,autoclose:s}of this.defaultSubscriptions.values())r?.subscribe(i,{mode:"default",overwrite:!1,autoclose:s})}}addDefaultRelays(e){const n=D2(e);this.setDefaultRelays({...this.defaultRelays.toObject(),...n})}removeDefaultRelays(e){const n=this.defaultRelays.copy(),r=Array.isArray(e)?e:[e];for(const i of r)n.delete(i);this.setDefaultRelays(n.toObject())}getAllRelayStatus(){return Object.fromEntries(Array.from(this.connections.values()).map(e=>[e.url,{connection:e.connectionState}]))}getRelayStatus(e){const n=this.connections.get(e);if(n)return{connection:n.connectionState}}reconnect(e){const n=this.getDefaultRelay(e);if(!n)throw new wd(`The relay (${e}) is not a default relay. \`reconnect()\` can be used only for a readable default relay.`);if(!n.read)throw new wd(`The relay (${e}) is not readable. \`reconnect()\` can be used only for a readable default relay.`);const r=this.connections.get(e);if(!r)throw new c_;(r.connectionState==="error"||r.connectionState==="rejected")&&r.connectManually()}use(e,n){const r=B2(this,n),i=({filters:u,relays:f},d)=>{var h;const p=e.strategy==="backward"?f:void 0,g=W6({rxReq:e,filters:u,index:d});return{subId:g[1],req:g,targetConnections:((h=p??r)==null?void 0:h.map(m=>this.ensureNostrConnection(m)))??this.defaultReadables,mode:p===void 0&&r===void 0?"default":"temporary"}},s=({req:u,targetConnections:f,mode:d})=>{this.startSubscription({req:u,targetConnections:f,mode:d,overwrite:e.strategy==="forward",autoclose:e.strategy==="backward"})},o=({subId:u,targetConnections:f,mode:d})=>{this.teardownSubscription({subId:u,targetConnections:f,mode:d})},a=({req:u,targetConnections:f})=>e.strategy==="forward"?this.createForwardEventObservable({req:u}).pipe(Xc(this.dispose$)):this.createBackwardEventObservable({req:u,targetConnections:f}).pipe(Xc(this.dispose$)),l=e.getReqPacketObservable().pipe(vi(({filters:u})=>u.length>0),ea(i),Xc(this.dispose$)),c=()=>$6(async({event:u})=>(this.config.skipVerify||await this.config.verifier(u))&&(this.config.skipExpirationCheck||!k$(u)));if(e.strategy==="forward"){let u;return l.pipe(Qf(f=>{u=f}),Qf(s),ea(a),dm(()=>{u&&o(u)}),M6(),c())}else return l.pipe(Qf(s),ea(u=>a(u).pipe(dm(()=>{o(u)}))),P_(),c())}createForwardEventObservable(e){const{req:n}=e,r=n[1];return this.event$.pipe(hm(r))}createBackwardEventObservable(e){const{req:n,targetConnections:r}=e,i=n[1],s=new Set,o=u=>u==="error"||u==="rejected"||u==="terminated",a=()=>r.every(({connectionState:u,url:f})=>o(u)||s.has(f)),l=this.fin$.pipe(hm(i),Qf(({from:u})=>{s.add(u)})),c=S6(l,this.connectionState$.asObservable()).pipe(vi(()=>a()),ay(null,void 0));return this.event$.pipe(Xc(c),P2(this.config.eoseTimeout),hm(i),vi(u=>!s.has(u.from)))}startSubscription(e){const{req:n,targetConnections:r,mode:i,overwrite:s,autoclose:o}=e,a=n[1];i==="default"&&this.defaultSubscriptions.set(a,{req:n,autoclose:o});for(const l of r)l.subscribe(n,{mode:i,overwrite:s,autoclose:o})}teardownSubscription(e){const{subId:n,targetConnections:r,mode:i}=e;i==="default"&&this.defaultSubscriptions.delete(n);for(const s of r)s.unsubscribe(n)}createAllEventObservable(){return this.event$.asObservable()}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.all$.asObservable()}createConnectionStateObservable(){return this.connectionState$.asObservable()}createOutgoingMessageObservable(){return this.outgoing$.asObservable()}send(e,n){const{signer:r,errorOnTimeout:i,completeOn:s}=Ef(n??{},{signer:this.config.signer,errorOnTimeout:!1,completeOn:"all-ok"}),o=B2(this,n),a=o===void 0?this.defaultWritables:o.map(h=>this.ensureNostrConnection(h)),l=new sn,c=new Set;let u="";const f=()=>{l.closed||l.complete();for(const h of a)h.confirmOK(u)};r.signEvent(e).then(async h=>{l.closed||(u=h.id,this.ok$.pipe(vi(({eventId:p})=>p===h.id)).subscribe(l),await Promise.all(a.map(p=>p.publish(h))),s==="sent"&&l.complete())}).catch(h=>{throw f(),new wd(h instanceof Error?h.message:"Failed to sign the given event")});const d=(()=>{switch(s){case"sent":return ao;case"all-ok":return L6(({from:h,done:p})=>(p&&c.add(h),c.size<a.length),!0);case"any-ok":return ay(h=>h.ok)}})();return l.pipe(d,Xc(this.dispose$),i?N_(this.config.okTimeout):P2(this.config.okTimeout),dm(f))}async cast(e,n){await M_(this.send(e,{...n,completeOn:"sent"}))}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;for(const n of this.connections.values())n.dispose();this.connections.clear();const e=[this.event$,this.ok$,this.fin$,this.all$,this.connectionState$,this.error$,this.outgoing$];for(const n of e)n.complete();this.dispose$.next(),this.dispose$.complete()}};const B_=t=>{const{strategy:e}=t,n=t.operators??[],r=t.rxReqId??Z6(),i=t.subject??new sn;return{strategy:e,rxReqId:r,getReqPacketObservable(){return i.pipe(...n)},pipe(...s){return B_({strategy:e,rxReqId:r,operators:[...n,...s],subject:i})},emit(s,o){i.next({filters:J6(s),...o??{}})},over(){i.complete()}}};function jd(t){return B_({strategy:"forward",rxReqId:t})}function Z6(){return`${Math.floor(Math.random()*1e6)}`}function Y6(t){var e,n;const r={},i=s=>/^#[a-zA-Z]$/.test(s);for(const s of Object.keys(t)){if(s==="limit"&&(t[s]??-1)>=0){r[s]=t[s];continue}if(s==="since"||s==="until"){const o=t[s];if(typeof o!="number"||(o??-1)>=0){r[s]=o;continue}}if((i(s)||s==="ids"||s==="authors")&&t[s]!==void 0&&(((e=t[s])==null?void 0:e.length)??-1)>0){r[s]=t[s];continue}if(s==="kinds"&&t[s]!==void 0&&(((n=t[s])==null?void 0:n.length)??-1)>0){r[s]=t[s];continue}if(s==="search"&&t[s]!==void 0){r[s]=t[s];continue}}return typeof r.since!="number"||typeof r.until!="number"||r.since<=r.until?r:null}function J6(t){return(Array.isArray(t)?t:[t]).map(e=>Y6(e)).filter(e=>e!==null)}function U2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function X6(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function _f(t,...e){if(!X6(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Q6(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");U2(t.outputLen),U2(t.blockLen)}function Vd(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function eN(t,e){_f(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const pm=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const gm=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),qi=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const tN=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function qd(t){_f(t);let e="";for(let n=0;n<t.length;n++)e+=tN[t[n]];return e}function nN(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function ev(t){return typeof t=="string"&&(t=nN(t)),_f(t),t}function rN(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];_f(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}let U_=class{clone(){return this._cloneInto()}};function iN(t){const e=r=>t().update(ev(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function H_(t=32){if(pm&&typeof pm.getRandomValues=="function")return pm.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function sN(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const oN=(t,e,n)=>t&e^~t&n,aN=(t,e,n)=>t&e^t&n^e&n;let lN=class extends U_{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=gm(this.buffer)}update(e){Vd(this);const{view:n,buffer:r,blockLen:i}=this;e=ev(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=gm(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Vd(this),eN(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;sN(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=gm(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const cN=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),So=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ao=new Uint32Array(64);let uN=class extends lN{constructor(){super(64,32,8,!1),this.A=So[0]|0,this.B=So[1]|0,this.C=So[2]|0,this.D=So[3]|0,this.E=So[4]|0,this.F=So[5]|0,this.G=So[6]|0,this.H=So[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let f=0;f<16;f++,n+=4)Ao[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const d=Ao[f-15],h=Ao[f-2],p=qi(d,7)^qi(d,18)^d>>>3,g=qi(h,17)^qi(h,19)^h>>>10;Ao[f]=g+Ao[f-7]+p+Ao[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const d=qi(a,6)^qi(a,11)^qi(a,25),h=u+d+oN(a,l,c)+cN[f]+Ao[f]|0,p=(qi(r,2)^qi(r,13)^qi(r,22))+aN(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Ao.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Wd=iN(()=>new uN);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const F_=BigInt(0),_p=BigInt(1),fN=BigInt(2);function al(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function kf(t){if(!al(t))throw new Error("Uint8Array expected")}const dN=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function hc(t){kf(t);let e="";for(let n=0;n<t.length;n++)e+=dN[t[n]];return e}function z_(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function tv(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}const ks={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function H2(t){if(t>=ks._0&&t<=ks._9)return t-ks._0;if(t>=ks._A&&t<=ks._F)return t-(ks._A-10);if(t>=ks._a&&t<=ks._f)return t-(ks._a-10)}function pc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=H2(t.charCodeAt(s)),a=H2(t.charCodeAt(s+1));if(o===void 0||a===void 0){const l=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function Fr(t){return tv(hc(t))}function nv(t){return kf(t),tv(hc(Uint8Array.from(t).reverse()))}function fa(t,e){return pc(t.toString(16).padStart(e*2,"0"))}function rv(t,e){return fa(t,e).reverse()}function hN(t){return pc(z_(t))}function or(t,e,n){let r;if(typeof e=="string")try{r=pc(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(al(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function ll(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];kf(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}function pN(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function gN(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function mN(t){let e;for(e=0;t>F_;t>>=_p,e+=1);return e}function yN(t,e){return t>>BigInt(e)&_p}function bN(t,e,n){return t|(n?_p:F_)<<BigInt(e)}const iv=t=>(fN<<BigInt(t-1))-_p,mm=t=>new Uint8Array(t),F2=t=>Uint8Array.from(t);function j_(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=mm(t),i=mm(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=mm())=>{i=a(F2([0]),u),r=a(),u.length!==0&&(i=a(F2([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const f=[];for(;u<e;){r=a();const d=r.slice();f.push(d),u+=r.length}return ll(...f)};return(u,f)=>{o(),l(u);let d;for(;!(d=f(c()));)l();return o(),d}}const vN={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||al(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Cf(t,e,n={}){const r=(i,s,o)=>{const a=vN[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const wN=Object.freeze(Object.defineProperty({__proto__:null,abytes:kf,bitGet:yN,bitLen:mN,bitMask:iv,bitSet:bN,bytesToHex:hc,bytesToNumberBE:Fr,bytesToNumberLE:nv,concatBytes:ll,createHmacDrbg:j_,ensureBytes:or,equalBytes:pN,hexToBytes:pc,hexToNumber:tv,isBytes:al,numberToBytesBE:fa,numberToBytesLE:rv,numberToHexUnpadded:z_,numberToVarBytesBE:hN,utf8ToBytes:gN,validateObject:Cf},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Nn=BigInt(0),mn=BigInt(1),Da=BigInt(2),EN=BigInt(3),ly=BigInt(4),z2=BigInt(5),j2=BigInt(8);BigInt(9);BigInt(16);function Kn(t,e){const n=t%e;return n>=Nn?n:e+n}function xN(t,e,n){if(n<=Nn||e<Nn)throw new Error("Expected power/modulo > 0");if(n===mn)return Nn;let r=mn;for(;e>Nn;)e&mn&&(r=r*t%n),t=t*t%n,e>>=mn;return r}function ai(t,e,n){let r=t;for(;e-- >Nn;)r*=r,r%=n;return r}function cy(t,e){if(t===Nn||e<=Nn)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Kn(t,e),r=e,i=Nn,s=mn;for(;n!==Nn;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==mn)throw new Error("invert: does not exist");return Kn(i,e)}function SN(t){const e=(t-mn)/Da;let n,r,i;for(n=t-mn,r=0;n%Da===Nn;n/=Da,r++);for(i=Da;i<t&&xN(i,e,t)!==t-mn;i++);if(r===1){const o=(t+mn)/ly;return function(a,l){const c=a.pow(l,o);if(!a.eql(a.sqr(c),l))throw new Error("Cannot find square root");return c}}const s=(n+mn)/Da;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let l=r,c=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),f=o.pow(a,n);for(;!o.eql(f,o.ONE);){if(o.eql(f,o.ZERO))return o.ZERO;let d=1;for(let p=o.sqr(f);d<l&&!o.eql(p,o.ONE);d++)p=o.sqr(p);const h=o.pow(c,mn<<BigInt(l-d-1));c=o.sqr(h),u=o.mul(u,h),f=o.mul(f,c),l=d}return u}}function AN(t){if(t%ly===EN){const e=(t+mn)/ly;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%j2===z2){const e=(t-z2)/j2;return function(n,r){const i=n.mul(r,Da),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Da),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return SN(t)}const _N=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function kN(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=_N.reduce((r,i)=>(r[i]="function",r),e);return Cf(t,n)}function CN(t,e,n){if(n<Nn)throw new Error("Expected power > 0");if(n===Nn)return t.ONE;if(n===mn)return e;let r=t.ONE,i=e;for(;n>Nn;)n&mn&&(r=t.mul(r,i)),i=t.sqr(i),n>>=mn;return r}function TN(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function V_(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function IN(t,e,n=!1,r={}){if(t<=Nn)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=V_(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=AN(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:iv(i),ZERO:Nn,ONE:mn,create:l=>Kn(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Nn<=l&&l<t},is0:l=>l===Nn,isOdd:l=>(l&mn)===mn,neg:l=>Kn(-l,t),eql:(l,c)=>l===c,sqr:l=>Kn(l*l,t),add:(l,c)=>Kn(l+c,t),sub:(l,c)=>Kn(l-c,t),mul:(l,c)=>Kn(l*c,t),pow:(l,c)=>CN(a,l,c),div:(l,c)=>Kn(l*cy(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>cy(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>TN(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?rv(l,s):fa(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?nv(l):Fr(l)}});return Object.freeze(a)}function q_(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function W_(t){const e=q_(t);return e+Math.ceil(e/2)}function ON(t,e,n=!1){const r=t.length,i=q_(e),s=W_(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Fr(t):nv(t),a=Kn(o,e-mn)+mn;return n?rv(a,i):fa(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const MN=BigInt(0),ym=BigInt(1);function LN(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>MN;)s&ym&&(o=o.add(a)),a=a.double(),s>>=ym;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let f=0;f<o;f++){u=c,l.push(u);for(let d=1;d<a;d++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const f=BigInt(2**i-1),d=2**i,h=BigInt(i);for(let p=0;p<a;p++){const g=p*l;let m=Number(o&f);o>>=h,m>l&&(m-=d,o+=ym);const v=g,x=g+Math.abs(m)-1,C=p%2!==0,N=m<0;m===0?u=u.add(n(C,s[v])):c=c.add(n(N,s[x]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function K_(t){return kN(t.Fp),Cf(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...V_(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $N(t){const e=K_(t);Cf(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:NN,hexToBytes:PN}=wN,Fa={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=Fa;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:NN(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Fa,n=typeof t=="string"?PN(t):t;kf(n);let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=Fa._parseInt(n.subarray(2)),{d:o,l:a}=Fa._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Bs=BigInt(0),pi=BigInt(1);BigInt(2);const V2=BigInt(3);BigInt(4);function RN(t){const e=$N(t),{Fp:n}=e,r=e.toBytes||((p,g,m)=>{const v=g.toAffine();return ll(Uint8Array.from([4]),n.toBytes(v.x),n.toBytes(v.y))}),i=e.fromBytes||(p=>{const g=p.subarray(1),m=n.fromBytes(g.subarray(0,n.BYTES)),v=n.fromBytes(g.subarray(n.BYTES,2*n.BYTES));return{x:m,y:v}});function s(p){const{a:g,b:m}=e,v=n.sqr(p),x=n.mul(v,p);return n.add(n.add(x,n.mul(p,g)),m)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Bs<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:v,n:x}=e;if(g&&typeof p!="bigint"){if(al(p)&&(p=hc(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(m*2,"0")}let C;try{C=typeof p=="bigint"?p:Fr(or("private key",p,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof p}`)}return v&&(C=Kn(C,x)),a(C),C}const c=new Map;function u(p){if(!(p instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(g,m,v){if(this.px=g,this.py=m,this.pz=v,g==null||!n.isValid(g))throw new Error("x required");if(m==null||!n.isValid(m))throw new Error("y required");if(v==null||!n.isValid(v))throw new Error("z required")}static fromAffine(g){const{x:m,y:v}=g||{};if(!g||!n.isValid(m)||!n.isValid(v))throw new Error("invalid affine point");if(g instanceof f)throw new Error("projective point not allowed");const x=C=>n.eql(C,n.ZERO);return x(m)&&x(v)?f.ZERO:new f(m,v,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const m=n.invertBatch(g.map(v=>v.pz));return g.map((v,x)=>v.toAffine(m[x])).map(f.fromAffine)}static fromHex(g){const m=f.fromAffine(i(or("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return f.BASE.multiply(l(g))}_setWindowSize(g){this._WINDOW_SIZE=g,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:m}=this.toAffine();if(!n.isValid(g)||!n.isValid(m))throw new Error("bad point: x or y not FE");const v=n.sqr(m),x=s(g);if(!n.eql(v,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(n.isOdd)return!n.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:m,py:v,pz:x}=this,{px:C,py:N,pz:O}=g,A=n.eql(n.mul(m,O),n.mul(C,x)),P=n.eql(n.mul(v,O),n.mul(N,x));return A&&P}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:g,b:m}=e,v=n.mul(m,V2),{px:x,py:C,pz:N}=this;let O=n.ZERO,A=n.ZERO,P=n.ZERO,S=n.mul(x,x),E=n.mul(C,C),_=n.mul(N,N),k=n.mul(x,C);return k=n.add(k,k),P=n.mul(x,N),P=n.add(P,P),O=n.mul(g,P),A=n.mul(v,_),A=n.add(O,A),O=n.sub(E,A),A=n.add(E,A),A=n.mul(O,A),O=n.mul(k,O),P=n.mul(v,P),_=n.mul(g,_),k=n.sub(S,_),k=n.mul(g,k),k=n.add(k,P),P=n.add(S,S),S=n.add(P,S),S=n.add(S,_),S=n.mul(S,k),A=n.add(A,S),_=n.mul(C,N),_=n.add(_,_),S=n.mul(_,k),O=n.sub(O,S),P=n.mul(_,E),P=n.add(P,P),P=n.add(P,P),new f(O,A,P)}add(g){u(g);const{px:m,py:v,pz:x}=this,{px:C,py:N,pz:O}=g;let A=n.ZERO,P=n.ZERO,S=n.ZERO;const E=e.a,_=n.mul(e.b,V2);let k=n.mul(m,C),D=n.mul(v,N),U=n.mul(x,O),B=n.add(m,v),M=n.add(C,N);B=n.mul(B,M),M=n.add(k,D),B=n.sub(B,M),M=n.add(m,x);let T=n.add(C,O);return M=n.mul(M,T),T=n.add(k,U),M=n.sub(M,T),T=n.add(v,x),A=n.add(N,O),T=n.mul(T,A),A=n.add(D,U),T=n.sub(T,A),S=n.mul(E,M),A=n.mul(_,U),S=n.add(A,S),A=n.sub(D,S),S=n.add(D,S),P=n.mul(A,S),D=n.add(k,k),D=n.add(D,k),U=n.mul(E,U),M=n.mul(_,M),D=n.add(D,U),U=n.sub(k,U),U=n.mul(E,U),M=n.add(M,U),k=n.mul(D,M),P=n.add(P,k),k=n.mul(T,M),A=n.mul(B,A),A=n.sub(A,k),k=n.mul(B,D),S=n.mul(T,S),S=n.add(S,k),new f(A,P,S)}subtract(g){return this.add(g.negate())}is0(){return this.equals(f.ZERO)}wNAF(g){return h.wNAFCached(this,c,g,m=>{const v=n.invertBatch(m.map(x=>x.pz));return m.map((x,C)=>x.toAffine(v[C])).map(f.fromAffine)})}multiplyUnsafe(g){const m=f.ZERO;if(g===Bs)return m;if(a(g),g===pi)return this;const{endo:v}=e;if(!v)return h.unsafeLadder(this,g);let{k1neg:x,k1:C,k2neg:N,k2:O}=v.splitScalar(g),A=m,P=m,S=this;for(;C>Bs||O>Bs;)C&pi&&(A=A.add(S)),O&pi&&(P=P.add(S)),S=S.double(),C>>=pi,O>>=pi;return x&&(A=A.negate()),N&&(P=P.negate()),P=new f(n.mul(P.px,v.beta),P.py,P.pz),A.add(P)}multiply(g){a(g);let m=g,v,x;const{endo:C}=e;if(C){const{k1neg:N,k1:O,k2neg:A,k2:P}=C.splitScalar(m);let{p:S,f:E}=this.wNAF(O),{p:_,f:k}=this.wNAF(P);S=h.constTimeNegate(N,S),_=h.constTimeNegate(A,_),_=new f(n.mul(_.px,C.beta),_.py,_.pz),v=S.add(_),x=E.add(k)}else{const{p:N,f:O}=this.wNAF(m);v=N,x=O}return f.normalizeZ([v,x])[0]}multiplyAndAddUnsafe(g,m,v){const x=f.BASE,C=(O,A)=>A===Bs||A===pi||!O.equals(x)?O.multiplyUnsafe(A):O.multiply(A),N=C(this,m).add(C(g,v));return N.is0()?void 0:N}toAffine(g){const{px:m,py:v,pz:x}=this,C=this.is0();g==null&&(g=C?n.ONE:n.inv(x));const N=n.mul(m,g),O=n.mul(v,g),A=n.mul(x,g);if(C)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:N,y:O}}isTorsionFree(){const{h:g,isTorsionFree:m}=e;if(g===pi)return!0;if(m)return m(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:m}=e;return g===pi?this:m?m(f,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),r(f,this,g)}toHex(g=!0){return hc(this.toRawBytes(g))}}f.BASE=new f(e.Gx,e.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,h=LN(f,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function DN(t){const e=K_(t);return Cf(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function BN(t){const e=DN(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(M){return Bs<M&&M<n.ORDER}function a(M){return Kn(M,r)}function l(M){return cy(M,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:d}=RN({...e,toBytes(M,T,L){const q=T.toAffine(),F=n.toBytes(q.x),j=ll;return L?j(Uint8Array.from([T.hasEvenY()?2:3]),F):j(Uint8Array.from([4]),F,n.toBytes(q.y))},fromBytes(M){const T=M.length,L=M[0],q=M.subarray(1);if(T===i&&(L===2||L===3)){const F=Fr(q);if(!o(F))throw new Error("Point is not on curve");const j=f(F);let Z;try{Z=n.sqrt(j)}catch(ue){const ae=ue instanceof Error?": "+ue.message:"";throw new Error("Point is not on curve"+ae)}const J=(Z&pi)===pi;return(L&1)===1!==J&&(Z=n.neg(Z)),{x:F,y:Z}}else if(T===s&&L===4){const F=n.fromBytes(q.subarray(0,n.BYTES)),j=n.fromBytes(q.subarray(n.BYTES,2*n.BYTES));return{x:F,y:j}}else throw new Error(`Point of length ${T} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=M=>hc(fa(M,e.nByteLength));function p(M){const T=r>>pi;return M>T}function g(M){return p(M)?a(-M):M}const m=(M,T,L)=>Fr(M.slice(T,L));class v{constructor(T,L,q){this.r=T,this.s=L,this.recovery=q,this.assertValidity()}static fromCompact(T){const L=e.nByteLength;return T=or("compactSignature",T,L*2),new v(m(T,0,L),m(T,L,2*L))}static fromDER(T){const{r:L,s:q}=Fa.toSig(or("DER",T));return new v(L,q)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(T){return new v(this.r,this.s,T)}recoverPublicKey(T){const{r:L,s:q,recovery:F}=this,j=P(or("msgHash",T));if(F==null||![0,1,2,3].includes(F))throw new Error("recovery id invalid");const Z=F===2||F===3?L+e.n:L;if(Z>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const J=F&1?"03":"02",ue=c.fromHex(J+h(Z)),ae=l(Z),X=a(-j*ae),be=a(q*ae),De=c.BASE.multiplyAndAddUnsafe(ue,X,be);if(!De)throw new Error("point at infinify");return De.assertValidity(),De}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return pc(this.toDERHex())}toDERHex(){return Fa.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return pc(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const x={isValidPrivateKey(M){try{return u(M),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const M=W_(e.n);return ON(e.randomBytes(M),e.n)},precompute(M=8,T=c.BASE){return T._setWindowSize(M),T.multiply(BigInt(3)),T}};function C(M,T=!0){return c.fromPrivateKey(M).toRawBytes(T)}function N(M){const T=al(M),L=typeof M=="string",q=(T||L)&&M.length;return T?q===i||q===s:L?q===2*i||q===2*s:M instanceof c}function O(M,T,L=!0){if(N(M))throw new Error("first arg must be private key");if(!N(T))throw new Error("second arg must be public key");return c.fromHex(T).multiply(u(M)).toRawBytes(L)}const A=e.bits2int||function(M){const T=Fr(M),L=M.length*8-e.nBitLength;return L>0?T>>BigInt(L):T},P=e.bits2int_modN||function(M){return a(A(M))},S=iv(e.nBitLength);function E(M){if(typeof M!="bigint")throw new Error("bigint expected");if(!(Bs<=M&&M<S))throw new Error(`bigint expected < 2^${e.nBitLength}`);return fa(M,e.nByteLength)}function _(M,T,L=k){if(["recovered","canonical"].some(ke=>ke in L))throw new Error("sign() legacy options not supported");const{hash:q,randomBytes:F}=e;let{lowS:j,prehash:Z,extraEntropy:J}=L;j==null&&(j=!0),M=or("msgHash",M),Z&&(M=or("prehashed msgHash",q(M)));const ue=P(M),ae=u(T),X=[E(ae),E(ue)];if(J!=null&&J!==!1){const ke=J===!0?F(n.BYTES):J;X.push(or("extraEntropy",ke))}const be=ll(...X),De=ue;function de(ke){const Ze=A(ke);if(!d(Ze))return;const me=l(Ze),Ee=c.BASE.multiply(Ze).toAffine(),ve=a(Ee.x);if(ve===Bs)return;const Oe=a(me*a(De+ve*ae));if(Oe===Bs)return;let Re=(Ee.x===ve?0:2)|Number(Ee.y&pi),nt=Oe;return j&&p(Oe)&&(nt=g(Oe),Re^=1),new v(ve,nt,Re)}return{seed:be,k2sig:de}}const k={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function U(M,T,L=k){const{seed:q,k2sig:F}=_(M,T,L),j=e;return j_(j.hash.outputLen,j.nByteLength,j.hmac)(q,F)}c.BASE._setWindowSize(8);function B(M,T,L,q=D){var F;const j=M;if(T=or("msgHash",T),L=or("publicKey",L),"strict"in q)throw new Error("options.strict was renamed to lowS");const{lowS:Z,prehash:J}=q;let ue,ae;try{if(typeof j=="string"||al(j))try{ue=v.fromDER(j)}catch(Ee){if(!(Ee instanceof Fa.Err))throw Ee;ue=v.fromCompact(j)}else if(typeof j=="object"&&typeof j.r=="bigint"&&typeof j.s=="bigint"){const{r:Ee,s:ve}=j;ue=new v(Ee,ve)}else throw new Error("PARSE");ae=c.fromHex(L)}catch(Ee){if(Ee.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Z&&ue.hasHighS())return!1;J&&(T=e.hash(T));const{r:X,s:be}=ue,De=P(T),de=l(be),ke=a(De*de),Ze=a(X*de),me=(F=c.BASE.multiplyAndAddUnsafe(ae,ke,Ze))==null?void 0:F.toAffine();return me?a(me.x)===X:!1}return{CURVE:e,getPublicKey:C,getSharedSecret:O,sign:U,verify:B,ProjectivePoint:c,Signature:v,utils:x}}let G_=class extends U_{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Q6(e);const r=ev(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Vd(this),this.iHash.update(e),this}digestInto(e){Vd(this),_f(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Z_=(t,e,n)=>new G_(t,e).update(n).digest();Z_.create=(t,e)=>new G_(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function UN(t){return{hash:t,hmac:(e,...n)=>Z_(t,e,rN(...n)),randomBytes:H_}}function HN(t,e){const n=r=>BN({...t,...UN(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const kp=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Kd=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Y_=BigInt(1),Gd=BigInt(2),q2=(t,e)=>(t+e/Gd)/e;function J_(t){const e=kp,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,f=ai(u,n,e)*u%e,d=ai(f,n,e)*u%e,h=ai(d,Gd,e)*c%e,p=ai(h,i,e)*h%e,g=ai(p,s,e)*p%e,m=ai(g,a,e)*g%e,v=ai(m,l,e)*m%e,x=ai(v,a,e)*g%e,C=ai(x,n,e)*u%e,N=ai(C,o,e)*p%e,O=ai(N,r,e)*c%e,A=ai(O,Gd,e);if(!uy.eql(uy.sqr(A),t))throw new Error("Cannot find square root");return A}const uy=IN(kp,void 0,void 0,{sqrt:J_}),sv=HN({a:BigInt(0),b:BigInt(7),Fp:uy,n:Kd,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Kd,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Y_*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=q2(s*t,e),l=q2(-r*t,e);let c=Kn(t-a*n-l*i,e),u=Kn(-a*r-l*s,e);const f=c>o,d=u>o;if(f&&(c=e-c),d&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:c,k2neg:d,k2:u}}}},Wd),Cp=BigInt(0),X_=t=>typeof t=="bigint"&&Cp<t&&t<kp,FN=t=>typeof t=="bigint"&&Cp<t&&t<Kd,W2={};function Zd(t,...e){let n=W2[t];if(n===void 0){const r=Wd(Uint8Array.from(t,i=>i.charCodeAt(0)));n=ll(r,r),W2[t]=n}return Wd(ll(n,...e))}const ov=t=>t.toRawBytes(!0).slice(1),fy=t=>fa(t,32),bm=t=>Kn(t,kp),qu=t=>Kn(t,Kd),av=sv.ProjectivePoint,zN=(t,e,n)=>av.BASE.multiplyAndAddUnsafe(t,e,n);function dy(t){let e=sv.utils.normPrivateKeyToScalar(t),n=av.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:qu(-e),bytes:ov(n)}}function Q_(t){if(!X_(t))throw new Error("bad x: need 0 < x < p");const e=bm(t*t),n=bm(e*t+BigInt(7));let r=J_(n);r%Gd!==Cp&&(r=bm(-r));const i=new av(t,r,Y_);return i.assertValidity(),i}function e3(...t){return qu(Fr(Zd("BIP0340/challenge",...t)))}function jN(t){return dy(t).bytes}function VN(t,e,n=H_(32)){const r=or("message",t),{bytes:i,scalar:s}=dy(e),o=or("auxRand",n,32),a=fy(s^Fr(Zd("BIP0340/aux",o))),l=Zd("BIP0340/nonce",a,i,r),c=qu(Fr(l));if(c===Cp)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=dy(c),d=e3(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(fy(qu(f+d*s)),32),!t3(h,r,i))throw new Error("sign: Invalid signature produced");return h}function t3(t,e,n){const r=or("signature",t,64),i=or("message",e),s=or("publicKey",n,32);try{const o=Q_(Fr(s)),a=Fr(r.subarray(0,32));if(!X_(a))return!1;const l=Fr(r.subarray(32,64));if(!FN(l))return!1;const c=e3(fy(a),ov(o),i),u=zN(o,l,qu(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const vm={getPublicKey:jN,sign:VN,verify:t3,utils:{randomPrivateKey:sv.utils.randomPrivateKey,lift_x:Q_,pointToBytes:ov,numberToBytesBE:fa,bytesToNumberBE:Fr,taggedHash:Zd,mod:Kn}};/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function qN(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function WN(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function KN(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function GN(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}const n3=(t,e)=>e?n3(e,t%e):t,Yd=(t,e)=>t+(e-n3(t,e));function hy(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Yd(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Yd(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function ZN(t,e=!1){if(Yd(8,t)>32||Yd(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!qN(n))throw new Error("radix2.encode input should be Uint8Array");return hy(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(hy(n,t,8,e))}}}function K2(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const py=WN(KN("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),GN("")),G2=[996825010,642813549,513874426,1027748829,705979059];function Qc(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<G2.length;r++)(e>>r&1)===1&&(n^=G2[r]);return n}function Z2(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Qc(i)^o>>5}i=Qc(i);for(let s=0;s<r;s++)i=Qc(i)^t.charCodeAt(s)&31;for(let s of e)i=Qc(i)^s;for(let s=0;s<6;s++)i=Qc(i);return i^=n,py.encode(hy([i%2**30],30,5,!1))}function YN(t){const n=ZN(5),r=n.decode,i=n.encode,s=K2(r);function o(u,f,d=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);if(u.length===0)throw new TypeError(`Invalid prefix length ${u.length}`);const h=u.length+7+f.length;if(d!==!1&&h>d)throw new TypeError(`Length ${h} exceeds limit ${d}`);const p=u.toLowerCase(),g=Z2(p,f,1);return`${p}1${py.encode(f)}${g}`}function a(u,f=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||f!==!1&&u.length>f)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${f})`);const d=u.toLowerCase();if(u!==d&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");const h=d.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=d.slice(0,h),g=d.slice(h+1);if(g.length<6)throw new Error("Data must be at least 6 characters long");const m=py.decode(g).slice(0,-6),v=Z2(p,m,1);if(!g.endsWith(v))throw new Error(`Invalid checksum in ${u}: expected "${v}"`);return{prefix:p,words:m}}const l=K2(a);function c(u){const{prefix:f,words:d}=a(u,!1);return{prefix:f,words:d,bytes:r(d)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const Y2=YN(),JN=new TextEncoder;function XN(t){return qd(Wd(JN.encode(t)))}const lv={sign:(t,e)=>qd(vm.sign(t,e)),verify:vm.verify,getPublicKey:t=>qd(vm.getPublicKey(t))};function QN(t){return lv.getPublicKey(t)}function r3(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return XN(e)}function eP(t,e){return lv.sign(t,e)}function tP(t){try{return lv.verify(t.sig,r3(t),t.pubkey)}catch(e){return console.warn("The following error occurred during verify():",e),!1}}function nP(t){const{words:e}=Y2.decode(t),n=new Uint8Array(Y2.fromWords(e));return qd(n)}function gy(t,e){const n=t.startsWith("nsec1")?nP(t):t,r=QN(n);return{async signEvent(i){const s={...i,pubkey:i.pubkey??r,tags:[...i.tags??[],...e?.tags??[]],created_at:i.created_at??Math.floor(Date.now()/1e3)};if(rP(s))return s;const o=s.id??r3(s),a=s.sig??eP(o,n);return{...s,id:o,sig:a}},async getPublicKey(){return r}}}function rP(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}const iP=async t=>tP(t),sP="modulepreload",oP=function(t){return"/ehagaki/"+t},J2={},Tp=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=l(n.map(c=>{if(c=oP(c),c in J2)return;J2[c]=!0;const u=c.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":sP,u||(d.as="script"),d.crossOrigin="",d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),u)return new Promise((h,p)=>{d.addEventListener("load",h),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var X2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aP(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wm,Q2;function lP(){if(Q2)return wm;Q2=1;var t=function(x){return e(x)&&!n(x)};function e(v){return!!v&&typeof v=="object"}function n(v){var x=Object.prototype.toString.call(v);return x==="[object RegExp]"||x==="[object Date]"||s(v)}var r=typeof Symbol=="function"&&Symbol.for,i=r?Symbol.for("react.element"):60103;function s(v){return v.$$typeof===i}function o(v){return Array.isArray(v)?[]:{}}function a(v,x){return x.clone!==!1&&x.isMergeableObject(v)?g(o(v),v,x):v}function l(v,x,C){return v.concat(x).map(function(N){return a(N,C)})}function c(v,x){if(!x.customMerge)return g;var C=x.customMerge(v);return typeof C=="function"?C:g}function u(v){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(v).filter(function(x){return Object.propertyIsEnumerable.call(v,x)}):[]}function f(v){return Object.keys(v).concat(u(v))}function d(v,x){try{return x in v}catch{return!1}}function h(v,x){return d(v,x)&&!(Object.hasOwnProperty.call(v,x)&&Object.propertyIsEnumerable.call(v,x))}function p(v,x,C){var N={};return C.isMergeableObject(v)&&f(v).forEach(function(O){N[O]=a(v[O],C)}),f(x).forEach(function(O){h(v,O)||(d(v,O)&&C.isMergeableObject(x[O])?N[O]=c(O,C)(v[O],x[O],C):N[O]=a(x[O],C))}),N}function g(v,x,C){C=C||{},C.arrayMerge=C.arrayMerge||l,C.isMergeableObject=C.isMergeableObject||t,C.cloneUnlessOtherwiseSpecified=a;var N=Array.isArray(x),O=Array.isArray(v),A=N===O;return A?N?C.arrayMerge(v,x,C):p(v,x,C):a(x,C)}g.all=function(x,C){if(!Array.isArray(x))throw new Error("first argument should be an array");return x.reduce(function(N,O){return g(N,O,C)},{})};var m=g;return wm=m,wm}var cP=lP();const uP=aP(cP);var my=function(t,e){return my=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},my(t,e)};function Ip(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");my(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var $t=function(){return $t=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},$t.apply(this,arguments)};function fP(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Em(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function xm(t,e){var n=e&&e.cache?e.cache:bP,r=e&&e.serializer?e.serializer:mP,i=e&&e.strategy?e.strategy:pP;return i(t,{cache:n,serializer:r})}function dP(t){return t==null||typeof t=="number"||typeof t=="boolean"}function hP(t,e,n,r){var i=dP(r)?r:n(r),s=e.get(i);return typeof s>"u"&&(s=t.call(this,r),e.set(i,s)),s}function i3(t,e,n){var r=Array.prototype.slice.call(arguments,3),i=n(r),s=e.get(i);return typeof s>"u"&&(s=t.apply(this,r),e.set(i,s)),s}function s3(t,e,n,r,i){return n.bind(e,t,r,i)}function pP(t,e){var n=t.length===1?hP:i3;return s3(t,this,n,e.cache.create(),e.serializer)}function gP(t,e){return s3(t,this,i3,e.cache.create(),e.serializer)}var mP=function(){return JSON.stringify(arguments)},yP=(function(){function t(){this.cache=Object.create(null)}return t.prototype.get=function(e){return this.cache[e]},t.prototype.set=function(e,n){this.cache[e]=n},t})(),bP={create:function(){return new yP}},Sm={variadic:gP},St;(function(t){t[t.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",t[t.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",t[t.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",t[t.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",t[t.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",t[t.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",t[t.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",t[t.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",t[t.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",t[t.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",t[t.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",t[t.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",t[t.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",t[t.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",t[t.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",t[t.INVALID_TAG=23]="INVALID_TAG",t[t.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",t[t.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",t[t.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(St||(St={}));var Jt;(function(t){t[t.literal=0]="literal",t[t.argument=1]="argument",t[t.number=2]="number",t[t.date=3]="date",t[t.time=4]="time",t[t.select=5]="select",t[t.plural=6]="plural",t[t.pound=7]="pound",t[t.tag=8]="tag"})(Jt||(Jt={}));var gc;(function(t){t[t.number=0]="number",t[t.dateTime=1]="dateTime"})(gc||(gc={}));function eE(t){return t.type===Jt.literal}function vP(t){return t.type===Jt.argument}function o3(t){return t.type===Jt.number}function a3(t){return t.type===Jt.date}function l3(t){return t.type===Jt.time}function c3(t){return t.type===Jt.select}function u3(t){return t.type===Jt.plural}function wP(t){return t.type===Jt.pound}function f3(t){return t.type===Jt.tag}function d3(t){return!!(t&&typeof t=="object"&&t.type===gc.number)}function yy(t){return!!(t&&typeof t=="object"&&t.type===gc.dateTime)}var h3=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,EP=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function xP(t){var e={};return t.replace(EP,function(n){var r=n.length;switch(n[0]){case"G":e.era=r===4?"long":r===5?"narrow":"short";break;case"y":e.year=r===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":e.month=["numeric","2-digit","short","long","narrow"][r-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":e.day=["numeric","2-digit"][r-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":e.weekday=r===4?"long":r===5?"narrow":"short";break;case"e":if(r<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"c":if(r<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"a":e.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":e.hourCycle="h12",e.hour=["numeric","2-digit"][r-1];break;case"H":e.hourCycle="h23",e.hour=["numeric","2-digit"][r-1];break;case"K":e.hourCycle="h11",e.hour=["numeric","2-digit"][r-1];break;case"k":e.hourCycle="h24",e.hour=["numeric","2-digit"][r-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":e.minute=["numeric","2-digit"][r-1];break;case"s":e.second=["numeric","2-digit"][r-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":e.timeZoneName=r<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),e}var SP=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function AP(t){if(t.length===0)throw new Error("Number skeleton cannot be empty");for(var e=t.split(SP).filter(function(d){return d.length>0}),n=[],r=0,i=e;r<i.length;r++){var s=i[r],o=s.split("/");if(o.length===0)throw new Error("Invalid number skeleton");for(var a=o[0],l=o.slice(1),c=0,u=l;c<u.length;c++){var f=u[c];if(f.length===0)throw new Error("Invalid number skeleton")}n.push({stem:a,options:l})}return n}function _P(t){return t.replace(/^(.*?)-/,"")}var tE=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,p3=/^(@+)?(\+|#+)?[rs]?$/g,kP=/(\*)(0+)|(#+)(0+)|(0+)/g,g3=/^(0+)$/;function nE(t){var e={};return t[t.length-1]==="r"?e.roundingPriority="morePrecision":t[t.length-1]==="s"&&(e.roundingPriority="lessPrecision"),t.replace(p3,function(n,r,i){return typeof i!="string"?(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length):i==="+"?e.minimumSignificantDigits=r.length:r[0]==="#"?e.maximumSignificantDigits=r.length:(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length+(typeof i=="string"?i.length:0)),""}),e}function m3(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function CP(t){var e;if(t[0]==="E"&&t[1]==="E"?(e={notation:"engineering"},t=t.slice(2)):t[0]==="E"&&(e={notation:"scientific"},t=t.slice(1)),e){var n=t.slice(0,2);if(n==="+!"?(e.signDisplay="always",t=t.slice(2)):n==="+?"&&(e.signDisplay="exceptZero",t=t.slice(2)),!g3.test(t))throw new Error("Malformed concise eng/scientific notation");e.minimumIntegerDigits=t.length}return e}function rE(t){var e={},n=m3(t);return n||e}function TP(t){for(var e={},n=0,r=t;n<r.length;n++){var i=r[n];switch(i.stem){case"percent":case"%":e.style="percent";continue;case"%x100":e.style="percent",e.scale=100;continue;case"currency":e.style="currency",e.currency=i.options[0];continue;case"group-off":case",_":e.useGrouping=!1;continue;case"precision-integer":case".":e.maximumFractionDigits=0;continue;case"measure-unit":case"unit":e.style="unit",e.unit=_P(i.options[0]);continue;case"compact-short":case"K":e.notation="compact",e.compactDisplay="short";continue;case"compact-long":case"KK":e.notation="compact",e.compactDisplay="long";continue;case"scientific":e=$t($t($t({},e),{notation:"scientific"}),i.options.reduce(function(l,c){return $t($t({},l),rE(c))},{}));continue;case"engineering":e=$t($t($t({},e),{notation:"engineering"}),i.options.reduce(function(l,c){return $t($t({},l),rE(c))},{}));continue;case"notation-simple":e.notation="standard";continue;case"unit-width-narrow":e.currencyDisplay="narrowSymbol",e.unitDisplay="narrow";continue;case"unit-width-short":e.currencyDisplay="code",e.unitDisplay="short";continue;case"unit-width-full-name":e.currencyDisplay="name",e.unitDisplay="long";continue;case"unit-width-iso-code":e.currencyDisplay="symbol";continue;case"scale":e.scale=parseFloat(i.options[0]);continue;case"rounding-mode-floor":e.roundingMode="floor";continue;case"rounding-mode-ceiling":e.roundingMode="ceil";continue;case"rounding-mode-down":e.roundingMode="trunc";continue;case"rounding-mode-up":e.roundingMode="expand";continue;case"rounding-mode-half-even":e.roundingMode="halfEven";continue;case"rounding-mode-half-down":e.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":e.roundingMode="halfExpand";continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(kP,function(l,c,u,f,d,h){if(c)e.minimumIntegerDigits=u.length;else{if(f&&d)throw new Error("We currently do not support maximum integer digits");if(h)throw new Error("We currently do not support exact integer digits")}return""});continue}if(g3.test(i.stem)){e.minimumIntegerDigits=i.stem.length;continue}if(tE.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(tE,function(l,c,u,f,d,h){return u==="*"?e.minimumFractionDigits=c.length:f&&f[0]==="#"?e.maximumFractionDigits=f.length:d&&h?(e.minimumFractionDigits=d.length,e.maximumFractionDigits=d.length+h.length):(e.minimumFractionDigits=c.length,e.maximumFractionDigits=c.length),""});var s=i.options[0];s==="w"?e=$t($t({},e),{trailingZeroDisplay:"stripIfInteger"}):s&&(e=$t($t({},e),nE(s)));continue}if(p3.test(i.stem)){e=$t($t({},e),nE(i.stem));continue}var o=m3(i.stem);o&&(e=$t($t({},e),o));var a=CP(i.stem);a&&(e=$t($t({},e),a))}return e}var ed={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function IP(t,e){for(var n="",r=0;r<t.length;r++){var i=t.charAt(r);if(i==="j"){for(var s=0;r+1<t.length&&t.charAt(r+1)===i;)s++,r++;var o=1+(s&1),a=s<2?1:3+(s>>1),l="a",c=OP(e);for((c=="H"||c=="k")&&(a=0);a-- >0;)n+=l;for(;o-- >0;)n=c+n}else i==="J"?n+="H":n+=i}return n}function OP(t){var e=t.hourCycle;if(e===void 0&&t.hourCycles&&t.hourCycles.length&&(e=t.hourCycles[0]),e)switch(e){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var n=t.language,r;n!=="root"&&(r=t.maximize().region);var i=ed[r||""]||ed[n||""]||ed["".concat(n,"-001")]||ed["001"];return i[0]}var Am,MP=new RegExp("^".concat(h3.source,"*")),LP=new RegExp("".concat(h3.source,"*$"));function kt(t,e){return{start:t,end:e}}var $P=!!String.prototype.startsWith&&"_a".startsWith("a",1),NP=!!String.fromCodePoint,PP=!!Object.fromEntries,RP=!!String.prototype.codePointAt,DP=!!String.prototype.trimStart,BP=!!String.prototype.trimEnd,UP=!!Number.isSafeInteger,HP=UP?Number.isSafeInteger:function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<=9007199254740991},by=!0;try{var FP=b3("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");by=((Am=FP.exec("a"))===null||Am===void 0?void 0:Am[0])==="a"}catch{by=!1}var iE=$P?function(e,n,r){return e.startsWith(n,r)}:function(e,n,r){return e.slice(r,r+n.length)===n},vy=NP?String.fromCodePoint:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r="",i=e.length,s=0,o;i>s;){if(o=e[s++],o>1114111)throw RangeError(o+" is not a valid code point");r+=o<65536?String.fromCharCode(o):String.fromCharCode(((o-=65536)>>10)+55296,o%1024+56320)}return r},sE=PP?Object.fromEntries:function(e){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r],o=s[0],a=s[1];n[o]=a}return n},y3=RP?function(e,n){return e.codePointAt(n)}:function(e,n){var r=e.length;if(!(n<0||n>=r)){var i=e.charCodeAt(n),s;return i<55296||i>56319||n+1===r||(s=e.charCodeAt(n+1))<56320||s>57343?i:(i-55296<<10)+(s-56320)+65536}},zP=DP?function(e){return e.trimStart()}:function(e){return e.replace(MP,"")},jP=BP?function(e){return e.trimEnd()}:function(e){return e.replace(LP,"")};function b3(t,e){return new RegExp(t,e)}var wy;if(by){var oE=b3("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");wy=function(e,n){var r;oE.lastIndex=n;var i=oE.exec(e);return(r=i[1])!==null&&r!==void 0?r:""}}else wy=function(e,n){for(var r=[];;){var i=y3(e,n);if(i===void 0||v3(i)||KP(i))break;r.push(i),n+=i>=65536?2:1}return vy.apply(void 0,r)};var VP=(function(){function t(e,n){n===void 0&&(n={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!n.ignoreTag,this.locale=n.locale,this.requiresOtherClause=!!n.requiresOtherClause,this.shouldParseSkeletons=!!n.shouldParseSkeletons}return t.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},t.prototype.parseMessage=function(e,n,r){for(var i=[];!this.isEOF();){var s=this.char();if(s===123){var o=this.parseArgument(e,r);if(o.err)return o;i.push(o.val)}else{if(s===125&&e>0)break;if(s===35&&(n==="plural"||n==="selectordinal")){var a=this.clonePosition();this.bump(),i.push({type:Jt.pound,location:kt(a,this.clonePosition())})}else if(s===60&&!this.ignoreTag&&this.peek()===47){if(r)break;return this.error(St.UNMATCHED_CLOSING_TAG,kt(this.clonePosition(),this.clonePosition()))}else if(s===60&&!this.ignoreTag&&Ey(this.peek()||0)){var o=this.parseTag(e,n);if(o.err)return o;i.push(o.val)}else{var o=this.parseLiteral(e,n);if(o.err)return o;i.push(o.val)}}}return{val:i,err:null}},t.prototype.parseTag=function(e,n){var r=this.clonePosition();this.bump();var i=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:Jt.literal,value:"<".concat(i,"/>"),location:kt(r,this.clonePosition())},err:null};if(this.bumpIf(">")){var s=this.parseMessage(e+1,n,!0);if(s.err)return s;var o=s.val,a=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!Ey(this.char()))return this.error(St.INVALID_TAG,kt(a,this.clonePosition()));var l=this.clonePosition(),c=this.parseTagName();return i!==c?this.error(St.UNMATCHED_CLOSING_TAG,kt(l,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:Jt.tag,value:i,children:o,location:kt(r,this.clonePosition())},err:null}:this.error(St.INVALID_TAG,kt(a,this.clonePosition())))}else return this.error(St.UNCLOSED_TAG,kt(r,this.clonePosition()))}else return this.error(St.INVALID_TAG,kt(r,this.clonePosition()))},t.prototype.parseTagName=function(){var e=this.offset();for(this.bump();!this.isEOF()&&WP(this.char());)this.bump();return this.message.slice(e,this.offset())},t.prototype.parseLiteral=function(e,n){for(var r=this.clonePosition(),i="";;){var s=this.tryParseQuote(n);if(s){i+=s;continue}var o=this.tryParseUnquoted(e,n);if(o){i+=o;continue}var a=this.tryParseLeftAngleBracket();if(a){i+=a;continue}break}var l=kt(r,this.clonePosition());return{val:{type:Jt.literal,value:i,location:l},err:null}},t.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!qP(this.peek()||0))?(this.bump(),"<"):null},t.prototype.tryParseQuote=function(e){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(e==="plural"||e==="selectordinal")break;return null;default:return null}this.bump();var n=[this.char()];for(this.bump();!this.isEOF();){var r=this.char();if(r===39)if(this.peek()===39)n.push(39),this.bump();else{this.bump();break}else n.push(r);this.bump()}return vy.apply(void 0,n)},t.prototype.tryParseUnquoted=function(e,n){if(this.isEOF())return null;var r=this.char();return r===60||r===123||r===35&&(n==="plural"||n==="selectordinal")||r===125&&e>0?null:(this.bump(),vy(r))},t.prototype.parseArgument=function(e,n){var r=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(St.EXPECT_ARGUMENT_CLOSING_BRACE,kt(r,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(St.EMPTY_ARGUMENT,kt(r,this.clonePosition()));var i=this.parseIdentifierIfPossible().value;if(!i)return this.error(St.MALFORMED_ARGUMENT,kt(r,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(St.EXPECT_ARGUMENT_CLOSING_BRACE,kt(r,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:Jt.argument,value:i,location:kt(r,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(St.EXPECT_ARGUMENT_CLOSING_BRACE,kt(r,this.clonePosition())):this.parseArgumentOptions(e,n,i,r);default:return this.error(St.MALFORMED_ARGUMENT,kt(r,this.clonePosition()))}},t.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),n=this.offset(),r=wy(this.message,n),i=n+r.length;this.bumpTo(i);var s=this.clonePosition(),o=kt(e,s);return{value:r,location:o}},t.prototype.parseArgumentOptions=function(e,n,r,i){var s,o=this.clonePosition(),a=this.parseIdentifierIfPossible().value,l=this.clonePosition();switch(a){case"":return this.error(St.EXPECT_ARGUMENT_TYPE,kt(o,l));case"number":case"date":case"time":{this.bumpSpace();var c=null;if(this.bumpIf(",")){this.bumpSpace();var u=this.clonePosition(),f=this.parseSimpleArgStyleIfPossible();if(f.err)return f;var d=jP(f.val);if(d.length===0)return this.error(St.EXPECT_ARGUMENT_STYLE,kt(this.clonePosition(),this.clonePosition()));var h=kt(u,this.clonePosition());c={style:d,styleLocation:h}}var p=this.tryParseArgumentClose(i);if(p.err)return p;var g=kt(i,this.clonePosition());if(c&&iE(c?.style,"::",0)){var m=zP(c.style.slice(2));if(a==="number"){var f=this.parseNumberSkeletonFromString(m,c.styleLocation);return f.err?f:{val:{type:Jt.number,value:r,location:g,style:f.val},err:null}}else{if(m.length===0)return this.error(St.EXPECT_DATE_TIME_SKELETON,g);var v=m;this.locale&&(v=IP(m,this.locale));var d={type:gc.dateTime,pattern:v,location:c.styleLocation,parsedOptions:this.shouldParseSkeletons?xP(v):{}},x=a==="date"?Jt.date:Jt.time;return{val:{type:x,value:r,location:g,style:d},err:null}}}return{val:{type:a==="number"?Jt.number:a==="date"?Jt.date:Jt.time,value:r,location:g,style:(s=c?.style)!==null&&s!==void 0?s:null},err:null}}case"plural":case"selectordinal":case"select":{var C=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(St.EXPECT_SELECT_ARGUMENT_OPTIONS,kt(C,$t({},C)));this.bumpSpace();var N=this.parseIdentifierIfPossible(),O=0;if(a!=="select"&&N.value==="offset"){if(!this.bumpIf(":"))return this.error(St.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,kt(this.clonePosition(),this.clonePosition()));this.bumpSpace();var f=this.tryParseDecimalInteger(St.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,St.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(f.err)return f;this.bumpSpace(),N=this.parseIdentifierIfPossible(),O=f.val}var A=this.tryParsePluralOrSelectOptions(e,a,n,N);if(A.err)return A;var p=this.tryParseArgumentClose(i);if(p.err)return p;var P=kt(i,this.clonePosition());return a==="select"?{val:{type:Jt.select,value:r,options:sE(A.val),location:P},err:null}:{val:{type:Jt.plural,value:r,options:sE(A.val),offset:O,pluralType:a==="plural"?"cardinal":"ordinal",location:P},err:null}}default:return this.error(St.INVALID_ARGUMENT_TYPE,kt(o,l))}},t.prototype.tryParseArgumentClose=function(e){return this.isEOF()||this.char()!==125?this.error(St.EXPECT_ARGUMENT_CLOSING_BRACE,kt(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},t.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,n=this.clonePosition();!this.isEOF();){var r=this.char();switch(r){case 39:{this.bump();var i=this.clonePosition();if(!this.bumpUntil("'"))return this.error(St.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,kt(i,this.clonePosition()));this.bump();break}case 123:{e+=1,this.bump();break}case 125:{if(e>0)e-=1;else return{val:this.message.slice(n.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(n.offset,this.offset()),err:null}},t.prototype.parseNumberSkeletonFromString=function(e,n){var r=[];try{r=AP(e)}catch{return this.error(St.INVALID_NUMBER_SKELETON,n)}return{val:{type:gc.number,tokens:r,location:n,parsedOptions:this.shouldParseSkeletons?TP(r):{}},err:null}},t.prototype.tryParsePluralOrSelectOptions=function(e,n,r,i){for(var s,o=!1,a=[],l=new Set,c=i.value,u=i.location;;){if(c.length===0){var f=this.clonePosition();if(n!=="select"&&this.bumpIf("=")){var d=this.tryParseDecimalInteger(St.EXPECT_PLURAL_ARGUMENT_SELECTOR,St.INVALID_PLURAL_ARGUMENT_SELECTOR);if(d.err)return d;u=kt(f,this.clonePosition()),c=this.message.slice(f.offset,this.offset())}else break}if(l.has(c))return this.error(n==="select"?St.DUPLICATE_SELECT_ARGUMENT_SELECTOR:St.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,u);c==="other"&&(o=!0),this.bumpSpace();var h=this.clonePosition();if(!this.bumpIf("{"))return this.error(n==="select"?St.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:St.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,kt(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,n,r);if(p.err)return p;var g=this.tryParseArgumentClose(h);if(g.err)return g;a.push([c,{value:p.val,location:kt(h,this.clonePosition())}]),l.add(c),this.bumpSpace(),s=this.parseIdentifierIfPossible(),c=s.value,u=s.location}return a.length===0?this.error(n==="select"?St.EXPECT_SELECT_ARGUMENT_SELECTOR:St.EXPECT_PLURAL_ARGUMENT_SELECTOR,kt(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!o?this.error(St.MISSING_OTHER_CLAUSE,kt(this.clonePosition(),this.clonePosition())):{val:a,err:null}},t.prototype.tryParseDecimalInteger=function(e,n){var r=1,i=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(r=-1);for(var s=!1,o=0;!this.isEOF();){var a=this.char();if(a>=48&&a<=57)s=!0,o=o*10+(a-48),this.bump();else break}var l=kt(i,this.clonePosition());return s?(o*=r,HP(o)?{val:o,err:null}:this.error(n,l)):this.error(e,l)},t.prototype.offset=function(){return this.position.offset},t.prototype.isEOF=function(){return this.offset()===this.message.length},t.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},t.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var n=y3(this.message,e);if(n===void 0)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return n},t.prototype.error=function(e,n){return{val:null,err:{kind:e,message:this.message,location:n}}},t.prototype.bump=function(){if(!this.isEOF()){var e=this.char();e===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},t.prototype.bumpIf=function(e){if(iE(this.message,e,this.offset())){for(var n=0;n<e.length;n++)this.bump();return!0}return!1},t.prototype.bumpUntil=function(e){var n=this.offset(),r=this.message.indexOf(e,n);return r>=0?(this.bumpTo(r),!0):(this.bumpTo(this.message.length),!1)},t.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var n=this.offset();if(n===e)break;if(n>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},t.prototype.bumpSpace=function(){for(;!this.isEOF()&&v3(this.char());)this.bump()},t.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),n=this.offset(),r=this.message.charCodeAt(n+(e>=65536?2:1));return r??null},t})();function Ey(t){return t>=97&&t<=122||t>=65&&t<=90}function qP(t){return Ey(t)||t===47}function WP(t){return t===45||t===46||t>=48&&t<=57||t===95||t>=97&&t<=122||t>=65&&t<=90||t==183||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}function v3(t){return t>=9&&t<=13||t===32||t===133||t>=8206&&t<=8207||t===8232||t===8233}function KP(t){return t>=33&&t<=35||t===36||t>=37&&t<=39||t===40||t===41||t===42||t===43||t===44||t===45||t>=46&&t<=47||t>=58&&t<=59||t>=60&&t<=62||t>=63&&t<=64||t===91||t===92||t===93||t===94||t===96||t===123||t===124||t===125||t===126||t===161||t>=162&&t<=165||t===166||t===167||t===169||t===171||t===172||t===174||t===176||t===177||t===182||t===187||t===191||t===215||t===247||t>=8208&&t<=8213||t>=8214&&t<=8215||t===8216||t===8217||t===8218||t>=8219&&t<=8220||t===8221||t===8222||t===8223||t>=8224&&t<=8231||t>=8240&&t<=8248||t===8249||t===8250||t>=8251&&t<=8254||t>=8257&&t<=8259||t===8260||t===8261||t===8262||t>=8263&&t<=8273||t===8274||t===8275||t>=8277&&t<=8286||t>=8592&&t<=8596||t>=8597&&t<=8601||t>=8602&&t<=8603||t>=8604&&t<=8607||t===8608||t>=8609&&t<=8610||t===8611||t>=8612&&t<=8613||t===8614||t>=8615&&t<=8621||t===8622||t>=8623&&t<=8653||t>=8654&&t<=8655||t>=8656&&t<=8657||t===8658||t===8659||t===8660||t>=8661&&t<=8691||t>=8692&&t<=8959||t>=8960&&t<=8967||t===8968||t===8969||t===8970||t===8971||t>=8972&&t<=8991||t>=8992&&t<=8993||t>=8994&&t<=9e3||t===9001||t===9002||t>=9003&&t<=9083||t===9084||t>=9085&&t<=9114||t>=9115&&t<=9139||t>=9140&&t<=9179||t>=9180&&t<=9185||t>=9186&&t<=9254||t>=9255&&t<=9279||t>=9280&&t<=9290||t>=9291&&t<=9311||t>=9472&&t<=9654||t===9655||t>=9656&&t<=9664||t===9665||t>=9666&&t<=9719||t>=9720&&t<=9727||t>=9728&&t<=9838||t===9839||t>=9840&&t<=10087||t===10088||t===10089||t===10090||t===10091||t===10092||t===10093||t===10094||t===10095||t===10096||t===10097||t===10098||t===10099||t===10100||t===10101||t>=10132&&t<=10175||t>=10176&&t<=10180||t===10181||t===10182||t>=10183&&t<=10213||t===10214||t===10215||t===10216||t===10217||t===10218||t===10219||t===10220||t===10221||t===10222||t===10223||t>=10224&&t<=10239||t>=10240&&t<=10495||t>=10496&&t<=10626||t===10627||t===10628||t===10629||t===10630||t===10631||t===10632||t===10633||t===10634||t===10635||t===10636||t===10637||t===10638||t===10639||t===10640||t===10641||t===10642||t===10643||t===10644||t===10645||t===10646||t===10647||t===10648||t>=10649&&t<=10711||t===10712||t===10713||t===10714||t===10715||t>=10716&&t<=10747||t===10748||t===10749||t>=10750&&t<=11007||t>=11008&&t<=11055||t>=11056&&t<=11076||t>=11077&&t<=11078||t>=11079&&t<=11084||t>=11085&&t<=11123||t>=11124&&t<=11125||t>=11126&&t<=11157||t===11158||t>=11159&&t<=11263||t>=11776&&t<=11777||t===11778||t===11779||t===11780||t===11781||t>=11782&&t<=11784||t===11785||t===11786||t===11787||t===11788||t===11789||t>=11790&&t<=11798||t===11799||t>=11800&&t<=11801||t===11802||t===11803||t===11804||t===11805||t>=11806&&t<=11807||t===11808||t===11809||t===11810||t===11811||t===11812||t===11813||t===11814||t===11815||t===11816||t===11817||t>=11818&&t<=11822||t===11823||t>=11824&&t<=11833||t>=11834&&t<=11835||t>=11836&&t<=11839||t===11840||t===11841||t===11842||t>=11843&&t<=11855||t>=11856&&t<=11857||t===11858||t>=11859&&t<=11903||t>=12289&&t<=12291||t===12296||t===12297||t===12298||t===12299||t===12300||t===12301||t===12302||t===12303||t===12304||t===12305||t>=12306&&t<=12307||t===12308||t===12309||t===12310||t===12311||t===12312||t===12313||t===12314||t===12315||t===12316||t===12317||t>=12318&&t<=12319||t===12320||t===12336||t===64830||t===64831||t>=65093&&t<=65094}function xy(t){t.forEach(function(e){if(delete e.location,c3(e)||u3(e))for(var n in e.options)delete e.options[n].location,xy(e.options[n].value);else o3(e)&&d3(e.style)||(a3(e)||l3(e))&&yy(e.style)?delete e.style.location:f3(e)&&xy(e.children)})}function GP(t,e){e===void 0&&(e={}),e=$t({shouldParseSkeletons:!0,requiresOtherClause:!0},e);var n=new VP(t,e).parse();if(n.err){var r=SyntaxError(St[n.err.kind]);throw r.location=n.err.location,r.originalMessage=n.err.message,r}return e?.captureLocation||xy(n.val),n.val}var mc;(function(t){t.MISSING_VALUE="MISSING_VALUE",t.INVALID_VALUE="INVALID_VALUE",t.MISSING_INTL_API="MISSING_INTL_API"})(mc||(mc={}));var Op=(function(t){Ip(e,t);function e(n,r,i){var s=t.call(this,n)||this;return s.code=r,s.originalMessage=i,s}return e.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},e})(Error),aE=(function(t){Ip(e,t);function e(n,r,i,s){return t.call(this,'Invalid values for "'.concat(n,'": "').concat(r,'". Options are "').concat(Object.keys(i).join('", "'),'"'),mc.INVALID_VALUE,s)||this}return e})(Op),ZP=(function(t){Ip(e,t);function e(n,r,i){return t.call(this,'Value for "'.concat(n,'" must be of type ').concat(r),mc.INVALID_VALUE,i)||this}return e})(Op),YP=(function(t){Ip(e,t);function e(n,r){return t.call(this,'The intl string context variable "'.concat(n,'" was not provided to the string "').concat(r,'"'),mc.MISSING_VALUE,r)||this}return e})(Op),Er;(function(t){t[t.literal=0]="literal",t[t.object=1]="object"})(Er||(Er={}));function JP(t){return t.length<2?t:t.reduce(function(e,n){var r=e[e.length-1];return!r||r.type!==Er.literal||n.type!==Er.literal?e.push(n):r.value+=n.value,e},[])}function XP(t){return typeof t=="function"}function Sd(t,e,n,r,i,s,o){if(t.length===1&&eE(t[0]))return[{type:Er.literal,value:t[0].value}];for(var a=[],l=0,c=t;l<c.length;l++){var u=c[l];if(eE(u)){a.push({type:Er.literal,value:u.value});continue}if(wP(u)){typeof s=="number"&&a.push({type:Er.literal,value:n.getNumberFormat(e).format(s)});continue}var f=u.value;if(!(i&&f in i))throw new YP(f,o);var d=i[f];if(vP(u)){(!d||typeof d=="string"||typeof d=="number")&&(d=typeof d=="string"||typeof d=="number"?String(d):""),a.push({type:typeof d=="string"?Er.literal:Er.object,value:d});continue}if(a3(u)){var h=typeof u.style=="string"?r.date[u.style]:yy(u.style)?u.style.parsedOptions:void 0;a.push({type:Er.literal,value:n.getDateTimeFormat(e,h).format(d)});continue}if(l3(u)){var h=typeof u.style=="string"?r.time[u.style]:yy(u.style)?u.style.parsedOptions:r.time.medium;a.push({type:Er.literal,value:n.getDateTimeFormat(e,h).format(d)});continue}if(o3(u)){var h=typeof u.style=="string"?r.number[u.style]:d3(u.style)?u.style.parsedOptions:void 0;h&&h.scale&&(d=d*(h.scale||1)),a.push({type:Er.literal,value:n.getNumberFormat(e,h).format(d)});continue}if(f3(u)){var p=u.children,g=u.value,m=i[g];if(!XP(m))throw new ZP(g,"function",o);var v=Sd(p,e,n,r,i,s),x=m(v.map(function(O){return O.value}));Array.isArray(x)||(x=[x]),a.push.apply(a,x.map(function(O){return{type:typeof O=="string"?Er.literal:Er.object,value:O}}))}if(c3(u)){var C=u.options[d]||u.options.other;if(!C)throw new aE(u.value,d,Object.keys(u.options),o);a.push.apply(a,Sd(C.value,e,n,r,i));continue}if(u3(u)){var C=u.options["=".concat(d)];if(!C){if(!Intl.PluralRules)throw new Op(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,mc.MISSING_INTL_API,o);var N=n.getPluralRules(e,{type:u.pluralType}).select(d-(u.offset||0));C=u.options[N]||u.options.other}if(!C)throw new aE(u.value,d,Object.keys(u.options),o);a.push.apply(a,Sd(C.value,e,n,r,i,d-(u.offset||0)));continue}}return JP(a)}function QP(t,e){return e?$t($t($t({},t||{}),e||{}),Object.keys(t).reduce(function(n,r){return n[r]=$t($t({},t[r]),e[r]||{}),n},{})):t}function eR(t,e){return e?Object.keys(t).reduce(function(n,r){return n[r]=QP(t[r],e[r]),n},$t({},t)):t}function _m(t){return{create:function(){return{get:function(e){return t[e]},set:function(e,n){t[e]=n}}}}}function tR(t){return t===void 0&&(t={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:xm(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.NumberFormat).bind.apply(e,Em([void 0],n,!1)))},{cache:_m(t.number),strategy:Sm.variadic}),getDateTimeFormat:xm(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.DateTimeFormat).bind.apply(e,Em([void 0],n,!1)))},{cache:_m(t.dateTime),strategy:Sm.variadic}),getPluralRules:xm(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.PluralRules).bind.apply(e,Em([void 0],n,!1)))},{cache:_m(t.pluralRules),strategy:Sm.variadic})}}var w3=(function(){function t(e,n,r,i){n===void 0&&(n=t.defaultLocale);var s=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(l){var c=s.formatToParts(l);if(c.length===1)return c[0].value;var u=c.reduce(function(f,d){return!f.length||d.type!==Er.literal||typeof f[f.length-1]!="string"?f.push(d.value):f[f.length-1]+=d.value,f},[]);return u.length<=1?u[0]||"":u},this.formatToParts=function(l){return Sd(s.ast,s.locales,s.formatters,s.formats,l,void 0,s.message)},this.resolvedOptions=function(){var l;return{locale:((l=s.resolvedLocale)===null||l===void 0?void 0:l.toString())||Intl.NumberFormat.supportedLocalesOf(s.locales)[0]}},this.getAst=function(){return s.ast},this.locales=n,this.resolvedLocale=t.resolveLocale(n),typeof e=="string"){if(this.message=e,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var o=i||{};o.formatters;var a=fP(o,["formatters"]);this.ast=t.__parse(e,$t($t({},a),{locale:this.resolvedLocale}))}else this.ast=e;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=eR(t.formats,r),this.formatters=i&&i.formatters||tR(this.formatterCache)}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.resolveLocale=function(e){if(!(typeof Intl.Locale>"u")){var n=Intl.NumberFormat.supportedLocalesOf(e);return n.length>0?new Intl.Locale(n[0]):new Intl.Locale(typeof e=="string"?e:e[0])}},t.__parse=GP,t.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t})();function nR(t,e){if(e==null)return;if(e in t)return t[e];const n=e.split(".");let r=t;for(let i=0;i<n.length;i++)if(typeof r=="object"){if(i>0){const s=n.slice(i,n.length).join(".");if(s in r){r=r[s];break}}r=r[n[i]]}else r=void 0;return r}const Ko={},rR=(t,e,n)=>n&&(e in Ko||(Ko[e]={}),t in Ko[e]||(Ko[e][t]=n),n),E3=(t,e)=>{if(e==null)return;if(e in Ko&&t in Ko[e])return Ko[e][t];const n=Tf(e);for(let r=0;r<n.length;r++){const i=n[r],s=sR(i,t);if(s)return rR(t,e,s)}};let cv;const $c=Ei({});function iR(t){return cv[t]||null}function uv(t){return t in cv}function sR(t,e){if(!uv(t))return null;const n=iR(t);return nR(n,e)}function oR(t){if(t==null)return;const e=Tf(t);for(let n=0;n<e.length;n++){const r=e[n];if(uv(r))return r}}function aR(t,...e){delete Ko[t],$c.update(n=>(n[t]=uP.all([n[t]||{},...e]),n))}Gs([$c],([t])=>Object.keys(t));$c.subscribe(t=>cv=t);const xu={};function lR(t){xu[t]=new Set}function cR(t,e){xu[t].delete(e),xu[t].size===0&&delete xu[t]}function Su(t){return xu[t]}function uR(t){return Tf(t).map(e=>{const n=Su(e);return[e,n?[...n]:[]]}).filter(([,e])=>e.length>0)}function Jd(t){return t==null?!1:Tf(t).some(e=>{var n;return(n=Su(e))==null?void 0:n.size})}function fR(t,e){return Promise.all(e.map(r=>(cR(t,r),r().then(i=>i.default||i)))).then(r=>aR(t,...r))}const eu={};function fv(t){if(!Jd(t))return t in eu?eu[t]:Promise.resolve();const e=uR(t);return eu[t]=Promise.all(e.map(([n,r])=>fR(n,r))).then(()=>{if(Jd(t))return fv(t);delete eu[t]}),eu[t]}function x3(t,e){Su(t)||lR(t);const n=Su(t);Su(t).has(e)||(uv(t)||$c.update(r=>(r[t]={},r)),n.add(e))}var lE=Object.getOwnPropertySymbols,dR=Object.prototype.hasOwnProperty,hR=Object.prototype.propertyIsEnumerable,pR=(t,e)=>{var n={};for(var r in t)dR.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&lE)for(var r of lE(t))e.indexOf(r)<0&&hR.call(t,r)&&(n[r]=t[r]);return n};const gR={number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};function mR({locale:t,id:e}){console.warn(`[svelte-i18n] The message "${e}" was not found in "${Tf(t).join('", "')}".${Jd(lo())?`

Note: there are at least one loader still registered to this locale that wasn't executed.`:""}`)}const yR={fallbackLocale:null,loadingDelay:200,formats:gR,warnOnMissingMessages:!0,handleMissingMessage:void 0,ignoreTag:!0},hu=yR;function cl(){return hu}function bR(t){const e=t,{formats:n}=e,r=pR(e,["formats"]);let i=t.fallbackLocale;if(t.initialLocale)try{w3.resolveLocale(t.initialLocale)&&(i=t.initialLocale)}catch{console.warn(`[svelte-i18n] The initial locale "${t.initialLocale}" is not a valid locale.`)}return r.warnOnMissingMessages&&(delete r.warnOnMissingMessages,r.handleMissingMessage==null?r.handleMissingMessage=mR:console.warn('[svelte-i18n] The "warnOnMissingMessages" option is deprecated. Please use the "handleMissingMessage" option instead.')),Object.assign(hu,r,{initialLocale:i}),n&&("number"in n&&Object.assign(hu.formats.number,n.number),"date"in n&&Object.assign(hu.formats.date,n.date),"time"in n&&Object.assign(hu.formats.time,n.time)),Di.set(i)}const km=Ei(!1);var vR=Object.defineProperty,wR=Object.defineProperties,ER=Object.getOwnPropertyDescriptors,cE=Object.getOwnPropertySymbols,xR=Object.prototype.hasOwnProperty,SR=Object.prototype.propertyIsEnumerable,uE=(t,e,n)=>e in t?vR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,AR=(t,e)=>{for(var n in e||(e={}))xR.call(e,n)&&uE(t,n,e[n]);if(cE)for(var n of cE(e))SR.call(e,n)&&uE(t,n,e[n]);return t},_R=(t,e)=>wR(t,ER(e));let Sy;const Xd=Ei(null);function fE(t){return t.split("-").map((e,n,r)=>r.slice(0,n+1).join("-")).reverse()}function Tf(t,e=cl().fallbackLocale){const n=fE(t);return e?[...new Set([...n,...fE(e)])]:n}function lo(){return Sy??void 0}Xd.subscribe(t=>{Sy=t??void 0,typeof window<"u"&&t!=null&&document.documentElement.setAttribute("lang",t)});const kR=t=>{if(t&&oR(t)&&Jd(t)){const{loadingDelay:e}=cl();let n;return typeof window<"u"&&lo()!=null&&e?n=window.setTimeout(()=>km.set(!0),e):km.set(!0),fv(t).then(()=>{Xd.set(t)}).finally(()=>{clearTimeout(n),km.set(!1)})}return Xd.set(t)},Di=_R(AR({},Xd),{set:kR}),CR=()=>typeof window>"u"?null:window.navigator.language||window.navigator.languages[0],Mp=t=>{const e=Object.create(null);return r=>{const i=JSON.stringify(r);return i in e?e[i]:e[i]=t(r)}};var TR=Object.defineProperty,Qd=Object.getOwnPropertySymbols,S3=Object.prototype.hasOwnProperty,A3=Object.prototype.propertyIsEnumerable,dE=(t,e,n)=>e in t?TR(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,dv=(t,e)=>{for(var n in e||(e={}))S3.call(e,n)&&dE(t,n,e[n]);if(Qd)for(var n of Qd(e))A3.call(e,n)&&dE(t,n,e[n]);return t},Nc=(t,e)=>{var n={};for(var r in t)S3.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Qd)for(var r of Qd(t))e.indexOf(r)<0&&A3.call(t,r)&&(n[r]=t[r]);return n};const Wu=(t,e)=>{const{formats:n}=cl();if(t in n&&e in n[t])return n[t][e];throw new Error(`[svelte-i18n] Unknown "${e}" ${t} format.`)},IR=Mp(t=>{var e=t,{locale:n,format:r}=e,i=Nc(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return r&&(i=Wu("number",r)),new Intl.NumberFormat(n,i)}),OR=Mp(t=>{var e=t,{locale:n,format:r}=e,i=Nc(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return r?i=Wu("date",r):Object.keys(i).length===0&&(i=Wu("date","short")),new Intl.DateTimeFormat(n,i)}),MR=Mp(t=>{var e=t,{locale:n,format:r}=e,i=Nc(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return r?i=Wu("time",r):Object.keys(i).length===0&&(i=Wu("time","short")),new Intl.DateTimeFormat(n,i)}),LR=(t={})=>{var e=t,{locale:n=lo()}=e,r=Nc(e,["locale"]);return IR(dv({locale:n},r))},$R=(t={})=>{var e=t,{locale:n=lo()}=e,r=Nc(e,["locale"]);return OR(dv({locale:n},r))},NR=(t={})=>{var e=t,{locale:n=lo()}=e,r=Nc(e,["locale"]);return MR(dv({locale:n},r))},PR=Mp((t,e=lo())=>new w3(t,e,cl().formats,{ignoreTag:cl().ignoreTag})),RR=(t,e={})=>{var n,r,i,s;let o=e;typeof t=="object"&&(o=t,t=o.id);const{values:a,locale:l=lo(),default:c}=o;if(l==null)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let u=E3(t,l);if(!u)u=(s=(i=(r=(n=cl()).handleMissingMessage)==null?void 0:r.call(n,{locale:l,id:t,defaultValue:c}))!=null?i:c)!=null?s:t;else if(typeof u!="string")return console.warn(`[svelte-i18n] Message with id "${t}" must be of type "string", found: "${typeof u}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),u;if(!a)return u;let f=u;try{f=PR(u,l).format(a)}catch(d){d instanceof Error&&console.warn(`[svelte-i18n] Message "${t}" has syntax error:`,d.message)}return f},DR=(t,e)=>NR(e).format(t),BR=(t,e)=>$R(e).format(t),UR=(t,e)=>LR(e).format(t),HR=(t,e=lo())=>E3(t,e),mr=Gs([Di,$c],()=>RR);Gs([Di],()=>DR);Gs([Di],()=>BR);Gs([Di],()=>UR);Gs([Di,$c],()=>HR);function FR(t){return fv(lo()||cl().initialLocale)}x3("ja",()=>Tp(()=>import("./ja-C1UdeksW.js"),[]));x3("en",()=>Tp(()=>import("./en-C0KPw4fy.js"),[]));function zR(){const t=localStorage.getItem("locale"),e=CR();return t&&(t==="ja"||t==="en")?t:e&&e.startsWith("ja")?"ja":"en"}const _3=zR();bR({fallbackLocale:"ja",initialLocale:_3,loadingDelay:0});Di.set(_3);function hE(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function k3(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function jR(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");hE(t.outputLen),hE(t.blockLen)}function eh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function VR(t,e){k3(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Cm=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const C3=t=>t instanceof Uint8Array,Tm=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Wi=(t,e)=>t<<32-e|t>>>e,qR=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!qR)throw new Error("Non little-endian hardware is not supported");function WR(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function hv(t){if(typeof t=="string"&&(t=WR(t)),!C3(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function KR(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!C3(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let T3=class{clone(){return this._cloneInto()}};function GR(t){const e=r=>t().update(hv(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function I3(t=32){if(Cm&&typeof Cm.getRandomValues=="function")return Cm.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function ZR(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}let YR=class extends T3{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Tm(this.buffer)}update(e){eh(this);const{view:n,buffer:r,blockLen:i}=this;e=hv(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=Tm(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){eh(this),VR(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;ZR(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Tm(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const JR=(t,e,n)=>t&e^~t&n,XR=(t,e,n)=>t&e^t&n^e&n,QR=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),_o=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ko=new Uint32Array(64);let eD=class extends YR{constructor(){super(64,32,8,!1),this.A=_o[0]|0,this.B=_o[1]|0,this.C=_o[2]|0,this.D=_o[3]|0,this.E=_o[4]|0,this.F=_o[5]|0,this.G=_o[6]|0,this.H=_o[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let f=0;f<16;f++,n+=4)ko[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const d=ko[f-15],h=ko[f-2],p=Wi(d,7)^Wi(d,18)^d>>>3,g=Wi(h,17)^Wi(h,19)^h>>>10;ko[f]=g+ko[f-7]+p+ko[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const d=Wi(a,6)^Wi(a,11)^Wi(a,25),h=u+d+JR(a,l,c)+QR[f]+ko[f]|0,g=(Wi(r,2)^Wi(r,13)^Wi(r,22))+XR(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){ko.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Ay=GR(()=>new eD);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const O3=BigInt(0),Lp=BigInt(1),tD=BigInt(2),$p=t=>t instanceof Uint8Array,nD=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function yc(t){if(!$p(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=nD[t[n]];return e}function M3(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function pv(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function bc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function zr(t){return pv(yc(t))}function gv(t){if(!$p(t))throw new Error("Uint8Array expected");return pv(yc(Uint8Array.from(t).reverse()))}function da(t,e){return bc(t.toString(16).padStart(e*2,"0"))}function mv(t,e){return da(t,e).reverse()}function rD(t){return bc(M3(t))}function ar(t,e,n){let r;if(typeof e=="string")try{r=bc(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if($p(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function ul(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!$p(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function iD(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function sD(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function oD(t){let e;for(e=0;t>O3;t>>=Lp,e+=1);return e}function aD(t,e){return t>>BigInt(e)&Lp}const lD=(t,e,n)=>t|(n?Lp:O3)<<BigInt(e),yv=t=>(tD<<BigInt(t-1))-Lp,Im=t=>new Uint8Array(t),pE=t=>Uint8Array.from(t);function L3(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Im(t),i=Im(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...f)=>n(i,r,...f),l=(f=Im())=>{i=a(pE([0]),f),r=a(),f.length!==0&&(i=a(pE([1]),f),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const d=[];for(;f<e;){r=a();const h=r.slice();d.push(h),f+=r.length}return ul(...d)};return(f,d)=>{o(),l(f);let h;for(;!(h=d(c()));)l();return o(),h}}const cD={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function If(t,e,n={}){const r=(i,s,o)=>{const a=cD[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const uD=Object.freeze(Object.defineProperty({__proto__:null,bitGet:aD,bitLen:oD,bitMask:yv,bitSet:lD,bytesToHex:yc,bytesToNumberBE:zr,bytesToNumberLE:gv,concatBytes:ul,createHmacDrbg:L3,ensureBytes:ar,equalBytes:iD,hexToBytes:bc,hexToNumber:pv,numberToBytesBE:da,numberToBytesLE:mv,numberToHexUnpadded:M3,numberToVarBytesBE:rD,utf8ToBytes:sD,validateObject:If},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Pn=BigInt(0),yn=BigInt(1),Ba=BigInt(2),fD=BigInt(3),_y=BigInt(4),gE=BigInt(5),mE=BigInt(8);BigInt(9);BigInt(16);function Gn(t,e){const n=t%e;return n>=Pn?n:e+n}function dD(t,e,n){if(n<=Pn||e<Pn)throw new Error("Expected power/modulo > 0");if(n===yn)return Pn;let r=yn;for(;e>Pn;)e&yn&&(r=r*t%n),t=t*t%n,e>>=yn;return r}function li(t,e,n){let r=t;for(;e-- >Pn;)r*=r,r%=n;return r}function ky(t,e){if(t===Pn||e<=Pn)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Gn(t,e),r=e,i=Pn,s=yn;for(;n!==Pn;){const a=r/n,l=r%n,c=i-s*a;r=n,n=l,i=s,s=c}if(r!==yn)throw new Error("invert: does not exist");return Gn(i,e)}function hD(t){const e=(t-yn)/Ba;let n,r,i;for(n=t-yn,r=0;n%Ba===Pn;n/=Ba,r++);for(i=Ba;i<t&&dD(i,e,t)!==t-yn;i++);if(r===1){const o=(t+yn)/_y;return function(l,c){const u=l.pow(c,o);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+yn)/Ba;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=r,u=a.pow(a.mul(a.ONE,i),n),f=a.pow(l,s),d=a.pow(l,n);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let h=1;for(let g=a.sqr(d);h<c&&!a.eql(g,a.ONE);h++)g=a.sqr(g);const p=a.pow(u,yn<<BigInt(c-h-1));u=a.sqr(p),f=a.mul(f,p),d=a.mul(d,u),c=h}return f}}function pD(t){if(t%_y===fD){const e=(t+yn)/_y;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%mE===gE){const e=(t-gE)/mE;return function(r,i){const s=r.mul(i,Ba),o=r.pow(s,e),a=r.mul(i,o),l=r.mul(r.mul(a,Ba),o),c=r.mul(a,r.sub(l,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return hD(t)}const gD=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function mD(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=gD.reduce((r,i)=>(r[i]="function",r),e);return If(t,n)}function yD(t,e,n){if(n<Pn)throw new Error("Expected power > 0");if(n===Pn)return t.ONE;if(n===yn)return e;let r=t.ONE,i=e;for(;n>Pn;)n&yn&&(r=t.mul(r,i)),i=t.sqr(i),n>>=yn;return r}function bD(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function $3(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function vD(t,e,n=!1,r={}){if(t<=Pn)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=$3(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=pD(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:yv(i),ZERO:Pn,ONE:yn,create:l=>Gn(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Pn<=l&&l<t},is0:l=>l===Pn,isOdd:l=>(l&yn)===yn,neg:l=>Gn(-l,t),eql:(l,c)=>l===c,sqr:l=>Gn(l*l,t),add:(l,c)=>Gn(l+c,t),sub:(l,c)=>Gn(l-c,t),mul:(l,c)=>Gn(l*c,t),pow:(l,c)=>yD(a,l,c),div:(l,c)=>Gn(l*ky(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>ky(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>bD(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?mv(l,s):da(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?gv(l):zr(l)}});return Object.freeze(a)}function N3(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function P3(t){const e=N3(t);return e+Math.ceil(e/2)}function wD(t,e,n=!1){const r=t.length,i=N3(e),s=P3(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?zr(t):gv(t),a=Gn(o,e-yn)+yn;return n?mv(a,i):da(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ED=BigInt(0),Om=BigInt(1);function xD(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>ED;)s&Om&&(o=o.add(a)),a=a.double(),s>>=Om;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let f=0;f<o;f++){u=c,l.push(u);for(let d=1;d<a;d++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const f=BigInt(2**i-1),d=2**i,h=BigInt(i);for(let p=0;p<a;p++){const g=p*l;let m=Number(o&f);o>>=h,m>l&&(m-=d,o+=Om);const v=g,x=g+Math.abs(m)-1,C=p%2!==0,N=m<0;m===0?u=u.add(n(C,s[v])):c=c.add(n(N,s[x]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function R3(t){return mD(t.Fp),If(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...$3(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function SD(t){const e=R3(t);If(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:AD,hexToBytes:_D}=uD,za={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=za;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:AD(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=za,n=typeof t=="string"?_D(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=za._parseInt(n.subarray(2)),{d:o,l:a}=za._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Us=BigInt(0),gi=BigInt(1);BigInt(2);const yE=BigInt(3);BigInt(4);function kD(t){const e=SD(t),{Fp:n}=e,r=e.toBytes||((p,g,m)=>{const v=g.toAffine();return ul(Uint8Array.from([4]),n.toBytes(v.x),n.toBytes(v.y))}),i=e.fromBytes||(p=>{const g=p.subarray(1),m=n.fromBytes(g.subarray(0,n.BYTES)),v=n.fromBytes(g.subarray(n.BYTES,2*n.BYTES));return{x:m,y:v}});function s(p){const{a:g,b:m}=e,v=n.sqr(p),x=n.mul(v,p);return n.add(n.add(x,n.mul(p,g)),m)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Us<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:v,n:x}=e;if(g&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=yc(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(m*2,"0")}let C;try{C=typeof p=="bigint"?p:zr(ar("private key",p,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof p}`)}return v&&(C=Gn(C,x)),a(C),C}const c=new Map;function u(p){if(!(p instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(g,m,v){if(this.px=g,this.py=m,this.pz=v,g==null||!n.isValid(g))throw new Error("x required");if(m==null||!n.isValid(m))throw new Error("y required");if(v==null||!n.isValid(v))throw new Error("z required")}static fromAffine(g){const{x:m,y:v}=g||{};if(!g||!n.isValid(m)||!n.isValid(v))throw new Error("invalid affine point");if(g instanceof f)throw new Error("projective point not allowed");const x=C=>n.eql(C,n.ZERO);return x(m)&&x(v)?f.ZERO:new f(m,v,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const m=n.invertBatch(g.map(v=>v.pz));return g.map((v,x)=>v.toAffine(m[x])).map(f.fromAffine)}static fromHex(g){const m=f.fromAffine(i(ar("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return f.BASE.multiply(l(g))}_setWindowSize(g){this._WINDOW_SIZE=g,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:m}=this.toAffine();if(!n.isValid(g)||!n.isValid(m))throw new Error("bad point: x or y not FE");const v=n.sqr(m),x=s(g);if(!n.eql(v,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(n.isOdd)return!n.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:m,py:v,pz:x}=this,{px:C,py:N,pz:O}=g,A=n.eql(n.mul(m,O),n.mul(C,x)),P=n.eql(n.mul(v,O),n.mul(N,x));return A&&P}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:g,b:m}=e,v=n.mul(m,yE),{px:x,py:C,pz:N}=this;let O=n.ZERO,A=n.ZERO,P=n.ZERO,S=n.mul(x,x),E=n.mul(C,C),_=n.mul(N,N),k=n.mul(x,C);return k=n.add(k,k),P=n.mul(x,N),P=n.add(P,P),O=n.mul(g,P),A=n.mul(v,_),A=n.add(O,A),O=n.sub(E,A),A=n.add(E,A),A=n.mul(O,A),O=n.mul(k,O),P=n.mul(v,P),_=n.mul(g,_),k=n.sub(S,_),k=n.mul(g,k),k=n.add(k,P),P=n.add(S,S),S=n.add(P,S),S=n.add(S,_),S=n.mul(S,k),A=n.add(A,S),_=n.mul(C,N),_=n.add(_,_),S=n.mul(_,k),O=n.sub(O,S),P=n.mul(_,E),P=n.add(P,P),P=n.add(P,P),new f(O,A,P)}add(g){u(g);const{px:m,py:v,pz:x}=this,{px:C,py:N,pz:O}=g;let A=n.ZERO,P=n.ZERO,S=n.ZERO;const E=e.a,_=n.mul(e.b,yE);let k=n.mul(m,C),D=n.mul(v,N),U=n.mul(x,O),B=n.add(m,v),M=n.add(C,N);B=n.mul(B,M),M=n.add(k,D),B=n.sub(B,M),M=n.add(m,x);let T=n.add(C,O);return M=n.mul(M,T),T=n.add(k,U),M=n.sub(M,T),T=n.add(v,x),A=n.add(N,O),T=n.mul(T,A),A=n.add(D,U),T=n.sub(T,A),S=n.mul(E,M),A=n.mul(_,U),S=n.add(A,S),A=n.sub(D,S),S=n.add(D,S),P=n.mul(A,S),D=n.add(k,k),D=n.add(D,k),U=n.mul(E,U),M=n.mul(_,M),D=n.add(D,U),U=n.sub(k,U),U=n.mul(E,U),M=n.add(M,U),k=n.mul(D,M),P=n.add(P,k),k=n.mul(T,M),A=n.mul(B,A),A=n.sub(A,k),k=n.mul(B,D),S=n.mul(T,S),S=n.add(S,k),new f(A,P,S)}subtract(g){return this.add(g.negate())}is0(){return this.equals(f.ZERO)}wNAF(g){return h.wNAFCached(this,c,g,m=>{const v=n.invertBatch(m.map(x=>x.pz));return m.map((x,C)=>x.toAffine(v[C])).map(f.fromAffine)})}multiplyUnsafe(g){const m=f.ZERO;if(g===Us)return m;if(a(g),g===gi)return this;const{endo:v}=e;if(!v)return h.unsafeLadder(this,g);let{k1neg:x,k1:C,k2neg:N,k2:O}=v.splitScalar(g),A=m,P=m,S=this;for(;C>Us||O>Us;)C&gi&&(A=A.add(S)),O&gi&&(P=P.add(S)),S=S.double(),C>>=gi,O>>=gi;return x&&(A=A.negate()),N&&(P=P.negate()),P=new f(n.mul(P.px,v.beta),P.py,P.pz),A.add(P)}multiply(g){a(g);let m=g,v,x;const{endo:C}=e;if(C){const{k1neg:N,k1:O,k2neg:A,k2:P}=C.splitScalar(m);let{p:S,f:E}=this.wNAF(O),{p:_,f:k}=this.wNAF(P);S=h.constTimeNegate(N,S),_=h.constTimeNegate(A,_),_=new f(n.mul(_.px,C.beta),_.py,_.pz),v=S.add(_),x=E.add(k)}else{const{p:N,f:O}=this.wNAF(m);v=N,x=O}return f.normalizeZ([v,x])[0]}multiplyAndAddUnsafe(g,m,v){const x=f.BASE,C=(O,A)=>A===Us||A===gi||!O.equals(x)?O.multiplyUnsafe(A):O.multiply(A),N=C(this,m).add(C(g,v));return N.is0()?void 0:N}toAffine(g){const{px:m,py:v,pz:x}=this,C=this.is0();g==null&&(g=C?n.ONE:n.inv(x));const N=n.mul(m,g),O=n.mul(v,g),A=n.mul(x,g);if(C)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:N,y:O}}isTorsionFree(){const{h:g,isTorsionFree:m}=e;if(g===gi)return!0;if(m)return m(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:m}=e;return g===gi?this:m?m(f,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),r(f,this,g)}toHex(g=!0){return yc(this.toRawBytes(g))}}f.BASE=new f(e.Gx,e.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,h=xD(f,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function CD(t){const e=R3(t);return If(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function TD(t){const e=CD(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(M){return Us<M&&M<n.ORDER}function a(M){return Gn(M,r)}function l(M){return ky(M,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:d}=kD({...e,toBytes(M,T,L){const q=T.toAffine(),F=n.toBytes(q.x),j=ul;return L?j(Uint8Array.from([T.hasEvenY()?2:3]),F):j(Uint8Array.from([4]),F,n.toBytes(q.y))},fromBytes(M){const T=M.length,L=M[0],q=M.subarray(1);if(T===i&&(L===2||L===3)){const F=zr(q);if(!o(F))throw new Error("Point is not on curve");const j=f(F);let Z=n.sqrt(j);const J=(Z&gi)===gi;return(L&1)===1!==J&&(Z=n.neg(Z)),{x:F,y:Z}}else if(T===s&&L===4){const F=n.fromBytes(q.subarray(0,n.BYTES)),j=n.fromBytes(q.subarray(n.BYTES,2*n.BYTES));return{x:F,y:j}}else throw new Error(`Point of length ${T} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=M=>yc(da(M,e.nByteLength));function p(M){const T=r>>gi;return M>T}function g(M){return p(M)?a(-M):M}const m=(M,T,L)=>zr(M.slice(T,L));class v{constructor(T,L,q){this.r=T,this.s=L,this.recovery=q,this.assertValidity()}static fromCompact(T){const L=e.nByteLength;return T=ar("compactSignature",T,L*2),new v(m(T,0,L),m(T,L,2*L))}static fromDER(T){const{r:L,s:q}=za.toSig(ar("DER",T));return new v(L,q)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(T){return new v(this.r,this.s,T)}recoverPublicKey(T){const{r:L,s:q,recovery:F}=this,j=P(ar("msgHash",T));if(F==null||![0,1,2,3].includes(F))throw new Error("recovery id invalid");const Z=F===2||F===3?L+e.n:L;if(Z>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const J=(F&1)===0?"02":"03",ue=c.fromHex(J+h(Z)),ae=l(Z),X=a(-j*ae),be=a(q*ae),De=c.BASE.multiplyAndAddUnsafe(ue,X,be);if(!De)throw new Error("point at infinify");return De.assertValidity(),De}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return bc(this.toDERHex())}toDERHex(){return za.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return bc(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const x={isValidPrivateKey(M){try{return u(M),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const M=P3(e.n);return wD(e.randomBytes(M),e.n)},precompute(M=8,T=c.BASE){return T._setWindowSize(M),T.multiply(BigInt(3)),T}};function C(M,T=!0){return c.fromPrivateKey(M).toRawBytes(T)}function N(M){const T=M instanceof Uint8Array,L=typeof M=="string",q=(T||L)&&M.length;return T?q===i||q===s:L?q===2*i||q===2*s:M instanceof c}function O(M,T,L=!0){if(N(M))throw new Error("first arg must be private key");if(!N(T))throw new Error("second arg must be public key");return c.fromHex(T).multiply(u(M)).toRawBytes(L)}const A=e.bits2int||function(M){const T=zr(M),L=M.length*8-e.nBitLength;return L>0?T>>BigInt(L):T},P=e.bits2int_modN||function(M){return a(A(M))},S=yv(e.nBitLength);function E(M){if(typeof M!="bigint")throw new Error("bigint expected");if(!(Us<=M&&M<S))throw new Error(`bigint expected < 2^${e.nBitLength}`);return da(M,e.nByteLength)}function _(M,T,L=k){if(["recovered","canonical"].some(ke=>ke in L))throw new Error("sign() legacy options not supported");const{hash:q,randomBytes:F}=e;let{lowS:j,prehash:Z,extraEntropy:J}=L;j==null&&(j=!0),M=ar("msgHash",M),Z&&(M=ar("prehashed msgHash",q(M)));const ue=P(M),ae=u(T),X=[E(ae),E(ue)];if(J!=null){const ke=J===!0?F(n.BYTES):J;X.push(ar("extraEntropy",ke))}const be=ul(...X),De=ue;function de(ke){const Ze=A(ke);if(!d(Ze))return;const me=l(Ze),Ee=c.BASE.multiply(Ze).toAffine(),ve=a(Ee.x);if(ve===Us)return;const Oe=a(me*a(De+ve*ae));if(Oe===Us)return;let Re=(Ee.x===ve?0:2)|Number(Ee.y&gi),nt=Oe;return j&&p(Oe)&&(nt=g(Oe),Re^=1),new v(ve,nt,Re)}return{seed:be,k2sig:de}}const k={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function U(M,T,L=k){const{seed:q,k2sig:F}=_(M,T,L),j=e;return L3(j.hash.outputLen,j.nByteLength,j.hmac)(q,F)}c.BASE._setWindowSize(8);function B(M,T,L,q=D){const F=M;if(T=ar("msgHash",T),L=ar("publicKey",L),"strict"in q)throw new Error("options.strict was renamed to lowS");const{lowS:j,prehash:Z}=q;let J,ue;try{if(typeof F=="string"||F instanceof Uint8Array)try{J=v.fromDER(F)}catch(Ee){if(!(Ee instanceof za.Err))throw Ee;J=v.fromCompact(F)}else if(typeof F=="object"&&typeof F.r=="bigint"&&typeof F.s=="bigint"){const{r:Ee,s:ve}=F;J=new v(Ee,ve)}else throw new Error("PARSE");ue=c.fromHex(L)}catch(Ee){if(Ee.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(j&&J.hasHighS())return!1;Z&&(T=e.hash(T));const{r:ae,s:X}=J,be=P(T),De=l(X),de=a(be*De),ke=a(ae*De),Ze=c.BASE.multiplyAndAddUnsafe(ue,de,ke)?.toAffine();return Ze?a(Ze.x)===ae:!1}return{CURVE:e,getPublicKey:C,getSharedSecret:O,sign:U,verify:B,ProjectivePoint:c,Signature:v,utils:x}}let D3=class extends T3{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,jR(e);const r=hv(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return eh(this),this.iHash.update(e),this}digestInto(e){eh(this),k3(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const B3=(t,e,n)=>new D3(t,e).update(n).digest();B3.create=(t,e)=>new D3(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ID(t){return{hash:t,hmac:(e,...n)=>B3(t,e,KR(...n)),randomBytes:I3}}function OD(t,e){const n=r=>TD({...t,...ID(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Np=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),th=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),U3=BigInt(1),nh=BigInt(2),bE=(t,e)=>(t+e/nh)/e;function H3(t){const e=Np,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,f=li(u,n,e)*u%e,d=li(f,n,e)*u%e,h=li(d,nh,e)*c%e,p=li(h,i,e)*h%e,g=li(p,s,e)*p%e,m=li(g,a,e)*g%e,v=li(m,l,e)*m%e,x=li(v,a,e)*g%e,C=li(x,n,e)*u%e,N=li(C,o,e)*p%e,O=li(N,r,e)*c%e,A=li(O,nh,e);if(!Cy.eql(Cy.sqr(A),t))throw new Error("Cannot find square root");return A}const Cy=vD(Np,void 0,void 0,{sqrt:H3}),Pc=OD({a:BigInt(0),b:BigInt(7),Fp:Cy,n:th,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=th,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-U3*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=bE(s*t,e),l=bE(-r*t,e);let c=Gn(t-a*n-l*i,e),u=Gn(-a*r-l*s,e);const f=c>o,d=u>o;if(f&&(c=e-c),d&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:c,k2neg:d,k2:u}}}},Ay),Pp=BigInt(0),F3=t=>typeof t=="bigint"&&Pp<t&&t<Np,MD=t=>typeof t=="bigint"&&Pp<t&&t<th,vE={};function rh(t,...e){let n=vE[t];if(n===void 0){const r=Ay(Uint8Array.from(t,i=>i.charCodeAt(0)));n=ul(r,r),vE[t]=n}return Ay(ul(n,...e))}const bv=t=>t.toRawBytes(!0).slice(1),Ty=t=>da(t,32),Mm=t=>Gn(t,Np),Ku=t=>Gn(t,th),vv=Pc.ProjectivePoint,LD=(t,e,n)=>vv.BASE.multiplyAndAddUnsafe(t,e,n);function Iy(t){let e=Pc.utils.normPrivateKeyToScalar(t),n=vv.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Ku(-e),bytes:bv(n)}}function z3(t){if(!F3(t))throw new Error("bad x: need 0 < x < p");const e=Mm(t*t),n=Mm(e*t+BigInt(7));let r=H3(n);r%nh!==Pp&&(r=Mm(-r));const i=new vv(t,r,U3);return i.assertValidity(),i}function j3(...t){return Ku(zr(rh("BIP0340/challenge",...t)))}function $D(t){return Iy(t).bytes}function ND(t,e,n=I3(32)){const r=ar("message",t),{bytes:i,scalar:s}=Iy(e),o=ar("auxRand",n,32),a=Ty(s^zr(rh("BIP0340/aux",o))),l=rh("BIP0340/nonce",a,i,r),c=Ku(zr(l));if(c===Pp)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=Iy(c),d=j3(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(Ty(Ku(f+d*s)),32),!V3(h,r,i))throw new Error("sign: Invalid signature produced");return h}function V3(t,e,n){const r=ar("signature",t,64),i=ar("message",e),s=ar("publicKey",n,32);try{const o=z3(zr(s)),a=zr(r.subarray(0,32));if(!F3(a))return!1;const l=zr(r.subarray(32,64));if(!MD(l))return!1;const c=j3(Ty(a),bv(o),i),u=LD(o,l,Ku(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const ns={getPublicKey:$D,sign:ND,verify:V3,utils:{randomPrivateKey:Pc.utils.randomPrivateKey,lift_x:z3,pointToBytes:bv,numberToBytesBE:da,bytesToNumberBE:zr,taggedHash:rh,mod:Gn}},Lm=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const wv=t=>t instanceof Uint8Array,$m=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ki=(t,e)=>t<<32-e|t>>>e,PD=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!PD)throw new Error("Non little-endian hardware is not supported");const RD=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function En(t){if(!wv(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=RD[t[n]];return e}function fl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function DD(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Gu(t){if(typeof t=="string"&&(t=DD(t)),!wv(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Rp(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!wv(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class q3{clone(){return this._cloneInto()}}function W3(t){const e=r=>t().update(Gu(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function K3(t=32){if(Lm&&typeof Lm.getRandomValues=="function")return Lm.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Oy(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function BD(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function G3(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function UD(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Oy(t.outputLen),Oy(t.blockLen)}function HD(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function FD(t,e){G3(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const as={number:Oy,bool:BD,bytes:G3,hash:UD,exists:HD,output:FD};function zD(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}class jD extends q3{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=$m(this.buffer)}update(e){as.exists(this);const{view:n,buffer:r,blockLen:i}=this;e=Gu(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=$m(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){as.exists(this),as.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;zD(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=$m(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const VD=(t,e,n)=>t&e^~t&n,qD=(t,e,n)=>t&e^t&n^e&n,WD=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Co=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),To=new Uint32Array(64);class Z3 extends jD{constructor(){super(64,32,8,!1),this.A=Co[0]|0,this.B=Co[1]|0,this.C=Co[2]|0,this.D=Co[3]|0,this.E=Co[4]|0,this.F=Co[5]|0,this.G=Co[6]|0,this.H=Co[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let f=0;f<16;f++,n+=4)To[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const d=To[f-15],h=To[f-2],p=Ki(d,7)^Ki(d,18)^d>>>3,g=Ki(h,17)^Ki(h,19)^h>>>10;To[f]=g+To[f-7]+p+To[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const d=Ki(a,6)^Ki(a,11)^Ki(a,25),h=u+d+VD(a,l,c)+WD[f]+To[f]|0,g=(Ki(r,2)^Ki(r,13)^Ki(r,22))+qD(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){To.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class KD extends Z3{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const xl=W3(()=>new Z3);W3(()=>new KD);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Rc(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function co(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce((i,s)=>i?e(i,s.encode):s.encode,void 0),r=t.reduce((i,s)=>i?e(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function uo(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Rc(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function fo(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function Dp(t,e="="){if(Rc(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Y3(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function wE(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach(o=>{if(Rc(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!==e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[l]?a=!1:r=l;else continue}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const J3=(t,e)=>e?J3(e,t%e):t,ih=(t,e)=>t+(e-J3(t,e));function My(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(ih(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${ih(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(Rc(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function GD(t){return Rc(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return wE(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(wE(e,t,2**8))}}}function xa(t,e=!1){if(Rc(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(ih(8,t)>32||ih(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return My(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(My(n,t,8,e))}}}function EE(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const ZD=co(xa(4),uo("0123456789ABCDEF"),fo("")),YD=co(xa(5),uo("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Dp(5),fo(""));co(xa(5),uo("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Dp(5),fo(""));co(xa(5),uo("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),fo(""),Y3(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const gs=co(xa(6),uo("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Dp(6),fo("")),JD=co(xa(6),uo("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Dp(6),fo("")),Ev=t=>co(GD(58),uo(t),fo("")),Ly=Ev("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Ev("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Ev("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const xE=[0,2,3,5,6,7,9,10,11],XD={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=Ly.encode(r).padStart(xE[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),i=xE.indexOf(r.length),s=Ly.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(e)}},$y=co(uo("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),fo("")),SE=[996825010,642813549,513874426,1027748829,705979059];function tu(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<SE.length;r++)(e>>r&1)===1&&(n^=SE[r]);return n}function AE(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=tu(i)^o>>5}i=tu(i);for(let s=0;s<r;s++)i=tu(i)^t.charCodeAt(s)&31;for(let s of e)i=tu(i)^s;for(let s=0;s<6;s++)i=tu(i);return i^=n,$y.encode(My([i%2**30],30,5,!1))}function X3(t){const e=t==="bech32"?1:734539939,n=xa(5),r=n.decode,i=n.encode,s=EE(r);function o(u,f,d=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const h=u.length+7+f.length;if(d!==!1&&h>d)throw new TypeError(`Length ${h} exceeds limit ${d}`);return u=u.toLowerCase(),`${u}1${$y.encode(f)}${AE(u,f,e)}`}function a(u,f=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||f!==!1&&u.length>f)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${f})`);const d=u.toLowerCase();if(u!==d&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=d;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=u.slice(0,h),g=u.slice(h+1);if(g.length<6)throw new Error("Data must be at least 6 characters long");const m=$y.decode(g).slice(0,-6),v=AE(p,m,e);if(!g.endsWith(v))throw new Error(`Invalid checksum in ${u}: expected "${v}"`);return{prefix:p,words:m}}const l=EE(a);function c(u){const{prefix:f,words:d}=a(u,!1);return{prefix:f,words:d,bytes:r(d)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const vc=X3("bech32");X3("bech32m");const QD={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},eB=co(xa(4),uo("0123456789abcdef"),fo(""),Y3(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),tB={utf8:QD,hex:eB,base16:ZD,base32:YD,base64:gs,base64url:JD,base58:Ly,base58xmr:XD};`${Object.keys(tB).join(", ")}`;function Nm(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function _E(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function nB(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Fs(t,...e){if(!nB(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const fr=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),rB=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!rB)throw new Error("Non little-endian hardware is not supported");function iB(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function sB(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const oB=(t,e)=>(Object.assign(e,t),e),ta=16,aB=283;function xv(t){return t<<1^aB&-(t>>7)}function Fl(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=xv(t);return n}const Ny=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=xv(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),lB=Ny.map((t,e)=>Ny.indexOf(e)),cB=t=>t<<24|t>>>8,Pm=t=>t<<8|t>>>24;function Q3(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((c,u)=>e(t[u])),r=n.map(Pm),i=r.map(Pm),s=i.map(Pm),o=new Uint32Array(256*256),a=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const f=c*256+u;o[f]=n[c]^r[u],a[f]=i[c]^s[u],l[f]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const Sv=Q3(Ny,t=>Fl(t,3)<<24|t<<16|t<<8|Fl(t,2)),ek=Q3(lB,t=>Fl(t,11)<<24|Fl(t,13)<<16|Fl(t,9)<<8|Fl(t,14)),uB=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=xv(n))t[e]=n;return t})();function tk(t){Fs(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=Sv,r=fr(t),i=r.length,s=a=>ls(n,a,a,a,a),o=new Uint32Array(e+28);o.set(r);for(let a=i;a<o.length;a++){let l=o[a-1];a%i===0?l=s(cB(l))^uB[a/i-1]:i>6&&a%i===4&&(l=s(l)),o[a]=o[a-i]^l}return o}function fB(t){const e=tk(t),n=e.slice(),r=e.length,{sbox2:i}=Sv,{T0:s,T1:o,T2:a,T3:l}=ek;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],f=ls(i,u,u,u,u);n[c]=s[f&255]^o[f>>>8&255]^a[f>>>16&255]^l[f>>>24]}return n}function Go(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function ls(t,e,n,r,i){return t[e&255|n&65280]|t[r>>>16&255|i>>>16&65280]<<16}function kE(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=Sv;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const g=t[l++]^Go(o,a,e,n,r,i),m=t[l++]^Go(o,a,n,r,i,e),v=t[l++]^Go(o,a,r,i,e,n),x=t[l++]^Go(o,a,i,e,n,r);e=g,n=m,r=v,i=x}const u=t[l++]^ls(s,e,n,r,i),f=t[l++]^ls(s,n,r,i,e),d=t[l++]^ls(s,r,i,e,n),h=t[l++]^ls(s,i,e,n,r);return{s0:u,s1:f,s2:d,s3:h}}function dB(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=ek;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const g=t[l++]^Go(o,a,e,i,r,n),m=t[l++]^Go(o,a,n,e,i,r),v=t[l++]^Go(o,a,r,n,e,i),x=t[l++]^Go(o,a,i,r,n,e);e=g,n=m,r=v,i=x}const u=t[l++]^ls(s,e,i,r,n),f=t[l++]^ls(s,n,e,i,r),d=t[l++]^ls(s,r,n,e,i),h=t[l++]^ls(s,i,r,n,e);return{s0:u,s1:f,s2:d,s3:h}}function nk(t,e){if(!e)return new Uint8Array(t);if(Fs(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function hB(t){if(Fs(t),t.length%ta!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${ta}`)}function pB(t,e,n){let r=t.length;const i=r%ta;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=fr(t);if(e){let l=ta-i;l||(l=ta),r=r+l}const o=nk(r,n),a=fr(o);return{b:s,o:a,out:o}}function gB(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function mB(t){const e=new Uint8Array(16),n=fr(e);e.set(t);const r=ta-t.length;for(let i=ta-r;i<ta;i++)e[i]=r;return n}const rk=oB({blockSize:16,nonceLength:16},function(e,n,r={}){Fs(e),Fs(n,16);const i=!r.disablePadding;return{encrypt:(s,o)=>{const a=tk(e),{b:l,o:c,out:u}=pB(s,i,o),f=fr(n);let d=f[0],h=f[1],p=f[2],g=f[3],m=0;for(;m+4<=l.length;)d^=l[m+0],h^=l[m+1],p^=l[m+2],g^=l[m+3],{s0:d,s1:h,s2:p,s3:g}=kE(a,d,h,p,g),c[m++]=d,c[m++]=h,c[m++]=p,c[m++]=g;if(i){const v=mB(s.subarray(m*4));d^=v[0],h^=v[1],p^=v[2],g^=v[3],{s0:d,s1:h,s2:p,s3:g}=kE(a,d,h,p,g),c[m++]=d,c[m++]=h,c[m++]=p,c[m++]=g}return a.fill(0),u},decrypt:(s,o)=>{hB(s);const a=fB(e),l=fr(n),c=nk(s.length,o),u=fr(s),f=fr(c);let d=l[0],h=l[1],p=l[2],g=l[3];for(let m=0;m+4<=u.length;){const v=d,x=h,C=p,N=g;d=u[m+0],h=u[m+1],p=u[m+2],g=u[m+3];const{s0:O,s1:A,s2:P,s3:S}=dB(a,d,h,p,g);f[m++]=O^v,f[m++]=A^x,f[m++]=P^C,f[m++]=S^N}return a.fill(0),gB(c,i)}}}),ik=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),yB=ik("expand 16-byte k"),bB=ik("expand 32-byte k"),vB=fr(yB),sk=fr(bB);sk.slice();function Lt(t,e){return t<<e|t>>>32-e}function Py(t){return t.byteOffset%4===0}const td=64,wB=16,ok=2**32-1,CE=new Uint32Array;function EB(t,e,n,r,i,s,o,a){const l=i.length,c=new Uint8Array(td),u=fr(c),f=Py(i)&&Py(s),d=f?fr(i):CE,h=f?fr(s):CE;for(let p=0;p<l;o++){if(t(e,n,r,u,o,a),o>=ok)throw new Error("arx: counter overflow");const g=Math.min(td,l-p);if(f&&g===td){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let v=0,x;v<wB;v++)x=m+v,h[x]=d[x]^u[v];p+=td;continue}for(let m=0,v;m<g;m++)v=p+m,s[v]=i[v]^c[m];p+=g}}function xB(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=iB({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Nm(i),Nm(o),_E(s),_E(n),(a,l,c,u,f=0)=>{Fs(a),Fs(l),Fs(c);const d=c.length;if(u||(u=new Uint8Array(d)),Fs(u),Nm(f),f<0||f>=ok)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const h=[];let p=a.length,g,m;if(p===32)g=a.slice(),h.push(g),m=sk;else if(p===16&&n)g=new Uint8Array(32),g.set(a),g.set(a,16),m=vB,h.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Py(l)||(l=l.slice(),h.push(l));const v=fr(g);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,v,fr(l.subarray(0,16)),v),l=l.subarray(16)}const x=16-i;if(x!==l.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const N=new Uint8Array(12);N.set(l,s?0:12-l.length),l=N,h.push(l)}const C=fr(l);for(EB(t,m,v,C,c,u,f,o);h.length>0;)h.pop().fill(0);return u}}function SB(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],f=e[1],d=e[2],h=e[3],p=e[4],g=e[5],m=e[6],v=e[7],x=i,C=n[0],N=n[1],O=n[2],A=o,P=a,S=l,E=c,_=u,k=f,D=d,U=h,B=p,M=g,T=m,L=v,q=x,F=C,j=N,Z=O;for(let ue=0;ue<s;ue+=2)A=A+_|0,q=Lt(q^A,16),B=B+q|0,_=Lt(_^B,12),A=A+_|0,q=Lt(q^A,8),B=B+q|0,_=Lt(_^B,7),P=P+k|0,F=Lt(F^P,16),M=M+F|0,k=Lt(k^M,12),P=P+k|0,F=Lt(F^P,8),M=M+F|0,k=Lt(k^M,7),S=S+D|0,j=Lt(j^S,16),T=T+j|0,D=Lt(D^T,12),S=S+D|0,j=Lt(j^S,8),T=T+j|0,D=Lt(D^T,7),E=E+U|0,Z=Lt(Z^E,16),L=L+Z|0,U=Lt(U^L,12),E=E+U|0,Z=Lt(Z^E,8),L=L+Z|0,U=Lt(U^L,7),A=A+k|0,Z=Lt(Z^A,16),T=T+Z|0,k=Lt(k^T,12),A=A+k|0,Z=Lt(Z^A,8),T=T+Z|0,k=Lt(k^T,7),P=P+D|0,q=Lt(q^P,16),L=L+q|0,D=Lt(D^L,12),P=P+D|0,q=Lt(q^P,8),L=L+q|0,D=Lt(D^L,7),S=S+U|0,F=Lt(F^S,16),B=B+F|0,U=Lt(U^B,12),S=S+U|0,F=Lt(F^S,8),B=B+F|0,U=Lt(U^B,7),E=E+_|0,j=Lt(j^E,16),M=M+j|0,_=Lt(_^M,12),E=E+_|0,j=Lt(j^E,8),M=M+j|0,_=Lt(_^M,7);let J=0;r[J++]=o+A|0,r[J++]=a+P|0,r[J++]=l+S|0,r[J++]=c+E|0,r[J++]=u+_|0,r[J++]=f+k|0,r[J++]=d+D|0,r[J++]=h+U|0,r[J++]=p+B|0,r[J++]=g+M|0,r[J++]=m+T|0,r[J++]=v+L|0,r[J++]=x+q|0,r[J++]=C+F|0,r[J++]=N+j|0,r[J++]=O+Z|0}const ak=xB(SB,{counterRight:!1,counterLength:4,allowShortKeys:!1});class lk extends q3{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,as.hash(e);const r=Gu(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return as.exists(this),this.iHash.update(e),this}digestInto(e){as.exists(this),as.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Bp=(t,e,n)=>new lk(t,e).update(n).digest();Bp.create=(t,e)=>new lk(t,e);function AB(t,e,n){return as.hash(t),Bp(t,Gu(n),Gu(e))}const Rm=new Uint8Array([0]),TE=new Uint8Array;function _B(t,e,n,r=32){if(as.hash(t),as.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=TE);const s=new Uint8Array(i*t.outputLen),o=Bp.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)Rm[0]=c+1,a.update(c===0?TE:l).update(n).update(Rm).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),Rm.fill(0),s.slice(0,r)}var kB=Object.defineProperty,en=(t,e)=>{for(var n in e)kB(t,n,{get:e[n],enumerable:!0})},Ll=Symbol("verified"),CB=t=>t instanceof Object;function Av(t){if(!CB(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var TB={};en(TB,{Queue:()=>LB,QueueNode:()=>ck,binarySearch:()=>_v,bytesToHex:()=>En,hexToBytes:()=>fl,insertEventIntoAscendingList:()=>MB,insertEventIntoDescendingList:()=>OB,normalizeURL:()=>IB,utf8Decoder:()=>zs,utf8Encoder:()=>Bi});var zs=new TextDecoder("utf-8"),Bi=new TextEncoder;function IB(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function OB(t,e){const[n,r]=_v(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at);return r||t.splice(n,0,e),t}function MB(t,e){const[n,r]=_v(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at);return r||t.splice(n,0,e),t}function _v(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var ck=class{value;next=null;prev=null;constructor(t){this.value=t}},LB=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new ck(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},$B=class{generateSecretKey(){return ns.utils.randomPrivateKey()}getPublicKey(e){return En(ns.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=En(ns.getPublicKey(n)),r.id=Ad(r),r.sig=En(ns.sign(Ad(r),n)),r[Ll]=!0,r}verifyEvent(e){if(typeof e[Ll]=="boolean")return e[Ll];const n=Ad(e);if(n!==e.id)return e[Ll]=!1,!1;try{const r=ns.verify(e.sig,n,e.pubkey);return e[Ll]=r,r}catch{return e[Ll]=!1,!1}}};function NB(t){if(!Av(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Ad(t){let e=xl(Bi.encode(NB(t)));return En(e)}var Up=new $B,PB=Up.generateSecretKey,Hp=Up.getPublicKey,vs=Up.finalizeEvent,kv=Up.verifyEvent,RB={};en(RB,{Application:()=>P7,BadgeAward:()=>VB,BadgeDefinition:()=>T7,BlockedRelaysList:()=>d7,BookmarkList:()=>c7,Bookmarksets:()=>_7,Calendar:()=>z7,CalendarEventRSVP:()=>j7,ChannelCreation:()=>gk,ChannelHideMessage:()=>bk,ChannelMessage:()=>yk,ChannelMetadata:()=>mk,ChannelMuteUser:()=>vk,ClassifiedListing:()=>B7,ClientAuth:()=>Ek,CommunitiesList:()=>u7,CommunityDefinition:()=>W7,CommunityPostApproval:()=>XB,Contacts:()=>FB,CreateOrUpdateProduct:()=>M7,CreateOrUpdateStall:()=>O7,Curationsets:()=>k7,Date:()=>H7,DirectMessageRelaysList:()=>m7,DraftClassifiedListing:()=>U7,DraftLong:()=>$7,Emojisets:()=>N7,EncryptedDirectMessage:()=>zB,EventDeletion:()=>jB,FileMetadata:()=>WB,FileServerPreference:()=>y7,Followsets:()=>x7,GenericRepost:()=>Mv,Genericlists:()=>S7,GiftWrap:()=>wk,HTTPAuth:()=>Lv,Handlerinformation:()=>q7,Handlerrecommendation:()=>V7,Highlights:()=>s7,InterestsList:()=>p7,Interestsets:()=>I7,JobFeedback:()=>t7,JobRequest:()=>QB,JobResult:()=>e7,Label:()=>JB,LightningPubRPC:()=>v7,LiveChatMessage:()=>KB,LiveEvent:()=>R7,LongFormArticle:()=>L7,Metadata:()=>UB,Mutelist:()=>o7,NWCWalletInfo:()=>b7,NWCWalletRequest:()=>xk,NWCWalletResponse:()=>w7,NostrConnect:()=>E7,OpenTimestamps:()=>qB,Pinlist:()=>a7,PrivateDirectMessage:()=>pk,ProblemTracker:()=>GB,ProfileBadges:()=>C7,PublicChatsList:()=>f7,Reaction:()=>Ov,RecommendRelay:()=>HB,RelayList:()=>l7,Relaysets:()=>A7,Report:()=>ZB,Reporting:()=>YB,Repost:()=>Iv,Seal:()=>hk,SearchRelaysList:()=>h7,ShortTextNote:()=>dk,Time:()=>F7,UserEmojiList:()=>g7,UserStatuses:()=>D7,Zap:()=>i7,ZapGoal:()=>n7,ZapRequest:()=>r7,classifyKind:()=>DB,isAddressableKind:()=>Tv,isEphemeralKind:()=>fk,isKind:()=>BB,isRegularKind:()=>uk,isReplaceableKind:()=>Cv});function uk(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function Cv(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function fk(t){return 2e4<=t&&t<3e4}function Tv(t){return 3e4<=t&&t<4e4}function DB(t){return uk(t)?"regular":Cv(t)?"replaceable":fk(t)?"ephemeral":Tv(t)?"parameterized":"unknown"}function BB(t,e){const n=e instanceof Array?e:[e];return Av(t)&&n.includes(t.kind)||!1}var UB=0,dk=1,HB=2,FB=3,zB=4,jB=5,Iv=6,Ov=7,VB=8,hk=13,pk=14,Mv=16,gk=40,mk=41,yk=42,bk=43,vk=44,qB=1040,wk=1059,WB=1063,KB=1311,GB=1971,ZB=1984,YB=1984,JB=1985,XB=4550,QB=5999,e7=6999,t7=7e3,n7=9041,r7=9734,i7=9735,s7=9802,o7=1e4,a7=10001,l7=10002,c7=10003,u7=10004,f7=10005,d7=10006,h7=10007,p7=10015,g7=10030,m7=10050,y7=10096,b7=13194,v7=21e3,Ek=22242,xk=23194,w7=23195,E7=24133,Lv=27235,x7=3e4,S7=30001,A7=30002,_7=30003,k7=30004,C7=30008,T7=30009,I7=30015,O7=30017,M7=30018,L7=30023,$7=30024,N7=30030,P7=30078,R7=30311,D7=30315,B7=30402,U7=30403,H7=31922,F7=31923,z7=31924,j7=31925,V7=31989,q7=31990,W7=34550,K7={};en(K7,{getHex64:()=>$v,getInt:()=>Sk,getSubscriptionId:()=>G7,matchEventId:()=>Z7,matchEventKind:()=>J7,matchEventPubkey:()=>Y7});function $v(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function Sk(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function G7(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function Z7(t,e){return e===$v(t,"id")}function Y7(t,e){return e===$v(t,"pubkey")}function J7(t,e){return e===Sk(t,"kind")}var X7={};en(X7,{makeAuthEvent:()=>Q7});function Q7(t,e){return{kind:Ek,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var e9;try{e9=WebSocket}catch{}var t9;try{t9=WebSocket}catch{}var ha={};en(ha,{BECH32_REGEX:()=>Ak,Bech32MaxSize:()=>Nv,NostrTypeGuard:()=>n9,decode:()=>Fp,decodeNostrURI:()=>i9,encodeBytes:()=>jp,naddrEncode:()=>u9,neventEncode:()=>c9,noteEncode:()=>a9,nprofileEncode:()=>l9,npubEncode:()=>o9,nsecEncode:()=>s9});var n9={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},Nv=5e3,Ak=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function r9(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function i9(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),Fp(t)}catch{return{type:"invalid",data:null}}}function Fp(t){let{prefix:e,words:n}=vc.decode(t,Nv),r=new Uint8Array(vc.fromWords(n));switch(e){case"nprofile":{let i=Dm(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:En(i[0][0]),relays:i[1]?i[1].map(s=>zs.decode(s)):[]}}}case"nevent":{let i=Dm(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:En(i[0][0]),relays:i[1]?i[1].map(s=>zs.decode(s)):[],author:i[2]?.[0]?En(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(En(i[3][0]),16):void 0}}}case"naddr":{let i=Dm(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:zs.decode(i[0][0]),pubkey:En(i[2][0]),kind:parseInt(En(i[3][0]),16),relays:i[1]?i[1].map(s=>zs.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:En(r)};default:throw new Error(`unknown prefix ${e}`)}}function Dm(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function s9(t){return jp("nsec",t)}function o9(t){return jp("npub",fl(t))}function a9(t){return jp("note",fl(t))}function zp(t,e){let n=vc.toWords(e);return vc.encode(t,n,Nv)}function jp(t,e){return zp(t,e)}function l9(t){let e=Pv({0:[fl(t.pubkey)],1:(t.relays||[]).map(n=>Bi.encode(n))});return zp("nprofile",e)}function c9(t){let e;t.kind!==void 0&&(e=r9(t.kind));let n=Pv({0:[fl(t.id)],1:(t.relays||[]).map(r=>Bi.encode(r)),2:t.author?[fl(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return zp("nevent",n)}function u9(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=Pv({0:[Bi.encode(t.identifier)],1:(t.relays||[]).map(r=>Bi.encode(r)),2:[fl(t.pubkey)],3:[new Uint8Array(e)]});return zp("naddr",n)}function Pv(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)})}),Rp(...e)}var f9={};en(f9,{decrypt:()=>d9,encrypt:()=>_k});function _k(t,e,n){const r=t instanceof Uint8Array?En(t):t,i=Pc.getSharedSecret(r,"02"+e),s=kk(i);let o=Uint8Array.from(K3(16)),a=Bi.encode(n),l=rk(s,o).encrypt(a),c=gs.encode(new Uint8Array(l)),u=gs.encode(new Uint8Array(o.buffer));return`${c}?iv=${u}`}function d9(t,e,n){const r=t instanceof Uint8Array?En(t):t;let[i,s]=n.split("?iv="),o=Pc.getSharedSecret(r,"02"+e),a=kk(o),l=gs.decode(s),c=gs.decode(i),u=rk(a,l).decrypt(c);return zs.decode(u)}function kk(t){return t.slice(1,33)}var h9={};en(h9,{NIP05_REGEX:()=>Rv,isNip05:()=>p9,isValid:()=>y9,queryProfile:()=>Ck,searchDomain:()=>m9,useFetchImplementation:()=>g9});var Rv=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,p9=t=>Rv.test(t||""),Vp;try{Vp=fetch}catch{}function g9(t){Vp=t}async function m9(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Vp(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Ck(t){const e=t.match(Rv);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Vp(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function y9(t,e){const n=await Ck(e);return n?n.pubkey===t:!1}var b9={};en(b9,{parse:()=>v9});function v9(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,f={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=f;continue}if(c==="reply"){e.reply=f;continue}if(c==="mention"){e.mentions.push(f);continue}n?r=f:n=f,e.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),e.mentions.forEach(i=>{if(i.author){let s=e.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),e}var w9={};en(w9,{fetchRelayInformation:()=>x9,useFetchImplementation:()=>E9});var Tk;try{Tk=fetch}catch{}function E9(t){Tk=t}async function x9(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var S9={};en(S9,{fastEventHash:()=>Ok,getPow:()=>Ik,minePow:()=>A9});function Ik(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function A9(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=Ok(r),Ik(r.id)>=e)break}return r}function Ok(t){return En(xl(Bi.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var _9={};en(_9,{unwrapEvent:()=>D9,unwrapManyEvents:()=>B9,wrapEvent:()=>jk,wrapManyEvents:()=>R9});var k9={};en(k9,{createRumor:()=>Uk,createSeal:()=>Hk,createWrap:()=>Fk,unwrapEvent:()=>Fv,unwrapManyEvents:()=>zk,wrapEvent:()=>sh,wrapManyEvents:()=>N9});var C9={};en(C9,{decrypt:()=>Hv,encrypt:()=>Uv,getConversationKey:()=>Dv,v2:()=>L9});var Mk=1,Lk=65535;function Dv(t,e){const n=Pc.getSharedSecret(t,"02"+e).subarray(1,33);return AB(xl,n,"nip44-v2")}function $k(t,e){const n=_B(xl,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Bv(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function T9(t){if(!Number.isSafeInteger(t)||t<Mk||t>Lk)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function I9(t){const e=Bi.encode(t),n=e.length,r=T9(n),i=new Uint8Array(Bv(n)-n);return Rp(r,e,i)}function O9(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Mk||e>Lk||n.length!==e||t.length!==2+Bv(e))throw new Error("invalid padding");return zs.decode(n)}function Nk(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=Rp(n,e);return Bp(xl,t,r)}function M9(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=gs.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Uv(t,e,n=K3(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=$k(e,n),o=I9(t),a=ak(r,i,o),l=Nk(s,a,n);return gs.encode(Rp(new Uint8Array([2]),n,a,l))}function Hv(t,e){const{nonce:n,ciphertext:r,mac:i}=M9(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=$k(e,n),l=Nk(a,r,n);if(!sB(l,i))throw new Error("invalid MAC");const c=ak(s,o,r);return O9(c)}var L9={utils:{getConversationKey:Dv,calcPaddedLen:Bv},encrypt:Uv,decrypt:Hv},$9=2880*60,Pk=()=>Math.round(Date.now()/1e3),Rk=()=>Math.round(Pk()-Math.random()*$9),Dk=(t,e)=>Dv(t,e),Bk=(t,e,n)=>Uv(JSON.stringify(t),Dk(e,n)),IE=(t,e)=>JSON.parse(Hv(t.content,Dk(e,t.pubkey)));function Uk(t,e){const n={created_at:Pk(),content:"",tags:[],...t,pubkey:Hp(e)};return n.id=Ad(n),n}function Hk(t,e,n){return vs({kind:hk,content:Bk(t,e,n),created_at:Rk(),tags:[]},e)}function Fk(t,e){const n=PB();return vs({kind:wk,content:Bk(t,n,e),created_at:Rk(),tags:[["p",e]]},n)}function sh(t,e,n){const r=Uk(t,e),i=Hk(r,e,n);return Fk(i,n)}function N9(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Hp(e),i=[sh(t,e,r)];return n.forEach(s=>{i.push(sh(t,e,s))}),i}function Fv(t,e){const n=IE(t,e);return IE(n,e)}function zk(t,e){let n=[];return t.forEach(r=>{n.push(Fv(r,e))}),n.sort((r,i)=>r.created_at-i.created_at),n}function P9(t,e,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:pk,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function jk(t,e,n,r,i){const s=P9(e,n,r,i);return sh(s,t,e.publicKey)}function R9(t,e,n,r,i){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Hp(t)},...e].map(o=>jk(t,o,n,r,i))}var D9=Fv,B9=zk,U9={};en(U9,{finishRepostEvent:()=>H9,getRepostedEvent:()=>F9,getRepostedEventPointer:()=>Vk});function H9(t,e,n,r){let i;const s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===dk?i=Iv:(i=Mv,s.push(["k",String(e.kind)])),vs({kind:i,tags:s,content:t.content===""||e.tags?.find(o=>o[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function Vk(t){if(![Iv,Mv].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function F9(t,{skipVerification:e}={}){const n=Vk(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!kv(r)))return r}var z9={};en(z9,{NOSTR_URI_REGEX:()=>zv,parse:()=>V9,test:()=>j9});var zv=new RegExp(`nostr:(${Ak.source})`);function j9(t){return typeof t=="string"&&new RegExp(`^${zv.source}$`).test(t)}function V9(t){const e=t.match(new RegExp(`^${zv.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Fp(e[1])}}var q9={};en(q9,{finishReactionEvent:()=>W9,getReactedEventPointer:()=>K9});function W9(t,e,n){const r=e.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return vs({...t,kind:Ov,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function K9(t){if(t.kind!==Ov)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var G9={};en(G9,{parse:()=>Y9});var Z9=/\W/m,OE=/\W |\W$|$|,| /m;function*Y9(t){const e=t.length;let n=0,r=0;for(;r<e;){let i=t.indexOf(":",r);if(i===-1)break;if(t.substring(i-5,i)==="nostr"){const s=t.substring(i+60).match(Z9),o=s?i+60+s.index:e;try{let a,{data:l,type:c}=Fp(t.substring(i+1,o));switch(c){case"npub":a={pubkey:l};break;case"nsec":case"note":r=o+1;continue;default:a=l}n!==i-5&&(yield{type:"text",text:t.substring(n,i-5)}),yield{type:"reference",pointer:a},r=o,n=r;continue}catch{r=i+1;continue}}else if(t.substring(i-5,i)==="https"||t.substring(i-4,i)==="http"){const s=t.substring(i+4).match(OE),o=s?i+4+s.index:e,a=t[i-1]==="s"?5:4;try{let l=new URL(t.substring(i-a,o));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==i-a&&(yield{type:"text",text:t.substring(n,i-a)}),l.pathname.endsWith(".png")||l.pathname.endsWith(".jpg")||l.pathname.endsWith(".jpeg")||l.pathname.endsWith(".gif")||l.pathname.endsWith(".webp")){yield{type:"image",url:l.toString()},r=o,n=r;continue}if(l.pathname.endsWith(".mp4")||l.pathname.endsWith(".avi")||l.pathname.endsWith(".webm")||l.pathname.endsWith(".mkv")){yield{type:"video",url:l.toString()},r=o,n=r;continue}if(l.pathname.endsWith(".mp3")||l.pathname.endsWith(".aac")||l.pathname.endsWith(".ogg")||l.pathname.endsWith(".opus")){yield{type:"audio",url:l.toString()},r=o,n=r;continue}yield{type:"url",url:l.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else if(t.substring(i-3,i)==="wss"||t.substring(i-2,i)==="ws"){const s=t.substring(i+4).match(OE),o=s?i+4+s.index:e,a=t[i-1]==="s"?3:2;try{let l=new URL(t.substring(i-a,o));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==i-a&&(yield{type:"text",text:t.substring(n,i-a)}),yield{type:"relay",url:l.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else{r=i+1;continue}}n!==e&&(yield{type:"text",text:t.substring(n)})}var J9={};en(J9,{channelCreateEvent:()=>X9,channelHideMessageEvent:()=>tU,channelMessageEvent:()=>eU,channelMetadataEvent:()=>Q9,channelMuteUserEvent:()=>nU});var X9=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return vs({kind:gk,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Q9=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return vs({kind:mk,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},eU=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),vs({kind:yk,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},tU=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return vs({kind:bk,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},nU=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return vs({kind:vk,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},rU={};en(rU,{EMOJI_SHORTCODE_REGEX:()=>qk,matchAll:()=>iU,regex:()=>jv,replaceAll:()=>sU});var qk=/:(\w+):/,jv=()=>new RegExp(`\\B${qk.source}\\B`,"g");function*iU(t){const e=t.matchAll(jv());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function sU(t,e){return t.replaceAll(jv(),(n,r)=>e({shortcode:n,name:r}))}var oU={};en(oU,{useFetchImplementation:()=>aU,validateGithub:()=>lU});var Vv;try{Vv=fetch}catch{}function aU(t){Vv=t}async function lU(t,e,n){try{return await(await Vv(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var cU={};en(cU,{makeNwcRequestEvent:()=>fU,parseConnectionString:()=>uU});function uU(t){const{host:e,pathname:n,searchParams:r}=new URL(t),i=n||e,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function fU(t,e,n){const i=_k(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:xk,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return vs(s,e)}var dU={};en(dU,{normalizeIdentifier:()=>hU});function hU(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var pU={};en(pU,{getSatoshisAmountFromBolt11:()=>wU,getZapEndpoint:()=>mU,makeZapReceipt:()=>vU,makeZapRequest:()=>yU,useFetchImplementation:()=>gU,validateZapRequest:()=>bU});var qv;try{qv=fetch}catch{}function gU(t){qv=t}async function mU(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=vc.decode(n,1e3),a=vc.fromWords(o);e=zs.decode(a)}else if(r){let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let s=await(await qv(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function yU(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),Cv(t.event.kind)){const n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(Tv(t.event.kind)){let n=t.event.tags.find(([i,s])=>i==="d"&&s);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function bU(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!Av(e))return"Zap request is not a valid Nostr event.";if(!kv(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function vU({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}function wU(t){if(t.length<50)return 0;t=t.substring(0,50);const e=t.lastIndexOf("1");if(e===-1)return 0;const n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const l=parseInt(r.substring(0,a));switch(i){case"m":return l*1e5;case"u":return l*100;case"n":return l/10;case"p":return l/1e4;default:return l*1e8}}var EU={};en(EU,{getToken:()=>xU,hashPayload:()=>Wv,unpackEventFromToken:()=>Kk,validateEvent:()=>Qk,validateEventKind:()=>Zk,validateEventMethodTag:()=>Jk,validateEventPayloadTag:()=>Xk,validateEventTimestamp:()=>Gk,validateEventUrlTag:()=>Yk,validateToken:()=>SU});var Wk="Nostr ";async function xU(t,e,n,r=!1,i){const s={kind:Lv,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",Wv(i)]);const o=await n(s);return(r?Wk:"")+gs.encode(Bi.encode(JSON.stringify(o)))}async function SU(t,e,n){const r=await Kk(t).catch(s=>{throw s});return await Qk(r,e,n).catch(s=>{throw s})}async function Kk(t){if(!t)throw new Error("Missing token");t=t.replace(Wk,"");const e=zs.decode(gs.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function Gk(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function Zk(t){return t.kind===Lv}function Yk(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function Jk(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function Wv(t){const e=xl(Bi.encode(JSON.stringify(t)));return En(e)}function Xk(t,e){const n=t.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=Wv(e);return n.length>0&&n[1]===r}async function Qk(t,e,n,r){if(!kv(t))throw new Error("Invalid nostr event, signature invalid");if(!Zk(t))throw new Error("Invalid nostr event, kind invalid");if(!Gk(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Yk(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!Jk(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!Xk(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function AU(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t;let a,l,c;const u=async(d=!0)=>{await l,c?.()};async function f(){if("serviceWorker"in navigator){if(a=await Tp(async()=>{const{Workbox:d}=await import("./workbox-window.prod.es5-CwtvwXb3.js");return{Workbox:d}},[]).then(({Workbox:d})=>new d("/ehagaki/sw.js",{scope:"/ehagaki/",type:"classic"})).catch(d=>{o?.(d)}),!a)return;c=()=>{a?.messageSkipWaiting()};{let d=!1;const h=()=>{d=!0,a?.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),n?.()};a.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"&&p.isExternal?h():!d&&r?.():p.isUpdate||r?.()}),a.addEventListener("waiting",h)}a.register({immediate:e}).then(d=>{s?s("/ehagaki/sw.js",d):i?.(d)}).catch(d=>{o?.(d)})}}return l=f(),u}function ME(t={}){const{immediate:e=!0,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t,a=Ei(!1),l=Ei(!1),c=AU({immediate:e,onOfflineReady(){l.set(!0),r?.()},onNeedRefresh(){a.set(!0),n?.()},onRegistered:i,onRegisteredSW:s,onRegisterError:o});return{needRefresh:a,offlineReady:l,updateServiceWorker:c}}let LE=Se(Et({info:null,visible:!1}));const zl={get value(){return $(LE)},set:t=>{se(LE,t,!0)}};let Bm=Se(!1);const Rt={get value(){return $(Bm)},set:t=>{se(Bm,t,!0)},reset:()=>{se(Bm,!1)}};let Ry=null;function _U(t){Ry=t}let Dy=null;function kU(t){Dy=t}function CU(){Rt.set(!0),Ry&&Ry.abort(),Dy&&Dy.abort(),_u.set(0),ku.set(0)}const oh={type:"none",isAuthenticated:!1,pubkey:"",npub:"",nprofile:"",isValid:!1,isInitialized:!1,isExtensionLogin:!1};let wc=Se(Et({...oh}));const $i={get value(){return $(wc)||oh},subscribe:t=>{qe(()=>{t($(wc)||oh)})}};function Kv(t){const n={...$(wc),...t};n.isAuthenticated=n.type!=="none"&&n.isValid,n.isExtensionLogin=n.isAuthenticated&&n.type==="nostr-login"&&typeof window<"u"&&typeof window.nostr=="object"&&typeof window.nostr.signEvent=="function",se(wc,n,!0),console.log("[updateAuthState] 認証状態を更新:",{type:n.type,isAuthenticated:n.isAuthenticated,isValid:n.isValid,pubkey:n.pubkey?n.pubkey.substring(0,8)+"...":"empty"})}function $E(t=!0){se(wc,{...oh,isInitialized:t?$(wc).isInitialized:!1},!0)}function NE(t,e,n){if(!t||!e||!n){console.warn("setNsecAuth: All parameters are required");return}Kv({type:"nsec",pubkey:t,npub:e,nprofile:n,isValid:!0})}function TU(t,e,n){if(!t||!e||!n){console.warn("setNostrLoginAuth: All parameters are required");return}console.log("[setNostrLoginAuth] NostrLogin認証状態を更新:",{pubkey:t.substring(0,8)+"...",npub:e.substring(0,12)+"...",type:"nostr-login"}),Kv({type:"nostr-login",pubkey:t,npub:e,nprofile:n,isValid:!0})}function IU(){Kv({isInitialized:!0})}const qn=Et({file:null,metadata:void 0,received:!1});function PE(t,e){qn.file=t,qn.metadata=e,qn.received=!!t}function OU(){qn.file=null,qn.metadata=void 0,qn.received=!1}const Xa=Et({content:null,received:!1});function MU(t){Xa.content=t,Xa.received=!!t}function LU(){Xa.content=null,Xa.received=!1}function $U(){return qn.file}function NU(){return qn.metadata}let RE=Se(!1),DE=Se(!1),BE=Se(!1),UE=Se(!1);const Au={get value(){return $(RE)},set:t=>{se(RE,t,!0)}},ah={get value(){return $(DE)},set:t=>{se(DE,t,!0)}},Gv={get value(){return $(BE)},set:t=>{se(BE,t,!0)}},nu={get value(){return $(UE)},set:t=>{se(UE,t,!0)}},eC=(()=>{try{if(typeof ME=="function")return ME({onRegistered:t=>{console.log("SW registered successfully",t)},onRegisterError(t){console.warn("SW registration error",t)},onNeedRefresh(){console.log("SW needs refresh - showing prompt")},immediate:!0,onOfflineReady(){console.log("App ready to work offline")}})}catch(t){console.warn("Failed to initialize Service Worker:",t)}return{needRefresh:{subscribe:()=>{}},updateServiceWorker:()=>{}}})(),Zv=eC.needRefresh,PU=eC.updateServiceWorker;let Um=Se(null);const tC={get value(){return $(Um)},set:t=>{se(Um,t,!0)},subscribe:t=>{qe(()=>{t($(Um))})}};let Hm=Se(Et({name:"",picture:""})),Fm=Se(!1),zm=Se(!1);const jm={get value(){return $(Hm)},set:t=>{se(Hm,t,!0)},subscribe:t=>{qe(()=>{t($(Hm))})}},Vm={get value(){return $(Fm)},set:t=>{se(Fm,t,!0)},subscribe:t=>{qe(()=>{t($(Fm))})}},ci={get value(){return $(zm)},set:t=>{se(zm,t,!0)},subscribe:t=>{qe(()=>{t($(zm))})}};let qm=Se(!1);const RU={get value(){return $(qm)},set:t=>{se(qm,t,!0)},subscribe:t=>{qe(()=>{t($(qm))})}};let Wm=Se(0);const _u={get value(){return $(Wm)},set:t=>{se(Wm,t,!0)},subscribe:t=>{qe(()=>{t($(Wm))})}};let Km=Se(0);const ku={get value(){return $(Km)},set:t=>{se(Km,t,!0)},subscribe:t=>{qe(()=>{t($(Km))})}};Et({content:"",hashtags:[],tags:[]});let Gm=Se(null);const DU={get value(){return $(Gm)},set:t=>{se(Gm,t,!0)},subscribe:t=>{qe(()=>{t($(Gm))})}};let Zm=Se(Et([])),HE=Se(!1),FE=Se(!1);const zE={get value(){return $(Zm)},set:t=>{se(Zm,t,!0)},subscribe:t=>{qe(()=>{t($(Zm))})}},By={get value(){return $(HE)},set:t=>{se(HE,t,!0)}},jE={get value(){return $(FE)},set:t=>{se(FE,t,!0)}};let Ym=Se(0);const Uy={get value(){return $(Ym)},set:t=>{se(Ym,t,!0)},subscribe:t=>{qe(()=>{t($(Ym))})}},ei=Ei({open:!1,nodeId:void 0,src:void 0});let VE=Se(null);const Zs={get value(){return $(VE)},set:t=>{se(VE,t,!0)}};let Sn=Et({showSecretKeyDialog:!1,pendingPost:"",showImageFullscreen:!1,fullscreenImageSrc:"",fullscreenImageAlt:"",showPopupModal:!1,popupX:0,popupY:0,popupMessage:""});const Cs={get value(){return Sn},subscribe:t=>{qe(()=>{t(Sn)})},showSecretKeyDialog:t=>{Sn.pendingPost=t,Sn.showSecretKeyDialog=!0},hideSecretKeyDialog:()=>{Sn.showSecretKeyDialog=!1,Sn.pendingPost=""},getPendingPost:()=>Sn.pendingPost,showImageFullscreen:(t,e="")=>{Sn.fullscreenImageSrc=t,Sn.fullscreenImageAlt=e,Sn.showImageFullscreen=!0},hideImageFullscreen:()=>{Sn.showImageFullscreen=!1,Sn.fullscreenImageSrc="",Sn.fullscreenImageAlt=""},showPopupMessage:(t,e,n,r=1800)=>{Sn.popupX=t,Sn.popupY=e,Sn.popupMessage=n,Sn.showPopupModal=!0,setTimeout(()=>{Sn.showPopupModal=!1},r)},hidePopupMessage:()=>{Sn.showPopupModal=!1}};function qE(t,e=3e3){if(t===null){nC();return}zl.set({info:t,visible:!0})}function nC(){zl.set({info:null,visible:!1})}function BU(){Au.set(!0)}function Jm(){Au.set(!1)}function UU(){ah.set(!0)}function HU(){ah.set(!1)}function FU(){Gv.set(!0)}function zU(){Gv.set(!1)}function jU(){PU(!0)}function VU(){return navigator.serviceWorker?.controller?new Promise(t=>{const e=new MessageChannel;if(e.port1.onmessage=n=>{n.data?.version?(tC.set(n.data.version),t(n.data.version)):t(null)},navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({type:"GET_VERSION"},[e.port2]);else{t(null);return}setTimeout(()=>t(null),2e3)}):Promise.resolve(null)}const Xm=["wss://purplepag.es/","wss://directory.yabu.me/","wss://indexer.coracle.social/","wss://user.kindpag.es/"],Qm=["wss://relay.nostr.band/","wss://nos.lol/","wss://relay.damus.io/","wss://relay-jp.nostr.wirednet.jp/","wss://yabu.me/","wss://r.kojira.io/","wss://nrelay-jp.c-stellar.net/"],ru="https://nostr.build/api/v2/upload/files",WE=1024*1024*1024,qU={none:{skip:!0},low:{maxWidthOrHeight:2048,fileType:"image/webp",initialQuality:.95,useWebWorker:!0},medium:{maxWidthOrHeight:1024,fileType:"image/webp",initialQuality:.8,useWebWorker:!0},high:{maxWidthOrHeight:800,fileType:"image/webp",initialQuality:.5,useWebWorker:!0}},Hy=/(?:^|[\s\n\u3000])#([^\s\n\u3000#]+)/g,WU=["http:","https:"],KU=[".png",".jpg",".jpeg",".gif",".webp",".svg"],GU=[".mp4",".webm",".mov",".avi",".mkv"],ZU=400,YU=10,KE=100,GE=1,JU=10,Pr={LOCALE:"locale",UPLOAD_ENDPOINT:"uploadEndpoint",CLIENT_TAG_ENABLED:"clientTagEnabled",IMAGE_COMPRESSION_LEVEL:"imageCompressionLevel",VIDEO_COMPRESSION_LEVEL:"videoCompressionLevel",NOSTR_RELAYS:"nostr-relays-"},XU=1e3,QU=0,rC=[{label:"share.yabu.me",url:"https://share.yabu.me/api/v2/media"},{label:"nostpic.com",url:"https://nostpic.com/api/v2/media"},{label:"nostrcheck.me",url:"https://nostrcheck.me/api/v2/media"},{label:"files.sovbit.host",url:"https://files.sovbit.host/api/v2/media"},{label:"nostr.build",url:"https://nostr.build/api/v2/nip96/upload"}];function Yv(t){return t==="ja"?"https://share.yabu.me/api/v2/media":"https://nostrcheck.me/api/v2/media"}function eH(t){return[{label:t("settingsDialog.compression_none")||"無圧縮",value:"none"},{label:t("settingsDialog.compression_low")||"低圧縮",value:"low"},{label:t("settingsDialog.compression_medium")||"中圧縮",value:"medium"},{label:t("settingsDialog.compression_high")||"高圧縮",value:"high"}]}function tH(t){return[{label:t("settingsDialog.compression_none")||"無圧縮",value:"none"},{label:t("settingsDialog.compression_low")||"低圧縮",value:"low"},{label:t("settingsDialog.compression_medium")||"中圧縮",value:"medium"},{label:t("settingsDialog.compression_high")||"高圧縮",value:"high"}]}const wn={MIN_SCALE:1,MAX_SCALE:100,DEFAULT_SCALE:1,DOUBLE_CLICK_SCALE:2.5,RESET_THRESHOLD:1.3,ZOOM_DELTA:{IN:1.1,OUT:.9},THRESHOLD:.1,PINCH_MIN_DISTANCE:10},ZE={FRICTION:.92,MIN_VELOCITY:.1},iC={EDITOR_FOCUS_DELAY:100,TRANSITION_DURATION:"0.3s"},nH={EDITOR:".tiptap-editor"},rH=["balloonMessage.info.hello","balloonMessage.info.hello2","balloonMessage.info.welcome","balloonMessage.info.waited","balloonMessage.info.relax","balloonMessage.info.good_weather","balloonMessage.info.thwomp","balloonMessage.info.sleep_on_floor","balloonMessage.info.home_here","balloonMessage.info.donai","balloonMessage.info.kita_na","balloonMessage.info.no_licking","balloonMessage.info.not_thwomp","balloonMessage.info.kitte_origin","balloonMessage.info.normal_stamp","balloonMessage.info.backside_curious","balloonMessage.info.corner_weapon","balloonMessage.info.square_peace","balloonMessage.info.how_much_stamp","balloonMessage.info.cancellation_done","balloonMessage.info.want_to_roll","balloonMessage.info.want_candy","balloonMessage.info.tetris_gone","balloonMessage.info.comfy_here","balloonMessage.info.what_did_you_eat","balloonMessage.info.go_to_bed_early","balloonMessage.info.did_you_brush_teeth","balloonMessage.info.kit-ten_ketten","balloonMessage.info.such_is_life"],iH=["balloonMessage.success.post_success","balloonMessage.success.sent","balloonMessage.success.to_everyone"],sH="balloonMessage.error.post_error",e0={MAX_WAIT_TIME:15e3,RETRY_INTERVAL:1e3,TIMEOUT_MESSAGE:"Upload processing timeout"},oH=/nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{10,}/,aH=/^nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58}$/,Rs={INDEXEDDB_NAME:"share-handler-db",INDEXEDDB_VERSION:1,STORE_NAME:"flags",REQUEST_TIMEOUT:3e3,SW_CONTROLLER_WAIT_TIMEOUT:100},pa={setBodyStyle(t,e){document.body.style.setProperty(t,e)},querySelector(t){return document.querySelector(t)},querySelectorAll(t){return document.querySelectorAll(t)},focusElement(t){t.focus()}};function Qa(t,e){pa.setBodyStyle(t,e)}function lH(){Qa("overflow",""),Qa("user-select",""),Qa("-webkit-user-select","")}function cH(){return document.activeElement}function uH(t){return t.classList?.contains?.("tiptap-editor")||!!t.closest?.(".tiptap-editor")}function fH(t){return["INPUT","TEXTAREA"].includes(t.tagName)||t.isContentEditable}function dH(){const t=cH();t&&(uH(t)||fH(t))&&(t.blur?.(),document.body?.focus?.())}function cs(){return typeof window<"u"&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0||navigator&&!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|Mobile/i))}function sC(){try{if(dH(),cs()){const t=document.querySelector(".tiptap-editor");t&&t.blur?.()}}catch{}}const hH={setTimeout:(t,e)=>setTimeout(t,e)};function pH(t,e,n=hH){n.setTimeout(()=>{const r=pa.querySelector(t);r&&pa.focusElement(r)},e)}function gH(t=200){if(!(typeof window>"u"||typeof navigator>"u"))if("vibrate"in navigator)try{navigator.vibrate(t)}catch{}else try{const e=document.getElementById("vibrateSwitch");e&&e.click()}catch{}}var mH=1063;function yH(t){const e={content:t.content,created_at:Math.floor(Date.now()/1e3),kind:mH,tags:[["url",t.url],["m",t.m],["x",t.x],["ox",t.ox]]};return t.size&&e.tags.push(["size",t.size]),t.dim&&e.tags.push(["dim",t.dim]),t.i&&e.tags.push(["i",t.i]),t.blurhash&&e.tags.push(["blurhash",t.blurhash]),t.thumb&&e.tags.push(["thumb",t.thumb]),t.image&&e.tags.push(["image",t.image]),t.summary&&e.tags.push(["summary",t.summary]),t.alt&&e.tags.push(["alt",t.alt]),t.fallback&&t.fallback.forEach(n=>e.tags.push(["fallback",n])),e}var oC=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],pu=t=>{let e=0;for(let n=0;n<t.length;n++){let r=t[n],i=oC.indexOf(r);e=e*83+i}return e},iu=(t,e)=>{var n="";for(let r=1;r<=e;r++){let i=Math.floor(t)/Math.pow(83,e-r)%83;n+=oC[Math.floor(i)]}return n},Ql=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},ec=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},bH=t=>t<0?-1:1,tc=(t,e)=>bH(t)*Math.pow(Math.abs(t),e),lh=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},vH=t=>{if(!t||t.length<6)throw new lh("The blurhash string must be at least 6 characters");let e=pu(t[0]),n=Math.floor(e/9)+1,r=e%9+1;if(t.length!==4+2*r*n)throw new lh(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*r*n}`)},wH=t=>{let e=t>>16,n=t>>8&255,r=t&255;return[Ql(e),Ql(n),Ql(r)]},EH=(t,e)=>{let n=Math.floor(t/361),r=Math.floor(t/19)%19,i=t%19;return[tc((n-9)/9,2)*e,tc((r-9)/9,2)*e,tc((i-9)/9,2)*e]},xH=(t,e,n,r)=>{vH(t),r=r|1;let i=pu(t[0]),s=Math.floor(i/9)+1,o=i%9+1,a=(pu(t[1])+1)/166,l=new Array(o*s);for(let f=0;f<l.length;f++)if(f===0){let d=pu(t.substring(2,6));l[f]=wH(d)}else{let d=pu(t.substring(4+f*2,6+f*2));l[f]=EH(d,a*r)}let c=e*4,u=new Uint8ClampedArray(c*n);for(let f=0;f<n;f++)for(let d=0;d<e;d++){let h=0,p=0,g=0;for(let C=0;C<s;C++)for(let N=0;N<o;N++){let O=Math.cos(Math.PI*d*N/e)*Math.cos(Math.PI*f*C/n),A=l[N+C*o];h+=A[0]*O,p+=A[1]*O,g+=A[2]*O}let m=ec(h),v=ec(p),x=ec(g);u[4*d+0+f*c]=m,u[4*d+1+f*c]=v,u[4*d+2+f*c]=x,u[4*d+3+f*c]=255}return u},SH=xH,YE=4,AH=(t,e,n,r)=>{let i=0,s=0,o=0,a=e*YE;for(let c=0;c<e;c++){let u=YE*c;for(let f=0;f<n;f++){let d=u+f*a,h=r(c,f);i+=h*Ql(t[d]),s+=h*Ql(t[d+1]),o+=h*Ql(t[d+2])}}let l=1/(e*n);return[i*l,s*l,o*l]},_H=t=>{let e=ec(t[0]),n=ec(t[1]),r=ec(t[2]);return(e<<16)+(n<<8)+r},kH=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor(tc(t[0]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(tc(t[1]/e,.5)*9+9.5)))),i=Math.floor(Math.max(0,Math.min(18,Math.floor(tc(t[2]/e,.5)*9+9.5))));return n*19*19+r*19+i},CH=(t,e,n,r,i)=>{if(r<1||r>9||i<1||i>9)throw new lh("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new lh("Width and height must match the pixels array");let s=[];for(let f=0;f<i;f++)for(let d=0;d<r;d++){let h=d==0&&f==0?1:2,p=AH(t,e,n,(g,m)=>h*Math.cos(Math.PI*d*g/e)*Math.cos(Math.PI*f*m/n));s.push(p)}let o=s[0],a=s.slice(1),l="",c=r-1+(i-1)*9;l+=iu(c,1);let u;if(a.length>0){let f=Math.max(...a.map(h=>Math.max(...h))),d=Math.floor(Math.max(0,Math.min(82,Math.floor(f*166-.5))));u=(d+1)/166,l+=iu(d,1)}else u=1,l+=iu(0,1);return l+=iu(_H(o),4),a.forEach(f=>{l+=iu(kH(f,u),2)}),l},TH=CH;async function aC(t){if(!t.url)throw new Error("url is required for imeta tag");if(!t.m)throw new Error("m (MIME type) is required for imeta tag");let e=t.dim;if(!e&&t.url)try{e=await new Promise(i=>{const s=new window.Image;s.onload=()=>{i(`${s.naturalWidth}x${s.naturalHeight}`)},s.onerror=()=>i(void 0),s.src=t.url})}catch{e=void 0}const n=yH({content:t.content||"",url:t.url,m:t.m,x:t.x||"",ox:t.ox||"",size:t.size,dim:e,blurhash:t.blurhash,thumb:t.thumb,image:t.image,summary:t.summary,alt:t.alt,fallback:t.fallback}),r=[`url ${t.url}`];for(const i of n.tags){const[s,...o]=i;s!=="url"&&(o.length===1?r.push(`${s} ${o[0]}`):o.length>1&&r.push(`${s} ${o.join(" ")}`))}return["imeta",...r]}async function IH(t){try{if(Rt.value)return null;const e=await new Promise((o,a)=>{const l=URL.createObjectURL(t),c=new window.Image;c.onload=()=>{URL.revokeObjectURL(l),o(c)},c.onerror=u=>{URL.revokeObjectURL(l),a(u)},c.src=l});if(Rt.value)return null;const n=document.createElement("canvas");n.width=Math.min(e.width,64),n.height=Math.min(e.height,64);const r=n.getContext("2d");if(!r)return null;r.drawImage(e,0,0,n.width,n.height);const i=r.getImageData(0,0,n.width,n.height);return TH(i.data,i.width,i.height,4,4)}catch{return null}}async function OH(t){try{return URL.createObjectURL(t)}catch{return null}}async function MH(t){return await IH(t)}function lC(t){const e={};return t&&t.state&&t.state.doc&&t.state.doc.descendants(n=>{n.type?.name==="image"&&n.attrs?.src&&n.attrs?.blurhash&&!n.attrs?.isPlaceholder&&!n.attrs?.src?.startsWith("placeholder-")&&(e[n.attrs.src]=n.attrs.blurhash)}),e}function LH(t,e,n,r){try{const i=SH(t,n,r),s=e.getContext("2d");if(!s)return!1;const o=new ImageData(new Uint8ClampedArray(Array.from(i)),n,r);return s.putImageData(o,0,0),!0}catch(i){return console.warn("Failed to decode blurhash:",i),!1}}function cC(t){const e=t.split(".").pop()?.toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",svg:"image/svg+xml"}[e||""]||"image/jpeg"}async function $H(t){try{const e=await fetch(t);if(!e.ok)return null;const n=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}catch(e){return console.warn("Failed to calculate image hash:",e),null}}const JE={maxWidth:780,maxHeight:240};function uC(t,e,n=JE.maxWidth,r=JE.maxHeight){if(t<=n&&e<=r)return{width:t,height:e,displayWidth:t,displayHeight:e};const i=t/e;let s,o;return t/n>e/r?(s=n,o=Math.round(n/i)):(o=r,s=Math.round(r*i)),{width:t,height:e,displayWidth:s,displayHeight:o}}function NH(t){if(!t)return null;const e=t.match(/^(\d+)x(\d+)$/);return e?{width:parseInt(e[1],10),height:parseInt(e[2],10)}:null}function t0(){return{width:200,height:150,displayWidth:200,displayHeight:150}}function PH(t,e,n){return{start:{nodePos:n?.()},move:e,end:{nodeData:e?.nodeData||{pos:n?.()},dropX:0,dropY:0,target:null,dropPosition:null,...e}}[t]}function RH(t){return{start:"touch-image-drag-start",move:"touch-image-drag-move",end:"touch-image-drop"}[t]}function su(t,e,n){const r=RH(t),i=PH(t,e,n),s=new CustomEvent(r,{detail:i,bubbles:!0,cancelable:!0});window.dispatchEvent(s),document.dispatchEvent(new CustomEvent(r,{detail:s.detail}))}function DH(t,e){return document.elementFromPoint(t,e)?.closest(".drop-zone-indicator")||null}function BH(){pa.querySelectorAll(".drop-zone-indicator").forEach(t=>{t.classList.remove("drop-zone-hover")})}function UH(t){t?.classList.add("drop-zone-hover")}function HH(t,e){BH();const n=DH(t,e);UH(n)}function FH(t,e=140){const n=Math.min(e,t.width||e),r=t.width>0?Math.round(t.height/t.width*n):n;return{width:n,height:r}}function zH(t){if(!t)return null;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n&&n.drawImage(t,0,0),e}function jH(t){if(!t)return null;const e=document.createElement("img");return e.src=t.src,e.alt=t.alt||"",e}function VH(t,e,n){Object.assign(t.style,{width:`${e.width}px`,height:`${e.height}px`,left:`${n.x-e.width/2}px`,top:`${n.y-e.height/2}px`,transformOrigin:"center center",transition:"transform 120ms ease, opacity 120ms ease"})}function qH(t,e,n,r=!1){const i=t.getBoundingClientRect(),s=FH(i);let o=null;if(r){const a=t.querySelector("canvas");a&&(o=zH(a))}else{const a=t.querySelector("img");a&&(o=jH(a))}return o?(VH(o,s,{x:e,y:n}),o.classList.add("drag-preview"),document.body.appendChild(o),requestAnimationFrame(()=>{o.style.transform="scale(0.8) rotate(0deg)",o.style.opacity="0.95"}),o):null}function WH(t,e,n){if(!t)return;const r=t.getBoundingClientRect(),i=r.width||100,s=r.height||100;t.style.left=`${e-i/2}px`,t.style.top=`${n-s/2}px`}function n0(t){t?.parentNode?.removeChild(t)}function KH(t,e,n,r,i){const s=t-n,o=e-r;return s*s+o*o>i*i}function GH(t,e,n,r){return!!(t||e||n&&!r)}function ZH(t){const e=t();cs()&&sC();const n=new CustomEvent("select-image-node",{detail:{pos:e}});window.dispatchEvent(n),document.dispatchEvent(n)}function YH(t,e,n,r,i,s,o,a,l){return GH(n,r,s,e)?(t.preventDefault(),!1):(i||ZH(l),t.preventDefault(),e||t.stopPropagation(),!0)}function JH(t,e,n){return!!(t&&e&&n.displayWidth>0&&n.displayHeight>0)}function XH(t,e){t.width=e.displayWidth,t.height=e.displayHeight}function XE(t,e,n,r,i=!1){JH(t,e,n)&&(XH(e,n),LH(t,e,n.displayWidth,n.displayHeight))}const fC={getItem:t=>localStorage.getItem(t),setItem:(t,e)=>localStorage.setItem(t,e)},QH={language:navigator.language},eF={location:{reload:()=>window.location.reload()}},tF={setTimeout:(t,e)=>setTimeout(t,e)};function ch(t){return t===0?"0KB":`${Math.round(t/1024)}KB`}function nF(t,e){return t>0?Math.round(e/t*100):100}function rF(t,e){return`${ch(t)} → ${ch(e)}`}function iF(t,e,n,r,i,s){return{originalSize:t,compressedSize:e,wasCompressed:n,compressionRatio:nF(t,e),sizeReduction:rF(t,e),originalFilename:r,compressedFilename:i,wasSkipped:s}}function sF(t){return t.wasCompressed||t.originalFilename!==t.compressedFilename||t.originalSize!==t.compressedSize||!!t.wasSkipped}function QE(t){return!t||!sF(t)?null:{wasCompressed:t.wasCompressed,originalSize:ch(t.originalSize),compressedSize:ch(t.compressedSize),compressionRatio:t.compressionRatio,originalFilename:t.originalFilename,compressedFilename:t.compressedFilename,wasSkipped:t.wasSkipped}}function oF(t){return oH.test(t)}function aF(t){return aH.test(t)}function lF(t){return Hp(t)}function cF(t){return{npub:ha.npubEncode(t),nprofile:ha.nprofileEncode({pubkey:t,relays:[]})}}function uF(t){try{const{type:e,data:n}=ha.decode(t);if(e!=="nsec")return console.warn("無効なnsec形式です"),{hex:"",npub:"",nprofile:""};const r=lF(n),{npub:i,nprofile:s}=cF(r);return{hex:r,npub:i,nprofile:s}}catch{return{hex:"",npub:"",nprofile:""}}}function dC(t){try{return ha.npubEncode(t)}catch{return`npub1${t.slice(0,10)}...`}}async function hC(t,e=window.crypto.subtle){if(Rt.value)throw new Error("Upload aborted by user");const n=await t.arrayBuffer(),r=await e.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function fF(t,e){try{return await hC(t,e)}catch{return}}async function dF(t){return new Promise(e=>{if(!t.type.startsWith("image/")){e(null);return}const n=new Image,r=URL.createObjectURL(t);n.onload=()=>{try{const i=uC(n.naturalWidth,n.naturalHeight);URL.revokeObjectURL(r),e(i)}catch(i){console.error("Failed to calculate image display size:",i),URL.revokeObjectURL(r),e(null)}},n.onerror=()=>{URL.revokeObjectURL(r),e(null)},n.src=r})}function hF(t,e){const r={"image/webp":".webp","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/avif":".avif","image/bmp":".bmp"}[e];return r?`${t.replace(/\.[^.]+$/,"")}${r}`:t}function qp(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function pF(t,e=fC){if(!t)return[];const n=`${Pr.NOSTR_RELAYS}${t}`;try{const r=JSON.parse(e.getItem(n)??"null");return Array.isArray(r)?r:r&&typeof r=="object"?Object.entries(r).filter(([,i])=>i&&typeof i=="object"&&"write"in i&&i.write).map(([i])=>i):[]}catch{return[]}}function gF(t,e){const n=t.getItem(Pr.LOCALE),r=e.language;return n||(r&&r.startsWith("ja")?"ja":"en")}function mF(t,e,n){const r=e.getItem(Pr.UPLOAD_ENDPOINT);return r&&rC.some(i=>i.url===r)?r:n||Yv(t)}function yF(t){const e=t.getItem(Pr.CLIENT_TAG_ENABLED),n=e===null?!0:e==="true";return e===null&&t.setItem(Pr.CLIENT_TAG_ENABLED,"true"),n}function bF(t,e){return t.getItem(Pr.IMAGE_COMPRESSION_LEVEL)||e||"medium"}function vF(t={}){const{selectedEndpoint:e,selectedCompression:n,storage:r=fC,navigator:i=QH}=t,s=gF(r,i),o=mF(s,r,e),a=yF(r),l=bF(r,n);return{endpoint:o,clientTagEnabled:a,compression:l}}function wF(t,e,n={}){const{timeout:r=1e3,windowAdapter:i=eF,timeoutAdapter:s=tF}=n;e(!0),t(),s.setTimeout(()=>{i.location.reload()},r)}async function pC(t,e,n,r="readonly"){return new Promise(i=>{try{const s=indexedDB.open(t,e);s.onupgradeneeded=o=>{const a=o.target.result;a.objectStoreNames.contains(n)||a.createObjectStore(n,{keyPath:"id"})},s.onerror=()=>i(null),s.onsuccess=o=>{try{const a=o.target.result;if(!a.objectStoreNames.contains(n)){a.close(),i(null);return}const l=a.transaction([n],r),c=l.objectStore(n);i({db:a,transaction:l,store:c})}catch{i(null)}}}catch{i(null)}})}async function EF(t,e,n,r){const i=await pC(t,e,n,"readonly");if(!i)return null;const{db:s,store:o}=i;return new Promise(a=>{const l=o.get(r);l.onsuccess=()=>{s.close(),a(l.result)},l.onerror=()=>{s.close(),a(null)}})}async function xF(t,e,n,r){const i=await pC(t,e,n,"readwrite");if(!i)return!1;const{db:s,store:o}=i;return new Promise(a=>{const l=o.delete(r);l.onsuccess=()=>{s.close(),a(!0)},l.onerror=()=>{s.close(),a(!1)}})}function SF(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function Jv(t,e=Rs.REQUEST_TIMEOUT){if(!navigator.serviceWorker.controller)throw new Error("No ServiceWorker controller available");const n=new MessageChannel,r=SF();return new Promise((i,s)=>{const o=setTimeout(()=>{n.port1.close(),s(new Error("ServiceWorker communication timeout"))},e);n.port1.onmessage=a=>{clearTimeout(o),n.port1.close();const{data:l}=a.data||{};i(l)},n.port1.addEventListener("error",a=>{clearTimeout(o),n.port1.close(),s(a)});try{if(navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({...t,requestId:r},[n.port2]);else throw new Error("ServiceWorker controller became unavailable")}catch(a){clearTimeout(o),n.port1.close(),s(a)}})}async function AF(){if(!navigator.serviceWorker.controller)return new Promise((t,e)=>{const n=setTimeout(()=>{navigator.serviceWorker.removeEventListener("controllerchange",r),e(new Error("ServiceWorkerコントローラー待機タイムアウト"))},Rs.REQUEST_TIMEOUT),r=()=>{clearTimeout(n),navigator.serviceWorker.removeEventListener("controllerchange",r),setTimeout(t,Rs.SW_CONTROLLER_WAIT_TIMEOUT)};navigator.serviceWorker.addEventListener("controllerchange",r)})}async function _F(){const t=await EF(Rs.INDEXEDDB_NAME,Rs.INDEXEDDB_VERSION,Rs.STORE_NAME,"sharedImageData");return t?.data?(await xF(Rs.INDEXEDDB_NAME,Rs.INDEXEDDB_VERSION,Rs.STORE_NAME,"sharedImageData"),t.data.image?.arrayBuffer&&t.data.image._isFile?{image:new File([t.data.image.arrayBuffer],t.data.image.name||"shared-image",{type:t.data.image.type||"image/jpeg"}),metadata:t.data.metadata}:t.data):null}async function kF(){try{const t=await Jv({action:"getSharedImage"});return t&&t.image?t:null}catch(t){return console.error("Failed to send message to ServiceWorker:",t),null}}async function CF(){try{try{await Promise.race([AF(),new Promise((t,e)=>setTimeout(()=>e(new Error("SW controller timeout")),2e3))])}catch(t){console.warn("Service Worker controller not ready, trying alternatives:",t)}try{const t=await kF();if(t)return console.log("Shared image retrieved via ServiceWorker MessageChannel"),t}catch(t){console.warn("Service Worker MessageChannel failed:",t)}try{const t=await _F();if(t)return console.log("Shared image retrieved via IndexedDB fallback"),t}catch(t){console.warn("IndexedDB fallback failed:",t)}try{const t=await Jv({action:"getSharedImageForce"},1e3),e=t&&t.image?t:null;if(e)return console.log("Shared image retrieved via forced Service Worker request"),e}catch(t){console.warn("Forced Service Worker request failed:",t)}return console.log("No shared image found through any method"),null}catch(t){return console.error("Error in getSharedImageWithFallback:",t),null}}async function TF(){if(!("serviceWorker"in navigator))return{isReady:!1,hasController:!1,error:"Service Worker not supported"};const t=await navigator.serviceWorker.getRegistration(),e=!!navigator.serviceWorker.controller;return t?{isReady:t.active!==null,hasController:e}:{isReady:!1,hasController:e,error:"Service Worker not registered"}}async function IF(){try{const t=await Jv({type:"PING_TEST"},3e3);return console.log("ServiceWorker communication test successful:",t),!0}catch(t){return console.warn("ServiceWorker communication test timeout"),console.error("ServiceWorker communication test error:",t),!1}}function jl(t){if(t.type.startsWith("touch")){const e=t,n=e.touches[0]||e.changedTouches[0];return{x:n.clientX,y:n.clientY}}else{const e=t;return{x:e.clientX,y:e.clientY}}}function nc(t,e,n,r,i){const s=window.innerWidth||document.documentElement.clientWidth||0,o=window.innerHeight||document.documentElement.clientHeight||0,a=typeof n=="number"?n:0,l=r?s-r-a:s-a,c=i?o-i-a:o-a;return{x:Math.max(a,Math.min(l,t)),y:Math.max(a,Math.min(c,e))}}async function OF(t,e){const n=[];if(Rt.value)throw new Error("Upload aborted by user");for(let r=0;r<t.length;r++){const i=t[r],[s,o]=await Promise.all([fF(i,e.crypto),e.getImageDimensions(i)]);n.push({file:i,index:r,ox:s,dimensions:o??void 0})}return n}function MF(t){return t.map(e=>({caption:e.name,expiration:"",size:e.size,alt:e.name,media_type:void 0,content_type:e.type||"",no_transform:"true"}))}class ex{static addCacheBuster(e){if(!e)return e;try{const n=new URL(e);return n.searchParams.set("cb",Date.now().toString()),n.toString()}catch{return e}}static addProfileMarker(e,n=!1,r=!0){if(!e)return e;try{const i=new URL(e);return i.searchParams.set("profile","true"),n&&r?i.searchParams.has("cb")&&i.searchParams.set("cb",Date.now().toString()):i.searchParams.delete("cb"),i.toString()}catch{return e}}}class LF{constructor(e={}){this.deps=e}createProfileData(e,n,r=!1){let i=e?.picture||"";if(i){r&&(i=ex.addCacheBuster(i));const s=this.deps.navigator?.onLine??!0;i=ex.addProfileMarker(i,r,s)}return{name:e?.name||"",picture:i,npub:dC(n)}}}class $F{constructor(e,n,r){this.localStorage=e,this.console=n,this.profileDataFactory=r}save(e,n){try{if(n===null){this.localStorage.removeItem(`nostr-profile-${e}`);return}this.localStorage.setItem(`nostr-profile-${e}`,JSON.stringify(n)),this.console.log("プロフィール情報をローカルストレージに保存:",e)}catch(r){this.console.error("プロフィール情報の保存に失敗:",r)}}get(e){try{const n=this.localStorage.getItem(`nostr-profile-${e}`);if(!n)return null;const r=JSON.parse(n);return this.profileDataFactory.createProfileData(r,e,!1)}catch(n){return this.console.error("プロフィール情報の取得に失敗:",n),null}}clear(e){this.save(e,null)}}class NF{constructor(e,n,r,i,s){this.rxNostr=e,this.profileDataFactory=n,this.setTimeoutFn=r,this.clearTimeoutFn=i,this.console=s}async fetchFromNetwork(e,n){const r=n?.timeoutMs??3e3;return new Promise(i=>{const s=jd();let o=!1,a=null,l=!1,c;const u=()=>{a!=null&&(this.clearTimeoutFn(a),a=null),c&&typeof c.unsubscribe=="function"&&(c.unsubscribe(),c=void 0)},f=d=>{l||(l=!0,u(),i(d))};c=this.rxNostr.use(s).subscribe({next:d=>{if(!l&&d.event?.kind===0&&d.event.pubkey===e){o=!0;try{const h=JSON.parse(d.event.content),p=this.profileDataFactory.createProfileData(h,e,n?.forceRemote);this.console.log("Kind 0からプロフィール情報を取得:",p),f(p)}catch(h){this.console.error("Kind 0のパースエラー:",h),f(null)}}},error:d=>{l||(this.console.error("プロフィール取得エラー:",d),f(null))}}),a=this.setTimeoutFn(()=>{if(!l&&!o){this.console.log("プロフィール取得タイムアウト、デフォルトプロフィールを使用");const d=this.profileDataFactory.createProfileData({},e,n?.forceRemote);f(d)}},r),s.emit({authors:[e],kinds:[0]})})}}class PF{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.navigator||(typeof window<"u"?window.navigator:{onLine:!0}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.console||(typeof window<"u"?window.console:{});this.profileDataFactory=new LF({navigator:i}),this.storage=new $F(r,a,this.profileDataFactory),this.networkFetcher=new NF(e,this.profileDataFactory,s,o,a)}storage;networkFetcher;profileDataFactory;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}async fetchProfileData(e,n){const r=this.networkFetcher.console;if(r.log(`プロフィール取得開始: ${e}`),!n?.forceRemote){const s=this.storage.get(e);if(s)return r.log("キャッシュからプロフィールを復元:",s),s}r.log("リモートからプロフィール情報を取得中...");const i=await this.networkFetcher.fetchFromNetwork(e,n);return i&&this.storage.save(e,i),i}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}getProfileDataFactory(){return this.profileDataFactory}}class uh{static parseKind10002Tags(e){const n={};return e.filter(r=>Array.isArray(r)&&r.length>=2&&r[0]==="r").forEach(r=>{const i=r[1];if(!i||typeof i!="string")return;let s=!0,o=!0;r.length>2&&(r.length===3?r[2]==="read"?o=!1:r[2]==="write"&&(s=!1):(s=r.includes("read"),o=r.includes("write"))),n[i]={read:s,write:o}}),n}static parseKind3Content(e){try{const n=JSON.parse(e);return n&&typeof n=="object"&&!Array.isArray(n)?n:null}catch{return null}}static isValidRelayConfig(e){return e?Array.isArray(e)?e.every(n=>typeof n=="string"):typeof e=="object"?Object.entries(e).every(([n,r])=>typeof n=="string"&&r&&typeof r=="object"&&"read"in r&&"write"in r&&typeof r.read=="boolean"&&typeof r.write=="boolean"):!1:!1}}class RF{constructor(e,n,r){this.localStorage=e,this.console=n,this.relayListUpdatedStore=r}save(e,n){try{const r=`nostr-relays-${e}`;if(n===null){this.localStorage.removeItem(r),this.console.log(`リレーリストを削除: ${e}`);return}if(!uh.isValidRelayConfig(n)){this.console.warn("無効なリレー設定のため保存をスキップ:",n);return}this.localStorage.setItem(r,JSON.stringify(n)),this.relayListUpdatedStore&&this.relayListUpdatedStore.set(this.relayListUpdatedStore.value+1),this.console.log("リレーリストをローカルストレージに保存:",e)}catch(r){this.console.error("リレーリストの保存に失敗:",r)}}get(e){try{const n=`nostr-relays-${e}`,r=this.localStorage.getItem(n);if(!r)return null;const i=JSON.parse(r);return uh.isValidRelayConfig(i)?i:null}catch(n){return this.console.error("リレーリストの取得に失敗:",n),null}}clear(e){this.save(e,null)}}class DF{constructor(e,n,r,i){this.rxNostr=e,this.console=n,this.setTimeoutFn=r,this.clearTimeoutFn=i}async fetchKind10002(e,n,r=3e3){return this.console.log(`Kind 10002取得試行: ${e}`),new Promise(i=>{const s=jd();let o=!1,a=null,l=!1,c;const u=()=>{a!=null&&(this.clearTimeoutFn(a),a=null),c&&typeof c.unsubscribe=="function"&&(c.unsubscribe(),c=void 0)},f=d=>{l||(l=!0,u(),i(d))};try{c=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:d=>{if(!l&&d.event?.kind===10002&&d.event.pubkey===e)try{const h=uh.parseKind10002Tags(d.event.tags);Object.keys(h).length>0&&(o=!0,this.console.log("Kind 10002からリレーを取得:",h),f({success:!0,relayConfig:h,source:"kind10002"}))}catch(h){this.console.error("Kind 10002のパースエラー:",h)}},error:d=>{l||(this.console.error("Kind 10002取得エラー:",d),f({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[10002]}),a=this.setTimeoutFn(()=>{l||(o||this.console.log("Kind 10002: タイムアウト"),f({success:o,error:o?void 0:"timeout"}))},r)}catch(d){this.console.error("Kind 10002リクエスト作成エラー:",d),f({success:!1,error:"request_error"})}})}async fetchKind3(e,n,r=3e3){return this.console.log(`Kind 3取得試行: ${e}`),new Promise(i=>{const s=jd();let o=!1,a=null,l=!1,c;const u=()=>{a!=null&&(this.clearTimeoutFn(a),a=null),c&&typeof c.unsubscribe=="function"&&(c.unsubscribe(),c=void 0)},f=d=>{l||(l=!0,u(),i(d))};try{c=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:d=>{if(!l&&d.event?.kind===3&&d.event.pubkey===e){const h=uh.parseKind3Content(d.event.content);h&&(o=!0,this.console.log("Kind 3からリレーを取得:",h),f({success:!0,relayConfig:h,source:"kind3"}))}},error:d=>{l||(this.console.error("Kind 3取得エラー:",d),f({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[3]}),a=this.setTimeoutFn(()=>{l||(o||this.console.log("Kind 3: タイムアウト"),f({success:o,error:o?void 0:"timeout"}))},r)}catch(d){this.console.error("Kind 3リクエスト作成エラー:",d),f({success:!1,error:"request_error"})}})}}class BF{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.console||(typeof window<"u"?window.console:{}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.relayListUpdatedStore||(typeof window<"u"?{value:0,set:l=>{}}:void 0);this.storage=new RF(r,i,a),this.networkFetcher=new DF(e,i,s,o)}storage;networkFetcher;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}setBootstrapRelays(){try{this.rxNostr.use(jd(),{on:{relays:Xm}}).subscribe()}catch(e){console.error("Bootstrap relays設定エラー:",e)}}useRelaysFromLocalStorageIfExists(e){const n=this.storage.get(e);if(n)try{return this.rxNostr.setDefaultRelays(n),console.log("ローカルストレージのリレーリストを使用:",n),!0}catch(r){return console.error("ローカルストレージのリレー設定エラー:",r),this.storage.clear(e),!1}return!1}async fetchUserRelays(e,n={}){const r=n.timeoutMs||3e3;if(console.log(`リレー取得開始: ${e}`),!n.forceRemote&&this.useRelaysFromLocalStorageIfExists(e))return console.log("ローカルストレージからリレーを復元しました"),!0;console.log("リモートからリレー情報を取得中...");const i=await this.networkFetcher.fetchKind10002(e,Xm,r);if(i.success&&i.relayConfig)return this.rxNostr.setDefaultRelays(i.relayConfig),this.storage.save(e,i.relayConfig),console.log("Kind 10002からリレー取得成功"),!0;const s=await this.networkFetcher.fetchKind3(e,Xm,r);return s.success&&s.relayConfig?(this.rxNostr.setDefaultRelays(s.relayConfig),this.storage.save(e,s.relayConfig),console.log("Kind 3からリレー取得成功"),!0):(console.log("リモート取得失敗、フォールバックリレーを使用"),this.rxNostr.setDefaultRelays(Qm),console.log("フォールバックリレーを設定:",Qm),this.storage.save(e,Qm),!1)}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}}function Vn(t){this.content=t}Vn.prototype={constructor:Vn,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new Vn(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Vn(n)},addToStart:function(t,e){return new Vn([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Vn(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new Vn(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Vn.from(t),t.size?new Vn(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Vn.from(t),t.size?new Vn(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Vn.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Vn.from=function(t){if(t instanceof Vn)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Vn(e)};function gC(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=gC(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function mC(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=mC(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class _e{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:s+=r),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new _e(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new _e(r,i)}cutByIndex(e,n){return e==n?_e.empty:e==0&&n==this.content.length?this:new _e(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new _e(i,s)}addToStart(e){return new _e([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new _e(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return gC(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return mC(this,e,n,r)}findIndex(e){if(e==0)return nd(0,e);if(e==this.size)return nd(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),s=r+i.nodeSize;if(s>=e)return s==e?nd(n+1,s):nd(n,r);r=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return _e.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new _e(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return _e.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new _e(n||e,r)}static from(e){if(!e)return _e.empty;if(e instanceof _e)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new _e([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}_e.empty=new _e([],0);const r0={index:0,offset:0};function nd(t,e){return r0.index=t,r0.offset=e,r0}function fh(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!fh(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!fh(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let zt=class Fy{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&fh(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let i=r.create(n.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return Fy.none;if(e instanceof Fy)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}};zt.none=[];class dh extends Error{}class Ue{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=bC(this.content,e+this.openStart,n);return r&&new Ue(r,this.openStart,this.openEnd)}removeBetween(e,n){return new Ue(yC(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return Ue.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Ue(_e.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new Ue(e,r,i)}}Ue.empty=new Ue(_e.empty,0,0);function yC(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(yC(s.content,e-i-1,n-i-1)))}function bC(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=bC(o.content,e-s-1,n,o);return a&&t.replaceChild(i,o.copy(a))}function UF(t,e,n){if(n.openStart>t.depth)throw new dh("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new dh("Inconsistent open depths");return vC(t,e,n,0)}function vC(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=vC(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return tl(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=HF(n,t);return tl(s,EC(t,o,a,e,r))}else return tl(s,hh(t,e,r))}function wC(t,e){if(!e.type.compatibleContent(t.type))throw new dh("Cannot join "+e.type.name+" onto "+t.type.name)}function zy(t,e,n){let r=t.node(n);return wC(r,e.node(n)),r}function el(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Cu(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(el(t.nodeAfter,r),s++));for(let a=s;a<o;a++)el(i.child(a),r);e&&e.depth==n&&e.textOffset&&el(e.nodeBefore,r)}function tl(t,e){return t.type.checkContent(e),t.copy(e)}function EC(t,e,n,r,i){let s=t.depth>i&&zy(t,e,i+1),o=r.depth>i&&zy(n,r,i+1),a=[];return Cu(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(wC(s,o),el(tl(s,EC(t,e,n,r,i+1)),a)):(s&&el(tl(s,hh(t,e,i+1)),a),Cu(e,n,i,a),o&&el(tl(o,hh(n,r,i+1)),a)),Cu(r,null,i,a),new _e(a)}function hh(t,e,n){let r=[];if(Cu(null,t,n,r),t.depth>n){let i=zy(t,e,n+1);el(tl(i,hh(t,e,n+1)),r)}return Cu(e,null,n,r),new _e(r)}function HF(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(_e.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class Zu{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return zt.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new ph(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new Zu(n,r,s)}static resolveCached(e,n){let r=tx.get(e);if(r)for(let s=0;s<r.elts.length;s++){let o=r.elts[s];if(o.pos==n)return o}else tx.set(e,r=new FF);let i=r.elts[r.i]=Zu.resolve(e,n);return r.i=(r.i+1)%zF,i}}class FF{constructor(){this.elts=[],this.i=0}}const zF=12,tx=new WeakMap;class ph{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const jF=Object.create(null);let na=class jy{constructor(e,n,r,i=zt.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||_e.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&fh(this.attrs,n||e.defaultAttrs||jF)&&zt.sameSet(this.marks,r||zt.none)}copy(e=null){return e==this.content?this:new jy(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new jy(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return Ue.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new Ue(c,i.depth-o,s.depth-o)}replace(e,n,r){return UF(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return Zu.resolveCached(this,e)}resolveNoCache(e){return Zu.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),xC(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=_e.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=zt.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!zt.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=_e.fromJSON(e,n.content),s=e.nodeType(n.type).create(n.attrs,i,r);return s.type.checkAttrs(s.attrs),s}};na.prototype.text=void 0;class gh extends na{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):xC(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new gh(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new gh(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function xC(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class dl{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new VF(e,n);if(r.next==null)return dl.empty;let i=SC(r);r.next&&r.err("Unexpected trailing text");let s=JF(YF(i));return XF(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return _e.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:f}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(f)==-1){i.push(f);let d=s(f,a.concat(u));if(d)return d}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}dl.empty=new dl(!0);class VF{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function SC(t){let e=[];do e.push(qF(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function qF(t){let e=[];do e.push(WF(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function WF(t){let e=ZF(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=KF(t,e);else break;return e}function nx(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function KF(t,e){let n=nx(t),r=n;return t.eat(",")&&(t.next!="}"?r=nx(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function GF(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function ZF(t){if(t.eat("(")){let e=SC(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=GF(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function YF(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function AC(t,e){return e-t}function rx(t,e){let n=[];return r(e),n.sort(AC);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function JF(t){let e=Object.create(null);return n(rx(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);rx(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new dl(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(AC);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function XF(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function _C(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function kC(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function CC(t,e,n,r){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${n} of type ${i}`);for(let i in t){let s=t[i];s.validate&&s.validate(e[i])}}function TC(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new ez(t,r,e[r]);return n}let ix=class IC{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=TC(e,r.attrs),this.defaultAttrs=_C(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==dl.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:kC(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new na(this,this.computeAttrs(e),_e.from(n),zt.setFrom(r))}createChecked(e=null,n,r){return n=_e.from(n),this.checkContent(n),new na(this,this.computeAttrs(e),n,zt.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=_e.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(_e.empty,!0);return s?new na(this,e,n.append(s),zt.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){CC(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:zt.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new IC(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function QF(t,e,n){let r=n.split("|");return i=>{let s=i===null?"null":typeof i;if(r.indexOf(s)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${s}`)}}class ez{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?QF(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Wp{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=TC(e,i.attrs),this.excluded=null;let s=_C(this.attrs);this.instance=s?new zt(this,s):null}create(e=null){return!e&&this.instance?this.instance:new zt(this,kC(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new Wp(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){CC(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class OC{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let i in e)n[i]=e[i];n.nodes=Vn.from(e.nodes),n.marks=Vn.from(e.marks||{}),this.nodes=ix.compile(this.spec.nodes,this),this.marks=Wp.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=r[o]||(r[o]=dl.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?sx(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:sx(this,o.split(" "))}this.nodeFromJSON=i=>na.fromJSON(this,i),this.markFromJSON=i=>zt.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof ix){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new gh(r,r.defaultAttrs,e,zt.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function sx(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function tz(t){return t.tag!=null}function nz(t){return t.style!=null}class ra{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(i=>{if(tz(i))this.tags.push(i);else if(nz(i)){let s=/[^=]*/.exec(i.style)[0];r.indexOf(s)<0&&r.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,n={}){let r=new ax(this,n,!1);return r.addAll(e,zt.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new ax(this,n,!0);return r.addAll(e,zt.none,n.from,n.to),Ue.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(sz(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=lx(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=lx(o)),o.node||o.ignore||o.mark||(o.node=i)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new ra(e,ra.schemaRules(e)))}}const MC={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},rz={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},LC={ol:!0,ul:!0},Yu=1,Vy=2,Tu=4;function ox(t,e,n){return e!=null?(e?Yu:0)|(e==="full"?Vy:0):t&&t.whitespace=="pre"?Yu|Vy:n&~Tu}class rd{constructor(e,n,r,i,s,o){this.type=e,this.attrs=n,this.marks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=zt.none,this.match=s||(o&Tu?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(_e.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&Yu)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=_e.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(_e.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!MC.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class ax{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let i=n.topNode,s,o=ox(null,n.preserveWhitespace,0)|(r?Tu:0);i?s=new rd(i.type,i.attrs,zt.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new rd(null,null,zt.none,!0,null,o):s=new rd(e.schema.topNodeType,null,zt.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,i=this.top,s=i.options&Vy?"full":this.localPreserveWS||(i.options&Yu)>0;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(s)s!=="full"?r=r.replace(/\r?\n|\r/g," "):r=r.replace(/\r\n?/g,`
`);else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],a=e.previousSibling;(!o||a&&a.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;LC.hasOwnProperty(o)&&this.parser.normalizeLists&&iz(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:rz.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(MC.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=r.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,i){let s,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(s=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,n,r,i){let s=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,n);this.findAtPoint(e,s)}findPlace(e,n,r){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)n=this.enterInner(i[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(n=this.enterInner(s,null,n))}let i=this.findPlace(e,n,r);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=zt.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):cx(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,n,r,i){let s=this.findPlace(e.create(n),r,!1);return s&&(s=this.enterInner(e,n,r,!0,i)),s}enterInner(e,n,r,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=ox(e,s,o.options);o.options&Tu&&o.content.length==0&&(a|=Tu);let l=zt.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):cx(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new rd(e,n,l,i,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=Yu)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function iz(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&LC.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function sz(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function lx(t){let e={};for(let n in t)e[n]=t[n];return e}function cx(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class Sl{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=i0(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=_d(i0(n),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&_d(i0(r),i(e,n),null,e.attrs)}static renderSpec(e,n,r=null,i){return _d(e,n,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Sl(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=ux(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return ux(e.marks)}}function ux(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function i0(t){return t.document||window.document}const fx=new WeakMap;function oz(t){let e=fx.get(t);return e===void 0&&fx.set(t,e=az(t)),e}function az(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)n(r[i]);else for(let i in r)n(r[i])}return n(t),e}function _d(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(s=oz(r))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));let a,l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let f in c)if(c[f]!=null){let d=f.indexOf(" ");d>0?l.setAttributeNS(f.slice(0,d),f.slice(d+1),c[f]):f=="style"&&l.style?l.style.cssText=c[f]:l.setAttribute(f,c[f])}}for(let f=u;f<e.length;f++){let d=e[f];if(d===0){if(f<e.length-1||f>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:h,contentDOM:p}=_d(t,d,n,r);if(l.appendChild(h),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const $C=65535,NC=Math.pow(2,16);function lz(t,e){return t+e*NC}function dx(t){return t&$C}function cz(t){return(t-(t&$C))/NC}const PC=1,RC=2,kd=4,DC=8;class qy{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&DC)>0}get deletedBefore(){return(this.delInfo&(PC|kd))>0}get deletedAfter(){return(this.delInfo&(RC|kd))>0}get deletedAcross(){return(this.delInfo&kd)>0}}class Qr{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Qr.empty)return Qr.empty}recover(e){let n=0,r=dx(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+cz(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],f=l+c;if(e<=f){let d=c?e==l?-1:e==f?1:n:n,h=l+i+(d<0?0:u);if(r)return h;let p=e==(n<0?l:f)?null:lz(a/3,e-l),g=e==l?RC:e==f?PC:kd;return(n<0?e!=l:e!=f)&&(g|=DC),new qy(h,g,p)}i+=u-c}return r?e+i:new qy(e+i,0,null)}touches(e,n){let r=0,i=dx(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Qr(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Qr.empty:new Qr(e<0?[0,-e,0]:[0,0,e])}}Qr.empty=new Qr([]);class Ju{constructor(e,n,r=0,i=e?e.length:0){this.mirror=n,this.from=r,this.to=i,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new Ju(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let i=e.getMirror(n);this.appendMap(e._maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e._maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new Ju;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new qy(e,i,null)}}const s0=Object.create(null);class yr{getMap(){return Qr.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=s0[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in s0)throw new RangeError("Duplicate use of step JSON ID "+e);return s0[e]=n,n.prototype.jsonID=e,n}}class xn{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new xn(e,null)}static fail(e){return new xn(null,e)}static fromReplace(e,n,r,i){try{return xn.ok(e.replace(n,r,i))}catch(s){if(s instanceof dh)return xn.fail(s.message);throw s}}}function Xv(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(Xv(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return _e.fromArray(r)}class Zo extends yr{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new Ue(Xv(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return xn.fromReplace(e,this.from,this.to,s)}invert(){return new us(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Zo(n.pos,r.pos,this.mark)}merge(e){return e instanceof Zo&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Zo(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Zo(n.from,n.to,e.markFromJSON(n.mark))}}yr.jsonID("addMark",Zo);class us extends yr{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new Ue(Xv(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return xn.fromReplace(e,this.from,this.to,r)}invert(){return new Zo(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new us(n.pos,r.pos,this.mark)}merge(e){return e instanceof us&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new us(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new us(n.from,n.to,e.markFromJSON(n.mark))}}yr.jsonID("removeMark",us);class Yo extends yr{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return xn.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return xn.fromReplace(e,this.pos,this.pos+1,new Ue(_e.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new Yo(this.pos,n.marks[i]);return new Yo(this.pos,this.mark)}}return new hl(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Yo(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Yo(n.pos,e.markFromJSON(n.mark))}}yr.jsonID("addNodeMark",Yo);class hl extends yr{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return xn.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return xn.fromReplace(e,this.pos,this.pos+1,new Ue(_e.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Yo(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new hl(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new hl(n.pos,e.markFromJSON(n.mark))}}yr.jsonID("removeNodeMark",hl);class $n extends yr{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&Wy(e,this.from,this.to)?xn.fail("Structure replace would overwrite content"):xn.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Qr([this.from,this.to-this.from,this.slice.size])}invert(e){return new $n(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new $n(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof $n)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?Ue.empty:new Ue(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new $n(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?Ue.empty:new Ue(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new $n(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new $n(n.from,n.to,Ue.fromJSON(e,n.slice),!!n.structure)}}yr.jsonID("replace",$n);class Dn extends yr{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(Wy(e,this.from,this.gapFrom)||Wy(e,this.gapTo,this.to)))return xn.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return xn.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?xn.fromReplace(e,this.from,this.to,r):xn.fail("Content does not fit in gap")}getMap(){return new Qr([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Dn(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new Dn(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Dn(n.from,n.to,n.gapFrom,n.gapTo,Ue.fromJSON(e,n.slice),n.insert,!!n.structure)}}yr.jsonID("replaceAround",Dn);function Wy(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function uz(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let f=l.marks;if(!r.isInSet(f)&&u.type.allowsMarkType(r.type)){let d=Math.max(c,e),h=Math.min(c+l.nodeSize,n),p=r.addToSet(f);for(let g=0;g<f.length;g++)f[g].isInSet(p)||(o&&o.to==d&&o.mark.eq(f[g])?o.to=h:i.push(o=new us(d,h,f[g])));a&&a.to==d?a.to=h:s.push(a=new Zo(d,h,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function fz(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof Wp){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let f=l[u],d;for(let h=0;h<i.length;h++){let p=i[h];p.step==s-1&&f.eq(i[h].style)&&(d=p)}d?(d.to=c,d.step=s):i.push({style:f,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new us(o.from,o.to,o.style)))}function Qv(t,e,n,r=n.contentMatch,i=!0){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,f=r.matchType(c.type);if(!f)o.push(new $n(a,u,Ue.empty));else{r=f;for(let d=0;d<c.marks.length;d++)n.allowsMarkType(c.marks[d].type)||t.step(new us(a,u,c.marks[d]));if(i&&c.isText&&n.whitespace!="pre"){let d,h=/\r?\n|\r/g,p;for(;d=h.exec(c.text);)p||(p=new Ue(_e.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new $n(a+d.index,a+d.index+d[0].length,p))}}a=u}if(!r.validEnd){let l=r.fillBefore(_e.empty,!0);t.replace(a,a,new Ue(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function dz(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Dc(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let i=t.$from.node(r),s=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&i.canReplace(s,o,n))return r;if(r==0||i.type.spec.isolating||!dz(i,s,o))break}return null}function hz(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=_e.empty,f=0;for(let p=s,g=!1;p>n;p--)g||r.index(p)>0?(g=!0,u=_e.from(r.node(p).copy(u)),f++):l--;let d=_e.empty,h=0;for(let p=s,g=!1;p>n;p--)g||i.after(p+1)<i.end(p)?(g=!0,d=_e.from(i.node(p).copy(d)),h++):c++;t.step(new Dn(l,c,o,a,new Ue(u.append(d),f,h),u.size-f,!0))}function ew(t,e,n=null,r=t){let i=pz(t,e),s=i&&gz(r,e);return s?i.map(hx).concat({type:e,attrs:n}).concat(s.map(hx)):null}function hx(t){return{type:t,attrs:null}}function pz(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function gz(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function mz(t,e,n){let r=_e.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=_e.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new Dn(i,s,i,s,new Ue(r,0,0),n.length,!0))}function yz(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(r,l)&&bz(t.doc,t.mapping.slice(s).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let h=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);h&&!p?c=!1:!h&&p&&(c=!0)}c===!1&&UC(t,o,a,s),Qv(t,t.mapping.slice(s).map(a,1),r,void 0,c===null);let u=t.mapping.slice(s),f=u.map(a,1),d=u.map(a+o.nodeSize,1);return t.step(new Dn(f,d,f+1,d-1,new Ue(_e.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&BC(t,o,a,s),!1}})}function BC(t,e,n,r){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=t.mapping.slice(r).map(n+1+s+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function UC(t,e,n,r){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+s);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function bz(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function vz(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Dn(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new Ue(_e.from(o),0,0),1,!0))}function Ys(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let f=i.node(c),d=i.index(c);if(f.type.spec.isolating)return!1;let h=f.content.cutByIndex(d,f.childCount),p=r&&r[u+1];p&&(h=h.replaceChild(0,p.type.create(p.attrs)));let g=r&&r[u]||f;if(!f.canReplace(d+1,f.childCount)||!g.type.validContent(h))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function wz(t,e,n=1,r){let i=t.doc.resolve(e),s=_e.empty,o=_e.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=_e.from(i.node(a).copy(s));let u=r&&r[c];o=_e.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new $n(e,e,new Ue(s.append(o),n,n),!0))}function Sa(t,e){let n=t.resolve(e),r=n.index();return HC(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function Ez(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==r?t.type.schema.nodes.text:s.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(s.marks))return!1}return n.validEnd}function HC(t,e){return!!(t&&e&&!t.isLeaf&&Ez(t,e))}function Kp(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let s,o,a=r.index(i);if(i==r.depth?(s=r.nodeBefore,o=r.nodeAfter):n>0?(s=r.node(i+1),a++,o=r.node(i).maybeChild(a)):(s=r.node(i).maybeChild(a-1),o=r.node(i+1)),s&&!s.isTextblock&&HC(s,o)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=n<0?r.before(i):r.after(i)}}function xz(t,e,n){let r=null,{linebreakReplacement:i}=t.doc.type.schema,s=t.doc.resolve(e-n),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",f=!!o.contentMatch.matchType(i);u&&!f?r=!1:!u&&f&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);UC(t,u.node(),u.before(),a)}o.inlineContent&&Qv(t,e+n-1,o,s.node().contentMatchAt(s.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new $n(c,l.map(e+n,-1),Ue.empty,!0)),r===!0){let u=t.doc.resolve(c);BC(t,u.node(),u.before(),t.steps.length)}return t}function Sz(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function FC(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let f=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=f&&c.canReplaceWith(l,l,f[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Gp(t,e,n=e,r=Ue.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return zC(i,s,r)?new $n(e,n,r):new Az(i,s,r).fit()}function zC(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class Az{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=_e.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=_e.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new Ue(s,o,a);return e>-1?new Dn(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new $n(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let s=n.firstChild;if(n.childCount>1&&(i=0),s.type.spec.isolating&&i<=r){e=r;break}n=s.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let i,s=null;r?(s=o0(this.unplaced.content,r-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,f=null;if(n==1&&(o?c.matchType(o.type)||(f=c.fillBefore(_e.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:r,frontierDepth:a,parent:s,inject:f};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=o0(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new Ue(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=o0(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new Ue(gu(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new Ue(gu(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let g=0;g<s.length;g++)this.openFrontierNode(s[g]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:f,type:d}=this.frontier[n];if(i){for(let g=0;g<i.childCount;g++)u.push(i.child(g));f=f.matchFragment(i)}let h=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let g=a.child(c),m=f.matchType(g.type);if(!m)break;c++,(c>1||l==0||g.content.size)&&(f=m,u.push(jC(g.mark(d.allowedMarks(g.marks)),c==1?l:0,c==a.childCount?h:-1)))}let p=c==a.childCount;p||(h=-1),this.placed=mu(this.placed,n,_e.from(u)),this.frontier[n].match=f,p&&h<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,m=a;g<h;g++){let v=m.lastChild;this.frontier.push({type:v.type,match:v.contentMatchAt(v.childCount)}),m=v.content}this.unplaced=p?e==0?Ue.empty:new Ue(gu(o.content,e-1,1),e-1,h<0?o.openEnd:e-1):new Ue(gu(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!a0(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=a0(e,n,i,r,s);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=a0(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=mu(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=mu(this.placed,this.depth,_e.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(_e.empty,!0);n.childCount&&(this.placed=mu(this.placed,this.frontier.length,n))}}function gu(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(gu(t.firstChild.content,e-1,n)))}function mu(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(mu(t.lastChild.content,e-1,n)))}function o0(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function jC(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,jC(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(_e.empty,!0)))),t.copy(r)}function a0(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!_z(n,s.content,o)?a:null}function _z(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function kz(t){return t.spec.defining||t.spec.definingForContent}function Cz(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(zC(i,s,r))return t.step(new $n(e,n,r));let o=qC(i,t.doc.resolve(n));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let d=i.depth,h=i.pos-1;d>0;d--,h--){let p=i.node(d).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(d)>-1?a=d:i.before(d)==h&&o.splice(1,0,-d)}let l=o.indexOf(a),c=[],u=r.openStart;for(let d=r.content,h=0;;h++){let p=d.firstChild;if(c.push(p),h==r.openStart)break;d=p.content}for(let d=u-1;d>=0;d--){let h=c[d],p=kz(h.type);if(p&&!h.sameMarkup(i.node(Math.abs(a)-1)))u=d;else if(p||!h.type.isTextblock)break}for(let d=r.openStart;d>=0;d--){let h=(d+u+1)%(r.openStart+1),p=c[h];if(p)for(let g=0;g<o.length;g++){let m=o[(g+l)%o.length],v=!0;m<0&&(v=!1,m=-m);let x=i.node(m-1),C=i.index(m-1);if(x.canReplaceWith(C,C,p.type,p.marks))return t.replace(i.before(m),v?s.after(m):n,new Ue(VC(r.content,0,r.openStart,h),h,r.openEnd))}}let f=t.steps.length;for(let d=o.length-1;d>=0&&(t.replace(e,n,r),!(t.steps.length>f));d--){let h=o[d];h<0||(e=i.before(h),n=s.after(h))}}function VC(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(VC(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(_e.empty,!0))}return t}function Tz(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=Sz(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new Ue(_e.from(r),0,0))}function Iz(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=qC(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function qC(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class rc extends yr{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return xn.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return xn.fromReplace(e,this.pos,this.pos+1,new Ue(_e.from(i),0,n.isLeaf?0:1))}getMap(){return Qr.empty}invert(e){return new rc(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new rc(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new rc(n.pos,n.attr,n.value)}}yr.jsonID("attr",rc);class Xu extends yr{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return xn.ok(r)}getMap(){return Qr.empty}invert(e){return new Xu(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Xu(n.attr,n.value)}}yr.jsonID("docAttr",Xu);let Ec=class extends Error{};Ec=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Ec.prototype=Object.create(Error.prototype);Ec.prototype.constructor=Ec;Ec.prototype.name="TransformError";class WC{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new Ju}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Ec(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=Ue.empty){let i=Gp(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new Ue(_e.from(r),0,0))}delete(e,n){return this.replace(e,n,Ue.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return Cz(this,e,n,r),this}replaceRangeWith(e,n,r){return Tz(this,e,n,r),this}deleteRange(e,n){return Iz(this,e,n),this}lift(e,n){return hz(this,e,n),this}join(e,n=1){return xz(this,e,n),this}wrap(e,n){return mz(this,e,n),this}setBlockType(e,n=e,r,i=null){return yz(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i){return vz(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new rc(e,n,r)),this}setDocAttribute(e,n){return this.step(new Xu(e,n)),this}addNodeMark(e,n){return this.step(new Yo(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof zt)n.isInSet(r.marks)&&this.step(new hl(e,n));else{let i=r.marks,s,o=[];for(;s=n.isInSet(i);)o.push(new hl(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return wz(this,e,n,r),this}addMark(e,n,r){return uz(this,e,n,r),this}removeMark(e,n,r){return fz(this,e,n,r),this}clearIncompatible(e,n,r){return Qv(this,e,n,r),this}}const l0=Object.create(null);class mt{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new Oz(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=Ue.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?Ue.empty:n),a==0&&mx(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),mx(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new ft(e):Dl(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?Dl(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):Dl(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new ti(e.node(0))}static atStart(e){return Dl(e,e,0,0,1)||new ti(e)}static atEnd(e){return Dl(e,e,e.content.size,e.childCount,-1)||new ti(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=l0[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in l0)throw new RangeError("Duplicate use of selection JSON ID "+e);return l0[e]=n,n.prototype.jsonID=e,n}getBookmark(){return ft.between(this.$anchor,this.$head).getBookmark()}}mt.prototype.visible=!0;class Oz{constructor(e,n){this.$from=e,this.$to=n}}let px=!1;function gx(t){!px&&!t.parent.inlineContent&&(px=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class ft extends mt{constructor(e,n=e){gx(e),gx(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return mt.near(r);let i=e.resolve(n.map(this.anchor));return new ft(i.parent.inlineContent?i:r,r)}replace(e,n=Ue.empty){if(super.replace(e,n),n==Ue.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof ft&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Zp(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ft(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=mt.findFrom(n,r,!0)||mt.findFrom(n,-r,!0);if(s)n=s.$head;else return mt.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(mt.findFrom(e,-r,!0)||mt.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new ft(e,n)}}mt.jsonID("text",ft);class Zp{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Zp(e.map(this.anchor),e.map(this.head))}resolve(e){return ft.between(e.resolve(this.anchor),e.resolve(this.head))}}class tt extends mt{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?mt.near(s):new tt(s)}content(){return new Ue(_e.from(this.node),0,0)}eq(e){return e instanceof tt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new tw(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new tt(e.resolve(n.anchor))}static create(e,n){return new tt(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}tt.prototype.visible=!1;mt.jsonID("node",tt);class tw{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Zp(r,r):new tw(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&tt.isSelectable(r)?new tt(n):mt.near(n)}}class ti extends mt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=Ue.empty){if(n==Ue.empty){e.delete(0,e.doc.content.size);let r=mt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new ti(e)}map(e){return new ti(e)}eq(e){return e instanceof ti}getBookmark(){return Mz}}mt.jsonID("all",ti);const Mz={map(){return this},resolve(t){return new ti(t)}};function Dl(t,e,n,r,i,s=!1){if(e.inlineContent)return ft.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&tt.isSelectable(a))return tt.create(t,n-(i<0?a.nodeSize:0))}else{let l=Dl(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function mx(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof $n||i instanceof Dn))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(mt.near(t.doc.resolve(o),n))}const yx=1,id=2,bx=4;class Lz extends WC{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|yx)&~id,this.storedMarks=null,this}get selectionSet(){return(this.updated&yx)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=id,this}ensureMarks(e){return zt.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&id)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~id,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||zt.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),r=r??n,!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),this.selection.empty||this.setSelection(mt.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=bx,this}get scrolledIntoView(){return(this.updated&bx)>0}}function vx(t,e){return!e||!t?t:t.bind(e)}class yu{constructor(e,n,r){this.name=e,this.init=vx(n.init,r),this.apply=vx(n.apply,r)}}const $z=[new yu("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new yu("selection",{init(t,e){return t.selection||mt.atStart(e.doc)},apply(t){return t.selection}}),new yu("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new yu("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class c0{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=$z.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new yu(r.key,r.spec.state,r))})}}class Vl{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let f=0;f<this.config.plugins.length;f++)i.push(f<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Vl(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new Lz(this)}static create(e){let n=new c0(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Vl(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new c0(this.schema,e.plugins),r=n.fields,i=new Vl(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new c0(e.schema,e.plugins),s=new Vl(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=na.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=mt.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function KC(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=KC(i,e,{})),n[r]=i}return n}class Vt{constructor(e){this.spec=e,this.props={},e.props&&KC(e.props,this,this.props),this.key=e.key?e.key.key:GC("plugin")}getState(e){return e[this.key]}}const u0=Object.create(null);function GC(t){return t in u0?t+"$"+ ++u0[t]:(u0[t]=0,t+"$")}class ln{constructor(e="key"){this.key=GC(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Yn=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},xc=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let Ky=null;const Ns=function(t,e,n){let r=Ky||(Ky=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},Nz=function(){Ky=null},pl=function(t,e,n,r){return n&&(wx(t,e,n,r,-1)||wx(t,e,n,r,1))},Pz=/^(img|br|input|textarea|hr)$/i;function wx(t,e,n,r,i){for(var s;;){if(t==n&&e==r)return!0;if(e==(i<0?0:wi(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Of(t)||Pz.test(t.nodeName)||t.contentEditable=="false")return!1;e=Yn(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else t=o,e=i<0?wi(t):0}else return!1}}function wi(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Rz(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=wi(t)}else if(t.parentNode&&!Of(t))e=Yn(t),t=t.parentNode;else return null}}function Dz(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Of(t))e=Yn(t)+1,t=t.parentNode;else return null}}function Bz(t,e,n){for(let r=e==0,i=e==wi(t);r||i;){if(t==n)return!0;let s=Yn(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==wi(t)}}function Of(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Yp=function(t){return t.focusNode&&pl(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Ua(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function Uz(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Hz(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(wi(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(wi(r.startContainer),r.startOffset)}}}const ms=typeof navigator<"u"?navigator:null,Ex=typeof document<"u"?document:null,Aa=ms&&ms.userAgent||"",Gy=/Edge\/(\d+)/.exec(Aa),ZC=/MSIE \d/.exec(Aa),Zy=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Aa),jr=!!(ZC||Zy||Gy),ia=ZC?document.documentMode:Zy?+Zy[1]:Gy?+Gy[1]:0,Ui=!jr&&/gecko\/(\d+)/i.test(Aa);Ui&&+(/Firefox\/(\d+)/.exec(Aa)||[0,0])[1];const Yy=!jr&&/Chrome\/(\d+)/.exec(Aa),dr=!!Yy,YC=Yy?+Yy[1]:0,Sr=!jr&&!!ms&&/Apple Computer/.test(ms.vendor),Sc=Sr&&(/Mobile\/\w+/.test(Aa)||!!ms&&ms.maxTouchPoints>2),bi=Sc||(ms?/Mac/.test(ms.platform):!1),Fz=ms?/Win/.test(ms.platform):!1,js=/Android \d/.test(Aa),Mf=!!Ex&&"webkitFontSmoothing"in Ex.documentElement.style,zz=Mf?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function jz(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Ts(t,e){return typeof t=="number"?t:t[e]}function Vz(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function xx(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=xc(o);continue}let a=o,l=a==s.body,c=l?jz(s):Vz(a),u=0,f=0;if(e.top<c.top+Ts(r,"top")?f=-(c.top-e.top+Ts(i,"top")):e.bottom>c.bottom-Ts(r,"bottom")&&(f=e.bottom-e.top>c.bottom-c.top?e.top+Ts(i,"top")-c.top:e.bottom-c.bottom+Ts(i,"bottom")),e.left<c.left+Ts(r,"left")?u=-(c.left-e.left+Ts(i,"left")):e.right>c.right-Ts(r,"right")&&(u=e.right-c.right+Ts(i,"right")),u||f)if(l)s.defaultView.scrollBy(u,f);else{let h=a.scrollLeft,p=a.scrollTop;f&&(a.scrollTop+=f),u&&(a.scrollLeft+=u);let g=a.scrollLeft-h,m=a.scrollTop-p;e={left:e.left-g,top:e.top-m,right:e.right-g,bottom:e.bottom-m}}let d=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(d))break;o=d=="absolute"?o.offsetParent:xc(o)}}function qz(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:JC(t.dom)}}function JC(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=xc(r));return e}function Wz({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;XC(n,r==0?0:r-e)}function XC(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let $l=null;function Kz(t){if(t.setActive)return t.setActive();if($l)return t.focus($l);let e=JC(t);t.focus($l==null?{get preventScroll(){return $l={preventScroll:!0},!0}}:void 0),$l||($l=!1,XC(e,0))}function QC(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,f=0;u;u=u.nextSibling,f++){let d;if(u.nodeType==1)d=u.getClientRects();else if(u.nodeType==3)d=Ns(u).getClientRects();else continue;for(let h=0;h<d.length;h++){let p=d[h];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let g=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(g<r){n=u,r=g,i=g&&n.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&g&&(s=f+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(s=f+1)}}return!n&&l&&(n=l,i=c,r=0),n&&n.nodeType==3?Gz(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:QC(n,i)}function Gz(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let s=Ro(r,1);if(s.top!=s.bottom&&nw(e,s))return{node:t,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:t,offset:0}}function nw(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Zz(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function Yz(t,e,n){let{node:r,offset:i}=QC(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function Jz(t,e,n,r){let i=-1;for(let s=e,o=!1;s!=t.dom;){let a=t.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?i=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function eT(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(nw(e,c))return eT(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function Xz(t,e){let n=t.dom.ownerDocument,r,i=0,s=Hz(n,e.left,e.top);s&&({node:r,offset:i}=s);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!nw(e,c)||(o=eT(t.dom,e,c),!o))return null}if(Sr)for(let c=o;r&&c;c=xc(c))c.draggable&&(r=void 0);if(o=Zz(o,e),r){if(Ui&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let u=r.childNodes[i],f;u.nodeName=="IMG"&&(f=u.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}let c;Mf&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=Jz(t,r,i,e))}a==null&&(a=Yz(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function Sx(t){return t.top<t.bottom||t.left<t.right}function Ro(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(Sx(r))return r}return Array.prototype.find.call(n,Sx)||t.getBoundingClientRect()}const Qz=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function tT(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=Mf||Ui;if(r.nodeType==3)if(o&&(Qz.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=Ro(Ns(r,i,i),n);if(Ui&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=Ro(Ns(r,i-1,i-1),-1);if(c.top==l.top){let u=Ro(Ns(r,i,i+1),-1);if(u.top!=l.top)return ou(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,ou(Ro(Ns(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==wi(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return f0(l.getBoundingClientRect(),!1)}if(s==null&&i<wi(r)){let l=r.childNodes[i];if(l.nodeType==1)return f0(l.getBoundingClientRect(),!0)}return f0(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==wi(r))){let l=r.childNodes[i-1],c=l.nodeType==3?Ns(l,wi(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return ou(Ro(c,1),!1)}if(s==null&&i<wi(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Ns(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return ou(Ro(c,-1),!0)}return ou(Ro(r.nodeType==3?Ns(r):r,-n),n>=0)}function ou(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function f0(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function nT(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function ej(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return nT(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=tT(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Ns(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const tj=/[\u0590-\u08ac]/;function nj(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return a?!tj.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:nT(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:f}=t.domSelectionRange(),d=a.caretBidiLevel;a.modify("move",n,"character");let h=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:p,focusOffset:g}=t.domSelectionRange(),m=p&&!h.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==g;try{a.collapse(u,f),l&&(l!=u||c!=f)&&a.extend&&a.extend(l,c)}catch{}return d!=null&&(a.caretBidiLevel=d),m}):r.pos==r.start()||r.pos==r.end()}let Ax=null,_x=null,kx=!1;function rj(t,e,n){return Ax==e&&_x==n?kx:(Ax=e,_x=n,kx=n=="up"||n=="down"?ej(t,e,n):nj(t,e,n))}const Ai=0,Cx=1,ja=2,ys=3;class Lf{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=Ai,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>Yn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof iT){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof rT&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?Yn(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?Yn(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let f=a;f>0;f--){let d=this.children[f-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){i=Yn(d.dom)+1;break}e-=d.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let f=this.children[u];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){s=Yn(f.dom);break}n+=f.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let h=0,p=0;h<this.children.length;h++){let g=this.children[h],m=p+g.size;if(s>p&&o<m)return g.setSelection(e-p-g.border,n-p-g.border,r,i);p=m}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),f=!1;if((Ui||Sr)&&e==n){let{node:h,offset:p}=a;if(h.nodeType==3){if(f=!!(p&&h.nodeValue[p-1]==`
`),f&&p==h.nodeValue.length)for(let g=h,m;g;g=g.parentNode){if(m=g.nextSibling){m.nodeName=="BR"&&(a=l={node:m.parentNode,offset:Yn(m)+1});break}let v=g.pmViewDesc;if(v&&v.node&&v.node.isBlock)break}}else{let g=h.childNodes[p-1];f=g&&(g.nodeName=="BR"||g.contentEditable=="false")}}if(Ui&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let h=u.focusNode.childNodes[u.focusOffset];h&&h.contentEditable=="false"&&(i=!0)}if(!(i||f&&Sr)&&pl(a.node,a.offset,u.anchorNode,u.anchorOffset)&&pl(l.node,l.offset,u.focusNode,u.focusOffset))return;let d=!1;if((c.extend||e==n)&&!f){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),d=!0}catch{}}if(!d){if(e>n){let p=a;a=l,l=p}let h=document.createRange();h.setEnd(l.node,l.offset),h.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(h)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?ja:Cx,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=ys:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?ja:ys}r=o}this.dirty=ja}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?ja:Cx;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class rT extends Lf{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==Ai&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class ij extends Lf{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class gl extends Lf{constructor(e,n,r,i,s){super(e,[],r,i),this.mark=n,this.spec=s}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=Sl.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new gl(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&ys||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ys&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Ai){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Ai}}slice(e,n,r){let i=gl.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=Xy(s,n,o,r)),e>0&&(s=Xy(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class sa extends Lf{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,f=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:f}=Sl.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let d=u;return u=aT(u,r,n),c?l=new sj(e,n,r,i,u,f||null,d,c,s,o+1):n.isText?new Jp(e,n,r,i,u,d,s):new sa(e,n,r,i,u,f||null,d,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>_e.empty)}return e}matchesNode(e,n,r){return this.dirty==Ai&&e.eq(this.node)&&mh(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new aj(this,o&&o.node,e);uj(this.node,this.innerDeco,(c,u,f)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!f&&l.syncToMarks(u==this.node.childCount?zt.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,i)},(c,u,f,d)=>{l.syncToMarks(c.marks,r,e);let h;l.findNodeMatch(c,u,f,d)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(h=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,f,h,e)||l.updateNextNode(c,u,f,e,d,i)||l.addNode(c,u,f,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==ja)&&(o&&this.protectLocalComposition(e,o),sT(this.contentDOM,this.children,e),Sc&&fj(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof ft)||r<n||i>n+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=dj(this.node.content,o,r-n,i-n);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new ij(this,s,n,i);e.input.compositionNodes.push(o),this.children=Xy(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==ys||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Ai}updateOuterDeco(e){if(mh(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=oT(this.dom,this.nodeDOM,Jy(this.outerDeco,this.node,n),Jy(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function Tx(t,e,n,r,i){aT(r,e,t);let s=new sa(void 0,t,e,n,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class Jp extends sa{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==ys||this.dirty!=Ai&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Ai||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Ai,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new Jp(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=ys)}get domAtom(){return!1}isText(e){return this.node.text==e}}class iT extends Lf{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Ai&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class sj extends sa{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==ys)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function sT(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=Ix(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof gl){let l=r?r.previousSibling:t.lastChild;sT(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=Ix(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const Iu=function(t){t&&(this.nodeName=t)};Iu.prototype=Object.create(null);const Va=[new Iu];function Jy(t,e,n){if(t.length==0)return Va;let r=n?Va[0]:new Iu,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new Iu(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new Iu(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function oT(t,e,n,r){if(n==Va&&r==Va)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Va[0]),i=l}oj(i,a||Va[0],o)}return i}function oj(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function aT(t,e,n){return oT(t,t,Va,Jy(e,n,t.nodeType!=1))}function mh(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Ix(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class aj{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=lj(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=Ai,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[s])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=gl.create(this.top,e[s],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==ys&&o.dom==o.contentDOM&&(o.dirty=ja),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof sa){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,f,d=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=ys&&mh(n,l.outerDeco));if(!d&&l.update(e,n,r,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!d&&(f=this.recreateWrapper(l,e,n,r,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=ja,f.updateChildren(i,o+1),f.dirty=Ai),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,i,s,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!mh(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=sa.create(this.top,n,r,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,i,s){let o=sa.create(this.top,e,n,r,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new rT(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof gl;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Jp)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Sr||dr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new iT(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function lj(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof gl)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function cj(t,e){return t.type.side-e.type.side}function uj(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,f;for(;o<i.length&&i[o].to==s;){let m=i[o++];m.widget&&(u?(f||(f=[u])).push(m):u=m)}if(u)if(f){f.sort(cj);for(let m=0;m<f.length;m++)n(f[m],c,!!l)}else n(u,c,!!l);let d,h;if(l)h=-1,d=l,l=null;else if(c<t.childCount)h=c,d=t.child(c++);else break;for(let m=0;m<a.length;m++)a[m].to<=s&&a.splice(m--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+d.nodeSize;if(d.isText){let m=p;o<i.length&&i[o].from<m&&(m=i[o].from);for(let v=0;v<a.length;v++)a[v].to<m&&(m=a[v].to);m<p&&(l=d.cut(m-s),d=d.cut(0,m-s),p=m,h=-1)}else for(;o<i.length&&i[o].to<p;)o++;let g=d.isInline&&!d.isLeaf?a.filter(m=>!m.inline):a.slice();r(d,g,e.forChild(s,d),h),s=p}}function fj(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function dj(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function Xy(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function rw(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(Yp(n)){for(l=o;i&&!i.node;)i=i.parent;let f=i.node;if(i&&f.isAtom&&tt.isSelectable(f)&&i.parent&&!(f.isInline&&Bz(n.focusNode,n.focusOffset,i.dom))){let d=i.posBefore;c=new tt(o==d?a:r.resolve(d))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=o,d=o;for(let h=0;h<n.rangeCount;h++){let p=n.getRangeAt(h);f=Math.min(f,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),d=Math.max(d,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(f<0)return null;[l,o]=d==t.state.selection.anchor?[d,f]:[f,d],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let f=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=iw(t,u,a,f)}return c}function lT(t){return t.editable?t.hasFocus():uT(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Js(t,e=!1){let n=t.state.selection;if(cT(t,n),!!lT(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&dr){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&pl(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)pj(t);else{let{anchor:r,head:i}=n,s,o;Ox&&!(n instanceof ft)&&(n.$from.parent.inlineContent||(s=Mx(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=Mx(t,n.to))),t.docView.setSelection(r,i,t,e),Ox&&(s&&Lx(s),o&&Lx(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&hj(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const Ox=Sr||dr&&YC<63;function Mx(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(Sr&&i&&i.contentEditable=="false")return d0(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return d0(i);if(s)return d0(s)}}function d0(t){return t.contentEditable="true",Sr&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Lx(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function hj(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!lT(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function pj(t){let e=t.domSelection(),n=document.createRange();if(!e)return;let r=t.cursorWrapper.dom,i=r.nodeName=="IMG";i?n.setStart(r.parentNode,Yn(r)+1):n.setStart(r,0),n.collapse(!0),e.removeAllRanges(),e.addRange(n),!i&&!t.state.selection.visible&&jr&&ia<=11&&(r.disabled=!0,r.disabled=!1)}function cT(t,e){if(e instanceof tt){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&($x(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else $x(t)}function $x(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function iw(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||ft.between(e,n,r)}function Nx(t){return t.editable&&!t.hasFocus()?!1:uT(t)}function uT(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function gj(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return pl(e.node,e.offset,n.anchorNode,n.anchorOffset)}function Qy(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&mt.findFrom(s,e)}function Do(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function Px(t,e,n){let r=t.state.selection;if(r instanceof ft)if(n.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return Do(t,new ft(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=Qy(t.state,e);return i&&i instanceof tt?Do(t,i):!1}else if(!(bi&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?tt.isSelectable(s)?Do(t,new tt(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):Mf?Do(t,new ft(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof tt&&r.node.isInline)return Do(t,new ft(e>0?r.$to:r.$from));{let i=Qy(t.state,e);return i?Do(t,i):!1}}}function yh(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Ou(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Nl(t,e){return e<0?mj(t):yj(t)}function mj(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for(Ui&&n.nodeType==1&&r<yh(n)&&Ou(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Ou(a,-1))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(fT(n))break;{let a=n.previousSibling;for(;a&&Ou(a,-1);)i=n.parentNode,s=Yn(a),a=a.previousSibling;if(a)n=a,r=yh(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?eb(t,n,r):i&&eb(t,i,s)}function yj(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=yh(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Ou(a,1))s=n,o=++r;else break}else{if(fT(n))break;{let a=n.nextSibling;for(;a&&Ou(a,1);)s=a.parentNode,o=Yn(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=yh(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&eb(t,s,o)}function fT(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function bj(t,e){for(;t&&e==t.childNodes.length&&!Of(t);)e=Yn(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function vj(t,e){for(;t&&!e&&!Of(t);)e=Yn(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function eb(t,e,n){if(e.nodeType!=3){let s,o;(o=bj(e,n))?(e=o,n=0):(s=vj(e,n))&&(e=s,n=s.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Yp(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&Js(t)},50)}function Rx(t,e){let n=t.state.doc.resolve(e);if(!(dr||Fz)&&n.parent.inlineContent){let i=t.coordsAtPos(e);if(e>n.start()){let s=t.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<n.end()){let s=t.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function Dx(t,e,n){let r=t.state.selection;if(r instanceof ft&&!r.empty||n.indexOf("s")>-1||bi&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=Qy(t.state,e);if(o&&o instanceof tt)return Do(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof ti?mt.near(o,e):mt.findFrom(o,e);return a?Do(t,a):!1}return!1}function Bx(t,e){if(!(t.state.selection instanceof ft))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function Ux(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function wj(t){if(!Sr||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;Ux(t,r,"true"),setTimeout(()=>Ux(t,r,"false"),20)}return!1}function Ej(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function xj(t,e){let n=e.keyCode,r=Ej(e);if(n==8||bi&&n==72&&r=="c")return Bx(t,-1)||Nl(t,-1);if(n==46&&!e.shiftKey||bi&&n==68&&r=="c")return Bx(t,1)||Nl(t,1);if(n==13||n==27)return!0;if(n==37||bi&&n==66&&r=="c"){let i=n==37?Rx(t,t.state.selection.from)=="ltr"?-1:1:-1;return Px(t,i,r)||Nl(t,i)}else if(n==39||bi&&n==70&&r=="c"){let i=n==39?Rx(t,t.state.selection.from)=="ltr"?1:-1:1;return Px(t,i,r)||Nl(t,i)}else{if(n==38||bi&&n==80&&r=="c")return Dx(t,-1,r)||Nl(t,-1);if(n==40||bi&&n==78&&r=="c")return wj(t)||Dx(t,1,r)||Nl(t,1);if(r==(bi?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function sw(t,e){t.someProp("transformCopied",h=>{e=h(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let h=r.firstChild;n.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let o=t.someProp("clipboardSerializer")||Sl.fromSchema(t.state.schema),a=yT(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,f=0;for(;c&&c.nodeType==1&&(u=mT[c.nodeName.toLowerCase()]);){for(let h=u.length-1;h>=0;h--){let p=a.createElement(u[h]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),f++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${f?` -${f}`:""} ${JSON.stringify(n)}`);let d=t.someProp("clipboardTextSerializer",h=>h(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:d,slice:e}}function dT(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",d=>{e=d(e,s||r,t)}),s)return e?new Ue(_e.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):Ue.empty;let f=t.someProp("clipboardTextParser",d=>d(e,i,r,t));if(f)a=f;else{let d=i.marks(),{schema:h}=t.state,p=Sl.fromSchema(h);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let m=o.appendChild(document.createElement("p"));g&&m.appendChild(p.serializeNode(h.text(g,d)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),o=kj(n),Mf&&Cj(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let f=+u[3];f>0;f--){let d=o.firstChild;for(;d&&d.nodeType!=1;)d=d.nextSibling;if(!d)break;o=d}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||ra.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(d){return d.nodeName=="BR"&&!d.nextSibling&&d.parentNode&&!Sj.test(d.parentNode.nodeName)?{ignore:!0}:null}})),u)a=Tj(Hx(a,+u[1],+u[2]),u[4]);else if(a=Ue.maxOpen(Aj(a.content,i),!0),a.openStart||a.openEnd){let f=0,d=0;for(let h=a.content.firstChild;f<a.openStart&&!h.type.spec.isolating;f++,h=h.firstChild);for(let h=a.content.lastChild;d<a.openEnd&&!h.type.spec.isolating;d++,h=h.lastChild);a=Hx(a,f,d)}return t.someProp("transformPasted",f=>{a=f(a,t)}),a}const Sj=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Aj(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&pT(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=gT(o[o.length-1],s.length));let u=hT(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return _e.from(o)}return t}function hT(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,_e.from(t));return t}function pT(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=pT(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(_e.from(hT(n,t,i+1))))}}function gT(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,gT(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(_e.empty,!0);return t.copy(n.append(r))}function tb(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),i<r-1&&(a=tb(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(_e.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function Hx(t,e,n){return e<t.openStart&&(t=new Ue(tb(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new Ue(tb(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const mT={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Fx=null;function yT(){return Fx||(Fx=document.implementation.createHTMLDocument("title"))}let h0=null;function _j(t){let e=window.trustedTypes;return e?(h0||(h0=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),h0.createHTML(t)):t}function kj(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=yT().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&mT[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=_j(t),i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function Cj(t){let e=t.querySelectorAll(dr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function Tj(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=_e.from(l.create(r[a+1],i)),s++,o++}return new Ue(i,s,o)}const Ar={},_r={},Ij={touchstart:!0,touchmove:!0};class Oj{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Mj(t){for(let e in Ar){let n=Ar[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{$j(t,r)&&!ow(t,r)&&(t.editable||!(r.type in _r))&&n(t,r)},Ij[e]?{passive:!0}:void 0)}Sr&&t.dom.addEventListener("input",()=>null),nb(t)}function Jo(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function Lj(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function nb(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>ow(t,r))})}function ow(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function $j(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function Nj(t,e){!ow(t,e)&&Ar[e.type]&&(t.editable||!(e.type in _r))&&Ar[e.type](t,e)}_r.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!vT(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(js&&dr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Sc&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,Ua(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||xj(t,n)?n.preventDefault():Jo(t,"key")};_r.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};_r.keypress=(t,e)=>{let n=e;if(vT(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||bi&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof ft)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode),s=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,i,s))&&t.dispatch(s()),n.preventDefault()}};function Xp(t){return{left:t.clientX,top:t.clientY}}function Pj(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function aw(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function ic(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function Rj(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&tt.isSelectable(r)?(ic(t,new tt(n)),!0):!1}function Dj(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof tt&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(tt.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(ic(t,tt.create(t.state.doc,i)),!0):!1}function Bj(t,e,n,r,i){return aw(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?Dj(t,n):Rj(t,n))}function Uj(t,e,n,r){return aw(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function Hj(t,e,n,r){return aw(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||Fj(t,n,r)}function Fj(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(ic(t,ft.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)ic(t,ft.create(r,a+1,a+1+o.content.size));else if(tt.isSelectable(o))ic(t,tt.create(r,a));else continue;return!0}}function lw(t){return bh(t)}const bT=bi?"metaKey":"ctrlKey";Ar.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=lw(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&Pj(n,t.input.lastClick)&&!n[bT]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s,button:n.button};let o=t.posAtCoords(Xp(n));o&&(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new zj(t,o,n,!!r)):(s=="doubleClick"?Uj:Hj)(t,o.pos,o.inside,n)?n.preventDefault():Jo(t,"pointer"))};class zj{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[bT],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof tt&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Ui&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Jo(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Js(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Xp(e))),this.updateAllowDefault(e),this.allowDefault||!n?Jo(this.view,"pointer"):Bj(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Sr&&this.mightDrag&&!this.mightDrag.node.isAtom||dr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(ic(this.view,mt.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Jo(this.view,"pointer")}move(e){this.updateAllowDefault(e),Jo(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ar.touchstart=t=>{t.input.lastTouch=Date.now(),lw(t),Jo(t,"pointer")};Ar.touchmove=t=>{t.input.lastTouch=Date.now(),Jo(t,"pointer")};Ar.contextmenu=t=>lw(t);function vT(t,e){return t.composing?!0:Sr&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const jj=js?5e3:-1;_r.compositionstart=_r.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof ft&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),bh(t,!0),t.markCursor=null;else if(bh(t,!e.selection.empty),Ui&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}wT(t,jj)};_r.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,wT(t,20))};function wT(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>bh(t),e))}function ET(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=qj());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function Vj(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=Rz(e.focusNode,e.focusOffset),r=Dz(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let i=r.pmViewDesc,s=t.domObserver.lastChangedTextNode;if(n==s||r==s)return s;if(!i||!i.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function qj(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function bh(t,e=!1){if(!(js&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),ET(t),e||t.docView&&t.docView.dirty){let n=rw(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function Wj(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const Qu=jr&&ia<15||Sc&&zz<604;Ar.copy=_r.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=Qu?null:n.clipboardData,o=r.content(),{dom:a,text:l}=sw(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):Wj(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Kj(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function Gj(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?ef(t,r.value,null,i,e):ef(t,r.textContent,r.innerHTML,i,e)},50)}function ef(t,e,n,r,i){let s=dT(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,s||Ue.empty)))return!0;if(!s)return!1;let o=Kj(s),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function xT(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}_r.paste=(t,e)=>{let n=e;if(t.composing&&!js)return;let r=Qu?null:n.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&ef(t,xT(r),r.getData("text/html"),i,n)?n.preventDefault():Gj(t,n)};class ST{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const Zj=bi?"altKey":"ctrlKey";function AT(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[Zj]}Ar.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(Xp(n)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof tt?i.to-1:i.to))){if(r&&r.mightDrag)o=tt.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(o=tt.create(t.state.doc,f.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=sw(t,a);(!n.dataTransfer.files.length||!dr||YC>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Qu?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Qu||n.dataTransfer.setData("text/plain",c),t.dragging=new ST(u,AT(t,n),o)};Ar.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};_r.dragover=_r.dragenter=(t,e)=>e.preventDefault();_r.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(Xp(n));if(!i)return;let s=t.state.doc.resolve(i.pos),o=r&&r.slice;o?t.someProp("transformPasted",p=>{o=p(o,t)}):o=dT(t,xT(n.dataTransfer),Qu?null:n.dataTransfer.getData("text/html"),!1,s);let a=!!(r&&AT(t,n));if(t.someProp("handleDrop",p=>p(t,n,o||Ue.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?FC(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let c=t.state.tr;if(a){let{node:p}=r;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),f=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,d=c.doc;if(f?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(d))return;let h=c.doc.resolve(u);if(f&&tt.isSelectable(o.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new tt(h));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((g,m,v,x)=>p=x),c.setSelection(iw(t,h,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};Ar.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Js(t)},20))};Ar.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ar.beforeinput=(t,e)=>{if(dr&&js&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,Ua(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in _r)Ar[t]=_r[t];function tf(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class vh{constructor(e,n){this.toDOM=e,this.spec=n||nl,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new hr(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof vh&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&tf(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class oa{constructor(e,n){this.attrs=e,this.spec=n||nl}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new hr(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof oa&&tf(this.attrs,e.attrs)&&tf(this.spec,e.spec)}static is(e){return e.type instanceof oa}destroy(){}}class cw{constructor(e,n){this.attrs=e,this.spec=n||nl}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new hr(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof cw&&tf(this.attrs,e.attrs)&&tf(this.spec,e.spec)}destroy(){}}class hr{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new hr(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new hr(e,e,new vh(n,r))}static inline(e,n,r,i){return new hr(e,n,new oa(r,i))}static node(e,n,r,i){return new hr(e,n,new cw(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof oa}get widget(){return this.type instanceof vh}}const Bl=[],nl={};class Kt{constructor(e,n){this.local=e.length?e:Bl,this.children=n.length?n:Bl}static create(e,n){return n.length?wh(n,e,0,nl):sr}find(e,n,r){let i=[];return this.findInner(e??0,n??1e9,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==sr||e.maps.length==0?this:this.mapInner(e,n,0,0,r||nl)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?Yj(this.children,o||[],e,n,r,i,s):o?new Kt(o.sort(rl),Bl):sr}add(e,n){return n.length?this==sr?Kt.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(u=kT(n,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,wh(u,a,c+1,nl)),s+=3}});let o=_T(s?CT(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new Kt(o.length?this.local.concat(o).sort(rl):this.local,i||this.children)}remove(e){return e.length==0||this==sr?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,f;u<e.length;u++)(f=e[u])&&f.from>a&&f.to<l&&(e[u]=null,(o||(o=[])).push(f));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=sr?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new Kt(i,r):sr}forChild(e,n){if(this==sr)return this;if(n.isLeaf)return Kt.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof oa){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new Kt(i.sort(rl),Bl);return r?new zo([a,r]):a}return r||sr}eq(e){if(this==e)return!0;if(!(e instanceof Kt)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return uw(this.localsInner(e))}localsInner(e){if(this==sr)return Bl;if(e.inlineContent||!this.local.some(oa.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof oa||n.push(this.local[r]);return n}forEachSet(e){e(this)}}Kt.empty=new Kt([],[]);Kt.removeOverlap=uw;const sr=Kt.empty;class zo{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,nl));return zo.from(r)}forChild(e,n){if(n.isLeaf)return Kt.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=sr&&(s instanceof zo?r=r.concat(s.members):r.push(s))}return zo.from(r)}eq(e){if(!(e instanceof zo)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?uw(r?n:n.sort(rl)):Bl}static from(e){switch(e.length){case 0:return sr;case 1:return e[0];default:return new zo(e.every(n=>n instanceof Kt)?e:e.reduce((n,r)=>n.concat(r instanceof Kt?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function Yj(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let f=0;n.maps[c].forEach((d,h,p,g)=>{let m=g-p-(h-d);for(let v=0;v<a.length;v+=3){let x=a[v+1];if(x<0||d>x+u-f)continue;let C=a[v]+u-f;h>=C?a[v+1]=d<=C?-2:-1:d>=u&&m&&(a[v]+=m,a[v+1]+=m)}f+=m}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),f=u-i;if(f<0||f>=r.content.size){l=!0;continue}let d=n.map(t[c+1]+s,-1),h=d-i,{index:p,offset:g}=r.content.findIndex(f),m=r.maybeChild(p);if(m&&g==f&&g+m.nodeSize==h){let v=a[c+2].mapInner(n,m,u+1,t[c]+s+1,o);v!=sr?(a[c]=f,a[c+1]=h,a[c+2]=v):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=Jj(a,t,e,n,i,s,o),u=wh(c,r,0,o);e=u.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,d=0;f<u.children.length;f+=3){let h=u.children[f];for(;d<a.length&&a[d]<h;)d+=3;a.splice(d,0,u.children[f],u.children[f+1],u.children[f+2])}}return new Kt(e.sort(rl),a)}function _T(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new hr(i.from+e,i.to+e,i.type))}return n}function Jj(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let f=l.local[u].map(r,i,c);f?n.push(f):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function kT(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function CT(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function wh(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=kT(t,a,l+n);if(c){s=!0;let u=wh(c,a,n+l+1,r);u!=sr&&i.push(l,l+a.nodeSize,u)}});let o=_T(s?CT(t):t,-n).sort(rl);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new Kt(o,i):sr}function rl(t,e){return t.from-e.from||t.to-e.to}function uw(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),zx(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),zx(e,i,r.copy(s.from,r.to)));break}}}return e}function zx(t,e,n){for(;e<t.length&&rl(n,t[e])>0;)e++;t.splice(e,0,n)}function p0(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=sr&&e.push(r)}),t.cursorWrapper&&e.push(Kt.create(t.state.doc,[t.cursorWrapper.deco])),zo.from(e)}const Xj={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Qj=jr&&ia<=11;class eV{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class tV{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new eV,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);jr&&ia<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),Qj&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Xj)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Nx(this.view)){if(this.suppressingSelectionUpdates)return Js(this.view);if(jr&&ia<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&pl(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=xc(s))n.add(s);for(let s=e.anchorNode;s;s=xc(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&Nx(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let f=this.registerMutation(n[u],l);f&&(s=s<0?f.from:Math.min(f.from,s),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(a=!0))}if(Ui&&l.length){let u=l.filter(f=>f.nodeName=="BR");if(u.length==2){let[f,d]=u;f.parentNode&&f.parentNode.parentNode==d.parentNode?d.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let d of u){let h=d.parentNode;h&&h.nodeName=="LI"&&(!f||iV(e,f)!=h)&&d.remove()}}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Yp(r)&&(c=rw(e))&&c.eq(mt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Js(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),nV(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Js(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let f=e.addedNodes[u];n.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(jr&&ia<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:f,nextSibling:d}=e.addedNodes[u];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f),(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(s=d)}let o=i&&i.parentNode==e.target?Yn(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?Yn(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let jx=new WeakMap,Vx=!1;function nV(t){if(!jx.has(t)&&(jx.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Ui,Vx)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Vx=!0}}function qx(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return pl(o.node,o.offset,i,s)&&([n,r,i,s]=[i,s,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}}function rV(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return qx(t,i)}let n;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?qx(t,n):null}function iV(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function sV(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],Yp(l)||c.push({node:l.focusNode,offset:l.focusOffset})),dr&&t.input.lastKeyCode===8)for(let m=s;m>i;m--){let v=r.childNodes[m-1],x=v.pmViewDesc;if(v.nodeName=="BR"&&!x){s=m;break}if(!x||x.size)break}let f=t.state.doc,d=t.someProp("domParser")||ra.fromSchema(t.state.schema),h=f.resolve(o),p=null,g=d.parse(r,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:i,to:s,preserveWhitespace:h.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:oV,context:h});if(c&&c[0].pos!=null){let m=c[0].pos,v=c[1]&&c[1].pos;v==null&&(v=m),p={anchor:m+o,head:v+o}}return{doc:g,sel:p,from:o,to:a}}function oV(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Sr&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Sr&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const aV=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function lV(t,e,n,r,i){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let S=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,E=rw(t,S);if(E&&!t.state.selection.eq(E)){if(dr&&js&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",k=>k(t,Ua(13,"Enter"))))return;let _=t.state.tr.setSelection(E);S=="pointer"?_.setMeta("pointer",!0):S=="key"&&_.scrollIntoView(),s&&_.setMeta("composition",s),t.dispatch(_)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=sV(t,e,n),u=t.state.doc,f=u.slice(c.from,c.to),d,h;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(d=t.state.selection.to,h="end"):(d=t.state.selection.from,h="start"),t.input.lastKeyCode=null;let p=fV(f.content,c.doc.content,c.from,d,h);if(p&&t.input.domChangeCount++,(Sc&&t.input.lastIOSEnter>Date.now()-225||js)&&i.some(S=>S.nodeType==1&&!aV.test(S.nodeName))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",S=>S(t,Ua(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!p)if(r&&l instanceof ft&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let S=Wx(t,t.state.doc,c.sel);if(S&&!S.eq(t.state.selection)){let E=t.state.tr.setSelection(S);s&&E.setMeta("composition",s),t.dispatch(E)}}return}t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof ft&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),jr&&ia<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)=="  "&&(p.start--,p.endA--,p.endB--);let g=c.doc.resolveNoCache(p.start-c.from),m=c.doc.resolveNoCache(p.endB-c.from),v=u.resolve(p.start),x=g.sameParent(m)&&g.parent.inlineContent&&v.end()>=p.endA,C;if((Sc&&t.input.lastIOSEnter>Date.now()-225&&(!x||i.some(S=>S.nodeName=="DIV"||S.nodeName=="P"))||!x&&g.pos<c.doc.content.size&&(!g.sameParent(m)||!g.parent.inlineContent)&&!/\S/.test(c.doc.textBetween(g.pos,m.pos,"",""))&&(C=mt.findFrom(c.doc.resolve(g.pos+1),1,!0))&&C.head>g.pos)&&t.someProp("handleKeyDown",S=>S(t,Ua(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>p.start&&uV(u,p.start,p.endA,g,m)&&t.someProp("handleKeyDown",S=>S(t,Ua(8,"Backspace")))){js&&dr&&t.domObserver.suppressSelectionUpdates();return}dr&&p.endB==p.start&&(t.input.lastChromeDelete=Date.now()),js&&!x&&g.start()!=m.start()&&m.parentOffset==0&&g.depth==m.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,m=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(S){return S(t,Ua(13,"Enter"))})},20));let N=p.start,O=p.endA,A=S=>{let E=S||t.state.tr.replace(N,O,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let _=Wx(t,E.doc,c.sel);_&&!(dr&&t.composing&&_.empty&&(p.start!=p.endB||t.input.lastChromeDelete<Date.now()-100)&&(_.head==N||_.head==E.mapping.map(O)-1)||jr&&_.empty&&_.head==N)&&E.setSelection(_)}return s&&E.setMeta("composition",s),E.scrollIntoView()},P;if(x){if(g.pos==m.pos){jr&&ia<=11&&g.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Js(t),20));let S=A(t.state.tr.delete(N,O)),E=u.resolve(p.start).marksAcross(u.resolve(p.endA));E&&S.ensureMarks(E),t.dispatch(S)}else if(p.endA==p.endB&&(P=cV(g.parent.content.cut(g.parentOffset,m.parentOffset),v.parent.content.cut(v.parentOffset,p.endA-v.start())))){let S=A(t.state.tr);P.type=="add"?S.addMark(N,O,P.mark):S.removeMark(N,O,P.mark),t.dispatch(S)}else if(g.parent.child(g.index()).isText&&g.index()==m.index()-(m.textOffset?0:1)){let S=g.parent.textBetween(g.parentOffset,m.parentOffset),E=()=>A(t.state.tr.insertText(S,N,O));t.someProp("handleTextInput",_=>_(t,N,O,S,E))||t.dispatch(E())}}else t.dispatch(A())}function Wx(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:iw(t,e.resolve(n.anchor),e.resolve(n.head))}function cV(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(_e.from(c).eq(t))return{mark:a,type:o}}function uV(t,e,n,r,i){if(n-e<=i.pos-r.pos||g0(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(!r.parent.isTextblock){let a=s.nodeAfter;return a!=null&&n==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(g0(s,!0,!0));return!o.parent.isTextblock||o.pos>n||g0(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function g0(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function fV(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}if(o<s&&t.size<e.size){let l=r<=s&&r>=o?s-r:0;s-=l,s&&s<e.size&&Kx(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=r<=s&&r>=a?s-r:0;s-=l,s&&s<t.size&&Kx(t.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function Kx(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class TT{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Oj,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(Xx),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Yx(this),Zx(this),this.nodeViews=Jx(this),this.docView=Tx(this.state.doc,Gx(this),p0(this),this.dom,this),this.domObserver=new tV(this,(r,i,s,o)=>lV(this,r,i,s,o)),this.domObserver.start(),Mj(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&nb(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Xx),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(ET(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let h=Jx(this);hV(h,this.nodeViews)&&(this.nodeViews=h,s=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&nb(this),this.editable=Yx(this),Zx(this);let l=p0(this),c=Gx(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",f=s||!this.docView.matchesNode(e.doc,c,l);(f||!e.selection.eq(i.selection))&&(o=!0);let d=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&qz(this);if(o){this.domObserver.stop();let h=f&&(jr||dr)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&dV(i.selection,e.selection);if(f){let p=dr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Vj(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=Tx(e.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(h=!0)}h||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&gj(this))?Js(this,h):(cT(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():d&&Wz(d)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof tt){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&xx(this,n.getBoundingClientRect(),e)}else xx(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let s=r.from+(this.state.doc.content.size-n.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==r.node&&(i=s)}this.dragging=new ST(e.slice,e.move,i<0?void 0:tt.create(this.state.doc,i))}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(jr){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Kz(this.dom),Js(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Xz(this,e)}coordsAtPos(e,n=1){return tT(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return rj(this,n||this.state,e)}pasteHTML(e,n){return ef(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return ef(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return sw(this,e)}destroy(){this.docView&&(Lj(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],p0(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Nz())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return Nj(this,e)}domSelectionRange(){let e=this.domSelection();return e?Sr&&this.root.nodeType===11&&Uz(this.dom.ownerDocument)==this.dom&&rV(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}TT.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function Gx(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[hr.node(0,t.state.doc.content.size,e)]}function Zx(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:hr.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function Yx(t){return!t.someProp("editable",e=>e(t.state)===!1)}function dV(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function Jx(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function hV(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function Xx(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var ga={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Eh={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},pV=typeof navigator<"u"&&/Mac/.test(navigator.platform),gV=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Jn=0;Jn<10;Jn++)ga[48+Jn]=ga[96+Jn]=String(Jn);for(var Jn=1;Jn<=24;Jn++)ga[Jn+111]="F"+Jn;for(var Jn=65;Jn<=90;Jn++)ga[Jn]=String.fromCharCode(Jn+32),Eh[Jn]=String.fromCharCode(Jn);for(var m0 in ga)Eh.hasOwnProperty(m0)||(Eh[m0]=ga[m0]);function mV(t){var e=pV&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||gV&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Eh:ga)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const yV=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),bV=typeof navigator<"u"&&/Win/.test(navigator.platform);function vV(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))yV?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function wV(t){let e=Object.create(null);for(let n in t)e[vV(n)]=t[n];return e}function y0(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function EV(t){return new Vt({props:{handleKeyDown:IT(t)}})}function IT(t){let e=wV(t);return function(n,r){let i=mV(r),s,o=e[y0(i,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[y0(i,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(bV&&r.ctrlKey&&r.altKey)&&(s=ga[r.keyCode])&&s!=i){let a=e[y0(s,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const fw=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function OT(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const MT=(t,e,n)=>{let r=OT(t,n);if(!r)return!1;let i=dw(r);if(!i){let o=r.blockRange(),a=o&&Dc(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(HT(t,i,e,-1))return!0;if(r.parent.content.size==0&&(Ac(s,"end")||tt.isSelectable(s)))for(let o=r.depth;;o--){let a=Gp(t.doc,r.before(o),r.after(o),Ue.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Ac(s,"end")?mt.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):tt.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1},xV=(t,e,n)=>{let r=OT(t,n);if(!r)return!1;let i=dw(r);return i?LT(t,i,e):!1},SV=(t,e,n)=>{let r=NT(t,n);if(!r)return!1;let i=hw(r);return i?LT(t,i,e):!1};function LT(t,e,n){let r=e.nodeBefore,i=r,s=e.pos-1;for(;!i.isTextblock;s--){if(i.type.spec.isolating)return!1;let u=i.lastChild;if(!u)return!1;i=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=Gp(t.doc,s,l,Ue.empty);if(!c||c.from!=s||c instanceof $n&&c.slice.size>=l-s)return!1;if(n){let u=t.tr.step(c);u.setSelection(ft.create(u.doc,s)),n(u.scrollIntoView())}return!0}function Ac(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const $T=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=dw(r)}let o=s&&s.nodeBefore;return!o||!tt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(tt.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function dw(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function NT(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const PT=(t,e,n)=>{let r=NT(t,n);if(!r)return!1;let i=hw(r);if(!i)return!1;let s=i.nodeAfter;if(HT(t,i,e,1))return!0;if(r.parent.content.size==0&&(Ac(s,"start")||tt.isSelectable(s))){let o=Gp(t.doc,r.before(),r.after(),Ue.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Ac(s,"start")?mt.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):tt.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},RT=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=hw(r)}let o=s&&s.nodeAfter;return!o||!tt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(tt.create(t.doc,s.pos)).scrollIntoView()),!0)};function hw(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const AV=(t,e)=>{let n=t.selection,r=n instanceof tt,i;if(r){if(n.node.isTextblock||!Sa(t.doc,n.from))return!1;i=n.from}else if(i=Kp(t.doc,n.from,-1),i==null)return!1;if(e){let s=t.tr.join(i);r&&s.setSelection(tt.create(s.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},_V=(t,e)=>{let n=t.selection,r;if(n instanceof tt){if(n.node.isTextblock||!Sa(t.doc,n.to))return!1;r=n.to}else if(r=Kp(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},kV=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&Dc(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},DT=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function pw(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const CV=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=pw(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(mt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},BT=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof ti||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=pw(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(ft.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},UT=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(Ys(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&Dc(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function TV(t){return(e,n)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof tt&&e.selection.node.isBlock)return!r.parentOffset||!Ys(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let s=[],o,a,l=!1,c=!1;for(let h=r.depth;;h--)if(r.node(h).isBlock){l=r.end(h)==r.pos+(r.depth-h),c=r.start(h)==r.pos-(r.depth-h),a=pw(r.node(h-1).contentMatchAt(r.indexAfter(h-1))),s.unshift(l&&a?{type:a}:null),o=h;break}else{if(h==1)return!1;s.unshift(null)}let u=e.tr;(e.selection instanceof ft||e.selection instanceof ti)&&u.deleteSelection();let f=u.mapping.map(r.pos),d=Ys(u.doc,f,s.length,s);if(d||(s[0]=a?{type:a}:null,d=Ys(u.doc,f,s.length,s)),!d)return!1;if(u.split(f,s.length,s),!l&&c&&r.node(o).type!=a){let h=u.mapping.map(r.before(o)),p=u.doc.resolve(h);a&&r.node(o-1).canReplaceWith(p.index(),p.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const IV=TV(),OV=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(tt.create(t.doc,i))),!0)};function MV(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||Sa(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function HT(t,e,n,r){let i=e.nodeBefore,s=e.nodeAfter,o,a,l=i.type.spec.isolating||s.type.spec.isolating;if(!l&&MV(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(n){let h=e.pos+s.nodeSize,p=_e.empty;for(let v=o.length-1;v>=0;v--)p=_e.from(o[v].create(null,p));p=_e.from(i.copy(p));let g=t.tr.step(new Dn(e.pos-1,h,e.pos,h,new Ue(p,1,0),o.length,!0)),m=g.doc.resolve(h+2*o.length);m.nodeAfter&&m.nodeAfter.type==i.type&&Sa(g.doc,m.pos)&&g.join(m.pos),n(g.scrollIntoView())}return!0}let u=s.type.spec.isolating||r>0&&l?null:mt.findFrom(e,1),f=u&&u.$from.blockRange(u.$to),d=f&&Dc(f);if(d!=null&&d>=e.depth)return n&&n(t.tr.lift(f,d).scrollIntoView()),!0;if(c&&Ac(s,"start",!0)&&Ac(i,"end")){let h=i,p=[];for(;p.push(h),!h.isTextblock;)h=h.lastChild;let g=s,m=1;for(;!g.isTextblock;g=g.firstChild)m++;if(h.canReplace(h.childCount,h.childCount,g.content)){if(n){let v=_e.empty;for(let C=p.length-1;C>=0;C--)v=_e.from(p[C].copy(v));let x=t.tr.step(new Dn(e.pos-p.length,e.pos+s.nodeSize,e.pos+m,e.pos+s.nodeSize-m,new Ue(v,p.length,0),0,!0));n(x.scrollIntoView())}return!0}}return!1}function FT(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(ft.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const LV=FT(-1),$V=FT(1);function NV(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&ew(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function Qx(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[s];n.doc.nodesBetween(o,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let u=n.doc.resolve(c),f=u.index();i=u.parent.canReplaceWith(f,f+1,t)}})}if(!i)return!1;if(r){let s=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];s.setBlockType(a,l,t,e)}r(s.scrollIntoView())}return!0}}function gw(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}gw(fw,MT,$T);gw(fw,PT,RT);gw(DT,BT,UT,IV);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function PV(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s);if(!o)return!1;let a=r?n.tr:null;return RV(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function RV(t,e,n,r=null){let i=!1,s=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);s=new ph(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new ph(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=ew(s,n,r,e);return a?(t&&DV(t,e,a,i,n),!0):!1}function DV(t,e,n,r,i){let s=_e.empty;for(let u=n.length-1;u>=0;u--)s=_e.from(n[u].type.create(n[u].attrs,s));t.step(new Dn(e.start-(r?2:0),e.end,e.start,e.end,new Ue(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,f=e.endIndex,d=!0;u<f;u++,d=!1)!d&&Ys(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function BV(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?UV(e,n,t,s):HV(e,n,s):!0:!1}}function UV(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new Dn(s-1,o,s,o,new Ue(_e.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new ph(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=Dc(r);if(a==null)return!1;i.lift(r,a);let l=i.doc.resolve(i.mapping.map(s,-1)-1);return Sa(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function HV(t,e,n){let r=t.tr,i=n.parent;for(let h=n.end,p=n.endIndex-1,g=n.startIndex;p>g;p--)h-=i.child(p).nodeSize,r.delete(h-1,h+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?_e.empty:_e.from(i))))return!1;let f=s.pos,d=f+o.nodeSize;return r.step(new Dn(f-(a?1:0),d+(l?1:0),f+1,d-1,new Ue((a?_e.empty:_e.from(i.copy(_e.empty))).append(l?_e.empty:_e.from(i.copy(_e.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function FV(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=_e.from(c?t.create():null),f=new Ue(_e.from(t.create(null,_e.from(a.type.create(null,u)))),c?3:1,0),d=s.start,h=s.end;n(e.tr.step(new Dn(d-(c?3:1),h,d,h,f,1,!0)).scrollIntoView())}return!0}}function Qp(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}class eg{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:i}=n,{tr:s}=r,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const f=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(d=>d===!0)),f={...Object.fromEntries(Object.entries(r).map(([d,h])=>[d,(...g)=>{const m=this.buildProps(c,n),v=h(...g)(m);return a.push(v),f}])),run:u};return f}createCan(e){const{rawCommands:n,state:r}=this,i=!1,s=e||r.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:Qp({state:s,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}}class zV{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(i=>i.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(i=>i!==n):delete this.callbacks[e]),this}once(e,n){const r=(...i)=>{this.off(e,r),n.apply(this,i)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function Ge(t,e,n){return t.config[e]===void 0&&t.parent?Ge(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Ge(t.parent,e,n):null}):t.config[e]}function tg(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function zT(t){const e=[],{nodeExtensions:n,markExtensions:r}=tg(t),i=[...n,...r],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=Ge(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(f=>{Object.entries(u.attributes).forEach(([d,h])=>{e.push({type:f,name:d,attribute:{...s,...h}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=Ge(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,f])=>{const d={...s,...f};typeof d?.default=="function"&&(d.default=d.default()),d?.isRequired&&d?.default===void 0&&delete d.default,e.push({type:o.name,name:u,attribute:d})})}),e}function Un(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function kn(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(u=>!l.includes(u));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[f,d]=u.split(":").map(h=>h.trim());c.set(f,d)}),a.forEach(u=>{const[f,d]=u.split(":").map(h=>h.trim());c.set(f,d)}),r[i]=Array.from(c.entries()).map(([u,f])=>`${u}: ${f}`).join("; ")}else r[i]=s}),r},{})}function xh(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>kn(n,r),{})}function jT(t){return typeof t=="function"}function bt(t,e=void 0,...n){return jT(t)?e?t.bind(e)(...n):t(...n):t}function jV(t={}){return Object.keys(t).length===0&&t.constructor===Object}function VV(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function eS(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):VV(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function tS(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&jV(n)?!1:n!=null))}function qV(t,e){var n;const r=zT(t),{nodeExtensions:i,markExtensions:s}=tg(t),o=(n=i.find(c=>Ge(c,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(i.map(c=>{const u=r.filter(v=>v.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:e},d=t.reduce((v,x)=>{const C=Ge(x,"extendNodeSchema",f);return{...v,...C?C(c):{}}},{}),h=tS({...d,content:bt(Ge(c,"content",f)),marks:bt(Ge(c,"marks",f)),group:bt(Ge(c,"group",f)),inline:bt(Ge(c,"inline",f)),atom:bt(Ge(c,"atom",f)),selectable:bt(Ge(c,"selectable",f)),draggable:bt(Ge(c,"draggable",f)),code:bt(Ge(c,"code",f)),whitespace:bt(Ge(c,"whitespace",f)),linebreakReplacement:bt(Ge(c,"linebreakReplacement",f)),defining:bt(Ge(c,"defining",f)),isolating:bt(Ge(c,"isolating",f)),attrs:Object.fromEntries(u.map(v=>{var x;return[v.name,{default:(x=v?.attribute)===null||x===void 0?void 0:x.default}]}))}),p=bt(Ge(c,"parseHTML",f));p&&(h.parseDOM=p.map(v=>eS(v,u)));const g=Ge(c,"renderHTML",f);g&&(h.toDOM=v=>g({node:v,HTMLAttributes:xh(v,u)}));const m=Ge(c,"renderText",f);return m&&(h.toText=m),[c.name,h]})),l=Object.fromEntries(s.map(c=>{const u=r.filter(m=>m.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:e},d=t.reduce((m,v)=>{const x=Ge(v,"extendMarkSchema",f);return{...m,...x?x(c):{}}},{}),h=tS({...d,inclusive:bt(Ge(c,"inclusive",f)),excludes:bt(Ge(c,"excludes",f)),group:bt(Ge(c,"group",f)),spanning:bt(Ge(c,"spanning",f)),code:bt(Ge(c,"code",f)),attrs:Object.fromEntries(u.map(m=>{var v;return[m.name,{default:(v=m?.attribute)===null||v===void 0?void 0:v.default}]}))}),p=bt(Ge(c,"parseHTML",f));p&&(h.parseDOM=p.map(m=>eS(m,u)));const g=Ge(c,"renderHTML",f);return g&&(h.toDOM=m=>g({mark:m,HTMLAttributes:xh(m,u)})),[c.name,h]}));return new OC({topNode:o,nodes:a,marks:l})}function b0(t,e){return e.nodes[t]||e.marks[t]||null}function nS(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function mw(t,e){const n=Sl.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}const WV=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";n+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,r-s))}),n};function yw(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class ng{constructor(e){this.find=e.find,this.handler=e.handler}}const KV=(t,e)=>{if(yw(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function sd(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(d=>d.type.spec.code))return!1;let u=!1;const f=WV(c)+s;return o.forEach(d=>{if(u)return;const h=KV(f,d.find);if(!h)return;const p=l.state.tr,g=Qp({state:l.state,transaction:p}),m={from:r-(h[0].length-s.length),to:i},{commands:v,chain:x,can:C}=new eg({editor:n,state:g});d.handler({state:g,range:m,match:h,commands:v,chain:x,can:C})===null||!p.steps.length||(p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function GV(t){const{editor:e,rules:n}=t,r=new Vt({state:{init(){return null},apply(i,s,o){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=mw(_e.from(u),o.schema);const{from:f}=l,d=f+u.length;sd({editor:e,from:f,to:d,text:u,rules:n,plugin:r})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return sd({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&sd({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?sd({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function ZV(t){return Object.prototype.toString.call(t).slice(8,-1)}function od(t){return ZV(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function rg(t,e){const n={...t};return od(t)&&od(e)&&Object.keys(e).forEach(r=>{od(e[r])&&od(t[r])?n[r]=rg(t[r],e[r]):n[r]=e[r]}),n}class no{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=bt(Ge(this,"addOptions",{name:this.name}))),this.storage=bt(Ge(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new no(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>rg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new no(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=bt(Ge(n,"addOptions",{name:n.name})),n.storage=bt(Ge(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===n.name))return!1;const l=o.find(c=>c?.type.name===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}}function YV(t){return typeof t=="number"}class JV{constructor(e){this.find=e.find,this.handler=e.handler}}const XV=(t,e,n)=>{if(yw(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(i=>{const s=[i.text];return s.index=i.index,s.input=t,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function QV(t){const{editor:e,state:n,from:r,to:i,rule:s,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new eg({editor:e,state:n}),f=[];return n.doc.nodesBetween(r,i,(h,p)=>{if(!h.isTextblock||h.type.spec.code)return;const g=Math.max(r,p),m=Math.min(i,p+h.content.size),v=h.textBetween(g-p,m-p,void 0,"￼");XV(v,s.find,o).forEach(C=>{if(C.index===void 0)return;const N=g+C.index+1,O=N+C[0].length,A={from:n.tr.mapping.map(N),to:n.tr.mapping.map(O)},P=s.handler({state:n,range:A,match:C,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});f.push(P)})}),f.every(h=>h!==null)}let ad=null;const eq=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function tq(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:f,to:d,rule:h,pasteEvt:p})=>{const g=u.tr,m=Qp({state:u,transaction:g});if(!(!QV({editor:e,state:m,from:Math.max(f-1,0),to:d.b-1,rule:h,pasteEvent:p,dropEvent:a})||!g.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g}};return n.map(u=>new Vt({view(f){const d=p=>{var g;r=!((g=f.dom.parentElement)===null||g===void 0)&&g.contains(p.target)?f.dom.parentElement:null,r&&(ad=e)},h=()=>{ad&&(ad=null)};return window.addEventListener("dragstart",d),window.addEventListener("dragend",h),{destroy(){window.removeEventListener("dragstart",d),window.removeEventListener("dragend",h)}}},props:{handleDOMEvents:{drop:(f,d)=>{if(s=r===f.dom.parentElement,a=d,!s){const h=ad;h?.isEditable&&setTimeout(()=>{const p=h.state.selection;p&&h.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(f,d)=>{var h;const p=(h=d.clipboardData)===null||h===void 0?void 0:h.getData("text/html");return o=d,i=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(f,d,h)=>{const p=f[0],g=p.getMeta("uiEvent")==="paste"&&!i,m=p.getMeta("uiEvent")==="drop"&&!s,v=p.getMeta("applyPasteRules"),x=!!v;if(!g&&!m&&!x)return;if(x){let{text:O}=v;typeof O=="string"?O=O:O=mw(_e.from(O),h.schema);const{from:A}=v,P=A+O.length,S=eq(O);return l({rule:u,state:h,from:A,to:{b:P},pasteEvt:S})}const C=d.doc.content.findDiffStart(h.doc.content),N=d.doc.content.findDiffEnd(h.doc.content);if(!(!YV(C)||!N||C===N.b))return l({rule:u,state:h,from:C,to:N,pasteEvt:o})}}))}function nq(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class ql{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=ql.resolve(e),this.schema=qV(this.extensions,n),this.setupExtensions()}static resolve(e){const n=ql.sort(ql.flatten(e)),r=nq(n.map(i=>i.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},i=Ge(n,"addExtensions",r);return i?[n,...this.flatten(i())]:n}).flat(10)}static sort(e){return e.sort((r,i)=>{const s=Ge(r,"priority")||100,o=Ge(i,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:b0(n.name,this.schema)},i=Ge(n,"addCommands",r);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,n=ql.sort([...this.extensions].reverse()),r=[],i=[],s=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:b0(o.name,this.schema)},l=[],c=Ge(o,"addKeyboardShortcuts",a);let u={};if(o.type==="mark"&&Ge(o,"exitable",a)&&(u.ArrowRight=()=>no.handleExit({editor:e,mark:o})),c){const g=Object.fromEntries(Object.entries(c()).map(([m,v])=>[m,()=>v({editor:e})]));u={...u,...g}}const f=EV(u);l.push(f);const d=Ge(o,"addInputRules",a);nS(o,e.options.enableInputRules)&&d&&r.push(...d());const h=Ge(o,"addPasteRules",a);nS(o,e.options.enablePasteRules)&&h&&i.push(...h());const p=Ge(o,"addProseMirrorPlugins",a);if(p){const g=p();l.push(...g)}return l}).flat();return[GV({editor:e,rules:r}),...tq({editor:e,rules:i}),...s]}get attributes(){return zT(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=tg(this.extensions);return Object.fromEntries(n.filter(r=>!!Ge(r,"addNodeView")).map(r=>{const i=this.attributes.filter(l=>l.type===r.name),s={name:r.name,options:r.options,storage:r.storage,editor:e,type:Un(r.name,this.schema)},o=Ge(r,"addNodeView",s);if(!o)return[];const a=(l,c,u,f,d)=>{const h=xh(l,i);return o()({node:l,view:c,getPos:u,decorations:f,innerDecorations:d,editor:e,extension:r,HTMLAttributes:h})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:b0(e.name,this.schema)};e.type==="mark"&&(!((n=bt(Ge(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const i=Ge(e,"onBeforeCreate",r),s=Ge(e,"onCreate",r),o=Ge(e,"onUpdate",r),a=Ge(e,"onSelectionUpdate",r),l=Ge(e,"onTransaction",r),c=Ge(e,"onFocus",r),u=Ge(e,"onBlur",r),f=Ge(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),f&&this.editor.on("destroy",f)})}}class cn{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=bt(Ge(this,"addOptions",{name:this.name}))),this.storage=bt(Ge(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new cn(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>rg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new cn({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=bt(Ge(n,"addOptions",{name:n.name})),n.storage=bt(Ge(n,"addStorage",{name:n.name,options:n.options})),n}}function VT(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,i,(l,c,u,f)=>{var d;l.isBlock&&c>r&&(a+=s);const h=o?.[l.type.name];if(h)return u&&(a+=h({node:l,pos:c,parent:u,index:f,range:e})),!1;l.isText&&(a+=(d=l?.text)===null||d===void 0?void 0:d.slice(Math.max(r,c)-c,i-c))}),a}function qT(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const rq=cn.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Vt({key:new ln("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=qT(n);return VT(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),iq=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),sq=(t=!1)=>({commands:e})=>e.setContent("",t),oq=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,f=c.resolve(u.map(l)),d=c.resolve(u.map(l+a.nodeSize)),h=f.blockRange(d);if(!h)return;const p=Dc(h);if(a.type.isTextblock){const{defaultType:g}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(h.start,g)}(p||p===0)&&e.lift(h,p)})}),!0},aq=t=>e=>t(e),lq=()=>({state:t,dispatch:e})=>BT(t,e),cq=(t,e)=>({editor:n,tr:r})=>{const{state:i}=n,s=i.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,s.content),r.setSelection(new ft(r.doc.resolve(Math.max(o-1,0)))),!0},uq=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===r.type){if(e){const a=i.before(s),l=i.after(s);t.delete(a,l).scrollIntoView()}return!0}return!1},fq=t=>({tr:e,state:n,dispatch:r})=>{const i=Un(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},dq=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},hq=()=>({state:t,dispatch:e})=>fw(t,e),pq=()=>({commands:t})=>t.keyboardShortcut("Enter"),gq=()=>({state:t,dispatch:e})=>CV(t,e);function Sh(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:yw(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function WT(t,e,n={}){return t.find(r=>r.type===e&&Sh(Object.fromEntries(Object.keys(n).map(i=>[i,r.attrs[i]])),n))}function rS(t,e,n={}){return!!WT(t,e,n)}function bw(t,e,n){var r;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(n=n||((r=i.node.marks[0])===null||r===void 0?void 0:r.attrs),!WT([...i.node.marks],e,n)))return;let o=i.index,a=t.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&rS([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&rS([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function _a(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const mq=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=_a(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const f=bw(l,s,e);if(f&&f.from<=c&&f.to>=u){const d=ft.create(o,f.from,f.to);n.setSelection(d)}}return!0},yq=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function KT(t){return t instanceof ft}function qa(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function GT(t,e=null){if(!e)return null;const n=mt.atStart(t),r=mt.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?ft.create(t,qa(0,i,s),qa(t.content.size,i,s)):ft.create(t,qa(e,i,s),qa(e,i,s))}function ZT(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function ig(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const bq=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(ig()||ZT())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!KT(n.state.selection))return o(),!0;const a=GT(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},vq=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),wq=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),YT=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&YT(r)}return t};function ld(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return YT(n)}function nf(t,e,n){if(t instanceof na||t instanceof _e)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,i=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return _e.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(s){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),nf("",e,n)}if(i){if(n.errorOnInvalidContent){let o=!1,a="";const l=new OC({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?ra.fromSchema(l).parseSlice(ld(t),n.parseOptions):ra.fromSchema(l).parse(ld(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=ra.fromSchema(e);return n.slice?s.parseSlice(ld(t),n.parseOptions).content:s.parse(ld(t),n.parseOptions)}return nf("",e,n)}function Eq(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof $n||i instanceof Dn))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(mt.near(t.doc.resolve(o),n))}const xq=t=>!("type"in t),Sq=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{var o;if(i){n={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=m=>{s.emit("contentError",{editor:s,error:m,disableCollaboration:()=>{s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{nf(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(m){l(m)}try{a=nf(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:s.options.enableContentCheck})}catch(m){return l(m),!1}let{from:u,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},d=!0,h=!0;if((xq(a)?a:[a]).forEach(m=>{m.check(),d=d?m.isText&&m.marks.length===0:!1,h=h?m.isBlock:!1}),u===f&&h){const{parent:m}=r.doc.resolve(u);m.isTextblock&&!m.type.spec.code&&!m.childCount&&(u-=1,f+=1)}let g;if(d){if(Array.isArray(e))g=e.map(m=>m.text||"").join("");else if(e instanceof _e){let m="";e.forEach(v=>{v.text&&(m+=v.text)}),g=m}else typeof e=="object"&&e&&e.text?g=e.text:g=e;r.insertText(g,u,f)}else g=a,r.replaceWith(u,f,g);n.updateSelection&&Eq(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:g}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:g})}return!0},Aq=()=>({state:t,dispatch:e})=>AV(t,e),_q=()=>({state:t,dispatch:e})=>_V(t,e),kq=()=>({state:t,dispatch:e})=>MT(t,e),Cq=()=>({state:t,dispatch:e})=>PT(t,e),Tq=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Kp(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Iq=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Kp(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Oq=()=>({state:t,dispatch:e})=>xV(t,e),Mq=()=>({state:t,dispatch:e})=>SV(t,e);function JT(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Lq(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))ig()||JT()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}const $q=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=Lq(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l?.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function rf(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?Un(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(f,d)=>{if(f.isText)return;const h=Math.max(r,d),p=Math.min(i,d+f.nodeSize);a.push({node:f,from:h,to:p})});const l=i-r,c=a.filter(f=>o?o.name===f.node.type.name:!0).filter(f=>Sh(f.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((f,d)=>f+d.to-d.from,0)>=l}const Nq=(t,e={})=>({state:n,dispatch:r})=>{const i=Un(t,n.schema);return rf(n,i,e)?kV(n,r):!1},Pq=()=>({state:t,dispatch:e})=>UT(t,e),Rq=t=>({state:e,dispatch:n})=>{const r=Un(t,e.schema);return BV(r)(e,n)},Dq=()=>({state:t,dispatch:e})=>DT(t,e);function sg(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function iS(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}const Bq=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=sg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=Un(t,r.schema)),a==="mark"&&(o=_a(t,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&n.setNodeMarkup(u,void 0,iS(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(f=>{o===f.type&&n.addMark(u,u+c.nodeSize,o.create(iS(f.attrs,e)))})})}),!0):!1},Uq=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),Hq=()=>({tr:t,dispatch:e})=>{if(e){const n=new ti(t.doc);t.setSelection(n)}return!0},Fq=()=>({state:t,dispatch:e})=>$T(t,e),zq=()=>({state:t,dispatch:e})=>RT(t,e),jq=()=>({state:t,dispatch:e})=>OV(t,e),Vq=()=>({state:t,dispatch:e})=>$V(t,e),qq=()=>({state:t,dispatch:e})=>LV(t,e);function rb(t,e,n={},r={}){return nf(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const Wq=(t,e=!1,n={},r={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{var l,c;const{doc:u}=s;if(n.preserveWhitespace!=="full"){const f=rb(t,i.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:i.options.enableContentCheck});return o&&s.replaceWith(0,u.content.size,f).setMeta("preventUpdate",!e),!0}return o&&s.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:u.content.size},t,{parseOptions:n,errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:i.options.enableContentCheck})};function XT(t,e){const n=_a(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function Kq(t,e){const n=new WC(t);return e.forEach(r=>{r.steps.forEach(i=>{n.step(i)})}),n}function Gq(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Zq(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(i,s)=>{n(i)&&r.push({node:i,pos:s})}),r}function Yq(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function vw(t){return e=>Yq(e.$from,t)}function Jq(t,e){const n={from:0,to:t.content.size};return VT(t,n,e)}function Xq(t,e){const n=Un(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function QT(t,e){const n=sg(typeof e=="string"?e:e.name,t.schema);return n==="node"?Xq(t,e):n==="mark"?XT(t,e):{}}function Qq(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function eW(t){const e=Qq(t);return e.length===1?e:e.filter((n,r)=>!e.filter((s,o)=>o!==r).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function tW(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),f=e.invert().map(c,-1),d=e.invert().map(u);r.push({oldRange:{from:f,to:d},newRange:{from:c,to:u}})})}),eW(r)}function ww(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t),o=bw(s,i.type);o&&r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{!i||i?.nodeSize===void 0||r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}function Cd(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}function ib(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?_a(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>s?s.name===f.type.name:!0).find(f=>Sh(f.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:f,$to:d})=>{const h=f.pos,p=d.pos;t.doc.nodesBetween(h,p,(g,m)=>{if(!g.isText&&!g.marks.length)return;const v=Math.max(h,m),x=Math.min(p,m+g.nodeSize),C=x-v;o+=C,a.push(...g.marks.map(N=>({mark:N,from:v,to:x})))})}),o===0)return!1;const l=a.filter(f=>s?s.name===f.mark.type.name:!0).filter(f=>Sh(f.mark.attrs,n,{strict:!1})).reduce((f,d)=>f+d.to-d.from,0),c=a.filter(f=>s?f.mark.type!==s&&f.mark.type.excludes(s):!0).reduce((f,d)=>f+d.to-d.from,0);return(l>0?l+c:l)>=o}function nW(t,e,n={}){if(!e)return rf(t,null,n)||ib(t,null,n);const r=sg(e,t.schema);return r==="node"?rf(t,e,n):r==="mark"?ib(t,e,n):!1}function sS(t,e){const{nodeExtensions:n}=tg(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=bt(Ge(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function og(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(s=>{i!==!1&&(og(s,{ignoreWhitespace:n,checkChildren:e})||(i=!1))}),i}return!1}function rW(t){return t instanceof tt}function iW(t,e,n){var r;const{selection:i}=e;let s=null;if(KT(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!==null&&r!==void 0?r:s.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,f,d)=>{if(c)return!1;if(u.isInline){const h=!d||d.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(n));c=h&&p}return!c}),c})}const sW=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=_a(t,r.schema);if(i)if(o){const c=XT(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,f=c.$to.pos;r.doc.nodesBetween(u,f,(d,h)=>{const p=Math.max(h,u),g=Math.min(h+d.nodeSize,f);d.marks.find(v=>v.type===l)?d.marks.forEach(v=>{l===v.type&&n.addMark(p,g,l.create({...v.attrs,...e}))}):n.addMark(p,g,l.create(e))})});return iW(r,n,l)},oW=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),aW=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=Un(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>Qx(s,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>Qx(s,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},lW=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=qa(t,0,r.content.size),s=tt.create(r,i);e.setSelection(s)}return!0},cW=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=ft.atStart(r).from,a=ft.atEnd(r).to,l=qa(i,o,a),c=qa(s,o,a),u=ft.create(r,l,c);e.setSelection(u)}return!0},uW=t=>({state:e,dispatch:n})=>{const r=Un(t,e.schema);return FV(r)(e,n)};function oS(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(r)}}const fW=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=Cd(c,a.node().type.name,a.node().attrs);if(s instanceof tt&&s.node.isBlock)return!a.parentOffset||!Ys(o,a.pos)?!1:(r&&(t&&oS(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,d=a.depth===0?void 0:Gq(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=f&&d?[{type:d,attrs:u}]:void 0,p=Ys(e.doc,e.mapping.map(a.pos),1,h);if(!h&&!p&&Ys(e.doc,e.mapping.map(a.pos),1,d?[{type:d}]:void 0)&&(p=!0,h=d?[{type:d,attrs:u}]:void 0),r){if(p&&(s instanceof ft&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,h),d&&!f&&!a.parentOffset&&a.parent.type!==d)){const g=e.mapping.map(a.before()),m=e.doc.resolve(g);a.node(-1).canReplaceWith(m.index(),m.index()+1,d)&&e.setNodeMarkup(e.mapping.map(a.before()),d)}t&&oS(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},dW=(t,e={})=>({tr:n,state:r,dispatch:i,editor:s})=>{var o;const a=Un(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const f=l.node(-1);if(f.type!==a)return!1;const d=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let v=_e.empty;const x=l.index(-1)?1:l.index(-2)?2:3;for(let S=l.depth-x;S>=l.depth-3;S-=1)v=_e.from(l.node(S).copy(v));const C=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...Cd(d,l.node().type.name,l.node().attrs),...e},O=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(N))||void 0;v=v.append(_e.from(a.createAndFill(null,O)||void 0));const A=l.before(l.depth-(x-1));n.replace(A,l.after(-C),new Ue(v,4-x,0));let P=-1;n.doc.nodesBetween(A,n.doc.content.size,(S,E)=>{if(P>-1)return!1;S.isTextblock&&S.content.size===0&&(P=E+1)}),P>-1&&n.setSelection(ft.near(n.doc.resolve(P))),n.scrollIntoView()}return!0}const h=c.pos===l.end()?f.contentMatchAt(0).defaultType:null,p={...Cd(d,f.type.name,f.attrs),...e},g={...Cd(d,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const m=h?[{type:a,attrs:p},{type:h,attrs:g}]:[{type:a,attrs:p}];if(!Ys(n.doc,l.pos,2))return!1;if(i){const{selection:v,storedMarks:x}=r,{splittableMarks:C}=s.extensionManager,N=x||v.$to.parentOffset&&v.$from.marks();if(n.split(l.pos,2,m).scrollIntoView(),!N||!i)return!0;const O=N.filter(A=>C.includes(A.type.name));n.ensureMarks(O)}return!0},v0=(t,e)=>{const n=vw(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&Sa(t.doc,n.pos)&&t.join(n.pos),!0},w0=(t,e)=>{const n=vw(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&Sa(t.doc,r)&&t.join(r),!0},hW=(t,e,n,r={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:f,splittableMarks:d}=i.extensionManager,h=Un(t,o.schema),p=Un(e,o.schema),{selection:g,storedMarks:m}=o,{$from:v,$to:x}=g,C=v.blockRange(x),N=m||g.$to.parentOffset&&g.$from.marks();if(!C)return!1;const O=vw(A=>sS(A.type.name,f))(g);if(C.depth>=1&&O&&C.depth-O.depth<=1){if(O.node.type===h)return c.liftListItem(p);if(sS(O.node.type.name,f)&&h.validContent(O.node.content)&&a)return l().command(()=>(s.setNodeMarkup(O.pos,h),!0)).command(()=>v0(s,h)).command(()=>w0(s,h)).run()}return!n||!N||!a?l().command(()=>u().wrapInList(h,r)?!0:c.clearNodes()).wrapInList(h,r).command(()=>v0(s,h)).command(()=>w0(s,h)).run():l().command(()=>{const A=u().wrapInList(h,r),P=N.filter(S=>d.includes(S.type.name));return s.ensureMarks(P),A?!0:c.clearNodes()}).wrapInList(h,r).command(()=>v0(s,h)).command(()=>w0(s,h)).run()},pW=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=_a(t,r.schema);return ib(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},gW=(t,e,n={})=>({state:r,commands:i})=>{const s=Un(t,r.schema),o=Un(e,r.schema),a=rf(r,s,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...n})},mW=(t,e={})=>({state:n,commands:r})=>{const i=Un(t,n.schema);return rf(n,i,e)?r.lift(i):r.wrapIn(i,e)},yW=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},bW=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},vW=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=_a(t,r.schema),{$from:c,empty:u,ranges:f}=a;if(!i)return!0;if(u&&o){let{from:d,to:h}=a;const p=(s=c.marks().find(m=>m.type===l))===null||s===void 0?void 0:s.attrs,g=bw(c,l,p);g&&(d=g.from,h=g.to),n.removeMark(d,h,l)}else f.forEach(d=>{n.removeMark(d.$from.pos,d.$to.pos,l)});return n.removeStoredMark(l),!0},wW=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=sg(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=Un(t,r.schema)),a==="mark"&&(o=_a(t,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let f,d,h,p;n.selection.empty?r.doc.nodesBetween(c,u,(g,m)=>{s&&s===g.type&&(h=Math.max(m,c),p=Math.min(m+g.nodeSize,u),f=m,d=g)}):r.doc.nodesBetween(c,u,(g,m)=>{m<c&&s&&s===g.type&&(h=Math.max(m,c),p=Math.min(m+g.nodeSize,u),f=m,d=g),m>=c&&m<=u&&(s&&s===g.type&&n.setNodeMarkup(m,void 0,{...g.attrs,...e}),o&&g.marks.length&&g.marks.forEach(v=>{if(o===v.type){const x=Math.max(m,c),C=Math.min(m+g.nodeSize,u);n.addMark(x,C,o.create({...v.attrs,...e}))}}))}),d&&(f!==void 0&&n.setNodeMarkup(f,void 0,{...d.attrs,...e}),o&&d.marks.length&&d.marks.forEach(g=>{o===g.type&&n.addMark(h,p,o.create({...g.attrs,...e}))}))}),!0):!1},EW=(t,e={})=>({state:n,dispatch:r})=>{const i=Un(t,n.schema);return NV(i,e)(n,r)},xW=(t,e={})=>({state:n,dispatch:r})=>{const i=Un(t,n.schema);return PV(i,e)(n,r)};var SW=Object.freeze({__proto__:null,blur:iq,clearContent:sq,clearNodes:oq,command:aq,createParagraphNear:lq,cut:cq,deleteCurrentNode:uq,deleteNode:fq,deleteRange:dq,deleteSelection:hq,enter:pq,exitCode:gq,extendMarkRange:mq,first:yq,focus:bq,forEach:vq,insertContent:wq,insertContentAt:Sq,joinBackward:kq,joinDown:_q,joinForward:Cq,joinItemBackward:Tq,joinItemForward:Iq,joinTextblockBackward:Oq,joinTextblockForward:Mq,joinUp:Aq,keyboardShortcut:$q,lift:Nq,liftEmptyBlock:Pq,liftListItem:Rq,newlineInCode:Dq,resetAttributes:Bq,scrollIntoView:Uq,selectAll:Hq,selectNodeBackward:Fq,selectNodeForward:zq,selectParentNode:jq,selectTextblockEnd:Vq,selectTextblockStart:qq,setContent:Wq,setMark:sW,setMeta:oW,setNode:aW,setNodeSelection:lW,setTextSelection:cW,sinkListItem:uW,splitBlock:fW,splitListItem:dW,toggleList:hW,toggleMark:pW,toggleNode:gW,toggleWrap:mW,undoInputRule:yW,unsetAllMarks:bW,unsetMark:vW,updateAttributes:wW,wrapIn:EW,wrapInList:xW});const AW=cn.create({name:"commands",addCommands(){return{...SW}}}),_W=cn.create({name:"drop",addProseMirrorPlugins(){return[new Vt({key:new ln("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),kW=cn.create({name:"editable",addProseMirrorPlugins(){return[new Vt({key:new ln("editable"),props:{editable:()=>this.editor.options.editable}})]}}),CW=new ln("focusEvents"),TW=cn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Vt({key:CW,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),IW=cn.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:f}=l,{pos:d,parent:h}=f,p=f.parent.isTextblock&&d>0?a.doc.resolve(d-1):f,g=p.parent.type.spec.isolating,m=f.pos-f.parentOffset,v=g&&p.parent.childCount===1?m===f.pos:mt.atStart(c).from===d;return!u||!h.type.isTextblock||h.textContent.length||!v||v&&f.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return ig()||JT()?s:i},addProseMirrorPlugins(){return[new Vt({key:new ln("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(g=>g.getMeta("composition")))return;const r=t.some(g=>g.docChanged)&&!e.doc.eq(n.doc),i=t.some(g=>g.getMeta("preventClearDocument"));if(!r||i)return;const{empty:s,from:o,to:a}=e.selection,l=mt.atStart(e.doc).from,c=mt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!og(n.doc))return;const d=n.tr,h=Qp({state:n,transaction:d}),{commands:p}=new eg({editor:this.editor,state:h});if(p.clearNodes(),!!d.steps.length)return d}})]}}),OW=cn.create({name:"paste",addProseMirrorPlugins(){return[new Vt({key:new ln("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),MW=cn.create({name:"tabindex",addProseMirrorPlugins(){return[new Vt({key:new ln("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Ha{get name(){return this.node.type.name}constructor(e,n,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=i}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Ha(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Ha(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Ha(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const i=n.isBlock&&!n.isTextblock,s=n.isAtom&&!n.isText,o=this.pos+r+(s?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new Ha(a,this.editor,i,i?n:null);i&&(l.actualDepth=this.depth+1),e.push(new Ha(a,this.editor,i,i?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(n).length>0){const s=i.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==n[l])break}}else r=i;i=i.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(n);return this.children.forEach(o=>{r&&i.length>0||(o.node.type.name===e&&s.every(l=>n[l]===o.node.attrs[l])&&i.push(o),!(r&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,n,r))))}),i}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const LW=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function $W(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}let NW=class extends zV{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:i})=>this.options.onDrop(n,r,i)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=$W(LW,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=jT(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,n;const i=[...this.options.enableCoreExtensions?[kW,rq.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),AW,TW,IW,MW,_W,OW].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s?.type));this.extensionManager=new ql(i,this)}createCommandManager(){this.commandManager=new eg({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=rb(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=rb(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=GT(n,this.options.autofocus);this.view=new TT(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:Vl.create({doc:n,selection:r||void 0})});const i=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(i),this.createNodeViews(),this.prependClass();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),s=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return QT(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return nW(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return mw(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return Jq(this.state.doc,{blockSeparator:n,textSerializers:{...qT(this.schema),...r}})}get isEmpty(){return og(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new Ha(n,this)}get $doc(){return this.$pos(0)}};function _c(t){return new ng({find:t.find,handler:({state:e,range:n,match:r})=>{const i=bt(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(ww(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(g=>g===t.type&&g!==h.mark.type)).filter(h=>h.to>c).length)return null;u<n.to&&s.delete(u,n.to),c>n.from&&s.delete(n.from+l,c);const d=n.from+l+o.length;s.addMark(n.from+l,d,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}function eI(t){return new ng({find:t.find,handler:({state:e,range:n,match:r})=>{const i=bt(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;const l=t.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const f=r[0][r[0].length-1];s.insertText(f,o+r[0].length-1),s.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;s.insert(c,t.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()}})}function sb(t){return new ng({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=bt(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)}})}function sf(t){return new ng({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const s=bt(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&ew(l,t.type,s);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:f,storedMarks:d}=e,{splittableMarks:h}=t.editor.extensionManager,p=d||f.$to.parentOffset&&f.$from.marks();if(p){const g=p.filter(m=>h.includes(m.type.name));o.ensureMarks(g)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(f,s).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&Sa(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)}})}let si=class ob{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=bt(Ge(this,"addOptions",{name:this.name}))),this.storage=bt(Ge(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new ob(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>rg(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new ob(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=bt(Ge(n,"addOptions",{name:n.name})),n.storage=bt(Ge(n,"addStorage",{name:n.name,options:n.options})),n}};class PW{constructor(e,n,r){this.isDragging=!1,this.component=e,this.editor=n.editor,this.options={stopEvent:null,ignoreMutation:null,...r},this.extension=n.extension,this.node=n.node,this.decorations=n.decorations,this.innerDecorations=n.innerDecorations,this.view=n.view,this.HTMLAttributes=n.HTMLAttributes,this.getPos=n.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var n,r,i,s,o,a,l;const{view:c}=this.editor,u=e.target,f=u.nodeType===3?(n=u.parentElement)===null||n===void 0?void 0:n.closest("[data-drag-handle]"):u.closest("[data-drag-handle]");if(!this.dom||!((r=this.contentDOM)===null||r===void 0)&&r.contains(u)||!f)return;let d=0,h=0;if(this.dom!==f){const x=this.dom.getBoundingClientRect(),C=f.getBoundingClientRect(),N=(i=e.offsetX)!==null&&i!==void 0?i:(s=e.nativeEvent)===null||s===void 0?void 0:s.offsetX,O=(o=e.offsetY)!==null&&o!==void 0?o:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;d=C.x-x.x+N,h=C.y-x.y+O}const p=this.dom.cloneNode(!0);(l=e.dataTransfer)===null||l===void 0||l.setDragImage(p,d,h);const g=this.getPos();if(typeof g!="number")return;const m=tt.create(c.state.doc,g),v=c.state.tr.setSelection(m);c.dispatch(v)}stopEvent(e){var n;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const r=e.target;if(!(this.dom.contains(r)&&!(!((n=this.contentDOM)===null||n===void 0)&&n.contains(r))))return!1;const s=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(r.tagName)||r.isContentEditable)&&!o&&!s)return!0;const{isEditable:l}=this.editor,{isDragging:c}=this,u=!!this.node.type.spec.draggable,f=tt.isSelectable(this.node),d=e.type==="copy",h=e.type==="paste",p=e.type==="cut",g=e.type==="mousedown";if(!u&&f&&s&&e.target===this.dom&&e.preventDefault(),u&&s&&!c&&e.target===this.dom)return e.preventDefault(),!1;if(u&&l&&!c&&g){const m=r.closest("[data-drag-handle]");m&&(this.dom===m||this.dom.contains(m))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(c||o||d||h||p||g&&f)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(ig()||ZT())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(r=>r.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:n})=>{const r=this.getPos();return typeof r!="number"?!1:(n.setNodeMarkup(r,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const n=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:n})}}function ml(t){return new JV({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:i})=>{const s=bt(t.getAttributes,void 0,r,i);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),f=n.from+l.indexOf(a),d=f+a.length;if(ww(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(m=>m===t.type&&m!==p.mark.type)).filter(p=>p.to>f).length)return null;d<n.to&&o.delete(d,n.to),f>n.from&&o.delete(n.from+u,f),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}function RW(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof tt){const s=r.index();return r.parent.canReplaceWith(s,s+1,e)}let i=r.depth;for(;i>=0;){const s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}class DW extends NW{contentElement=null}const BW=t=>{const e=new DW(t);return l_(e,n=>(e.on("transaction",()=>{n(e)}),()=>{e.destroy()}))};class UW{component;props;dom;constructor(e,{element:n,props:r}){this.component=e,this.props=r,this.dom=n,this.dom.classList.add("svelte-renderer")}updateProps(e){Object.assign(this.props,e)}updateAttributes(e){Object.keys(e).forEach(n=>{this.dom.setAttribute(n,e[n])})}destroy(){n$(this.component)}}const tI="TipTapNodeView",HW=(t,e)=>{if(!t)throw new Error(e)};class FW extends Map{#e=new Map;#t=Se(0);#n=Se(0);#s=Ks||-1;constructor(e){if(super(),e){for(var[n,r]of e)super.set(n,r);this.#n.v=super.size}}#r(e){return Ks===this.#s?Se(e):lc(e)}has(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#r(0),n.set(e,r);else return $(this.#t),!1}return $(r),!0}forEach(e,n){this.#o(),super.forEach(e,n)}get(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#r(0),n.set(e,r);else{$(this.#t);return}}return $(r),super.get(e)}set(e,n){var r=this.#e,i=r.get(e),s=super.get(e),o=super.set(e,n),a=this.#t;if(i===void 0)i=this.#r(0),r.set(e,i),se(this.#n,super.size),Fo(a);else if(s!==n){Fo(i);var l=a.reactions===null?null:new Set(a.reactions),c=l===null||!i.reactions?.every(u=>l.has(u));c&&Fo(a)}return o}delete(e){var n=this.#e,r=n.get(e),i=super.delete(e);return r!==void 0&&(n.delete(e),se(this.#n,super.size),se(r,-1),Fo(this.#t)),i}clear(){if(super.size!==0){super.clear();var e=this.#e;se(this.#n,0);for(var n of e.values())se(n,-1);Fo(this.#t),e.clear()}}#o(){$(this.#t);var e=this.#e;if(this.#n.v!==e.size){for(var n of super.keys())if(!e.has(n)){var r=this.#r(0);e.set(n,r)}}for([,r]of this.#e)$(r)}keys(){return $(this.#t),super.keys()}values(){return this.#o(),super.values()}entries(){return this.#o(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return $(this.#n),super.size}}class zW extends PW{mount(){const e=this.component,n=Et({editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(a={})=>this.updateAttributes(a),deleteNode:()=>this.deleteNode()});this.contentDOMElement=this.node.isLeaf?null:document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");const r=this.options.context||new FW;r.set(tI,{onDragStart:this.onDragStart.bind(this)});const i=this.options.as??(this.node.isInline?"span":"div"),s=document.createElement(i);s.classList.add(`node-${this.node.type.name}`),this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate);const o=JA(e,{target:s,props:n,context:r});this.renderer=new UW(o,{element:s,props:n}),this.appendContendDom(),this.updateElementAttributes()}appendContendDom(){const e=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&e&&!e.contains(this.contentDOMElement)&&e.appendChild(this.contentDOMElement)}get dom(){return HW(this.renderer.dom.firstElementChild?.hasAttribute("data-node-view-wrapper"),"Please use the NodeViewWrapper component for your node view."),this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection,r=this.getPos();if(typeof r=="number")if(e<=r&&n>=r+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n,r){const i=s=>{this.renderer.updateProps(s),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(typeof this.options.update=="function"){const s=this.node,o=this.decorations,a=this.innerDecorations;return this.node=e,this.decorations=n,this.innerDecorations=r,this.options.update({oldNode:s,oldDecorations:o,oldInnerDecorations:a,newNode:e,newDecorations:n,newInnerDecorations:r,updateProps:()=>i({node:e,decorations:n,innerDecorations:r})})}return e.type!==this.node.type?!1:(e===this.node&&this.decorations===n&&this.innerDecorations===r||(this.node=e,this.decorations=n,this.innerDecorations=r,i({node:e,decorations:n,innerDecorations:r})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.dom.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.dom.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const n=this.editor.extensionManager.attributes,r=xh(this.node,n);e=this.options.attrs({node:this.node,HTMLAttributes:r})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}const nI=(t,e)=>n=>new zW(t,n,e);var jW=je("<div></div> <!>",1);function VW(t,e){un(e,!0);const n=dt(e,"editor",7);let r;Ti(async()=>{await ua(),r&&n()?.options.element&&(n().contentElement||(r.append(...Array.from(n().options.element.childNodes)),n().setOptions({element:r}),n().contentElement=r))}),ol(()=>{if(!n()||(n().contentElement=null,!n().options.element.firstChild))return;const c=document.createElement("div");c.append(...Array.from(n().options.element.childNodes)),n().setOptions({element:c})});var s=jW(),o=vt(s);Rn(o,c=>r=c,()=>r);var a=Me(o,2);{var l=c=>{var u=Xt(),f=vt(u);cc(f,()=>e.children),we(c,u)};rt(a,c=>{e.children&&c(l)})}Je(()=>ri(o,1,t_(e.class))),we(t,s),fn()}function rI(t,e){un(e,!0);const n=dt(e,"as",3,"div"),r=m$(e,["$$slots","$$events","$$legacy","as","children"]),{onDragStart:i}=vL(tI);let s;Ti(async()=>{await ua(),s.style.whiteSpace="normal"});var o=Xt(),a=vt(o);s$(a,n,!1,(l,c)=>{Rn(l,h=>s=h,()=>s),s_(l,()=>({"data-node-view-wrapper":"",role:"none",...r,ondragstart:i}));var u=Xt(),f=vt(u);{var d=h=>{var p=Xt(),g=vt(p);cc(g,()=>e.children),we(h,p)};rt(f,h=>{e.children&&h(d)})}we(c,u)}),we(t,o),fn()}class Mu{static isValidNsec(e){return aF(e)}static derivePublicKey(e){return uF(e)}static pubkeyToNpub(e){try{return e?dC(e):""}catch(n){return console.error("pubkeyからnpubへの変換エラー:",n),""}}}class qW{constructor(e,n,r){this.localStorage=e,this.console=n,this.secretKeyStore=r}saveToStorage(e){if(!e?.trim())return{success:!1,error:{type:"validation",message:"Key cannot be empty"}};try{const n=e.trim();return this.localStorage.setItem("nostr-secret-key",n),this.secretKeyStore.set(n),{success:!0}}catch(n){const r={type:"storage",message:"鍵の保存に失敗しました",originalError:n};return this.console.error("鍵の保存に失敗:",n),{success:!1,error:r}}}loadFromStorage(){let e=this.secretKeyStore.value;if(e)return e;try{return e=this.localStorage.getItem("nostr-secret-key"),e&&this.secretKeyStore.set(e),e}catch(n){return this.console.error("鍵の読み込みに失敗:",n),null}}getFromStore(){return this.secretKeyStore.value}hasStoredKey(){try{return!!this.localStorage.getItem("nostr-secret-key")}catch(e){return this.console.error("ストレージアクセスエラー:",e),!1}}}class WW{constructor(e){this.window=e}isWindowNostrAvailable(){return typeof this.window<"u"&&"nostr"in this.window&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}async getPublicKeyFromWindowNostr(){if(!this.isWindowNostrAvailable()||!this.window?.nostr)return{success:!1,error:{type:"validation",message:"window.nostr is not available"}};try{return{success:!0,pubkey:await this.window.nostr.getPublicKey()}}catch(e){const n={type:"network",message:"window.nostrから公開鍵の取得に失敗しました",originalError:e};return console.error("window.nostrから公開鍵の取得に失敗:",e),{success:!1,error:n}}}}class iI{constructor(e={}){this.deps=e,this._nsecStore.subscribe(n=>this.updateFromNsec(n))}_nsecStore=Ei("");_dataStore=Ei({hex:"",npub:"",nprofile:""});_isValidStore=Ei(!1);_isNostrLoginStore=Ei(!1);nsec={subscribe:this._nsecStore.subscribe};data={subscribe:this._dataStore.subscribe};isValid={subscribe:this._isValidStore.subscribe};isNostrLogin={subscribe:this._isNostrLoginStore.subscribe};hex=Gs(this._dataStore,e=>e.hex);npub=Gs(this._dataStore,e=>e.npub);nprofile=Gs(this._dataStore,e=>e.nprofile);setNsec(e){const n=e?.trim()||"";this._nsecStore.set(n),this._isNostrLoginStore.set(!1)}setNostrLoginAuth(e){if(e.type==="logout"){this.clear();return}if(!e.pubkey){console.warn("NostrLoginAuth: pubkey is required for login/signup");return}try{const n=e.npub||ha.npubEncode(e.pubkey),r=ha.nprofileEncode({pubkey:e.pubkey,relays:[]});this._dataStore.set({hex:e.pubkey,npub:n,nprofile:r}),this._isValidStore.set(!0),this._isNostrLoginStore.set(!0),this._nsecStore.set(""),this.deps.setNostrLoginAuthFn?this.deps.setNostrLoginAuthFn(e.pubkey,n,r):setTimeout(()=>{this.deps.setNostrLoginAuthFn&&this.deps.setNostrLoginAuthFn(e.pubkey,n,r)},10),console.log("[PublicKeyState] NostrLogin認証状態を設定:",{pubkey:e.pubkey,npub:n,type:e.type})}catch(n){console.error("Failed to set NostrLogin auth:",n),this.clear()}}updateFromNsec(e){if(!e||!Mu.isValidNsec(e)){this._resetState();return}try{const n=Mu.derivePublicKey(e);n.hex?(this._dataStore.set(n),this._isValidStore.set(!0)):this._resetState()}catch(n){console.error("Failed to derive public key from nsec:",n),this._resetState()}}_resetState(){this._dataStore.set({hex:"",npub:"",nprofile:""}),this._isValidStore.set(!1)}clear(){this._nsecStore.set(""),this._isNostrLoginStore.set(!1),this.deps.clearAuthStateFn&&this.deps.clearAuthStateFn()}get currentIsValid(){return Ja(this._isValidStore)}get currentHex(){return Ja(this.hex)}get currentIsNostrLogin(){return Ja(this._isNostrLoginStore)}}class sI{storage;externalAuth;constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.console||(typeof window<"u"?window.console:{}),i=e.secretKeyStore||{value:null,set:()=>{}},s=e.window||(typeof window<"u"?window:void 0);this.storage=new qW(n,r,i),this.externalAuth=new WW(s)}isValidNsec(e){return Mu.isValidNsec(e)}derivePublicKey(e){return Mu.derivePublicKey(e)}pubkeyToNpub(e){return Mu.pubkeyToNpub(e)}saveToStorage(e){return this.storage.saveToStorage(e)}loadFromStorage(){return this.storage.loadFromStorage()}getFromStore(){return this.storage.getFromStore()}hasStoredKey(){return this.storage.hasStoredKey()}isWindowNostrAvailable(){return this.externalAuth.isWindowNostrAvailable()}async getPublicKeyFromWindowNostr(){return await this.externalAuth.getPublicKeyFromWindowNostr()}getStorage(){return this.storage}getExternalAuth(){return this.externalAuth}}const ab=new sI;let oI=Et({content:"",hashtags:[],tags:[]});const jo=oI;function KW(){return bL(oI)}Et({});let au=Et({});const lb={get value(){return au},set:t=>{Object.assign(au,t)},update:t=>{const e=t(au);Object.assign(au,e)},subscribe:t=>(qe(()=>{t(au)}),()=>{})},aS=["client","eHagaki","31990:ec42c765418b3db9c85abff3a88f4a3bbe57535eebbdc54522041fa5328c0600:1754918316480","wss://relay.nostr.band"];function GW(){try{const t=localStorage.getItem("clientTagEnabled");return(t===null?!0:t==="true")?[...aS]:null}catch{return[...aS]}}function ZW(t){return encodeURI(t.trim())}function YW(t){return WU.includes(t)}function JW(t){const e=t.toLowerCase();return KU.some(n=>e.endsWith(n))}function XW(t){const e=t.toLowerCase();return GU.some(n=>e.endsWith(n))}function ag(t){try{const e=ZW(t),n=new URL(e);return YW(n.protocol)?n.href:null}catch{return null}}function aI(t){const e=ag(t);if(!e)return null;try{const n=new URL(e);return JW(n.pathname)?e:null}catch{return null}}function QW(t){const e=ag(t);if(!e)return null;try{const n=new URL(e);return XW(n.pathname)?e:null}catch{return null}}function lI(t){return t.replace(/\r\n/g,`
`).replace(/\r/g,`
`)}function eK(t){return!t||/[\s\n\u3000]/.test(t)}function tK(t){const e=/([.,;:!?）】」』〉》】\]}>）]){2,}$/,n=t.match(e);if(n){const r=n[0];return{cleanUrl:t.slice(0,-r.length),trailingChars:r}}return{cleanUrl:t,trailingChars:""}}function nK(t){const{cleanUrl:e}=tK(t);return{cleanUrl:e,actualLength:e.length}}function rK(t){if(t.childCount===1){const e=t.firstChild;return e?.type.name==="paragraph"&&e.content.size===0}return t.childCount===0}function iK(t){return rK(t.doc)}function sK(t,e){return t.type.name==="paragraph"&&t.content.size===e&&t.textContent.trim().length===e}function oK(t){const e=[];return t.descendants(n=>{if(n.type.name==="paragraph"){const r=n.textContent;e.push(r)}else if(n.type.name==="image"){const r=n.attrs?.src;r&&e.push(r)}else if(n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}}),e}function aK(t){if(!t)return null;try{const e=typeof t=="function"?t():t;return e?.state?.doc??e?.view?.state?.doc??null}catch{return null}}function cI(t){const e=aK(t);return e?oK(e).join(`
`):""}function lK(t,e,n){if(t===e)return null;let r=t;if(n){const i=n.resolve(t);i.parent.type.name==="paragraph"&&(r=i.after())}return r<e?{insertPos:r,deleteStart:e+1,deleteEnd:e+2}:r>e+1?{insertPos:r-1,deleteStart:e,deleteEnd:e+1}:null}function cK(t,e,n){return n.insertPos<n.deleteStart?t.insert(n.insertPos,e).delete(n.deleteStart,n.deleteEnd):t.delete(n.deleteStart,n.deleteEnd).insert(n.insertPos,e)}function E0(t,e,n){const{tr:r,doc:i,schema:s}=t.state,o=e.pos,a=lK(n,o,i);if(!a)return!0;const l=s.nodes.image.create(e.attrs);try{const c=cK(r,l,a);return t.dispatch(c),!0}catch(c){return console.error("Error moving image:",c),!1}}function lS(t){t.dispatch(t.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null}))}function Ew(t,e,n){if(!t)return;t.state.doc.descendants((i,s)=>{if(e(i,s))return n(i,s),!1})}function uK(t,e,n,r){t.update(i=>{const s={...i};return e&&delete s[e],s})}function x0(t,e,n,r,i=!1){n&&(uK(r,t),Ew(n,(s,o)=>{const a=s.type?.name;return(e&&a==="video"||!e&&a==="image")&&(s.attrs?.src===t||s.attrs?.id===t)},(s,o)=>{const a=n.state.tr.delete(o,o+s.nodeSize);n.view.dispatch(a),i&&console.log("[uploadHelper] Deleted placeholder:",t)}))}function uI(t,e=!1){if(!t)return;const{state:n}=t,{doc:r}=n,i=n.tr;let s=0;const o=[];r.descendants((a,l)=>{const c=a.type?.name,u=a.attrs?.isPlaceholder===!0||a.attrs?.src?.startsWith("placeholder-")||a.attrs?.src?.startsWith("blob:");(c==="image"||c==="video")&&u&&o.push({pos:l,size:a.nodeSize})}),o.reverse().forEach(({pos:a,size:l})=>{i.delete(a,a+l),s++}),s>0&&(t.view.dispatch(i),e&&console.log(`[editorUtils] Deleted ${s} placeholder(s)`))}const fK=/^\s*>\s$/,dK=si.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[sf({find:fK,type:this.type})]}}),hK=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,pK=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,gK=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,mK=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,yK=no.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[_c({find:hK,type:this.type}),_c({find:gK,type:this.type})]},addPasteRules(){return[ml({find:pK,type:this.type}),ml({find:mK,type:this.type})]}}),bK="listItem",cS="textStyle",uS=/^\s*([-+*])\s$/,vK=si.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(bK,this.editor.getAttributes(cS)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=sf({find:uS,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=sf({find:uS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(cS),editor:this.editor})),[t]}}),wK=/(^|[^`])`([^`]+)`(?!`)/,EK=/(^|[^`])`([^`]+)`(?!`)/g,xK=no.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[_c({find:wK,type:this.type})]},addPasteRules(){return[ml({find:EK,type:this.type})]}}),SK=/^```([a-z]+)?[\s\n]$/,AK=/^~~~([a-z]+)?[\s\n]$/,_K=si.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,s=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",kn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(mt.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[sb({find:SK,type:this.type,getAttributes:t=>({language:t[1]})}),sb({find:AK,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Vt({key:new ln("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i?.mode;if(!n||!s)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(ft.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),kK=si.create({name:"doc",topNode:!0,content:"block+"});function CK(t={}){return new Vt({view(e){return new TK(e,t)}})}class TK{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,i=this.editorView.dom,s=i.getBoundingClientRect(),o=s.width/i.offsetWidth,a=s.height/i.offsetHeight;if(n){let f=e.nodeBefore,d=e.nodeAfter;if(f||d){let h=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(h){let p=h.getBoundingClientRect(),g=f?p.bottom:p.top;f&&d&&(g=(g+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let m=this.width/2*a;r={left:p.left,right:p.right,top:g-m,bottom:g+m}}}}if(!r){let f=this.editorView.coordsAtPos(this.cursorPos),d=this.width/2*o;r={left:f.left-d,right:f.left+d,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let f=l.getBoundingClientRect(),d=f.width/l.offsetWidth,h=f.height/l.offsetHeight;c=f.left-l.scrollLeft*d,u=f.top-l.scrollTop*h}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n,e):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=FC(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const IK=cn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[CK(this.options)]}});class on extends mt{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return on.valid(r)?new on(r):mt.near(r)}content(){return Ue.empty}eq(e){return e instanceof on&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new on(e.resolve(n.pos))}getBookmark(){return new xw(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!OK(e)||!MK(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&on.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(on.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!tt.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(on.valid(a))return a}return null}}}on.prototype.visible=!1;on.findFrom=on.findGapCursorFrom;mt.jsonID("gapcursor",on);class xw{constructor(e){this.pos=e}map(e){return new xw(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return on.valid(n)?new on(n):mt.near(n)}}function OK(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function MK(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function LK(){return new Vt({props:{decorations:RK,createSelectionBetween(t,e,n){return e.pos==n.pos&&on.valid(n)?new on(n):null},handleClick:NK,handleKeyDown:$K,handleDOMEvents:{beforeinput:PK}}})}const $K=IT({ArrowLeft:cd("horiz",-1),ArrowRight:cd("horiz",1),ArrowUp:cd("vert",-1),ArrowDown:cd("vert",1)});function cd(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof ft){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=on.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new on(c))),!0):!1}}function NK(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!on.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&tt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new on(r))),!0)}function PK(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof on))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=_e.empty;for(let o=r.length-1;o>=0;o--)i=_e.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new Ue(i,0,0));return s.setSelection(ft.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function RK(t){if(!(t.selection instanceof on))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Kt.create(t.doc,[hr.widget(t.selection.head,e,{key:"gapcursor"})])}const DK=cn.create({name:"gapCursor",addProseMirrorPlugins(){return[LK()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=bt(Ge(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),BK=si.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",kn(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const f=l.filter(d=>a.includes(d.type.name));c.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),UK=si.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,kn(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>sb({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Ah=200,Bn=function(){};Bn.prototype.append=function(e){return e.length?(e=Bn.from(e),!this.length&&e||e.length<Ah&&this.leafAppend(e)||this.length<Ah&&e.leafPrepend(this)||this.appendInner(e)):this};Bn.prototype.prepend=function(e){return e.length?Bn.from(e).append(this):this};Bn.prototype.appendInner=function(e){return new HK(this,e)};Bn.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Bn.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Bn.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Bn.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Bn.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};Bn.from=function(e){return e instanceof Bn?e:e&&e.length?new fI(e):Bn.empty};var fI=(function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=Ah)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=Ah)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(Bn);Bn.empty=new fI([]);var HK=(function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(Bn);const FK=500;class Pi{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((f,d)=>{if(!f.step){i||(i=this.remapping(r,d+1),s=i.maps.length),s--,u.push(f);return}if(i){u.push(new Ji(f.map));let h=f.step.map(i.slice(s)),p;h&&o.maybeStep(h).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new Ji(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(f.step);if(f.selection)return a=i?f.selection.map(i.slice(s)):f.selection,l=new Pi(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let f=e.steps[u].invert(e.docs[u]),d=new Ji(e.mapping.maps[u],f,n),h;(h=l&&l.merge(d))&&(d=h,u?s.pop():a=a.slice(0,a.length-1)),s.push(d),n&&(o++,n=void 0),i||(l=d)}let c=o-r.depth;return c>jK&&(a=zK(a,c),o-=c),new Pi(a.append(s),o)}remapping(e,n){let r=new Ju;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Pi(this.items.append(e.map(n=>new Ji(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(d=>{d.selection&&a--},i);let l=n;this.items.forEach(d=>{let h=s.getMirror(--l);if(h==null)return;o=Math.min(o,h);let p=s.maps[h];if(d.step){let g=e.steps[h].invert(e.docs[h]),m=d.selection&&d.selection.map(s.slice(l+1,h));m&&a++,r.push(new Ji(p,g,m))}else r.push(new Ji(p))},i);let c=[];for(let d=n;d<o;d++)c.push(new Ji(s.maps[d]));let u=this.items.slice(0,i).append(c).append(r),f=new Pi(u,a);return f.emptyItemCount()>FK&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let f=new Ji(c.invert(),l,u),d,h=i.length-1;(d=i.length&&i[h].merge(f))?i[h]=d:i.push(f)}}else o.map&&r--},this.items.length,0),new Pi(Bn.from(i.reverse()),s)}}Pi.empty=new Pi(Bn.empty,0);function zK(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class Ji{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Ji(n.getMap().invert(),n,this.selection)}}}class Bo{constructor(e,n,r,i,s){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const jK=20;function VK(t,e,n,r){let i=n.getMeta(il),s;if(i)return i.historyState;n.getMeta(KK)&&(t=new Bo(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(il))return o.getMeta(il).redo?new Bo(t.done.addTransform(n,void 0,r,Td(e)),t.undone,fS(n.mapping.maps),t.prevTime,t.prevComposition):new Bo(t.done,t.undone.addTransform(n,void 0,r,Td(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!qK(n,t.prevRanges)),c=o?S0(t.prevRanges,n.mapping):fS(n.mapping.maps);return new Bo(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,Td(e)),Pi.empty,c,n.time,a??t.prevComposition)}else return(s=n.getMeta("rebased"))?new Bo(t.done.rebased(n,s),t.undone.rebased(n,s),S0(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Bo(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),S0(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function qK(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function fS(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,i,s,o)=>e.push(s,o));return e}function S0(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function WK(t,e,n){let r=Td(e),i=il.get(e).spec.config,s=(n?t.undone:t.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(n?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),l=new Bo(n?a:s.remaining,n?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(il,{redo:n,historyState:l})}let A0=!1,dS=null;function Td(t){let e=t.plugins;if(dS!=e){A0=!1,dS=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){A0=!0;break}}return A0}const il=new ln("history"),KK=new ln("closeHistory");function GK(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Vt({key:il,state:{init(){return new Bo(Pi.empty,Pi.empty,null,0,-1)},apply(e,n,r){return VK(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?hI:r=="historyRedo"?pI:null;return i?(n.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function dI(t,e){return(n,r)=>{let i=il.getState(n);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(r){let s=WK(i,n,t);s&&r(e?s.scrollIntoView():s)}return!0}}const hI=dI(!1,!0),pI=dI(!0,!0),ZK=cn.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>hI(t,e),redo:()=>({state:t,dispatch:e})=>pI(t,e)}},addProseMirrorPlugins(){return[GK(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),YK=si.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",kn(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!RW(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:i}=n,s=t();return r.parentOffset===0?s.insertContentAt({from:Math.max(r.pos-1,0),to:i.pos},{type:this.name}):rW(n)?s.insertContentAt(i.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:c}=o.selection,u=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?o.setSelection(ft.create(o.doc,c.pos+1)):c.nodeAfter.isBlock?o.setSelection(tt.create(o.doc,c.pos)):o.setSelection(ft.create(o.doc,c.pos));else{const f=(l=c.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();f&&(o.insert(u,f),o.setSelection(ft.create(o.doc,u+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[eI({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),JK=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,XK=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,QK=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,eG=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,tG=no.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[_c({find:JK,type:this.type}),_c({find:QK,type:this.type})]},addPasteRules(){return[ml({find:XK,type:this.type}),ml({find:eG,type:this.type})]}}),nG=si.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",kn(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),rG="listItem",hS="textStyle",pS=/^(\d+)\.\s$/,iG=si.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",kn(this.options.HTMLAttributes,n),0]:["ol",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(rG,this.editor.getAttributes(hS)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=sf({find:pS,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=sf({find:pS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(hS)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),sG=si.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),oG=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,aG=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,lG=no.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",kn(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[_c({find:oG,type:this.type})]},addPasteRules(){return[ml({find:aG,type:this.type})]}}),cG=si.create({name:"text",group:"inline"}),uG=cn.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(yK.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(dK.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(vK.configure(this.options.bulletList)),this.options.code!==!1&&t.push(xK.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(_K.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(kK.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(IK.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(DK.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(BK.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push(UK.configure(this.options.heading)),this.options.history!==!1&&t.push(ZK.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(YK.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(tG.configure(this.options.italic)),this.options.listItem!==!1&&t.push(nG.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(iG.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(sG.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(lG.configure(this.options.strike)),this.options.text!==!1&&t.push(cG.configure(this.options.text)),t}}),fG="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",dG="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",cb="numeric",ub="ascii",fb="alpha",Lu="asciinumeric",bu="alphanumeric",db="domain",gI="emoji",hG="scheme",pG="slashscheme",_0="whitespace";function gG(t,e){return t in e||(e[t]=[]),e[t]}function Wa(t,e,n){e[cb]&&(e[Lu]=!0,e[bu]=!0),e[ub]&&(e[Lu]=!0,e[fb]=!0),e[Lu]&&(e[bu]=!0),e[fb]&&(e[bu]=!0),e[bu]&&(e[db]=!0),e[gI]&&(e[db]=!0);for(const r in e){const i=gG(r,n);i.indexOf(t)<0&&i.push(t)}}function mG(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Rr(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Rr.groups={};Rr.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(t))return s}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let i=0;i<t.length;i++)this.tt(t[i],e,n,r)},tr(t,e,n,r){r=r||Rr.groups;let i;return e&&e.j?i=e:(i=new Rr(e),n&&r&&Wa(e,n,r)),this.jr.push([t,i]),i},ts(t,e,n,r){let i=this;const s=t.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(t[o]);return i.tt(t[s-1],e,n,r)},tt(t,e,n,r){r=r||Rr.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const s=e;let o,a=i.go(t);if(a?(o=new Rr,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Rr,s){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(mG(o.t,r),n);Wa(s,l,r)}else n&&Wa(s,n,r);o.t=s}return i.j[t]=o,o}};const yt=(t,e,n,r,i)=>t.ta(e,n,r,i),rn=(t,e,n,r,i)=>t.tr(e,n,r,i),gS=(t,e,n,r,i)=>t.ts(e,n,r,i),Te=(t,e,n,r,i)=>t.tt(e,n,r,i),Ms="WORD",hb="UWORD",mI="ASCIINUMERICAL",yI="ALPHANUMERICAL",of="LOCALHOST",pb="TLD",gb="UTLD",Id="SCHEME",Ul="SLASH_SCHEME",Sw="NUM",mb="WS",Aw="NL",$u="OPENBRACE",Nu="CLOSEBRACE",_h="OPENBRACKET",kh="CLOSEBRACKET",Ch="OPENPAREN",Th="CLOSEPAREN",Ih="OPENANGLEBRACKET",Oh="CLOSEANGLEBRACKET",Mh="FULLWIDTHLEFTPAREN",Lh="FULLWIDTHRIGHTPAREN",$h="LEFTCORNERBRACKET",Nh="RIGHTCORNERBRACKET",Ph="LEFTWHITECORNERBRACKET",Rh="RIGHTWHITECORNERBRACKET",Dh="FULLWIDTHLESSTHAN",Bh="FULLWIDTHGREATERTHAN",Uh="AMPERSAND",Hh="APOSTROPHE",Fh="ASTERISK",Uo="AT",zh="BACKSLASH",jh="BACKTICK",Vh="CARET",Vo="COLON",_w="COMMA",qh="DOLLAR",Xi="DOT",Wh="EQUALS",kw="EXCLAMATION",di="HYPHEN",Pu="PERCENT",Kh="PIPE",Gh="PLUS",Zh="POUND",Ru="QUERY",Cw="QUOTE",bI="FULLWIDTHMIDDLEDOT",Tw="SEMI",Qi="SLASH",Du="TILDE",Yh="UNDERSCORE",vI="EMOJI",Jh="SYM";var wI=Object.freeze({__proto__:null,ALPHANUMERICAL:yI,AMPERSAND:Uh,APOSTROPHE:Hh,ASCIINUMERICAL:mI,ASTERISK:Fh,AT:Uo,BACKSLASH:zh,BACKTICK:jh,CARET:Vh,CLOSEANGLEBRACKET:Oh,CLOSEBRACE:Nu,CLOSEBRACKET:kh,CLOSEPAREN:Th,COLON:Vo,COMMA:_w,DOLLAR:qh,DOT:Xi,EMOJI:vI,EQUALS:Wh,EXCLAMATION:kw,FULLWIDTHGREATERTHAN:Bh,FULLWIDTHLEFTPAREN:Mh,FULLWIDTHLESSTHAN:Dh,FULLWIDTHMIDDLEDOT:bI,FULLWIDTHRIGHTPAREN:Lh,HYPHEN:di,LEFTCORNERBRACKET:$h,LEFTWHITECORNERBRACKET:Ph,LOCALHOST:of,NL:Aw,NUM:Sw,OPENANGLEBRACKET:Ih,OPENBRACE:$u,OPENBRACKET:_h,OPENPAREN:Ch,PERCENT:Pu,PIPE:Kh,PLUS:Gh,POUND:Zh,QUERY:Ru,QUOTE:Cw,RIGHTCORNERBRACKET:Nh,RIGHTWHITECORNERBRACKET:Rh,SCHEME:Id,SEMI:Tw,SLASH:Qi,SLASH_SCHEME:Ul,SYM:Jh,TILDE:Du,TLD:pb,UNDERSCORE:Yh,UTLD:gb,UWORD:hb,WORD:Ms,WS:mb});const Is=/[a-z]/,lu=new RegExp("\\p{L}","u"),k0=new RegExp("\\p{Emoji}","u"),Os=/\d/,C0=/\s/,mS="\r",T0=`
`,yG="️",bG="‍",I0="￼";let ud=null,fd=null;function vG(t=[]){const e={};Rr.groups=e;const n=new Rr;ud==null&&(ud=yS(fG)),fd==null&&(fd=yS(dG)),Te(n,"'",Hh),Te(n,"{",$u),Te(n,"}",Nu),Te(n,"[",_h),Te(n,"]",kh),Te(n,"(",Ch),Te(n,")",Th),Te(n,"<",Ih),Te(n,">",Oh),Te(n,"（",Mh),Te(n,"）",Lh),Te(n,"「",$h),Te(n,"」",Nh),Te(n,"『",Ph),Te(n,"』",Rh),Te(n,"＜",Dh),Te(n,"＞",Bh),Te(n,"&",Uh),Te(n,"*",Fh),Te(n,"@",Uo),Te(n,"`",jh),Te(n,"^",Vh),Te(n,":",Vo),Te(n,",",_w),Te(n,"$",qh),Te(n,".",Xi),Te(n,"=",Wh),Te(n,"!",kw),Te(n,"-",di),Te(n,"%",Pu),Te(n,"|",Kh),Te(n,"+",Gh),Te(n,"#",Zh),Te(n,"?",Ru),Te(n,'"',Cw),Te(n,"/",Qi),Te(n,";",Tw),Te(n,"~",Du),Te(n,"_",Yh),Te(n,"\\",zh),Te(n,"・",bI);const r=rn(n,Os,Sw,{[cb]:!0});rn(r,Os,r);const i=rn(r,Is,mI,{[Lu]:!0}),s=rn(r,lu,yI,{[bu]:!0}),o=rn(n,Is,Ms,{[ub]:!0});rn(o,Os,i),rn(o,Is,o),rn(i,Os,i),rn(i,Is,i);const a=rn(n,lu,hb,{[fb]:!0});rn(a,Is),rn(a,Os,s),rn(a,lu,a),rn(s,Os,s),rn(s,Is),rn(s,lu,s);const l=Te(n,T0,Aw,{[_0]:!0}),c=Te(n,mS,mb,{[_0]:!0}),u=rn(n,C0,mb,{[_0]:!0});Te(n,I0,u),Te(c,T0,l),Te(c,I0,u),rn(c,C0,u),Te(u,mS),Te(u,T0),rn(u,C0,u),Te(u,I0,u);const f=rn(n,k0,vI,{[gI]:!0});Te(f,"#"),rn(f,k0,f),Te(f,yG,f);const d=Te(f,bG);Te(d,"#"),rn(d,k0,f);const h=[[Is,o],[Os,i]],p=[[Is,null],[lu,a],[Os,s]];for(let g=0;g<ud.length;g++)Io(n,ud[g],pb,Ms,h);for(let g=0;g<fd.length;g++)Io(n,fd[g],gb,hb,p);Wa(pb,{tld:!0,ascii:!0},e),Wa(gb,{utld:!0,alpha:!0},e),Io(n,"file",Id,Ms,h),Io(n,"mailto",Id,Ms,h),Io(n,"http",Ul,Ms,h),Io(n,"https",Ul,Ms,h),Io(n,"ftp",Ul,Ms,h),Io(n,"ftps",Ul,Ms,h),Wa(Id,{scheme:!0,ascii:!0},e),Wa(Ul,{slashscheme:!0,ascii:!0},e),t=t.sort((g,m)=>g[0]>m[0]?1:-1);for(let g=0;g<t.length;g++){const m=t[g][0],x=t[g][1]?{[hG]:!0}:{[pG]:!0};m.indexOf("-")>=0?x[db]=!0:Is.test(m)?Os.test(m)?x[Lu]=!0:x[ub]=!0:x[cb]=!0,gS(n,m,m,x)}return gS(n,"localhost",of,{ascii:!0}),n.jd=new Rr(Jh),{start:n,tokens:Object.assign({groups:e},wI)}}function EI(t,e){const n=wG(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,i=[];let s=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,f=-1,d=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(f=0,d=0,u=a):f>=0&&(f+=n[o].length,d++),c+=n[o].length,s+=n[o].length,o++;s-=f,o-=d,c-=f,i.push({t:u.t,v:e.slice(s-c,s),s:s-c,e:s})}return i}function wG(t){const e=[],n=t.length;let r=0;for(;r<n;){let i=t.charCodeAt(r),s,o=i<55296||i>56319||r+1===n||(s=t.charCodeAt(r+1))<56320||s>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function Io(t,e,n,r,i){let s;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?s=t.j[l]:(s=new Rr(r),s.jr=i.slice(),t.j[l]=s),t=s}return s=new Rr(n),s.jr=i.slice(),t.j[e[o-1]]=s,s}function yS(t){const e=[],n=[];let r=0,i="0123456789";for(;r<t.length;){let s=0;for(;i.indexOf(t[r+s])>=0;)s++;if(s>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+s),10);o>0;o--)n.pop();r+=s}else n.push(t[r]),r++}return e}const af={defaultProtocol:"http",events:null,format:bS,formatHref:bS,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Iw(t,e=null){let n=Object.assign({},af);t&&(n=Object.assign(n,t instanceof Iw?t.o:t));const r=n.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=i}Iw.prototype={o:af,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:af[t],typeof i=="function"&&r&&(i=i(e,n))):typeof i=="function"&&r&&(i=i(e,n.t,n)),i)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function bS(t){return t}function xI(t,e){this.t="token",this.v=t,this.tk=e}xI.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"…":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=af.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),i=t.get("tagName",n,e),s=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),f=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:i,attributes:o,content:s,eventListeners:f}}};function lg(t,e){class n extends xI{constructor(i,s){super(i,s),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const vS=lg("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),wS=lg("text"),EG=lg("nl"),dd=lg("url",{isLink:!0,toHref(t=af.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==of&&t[1].t===Vo}}),ui=t=>new Rr(t);function xG({groups:t}){const e=t.domain.concat([Uh,Fh,Uo,zh,jh,Vh,qh,Wh,di,Sw,Pu,Kh,Gh,Zh,Qi,Jh,Du,Yh]),n=[Hh,Vo,_w,Xi,kw,Pu,Ru,Cw,Tw,Ih,Oh,$u,Nu,kh,_h,Ch,Th,Mh,Lh,$h,Nh,Ph,Rh,Dh,Bh],r=[Uh,Hh,Fh,zh,jh,Vh,qh,Wh,di,$u,Nu,Pu,Kh,Gh,Zh,Ru,Qi,Jh,Du,Yh],i=ui(),s=Te(i,Du);yt(s,r,s),yt(s,t.domain,s);const o=ui(),a=ui(),l=ui();yt(i,t.domain,o),yt(i,t.scheme,a),yt(i,t.slashscheme,l),yt(o,r,s),yt(o,t.domain,o);const c=Te(o,Uo);Te(s,Uo,c),Te(a,Uo,c),Te(l,Uo,c);const u=Te(s,Xi);yt(u,r,s),yt(u,t.domain,s);const f=ui();yt(c,t.domain,f),yt(f,t.domain,f);const d=Te(f,Xi);yt(d,t.domain,f);const h=ui(vS);yt(d,t.tld,h),yt(d,t.utld,h),Te(c,of,h);const p=Te(f,di);Te(p,di,p),yt(p,t.domain,f),yt(h,t.domain,f),Te(h,Xi,d),Te(h,di,p);const g=Te(h,Vo);yt(g,t.numeric,vS);const m=Te(o,di),v=Te(o,Xi);Te(m,di,m),yt(m,t.domain,o),yt(v,r,s),yt(v,t.domain,o);const x=ui(dd);yt(v,t.tld,x),yt(v,t.utld,x),yt(x,t.domain,o),yt(x,r,s),Te(x,Xi,v),Te(x,di,m),Te(x,Uo,c);const C=Te(x,Vo),N=ui(dd);yt(C,t.numeric,N);const O=ui(dd),A=ui();yt(O,e,O),yt(O,n,A),yt(A,e,O),yt(A,n,A),Te(x,Qi,O),Te(N,Qi,O);const P=Te(a,Vo),S=Te(l,Vo),E=Te(S,Qi),_=Te(E,Qi);yt(a,t.domain,o),Te(a,Xi,v),Te(a,di,m),yt(l,t.domain,o),Te(l,Xi,v),Te(l,di,m),yt(P,t.domain,O),Te(P,Qi,O),Te(P,Ru,O),yt(_,t.domain,O),yt(_,e,O),Te(_,Qi,O);const k=[[$u,Nu],[_h,kh],[Ch,Th],[Ih,Oh],[Mh,Lh],[$h,Nh],[Ph,Rh],[Dh,Bh]];for(let D=0;D<k.length;D++){const[U,B]=k[D],M=Te(O,U);Te(A,U,M),Te(M,B,O);const T=ui(dd);yt(M,e,T);const L=ui();yt(M,n),yt(T,e,T),yt(T,n,L),yt(L,e,T),yt(L,n,L),Te(T,B,O),Te(L,B,O)}return Te(i,of,x),Te(i,Aw,EG),{start:i,tokens:wI}}function SG(t,e,n){let r=n.length,i=0,s=[],o=[];for(;i<r;){let a=t,l=null,c=null,u=0,f=null,d=-1;for(;i<r&&!(l=a.go(n[i].t));)o.push(n[i++]);for(;i<r&&(c=l||a.go(n[i].t));)l=null,a=c,a.accepts()?(d=0,f=a):d>=0&&d++,i++,u++;if(d<0)i-=u,i<r&&(o.push(n[i]),i++);else{o.length>0&&(s.push(O0(wS,e,o)),o=[]),i-=d,u-=d;const h=f.t,p=n.slice(i-u,i);s.push(O0(h,e,p))}}return o.length>0&&s.push(O0(wS,e,o)),s}function O0(t,e,n){const r=n[0].s,i=n[n.length-1].e,s=e.slice(r,i);return new t(s,n)}const AG=typeof console<"u"&&console&&console.warn||(()=>{}),_G="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Wt={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function kG(){return Rr.groups={},Wt.scanner=null,Wt.parser=null,Wt.tokenQueue=[],Wt.pluginQueue=[],Wt.customSchemes=[],Wt.initialized=!1,Wt}function ES(t,e=!1){if(Wt.initialized&&AG(`linkifyjs: already initialized - will not register custom scheme "${t}" ${_G}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Wt.customSchemes.push([t,e])}function CG(){Wt.scanner=vG(Wt.customSchemes);for(let t=0;t<Wt.tokenQueue.length;t++)Wt.tokenQueue[t][1]({scanner:Wt.scanner});Wt.parser=xG(Wt.scanner.tokens);for(let t=0;t<Wt.pluginQueue.length;t++)Wt.pluginQueue[t][1]({scanner:Wt.scanner,parser:Wt.parser});return Wt.initialized=!0,Wt}function Ow(t){return Wt.initialized||CG(),SG(Wt.parser.start,t,EI(Wt.scanner.start,t))}Ow.scan=EI;function SI(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new Iw(n),i=Ow(t),s=[];for(let o=0;o<i.length;o++){const a=i[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&s.push(a.toFormattedObject(r))}return s}const Mw="[\0-   ᠎ -\u2029 　]",TG=new RegExp(Mw),IG=new RegExp(`${Mw}$`),OG=new RegExp(Mw,"g");function MG(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function LG(t){return new Vt({key:new ln("autolink"),appendTransaction:(e,n,r)=>{const i=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=r,a=Kq(n.doc,[...e]);if(tW(a).forEach(({newRange:c})=>{const u=Zq(r.doc,c,h=>h.isTextblock);let f,d;if(u.length>1)f=u[0],d=r.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ");else if(u.length){const h=r.doc.textBetween(c.from,c.to," "," ");if(!IG.test(h))return;f=u[0],d=r.doc.textBetween(f.pos,c.to,void 0," ")}if(f&&d){const h=d.split(TG).filter(Boolean);if(h.length<=0)return!1;const p=h[h.length-1],g=f.pos+d.lastIndexOf(p);if(!p)return!1;const m=Ow(p).map(v=>v.toObject(t.defaultProtocol));if(!MG(m))return!1;m.filter(v=>v.isLink).map(v=>({...v,from:g+v.start+1,to:g+v.end+1})).filter(v=>r.schema.marks.code?!r.doc.rangeHasMark(v.from,v.to,r.schema.marks.code):!0).filter(v=>t.validate(v.value)).filter(v=>t.shouldAutoLink(v.value)).forEach(v=>{ww(v.from,v.to,r.doc).some(x=>x.mark.type===t.type)||o.addMark(v.from,v.to,t.type.create({href:v.href}))})}}),!!o.steps.length)return o}})}function $G(t){return new Vt({key:new ln("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,s;if(r.button!==0||!e.editable)return!1;let o=r.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(d=>d.nodeName==="A"))return!1;const l=QT(e.state,t.type.name),c=r.target,u=(i=c?.href)!==null&&i!==void 0?i:l.href,f=(s=c?.target)!==null&&s!==void 0?s:l.target;return c&&u?(window.open(u,f),!0):!1}}})}function NG(t){return new Vt({key:new ln("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:i}=e,{selection:s}=i,{empty:o}=s;if(o)return!1;let a="";r.content.forEach(c=>{a+=c.textContent});const l=SI(a,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:t.editor.commands.setMark(t.type,{href:l.href})}}})}function La(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const i=typeof r=="string"?r:r.scheme;i&&n.push(i)}),!t||t.replace(OG,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const PG=no.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){ES(t);return}ES(t.scheme,t.optionalSlashes)})},onDestroy(){kG()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!La(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!La(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!La(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",kn(this.options.HTMLAttributes,t),0]:["a",kn(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!La(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!La(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[ml({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,i=SI(t).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:o=>!!La(o,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(s=>e.push({text:s.value,data:{href:s.href},index:s.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(LG({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:i=>!!La(i,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push($G({type:this.type})),this.options.linkOnPaste&&t.push(NG({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),RG=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,DG=si.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",kn(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[eI({find:RG,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),BG=cn.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Vt({key:new ln("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,i=[];if(!n)return null;const s=this.editor.isEmpty;return t.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&og(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];s&&u.push(this.options.emptyEditorClass);const f=hr.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});i.push(f)}return this.options.includeChildren}),Kt.create(t,i)}}})]}});function UG(t,e,n,r,i,s,o){const a=window,l=navigator,c=o?.editorObj??window.__currentEditor,u=mr,f=typeof u=="function"?u:Ja(u);return[{label:f("imageContextMenu.fullscreen"),action:()=>{let d=c?.view?.dom||document.querySelector(".editor-container")||a;typeof d.dispatchEvent!="function"&&(d=window),d.dispatchEvent(new CustomEvent("image-fullscreen-request",{detail:{src:t,alt:e},bubbles:!0,composed:!0}))},src:t,icon:"/icons/expand-solid-full.svg"},{label:f("imageContextMenu.copyUrl"),action:async()=>{try{if(l?.clipboard&&typeof l.clipboard.writeText=="function")return await l.clipboard.writeText(t),!0}catch{}try{const d=a&&a.document||document,h=d.createElement("textarea");h.value=t,h.style.position="fixed",h.style.left="-9999px",h.style.top="0",h.setAttribute("readonly","true"),d.body.appendChild(h),h.focus(),h.select();const p=d.execCommand&&d.execCommand("copy");if(d.body.removeChild(h),!p)throw new Error("fallback_copy_failed");return!0}catch(d){throw console.warn("Failed to copy URL (both clipboard API and fallback failed):",d),d}},src:t,icon:"/icons/copy-solid-full.svg"},{label:f("imageContextMenu.delete"),action:()=>{const d=c?.view;if(d?.state&&d?.dispatch){let h=!1;d.state.doc.descendants((p,g)=>{if(!h&&p.type.name==="image"&&p.attrs.id===s)return d.dispatch(d.state.tr.delete(g,g+p.nodeSize)),h=!0,!1})}},disabled:!1,src:t,icon:"/icons/trash-solid-full.svg"}]}function HG(t,e,n,r,i){const s=((l,c,...u)=>setTimeout(l,c,...u));let o=!1,a;if(t.update(l=>(o=l.open&&l.nodeId!==e,a=l.nodeId,l)),o&&a){t.set({open:!1,nodeId:void 0,src:void 0}),s(()=>{t.set({open:!0,nodeId:e,src:r})},0);return}t.set({open:!0,nodeId:e,src:r})}function FG(t,e,n,r){if(!t.open||!t.nodeId)return null;const i=t.nodeId,s=t.src||"",o="Image";let a=0,l=1;e?.state?.doc&&e.state.doc.descendants((d,h)=>{if(d.attrs.id===i)return a=h,l=d.nodeSize,!1});const u=UG(s,o,()=>a,l,!0,i,{editorObj:e});let f={x:0,y:0};return n&&(f=nc(n.x,n.y)),{items:u,x:f.x,y:f.y}}function zG(t,e,n){e(t,!1),n()}function jG(t){t.preventDefault()}var VG=je("<canvas></canvas>"),qG=je('<img draggable="false" style="z-index:2; position:relative;"/>'),WG=je('<button type="button" class="editor-image-button svelte-1wpi4se" tabindex="0"><!> <!></button>');function KG(t,e){un(e,!0);let n=kS,r=CS,i=Se(!1),s=Se(!1),o=Se(void 0),a=Se(void 0);const l=cs(),c=400;let u=Qe(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src&&e.node.attrs.src.startsWith("placeholder-")),f=Qe(()=>!$(u)&&e.node.attrs.src&&!e.node.attrs.src.startsWith("placeholder-")),d=Qe(()=>e.node.attrs.blurhash&&($(u)||!$(i)||$(s))),h=Se(null);const p=!1;qe(()=>{const U=e.node.attrs.src;if(!U)return;const B=lb.value[U];if(B){se(h,B,!0);return}const M=NH(e.node.attrs.dim);if(M){const T=uC(M.width,M.height);se(h,T,!0),lb.update(L=>({...L,[U]:T}))}else $(u)&&se(h,t0(),!0)});let g=Se(!1),m=Qe(()=>Zs.value);const v=e.node.attrs.id||(typeof e.getPos=="function"?e.getPos().toString():"");qe(()=>{ei.subscribe(U=>{(!U.open||U.nodeId!==v)&&se(g,!1)})});function x(){$(m)&&HG(ei,v,$(m),e.node.attrs.src)}function C(U,B=!1){const M=jl(U);Zs.set(M),YH(U,B,n.isDragging,$(u),e.selected,r.justSelected,e.node.attrs.src,e.node.attrs.alt||"Image",e.getPos)&&!e.selected&&(r.justSelectedTimeout&&clearTimeout(r.justSelectedTimeout),r.justSelected=!0,r.justSelectedTimeout=setTimeout(()=>{r.justSelected=!1,r.justSelectedTimeout=null},c))}function N(){n.isDragging=!0,su("start",{},e.getPos),n.preview=qH(n.startTarget,n.startPos.x,n.startPos.y,$(u))}function O(){n.longPressTimeout&&(clearTimeout(n.longPressTimeout),n.longPressTimeout=null),n.startTarget=null}function A(U,B,M){O(),n.startPos={x:B,y:M},n.startTarget=U,n.longPressTimeout=setTimeout(()=>{N()},ZU)}function P(){se(i,!0),se(s,!0),setTimeout(()=>{se(s,!1)},400)}function S(){se(i,!1)}function E(U,B){if(U==="start"){const M=B;if(!M?.dataTransfer&&!l)return;if(l){B?.preventDefault();return}M?.dataTransfer&&(M.dataTransfer.setData("application/x-tiptap-node",JSON.stringify({type:"image",attrs:e.node.attrs,pos:e.getPos()})),M.dataTransfer.effectAllowed="move"),n.isDragging=!0,su("start")}else n.isDragging=!1,n0(n.preview),su("end")}function _(U){if(U.touches.length!==1)return;sC();const B=jl(U);Zs.set(B),A(U.currentTarget,B.x,B.y)}function k(U){if(U.touches.length!==1){O();return}const B=jl(U);if(!n.isDragging&&n.longPressTimeout&&KH(B.x,B.y,n.startPos.x,n.startPos.y,YU)){O();return}n.isDragging&&(U.preventDefault(),WH(n.preview,B.x,B.y),HH(B.x,B.y),su("move",{touchX:B.x,touchY:B.y,nodePos:e.getPos()}))}function D(U){if(n.longPressTimeout&&(O(),!n.isDragging)){C(U,!0),x();return}if(!n.isDragging)return;U.preventDefault();const B=jl(U),M=document.elementFromPoint(B.x,B.y);if(M){const L=M.closest(".drop-zone-indicator")?.getAttribute("data-drop-pos");su("end",{nodeData:{type:"image",attrs:e.node.attrs,pos:e.getPos()},dropX:B.x,dropY:B.y,target:M,dropPosition:L?parseInt(L,10):null})}n.isDragging=!1,n0(n.preview),n.preview=null}Ti(()=>{e.node.attrs.blurhash&&$(o)&&XE(e.node.attrs.blurhash,$(o),$(h)||t0(),$(u),p),l&&$(a)&&($(a).addEventListener("touchstart",_,{passive:!1}),$(a).addEventListener("touchmove",k,{passive:!1}),$(a).addEventListener("touchend",D,{passive:!1}))}),qe(()=>{e.node.attrs.blurhash&&$(o)&&XE(e.node.attrs.blurhash,$(o),$(h)||t0(),$(u),p)}),ol(()=>{O(),r.justSelectedTimeout&&clearTimeout(r.justSelectedTimeout),n0(n.preview),ei.set({open:!1,nodeId:void 0}),l&&$(a)&&($(a).removeEventListener("touchstart",_),$(a).removeEventListener("touchmove",k),$(a).removeEventListener("touchend",D)),Object.assign(kS,{isDragging:!1,longPressTimeout:null,startTarget:null,preview:null}),Object.assign(CS,{justSelected:!1,justSelectedTimeout:null}),se(o,void 0)}),rI(t,{children:(U,B)=>{var M=WG();M.__click=[zG,C,x];var T=pe(M);{var L=j=>{var Z=VG();let J;Rn(Z,ue=>se(o,ue),()=>$(o)),Je(ue=>J=ri(Z,1,"blurhash-canvas svelte-1wpi4se",null,J,ue),[()=>({"is-placeholder":$(u),"fade-out":$(i)&&$(s)&&$(f)})]),we(j,Z)};rt(T,j=>{$(d)&&j(L)})}var q=Me(T,2);{var F=j=>{var Z=qG();let J;Z.__contextmenu=[jG],Je(ue=>{an(Z,"src",e.node?.attrs?.src),an(Z,"alt",e.node?.attrs?.alt||""),J=ri(Z,1,"editor-image svelte-1wpi4se",null,J,ue)},[()=>({"image-loading":!$(i)})]),Ni("load",Z,P),Ni("error",Z,S),we(j,Z)};rt(q,j=>{$(f)&&j(F)})}Rn(M,j=>se(a,j),()=>$(a)),Je(()=>{an(M,"data-highlighted",e.selected),an(M,"data-dragging",n.isDragging),an(M,"aria-label",e.node?.attrs?.alt||"Image"),an(M,"draggable",!l)}),Ni("dragstart",M,j=>E("start",j)),Ni("dragend",M,()=>E("end")),Ni("dragover",M,function(...j){(l?Z=>Z.preventDefault():void 0)?.apply(this,j)}),Ni("drop",M,function(...j){(l?Z=>Z.preventDefault():void 0)?.apply(this,j)}),we(U,M)},$$slots:{default:!0}}),fn()}Ci(["click","contextmenu"]);var GG=je('<div class="loader-container svelte-zx73mp"><div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div></div>'),ZG=je('<div class="placeholder-image svelte-zx73mp" aria-hidden="true"></div>'),YG=je('<span class="placeholder-text loading-text svelte-zx73mp"> </span>'),JG=je("<div><!> <!> <!></div>");function ma(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii();let s=dt(e,"text",3,!1),o=dt(e,"showImage",3,!1),a=dt(e,"showLoader",3,!1),l=dt(e,"customClass",3,""),c=Qe(()=>typeof s()=="string"?s():s()===!0?n()("loadingPlaceholder.loading"):"");var u=JG(),f=pe(u);{var d=v=>{var x=GG();we(v,x)};rt(f,v=>{a()&&v(d)})}var h=Me(f,2);{var p=v=>{var x=ZG();we(v,x)};rt(h,v=>{o()&&v(p)})}var g=Me(h,2);{var m=v=>{var x=YG(),C=pe(x);Je(()=>Ye(C,$(c))),we(v,x)};rt(g,v=>{$(c)&&v(m)})}Je(()=>{ri(u,1,`loading-placeholder ${l()??""}`,"svelte-zx73mp"),an(u,"aria-label",$(c))}),we(t,u),fn(),i()}function XG(t,e,n,r,i,s){const o=window,a=navigator,l=s?.editorObj??window.__currentEditor,c=mr,u=typeof c=="function"?c:Ja(c);return[{label:u("videoContextMenu.playPause"),action:()=>{const f=document.querySelector(`video[data-node-id="${i}"]`);f?f.paused?f.play().catch(d=>{console.warn("Failed to play video:",d)}):f.pause():console.warn("Video element not found for nodeId:",i)},src:t,icon:"/icons/play_pause_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg"},{label:u("videoContextMenu.copyUrl"),action:async()=>{try{if(a?.clipboard&&typeof a.clipboard.writeText=="function")return await a.clipboard.writeText(t),!0}catch{}try{const f=o&&o.document||document,d=f.createElement("textarea");d.value=t,d.style.position="fixed",d.style.left="-9999px",d.style.top="0",d.setAttribute("readonly","true"),f.body.appendChild(d),d.focus(),d.select();const h=f.execCommand&&f.execCommand("copy");if(f.body.removeChild(d),!h)throw new Error("fallback_copy_failed");return!0}catch(f){throw console.warn("Failed to copy URL (both clipboard API and fallback failed):",f),f}},src:t,icon:"/icons/copy-solid-full.svg"},{label:u("videoContextMenu.delete"),action:()=>{const f=l?.view;if(f?.state&&f?.dispatch){let d=!1;f.state.doc.descendants((h,p)=>{if(!d&&h.type.name==="video"&&h.attrs.id===i)return f.dispatch(f.state.tr.delete(p,p+h.nodeSize)),d=!0,!1})}},disabled:!1,src:t,icon:"/icons/trash-solid-full.svg"}]}function cg(t,e,n,r,i,s){const o=((c,u,...f)=>setTimeout(c,u,...f));let a=!1,l;if(t.update(c=>(a=c.open&&c.nodeId!==e,l=c.nodeId,c)),a&&l){t.set({open:!1,nodeId:void 0,src:void 0,videoElement:void 0}),o(()=>{t.set({open:!0,nodeId:e,src:r,videoElement:i})},0);return}t.set({open:!0,nodeId:e,src:r,videoElement:i})}function QG(t,e,n,r){if(!t.open||!t.nodeId)return null;const i=t.nodeId,s=t.src||"";t.videoElement;let o=0,a=1;e?.state?.doc&&e.state.doc.descendants((f,d)=>{if(f.attrs.id===i)return o=d,a=f.nodeSize,!1});const c=XG(s,()=>o,a,!0,i,{editorObj:e});let u={x:0,y:0};return n&&(u=nc(n.x,n.y)),{items:c,x:u.x,y:u.y}}function eZ(t,e,n,r,i,s){if($(e)||n()||t.target===$(r))return;t.stopPropagation(),t.preventDefault();const o=jl(t);Zs.set(o),cg(ei,$(i),o,s.node.attrs.src||"",$(r))}function tZ(t,e,n,r,i,s){if($(e)||n())return;if($(r)){const a=$(r).getBoundingClientRect(),l=t.clientY,c=a.bottom;if(l>c-48)return}if(t.button===2)return;t.stopPropagation(),t.preventDefault();const o=jl(t);Zs.set(o),cg(ei,$(i),o,s.node.attrs.src||"",$(r))}function nZ(t,e,n,r,i){if(t.key==="Enter"||t.key===" "){t.preventDefault();const s={x:0,y:0};Zs.set(s),$(e)||cg(ei,$(n),s,r.node.attrs.src||"",$(i))}}var rZ=je('<video controls playsinline="" autoplay loop preload="metadata"><track kind="captions"/> </video>',2),iZ=je('<div data-video-node="" role="button" tabindex="0"><!></div>');function sZ(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii();let s=Se(void 0),o=Se(!1),a=Se(void 0),l=Qe(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src?.startsWith("placeholder-")||e.node.attrs.src?.startsWith("blob:")||!e.node.attrs.src),c=Qe(()=>e.node.attrs.id||(typeof e.getPos=="function"?e.getPos().toString():"unknown"));function u(){se(o,!0)}function f(){$(l)||console.error("Failed to load video:",e.node.attrs.src)}function d(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}let h=0,p={x:0,y:0};const g=200,m=10;function v(C){if($(l)||C.touches.length!==1)return;h=Date.now();const N=C.touches[0];p={x:N.clientX,y:N.clientY}}function x(C){if($(l)||d())return;if(Date.now()-h<g&&C.changedTouches.length===1){const A=C.changedTouches[0],P={x:A.clientX,y:A.clientY};if(Math.sqrt(Math.pow(P.x-p.x,2)+Math.pow(P.y-p.y,2))<m){if($(s)){const _=$(s).getBoundingClientRect(),k=A.clientY,D=_.bottom;if(k>D-48)return}C.stopPropagation(),C.preventDefault();const E={x:A.clientX,y:A.clientY};Zs.set(E),cg(ei,$(c),E,e.node.attrs.src||"")}}}Ti(()=>($(s)&&($(s).addEventListener("touchstart",v,{passive:!1}),$(s).addEventListener("touchend",x,{passive:!1})),()=>{$(s)&&($(s).removeEventListener("touchstart",v),$(s).removeEventListener("touchend",x))})),rI(t,{children:(C,N)=>{var O=iZ();let A;O.__click=[eZ,l,d,s,c,e],O.__keydown=[nZ,l,c,e,s];var P=pe(O);{var S=_=>{{let k=Qe(()=>n()("videoNode.uploading"));ma(_,{get text(){return $(k)},showLoader:!0})}},E=_=>{var k=rZ();k.muted=!0;let D;k.__click=[tZ,l,d,s,c,e],k.__touchstart=v,k.__touchend=x;var U=Me(pe(k));Rn(k,B=>se(s,B),()=>$(s)),Je((B,M)=>{an(k,"src",e.node.attrs.src),D=ri(k,1,"editor-video svelte-1rna2kk",null,D,B),an(k,"data-node-id",$(c)),Ye(U,` ${M??""}`)},[()=>({loaded:$(o)}),()=>n()("videoNode.not_supported")]),Ni("loadeddata",k,u),Ni("error",k,f),we(_,k)};rt(P,_=>{$(l)?_(S):_(E,!1)})}Rn(O,_=>se(a,_),()=>$(a)),Je(_=>A=ri(O,1,"video-wrapper svelte-1rna2kk",null,A,_),[()=>({selected:e.selected})]),we(C,O)},$$slots:{default:!0}}),fn(),i()}Ci(["click","keydown","touchstart","touchend"]);const oZ=si.create({name:"video",group:"block",draggable:!1,addAttributes(){return{src:{default:null},id:{default:()=>qp()},isPlaceholder:{default:!1}}},parseHTML(){return[{tag:"video[src]"}]},renderHTML({HTMLAttributes:t}){return["video",kn(t,{controls:!0})]},addNodeView(){return nI(sZ)}});function AI(t){const e=[],n=Hy.source;return t.descendants((r,i)=>{if(!r.isText||!r.text)return;const s=r.text,o=new RegExp(n,"g");let a;for(;(a=o.exec(s))!==null;){const l=a[0].indexOf("#");if(l===-1)continue;const c=i+a.index+l,u=c+1+a[1].length;e.push({from:c,to:u,hashtag:a[1]})}}),e}function aZ(t){const e=[],n=new Set;Hy.lastIndex=0;let r;for(;(r=Hy.exec(t))!==null;){const i=r[1];i&&i.trim()&&(n.has(i)||(n.add(i),e.push(i)))}return e}function lZ(t){const e=AI(t),n=[],r=new Set;for(const i of e)r.has(i.hashtag)||(r.add(i.hashtag),n.push(i.hashtag));return n}function _I(t){Array.isArray(jo.hashtags)&&[...jo.hashtags];let e,n;typeof t=="string"?(n=t,e=aZ(n)):(e=lZ(t),n=t.textContent);const r=e.map(i=>["t",i.toLowerCase()]);jo.content=n,jo.hashtags=e,jo.tags=r}function M0(t){const e=[],n=AI(t);for(const r of n)e.push(hr.inline(r.from,r.to,{class:"hashtag"}));return Kt.create(t,e)}function cZ(t){const e=t.schema.marks.link,n=t.schema.nodes.image;if(!e)return null;let r=null;return t.doc.descendants((i,s)=>{if(!i.isText||!i.text)return;const o=i.text;(i.marks?.some(u=>u.type===e)??!1)&&(r=r||t.tr,r.removeMark(s,s+o.length,e));const l=/https?:\/\/[^\s\u3000]+/gi;let c;for(;(c=l.exec(o))!==null;){if(typeof c.index!="number")continue;const u=c.index,f=c[0],d=u>0?o[u-1]:void 0;if(!eK(d))continue;const{cleanUrl:h,actualLength:p}=nK(f),g=u+p,m=aI(h);if(m&&n){r=r||t.tr;const x=s+u,C=s+g,N=t.doc.resolve(x),O=N.parent,A=O.type.name==="paragraph"&&O.textContent.trim().length===0,P=sK(O,C-x),S=iK(t),E=n.create({src:m,alt:"Image"});if(A||P){const _=N.depth,k=N.start(_),D=N.end(_);S||t.doc.childCount===1&&P?r=r.delete(0,t.doc.content.size).insert(0,E):r=r.replaceWith(k,D,E)}else r=r.replaceWith(x,C,E);break}if(/^https?:\/\/[a-zA-Z0-9]/.test(h)&&h.length>8){const C=ag(h)||h;r=r||t.tr;const N=s+u,O=s+g,A=e.create({href:C});r.addMark(N,O,A)}}}),r!==null&&r.docChanged?r:null}const uZ=cn.create({name:"contentTracking",addProseMirrorPlugins(){return[new Vt({key:new ln("content-decoration-validation"),state:{init:(t,{doc:e})=>M0(e),apply(t,e){return M0(t.doc)}},props:{decorations(t){return M0(t.doc)}},appendTransaction:(t,e,n)=>{if(t.some(r=>r.docChanged))return cZ(n)}}),new Vt({key:new ln("content-update-tracker"),state:{init:()=>null,apply:t=>(t.docChanged&&(this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout),this.storage.updateTimeout=setTimeout(()=>{const e=t.doc.textContent;_I(t.doc),window.dispatchEvent(new CustomEvent("editor-content-changed",{detail:{plainText:e}}))},300)),null)}})]},addStorage(){return{updateTimeout:null}},onDestroy(){this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout)}});function xS(t){return t.split(/[\n ]+/).map(e=>e.trim()).filter(Boolean).map(e=>{const n=aI(e);if(n)return{url:n,type:"image"};const r=QW(e);return r?{url:r,type:"video"}:null}).filter(e=>e!==null)}function fZ(t,e){const n=e.parent;return n.type.name==="paragraph"&&n.textContent.trim().length===0}function dZ(t){const{selection:e}=t,n=t.doc.resolve(e.from);if(fZ(e,n)){const r=n.depth,i=n.start(r),s=n.end(r);return{start:i,end:s}}return null}function SS(t,e){return t.map((n,r)=>{const i=Date.now();if(n.type==="image")return e.nodes.image.create({src:n.url,alt:"Pasted image"});{const s=`pasted-video-${i}-${r}`;return e.nodes.video.create({src:n.url,id:s})}})}function AS(t){const e=t.doc;if(!e)return t;const n=[];return e.descendants((r,i)=>{if(r.type.name==="paragraph"&&r.textContent.trim().length===0){if(e.childCount===1&&e.firstChild===r)return;let s=!1;r.descendants(o=>o.type&&(o.type.name==="image"||o.type.name==="video")?(s=!0,!1):!0),s||n.push([i,i+r.nodeSize])}}),n.sort((r,i)=>i[0]-r[0]),n.forEach(([r,i])=>{t=t.delete(r,i)}),t}const hZ=cn.create({name:"imagePaste",addProseMirrorPlugins(){return[new Vt({key:new ln("image-paste"),props:{handlePaste:(t,e)=>{const n=e.clipboardData?.getData("text/plain")||"",r=xS(n);if(r.length>0){e.preventDefault();const{state:i,dispatch:s}=t,{tr:o,selection:a,schema:l}=i,c=SS(r,l);let u=o;const f=dZ(i);if(f&&c.length>0){u=u.replaceWith(f.start,f.end,c[0]);let d=f.start+c[0].nodeSize;for(let h=1;h<c.length;h++)u=u.insert(d,c[h]),d+=c[h].nodeSize}else{let d=a.from;c.forEach(h=>{u=u.insert(d,h),d+=h.nodeSize})}return u=AS(u),s(u),!0}return!1},handleTextInput:(t,e,n,r)=>{if(r.includes(`
`)||r.length>20){const i=xS(r);if(i.length>0){const{state:s,dispatch:o}=t,{tr:a,schema:l}=s,c=SS(i,l);let u=a;u=u.delete(e,n);let f=e;return c.forEach(d=>{u=u.insert(f,d),f+=d.nodeSize}),u=AS(u),o(u),!0}}return!1}}})]}}),pZ=cn.create({name:"imageDragDrop",addProseMirrorPlugins(){const t=new ln("image-drag-drop"),e=new ln("drop-zone-indicator");return[new Vt({key:t,state:{init:()=>({isDragging:!1,draggedNodePos:null,autoScrollInterval:null}),apply:(n,r)=>{const i=n.getMeta("imageDrag");return i?i.isDragging===!1&&r.autoScrollInterval?(clearInterval(r.autoScrollInterval),{...r,...i,autoScrollInterval:null}):{...r,...i}:r}},props:{handleDrop:(n,r,i,s)=>{const o=r.dataTransfer?.getData("application/x-tiptap-node");if(!s&&o)try{const a=JSON.parse(o);if(a.type==="image"){r.preventDefault();const l=n.posAtCoords({left:r.clientX,top:r.clientY});if(l&&typeof a.pos=="number")return lS(n),E0(n,a,l.pos),!0}}catch(a){console.warn("Failed to parse drag data:",a)}return!1},handleDOMEvents:{dragstart:(n,r)=>cs()?(r.preventDefault(),!0):!1,dragover:(n,r)=>cs()?(r.preventDefault(),!0):!1,drop:(n,r)=>cs()?(r.preventDefault(),!0):!1}},view:n=>{let r=null;const i=(c,u)=>{r&&(cancelAnimationFrame(r),r=null);const f=n.dom;if(!f)return;const d=f.getBoundingClientRect(),h=KE;let p=0;c==="up"?p=u-d.top:p=d.bottom-u;const g=Math.max(0,Math.min(1,p/h)),m=GE+(JU-GE)*(1-g),v=()=>{const x=f.scrollTop,C=f.scrollHeight,N=f.clientHeight;if(c==="up"&&x>0){const O=Math.max(0,x-m);f.scrollTop=O,O>0&&(r=requestAnimationFrame(v))}else if(c==="down"&&x<C-N){const O=Math.min(C-N,x+m);f.scrollTop=O,O<C-N&&(r=requestAnimationFrame(v))}};r=requestAnimationFrame(v)},s=()=>{r&&(cancelAnimationFrame(r),r=null)},o=c=>{const{nodeData:u,dropPosition:f,dropX:d,dropY:h}=c.detail;if(s(),n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null})),u&&u.type==="image"){let p;typeof f=="number"?p=f:p=n.posAtCoords({left:d,top:h})?.pos||u.pos,typeof u.pos=="number"&&E0(n,u,p)}},a=c=>{const{nodePos:u}=c.detail;n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!0,draggedNodePos:u}))},l=c=>{const{touchY:u}=c.detail;if(typeof u!="number"||!t.getState(n.state)?.isDragging)return;const d=n.dom;if(!d)return;const h=d.getBoundingClientRect(),p=KE;u<h.top+p?i("up",u):u>h.bottom-p?i("down",u):s()};return window.addEventListener("touch-image-drop",o),window.addEventListener("touch-image-drag-start",a),window.addEventListener("touch-image-drag-move",l),{destroy(){s(),window.removeEventListener("touch-image-drop",o),window.removeEventListener("touch-image-drag-start",a),window.removeEventListener("touch-image-drag-move",l)}}}}),new Vt({key:e,state:{init(){return Kt.empty},apply(n,r,i,s){if(!cs())return Kt.empty;const o=t.getState(s);if(!o?.isDragging)return Kt.empty;const a=[],l=s.doc;let c=!1;if(typeof o.draggedNodePos=="number"){const u=l.firstChild;u&&u.type.name==="image"&&u.attrs&&o.draggedNodePos===0&&(c=!0)}return c||a.push(hr.widget(0,()=>{const u=document.createElement("div");u.className="drop-zone-indicator drop-zone-top",u.setAttribute("data-drop-pos","0");const f=document.createElement("div");return f.className="drop-zone-bar",u.appendChild(f),u},{side:-1})),l.descendants((u,f)=>{if(u.type.name==="paragraph"||u.type.name==="image"){const d=f+u.nodeSize;if(typeof o.draggedNodePos=="number"&&d===o.draggedNodePos)return;o.draggedNodePos!==f&&a.push(hr.widget(d,()=>{const h=document.createElement("div");h.className="drop-zone-indicator drop-zone-between",h.setAttribute("data-drop-pos",d.toString());const p=document.createElement("div");return p.className="drop-zone-bar",h.appendChild(p),h},{side:1}))}}),Kt.create(l,a)}},props:{decorations(n){return this.getState(n)}}})]},addStorage(){return{moveImageNode:(t,e,n)=>(lS(t),E0(t,e,n))}}}),gZ=cn.create({name:"smartBackspace",addProseMirrorPlugins(){return[new Vt({key:new ln("smart-backspace"),props:{handleKeyDown(t,e){if(e.key!=="Backspace"||cs()&&document.activeElement!==t.dom)return!1;const{state:n}=t,{selection:r,doc:i}=n;if(r.empty&&r.from===1){const s=i.firstChild,o=i.childCount>1?i.child(1):null;if(s&&s.type.name==="paragraph"&&s.content.size===0&&o&&o.type.name==="image")return t.dispatch(n.tr.delete(0,s.nodeSize)),!0}return!1}}})]}}),mZ=cn.create({name:"gapCursorNewline",addProseMirrorPlugins(){return[new Vt({key:new ln("gap-cursor-newline"),props:{handleKeyDown(t,e){if(e.key!=="Enter"||cs()&&document.activeElement!==t.dom)return!1;const{state:n}=t,{selection:r,schema:i}=n;if(r.constructor.name==="GapCursor"){const l=i.nodes.paragraph.create(),c=n.tr.insert(r.from,l),u=r.from+1,f=c.doc.resolve(u),d=ft.near(f,1);return d&&c.setSelection(d),t.dispatch(c),!0}const s=n.doc.resolve(r.from),o=s.nodeBefore,a=s.nodeAfter;if(o&&o.type.name==="image"||a&&a.type.name==="image"){const l=i.nodes.paragraph.create(),c=n.tr.insert(r.from,l),u=r.from+1,f=c.doc.resolve(u),d=ft.near(f,1);if(d)return c.setSelection(d),t.dispatch(c),!0}return!1}}})]}});function kI(t,e={}){const{collapseEmptyLines:n=!1,maxConsecutiveEmptyLines:r=2}=e;let i=lI(t);if(n){const o=new RegExp(`\\n{${r+2},}`,"g");i=i.replace(o,`
`.repeat(r+1))}let s=i.split(`
`);return s.length>0&&s[s.length-1]===""&&(s=s.slice(0,-1)),s.length===1&&s[0]===""&&(s=[]),{normalized:i,lines:s}}function yZ(t){return t.join(`
`)}const bZ=cn.create({name:"clipboardExtension",addProseMirrorPlugins(){const{editor:t}=this;return[new Vt({key:new ln("clipboardExtension"),props:{handlePaste(e,n,r){const{state:i,dispatch:s}=e,{clipboardData:o}=n;if(!o||o.files&&o.files.length>0)return!1;const l=o.getData("text/plain");if(!l)return!1;const c=o.types.includes("text/html");let u=!1;if(c){const v=o.getData("text/html");if(v.includes("<strong>")||v.includes("<b>")||v.includes("<em>")||v.includes("<i>"))return!1;u=v.includes('data-block="true"')&&v.includes("data-editor=")}const{lines:f}=kI(l,{collapseEmptyLines:u,maxConsecutiveEmptyLines:1});if(f.length===0)return!1;const d=[],h=i.schema;f.forEach(v=>{const x=v.length>0?[h.text(v)]:[];d.push(h.nodes.paragraph.create(null,x))});const p=_e.from(d),g=new Ue(p,0,0),m=i.tr.replaceSelection(g);return s(m),!0},clipboardTextSerializer(e){const n=[];return e.content.forEach(r=>{if(r.type.name==="paragraph"){let i="";r.content.forEach(s=>{s.isText&&(i+=s.text||"")}),n.push(i)}else if(r.type.name==="image"){const i=r.attrs?.src;i&&n.push(i)}else if(r.type.name==="video"){const i=r.attrs?.src;i&&n.push(i)}else r.isTextblock&&n.push(r.textContent)}),yZ(n)}}})]}});function vZ(t,e){if(!t||!e)return!1;const{state:n,dispatch:r}=t.view,{lines:i}=kI(e,{collapseEmptyLines:!1,maxConsecutiveEmptyLines:2});if(i.length===0)return!1;const s=[],o=n.schema;i.forEach(f=>{const d=f.length>0?[o.text(f)]:[];s.push(o.nodes.paragraph.create(null,d))});const a=_e.from(s),l=new Ue(a,0,0);let c=n.tr.replaceSelection(l);const u=c.doc.resolve(c.selection.from);return c=c.setSelection(ft.near(u,1)),r(c),!0}function yb(t){if(!t||!t.types)return!1;try{return Array.from(t.types).some(e=>e==="application/x-tiptap-node")}catch{return!1}}function CI(t){if(!t)return!1;try{return Array.from(t.types).includes("Files")||t.files&&t.files.length>0}catch{return!!(t.files&&t.files.length>0)}}function wZ(t){let e=Se(!1);function n(s){const o=s.dataTransfer,a=yb(o);CI(o)&&!a?(s.preventDefault(),$(e)||(se(e,!0),t.classList.add("drag-over"))):$(e)&&(se(e,!1),t.classList.remove("drag-over"))}function r(s){$(e)&&(se(e,!1),t.classList.remove("drag-over"))}async function i(s){se(e,!1),t.classList.remove("drag-over");const o=s.dataTransfer;yb(o)||o?.files&&o.files.length>0&&typeof t.__uploadFiles=="function"&&(s.preventDefault(),t.__uploadFiles(o.files))}return t.addEventListener("dragover",n),t.addEventListener("dragleave",r),t.addEventListener("drop",i),{destroy(){t.removeEventListener("dragover",n),t.removeEventListener("dragleave",r),t.removeEventListener("drop",i)}}}function EZ(t,e){const n=wZ(t);function r(o){const a=o.dataTransfer,l=yb(a);CI(a)&&!l?e.dragOver(!0):e.dragOver(!1)}function i(o){e.dragOver(!1)}function s(o){e.dragOver(!1)}return t.addEventListener("dragover",r),t.addEventListener("dragleave",i),t.addEventListener("drop",s),{destroy(){n?.destroy?.(),t.removeEventListener("dragover",r),t.removeEventListener("dragleave",i),t.removeEventListener("drop",s)}}}function xZ(t){function e(n){if(!n.clipboardData)return;const r=[];for(const i of n.clipboardData.items)if(i.kind==="file"&&i.type.startsWith("image/")){const s=i.getAsFile();s&&r.push(s)}r.length>0&&(n.preventDefault(),t.__uploadFiles?.(r))}return t.addEventListener("paste",e),{destroy(){t.removeEventListener("paste",e)}}}function SZ(t){function e(r){const i=r.target;if(i&&i.closest('.editor-image-button[data-dragging="true"]')){const s=r.touches[0],o=120,a=pa.querySelector(".tiptap-editor");if(a){const l=a.getBoundingClientRect(),c=s.clientY<l.top+o,u=s.clientY>l.bottom-o;if(!c&&!u)return r.preventDefault(),!1}}}function n(r){const i=pa.querySelectorAll(".drop-zone-indicator");i.forEach(s=>{s.classList.remove("drop-zone-hover"),s.classList.add("drop-zone-fade-out")}),setTimeout(()=>{i.forEach(s=>{s.parentNode&&s.parentNode.removeChild(s)})},300)}return t.addEventListener("touchmove",e),t.addEventListener("touchend",n),{destroy(){t.removeEventListener("touchmove",e),t.removeEventListener("touchend",n)}}}function AZ(t){function e(n){if((n.ctrlKey||n.metaKey)&&(n.key==="Enter"||n.key==="NumpadEnter")){n.preventDefault();const r=t.__currentEditor,i=typeof r=="function"?r():r,s=t.__hasStoredKey,o=typeof s=="function"?s():s,a=t.__postStatus,l=typeof a=="function"?a():a,c=i?cI(i):"";!l?.sending&&c.trim()&&o&&t.__submitPost?.()}}return t.addEventListener("keydown",e),{destroy(){t.removeEventListener("keydown",e)}}}function _Z(t){let e=!1;return t?.descendants(n=>{n.type?.name==="image"&&(e=!0)}),e}function kZ(t){let e=!1;return t?.descendants(n=>{n.type?.name==="video"&&(e=!0)}),e}function CZ(t){return _Z(t)||kZ(t)}function TZ(t){const{currentEditor:e,editorContainerEl:n,callbacks:r}=t,i=a=>{const c=a.detail.plainText,u=e?CZ(e.state?.doc):!1;r.onContentUpdate?.(c,u)},s=a=>{const l=a;r.onImageFullscreenRequest?.(l.detail.src,l.detail.alt||"")},o=a=>{const c=a?.detail?.pos;if(c!=null&&!(!e||!e.view)){try{"ontouchstart"in window||navigator.maxTouchPoints>0||e.view.focus();const u=tt.create(e.state.doc,c);e.view.dispatch(e.state.tr.setSelection(u).scrollIntoView())}catch(u){console.warn("select-image-node handler failed:",u)}r.onSelectImageNode?.(c)}};return window.addEventListener("editor-content-changed",i),window.addEventListener("image-fullscreen-request",s),window.addEventListener("select-image-node",o),n&&(n.addEventListener("image-fullscreen-request",s),n.addEventListener("select-image-node",o)),{handleContentUpdate:i,handleImageFullscreenRequest:s,handleSelectImageNode:o}}function IZ(t,e){window.removeEventListener("editor-content-changed",t.handleContentUpdate),window.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),window.removeEventListener("select-image-node",t.handleSelectImageNode),e&&(e.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),e.removeEventListener("select-image-node",t.handleSelectImageNode))}function OZ(t){const{editorContainerEl:e,getCurrentEditor:n,processPastedText:r}=t;let i="",s=!1;const o=n();o&&(i=o.getText());const a=()=>{if(s)return;const l=n();if(!l)return;const c=l.getText();if(c.length-i.length>10&&c.length>i.length){const f=c.substring(i.length);if(f.includes(`
`)){s=!0,l.chain().focus().clearContent().run(),setTimeout(()=>{const d=n();if(d){const h=f.replace(/\n\n/g,`
`);r(d,h)}s=!1,setTimeout(()=>{const h=n();h&&(i=h.getText())},100)},10);return}}i=c};return e.addEventListener("input",a),()=>{e.removeEventListener("input",a)}}function MZ(t){let e=BG.configure({placeholder:t,emptyEditorClass:"is-editor-empty",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1});const n=BW({extensions:[uG.configure({paragraph:{HTMLAttributes:{class:"editor-paragraph"}}}),PG.configure({HTMLAttributes:{class:"preview-link",target:"_blank",rel:"noopener noreferrer"},autolink:!0,linkOnPaste:!0,validate:i=>!!ag(i)}),DG.configure({HTMLAttributes:{class:"editor-image"},allowBase64:!1}).extend({addAttributes(){return{src:{default:null},blurhash:{default:null},isPlaceholder:{default:!1},id:{default:()=>qp()}}},addNodeView(){return nI(KG)}}),uZ.configure({onContentChanged:i=>{_I(i);const s=new CustomEvent("editor-content-changed",{detail:{plainText:i}});window.dispatchEvent(s)}}),oZ,bZ,hZ,pZ,gZ,mZ,e],content:{type:"doc",content:[{type:"paragraph"}]},editorProps:{attributes:{class:"tiptap-editor","data-placeholder":t},handleClickOn(i,s,o,a,l,c){let u=l.target;for(;u&&u!==i.dom;){if(u.tagName==="A"&&u.hasAttribute("href")){if("ontouchstart"in window||navigator.maxTouchPoints>0){const d=i.dom;d&&d.blur(),document.body.focus()}return l.ctrlKey||l.metaKey?!1:(l.preventDefault(),!0)}u=u.parentElement}return!1},handleKeyDown:(i,s)=>(s.ctrlKey||s.metaKey)&&(s.key==="Enter"||s.key==="NumpadEnter")?(s.preventDefault(),II(),!0):!1},onCreate({editor:i}){window.__currentEditor=i;const s=i.view.dom;if(s){s.classList.add("is-editor-empty"),s.setAttribute("data-placeholder",t);const o=s.querySelector("p:first-child");o&&o.setAttribute("data-placeholder",t)}},onUpdate({editor:i}){const s=i.view.dom;if(s){const o=i.state.doc;let a=!0;o.descendants(f=>f.isText&&f.text&&f.text.trim().length>0||f.type.name==="image"||f.type.name==="video"?(a=!1,!1):!0),s.classList.contains("is-editor-empty")!==a&&(a?s.classList.add("is-editor-empty"):s.classList.remove("is-editor-empty"));const u=s.querySelector("p:first-child");if(u&&(u.classList.contains("is-editor-empty")!==a&&(a?u.classList.add("is-editor-empty"):u.classList.remove("is-editor-empty")),!u.getAttribute("data-placeholder"))){const h=s.getAttribute("data-placeholder")||t;u.setAttribute("data-placeholder",h)}}},onDestroy(){delete window.__currentEditor}}),r=i=>{const s=window.__currentEditor;if(s&&s.view){const o=s.view.dom;if(o){o.getAttribute("data-placeholder")!==i&&o.setAttribute("data-placeholder",i);const c=o.querySelector("p:first-child");c&&c.getAttribute("data-placeholder")!==i&&c.setAttribute("data-placeholder",i)}const a=s.extensionManager.extensions.find(l=>l.name==="placeholder");a&&a.options.placeholder!==i&&(a.options.placeholder=i,s.view.dispatch(s.state.tr.setMeta("addToHistory",!1)))}};return n.updatePlaceholder=r,n}let Xh=Et({value:""}),_S=Se(null);const TI={get value(){return $(_S)},set:t=>{se(_S,t,!0)}};let Qt=Et({content:"",canPost:!1,isUploading:!1,uploadErrorMessage:"",postStatus:{sending:!1,success:!1,error:!1,message:""},hasImage:!1});const kS=Et({isDragging:!1,startPos:{x:0,y:0},longPressTimeout:null,startTarget:null,preview:null}),CS=Et({justSelected:!1,justSelectedTimeout:null});function LZ(t,e){return!!t.trim()||e}function $Z(t,e=!1){Qt.content=t,Qt.hasImage=e,Qt.canPost=LZ(t,e)}function Ls(t){Qt.postStatus=t}function NZ(){Qt.content="",Qt.canPost=!1,Qt.uploadErrorMessage="",Qt.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1},Qt.hasImage=!1}function PZ(){Qt.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1}}function TS(t){Xh.value=t}let bb;function RZ(t){bb=t}async function II(){bb&&await bb()}function DZ(t){const{placeholderText:e,editorContainerEl:n,hasStoredKey:r,submitPost:i,uploadFiles:s,eventCallbacks:o}=t;Xh.value=e;const a=MZ(e);let l=null;const c=a.subscribe(d=>{l=d}),u=TZ({currentEditor:l,editorContainerEl:n,callbacks:o});RZ(i),n&&Object.assign(n,{__uploadFiles:s,__currentEditor:()=>l,__hasStoredKey:()=>r,__postStatus:()=>Qt.postStatus,__submitPost:i});let f;return n&&(f=OZ({editorContainerEl:n,getCurrentEditor:()=>l,processPastedText:vZ})),{editor:a,unsubscribe:c,handlers:u,gboardCleanup:f}}function BZ(t){const{unsubscribe:e,handlers:n,gboardCleanup:r,currentEditor:i,editorContainerEl:s}=t;IZ(n,s),r&&r(),e(),i?.destroy?.(),s&&(delete s.__uploadFiles,delete s.__currentEditor,delete s.__hasStoredKey,delete s.__postStatus,delete s.__submitPost)}function UZ(t,e,n,r,i,s,o=!1){const a=[],l=new s,c=Date.now();if(!n)return a;const u=n.state,f=u.selection,d=f instanceof tt&&f.node?.type?.name==="image";o&&console.log("[dev] insertPlaceholdersIntoEditor:",{fileCount:t.length,isImageNodeSelected:d,selectionType:f.constructor.name,selectionFrom:f.from,selectionTo:f.to,docSize:u.doc.content.size});const h=u.doc.childCount===1&&u.doc.firstChild?.type.name==="paragraph"&&u.doc.firstChild.content.size===0;let p=u.tr,g=d?f.to:f.from;return t.forEach((m,v)=>{const x=m.type.startsWith("video/"),C=l.validateMediaFile(m);if(!C.isValid){r(C.errorMessage||"postComponent.upload_failed");return}const N=`placeholder-${c}-${v}-${qp()}`,O=e[v],A=O?.ox,P=O?.dimensions;try{let S;if(x){const E={src:N,id:N,isPlaceholder:!0};S=u.schema.nodes.video.create(E)}else{const E={src:N,isPlaceholder:!0};P&&(E.dim=`${P.width}x${P.height}`,i.update(_=>({..._,[N]:P}))),S=u.schema.nodes.image.create(E)}h&&v===0?(p=p.replaceWith(0,u.doc.content.size,S),g=S.nodeSize):(p=p.insert(g,S),g+=S.nodeSize),a.push({file:m,placeholderId:N,ox:A,dimensions:P})}catch(S){o&&console.error("[uploadHelper] failed to insert media node",{placeholderId:N,file:m.name,isVideo:x,error:S,insertPos:g,docSize:u.doc.content.size}),r(x?"動画の挿入に失敗しました":"画像の挿入に失敗しました")}}),a.length>0&&n.view.dispatch(p),a}async function HZ(t,e,n,r=!1){if(Rt.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted before blurhash generation");return}const i=new n,s=t.map(async o=>{if(Rt.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted during blurhash generation");return}try{const a=await i.generateBlurhashForFile(o.file);if(Rt.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted after blurhash generation");return}a&&(o.blurhash=a,e&&Ew(e,(l,c)=>{const u=l.type?.name,f=o.file.type.startsWith("video/")&&u==="video",d=!o.file.type.startsWith("video/")&&u==="image";return(f||d)&&(l.attrs?.src===o.placeholderId||l.attrs?.id===o.placeholderId)},(l,c)=>{const u=e.state.tr.setNodeMarkup(c,void 0,{...l.attrs,blurhash:a});e.view.dispatch(u)}))}catch(a){r&&console.warn("[uploadHelper] blurhash generation failed",{file:o.file.name,error:a})}});await Promise.all(s)}async function FZ(t,e,n,r,i,s,o,a,l,c,u=!1){const f=[],d={};let h="";const p=[...e];for(let g=0;g<t.length;g++){const m=t[g];if(u&&console.log("[uploadHelper] Processing result",g,":",{success:m.success,url:m.url,filename:m.filename,sizeInfo:m.sizeInfo,aborted:m.aborted}),m.aborted){const v=p.shift();if(v){const x=v.file.type.startsWith("video/");x0(v.placeholderId,x,n,s,u)}continue}if(m.success&&m.url){let v,x=-1;if(m.sizeInfo&&m.sizeInfo.originalFilename&&(x=p.findIndex(C=>C.file.name===m.sizeInfo.originalFilename),x!==-1&&(v=p[x])),!v&&p.length>0&&(v=p[0],x=0),v&&x!==-1&&n){p.splice(x,1);const C=v.file.type.startsWith("video/");if(u&&console.log("[uploadHelper] Replacing placeholder",{placeholderId:v.placeholderId,url:m.url,isVideo:C}),Ew(n,(N,O)=>{const A=N.type?.name;return(C&&A==="video"||!C&&A==="image")&&(N.attrs?.src===v.placeholderId||N.attrs?.id===v.placeholderId)},(N,O)=>{if(C){const A={...N.attrs,src:m.url,id:m.url,isPlaceholder:!1},P=n.state.tr.setNodeMarkup(O,void 0,A);n.view.dispatch(P)}else{const A={...N.attrs,src:m.url,isPlaceholder:!1,blurhash:v.blurhash??void 0};v.dimensions&&(A.dim=`${v.dimensions.width}x${v.dimensions.height}`);const P=n.state.tr.setNodeMarkup(O,void 0,A);n.view.dispatch(P),s.update(S=>{const E={...S};return delete E[v.placeholderId],v.dimensions&&(E[m.url]=v.dimensions),E})}}),!C){const N=m.nip94||{},O=N.blurhash??N.b??void 0;O&&m.url&&(d[m.url]=O);const A=N.ox??N.o??void 0,P=N.x??void 0;if(A&&m.url?r[m.url]=A:v.ox&&m.url&&(r[m.url]=v.ox),m.url)if(P)i[m.url]=P;else try{const S=await l(m.url);S&&(i[m.url]=S)}catch(S){u&&console.warn("[uploadHelper] failed to calculate x hash (fallback)",{url:m.url,error:S})}}}}else if(!m.success){f.push(m);const v=p.shift();if(v){const x=v.file.type.startsWith("video/");x0(v.placeholderId,x,n,s,u)}}}for(const g of p){const m=g.file.type.startsWith("video/");x0(g.placeholderId,m,n,s,u)}return f.length&&(h=f.length===1?f[0].error||"postComponent.upload_failed":`${f.length}個のファイルのアップロードに失敗しました`),{failedResults:f,errorMessage:h,imageServerBlurhashMap:d}}class zZ{allowedOrigins;console;windowObj;constructor(e={}){this.allowedOrigins=e.allowedOrigins||[],this.console=e.console||(typeof console<"u"?console:{log:()=>{},warn:()=>{},error:()=>{}}),this.windowObj=e.window||(typeof window<"u"?window:void 0)}isInIframe(){if(!this.windowObj)return!1;try{return this.windowObj.self!==this.windowObj.top}catch{return!0}}getParentOrigin(){if(!this.windowObj||!this.isInIframe())return null;try{return this.windowObj.parent.location.origin}catch{if(this.windowObj.document&&this.windowObj.document.referrer)try{return new URL(this.windowObj.document.referrer).origin}catch(n){return this.console.warn("親ウィンドウのオリジンを取得できませんでした:",n),null}return null}}isOriginAllowed(e){return e?this.allowedOrigins.length===0?!0:this.allowedOrigins.includes(e):!1}sendMessageToParent(e){if(!this.windowObj||!this.isInIframe())return!1;const n=this.getParentOrigin();if(!n)return this.console.warn("親ウィンドウのオリジンを特定できないため、postMessageを送信できません"),!1;if(!this.isOriginAllowed(n))return this.console.warn(`親ウィンドウのオリジン ${n} は許可されていません`),!1;try{return this.windowObj.parent.postMessage(e,n),this.console.log(`親ウィンドウ (${n}) にメッセージを送信しました:`,e),!0}catch(r){return this.console.error("postMessageの送信に失敗しました:",r),!1}}notifyPostSuccess(){return this.sendMessageToParent({type:"POST_SUCCESS",timestamp:Date.now()})}notifyPostError(e){return this.sendMessageToParent({type:"POST_ERROR",timestamp:Date.now(),error:e})}setAllowedOrigins(e){this.allowedOrigins=e}addAllowedOrigin(e){this.allowedOrigins.includes(e)||this.allowedOrigins.push(e)}}const jZ=new zZ;class VZ{static validatePost(e,n,r){return e.trim()?r?n?{valid:!0}:{valid:!1,error:"login_required"}:{valid:!1,error:"nostr_not_ready"}:{valid:!1,error:"empty_content"}}}class IS{static async buildEvent(e,n,r,i,s,o,a){const l=Array.isArray(r)&&r.length?[...r]:Array.isArray(n)?n.map(u=>["t",u.toLowerCase()]):[];if(a){const u=a();u&&l.push(u)}if(s&&o){for(const[u,f]of Object.entries(s))if(u&&f&&f.m){const d=await o({url:u,...f});l.push(d)}}const c={kind:1,content:e,tags:l,created_at:Math.floor(Date.now()/1e3)};return i&&(c.pubkey=i),c}}class qZ{constructor(e,n){this.rxNostr=e,this.console=n}sendEvent(e,n){return new Promise(r=>{let i=!1,s=!1,o=null;const a=()=>{try{o?.unsubscribe()}catch{}},l={next:c=>{this.console.log(`リレー ${c.from} への送信結果:`,c.ok?"成功":"失敗"),c.ok&&!i&&(s=!0,i=!0,a(),r({success:!0}))},error:c=>{this.console.error("送信エラー:",c),i||(i=!0,a(),r({success:!1,error:"post_error"}))},complete:()=>{!i&&!s&&(i=!0,a(),r({success:!1,error:"post_error"}))}};o=this.rxNostr.send(e,n?{signer:n}:void 0).subscribe(l),setTimeout(()=>{i||(i=!0,a(),r(s?{success:!0}:{success:!1,error:"post_error"}))},1e4)})}}class WZ{constructor(e,n={}){this.deps=n,e&&this.setRxNostr(e),this.deps.console=n.console||(typeof window<"u"?window.console:{}),this.deps.createImetaTagFn=n.createImetaTagFn||aC,this.deps.getClientTagFn=n.getClientTagFn||GW,this.deps.seckeySignerFn=n.seckeySignerFn||gy,this.deps.extractContentWithImagesFn=n.extractContentWithImagesFn||cI,this.deps.extractImageBlurhashMapFn=n.extractImageBlurhashMapFn||lC,this.deps.resetEditorStateFn=n.resetEditorStateFn||NZ,this.deps.resetPostStatusFn=n.resetPostStatusFn||PZ,this.deps.iframeMessageService=n.iframeMessageService||jZ}rxNostr=null;eventSender=null;setRxNostr(e){this.rxNostr=e,this.eventSender=new qZ(e,this.deps.console||console)}validatePost(e){const n=this.deps.authStateStore||{value:$i.value};return VZ.validatePost(e,n.value.isAuthenticated,!!this.rxNostr)}async submitPost(e,n){const r=this.validatePost(e);if(!r.valid)return this.deps.iframeMessageService?.notifyPostError(r.error),{success:!1,error:r.error};if(!this.eventSender)return this.deps.iframeMessageService?.notifyPostError("nostr_not_ready"),{success:!1,error:"nostr_not_ready"};try{const i=this.deps.authStateStore||{value:$i.value},s=this.deps.hashtagStore||jo,{hashtags:o,tags:a}=this.getHashtagArrays(s),l=this.deps.keyManager||ab,c=this.deps.window||(typeof window<"u"?window:void 0),u=i.value;if(u.type==="nostr-login"&&l.isWindowNostrAvailable()&&c?.nostr)try{const m=u.pubkey;if(!m)return this.deps.iframeMessageService?.notifyPostError("pubkey_not_found"),{success:!1,error:"pubkey_not_found"};const v=await IS.buildEvent(e,o,a,m,n,this.deps.createImetaTagFn,this.deps.getClientTagFn);if(typeof c.nostr.signEvent=="function"){const x=await c.nostr.signEvent(v);this.deps.console?.log("署名済みイベント:",x);const C=await this.eventSender.sendEvent(x);return C.success?this.deps.iframeMessageService?.notifyPostSuccess():this.deps.iframeMessageService?.notifyPostError(C.error),C}else return this.deps.iframeMessageService?.notifyPostError("nostr_sign_event_not_supported"),{success:!1,error:"nostr_sign_event_not_supported"}}catch(m){return this.deps.console?.error("window.nostrでの投稿エラー:",m),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}const d=l.getFromStore()||l.loadFromStorage();if(!d)return this.deps.iframeMessageService?.notifyPostError("key_not_found"),{success:!1,error:"key_not_found"};const h=await IS.buildEvent(e,o,a,void 0,n,this.deps.createImetaTagFn,this.deps.getClientTagFn),p=this.deps.seckeySignerFn?this.deps.seckeySignerFn(d):gy(d),g=await this.eventSender.sendEvent(h,p);return g.success?this.deps.iframeMessageService?.notifyPostSuccess():this.deps.iframeMessageService?.notifyPostError(g.error),g}catch(i){return this.deps.console?.error("投稿エラー:",i),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}}getEventSender(){return this.eventSender}getHashtagArrays(e){const n=e||jo,r=this.deps.hashtagSnapshotFn;if(r){const i=r(n);return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}if(n===jo)try{const i=KW();return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}catch(i){this.deps.console?.warn("hashtag_snapshot_failed",i)}return{hashtags:Array.isArray(n?.hashtags)?[...n.hashtags]:[],tags:Array.isArray(n?.tags)?n.tags.map(i=>[...i]):[]}}preparePostContent(e){return this.deps.extractContentWithImagesFn(e)||""}prepareImageBlurhashMap(e,n,r){const i=this.deps.extractImageBlurhashMapFn(e),s={};for(const[o,a]of Object.entries(i))s[o]={m:cC(o),blurhash:a,ox:n[o],x:r[o]};return s}async performPostSubmission(e,n,r,i,s,o){const a=this.preparePostContent(e),l=this.prepareImageBlurhashMap(e,n,r);i?.();try{const c=await this.submitPost(a,l);c.success?s?.():o?.(c.error||"post_error")}catch{o?.("post_error")}}applyEmptyStateToEditor(e){e.chain().clearContent().run();const n=e.view.dom;if(!n)return;n.classList.add("is-editor-empty");const r=n.querySelectorAll("p"),i=n.getAttribute("data-placeholder")||"テキストを入力してください";r.forEach((s,o)=>{const a=s;o===0?a.classList.add("is-editor-empty"):a.classList.remove("is-editor-empty"),a.setAttribute("data-placeholder",i)})}resetPostContent(e){this.applyEmptyStateToEditor(e),this.deps.resetEditorStateFn?.(),this.deps.resetPostStatusFn?.()}clearContentAfterSuccess(e){this.applyEmptyStateToEditor(e)}}function KZ(t,e){return e.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}}))})),Object.freeze(t)}function OI(t,e){return new Promise((function(n,r){let i;return GZ(t).then((function(s){try{return i=s,n(new Blob([e.slice(0,2),i,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}}),r)}))}const GZ=t=>new Promise(((e,n)=>{const r=new FileReader;r.addEventListener("load",(({target:{result:i}})=>{const s=new DataView(i);let o=0;if(s.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=s.getUint16(o);if(a===65498)break;const l=s.getUint16(o+2);if(a===65505&&s.getUint32(o+4)===1165519206){const c=o+10;let u;switch(s.getUint16(c)){case 18761:u=!0;break;case 19789:u=!1;break;default:return n("TIFF header contains invalid endian")}if(s.getUint16(c+2,u)!==42)return n("TIFF header contains invalid version");const f=s.getUint32(c+4,u),d=c+f+2+12*s.getUint16(c+f,u);for(let h=c+f+2;h<d;h+=12)if(s.getUint16(h,u)==274){if(s.getUint16(h+2,u)!==3)return n("Orientation data type is invalid");if(s.getUint32(h+4,u)!==1)return n("Orientation data count is invalid");s.setUint16(h+8,1,u);break}return e(i.slice(o,o+2+l))}o+=2+l}return e(new Blob)})),r.readAsArrayBuffer(t)}));var Qh={},ZZ={get exports(){return Qh},set exports(t){Qh=t}};(function(t){var e,n,r={};ZZ.exports=r,r.parse=function(i,s){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,c={},u=new Uint8Array(i),f=u.length-4;a(u,f)!=101010256;)f--;l=f,l+=4;var d=o(u,l+=4);o(u,l+=2);var h=a(u,l+=2),p=a(u,l+=4);l+=4,l=p;for(var g=0;g<d;g++){a(u,l),l+=4,l+=4,l+=4,a(u,l+=4),h=a(u,l+=4);var m=a(u,l+=4),v=o(u,l+=4),x=o(u,l+2),C=o(u,l+4);l+=6;var N=a(u,l+=8);l+=4,l+=v+x+C,r._readLocal(u,N,c,h,m,s)}return c},r._readLocal=function(i,s,o,a,l,c){var u=r.bin.readUshort,f=r.bin.readUint;f(i,s),u(i,s+=4),u(i,s+=2);var d=u(i,s+=2);f(i,s+=2),f(i,s+=4),s+=4;var h=u(i,s+=8),p=u(i,s+=2);s+=2;var g=r.bin.readUTF8(i,s,h);if(s+=h,s+=p,c)o[g]={size:l,csize:a};else{var m=new Uint8Array(i.buffer,s);if(d==0)o[g]=new Uint8Array(m.buffer.slice(s,s+a));else{if(d!=8)throw"unknown compression method: "+d;var v=new Uint8Array(l);r.inflateRaw(m,v),o[g]=v}}},r.inflateRaw=function(i,s){return r.F.inflate(i,s)},r.inflate=function(i,s){return i[0],i[1],r.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-6),s)},r.deflate=function(i,s){s==null&&(s={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*i.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(i,a,o,s.level);var l=r.adler(i,0,i.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(i,s){s==null&&(s={level:6});var o=new Uint8Array(50+Math.floor(1.1*i.length)),a=r.F.deflateRaw(i,o,a,s.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(i,s){s==null&&(s=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,c={};for(var u in i){var f=!r._noNeed(u)&&!s,d=i[u],h=r.crc.crc(d,0,d.length);c[u]={cpr:f,usize:d.length,crc:h,file:f?r.deflateRaw(d):d}}for(var u in c)o+=c[u].file.length+30+46+2*r.bin.sizeUTF8(u);o+=22;var p=new Uint8Array(o),g=0,m=[];for(var u in c){var v=c[u];m.push(g),g=r._writeHeader(p,g,u,v,0)}var x=0,C=g;for(var u in c)v=c[u],m.push(g),g=r._writeHeader(p,g,u,v,1,m[x++]);var N=g-C;return a(p,g,101010256),g+=4,l(p,g+=4,x),l(p,g+=2,x),a(p,g+=2,N),a(p,g+=4,C),g+=4,g+=2,p.buffer},r._noNeed=function(i){var s=i.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(s)!=-1},r._writeHeader=function(i,s,o,a,l,c){var u=r.bin.writeUint,f=r.bin.writeUshort,d=a.file;return u(i,s,l==0?67324752:33639248),s+=4,l==1&&(s+=2),f(i,s,20),f(i,s+=2,0),f(i,s+=2,a.cpr?8:0),u(i,s+=2,0),u(i,s+=4,a.crc),u(i,s+=4,d.length),u(i,s+=4,a.usize),f(i,s+=4,r.bin.sizeUTF8(o)),f(i,s+=2,0),s+=2,l==1&&(s+=2,s+=2,u(i,s+=6,c),s+=4),s+=r.bin.writeUTF8(i,s,o),l==0&&(i.set(d,s),s+=d.length),s},r.crc={table:(function(){for(var i=new Uint32Array(256),s=0;s<256;s++){for(var o=s,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;i[s]=o}return i})(),update:function(i,s,o,a){for(var l=0;l<a;l++)i=r.crc.table[255&(i^s[o+l])]^i>>>8;return i},crc:function(i,s,o){return 4294967295^r.crc.update(4294967295,i,s,o)}},r.adler=function(i,s,o){for(var a=1,l=0,c=s,u=s+o;c<u;){for(var f=Math.min(c+5552,u);c<f;)l+=a+=i[c++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(i,s){return i[s]|i[s+1]<<8},writeUshort:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255},readUint:function(i,s){return 16777216*i[s+3]+(i[s+2]<<16|i[s+1]<<8|i[s])},writeUint:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255,i[s+2]=o>>16&255,i[s+3]=o>>24&255},readASCII:function(i,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(i[s+l]);return a},writeASCII:function(i,s,o){for(var a=0;a<o.length;a++)i[s+a]=o.charCodeAt(a)},pad:function(i){return i.length<2?"0"+i:i},readUTF8:function(i,s,o){for(var a,l="",c=0;c<o;c++)l+="%"+r.bin.pad(i[s+c].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(i,s,o)}return a},writeUTF8:function(i,s,o){for(var a=o.length,l=0,c=0;c<a;c++){var u=o.charCodeAt(c);if((4294967168&u)==0)i[s+l]=u,l++;else if((4294965248&u)==0)i[s+l]=192|u>>6,i[s+l+1]=128|u>>0&63,l+=2;else if((4294901760&u)==0)i[s+l]=224|u>>12,i[s+l+1]=128|u>>6&63,i[s+l+2]=128|u>>0&63,l+=3;else{if((4292870144&u)!=0)throw"e";i[s+l]=240|u>>18,i[s+l+1]=128|u>>12&63,i[s+l+2]=128|u>>6&63,i[s+l+3]=128|u>>0&63,l+=4}}return l},sizeUTF8:function(i){for(var s=i.length,o=0,a=0;a<s;a++){var l=i.charCodeAt(a);if((4294967168&l)==0)o++;else if((4294965248&l)==0)o+=2;else if((4294901760&l)==0)o+=3;else{if((4292870144&l)!=0)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(i,s,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],c=r.F.U,u=r.F._goodIndex;r.F._hash;var f=r.F._putsE,d=0,h=o<<3,p=0,g=i.length;if(a==0){for(;d<g;)f(s,h,d+(k=Math.min(65535,g-d))==g?1:0),h=r.F._copyExact(i,d,k,s,h+8),d+=k;return h>>>3}var m=c.lits,v=c.strt,x=c.prev,C=0,N=0,O=0,A=0,P=0,S=0;for(g>2&&(v[S=r.F._hash(i,0)]=0),d=0;d<g;d++){if(P=S,d+1<g-2){S=r.F._hash(i,d+1);var E=d+1&32767;x[E]=v[S],v[S]=E}if(p<=d){(C>14e3||N>26697)&&g-d>100&&(p<d&&(m[C]=d-p,C+=2,p=d),h=r.F._writeBlock(d==g-1||p==g?1:0,m,C,A,i,O,d-O,s,h),C=N=A=0,O=d);var _=0;d<g-2&&(_=r.F._bestMatch(i,d,x,P,Math.min(l[2],g-d),l[3]));var k=_>>>16,D=65535&_;if(_!=0){D=65535&_;var U=u(k=_>>>16,c.of0);c.lhst[257+U]++;var B=u(D,c.df0);c.dhst[B]++,A+=c.exb[U]+c.dxb[B],m[C]=k<<23|d-p,m[C+1]=D<<16|U<<8|B,C+=2,p=d+k}else c.lhst[i[d]]++;N++}}for(O==d&&i.length!=0||(p<d&&(m[C]=d-p,C+=2,p=d),h=r.F._writeBlock(1,m,C,A,i,O,d-O,s,h),C=0,N=0,C=N=A=0,O=d);(7&h)!=0;)h++;return h>>>3},r.F._bestMatch=function(i,s,o,a,l,c){var u=32767&s,f=o[u],d=u-f+32768&32767;if(f==u||a!=r.F._hash(i,s-d))return 0;for(var h=0,p=0,g=Math.min(32767,s);d<=g&&--c!=0&&f!=u;){if(h==0||i[s+h]==i[s+h-d]){var m=r.F._howLong(i,s,d);if(m>h){if(p=d,(h=m)>=l)break;d+2<m&&(m=d+2);for(var v=0,x=0;x<m-2;x++){var C=s-d+x+32768&32767,N=C-o[C]+32768&32767;N>v&&(v=N,f=C)}}}d+=(u=f)-(f=o[u])+32768&32767}return h<<16|p},r.F._howLong=function(i,s,o){if(i[s]!=i[s-o]||i[s+1]!=i[s+1-o]||i[s+2]!=i[s+2-o])return 0;var a=s,l=Math.min(i.length,s+258);for(s+=3;s<l&&i[s]==i[s-o];)s++;return s-a},r.F._hash=function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(i,s,o,a,l,c,u,f,d){var h,p,g,m,v,x,C,N,O,A=r.F.U,P=r.F._putsF,S=r.F._putsE;A.lhst[256]++,p=(h=r.F.getTrees())[0],g=h[1],m=h[2],v=h[3],x=h[4],C=h[5],N=h[6],O=h[7];var E=32+((d+3&7)==0?0:8-(d+3&7))+(u<<3),_=a+r.F.contSize(A.fltree,A.lhst)+r.F.contSize(A.fdtree,A.dhst),k=a+r.F.contSize(A.ltree,A.lhst)+r.F.contSize(A.dtree,A.dhst);k+=14+3*C+r.F.contSize(A.itree,A.ihst)+(2*A.ihst[16]+3*A.ihst[17]+7*A.ihst[18]);for(var D=0;D<286;D++)A.lhst[D]=0;for(D=0;D<30;D++)A.dhst[D]=0;for(D=0;D<19;D++)A.ihst[D]=0;var U=E<_&&E<k?0:_<k?1:2;if(P(f,d,i),P(f,d+1,U),d+=3,U==0){for(;(7&d)!=0;)d++;d=r.F._copyExact(l,c,u,f,d)}else{var B,M;if(U==1&&(B=A.fltree,M=A.fdtree),U==2){r.F.makeCodes(A.ltree,p),r.F.revCodes(A.ltree,p),r.F.makeCodes(A.dtree,g),r.F.revCodes(A.dtree,g),r.F.makeCodes(A.itree,m),r.F.revCodes(A.itree,m),B=A.ltree,M=A.dtree,S(f,d,v-257),S(f,d+=5,x-1),S(f,d+=5,C-4),d+=4;for(var T=0;T<C;T++)S(f,d+3*T,A.itree[1+(A.ordr[T]<<1)]);d+=3*C,d=r.F._codeTiny(N,A.itree,f,d),d=r.F._codeTiny(O,A.itree,f,d)}for(var L=c,q=0;q<o;q+=2){for(var F=s[q],j=F>>>23,Z=L+(8388607&F);L<Z;)d=r.F._writeLit(l[L++],B,f,d);if(j!=0){var J=s[q+1],ue=J>>16,ae=J>>8&255,X=255&J;S(f,d=r.F._writeLit(257+ae,B,f,d),j-A.of0[ae]),d+=A.exb[ae],P(f,d=r.F._writeLit(X,M,f,d),ue-A.df0[X]),d+=A.dxb[X],L+=j}}d=r.F._writeLit(256,B,f,d)}return d},r.F._copyExact=function(i,s,o,a,l){var c=l>>>3;return a[c]=o,a[c+1]=o>>>8,a[c+2]=255-a[c],a[c+3]=255-a[c+1],c+=4,a.set(new Uint8Array(i.buffer,s,o),c),l+(o+4<<3)},r.F.getTrees=function(){for(var i=r.F.U,s=r.F._hufTree(i.lhst,i.ltree,15),o=r.F._hufTree(i.dhst,i.dtree,15),a=[],l=r.F._lenCodes(i.ltree,a),c=[],u=r.F._lenCodes(i.dtree,c),f=0;f<a.length;f+=2)i.ihst[a[f]]++;for(f=0;f<c.length;f+=2)i.ihst[c[f]]++;for(var d=r.F._hufTree(i.ihst,i.itree,7),h=19;h>4&&i.itree[1+(i.ordr[h-1]<<1)]==0;)h--;return[s,o,d,l,u,h,a,c]},r.F.getSecond=function(i){for(var s=[],o=0;o<i.length;o+=2)s.push(i[o+1]);return s},r.F.nonZero=function(i){for(var s="",o=0;o<i.length;o+=2)i[o+1]!=0&&(s+=(o>>1)+",");return s},r.F.contSize=function(i,s){for(var o=0,a=0;a<s.length;a++)o+=s[a]*i[1+(a<<1)];return o},r.F._codeTiny=function(i,s,o,a){for(var l=0;l<i.length;l+=2){var c=i[l],u=i[l+1];a=r.F._writeLit(c,s,o,a);var f=c==16?2:c==17?3:7;c>15&&(r.F._putsE(o,a,u,f),a+=f)}return a},r.F._lenCodes=function(i,s){for(var o=i.length;o!=2&&i[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=i[a+1],c=a+3<o?i[a+3]:-1,u=a+5<o?i[a+5]:-1,f=a==0?-1:i[a-1];if(l==0&&c==l&&u==l){for(var d=a+5;d+2<o&&i[d+2]==l;)d+=2;(h=Math.min(d+1-a>>>1,138))<11?s.push(17,h-3):s.push(18,h-11),a+=2*h-2}else if(l==f&&c==l&&u==l){for(d=a+5;d+2<o&&i[d+2]==l;)d+=2;var h=Math.min(d+1-a>>>1,6);s.push(16,h-3),a+=2*h-2}else s.push(l,0)}return o>>>1},r.F._hufTree=function(i,s,o){var a=[],l=i.length,c=s.length,u=0;for(u=0;u<c;u+=2)s[u]=0,s[u+1]=0;for(u=0;u<l;u++)i[u]!=0&&a.push({lit:u,f:i[u]});var f=a.length,d=a.slice(0);if(f==0)return 0;if(f==1){var h=a[0].lit;return d=h==0?1:0,s[1+(h<<1)]=1,s[1+(d<<1)]=1,1}a.sort((function(N,O){return N.f-O.f}));var p=a[0],g=a[1],m=0,v=1,x=2;for(a[0]={lit:-1,f:p.f+g.f,l:p,r:g,d:0};v!=f-1;)p=m!=v&&(x==f||a[m].f<a[x].f)?a[m++]:a[x++],g=m!=v&&(x==f||a[m].f<a[x].f)?a[m++]:a[x++],a[v++]={lit:-1,f:p.f+g.f,l:p,r:g};var C=r.F.setDepth(a[v-1],0);for(C>o&&(r.F.restrictDepth(d,o,C),C=o),u=0;u<f;u++)s[1+(d[u].lit<<1)]=d[u].d;return C},r.F.setDepth=function(i,s){return i.lit!=-1?(i.d=s,s):Math.max(r.F.setDepth(i.l,s+1),r.F.setDepth(i.r,s+1))},r.F.restrictDepth=function(i,s,o){var a=0,l=1<<o-s,c=0;for(i.sort((function(f,d){return d.d==f.d?f.f-d.f:d.d-f.d})),a=0;a<i.length&&i[a].d>s;a++){var u=i[a].d;i[a].d=s,c+=l-(1<<o-u)}for(c>>>=o-s;c>0;)(u=i[a].d)<s?(i[a].d++,c-=1<<s-u-1):a++;for(;a>=0;a--)i[a].d==s&&c<0&&(i[a].d--,c++);c!=0&&console.log("debt left")},r.F._goodIndex=function(i,s){var o=0;return s[16|o]<=i&&(o|=16),s[8|o]<=i&&(o|=8),s[4|o]<=i&&(o|=4),s[2|o]<=i&&(o|=2),s[1|o]<=i&&(o|=1),o},r.F._writeLit=function(i,s,o,a){return r.F._putsF(o,a,s[i<<1]),a+s[1+(i<<1)]},r.F.inflate=function(i,s){var o=Uint8Array;if(i[0]==3&&i[1]==0)return s||new o(0);var a=r.F,l=a._bitsF,c=a._bitsE,u=a._decodeTiny,f=a.makeCodes,d=a.codes2map,h=a._get17,p=a.U,g=s==null;g&&(s=new o(i.length>>>2<<3));for(var m,v,x=0,C=0,N=0,O=0,A=0,P=0,S=0,E=0,_=0;x==0;)if(x=l(i,_,1),C=l(i,_+1,2),_+=3,C!=0){if(g&&(s=r.F._check(s,E+(1<<17))),C==1&&(m=p.flmap,v=p.fdmap,P=511,S=31),C==2){N=c(i,_,5)+257,O=c(i,_+5,5)+1,A=c(i,_+10,4)+4,_+=14;for(var k=0;k<38;k+=2)p.itree[k]=0,p.itree[k+1]=0;var D=1;for(k=0;k<A;k++){var U=c(i,_+3*k,3);p.itree[1+(p.ordr[k]<<1)]=U,U>D&&(D=U)}_+=3*A,f(p.itree,D),d(p.itree,D,p.imap),m=p.lmap,v=p.dmap,_=u(p.imap,(1<<D)-1,N+O,i,_,p.ttree);var B=a._copyOut(p.ttree,0,N,p.ltree);P=(1<<B)-1;var M=a._copyOut(p.ttree,N,O,p.dtree);S=(1<<M)-1,f(p.ltree,B),d(p.ltree,B,m),f(p.dtree,M),d(p.dtree,M,v)}for(;;){var T=m[h(i,_)&P];_+=15&T;var L=T>>>4;if(!(L>>>8))s[E++]=L;else{if(L==256)break;var q=E+L-254;if(L>264){var F=p.ldef[L-257];q=E+(F>>>3)+c(i,_,7&F),_+=7&F}var j=v[h(i,_)&S];_+=15&j;var Z=j>>>4,J=p.ddef[Z],ue=(J>>>4)+l(i,_,15&J);for(_+=15&J,g&&(s=r.F._check(s,E+(1<<17)));E<q;)s[E]=s[E++-ue],s[E]=s[E++-ue],s[E]=s[E++-ue],s[E]=s[E++-ue];E=q}}}else{(7&_)!=0&&(_+=8-(7&_));var ae=4+(_>>>3),X=i[ae-4]|i[ae-3]<<8;g&&(s=r.F._check(s,E+X)),s.set(new o(i.buffer,i.byteOffset+ae,X),E),_=ae+X<<3,E+=X}return s.length==E?s:s.slice(0,E)},r.F._check=function(i,s){var o=i.length;if(s<=o)return i;var a=new Uint8Array(Math.max(o<<1,s));return a.set(i,0),a},r.F._decodeTiny=function(i,s,o,a,l,c){for(var u=r.F._bitsE,f=r.F._get17,d=0;d<o;){var h=i[f(a,l)&s];l+=15&h;var p=h>>>4;if(p<=15)c[d]=p,d++;else{var g=0,m=0;p==16?(m=3+u(a,l,2),l+=2,g=c[d-1]):p==17?(m=3+u(a,l,3),l+=3):p==18&&(m=11+u(a,l,7),l+=7);for(var v=d+m;d<v;)c[d]=g,d++}}return l},r.F._copyOut=function(i,s,o,a){for(var l=0,c=0,u=a.length>>>1;c<o;){var f=i[c+s];a[c<<1]=0,a[1+(c<<1)]=f,f>l&&(l=f),c++}for(;c<u;)a[c<<1]=0,a[1+(c<<1)]=0,c++;return l},r.F.makeCodes=function(i,s){for(var o,a,l,c,u=r.F.U,f=i.length,d=u.bl_count,h=0;h<=s;h++)d[h]=0;for(h=1;h<f;h+=2)d[i[h]]++;var p=u.next_code;for(o=0,d[0]=0,a=1;a<=s;a++)o=o+d[a-1]<<1,p[a]=o;for(l=0;l<f;l+=2)(c=i[l+1])!=0&&(i[l]=p[c],p[c]++)},r.F.codes2map=function(i,s,o){for(var a=i.length,l=r.F.U.rev15,c=0;c<a;c+=2)if(i[c+1]!=0)for(var u=c>>1,f=i[c+1],d=u<<4|f,h=s-f,p=i[c]<<h,g=p+(1<<h);p!=g;)o[l[p]>>>15-s]=d,p++},r.F.revCodes=function(i,s){for(var o=r.F.U.rev15,a=15-s,l=0;l<i.length;l+=2){var c=i[l]<<s-i[l+1];i[l]=o[c]>>>a}},r.F._putsE=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8},r.F._putsF=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8,i[a+2]|=o>>>16},r.F._bitsE=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8)>>>(7&s)&(1<<o)-1},r.F._bitsF=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)&(1<<o)-1},r.F._get17=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)},r.F._get25=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16|i[3+(s>>>3)]<<24)>>>(7&s)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),(function(){for(var i=r.F.U,s=0;s<32768;s++){var o=s;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,i.rev15[s]=(o>>>16|o<<16)>>>17}function a(l,c,u){for(;c--!=0;)l.push(0,u)}for(s=0;s<32;s++)i.ldef[s]=i.of0[s]<<3|i.exb[s],i.ddef[s]=i.df0[s]<<4|i.dxb[s];a(i.fltree,144,8),a(i.fltree,112,9),a(i.fltree,24,7),a(i.fltree,8,8),r.F.makeCodes(i.fltree,9),r.F.codes2map(i.fltree,9,i.flmap),r.F.revCodes(i.fltree,9),a(i.fdtree,32,5),r.F.makeCodes(i.fdtree,5),r.F.codes2map(i.fdtree,5,i.fdmap),r.F.revCodes(i.fdtree,5),a(i.itree,19,0),a(i.ltree,286,0),a(i.dtree,30,0),a(i.ttree,320,0)})()})();var YZ=KZ({__proto__:null,default:Qh},[Qh]);const Li=(function(){var t={nextZero(u,f){for(;u[f]!=0;)f++;return f},readUshort:(u,f)=>u[f]<<8|u[f+1],writeUshort(u,f,d){u[f]=d>>8&255,u[f+1]=255&d},readUint:(u,f)=>16777216*u[f]+(u[f+1]<<16|u[f+2]<<8|u[f+3]),writeUint(u,f,d){u[f]=d>>24&255,u[f+1]=d>>16&255,u[f+2]=d>>8&255,u[f+3]=255&d},readASCII(u,f,d){let h="";for(let p=0;p<d;p++)h+=String.fromCharCode(u[f+p]);return h},writeASCII(u,f,d){for(let h=0;h<d.length;h++)u[f+h]=d.charCodeAt(h)},readBytes(u,f,d){const h=[];for(let p=0;p<d;p++)h.push(u[f+p]);return h},pad:u=>u.length<2?`0${u}`:u,readUTF8(u,f,d){let h,p="";for(let g=0;g<d;g++)p+=`%${t.pad(u[f+g].toString(16))}`;try{h=decodeURIComponent(p)}catch{return t.readASCII(u,f,d)}return h}};function e(u,f,d,h){const p=f*d,g=s(h),m=Math.ceil(f*g/8),v=new Uint8Array(4*p),x=new Uint32Array(v.buffer),{ctype:C}=h,{depth:N}=h,O=t.readUshort;if(C==6){const F=p<<2;if(N==8)for(var A=0;A<F;A+=4)v[A]=u[A],v[A+1]=u[A+1],v[A+2]=u[A+2],v[A+3]=u[A+3];if(N==16)for(A=0;A<F;A++)v[A]=u[A<<1]}else if(C==2){const F=h.tabs.tRNS;if(F==null){if(N==8)for(A=0;A<p;A++){var P=3*A;x[A]=255<<24|u[P+2]<<16|u[P+1]<<8|u[P]}if(N==16)for(A=0;A<p;A++)P=6*A,x[A]=255<<24|u[P+4]<<16|u[P+2]<<8|u[P]}else{var S=F[0];const j=F[1],Z=F[2];if(N==8)for(A=0;A<p;A++){var E=A<<2;P=3*A,x[A]=255<<24|u[P+2]<<16|u[P+1]<<8|u[P],u[P]==S&&u[P+1]==j&&u[P+2]==Z&&(v[E+3]=0)}if(N==16)for(A=0;A<p;A++)E=A<<2,P=6*A,x[A]=255<<24|u[P+4]<<16|u[P+2]<<8|u[P],O(u,P)==S&&O(u,P+2)==j&&O(u,P+4)==Z&&(v[E+3]=0)}}else if(C==3){const F=h.tabs.PLTE,j=h.tabs.tRNS,Z=j?j.length:0;if(N==1)for(var _=0;_<d;_++){var k=_*m,D=_*f;for(A=0;A<f;A++){E=D+A<<2;var U=3*(B=u[k+(A>>3)]>>7-((7&A)<<0)&1);v[E]=F[U],v[E+1]=F[U+1],v[E+2]=F[U+2],v[E+3]=B<Z?j[B]:255}}if(N==2)for(_=0;_<d;_++)for(k=_*m,D=_*f,A=0;A<f;A++)E=D+A<<2,U=3*(B=u[k+(A>>2)]>>6-((3&A)<<1)&3),v[E]=F[U],v[E+1]=F[U+1],v[E+2]=F[U+2],v[E+3]=B<Z?j[B]:255;if(N==4)for(_=0;_<d;_++)for(k=_*m,D=_*f,A=0;A<f;A++)E=D+A<<2,U=3*(B=u[k+(A>>1)]>>4-((1&A)<<2)&15),v[E]=F[U],v[E+1]=F[U+1],v[E+2]=F[U+2],v[E+3]=B<Z?j[B]:255;if(N==8)for(A=0;A<p;A++){var B;E=A<<2,U=3*(B=u[A]),v[E]=F[U],v[E+1]=F[U+1],v[E+2]=F[U+2],v[E+3]=B<Z?j[B]:255}}else if(C==4){if(N==8)for(A=0;A<p;A++){E=A<<2;var M=u[T=A<<1];v[E]=M,v[E+1]=M,v[E+2]=M,v[E+3]=u[T+1]}if(N==16)for(A=0;A<p;A++){var T;E=A<<2,M=u[T=A<<2],v[E]=M,v[E+1]=M,v[E+2]=M,v[E+3]=u[T+2]}}else if(C==0)for(S=h.tabs.tRNS?h.tabs.tRNS:-1,_=0;_<d;_++){const F=_*m,j=_*f;if(N==1)for(var L=0;L<f;L++){var q=(M=255*(u[F+(L>>>3)]>>>7-(7&L)&1))==255*S?0:255;x[j+L]=q<<24|M<<16|M<<8|M}else if(N==2)for(L=0;L<f;L++)q=(M=85*(u[F+(L>>>2)]>>>6-((3&L)<<1)&3))==85*S?0:255,x[j+L]=q<<24|M<<16|M<<8|M;else if(N==4)for(L=0;L<f;L++)q=(M=17*(u[F+(L>>>1)]>>>4-((1&L)<<2)&15))==17*S?0:255,x[j+L]=q<<24|M<<16|M<<8|M;else if(N==8)for(L=0;L<f;L++)q=(M=u[F+L])==S?0:255,x[j+L]=q<<24|M<<16|M<<8|M;else if(N==16)for(L=0;L<f;L++)M=u[F+(L<<1)],q=O(u,F+(L<<1))==S?0:255,x[j+L]=q<<24|M<<16|M<<8|M}return v}function n(u,f,d,h){const p=s(u),g=Math.ceil(d*p/8),m=new Uint8Array((g+1+u.interlace)*h);return f=u.tabs.CgBI?i(f,m):r(f,m),u.interlace==0?f=o(f,u,0,d,h):u.interlace==1&&(f=(function(x,C){const N=C.width,O=C.height,A=s(C),P=A>>3,S=Math.ceil(N*A/8),E=new Uint8Array(O*S);let _=0;const k=[0,0,4,0,2,0,1],D=[0,4,0,2,0,1,0],U=[8,8,8,4,4,2,2],B=[8,8,4,4,2,2,1];let M=0;for(;M<7;){const L=U[M],q=B[M];let F=0,j=0,Z=k[M];for(;Z<O;)Z+=L,j++;let J=D[M];for(;J<N;)J+=q,F++;const ue=Math.ceil(F*A/8);o(x,C,_,F,j);let ae=0,X=k[M];for(;X<O;){let be=D[M],De=_+ae*ue<<3;for(;be<N;){var T;if(A==1&&(T=(T=x[De>>3])>>7-(7&De)&1,E[X*S+(be>>3)]|=T<<7-((7&be)<<0)),A==2&&(T=(T=x[De>>3])>>6-(7&De)&3,E[X*S+(be>>2)]|=T<<6-((3&be)<<1)),A==4&&(T=(T=x[De>>3])>>4-(7&De)&15,E[X*S+(be>>1)]|=T<<4-((1&be)<<2)),A>=8){const de=X*S+be*P;for(let ke=0;ke<P;ke++)E[de+ke]=x[(De>>3)+ke]}De+=A,be+=q}ae++,X+=L}F*j!=0&&(_+=j*(1+ue)),M+=1}return E})(f,u)),f}function r(u,f){return i(new Uint8Array(u.buffer,2,u.length-6),f)}var i=(function(){const u={H:{}};return u.H.N=function(f,d){const h=Uint8Array;let p,g,m=0,v=0,x=0,C=0,N=0,O=0,A=0,P=0,S=0;if(f[0]==3&&f[1]==0)return d||new h(0);const E=u.H,_=E.b,k=E.e,D=E.R,U=E.n,B=E.A,M=E.Z,T=E.m,L=d==null;for(L&&(d=new h(f.length>>>2<<5));m==0;)if(m=_(f,S,1),v=_(f,S+1,2),S+=3,v!=0){if(L&&(d=u.H.W(d,P+(1<<17))),v==1&&(p=T.J,g=T.h,O=511,A=31),v==2){x=k(f,S,5)+257,C=k(f,S+5,5)+1,N=k(f,S+10,4)+4,S+=14;let F=1;for(var q=0;q<38;q+=2)T.Q[q]=0,T.Q[q+1]=0;for(q=0;q<N;q++){const J=k(f,S+3*q,3);T.Q[1+(T.X[q]<<1)]=J,J>F&&(F=J)}S+=3*N,U(T.Q,F),B(T.Q,F,T.u),p=T.w,g=T.d,S=D(T.u,(1<<F)-1,x+C,f,S,T.v);const j=E.V(T.v,0,x,T.C);O=(1<<j)-1;const Z=E.V(T.v,x,C,T.D);A=(1<<Z)-1,U(T.C,j),B(T.C,j,p),U(T.D,Z),B(T.D,Z,g)}for(;;){const F=p[M(f,S)&O];S+=15&F;const j=F>>>4;if(!(j>>>8))d[P++]=j;else{if(j==256)break;{let Z=P+j-254;if(j>264){const be=T.q[j-257];Z=P+(be>>>3)+k(f,S,7&be),S+=7&be}const J=g[M(f,S)&A];S+=15&J;const ue=J>>>4,ae=T.c[ue],X=(ae>>>4)+_(f,S,15&ae);for(S+=15&ae;P<Z;)d[P]=d[P++-X],d[P]=d[P++-X],d[P]=d[P++-X],d[P]=d[P++-X];P=Z}}}}else{(7&S)!=0&&(S+=8-(7&S));const F=4+(S>>>3),j=f[F-4]|f[F-3]<<8;L&&(d=u.H.W(d,P+j)),d.set(new h(f.buffer,f.byteOffset+F,j),P),S=F+j<<3,P+=j}return d.length==P?d:d.slice(0,P)},u.H.W=function(f,d){const h=f.length;if(d<=h)return f;const p=new Uint8Array(h<<1);return p.set(f,0),p},u.H.R=function(f,d,h,p,g,m){const v=u.H.e,x=u.H.Z;let C=0;for(;C<h;){const N=f[x(p,g)&d];g+=15&N;const O=N>>>4;if(O<=15)m[C]=O,C++;else{let A=0,P=0;O==16?(P=3+v(p,g,2),g+=2,A=m[C-1]):O==17?(P=3+v(p,g,3),g+=3):O==18&&(P=11+v(p,g,7),g+=7);const S=C+P;for(;C<S;)m[C]=A,C++}}return g},u.H.V=function(f,d,h,p){let g=0,m=0;const v=p.length>>>1;for(;m<h;){const x=f[m+d];p[m<<1]=0,p[1+(m<<1)]=x,x>g&&(g=x),m++}for(;m<v;)p[m<<1]=0,p[1+(m<<1)]=0,m++;return g},u.H.n=function(f,d){const h=u.H.m,p=f.length;let g,m,v,x;const C=h.j;for(var N=0;N<=d;N++)C[N]=0;for(N=1;N<p;N+=2)C[f[N]]++;const O=h.K;for(g=0,C[0]=0,m=1;m<=d;m++)g=g+C[m-1]<<1,O[m]=g;for(v=0;v<p;v+=2)x=f[v+1],x!=0&&(f[v]=O[x],O[x]++)},u.H.A=function(f,d,h){const p=f.length,g=u.H.m.r;for(let m=0;m<p;m+=2)if(f[m+1]!=0){const v=m>>1,x=f[m+1],C=v<<4|x,N=d-x;let O=f[m]<<N;const A=O+(1<<N);for(;O!=A;)h[g[O]>>>15-d]=C,O++}},u.H.l=function(f,d){const h=u.H.m.r,p=15-d;for(let g=0;g<f.length;g+=2){const m=f[g]<<d-f[g+1];f[g]=h[m]>>>p}},u.H.M=function(f,d,h){h<<=7&d;const p=d>>>3;f[p]|=h,f[p+1]|=h>>>8},u.H.I=function(f,d,h){h<<=7&d;const p=d>>>3;f[p]|=h,f[p+1]|=h>>>8,f[p+2]|=h>>>16},u.H.e=function(f,d,h){return(f[d>>>3]|f[1+(d>>>3)]<<8)>>>(7&d)&(1<<h)-1},u.H.b=function(f,d,h){return(f[d>>>3]|f[1+(d>>>3)]<<8|f[2+(d>>>3)]<<16)>>>(7&d)&(1<<h)-1},u.H.Z=function(f,d){return(f[d>>>3]|f[1+(d>>>3)]<<8|f[2+(d>>>3)]<<16)>>>(7&d)},u.H.i=function(f,d){return(f[d>>>3]|f[1+(d>>>3)]<<8|f[2+(d>>>3)]<<16|f[3+(d>>>3)]<<24)>>>(7&d)},u.H.m=(function(){const f=Uint16Array,d=Uint32Array;return{K:new f(16),j:new f(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new f(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new d(32),J:new f(512),_:[],h:new f(32),$:[],w:new f(32768),C:[],v:[],d:new f(32768),D:[],u:new f(512),Q:[],r:new f(32768),s:new d(286),Y:new d(30),a:new d(19),t:new d(15e3),k:new f(65536),g:new f(32768)}})(),(function(){const f=u.H.m;for(var d=0;d<32768;d++){let p=d;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,f.r[d]=(p>>>16|p<<16)>>>17}function h(p,g,m){for(;g--!=0;)p.push(0,m)}for(d=0;d<32;d++)f.q[d]=f.S[d]<<3|f.T[d],f.c[d]=f.p[d]<<4|f.z[d];h(f._,144,8),h(f._,112,9),h(f._,24,7),h(f._,8,8),u.H.n(f._,9),u.H.A(f._,9,f.J),u.H.l(f._,9),h(f.$,32,5),u.H.n(f.$,5),u.H.A(f.$,5,f.h),u.H.l(f.$,5),h(f.Q,19,0),h(f.C,286,0),h(f.D,30,0),h(f.v,320,0)})(),u.H.N})();function s(u){return[1,null,3,1,2,null,4][u.ctype]*u.depth}function o(u,f,d,h,p){let g=s(f);const m=Math.ceil(h*g/8);let v,x;g=Math.ceil(g/8);let C=u[d],N=0;if(C>1&&(u[d]=[0,0,1][C-2]),C==3)for(N=g;N<m;N++)u[N+1]=u[N+1]+(u[N+1-g]>>>1)&255;for(let O=0;O<p;O++)if(v=d+O*m,x=v+O+1,C=u[x-1],N=0,C==0)for(;N<m;N++)u[v+N]=u[x+N];else if(C==1){for(;N<g;N++)u[v+N]=u[x+N];for(;N<m;N++)u[v+N]=u[x+N]+u[v+N-g]}else if(C==2)for(;N<m;N++)u[v+N]=u[x+N]+u[v+N-m];else if(C==3){for(;N<g;N++)u[v+N]=u[x+N]+(u[v+N-m]>>>1);for(;N<m;N++)u[v+N]=u[x+N]+(u[v+N-m]+u[v+N-g]>>>1)}else{for(;N<g;N++)u[v+N]=u[x+N]+a(0,u[v+N-m],0);for(;N<m;N++)u[v+N]=u[x+N]+a(u[v+N-g],u[v+N-m],u[v+N-g-m])}return u}function a(u,f,d){const h=u+f-d,p=h-u,g=h-f,m=h-d;return p*p<=g*g&&p*p<=m*m?u:g*g<=m*m?f:d}function l(u,f,d){d.width=t.readUint(u,f),f+=4,d.height=t.readUint(u,f),f+=4,d.depth=u[f],f++,d.ctype=u[f],f++,d.compress=u[f],f++,d.filter=u[f],f++,d.interlace=u[f],f++}function c(u,f,d,h,p,g,m,v,x){const C=Math.min(f,p),N=Math.min(d,g);let O=0,A=0;for(let M=0;M<N;M++)for(let T=0;T<C;T++)if(m>=0&&v>=0?(O=M*f+T<<2,A=(v+M)*p+m+T<<2):(O=(-v+M)*f-m+T<<2,A=M*p+T<<2),x==0)h[A]=u[O],h[A+1]=u[O+1],h[A+2]=u[O+2],h[A+3]=u[O+3];else if(x==1){var P=u[O+3]*.00392156862745098,S=u[O]*P,E=u[O+1]*P,_=u[O+2]*P,k=h[A+3]*(1/255),D=h[A]*k,U=h[A+1]*k,B=h[A+2]*k;const L=1-P,q=P+k*L,F=q==0?0:1/q;h[A+3]=255*q,h[A+0]=(S+D*L)*F,h[A+1]=(E+U*L)*F,h[A+2]=(_+B*L)*F}else if(x==2)P=u[O+3],S=u[O],E=u[O+1],_=u[O+2],k=h[A+3],D=h[A],U=h[A+1],B=h[A+2],P==k&&S==D&&E==U&&_==B?(h[A]=0,h[A+1]=0,h[A+2]=0,h[A+3]=0):(h[A]=S,h[A+1]=E,h[A+2]=_,h[A+3]=P);else if(x==3){if(P=u[O+3],S=u[O],E=u[O+1],_=u[O+2],k=h[A+3],D=h[A],U=h[A+1],B=h[A+2],P==k&&S==D&&E==U&&_==B)continue;if(P<220&&k>20)return!1}return!0}return{decode:function(f){const d=new Uint8Array(f);let h=8;const p=t,g=p.readUshort,m=p.readUint,v={tabs:{},frames:[]},x=new Uint8Array(d.length);let C,N=0,O=0;const A=[137,80,78,71,13,10,26,10];for(var P=0;P<8;P++)if(d[P]!=A[P])throw"The input is not a PNG file!";for(;h<d.length;){const M=p.readUint(d,h);h+=4;const T=p.readASCII(d,h,4);if(h+=4,T=="IHDR")l(d,h,v);else if(T=="iCCP"){for(var S=h;d[S]!=0;)S++;p.readASCII(d,h,S-h),d[S+1];const L=d.slice(S+2,h+M);let q=null;try{q=r(L)}catch{q=i(L)}v.tabs[T]=q}else if(T=="CgBI")v.tabs[T]=d.slice(h,h+4);else if(T=="IDAT"){for(P=0;P<M;P++)x[N+P]=d[h+P];N+=M}else if(T=="acTL")v.tabs[T]={num_frames:m(d,h),num_plays:m(d,h+4)},C=new Uint8Array(d.length);else if(T=="fcTL"){O!=0&&((B=v.frames[v.frames.length-1]).data=n(v,C.slice(0,O),B.rect.width,B.rect.height),O=0);const L={x:m(d,h+12),y:m(d,h+16),width:m(d,h+4),height:m(d,h+8)};let q=g(d,h+22);q=g(d,h+20)/(q==0?100:q);const F={rect:L,delay:Math.round(1e3*q),dispose:d[h+24],blend:d[h+25]};v.frames.push(F)}else if(T=="fdAT"){for(P=0;P<M-4;P++)C[O+P]=d[h+P+4];O+=M-4}else if(T=="pHYs")v.tabs[T]=[p.readUint(d,h),p.readUint(d,h+4),d[h+8]];else if(T=="cHRM")for(v.tabs[T]=[],P=0;P<8;P++)v.tabs[T].push(p.readUint(d,h+4*P));else if(T=="tEXt"||T=="zTXt"){v.tabs[T]==null&&(v.tabs[T]={});var E=p.nextZero(d,h),_=p.readASCII(d,h,E-h),k=h+M-E-1;if(T=="tEXt")U=p.readASCII(d,E+1,k);else{var D=r(d.slice(E+2,E+2+k));U=p.readUTF8(D,0,D.length)}v.tabs[T][_]=U}else if(T=="iTXt"){v.tabs[T]==null&&(v.tabs[T]={}),E=0,S=h,E=p.nextZero(d,S),_=p.readASCII(d,S,E-S);const L=d[S=E+1];var U;d[S+1],S+=2,E=p.nextZero(d,S),p.readASCII(d,S,E-S),S=E+1,E=p.nextZero(d,S),p.readUTF8(d,S,E-S),k=M-((S=E+1)-h),L==0?U=p.readUTF8(d,S,k):(D=r(d.slice(S,S+k)),U=p.readUTF8(D,0,D.length)),v.tabs[T][_]=U}else if(T=="PLTE")v.tabs[T]=p.readBytes(d,h,M);else if(T=="hIST"){const L=v.tabs.PLTE.length/3;for(v.tabs[T]=[],P=0;P<L;P++)v.tabs[T].push(g(d,h+2*P))}else if(T=="tRNS")v.ctype==3?v.tabs[T]=p.readBytes(d,h,M):v.ctype==0?v.tabs[T]=g(d,h):v.ctype==2&&(v.tabs[T]=[g(d,h),g(d,h+2),g(d,h+4)]);else if(T=="gAMA")v.tabs[T]=p.readUint(d,h)/1e5;else if(T=="sRGB")v.tabs[T]=d[h];else if(T=="bKGD")v.ctype==0||v.ctype==4?v.tabs[T]=[g(d,h)]:v.ctype==2||v.ctype==6?v.tabs[T]=[g(d,h),g(d,h+2),g(d,h+4)]:v.ctype==3&&(v.tabs[T]=d[h]);else if(T=="IEND")break;h+=M,p.readUint(d,h),h+=4}var B;return O!=0&&((B=v.frames[v.frames.length-1]).data=n(v,C.slice(0,O),B.rect.width,B.rect.height)),v.data=n(v,x,v.width,v.height),delete v.compress,delete v.interlace,delete v.filter,v},toRGBA8:function(f){const d=f.width,h=f.height;if(f.tabs.acTL==null)return[e(f.data,d,h,f).buffer];const p=[];f.frames[0].data==null&&(f.frames[0].data=f.data);const g=d*h*4,m=new Uint8Array(g),v=new Uint8Array(g),x=new Uint8Array(g);for(let N=0;N<f.frames.length;N++){const O=f.frames[N],A=O.rect.x,P=O.rect.y,S=O.rect.width,E=O.rect.height,_=e(O.data,S,E,f);if(N!=0)for(var C=0;C<g;C++)x[C]=m[C];if(O.blend==0?c(_,S,E,m,d,h,A,P,0):O.blend==1&&c(_,S,E,m,d,h,A,P,1),p.push(m.buffer.slice(0)),O.dispose!=0){if(O.dispose==1)c(v,S,E,m,d,h,A,P,0);else if(O.dispose==2)for(C=0;C<g;C++)m[C]=x[C]}}return p},_paeth:a,_copyTile:c,_bin:t}})();(function(){const{_copyTile:t}=Li,{_bin:e}=Li,n=Li._paeth;var r={table:(function(){const S=new Uint32Array(256);for(let E=0;E<256;E++){let _=E;for(let k=0;k<8;k++)1&_?_=3988292384^_>>>1:_>>>=1;S[E]=_}return S})(),update(S,E,_,k){for(let D=0;D<k;D++)S=r.table[255&(S^E[_+D])]^S>>>8;return S},crc:(S,E,_)=>4294967295^r.update(4294967295,S,E,_)};function i(S,E,_,k){E[_]+=S[0]*k>>4,E[_+1]+=S[1]*k>>4,E[_+2]+=S[2]*k>>4,E[_+3]+=S[3]*k>>4}function s(S){return Math.max(0,Math.min(255,S))}function o(S,E){const _=S[0]-E[0],k=S[1]-E[1],D=S[2]-E[2],U=S[3]-E[3];return _*_+k*k+D*D+U*U}function a(S,E,_,k,D,U,B){B==null&&(B=1);const M=k.length,T=[];for(var L=0;L<M;L++){const X=k[L];T.push([X>>>0&255,X>>>8&255,X>>>16&255,X>>>24&255])}for(L=0;L<M;L++){let X=4294967295;for(var q=0,F=0;F<M;F++){var j=o(T[L],T[F]);F!=L&&j<X&&(X=j,q=F)}}const Z=new Uint32Array(D.buffer),J=new Int16Array(E*_*4),ue=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(L=0;L<ue.length;L++)ue[L]=255*((ue[L]+.5)/16-.5);for(let X=0;X<_;X++)for(let be=0;be<E;be++){var ae;L=4*(X*E+be),B!=2?ae=[s(S[L]+J[L]),s(S[L+1]+J[L+1]),s(S[L+2]+J[L+2]),s(S[L+3]+J[L+3])]:(j=ue[4*(3&X)+(3&be)],ae=[s(S[L]+j),s(S[L+1]+j),s(S[L+2]+j),s(S[L+3]+j)]),q=0;let De=16777215;for(F=0;F<M;F++){const Ze=o(ae,T[F]);Ze<De&&(De=Ze,q=F)}const de=T[q],ke=[ae[0]-de[0],ae[1]-de[1],ae[2]-de[2],ae[3]-de[3]];B==1&&(be!=E-1&&i(ke,J,L+4,7),X!=_-1&&(be!=0&&i(ke,J,L+4*E-4,3),i(ke,J,L+4*E,5),be!=E-1&&i(ke,J,L+4*E+4,1))),U[L>>2]=q,Z[L>>2]=k[q]}}function l(S,E,_,k,D){D==null&&(D={});const{crc:U}=r,B=e.writeUint,M=e.writeUshort,T=e.writeASCII;let L=8;const q=S.frames.length>1;let F,j=!1,Z=33+(q?20:0);if(D.sRGB!=null&&(Z+=13),D.pHYs!=null&&(Z+=21),D.iCCP!=null&&(F=pako.deflate(D.iCCP),Z+=21+F.length+4),S.ctype==3){for(var J=S.plte.length,ue=0;ue<J;ue++)S.plte[ue]>>>24!=255&&(j=!0);Z+=8+3*J+4+(j?8+1*J+4:0)}for(var ae=0;ae<S.frames.length;ae++)q&&(Z+=38),Z+=(de=S.frames[ae]).cimg.length+12,ae!=0&&(Z+=4);Z+=12;const X=new Uint8Array(Z),be=[137,80,78,71,13,10,26,10];for(ue=0;ue<8;ue++)X[ue]=be[ue];if(B(X,L,13),L+=4,T(X,L,"IHDR"),L+=4,B(X,L,E),L+=4,B(X,L,_),L+=4,X[L]=S.depth,L++,X[L]=S.ctype,L++,X[L]=0,L++,X[L]=0,L++,X[L]=0,L++,B(X,L,U(X,L-17,17)),L+=4,D.sRGB!=null&&(B(X,L,1),L+=4,T(X,L,"sRGB"),L+=4,X[L]=D.sRGB,L++,B(X,L,U(X,L-5,5)),L+=4),D.iCCP!=null){const ke=13+F.length;B(X,L,ke),L+=4,T(X,L,"iCCP"),L+=4,T(X,L,"ICC profile"),L+=11,L+=2,X.set(F,L),L+=F.length,B(X,L,U(X,L-(ke+4),ke+4)),L+=4}if(D.pHYs!=null&&(B(X,L,9),L+=4,T(X,L,"pHYs"),L+=4,B(X,L,D.pHYs[0]),L+=4,B(X,L,D.pHYs[1]),L+=4,X[L]=D.pHYs[2],L++,B(X,L,U(X,L-13,13)),L+=4),q&&(B(X,L,8),L+=4,T(X,L,"acTL"),L+=4,B(X,L,S.frames.length),L+=4,B(X,L,D.loop!=null?D.loop:0),L+=4,B(X,L,U(X,L-12,12)),L+=4),S.ctype==3){for(B(X,L,3*(J=S.plte.length)),L+=4,T(X,L,"PLTE"),L+=4,ue=0;ue<J;ue++){const ke=3*ue,Ze=S.plte[ue],me=255&Ze,Ee=Ze>>>8&255,ve=Ze>>>16&255;X[L+ke+0]=me,X[L+ke+1]=Ee,X[L+ke+2]=ve}if(L+=3*J,B(X,L,U(X,L-3*J-4,3*J+4)),L+=4,j){for(B(X,L,J),L+=4,T(X,L,"tRNS"),L+=4,ue=0;ue<J;ue++)X[L+ue]=S.plte[ue]>>>24&255;L+=J,B(X,L,U(X,L-J-4,J+4)),L+=4}}let De=0;for(ae=0;ae<S.frames.length;ae++){var de=S.frames[ae];q&&(B(X,L,26),L+=4,T(X,L,"fcTL"),L+=4,B(X,L,De++),L+=4,B(X,L,de.rect.width),L+=4,B(X,L,de.rect.height),L+=4,B(X,L,de.rect.x),L+=4,B(X,L,de.rect.y),L+=4,M(X,L,k[ae]),L+=2,M(X,L,1e3),L+=2,X[L]=de.dispose,L++,X[L]=de.blend,L++,B(X,L,U(X,L-30,30)),L+=4);const ke=de.cimg;B(X,L,(J=ke.length)+(ae==0?0:4)),L+=4;const Ze=L;T(X,L,ae==0?"IDAT":"fdAT"),L+=4,ae!=0&&(B(X,L,De++),L+=4),X.set(ke,L),L+=J,B(X,L,U(X,Ze,L-Ze)),L+=4}return B(X,L,0),L+=4,T(X,L,"IEND"),L+=4,B(X,L,U(X,L-4,4)),L+=4,X.buffer}function c(S,E,_){for(let k=0;k<S.frames.length;k++){const D=S.frames[k];D.rect.width;const U=D.rect.height,B=new Uint8Array(U*D.bpl+U);D.cimg=h(D.img,U,D.bpp,D.bpl,B,E,_)}}function u(S,E,_,k,D){const U=D[0],B=D[1],M=D[2],T=D[3],L=D[4],q=D[5];let F=6,j=8,Z=255;for(var J=0;J<S.length;J++){const nt=new Uint8Array(S[J]);for(var ue=nt.length,ae=0;ae<ue;ae+=4)Z&=nt[ae+3]}const X=Z!=255,be=(function(He,it,at,At,ht,Tt){const Ce=[];for(var Be=0;Be<He.length;Be++){const Nt=new Uint8Array(He[Be]),_t=new Uint32Array(Nt.buffer);var ot;let xt=0,Ht=0,Cn=it,Qn=at,kr=At?1:0;if(Be!=0){const oi=Tt||At||Be==1||Ce[Be-2].dispose!=0?1:2;let Cr=0,ka=1e9;for(let Es=0;Es<oi;Es++){var ct=new Uint8Array(He[Be-1-Es]);const Ca=new Uint32Array(He[Be-1-Es]);let Kr=it,Gr=at,br=-1,Tr=-1;for(let In=0;In<at;In++)for(let Ir=0;Ir<it;Ir++)_t[Ut=In*it+Ir]!=Ca[Ut]&&(Ir<Kr&&(Kr=Ir),Ir>br&&(br=Ir),In<Gr&&(Gr=In),In>Tr&&(Tr=In));br==-1&&(Kr=Gr=br=Tr=0),ht&&((1&Kr)==1&&Kr--,(1&Gr)==1&&Gr--);const Tn=(br-Kr+1)*(Tr-Gr+1);Tn<ka&&(ka=Tn,Cr=Es,xt=Kr,Ht=Gr,Cn=br-Kr+1,Qn=Tr-Gr+1)}ct=new Uint8Array(He[Be-1-Cr]),Cr==1&&(Ce[Be-1].dispose=2),ot=new Uint8Array(Cn*Qn*4),t(ct,it,at,ot,Cn,Qn,-xt,-Ht,0),kr=t(Nt,it,at,ot,Cn,Qn,-xt,-Ht,3)?1:0,kr==1?d(Nt,it,at,ot,{x:xt,y:Ht,width:Cn,height:Qn}):t(Nt,it,at,ot,Cn,Qn,-xt,-Ht,0)}else ot=Nt.slice(0);Ce.push({rect:{x:xt,y:Ht,width:Cn,height:Qn},img:ot,blend:kr,dispose:0})}if(At)for(Be=0;Be<Ce.length;Be++){if((jt=Ce[Be]).blend==1)continue;const Nt=jt.rect,_t=Ce[Be-1].rect,xt=Math.min(Nt.x,_t.x),Ht=Math.min(Nt.y,_t.y),Cn={x:xt,y:Ht,width:Math.max(Nt.x+Nt.width,_t.x+_t.width)-xt,height:Math.max(Nt.y+Nt.height,_t.y+_t.height)-Ht};Ce[Be-1].dispose=1,Be-1!=0&&f(He,it,at,Ce,Be-1,Cn,ht),f(He,it,at,Ce,Be,Cn,ht)}let Zt=0;if(He.length!=1)for(var Ut=0;Ut<Ce.length;Ut++){var jt;Zt+=(jt=Ce[Ut]).rect.width*jt.rect.height}return Ce})(S,E,_,U,B,M),De={},de=[],ke=[];if(k!=0){const nt=[];for(ae=0;ae<be.length;ae++)nt.push(be[ae].img.buffer);const He=(function(ht){let Tt=0;for(var Ce=0;Ce<ht.length;Ce++)Tt+=ht[Ce].byteLength;const Be=new Uint8Array(Tt);let ot=0;for(Ce=0;Ce<ht.length;Ce++){const ct=new Uint8Array(ht[Ce]),Zt=ct.length;for(let Ut=0;Ut<Zt;Ut+=4){let jt=ct[Ut],Nt=ct[Ut+1],_t=ct[Ut+2];const xt=ct[Ut+3];xt==0&&(jt=Nt=_t=0),Be[ot+Ut]=jt,Be[ot+Ut+1]=Nt,Be[ot+Ut+2]=_t,Be[ot+Ut+3]=xt}ot+=Zt}return Be.buffer})(nt),it=g(He,k);for(ae=0;ae<it.plte.length;ae++)de.push(it.plte[ae].est.rgba);let at=0;for(ae=0;ae<be.length;ae++){const At=(me=be[ae]).img.length;var Ze=new Uint8Array(it.inds.buffer,at>>2,At>>2);ke.push(Ze);const ht=new Uint8Array(it.abuf,at,At);q&&a(me.img,me.rect.width,me.rect.height,de,ht,Ze),me.img.set(ht),at+=At}}else for(J=0;J<be.length;J++){var me=be[J];const nt=new Uint32Array(me.img.buffer);var Ee=me.rect.width;for(ue=nt.length,Ze=new Uint8Array(ue),ke.push(Ze),ae=0;ae<ue;ae++){const He=nt[ae];if(ae!=0&&He==nt[ae-1])Ze[ae]=Ze[ae-1];else if(ae>Ee&&He==nt[ae-Ee])Ze[ae]=Ze[ae-Ee];else{let it=De[He];if(it==null&&(De[He]=it=de.length,de.push(He),de.length>=300))break;Ze[ae]=it}}}const ve=de.length;for(ve<=256&&L==0&&(j=ve<=2?1:ve<=4?2:ve<=16?4:8,j=Math.max(j,T)),J=0;J<be.length;J++){(me=be[J]).rect.x,me.rect.y,Ee=me.rect.width;const nt=me.rect.height;let He=me.img;new Uint32Array(He.buffer);let it=4*Ee,at=4;if(ve<=256&&L==0){it=Math.ceil(j*Ee/8);var Oe=new Uint8Array(it*nt);const At=ke[J];for(let ht=0;ht<nt;ht++){ae=ht*it;const Tt=ht*Ee;if(j==8)for(var Re=0;Re<Ee;Re++)Oe[ae+Re]=At[Tt+Re];else if(j==4)for(Re=0;Re<Ee;Re++)Oe[ae+(Re>>1)]|=At[Tt+Re]<<4-4*(1&Re);else if(j==2)for(Re=0;Re<Ee;Re++)Oe[ae+(Re>>2)]|=At[Tt+Re]<<6-2*(3&Re);else if(j==1)for(Re=0;Re<Ee;Re++)Oe[ae+(Re>>3)]|=At[Tt+Re]<<7-1*(7&Re)}He=Oe,F=3,at=1}else if(X==0&&be.length==1){Oe=new Uint8Array(Ee*nt*3);const At=Ee*nt;for(ae=0;ae<At;ae++){const ht=3*ae,Tt=4*ae;Oe[ht]=He[Tt],Oe[ht+1]=He[Tt+1],Oe[ht+2]=He[Tt+2]}He=Oe,F=2,at=3,it=3*Ee}me.img=He,me.bpl=it,me.bpp=at}return{ctype:F,depth:j,plte:de,frames:be}}function f(S,E,_,k,D,U,B){const M=Uint8Array,T=Uint32Array,L=new M(S[D-1]),q=new T(S[D-1]),F=D+1<S.length?new M(S[D+1]):null,j=new M(S[D]),Z=new T(j.buffer);let J=E,ue=_,ae=-1,X=-1;for(let De=0;De<U.height;De++)for(let de=0;de<U.width;de++){const ke=U.x+de,Ze=U.y+De,me=Ze*E+ke,Ee=Z[me];Ee==0||k[D-1].dispose==0&&q[me]==Ee&&(F==null||F[4*me+3]!=0)||(ke<J&&(J=ke),ke>ae&&(ae=ke),Ze<ue&&(ue=Ze),Ze>X&&(X=Ze))}ae==-1&&(J=ue=ae=X=0),B&&((1&J)==1&&J--,(1&ue)==1&&ue--),U={x:J,y:ue,width:ae-J+1,height:X-ue+1};const be=k[D];be.rect=U,be.blend=1,be.img=new Uint8Array(U.width*U.height*4),k[D-1].dispose==0?(t(L,E,_,be.img,U.width,U.height,-U.x,-U.y,0),d(j,E,_,be.img,U)):t(j,E,_,be.img,U.width,U.height,-U.x,-U.y,0)}function d(S,E,_,k,D){t(S,E,_,k,D.width,D.height,-D.x,-D.y,2)}function h(S,E,_,k,D,U,B){const M=[];let T,L=[0,1,2,3,4];U!=-1?L=[U]:(E*k>5e5||_==1)&&(L=[0]),B&&(T={level:0});const q=YZ;for(var F=0;F<L.length;F++){for(let J=0;J<E;J++)p(D,S,J,k,_,L[F]);M.push(q.deflate(D,T))}let j,Z=1e9;for(F=0;F<M.length;F++)M[F].length<Z&&(j=F,Z=M[F].length);return M[j]}function p(S,E,_,k,D,U){const B=_*k;let M=B+_;if(S[M]=U,M++,U==0)if(k<500)for(var T=0;T<k;T++)S[M+T]=E[B+T];else S.set(new Uint8Array(E.buffer,B,k),M);else if(U==1){for(T=0;T<D;T++)S[M+T]=E[B+T];for(T=D;T<k;T++)S[M+T]=E[B+T]-E[B+T-D]+256&255}else if(_==0){for(T=0;T<D;T++)S[M+T]=E[B+T];if(U==2)for(T=D;T<k;T++)S[M+T]=E[B+T];if(U==3)for(T=D;T<k;T++)S[M+T]=E[B+T]-(E[B+T-D]>>1)+256&255;if(U==4)for(T=D;T<k;T++)S[M+T]=E[B+T]-n(E[B+T-D],0,0)+256&255}else{if(U==2)for(T=0;T<k;T++)S[M+T]=E[B+T]+256-E[B+T-k]&255;if(U==3){for(T=0;T<D;T++)S[M+T]=E[B+T]+256-(E[B+T-k]>>1)&255;for(T=D;T<k;T++)S[M+T]=E[B+T]+256-(E[B+T-k]+E[B+T-D]>>1)&255}if(U==4){for(T=0;T<D;T++)S[M+T]=E[B+T]+256-n(0,E[B+T-k],0)&255;for(T=D;T<k;T++)S[M+T]=E[B+T]+256-n(E[B+T-D],E[B+T-k],E[B+T-D-k])&255}}}function g(S,E){const _=new Uint8Array(S),k=_.slice(0),D=new Uint32Array(k.buffer),U=m(k,E),B=U[0],M=U[1],T=_.length,L=new Uint8Array(T>>2);let q;if(_.length<2e7)for(var F=0;F<T;F+=4)q=v(B,j=_[F]*(1/255),Z=_[F+1]*(1/255),J=_[F+2]*(1/255),ue=_[F+3]*(1/255)),L[F>>2]=q.ind,D[F>>2]=q.est.rgba;else for(F=0;F<T;F+=4){var j=_[F]*.00392156862745098,Z=_[F+1]*(1/255),J=_[F+2]*(1/255),ue=_[F+3]*(1/255);for(q=B;q.left;)q=x(q.est,j,Z,J,ue)<=0?q.left:q.right;L[F>>2]=q.ind,D[F>>2]=q.est.rgba}return{abuf:k.buffer,inds:L,plte:M}}function m(S,E,_){_==null&&(_=1e-4);const k=new Uint32Array(S.buffer),D={i0:0,i1:S.length,bst:null,est:null,tdst:0,left:null,right:null};D.bst=O(S,D.i0,D.i1),D.est=A(D.bst);const U=[D];for(;U.length<E;){let M=0,T=0;for(var B=0;B<U.length;B++)U[B].est.L>M&&(M=U[B].est.L,T=B);if(M<_)break;const L=U[T],q=C(S,k,L.i0,L.i1,L.est.e,L.est.eMq255);if(L.i0>=q||L.i1<=q){L.est.L=0;continue}const F={i0:L.i0,i1:q,bst:null,est:null,tdst:0,left:null,right:null};F.bst=O(S,F.i0,F.i1),F.est=A(F.bst);const j={i0:q,i1:L.i1,bst:null,est:null,tdst:0,left:null,right:null};for(j.bst={R:[],m:[],N:L.bst.N-F.bst.N},B=0;B<16;B++)j.bst.R[B]=L.bst.R[B]-F.bst.R[B];for(B=0;B<4;B++)j.bst.m[B]=L.bst.m[B]-F.bst.m[B];j.est=A(j.bst),L.left=F,L.right=j,U[T]=F,U.push(j)}for(U.sort(((M,T)=>T.bst.N-M.bst.N)),B=0;B<U.length;B++)U[B].ind=B;return[D,U]}function v(S,E,_,k,D){if(S.left==null)return S.tdst=(function(F,j,Z,J,ue){const ae=j-F[0],X=Z-F[1],be=J-F[2],De=ue-F[3];return ae*ae+X*X+be*be+De*De})(S.est.q,E,_,k,D),S;const U=x(S.est,E,_,k,D);let B=S.left,M=S.right;U>0&&(B=S.right,M=S.left);const T=v(B,E,_,k,D);if(T.tdst<=U*U)return T;const L=v(M,E,_,k,D);return L.tdst<T.tdst?L:T}function x(S,E,_,k,D){const{e:U}=S;return U[0]*E+U[1]*_+U[2]*k+U[3]*D-S.eMq}function C(S,E,_,k,D,U){for(k-=4;_<k;){for(;N(S,_,D)<=U;)_+=4;for(;N(S,k,D)>U;)k-=4;if(_>=k)break;const B=E[_>>2];E[_>>2]=E[k>>2],E[k>>2]=B,_+=4,k-=4}for(;N(S,_,D)>U;)_-=4;return _+4}function N(S,E,_){return S[E]*_[0]+S[E+1]*_[1]+S[E+2]*_[2]+S[E+3]*_[3]}function O(S,E,_){const k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],D=[0,0,0,0],U=_-E>>2;for(let B=E;B<_;B+=4){const M=S[B]*.00392156862745098,T=S[B+1]*(1/255),L=S[B+2]*(1/255),q=S[B+3]*(1/255);D[0]+=M,D[1]+=T,D[2]+=L,D[3]+=q,k[0]+=M*M,k[1]+=M*T,k[2]+=M*L,k[3]+=M*q,k[5]+=T*T,k[6]+=T*L,k[7]+=T*q,k[10]+=L*L,k[11]+=L*q,k[15]+=q*q}return k[4]=k[1],k[8]=k[2],k[9]=k[6],k[12]=k[3],k[13]=k[7],k[14]=k[11],{R:k,m:D,N:U}}function A(S){const{R:E}=S,{m:_}=S,{N:k}=S,D=_[0],U=_[1],B=_[2],M=_[3],T=k==0?0:1/k,L=[E[0]-D*D*T,E[1]-D*U*T,E[2]-D*B*T,E[3]-D*M*T,E[4]-U*D*T,E[5]-U*U*T,E[6]-U*B*T,E[7]-U*M*T,E[8]-B*D*T,E[9]-B*U*T,E[10]-B*B*T,E[11]-B*M*T,E[12]-M*D*T,E[13]-M*U*T,E[14]-M*B*T,E[15]-M*M*T],q=L,F=P;let j=[Math.random(),Math.random(),Math.random(),Math.random()],Z=0,J=0;if(k!=0)for(let ae=0;ae<16&&(j=F.multVec(q,j),J=Math.sqrt(F.dot(j,j)),j=F.sml(1/J,j),!(ae!=0&&Math.abs(J-Z)<1e-9));ae++)Z=J;const ue=[D*T,U*T,B*T,M*T];return{Cov:L,q:ue,e:j,L:Z,eMq255:F.dot(F.sml(255,ue),j),eMq:F.dot(j,ue),rgba:(Math.round(255*ue[3])<<24|Math.round(255*ue[2])<<16|Math.round(255*ue[1])<<8|Math.round(255*ue[0])<<0)>>>0}}var P={multVec:(S,E)=>[S[0]*E[0]+S[1]*E[1]+S[2]*E[2]+S[3]*E[3],S[4]*E[0]+S[5]*E[1]+S[6]*E[2]+S[7]*E[3],S[8]*E[0]+S[9]*E[1]+S[10]*E[2]+S[11]*E[3],S[12]*E[0]+S[13]*E[1]+S[14]*E[2]+S[15]*E[3]],dot:(S,E)=>S[0]*E[0]+S[1]*E[1]+S[2]*E[2]+S[3]*E[3],sml:(S,E)=>[S*E[0],S*E[1],S*E[2],S*E[3]]};Li.encode=function(E,_,k,D,U,B,M){D==null&&(D=0),M==null&&(M=!1);const T=u(E,_,k,D,[!1,!1,!1,0,M,!1]);return c(T,-1),l(T,_,k,U,B)},Li.encodeLL=function(E,_,k,D,U,B,M,T){const L={ctype:0+(D==1?0:2)+(U==0?0:4),depth:B,frames:[]},q=(D+U)*B,F=q*_;for(let j=0;j<E.length;j++)L.frames.push({rect:{x:0,y:0,width:_,height:k},img:new Uint8Array(E[j]),blend:0,dispose:1,bpp:Math.ceil(q/8),bpl:Math.ceil(F/8)});return c(L,0,!0),l(L,_,k,M,T)},Li.encode.compress=u,Li.encode.dither=a,Li.quantize=g,Li.quantize.getKDtree=m,Li.quantize.getNearest=v})();const MI={toArrayBuffer(t,e){const n=t.width,r=t.height,i=n<<2,s=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(s.data.buffer),a=(32*n+31)/32<<2,l=a*r,c=122+l,u=new ArrayBuffer(c),f=new DataView(u),d=1<<20;let h,p,g,m,v=d,x=0,C=0,N=0;function O(S){f.setUint16(C,S,!0),C+=2}function A(S){f.setUint32(C,S,!0),C+=4}function P(S){C+=S}O(19778),A(c),P(4),A(122),A(108),A(n),A(-r>>>0),O(1),O(32),A(3),A(l),A(2835),A(2835),P(8),A(16711680),A(65280),A(255),A(4278190080),A(1466527264),(function S(){for(;x<r&&v>0;){for(m=122+x*a,h=0;h<i;)v--,p=o[N++],g=p>>>24,f.setUint32(m+h,p<<8|g),h+=4;x++}N<o.length?(v=d,setTimeout(S,MI._dly)):e(u)})()},toBlob(t,e){this.toArrayBuffer(t,(n=>{e(new Blob([n],{type:"image/bmp"}))}))},_dly:9};var Dr={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},JZ={[Dr.CHROME]:16384,[Dr.FIREFOX]:11180,[Dr.DESKTOP_SAFARI]:16384,[Dr.IE]:8192,[Dr.IOS]:4096,[Dr.ETC]:8192};const Lw=typeof window<"u",LI=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,ep=Lw&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),XZ=(Lw||LI)&&(ep&&ep.getOriginalSymbol(window,"File")||typeof File<"u"&&File),$I=(Lw||LI)&&(ep&&ep.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function $w(t,e,n=Date.now()){return new Promise((r=>{const i=t.split(","),s=i[0].match(/:(.*?);/)[1],o=globalThis.atob(i[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const c=new Blob([l],{type:s});c.name=e,c.lastModified=n,r(c)}))}function NI(t){return new Promise(((e,n)=>{const r=new $I;r.onload=()=>e(r.result),r.onerror=i=>n(i),r.readAsDataURL(t)}))}function PI(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=i=>n(i),r.src=t}))}function Ka(){if(Ka.cachedResult!==void 0)return Ka.cachedResult;let t=Dr.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Dr.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Dr.IOS:/Safari/i.test(e)?t=Dr.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Dr.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Dr.IE),Ka.cachedResult=t,Ka.cachedResult}function RI(t,e){const n=Ka(),r=JZ[n];let i=t,s=e,o=i*s;const a=i>s?s/i:i/s;for(;o>r*r;){const l=(r+i)/2,c=(r+s)/2;l<c?(s=c,i=c*a):(s=l*a,i=l),o=i*s}return{width:i,height:s}}function ug(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function DI(t,e){const{width:n,height:r}=RI(t.width,t.height),[i,s]=ug(n,r);return e&&/jpe?g/.test(e)&&(s.fillStyle="white",s.fillRect(0,0,i.width,i.height)),s.drawImage(t,0,0,i.width,i.height),i}function Od(){return Od.cachedResult!==void 0||(Od.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Od.cachedResult}function tp(t,e={}){return new Promise((function(n,r){let i,s;var o=function(){try{return s=DI(i,e.fileType||t.type),n([i,s])}catch(l){return r(l)}},a=function(l){try{var c=function(u){try{throw u}catch(f){return r(f)}};try{let u;return NI(t).then((function(f){try{return u=f,PI(u).then((function(d){try{return i=d,(function(){try{return o()}catch(h){return r(h)}})()}catch(h){return c(h)}}),c)}catch(d){return c(d)}}),c)}catch(u){c(u)}}catch(u){return r(u)}};try{if(Od()||[Dr.DESKTOP_SAFARI,Dr.MOBILE_SAFARI].includes(Ka()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then((function(l){try{return i=l,o()}catch{return a()}}),a)}catch{a()}}))}function np(t,e,n,r,i=1){return new Promise((function(s,o){let a;if(e==="image/png"){let c,u,f;return c=t.getContext("2d"),{data:u}=c.getImageData(0,0,t.width,t.height),f=Li.encode([u.buffer],t.width,t.height,4096*i),a=new Blob([f],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let c=function(){return l.call(this)};if(e==="image/bmp")return new Promise((u=>MI.toBlob(t,u))).then((function(u){try{return a=u,a.name=n,a.lastModified=r,c.call(this)}catch(f){return o(f)}}).bind(this),o);{let u=function(){return c.call(this)};if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:i}).then((function(f){try{return a=f,a.name=n,a.lastModified=r,u.call(this)}catch(d){return o(d)}}).bind(this),o);{let f;return f=t.toDataURL(e,i),$w(f,n,r).then((function(d){try{return a=d,u.call(this)}catch(h){return o(h)}}).bind(this),o)}}}function l(){return s(a)}}))}function es(t){t.width=0,t.height=0}function Wl(){return new Promise((function(t,e){let n,r,i,s;return Wl.cachedResult!==void 0?t(Wl.cachedResult):$w("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(o){try{return n=o,tp(n).then((function(a){try{return r=a[1],np(r,n.type,n.name,n.lastModified).then((function(l){try{return i=l,es(r),tp(i).then((function(c){try{return s=c[0],Wl.cachedResult=s.width===1&&s.height===2,t(Wl.cachedResult)}catch(u){return e(u)}}),e)}catch(c){return e(c)}}),e)}catch(l){return e(l)}}),e)}catch(a){return e(a)}}),e)}))}function BI(t){return new Promise(((e,n)=>{const r=new $I;r.onload=i=>{const s=new DataView(i.target.result);if(s.getUint16(0,!1)!=65496)return e(-2);const o=s.byteLength;let a=2;for(;a<o;){if(s.getUint16(a+2,!1)<=8)return e(-1);const l=s.getUint16(a,!1);if(a+=2,l==65505){if(s.getUint32(a+=2,!1)!=1165519206)return e(-1);const c=s.getUint16(a+=6,!1)==18761;a+=s.getUint32(a+4,c);const u=s.getUint16(a,c);a+=2;for(let f=0;f<u;f++)if(s.getUint16(a+12*f,c)==274)return e(s.getUint16(a+12*f+8,c))}else{if((65280&l)!=65280)break;a+=s.getUint16(a,!1)}}return e(-1)},r.onerror=i=>n(i),r.readAsArrayBuffer(t)}))}function UI(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:i}=e;let s,o=t;return isFinite(i)&&(n>i||r>i)&&([o,s]=ug(n,r),n>r?(o.width=i,o.height=r/n*i):(o.width=n/r*i,o.height=i),s.drawImage(t,0,0,o.width,o.height),es(t)),o}function HI(t,e){const{width:n}=t,{height:r}=t,[i,s]=ug(n,r);switch(e>4&&e<9?(i.width=r,i.height=n):(i.width=n,i.height=r),e){case 2:s.transform(-1,0,0,1,n,0);break;case 3:s.transform(-1,0,0,-1,n,r);break;case 4:s.transform(1,0,0,-1,0,r);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,r,0);break;case 7:s.transform(0,-1,-1,0,r,n);break;case 8:s.transform(0,-1,1,0,0,n)}return s.drawImage(t,0,0,n,r),es(t),i}function OS(t,e,n=0){return new Promise((function(r,i){let s,o,a,l,c,u,f,d,h,p,g,m,v,x,C,N,O,A,P,S;function E(k=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;s+=k,e.onProgress(Math.min(s,100))}function _(k){if(e.signal&&e.signal.aborted)throw e.signal.reason;s=Math.min(Math.max(k,s),100),e.onProgress(s)}return s=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,E(),tp(t,e).then((function(k){try{return[,l]=k,E(),c=UI(l,e),E(),new Promise((function(D,U){var B;if(!(B=e.exifOrientation))return BI(t).then((function(T){try{return B=T,M.call(this)}catch(L){return U(L)}}).bind(this),U);function M(){return D(B)}return M.call(this)})).then((function(D){try{return u=D,E(),Wl().then((function(U){try{return f=U?c:HI(c,u),E(),d=e.initialQuality||1,h=e.fileType||t.type,np(f,h,t.name,t.lastModified,d).then((function(B){try{{let T=function(){if(o--&&(C>a||C>v)){let q,F;return q=S?.95*P.width:P.width,F=S?.95*P.height:P.height,[O,A]=ug(q,F),A.drawImage(P,0,0,q,F),d*=h==="image/png"?.85:.95,np(O,h,t.name,t.lastModified,d).then((function(j){try{return N=j,es(P),P=O,C=N.size,_(Math.min(99,Math.floor((x-C)/(x-a)*100))),T}catch(Z){return i(Z)}}),i)}return[1]},L=function(){return es(P),es(O),es(c),es(f),es(l),_(100),r(N)};if(p=B,E(),g=p.size>a,m=p.size>t.size,!g&&!m)return _(100),r(p);var M;return v=t.size,x=p.size,C=x,P=f,S=!e.alwaysKeepResolution&&g,(M=(function(q){for(;q;){if(q.then)return void q.then(M,i);try{if(q.pop){if(q.length)return q.pop()?L.call(this):q;q=T}else q=q.call(this)}catch(F){return i(F)}}}).bind(this))(T)}}catch(T){return i(T)}}).bind(this),i)}catch(B){return i(B)}}).bind(this),i)}catch(U){return i(U)}}).bind(this),i)}catch(D){return i(D)}}).bind(this),i)}))}const QZ=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let L0;function eY(t,e){return new Promise(((n,r)=>{L0||(L0=(function(o){const a=[];return a.push(o),URL.createObjectURL(new Blob(a))})(QZ));const i=new Worker(L0);i.addEventListener("message",(function(o){if(e.signal&&e.signal.aborted)i.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void i.terminate();n(o.data.file),i.terminate()}else e.onProgress(o.data.progress)})),i.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",(()=>{r(e.signal.reason),i.terminate()})),i.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})}))}function ir(t,e){return new Promise((function(n,r){let i,s,o,a,l,c;if(i={...e},o=0,{onProgress:a}=i,i.maxSizeMB=i.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof i.useWebWorker!="boolean"||i.useWebWorker,delete i.useWebWorker,i.onProgress=h=>{o=h,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof XZ))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(c=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||c)return OS(t,i).then((function(h){try{return s=h,d.call(this)}catch(p){return r(p)}}).bind(this),r);var u=(function(){try{return d.call(this)}catch(h){return r(h)}}).bind(this),f=function(h){try{return OS(t,i).then((function(p){try{return s=p,u()}catch(g){return r(g)}}),r)}catch(p){return r(p)}};try{return i.libURL=i.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",eY(t,i).then((function(h){try{return s=h,u()}catch{return f()}}),f)}catch{f()}function d(){try{s.name=t.name,s.lastModified=t.lastModified}catch{}try{i.preserveExif&&t.type==="image/jpeg"&&(!i.fileType||i.fileType&&i.fileType===t.type)&&(s=OI(t,s))}catch{}return n(s)}}))}ir.getDataUrlFromFile=NI,ir.getFilefromDataUrl=$w,ir.loadImage=PI,ir.drawImageInCanvas=DI,ir.drawFileInCanvas=tp,ir.canvasToFile=np,ir.getExifOrientation=BI,ir.handleMaxWidthOrHeight=UI,ir.followExifOrientation=HI,ir.cleanupCanvasMemory=es,ir.isAutoOrientationInBrowser=Wl,ir.approximateBelowMaximumCanvasSizeOfBrowser=RI,ir.copyExifWithoutOrientation=OI,ir.getBrowserName=Ka,ir.version="2.0.2";var Ft;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(Ft||(Ft={}));const tY=(()=>{let t=0;return()=>t++})(),nY=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),rY=new Error("called FFmpeg.terminate()");class iY{#e=null;#t={};#n={};#s=[];#r=[];loaded=!1;#o=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:n,data:r}})=>{switch(n){case Ft.LOAD:this.loaded=!0,this.#t[e](r);break;case Ft.MOUNT:case Ft.UNMOUNT:case Ft.EXEC:case Ft.WRITE_FILE:case Ft.READ_FILE:case Ft.DELETE_FILE:case Ft.RENAME:case Ft.CREATE_DIR:case Ft.LIST_DIR:case Ft.DELETE_DIR:this.#t[e](r);break;case Ft.LOG:this.#s.forEach(i=>i(r));break;case Ft.PROGRESS:this.#r.forEach(i=>i(r));break;case Ft.ERROR:this.#n[e](r);break}delete this.#t[e],delete this.#n[e]})};#i=({type:e,data:n},r=[],i)=>this.#e?new Promise((s,o)=>{const a=tY();this.#e&&this.#e.postMessage({id:a,type:e,data:n},r),this.#t[a]=s,this.#n[a]=o,i?.addEventListener("abort",()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(nY);on(e,n){e==="log"?this.#s.push(n):e==="progress"&&this.#r.push(n)}off(e,n){e==="log"?this.#s=this.#s.filter(r=>r!==n):e==="progress"&&(this.#r=this.#r.filter(r=>r!==n))}load=({classWorkerURL:e,...n}={},{signal:r}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/ehagaki/assets/worker-0l8QF2aX.js",import.meta.url),{type:"module"}),this.#o()),this.#i({type:Ft.LOAD,data:n},void 0,r));exec=(e,n=-1,{signal:r}={})=>this.#i({type:Ft.EXEC,data:{args:e,timeout:n}},void 0,r);terminate=()=>{const e=Object.keys(this.#n);for(const n of e)this.#n[n](rY),delete this.#n[n],delete this.#t[n];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,n,{signal:r}={})=>{const i=[];return n instanceof Uint8Array&&i.push(n.buffer),this.#i({type:Ft.WRITE_FILE,data:{path:e,data:n}},i,r)};mount=(e,n,r)=>{const i=[];return this.#i({type:Ft.MOUNT,data:{fsType:e,options:n,mountPoint:r}},i)};unmount=e=>{const n=[];return this.#i({type:Ft.UNMOUNT,data:{mountPoint:e}},n)};readFile=(e,n="binary",{signal:r}={})=>this.#i({type:Ft.READ_FILE,data:{path:e,encoding:n}},void 0,r);deleteFile=(e,{signal:n}={})=>this.#i({type:Ft.DELETE_FILE,data:{path:e}},void 0,n);rename=(e,n,{signal:r}={})=>this.#i({type:Ft.RENAME,data:{oldPath:e,newPath:n}},void 0,r);createDir=(e,{signal:n}={})=>this.#i({type:Ft.CREATE_DIR,data:{path:e}},void 0,n);listDir=(e,{signal:n}={})=>this.#i({type:Ft.LIST_DIR,data:{path:e}},void 0,n);deleteDir=(e,{signal:n}={})=>this.#i({type:Ft.DELETE_DIR,data:{path:e}},void 0,n)}const sY=t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{const{result:i}=r;i instanceof ArrayBuffer?e(new Uint8Array(i)):e(new Uint8Array)},r.onerror=i=>{n(Error(`File could not be read! Code=${i?.target?.error?.code||-1}`))},r.readAsArrayBuffer(t)}),oY=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await sY(t);else return new Uint8Array;return new Uint8Array(e)},aY={none:{skip:!0},low:{crf:20,preset:"superfast",maxSize:1280,audioBitrate:"128k"},medium:{crf:26,preset:"superfast",maxSize:640,audioBitrate:"64k",audioSampleRate:44100},high:{crf:28,preset:"medium",maxSize:320,audioBitrate:"32k",audioSampleRate:16e3,audioChannels:1}};class MS{constructor(e){this.localStorage=e}ffmpeg=null;isLoaded=!1;loadPromise=null;onProgress;isCompressing=!1;abort(){if(this.onProgress&&this.onProgress(0),this.ffmpeg&&this.isCompressing)try{this.ffmpeg.terminate()}catch{}}setProgressCallback(e){this.onProgress=e}async loadFFmpeg(){if(!this.isLoaded)return this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{try{this.ffmpeg=new iY,this.ffmpeg.on("progress",({progress:s})=>{this.onProgress&&this.onProgress(Math.round(s*100))});const e="/ehagaki/",n=new URL(e,window.location.origin).href,r=new URL("ffmpeg-core/ffmpeg-core.js",n).href,i=new URL("ffmpeg-core/ffmpeg-core.wasm",n).href;await this.ffmpeg.load({coreURL:r,wasmURL:i}),this.isLoaded=!0}catch(e){throw console.error("[VideoCompressionService] Failed to load FFmpeg:",e),this.loadPromise=null,e}})(),this.loadPromise)}getCompressionOptions(){const e=this.localStorage.getItem("videoCompressionLevel")||"medium",n=aY[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n||null}hasCompressionSettings(){return this.getCompressionOptions()!==null}async compress(e){if(this.isCompressing=!1,Rt.value)return{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0};if(!e.type.startsWith("video/"))return{file:e,wasCompressed:!1};if(e.size<=200*1024)return{file:e,wasCompressed:!1,wasSkipped:!0};const r=this.getCompressionOptions();if(!r)return{file:e,wasCompressed:!1,wasSkipped:!0};try{if(await this.loadFFmpeg(),Rt.value)return{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0};if(!this.ffmpeg)throw new Error("FFmpeg not loaded");const i="input.mp4",s="output.mp4";await this.ffmpeg.writeFile(i,await oY(e));const o=["-i",i,"-c:v","libx264","-crf",String(r.crf),"-preset",r.preset,"-c:a","aac","-b:a",r.audioBitrate||"128k"];if(r.audioSampleRate&&o.push("-ar",String(r.audioSampleRate)),r.audioChannels&&o.push("-ac",String(r.audioChannels)),r.maxSize){const d=`scale='if(gte(iw,ih),min(${r.maxSize},iw),-2)':'if(lt(iw,ih),min(${r.maxSize},ih),-2)'`;o.push("-vf",d)}if(o.push("-movflags","+faststart","-y",s),Rt.value)return await this.ffmpeg.deleteFile(i),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0};this.isCompressing=!0;try{await this.ffmpeg.exec(o)}catch(d){if(!Rt.value)throw d}finally{this.isCompressing=!1}if(Rt.value){try{await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s)}catch{}return{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}}const a=await this.ffmpeg.readFile(s),l=new Blob([a],{type:"video/mp4"});if(await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s),l.size>=e.size)return{file:e,wasCompressed:!1};const u=e.name.replace(/\.[^.]+$/,"");return{file:new File([l],`${u}_compressed.mp4`,{type:"video/mp4"}),wasCompressed:!0}}catch(i){return this.isCompressing=!1,Rt.value?{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}:(console.error("[VideoCompressionService] Compression failed:",i),{file:e,wasCompressed:!1,wasSkipped:!0})}}async cleanup(){if(this.ffmpeg&&this.isLoaded)try{this.isLoaded=!1,this.ffmpeg=null,this.loadPromise=null}catch(e){console.error("[VideoCompressionService] Cleanup error:",e)}}}var Pl=Symbol("verified"),lY=t=>t instanceof Object;function cY(t){if(!lY(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}new TextDecoder("utf-8");var FI=new TextEncoder,uY=class{generateSecretKey(){return ns.utils.randomPrivateKey()}getPublicKey(t){return En(ns.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=En(ns.getPublicKey(e)),n.id=$0(n),n.sig=En(ns.sign($0(n),e)),n[Pl]=!0,n}verifyEvent(t){if(typeof t[Pl]=="boolean")return t[Pl];const e=$0(t);if(e!==t.id)return t[Pl]=!1,!1;try{const n=ns.verify(t.sig,e,t.pubkey);return t[Pl]=n,n}catch{return t[Pl]=!1,!1}}};function fY(t){if(!cY(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function $0(t){let e=xl(FI.encode(fY(t)));return En(e)}var fg=new uY;fg.generateSecretKey;fg.getPublicKey;fg.finalizeEvent;fg.verifyEvent;var dY=27235,hY="Nostr ";async function pY(t,e,n,r=!1,i){const s={kind:dY,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""},o=await n(s);return(r?hY:"")+gs.encode(FI.encode(JSON.stringify(o)))}const Nw=Ei([]);function gY(){return window.location.port==="4173"||window.location.hostname==="localhost"}function zI(){return gY()}function mY(...t){const e=t.map(n=>typeof n=="object"?JSON.stringify(n):String(n)).join(" ");Nw.update(n=>[e,...n].slice(0,250))}const yY=console.log;typeof window<"u"&&(window.__originalConsoleLog=yY);async function bY(t){let e=[];t?e=t:Nw.subscribe(r=>e=r)();const n=e?.join(`
`)??"";if(n){if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function")try{await navigator.clipboard.writeText(n);return}catch{}try{const r=document.createElement("textarea");r.value=n,r.setAttribute("readonly",""),r.style.position="absolute",r.style.left="-9999px",r.style.fontSize="12px",document.body.appendChild(r),r.focus(),r.select();try{r.setSelectionRange(0,r.value.length)}catch{}const i=document.execCommand&&document.execCommand("copy");if(document.body.removeChild(r),i)return;throw new Error("execCommand copy failed")}catch(r){throw r}}}typeof window<"u"&&(window.showSwUpdateModalDebug=()=>{Zv.set(!0),console.log("SW更新ボタンを強制表示しました（設定ボタンランプ＋SettingsDialog内）")});zI()&&(window.testDevLog=()=>{console.log("テスト用ログ出力:",new Date().toISOString()),mY("直接devLogに追加:",Math.random())},window.showPostSuccessDebug=()=>{Qt.postStatus={...Qt.postStatus,success:!0,error:!1,message:"post_success",completed:!0}},window.showPostErrorDebug=()=>{Qt.postStatus={...Qt.postStatus,success:!1,error:!0,message:"post_error",completed:!1}});class vY{constructor(e){this.document=e}mimeSupportCache={};webpQualitySupport;async canEncodeWebpWithQuality(){if(this.webpQualitySupport!==void 0)return this.webpQualitySupport;try{if(!this.document)return this.webpQualitySupport=!1;const e=this.document.createElement("canvas");e.width=2,e.height=2;const n=e.getContext("2d");if(!n)return this.webpQualitySupport=!1;n.fillStyle="#f00",n.fillRect(0,0,2,2);const r=e.toDataURL("image/webp",.2),i=e.toDataURL("image/webp",.9),s=r.startsWith("data:image/webp")&&i.startsWith("data:image/webp")&&r.length!==i.length;return this.webpQualitySupport=s,s}catch{return this.webpQualitySupport=!1,!1}}canEncodeMimeType(e){if(!e)return!1;if(e in this.mimeSupportCache)return this.mimeSupportCache[e];try{if(!this.document)return this.mimeSupportCache[e]=!1;const n=this.document.createElement("canvas");n.width=2,n.height=2;const r=n.getContext("2d");if(!r)return this.mimeSupportCache[e]=!1;r.fillStyle="#000",r.fillRect(0,0,2,2);const i=n.toDataURL(e),s=typeof i=="string"&&i.startsWith(`data:${e}`);return this.mimeSupportCache[e]=s,s}catch{return this.mimeSupportCache[e]=!1,!1}}}class LS{constructor(e,n){this.mimeSupport=e,this.localStorage=n}onProgress;abort(){this.onProgress&&this.onProgress(0)}setProgressCallback(e){this.onProgress=e}getCompressionOptions(){const e=this.localStorage.getItem("imageCompressionLevel")||"medium",n=qU[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n?{...n,preserveExif:!1}:null}hasCompressionSettings(){return this.getCompressionOptions()!==null}async compress(e){if(Rt.value)return{file:e,wasCompressed:!1,aborted:!0};if(!e.type.startsWith("image/"))return{file:e,wasCompressed:!1};if(e.size<=20*1024)return{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(!n)return{file:e,wasCompressed:!1,wasSkipped:!0};let r={...n,onProgress:s=>{this.onProgress&&this.onProgress(Math.round(s*100))}};if(r.fileType==="image/webp"&&(await this.mimeSupport.canEncodeWebpWithQuality()||(r.fileType=e.type==="image/png"?"image/png":"image/jpeg")),Rt.value)return{file:e,wasCompressed:!1,aborted:!0};let i=r.fileType||e.type;this.mimeSupport.canEncodeMimeType(i)||(i=e.type,delete r.fileType);try{const s=await ir(e,r);if(Rt.value)return this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0};if(s.size>=e.size)return{file:e,wasCompressed:!1};const o=r.fileType||s.type||i||e.type,a=hF(e.name,o),l=new File([s],a,{type:o});return{file:l,wasCompressed:!0}}catch(s){return Rt.value?(this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0}):(console.warn("[ImageCompressionService] Compression failed:",s),{file:e,wasCompressed:!1,wasSkipped:!0})}}}class wY{async buildAuthHeader(e,n="POST"){const r=ab.getFromStore()||ab.loadFromStorage();let i;if(r)i=s=>gy(r).signEvent(s);else{const s=window?.nostr;if(s?.signEvent)i=o=>s.signEvent(o);else throw new Error("Authentication required")}return await pY(e,n,i,!0)}}class jI{constructor(e={localStorage:window.localStorage,fetch:window.fetch.bind(window),crypto:window.crypto.subtle,document:window.document,window,navigator:window.navigator},n,r,i,s){this.dependencies=e,this.mimeSupport=s||new vY(e.document),this.imageCompressionService=r||new LS(this.mimeSupport,e.localStorage),this.videoCompressionService=i||new MS(e.localStorage),this.authService=n||new wY,this.videoCompressionService instanceof MS&&(_U(this.videoCompressionService),console.log("[FileUploadManager] VideoCompressionService registered to store")),this.imageCompressionService instanceof LS&&(kU(this.imageCompressionService),console.log("[FileUploadManager] ImageCompressionService registered to store"))}imageCompressionService;videoCompressionService;mimeSupport;authService;validateImageFile(e){return e.type.startsWith("image/")?e.size>WE?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}:{isValid:!1,errorMessage:"only_images_allowed"}}validateMediaFile(e){const n=e.type.startsWith("image/"),r=e.type.startsWith("video/");return!n&&!r?{isValid:!1,errorMessage:"only_images_or_videos_allowed"}:e.size>WE?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}}async generateBlurhashForFile(e){return await MH(e)}async createPlaceholderUrl(e){return await OH(e)}getUploadEndpoint(e){const n=this.dependencies.localStorage.getItem("uploadEndpoint"),r=i=>i&&i.trim().length>0?i:void 0;return r(n)??r(e)??ru}async pollUploadStatus(e,n,r=e0.MAX_WAIT_TIME){const i=Date.now();for(;;){if(Rt.value)throw new Error("Upload aborted by user");if(Date.now()-i>r)throw new Error(e0.TIMEOUT_MESSAGE);const s=await this.dependencies.fetch(e,{method:"GET",headers:{Authorization:n}});if(!s.ok)throw new Error(`Unexpected status code ${s.status} while polling processing_url`);let o=null;try{o=await s.json()}catch{o=null}if(s.status===201&&o)return o;if(o?.status==="processing"){await new Promise(a=>setTimeout(a,e0.RETRY_INTERVAL));continue}if(o?.status==="success")return o;if(o?.status==="error")throw new Error(o?.message||"File processing failed");if(s.status===200)return o;throw new Error("Unexpected processing status")}}async uploadFile(e,n=ru,r=!1,i,s){let o;try{if(!e)return{success:!1,error:"No file selected"};let a;try{a=await hC(e,this.dependencies.crypto)}catch{a=void 0}const l=e.size;if(Rt.value)return r&&console.log("[FileUploadManager] Upload aborted before compression"),{success:!1,error:"Upload aborted by user",aborted:!0};const c=e.type.startsWith("video/"),u=c?this.videoCompressionService:this.imageCompressionService;c&&s?.onVideoCompressionProgress&&this.videoCompressionService.setProgressCallback(s.onVideoCompressionProgress),!c&&s?.onImageCompressionProgress&&this.imageCompressionService.setProgressCallback(s.onImageCompressionProgress);const{file:f,wasCompressed:d,wasSkipped:h,aborted:p}=await u.compress(e);if(c?this.videoCompressionService.setProgressCallback(void 0):this.imageCompressionService.setProgressCallback(void 0),p)return r&&console.log("[FileUploadManager] Upload aborted by user"),{success:!1,error:"Upload aborted by user",aborted:!0};const g=f.size,m=c?this.videoCompressionService.hasCompressionSettings():this.imageCompressionService.hasCompressionSettings();o=iF(l,g,m||d,e.name,f.name,h);const v=this.getUploadEndpoint(n),x=await this.authService.buildAuthHeader(v,"POST"),C=new FormData;C.append("file",f),i?.caption&&C.append("caption",String(i.caption)),i?.expiration!==void 0&&C.append("expiration",String(i.expiration)),C.append("size",String(f.size)),i?.alt&&C.append("alt",String(i.alt)),i?.media_type&&C.append("media_type",String(i.media_type)),C.append("content_type",i?.content_type?String(i.content_type):f.type||""),C.append("no_transform",i?.no_transform?String(i.no_transform):"true");const N=await this.dependencies.fetch(v,{method:"POST",headers:{Authorization:x},body:C});if(Rt.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};if(!N.ok){const P=await N.text().catch(()=>"Unknown error");return{success:!1,error:`Upload failed: ${N.status} ${N.statusText} - ${P}`,sizeInfo:o}}let O;try{O=await N.json()}catch(P){return r&&console.error("[dev] JSON parse error:",P),{success:!1,error:"Could not parse upload response",sizeInfo:o}}if((N.status===200||N.status===202)&&O.processing_url)try{const P=await this.authService.buildAuthHeader(O.processing_url,"GET");if(O=await this.pollUploadStatus(O.processing_url,P),Rt.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0}}catch(P){return{success:!1,error:P instanceof Error?P.message:String(P),sizeInfo:o}}const A={};if(O?.nip94_event?.tags&&Array.isArray(O.nip94_event.tags))for(const P of O.nip94_event.tags){if(!Array.isArray(P)||P.length<2)continue;const S=String(P[0]),E=P.slice(1).join(" ");S in A||(A[S]=E)}if(O.status==="success"&&O.nip94_event?.tags){const P=O.nip94_event.tags.find(S=>S[0]==="url");if(P?.[1])return{success:!0,url:P[1],sizeInfo:o,nip94:A}}return{success:!1,error:O.message||"Could not extract URL from response",sizeInfo:o,nip94:Object.keys(A).length?A:void 0}}catch(a){if(Rt.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};r&&console.error("[dev] Upload error:",a);const l=a instanceof Error?a.message:String(a);return l.includes("aborted by user")?{success:!1,error:l,sizeInfo:o,aborted:!0}:{success:!1,error:l.includes("Failed to fetch")?`${l} (Service Workerが画像アップロードをブロックしている可能性があります)`:l}}}async uploadMultipleFiles(e,n=ru,r,i=!1,s,o){if(!e?.length)return[];const a=new Array(e.length);let l=0,c=0,u=0;const f=()=>r?.({completed:l,failed:c,aborted:u,total:e.length,inProgress:l+c+u<e.length});f();for(let d=0;d<e.length;d++){if(Rt.value){for(let p=d;p<e.length;p++)a[p]={success:!1,aborted:!0},u++;f();break}const h=e[d];try{const p=s?s[d]:void 0,g=await this.uploadFile(h,n,i,p,o);a[d]=g,g.success?l++:g.aborted?u++:c++,f()}catch(p){a[d]={success:!1,error:p instanceof Error?p.message:String(p)},c++,f()}}return a}async uploadFileWithCallbacks(e,n=ru,r,i=!1,s){r?.onProgress?.({completed:0,failed:0,aborted:0,total:1,inProgress:!0});try{const o=await this.uploadFile(e,n,i,s,r);if(r?.onProgress?.({completed:o.success?1:0,failed:!o.success&&!o.aborted?1:0,aborted:o.aborted?1:0,total:1,inProgress:!1}),o.success&&o.sizeInfo&&!o.aborted){const a=QE(o.sizeInfo);a&&qE(a)}return o}catch(o){return r?.onProgress?.({completed:0,failed:1,aborted:0,total:1,inProgress:!1}),{success:!1,error:o instanceof Error?o.message:String(o)}}}async uploadMultipleFilesWithCallbacks(e,n=ru,r,i){if(!e?.length)return[];r?.onProgress?.({completed:0,failed:0,aborted:0,total:e.length,inProgress:!0});const s=await this.uploadMultipleFiles(e,n,r?.onProgress,!1,i,r);if(!Rt.value){const o=s.find(a=>a.success&&a.sizeInfo);if(o?.sizeInfo){const a=QE(o.sizeInfo);a&&qE(a)}}return s}async getSharedImageFromServiceWorker(){if(!this.dependencies.navigator?.serviceWorker?.controller)return null;try{const e=new MessageChannel,n=new Promise(r=>{e.port1.onmessage=i=>{i.data?.type==="SHARED_IMAGE"?r(i.data.data):r(null)},setTimeout(()=>r(null),3e3)});return this.dependencies.navigator.serviceWorker.controller.postMessage({action:"getSharedImage"},[e.port2]),await n}catch(e){return console.error("Service Workerからの共有画像取得に失敗:",e),null}}checkIfOpenedFromShare(){return this.dependencies.window?.location?new URLSearchParams(this.dependencies.window.location.search).get("shared")==="true":!1}async processSharedImageOnLaunch(){try{const e=await this.getSharedImageFromServiceWorker();return e?.image?{success:!0,data:e,fromServiceWorker:!0}:{success:!1,error:"共有画像が見つかりません"}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}}class EY{dependencies;devMode;constructor(e,n){this.dependencies=e,this.devMode=n}async uploadFiles(e,n,r,i){const s=new this.dependencies.FileUploadManager;try{if(e.length===1)return[await s.uploadFileWithCallbacks(e[0],n,r,this.devMode,i?.[0])];if(e.length>1)return await s.uploadMultipleFilesWithCallbacks(e,n,r,i)}catch(o){if(this.devMode){const l=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";console.error(`${l} [uploadHelper] Upload error:`,o)}throw o}return null}}function N0(t,e,n,r,i,s=!1,o=!1){return r(!1),o&&n&&uI(n,s),i?.onProgress&&i.onProgress({completed:0,failed:0,aborted:t.length,total:t.length,inProgress:!1}),{placeholderMap:o?[]:e,results:null,imageOxMap:{},imageXMap:{},failedResults:[],errorMessage:"Upload aborted by user"}}const VI=()=>({localStorage:window.localStorage,crypto:window.crypto.subtle,tick:ua,FileUploadManager:jI,getImageDimensions:dF,extractImageBlurhashMap:lC,calculateImageHash:$H,getMimeTypeFromUrl:cC,createImetaTag:async t=>await aC(t),imageSizeMapStore:lb});async function xY({files:t,currentEditor:e,fileInput:n,uploadCallbacks:r,showUploadError:i,updateUploadState:s,devMode:o,dependencies:a=VI()}){const l=Array.from(t),c=a.localStorage.getItem("uploadEndpoint")||"",u={},f={},h=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:0,total:l.length,inProgress:!0}),Rt.reset();const p=new EY(a,o);let g;try{g=await OF(l,a)}catch(A){if(A instanceof Error&&A.message==="Upload aborted by user")return s(!1),r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:l.length,total:l.length,inProgress:!1}),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:f,failedResults:[],errorMessage:"Upload aborted by user"};throw A}if(Rt.value)return N0(l,[],e,s,r,o,!1);let m=UZ(l,g,e,i,a.imageSizeMapStore,a.FileUploadManager,o);if(m.length===0)return{placeholderMap:[],results:null,imageOxMap:u,imageXMap:f,failedResults:[],errorMessage:""};if(Rt.value||(s(!0,""),await HZ(m,e,a.FileUploadManager,o),Rt.value))return N0(l,m,e,s,r,o,!0);const v=m.map(A=>A.file);let x=null;try{const A=MF(v);x=await p.uploadFiles(v,c,r,A)}catch(A){const P=A instanceof Error?A.message:String(A);i(P,5e3),x=null}finally{s(!1)}if(Rt.value)return n&&(n.value=""),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:f,failedResults:[],errorMessage:"Upload aborted by user"};await a.tick();const C=[];let N="",O={};if(x&&m.length>0){const A=await FZ(x,m,e,u,f,a.imageSizeMapStore,a.extractImageBlurhashMap,a.getMimeTypeFromUrl,a.calculateImageHash,a.createImetaTag,o);C.push(...A.failedResults),N=A.errorMessage,O=A.imageServerBlurhashMap,m=[]}if(o&&e)try{const A=a.extractImageBlurhashMap(e),P=new Set([...Object.keys(A),...Object.keys(O)]);await Promise.all(Array.from(P).map(async E=>{if(!f[E]){const _=await a.calculateImageHash(E);_&&(f[E]=_)}}));const S=await Promise.all(Array.from(P).map(async E=>{const _=O[E]??A[E],k=a.getMimeTypeFromUrl(E),D=u[E],U=f[E];return(await a.createImetaTag({url:E,m:k,blurhash:_,ox:D,x:U})).join(" ")}))}catch(A){console.warn(`${h} [dev] imetaタグ生成失敗`,A)}return n&&(n.value=""),{placeholderMap:m,results:x,imageOxMap:u,imageXMap:f,failedResults:C,errorMessage:N}}function SY(t){const{onUploadProgress:e,videoCompressionProgressStore:n,imageCompressionProgressStore:r}=t;return e?{onProgress:e,onVideoCompressionProgress:i=>{n.set(i)},onImageCompressionProgress:i=>{r.set(i)}}:void 0}function $S(t,e=3e3,n){n.updateUploadState(!1,t),setTimeout(()=>n.updateUploadState(!1,""),e)}async function AY(t){const{files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,updateUploadState:s,devMode:o,imageOxMap:a,imageXMap:l,dependencies:c=VI(),getUploadFailedText:u}=t;if(!e||e.length===0)return;const f=await xY({files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,showUploadError:(d,h)=>$S(d,h,{updateUploadState:s}),updateUploadState:s,devMode:o,dependencies:c});Object.assign(a,f.imageOxMap),Object.assign(l,f.imageXMap),f.failedResults?.length&&$S(f.errorMessage||(f.failedResults.length===1?f.failedResults[0].error||u("postComponent.upload_failed"):`${f.failedResults.length}個のファイルのアップロードに失敗しました`),5e3,{updateUploadState:s}),r&&(r.value="")}async function _Y(t){const{files:e,currentEditor:n,fileInput:r,onUploadProgress:i,updateUploadState:s,imageOxMap:o,imageXMap:a,videoCompressionProgressStore:l,imageCompressionProgressStore:c,getUploadFailedText:u,dependencies:f}=t,d=SY({onUploadProgress:i,videoCompressionProgressStore:l,imageCompressionProgressStore:c});await AY({files:e,currentEditor:n,fileInput:r,uploadCallbacks:d,updateUploadState:s,devMode:!1,imageOxMap:o,imageXMap:a,dependencies:f,getUploadFailedText:u})}var kY=je('<div class="context-menu-header svelte-1ea8bn9"> </div>'),CY=async(t,e,n,r,i)=>{if($(e).icon==="/icons/copy-solid-full.svg"||/copy/i.test(String($(e).label)))try{$(e).action(),n(t)}catch(o){console.warn("Copy failed:",o),r(t)}else $(e).action();i.onClose()},TY=je('<span aria-hidden="true"></span>'),IY=je('<button role="menuitem"><!> </button>'),OY=je('<div class="context-menu svelte-1ea8bn9" role="menu" aria-label="Image context menu"><!> <!></div>');function MY(t,e){un(e,!0);let n=e.x,r=e.y,i=Se(Et(e.x)),s=Se(Et(e.y)),o=Se(void 0),a=Se(!0),l=0,c=!1;function u(S){if($(a))return;const E=Date.now();c&&E-l<500||$(o)&&!$(o).contains(S.target)&&(e.onClose(),ei.set({open:!1,nodeId:void 0}))}function f(S){$(a)||(c=!0,l=Date.now(),$(o)&&S.target instanceof Node&&!$(o).contains(S.target)&&(e.onClose(),ei.set({open:!1,nodeId:void 0})))}function d(S){S.key==="Escape"&&(e.onClose(),ei.set({open:!1,nodeId:void 0}))}async function h(){await ua();let S=$(o)?$(o).getBoundingClientRect().width:0,E=$(o)?$(o).getBoundingClientRect().height:0;(!S||S<8)&&(S=$(o)?.offsetWidth??160),(!E||E<4)&&(E=$(o)?.offsetHeight??40);const k=nc(n,r,8,S,E);se(i,k.x,!0),se(s,k.y,!0)}qe(()=>{n=e.x,r=e.y,h()});function p(){h()}Ti(()=>{setTimeout(()=>{se(a,!1),document.addEventListener("click",u),document.addEventListener("touchend",f)},0),document.addEventListener("keydown",d),window.addEventListener("resize",p),h()}),ol(()=>{document.removeEventListener("click",u),document.removeEventListener("touchend",f),document.removeEventListener("keydown",d),window.removeEventListener("resize",p)});let g=Se(null);qe(()=>{const S=e.items[0]?.src;if(typeof S=="string"){let E=S.replace(/^https?:\/\//,"");E.length>26?se(g,`${E.slice(0,18)}...${E.slice(-8)}`):se(g,E,!0)}else se(g,null)});const m=S=>{const E=Ja(mr);return typeof E=="function"?E(S):String(S)},v=Qe(()=>()=>{const S=e.items[0];if(S&&S.label){const E=typeof S.label=="string"?S.label:"";if(E===m("videoContextMenu.copyUrl")||E===m("videoContextMenu.delete"))return"video"}return"image"});function x(S){let E;S&&typeof S.clientX=="number"&&typeof S.clientY=="number"?E={x:S.clientX,y:S.clientY}:E={x:e.x,y:e.y};const _=nc(E.x,E.y),D=$(v)()==="video"?"videoContextMenu.copySuccess":"imageContextMenu.copySuccess";e.onShowPopup(_.x,_.y,m(D))}function C(S){let E;S&&typeof S.clientX=="number"&&typeof S.clientY=="number"?E={x:S.clientX,y:S.clientY}:E={x:e.x,y:e.y};const _=nc(E.x,E.y),D=$(v)()==="video"?"videoContextMenu.copyFailed":"imageContextMenu.copyFailed";e.onShowPopup(_.x,_.y,m(D))}var N=OY(),O=pe(N);{var A=S=>{var E=kY(),_=pe(E);Je(()=>Ye(_,$(g))),we(S,E)};rt(O,S=>{$(g)&&S(A)})}var P=Me(O,2);Hl(P,17,()=>e.items,S=>S.label,(S,E)=>{var _=IY();let k;_.__click=[CY,E,x,C,e];var D=pe(_);{var U=M=>{var T=TY();let L;Je(q=>L=ri(T,1,"menu-icon svg-icon svelte-1ea8bn9",null,L,q),[()=>({"expand-icon":$(E).icon==="/icons/expand-solid-full.svg","copy-icon":$(E).icon==="/icons/copy-solid-full.svg","play-pause-icon":$(E).icon==="/icons/play_pause_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg","trash-icon":$(E).icon==="/icons/trash-solid-full.svg"})]),we(M,T)};rt(D,M=>{$(E).icon&&M(U)})}var B=Me(D);Je(M=>{k=ri(_,1,"context-menu-item svelte-1ea8bn9",null,k,M),_.disabled=$(E).disabled,Ye(B,` ${$(E).label??""}`)},[()=>({disabled:$(E).disabled})]),we(S,_)}),Rn(N,S=>se(o,S),()=>$(o)),Je(()=>Wo(N,`left: ${$(i)??""}px; top: ${$(s)??""}px;`)),we(t,N),fn()}Ci(["click"]);var LY=t=>t.stopPropagation?.(),$Y=(t,e)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e())},NY=je('<div class="popup-modal svelte-1i030h4" role="dialog" aria-modal="true" tabindex="0"><div class="popup-body svelte-1i030h4" role="document"><span class="info-icon svg-icon svelte-1i030h4" aria-hidden="true"></span> <div class="popup-children svelte-1i030h4"><!></div></div></div>');function PY(t,e){un(e,!0);let n=dt(e,"show",3,!1),r=dt(e,"x",3,0),i=dt(e,"y",3,0),s=dt(e,"onClose",3,void 0),o=dt(e,"children",3,void 0);function a(){try{s()&&s()()}catch{}}function l(g){g.key==="Escape"&&a()}Ti(()=>{window.addEventListener("keydown",l)}),ol(()=>{window.removeEventListener("keydown",l)});let c=Se(void 0);qe(()=>{n()&&$(c)&&(async()=>(await ua(),$(c).parentElement!==document.body&&document.body.appendChild($(c))))()}),ol(()=>{if($(c)&&$(c).parentElement===document.body)try{document.body.removeChild($(c))}catch{}});let u=Se(Et(r())),f=Se(Et(i()));qe(()=>{(async()=>{await ua();let g=$(c)?.offsetWidth??0,m=$(c)?.offsetHeight??0;g<10&&(g=320),m<10&&(m=40);const v=nc(r(),i(),void 0,g,m);se(u,v.x,!0),se(f,v.y,!0)})()});var d=Xt(),h=vt(d);{var p=g=>{var m=NY();m.__click=[LY],m.__keydown=[$Y,a];var v=pe(m),x=Me(pe(v),2),C=pe(x);cc(C,()=>o()??xi),Rn(m,N=>se(c,N),()=>$(c)),Je(()=>Wo(m,`left: ${$(u)??""}px; top: ${$(f)??""}px;`)),we(g,m)};rt(h,g=>{n()&&g(p)})}we(t,d),fn()}Ci(["click","keydown"]);function RY(t,e){e()&&e()(t)}var DY=je("<button><!></button>");function Gt(t,e){un(e,!0);let n=dt(e,"className",3,""),r=dt(e,"disabled",3,!1),i=dt(e,"type",3,"button"),s=dt(e,"ariaLabel",3,""),o=dt(e,"style",3,""),a=dt(e,"variant",3,"default"),l=dt(e,"shape",3,"rounded"),c=dt(e,"onClick",3,void 0);var u=DY();u.__click=[RY,c];var f=pe(u);cc(f,()=>e.children??xi),Je(()=>{an(u,"type",i()),ri(u,1,`${n()} ${a()} ${l()}`,"svelte-1g7knmk"),u.disabled=r(),an(u,"aria-label",s()),Wo(u,o())}),we(t,u),fn()}Ci(["click"]);var BY=t=>t.stopPropagation(),UY=(t,e)=>{t.key==="Escape"&&e()},HY=je('<div class="xmark-icon svg-icon svelte-1vy7xud" aria-label="閉じる"></div>'),FY=je('<div class="dialog-footer svelte-1vy7xud"><!></div>'),zY=je('<div class="dialog-overlay svelte-1vy7xud" role="presentation"><div role="dialog" aria-modal="true" tabindex="0"><div class="dialog-content svelte-1vy7xud"><!></div> <!></div></div>');function $f(t,e){un(e,!0);let n=dt(e,"show",15,!1),r=dt(e,"ariaLabel",3,"Dialog"),i=dt(e,"className",3,""),s=dt(e,"showFooter",3,!1),o=dt(e,"useHistory",3,!0),a=Se(!1),l=Se(null);const c=()=>{n(!1)},u=p=>{$(a)&&p.state?.modalId!==$(l)&&c()};qe(()=>{if(typeof window>"u"){se(a,n(),!0),n()||e.onClose?.();return}if(!o()){se(a,n(),!0),n()||e.onClose?.();return}if(n()&&!$(a)){se(a,!0),$(l)||(se(l,`modal-${qp()}`),history.pushState({modalId:$(l)},"",window.location.href));return}if(!n()&&$(a)){const p=history.state?.modalId===$(l);se(a,!1),se(l,null),p&&history.back(),e.onClose?.()}}),Ti(()=>{o()&&window.addEventListener("popstate",u)}),ol(()=>{o()&&(window.removeEventListener("popstate",u),$(a)&&history.state?.modalId===$(l)&&history.back())});var f=Xt(),d=vt(f);{var h=p=>{var g=zY();g.__click=c;var m=pe(g);let v;m.__click=[BY],m.__keydown=[UY,c];var x=pe(m),C=pe(x);cc(C,()=>e.children??xi,()=>({close:c}));var N=Me(x,2);{var O=A=>{var P=FY(),S=pe(P);{var E=k=>{var D=Xt(),U=vt(D);cc(U,()=>e.footer,()=>({close:c})),we(k,D)},_=k=>{Gt(k,{className:"modal-close",onClick:c,ariaLabel:"閉じる",children:(D,U)=>{var B=HY();we(D,B)},$$slots:{default:!0}})};rt(S,k=>{e.footer?k(E):k(_,!1)})}we(A,P)};rt(N,A=>{s()&&A(O)})}Je(()=>{an(g,"aria-label",r()),v=ri(m,1,`dialog ${i()??""}`,"svelte-1vy7xud",v,{dialog:!0})}),we(p,g)};rt(d,p=>{$(a)&&p(h)})}we(t,f),fn()}Ci(["click","keydown"]);var jY=je('<div class="secretkey-dialog-content svelte-4om0n"><div class="secretkey-dialog-message svelte-4om0n"> </div> <div class="secretkey-dialog-buttons svelte-4om0n"><!> <!></div></div>');function VY(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii();let s=dt(e,"show",15,!1);{let o=Qe(()=>n()("postComponent.warning"));$f(t,{get ariaLabel(){return $(o)},get onClose(){return e.onCancel},get show(){return s()},set show(a){s(a)},children:(a,l)=>{var c=jY(),u=pe(c),f=pe(u),d=Me(u,2),h=pe(d);Gt(h,{className:"btn-confirm",variant:"danger",shape:"square",get onClick(){return e.onConfirm},children:(g,m)=>{var v=Wn();Je(x=>Ye(v,x),[()=>n()("postComponent.post")]),we(g,v)},$$slots:{default:!0}});var p=Me(h,2);Gt(p,{className:"btn-cancel",variant:"secondary",shape:"square",get onClick(){return e.onCancel},children:(g,m)=>{var v=Wn();Je(x=>Ye(v,x),[()=>n()("postComponent.cancel")]),we(g,v)},$$slots:{default:!0}}),Je(g=>Ye(f,g),[()=>n()("postComponent.secret_key_detected")]),we(a,c)},$$slots:{default:!0}})}fn(),i()}function qY(t,e,n){const r=t.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{centerX:i.x,centerY:i.y,offsetX:e-r.left-i.x,offsetY:n-r.top-i.y}}function WY(t,e){return{x:t.x-e.x,y:t.y-e.y}}function KY(t,e,n){const r=e.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{scale:n,offsetX:t.clientX-r.left-i.x,offsetY:t.clientY-r.top-i.y}}function GY({scale:t,translate:e,useTransition:n},r){const i=r??document.querySelector(".image-container");i&&(i.style.transition=n?`transform ${iC.TRANSITION_DURATION} ease`:"none",i.style.transform=`scale(${t}) translate(${e.x/t}px, ${e.y/t}px)`,i.style.transformOrigin="center")}function ZY(t,e,n,r){const i=r??document.querySelector(".image-container");i&&(i.style.transition="none",i.style.transform=`scale(${t}) translate(${e/t}px, ${n/t}px)`)}function $a(t,e){const n=e??document.querySelector(".image-container");n&&(n.style.cursor=t>wn.DEFAULT_SCALE?"grab":"default")}function cu(t,e){const n=e??document.querySelector(".fullscreen-overlay");n&&(n.style.cursor=t>wn.DEFAULT_SCALE?"grab":"default")}function Oo(t){Xr.setTransition(t)}function NS(t){const e=t?"":"none";Qa("user-select",e),Qa("-webkit-user-select",e)}function lf(t){t!==null&&clearTimeout(t)}function PS(t,e){if(t&&e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i={imageWidth:n.width,imageHeight:n.height,containerWidth:r.width,containerHeight:r.height};Xr.setBoundaryConstraints(i)}}function hd(t,e,n,r,i){t!==null&&cancelAnimationFrame(t),e!==null&&cancelAnimationFrame(e),t=null,e=null,Xr.reset(),Xr.setBoundaryConstraints(null),n.isDragging=!1,r.isPinching=!1,lf(i),lH()}function YY(t,e,n,r,i,s,o){if(!s)return{isDoubleTap:!1,newLastTapTime:t,newLastTapPosition:e,newTapTimeoutId:n};const a=Date.now(),l=e?Math.sqrt(Math.pow(r-e.x,2)+Math.pow(i-e.y,2)):0;if(a-t<200&&l<50&&n!==null)return lf(n),o(r,i),{isDoubleTap:!0,newLastTapTime:0,newLastTapPosition:null,newTapTimeoutId:null};const c=a,u={x:r,y:i};lf(n);const f=window.setTimeout(()=>{},300);return{isDoubleTap:!1,newLastTapTime:c,newLastTapPosition:u,newTapTimeoutId:f}}function RS(t,e,n,r,i,s,o,a,l,c){let u={...n},f=r,d=i,h=s;const p=YY(r,i,s,o,a,l,c);return f=p.newLastTapTime,d=p.newLastTapPosition,h=p.newTapTimeoutId,p.isDoubleTap&&l?{newDragState:u,newLastTapTime:f,newLastTapPosition:d,newTapTimeoutId:h}:(t>wn.DEFAULT_SCALE&&(u.start={x:o,y:a},u.startTranslate={...e}),{newDragState:u,newLastTapTime:f,newLastTapPosition:d,newTapTimeoutId:h})}function DS(t,e,n,r,i,s,o,a){let l={...t},c=!1;return r&&(l.start?Math.sqrt(Math.pow(e-l.start.x,2)+Math.pow(n-l.start.y,2)):0)>i&&(c=!0,!l.isDragging&&s>wn.DEFAULT_SCALE&&(o(l.start.x,l.start.y),l.isDragging=!0)),l.isDragging&&a(e,n),{newDragState:l,touchMoved:c}}function BS(t,e,n,r,i){e&&Date.now()-n<200&&!r||i()}function vb(t,e,n){return Math.max(e,Math.min(n,t))}function JY(t,e,n){return Math.abs(t-e)<n}function XY(t,e,n){const r=e.x-t.x,i=e.y-t.y;return{x:r/n*16,y:i/n*16}}function QY(t,e,n,r,i,s,o){s!==null&&cancelAnimationFrame(s);let a={...t},l={...e};const c=ZE.FRICTION,u=ZE.MIN_VELOCITY;function f(){if(a.x*=c,a.y*=c,Math.abs(a.x)<u&&Math.abs(a.y)<u){o(null),i();return}l.x+=a.x,l.y+=a.y,l=Xr.applyBoundaryConstraints(l,n),r(l),o(requestAnimationFrame(f))}o(requestAnimationFrame(f))}let qt=Et({scale:wn.DEFAULT_SCALE,translate:{x:0,y:0},useTransition:!0}),wb=null;function US(t,e){if(!wb)return t;const{imageWidth:n,imageHeight:r,containerWidth:i}=wb,s=n*e,o=r*e;let a=t.x,l=t.y;if(s>i){const f=(s-i)/2,d=-f;a=vb(a,d,f)}else a=0;const c=o/2,u=-c;return l=vb(l,u,c),{x:a,y:l}}const Xr={get state(){return qt},reset(){qt.scale=wn.DEFAULT_SCALE,qt.translate={x:0,y:0},qt.useTransition=!0},setDirectState(t){qt.scale=t.scale,qt.translate={...t.translate},qt.useTransition=t.useTransition??qt.useTransition},zoom(t){const e=vb(t.scale,wn.MIN_SCALE,wn.MAX_SCALE);if(JY(e,wn.DEFAULT_SCALE,wn.THRESHOLD)){this.reset();return}const n=e/qt.scale;qt.translate.x=qt.translate.x*n-t.offsetX*(n-1),qt.translate.y=qt.translate.y*n-t.offsetY*(n-1),qt.scale=e},zoomToPoint(t,e=0,n=0){if(qt.scale>=wn.RESET_THRESHOLD){this.reset();return}const r=t/qt.scale;qt.translate.x=qt.translate.x*r-e*(r-1),qt.translate.y=qt.translate.y*r-n*(r-1),qt.scale=t},drag(t,e,n){const r={x:n.x+t,y:n.y+e},i=US(r,qt.scale);qt.translate.x=i.x,qt.translate.y=i.y},setTransition(t){qt.useTransition=t},setBoundaryConstraints(t){wb=t},applyBoundaryConstraints(t,e){return US(t,e)}};function eJ(){return{isDragging:!1,start:{x:0,y:0},startTranslate:{x:0,y:0}}}function tJ(){return{isPinching:!1,initialDistance:0,initialScale:1,centerX:0,centerY:0}}function nJ(t,e,n){e(),n(t.clientX,t.clientY)}function rJ(t,e){t.key==="Escape"&&e()}var iJ=t=>t.stopPropagation(),sJ=(t,e)=>{t.stopPropagation(),e()},oJ=je('<div class="fullscreen-overlay svelte-mot0ha" tabindex="0" role="dialog" aria-label="画像全画面表示"><div class="close-button-container svelte-mot0ha"><button type="button" class="close-button svelte-mot0ha" aria-label="Close fullscreen image"><span class="svg-icon close-icon svelte-mot0ha"></span></button></div> <div class="image-container svelte-mot0ha"><img class="fullscreen-image svelte-mot0ha" draggable="false"/></div></div>');function aJ(t,e){un(e,!0);let n=dt(e,"src",3,""),r=dt(e,"alt",3,""),i=dt(e,"show",15,!1),s=dt(e,"onClose",3,()=>{}),o=Se(void 0),a=Se(void 0),l=Se(void 0),c=Xr.state,u=eJ(),f=tJ(),d=null,h=null,p=null,g=!1,m=0,v=null,x=null,C=0,N=!1,O=10,A=0,P={x:0,y:0},S={x:0,y:0};qe(()=>{c=Xr.state,GY({scale:c.scale,translate:c.translate,useTransition:c.useTransition??!1},$(l))});function E(me){if(me.preventDefault(),!$(l)||!$(a))return;const Ee=me.deltaY>0?wn.ZOOM_DELTA.OUT:wn.ZOOM_DELTA.IN,ve=c.scale*Ee,Oe=KY(me,$(a),ve);Xr.zoom(Oe),$a(c.scale,$(l)),cu(c.scale,$(a))}function _(me,Ee){Oo(!0),setTimeout(()=>{if(c.scale>=wn.RESET_THRESHOLD)Xr.reset();else{const ve=me!==void 0&&Ee!==void 0&&$(a)?qY($(a),me,Ee):{offsetX:0,offsetY:0};Xr.zoomToPoint(wn.DOUBLE_CLICK_SCALE,ve.offsetX,ve.offsetY)}$a(c.scale,$(l))},100)}function k(me,Ee){c.scale<=wn.DEFAULT_SCALE||(u.isDragging=!0,u.start={x:me,y:Ee},u.startTranslate={...c.translate},A=Date.now(),P={x:me,y:Ee},S={x:0,y:0},$(l)&&($(l).style.cursor="grabbing",Oo(!1)),$(a)&&($(a).style.cursor="grabbing"),NS(!1))}function D(me,Ee){u.isDragging&&(d!==null&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{const ve=WY({x:me,y:Ee},u.start);Xr.drag(ve.x,ve.y,u.startTranslate);const Oe=Date.now(),Re=Oe-A;Re>0&&(S=XY(P,{x:me,y:Ee},Re)),A=Oe,P={x:me,y:Ee}}))}function U(){u.isDragging&&(u.isDragging=!1,d!==null&&(cancelAnimationFrame(d),d=null),cs()?QY(S,c.translate,c.scale,me=>{Xr.setDirectState({...c,translate:me,useTransition:!1})},()=>{Oo(!0),$a(c.scale,$(l)),cu(c.scale,$(a))},p,me=>{p=me}):($a(c.scale,$(l)),cu(c.scale,$(a)),setTimeout(()=>Oo(!0),50)),NS(!0))}function B(){u.isDragging&&U()}function M(me){const[Ee,ve]=[me.touches[0],me.touches[1]],Oe=Ee.clientX-ve.clientX,Re=Ee.clientY-ve.clientY,nt=Math.sqrt(Oe*Oe+Re*Re);nt>wn.PINCH_MIN_DISTANCE&&(f.isPinching=!0,f.initialDistance=nt,f.initialScale=c.scale,f.centerX=(Ee.clientX+ve.clientX)/2,f.centerY=(Ee.clientY+ve.clientY)/2,Oo(!1))}function T(me){!f.isPinching||!$(a)||(h!==null&&cancelAnimationFrame(h),h=requestAnimationFrame(()=>{const[Ee,ve]=[me.touches[0],me.touches[1]],Oe=Ee.clientX-ve.clientX,Re=Ee.clientY-ve.clientY,nt=Math.sqrt(Oe*Oe+Re*Re);if(nt>wn.PINCH_MIN_DISTANCE){const He=nt/f.initialDistance,it=Math.max(wn.MIN_SCALE,Math.min(wn.MAX_SCALE,f.initialScale*He));if(!$(a))return;const at=$(a).getBoundingClientRect(),At=at.width/2,ht=at.height/2,Tt=f.centerX-at.left-At,Ce=f.centerY-at.top-ht,Be=it/c.scale,ot=c.translate.x*Be-Tt*(Be-1),ct=c.translate.y*Be-Ce*(Be-1);ZY(it,ot,ct,$(l))}}))}function L(){if(f.isPinching){if(h!==null&&(cancelAnimationFrame(h),h=null),f.isPinching=!1,$(l)){const me=$(l).style.transform,Ee=me.match(/scale\(([^)]+)\)/),ve=me.match(/translate\(([^,]+)px,\s*([^)]+)px\)/);if(Ee&&ve){const Oe=parseFloat(Ee[1]),Re=parseFloat(ve[1])*Oe,nt=parseFloat(ve[2])*Oe;Xr.setDirectState({scale:Oe,translate:{x:Re,y:nt},useTransition:!0})}}Oo(!0),$a(c.scale,$(l))}}function q(me){if(!me.target?.closest(".close-button-container"))if(me.preventDefault(),p!==null&&(cancelAnimationFrame(p),p=null,Oo(!0),$a(c.scale,$(l)),cu(c.scale,$(a))),me.touches.length===1){const Ee=me.touches[0],ve=RS(c.scale,c.translate,u,m,x,v,Ee.clientX,Ee.clientY,!0,(Oe,Re)=>_(Oe,Re));u=ve.newDragState,m=ve.newLastTapTime,x=ve.newLastTapPosition,v=ve.newTapTimeoutId}else me.touches.length===2&&(U(),lf(v),M(me))}function F(me){if(me.preventDefault(),me.touches.length===1){const Ee=me.touches[0],ve=DS(u,Ee.clientX,Ee.clientY,!0,O,c.scale,k,D);u=ve.newDragState,N=ve.touchMoved}else me.touches.length===2&&f.isPinching&&T(me)}function j(me){me.preventDefault(),me.touches.length===0?(BS(u,!0,C,N,U),L()):me.touches.length===1&&f.isPinching&&L()}function Z(me){if(me.target?.closest(".close-button-container"))return;p!==null&&(cancelAnimationFrame(p),p=null,Oo(!0),$a(c.scale,$(l)),cu(c.scale,$(a)));const Ee=RS(c.scale,c.translate,u,m,x,v,me.clientX,me.clientY,!1,(ve,Oe)=>_(ve,Oe));u=Ee.newDragState,m=Ee.newLastTapTime,x=Ee.newLastTapPosition,v=Ee.newTapTimeoutId,k(me.clientX,me.clientY)}function J(me){u.isDragging&&(me.preventDefault(),u=DS(u,me.clientX,me.clientY,!1,O,c.scale,k,D).newDragState)}function ue(){BS(u,!1,C,N,U)}function ae(me){i()&&g&&(me.preventDefault(),hd(d,h,u,f,m),d=null,h=null,m=0,v=null,i(!1),s()())}function X(){hd(d,h,u,f,m),d=null,h=null,m=0,v=null,i(!1),s()(),g&&(g=!1,history.back()),pH(nH.EDITOR,iC.EDITOR_FOCUS_DELAY)}qe(()=>{i()?(hd(d,h,u,f,m),d=null,h=null,m=0,v=null,Qa("overflow","hidden"),g||(history.pushState({imageFullscreen:!0},"",""),g=!0),$(o)&&$(o).complete&&PS($(o),$(a))):(Qa("overflow",""),g=!1)});function be(){const me=[{event:"mousemove",handler:J,target:document},{event:"mouseup",handler:ue,target:document},{event:"popstate",handler:ae,target:window}];return me.forEach(({event:Ee,handler:ve,target:Oe})=>Oe.addEventListener(Ee,ve)),me}function De(me){me.forEach(({event:Ee,handler:ve,target:Oe})=>Oe.removeEventListener(Ee,ve))}Ti(()=>{const me=be();return()=>{De(me),lf(v)}}),ol(()=>{hd(d,h,u,f,m),g=!1,x=null});var de=Xt(),ke=vt(de);{var Ze=me=>{var Ee=oJ();Ee.__keydown=[rJ,X],Ee.__mousedown=Z,Ee.__touchstart=q,Ee.__touchmove=F,Ee.__touchend=j;var ve=pe(Ee),Oe=pe(ve);Oe.__click=X,Oe.__touchstart=[iJ],Oe.__touchend=[sJ,X];var Re=Me(ve,2),nt=pe(Re);nt.__dblclick=[nJ,B,_],Rn(nt,He=>se(o,He),()=>$(o)),Rn(Re,He=>se(l,He),()=>$(l)),Rn(Ee,He=>se(a,He),()=>$(a)),Je(()=>{an(nt,"src",n()),an(nt,"alt",r())}),Ni("wheel",Ee,E),Ni("load",nt,He=>PS($(o),$(a))),we(me,Ee)};rt(ke,me=>{i()&&me(Ze)})}we(t,de),fn()}Ci(["keydown","mousedown","touchstart","touchmove","touchend","click","dblclick"]);function lJ(t,e){const n=t.target;n?.files?.length&&e(n.files)}var cJ=je('<div class="upload-error svelte-1iomqyp"> </div>'),uJ=je('<div class="copy-success-message"> </div>'),fJ=je('<div class="post-container svelte-1iomqyp"><div aria-label="テキスト入力エリア" role="textbox" tabindex="0"><!></div> <input type="file" accept="image/*,video/*" multiple style="display: none;"/> <!></div> <!> <!> <!> <!>',1);function dJ(t,e){un(e,!0);const n=()=>_n(ei,"$globalContextMenuStore",i),r=()=>_n(mr,"$_",i),[i,s]=ii();let o=Se(null),a=Se(null),l=Se(!1),c=Se(void 0),u=Se(void 0),f=Et({}),d=Et({}),h=Qe(()=>Qt.postStatus),p=Qe(()=>Qt.uploadErrorMessage),g=null,m=null,v=Qe(()=>Cs.value),x=Qe(()=>$(v).showSecretKeyDialog),C=Qe(()=>$(v).showImageFullscreen),N=Qe(()=>$(v).fullscreenImageSrc),O=Qe(()=>$(v).fullscreenImageAlt),A=Qe(()=>$(v).showPopupModal),P=Qe(()=>$(v).popupX),S=Qe(()=>$(v).popupY),E=Qe(()=>$(v).popupMessage),_=Se(Et(n())),k=Qe(()=>$(_).open),D=Se(0),U=Se(0),B=Se(Et([]));qe(()=>ei.subscribe(Be=>{se(_,Be,!0)})),qe(()=>{e.rxNostr&&($(u)?$(u).setRxNostr(e.rxNostr):se(u,new WZ(e.rxNostr),!0))});async function M(Ce){!Ce||Ce.length===0||await _Y({files:Ce,currentEditor:$(a),fileInput:$(c),onUploadProgress:e.onUploadProgress,updateUploadState:(Be,ot)=>{Qt.isUploading=Be,Qt.uploadErrorMessage=ot||""},imageOxMap:f,imageXMap:d,videoCompressionProgressStore:_u,imageCompressionProgressStore:ku,getUploadFailedText:Be=>r()(Be)})}Ti(()=>{const Ce=r()("postComponent.enter_your_text")||"テキストを入力してください";return m=DZ({placeholderText:Ce,editorContainerEl:g,currentEditor:$(a),hasStoredKey:e.hasStoredKey,submitPost:q,uploadFiles:Be=>{M(Be)},eventCallbacks:{onContentUpdate:$Z,onImageFullscreenRequest:(Be,ot)=>{Cs.showImageFullscreen(Be,ot)},onSelectImageNode:Be=>{}}}),se(o,m.editor,!0),$(o).subscribe(Be=>{se(a,Be,!0),TI.set(Be)}),()=>{m&&BZ({unsubscribe:m.unsubscribe,handlers:m.handlers,gboardCleanup:m.gboardCleanup,currentEditor:$(a),editorContainerEl:g})}});async function T(Ce){await M(Ce)}function L(Ce){if(!$(a)||!Ce)return;const Be=$(a),ct=Ce.split(`
`).map(Zt=>({type:"paragraph",content:Zt?[{type:"text",text:Zt}]:void 0}));Be.commands.setContent({type:"doc",content:ct}),Be.commands.focus("end")}async function q(){if(!$(u)||!$(a))return;const Ce=$(u).preparePostContent($(a));if(oF(Ce)){Cs.showSecretKeyDialog(Ce);return}await $(u).performPostSubmission($(a),f,d,()=>Ls({sending:!0,success:!1,error:!1,message:"",completed:!1}),()=>{Ls({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),j(),e.onPostSuccess?.()},Be=>Ls({sending:!1,success:!1,error:!0,message:Be||"postComponent.post_error",completed:!1}))}function F(){$(u)&&$(a)&&$(u).resetPostContent($(a))}function j(){$(u)&&$(a)&&$(u).clearContentAfterSuccess($(a))}function Z(){pa.querySelector(".tiptap-editor")?.focus()}async function J(){const Ce=Cs.getPendingPost();if(Cs.hideSecretKeyDialog(),$(u)&&$(a)){const Be=$(u).prepareImageBlurhashMap($(a),f,d);Ls({sending:!0,success:!1,error:!1,message:"",completed:!1});try{const ot=await $(u).submitPost(Ce,Be);ot.success?(Ls({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),j(),e.onPostSuccess?.()):Ls({sending:!1,success:!1,error:!0,message:ot.error||"postComponent.post_error",completed:!1})}catch{Ls({sending:!1,success:!1,error:!0,message:"postComponent.post_error",completed:!1})}}}function ue(){Cs.hideSecretKeyDialog()}function ae(){Cs.hideImageFullscreen(),setTimeout(()=>{pa.querySelector(".tiptap-editor")?.focus()},150)}qe(()=>{if($(k)&&$(_).nodeId){const Ce=$(_).nodeId;let Be=!1;$(a)?.state?.doc&&$(a).state.doc.descendants(ct=>{if(ct.attrs.id===Ce)return Be=ct.type.name==="video",!1});let ot;Be?ot=QG($(_),$(a),Zs.value):ot=FG($(_),$(a),Zs.value),ot&&(se(B,ot.items,!0),se(D,ot.x,!0),se(U,ot.y,!0))}}),qe(()=>{$(a)&&$(u)&&$(u).preparePostContent($(a))!==Qt.content&&$(h).error&&Ls({...$(h),error:!1,message:""})}),qe(()=>{Xh.value&&$(o)?.updatePlaceholder&&setTimeout(()=>$(o)&&$(o).updatePlaceholder?.(Xh.value),0)});function X(){$(c)?.click()}var be={uploadFiles:T,insertTextContent:L,submitPost:q,resetPostContent:F,clearContentAfterSuccess:j,focusEditor:Z,openFileDialog:X},De=fJ(),de=vt(De),ke=pe(de);let Ze;var me=pe(ke);{var Ee=Ce=>{VW(Ce,{get editor(){return $(a)},class:"editor-content"})};rt(me,Ce=>{$(o)&&$(a)&&Ce(Ee)})}Yf(ke,(Ce,Be)=>EZ?.(Ce,Be),()=>({dragOver:Ce=>se(l,Ce,!0)})),Yf(ke,Ce=>xZ?.(Ce)),Yf(ke,Ce=>SZ?.(Ce)),Yf(ke,Ce=>AZ?.(Ce)),Rn(ke,Ce=>g=Ce,()=>g);var ve=Me(ke,2);ve.__change=[lJ,M],Rn(ve,Ce=>se(c,Ce),()=>$(c));var Oe=Me(ve,2);{var Re=Ce=>{var Be=cJ(),ot=pe(Be);Je(()=>Ye(ot,$(p))),we(Ce,Be)};rt(Oe,Ce=>{$(p)&&Ce(Re)})}var nt=Me(de,2);VY(nt,{onConfirm:J,onCancel:ue,get show(){return $(x)},set show(Ce){se(x,Ce)}});var He=Me(nt,2);aJ(He,{get src(){return $(N)},get alt(){return $(O)},onClose:ae,get show(){return $(C)},set show(Ce){se(C,Ce)}});var it=Me(He,2);{var at=Ce=>{MY(Ce,{get x(){return $(D)},get y(){return $(U)},get items(){return $(B)},onClose:()=>ei.set({open:!1,nodeId:void 0,src:void 0}),get onShowPopup(){return Cs.showPopupMessage}})};rt(it,Ce=>{$(k)&&Ce(at)})}var At=Me(it,2);{var ht=Ce=>{PY(Ce,{get show(){return $(A)},get x(){return $(P)},get y(){return $(S)},onClose:()=>Cs.hidePopupMessage(),children:(Be,ot)=>{var ct=uJ(),Zt=pe(ct);Je(()=>Ye(Zt,$(E))),we(Be,ct)},$$slots:{default:!0}})};rt(At,Ce=>{$(A)&&Ce(ht)})}Je(Ce=>Ze=ri(ke,1,"editor-container svelte-1iomqyp",null,Ze,Ce),[()=>({"drag-over":$(l)})]),we(t,De);var Tt=fn(be);return s(),Tt}Ci(["change"]);/*! MIT License

Copyright (c) 2024 Lokuyow

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
 */var hJ={203:(t,e)=>{function n(E){if(!Number.isSafeInteger(E))throw new Error(`Wrong integer: ${E}`)}function r(...E){const _=(U,B)=>M=>U(B(M)),k=Array.from(E).reverse().reduce(((U,B)=>U?_(U,B.encode):B.encode),void 0),D=E.reduce(((U,B)=>U?_(U,B.decode):B.decode),void 0);return{encode:k,decode:D}}function i(E){return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return _.map((k=>{if(n(k),k<0||k>=E.length)throw new Error(`Digit index outside alphabet: ${k} (alphabet: ${E.length})`);return E[k]}))},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("alphabet.decode input should be array of strings");return _.map((k=>{if(typeof k!="string")throw new Error(`alphabet.decode: not string element=${k}`);const D=E.indexOf(k);if(D===-1)throw new Error(`Unknown letter: "${k}". Allowed: ${E}`);return D}))}}}function s(E=""){if(typeof E!="string")throw new Error("join separator should be string");return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("join.encode input should be array of strings");for(let k of _)if(typeof k!="string")throw new Error(`join.encode: non-string input=${k}`);return _.join(E)},decode:_=>{if(typeof _!="string")throw new Error("join.decode input should be string");return _.split(E)}}}function o(E,_="="){if(n(E),typeof _!="string")throw new Error("padding chr should be string");return{encode(k){if(!Array.isArray(k)||k.length&&typeof k[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of k)if(typeof D!="string")throw new Error(`padding.encode: non-string input=${D}`);for(;k.length*E%8;)k.push(_);return k},decode(k){if(!Array.isArray(k)||k.length&&typeof k[0]!="string")throw new Error("padding.encode input should be array of strings");for(let U of k)if(typeof U!="string")throw new Error(`padding.decode: non-string input=${U}`);let D=k.length;if(D*E%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;D>0&&k[D-1]===_;D--)if(!((D-1)*E%8))throw new Error("Invalid padding: string has too much padding");return k.slice(0,D)}}}function a(E){if(typeof E!="function")throw new Error("normalize fn should be function");return{encode:_=>_,decode:_=>E(_)}}function l(E,_,k){if(_<2)throw new Error(`convertRadix: wrong from=${_}, base cannot be less than 2`);if(k<2)throw new Error(`convertRadix: wrong to=${k}, base cannot be less than 2`);if(!Array.isArray(E))throw new Error("convertRadix: data should be array");if(!E.length)return[];let D=0;const U=[],B=Array.from(E);for(B.forEach((M=>{if(n(M),M<0||M>=_)throw new Error(`Wrong integer: ${M}`)}));;){let M=0,T=!0;for(let L=D;L<B.length;L++){const q=B[L],F=_*M+q;if(!Number.isSafeInteger(F)||_*M/_!==M||F-q!=_*M)throw new Error("convertRadix: carry overflow");if(M=F%k,B[L]=Math.floor(F/k),!Number.isSafeInteger(B[L])||B[L]*k+M!==F)throw new Error("convertRadix: carry overflow");T&&(B[L]?T=!1:D=L)}if(U.push(M),T)break}for(let M=0;M<E.length-1&&E[M]===0;M++)U.push(0);return U.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const c=(E,_)=>_?c(_,E%_):E,u=(E,_)=>E+(_-c(E,_));function f(E,_,k,D){if(!Array.isArray(E))throw new Error("convertRadix2: data should be array");if(_<=0||_>32)throw new Error(`convertRadix2: wrong from=${_}`);if(k<=0||k>32)throw new Error(`convertRadix2: wrong to=${k}`);if(u(_,k)>32)throw new Error(`convertRadix2: carry overflow from=${_} to=${k} carryBits=${u(_,k)}`);let U=0,B=0;const M=2**k-1,T=[];for(const L of E){if(n(L),L>=2**_)throw new Error(`convertRadix2: invalid data word=${L} from=${_}`);if(U=U<<_|L,B+_>32)throw new Error(`convertRadix2: carry overflow pos=${B} from=${_}`);for(B+=_;B>=k;B-=k)T.push((U>>B-k&M)>>>0);U&=2**B-1}if(U=U<<k-B&M,!D&&B>=_)throw new Error("Excess padding");if(!D&&U)throw new Error(`Non-zero padding: ${U}`);return D&&B>0&&T.push(U>>>0),T}function d(E){return n(E),{encode:_=>{if(!(_ instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return l(Array.from(_),256,E)},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(l(_,E,256))}}}function h(E,_=!1){if(n(E),E<=0||E>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,E)>32||u(E,8)>32)throw new Error("radix2: carry overflow");return{encode:k=>{if(!(k instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return f(Array.from(k),8,E,!_)},decode:k=>{if(!Array.isArray(k)||k.length&&typeof k[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(f(k,E,8,_))}}}function p(E){if(typeof E!="function")throw new Error("unsafeWrapper fn should be function");return function(..._){try{return E.apply(null,_)}catch{}}}function g(E,_){if(n(E),typeof _!="function")throw new Error("checksum fn should be function");return{encode(k){if(!(k instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const D=_(k).slice(0,E),U=new Uint8Array(k.length+E);return U.set(k),U.set(D,k.length),U},decode(k){if(!(k instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const D=k.slice(0,-E),U=_(D).slice(0,E),B=k.slice(-E);for(let M=0;M<E;M++)if(U[M]!==B[M])throw new Error("Invalid checksum");return D}}}e.utils={alphabet:i,chain:r,checksum:g,radix:d,radix2:h,join:s,padding:o},e.base16=r(h(4),i("0123456789ABCDEF"),s("")),e.base32=r(h(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),e.base32hex=r(h(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),e.base32crockford=r(h(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((E=>E.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),e.base64url=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const m=E=>r(d(58),i(E),s(""));e.base58=m("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=m("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=m("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const v=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(E){let _="";for(let k=0;k<E.length;k+=8){const D=E.subarray(k,k+8);_+=e.base58.encode(D).padStart(v[D.length],"1")}return _},decode(E){let _=[];for(let k=0;k<E.length;k+=11){const D=E.slice(k,k+11),U=v.indexOf(D.length),B=e.base58.decode(D);for(let M=0;M<B.length-U;M++)if(B[M]!==0)throw new Error("base58xmr: wrong padding");_=_.concat(Array.from(B.slice(B.length-U)))}return Uint8Array.from(_)}},e.base58check=E=>r(g(4,(_=>E(E(_)))),e.base58);const x=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),C=[996825010,642813549,513874426,1027748829,705979059];function N(E){const _=E>>25;let k=(33554431&E)<<5;for(let D=0;D<C.length;D++)(_>>D&1)==1&&(k^=C[D]);return k}function O(E,_,k=1){const D=E.length;let U=1;for(let B=0;B<D;B++){const M=E.charCodeAt(B);if(M<33||M>126)throw new Error(`Invalid prefix (${E})`);U=N(U)^M>>5}U=N(U);for(let B=0;B<D;B++)U=N(U)^31&E.charCodeAt(B);for(let B of _)U=N(U)^B;for(let B=0;B<6;B++)U=N(U);return U^=k,x.encode(f([U%2**30],30,5,!1))}function A(E){const _=E==="bech32"?1:734539939,k=h(5),D=k.decode,U=k.encode,B=p(D);function M(T,L=90){if(typeof T!="string")throw new Error("bech32.decode input should be string, not "+typeof T);if(T.length<8||L!==!1&&T.length>L)throw new TypeError(`Wrong string length: ${T.length} (${T}). Expected (8..${L})`);const q=T.toLowerCase();if(T!==q&&T!==T.toUpperCase())throw new Error("String must be lowercase or uppercase");const F=(T=q).lastIndexOf("1");if(F===0||F===-1)throw new Error('Letter "1" must be present between prefix and data only');const j=T.slice(0,F),Z=T.slice(F+1);if(Z.length<6)throw new Error("Data must be at least 6 characters long");const J=x.decode(Z).slice(0,-6),ue=O(j,J,_);if(!Z.endsWith(ue))throw new Error(`Invalid checksum in ${T}: expected "${ue}"`);return{prefix:j,words:J}}return{encode:function(T,L,q=90){if(typeof T!="string")throw new Error("bech32.encode prefix should be string, not "+typeof T);if(!Array.isArray(L)||L.length&&typeof L[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof L);const F=T.length+7+L.length;if(q!==!1&&F>q)throw new TypeError(`Length ${F} exceeds limit ${q}`);return`${T=T.toLowerCase()}1${x.encode(L)}${O(T,L,_)}`},decode:M,decodeToBytes:function(T){const{prefix:L,words:q}=M(T,!1);return{prefix:L,words:q,bytes:D(q)}},decodeUnsafe:p(M),fromWords:D,fromWordsUnsafe:B,toWords:U}}e.bech32=A("bech32"),e.bech32m=A("bech32m"),e.utf8={encode:E=>new TextDecoder().decode(E),decode:E=>new TextEncoder().encode(E)},e.hex=r(h(4),i("0123456789abcdef"),s(""),a((E=>{if(typeof E!="string"||E.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof E} with length ${E.length}`);return E.toLowerCase()})));const P={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},S=`Invalid encoding type. Available types: ${Object.keys(P).join(", ")}`;e.bytesToString=(E,_)=>{if(typeof E!="string"||!P.hasOwnProperty(E))throw new TypeError(S);if(!(_ instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return P[E].encode(_)},e.str=e.bytesToString,e.stringToBytes=(E,_)=>{if(!P.hasOwnProperty(E))throw new TypeError(S);if(typeof _!="string")throw new TypeError("stringToBytes() expects string");return P[E].decode(_)},e.bytes=e.stringToBytes},806:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([t.id,`.zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

/* Color Classes Generator */
[class*="zap-amount-"] .zap-sender {
  border-radius: 6px;
}

[class*="zap-amount-"] .zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

[class*="zap-amount-"] .zap-details {
  padding-top: 8px;
  padding-bottom: 8px;
}

/* Amount-based Styles */
.zap-amount-100 .zap-sender {
  background-color: var(--zap-100);
}

.zap-amount-200 .zap-sender {
  background-color: var(--zap-200);
}

.zap-amount-500 .zap-sender {
  background-color: var(--zap-500);
}

.zap-amount-1k .zap-sender {
  background-color: var(--zap-1k);
}

.zap-amount-2k .zap-sender {
  background-color: var(--zap-2k);
}

.zap-amount-5k .zap-sender {
  background-color: var(--zap-5k);
}

.zap-amount-10k .zap-sender {
  background-color: var(--zap-10k);
}

/* Details Background Colors */
.zap-amount-100 .zap-details {
  background-color: var(--zap-100-light);
}

.zap-amount-200 .zap-details {
  background-color: var(--zap-200-light);
}

.zap-amount-500 .zap-details {
  background-color: var(--zap-500-light);
}

.zap-amount-1k .zap-details {
  background-color: var(--zap-1k-light);
}

.zap-amount-2k .zap-details {
  background-color: var(--zap-2k-light);
}

.zap-amount-5k .zap-details {
  background-color: var(--zap-5k-light);
}

.zap-amount-10k .zap-details {
  background-color: var(--zap-10k-light);
}

/* Dark Text Colors */
.zap-amount-100,
.zap-amount-2k,
.zap-amount-5k,
.zap-amount-10k {
  .zap-amount {
    color: var(--text-light);
  }

  .sender-name {
    color: var(--text-light-secondary);
  }

  .sender-pubkey {
    color: var(--text-light-tertiary);
  }

  .zap-comment {
    color: var(--text-light);
  }
}

/* Light Text Colors */
.zap-amount-200,
.zap-amount-500,
.zap-amount-1k {
  .zap-amount {
    color: var(--text-dark);
  }

  .sender-name {
    color: var(--text-dark-secondary);
  }

  .sender-pubkey {
    color: var(--text-dark-tertiary);
  }

  .zap-comment {
    color: var(--text-dark);
  }
}`,""]);const a=o},540:(t,e,n)=>{n.r(e),n.d(e,{default:()=>c});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(806),l=o()(i());l.i(a.A),l.push([t.id,`/* styles.css */

:host {
  --main-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  --main-text: Black;
  --pubkey-text: #888;
  --custom-title-text: #555;
  --stats-item-text: #333;
  --name-text: #444;
  --dialog-bg: #ffffff;
  --zap-stats-bg: #edf2f7;
  --hover-bg: #edf2f7;
  --border: #ddd;
  --skeleton: #fdfdfd;
  --skeleton2: #e2e5ec;
  --zap-stats-skeleton-bg: #bbc5cf;
  --new-mark: #22c55e;

  /* Zap Amount Colors */
  --zap-100: #1565c0;
  --zap-200: #00b8d4;
  --zap-500: #00bfa5;
  --zap-1k: #ffb300;
  --zap-2k: #e65100;
  --zap-5k: #c2185b;
  --zap-10k: #d00000;

  /* Light Variants */
  --zap-100-light: #1e88e5;
  --zap-200-light: #00e5ff;
  --zap-500-light: #1de9b6;
  --zap-1k-light: #ffca28;
  --zap-2k-light: #f57c00;
  --zap-5k-light: #e91e63;
  --zap-10k-light: #e62117;

  /* Text Colors */
  --text-light: #ffffff;
  --text-light-secondary: rgba(255, 255, 255, 0.9);
  --text-light-tertiary: rgba(255, 255, 255, 0.5);
  --text-dark: #000000;
  --text-dark-secondary: rgba(0, 0, 0, 0.7);
  --text-dark-tertiary: rgba(0, 0, 0, 0.5);
}

* {
  box-sizing: border-box;
}

button {
  color: var(--main-text);
  background: none;
  border: none;
  cursor: pointer;
}

.dialog {
  font-family: var(--main-font);
  color: var(--main-text);
  font-size: medium;
  font-weight: normal;
  max-height: 700px;
  height: 100dvh;
  width: 360px;
  margin: auto;
  padding: 0;
  border: none;
  border-radius: 10px;
  background: var(--dialog-bg);
  display: flex;
  flex-direction: column;
}

.close-dialog-button {
  color: var(--custom-title-text);
  font-size: 16px;
  font-weight: 500;
  position: absolute;
  right: 0;
  width: 2.625rem;
  height: 2.625rem;
  border: none;
  border-radius: 50%;
  background: none;
  cursor: pointer;
  padding: 10px;
  text-align: center;
}

.close-dialog-button:hover {
  background-color: var(--hover-bg);
}

.dialog-title {
  height: 42px;
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;

  & a {
    font-size: 0.9rem;
    font-weight: normal;
    color: var(--pubkey-text);
    text-decoration: none;
    cursor: pointer;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
  }

  & a:hover {
    text-decoration: underline;
  }
}

.dialog-title.custom-title a {
  color: var(--custom-title-text);
  font-weight: 600;
  font-size: 1rem;
}

.zap-stats {
  min-height: 80px;
  padding: 6px 14px;
  background: var(--zap-stats-bg);
  border-radius: 6px;
  display: grid;
  grid-template-columns: 90px 1fr 40px;
  grid-template-rows: repeat(3, 1fr);
  gap: 4px;
  margin: 0 8px;

  .stats-item {
    height: 23px;
    color: var(--stats-item-text);
    font-size: 0.9rem;

    .number {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .number.skeleton {
      width: 100%;
      background: linear-gradient(90deg,
          var(--skeleton) 0%,
          var(--zap-stats-skeleton-bg) 50%,
          var(--skeleton) 100%);
      background-size: 200% 100%;
    }
  }
}

.stats-item:nth-child(3n + 1) {
  justify-content: flex-start;
}

.stats-item:nth-child(3n + 2),
.stats-item:nth-child(3n + 3) {
  justify-content: flex-end;
}

.text-muted {
  margin-right: 16px;
  opacity: 0.4;
}

.dialog-zap-list {
  list-style-type: none;
  margin: 10px 0;
  padding: 0 6px;
  flex: 1;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: smooth;

  /* スクロールバーのスタイリング */
  &::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 3px;
  }

  &::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    transition: background 0.2s;
  }

  &::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.2);
  }

  /* Firefox用のスクロールバースタイル */
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
}

.zap-list-item {
  display: flex;
  flex-direction: column;
  border-top: 1px solid var(--border);
  padding: 4px 0;
}

.zap-content {
  display: flex;
  flex-direction: column;
}

.reference-container {
  display: flex;
  flex-direction: column;
}

.zap-sender {
  gap: 12px;
  height: 46px;
  justify-content: space-between;
  padding: 6px;
}

.sender-icon {
  flex-shrink: 0;

  & img {
    width: 100%;
    height: 100%;
    border-radius: 4px;
    object-fit: cover;
    object-position: center;
  }
}

.sender-icon.is-new::before {
  content: "";
  position: absolute;
  top: -4px;
  left: -4px;
  width: 8px;
  height: 8px;
  background-color: var(--new-mark);
  border: 1px solid #fff;
  border-radius: 50%;
  z-index: 1;
  animation: pulse 2500ms cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  50% {
    opacity: 0.3;
  }
}

.sender-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  overflow: hidden;
  min-width: 0;
}

.sender-name {
  font-size: 0.9375rem;
  font-weight: bold;
  color: var(--name-text);
}

.sender-pubkey {
  font-size: 0.625rem;
  color: var(--pubkey-text);
  margin-top: -1px;
}

.zap-amount {
  font-size: 0.8rem;
  white-space: nowrap;
  flex-shrink: 0;

  .number {
    font-size: 1.4rem;
    font-weight: 500;
    text-align: right;
  }
}

.zap-details {
  padding: 2px 8px;
  border-radius: 0 0 6px 6px;
  margin: 0;
}

.zap-comment {
  font-size: 0.9375rem;
  margin: 0;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  max-width: 100%;
}

.no-zaps-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

.no-zaps-message {
  text-align: center;
  color: var(--pubkey-text);
  font-size: 1.8rem;
  font-weight: 700;
}

.zap-reference {
  padding: 2px 0 2px 12px;
  margin: 0;
  font-size: 0.875rem;
  color: var(--pubkey-text);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.reference-arrow {
  flex-shrink: 0;

  img {
    height: 16px;
    width: auto;
  }
}

.reference-text {
  font-size: 0.75rem;
  margin: 0 2px;
  flex-grow: 1;
}

.reference-link {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 1.5rem;
  width: 2.6rem;
  text-decoration: none;
  border-left: 1px solid var(--border);
  flex-shrink: 0;

  & img {
    height: 20px;
    width: auto;
  }
}

.zap-placeholder-name {
  height: 30px;
  width: 140px;
}

.zap-placeholder-name.skeleton {
  width: 120px;
  height: 19px;
  margin: 2px 0;
}

.skeleton {
  color: transparent;
  border-radius: 2px;
  background: linear-gradient(90deg,
      var(--skeleton) 0%,
      var(--skeleton2) 50%,
      var(--skeleton) 100%);
  background-size: 200% 100%;
  animation: loading-animation 3.5s infinite;
  opacity: 0.7;
}

@keyframes loading-animation {
  0% {
    background-position: 200% 0;
  }

  100% {
    background-position: -200% 0;
  }
}

/* 共通のテキストオーバーフロー処理 */
.dialog-title,
.sender-name,
.sender-pubkey,
.reference-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* 共通のフレックスボックス設定 */
.zap-sender,
.stats-item,
.zap-details,
.reference-link,
.zap-reference {
  display: flex;
  align-items: center;
}

/* 共通のアイコンサイズ */
.zap-placeholder-icon,
.sender-icon {
  width: 32px;
  height: 32px;
  border-radius: 4px;
  position: relative;
}

.load-more-trigger {
  height: 40px;
  margin: 10px 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--zap-stats-bg);
  border-top: 3px solid var(--pubkey-text);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}`,""]);const c=l},314:t=>{t.exports=function(e){var n=[];return n.toString=function(){return this.map((function(r){var i="",s=r[5]!==void 0;return r[4]&&(i+="@supports (".concat(r[4],") {")),r[2]&&(i+="@media ".concat(r[2]," {")),s&&(i+="@layer".concat(r[5].length>0?" ".concat(r[5]):""," {")),i+=e(r),s&&(i+="}"),r[2]&&(i+="}"),r[4]&&(i+="}"),i})).join("")},n.i=function(r,i,s,o,a){typeof r=="string"&&(r=[[null,r,void 0]]);var l={};if(s)for(var c=0;c<this.length;c++){var u=this[c][0];u!=null&&(l[u]=!0)}for(var f=0;f<r.length;f++){var d=[].concat(r[f]);s&&l[d[0]]||(a!==void 0&&(d[5]===void 0||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),i&&(d[2]&&(d[1]="@media ".concat(d[2]," {").concat(d[1],"}")),d[2]=i),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),n.push(d))}},n}},601:t=>{t.exports=function(e){return e[1]}},705:(t,e,n)=>{const{bech32:r,hex:i,utf8:s}=n(203),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},f=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],d={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},h=BigInt("2100000000000000000"),p=BigInt(1e11),g={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},m={};for(let O=0,A=Object.keys(g);O<A.length;O++){const P=A[O],S=g[A[O]].toString();m[S]=P}const v={1:O=>i.encode(r.fromWordsUnsafe(O)),16:O=>i.encode(r.fromWordsUnsafe(O)),13:O=>s.encode(r.fromWordsUnsafe(O)),19:O=>i.encode(r.fromWordsUnsafe(O)),23:O=>i.encode(r.fromWordsUnsafe(O)),27:O=>i.encode(r.fromWordsUnsafe(O)),6:C,24:C,3:function(O){const A=[];let P,S,E,_,k,D=r.fromWordsUnsafe(O);for(;D.length>0;)P=i.encode(D.slice(0,33)),S=i.encode(D.slice(33,41)),E=parseInt(i.encode(D.slice(41,45)),16),_=parseInt(i.encode(D.slice(45,49)),16),k=parseInt(i.encode(D.slice(49,51)),16),D=D.slice(51),A.push({pubkey:P,short_channel_id:S,fee_base_msat:E,fee_proportional_millionths:_,cltv_expiry_delta:k});return A},5:function(O){const A=O.slice().reverse().map((E=>[!!(1&E),!!(2&E),!!(4&E),!!(8&E),!!(16&E)])).reduce(((E,_)=>E.concat(_)),[]);for(;A.length<2*f.length;)A.push(!1);const P={};f.forEach(((E,_)=>{let k;k=A[2*_]?"required":A[2*_+1]?"supported":"unsupported",P[E]=k}));const S=A.slice(2*f.length);return P.extra_bits={start_bit:2*f.length,bits:S,has_required:S.reduce(((E,_,k)=>k%2!=0?E||!1:E||_),!1)},P}};function x(O){return A=>({tagCode:parseInt(O),words:r.encode("unknown",A,Number.MAX_SAFE_INTEGER)})}function C(O){return O.reverse().reduce(((A,P,S)=>A+P*Math.pow(32,S)),0)}function N(O,A){let P,S;if(O.slice(-1).match(/^[munp]$/))P=O.slice(-1),S=O.slice(0,-1);else{if(O.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");S=O}if(!S.match(/^\d+$/))throw new Error("Not a valid human readable amount");const E=BigInt(S),_=P?E*p/d[P]:E*p;if(P==="p"&&E%BigInt(10)!==BigInt(0)||_>h)throw new Error("Amount is outside of valid range");return A?_.toString():_}t.exports={decode:function(O,A){if(typeof O!="string")throw new Error("Lightning Payment Request must be string");if(O.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const P=[],S=r.decode(O,Number.MAX_SAFE_INTEGER);O=O.toLowerCase();const E=S.prefix;let _=S.words,k=O.slice(E.length+1),D=_.slice(-104);_=_.slice(0,-104);let U=E.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(U&&!U[2]&&(U=E.match(/^ln(\S+)$/)),!U)throw new Error("Not a proper lightning payment request");P.push({name:"lightning_network",letters:"ln"});const B=U[1];let M;if(A){if(A.bech32===void 0||A.pubKeyHash===void 0||A.scriptHash===void 0||!Array.isArray(A.validWitnessVersions))throw new Error("Invalid network");M=A}else switch(B){case o.bech32:M=o;break;case a.bech32:M=a;break;case l.bech32:M=l;break;case c.bech32:M=c;break;case u.bech32:M=u}if(!M||M.bech32!==B)throw new Error("Unknown coin bech32 prefix");P.push({name:"coin_network",letters:B,value:M});const T=U[2];let L;T?(L=N(T+U[3],!0),P.push({name:"amount",letters:U[2]+U[3],value:L})):L=null,P.push({name:"separator",letters:"1"});const q=C(_.slice(0,7));let F,j,Z,J;for(_=_.slice(7),P.push({name:"timestamp",letters:k.slice(0,7),value:q}),k=k.slice(7);_.length>0;){const X=_[0].toString();F=m[X]||"unknown_tag",j=v[X]||x(X),_=_.slice(1),Z=C(_.slice(0,2)),_=_.slice(2),J=_.slice(0,Z),_=_.slice(Z),P.push({name:F,tag:k[0],letters:k.slice(0,3+Z),value:j(J)}),k=k.slice(3+Z)}P.push({name:"signature",letters:k.slice(0,104),value:i.encode(r.fromWordsUnsafe(D))}),k=k.slice(104),P.push({name:"checksum",letters:k});let ue={paymentRequest:O,sections:P,get expiry(){let X=P.find((be=>be.name==="expiry"));if(X)return ae("timestamp")+X.value},get route_hints(){return P.filter((X=>X.name==="route_hint")).map((X=>X.value))}};for(let X in g)X!=="route_hint"&&Object.defineProperty(ue,X,{get:()=>ae(X)});return ue;function ae(X){let be=P.find((De=>De.name===X));return be?be.value:void 0}},hrpToMillisat:N}},0:(t,e,n)=>{var r=n(540);r&&r.__esModule&&(r=r.default),t.exports=typeof r=="string"?r:r.toString()}},HS={};function cr(t){var e=HS[t];if(e!==void 0)return e.exports;var n=HS[t]={id:t,exports:{}};return hJ[t](n,n.exports,cr),n.exports}cr.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return cr.d(e,{a:e}),e},cr.d=(t,e)=>{for(var n in e)cr.o(e,n)&&!cr.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},cr.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),cr.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var ws={};cr.d(ws,{vQ:()=>ut,ZM:()=>hf,yk:()=>et,h0:()=>Za,n_:()=>s8,Xz:()=>ate,Uv:()=>pf,fU:()=>gf,Dw:()=>ss});var Eb={};cr.r(Eb),cr.d(Eb,{OG:()=>Bw,My:()=>kc,Ph:()=>Ur,lX:()=>Rw,Id:()=>yl,fg:()=>YI,qj:()=>lr,aT:()=>cf,lq:()=>aa,z:()=>Dw,Q5:()=>uf});var xb={};cr.r(xb),cr.d(xb,{Relay:()=>o5,SimplePool:()=>IQ,finalizeEvent:()=>Fi,fj:()=>Q4,generateSecretKey:()=>B4,getEventHash:()=>Bu,getFilterLimit:()=>EQ,getPublicKey:()=>Zw,kinds:()=>U4,matchFilter:()=>J4,matchFilters:()=>X4,mergeFilters:()=>wQ,nip04:()=>c5,nip05:()=>d5,nip10:()=>p5,nip11:()=>g5,nip13:()=>m5,nip18:()=>v5,nip19:()=>a5,nip21:()=>E5,nip25:()=>x5,nip27:()=>S5,nip28:()=>A5,nip30:()=>_5,nip39:()=>C5,nip42:()=>n5,nip44:()=>T5,nip47:()=>$5,nip57:()=>N5,nip59:()=>P5,nip98:()=>V5,parseReferences:()=>BQ,serializeEvent:()=>D4,sortEvents:()=>iX,utils:()=>N4,validateEvent:()=>bg,verifiedSymbol:()=>Ho,verifyEvent:()=>zc});var pJ=cr(705);function FS(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function qI(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function gJ(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");FS(t.outputLen),FS(t.blockLen)}function rp(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function mJ(t,e){qI(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const P0=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,WI=t=>t instanceof Uint8Array,R0=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Gi=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function Pw(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!WI(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class KI{clone(){return this._cloneInto()}}function yJ(t){const e=r=>t().update(Pw(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function GI(t=32){if(P0&&typeof P0.getRandomValues=="function")return P0.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class bJ extends KI{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=R0(this.buffer)}update(e){rp(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=Pw(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=R0(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){rp(this),mJ(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;(function(f,d,h,p){if(typeof f.setBigUint64=="function")return f.setBigUint64(d,h,p);const g=BigInt(32),m=BigInt(4294967295),v=Number(h>>g&m),x=Number(h&m),C=p?4:0,N=p?0:4;f.setUint32(d+C,v,p),f.setUint32(d+N,x,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=R0(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const vJ=(t,e,n)=>t&e^t&n^e&n,wJ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Mo=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Lo=new Uint32Array(64);class EJ extends bJ{constructor(){super(64,32,8,!1),this.A=0|Mo[0],this.B=0|Mo[1],this.C=0|Mo[2],this.D=0|Mo[3],this.E=0|Mo[4],this.F=0|Mo[5],this.G=0|Mo[6],this.H=0|Mo[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let d=0;d<16;d++,n+=4)Lo[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const h=Lo[d-15],p=Lo[d-2],g=Gi(h,7)^Gi(h,18)^h>>>3,m=Gi(p,17)^Gi(p,19)^p>>>10;Lo[d]=m+Lo[d-7]+g+Lo[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const h=u+(Gi(a,6)^Gi(a,11)^Gi(a,25))+((f=a)&l^~f&c)+wJ[d]+Lo[d]|0,p=(Gi(r,2)^Gi(r,13)^Gi(r,22))+vJ(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var f;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Lo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Sb=yJ((()=>new EJ)),xJ=(BigInt(0),BigInt(1)),SJ=BigInt(2),dg=t=>t instanceof Uint8Array,AJ=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function kc(t){if(!dg(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=AJ[t[n]];return e}function ZI(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function cf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Ur(t){return ZI(kc(t))}function Rw(t){if(!dg(t))throw new Error("Uint8Array expected");return ZI(kc(Uint8Array.from(t).reverse()))}function aa(t,e){return cf(t.toString(16).padStart(2*e,"0"))}function Dw(t,e){return aa(t,e).reverse()}function lr(t,e,n){let r;if(typeof e=="string")try{r=cf(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else{if(!dg(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function yl(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!dg(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}const Bw=t=>(SJ<<BigInt(t-1))-xJ,D0=t=>new Uint8Array(t),zS=t=>Uint8Array.from(t);function YI(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=D0(t),i=D0(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=D0())=>{i=a(zS([0]),u),r=a(),u.length!==0&&(i=a(zS([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const f=[];for(;u<e;){r=a();const d=r.slice();f.push(d),u+=r.length}return yl(...f)};return(u,f)=>{let d;for(o(),l(u);!(d=f(c()));)l();return o(),d}}const _J={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function uf(t,e,n={}){const r=(i,s,o)=>{const a=_J[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0||a(l,t)))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const Ln=BigInt(0),gn=BigInt(1),Na=BigInt(2),kJ=BigInt(3),B0=BigInt(4),jS=BigInt(5),VS=BigInt(8);BigInt(9),BigInt(16);function Zn(t,e){const n=t%e;return n>=Ln?n:e+n}function CJ(t,e,n){if(n<=Ln||e<Ln)throw new Error("Expected power/modulo > 0");if(n===gn)return Ln;let r=gn;for(;e>Ln;)e&gn&&(r=r*t%n),t=t*t%n,e>>=gn;return r}function fi(t,e,n){let r=t;for(;e-- >Ln;)r*=r,r%=n;return r}function Ab(t,e){if(t===Ln||e<=Ln)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Zn(t,e),r=e,i=Ln,s=gn;for(;n!==Ln;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==gn)throw new Error("invert: does not exist");return Zn(i,e)}function TJ(t){if(t%B0===kJ){const e=(t+gn)/B0;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%VS===jS){const e=(t-jS)/VS;return function(n,r){const i=n.mul(r,Na),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Na),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return(function(e){const n=(e-gn)/Na;let r,i,s;for(r=e-gn,i=0;r%Na===Ln;r/=Na,i++);for(s=Na;s<e&&CJ(s,n,e)!==e-gn;s++);if(i===1){const a=(e+gn)/B0;return function(l,c){const u=l.pow(c,a);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const o=(r+gn)/Na;return function(a,l){if(a.pow(l,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,u=a.pow(a.mul(a.ONE,s),r),f=a.pow(l,o),d=a.pow(l,r);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let h=1;for(let g=a.sqr(d);h<c&&!a.eql(g,a.ONE);h++)g=a.sqr(g);const p=a.pow(u,gn<<BigInt(c-h-1));u=a.sqr(p),f=a.mul(f,p),d=a.mul(d,u),c=h}return f}})(t)}const IJ=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function JI(t,e){const n=e!==void 0?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function XI(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function qS(t){const e=XI(t);return e+Math.ceil(e/2)}class QI extends KI{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,gJ(e);const r=Pw(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return rp(this),this.iHash.update(e),this}digestInto(e){rp(this),qI(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const e4=(t,e,n)=>new QI(t,e).update(n).digest();e4.create=(t,e)=>new QI(t,e);const OJ=BigInt(0),U0=BigInt(1);function t4(t){return uf(t.Fp,IJ.reduce(((e,n)=>(e[n]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),uf(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...JI(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:MJ,aT:LJ}=Eb,Ga={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=Ga;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(r[0]===0&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:MJ(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Ga,n=typeof t=="string"?LJ(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=Ga._parseInt(n.subarray(2)),{d:o,l:a}=Ga._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>8&Number.parseInt(c[0],16)?"00"+c:c,n=c=>{const u=c.toString(16);return 1&u.length?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Hs=BigInt(0),mi=BigInt(1),WS=(BigInt(2),BigInt(3));BigInt(4);function $J(t){const e=(function(p){const g=t4(p);uf(g,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:m,Fp:v,a:x}=g;if(m){if(!v.eql(x,v.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof m!="object"||typeof m.beta!="bigint"||typeof m.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...g})})(t),{Fp:n}=e,r=e.toBytes||((p,g,m)=>{const v=g.toAffine();return yl(Uint8Array.from([4]),n.toBytes(v.x),n.toBytes(v.y))}),i=e.fromBytes||(p=>{const g=p.subarray(1);return{x:n.fromBytes(g.subarray(0,n.BYTES)),y:n.fromBytes(g.subarray(n.BYTES,2*n.BYTES))}});function s(p){const{a:g,b:m}=e,v=n.sqr(p),x=n.mul(v,p);return n.add(n.add(x,n.mul(p,g)),m)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Hs<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:v,n:x}=e;if(g&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=kc(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(2*m,"0")}let C;try{C=typeof p=="bigint"?p:Ur(lr("private key",p,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof p}`)}return v&&(C=Zn(C,x)),a(C),C}const c=new Map;function u(p){if(!(p instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(g,m,v){if(this.px=g,this.py=m,this.pz=v,g==null||!n.isValid(g))throw new Error("x required");if(m==null||!n.isValid(m))throw new Error("y required");if(v==null||!n.isValid(v))throw new Error("z required")}static fromAffine(g){const{x:m,y:v}=g||{};if(!g||!n.isValid(m)||!n.isValid(v))throw new Error("invalid affine point");if(g instanceof f)throw new Error("projective point not allowed");const x=C=>n.eql(C,n.ZERO);return x(m)&&x(v)?f.ZERO:new f(m,v,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const m=n.invertBatch(g.map((v=>v.pz)));return g.map(((v,x)=>v.toAffine(m[x]))).map(f.fromAffine)}static fromHex(g){const m=f.fromAffine(i(lr("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return f.BASE.multiply(l(g))}_setWindowSize(g){this._WINDOW_SIZE=g,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:m}=this.toAffine();if(!n.isValid(g)||!n.isValid(m))throw new Error("bad point: x or y not FE");const v=n.sqr(m),x=s(g);if(!n.eql(v,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(n.isOdd)return!n.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:m,py:v,pz:x}=this,{px:C,py:N,pz:O}=g,A=n.eql(n.mul(m,O),n.mul(C,x)),P=n.eql(n.mul(v,O),n.mul(N,x));return A&&P}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:g,b:m}=e,v=n.mul(m,WS),{px:x,py:C,pz:N}=this;let O=n.ZERO,A=n.ZERO,P=n.ZERO,S=n.mul(x,x),E=n.mul(C,C),_=n.mul(N,N),k=n.mul(x,C);return k=n.add(k,k),P=n.mul(x,N),P=n.add(P,P),O=n.mul(g,P),A=n.mul(v,_),A=n.add(O,A),O=n.sub(E,A),A=n.add(E,A),A=n.mul(O,A),O=n.mul(k,O),P=n.mul(v,P),_=n.mul(g,_),k=n.sub(S,_),k=n.mul(g,k),k=n.add(k,P),P=n.add(S,S),S=n.add(P,S),S=n.add(S,_),S=n.mul(S,k),A=n.add(A,S),_=n.mul(C,N),_=n.add(_,_),S=n.mul(_,k),O=n.sub(O,S),P=n.mul(_,E),P=n.add(P,P),P=n.add(P,P),new f(O,A,P)}add(g){u(g);const{px:m,py:v,pz:x}=this,{px:C,py:N,pz:O}=g;let A=n.ZERO,P=n.ZERO,S=n.ZERO;const E=e.a,_=n.mul(e.b,WS);let k=n.mul(m,C),D=n.mul(v,N),U=n.mul(x,O),B=n.add(m,v),M=n.add(C,N);B=n.mul(B,M),M=n.add(k,D),B=n.sub(B,M),M=n.add(m,x);let T=n.add(C,O);return M=n.mul(M,T),T=n.add(k,U),M=n.sub(M,T),T=n.add(v,x),A=n.add(N,O),T=n.mul(T,A),A=n.add(D,U),T=n.sub(T,A),S=n.mul(E,M),A=n.mul(_,U),S=n.add(A,S),A=n.sub(D,S),S=n.add(D,S),P=n.mul(A,S),D=n.add(k,k),D=n.add(D,k),U=n.mul(E,U),M=n.mul(_,M),D=n.add(D,U),U=n.sub(k,U),U=n.mul(E,U),M=n.add(M,U),k=n.mul(D,M),P=n.add(P,k),k=n.mul(T,M),A=n.mul(B,A),A=n.sub(A,k),k=n.mul(B,D),S=n.mul(T,S),S=n.add(S,k),new f(A,P,S)}subtract(g){return this.add(g.negate())}is0(){return this.equals(f.ZERO)}wNAF(g){return h.wNAFCached(this,c,g,(m=>{const v=n.invertBatch(m.map((x=>x.pz)));return m.map(((x,C)=>x.toAffine(v[C]))).map(f.fromAffine)}))}multiplyUnsafe(g){const m=f.ZERO;if(g===Hs)return m;if(a(g),g===mi)return this;const{endo:v}=e;if(!v)return h.unsafeLadder(this,g);let{k1neg:x,k1:C,k2neg:N,k2:O}=v.splitScalar(g),A=m,P=m,S=this;for(;C>Hs||O>Hs;)C&mi&&(A=A.add(S)),O&mi&&(P=P.add(S)),S=S.double(),C>>=mi,O>>=mi;return x&&(A=A.negate()),N&&(P=P.negate()),P=new f(n.mul(P.px,v.beta),P.py,P.pz),A.add(P)}multiply(g){a(g);let m,v,x=g;const{endo:C}=e;if(C){const{k1neg:N,k1:O,k2neg:A,k2:P}=C.splitScalar(x);let{p:S,f:E}=this.wNAF(O),{p:_,f:k}=this.wNAF(P);S=h.constTimeNegate(N,S),_=h.constTimeNegate(A,_),_=new f(n.mul(_.px,C.beta),_.py,_.pz),m=S.add(_),v=E.add(k)}else{const{p:N,f:O}=this.wNAF(x);m=N,v=O}return f.normalizeZ([m,v])[0]}multiplyAndAddUnsafe(g,m,v){const x=f.BASE,C=(O,A)=>A!==Hs&&A!==mi&&O.equals(x)?O.multiply(A):O.multiplyUnsafe(A),N=C(this,m).add(C(g,v));return N.is0()?void 0:N}toAffine(g){const{px:m,py:v,pz:x}=this,C=this.is0();g==null&&(g=C?n.ONE:n.inv(x));const N=n.mul(m,g),O=n.mul(v,g),A=n.mul(x,g);if(C)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:N,y:O}}isTorsionFree(){const{h:g,isTorsionFree:m}=e;if(g===mi)return!0;if(m)return m(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:m}=e;return g===mi?this:m?m(f,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),r(f,this,g)}toHex(g=!0){return kc(this.toRawBytes(g))}}f.BASE=new f(e.Gx,e.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,h=(function(p,g){const m=(x,C)=>{const N=C.negate();return x?N:C},v=x=>({windows:Math.ceil(g/x)+1,windowSize:2**(x-1)});return{constTimeNegate:m,unsafeLadder(x,C){let N=p.ZERO,O=x;for(;C>OJ;)C&U0&&(N=N.add(O)),O=O.double(),C>>=U0;return N},precomputeWindow(x,C){const{windows:N,windowSize:O}=v(C),A=[];let P=x,S=P;for(let E=0;E<N;E++){S=P,A.push(S);for(let _=1;_<O;_++)S=S.add(P),A.push(S);P=S.double()}return A},wNAF(x,C,N){const{windows:O,windowSize:A}=v(x);let P=p.ZERO,S=p.BASE;const E=BigInt(2**x-1),_=2**x,k=BigInt(x);for(let D=0;D<O;D++){const U=D*A;let B=Number(N&E);N>>=k,B>A&&(B-=_,N+=U0);const M=U,T=U+Math.abs(B)-1,L=D%2!=0,q=B<0;B===0?S=S.add(m(L,C[M])):P=P.add(m(q,C[T]))}return{p:P,f:S}},wNAFCached(x,C,N,O){const A=x._WINDOW_SIZE||1;let P=C.get(x);return P||(P=this.precomputeWindow(x,A),A!==1&&C.set(x,O(P))),this.wNAF(A,P,N)}}})(f,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function NJ(t){const e=(function(E){const _=t4(E);return uf(_,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,..._})})(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(E){return Zn(E,r)}function a(E){return Ab(E,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:f}=$J({...e,toBytes(E,_,k){const D=_.toAffine(),U=n.toBytes(D.x),B=yl;return k?B(Uint8Array.from([_.hasEvenY()?2:3]),U):B(Uint8Array.from([4]),U,n.toBytes(D.y))},fromBytes(E){const _=E.length,k=E[0],D=E.subarray(1);if(_!==i||k!==2&&k!==3){if(_===s&&k===4)return{x:n.fromBytes(D.subarray(0,n.BYTES)),y:n.fromBytes(D.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${_} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const B=Ur(D);if(!(Hs<(U=B)&&U<n.ORDER))throw new Error("Point is not on curve");const M=u(B);let T=n.sqrt(M);return!(1&~k)!=((T&mi)===mi)&&(T=n.neg(T)),{x:B,y:T}}var U}}),d=E=>kc(aa(E,e.nByteLength));function h(E){return E>r>>mi}const p=(E,_,k)=>Ur(E.slice(_,k));class g{constructor(_,k,D){this.r=_,this.s=k,this.recovery=D,this.assertValidity()}static fromCompact(_){const k=e.nByteLength;return _=lr("compactSignature",_,2*k),new g(p(_,0,k),p(_,k,2*k))}static fromDER(_){const{r:k,s:D}=Ga.toSig(lr("DER",_));return new g(k,D)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(_){return new g(this.r,this.s,_)}recoverPublicKey(_){const{r:k,s:D,recovery:U}=this,B=C(lr("msgHash",_));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const M=U===2||U===3?k+e.n:k;if(M>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const T=1&U?"03":"02",L=l.fromHex(T+d(M)),q=a(M),F=o(-B*q),j=o(D*q),Z=l.BASE.multiplyAndAddUnsafe(L,F,j);if(!Z)throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return cf(this.toDERHex())}toDERHex(){return Ga.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return cf(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const m={isValidPrivateKey(E){try{return c(E),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const E=qS(e.n);return(function(_,k,D=!1){const U=_.length,B=XI(k),M=qS(k);if(U<16||U<M||U>1024)throw new Error(`expected ${M}-1024 bytes of input, got ${U}`);const T=Zn(D?Ur(_):Rw(_),k-gn)+gn;return D?Dw(T,B):aa(T,B)})(e.randomBytes(E),e.n)},precompute:(E=8,_=l.BASE)=>(_._setWindowSize(E),_.multiply(BigInt(3)),_)};function v(E){const _=E instanceof Uint8Array,k=typeof E=="string",D=(_||k)&&E.length;return _?D===i||D===s:k?D===2*i||D===2*s:E instanceof l}const x=e.bits2int||function(E){const _=Ur(E),k=8*E.length-e.nBitLength;return k>0?_>>BigInt(k):_},C=e.bits2int_modN||function(E){return o(x(E))},N=Bw(e.nBitLength);function O(E){if(typeof E!="bigint")throw new Error("bigint expected");if(!(Hs<=E&&E<N))throw new Error(`bigint expected < 2^${e.nBitLength}`);return aa(E,e.nByteLength)}function A(E,_,k=P){if(["recovered","canonical"].some((J=>J in k)))throw new Error("sign() legacy options not supported");const{hash:D,randomBytes:U}=e;let{lowS:B,prehash:M,extraEntropy:T}=k;B==null&&(B=!0),E=lr("msgHash",E),M&&(E=lr("prehashed msgHash",D(E)));const L=C(E),q=c(_),F=[O(q),O(L)];if(T!=null){const J=T===!0?U(n.BYTES):T;F.push(lr("extraEntropy",J))}const j=yl(...F),Z=L;return{seed:j,k2sig:function(J){const ue=x(J);if(!f(ue))return;const ae=a(ue),X=l.BASE.multiply(ue).toAffine(),be=o(X.x);if(be===Hs)return;const De=o(ae*o(Z+be*q));if(De===Hs)return;let de=(X.x===be?0:2)|Number(X.y&mi),ke=De;return B&&h(De)&&(ke=(function(Ze){return h(Ze)?o(-Ze):Ze})(De),de^=1),new g(be,ke,de)}}}const P={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(E,_=!0){return l.fromPrivateKey(E).toRawBytes(_)},getSharedSecret:function(E,_,k=!0){if(v(E))throw new Error("first arg must be private key");if(!v(_))throw new Error("second arg must be public key");return l.fromHex(_).multiply(c(E)).toRawBytes(k)},sign:function(E,_,k=P){const{seed:D,k2sig:U}=A(E,_,k),B=e;return YI(B.hash.outputLen,B.nByteLength,B.hmac)(D,U)},verify:function(E,_,k,D=S){const U=E;if(_=lr("msgHash",_),k=lr("publicKey",k),"strict"in D)throw new Error("options.strict was renamed to lowS");const{lowS:B,prehash:M}=D;let T,L;try{if(typeof U=="string"||U instanceof Uint8Array)try{T=g.fromDER(U)}catch(X){if(!(X instanceof Ga.Err))throw X;T=g.fromCompact(U)}else{if(typeof U!="object"||typeof U.r!="bigint"||typeof U.s!="bigint")throw new Error("PARSE");{const{r:X,s:be}=U;T=new g(X,be)}}L=l.fromHex(k)}catch(X){if(X.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(B&&T.hasHighS())return!1;M&&(_=e.hash(_));const{r:q,s:F}=T,j=C(_),Z=a(F),J=o(j*Z),ue=o(q*Z),ae=l.BASE.multiplyAndAddUnsafe(L,J,ue)?.toAffine();return!!ae&&o(ae.x)===q},ProjectivePoint:l,Signature:g,utils:m}}function PJ(t){return{hash:t,hmac:(e,...n)=>e4(t,e,(function(...r){const i=new Uint8Array(r.reduce(((o,a)=>o+a.length),0));let s=0;return r.forEach((o=>{if(!WI(o))throw new Error("Uint8Array expected");i.set(o,s),s+=o.length})),i})(...n)),randomBytes:GI}}const hg=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ip=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),n4=BigInt(1),sp=BigInt(2),KS=(t,e)=>(t+e/sp)/e;function r4(t){const e=hg,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,f=fi(u,n,e)*u%e,d=fi(f,n,e)*u%e,h=fi(d,sp,e)*c%e,p=fi(h,i,e)*h%e,g=fi(p,s,e)*p%e,m=fi(g,a,e)*g%e,v=fi(m,l,e)*m%e,x=fi(v,a,e)*g%e,C=fi(x,n,e)*u%e,N=fi(C,o,e)*p%e,O=fi(N,r,e)*c%e,A=fi(O,sp,e);if(!_b.eql(_b.sqr(A),t))throw new Error("Cannot find square root");return A}const _b=(function(t,e,n=!1,r={}){if(t<=Ln)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=JI(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=TJ(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:Bw(i),ZERO:Ln,ONE:gn,create:l=>Zn(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("Invalid field element: expected bigint, got "+typeof l);return Ln<=l&&l<t},is0:l=>l===Ln,isOdd:l=>(l&gn)===gn,neg:l=>Zn(-l,t),eql:(l,c)=>l===c,sqr:l=>Zn(l*l,t),add:(l,c)=>Zn(l+c,t),sub:(l,c)=>Zn(l-c,t),mul:(l,c)=>Zn(l*c,t),pow:(l,c)=>(function(u,f,d){if(d<Ln)throw new Error("Expected power > 0");if(d===Ln)return u.ONE;if(d===gn)return f;let h=u.ONE,p=f;for(;d>Ln;)d&gn&&(h=u.mul(h,p)),p=u.sqr(p),d>>=gn;return h})(a,l,c),div:(l,c)=>Zn(l*Ab(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>Ab(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>(function(c,u){const f=new Array(u.length),d=u.reduce(((p,g,m)=>c.is0(g)?p:(f[m]=p,c.mul(p,g))),c.ONE),h=c.inv(d);return u.reduceRight(((p,g,m)=>c.is0(g)?p:(f[m]=c.mul(p,f[m]),c.mul(p,g))),h),f})(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?Dw(l,s):aa(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?Rw(l):Ur(l)}});return Object.freeze(a)})(hg,void 0,void 0,{sqrt:r4}),Bc=(function(t,e){const n=r=>NJ({...t,...PJ(r)});return Object.freeze({...n(e),create:n})})({a:BigInt(0),b:BigInt(7),Fp:_b,n:ip,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=ip,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-n4*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=KS(s*t,e),l=KS(-r*t,e);let c=Zn(t-a*n-l*i,e),u=Zn(-a*r-l*s,e);const f=c>o,d=u>o;if(f&&(c=e-c),d&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:c,k2neg:d,k2:u}}}},Sb),pg=BigInt(0),i4=t=>typeof t=="bigint"&&pg<t&&t<hg,GS={};function op(t,...e){let n=GS[t];if(n===void 0){const r=Sb(Uint8Array.from(t,(i=>i.charCodeAt(0))));n=yl(r,r),GS[t]=n}return Sb(yl(n,...e))}const Uw=t=>t.toRawBytes(!0).slice(1),kb=t=>aa(t,32),H0=t=>Zn(t,hg),ff=t=>Zn(t,ip),Hw=Bc.ProjectivePoint;function Cb(t){let e=Bc.utils.normPrivateKeyToScalar(t),n=Hw.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:ff(-e),bytes:Uw(n)}}function s4(t){if(!i4(t))throw new Error("bad x: need 0 < x < p");const e=H0(t*t);let n=r4(H0(e*t+BigInt(7)));n%sp!==pg&&(n=H0(-n));const r=new Hw(t,n,n4);return r.assertValidity(),r}function o4(...t){return ff(Ur(op("BIP0340/challenge",...t)))}function RJ(t){return Cb(t).bytes}function DJ(t,e,n=GI(32)){const r=lr("message",t),{bytes:i,scalar:s}=Cb(e),o=lr("auxRand",n,32),a=kb(s^Ur(op("BIP0340/aux",o))),l=op("BIP0340/nonce",a,i,r),c=ff(Ur(l));if(c===pg)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=Cb(c),d=o4(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(kb(ff(f+d*s)),32),!a4(h,r,i))throw new Error("sign: Invalid signature produced");return h}function a4(t,e,n){const r=lr("signature",t,64),i=lr("message",e),s=lr("publicKey",n,32);try{const u=s4(Ur(s)),f=Ur(r.subarray(0,32));if(!i4(f))return!1;const d=Ur(r.subarray(32,64));if(!(typeof(c=d)=="bigint"&&pg<c&&c<ip))return!1;const h=o4(kb(f),Uw(u),i),p=(o=u,a=d,l=ff(-h),Hw.BASE.multiplyAndAddUnsafe(o,a,l));return!(!p||!p.hasEvenY()||p.toAffine().x!==f)}catch{return!1}var o,a,l,c}const rs={getPublicKey:RJ,sign:DJ,verify:a4,utils:{randomPrivateKey:Bc.utils.randomPrivateKey,lift_x:s4,pointToBytes:Uw,numberToBytesBE:aa,bytesToNumberBE:Ur,taggedHash:op,mod:Zn}},F0=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,Fw=t=>t instanceof Uint8Array,z0=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Zi=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");const BJ=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function An(t){if(!Fw(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=BJ[t[n]];return e}function Cc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function df(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!Fw(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function gg(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!Fw(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}class l4{clone(){return this._cloneInto()}}function c4(t){const e=r=>t().update(df(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function u4(t=32){if(F0&&typeof F0.getRandomValues=="function")return F0.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function j0(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function ZS(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const UJ={number:j0,bool:function(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)},bytes:ZS,hash:function(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");j0(t.outputLen),j0(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){ZS(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},fs=UJ;class HJ extends l4{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=z0(this.buffer)}update(e){fs.exists(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=df(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=z0(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){fs.exists(this),fs.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;(function(f,d,h,p){if(typeof f.setBigUint64=="function")return f.setBigUint64(d,h,p);const g=BigInt(32),m=BigInt(4294967295),v=Number(h>>g&m),x=Number(h&m),C=p?4:0,N=p?0:4;f.setUint32(d+C,v,p),f.setUint32(d+N,x,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=z0(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const FJ=(t,e,n)=>t&e^t&n^e&n,zJ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$o=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),No=new Uint32Array(64);class f4 extends HJ{constructor(){super(64,32,8,!1),this.A=0|$o[0],this.B=0|$o[1],this.C=0|$o[2],this.D=0|$o[3],this.E=0|$o[4],this.F=0|$o[5],this.G=0|$o[6],this.H=0|$o[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let d=0;d<16;d++,n+=4)No[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const h=No[d-15],p=No[d-2],g=Zi(h,7)^Zi(h,18)^h>>>3,m=Zi(p,17)^Zi(p,19)^p>>>10;No[d]=m+No[d-7]+g+No[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const h=u+(Zi(a,6)^Zi(a,11)^Zi(a,25))+((f=a)&l^~f&c)+zJ[d]+No[d]|0,p=(Zi(r,2)^Zi(r,13)^Zi(r,22))+FJ(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var f;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){No.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class jJ extends f4{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Al=c4((()=>new f4));c4((()=>new jJ));function Uc(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Xs(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce(((i,s)=>i?e(i,s.encode):s.encode),void 0),r=t.reduce(((i,s)=>i?e(i,s.decode):s.decode),void 0);return{encode:n,decode:r}}function Qs(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map((n=>{if(Uc(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]}))},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map((n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r}))}}}function eo(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function ap(t,e="="){if(Uc(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function d4(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function YS(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((o=>{if(Uc(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)}));;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!=e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");a&&(s[l]?a=!1:r=l)}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const h4=(t,e)=>e?h4(e,t%e):t,lp=(t,e)=>t+(e-h4(t,e));function Tb(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(lp(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${lp(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(Uc(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function VJ(t){return Uc(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return YS(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(YS(e,t,256))}}}function la(t,e=!1){if(Uc(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(lp(8,t)>32||lp(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Tb(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Tb(n,t,8,e))}}}function JS(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}Xs(la(4),Qs("0123456789ABCDEF"),eo(""));Xs(la(5),Qs("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ap(5),eo(""));const ya=(Xs(la(5),Qs("0123456789ABCDEFGHIJKLMNOPQRSTUV"),ap(5),eo("")),Xs(la(5),Qs("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),eo(""),d4((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),Xs(la(6),Qs("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ap(6),eo("")));Xs(la(6),Qs("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),ap(6),eo(""));const Ib=t=>Xs(VJ(58),Qs(t),eo(""));Ib("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Ib("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Ib("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Ob=Xs(Qs("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),eo("")),XS=[996825010,642813549,513874426,1027748829,705979059];function uu(t){const e=t>>25;let n=(33554431&t)<<5;for(let r=0;r<XS.length;r++)(e>>r&1)==1&&(n^=XS[r]);return n}function QS(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=uu(i)^o>>5}i=uu(i);for(let s=0;s<r;s++)i=uu(i)^31&t.charCodeAt(s);for(let s of e)i=uu(i)^s;for(let s=0;s<6;s++)i=uu(i);return i^=n,Ob.encode(Tb([i%2**30],30,5,!1))}function p4(t){const e=t==="bech32"?1:734539939,n=la(5),r=n.decode,i=n.encode,s=JS(r);function o(a,l=90){if(typeof a!="string")throw new Error("bech32.decode input should be string, not "+typeof a);if(a.length<8||l!==!1&&a.length>l)throw new TypeError(`Wrong string length: ${a.length} (${a}). Expected (8..${l})`);const c=a.toLowerCase();if(a!==c&&a!==a.toUpperCase())throw new Error("String must be lowercase or uppercase");const u=(a=c).lastIndexOf("1");if(u===0||u===-1)throw new Error('Letter "1" must be present between prefix and data only');const f=a.slice(0,u),d=a.slice(u+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const h=Ob.decode(d).slice(0,-6),p=QS(f,h,e);if(!d.endsWith(p))throw new Error(`Invalid checksum in ${a}: expected "${p}"`);return{prefix:f,words:h}}return{encode:function(a,l,c=90){if(typeof a!="string")throw new Error("bech32.encode prefix should be string, not "+typeof a);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof l);const u=a.length+7+l.length;if(c!==!1&&u>c)throw new TypeError(`Length ${u} exceeds limit ${c}`);return`${a=a.toLowerCase()}1${Ob.encode(l)}${QS(a,l,e)}`},decode:o,decodeToBytes:function(a){const{prefix:l,words:c}=o(a,!1);return{prefix:l,words:c,bytes:r(c)}},decodeUnsafe:JS(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const Tc=p4("bech32");p4("bech32m");Xs(la(4),Qs("0123456789abcdef"),eo(""),d4((t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));function V0(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function eA(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function g4(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Bt(t,...e){if(!g4(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Ic(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zw(t,e){Bt(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const jw=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),wt=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),mg=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function ba(t){if(typeof t=="string")t=(function(e){if(typeof e!="string")throw new Error("string expected, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t);else{if(!g4(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function Vw(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const Hc=(t,e)=>(Object.assign(e,t),e);function Mb(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const Ds=16,qw=new Uint8Array(16),is=wt(qw),yi=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class m4{constructor(e,n){this.blockLen=Ds,this.outputLen=Ds,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,Bt(e=ba(e),16);const r=mg(e);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const l=[];for(let v=0;v<128;v++)l.push({s0:yi(i),s1:yi(s),s2:yi(o),s3:yi(a)}),{s0:i,s1:s,s2:o,s3:a}={s3:(f=o)<<31|(d=a)>>>1,s2:(u=s)<<31|f>>>1,s1:(c=i)<<31|u>>>1,s0:c>>>1^225<<24&-(1&d)};var c,u,f,d;const h=(v=>v>65536?8:v>1024?4:2)(n||1024);if(![1,2,4,8].includes(h))throw new Error(`ghash: wrong window size=${h}, should be 2, 4 or 8`);this.W=h;const p=128/h,g=this.windowSize=2**h,m=[];for(let v=0;v<p;v++)for(let x=0;x<g;x++){let C=0,N=0,O=0,A=0;for(let P=0;P<h;P++){if(!(x>>>h-P-1&1))continue;const{s0:S,s1:E,s2:_,s3:k}=l[h*v+P];C^=S,N^=E,O^=_,A^=k}m.push({s0:C,s1:N,s2:O,s3:A})}this.t=m}_updateBlock(e,n,r,i){e^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let l=0,c=0,u=0,f=0;const d=(1<<s)-1;let h=0;for(const p of[e,n,r,i])for(let g=0;g<4;g++){const m=p>>>8*g&255;for(let v=8/s-1;v>=0;v--){const x=m>>>s*v&d,{s0:C,s1:N,s2:O,s3:A}=o[h*a+x];l^=C,c^=N,u^=O,f^=A,h+=1}}this.s0=l,this.s1=c,this.s2=u,this.s3=f}update(e){e=ba(e),Ic(this);const n=wt(e),r=Math.floor(e.length/Ds),i=e.length%Ds;for(let s=0;s<r;s++)this._updateBlock(n[4*s+0],n[4*s+1],n[4*s+2],n[4*s+3]);return i&&(qw.set(e.subarray(r*Ds)),this._updateBlock(is[0],is[1],is[2],is[3]),is.fill(0)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){Ic(this),zw(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=wt(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e}digest(){const e=new Uint8Array(Ds);return this.digestInto(e),this.destroy(),e}}class qJ extends m4{constructor(e,n){const r=(function(i){i.reverse();const s=1&i[15];let o=0;for(let a=0;a<i.length;a++){const l=i[a];i[a]=l>>>1|o,o=(1&l)<<7}return i[0]^=225&-s,i})((e=ba(e)).slice());super(r,n),r.fill(0)}update(e){e=ba(e),Ic(this);const n=wt(e),r=e.length%Ds,i=Math.floor(e.length/Ds);for(let s=0;s<i;s++)this._updateBlock(yi(n[4*s+3]),yi(n[4*s+2]),yi(n[4*s+1]),yi(n[4*s+0]));return r&&(qw.set(e.subarray(i*Ds)),this._updateBlock(yi(is[3]),yi(is[2]),yi(is[1]),yi(is[0])),is.fill(0)),this}digestInto(e){Ic(this),zw(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=wt(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e.reverse()}}function y4(t){const e=(r,i)=>t(i,r.length).update(ba(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,i)=>t(r,i),e}const tA=y4(((t,e)=>new m4(t,e))),WJ=y4(((t,e)=>new qJ(t,e))),Vr=16,pd=new Uint8Array(Vr);function Ww(t){return t<<1^283&-(t>>7)}function Kl(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=Ww(t);return n}const Lb=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=Ww(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),KJ=Lb.map(((t,e)=>Lb.indexOf(e))),q0=t=>t<<8|t>>>24;function b4(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((c,u)=>e(t[u]))),r=n.map(q0),i=r.map(q0),s=i.map(q0),o=new Uint32Array(65536),a=new Uint32Array(65536),l=new Uint16Array(65536);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const f=256*c+u;o[f]=n[c]^r[u],a[f]=i[c]^s[u],l[f]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const Kw=b4(Lb,(t=>Kl(t,3)<<24|t<<16|t<<8|Kl(t,2))),v4=b4(KJ,(t=>Kl(t,11)<<24|Kl(t,13)<<16|Kl(t,9)<<8|Kl(t,14))),GJ=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=Ww(n))t[e]=n;return t})();function va(t){Bt(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=Kw,r=wt(t),i=r.length,s=l=>ds(n,l,l,l,l),o=new Uint32Array(e+28);o.set(r);for(let l=i;l<o.length;l++){let c=o[l-1];l%i==0?c=s((a=c)<<24|a>>>8)^GJ[l/i-1]:i>6&&l%i==4&&(c=s(c)),o[l]=o[l-i]^c}var a;return o}function w4(t){const e=va(t),n=e.slice(),r=e.length,{sbox2:i}=Kw,{T0:s,T1:o,T2:a,T3:l}=v4;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],f=ds(i,u,u,u,u);n[c]=s[255&f]^o[f>>>8&255]^a[f>>>16&255]^l[f>>>24]}return n}function Xo(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function ds(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function ki(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=Kw;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const f=t[l++]^Xo(o,a,e,n,r,i),d=t[l++]^Xo(o,a,n,r,i,e),h=t[l++]^Xo(o,a,r,i,e,n),p=t[l++]^Xo(o,a,i,e,n,r);e=f,n=d,r=h,i=p}return{s0:t[l++]^ds(s,e,n,r,i),s1:t[l++]^ds(s,n,r,i,e),s2:t[l++]^ds(s,r,i,e,n),s3:t[l++]^ds(s,i,e,n,r)}}function E4(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=v4;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const f=t[l++]^Xo(o,a,e,i,r,n),d=t[l++]^Xo(o,a,n,e,i,r),h=t[l++]^Xo(o,a,r,n,e,i),p=t[l++]^Xo(o,a,i,r,n,e);e=f,n=d,r=h,i=p}return{s0:t[l++]^ds(s,e,i,r,n),s1:t[l++]^ds(s,n,e,i,r),s2:t[l++]^ds(s,r,n,e,i),s3:t[l++]^ds(s,i,r,n,e)}}function Fc(t,e){if(!e)return new Uint8Array(t);if(Bt(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function ZJ(t,e,n,r){Bt(e,Vr),Bt(n);const i=n.length;r=Fc(i,r);const s=e,o=wt(s);let{s0:a,s1:l,s2:c,s3:u}=ki(t,o[0],o[1],o[2],o[3]);const f=wt(n),d=wt(r);for(let p=0;p+4<=f.length;p+=4){d[p+0]=f[p+0]^a,d[p+1]=f[p+1]^l,d[p+2]=f[p+2]^c,d[p+3]=f[p+3]^u;let g=1;for(let m=s.length-1;m>=0;m--)g=g+(255&s[m])|0,s[m]=255&g,g>>>=8;({s0:a,s1:l,s2:c,s3:u}=ki(t,o[0],o[1],o[2],o[3]))}const h=Vr*Math.floor(f.length/4);if(h<i){const p=new Uint32Array([a,l,c,u]),g=jw(p);for(let m=h,v=0;m<i;m++,v++)r[m]=n[m]^g[v]}return r}function vu(t,e,n,r,i){Bt(n,Vr),Bt(r),i=Fc(r.length,i);const s=n,o=wt(s),a=mg(s),l=wt(r),c=wt(i),u=e?0:12,f=r.length;let d=a.getUint32(u,e),{s0:h,s1:p,s2:g,s3:m}=ki(t,o[0],o[1],o[2],o[3]);for(let x=0;x+4<=l.length;x+=4)c[x+0]=l[x+0]^h,c[x+1]=l[x+1]^p,c[x+2]=l[x+2]^g,c[x+3]=l[x+3]^m,d=d+1>>>0,a.setUint32(u,d,e),{s0:h,s1:p,s2:g,s3:m}=ki(t,o[0],o[1],o[2],o[3]);const v=Vr*Math.floor(l.length/4);if(v<f){const x=new Uint32Array([h,p,g,m]),C=jw(x);for(let N=v,O=0;N<f;N++,O++)i[N]=r[N]^C[O]}return i}Hc({blockSize:16,nonceLength:16},(function(t,e){function n(r,i){const s=va(t),o=e.slice(),a=ZJ(s,o,r,i);return s.fill(0),o.fill(0),a}return Bt(t),Bt(e,Vr),{encrypt:(r,i)=>n(r,i),decrypt:(r,i)=>n(r,i)}}));function x4(t){if(Bt(t),t.length%Vr!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function S4(t,e,n){let r=t.length;const i=r%Vr;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=wt(t);if(e){let a=Vr-i;a||(a=Vr),r+=a}const o=Fc(r,n);return{b:s,o:wt(o),out:o}}function A4(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function _4(t){const e=new Uint8Array(16),n=wt(e);e.set(t);const r=Vr-t.length;for(let i=Vr-r;i<Vr;i++)e[i]=r;return n}Hc({blockSize:16},(function(t,e={}){Bt(t);const n=!e.disablePadding;return{encrypt:(r,i)=>{Bt(r);const{b:s,o,out:a}=S4(r,n,i),l=va(t);let c=0;for(;c+4<=s.length;){const{s0:u,s1:f,s2:d,s3:h}=ki(l,s[c+0],s[c+1],s[c+2],s[c+3]);o[c++]=u,o[c++]=f,o[c++]=d,o[c++]=h}if(n){const u=_4(r.subarray(4*c)),{s0:f,s1:d,s2:h,s3:p}=ki(l,u[0],u[1],u[2],u[3]);o[c++]=f,o[c++]=d,o[c++]=h,o[c++]=p}return l.fill(0),a},decrypt:(r,i)=>{x4(r);const s=w4(t),o=Fc(r.length,i),a=wt(r),l=wt(o);for(let c=0;c+4<=a.length;){const{s0:u,s1:f,s2:d,s3:h}=E4(s,a[c+0],a[c+1],a[c+2],a[c+3]);l[c++]=u,l[c++]=f,l[c++]=d,l[c++]=h}return s.fill(0),A4(o,n)}}}));const k4=Hc({blockSize:16,nonceLength:16},(function(t,e,n={}){Bt(t),Bt(e,16);const r=!n.disablePadding;return{encrypt:(i,s)=>{const o=va(t),{b:a,o:l,out:c}=S4(i,r,s),u=wt(e);let f=u[0],d=u[1],h=u[2],p=u[3],g=0;for(;g+4<=a.length;)f^=a[g+0],d^=a[g+1],h^=a[g+2],p^=a[g+3],{s0:f,s1:d,s2:h,s3:p}=ki(o,f,d,h,p),l[g++]=f,l[g++]=d,l[g++]=h,l[g++]=p;if(r){const m=_4(i.subarray(4*g));f^=m[0],d^=m[1],h^=m[2],p^=m[3],{s0:f,s1:d,s2:h,s3:p}=ki(o,f,d,h,p),l[g++]=f,l[g++]=d,l[g++]=h,l[g++]=p}return o.fill(0),c},decrypt:(i,s)=>{x4(i);const o=w4(t),a=wt(e),l=Fc(i.length,s),c=wt(i),u=wt(l);let f=a[0],d=a[1],h=a[2],p=a[3];for(let g=0;g+4<=c.length;){const m=f,v=d,x=h,C=p;f=c[g+0],d=c[g+1],h=c[g+2],p=c[g+3];const{s0:N,s1:O,s2:A,s3:P}=E4(o,f,d,h,p);u[g++]=N^m,u[g++]=O^v,u[g++]=A^x,u[g++]=P^C}return o.fill(0),A4(l,r)}}}));Hc({blockSize:16,nonceLength:16},(function(t,e){function n(r,i,s){const o=va(t),a=r.length;s=Fc(a,s);const l=wt(r),c=wt(s),u=i?c:l,f=wt(e);let d=f[0],h=f[1],p=f[2],g=f[3];for(let v=0;v+4<=l.length;){const{s0:x,s1:C,s2:N,s3:O}=ki(o,d,h,p,g);c[v+0]=l[v+0]^x,c[v+1]=l[v+1]^C,c[v+2]=l[v+2]^N,c[v+3]=l[v+3]^O,d=u[v++],h=u[v++],p=u[v++],g=u[v++]}const m=Vr*Math.floor(l.length/4);if(m<a){({s0:d,s1:h,s2:p,s3:g}=ki(o,d,h,p,g));const v=jw(new Uint32Array([d,h,p,g]));for(let x=m,C=0;x<a;x++,C++)s[x]=r[x]^v[C];v.fill(0)}return o.fill(0),s}return Bt(t),Bt(e,16),{encrypt:(r,i)=>n(r,!0,i),decrypt:(r,i)=>n(r,!1,i)}}));function C4(t,e,n,r,i){const s=t.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=mg(o);return i&&Mb(a,0,BigInt(8*i.length),e),Mb(a,8,BigInt(8*r.length),e),s.update(o),s.digest()}Hc({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(Bt(e),e.length===0)throw new Error("aes/gcm: empty nonce");const r=16;function i(o,a,l){const c=C4(tA,!1,o,l,n);for(let u=0;u<a.length;u++)c[u]^=a[u];return c}function s(){const o=va(t),a=pd.slice(),l=pd.slice();if(vu(o,!1,l,l,a),e.length===12)l.set(e);else{const c=pd.slice();Mb(mg(c),8,BigInt(8*e.length),!1),tA.create(a).update(e).update(c).digestInto(l)}return{xk:o,authKey:a,counter:l,tagMask:vu(o,!1,l,pd)}}return{encrypt:o=>{Bt(o);const{xk:a,authKey:l,counter:c,tagMask:u}=s(),f=new Uint8Array(o.length+r);vu(a,!1,c,o,f);const d=i(l,u,f.subarray(0,f.length-r));return f.set(d,o.length),a.fill(0),f},decrypt:o=>{if(Bt(o),o.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:a,authKey:l,counter:c,tagMask:u}=s(),f=o.subarray(0,-16),d=o.subarray(-16);if(!Vw(i(l,u,f),d))throw new Error("aes/gcm: invalid ghash tag");const h=vu(a,!1,c,f);return l.fill(0),u.fill(0),a.fill(0),h}}}));const gd=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};Hc({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=gd("AAD",0,68719476736),i=gd("plaintext",0,2**36),s=gd("nonce",12,12),o=gd("ciphertext",16,2**36+16);function a(){const u=t.length;if(u!==16&&u!==24&&u!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${u} bytes`);const f=va(t),d=new Uint8Array(u),h=new Uint8Array(16),p=wt(e);let g=0,m=p[0],v=p[1],x=p[2],C=0;for(const N of[h,d].map(wt)){const O=wt(N);for(let A=0;A<O.length;A+=2){const{s0:P,s1:S}=ki(f,g,m,v,x);O[A+0]=P,O[A+1]=S,g=++C}}return f.fill(0),{authKey:h,encKey:va(d)}}function l(u,f,d){const h=C4(WJ,!0,f,d,n);for(let C=0;C<12;C++)h[C]^=e[C];h[15]&=127;const p=wt(h);let g=p[0],m=p[1],v=p[2],x=p[3];return{s0:g,s1:m,s2:v,s3:x}=ki(u,g,m,v,x),p[0]=g,p[1]=m,p[2]=v,p[3]=x,h}function c(u,f,d){let h=f.slice();return h[15]|=128,vu(u,!0,h,d)}return Bt(e),s(e.length),n&&(Bt(n),r(n.length)),{encrypt:u=>{Bt(u),i(u.length);const{encKey:f,authKey:d}=a(),h=l(f,d,u),p=new Uint8Array(u.length+16);return p.set(h,u.length),p.set(c(f,h,u)),f.fill(0),d.fill(0),p},decrypt:u=>{Bt(u),o(u.length);const f=u.subarray(-16),{encKey:d,authKey:h}=a(),p=c(d,f,u.subarray(0,-16)),g=l(d,h,p);if(d.fill(0),h.fill(0),!Vw(f,g))throw new Error("invalid polyval tag");return p}}}));const jn=(t,e)=>255&t[e++]|(255&t[e++])<<8;class YJ{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,Bt(e=ba(e),32);const n=jn(e,0),r=jn(e,2),i=jn(e,4),s=jn(e,6),o=jn(e,8),a=jn(e,10),l=jn(e,12),c=jn(e,14);this.r[0]=8191&n,this.r[1]=8191&(n>>>13|r<<3),this.r[2]=7939&(r>>>10|i<<6),this.r[3]=8191&(i>>>7|s<<9),this.r[4]=255&(s>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|a<<2),this.r[7]=8065&(a>>>11|l<<5),this.r[8]=8191&(l>>>8|c<<8),this.r[9]=c>>>5&127;for(let u=0;u<8;u++)this.pad[u]=jn(e,16+2*u)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],l=o[1],c=o[2],u=o[3],f=o[4],d=o[5],h=o[6],p=o[7],g=o[8],m=o[9],v=jn(e,n+0),x=jn(e,n+2),C=jn(e,n+4),N=jn(e,n+6),O=jn(e,n+8),A=jn(e,n+10),P=jn(e,n+12),S=jn(e,n+14);let E=s[0]+(8191&v),_=s[1]+(8191&(v>>>13|x<<3)),k=s[2]+(8191&(x>>>10|C<<6)),D=s[3]+(8191&(C>>>7|N<<9)),U=s[4]+(8191&(N>>>4|O<<12)),B=s[5]+(O>>>1&8191),M=s[6]+(8191&(O>>>14|A<<2)),T=s[7]+(8191&(A>>>11|P<<5)),L=s[8]+(8191&(P>>>8|S<<8)),q=s[9]+(S>>>5|i),F=0,j=F+E*a+_*(5*m)+k*(5*g)+D*(5*p)+U*(5*h);F=j>>>13,j&=8191,j+=B*(5*d)+M*(5*f)+T*(5*u)+L*(5*c)+q*(5*l),F+=j>>>13,j&=8191;let Z=F+E*l+_*a+k*(5*m)+D*(5*g)+U*(5*p);F=Z>>>13,Z&=8191,Z+=B*(5*h)+M*(5*d)+T*(5*f)+L*(5*u)+q*(5*c),F+=Z>>>13,Z&=8191;let J=F+E*c+_*l+k*a+D*(5*m)+U*(5*g);F=J>>>13,J&=8191,J+=B*(5*p)+M*(5*h)+T*(5*d)+L*(5*f)+q*(5*u),F+=J>>>13,J&=8191;let ue=F+E*u+_*c+k*l+D*a+U*(5*m);F=ue>>>13,ue&=8191,ue+=B*(5*g)+M*(5*p)+T*(5*h)+L*(5*d)+q*(5*f),F+=ue>>>13,ue&=8191;let ae=F+E*f+_*u+k*c+D*l+U*a;F=ae>>>13,ae&=8191,ae+=B*(5*m)+M*(5*g)+T*(5*p)+L*(5*h)+q*(5*d),F+=ae>>>13,ae&=8191;let X=F+E*d+_*f+k*u+D*c+U*l;F=X>>>13,X&=8191,X+=B*a+M*(5*m)+T*(5*g)+L*(5*p)+q*(5*h),F+=X>>>13,X&=8191;let be=F+E*h+_*d+k*f+D*u+U*c;F=be>>>13,be&=8191,be+=B*l+M*a+T*(5*m)+L*(5*g)+q*(5*p),F+=be>>>13,be&=8191;let De=F+E*p+_*h+k*d+D*f+U*u;F=De>>>13,De&=8191,De+=B*c+M*l+T*a+L*(5*m)+q*(5*g),F+=De>>>13,De&=8191;let de=F+E*g+_*p+k*h+D*d+U*f;F=de>>>13,de&=8191,de+=B*u+M*c+T*l+L*a+q*(5*m),F+=de>>>13,de&=8191;let ke=F+E*m+_*g+k*p+D*h+U*d;F=ke>>>13,ke&=8191,ke+=B*f+M*u+T*c+L*l+q*a,F+=ke>>>13,ke&=8191,F=(F<<2)+F|0,F=F+j|0,j=8191&F,F>>>=13,Z+=F,s[0]=j,s[1]=Z,s[2]=J,s[3]=ue,s[4]=ae,s[5]=X,s[6]=be,s[7]=De,s[8]=de,s[9]=ke}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(1^i)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+n[0];e[0]=65535&o;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=65535&o}update(e){Ic(this);const{buffer:n,blockLen:r}=this,i=(e=ba(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0);else for(;r<=i-s;s+=r)this.process(e,s)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){Ic(this),zw(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}(function(t){const e=(r,i)=>t(i).update(ba(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e})((t=>new YJ(t)));const T4=t=>Uint8Array.from(t.split("").map((e=>e.charCodeAt(0)))),JJ=T4("expand 16-byte k"),XJ=T4("expand 32-byte k"),QJ=wt(JJ),I4=wt(XJ);I4.slice();function We(t,e){return t<<e|t>>>32-e}function W0(t){return t.byteOffset%4==0}const nA=2**32-1,rA=new Uint32Array;function O4(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=(function(a,l){if(l==null||typeof l!="object")throw new Error("options must be defined");return Object.assign(a,l)})({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return V0(i),V0(o),eA(s),eA(n),(a,l,c,u,f=0)=>{Bt(a),Bt(l),Bt(c);const d=c.length;if(u||(u=new Uint8Array(d)),Bt(u),V0(f),f<0||f>=nA)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const h=[];let p,g,m=a.length;if(m===32)p=a.slice(),h.push(p),g=I4;else{if(m!==16||!n)throw new Error(`arx: invalid 32-byte key, got length=${m}`);p=new Uint8Array(32),p.set(a),p.set(a,16),g=QJ,h.push(p)}W0(l)||(l=l.slice(),h.push(l));const v=wt(p);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,v,wt(l.subarray(0,16)),v),l=l.subarray(16)}const x=16-i;if(x!==l.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const N=new Uint8Array(12);N.set(l,s?0:12-l.length),l=N,h.push(l)}const C=wt(l);for(!(function(N,O,A,P,S,E,_,k){const D=S.length,U=new Uint8Array(64),B=wt(U),M=W0(S)&&W0(E),T=M?wt(S):rA,L=M?wt(E):rA;for(let q=0;q<D;_++){if(N(O,A,P,B,_,k),_>=nA)throw new Error("arx: counter overflow");const F=Math.min(64,D-q);if(M&&F===64){const j=q/4;if(q%4!=0)throw new Error("arx: invalid block position");for(let Z,J=0;J<16;J++)Z=j+J,L[Z]=T[Z]^B[J];q+=64}else{for(let j,Z=0;Z<F;Z++)j=q+Z,E[j]=S[j]^U[Z];q+=F}}})(t,g,v,C,c,u,f,o);h.length>0;)h.pop().fill(0);return u}}function M4(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],f=e[1],d=e[2],h=e[3],p=e[4],g=e[5],m=e[6],v=e[7],x=i,C=n[0],N=n[1],O=n[2],A=o,P=a,S=l,E=c,_=u,k=f,D=d,U=h,B=p,M=g,T=m,L=v,q=x,F=C,j=N,Z=O;for(let ue=0;ue<s;ue+=2)A=A+_|0,q=We(q^A,16),B=B+q|0,_=We(_^B,12),A=A+_|0,q=We(q^A,8),B=B+q|0,_=We(_^B,7),P=P+k|0,F=We(F^P,16),M=M+F|0,k=We(k^M,12),P=P+k|0,F=We(F^P,8),M=M+F|0,k=We(k^M,7),S=S+D|0,j=We(j^S,16),T=T+j|0,D=We(D^T,12),S=S+D|0,j=We(j^S,8),T=T+j|0,D=We(D^T,7),E=E+U|0,Z=We(Z^E,16),L=L+Z|0,U=We(U^L,12),E=E+U|0,Z=We(Z^E,8),L=L+Z|0,U=We(U^L,7),A=A+k|0,Z=We(Z^A,16),T=T+Z|0,k=We(k^T,12),A=A+k|0,Z=We(Z^A,8),T=T+Z|0,k=We(k^T,7),P=P+D|0,q=We(q^P,16),L=L+q|0,D=We(D^L,12),P=P+D|0,q=We(q^P,8),L=L+q|0,D=We(D^L,7),S=S+U|0,F=We(F^S,16),B=B+F|0,U=We(U^B,12),S=S+U|0,F=We(F^S,8),B=B+F|0,U=We(U^B,7),E=E+_|0,j=We(j^E,16),M=M+j|0,_=We(_^M,12),E=E+_|0,j=We(j^E,8),M=M+j|0,_=We(_^M,7);let J=0;r[J++]=o+A|0,r[J++]=a+P|0,r[J++]=l+S|0,r[J++]=c+E|0,r[J++]=u+_|0,r[J++]=f+k|0,r[J++]=d+D|0,r[J++]=h+U|0,r[J++]=p+B|0,r[J++]=g+M|0,r[J++]=m+T|0,r[J++]=v+L|0,r[J++]=x+q|0,r[J++]=C+F|0,r[J++]=N+j|0,r[J++]=O+Z|0}const L4=O4(M4,{counterRight:!1,counterLength:4,allowShortKeys:!1});O4(M4,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let i=t[0],s=t[1],o=t[2],a=t[3],l=e[0],c=e[1],u=e[2],f=e[3],d=e[4],h=e[5],p=e[6],g=e[7],m=n[0],v=n[1],x=n[2],C=n[3];for(let O=0;O<20;O+=2)i=i+l|0,m=We(m^i,16),d=d+m|0,l=We(l^d,12),i=i+l|0,m=We(m^i,8),d=d+m|0,l=We(l^d,7),s=s+c|0,v=We(v^s,16),h=h+v|0,c=We(c^h,12),s=s+c|0,v=We(v^s,8),h=h+v|0,c=We(c^h,7),o=o+u|0,x=We(x^o,16),p=p+x|0,u=We(u^p,12),o=o+u|0,x=We(x^o,8),p=p+x|0,u=We(u^p,7),a=a+f|0,C=We(C^a,16),g=g+C|0,f=We(f^g,12),a=a+f|0,C=We(C^a,8),g=g+C|0,f=We(f^g,7),i=i+c|0,C=We(C^i,16),p=p+C|0,c=We(c^p,12),i=i+c|0,C=We(C^i,8),p=p+C|0,c=We(c^p,7),s=s+u|0,m=We(m^s,16),g=g+m|0,u=We(u^g,12),s=s+u|0,m=We(m^s,8),g=g+m|0,u=We(u^g,7),o=o+f|0,v=We(v^o,16),d=d+v|0,f=We(f^d,12),o=o+f|0,v=We(v^o,8),d=d+v|0,f=We(f^d,7),a=a+l|0,x=We(x^a,16),h=h+x|0,l=We(l^h,12),a=a+l|0,x=We(x^a,8),h=h+x|0,l=We(l^h,7);let N=0;r[N++]=i,r[N++]=s,r[N++]=o,r[N++]=a,r[N++]=m,r[N++]=v,r[N++]=x,r[N++]=C},allowShortKeys:!1});class $4 extends l4{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,fs.hash(e);const r=df(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return fs.exists(this),this.iHash.update(e),this}digestInto(e){fs.exists(this),fs.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const yg=(t,e,n)=>new $4(t,e).update(n).digest();function eX(t,e,n){return fs.hash(t),yg(t,df(n),df(e))}yg.create=(t,e)=>new $4(t,e);const K0=new Uint8Array([0]),iA=new Uint8Array;function tX(t,e,n,r=32){if(fs.hash(t),fs.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=iA);const s=new Uint8Array(i*t.outputLen),o=yg.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)K0[0]=c+1,a.update(c===0?iA:l).update(n).update(K0).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),K0.fill(0),s.slice(0,r)}var nX=Object.defineProperty,dn=(t,e)=>{for(var n in e)nX(t,n,{get:e[n],enumerable:!0})},Ho=Symbol("verified"),rX=t=>t instanceof Object;function bg(t){if(!rX(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function iX(t){return t.sort(((e,n)=>e.created_at!==n.created_at?n.created_at-e.created_at:e.id.localeCompare(n.id)))}var N4={};dn(N4,{Queue:()=>R4,QueueNode:()=>P4,binarySearch:()=>Gw,insertEventIntoAscendingList:()=>oX,insertEventIntoDescendingList:()=>sX,normalizeURL:()=>Gl,utf8Decoder:()=>Vs,utf8Encoder:()=>Hi});var Vs=new TextDecoder("utf-8"),Hi=new TextEncoder;function Gl(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function sX(t,e){const[n,r]=Gw(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at));return r||t.splice(n,0,e),t}function oX(t,e){const[n,r]=Gw(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at));return r||t.splice(n,0,e),t}function Gw(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var P4=class{value;next=null;prev=null;constructor(t){this.value=t}},R4=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new P4(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function D4(t){if(!bg(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Bu(t){return An(Al(Hi.encode(D4(t))))}var vg=new class{generateSecretKey(){return rs.utils.randomPrivateKey()}getPublicKey(t){return An(rs.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=An(rs.getPublicKey(e)),n.id=Bu(n),n.sig=An(rs.sign(Bu(n),e)),n[Ho]=!0,n}verifyEvent(t){if(typeof t[Ho]=="boolean")return t[Ho];const e=Bu(t);if(e!==t.id)return t[Ho]=!1,!1;try{const n=rs.verify(t.sig,e,t.pubkey);return t[Ho]=n,n}catch{return t[Ho]=!1,!1}}},B4=vg.generateSecretKey,Zw=vg.getPublicKey,Fi=vg.finalizeEvent,zc=vg.verifyEvent,U4={};function H4(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function Yw(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function F4(t){return 2e4<=t&&t<3e4}function Jw(t){return 3e4<=t&&t<4e4}function aX(t){return H4(t)?"regular":Yw(t)?"replaceable":F4(t)?"ephemeral":Jw(t)?"parameterized":"unknown"}function lX(t,e){const n=e instanceof Array?e:[e];return bg(t)&&n.includes(t.kind)||!1}dn(U4,{Application:()=>lQ,BadgeAward:()=>gX,BadgeDefinition:()=>tQ,BlockedRelaysList:()=>UX,BookmarkList:()=>RX,Bookmarksets:()=>XX,Calendar:()=>gQ,CalendarEventRSVP:()=>mQ,ChannelCreation:()=>j4,ChannelHideMessage:()=>W4,ChannelMessage:()=>q4,ChannelMetadata:()=>V4,ChannelMuteUser:()=>K4,ClassifiedListing:()=>fQ,ClientAuth:()=>Z4,CommunitiesList:()=>DX,CommunityDefinition:()=>vQ,CommunityPostApproval:()=>_X,Contacts:()=>dX,CreateOrUpdateProduct:()=>iQ,CreateOrUpdateStall:()=>rQ,Curationsets:()=>QX,Date:()=>hQ,DirectMessageRelaysList:()=>jX,DraftClassifiedListing:()=>dQ,DraftLong:()=>oQ,Emojisets:()=>aQ,EncryptedDirectMessage:()=>hX,EventDeletion:()=>pX,FileMetadata:()=>vX,FileServerPreference:()=>VX,Followsets:()=>ZX,GenericRepost:()=>yX,Genericlists:()=>YX,GiftWrap:()=>G4,HTTPAuth:()=>e1,Handlerinformation:()=>bQ,Handlerrecommendation:()=>yQ,Highlights:()=>LX,InterestsList:()=>FX,Interestsets:()=>nQ,JobFeedback:()=>TX,JobRequest:()=>kX,JobResult:()=>CX,Label:()=>AX,LightningPubRPC:()=>WX,LiveChatMessage:()=>wX,LiveEvent:()=>cQ,LongFormArticle:()=>sQ,Metadata:()=>cX,Mutelist:()=>$X,NWCWalletInfo:()=>qX,NWCWalletRequest:()=>Y4,NWCWalletResponse:()=>KX,NostrConnect:()=>GX,OpenTimestamps:()=>bX,Pinlist:()=>NX,PrivateDirectMessage:()=>mX,ProblemTracker:()=>EX,ProfileBadges:()=>eQ,PublicChatsList:()=>BX,Reaction:()=>Qw,RecommendRelay:()=>fX,RelayList:()=>PX,Relaysets:()=>JX,Report:()=>xX,Reporting:()=>SX,Repost:()=>Xw,Seal:()=>z4,SearchRelaysList:()=>HX,ShortTextNote:()=>uX,Time:()=>pQ,UserEmojiList:()=>zX,UserStatuses:()=>uQ,Zap:()=>MX,ZapGoal:()=>IX,ZapRequest:()=>OX,classifyKind:()=>aX,isEphemeralKind:()=>F4,isKind:()=>lX,isParameterizedReplaceableKind:()=>Jw,isRegularKind:()=>H4,isReplaceableKind:()=>Yw});var cX=0,uX=1,fX=2,dX=3,hX=4,pX=5,Xw=6,Qw=7,gX=8,z4=13,mX=14,yX=16,j4=40,V4=41,q4=42,W4=43,K4=44,bX=1040,G4=1059,vX=1063,wX=1311,EX=1971,xX=1984,SX=1984,AX=1985,_X=4550,kX=5999,CX=6999,TX=7e3,IX=9041,OX=9734,MX=9735,LX=9802,$X=1e4,NX=10001,PX=10002,RX=10003,DX=10004,BX=10005,UX=10006,HX=10007,FX=10015,zX=10030,jX=10050,VX=10096,qX=13194,WX=21e3,Z4=22242,Y4=23194,KX=23195,GX=24133,e1=27235,ZX=3e4,YX=30001,JX=30002,XX=30003,QX=30004,eQ=30008,tQ=30009,nQ=30015,rQ=30017,iQ=30018,sQ=30023,oQ=30024,aQ=30030,lQ=30078,cQ=30311,uQ=30315,fQ=30402,dQ=30403,hQ=31922,pQ=31923,gQ=31924,mQ=31925,yQ=31989,bQ=31990,vQ=34550;function J4(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}function X4(t,e){for(let n=0;n<t.length;n++)if(J4(t[n],e))return!0;return!1}function wQ(...t){let e={};for(let n=0;n<t.length;n++){let r=t[n];Object.entries(r).forEach((([i,s])=>{if(i==="kinds"||i==="ids"||i==="authors"||i[0]==="#"){e[i]=e[i]||[];for(let o=0;o<s.length;o++){let a=s[o];e[i].includes(a)||e[i].push(a)}}})),r.limit&&(!e.limit||r.limit>e.limit)&&(e.limit=r.limit),r.until&&(!e.until||r.until>e.until)&&(e.until=r.until),r.since&&(!e.since||r.since<e.since)&&(e.since=r.since)}return e}function EQ(t){if(t.ids&&!t.ids.length||t.kinds&&!t.kinds.length||t.authors&&!t.authors.length)return 0;for(const[e,n]of Object.entries(t))if(e[0]==="#"&&Array.isArray(n)&&!n.length)return 0;return Math.min(Math.max(0,t.limit??1/0),t.ids?.length??1/0,t.authors?.length&&t.kinds?.every((e=>Yw(e)))?t.authors.length*t.kinds.length:1/0,t.authors?.length&&t.kinds?.every((e=>Jw(e)))&&t["#d"]?.length?t.authors.length*t.kinds.length*t["#d"].length:1/0)}var Q4={};function wg(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function e5(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function t5(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function xQ(t,e){return e===wg(t,"id")}function SQ(t,e){return e===wg(t,"pubkey")}function AQ(t,e){return e===e5(t,"kind")}dn(Q4,{getHex64:()=>wg,getInt:()=>e5,getSubscriptionId:()=>t5,matchEventId:()=>xQ,matchEventKind:()=>AQ,matchEventPubkey:()=>SQ});var n5={};function r5(t,e){return{kind:Z4,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function _Q(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}dn(n5,{makeAuthEvent:()=>r5});var i5,kQ=t=>(t[Ho]=!0,!0),t1=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new R4;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=Gl(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new t1(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await _Q();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=t5(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=wg(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&X4(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t(r5(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new CQ(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},CQ=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{i5=WebSocket}catch{}var s5,o5=class extends t1{constructor(t){super(t,{verifyEvent:zc,websocketImplementation:i5})}static async connect(t){const e=new o5(t);return await e.connect(),e}},TQ=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=Gl(t);let n=this.relays.get(t);return n||(n=new t1(t,{verifyEvent:this.trustedRelayURLs.has(t)?kQ:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(Gl).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(f,d)=>{let h=this.seenOn.get(d);h||(h=new Set,this.seenOn.set(d,h)),h.add(f)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=f=>{s[f]=!0,s.filter((d=>d)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(f,d)=>{o(f),a[f]=d,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=f=>{if(e.alreadyHaveEvent?.(f))return!0;const d=n.has(f);return n.add(f),d},u=Promise.all(Object.entries(t).map((async(f,d,h)=>{if(h.indexOf(f)!==d)return void l(d,"duplicate url");let p,[g,m]=f;g=Gl(g);try{p=await this.ensureRelay(g,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(x){return void l(d,x?.message||String(x))}let v=p.subscribe(m,{...e,oneose:()=>o(d),onclose:x=>l(d,x),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(v)})));return{async close(){await u,r.forEach((f=>{f.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(Gl).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{s5=WebSocket}catch{}var IQ=class extends TQ{constructor(){super({verifyEvent:zc,websocketImplementation:s5})}},a5={};dn(a5,{BECH32_REGEX:()=>l5,Bech32MaxSize:()=>n1,NostrTypeGuard:()=>OQ,decode:()=>Nf,encodeBytes:()=>xg,naddrEncode:()=>RQ,neventEncode:()=>PQ,noteEncode:()=>$Q,nprofileEncode:()=>NQ,npubEncode:()=>LQ,nsecEncode:()=>MQ});var OQ={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},n1=5e3,l5=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Nf(t){let{prefix:e,words:n}=Tc.decode(t,n1),r=new Uint8Array(Tc.fromWords(n));switch(e){case"nprofile":{let i=G0(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:An(i[0][0]),relays:i[1]?i[1].map((s=>Vs.decode(s))):[]}}}case"nevent":{let i=G0(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:An(i[0][0]),relays:i[1]?i[1].map((s=>Vs.decode(s))):[],author:i[2]?.[0]?An(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(An(i[3][0]),16):void 0}}}case"naddr":{let i=G0(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Vs.decode(i[0][0]),pubkey:An(i[2][0]),kind:parseInt(An(i[3][0]),16),relays:i[1]?i[1].map((s=>Vs.decode(s))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:An(r)};default:throw new Error(`unknown prefix ${e}`)}}function G0(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function MQ(t){return xg("nsec",t)}function LQ(t){return xg("npub",Cc(t))}function $Q(t){return xg("note",Cc(t))}function Eg(t,e){let n=Tc.toWords(e);return Tc.encode(t,n,n1)}function xg(t,e){return Eg(t,e)}function NQ(t){return Eg("nprofile",r1({0:[Cc(t.pubkey)],1:(t.relays||[]).map((e=>Hi.encode(e)))}))}function PQ(t){let e;return t.kind!==void 0&&(e=(function(n){const r=new Uint8Array(4);return r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=255&n,r})(t.kind)),Eg("nevent",r1({0:[Cc(t.id)],1:(t.relays||[]).map((n=>Hi.encode(n))),2:t.author?[Cc(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function RQ(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),Eg("naddr",r1({0:[Hi.encode(t.identifier)],1:(t.relays||[]).map((n=>Hi.encode(n))),2:[Cc(t.pubkey)],3:[new Uint8Array(e)]}))}function r1(t){let e=[];return Object.entries(t).reverse().forEach((([n,r])=>{r.forEach((i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)}))})),gg(...e)}var DQ=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function BQ(t){let e=[];for(let n of t.content.matchAll(DQ))if(n[2])try{let{type:r,data:i}=Nf(n[1]);switch(r){case"npub":e.push({text:n[0],profile:{pubkey:i,relays:[]}});break;case"nprofile":e.push({text:n[0],profile:i});break;case"note":e.push({text:n[0],event:{id:i,relays:[]}});break;case"nevent":e.push({text:n[0],event:i});break;case"naddr":e.push({text:n[0],address:i})}}catch{}else if(n[3]){let r=parseInt(n[3],10),i=t.tags[r];if(!i)continue;switch(i[0]){case"p":e.push({text:n[0],profile:{pubkey:i[1],relays:i[2]?[i[2]]:[]}});break;case"e":e.push({text:n[0],event:{id:i[1],relays:i[2]?[i[2]]:[]}});break;case"a":try{let[s,o,a]=i[1].split(":");e.push({text:n[0],address:{identifier:a,pubkey:o,kind:parseInt(s,10),relays:i[2]?[i[2]]:[]}})}catch{}}}return e}var c5={};async function u5(t,e,n){const r=t instanceof Uint8Array?An(t):t,i=f5(Bc.getSharedSecret(r,"02"+e));let s=Uint8Array.from(u4(16)),o=Hi.encode(n),a=k4(i,s).encrypt(o);return`${ya.encode(new Uint8Array(a))}?iv=${ya.encode(new Uint8Array(s.buffer))}`}async function UQ(t,e,n){const r=t instanceof Uint8Array?An(t):t;let[i,s]=n.split("?iv="),o=f5(Bc.getSharedSecret(r,"02"+e)),a=ya.decode(s),l=ya.decode(i),c=k4(o,a).decrypt(l);return Vs.decode(c)}function f5(t){return t.slice(1,33)}dn(c5,{decrypt:()=>UQ,encrypt:()=>u5});var d5={};dn(d5,{NIP05_REGEX:()=>i1,isNip05:()=>HQ,isValid:()=>jQ,queryProfile:()=>h5,searchDomain:()=>zQ,useFetchImplementation:()=>FQ});var Sg,i1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,HQ=t=>i1.test(t||"");try{Sg=fetch}catch{}function FQ(t){Sg=t}async function zQ(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Sg(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function h5(t){const e=t.match(i1);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Sg(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function jQ(t,e){const n=await h5(e);return!!n&&n.pubkey===t}var p5={};function VQ(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,f={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=f;continue}if(c==="reply"){e.reply=f;continue}if(c==="mention"){e.mentions.push(f);continue}n?r=f:n=f,e.mentions.push(f)}else{if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}s[0]==="p"&&s[1]&&e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find((a=>a.pubkey===i.author));o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach((a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)})),o.relays=i.relays)}})),e.mentions.forEach((i=>{if(i.author){let s=e.profiles.find((o=>o.pubkey===i.author));s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach((o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)})),s.relays=i.relays)}})),e}dn(p5,{parse:()=>VQ});var g5={};dn(g5,{fetchRelayInformation:()=>WQ,useFetchImplementation:()=>qQ});function qQ(t){}async function WQ(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var m5={};function y5(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r!==0){e+=Math.clz32(r);break}e+=32}return e}function KQ(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=b5(r),y5(r.id)>=e)break}return r}function b5(t){return An(Al(Hi.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}dn(m5,{fastEventHash:()=>b5,getPow:()=>y5,minePow:()=>KQ});var v5={};function GQ(t,e,n,r){return Fi({kind:Xw,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function w5(t){if(t.kind!==Xw)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0?{id:e[1],relays:[e[2],n?.[2]].filter((r=>typeof r=="string")),author:n?.[1]}:void 0}function ZQ(t,{skipVerification:e}={}){const n=w5(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}return r.id===n.id&&(e||zc(r))?r:void 0}dn(v5,{finishRepostEvent:()=>GQ,getRepostedEvent:()=>ZQ,getRepostedEventPointer:()=>w5});var E5={};dn(E5,{NOSTR_URI_REGEX:()=>Ag,parse:()=>JQ,test:()=>YQ});var Ag=new RegExp(`nostr:(${l5.source})`);function YQ(t){return typeof t=="string"&&new RegExp(`^${Ag.source}$`).test(t)}function JQ(t){const e=t.match(new RegExp(`^${Ag.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Nf(e[1])}}var x5={};function XQ(t,e,n){const r=e.tags.filter((i=>i.length>=2&&(i[0]==="e"||i[0]==="p")));return Fi({...t,kind:Qw,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function QQ(t){if(t.kind!==Qw)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0&&n!==void 0?{id:e[1],relays:[e[2],n[2]].filter((r=>r!==void 0)),author:n[1]}:void 0}dn(x5,{finishReactionEvent:()=>XQ,getReactedEventPointer:()=>QQ});var S5={};dn(S5,{matchAll:()=>eee,regex:()=>s1,replaceAll:()=>tee});var s1=()=>new RegExp(`\\b${Ag.source}\\b`,"g");function*eee(t){const e=t.matchAll(s1());for(const n of e)try{const[r,i]=n;yield{uri:r,value:i,decoded:Nf(i),start:n.index,end:n.index+r.length}}catch{}}function tee(t,e){return t.replaceAll(s1(),((n,r)=>e({uri:n,value:r,decoded:Nf(r)})))}var A5={};dn(A5,{channelCreateEvent:()=>nee,channelHideMessageEvent:()=>see,channelMessageEvent:()=>iee,channelMetadataEvent:()=>ree,channelMuteUserEvent:()=>oee});var nee=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return Fi({kind:j4,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},ree=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return Fi({kind:V4,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},iee=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),Fi({kind:q4,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},see=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return Fi({kind:W4,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},oee=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return Fi({kind:K4,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},_5={};dn(_5,{EMOJI_SHORTCODE_REGEX:()=>k5,matchAll:()=>aee,regex:()=>o1,replaceAll:()=>lee});var k5=/:(\w+):/,o1=()=>new RegExp(`\\B${k5.source}\\B`,"g");function*aee(t){const e=t.matchAll(o1());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function lee(t,e){return t.replaceAll(o1(),((n,r)=>e({shortcode:n,name:r})))}var a1,C5={};dn(C5,{useFetchImplementation:()=>cee,validateGithub:()=>uee});try{a1=fetch}catch{}function cee(t){a1=t}async function uee(t,e,n){try{return await(await a1(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var T5={};dn(T5,{decrypt:()=>f1,encrypt:()=>u1,getConversationKey:()=>l1,v2:()=>dee});var I5=1,O5=65535;function l1(t,e){const n=Bc.getSharedSecret(t,"02"+e).subarray(1,33);return eX(Al,n,"nip44-v2")}function M5(t,e){const n=tX(Al,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function c1(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function fee(t){const e=Hi.encode(t),n=e.length;return gg((function(r){if(!Number.isSafeInteger(r)||r<I5||r>O5)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const i=new Uint8Array(2);return new DataView(i.buffer).setUint16(0,r,!1),i})(n),e,new Uint8Array(c1(n)-n))}function L5(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=gg(n,e);return yg(Al,t,r)}function u1(t,e,n=u4(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=M5(e,n),o=fee(t),a=L4(r,i,o),l=L5(s,a,n);return ya.encode(gg(new Uint8Array([2]),n,a,l))}function f1(t,e){const{nonce:n,ciphertext:r,mac:i}=(function(l){if(typeof l!="string")throw new Error("payload must be a valid string");const c=l.length;if(c<132||c>87472)throw new Error("invalid payload length: "+c);if(l[0]==="#")throw new Error("unknown encryption version");let u;try{u=ya.decode(l)}catch(h){throw new Error("invalid base64: "+h.message)}const f=u.length;if(f<99||f>65603)throw new Error("invalid data length: "+f);const d=u[0];if(d!==2)throw new Error("unknown encryption version "+d);return{nonce:u.subarray(1,33),ciphertext:u.subarray(33,-32),mac:u.subarray(-32)}})(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=M5(e,n);if(!Vw(L5(a,r,n),i))throw new Error("invalid MAC");return(function(l){const c=new DataView(l.buffer).getUint16(0),u=l.subarray(2,2+c);if(c<I5||c>O5||u.length!==c||l.length!==2+c1(c))throw new Error("invalid padding");return Vs.decode(u)})(L4(s,o,r))}var dee={utils:{getConversationKey:l1,calcPaddedLen:c1},encrypt:u1,decrypt:f1},$5={};function hee(t){const{pathname:e,searchParams:n}=new URL(t),r=e,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function pee(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},i=await u5(e,t,JSON.stringify(r)),s={kind:Y4,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return Fi(s,e)}dn($5,{makeNwcRequestEvent:()=>pee,parseConnectionString:()=>hee});var d1,N5={};dn(N5,{getZapEndpoint:()=>mee,makeZapReceipt:()=>vee,makeZapRequest:()=>yee,useFetchImplementation:()=>gee,validateZapRequest:()=>bee});try{d1=fetch}catch{}function gee(t){d1=t}async function mee(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=Tc.decode(n,1e3),a=Tc.fromWords(o);e=Vs.decode(a)}else{if(!r)return null;{let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}}let i=await d1(e),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function yee({profile:t,event:e,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function bee(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!bg(e))return"Zap request is not a valid Nostr event.";if(!zc(e))return"Invalid signature on zap request.";let n=e.tags.find((([i,s])=>i==="p"&&s));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([i,s])=>i==="e"&&s));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([i,s])=>i==="relays"&&s))?null:"Zap request doesn't have a 'relays' tag."}function vee({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter((([a])=>a==="e"||a==="p"||a==="a")),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}var P5={};dn(P5,{createRumor:()=>H5,createSeal:()=>F5,createWrap:()=>z5,unwrapEvent:()=>j5,unwrapManyEvents:()=>Eee,wrapEvent:()=>$b,wrapManyEvents:()=>wee});var R5=()=>Math.round(Date.now()/1e3),D5=()=>Math.round(R5()-172800*Math.random()),B5=(t,e)=>l1(t,e),U5=(t,e,n)=>u1(JSON.stringify(t),B5(e,n)),sA=(t,e)=>JSON.parse(f1(t.content,B5(e,t.pubkey)));function H5(t,e){const n={created_at:R5(),content:"",tags:[],...t,pubkey:Zw(e)};return n.id=Bu(n),n}function F5(t,e,n){return Fi({kind:z4,content:U5(t,e,n),created_at:D5(),tags:[]},e)}function z5(t,e){const n=B4();return Fi({kind:G4,content:U5(t,n,e),created_at:D5(),tags:[["p",e]]},n)}function $b(t,e,n){return z5(F5(H5(t,e),e,n),n)}function wee(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Zw(e),i=[$b(t,e,r)];return n.forEach((s=>{i.push($b(t,e,s))})),i}function j5(t,e){const n=sA(t,e);return sA(n,e)}function Eee(t,e){let n=[];return t.forEach((r=>{n.push(j5(r,e))})),n.sort(((r,i)=>r.created_at-i.created_at)),n}var V5={};dn(V5,{getToken:()=>xee,hashPayload:()=>h1,unpackEventFromToken:()=>W5,validateEvent:()=>X5,validateEventKind:()=>G5,validateEventMethodTag:()=>Y5,validateEventPayloadTag:()=>J5,validateEventTimestamp:()=>K5,validateEventUrlTag:()=>Z5,validateToken:()=>See});var q5="Nostr ";async function xee(t,e,n,r=!1,i){const s={kind:e1,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",h1(i)]);const o=await n(s);return(r?q5:"")+ya.encode(Hi.encode(JSON.stringify(o)))}async function See(t,e,n){const r=await W5(t).catch((i=>{throw i}));return await X5(r,e,n).catch((i=>{throw i}))}async function W5(t){if(!t)throw new Error("Missing token");t=t.replace(q5,"");const e=Vs.decode(ya.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function K5(t){return!!t.created_at&&Math.round(new Date().getTime()/1e3)-t.created_at<60}function G5(t){return t.kind===e1}function Z5(t,e){const n=t.tags.find((r=>r[0]==="u"));return!!n&&n.length>0&&n[1]===e}function Y5(t,e){const n=t.tags.find((r=>r[0]==="method"));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function h1(t){return An(Al(Hi.encode(JSON.stringify(t))))}function J5(t,e){const n=t.tags.find((i=>i[0]==="payload"));if(!n)return!1;const r=h1(e);return n.length>0&&n[1]===r}async function X5(t,e,n,r){if(!zc(t))throw new Error("Invalid nostr event, signature invalid");if(!G5(t))throw new Error("Invalid nostr event, kind invalid");if(!K5(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Z5(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!Y5(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!J5(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const ut={LIBRARIES:{decodeBolt11:pJ.decode,NostrTools:xb},DEFAULT_OPTIONS:{theme:"light",colorMode:!0},BATCH_SIZE:5,REQ_CONFIG:{INITIAL_LOAD_COUNT:15,ADDITIONAL_LOAD_COUNT:20},LOAD_TIMEOUT:1e4,BUFFER_INTERVAL:500,BUFFER_MIN_INTERVAL:100,INFINITE_SCROLL:{ROOT_MARGIN:"400px",THRESHOLD:.1,DEBOUNCE_TIME:500,RETRY_DELAY:500},ZAP_CONFIG:{DEFAULT_LIMIT:1,DEFAULT_COLOR_MODE:!0,ERRORS:{DIALOG_NOT_FOUND:"Zap dialog not found",BUTTON_NOT_FOUND:"Fetch button not found",DECODE_FAILED:"Failed to decode identifier"}},ZAP_AMOUNT_CONFIG:{DEFAULT_COLOR_MODE:!0,THRESHOLDS:[{value:1e4,className:"zap-amount-10k"},{value:5e3,className:"zap-amount-5k"},{value:2e3,className:"zap-amount-2k"},{value:1e3,className:"zap-amount-1k"},{value:500,className:"zap-amount-500"},{value:200,className:"zap-amount-200"},{value:100,className:"zap-amount-100"}],DEFAULT_CLASS:"default-color",DISABLED_CLASS:""},DIALOG_CONFIG:{DEFAULT_TITLE:"To ",NO_ZAPS_MESSAGE:"No Zaps yet!<br>Send the first Zap!",DEFAULT_NO_ZAPS_DELAY:1500,ZAP_LIST:{INITIAL_BATCH:30,REMAINING_BATCH:30,PROFILE_BATCH:30,MIN_HEIGHT:"100px"}},REQUEST_CONFIG:{METADATA_TIMEOUT:2e4,REQUEST_TIMEOUT:2e3,CACHE_DURATION:3e5},PROFILE_CONFIG:{BATCH_SIZE:20,BATCH_DELAY:100,RELAYS:["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine","wss://directory.yabu.me"]},BATCH_CONFIG:{REFERENCE_PROCESSOR:{BATCH_SIZE:20,BATCH_DELAY:100},SUPPORTED_EVENT_KINDS:[1,30023,30030,30009,40,42,31990]},BATCH_PROCESSOR_CONFIG:{DEFAULT_BATCH_SIZE:20,DEFAULT_BATCH_DELAY:100,DEFAULT_MAX_CACHE_AGE:18e5,DEFAULT_RELAY_URLS:[],TIMEOUT_DURATION:500}};class hf{constructor(e,n,r=null){this.identifier=e,this.relayUrls=n,this.isColorModeEnabled=r===null?ut.ZAP_CONFIG.DEFAULT_COLOR_MODE:String(r).toLowerCase()==="true"}static determineColorMode(e){if(!e||!e.hasAttribute("data-zap-color-mode"))return ut.ZAP_CONFIG.DEFAULT_COLOR_MODE;const n=e.getAttribute("data-zap-color-mode");return n.toLowerCase()!=="true"&&n.toLowerCase()!=="false"||n.toLowerCase()==="true"}static fromButton(e){if(!e)throw new Error(ut.ZAP_CONFIG.ERRORS.BUTTON_NOT_FOUND);const n=hf.determineColorMode(e);return new hf(e.getAttribute("data-nzv-id"),e.getAttribute("data-relay-urls").split(","),n)}}class ro{constructor(e=1e3){this.cache=new Map,this.maxSize=e,this.accessOrder=new Map}set(e,n){if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const r=this.accessOrder.keys().next().value;this.cache.delete(r),this.accessOrder.delete(r)}return this.cache.set(e,n),this.accessOrder.delete(e),this.accessOrder.set(e,Date.now()),n}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.accessOrder.set(e,Date.now()),n}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}}class p1 extends ro{#e=new Map;setProfile(e,n){if(!e||!n)return;const r=this.get(e);r&&r._eventCreatedAt&&n._eventCreatedAt&&!(n._eventCreatedAt>r._eventCreatedAt)||(this.set(e,n),this.#t(e,n))}#t(e,n){this.#e.forEach((r=>{try{r(e,n)}catch{}}))}subscribe(e){if(typeof e!="function")return null;const n=Math.random().toString(36).substr(2,9);return this.#e.set(n,e),()=>this.#e.delete(n)}clearSubscriptions(){this.#e.clear()}}class Aee extends ro{#e=new Map;initializeView(e){this.#e.set(e,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,batchProcessing:!1})}getViewState(e){return this.#e.get(e)||this.initializeView(e)}updateViewState(e,n){const r=this.getViewState(e);return this.#e.set(e,{...r,...n}),this.#e.get(e)}getEvents(e){return this.get(e)||[]}setEvents(e,n,r=!1){const i=r?this.getEvents(e):[],s=new Map(n.map((a=>[a.id,a]))),o=[...i.filter((a=>!s.has(a.id))),...n];this.set(e,o)}addEvent(e,n){if(!n?.id)return!1;const r=this.getEvents(e);return!this.#t(r,n)&&(r.push(n),r.sort(((i,s)=>s.created_at-i.created_at)),this.setEvents(e,r,!0),!0)}#t(e,n){return e.some((r=>r.id===n.id||r.kind===n.kind&&r.pubkey===n.pubkey&&r.content===n.content&&r.created_at===n.created_at))}}class _ee extends ro{#e=new Map;#t=new Map;async getOrFetch(e,n){const r=this.get(e);if(r)return r;const i=this.#e.get(e);if(i)return i;const s=n().then((o=>(o&&this.set(e,o),this.#e.delete(e),o))).catch((o=>(this.#e.delete(e),null)));return this.#e.set(e,s),s}clearPendingFetches(){this.#e.clear()}setComponent(e,n){this.#t.set(e,n)}getComponent(e){return this.#t.get(e)}clearComponents(){this.#t.clear()}clear(){super.clear(),this.clearPendingFetches(),this.clearComponents()}}class kee extends ro{#e=new Map;#t=new Map;setCached(e,n,r){const i=`${e}:${n}`;this.set(i,{stats:r,timestamp:Date.now()}),this.updateViewStats(e,r)}getCached(e,n){const r=`${e}:${n}`;return this.get(r)}updateViewStats(e,n){n&&this.#e.set(e,{...n,lastUpdate:Date.now()})}getViewStats(e){return this.#e.get(e)}clearViewStats(e){this.#e.delete(e)}setNoZapsState(e,n){this.#t.set(e,n)}hasNoZaps(e){return this.#t.get(e)||!1}clearNoZapsState(e){this.#t.delete(e)}clear(){super.clear(),this.#e.clear(),this.#t.clear()}}class Cee extends ro{hasDecoded(e){return this.has(e)}setDecoded(e,n){this.set(e,n)}getDecoded(e){return this.get(e)}}class Tee extends ro{initializeLoadState(e){const n={isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,currentCount:0};return this.set(e,n),n}getLoadState(e){return this.has(e)?this.get(e):this.initializeLoadState(e)}updateLoadState(e,n){const r={...this.getLoadState(e),...n};return this.set(e,r),r}canLoadMore(e){const n=this.getLoadState(e);return n&&!n.isLoading&&n.lastEventTime}updateLoadProgress(e,n){const r=this.getLoadState(e);return r.currentCount+=n,this.updateLoadState(e,{currentCount:r.currentCount}),r.currentCount}}class Iee extends ro{setZapInfo(e,n){this.set(e,n)}getZapInfo(e){return this.get(e)}clearZapInfo(e){this.delete(e)}}class Oee extends p1{setImage(e,n){e&&n&&this.set(e,{image:n,timestamp:Date.now()})}getImage(e){return this.get(e)?.image}hasImage(e){return this.has(e)}clearExpired(e=36e5){const n=Date.now();for(const[r,i]of this.cache.entries())n-i.timestamp>e&&this.delete(r)}}class Mee extends p1{#e=new Map;setNip05(e,n){e&&this.set(e,{value:n,timestamp:Date.now(),verified:!0})}getNip05(e){return this.get(e)?.value}setPendingVerification(e,n){this.#e.set(e,n)}getPendingVerification(e){return this.#e.get(e)}deletePendingVerification(e){this.#e.delete(e)}clearPendingVerifications(){this.#e.clear()}clear(){super.clear(),this.clearPendingVerifications()}}class Uu{static#e=null;#t=null;#n={};constructor(){if(Uu.#e)return Uu.#e;this.profileCache=new p1,this.zapEventCache=new Aee,this.referenceCache=new _ee,this.statsCache=new kee,this.decodedCache=new Cee,this.loadStateCache=new Tee,this.zapInfoCache=new Iee,this.imageCache=new Oee,this.nip05Cache=new Mee,this.nip05PendingCache=new ro,this.#n=["zapInfo","uiComponent","decoded","nip05","nip05PendingFetches","zapLoadStates","imageCache","isEventIdentifier"].reduce(((e,n)=>(e[n]=new ro,e)),{}),this.viewStats=new Map,this.viewStates=new Map,Uu.#e=this}setProfile(e,n){return this.profileCache.setProfile(e,n)}getProfile(e){return this.profileCache.get(e)}subscribeToProfileUpdates(e){return this.profileCache.subscribe(e)}initializeZapView(e){return this.zapEventCache.initializeView(e)}getZapEvents(e){return this.zapEventCache.getEvents(e)}setZapEvents(e,n,r){return this.zapEventCache.setEvents(e,n,r)}addZapEvent(e,n){return this.zapEventCache.addEvent(e,n)}getZapViewState(e){return this.zapEventCache.getViewState(e)}updateZapViewState(e,n){return this.zapEventCache.updateViewState(e,n)}setReference(e,n){return this.referenceCache.set(e,n)}getReference(e){return this.referenceCache.get(e)}getOrFetchReference(e,n){return this.referenceCache.getOrFetch(e,n)}getReferenceComponent(e){return this.referenceCache.getComponent(e)}setReferenceComponent(e,n){return this.referenceCache.setComponent(e,n)}getCachedStats(e,n){return this.statsCache.getCached(e,n)}updateStatsCache(e,n,r){this.statsCache.setCached(e,n,r),this.statsCache.updateViewStats(e,r)}getViewStats(e){return this.statsCache.getViewStats(e)}setNoZapsState(e,n){return this.statsCache.setNoZapsState(e,n)}hasNoZaps(e){return this.statsCache.hasNoZaps(e)}async processCachedData(e,n){this.setRelayUrls(n.relayUrls);const r=this.getZapEvents(e),i=r.some((s=>this.getReference(s.id)));return{stats:(await Promise.all([this.getCachedStats(e,n.identifier)]))[0],hasEnoughCachedEvents:r.length>=ut.REQ_CONFIG.INITIAL_LOAD_COUNT,hasReferences:i}}hasDecoded(e){return this.decodedCache.hasDecoded(e)}setDecoded(e,n){return this.decodedCache.setDecoded(e,n)}getDecoded(e){return this.decodedCache.getDecoded(e)}initializeLoadState(e){return this.loadStateCache.initializeLoadState(e)}getLoadState(e){return this.loadStateCache.getLoadState(e)}updateLoadState(e,n){return this.loadStateCache.updateLoadState(e,n)}canLoadMore(e){return this.loadStateCache.canLoadMore(e)}updateLoadProgress(e,n){return this.loadStateCache.updateLoadProgress(e,n)}setZapInfo(e,n){return this.zapInfoCache.setZapInfo(e,n)}getZapInfo(e){return this.zapInfoCache.getZapInfo(e)}clearZapInfo(e){return this.zapInfoCache.clearZapInfo(e)}setImageCache(e,n){return this.imageCache.setImage(e,n)}getImageCache(e){return this.imageCache.getImage(e)}hasImageCache(e){return this.imageCache.hasImage(e)}setNip05(e,n){return this.nip05Cache.setNip05(e,n)}getNip05(e){return this.nip05Cache.getNip05(e)}setNip05PendingFetch(e,n){this.nip05Cache.setPendingVerification(e,n)}getNip05PendingFetch(e){return this.nip05Cache.getPendingVerification(e)}deleteNip05PendingFetch(e){this.nip05Cache.deletePendingVerification(e)}getOrCreateViewState(e,n={}){return this.viewStates.has(e)||this.viewStates.set(e,{currentStats:null,...n}),this.viewStates.get(e)}getViewState(e){return this.getOrCreateViewState(e)}updateViewState(e,n){const r=this.getOrCreateViewState(e);return this.viewStates.set(e,{...r,...n}),this.viewStates.get(e)}setCacheItem(e,n,r){const i=this.#n[e];return i&&n!==void 0?i.set(n,r):null}getCacheItem(e,n){const r=this.#n[e];return r&&n!==void 0?r.get(n):null}setRelayUrls(e){this.#t=e}getRelayUrls(){return this.#t}clearAll(){this.profileCache.clear(),this.profileCache.clearSubscriptions(),this.zapEventCache.clear(),this.referenceCache.clear(),this.referenceCache.clearPendingFetches(),this.referenceCache.clearComponents(),this.statsCache.clear(),this.decodedCache.clear(),this.loadStateCache.clear(),this.zapInfoCache.clear(),this.imageCache.clear(),this.nip05Cache.clear(),this.nip05Cache.clearPendingVerifications(),Object.values(this.#n).forEach((e=>e.clear())),this.viewStats.clear(),this.viewStates.clear()}}const et=new Uu,oA="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDYuMzMgMjA2LjMzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICA8ZGVmcz4KICAgICAgPHN0eWxlPgogICAgICAgICAuY2xzLTEgewogICAgICAgICAgICBmaWxsOiBub25lOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTIgewogICAgICAgICAgICBmaWxsOiAjZmZmOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTMgewogICAgICAgICAgICBmaWxsOiAjNjY2OwogICAgICAgICB9CiAgICAgIDwvc3R5bGU+CiAgIDwvZGVmcz4KICAgPHBhdGggY2xhc3M9ImNscy0yIgogICAgICBkPSJtMjA2LjMzIDEzNC4zOWMwIDIwLjcxIDAgMzEuMDctMy41MyA0Mi4yMi00LjQzIDEyLjE3LTE0LjAyIDIxLjc2LTI2LjE5IDI2LjE5LTExLjE1IDMuNTMtMjEuNSAzLjUzLTQyLjIyIDMuNTNoLTYyLjQ2Yy0yMC43MSAwLTMxLjA2IDAtNDIuMjEtMy41My0xMi4xNy00LjQzLTIxLjc2LTE0LjAyLTI2LjE5LTI2LjE5LTMuNTMtMTEuMTUtMy41My0yMS41LTMuNTMtNDIuMjJ2LTYyLjQ2YzAtMjAuNzEgMC0zMS4wNyAzLjUzLTQyLjIyIDQuNDMtMTIuMTcgMTQuMDItMjEuNzYgMjYuMTktMjYuMTkgMTEuMTUtMy41MiAyMS41LTMuNTIgNDIuMjEtMy41Mmg2Mi40NmMyMC43MSAwIDMxLjA3IDAgNDIuMjIgMy41MiAxMi4xNyA0LjQzIDIxLjc2IDE0LjAyIDI2LjE5IDI2LjE5IDMuNTMgMTEuMTUgMy41MyAyMS41IDMuNTMgNDIuMjJ6IiAvPgogICA8cGF0aCBjbGFzcz0iY2xzLTMiCiAgICAgIGQ9Im0xODUuOTggOTEuMXY4My4yM2MwIDMuMTMtMi41NCA1LjY3LTUuNjcgNS42N2gtNjguMDRjLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNS41YzAuMzEtMTkgMi4zMi0zNy4yIDYuNTQtNDUuNDggMi41My00Ljk4IDYuNy03LjY5IDExLjQ5LTkuMTQgOS4wNS0yLjcyIDI0LjkzLTAuODYgMzEuNjctMS4xOCAwIDAgMjAuMzYgMC44MSAyMC4zNi0xMC43MiAwLTkuMjgtOS4xLTguNTUtOS4xLTguNTUtMTAuMDMgMC4yNi0xNy42Ny0wLjQyLTIyLjYyLTIuMzctOC4yOS0zLjI2LTguNTctOS4yNC04LjYtMTEuMjQtMC40MS0yMy4xLTM0LjQ3LTI1Ljg3LTY0LjQ4LTIwLjE0LTMyLjgxIDYuMjQgMC4zNiA1My4yNyAwLjM2IDExNi4wNXY4LjM4Yy0wLjA2IDMuMDgtMi41NSA1LjU3LTUuNjUgNS41N2gtMzMuNjljLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNDMuOTVjMC0zLjEzIDIuNTQtNS42NyA1LjY3LTUuNjdoMzEuNjdjMy4xMyAwIDUuNjcgMi41NCA1LjY3IDUuNjcgMCA0LjY1IDUuMjMgNy4yNCA5LjAxIDQuNTMgMTEuMzktOC4xNiAyNi4wMS0xMi41MSA0Mi4zNy0xMi41MSAzNi42NSAwIDY0LjM2IDIxLjM2IDY0LjM2IDY4LjY5em0tNjAuODQtMTYuODljMC02LjctNS40My0xMi4xMy0xMi4xMy0xMi4xM3MtMTIuMTMgNS40My0xMi4xMyAxMi4xMyA1LjQzIDEyLjEzIDEyLjEzIDEyLjEzIDEyLjEzLTUuNDMgMTIuMTMtMTIuMTN6IiAvPgo8L3N2Zz4=",Lee=t=>typeof t=="string"&&t.length>0,$ee=t=>{try{return window.NostrTools.nip19.decode(t)}catch{return null}},Nee=(t,e,n)=>{const r={npub:()=>({kinds:[9735],"#p":[e]}),note:()=>({kinds:[9735],"#e":[e]}),nprofile:()=>({kinds:[9735],"#p":[e.pubkey]}),nevent:()=>({kinds:[9735],"#e":[e.id]}),naddr:()=>({kinds:[9735],"#a":[`${e.kind}:${e.pubkey}:${e.identifier}`]})}[t];if(!r)return null;const i=r();return i.limit=n?ut.REQ_CONFIG.ADDITIONAL_LOAD_COUNT:ut.REQ_CONFIG.INITIAL_LOAD_COUNT,n&&(i.until=n),{req:i}};function aA(t,e=null){const n=`${t}:${e}`;if(et.hasDecoded(n))return et.getDecoded(n);if(!Lee(t))throw new Error(ut.ZAP_CONFIG.ERRORS.DECODE_FAILED);const r=$ee(t);if(!r)return null;const i=Nee(r.type,r.data,e);return i&&et.setDecoded(n,i),i}function Q5(t){return t?.display_name||t?.name||"nameless"}async function Pee(t,e){if(!t||!e)return null;try{return(await window.NostrTools.nip05.queryProfile(t))?.pubkey===e?t:null}catch{return null}}function Md(t){return new Intl.NumberFormat().format(t)}function e8(t){if(!t||typeof t!="string")return"unknown";try{return`${window.NostrTools.nip19.decode(t).type.toLowerCase()}1${t.slice(5,11)}...${t.slice(-4)}`}catch{return"unknown"}}function sc(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function Ree(t){try{return window.NostrTools.nip19.npubEncode(t)}catch{return null}}function Oc(t){if(!t||typeof t!="string")return!1;const e=`isEventIdentifier:${t}`,n=et.getCacheItem("isEventIdentifier",e);if(n!==void 0)return n;const r=t.startsWith("note1")||t.startsWith("nevent1")||t.startsWith("naddr1");return et.setCacheItem("isEventIdentifier",e,r),r}async function Dee(t){const{pubkey:e,content:n}=(function(i){const s=i.tags.find((o=>o[0]==="description"))?.[1];if(!s)return{pubkey:null,content:""};try{const o=Bee(s);let a;try{a=JSON.parse(o)}catch{const c=o.match(/"pubkey"\s*:\s*"([^"]+)"|"content"\s*:\s*"([^"]+)"/g);if(!c)throw new Error("Invalid JSON structure");a={},c.forEach((u=>{const[f,d]=u.split(":").map((h=>h.trim().replace(/"/g,"")));a[f]=d}))}let l=null;return a.pubkey&&(l=typeof a.pubkey=="string"?a.pubkey:String(a.pubkey)),{pubkey:l,content:typeof a.content=="string"?a.content.trim():""}}catch{return{pubkey:null,content:""}}})(t),r=await(async function(i){const s=i.tags.find((o=>o[0].toLowerCase()==="bolt11"))?.[1];if(!s)return"Amount: Unknown";try{const o=window.decodeBolt11(s),a=o.sections.find((l=>l.name==="amount"))?.value;return a?`${Md(Math.floor(a/1e3))} sats`:"Amount: Unknown"}catch{return"Amount: Unknown"}})(t);return{pubkey:e,content:n,satsText:r}}function lA(t){try{return window.NostrTools.nip19.decode(t)}catch{return null}}function Bee(t){return t.replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/\\\\/g,"\\").replace(/\\(?!(["\\\/bfnrt]|u[0-9a-fA-F]{4}))/g,"").replace(/\\+(["\\/bfnrt])/g,"\\$1").replace(/\\u(?![0-9a-fA-F]{4})/g,"")}class Uee{constructor(e){this.root=e}displayStats(e){requestAnimationFrame((()=>{const n=this.root?.querySelector(".zap-stats");if(n)try{let r;r=e?e.skeleton?this.#e():e.error?this.createTimeoutStats():this.createNormalStats(e):this.createTimeoutStats(),n.innerHTML=r}catch{n.innerHTML=this.createTimeoutStats()}}))}#e(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
    `}createTimeoutStats(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number text-muted">nostr.band</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number text-muted">Stats</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number text-muted">Unavailable</span></div>
      <div class="stats-item">sats</div>
    `}createNormalStats(e){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number">${Md(e.count)}</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number">${Md(Math.floor(e.msats/1e3))}</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number">${Md(Math.floor(e.maxMsats/1e3))}</span></div>
      <div class="stats-item">sats</div>
    `}}class g1{constructor(e={}){this._validateOptions(e),this._initializeProperties(e)}_validateOptions(e){if(!e.pool?.ensureRelay)throw new Error("Invalid pool object: ensureRelay method is required")}_initializeProperties(e){this.pool=e.pool,this.batchSize=e.batchSize||ut.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_SIZE,this.batchDelay=e.batchDelay||ut.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_DELAY,this.relayUrls=e.relayUrls||ut.BATCH_PROCESSOR_CONFIG.DEFAULT_RELAY_URLS,this.batchQueue=new Set,this.pendingFetches=new Map,this.resolvers=new Map,this.processingItems=new Set,this.batchTimer=null,this.eventCache=new Map,this.maxCacheAge=e.maxCacheAge||ut.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}getOrCreateFetchPromise(e){if(this.pendingFetches.has(e))return this.pendingFetches.get(e);const n=new Promise((r=>{this.resolvers.set(e,r)}));return this.pendingFetches.set(e,n),this.batchQueue.add(e),this._scheduleBatchProcess(),n}_scheduleBatchProcess(){this.batchTimer||(this.batchTimer=setTimeout((()=>{this.batchTimer=null,this._processBatchQueue()}),this.batchDelay))}async _processBatchQueue(){if(this.batchQueue.size===0)return;const e=this._getBatchItems();await this._processBatch(e),this.batchQueue.size>0&&this._scheduleBatchProcess()}_getBatchItems(){const e=Array.from(this.batchQueue).slice(0,this.batchSize);return e.forEach((n=>{this.batchQueue.delete(n),this.processingItems.add(n)})),e}async _processBatch(e){try{await this.onBatchProcess(e)}catch(n){this._handleBatchError(e,n)}finally{this._cleanupBatchItems(e)}}_handleBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanupBatchItems(e){e.forEach((n=>{this.processingItems.delete(n),this.pendingFetches.delete(n),this.resolvers.delete(n)}))}resolveItem(e,n){const r=this.resolvers.get(e);r&&(r(n),this.resolvers.delete(e))}async onBatchProcess(e){throw new Error("onBatchProcess must be implemented by derived class")}onBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanup(e,n,r,i){clearTimeout(e),n&&n.close(),r.forEach((s=>{!i.has(s)&&this.resolvers.has(s)&&this.resolveItem(s,null)}))}_getSubscriptionPool(){return this.pool}async _createSubscriptionPromise(e,n,r,i){if(n?.length)return new Promise((s=>{const o=new Set,a=ut.BATCH_PROCESSOR_CONFIG.TIMEOUT_DURATION;let l,c,u=!1;const f=()=>{u||(u=!0,l&&clearTimeout(l),c&&c.close(),e.forEach((d=>{o.has(d)||this.resolveItem(d,null)})),s())};c=this.pool.subscribeMany(n,r,{onevent:d=>{try{u||(i(d,o),o.size===e.length&&f())}catch{}},oneose:()=>{setTimeout(f,100)},onerror:d=>{}}),l=setTimeout((()=>{u||f()}),a)}));e.forEach((s=>this.resolveItem(s,null)))}setRelayUrls(e){this.relayUrls=Array.isArray(e)?e:[]}getCachedItem(e){const n=this.eventCache.get(e);return this._isValidCache(n)?n.event:(this.eventCache.delete(e),null)}_isValidCache(e){return!!e&&Date.now()-e.timestamp<=this.maxCacheAge}setCachedItem(e,n){this.eventCache.set(e,{event:n,timestamp:Date.now()})}}class Hee extends g1{constructor(e={}){super(e)}async onBatchProcess(e){if(!e?.length)return;const n=[{ids:e.slice(0,this.batchSize)}];await this._createSubscriptionPromise(e,this.relayUrls,n,((r,i)=>{if(e.includes(r.id)){const s=this.getCachedItem(r.id);(!s||r.created_at>s.created_at)&&(this.setCachedItem(r.id,r),this.resolveItem(r.id,r),i.add(r.id))}}))}}class Fee extends g1{constructor(e={}){super(e)}_parseAtagValue(e){const n=e.split(":");return n.length!==3?null:{kind:parseInt(n[0]),pubkey:n[1],identifier:n[2]}}async onBatchProcess(e){if(!e?.length)return;const n=[],r={kinds:[],authors:[],"#d":[]};if(e.slice(0,this.batchSize).forEach((s=>{const o=this._parseAtagValue(s);o?(r.kinds.push(o.kind),r.authors.push(o.pubkey),r["#d"].push(o.identifier),n.push(s)):this.resolveItem(s,null)})),n.length===0)return;const i=[r];await this._createSubscriptionPromise(n,this.relayUrls,i,((s,o)=>{const a=n.find((l=>{const c=this._parseAtagValue(l);return c&&s.kind===c.kind&&s.pubkey===c.pubkey&&s.tags.some((u=>u[0]==="d"&&u[1]===c.identifier))}));if(a){const l=this.getCachedItem(a);(!l||s.created_at>l.created_at)&&(this.setCachedItem(a,s),this.resolveItem(a,s),o.add(a))}}))}}class zee extends g1{constructor(e={}){const{simplePool:n,config:r}=e;super({pool:n,batchSize:r.BATCH_SIZE||ut.PROFILE_CONFIG.BATCH_SIZE,batchDelay:r.BATCH_DELAY||ut.PROFILE_CONFIG.BATCH_DELAY,relayUrls:r.RELAYS||ut.PROFILE_CONFIG.RELAYS,maxCacheAge:ut.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}),this.config=r}async onBatchProcess(e){if(!this.config.RELAYS?.length)throw new Error("No relays configured for profile fetch");const n=e.filter((o=>{const a=this.getCachedItem(o);return!a||(this.resolveItem(o,a),!1)}));if(n.length===0)return;const r=[{kinds:[0],authors:n}],i=new Map,s=(o,a)=>{const l=i.get(o.pubkey);(!l||o.created_at>l.created_at)&&(i.set(o.pubkey,o),this.setCachedItem(o.pubkey,o)),a.add(o.pubkey)};try{await this._createSubscriptionPromise(n,this.config.RELAYS,r,s),n.forEach((o=>{const a=i.get(o);this.resolveItem(o,a||null)}))}catch(o){this.onBatchError(e,o)}}}var Pa=Symbol("verified");function jee(t){if(!(t instanceof Object)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var Vee=new TextEncoder;function wu(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}var qee=class{value;next=null;prev=null;constructor(t){this.value=t}},Wee=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new qee(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function Z0(t){return An(Al(Vee.encode((function(e){if(!jee(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])})(t))))}var md=new class{generateSecretKey(){return rs.utils.randomPrivateKey()}getPublicKey(t){return An(rs.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=An(rs.getPublicKey(e)),n.id=Z0(n),n.sig=An(rs.sign(Z0(n),e)),n[Pa]=!0,n}verifyEvent(t){if(typeof t[Pa]=="boolean")return t[Pa];const e=Z0(t);if(e!==t.id)return t[Pa]=!1,!1;try{const n=rs.verify(t.sig,e,t.pubkey);return t[Pa]=n,n}catch{return t[Pa]=!1,!1}}},Kee=(md.generateSecretKey,md.getPublicKey,md.finalizeEvent,md.verifyEvent);function Gee(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}async function Zee(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}var t8,Yee=t=>(t[Pa]=!0,!0),n8=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Wee;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=wu(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new n8(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Zee();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=(function(n){let r=n.slice(0,22).indexOf('"EVENT"');if(r===-1)return null;let i=n.slice(r+7+1).indexOf('"');if(i===-1)return null;let s=r+7+1+i,o=n.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return n.slice(s+1,a)})(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=(function(s,o){let a=o.length+3,l=s.indexOf(`"${o}":`)+a,c=s.slice(l).indexOf('"')+l+1;return s.slice(c,c+64)})(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&(function(s,o){for(let a=0;a<s.length;a++)if(Gee(s[a],o))return!0;return!1})(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t((function(r,i){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",i]],content:""}})(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new Jee(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},Jee=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}},Xee=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=wu(t);let n=this.relays.get(t);return n||(n=new n8(t,{verifyEvent:this.trustedRelayURLs.has(t)?Yee:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(wu).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(f,d)=>{let h=this.seenOn.get(d);h||(h=new Set,this.seenOn.set(d,h)),h.add(f)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=f=>{s[f]=!0,s.filter((d=>d)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(f,d)=>{o(f),a[f]=d,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=f=>{if(e.alreadyHaveEvent?.(f))return!0;const d=n.has(f);return n.add(f),d},u=Promise.all(Object.entries(t).map((async(f,d,h)=>{if(h.indexOf(f)!==d)return void l(d,"duplicate url");let p,[g,m]=f;g=wu(g);try{p=await this.ensureRelay(g,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(x){return void l(d,x?.message||String(x))}let v=p.subscribe(m,{...e,oneose:()=>o(d),onclose:x=>l(d,x),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(v)})));return{async close(){await u,r.forEach((f=>{f.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(wu).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{t8=WebSocket}catch{}var r8=class extends Xee{constructor(){super({verifyEvent:Kee,websocketImplementation:t8})}};class Hu{static instance=null;#e;#t;#n=!0;#s;constructor(){return Hu.instance?Hu.instance:(this.#r(),Hu.instance=this,this)}#r(){if(this.#e=ut.PROFILE_CONFIG,this.#t=new r8,!this.#t?.ensureRelay)throw new Error("Failed to initialize SimplePool");this.#s=new zee({simplePool:this.#t,config:{...this.#e,RELAYS:this.#e.RELAYS||[]}})}get isInitialized(){return this.#n}async fetchProfiles(e){if(!Array.isArray(e)||e.length===0)return[];const n=Date.now(),r=new Array(e.length),i=e.reduce(((s,o,a)=>{const l=et.getProfile(o);return this.#o(l,n)?r[a]=l:s.push({index:a,pubkey:o}),s}),[]);return i.length>0&&await this.#a(i,r,e),r}async processBatchProfiles(e){const n=this.#i(e);if(n.length!==0)try{await Promise.all([this.fetchProfiles(n),...n.map((r=>this.verifyNip05Async(r)))])}catch{}}async verifyNip05Async(e){const n=et.getNip05(e);if(n!==void 0)return n;const r=et.getNip05PendingFetch(e);if(r)return r;const i=this.#u(e);return et.setNip05PendingFetch(e,i),i}getNip05(e){return et.getNip05(e)}clearCache(){et.clearAll(),this.#s.clearPendingFetches()}#o(e,n){return e&&e._lastUpdated&&n-e._lastUpdated<18e5}#i(e){return[...new Set(e?.map((n=>n?.pubkey))?.filter((n=>n&&typeof n=="string"&&n.length===64)))]}async#a(e,n,r){if(!e.length)return;const i=Date.now(),s=e.filter((({pubkey:a})=>a&&typeof a=="string"&&a.length===64));if(s.length===0)return;const o=await Promise.all(s.map((({pubkey:a})=>this.#l(a,i))));s.forEach((({index:a},l)=>{a>=0&&a<n.length&&(n[a]=o[l],r[a]&&et.setProfile(r[a],o[l]))}))}async#l(e,n){if(!e||typeof e!="string"||e.length!==64)return this.#c();try{const r={kinds:[0],authors:[e],limit:1},i=await this.#s.getOrCreateFetchPromise(e,r);if(!i?.content)return this.#c();let s;try{s=JSON.parse(i.content)}catch{return this.#c()}return{...s,name:Q5(s)||"nameless",_lastUpdated:n,_eventCreatedAt:i.created_at}}catch{return this.#c()}}async#u(e){try{const[n]=await this.fetchProfiles([e]);if(!n?.nip05)return et.setNip05(e,null),null;const r=await Promise.race([Pee(n.nip05,e),new Promise(((s,o)=>setTimeout((()=>o(new Error("NIP-05 timeout"))),5e3)))]);if(!r)return et.setNip05(e,null),null;const i=sc(r.startsWith("_@")?r.slice(1):r);return et.setNip05(e,i),i}catch{return et.setNip05(e,null),null}finally{et.deleteNip05PendingFetch(e)}}#c(){return{name:"anonymous",display_name:"anonymous"}}}const pf=new Hu;class Qee{async loadAndUpdate(e,n){if(e)try{const r=n.querySelector(".sender-name"),i=n.querySelector(".zap-placeholder-name"),s=n.querySelector(".sender-icon"),o=s?.querySelector(".zap-placeholder-icon"),a=n.querySelector(".sender-pubkey");let l=et.getProfile(e);const c=l?Q5(l)||"nameless":"anonymous",u=l?.picture?(function(f){if(!f||typeof f!="string")return null;try{const d=new URL(f);return["http:","https:"].includes(d.protocol)?d.href:null}catch{return null}})(l.picture):null;this.#e(i,r,c),this.#n(o,s,u,c),this.#s(a,e)}catch{this.#r(n)}}#e(e,n,r){e?e.replaceWith(Object.assign(document.createElement("span"),{className:"sender-name",textContent:r})):n&&(n.textContent=r)}#t(e,n="anonymous user's icon"){const r=`https://robohash.org/${e}.png?set=set5&bgset=bg2&size=128x128`,i=et.getImageCache(r),s=Object.assign(document.createElement("img"),{alt:n,loading:"lazy",className:"profile-icon"});if(i)return s.src=r,s;const o=new Image;return o.onerror=()=>{s.src=oA,et.setImageCache(r,oA)},o.onload=()=>{et.setImageCache(r,o)},o.src=r,s.src=r,s}#n(e,n,r,i){if(e&&n){const s=o=>{e.remove();const a=n.querySelector("img"),l=n.querySelector("a");a&&a.remove(),l&&l.remove();const c=o==="robohash"?this.#t(n.closest("[data-pubkey]")?.dataset.pubkey,`${sc(i)}'s icon`):Object.assign(document.createElement("img"),{src:o,alt:`${sc(i)}'s icon`,loading:"lazy",className:"profile-icon"}),u=n.closest("[data-pubkey]")?.dataset.pubkey;if(u){const f=(function(h,p=[]){try{return window.NostrTools.nip19.nprofileEncode({pubkey:h,relays:p})}catch{return null}})(u),d=Object.assign(document.createElement("a"),{href:`https://njump.me/${f}`,target:"_blank",rel:"noopener noreferrer"});d.appendChild(c),n.appendChild(d)}else n.appendChild(c)};if(r){const o=new Image;o.onload=()=>{et.setImageCache(r,o),s(r)},o.onerror=()=>{s("robohash")},o.src=r}else s("robohash")}}#s(e,n){if(e&&!e.getAttribute("data-nip05-updated")){const r=pf.getNip05(n);r?(e.textContent=r,e.setAttribute("data-nip05-updated","true")):pf.verifyNip05Async(n).then((i=>{i&&(e.textContent=i,e.setAttribute("data-nip05-updated","true"))}))}}#r(e){const n=e.querySelector(".zap-placeholder-icon");if(n){const r=n.parentElement,i=e.closest("[data-pubkey]")?.dataset.pubkey;n.remove(),r.appendChild(this.#t(i))}}async updateProfileElement(e,n){if(!e||!n)return;const r=e.querySelector(".sender-icon img, .zap-placeholder-icon");if(r)if(n.picture){const s=document.createElement("img");s.alt=n.name||"Profile Picture",s.width=32,s.height=32,s.className="profile-icon",s.onerror=()=>{const o=e.getAttribute("data-pubkey");if(o){const a=this.#t(o,n.name||"anonymous user");s.parentElement&&s.parentElement.replaceChild(a,s)}},s.src=n.picture,r.parentElement&&r.parentElement.replaceChild(s,r)}else{const s=e.getAttribute("data-pubkey");if(s){const o=this.#t(s,n.name||"anonymous user");r.parentElement&&r.parentElement.replaceChild(o,r)}}const i=e.querySelector(".sender-name, .zap-placeholder-name");if(i&&(i.textContent=n.display_name||n.name||"anonymous",i.className="sender-name"),n.nip05){const s=e.getAttribute("data-pubkey");if(s){const o=e.querySelector('[data-nip05-target="true"]');o&&await this.updateNip05Display(s,o)}}}}class Br{static#e={1:"content",30023:"title",30030:"title",30009:"name",40:"content",42:"name",31990:"alt"};static#t={UI_COMPONENTS:"Failed to create UI components:",ZAP_ITEM:"Failed to create zap item HTML:",REFERENCE:"Reference component creation failed:"};static createUIComponents(e,n,r){try{const i=this.viewConfigs?.get(n),s=r||i?.identifier,o=Oc(s)?null:this.#a(e);return{iconComponent:this.#n(),nameComponent:this.#u(e),pubkeyComponent:this.#c(e,s),referenceComponent:this.#f(o)}}catch{return this.#s()}}static#n(){return'<div class="zap-placeholder-icon skeleton"></div>'}static#s(){return{iconComponent:'<div class="zap-placeholder-icon skeleton"></div>',nameComponent:'<div class="zap-placeholder-name skeleton"></div>',pubkeyComponent:"",referenceComponent:""}}static createReferenceComponent(e){return this.#f(this.#a({reference:e}))}static addReferenceToElement(e,n){if(!this.#r(e,n))return;const r=e.querySelector(".zap-content");this.#o(r,n)}static#r(e,n){return e&&n&&e.querySelector(".zap-content")}static#o(e,n){e.querySelectorAll(".zap-reference").forEach((i=>i.remove()));const r=this.createReferenceComponent({reference:n});e.insertAdjacentHTML("beforeend",r)}static getDialogTemplate(){return`
      <dialog class="dialog">
        <h2 class="dialog-title"><a href="#" target="_blank"></a></h2>
        <button class="close-dialog-button">X</button>
        <div class="zap-stats"></div>
        <ul class="dialog-zap-list"></ul>
      </dialog>
    `}static createZapItemHTML(e,n,r,i){try{const s=this.createUIComponents(e,r,i);return this.#i(e,n,s)}catch{return""}}static createNoZapsMessageHTML(e){return`
      <div class="no-zaps-container">
        <div class="no-zaps-message">${e}</div>
      </div>
    `}static#i(e,n,r){const[i,s]=e.satsText.split(" "),o=(a=e.created_at,Math.floor(Date.now()/1e3)-a<86400);var a;return`
      <div class="zap-content">
        <div class="zap-sender${e.comment?" with-comment":""}" data-pubkey="${e.pubkey}">
          <div class="sender-icon${o?" is-new":""}">
            ${r.iconComponent}
          </div>
          <div class="sender-info">
            ${r.nameComponent}
            ${r.pubkeyComponent}
          </div>
          <div class="zap-amount ${n}"><span class="number">${i}</span> ${s}</div>
        </div>
        ${e.comment?`<div class="zap-details"><span class="zap-comment">${sc(e.comment)}</span></div>`:""}
        ${r.referenceComponent}
      </div>
    `}static#a(e){if(!e)return null;if(this.#l(e))return e;if(e.reference&&typeof e.reference=="object"){if(e.reference.reference&&this.#l(e.reference.reference))return e.reference.reference;if(this.#l(e.reference))return e.reference}return null}static#l(e){return e&&typeof e=="object"&&"id"in e&&"tags"in e&&Array.isArray(e.tags)&&"content"in e&&"kind"in e}static#u({senderName:e}){return e?`<span class="sender-name">${sc(e)}</span>`:'<div class="zap-placeholder-name skeleton"></div>'}static#c({pubkey:e,displayIdentifier:n,reference:r},i){const s=!Oc(i),o=`class="sender-pubkey" data-pubkey="${e}"`;return r&&s?`<span ${o}>${n}</span>`:`<span ${o} data-nip05-target="true">${n}</span>`}static#f(e){if(!this.#l(e))return"";const n=e.id,r=et.getReferenceComponent(n);if(r)return r;try{const i=this.#m(e),s=this.#h(e),o=this.#p(i,s);return et.setReferenceComponent(n,o),o}catch{return""}}static#m(e){if(!e?.tags)return"";if(e.kind===31990)return this.#d(e)||"";const n=Array.isArray(e.tags)?e.tags.find((r=>Array.isArray(r)&&r[0]==="d")):null;return n?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.naddrEncode({kind:r,pubkey:i,identifier:s,relays:o})}catch{return null}})(e.kind,e.pubkey,n[1])}`:e.id?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.neventEncode({id:r,kind:i,pubkey:s,relays:o})}catch{return null}})(e.id,e.kind,e.pubkey)}`:""}static#d(e){const n=e.tags.filter((i=>i[0]==="r"));return(n.find((i=>!i.includes("source")))||n[0])?.[1]}static#h(e){if(!e)return"";const n=Br.#e[e.kind];if(n){const r=e.tags.find((i=>Array.isArray(i)&&i[0]===n));if(r&&r[1])return r[1]}if(e.kind===40)try{return JSON.parse(e.content).name||e.content}catch{}return e.content||""}static#p(e,n){return`
      <div class="zap-reference">
        <div class="reference-arrow">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aCBkPSJtNTYwLTEyMC01Ny01NyAxNDQtMTQzSDIwMHYtNDgwaDgwdjQwMGgzNjdMNTAzLTU0NGw1Ni01NyAyNDEgMjQxLTI0MCAyNDBaIiAvPg0KPC9zdmc+" alt="Reference" width="18" height="18" />
        </div>
        <div class="reference-text">${sc(n)}</div>
        <a href="${e}" target="_blank" class="reference-link">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aA0KICAgICAgICBkPSJNNDQwLTI4MEgyODBxLTgzIDAtMTQxLjUtNTguNVQ4MC00ODBxMC04MyA1OC41LTE0MS41VDI4MC02ODBoMTYwdjgwSDI4MHEtNTAgMC04NSAzNXQtMzUgODVxMCA1MCAzNSA4NXQ4NSAzNWgxNjB2ODBaTTMyMC00NDB2LTgwaDMyMHY4MEgzMjBabTIwMCAxNjB2LTgwaDE2MHE1MCAwIDg1LTM1dDM1LTg1cTAtNTAtMzUtODV0LTg1LTM1SDUyMHYtODBoMTYwcTgzIDAgMTQxLjUgNTguNVQ4ODAtNDgwcTAgODMtNTguNSAxNDEuNVQ2ODAtMjgwSDUyMFoiIC8+DQo8L3N2Zz4=" alt="Quick Reference" width="16" height="16" />
        </a>
      </div>
    `}static ZapInfo=class{#g;constructor(e){this.#g=e}static async createFromEvent(e,n={}){return await new Br.ZapInfo(e).extractInfo(n)}static getAmountColorClass(e,n){return(n===void 0?ut.ZAP_AMOUNT_CONFIG.DEFAULT_COLOR_MODE:n)?this.#y(e):ut.ZAP_AMOUNT_CONFIG.DISABLED_CLASS}static#y(e){const{THRESHOLDS:n,DEFAULT_CLASS:r}=ut.ZAP_AMOUNT_CONFIG;return n.find((i=>e>=i.value))?.className||r}async extractInfo(e={}){const n=this.#g.id,r=et.getZapInfo(n);if(r)return r.colorClass=Br.ZapInfo.getAmountColorClass(r.satsAmount,e.isColorModeEnabled),r;try{const{pubkey:s,content:o,satsText:a}=await Dee(this.#g),l=parseInt(a.replace(/,/g,"").split(" ")[0],10),c=typeof s=="string"?s:null,u=this.#g.reference||null,f={satsText:a,satsAmount:l,comment:o||"",pubkey:c||"",created_at:this.#g.created_at,displayIdentifier:c?e8(Ree(c)):"anonymous",senderName:null,senderIcon:null,reference:u,colorClass:Br.ZapInfo.getAmountColorClass(l,e?.isColorModeEnabled)};return et.setZapInfo(n,f),f}catch{const o={satsText:"Amount: Unknown",satsAmount:0,comment:"",pubkey:"",created_at:this.#g.created_at,displayIdentifier:"anonymous",senderName:"anonymous",senderIcon:i,reference:null};return et.setZapInfo(n,o),o}var i}static async batchExtractInfo(e,n=!0){const r=new Map;return await Promise.all(e.map((async i=>{const s=new Br.ZapInfo(i),o=await s.extractInfo({isColorModeEnabled:n});r.set(i.id,o)}))),r}};static viewConfigs=new Map}class ete{constructor(e,n){this.viewId=e,this.config=n}async createListItem(e){const n=await Br.ZapInfo.createFromEvent(e,{isColorModeEnabled:this.config?.isColorModeEnabled}),r=document.createElement("li");return r.className=`zap-list-item ${n.colorClass}${n.comment?" with-comment":""}`,r.setAttribute("data-pubkey",n.pubkey),e?.id&&r.setAttribute("data-event-id",e.id),r.innerHTML=Br.createZapItemHTML(n,n.colorClass,this.viewId),r.setAttribute("data-timestamp",e.created_at.toString()),{li:r,zapInfo:n}}}class tte{constructor(e,n,r,i){if(!e)throw new Error("shadowRoot is required");if(!i)throw new Error("config is required");this.shadowRoot=e,this.profileUI=n,this.viewId=r,this.config=i,this.itemBuilder=new ete(r,this.config),this.profileUpdateUnsubscribe=null,this.#m()}destroy(){this.profileUpdateUnsubscribe&&(this.profileUpdateUnsubscribe(),this.profileUpdateUnsubscribe=null);const e=this.#e(".dialog-zap-list");e&&(e.innerHTML="")}#e(e){return this.shadowRoot.querySelector(e)}getElementByEventId(e){return this.#e(`.zap-list-item[data-event-id="${e}"]`)}async#t(e){const n=this.#e(".dialog-zap-list");if(n)try{return this.#s(n),await e(n)}catch{n.children.length===0&&this.showNoZapsMessage()}}#n(e,n){const r=e.querySelector(".load-more-trigger");r&&r.remove(),Array.from(n.children).forEach((i=>{const s=i.getAttribute("data-event-id"),o=parseInt(i.getAttribute("data-timestamp"));let a=null;const l=Array.from(e.children);for(let c=0;c<l.length;c++)if(o>parseInt(l[c].getAttribute("data-timestamp"))){a=l[c];break}e.querySelector(`.zap-list-item[data-event-id="${s}"]`)||(a?e.insertBefore(i,a):e.appendChild(i))})),r&&e.appendChild(r)}#s(e){const n=e.querySelector(".no-zaps-message");n&&n.remove()}async#r(e,n){return this.#t((async r=>{const{li:i,zapInfo:s}=await this.itemBuilder.createListItem(e);return n(r,i),await this.#p(s.pubkey,i),{li:i,zapInfo:s}}))}async renderZapListFromCache(e){if(!e?.length)return et.setNoZapsState(this.viewId,!1),this.showNoZapsMessage();await this.#t((async n=>{const{initialBatch:r,remainingBatch:i}=this.#o(e),{fragment:s,profileUpdates:o}=await this.#i(r);this.#n(n,s),i.length>0?this.#a(i,n,o):await this.#h(o)}))}#o(e){const n=this.#y(e),r=ut.DIALOG_CONFIG.ZAP_LIST.INITIAL_BATCH;return{initialBatch:n.slice(0,r),remainingBatch:n.slice(r)}}async#i(e){const n=document.createDocumentFragment(),r=[];for(const i of e){const{li:s,zapInfo:o}=await this.itemBuilder.createListItem(i);this.#b(i.id,s),n.appendChild(s),o.pubkey&&r.push({pubkey:o.pubkey,element:s})}return{fragment:n,profileUpdates:r}}#a(e,n,r){if(!e.length)return;const i=ut.DIALOG_CONFIG.ZAP_LIST.REMAINING_BATCH;let s=0;const o=async()=>{if(s>=e.length)return void await this.#h(r);const a=e.slice(s,s+i);await this.#l(a,n,r),s+=i,setTimeout((()=>o()),0)};requestIdleCallback((()=>o()))}async#l(e,n,r){const i=document.createDocumentFragment();await Promise.all(e.map((async o=>{const{li:a,zapInfo:l}=await this.itemBuilder.createListItem(o);this.#b(o.id,a),i.appendChild(a),l.pubkey&&r.push({pubkey:l.pubkey,element:a})})));const s=n.querySelector(".load-more-trigger");s&&s.remove(),n.appendChild(i),s&&n.appendChild(s),await new Promise((o=>requestAnimationFrame(o)))}async prependZap(e){return this.#r(e,((n,r)=>n.prepend(r)))}async appendZap(e){return this.#r(e,((n,r)=>{const i=this.#f(n,e.created_at);i?n.insertBefore(r,i):n.appendChild(r)}))}async replacePlaceholderWithZap(e,n){const r=this.#e(`[data-index="${n}"]`);if(this.#v(r))try{const{zapInfo:i}=await this.itemBuilder.createListItem(e);this.#w(r,i,e.id),await this.#p(i.pubkey,r)}catch{r.remove()}}async showNoZapsMessage(){const e=this.#e(".dialog-zap-list");if(e){if(et.hasNoZaps(this.viewId))return void this.#c(e);await this.#u()||(this.#c(e),et.setNoZapsState(this.viewId,!0))}}async#u(){const e=this.config.noZapsDelay||ut.DIALOG_CONFIG.DEFAULT_NO_ZAPS_DELAY;await new Promise((r=>setTimeout(r,e)));const n=et.getZapEvents(this.viewId);return!!n?.length&&(await this.renderZapListFromCache(n),!0)}#c(e){const n=this.config.noZapsMessage||ut.DIALOG_CONFIG.NO_ZAPS_MESSAGE;e.innerHTML=Br.createNoZapsMessageHTML(n),e.style.minHeight=ut.DIALOG_CONFIG.ZAP_LIST.MIN_HEIGHT}async batchUpdate(e,n={}){const r=this.#e(".dialog-zap-list");if(r)try{const i=new Map(Array.from(r.querySelectorAll(".zap-list-item")).map((c=>[c.getAttribute("data-event-id"),c]))),s=this.#y(e),o=Oc(this.config.identifier),a=s.filter((c=>{const u=i.get(c.id);return o?!u:!u||c.reference&&!u.querySelector(".zap-reference")}));if(a.length===0&&!n.isFullUpdate)return;const l=document.createDocumentFragment();for(const c of a){const{li:u,zapInfo:f}=await this.itemBuilder.createListItem(c);!o&&c.reference&&this.updateZapReference(c),l.appendChild(u),f.pubkey&&await this.#p(f.pubkey,u)}this.#n(r,l)}catch{}}#f(e,n){return Array.from(e.children).find((r=>{const i=parseInt(r.getAttribute("data-timestamp")||"0");return n>i}))}updateZapReference(e){if(e?.id&&e?.reference)try{const n=this.getElementByEventId(e.id);if(!n)return;Br.addReferenceToElement(n,e.reference),et.setReference(e.id,e.reference)}catch{}}#m(){this.profileUpdateUnsubscribe=et.subscribeToProfileUpdates(this.#d.bind(this))}async#d(e,n){const r=this.shadowRoot.querySelectorAll(`[data-pubkey="${e}"]`);await Promise.allSettled(Array.from(r).map((i=>this.profileUI.updateProfileElement(i,n))))}async#h(e){const n=ut.DIALOG_CONFIG.ZAP_LIST.PROFILE_BATCH;for(let r=0;r<e.length;r+=n){const i=e.slice(r,r+n);await Promise.all(i.map((({pubkey:s,element:o})=>this.#p(s,o)))),await new Promise((s=>requestAnimationFrame(s)))}}async#p(e,n){e&&await this.#g(e,n)}async#g(e,n){if(e&&n)try{await this.profileUI.loadAndUpdate(e,n)}catch{}}#y(e){return[...new Map(e.map((n=>[n.id,n]))).values()].sort(((n,r)=>r.created_at-n.created_at))}#b(e,n){if(Oc(this.config.identifier))return;const r=et.getReference(e);r&&Br.addReferenceToElement(n,r)}#v(e){return e&&e.classList.contains("placeholder")}#w(e,n,r){const i=this.itemBuilder.getAmountColorClass(n.satsAmount);e.className=`zap-list-item ${i}${n.comment?" with-comment":""}`,e.setAttribute("data-pubkey",n.pubkey),e.setAttribute("data-event-id",r),e.innerHTML=Br.createZapItemHTML(n,i,this.viewId),e.removeAttribute("data-index")}}var nte=cr(0),rte=cr.n(nte);const gf=new class{#e=new Map;#t=new Map;constructor(){}async getZapStats(t,e){const n=await this.#n(e,t);if(n)return n;const r=await this.fetchStats(t);return r&&et.updateStatsCache(e,t,r),r}async fetchStats(t){try{const e=await this._fetchFromApi(t);return this._formatStats(e)||this.createTimeoutError()}catch(e){return this.handleFetchError(e)}}createTimeoutError(){return{error:!0,timeout:!0}}handleFetchError(t){return{error:!0,timeout:t.message==="STATS_TIMEOUT"}}async _fetchFromApi(t){const e=lA(t);if(!e)return null;const n=`https://api.nostr.band/v0/stats/${e.type==="npub"||e.type==="nprofile"?"profile":"event"}/${t}`,r=new AbortController,i=setTimeout((()=>r.abort()),ut.REQUEST_CONFIG.REQUEST_TIMEOUT);try{return await(await fetch(n,{signal:r.signal})).json()}catch(s){throw s.name==="AbortError"?new Error("STATS_TIMEOUT"):s}finally{clearTimeout(i)}}_formatStats(t){if(!t?.stats)return null;const e=Object.values(t.stats)[0];return e?{count:parseInt(e.zaps_received?.count||e.zaps?.count||0,10),msats:parseInt(e.zaps_received?.msats||e.zaps?.msats||0,10),maxMsats:parseInt(e.zaps_received?.max_msats||e.zaps?.max_msats||0,10)}:null}async initializeStats(t,e,n=!1){if(n&&this.displayStats({skeleton:!0},e),this.#t.has(e))return this.#t.get(e);if(lA(t)?.type==="naddr"){const s=this.createTimeoutError();return this.displayStats(s,e),this.#e.set(e,s),s}const i=(async()=>{try{const s=await this.getZapStats(t,e);return s&&(this.displayStats(s,e),this.#e.set(e,s)),s}catch{return null}finally{this.#t.delete(e)}})();return this.#t.set(e,i),i}async#n(t,e){const n=et.getCachedStats(t,e),r=Date.now();return n&&r-n.timestamp<ut.REQUEST_CONFIG.CACHE_DURATION?n.stats:null}getCurrentStats(t){return this.#e.get(t)}async handleZapEvent(t,e,n){if(t?.isRealTimeEvent)try{const r=t.tags.find((l=>l[0].toLowerCase()==="bolt11"))?.[1],i=this.extractAmountFromBolt11(r);if(i<=0)return;const s=et.getViewStats(e),o={count:s?.count||0,msats:s?.msats||0,maxMsats:s?.maxMsats||0},a={count:o.count+1,msats:o.msats+i,maxMsats:Math.max(o.maxMsats,i)};et.updateStatsCache(e,n,a),this.#e.set(e,a),await this.displayStats(a,e),t.isStatsCalculated=!0,t.amountMsats=i}catch{}}extractAmountFromBolt11(t){try{const e=window.decodeBolt11(t);return parseInt(e.sections.find((n=>n.name==="amount"))?.value??"0",10)}catch{return 0}}async displayStats(t,e){try{await ste(t,e)}catch{}}},Za=new class{#e;#t;#n;#s;#r;#o;#i;constructor(){this.#e=new r8,this.#a(),this.#l()}#a(){this.#n=new Map,this.#s=new Map,this.#r=new Map,this.#t=!1}#l(){const t={pool:this.#e,batchSize:ut.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_SIZE,batchDelay:ut.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_DELAY};this.#o=new Hee(t),this.#i=new Fee(t)}#u(t){this.#n.has(t)||this.#n.set(t,{zap:null}),this.#s.has(t)||this.#s.set(t,{isZapClosed:!1})}#c(t,e,n,r){this.#n.get(t).zap=this.#e.subscribeMany(e.relayUrls,[n.req],r)}#f(t){return t&&t.id&&Array.isArray(t.tags)}#m(t,e){return t&&this.#r.delete(t),null}async connectToRelays(t){this.#t||([this.#o,this.#i].forEach((e=>e.setRelayUrls(t))),this.#t=!0)}subscribeToZaps(t,e,n,r){try{this.#d(n),this.#u(t),this.#s.get(t).isZapClosed=!1,this.#c(t,e,n,this.#h(r))}catch(i){this.#p("Subscription error",i)}}#d(t){if(!t?.req?.kinds||!Array.isArray(t.req.kinds))throw new Error("Invalid subscription settings")}async fetchReference(t,e,n){try{if(!this.#f(e))return null;const r=e.tags.find((l=>Array.isArray(l)&&l[0]===n));if(!r)return null;const i=n==="e"?r[1]:`${r[1]}`,s=et.getReference(i);if(s)return s;const o=this.#r.get(i);if(o)return o;const a=n==="e"?this.#o:this.#i;try{const l=await a.getOrCreateFetchPromise(i);return l&&et.setReference(i,l),this.#r.delete(i),l}finally{this.#r.delete(i)}}catch(r){return this.#m(e?.id,r)}}#h(t){const e=Math.floor(Date.now()/1e3);return{...t,onevent:n=>{n.isRealTimeEvent=n.created_at>=e,t.onevent(n)},oneose:t.oneose}}#p(t,e){throw e}get zapPool(){return this.#e}},{zapPool:ure}=Za,ss=new class{constructor(){this.viewConfigs=new Map,this.configStore=new Map,this.observers=new Map,this.#e=new Map,this.#t=new Map}#e;#t;setZapListUI(t){this.zapListUI=t}setViewConfig(t,e){this.viewConfigs.set(t,e),Br.viewConfigs.set(t,e),et.initializeZapView(t)}getViewConfig(t){return this.viewConfigs.get(t)}async updateEventReference(t,e){try{const n=this.getViewConfig(e);if(!n?.relayUrls?.length||Oc(n?.identifier||""))return!1;const r=await this._fetchEventReference(t,n);return!!r&&(t.reference=r,!0)}catch{return!1}}async _fetchEventReference(t,e){const n=async()=>{if(!t?.tags||!Array.isArray(t.tags))return null;try{if(t.tags.find((s=>Array.isArray(s)&&s[0]==="a"))?.[1])return await Za.fetchReference(e.relayUrls,t,"a");const i=t.tags.find((s=>Array.isArray(s)&&s[0]==="e"));return i?.[1]&&/^[0-9a-f]{64}$/.test(i[1].toLowerCase())?await Za.fetchReference(e.relayUrls,t,"e"):null}catch{return null}};try{return await et.getOrFetchReference(t.id,n)}catch{return null}}async updateEventReferenceBatch(t,e){const n=this.getViewConfig(e);if(!n?.relayUrls?.length||Oc(n?.identifier||""))return;const r=t.map((i=>this.updateEventReference(i,e)));await Promise.allSettled(r)}updateUIReferences(t){this.zapListUI&&t.forEach((e=>{e.reference&&this.zapListUI.updateZapReference(e)}))}async initializeSubscriptions(t,e){try{if(!this._isValidFilter(t))throw new Error("Invalid filter settings");const n=aA(t.identifier);if(!n)throw new Error(ut.ZAP_CONFIG.ERRORS.DECODE_FAILED);this._initializeLoadState(e),this._showInitialLoadingSpinner(e);const{batchEvents:r,lastEventTime:i}=await this._collectInitialEvents(e,t,n);r?.length>0&&this._processBatchEvents(r,e).catch(console.error),await this.finalizeInitialization(e,i)}catch(n){throw n}}_showInitialLoadingSpinner(t){const e=this._getListElement(t);if(e){const n=this._createLoadTrigger();e.appendChild(n)}}async finalizeInitialization(t,e){const n=et.getZapEvents(t),r=this._getListElement(t),i=et.updateLoadState(t,{isInitialFetchComplete:!0,lastEventTime:e});await Promise.all([i,n.length===0?this.zapListUI?.showNoZapsMessage():null,n.length>=ut.REQ_CONFIG.INITIAL_LOAD_COUNT?this.setupInfiniteScroll(t):null]),r?.querySelector(".load-more-trigger")?.remove()}_initializeLoadState(t){et.updateLoadState(t,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1})}_isValidFilter(t){return t&&t.relayUrls&&Array.isArray(t.relayUrls)&&t.relayUrls.length>0&&t.identifier}setupInfiniteScroll(t){try{this._cleanupInfiniteScroll(t);const e=this._getListElement(t);if(!e)return;const n=this._createLoadTrigger();e.appendChild(n),this._observeLoadTrigger(n,t,e)}catch{}}_createLoadTrigger(){const t=document.createElement("div");t.className="load-more-trigger";const e=document.createElement("div");return e.className="loading-spinner",t.appendChild(e),t}_observeLoadTrigger(t,e,n){const r=new IntersectionObserver((i=>this._handleIntersection(i[0],e)),{root:n,rootMargin:ut.INFINITE_SCROLL.ROOT_MARGIN,threshold:ut.INFINITE_SCROLL.THRESHOLD});r.observe(t),this.observers.set(e,r)}async _handleIntersection(t,e){t.isIntersecting&&(et.getLoadState(e).isLoading?setTimeout((()=>{t.isIntersecting&&this._handleIntersection(t,e)}),ut.INFINITE_SCROLL.RETRY_DELAY):this.loadMoreZaps(e).then((n=>{n===0&&this._cleanupInfiniteScroll(e)})).catch((n=>{this._cleanupInfiniteScroll(e)})))}_cleanupInfiniteScroll(t){const e=this.observers.get(t);if(!e)return;e.disconnect(),this._getListElement(t)?.querySelector(".load-more-trigger")?.remove(),this.observers.delete(t)}_getListElement(t){return document.querySelector(`nzv-dialog[data-view-id="${t}"]`)?.shadowRoot?.querySelector(".dialog-zap-list")}async loadMoreZaps(t){const e=et.getLoadState(t),n=this.getViewConfig(t);if(!this._canLoadMore(e,n))return 0;e.isLoading=!0;try{const r=await this._executeLoadMore(t,e,n);if(r>0){const i=et.getZapEvents(t).slice(-r);await this.updateEventReferenceBatch(i,t),this.updateUIReferences(i)}return r}finally{e.isLoading=!1}}async _executeLoadMore(t,e,n){const r=aA(n.identifier,e.lastEventTime);if(!r)return 0;const i=[],s=setTimeout((()=>{i.length===0&&this._cleanupInfiniteScroll(t)}),ut.LOAD_TIMEOUT);try{return await this._collectEvents(t,n,r,i,ut.REQ_CONFIG.ADDITIONAL_LOAD_COUNT,e),i.length>0&&await this._processBatchEvents(i,t),i.length}catch{return 0}finally{clearTimeout(s)}}async _collectEvents(t,e,n,r,i,s){return new Promise(((o,a)=>{const l=setTimeout((()=>a(new Error("Load timeout"))),ut.LOAD_TIMEOUT);Za.subscribeToZaps(t,e,n,{onevent:c=>{c.created_at<s.lastEventTime&&(r.push(c),s.lastEventTime=Math.min(s.lastEventTime,c.created_at),r.length>=i&&(clearTimeout(l),o()))},oneose:()=>{clearTimeout(l),o()}})}))}async _collectInitialEvents(t,e,n){const r=[];let i=null;return new Promise((s=>{const o=this._setupBufferInterval(r,t),a=Za.subscribeToZaps(t,e,n,{onevent:l=>{const c=this._handleInitialEvent(l,r,i,t);c!==null&&(i=c)},oneose:()=>{clearInterval(o),s({batchEvents:[...r],lastEventTime:i})}});this.#e.set(t,{zap:a})}))}_handleInitialEvent(t,e,n,r){const i=Math.min(n||t.created_at,t.created_at);if(et.addZapEvent(r,t)){if(e.push(t),this.updateEventReference(t,r).then((s=>{s&&this.zapListUI&&t.reference&&this.zapListUI.updateZapReference(t)})),t.isRealTimeEvent){const s=this.getViewConfig(r);gf.handleZapEvent(t,r,s?.identifier),this.zapListUI&&this.zapListUI.prependZap(t).catch(console.error)}e.length>=ut.BATCH_SIZE&&this.zapListUI&&this.zapListUI.batchUpdate(et.getZapEvents(r)).catch(console.error)}return i}async _processBatchEvents(t,e){if(t?.length){t.sort(((n,r)=>r.created_at-n.created_at)),t.forEach((n=>et.addZapEvent(e,n)));try{await Promise.all([pf.processBatchProfiles(t)])}catch{}await this._updateUI(t,e)}}async _updateUI(t,e){this.zapListUI&&await this.zapListUI.batchUpdate(t,{isFullUpdate:!0})}_setupBufferInterval(t,e){let n=0;const r=ut.BUFFER_MIN_INTERVAL;return setInterval((()=>{const i=Date.now();t.length>0&&i-n>=r&&this.zapListUI&&(this.zapListUI.batchUpdate(et.getZapEvents(e),{isBufferUpdate:!0}).catch(console.error),n=i)}),ut.BUFFER_INTERVAL)}_canLoadMore(t,e){return e&&!t.isLoading&&t.lastEventTime}unsubscribe(t){try{const e=this.#e.get(t);e?.zap&&(e.zap(),e.zap=null),this.#t.set(t,{isZapClosed:!0}),this._cleanupInfiniteScroll(t)}catch{}}};class ite extends HTMLElement{#e;#t;constructor(){super(),this.attachShadow({mode:"open"}),this.#e={isInitialized:!1,theme:ut.DEFAULT_OPTIONS.theme},this.popStateHandler=e=>{e.preventDefault(),this.#a(".dialog")?.open&&this.closeDialog()}}async connectedCallback(){if(this.viewId=this.getAttribute("data-view-id"),this.viewId){this.#t=this.#n();try{await this.#t,this.#e.isInitialized=!0;const e=ss.getViewConfig(this.viewId);if(!e)throw new Error("Config is required for initialization");if(await this.#s(e),this.getAttribute("data-nzv-id")){const n=await gf.getCurrentStats(this.viewId);n&&this.statsUI.displayStats(n)}this.#e.isInitialized=!0,this.dispatchEvent(new CustomEvent("dialog-initialized",{detail:{viewId:this.viewId}}))}catch{}}}async#n(){return new Promise((e=>{const n=document.createElement("template");n.innerHTML=Br.getDialogTemplate(),this.shadowRoot.appendChild(n.content.cloneNode(!0)),this.#r(),queueMicrotask((()=>e()))}))}async#s(e){const n=document.createElement("style");n.textContent=rte(),this.shadowRoot.appendChild(n),this.statsUI=new Uee(this.shadowRoot),this.profileUI=new Qee,this.zapListUI=new tte(this.shadowRoot,this.profileUI,this.viewId,e),ss.setZapListUI(this.zapListUI);const r=et.getZapEvents(this.viewId);r?.length?await this.zapListUI.renderZapListFromCache(r):this.zapListUI.showNoZapsMessage();const i=this.getAttribute("data-nzv-id");if(i){const s=await et.getCachedStats(this.viewId,i);if(s?.stats)this.statsUI.displayStats(s.stats);else{const o=await gf.getCurrentStats(this.viewId);o&&this.statsUI.displayStats(o)}}}static get observedAttributes(){return["data-theme"]}#r(){const e=this.#a(".dialog");this.#a(".close-dialog-button").addEventListener("click",(()=>this.closeDialog())),e.addEventListener("click",(n=>{n.target===e&&this.closeDialog()})),e.addEventListener("cancel",(n=>{n.preventDefault(),this.closeDialog()})),document.addEventListener("keydown",(n=>{if(e?.open){if(n.key==="Escape")this.closeDialog();else if(n.key===" "){n.preventDefault();const r=this.#a(".dialog-zap-list");r&&(r.scrollTop+=.8*r.clientHeight)}}}))}attributeChangedCallback(e,n,r){n!==r&&e==="data-theme"&&this.#o(r)}#o(e){et.updateThemeState(this.viewId,{theme:e}).isInitialized&&this.#i()}#i(){const e=et.getThemeState(this.viewId).theme==="dark"?"dark-theme":"light-theme";this.shadowRoot.host.classList.add(e)}async showDialog(){await this.#t;const e=this.#a(".dialog");e&&!e.open&&this.#e.isInitialized&&(window.addEventListener("popstate",this.popStateHandler),e.showModal(),queueMicrotask((()=>{document.activeElement&&document.activeElement.blur()})),this.#l())}closeDialog(){const e=this.#a(".dialog");e?.open&&(this.zapListUI?.destroy(),ss.unsubscribe(this.viewId),e.close(),this.remove(),window.removeEventListener("popstate",this.popStateHandler))}displayZapStats(e){this.statsUI.displayStats(e)}#a(e){return this.shadowRoot.querySelector(e)}#l(){const e=this.getAttribute("data-view-id"),n=document.querySelector(`button[data-zap-view-id="${e}"]`);if(!n)return;const r=this.#a(".dialog-title"),i=this.#a(".dialog-title a");if(!i||!r)return;const s=n.getAttribute("data-title"),o=n.getAttribute("data-nzv-id");i.href=o?`https://njump.me/${o}`:"#",s?.trim()?(i.textContent=s,r.classList.add("custom-title")):(i.textContent=ut.DIALOG_CONFIG.DEFAULT_TITLE+e8(o),r.classList.remove("custom-title"))}getOperations(){if(!this.#e.isInitialized)return null;const e={closeDialog:()=>this.closeDialog(),showDialog:()=>this.showDialog()};return this.#e.isInitialized&&Object.assign(e,{prependZap:n=>this.zapListUI?.prependZap(n),displayZapStats:n=>this.statsUI?.displayStats(n),showNoZapsMessage:()=>this.zapListUI?.showNoZapsMessage()}),e}async waitForInitialization(){return this.#t}}customElements.define("nzv-dialog",ite);const cp={create:async(t,e)=>{if(!t||!e)return Promise.reject(new Error("Invalid viewId or config"));ss.setViewConfig(t,e);const n=document.querySelector(`nzv-dialog[data-view-id="${t}"]`);if(n)return n;const r=document.createElement("nzv-dialog");r.setAttribute("data-view-id",t),r.setAttribute("data-config",JSON.stringify(e));const i=document.querySelector(`button[data-zap-view-id="${t}"]`);return i?.getAttribute("data-nzv-id")&&r.setAttribute("data-nzv-id",i.getAttribute("data-nzv-id")),document.body.appendChild(r),await r.waitForInitialization(),r},get:t=>document.querySelector(`nzv-dialog[data-view-id="${t}"]`),execute:(t,e,...n)=>{const r=cp.get(t),i=r?.getOperations();return i?i[e]?.(...n)??null:null}},ste=(t,e)=>cp.execute(e,"displayZapStats",t);async function ote(t,e){try{const n=hf.fromButton(t);if(!n)throw new Error("Failed to create config from button");if(ss.setViewConfig(e,n),!await(async function(i){try{const s=ss.getViewConfig(i);if(!s)throw new Error(`View configuration not found for viewId: ${i}`);return ss.setViewConfig(i,s),await cp.create(i,s)}catch{return null}})(e))throw new Error(ut.ZAP_CONFIG.ERRORS.DIALOG_NOT_FOUND);await(async function(i){try{const s=cp.get(i);if(!s)throw new Error("Dialog not found");await s.waitForInitialization();const o=s.getOperations();if(!o?.showDialog)throw new Error("Basic dialog operations not available");o.showDialog()}catch{}})(e),setTimeout((async()=>{if(await(async function(i,s){const o=et.getZapEvents(i);if(o.length>0){const l=[...new Set(o.map((c=>c.pubkey)))];pf.fetchProfiles(l)}const{hasEnoughCachedEvents:a}=await et.processCachedData(i,s);return a&&ss.setupInfiniteScroll(i),a})(e,n),!t.hasAttribute("data-initialized")){const i=t.getAttribute("data-nzv-id");await Promise.all([Za.connectToRelays(n.relayUrls),ss.initializeSubscriptions(n,e),i?gf.initializeStats(i,e,!0):Promise.resolve()]),t.setAttribute("data-initialized","true")}}),0)}catch{}}function i8(){Object.entries(ut.LIBRARIES).forEach((([t,e])=>{window[t]=e})),document.querySelectorAll("button[data-nzv-id]").forEach(((t,e)=>{if(t.hasAttribute("data-zap-view-id"))return;const n=`nostr-zap-view-${e}`;t.setAttribute("data-zap-view-id",n),t.hasAttribute("data-zap-color-mode")||t.setAttribute("data-zap-color-mode",ut.ZAP_CONFIG.DEFAULT_COLOR_MODE),t.addEventListener("click",(()=>ote(t,n)))}))}function s8(t={}){Object.assign(ut,t),typeof window<"u"&&i8()}function ate(t={}){return s8(t)}typeof window<"u"&&document.addEventListener("DOMContentLoaded",i8);ws.vQ;ws.ZM;ws.yk;ws.h0;ws.n_;var lte=ws.Xz;ws.Uv;ws.fU;ws.Dw;var cA={},uA;function cte(){if(uA)return cA;uA=1;var t=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof X2<"u"?X2:{};function e(b){return b&&b.__esModule?b.default:b}var n={},r={},i=t.parcelRequire1faa;i==null&&(i=function(b){if(b in n)return n[b].exports;if(b in r){var y=r[b];delete r[b];var w={id:b,exports:{}};return n[b]=w,y.call(w.exports,w,w.exports),w.exports}var I=new Error("Cannot find module '"+b+"'");throw I.code="MODULE_NOT_FOUND",I},i.register=function(y,w){r[y]=w},t.parcelRequire1faa=i),i.register("58QMB",function(b,y){(function(){function w(V,K){var ee,oe=Object.keys(K);for(ee=0;ee<oe.length;ee++)V=V.replace(new RegExp("\\{"+oe[ee]+"\\}","gi"),K[oe[ee]]);return V}function I(V){var K,ee,oe;if(!V)throw new Error("cannot create a random attribute name for an undefined object");K="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",ee="";do for(ee="",oe=0;oe<12;oe++)ee+=K[Math.floor(Math.random()*K.length)];while(V[ee]);return ee}function R(V){var K={left:"start",right:"end",center:"middle",start:"start",end:"end"};return K[V]||K.start}function H(V){var K={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return K[V]||K.alphabetic}var W,z,ne,ce,re;re=(function(V,K){var ee,oe,he,ge={};for(V=V.split(","),K=K||10,ee=0;ee<V.length;ee+=2)oe="&"+V[ee+1]+";",he=parseInt(V[ee],K),ge[oe]="&#"+he+";";return ge["\\xa0"]="&#160;",ge})("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),W={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},ne=function(V,K){this.__root=V,this.__ctx=K},ne.prototype.addColorStop=function(V,K){var ee,oe,he=this.__ctx.__createElement("stop");he.setAttribute("offset",V),K.indexOf("rgba")!==-1?(ee=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,oe=ee.exec(K),he.setAttribute("stop-color",w("rgb({r},{g},{b})",{r:oe[1],g:oe[2],b:oe[3]})),he.setAttribute("stop-opacity",oe[4])):he.setAttribute("stop-color",K),this.__root.appendChild(he)},ce=function(V,K){this.__root=V,this.__ctx=K},z=function(V){var K,ee={width:500,height:500,enableMirroring:!1};if(arguments.length>1?(K=ee,K.width=arguments[0],K.height=arguments[1]):K=V||ee,!(this instanceof z))return new z(K);this.width=K.width||ee.width,this.height=K.height||ee.height,this.enableMirroring=K.enableMirroring!==void 0?K.enableMirroring:ee.enableMirroring,this.canvas=this,this.__document=K.document||document,K.ctx?this.__ctx=K.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)},z.prototype.__createElement=function(V,K,ee){K===void 0&&(K={});var oe,he,ge=this.__document.createElementNS("http://www.w3.org/2000/svg",V),Le=Object.keys(K);for(ee&&(ge.setAttribute("fill","none"),ge.setAttribute("stroke","none")),oe=0;oe<Le.length;oe++)he=Le[oe],ge.setAttribute(he,K[he]);return ge},z.prototype.__setDefaultStyles=function(){var V,K,ee=Object.keys(W);for(V=0;V<ee.length;V++)K=ee[V],this[K]=W[K].canvas},z.prototype.__applyStyleState=function(V){var K,ee,oe=Object.keys(V);for(K=0;K<oe.length;K++)ee=oe[K],this[ee]=V[ee]},z.prototype.__getStyleState=function(){var V,K,ee={},oe=Object.keys(W);for(V=0;V<oe.length;V++)K=oe[V],ee[K]=this[K];return ee},z.prototype.__applyStyleToCurrentElement=function(V){var K=this.__currentElement,ee=this.__currentElementsToStyle;ee&&(K.setAttribute(V,""),K=ee.element,ee.children.forEach(function(Pt){Pt.setAttribute(V,"")}));var oe,he,ge,Le,Ae,ze,Pe=Object.keys(W);for(oe=0;oe<Pe.length;oe++)if(he=W[Pe[oe]],ge=this[Pe[oe]],he.apply){if(ge instanceof ce){if(ge.__ctx)for(;ge.__ctx.__defs.childNodes.length;)Le=ge.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[Le]=Le,this.__defs.appendChild(ge.__ctx.__defs.childNodes[0]);K.setAttribute(he.apply,w("url(#{id})",{id:ge.__root.getAttribute("id")}))}else if(ge instanceof ne)K.setAttribute(he.apply,w("url(#{id})",{id:ge.__root.getAttribute("id")}));else if(he.apply.indexOf(V)!==-1&&he.svg!==ge)if(he.svgAttr!=="stroke"&&he.svgAttr!=="fill"||ge.indexOf("rgba")===-1){var Ne=he.svgAttr;if(Pe[oe]==="globalAlpha"&&(Ne=V+"-"+he.svgAttr,K.getAttribute(Ne)))continue;K.setAttribute(Ne,ge)}else{Ae=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,ze=Ae.exec(ge),K.setAttribute(he.svgAttr,w("rgb({r},{g},{b})",{r:ze[1],g:ze[2],b:ze[3]}));var Ve=ze[4],Xe=this.globalAlpha;Xe!=null&&(Ve*=Xe),K.setAttribute(he.svgAttr+"-opacity",Ve)}}},z.prototype.__closestGroupOrSvg=function(V){return V=V||this.__currentElement,V.nodeName==="g"||V.nodeName==="svg"?V:this.__closestGroupOrSvg(V.parentNode)},z.prototype.getSerializedSvg=function(V){var K,ee,oe,he,ge,Le,Ae=new XMLSerializer().serializeToString(this.__root);if(Le=/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi,Le.test(Ae)&&(Ae=Ae.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),V)for(K=Object.keys(re),ee=0;ee<K.length;ee++)oe=K[ee],he=re[oe],ge=new RegExp(oe,"gi"),ge.test(Ae)&&(Ae=Ae.replace(ge,he));return Ae},z.prototype.getSvg=function(){return this.__root},z.prototype.save=function(){var V=this.__createElement("g"),K=this.__closestGroupOrSvg();this.__groupStack.push(K),K.appendChild(V),this.__currentElement=V,this.__stack.push(this.__getStyleState())},z.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var V=this.__stack.pop();this.__applyStyleState(V)},z.prototype.__addTransform=function(V){var K=this.__closestGroupOrSvg();if(K.childNodes.length>0){this.__currentElement.nodeName==="path"&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:K,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var ee=this.__createElement("g");K.appendChild(ee),this.__currentElement=ee}var oe=this.__currentElement.getAttribute("transform");oe?oe+=" ":oe="",oe+=V,this.__currentElement.setAttribute("transform",oe)},z.prototype.scale=function(V,K){K===void 0&&(K=V),this.__addTransform(w("scale({x},{y})",{x:V,y:K}))},z.prototype.rotate=function(V){var K=180*V/Math.PI;this.__addTransform(w("rotate({angle},{cx},{cy})",{angle:K,cx:0,cy:0}))},z.prototype.translate=function(V,K){this.__addTransform(w("translate({x},{y})",{x:V,y:K}))},z.prototype.transform=function(V,K,ee,oe,he,ge){this.__addTransform(w("matrix({a},{b},{c},{d},{e},{f})",{a:V,b:K,c:ee,d:oe,e:he,f:ge}))},z.prototype.beginPath=function(){var V,K;this.__currentDefaultPath="",this.__currentPosition={},V=this.__createElement("path",{},!0),K=this.__closestGroupOrSvg(),K.appendChild(V),this.__currentElement=V},z.prototype.__applyCurrentDefaultPath=function(){var V=this.__currentElement;V.nodeName==="path"?V.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",V.nodeName)},z.prototype.__addPathCommand=function(V){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=V},z.prototype.moveTo=function(V,K){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.__currentPosition={x:V,y:K},this.__addPathCommand(w("M {x} {y}",{x:V,y:K}))},z.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},z.prototype.lineTo=function(V,K){this.__currentPosition={x:V,y:K},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(w("L {x} {y}",{x:V,y:K})):this.__addPathCommand(w("M {x} {y}",{x:V,y:K}))},z.prototype.bezierCurveTo=function(V,K,ee,oe,he,ge){this.__currentPosition={x:he,y:ge},this.__addPathCommand(w("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:V,cp1y:K,cp2x:ee,cp2y:oe,x:he,y:ge}))},z.prototype.quadraticCurveTo=function(V,K,ee,oe){this.__currentPosition={x:ee,y:oe},this.__addPathCommand(w("Q {cpx} {cpy} {x} {y}",{cpx:V,cpy:K,x:ee,y:oe}))};var le=function(V){var K=Math.sqrt(V[0]*V[0]+V[1]*V[1]);return[V[0]/K,V[1]/K]};z.prototype.arcTo=function(V,K,ee,oe,he){var ge=this.__currentPosition&&this.__currentPosition.x,Le=this.__currentPosition&&this.__currentPosition.y;if(ge!==void 0&&Le!==void 0){if(he<0)throw new Error("IndexSizeError: The radius provided ("+he+") is negative.");if(ge===V&&Le===K||V===ee&&K===oe||he===0)return void this.lineTo(V,K);var Ae=le([ge-V,Le-K]),ze=le([ee-V,oe-K]);if(Ae[0]*ze[1]==Ae[1]*ze[0])return void this.lineTo(V,K);var Pe=Ae[0]*ze[0]+Ae[1]*ze[1],Ne=Math.acos(Math.abs(Pe)),Ve=le([Ae[0]+ze[0],Ae[1]+ze[1]]),Xe=he/Math.sin(Ne/2),Pt=V+Xe*Ve[0],Y=K+Xe*Ve[1],Q=[-Ae[1],Ae[0]],G=[ze[1],-ze[0]],ie=function($e){var ye=$e[0];return $e[1]>=0?Math.acos(ye):-Math.acos(ye)},fe=ie(Q),xe=ie(G);this.lineTo(Pt+Q[0]*he,Y+Q[1]*he),this.arc(Pt,Y,he,fe,xe)}},z.prototype.stroke=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},z.prototype.fill=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},z.prototype.rect=function(V,K,ee,oe){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.moveTo(V,K),this.lineTo(V+ee,K),this.lineTo(V+ee,K+oe),this.lineTo(V,K+oe),this.lineTo(V,K),this.closePath()},z.prototype.fillRect=function(V,K,ee,oe){var he,ge;he=this.__createElement("rect",{x:V,y:K,width:ee,height:oe,"shape-rendering":"crispEdges"},!0),ge=this.__closestGroupOrSvg(),ge.appendChild(he),this.__currentElement=he,this.__applyStyleToCurrentElement("fill")},z.prototype.strokeRect=function(V,K,ee,oe){var he,ge;he=this.__createElement("rect",{x:V,y:K,width:ee,height:oe},!0),ge=this.__closestGroupOrSvg(),ge.appendChild(he),this.__currentElement=he,this.__applyStyleToCurrentElement("stroke")},z.prototype.__clearCanvas=function(){for(var V=this.__closestGroupOrSvg(),K=V.getAttribute("transform"),ee=this.__root.childNodes[1],oe=ee.childNodes,he=oe.length-1;he>=0;he--)oe[he]&&ee.removeChild(oe[he]);this.__currentElement=ee,this.__groupStack=[],K&&this.__addTransform(K)},z.prototype.clearRect=function(V,K,ee,oe){if(V===0&&K===0&&ee===this.width&&oe===this.height)return void this.__clearCanvas();var he,ge=this.__closestGroupOrSvg();he=this.__createElement("rect",{x:V,y:K,width:ee,height:oe,fill:"#FFFFFF"},!0),ge.appendChild(he)},z.prototype.createLinearGradient=function(V,K,ee,oe){var he=this.__createElement("linearGradient",{id:I(this.__ids),x1:V+"px",x2:ee+"px",y1:K+"px",y2:oe+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(he),new ne(he,this)},z.prototype.createRadialGradient=function(V,K,ee,oe,he,ge){var Le=this.__createElement("radialGradient",{id:I(this.__ids),cx:oe+"px",cy:he+"px",r:ge+"px",fx:V+"px",fy:K+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(Le),new ne(Le,this)},z.prototype.__parseFont=function(){var V=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i,K=V.exec(this.font),ee={style:K[1]||"normal",size:K[4]||"10px",family:K[6]||"sans-serif",weight:K[3]||"normal",decoration:K[2]||"normal",href:null};return this.__fontUnderline==="underline"&&(ee.decoration="underline"),this.__fontHref&&(ee.href=this.__fontHref),ee},z.prototype.__wrapTextLink=function(V,K){if(V.href){var ee=this.__createElement("a");return ee.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",V.href),ee.appendChild(K),ee}return K},z.prototype.__applyText=function(V,K,ee,oe){var he=this.__parseFont(),ge=this.__closestGroupOrSvg(),Le=this.__createElement("text",{"font-family":he.family,"font-size":he.size,"font-style":he.style,"font-weight":he.weight,"text-decoration":he.decoration,x:K,y:ee,"text-anchor":R(this.textAlign),"dominant-baseline":H(this.textBaseline)},!0);Le.appendChild(this.__document.createTextNode(V)),this.__currentElement=Le,this.__applyStyleToCurrentElement(oe),ge.appendChild(this.__wrapTextLink(he,Le))},z.prototype.fillText=function(V,K,ee){this.__applyText(V,K,ee,"fill")},z.prototype.strokeText=function(V,K,ee){this.__applyText(V,K,ee,"stroke")},z.prototype.measureText=function(V){return this.__ctx.font=this.font,this.__ctx.measureText(V)},z.prototype.arc=function(V,K,ee,oe,he,ge){if(oe!==he){oe%=2*Math.PI,he%=2*Math.PI,oe===he&&(he=(he+2*Math.PI-.001*(ge?-1:1))%(2*Math.PI));var Le=V+ee*Math.cos(he),Ae=K+ee*Math.sin(he),ze=V+ee*Math.cos(oe),Pe=K+ee*Math.sin(oe),Ne=ge?0:1,Ve=0,Xe=he-oe;Xe<0&&(Xe+=2*Math.PI),Ve=ge?Xe>Math.PI?0:1:Xe>Math.PI?1:0,this.lineTo(ze,Pe),this.__addPathCommand(w("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:ee,ry:ee,xAxisRotation:0,largeArcFlag:Ve,sweepFlag:Ne,endX:Le,endY:Ae})),this.__currentPosition={x:Le,y:Ae}}},z.prototype.clip=function(){var V=this.__closestGroupOrSvg(),K=this.__createElement("clipPath"),ee=I(this.__ids),oe=this.__createElement("g");this.__applyCurrentDefaultPath(),V.removeChild(this.__currentElement),K.setAttribute("id",ee),K.appendChild(this.__currentElement),this.__defs.appendChild(K),V.setAttribute("clip-path",w("url(#{id})",{id:ee})),V.appendChild(oe),this.__currentElement=oe},z.prototype.drawImage=function(){var V,K,ee,oe,he,ge,Le,Ae,ze,Pe,Ne,Ve,Xe,Pt,Y=Array.prototype.slice.call(arguments),Q=Y[0],G=0,ie=0;if(Y.length===3)V=Y[1],K=Y[2],he=Q.width,ge=Q.height,ee=he,oe=ge;else if(Y.length===5)V=Y[1],K=Y[2],ee=Y[3],oe=Y[4],he=Q.width,ge=Q.height;else{if(Y.length!==9)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);G=Y[1],ie=Y[2],he=Y[3],ge=Y[4],V=Y[5],K=Y[6],ee=Y[7],oe=Y[8]}Le=this.__closestGroupOrSvg(),this.__currentElement;var fe="translate("+V+", "+K+")";if(Q instanceof z){if(Ae=Q.getSvg().cloneNode(!0),Ae.childNodes&&Ae.childNodes.length>1){for(ze=Ae.childNodes[0];ze.childNodes.length;)Pt=ze.childNodes[0].getAttribute("id"),this.__ids[Pt]=Pt,this.__defs.appendChild(ze.childNodes[0]);if(Pe=Ae.childNodes[1]){var xe,$e=Pe.getAttribute("transform");xe=$e?$e+" "+fe:fe,Pe.setAttribute("transform",xe),Le.appendChild(Pe)}}}else Q.nodeName!=="CANVAS"&&Q.nodeName!=="IMG"||(Ne=this.__createElement("image"),Ne.setAttribute("width",ee),Ne.setAttribute("height",oe),Ne.setAttribute("preserveAspectRatio","none"),Ne.setAttribute("opacity",this.globalAlpha),(G||ie||he!==Q.width||ge!==Q.height)&&(Ve=this.__document.createElement("canvas"),Ve.width=ee,Ve.height=oe,Xe=Ve.getContext("2d"),Xe.drawImage(Q,G,ie,he,ge,0,0,ee,oe),Q=Ve),Ne.setAttribute("transform",fe),Ne.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",Q.nodeName==="CANVAS"?Q.toDataURL():Q.originalSrc),Le.appendChild(Ne))},z.prototype.createPattern=function(V,K){var ee,oe=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),he=I(this.__ids);return oe.setAttribute("id",he),oe.setAttribute("width",V.width),oe.setAttribute("height",V.height),V.nodeName==="CANVAS"||V.nodeName==="IMG"?(ee=this.__document.createElementNS("http://www.w3.org/2000/svg","image"),ee.setAttribute("width",V.width),ee.setAttribute("height",V.height),ee.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",V.nodeName==="CANVAS"?V.toDataURL():V.getAttribute("src")),oe.appendChild(ee),this.__defs.appendChild(oe)):V instanceof z&&(oe.appendChild(V.__root.childNodes[1]),this.__defs.appendChild(oe)),new ce(oe,this)},z.prototype.setLineDash=function(V){V&&V.length>0?this.lineDash=V.join(","):this.lineDash=null},z.prototype.drawFocusRing=function(){},z.prototype.createImageData=function(){},z.prototype.getImageData=function(){},z.prototype.putImageData=function(){},z.prototype.globalCompositeOperation=function(){},z.prototype.setTransform=function(){},typeof window=="object"&&(window.C2S=z),typeof b.exports=="object"&&(b.exports=z)})(),(function(){function w(Y,Q,G){this.mode=Le.MODE_8BIT_BYTE,this.data=Y,this.parsedData=[];for(var ie=0,fe=this.data.length;ie<fe;ie++){var xe=[],$e=this.data.charCodeAt(ie);Q?xe[0]=$e:$e>65536?(xe[0]=240|(1835008&$e)>>>18,xe[1]=128|(258048&$e)>>>12,xe[2]=128|(4032&$e)>>>6,xe[3]=128|63&$e):$e>2048?(xe[0]=224|(61440&$e)>>>12,xe[1]=128|(4032&$e)>>>6,xe[2]=128|63&$e):$e>128?(xe[0]=192|(1984&$e)>>>6,xe[1]=128|63&$e):xe[0]=$e,this.parsedData.push(xe)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),G||this.parsedData.length==this.data.length||(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function I(Y,Q){this.typeNumber=Y,this.errorCorrectLevel=Q,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function R(Y,Q){if(Y.length==re)throw new Error(Y.length+"/"+Q);for(var G=0;G<Y.length&&Y[G]==0;)G++;this.num=new Array(Y.length-G+Q);for(var ie=0;ie<Y.length-G;ie++)this.num[ie]=Y[ie+G]}function H(Y,Q){this.totalCount=Y,this.dataCount=Q}function W(){this.buffer=[],this.length=0}function z(){var Y=!1,Q=navigator.userAgent;if(/android/i.test(Q)){Y=!0;var G=Q.toString().match(/android ([0-9]\.[0-9])/i);G&&G[1]&&(Y=parseFloat(G[1]))}return Y}function ne(Y,Q){for(var G=Q.correctLevel,ie=1,fe=ce(Y),xe=0,$e=Xe.length;xe<$e;xe++){var ye=0;switch(G){case Ae.L:ye=Xe[xe][0];break;case Ae.M:ye=Xe[xe][1];break;case Ae.Q:ye=Xe[xe][2];break;case Ae.H:ye=Xe[xe][3]}if(fe<=ye)break;ie++}if(ie>Xe.length)throw new Error("Too long data. the CorrectLevel."+["M","L","H","Q"][G]+" limit length is "+ye);return Q.version!=0&&(ie<=Q.version?(ie=Q.version,Q.runVersion=ie):(console.warn("QR Code version "+Q.version+" too small, run version use "+ie),Q.runVersion=ie)),ie}function ce(Y){var Q=encodeURI(Y).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return Q.length+(Q.length!=Y.length?3:0)}var re,le,V=typeof t=="object"&&t&&t.Object===Object&&t,K=typeof self=="object"&&self&&self.Object===Object&&self,ee=V||K||Function("return this")(),oe=y&&!y.nodeType&&y,he=oe&&!0&&b&&!b.nodeType&&b,ge=ee.QRCode;w.prototype={getLength:function(Y){return this.parsedData.length},write:function(Y){for(var Q=0,G=this.parsedData.length;Q<G;Q++)Y.put(this.parsedData[Q],8)}},I.prototype={addData:function(Y,Q,G){var ie=new w(Y,Q,G);this.dataList.push(ie),this.dataCache=null},isDark:function(Y,Q){if(Y<0||this.moduleCount<=Y||Q<0||this.moduleCount<=Q)throw new Error(Y+","+Q);return this.modules[Y][Q][0]},getEye:function(Y,Q){if(Y<0||this.moduleCount<=Y||Q<0||this.moduleCount<=Q)throw new Error(Y+","+Q);var G=this.modules[Y][Q];if(G[1]){var ie="P"+G[1]+"_"+G[2];return G[2]=="A"&&(ie="A"+G[1]),{isDark:G[0],type:ie}}return null},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(Y,Q){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var G=0;G<this.moduleCount;G++){this.modules[G]=new Array(this.moduleCount);for(var ie=0;ie<this.moduleCount;ie++)this.modules[G][ie]=[]}this.setupPositionProbePattern(0,0,"TL"),this.setupPositionProbePattern(this.moduleCount-7,0,"BL"),this.setupPositionProbePattern(0,this.moduleCount-7,"TR"),this.setupPositionAdjustPattern("A"),this.setupTimingPattern(),this.setupTypeInfo(Y,Q),this.typeNumber>=7&&this.setupTypeNumber(Y),this.dataCache==null&&(this.dataCache=I.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,Q)},setupPositionProbePattern:function(Y,Q,G){for(var ie=-1;ie<=7;ie++)if(!(Y+ie<=-1||this.moduleCount<=Y+ie))for(var fe=-1;fe<=7;fe++)Q+fe<=-1||this.moduleCount<=Q+fe||(0<=ie&&ie<=6&&(fe==0||fe==6)||0<=fe&&fe<=6&&(ie==0||ie==6)||2<=ie&&ie<=4&&2<=fe&&fe<=4?(this.modules[Y+ie][Q+fe][0]=!0,this.modules[Y+ie][Q+fe][2]=G,this.modules[Y+ie][Q+fe][1]=ie==-0||fe==-0||ie==6||fe==6?"O":"I"):this.modules[Y+ie][Q+fe][0]=!1)},getBestMaskPattern:function(){for(var Y=0,Q=0,G=0;G<8;G++){this.makeImpl(!0,G);var ie=Pe.getLostPoint(this);(G==0||Y>ie)&&(Y=ie,Q=G)}return Q},createMovieClip:function(Y,Q,G){var ie=Y.createEmptyMovieClip(Q,G);this.make();for(var fe=0;fe<this.modules.length;fe++)for(var xe=1*fe,$e=0;$e<this.modules[fe].length;$e++){var ye=1*$e,te=this.modules[fe][$e][0];te&&(ie.beginFill(0,100),ie.moveTo(ye,xe),ie.lineTo(ye+1,xe),ie.lineTo(ye+1,xe+1),ie.lineTo(ye,xe+1),ie.endFill())}return ie},setupTimingPattern:function(){for(var Y=8;Y<this.moduleCount-8;Y++)this.modules[Y][6][0]==null&&(this.modules[Y][6][0]=Y%2==0);for(var Q=8;Q<this.moduleCount-8;Q++)this.modules[6][Q][0]==null&&(this.modules[6][Q][0]=Q%2==0)},setupPositionAdjustPattern:function(Y){for(var Q=Pe.getPatternPosition(this.typeNumber),G=0;G<Q.length;G++)for(var ie=0;ie<Q.length;ie++){var fe=Q[G],xe=Q[ie];if(this.modules[fe][xe][0]==null)for(var $e=-2;$e<=2;$e++)for(var ye=-2;ye<=2;ye++)$e==-2||$e==2||ye==-2||ye==2||$e==0&&ye==0?(this.modules[fe+$e][xe+ye][0]=!0,this.modules[fe+$e][xe+ye][2]=Y,this.modules[fe+$e][xe+ye][1]=$e==-2||ye==-2||$e==2||ye==2?"O":"I"):this.modules[fe+$e][xe+ye][0]=!1}},setupTypeNumber:function(Y){for(var Q=Pe.getBCHTypeNumber(this.typeNumber),G=0;G<18;G++){var ie=!Y&&(Q>>G&1)==1;this.modules[Math.floor(G/3)][G%3+this.moduleCount-8-3][0]=ie}for(var G=0;G<18;G++){var ie=!Y&&(Q>>G&1)==1;this.modules[G%3+this.moduleCount-8-3][Math.floor(G/3)][0]=ie}},setupTypeInfo:function(Y,Q){for(var G=this.errorCorrectLevel<<3|Q,ie=Pe.getBCHTypeInfo(G),fe=0;fe<15;fe++){var xe=!Y&&(ie>>fe&1)==1;fe<6?this.modules[fe][8][0]=xe:fe<8?this.modules[fe+1][8][0]=xe:this.modules[this.moduleCount-15+fe][8][0]=xe}for(var fe=0;fe<15;fe++){var xe=!Y&&(ie>>fe&1)==1;fe<8?this.modules[8][this.moduleCount-fe-1][0]=xe:fe<9?this.modules[8][15-fe-1+1][0]=xe:this.modules[8][15-fe-1][0]=xe}this.modules[this.moduleCount-8][8][0]=!Y},mapData:function(Y,Q){for(var G=-1,ie=this.moduleCount-1,fe=7,xe=0,$e=this.moduleCount-1;$e>0;$e-=2)for($e==6&&$e--;;){for(var ye=0;ye<2;ye++)if(this.modules[ie][$e-ye][0]==null){var te=!1;xe<Y.length&&(te=(Y[xe]>>>fe&1)==1);var Dt=Pe.getMask(Q,ie,$e-ye);Dt&&(te=!te),this.modules[ie][$e-ye][0]=te,fe--,fe==-1&&(xe++,fe=7)}if((ie+=G)<0||this.moduleCount<=ie){ie-=G,G=-G;break}}}},I.PAD0=236,I.PAD1=17,I.createData=function(Y,Q,G){for(var ie=H.getRSBlocks(Y,Q),fe=new W,xe=0;xe<G.length;xe++){var $e=G[xe];fe.put($e.mode,4),fe.put($e.getLength(),Pe.getLengthInBits($e.mode,Y)),$e.write(fe)}for(var ye=0,xe=0;xe<ie.length;xe++)ye+=ie[xe].dataCount;if(fe.getLengthInBits()>8*ye)throw new Error("code length overflow. ("+fe.getLengthInBits()+">"+8*ye+")");for(fe.getLengthInBits()+4<=8*ye&&fe.put(0,4);fe.getLengthInBits()%8!=0;)fe.putBit(!1);for(;!(fe.getLengthInBits()>=8*ye||(fe.put(I.PAD0,8),fe.getLengthInBits()>=8*ye));)fe.put(I.PAD1,8);return I.createBytes(fe,ie)},I.createBytes=function(Y,Q){for(var G=0,ie=0,fe=0,xe=new Array(Q.length),$e=new Array(Q.length),ye=0;ye<Q.length;ye++){var te=Q[ye].dataCount,Dt=Q[ye].totalCount-te;ie=Math.max(ie,te),fe=Math.max(fe,Dt),xe[ye]=new Array(te);for(var pt=0;pt<xe[ye].length;pt++)xe[ye][pt]=255&Y.buffer[pt+G];G+=te;var pn=Pe.getErrorCorrectPolynomial(Dt),st=new R(xe[ye],pn.getLength()-1),Lr=st.mod(pn);$e[ye]=new Array(pn.getLength()-1);for(var pt=0;pt<$e[ye].length;pt++){var wr=pt+Lr.getLength()-$e[ye].length;$e[ye][pt]=wr>=0?Lr.get(wr):0}}for(var As=0,pt=0;pt<Q.length;pt++)As+=Q[pt].totalCount;for(var Yr=new Array(As),Fn=0,pt=0;pt<ie;pt++)for(var ye=0;ye<Q.length;ye++)pt<xe[ye].length&&(Yr[Fn++]=xe[ye][pt]);for(var pt=0;pt<fe;pt++)for(var ye=0;ye<Q.length;ye++)pt<$e[ye].length&&(Yr[Fn++]=$e[ye][pt]);return Yr};for(var Le={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Ae={L:1,M:0,Q:3,H:2},ze={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},Pe={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(Y){for(var Q=Y<<10;Pe.getBCHDigit(Q)-Pe.getBCHDigit(Pe.G15)>=0;)Q^=Pe.G15<<Pe.getBCHDigit(Q)-Pe.getBCHDigit(Pe.G15);return(Y<<10|Q)^Pe.G15_MASK},getBCHTypeNumber:function(Y){for(var Q=Y<<12;Pe.getBCHDigit(Q)-Pe.getBCHDigit(Pe.G18)>=0;)Q^=Pe.G18<<Pe.getBCHDigit(Q)-Pe.getBCHDigit(Pe.G18);return Y<<12|Q},getBCHDigit:function(Y){for(var Q=0;Y!=0;)Q++,Y>>>=1;return Q},getPatternPosition:function(Y){return Pe.PATTERN_POSITION_TABLE[Y-1]},getMask:function(Y,Q,G){switch(Y){case ze.PATTERN000:return(Q+G)%2==0;case ze.PATTERN001:return Q%2==0;case ze.PATTERN010:return G%3==0;case ze.PATTERN011:return(Q+G)%3==0;case ze.PATTERN100:return(Math.floor(Q/2)+Math.floor(G/3))%2==0;case ze.PATTERN101:return Q*G%2+Q*G%3==0;case ze.PATTERN110:return(Q*G%2+Q*G%3)%2==0;case ze.PATTERN111:return(Q*G%3+(Q+G)%2)%2==0;default:throw new Error("bad maskPattern:"+Y)}},getErrorCorrectPolynomial:function(Y){for(var Q=new R([1],0),G=0;G<Y;G++)Q=Q.multiply(new R([1,Ne.gexp(G)],0));return Q},getLengthInBits:function(Y,Q){if(1<=Q&&Q<10)switch(Y){case Le.MODE_NUMBER:return 10;case Le.MODE_ALPHA_NUM:return 9;case Le.MODE_8BIT_BYTE:case Le.MODE_KANJI:return 8;default:throw new Error("mode:"+Y)}else if(Q<27)switch(Y){case Le.MODE_NUMBER:return 12;case Le.MODE_ALPHA_NUM:return 11;case Le.MODE_8BIT_BYTE:return 16;case Le.MODE_KANJI:return 10;default:throw new Error("mode:"+Y)}else{if(!(Q<41))throw new Error("type:"+Q);switch(Y){case Le.MODE_NUMBER:return 14;case Le.MODE_ALPHA_NUM:return 13;case Le.MODE_8BIT_BYTE:return 16;case Le.MODE_KANJI:return 12;default:throw new Error("mode:"+Y)}}},getLostPoint:function(Y){for(var Q=Y.getModuleCount(),G=0,ie=0;ie<Q;ie++)for(var fe=0;fe<Q;fe++){for(var xe=0,$e=Y.isDark(ie,fe),ye=-1;ye<=1;ye++)if(!(ie+ye<0||Q<=ie+ye))for(var te=-1;te<=1;te++)fe+te<0||Q<=fe+te||ye==0&&te==0||$e==Y.isDark(ie+ye,fe+te)&&xe++;xe>5&&(G+=3+xe-5)}for(var ie=0;ie<Q-1;ie++)for(var fe=0;fe<Q-1;fe++){var Dt=0;Y.isDark(ie,fe)&&Dt++,Y.isDark(ie+1,fe)&&Dt++,Y.isDark(ie,fe+1)&&Dt++,Y.isDark(ie+1,fe+1)&&Dt++,Dt!=0&&Dt!=4||(G+=3)}for(var ie=0;ie<Q;ie++)for(var fe=0;fe<Q-6;fe++)Y.isDark(ie,fe)&&!Y.isDark(ie,fe+1)&&Y.isDark(ie,fe+2)&&Y.isDark(ie,fe+3)&&Y.isDark(ie,fe+4)&&!Y.isDark(ie,fe+5)&&Y.isDark(ie,fe+6)&&(G+=40);for(var fe=0;fe<Q;fe++)for(var ie=0;ie<Q-6;ie++)Y.isDark(ie,fe)&&!Y.isDark(ie+1,fe)&&Y.isDark(ie+2,fe)&&Y.isDark(ie+3,fe)&&Y.isDark(ie+4,fe)&&!Y.isDark(ie+5,fe)&&Y.isDark(ie+6,fe)&&(G+=40);for(var pt=0,fe=0;fe<Q;fe++)for(var ie=0;ie<Q;ie++)Y.isDark(ie,fe)&&pt++;return G+=Math.abs(100*pt/Q/Q-50)/5*10}},Ne={glog:function(Y){if(Y<1)throw new Error("glog("+Y+")");return Ne.LOG_TABLE[Y]},gexp:function(Y){for(;Y<0;)Y+=255;for(;Y>=256;)Y-=255;return Ne.EXP_TABLE[Y]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},Ve=0;Ve<8;Ve++)Ne.EXP_TABLE[Ve]=1<<Ve;for(var Ve=8;Ve<256;Ve++)Ne.EXP_TABLE[Ve]=Ne.EXP_TABLE[Ve-4]^Ne.EXP_TABLE[Ve-5]^Ne.EXP_TABLE[Ve-6]^Ne.EXP_TABLE[Ve-8];for(var Ve=0;Ve<255;Ve++)Ne.LOG_TABLE[Ne.EXP_TABLE[Ve]]=Ve;R.prototype={get:function(Y){return this.num[Y]},getLength:function(){return this.num.length},multiply:function(Y){for(var Q=new Array(this.getLength()+Y.getLength()-1),G=0;G<this.getLength();G++)for(var ie=0;ie<Y.getLength();ie++)Q[G+ie]^=Ne.gexp(Ne.glog(this.get(G))+Ne.glog(Y.get(ie)));return new R(Q,0)},mod:function(Y){if(this.getLength()-Y.getLength()<0)return this;for(var Q=Ne.glog(this.get(0))-Ne.glog(Y.get(0)),G=new Array(this.getLength()),ie=0;ie<this.getLength();ie++)G[ie]=this.get(ie);for(var ie=0;ie<Y.getLength();ie++)G[ie]^=Ne.gexp(Ne.glog(Y.get(ie))+Q);return new R(G,0).mod(Y)}},H.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],H.getRSBlocks=function(Y,Q){var G=H.getRsBlockTable(Y,Q);if(G==re)throw new Error("bad rs block @ typeNumber:"+Y+"/errorCorrectLevel:"+Q);for(var ie=G.length/3,fe=[],xe=0;xe<ie;xe++)for(var $e=G[3*xe+0],ye=G[3*xe+1],te=G[3*xe+2],Dt=0;Dt<$e;Dt++)fe.push(new H(ye,te));return fe},H.getRsBlockTable=function(Y,Q){switch(Q){case Ae.L:return H.RS_BLOCK_TABLE[4*(Y-1)+0];case Ae.M:return H.RS_BLOCK_TABLE[4*(Y-1)+1];case Ae.Q:return H.RS_BLOCK_TABLE[4*(Y-1)+2];case Ae.H:return H.RS_BLOCK_TABLE[4*(Y-1)+3];default:return re}},W.prototype={get:function(Y){var Q=Math.floor(Y/8);return(this.buffer[Q]>>>7-Y%8&1)==1},put:function(Y,Q){for(var G=0;G<Q;G++)this.putBit((Y>>>Q-G-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(Y){var Q=Math.floor(this.length/8);this.buffer.length<=Q&&this.buffer.push(0),Y&&(this.buffer[Q]|=128>>>this.length%8),this.length++}};var Xe=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],Pt=(function(){return typeof CanvasRenderingContext2D<"u"})()?(function(){function Y(){if(this._htOption.drawer=="svg"){var xe=this._oContext.getSerializedSvg(!0);this.dataURL=xe,this._el.innerHTML=xe}else try{var $e=this._elCanvas.toDataURL("image/png");this.dataURL=$e}catch(ye){console.error(ye)}this._htOption.onRenderingEnd&&(this.dataURL||console.error("Can not get base64 data, please check: 1. Published the page and image to the server 2. The image request support CORS 3. Configured `crossOrigin:'anonymous'` option"),this._htOption.onRenderingEnd(this._htOption,this.dataURL))}function Q(xe,$e){var ye=this;if(ye._fFail=$e,ye._fSuccess=xe,ye._bSupportDataURI===null){var te=document.createElement("img"),Dt=function(){ye._bSupportDataURI=!1,ye._fFail&&ye._fFail.call(ye)},pt=function(){ye._bSupportDataURI=!0,ye._fSuccess&&ye._fSuccess.call(ye)};return te.onabort=Dt,te.onerror=Dt,te.onload=pt,void(te.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}ye._bSupportDataURI===!0&&ye._fSuccess?ye._fSuccess.call(ye):ye._bSupportDataURI===!1&&ye._fFail&&ye._fFail.call(ye)}if(ee._android&&ee._android<=2.1){var G=1/window.devicePixelRatio,ie=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(xe,$e,ye,te,Dt,pt,pn,st,Lr){if("nodeName"in xe&&/img/i.test(xe.nodeName))for(var wr=arguments.length-1;wr>=1;wr--)arguments[wr]=arguments[wr]*G;else st===void 0&&(arguments[1]*=G,arguments[2]*=G,arguments[3]*=G,arguments[4]*=G);ie.apply(this,arguments)}}var fe=function(xe,$e){this._bIsPainted=!1,this._android=z(),this._el=xe,this._htOption=$e,this._htOption.drawer=="svg"?(this._oContext={},this._elCanvas={}):(this._elCanvas=document.createElement("canvas"),this._el.appendChild(this._elCanvas),this._oContext=this._elCanvas.getContext("2d")),this._bSupportDataURI=null,this.dataURL=null};return fe.prototype.draw=function(xe){function $e(){te.quietZone>0&&te.quietZoneColor&&(st.lineWidth=0,st.fillStyle=te.quietZoneColor,st.fillRect(0,0,Lr._elCanvas.width,te.quietZone),st.fillRect(0,te.quietZone,te.quietZone,Lr._elCanvas.height-2*te.quietZone),st.fillRect(Lr._elCanvas.width-te.quietZone,te.quietZone,te.quietZone,Lr._elCanvas.height-2*te.quietZone),st.fillRect(0,Lr._elCanvas.height-te.quietZone,Lr._elCanvas.width,te.quietZone))}function ye(As){function Yr(Mi){var zn=Math.round(te.width/3.5),Nr=Math.round(te.height/3.5);zn!==Nr&&(zn=Nr),te.logoMaxWidth?zn=Math.round(te.logoMaxWidth):te.logoWidth&&(zn=Math.round(te.logoWidth)),te.logoMaxHeight?Nr=Math.round(te.logoMaxHeight):te.logoHeight&&(Nr=Math.round(te.logoHeight));var Eo,xo;Mi.naturalWidth===void 0?(Eo=Mi.width,xo=Mi.height):(Eo=Mi.naturalWidth,xo=Mi.naturalHeight),(te.logoMaxWidth||te.logoMaxHeight)&&(te.logoMaxWidth&&Eo<=zn&&(zn=Eo),te.logoMaxHeight&&xo<=Nr&&(Nr=xo),Eo<=zn&&xo<=Nr&&(zn=Eo,Nr=xo));var Xg=(te.width+2*te.quietZone-zn)/2,Qg=(te.height+te.titleHeight+2*te.quietZone-Nr)/2,l2=Math.min(zn/Eo,Nr/xo),em=Eo*l2,tm=xo*l2;(te.logoMaxWidth||te.logoMaxHeight)&&(zn=em,Nr=tm,Xg=(te.width+2*te.quietZone-zn)/2,Qg=(te.height+te.titleHeight+2*te.quietZone-Nr)/2),te.logoBackgroundTransparent||(st.fillStyle=te.logoBackgroundColor,st.fillRect(Xg,Qg,zn,Nr));var BM=st.imageSmoothingQuality,UM=st.imageSmoothingEnabled;st.imageSmoothingEnabled=!0,st.imageSmoothingQuality="high",st.drawImage(Mi,Xg+(zn-em)/2,Qg+(Nr-tm)/2,em,tm),st.imageSmoothingEnabled=UM,st.imageSmoothingQuality=BM,$e(),Il._bIsPainted=!0,Il.makeImage()}te.onRenderingStart&&te.onRenderingStart(te);for(var Fn=0;Fn<Dt;Fn++)for(var $r=0;$r<Dt;$r++){var wo=$r*pt+te.quietZone,Ma=Fn*pn+te.quietZone,Zc=As.isDark(Fn,$r),nr=As.getEye(Fn,$r),nn=te.dotScale;st.lineWidth=0;var vn,rr;nr?(vn=te[nr.type]||te[nr.type.substring(0,2)]||te.colorDark,rr=te.colorLight):te.backgroundImage?(rr="rgba(0,0,0,0)",Fn==6?te.autoColor?(vn=te.timing_H||te.timing||te.autoColorDark,rr=te.autoColorLight):vn=te.timing_H||te.timing||te.colorDark:$r==6?te.autoColor?(vn=te.timing_V||te.timing||te.autoColorDark,rr=te.autoColorLight):vn=te.timing_V||te.timing||te.colorDark:te.autoColor?(vn=te.autoColorDark,rr=te.autoColorLight):vn=te.colorDark):(vn=Fn==6?te.timing_H||te.timing||te.colorDark:$r==6&&(te.timing_V||te.timing)||te.colorDark,rr=te.colorLight),st.strokeStyle=Zc?vn:rr,st.fillStyle=Zc?vn:rr,nr?(nn=nr.type=="AO"?te.dotScaleAO:nr.type=="AI"?te.dotScaleAI:1,te.backgroundImage&&te.autoColor?(vn=(nr.type=="AO"?te.AI:te.AO)||te.autoColorDark,rr=te.autoColorLight):vn=(nr.type=="AO"?te.AI:te.AO)||vn,Zc=nr.isDark,st.fillRect(wo+pt*(1-nn)/2,te.titleHeight+Ma+pn*(1-nn)/2,pt*nn,pn*nn)):Fn==6?(nn=te.dotScaleTiming_H,st.fillRect(wo+pt*(1-nn)/2,te.titleHeight+Ma+pn*(1-nn)/2,pt*nn,pn*nn)):$r==6?(nn=te.dotScaleTiming_V,st.fillRect(wo+pt*(1-nn)/2,te.titleHeight+Ma+pn*(1-nn)/2,pt*nn,pn*nn)):(te.backgroundImage,st.fillRect(wo+pt*(1-nn)/2,te.titleHeight+Ma+pn*(1-nn)/2,pt*nn,pn*nn)),te.dotScale==1||nr||(st.strokeStyle=te.colorLight)}if(te.title&&(st.fillStyle=te.titleBackgroundColor,st.fillRect(te.quietZone,te.quietZone,te.width,te.titleHeight),st.font=te.titleFont,st.fillStyle=te.titleColor,st.textAlign="center",st.fillText(te.title,this._elCanvas.width/2,+te.quietZone+te.titleTop)),te.subTitle&&(st.font=te.subTitleFont,st.fillStyle=te.subTitleColor,st.fillText(te.subTitle,this._elCanvas.width/2,+te.quietZone+te.subTitleTop)),te.logo){var _s=new Image,Il=this;_s.onload=function(){Yr(_s)},_s.onerror=function(Mi){console.error(Mi)},te.crossOrigin!=null&&(_s.crossOrigin=te.crossOrigin),_s.originalSrc=te.logo,_s.src=te.logo}else $e(),this._bIsPainted=!0,this.makeImage()}var te=this._htOption,Dt=xe.getModuleCount(),pt=Math.round(te.width/Dt),pn=Math.round((te.height-te.titleHeight)/Dt);pt<=1&&(pt=1),pn<=1&&(pn=1),te.width=pt*Dt,te.height=pn*Dt+te.titleHeight,te.quietZone=Math.round(te.quietZone),this._elCanvas.width=te.width+2*te.quietZone,this._elCanvas.height=te.height+2*te.quietZone,this._htOption.drawer!="canvas"&&(this._oContext=new C2S(this._elCanvas.width,this._elCanvas.height)),this.clear();var st=this._oContext;st.lineWidth=0,st.fillStyle=te.colorLight,st.fillRect(0,0,this._elCanvas.width,this._elCanvas.height),st.clearRect(te.quietZone,te.quietZone,te.width,te.titleHeight);var Lr=this;if(te.backgroundImage){var wr=new Image;wr.onload=function(){st.globalAlpha=1,st.globalAlpha=te.backgroundImageAlpha;var As=st.imageSmoothingQuality,Yr=st.imageSmoothingEnabled;st.imageSmoothingEnabled=!0,st.imageSmoothingQuality="high",st.drawImage(wr,0,te.titleHeight,te.width+2*te.quietZone,te.height+2*te.quietZone-te.titleHeight),st.imageSmoothingEnabled=Yr,st.imageSmoothingQuality=As,st.globalAlpha=1,ye.call(Lr,xe)},te.crossOrigin!=null&&(wr.crossOrigin=te.crossOrigin),wr.originalSrc=te.backgroundImage,wr.src=te.backgroundImage}else ye.call(Lr,xe)},fe.prototype.makeImage=function(){this._bIsPainted&&Q.call(this,Y)},fe.prototype.isPainted=function(){return this._bIsPainted},fe.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},fe.prototype.remove=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1,this._el.innerHTML=""},fe.prototype.round=function(xe){return xe&&Math.floor(1e3*xe)/1e3},fe})():(function(){var Y=function(Q,G){this._el=Q,this._htOption=G};return Y.prototype.draw=function(Q){var G=this._htOption,ie=this._el,fe=Q.getModuleCount(),xe=Math.round(G.width/fe),$e=Math.round((G.height-G.titleHeight)/fe);xe<=1&&(xe=1),$e<=1&&($e=1),this._htOption.width=xe*fe,this._htOption.height=$e*fe+G.titleHeight,this._htOption.quietZone=Math.round(this._htOption.quietZone);var ye=[],te="",Dt=Math.round(xe*G.dotScale),pt=Math.round($e*G.dotScale);Dt<4&&(Dt=4,pt=4);var pn=G.colorDark,st=G.colorLight;if(G.backgroundImage){G.autoColor?(G.colorDark="rgba(0, 0, 0, .6);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#99000000', EndColorStr='#99000000');",G.colorLight="rgba(255, 255, 255, .7);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#B2FFFFFF', EndColorStr='#B2FFFFFF');"):G.colorLight="rgba(0,0,0,0)";var Lr='<div style="display:inline-block; z-index:-10;position:absolute;"><img src="'+G.backgroundImage+'" widht="'+(G.width+2*G.quietZone)+'" height="'+(G.height+2*G.quietZone)+'" style="opacity:'+G.backgroundImageAlpha+";filter:alpha(opacity="+100*G.backgroundImageAlpha+'); "/></div>';ye.push(Lr)}if(G.quietZone&&(te="display:inline-block; width:"+(G.width+2*G.quietZone)+"px; height:"+(G.width+2*G.quietZone)+"px;background:"+G.quietZoneColor+"; text-align:center;"),ye.push('<div style="font-size:0;'+te+'">'),ye.push('<table  style="font-size:0;border:0;border-collapse:collapse; margin-top:'+G.quietZone+'px;" border="0" cellspacing="0" cellspadding="0" align="center" valign="middle">'),ye.push('<tr height="'+G.titleHeight+'" align="center"><td style="border:0;border-collapse:collapse;margin:0;padding:0" colspan="'+fe+'">'),G.title){var wr=G.titleColor,As=G.titleFont;ye.push('<div style="width:100%;margin-top:'+G.titleTop+"px;color:"+wr+";font:"+As+";background:"+G.titleBackgroundColor+'">'+G.title+"</div>")}G.subTitle&&ye.push('<div style="width:100%;margin-top:'+(G.subTitleTop-G.titleTop)+"px;color:"+G.subTitleColor+"; font:"+G.subTitleFont+'">'+G.subTitle+"</div>"),ye.push("</td></tr>");for(var Yr=0;Yr<fe;Yr++){ye.push('<tr style="border:0; padding:0; margin:0;" height="7">');for(var Fn=0;Fn<fe;Fn++){var $r=Q.isDark(Yr,Fn),wo=Q.getEye(Yr,Fn);if(wo){$r=wo.isDark;var Ma=wo.type,Zc=G[Ma]||G[Ma.substring(0,2)]||pn;ye.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+xe+"px;height:"+$e+'px;"><span style="width:'+xe+"px;height:"+$e+"px;background-color:"+($r?Zc:st)+';display:inline-block"></span></td>')}else{var nr=G.colorDark;Yr==6?(nr=G.timing_H||G.timing||pn,ye.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+xe+"px;height:"+$e+"px;background-color:"+($r?nr:st)+';"></td>')):Fn==6?(nr=G.timing_V||G.timing||pn,ye.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+xe+"px;height:"+$e+"px;background-color:"+($r?nr:st)+';"></td>')):ye.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+xe+"px;height:"+$e+'px;"><div style="display:inline-block;width:'+Dt+"px;height:"+pt+"px;background-color:"+($r?nr:G.colorLight)+';"></div></td>')}}ye.push("</tr>")}if(ye.push("</table>"),ye.push("</div>"),G.logo){var nn=new Image;G.crossOrigin!=null&&(nn.crossOrigin=G.crossOrigin),nn.src=G.logo;var vn=G.width/3.5,rr=G.height/3.5;vn!=rr&&(vn=rr),G.logoWidth&&(vn=G.logoWidth),G.logoHeight&&(rr=G.logoHeight);var _s="position:relative; z-index:1;display:table-cell;top:-"+((G.height-G.titleHeight)/2+rr/2+G.quietZone)+"px;text-align:center; width:"+vn+"px; height:"+rr+"px;line-height:"+vn+"px; vertical-align: middle;";G.logoBackgroundTransparent||(_s+="background:"+G.logoBackgroundColor),ye.push('<div style="'+_s+'"><img  src="'+G.logo+'"  style="max-width: '+vn+"px; max-height: "+rr+'px;" /> <div style=" display: none; width:1px;margin-left: -1px;"></div></div>')}G.onRenderingStart&&G.onRenderingStart(G),ie.innerHTML=ye.join("");var Il=ie.childNodes[0],Mi=(G.width-Il.offsetWidth)/2,zn=(G.height-Il.offsetHeight)/2;Mi>0&&zn>0&&(Il.style.margin=zn+"px "+Mi+"px"),this._htOption.onRenderingEnd&&this._htOption.onRenderingEnd(this._htOption,null)},Y.prototype.clear=function(){this._el.innerHTML=""},Y})();le=function(Y,Q){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:Ae.H,dotScale:1,dotScaleTiming:1,dotScaleTiming_H:re,dotScaleTiming_V:re,dotScaleA:1,dotScaleAO:re,dotScaleAI:re,quietZone:0,quietZoneColor:"rgba(0,0,0,0)",title:"",titleFont:"normal normal bold 16px Arial",titleColor:"#000000",titleBackgroundColor:"#ffffff",titleHeight:0,titleTop:30,subTitle:"",subTitleFont:"normal normal normal 14px Arial",subTitleColor:"#4F4F4F",subTitleTop:60,logo:re,logoWidth:re,logoHeight:re,logoMaxWidth:re,logoMaxHeight:re,logoBackgroundColor:"#ffffff",logoBackgroundTransparent:!1,PO:re,PI:re,PO_TL:re,PI_TL:re,PO_TR:re,PI_TR:re,PO_BL:re,PI_BL:re,AO:re,AI:re,timing:re,timing_H:re,timing_V:re,backgroundImage:re,backgroundImageAlpha:1,autoColor:!1,autoColorDark:"rgba(0, 0, 0, .6)",autoColorLight:"rgba(255, 255, 255, .7)",onRenderingStart:re,onRenderingEnd:re,version:0,tooltip:!1,binary:!1,drawer:"canvas",crossOrigin:null,utf8WithoutBOM:!0},typeof Q=="string"&&(Q={text:Q}),Q)for(var G in Q)this._htOption[G]=Q[G];this._htOption.title||this._htOption.subTitle||(this._htOption.titleHeight=0),(this._htOption.version<0||this._htOption.version>40)&&(console.warn("QR Code version '"+this._htOption.version+"' is invalidate, reset to 0"),this._htOption.version=0),(this._htOption.dotScale<0||this._htOption.dotScale>1)&&(console.warn(this._htOption.dotScale+" , is invalidate, dotScale must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScale=1),(this._htOption.dotScaleTiming<0||this._htOption.dotScaleTiming>1)&&(console.warn(this._htOption.dotScaleTiming+" , is invalidate, dotScaleTiming must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming=1),this._htOption.dotScaleTiming_H?(this._htOption.dotScaleTiming_H<0||this._htOption.dotScaleTiming_H>1)&&(console.warn(this._htOption.dotScaleTiming_H+" , is invalidate, dotScaleTiming_H must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_H=1):this._htOption.dotScaleTiming_H=this._htOption.dotScaleTiming,this._htOption.dotScaleTiming_V?(this._htOption.dotScaleTiming_V<0||this._htOption.dotScaleTiming_V>1)&&(console.warn(this._htOption.dotScaleTiming_V+" , is invalidate, dotScaleTiming_V must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_V=1):this._htOption.dotScaleTiming_V=this._htOption.dotScaleTiming,(this._htOption.dotScaleA<0||this._htOption.dotScaleA>1)&&(console.warn(this._htOption.dotScaleA+" , is invalidate, dotScaleA must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleA=1),this._htOption.dotScaleAO?(this._htOption.dotScaleAO<0||this._htOption.dotScaleAO>1)&&(console.warn(this._htOption.dotScaleAO+" , is invalidate, dotScaleAO must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAO=1):this._htOption.dotScaleAO=this._htOption.dotScaleA,this._htOption.dotScaleAI?(this._htOption.dotScaleAI<0||this._htOption.dotScaleAI>1)&&(console.warn(this._htOption.dotScaleAI+" , is invalidate, dotScaleAI must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAI=1):this._htOption.dotScaleAI=this._htOption.dotScaleA,(this._htOption.backgroundImageAlpha<0||this._htOption.backgroundImageAlpha>1)&&(console.warn(this._htOption.backgroundImageAlpha+" , is invalidate, backgroundImageAlpha must between 0 and 1, now reset to 1. "),this._htOption.backgroundImageAlpha=1),this._htOption.height=this._htOption.height+this._htOption.titleHeight,typeof Y=="string"&&(Y=document.getElementById(Y)),(!this._htOption.drawer||this._htOption.drawer!="svg"&&this._htOption.drawer!="canvas")&&(this._htOption.drawer="canvas"),this._android=z(),this._el=Y,this._oQRCode=null,this._htOption._element=Y;var ie={};for(var G in this._htOption)ie[G]=this._htOption[G];this._oDrawing=new Pt(this._el,ie),this._htOption.text&&this.makeCode(this._htOption.text)},le.prototype.makeCode=function(Y){this._oQRCode=new I(ne(Y,this._htOption),this._htOption.correctLevel),this._oQRCode.addData(Y,this._htOption.binary,this._htOption.utf8WithoutBOM),this._oQRCode.make(),this._htOption.tooltip&&(this._el.title=Y),this._oDrawing.draw(this._oQRCode)},le.prototype.makeImage=function(){typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},le.prototype.clear=function(){this._oDrawing.remove()},le.prototype.resize=function(Y,Q){this._oDrawing._htOption.width=Y,this._oDrawing._htOption.height=Q,this._oDrawing.draw(this._oQRCode)},le.prototype.noConflict=function(){return ee.QRCode===this&&(ee.QRCode=ge),le},le.CorrectLevel=Ae,he?((he.exports=le).QRCode=le,oe.QRCode=le):ee.QRCode=le}).call(this)});var s=i("58QMB");/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */var o={};const a=BigInt(0),l=BigInt(1),c=BigInt(2),u=BigInt(3),f=BigInt(8),d=Object.freeze({a,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),h=(b,y)=>(b+y/c)/y,p={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(b){const{n:y}=d,w=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),I=-l*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),R=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),H=w,W=BigInt("0x100000000000000000000000000000000"),z=h(H*b,y),ne=h(-I*b,y);let ce=de(b-z*w-ne*R,y),re=de(-z*I-ne*H,y);const le=ce>W,V=re>W;if(le&&(ce=y-ce),V&&(re=y-re),ce>W||re>W)throw new Error("splitScalarEndo: Endomorphism failed, k="+b);return{k1neg:le,k1:ce,k2neg:V,k2:re}}},g=32,m=32,v=32,x=g+1,C=2*g+1;function N(b){const{a:y,b:w}=d,I=de(b*b),R=de(I*b);return de(R+y*b+w)}const O=d.a===a;class A extends Error{constructor(y){super(y)}}function P(b){if(!(b instanceof S))throw new TypeError("JacobianPoint expected")}class S{constructor(y,w,I){this.x=y,this.y=w,this.z=I}static fromAffine(y){if(!(y instanceof k))throw new TypeError("JacobianPoint#fromAffine: expected Point");return y.equals(k.ZERO)?S.ZERO:new S(y.x,y.y,l)}static toAffineBatch(y){const w=Ee(y.map(I=>I.z));return y.map((I,R)=>I.toAffine(w[R]))}static normalizeZ(y){return S.toAffineBatch(y).map(S.fromAffine)}equals(y){P(y);const{x:w,y:I,z:R}=this,{x:H,y:W,z}=y,ne=de(R*R),ce=de(z*z),re=de(w*ce),le=de(H*ne),V=de(de(I*z)*ce),K=de(de(W*R)*ne);return re===le&&V===K}negate(){return new S(this.x,de(-this.y),this.z)}double(){const{x:y,y:w,z:I}=this,R=de(y*y),H=de(w*w),W=de(H*H),z=y+H,ne=de(c*(de(z*z)-R-W)),ce=de(u*R),re=de(ce*ce),le=de(re-c*ne),V=de(ce*(ne-le)-f*W),K=de(c*w*I);return new S(le,V,K)}add(y){P(y);const{x:w,y:I,z:R}=this,{x:H,y:W,z}=y;if(H===a||W===a)return this;if(w===a||I===a)return y;const ne=de(R*R),ce=de(z*z),re=de(w*ce),le=de(H*ne),V=de(de(I*z)*ce),K=de(de(W*R)*ne),ee=de(le-re),oe=de(K-V);if(ee===a)return oe===a?this.double():S.ZERO;const he=de(ee*ee),ge=de(ee*he),Le=de(re*he),Ae=de(oe*oe-ge-c*Le),ze=de(oe*(Le-Ae)-V*ge),Pe=de(R*z*ee);return new S(Ae,ze,Pe)}subtract(y){return this.add(y.negate())}multiplyUnsafe(y){const w=S.ZERO;if(typeof y=="bigint"&&y===a)return w;let I=De(y);if(I===l)return this;if(!O){let le=w,V=this;for(;I>a;)I&l&&(le=le.add(V)),V=V.double(),I>>=l;return le}let{k1neg:R,k1:H,k2neg:W,k2:z}=p.splitScalar(I),ne=w,ce=w,re=this;for(;H>a||z>a;)H&l&&(ne=ne.add(re)),z&l&&(ce=ce.add(re)),re=re.double(),H>>=l,z>>=l;return R&&(ne=ne.negate()),W&&(ce=ce.negate()),ce=new S(de(ce.x*p.beta),ce.y,ce.z),ne.add(ce)}precomputeWindow(y){const w=O?128/y+1:256/y+1,I=[];let R=this,H=R;for(let W=0;W<w;W++){H=R,I.push(H);for(let z=1;z<2**(y-1);z++)H=H.add(R),I.push(H);R=H.double()}return I}wNAF(y,w){!w&&this.equals(S.BASE)&&(w=k.BASE);const I=w&&w._WINDOW_SIZE||1;if(256%I)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let R=w&&_.get(w);R||(R=this.precomputeWindow(I),w&&I!==1&&(R=S.normalizeZ(R),_.set(w,R)));let H=S.ZERO,W=S.BASE;const z=1+(O?128/I:256/I),ne=2**(I-1),ce=BigInt(2**I-1),re=2**I,le=BigInt(I);for(let V=0;V<z;V++){const K=V*ne;let ee=Number(y&ce);y>>=le,ee>ne&&(ee-=re,y+=l);const oe=K,he=K+Math.abs(ee)-1,ge=V%2!==0,Le=ee<0;ee===0?W=W.add(E(ge,R[oe])):H=H.add(E(Le,R[he]))}return{p:H,f:W}}multiply(y,w){let I=De(y),R,H;if(O){const{k1neg:W,k1:z,k2neg:ne,k2:ce}=p.splitScalar(I);let{p:re,f:le}=this.wNAF(z,w),{p:V,f:K}=this.wNAF(ce,w);re=E(W,re),V=E(ne,V),V=new S(de(V.x*p.beta),V.y,V.z),R=re.add(V),H=le.add(K)}else{const{p:W,f:z}=this.wNAF(I,w);R=W,H=z}return S.normalizeZ([R,H])[0]}toAffine(y){const{x:w,y:I,z:R}=this,H=this.equals(S.ZERO);y==null&&(y=H?f:me(R));const W=y,z=de(W*W),ne=de(z*W),ce=de(w*z),re=de(I*ne),le=de(R*W);if(H)return k.ZERO;if(le!==l)throw new Error("invZ was invalid");return new k(ce,re)}}S.BASE=new S(d.Gx,d.Gy,l),S.ZERO=new S(a,l,a);function E(b,y){const w=y.negate();return b?w:y}const _=new WeakMap;class k{constructor(y,w){this.x=y,this.y=w}_setWindowSize(y){this._WINDOW_SIZE=y,_.delete(this)}hasEvenY(){return this.y%c===a}static fromCompressedHex(y){const w=y.length===32,I=X(w?y:y.subarray(1));if(!at(I))throw new Error("Point is not on curve");const R=N(I);let H=Ze(R);const W=(H&l)===l;w?W&&(H=de(-H)):(y[0]&1)===1!==W&&(H=de(-H));const z=new k(I,H);return z.assertValidity(),z}static fromUncompressedHex(y){const w=X(y.subarray(1,g+1)),I=X(y.subarray(g+1,g*2+1)),R=new k(w,I);return R.assertValidity(),R}static fromHex(y){const w=be(y),I=w.length,R=w[0];if(I===g)return this.fromCompressedHex(w);if(I===x&&(R===2||R===3))return this.fromCompressedHex(w);if(I===C&&R===4)return this.fromUncompressedHex(w);throw new Error(`Point.fromHex: received invalid point. Expected 32-${x} compressed bytes or ${C} uncompressed bytes, not ${I}`)}static fromPrivateKey(y){return k.BASE.multiply(ht(y))}static fromSignature(y,w,I){const{r:R,s:H}=Ce(w);if(![0,1,2,3].includes(I))throw new Error("Cannot recover: invalid recovery bit");const W=Oe(be(y)),{n:z}=d,ne=I===2||I===3?R+z:R,ce=me(ne,z),re=de(-W*ce,z),le=de(H*ce,z),V=I&1?"03":"02",K=k.fromHex(V+j(ne)),ee=k.BASE.multiplyAndAddUnsafe(K,re,le);if(!ee)throw new Error("Cannot recover signature: point at infinify");return ee.assertValidity(),ee}toRawBytes(y=!1){return ae(this.toHex(y))}toHex(y=!1){const w=j(this.x);return y?`${this.hasEvenY()?"02":"03"}${w}`:`04${w}${j(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const y="Point is not on elliptic curve",{x:w,y:I}=this;if(!at(w)||!at(I))throw new Error(y);const R=de(I*I),H=N(w);if(de(R-H)!==a)throw new Error(y)}equals(y){return this.x===y.x&&this.y===y.y}negate(){return new k(this.x,de(-this.y))}double(){return S.fromAffine(this).double().toAffine()}add(y){return S.fromAffine(this).add(S.fromAffine(y)).toAffine()}subtract(y){return this.add(y.negate())}multiply(y){return S.fromAffine(this).multiply(y,this).toAffine()}multiplyAndAddUnsafe(y,w,I){const R=S.fromAffine(this),H=w===a||w===l||this!==k.BASE?R.multiplyUnsafe(w):R.multiply(w),W=S.fromAffine(y).multiplyUnsafe(I),z=H.add(W);return z.equals(S.ZERO)?void 0:z.toAffine()}}k.BASE=new k(d.Gx,d.Gy),k.ZERO=new k(a,a);function D(b){return Number.parseInt(b[0],16)>=8?"00"+b:b}function U(b){if(b.length<2||b[0]!==2)throw new Error(`Invalid signature integer tag: ${q(b)}`);const y=b[1],w=b.subarray(2,y+2);if(!y||w.length!==y)throw new Error("Invalid signature integer: wrong length");if(w[0]===0&&w[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:X(w),left:b.subarray(y+2)}}function B(b){if(b.length<2||b[0]!=48)throw new Error(`Invalid signature tag: ${q(b)}`);if(b[1]!==b.length-2)throw new Error("Invalid signature: incorrect length");const{data:y,left:w}=U(b.subarray(2)),{data:I,left:R}=U(w);if(R.length)throw new Error(`Invalid signature: left bytes after parsing: ${q(R)}`);return{r:y,s:I}}class M{constructor(y,w){this.r=y,this.s=w,this.assertValidity()}static fromCompact(y){const w=y instanceof Uint8Array,I="Signature.fromCompact";if(typeof y!="string"&&!w)throw new TypeError(`${I}: Expected string or Uint8Array`);const R=w?q(y):y;if(R.length!==128)throw new Error(`${I}: Expected 64-byte hex`);return new M(ue(R.slice(0,64)),ue(R.slice(64,128)))}static fromDER(y){const w=y instanceof Uint8Array;if(typeof y!="string"&&!w)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:I,s:R}=B(w?y:ae(y));return new M(I,R)}static fromHex(y){return this.fromDER(y)}assertValidity(){const{r:y,s:w}=this;if(!it(y))throw new Error("Invalid Signature: r must be 0 < r < n");if(!it(w))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const y=d.n>>l;return this.s>y}normalizeS(){return this.hasHighS()?new M(this.r,de(-this.s,d.n)):this}toDERRawBytes(){return ae(this.toDERHex())}toDERHex(){const y=D(J(this.s)),w=D(J(this.r)),I=y.length/2,R=w.length/2,H=J(I),W=J(R);return`30${J(R+I+4)}02${W}${w}02${H}${y}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return ae(this.toCompactHex())}toCompactHex(){return j(this.r)+j(this.s)}}function T(...b){if(!b.every(I=>I instanceof Uint8Array))throw new Error("Uint8Array list expected");if(b.length===1)return b[0];const y=b.reduce((I,R)=>I+R.length,0),w=new Uint8Array(y);for(let I=0,R=0;I<b.length;I++){const H=b[I];w.set(H,R),R+=H.length}return w}const L=Array.from({length:256},(b,y)=>y.toString(16).padStart(2,"0"));function q(b){if(!(b instanceof Uint8Array))throw new Error("Expected Uint8Array");let y="";for(let w=0;w<b.length;w++)y+=L[b[w]];return y}const F=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function j(b){if(typeof b!="bigint")throw new Error("Expected bigint");if(!(a<=b&&b<F))throw new Error("Expected number 0 <= n < 2^256");return b.toString(16).padStart(64,"0")}function Z(b){const y=ae(j(b));if(y.length!==32)throw new Error("Error: expected 32 bytes");return y}function J(b){const y=b.toString(16);return y.length&1?`0${y}`:y}function ue(b){if(typeof b!="string")throw new TypeError("hexToNumber: expected string, got "+typeof b);return BigInt(`0x${b}`)}function ae(b){if(typeof b!="string")throw new TypeError("hexToBytes: expected string, got "+typeof b);if(b.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+b.length);const y=new Uint8Array(b.length/2);for(let w=0;w<y.length;w++){const I=w*2,R=b.slice(I,I+2),H=Number.parseInt(R,16);if(Number.isNaN(H)||H<0)throw new Error("Invalid byte sequence");y[w]=H}return y}function X(b){return ue(q(b))}function be(b){return b instanceof Uint8Array?Uint8Array.from(b):ae(b)}function De(b){if(typeof b=="number"&&Number.isSafeInteger(b)&&b>0)return BigInt(b);if(typeof b=="bigint"&&it(b))return b;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function de(b,y=d.P){const w=b%y;return w>=a?w:y+w}function ke(b,y){const{P:w}=d;let I=b;for(;y-- >a;)I*=I,I%=w;return I}function Ze(b){const{P:y}=d,w=BigInt(6),I=BigInt(11),R=BigInt(22),H=BigInt(23),W=BigInt(44),z=BigInt(88),ne=b*b*b%y,ce=ne*ne*b%y,re=ke(ce,u)*ce%y,le=ke(re,u)*ce%y,V=ke(le,c)*ne%y,K=ke(V,I)*V%y,ee=ke(K,R)*K%y,oe=ke(ee,W)*ee%y,he=ke(oe,z)*oe%y,ge=ke(he,W)*ee%y,Le=ke(ge,u)*ce%y,Ae=ke(Le,H)*K%y,ze=ke(Ae,w)*ne%y,Pe=ke(ze,c);if(Pe*Pe%y!==b)throw new Error("Cannot find square root");return Pe}function me(b,y=d.P){if(b===a||y<=a)throw new Error(`invert: expected positive integers, got n=${b} mod=${y}`);let w=de(b,y),I=y,R=a,H=l;for(;w!==a;){const z=I/w,ne=I%w,ce=R-H*z;I=w,w=ne,R=H,H=ce}if(I!==l)throw new Error("invert: does not exist");return de(R,y)}function Ee(b,y=d.P){const w=new Array(b.length),I=b.reduce((H,W,z)=>W===a?H:(w[z]=H,de(H*W,y)),l),R=me(I,y);return b.reduceRight((H,W,z)=>W===a?H:(w[z]=de(H*w[z],y),de(H*W,y)),R),w}function ve(b){const y=b.length*8-m*8,w=X(b);return y>0?w>>BigInt(y):w}function Oe(b,y=!1){const w=ve(b);if(y)return w;const{n:I}=d;return w>=I?w-I:w}let Re,nt;class He{constructor(y,w){if(this.hashLen=y,this.qByteLen=w,typeof y!="number"||y<2)throw new Error("hashLen must be a number");if(typeof w!="number"||w<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(y).fill(1),this.k=new Uint8Array(y).fill(0),this.counter=0}hmac(...y){return gt.hmacSha256(this.k,...y)}hmacSync(...y){return nt(this.k,...y)}checkSync(){if(typeof nt!="function")throw new A("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(y=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),y),this.v=await this.hmac(this.v),y.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),y),this.v=await this.hmac(this.v))}reseedSync(y=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),y),this.v=this.hmacSync(this.v),y.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),y),this.v=this.hmacSync(this.v))}async generate(){this.incr();let y=0;const w=[];for(;y<this.qByteLen;){this.v=await this.hmac(this.v);const I=this.v.slice();w.push(I),y+=this.v.length}return T(...w)}generateSync(){this.checkSync(),this.incr();let y=0;const w=[];for(;y<this.qByteLen;){this.v=this.hmacSync(this.v);const I=this.v.slice();w.push(I),y+=this.v.length}return T(...w)}}function it(b){return a<b&&b<d.n}function at(b){return a<b&&b<d.P}function At(b,y,w,I=!0){const{n:R}=d,H=Oe(b,!0);if(!it(H))return;const W=me(H,R),z=k.BASE.multiply(H),ne=de(z.x,R);if(ne===a)return;const ce=de(W*de(y+w*ne,R),R);if(ce===a)return;let re=new M(ne,ce),le=(z.x===re.r?0:2)|Number(z.y&l);return I&&re.hasHighS()&&(re=re.normalizeS(),le^=1),{sig:re,recovery:le}}function ht(b){let y;if(typeof b=="bigint")y=b;else if(typeof b=="number"&&Number.isSafeInteger(b)&&b>0)y=BigInt(b);else if(typeof b=="string"){if(b.length!==2*m)throw new Error("Expected 32 bytes of private key");y=ue(b)}else if(b instanceof Uint8Array){if(b.length!==m)throw new Error("Expected 32 bytes of private key");y=X(b)}else throw new TypeError("Expected valid private key");if(!it(y))throw new Error("Expected private key: 0 < key < n");return y}function Tt(b){return b instanceof k?(b.assertValidity(),b):k.fromHex(b)}function Ce(b){if(b instanceof M)return b.assertValidity(),b;try{return M.fromDER(b)}catch{return M.fromCompact(b)}}function Be(b,y=!1){return k.fromPrivateKey(b).toRawBytes(y)}function ot(b){const y=b instanceof Uint8Array,w=typeof b=="string",I=(y||w)&&b.length;return y?I===x||I===C:w?I===x*2||I===C*2:b instanceof k}function ct(b,y,w=!1){if(ot(b))throw new TypeError("getSharedSecret: first arg must be private key");if(!ot(y))throw new TypeError("getSharedSecret: second arg must be public key");const I=Tt(y);return I.assertValidity(),I.multiply(ht(b)).toRawBytes(w)}function Zt(b){const y=b.length>g?b.slice(0,g):b;return X(y)}function Ut(b){const y=Zt(b),w=de(y,d.n);return jt(w<a?y:w)}function jt(b){return Z(b)}function Nt(b,y,w){if(b==null)throw new Error(`sign: expected valid message hash, not "${b}"`);const I=be(b),R=ht(y),H=[jt(R),Ut(I)];if(w!=null){w===!0&&(w=gt.randomBytes(g));const ne=be(w);if(ne.length!==g)throw new Error(`sign: Expected ${g} bytes of extra data`);H.push(ne)}const W=T(...H),z=Zt(I);return{seed:W,m:z,d:R}}function _t(b,y){const{sig:w,recovery:I}=b,{der:R,recovered:H}=Object.assign({canonical:!0,der:!0},y),W=R?w.toDERRawBytes():w.toCompactRawBytes();return H?[W,I]:W}function xt(b,y,w={}){const{seed:I,m:R,d:H}=Nt(b,y,w.extraEntropy),W=new He(v,m);W.reseedSync(I);let z;for(;!(z=At(W.generateSync(),R,H,w.canonical));)W.reseedSync();return _t(z,w)}const Ht={strict:!0};function Cn(b,y,w,I=Ht){let R;try{R=Ce(b),y=be(y)}catch{return!1}const{r:H,s:W}=R;if(I.strict&&R.hasHighS())return!1;const z=Oe(y);let ne;try{ne=Tt(w)}catch{return!1}const{n:ce}=d,re=me(W,ce),le=de(z*re,ce),V=de(H*re,ce),K=k.BASE.multiplyAndAddUnsafe(ne,le,V);return K?de(K.x,ce)===H:!1}function Qn(b){return de(X(b),d.n)}class kr{constructor(y,w){this.r=y,this.s=w,this.assertValidity()}static fromHex(y){const w=be(y);if(w.length!==64)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${w.length}`);const I=X(w.subarray(0,32)),R=X(w.subarray(32,64));return new kr(I,R)}assertValidity(){const{r:y,s:w}=this;if(!at(y)||!it(w))throw new Error("Invalid signature")}toHex(){return j(this.r)+j(this.s)}toRawBytes(){return ae(this.toHex())}}function oi(b){return k.fromPrivateKey(b).toRawX()}class Cr{constructor(y,w,I=gt.randomBytes()){if(y==null)throw new TypeError(`sign: Expected valid message, not "${y}"`);this.m=be(y);const{x:R,scalar:H}=this.getScalar(ht(w));if(this.px=R,this.d=H,this.rand=be(I),this.rand.length!==32)throw new TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(y){const w=k.fromPrivateKey(y),I=w.hasEvenY()?y:d.n-y;return{point:w,scalar:I,x:w.toRawX()}}initNonce(y,w){return Z(y^X(w))}finalizeNonce(y){const w=de(X(y),d.n);if(w===a)throw new Error("sign: Creation of signature failed. k is zero");const{point:I,x:R,scalar:H}=this.getScalar(w);return{R:I,rx:R,k:H}}finalizeSig(y,w,I,R){return new kr(y.x,de(w+I*R,d.n)).toRawBytes()}error(){throw new Error("sign: Invalid signature produced")}async calc(){const{m:y,d:w,px:I,rand:R}=this,H=gt.taggedHash,W=this.initNonce(w,await H(In.aux,R)),{R:z,rx:ne,k:ce}=this.finalizeNonce(await H(In.nonce,W,I,y)),re=Qn(await H(In.challenge,ne,I,y)),le=this.finalizeSig(z,ce,re,w);return await Gr(le,y,I)||this.error(),le}calcSync(){const{m:y,d:w,px:I,rand:R}=this,H=gt.taggedHashSync,W=this.initNonce(w,H(In.aux,R)),{R:z,rx:ne,k:ce}=this.finalizeNonce(H(In.nonce,W,I,y)),re=Qn(H(In.challenge,ne,I,y)),le=this.finalizeSig(z,ce,re,w);return br(le,y,I)||this.error(),le}}async function ka(b,y,w){return new Cr(b,y,w).calc()}function Es(b,y,w){return new Cr(b,y,w).calcSync()}function Ca(b,y,w){const I=b instanceof kr,R=I?b:kr.fromHex(b);return I&&R.assertValidity(),{...R,m:be(y),P:Tt(w)}}function Kr(b,y,w,I){const R=k.BASE.multiplyAndAddUnsafe(y,ht(w),de(-I,d.n));return!(!R||!R.hasEvenY()||R.x!==b)}async function Gr(b,y,w){try{const{r:I,s:R,m:H,P:W}=Ca(b,y,w),z=Qn(await gt.taggedHash(In.challenge,Z(I),W.toRawX(),H));return Kr(I,W,R,z)}catch{return!1}}function br(b,y,w){try{const{r:I,s:R,m:H,P:W}=Ca(b,y,w),z=Qn(gt.taggedHashSync(In.challenge,Z(I),W.toRawX(),H));return Kr(I,W,R,z)}catch(I){if(I instanceof A)throw I;return!1}}const Tr={Signature:kr,getPublicKey:oi,sign:ka,verify:Gr,signSync:Es,verifySync:br};k.BASE._setWindowSize(8);const Tn={node:o,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},In={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},Ir={},gt={bytesToHex:q,hexToBytes:ae,concatBytes:T,mod:de,invert:me,isValidPrivateKey(b){try{return ht(b),!0}catch{return!1}},_bigintTo32Bytes:Z,_normalizePrivateKey:ht,hashToPrivateKey:b=>{b=be(b);const y=m+8;if(b.length<y||b.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const w=de(X(b),d.n-l)+l;return Z(w)},randomBytes:(b=32)=>{if(Tn.web)return Tn.web.getRandomValues(new Uint8Array(b));if(Tn.node){const{randomBytes:y}=Tn.node;return Uint8Array.from(y(b))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>gt.hashToPrivateKey(gt.randomBytes(m+8)),precompute(b=8,y=k.BASE){const w=y===k.BASE?y:new k(y.x,y.y);return w._setWindowSize(b),w.multiply(u),w},sha256:async(...b)=>{if(Tn.web){const y=await Tn.web.subtle.digest("SHA-256",T(...b));return new Uint8Array(y)}else if(Tn.node){const{createHash:y}=Tn.node,w=y("sha256");return b.forEach(I=>w.update(I)),Uint8Array.from(w.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(b,...y)=>{if(Tn.web){const w=await Tn.web.subtle.importKey("raw",b,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),I=T(...y),R=await Tn.web.subtle.sign("HMAC",w,I);return new Uint8Array(R)}else if(Tn.node){const{createHmac:w}=Tn.node,I=w("sha256",b);return y.forEach(R=>I.update(R)),Uint8Array.from(I.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(b,...y)=>{let w=Ir[b];if(w===void 0){const I=await gt.sha256(Uint8Array.from(b,R=>R.charCodeAt(0)));w=T(I,I),Ir[b]=w}return gt.sha256(w,...y)},taggedHashSync:(b,...y)=>{if(typeof Re!="function")throw new A("sha256Sync is undefined, you need to set it");let w=Ir[b];if(w===void 0){const I=Re(Uint8Array.from(b,R=>R.charCodeAt(0)));w=T(I,I),Ir[b]=w}return Re(w,...y)},_JacobianPoint:S};Object.defineProperties(gt,{sha256Sync:{configurable:!1,get(){return Re},set(b){Re||(Re=b)}},hmacSha256Sync:{configurable:!1,get(){return nt},set(b){nt||(nt=b)}}});var er={};Object.defineProperty(er,"__esModule",{value:!0}),er.sha224=er.sha256=void 0;var ho={};Object.defineProperty(ho,"__esModule",{value:!0}),ho.SHA2=void 0;var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.output=Fe.exists=Fe.hash=Fe.bytes=Fe.bool=Fe.number=void 0;function It(b){if(!Number.isSafeInteger(b)||b<0)throw new Error(`Wrong positive integer: ${b}`)}Fe.number=It;function Mt(b){if(typeof b!="boolean")throw new Error(`Expected boolean, not ${b}`)}Fe.bool=Mt;function hn(b,...y){if(!(b instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length>0&&!y.includes(b.length))throw new TypeError(`Expected Uint8Array of length ${y}, not of length=${b.length}`)}Fe.bytes=hn;function tn(b){if(typeof b!="function"||typeof b.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");It(b.outputLen),It(b.blockLen)}Fe.hash=tn;function Hn(b,y=!0){if(b.destroyed)throw new Error("Hash instance has been destroyed");if(y&&b.finished)throw new Error("Hash#digest() has already been called")}Fe.exists=Hn;function On(b,y){hn(b);const w=y.outputLen;if(b.length<w)throw new Error(`digestInto() expects output buffer of length at least ${w}`)}Fe.output=On;const Zr={number:It,bool:Mt,bytes:hn,hash:tn,exists:Hn,output:On};Fe.default=Zr;var Ie={};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.randomBytes=Ie.wrapConstructorWithOpts=Ie.wrapConstructor=Ie.checkOpts=Ie.Hash=Ie.concatBytes=Ie.toBytes=Ie.utf8ToBytes=Ie.asyncLoop=Ie.nextTick=Ie.hexToBytes=Ie.bytesToHex=Ie.isLE=Ie.rotr=Ie.createView=Ie.u32=Ie.u8=void 0;var Ii={};Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.crypto=void 0,Ii.crypto={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};const _l=b=>new Uint8Array(b.buffer,b.byteOffset,b.byteLength);Ie.u8=_l;const _g=b=>new Uint32Array(b.buffer,b.byteOffset,Math.floor(b.byteLength/4));Ie.u32=_g;const kg=b=>new DataView(b.buffer,b.byteOffset,b.byteLength);Ie.createView=kg;const Cg=(b,y)=>b<<32-y|b>>>y;if(Ie.rotr=Cg,Ie.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!Ie.isLE)throw new Error("Non little-endian hardware is not supported");const po=Array.from({length:256},(b,y)=>y.toString(16).padStart(2,"0"));function kl(b){if(!(b instanceof Uint8Array))throw new Error("Uint8Array expected");let y="";for(let w=0;w<b.length;w++)y+=po[b[w]];return y}Ie.bytesToHex=kl;function Pf(b){if(typeof b!="string")throw new TypeError("hexToBytes: expected string, got "+typeof b);if(b.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const y=new Uint8Array(b.length/2);for(let w=0;w<y.length;w++){const I=w*2,R=b.slice(I,I+2),H=Number.parseInt(R,16);if(Number.isNaN(H)||H<0)throw new Error("Invalid byte sequence");y[w]=H}return y}Ie.hexToBytes=Pf;const Tg=async()=>{};Ie.nextTick=Tg;async function Ig(b,y,w){let I=Date.now();for(let R=0;R<b;R++){w(R);const H=Date.now()-I;H>=0&&H<y||(await(0,Ie.nextTick)(),I+=H)}}Ie.asyncLoop=Ig;function Rf(b){if(typeof b!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof b}`);return new TextEncoder().encode(b)}Ie.utf8ToBytes=Rf;function jc(b){if(typeof b=="string"&&(b=Rf(b)),!(b instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof b})`);return b}Ie.toBytes=jc;function a8(...b){if(!b.every(I=>I instanceof Uint8Array))throw new Error("Uint8Array list expected");if(b.length===1)return b[0];const y=b.reduce((I,R)=>I+R.length,0),w=new Uint8Array(y);for(let I=0,R=0;I<b.length;I++){const H=b[I];w.set(H,R),R+=H.length}return w}Ie.concatBytes=a8;class l8{clone(){return this._cloneInto()}}Ie.Hash=l8;const c8=b=>Object.prototype.toString.call(b)==="[object Object]"&&b.constructor===Object;function u8(b,y){if(y!==void 0&&(typeof y!="object"||!c8(y)))throw new TypeError("Options should be object or undefined");return Object.assign(b,y)}Ie.checkOpts=u8;function f8(b){const y=I=>b().update(jc(I)).digest(),w=b();return y.outputLen=w.outputLen,y.blockLen=w.blockLen,y.create=()=>b(),y}Ie.wrapConstructor=f8;function d8(b){const y=(I,R)=>b(R).update(jc(I)).digest(),w=b({});return y.outputLen=w.outputLen,y.blockLen=w.blockLen,y.create=I=>b(I),y}Ie.wrapConstructorWithOpts=d8;function h8(b=32){if(Ii.crypto.web)return Ii.crypto.web.getRandomValues(new Uint8Array(b));if(Ii.crypto.node)return new Uint8Array(Ii.crypto.node.randomBytes(b).buffer);throw new Error("The environment doesn't have randomBytes function")}Ie.randomBytes=h8;function p8(b,y,w,I){if(typeof b.setBigUint64=="function")return b.setBigUint64(y,w,I);const R=BigInt(32),H=BigInt(4294967295),W=Number(w>>R&H),z=Number(w&H),ne=I?4:0,ce=I?0:4;b.setUint32(y+ne,W,I),b.setUint32(y+ce,z,I)}class g8 extends Ie.Hash{constructor(y,w,I,R){super(),this.blockLen=y,this.outputLen=w,this.padOffset=I,this.isLE=R,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(y),this.view=(0,Ie.createView)(this.buffer)}update(y){Fe.default.exists(this);const{view:w,buffer:I,blockLen:R}=this;y=(0,Ie.toBytes)(y);const H=y.length;for(let W=0;W<H;){const z=Math.min(R-this.pos,H-W);if(z===R){const ne=(0,Ie.createView)(y);for(;R<=H-W;W+=R)this.process(ne,W);continue}I.set(y.subarray(W,W+z),this.pos),this.pos+=z,W+=z,this.pos===R&&(this.process(w,0),this.pos=0)}return this.length+=y.length,this.roundClean(),this}digestInto(y){Fe.default.exists(this),Fe.default.output(y,this),this.finished=!0;const{buffer:w,view:I,blockLen:R,isLE:H}=this;let{pos:W}=this;w[W++]=128,this.buffer.subarray(W).fill(0),this.padOffset>R-W&&(this.process(I,0),W=0);for(let le=W;le<R;le++)w[le]=0;p8(I,R-8,BigInt(this.length*8),H),this.process(I,0);const z=(0,Ie.createView)(y),ne=this.outputLen;if(ne%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const ce=ne/4,re=this.get();if(ce>re.length)throw new Error("_sha2: outputLen bigger than state");for(let le=0;le<ce;le++)z.setUint32(4*le,re[le],H)}digest(){const{buffer:y,outputLen:w}=this;this.digestInto(y);const I=y.slice(0,w);return this.destroy(),I}_cloneInto(y){y||(y=new this.constructor),y.set(...this.get());const{blockLen:w,buffer:I,length:R,finished:H,destroyed:W,pos:z}=this;return y.length=R,y.pos=z,y.finished=H,y.destroyed=W,R%w&&y.buffer.set(I),y}}ho.SHA2=g8;const m8=(b,y,w)=>b&y^~b&w,y8=(b,y,w)=>b&y^b&w^y&w,b8=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),go=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),mo=new Uint32Array(64);class m1 extends ho.SHA2{constructor(){super(64,32,8,!1),this.A=go[0]|0,this.B=go[1]|0,this.C=go[2]|0,this.D=go[3]|0,this.E=go[4]|0,this.F=go[5]|0,this.G=go[6]|0,this.H=go[7]|0}get(){const{A:y,B:w,C:I,D:R,E:H,F:W,G:z,H:ne}=this;return[y,w,I,R,H,W,z,ne]}set(y,w,I,R,H,W,z,ne){this.A=y|0,this.B=w|0,this.C=I|0,this.D=R|0,this.E=H|0,this.F=W|0,this.G=z|0,this.H=ne|0}process(y,w){for(let le=0;le<16;le++,w+=4)mo[le]=y.getUint32(w,!1);for(let le=16;le<64;le++){const V=mo[le-15],K=mo[le-2],ee=(0,Ie.rotr)(V,7)^(0,Ie.rotr)(V,18)^V>>>3,oe=(0,Ie.rotr)(K,17)^(0,Ie.rotr)(K,19)^K>>>10;mo[le]=oe+mo[le-7]+ee+mo[le-16]|0}let{A:I,B:R,C:H,D:W,E:z,F:ne,G:ce,H:re}=this;for(let le=0;le<64;le++){const V=(0,Ie.rotr)(z,6)^(0,Ie.rotr)(z,11)^(0,Ie.rotr)(z,25),K=re+V+m8(z,ne,ce)+b8[le]+mo[le]|0,oe=((0,Ie.rotr)(I,2)^(0,Ie.rotr)(I,13)^(0,Ie.rotr)(I,22))+y8(I,R,H)|0;re=ce,ce=ne,ne=z,z=W+K|0,W=H,H=R,R=I,I=K+oe|0}I=I+this.A|0,R=R+this.B|0,H=H+this.C|0,W=W+this.D|0,z=z+this.E|0,ne=ne+this.F|0,ce=ce+this.G|0,re=re+this.H|0,this.set(I,R,H,W,z,ne,ce,re)}roundClean(){mo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class v8 extends m1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}er.sha256=(0,Ie.wrapConstructor)(()=>new m1),er.sha224=(0,Ie.wrapConstructor)(()=>new v8);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ta(b){if(!Number.isSafeInteger(b))throw new Error(`Wrong integer: ${b}`)}function Oi(...b){const y=(R,H)=>W=>R(H(W)),w=Array.from(b).reverse().reduce((R,H)=>R?y(R,H.encode):H.encode,void 0),I=b.reduce((R,H)=>R?y(R,H.decode):H.decode,void 0);return{encode:w,decode:I}}function zi(b){return{encode:y=>{if(!Array.isArray(y)||y.length&&typeof y[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return y.map(w=>{if(Ta(w),w<0||w>=b.length)throw new Error(`Digit index outside alphabet: ${w} (alphabet: ${b.length})`);return b[w]})},decode:y=>{if(!Array.isArray(y)||y.length&&typeof y[0]!="string")throw new Error("alphabet.decode input should be array of strings");return y.map(w=>{if(typeof w!="string")throw new Error(`alphabet.decode: not string element=${w}`);const I=b.indexOf(w);if(I===-1)throw new Error(`Unknown letter: "${w}". Allowed: ${b}`);return I})}}}function ji(b=""){if(typeof b!="string")throw new Error("join separator should be string");return{encode:y=>{if(!Array.isArray(y)||y.length&&typeof y[0]!="string")throw new Error("join.encode input should be array of strings");for(let w of y)if(typeof w!="string")throw new Error(`join.encode: non-string input=${w}`);return y.join(b)},decode:y=>{if(typeof y!="string")throw new Error("join.decode input should be string");return y.split(b)}}}function Vc(b,y="="){if(Ta(b),typeof y!="string")throw new Error("padding chr should be string");return{encode(w){if(!Array.isArray(w)||w.length&&typeof w[0]!="string")throw new Error("padding.encode input should be array of strings");for(let I of w)if(typeof I!="string")throw new Error(`padding.encode: non-string input=${I}`);for(;w.length*b%8;)w.push(y);return w},decode(w){if(!Array.isArray(w)||w.length&&typeof w[0]!="string")throw new Error("padding.encode input should be array of strings");for(let R of w)if(typeof R!="string")throw new Error(`padding.decode: non-string input=${R}`);let I=w.length;if(I*b%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;I>0&&w[I-1]===y;I--)if(!((I-1)*b%8))throw new Error("Invalid padding: string has too much padding");return w.slice(0,I)}}}function y1(b){if(typeof b!="function")throw new Error("normalize fn should be function");return{encode:y=>y,decode:y=>b(y)}}function b1(b,y,w){if(y<2)throw new Error(`convertRadix: wrong from=${y}, base cannot be less than 2`);if(w<2)throw new Error(`convertRadix: wrong to=${w}, base cannot be less than 2`);if(!Array.isArray(b))throw new Error("convertRadix: data should be array");if(!b.length)return[];let I=0;const R=[],H=Array.from(b);for(H.forEach(W=>{if(Ta(W),W<0||W>=y)throw new Error(`Wrong integer: ${W}`)});;){let W=0,z=!0;for(let ne=I;ne<H.length;ne++){const ce=H[ne],re=y*W+ce;if(!Number.isSafeInteger(re)||y*W/y!==W||re-ce!==y*W)throw new Error("convertRadix: carry overflow");if(W=re%w,H[ne]=Math.floor(re/w),!Number.isSafeInteger(H[ne])||H[ne]*w+W!==re)throw new Error("convertRadix: carry overflow");if(z)H[ne]?z=!1:I=ne;else continue}if(R.push(W),z)break}for(let W=0;W<b.length-1&&b[W]===0;W++)R.push(0);return R.reverse()}const v1=(b,y)=>y?v1(y,b%y):b,Df=(b,y)=>b+(y-v1(b,y));function Og(b,y,w,I){if(!Array.isArray(b))throw new Error("convertRadix2: data should be array");if(y<=0||y>32)throw new Error(`convertRadix2: wrong from=${y}`);if(w<=0||w>32)throw new Error(`convertRadix2: wrong to=${w}`);if(Df(y,w)>32)throw new Error(`convertRadix2: carry overflow from=${y} to=${w} carryBits=${Df(y,w)}`);let R=0,H=0;const W=2**w-1,z=[];for(const ne of b){if(Ta(ne),ne>=2**y)throw new Error(`convertRadix2: invalid data word=${ne} from=${y}`);if(R=R<<y|ne,H+y>32)throw new Error(`convertRadix2: carry overflow pos=${H} from=${y}`);for(H+=y;H>=w;H-=w)z.push((R>>H-w&W)>>>0);R&=2**H-1}if(R=R<<w-H&W,!I&&H>=y)throw new Error("Excess padding");if(!I&&R)throw new Error(`Non-zero padding: ${R}`);return I&&H>0&&z.push(R>>>0),z}function w1(b){return Ta(b),{encode:y=>{if(!(y instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return b1(Array.from(y),256,b)},decode:y=>{if(!Array.isArray(y)||y.length&&typeof y[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(b1(y,b,256))}}}function xs(b,y=!1){if(Ta(b),b<=0||b>32)throw new Error("radix2: bits should be in (0..32]");if(Df(8,b)>32||Df(b,8)>32)throw new Error("radix2: carry overflow");return{encode:w=>{if(!(w instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Og(Array.from(w),8,b,!y)},decode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Og(w,b,8,y))}}}function E1(b){if(typeof b!="function")throw new Error("unsafeWrapper fn should be function");return function(...y){try{return b.apply(null,y)}catch{}}}function x1(b,y){if(Ta(b),typeof y!="function")throw new Error("checksum fn should be function");return{encode(w){if(!(w instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const I=y(w).slice(0,b),R=new Uint8Array(w.length+b);return R.set(w),R.set(I,w.length),R},decode(w){if(!(w instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const I=w.slice(0,-b),R=y(I).slice(0,b),H=w.slice(-b);for(let W=0;W<b;W++)if(R[W]!==H[W])throw new Error("Invalid checksum");return I}}}const Bf={alphabet:zi,chain:Oi,checksum:x1,radix:w1,radix2:xs,join:ji,padding:Vc},w8=Oi(xs(4),zi("0123456789ABCDEF"),ji("")),E8=Oi(xs(5),zi("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Vc(5),ji(""));Oi(xs(5),zi("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Vc(5),ji("")),Oi(xs(5),zi("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ji(""),y1(b=>b.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const qc=Oi(xs(6),zi("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Vc(6),ji("")),x8=Oi(xs(6),zi("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Vc(6),ji("")),Mg=b=>Oi(w1(58),zi(b),ji("")),Uf=Mg("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Mg("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Mg("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const S1=[0,2,3,5,6,7,9,10,11],S8={encode(b){let y="";for(let w=0;w<b.length;w+=8){const I=b.subarray(w,w+8);y+=Uf.encode(I).padStart(S1[I.length],"1")}return y},decode(b){let y=[];for(let w=0;w<b.length;w+=11){const I=b.slice(w,w+11),R=S1.indexOf(I.length),H=Uf.decode(I);for(let W=0;W<H.length-R;W++)if(H[W]!==0)throw new Error("base58xmr: wrong padding");y=y.concat(Array.from(H.slice(H.length-R)))}return Uint8Array.from(y)}},A8=b=>Oi(x1(4,y=>b(b(y))),Uf),Lg=Oi(zi("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ji("")),A1=[996825010,642813549,513874426,1027748829,705979059];function Wc(b){const y=b>>25;let w=(b&33554431)<<5;for(let I=0;I<A1.length;I++)(y>>I&1)===1&&(w^=A1[I]);return w}function _1(b,y,w=1){const I=b.length;let R=1;for(let H=0;H<I;H++){const W=b.charCodeAt(H);if(W<33||W>126)throw new Error(`Invalid prefix (${b})`);R=Wc(R)^W>>5}R=Wc(R);for(let H=0;H<I;H++)R=Wc(R)^b.charCodeAt(H)&31;for(let H of y)R=Wc(R)^H;for(let H=0;H<6;H++)R=Wc(R);return R^=w,Lg.encode(Og([R%2**30],30,5,!1))}function k1(b){const y=b==="bech32"?1:734539939,w=xs(5),I=w.decode,R=w.encode,H=E1(I);function W(re,le,V=90){if(typeof re!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof re}`);if(!Array.isArray(le)||le.length&&typeof le[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof le}`);const K=re.length+7+le.length;if(V!==!1&&K>V)throw new TypeError(`Length ${K} exceeds limit ${V}`);return re=re.toLowerCase(),`${re}1${Lg.encode(le)}${_1(re,le,y)}`}function z(re,le=90){if(typeof re!="string")throw new Error(`bech32.decode input should be string, not ${typeof re}`);if(re.length<8||le!==!1&&re.length>le)throw new TypeError(`Wrong string length: ${re.length} (${re}). Expected (8..${le})`);const V=re.toLowerCase();if(re!==V&&re!==re.toUpperCase())throw new Error("String must be lowercase or uppercase");re=V;const K=re.lastIndexOf("1");if(K===0||K===-1)throw new Error('Letter "1" must be present between prefix and data only');const ee=re.slice(0,K),oe=re.slice(K+1);if(oe.length<6)throw new Error("Data must be at least 6 characters long");const he=Lg.decode(oe).slice(0,-6),ge=_1(ee,he,y);if(!oe.endsWith(ge))throw new Error(`Invalid checksum in ${re}: expected "${ge}"`);return{prefix:ee,words:he}}const ne=E1(z);function ce(re){const{prefix:le,words:V}=z(re,!1);return{prefix:le,words:V,bytes:I(V)}}return{encode:W,decode:z,decodeToBytes:ce,decodeUnsafe:ne,fromWords:I,fromWordsUnsafe:H,toWords:R}}const Or=k1("bech32");k1("bech32m");const _8={encode:b=>new TextDecoder().decode(b),decode:b=>new TextEncoder().encode(b)},k8=Oi(xs(4),zi("0123456789abcdef"),ji(""),y1(b=>{if(typeof b!="string"||b.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof b} with length ${b.length}`);return b.toLowerCase()}));`${Object.keys({utf8:_8,hex:k8,base16:w8,base32:E8,base64:qc,base64url:x8,base58:Uf,base58xmr:S8}).join(", ")}`;var Kc={};Object.defineProperty(Kc,"__esModule",{value:!0}),Kc.wordlist=void 0,Kc.wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);var tr={};Object.defineProperty(tr,"__esModule",{value:!0}),tr.mnemonicToSeedSync=tr.mnemonicToSeed=tr.validateMnemonic=tr.entropyToMnemonic=tr.mnemonicToEntropy=tr.generateMnemonic=void 0;var Ia={};Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.pbkdf2Async=Ia.pbkdf2=void 0;var Ss={};Object.defineProperty(Ss,"__esModule",{value:!0}),Ss.hmac=void 0;class C1 extends Ie.Hash{constructor(y,w){super(),this.finished=!1,this.destroyed=!1,Fe.default.hash(y);const I=(0,Ie.toBytes)(w);if(this.iHash=y.create(),typeof this.iHash.update!="function")throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const R=this.blockLen,H=new Uint8Array(R);H.set(I.length>R?y.create().update(I).digest():I);for(let W=0;W<H.length;W++)H[W]^=54;this.iHash.update(H),this.oHash=y.create();for(let W=0;W<H.length;W++)H[W]^=106;this.oHash.update(H),H.fill(0)}update(y){return Fe.default.exists(this),this.iHash.update(y),this}digestInto(y){Fe.default.exists(this),Fe.default.bytes(y,this.outputLen),this.finished=!0,this.iHash.digestInto(y),this.oHash.update(y),this.oHash.digestInto(y),this.destroy()}digest(){const y=new Uint8Array(this.oHash.outputLen);return this.digestInto(y),y}_cloneInto(y){y||(y=Object.create(Object.getPrototypeOf(this),{}));const{oHash:w,iHash:I,finished:R,destroyed:H,blockLen:W,outputLen:z}=this;return y.finished=R,y.destroyed=H,y.blockLen=W,y.outputLen=z,y.oHash=w._cloneInto(y.oHash),y.iHash=I._cloneInto(y.iHash),y}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const C8=(b,y,w)=>new C1(b,y).update(w).digest();Ss.hmac=C8,Ss.hmac.create=(b,y)=>new C1(b,y);function T1(b,y,w,I){Fe.default.hash(b);const R=(0,Ie.checkOpts)({dkLen:32,asyncTick:10},I),{c:H,dkLen:W,asyncTick:z}=R;if(Fe.default.number(H),Fe.default.number(W),Fe.default.number(z),H<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const ne=(0,Ie.toBytes)(y),ce=(0,Ie.toBytes)(w),re=new Uint8Array(W),le=Ss.hmac.create(b,ne),V=le._cloneInto().update(ce);return{c:H,dkLen:W,asyncTick:z,DK:re,PRF:le,PRFSalt:V}}function I1(b,y,w,I,R){return b.destroy(),y.destroy(),I&&I.destroy(),R.fill(0),w}function T8(b,y,w,I){const{c:R,dkLen:H,DK:W,PRF:z,PRFSalt:ne}=T1(b,y,w,I);let ce;const re=new Uint8Array(4),le=(0,Ie.createView)(re),V=new Uint8Array(z.outputLen);for(let K=1,ee=0;ee<H;K++,ee+=z.outputLen){const oe=W.subarray(ee,ee+z.outputLen);le.setInt32(0,K,!1),(ce=ne._cloneInto(ce)).update(re).digestInto(V),oe.set(V.subarray(0,oe.length));for(let he=1;he<R;he++){z._cloneInto(ce).update(V).digestInto(V);for(let ge=0;ge<oe.length;ge++)oe[ge]^=V[ge]}}return I1(z,ne,W,ce,V)}Ia.pbkdf2=T8;async function I8(b,y,w,I){const{c:R,dkLen:H,asyncTick:W,DK:z,PRF:ne,PRFSalt:ce}=T1(b,y,w,I);let re;const le=new Uint8Array(4),V=(0,Ie.createView)(le),K=new Uint8Array(ne.outputLen);for(let ee=1,oe=0;oe<H;ee++,oe+=ne.outputLen){const he=z.subarray(oe,oe+ne.outputLen);V.setInt32(0,ee,!1),(re=ce._cloneInto(re)).update(le).digestInto(K),he.set(K.subarray(0,he.length)),await(0,Ie.asyncLoop)(R-1,W,ge=>{ne._cloneInto(re).update(K).digestInto(K);for(let Le=0;Le<he.length;Le++)he[Le]^=K[Le]})}return I1(ne,ce,z,re,K)}Ia.pbkdf2Async=I8;var vr={};Object.defineProperty(vr,"__esModule",{value:!0}),vr.sha384=vr.sha512_256=vr.sha512_224=vr.sha512=vr.SHA512=void 0;var lt={};Object.defineProperty(lt,"__esModule",{value:!0}),lt.add=lt.toBig=lt.split=lt.fromBig=void 0;const Hf=BigInt(2**32-1),$g=BigInt(32);function Ng(b,y=!1){return y?{h:Number(b&Hf),l:Number(b>>$g&Hf)}:{h:Number(b>>$g&Hf)|0,l:Number(b&Hf)|0}}lt.fromBig=Ng;function O1(b,y=!1){let w=new Uint32Array(b.length),I=new Uint32Array(b.length);for(let R=0;R<b.length;R++){const{h:H,l:W}=Ng(b[R],y);[w[R],I[R]]=[H,W]}return[w,I]}lt.split=O1;const O8=(b,y)=>BigInt(b>>>0)<<$g|BigInt(y>>>0);lt.toBig=O8;const M8=(b,y,w)=>b>>>w,L8=(b,y,w)=>b<<32-w|y>>>w,$8=(b,y,w)=>b>>>w|y<<32-w,N8=(b,y,w)=>b<<32-w|y>>>w,P8=(b,y,w)=>b<<64-w|y>>>w-32,R8=(b,y,w)=>b>>>w-32|y<<64-w,D8=(b,y)=>y,B8=(b,y)=>b,U8=(b,y,w)=>b<<w|y>>>32-w,H8=(b,y,w)=>y<<w|b>>>32-w,F8=(b,y,w)=>y<<w-32|b>>>64-w,z8=(b,y,w)=>b<<w-32|y>>>64-w;function M1(b,y,w,I){const R=(y>>>0)+(I>>>0);return{h:b+w+(R/2**32|0)|0,l:R|0}}lt.add=M1;const j8=(b,y,w)=>(b>>>0)+(y>>>0)+(w>>>0),V8=(b,y,w,I)=>y+w+I+(b/2**32|0)|0,q8=(b,y,w,I)=>(b>>>0)+(y>>>0)+(w>>>0)+(I>>>0),W8=(b,y,w,I,R)=>y+w+I+R+(b/2**32|0)|0,K8=(b,y,w,I,R)=>(b>>>0)+(y>>>0)+(w>>>0)+(I>>>0)+(R>>>0),G8=(b,y,w,I,R,H)=>y+w+I+R+H+(b/2**32|0)|0,Z8={fromBig:Ng,split:O1,toBig:lt.toBig,shrSH:M8,shrSL:L8,rotrSH:$8,rotrSL:N8,rotrBH:P8,rotrBL:R8,rotr32H:D8,rotr32L:B8,rotlSH:U8,rotlSL:H8,rotlBH:F8,rotlBL:z8,add:M1,add3L:j8,add3H:V8,add4L:q8,add4H:W8,add5H:G8,add5L:K8};lt.default=Z8;const[Y8,J8]=lt.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(b=>BigInt(b))),yo=new Uint32Array(80),bo=new Uint32Array(80);class Gc extends ho.SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:y,Al:w,Bh:I,Bl:R,Ch:H,Cl:W,Dh:z,Dl:ne,Eh:ce,El:re,Fh:le,Fl:V,Gh:K,Gl:ee,Hh:oe,Hl:he}=this;return[y,w,I,R,H,W,z,ne,ce,re,le,V,K,ee,oe,he]}set(y,w,I,R,H,W,z,ne,ce,re,le,V,K,ee,oe,he){this.Ah=y|0,this.Al=w|0,this.Bh=I|0,this.Bl=R|0,this.Ch=H|0,this.Cl=W|0,this.Dh=z|0,this.Dl=ne|0,this.Eh=ce|0,this.El=re|0,this.Fh=le|0,this.Fl=V|0,this.Gh=K|0,this.Gl=ee|0,this.Hh=oe|0,this.Hl=he|0}process(y,w){for(let Ae=0;Ae<16;Ae++,w+=4)yo[Ae]=y.getUint32(w),bo[Ae]=y.getUint32(w+=4);for(let Ae=16;Ae<80;Ae++){const ze=yo[Ae-15]|0,Pe=bo[Ae-15]|0,Ne=lt.default.rotrSH(ze,Pe,1)^lt.default.rotrSH(ze,Pe,8)^lt.default.shrSH(ze,Pe,7),Ve=lt.default.rotrSL(ze,Pe,1)^lt.default.rotrSL(ze,Pe,8)^lt.default.shrSL(ze,Pe,7),Xe=yo[Ae-2]|0,Pt=bo[Ae-2]|0,Y=lt.default.rotrSH(Xe,Pt,19)^lt.default.rotrBH(Xe,Pt,61)^lt.default.shrSH(Xe,Pt,6),Q=lt.default.rotrSL(Xe,Pt,19)^lt.default.rotrBL(Xe,Pt,61)^lt.default.shrSL(Xe,Pt,6),G=lt.default.add4L(Ve,Q,bo[Ae-7],bo[Ae-16]),ie=lt.default.add4H(G,Ne,Y,yo[Ae-7],yo[Ae-16]);yo[Ae]=ie|0,bo[Ae]=G|0}let{Ah:I,Al:R,Bh:H,Bl:W,Ch:z,Cl:ne,Dh:ce,Dl:re,Eh:le,El:V,Fh:K,Fl:ee,Gh:oe,Gl:he,Hh:ge,Hl:Le}=this;for(let Ae=0;Ae<80;Ae++){const ze=lt.default.rotrSH(le,V,14)^lt.default.rotrSH(le,V,18)^lt.default.rotrBH(le,V,41),Pe=lt.default.rotrSL(le,V,14)^lt.default.rotrSL(le,V,18)^lt.default.rotrBL(le,V,41),Ne=le&K^~le&oe,Ve=V&ee^~V&he,Xe=lt.default.add5L(Le,Pe,Ve,J8[Ae],bo[Ae]),Pt=lt.default.add5H(Xe,ge,ze,Ne,Y8[Ae],yo[Ae]),Y=Xe|0,Q=lt.default.rotrSH(I,R,28)^lt.default.rotrBH(I,R,34)^lt.default.rotrBH(I,R,39),G=lt.default.rotrSL(I,R,28)^lt.default.rotrBL(I,R,34)^lt.default.rotrBL(I,R,39),ie=I&H^I&z^H&z,fe=R&W^R&ne^W&ne;ge=oe|0,Le=he|0,oe=K|0,he=ee|0,K=le|0,ee=V|0,{h:le,l:V}=lt.default.add(ce|0,re|0,Pt|0,Y|0),ce=z|0,re=ne|0,z=H|0,ne=W|0,H=I|0,W=R|0;const xe=lt.default.add3L(Y,G,fe);I=lt.default.add3H(xe,Pt,Q,ie),R=xe|0}({h:I,l:R}=lt.default.add(this.Ah|0,this.Al|0,I|0,R|0)),{h:H,l:W}=lt.default.add(this.Bh|0,this.Bl|0,H|0,W|0),{h:z,l:ne}=lt.default.add(this.Ch|0,this.Cl|0,z|0,ne|0),{h:ce,l:re}=lt.default.add(this.Dh|0,this.Dl|0,ce|0,re|0),{h:le,l:V}=lt.default.add(this.Eh|0,this.El|0,le|0,V|0),{h:K,l:ee}=lt.default.add(this.Fh|0,this.Fl|0,K|0,ee|0),{h:oe,l:he}=lt.default.add(this.Gh|0,this.Gl|0,oe|0,he|0),{h:ge,l:Le}=lt.default.add(this.Hh|0,this.Hl|0,ge|0,Le|0),this.set(I,R,H,W,z,ne,ce,re,le,V,K,ee,oe,he,ge,Le)}roundClean(){yo.fill(0),bo.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}vr.SHA512=Gc;class X8 extends Gc{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class Q8 extends Gc{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class eO extends Gc{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}vr.sha512=(0,Ie.wrapConstructor)(()=>new Gc),vr.sha512_224=(0,Ie.wrapConstructor)(()=>new X8),vr.sha512_256=(0,Ie.wrapConstructor)(()=>new Q8),vr.sha384=(0,Ie.wrapConstructor)(()=>new eO);const tO=b=>b[0]==="あいこくしん";function L1(b){if(typeof b!="string")throw new TypeError(`Invalid mnemonic type: ${typeof b}`);return b.normalize("NFKD")}function Pg(b){const y=L1(b),w=y.split(" ");if(![12,15,18,21,24].includes(w.length))throw new Error("Invalid mnemonic");return{nfkd:y,words:w}}function $1(b){Fe.default.bytes(b,16,20,24,28,32)}function nO(b,y=128){if(Fe.default.number(y),y%32!==0||y>256)throw new TypeError("Invalid entropy");return R1((0,Ie.randomBytes)(y/8),b)}tr.generateMnemonic=nO;const rO=b=>{const y=8-b.length/4;return new Uint8Array([(0,er.sha256)(b)[0]>>y<<y])};function N1(b){if(!Array.isArray(b)||b.length!==2048||typeof b[0]!="string")throw new Error("Worlist: expected array of 2048 strings");return b.forEach(y=>{if(typeof y!="string")throw new Error(`Wordlist: non-string element: ${y}`)}),Bf.chain(Bf.checksum(1,rO),Bf.radix2(11,!0),Bf.alphabet(b))}function P1(b,y){const{words:w}=Pg(b),I=N1(y).decode(w);return $1(I),I}tr.mnemonicToEntropy=P1;function R1(b,y){return $1(b),N1(y).encode(b).join(tO(y)?"　":" ")}tr.entropyToMnemonic=R1;function iO(b,y){try{P1(b,y)}catch{return!1}return!0}tr.validateMnemonic=iO;const D1=b=>L1(`mnemonic${b}`);function sO(b,y=""){return(0,Ia.pbkdf2Async)(vr.sha512,Pg(b).nfkd,D1(y),{c:2048,dkLen:64})}tr.mnemonicToSeed=sO;function oO(b,y=""){return(0,Ia.pbkdf2)(vr.sha512,Pg(b).nfkd,D1(y),{c:2048,dkLen:64})}tr.mnemonicToSeedSync=oO;var Cl={};Object.defineProperty(Cl,"__esModule",{value:!0}),Cl.ripemd160=Cl.RIPEMD160=void 0;const aO=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),B1=Uint8Array.from({length:16},(b,y)=>y),lO=B1.map(b=>(9*b+5)%16);let Rg=[B1],Dg=[lO];for(let b=0;b<4;b++)for(let y of[Rg,Dg])y.push(y[b].map(w=>aO[w]));const U1=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(b=>new Uint8Array(b)),cO=Rg.map((b,y)=>b.map(w=>U1[y][w])),uO=Dg.map((b,y)=>b.map(w=>U1[y][w])),fO=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),dO=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),Ff=(b,y)=>b<<y|b>>>32-y;function H1(b,y,w,I){return b===0?y^w^I:b===1?y&w|~y&I:b===2?(y|~w)^I:b===3?y&I|w&~I:y^(w|~I)}const zf=new Uint32Array(16);class F1 extends ho.SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:y,h1:w,h2:I,h3:R,h4:H}=this;return[y,w,I,R,H]}set(y,w,I,R,H){this.h0=y|0,this.h1=w|0,this.h2=I|0,this.h3=R|0,this.h4=H|0}process(y,w){for(let K=0;K<16;K++,w+=4)zf[K]=y.getUint32(w,!0);let I=this.h0|0,R=I,H=this.h1|0,W=H,z=this.h2|0,ne=z,ce=this.h3|0,re=ce,le=this.h4|0,V=le;for(let K=0;K<5;K++){const ee=4-K,oe=fO[K],he=dO[K],ge=Rg[K],Le=Dg[K],Ae=cO[K],ze=uO[K];for(let Pe=0;Pe<16;Pe++){const Ne=Ff(I+H1(K,H,z,ce)+zf[ge[Pe]]+oe,Ae[Pe])+le|0;I=le,le=ce,ce=Ff(z,10)|0,z=H,H=Ne}for(let Pe=0;Pe<16;Pe++){const Ne=Ff(R+H1(ee,W,ne,re)+zf[Le[Pe]]+he,ze[Pe])+V|0;R=V,V=re,re=Ff(ne,10)|0,ne=W,W=Ne}}this.set(this.h1+z+re|0,this.h2+ce+V|0,this.h3+le+R|0,this.h4+I+W|0,this.h0+H+ne|0)}roundClean(){zf.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}Cl.RIPEMD160=F1,Cl.ripemd160=(0,Ie.wrapConstructor)(()=>new F1),gt.hmacSha256Sync=(b,...y)=>(0,Ss.hmac)(er.sha256,b,gt.concatBytes(...y));const Bg=A8(er.sha256);function z1(b){return BigInt(`0x${(0,Ie.bytesToHex)(b)}`)}function hO(b){return(0,Ie.hexToBytes)(b.toString(16).padStart(64,"0"))}const pO=(0,Ie.utf8ToBytes)("Bitcoin seed"),Ug={private:76066276,public:76067358},Hg=2147483648,gO=b=>(0,Cl.ripemd160)((0,er.sha256)(b)),mO=b=>(0,Ie.createView)(b).getUint32(0,!1),jf=b=>{if(!Number.isSafeInteger(b)||b<0||b>2**32-1)throw new Error(`Invalid number=${b}. Should be from 0 to 2 ** 32 - 1`);const y=new Uint8Array(4);return(0,Ie.createView)(y).setUint32(0,b,!1),y};class Oa{constructor(y){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!y||typeof y!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=y.versions||Ug,this.depth=y.depth||0,this.chainCode=y.chainCode,this.index=y.index||0,this.parentFingerprint=y.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(y.publicKey&&y.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(y.privateKey){if(!gt.isValidPrivateKey(y.privateKey))throw new Error("Invalid private key");this.privKey=typeof y.privateKey=="bigint"?y.privateKey:z1(y.privateKey),this.privKeyBytes=hO(this.privKey),this.pubKey=Be(y.privateKey,!0)}else if(y.publicKey)this.pubKey=k.fromHex(y.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=gO(this.pubKey)}get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return mO(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const y=this.privateKey;if(!y)throw new Error("No private key");return Bg.encode(this.serialize(this.versions.private,(0,Ie.concatBytes)(new Uint8Array([0]),y)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return Bg.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(y,w=Ug){if((0,Fe.bytes)(y),8*y.length<128||8*y.length>512)throw new Error(`HDKey: wrong seed length=${y.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const I=(0,Ss.hmac)(vr.sha512,pO,y);return new Oa({versions:w,chainCode:I.slice(32),privateKey:I.slice(0,32)})}static fromExtendedKey(y,w=Ug){const I=Bg.decode(y),R=(0,Ie.createView)(I),H=R.getUint32(0,!1),W={versions:w,depth:I[4],parentFingerprint:R.getUint32(5,!1),index:R.getUint32(9,!1),chainCode:I.slice(13,45)},z=I.slice(45),ne=z[0]===0;if(H!==w[ne?"private":"public"])throw new Error("Version mismatch");return ne?new Oa({...W,privateKey:z.slice(1)}):new Oa({...W,publicKey:z})}static fromJSON(y){return Oa.fromExtendedKey(y.xpriv)}derive(y){if(!/^[mM]'?/.test(y))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(y))return this;const w=y.replace(/^[mM]'?\//,"").split("/");let I=this;for(const R of w){const H=/^(\d+)('?)$/.exec(R);if(!H||H.length!==3)throw new Error(`Invalid child index: ${R}`);let W=+H[1];if(!Number.isSafeInteger(W)||W>=Hg)throw new Error("Invalid index");H[2]==="'"&&(W+=Hg),I=I.deriveChild(W)}return I}deriveChild(y){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let w=jf(y);if(y>=Hg){const z=this.privateKey;if(!z)throw new Error("Could not derive hardened child key");w=(0,Ie.concatBytes)(new Uint8Array([0]),z,w)}else w=(0,Ie.concatBytes)(this.pubKey,w);const I=(0,Ss.hmac)(vr.sha512,this.chainCode,w),R=z1(I.slice(0,32)),H=I.slice(32);if(!gt.isValidPrivateKey(R))throw new Error("Tweak bigger than curve order");const W={versions:this.versions,chainCode:H,depth:this.depth+1,parentFingerprint:this.fingerprint,index:y};try{if(this.privateKey){const z=gt.mod(this.privKey+R,d.n);if(!gt.isValidPrivateKey(z))throw new Error("The tweak was out of range or the resulted private key is invalid");W.privateKey=z}else{const z=k.fromHex(this.pubKey).add(k.fromPrivateKey(R));if(z.equals(k.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");W.publicKey=z.toRawBytes(!0)}return new Oa(W)}catch{return this.deriveChild(y+1)}}sign(y){if(!this.privateKey)throw new Error("No privateKey set!");return(0,Fe.bytes)(y,32),xt(y,this.privKey,{canonical:!0,der:!1})}verify(y,w){if((0,Fe.bytes)(y,32),(0,Fe.bytes)(w,64),!this.publicKey)throw new Error("No publicKey set!");let I;try{I=M.fromCompact(w)}catch{return!1}return Cn(I,y,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(y,w){if(!this.chainCode)throw new Error("No chainCode set");return(0,Fe.bytes)(w,33),(0,Ie.concatBytes)(jf(y),new Uint8Array([this.depth]),jf(this.parentFingerprint),jf(this.index),this.chainCode,w)}}var yO=Object.defineProperty,Mr=(b,y)=>{for(var w in y)yO(b,w,{get:y[w],enumerable:!0})};function bO(){return gt.bytesToHex(gt.randomPrivateKey())}function j1(b){return gt.bytesToHex(Tr.getPublicKey(b))}var vO={};Mr(vO,{insertEventIntoAscendingList:()=>EO,insertEventIntoDescendingList:()=>wO,normalizeURL:()=>Fg,utf8Decoder:()=>vo,utf8Encoder:()=>Vi});var vo=new TextDecoder("utf-8"),Vi=new TextEncoder;function Fg(b){let y=new URL(b);return y.pathname=y.pathname.replace(/\/+/g,"/"),y.pathname.endsWith("/")&&(y.pathname=y.pathname.slice(0,-1)),(y.port==="80"&&y.protocol==="ws:"||y.port==="443"&&y.protocol==="wss:")&&(y.port=""),y.searchParams.sort(),y.hash="",y.toString()}function wO(b,y){let w=0,I=b.length-1,R,H=w;if(I<0)H=0;else if(y.created_at<b[I].created_at)H=I+1;else if(y.created_at>=b[w].created_at)H=w;else for(;;){if(I<=w+1){H=I;break}if(R=Math.floor(w+(I-w)/2),b[R].created_at>y.created_at)w=R;else if(b[R].created_at<y.created_at)I=R;else{H=R;break}}return b[H]?.id!==y.id?[...b.slice(0,H),y,...b.slice(H)]:b}function EO(b,y){let w=0,I=b.length-1,R,H=w;if(I<0)H=0;else if(y.created_at>b[I].created_at)H=I+1;else if(y.created_at<=b[w].created_at)H=w;else for(;;){if(I<=w+1){H=I;break}if(R=Math.floor(w+(I-w)/2),b[R].created_at<y.created_at)w=R;else if(b[R].created_at>y.created_at)I=R;else{H=R;break}}return b[H]?.id!==y.id?[...b.slice(0,H),y,...b.slice(H)]:b}function xO(b,y){let w=b;return w.pubkey=j1(y),w.id=zg(w),w.sig=_O(w,y),w}function SO(b){if(!jg(b))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,b.pubkey,b.created_at,b.kind,b.tags,b.content])}function zg(b){let y=(0,er.sha256)(Vi.encode(SO(b)));return gt.bytesToHex(y)}var AO=b=>b instanceof Object;function jg(b){if(!AO(b)||typeof b.kind!="number"||typeof b.content!="string"||typeof b.created_at!="number"||typeof b.pubkey!="string"||!b.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(b.tags))return!1;for(let y=0;y<b.tags.length;y++){let w=b.tags[y];if(!Array.isArray(w))return!1;for(let I=0;I<w.length;I++)if(typeof w[I]=="object")return!1}return!0}function V1(b){return Tr.verifySync(b.sig,zg(b),b.pubkey)}function _O(b,y){return gt.bytesToHex(Tr.signSync(zg(b),y))}function kO(b,y){if(b.ids&&b.ids.indexOf(y.id)===-1&&!b.ids.some(w=>y.id.startsWith(w))||b.kinds&&b.kinds.indexOf(y.kind)===-1||b.authors&&b.authors.indexOf(y.pubkey)===-1&&!b.authors.some(w=>y.pubkey.startsWith(w)))return!1;for(let w in b)if(w[0]==="#"){let I=w.slice(1),R=b[`#${I}`];if(R&&!y.tags.find(([H,W])=>H===w.slice(1)&&R.indexOf(W)!==-1))return!1}return!(b.since&&y.created_at<b.since||b.until&&y.created_at>=b.until)}function CO(b,y){for(let w=0;w<b.length;w++)if(kO(b[w],y))return!0;return!1}var TO={};Mr(TO,{getHex64:()=>Vf,getInt:()=>q1,getSubscriptionId:()=>W1,matchEventId:()=>IO,matchEventKind:()=>MO,matchEventPubkey:()=>OO});function Vf(b,y){let w=y.length+3,I=b.indexOf(`"${y}":`)+w,R=b.slice(I).indexOf('"')+I+1;return b.slice(R,R+64)}function q1(b,y){let w=y.length,I=b.indexOf(`"${y}":`)+w+3,R=b.slice(I),H=Math.min(R.indexOf(","),R.indexOf("}"));return parseInt(R.slice(0,H),10)}function W1(b){let y=b.slice(0,22).indexOf('"EVENT"');if(y===-1)return null;let w=b.slice(y+7+1).indexOf('"');if(w===-1)return null;let I=y+7+1+w,R=b.slice(I+1,80).indexOf('"');if(R===-1)return null;let H=I+1+R;return b.slice(I+1,H)}function IO(b,y){return y===Vf(b,"id")}function OO(b,y){return y===Vf(b,"pubkey")}function MO(b,y){return y===q1(b,"kind")}var K1=()=>({connect:[],disconnect:[],error:[],notice:[],auth:[]});function LO(b,y={}){let{listTimeout:w=3e3,getTimeout:I=3e3,countTimeout:R=3e3}=y;var H,W={},z=K1(),ne={},ce={},re;async function le(){return re||(re=new Promise((ge,Le)=>{try{H=new WebSocket(b)}catch(Ne){Le(Ne)}H.onopen=()=>{z.connect.forEach(Ne=>Ne()),ge()},H.onerror=()=>{re=void 0,z.error.forEach(Ne=>Ne()),Le()},H.onclose=async()=>{re=void 0,z.disconnect.forEach(Ne=>Ne())};let Ae=[],ze;H.onmessage=Ne=>{Ae.push(Ne.data),ze||(ze=setInterval(Pe,0))};function Pe(){if(Ae.length===0){clearInterval(ze),ze=null;return}var Ne=Ae.shift();if(!Ne)return;let Ve=W1(Ne);if(Ve){let Xe=W[Ve];if(Xe&&Xe.alreadyHaveEvent&&Xe.alreadyHaveEvent(Vf(Ne,"id"),b))return}try{let Xe=JSON.parse(Ne);switch(Xe[0]){case"EVENT":{let G=Xe[1],ie=Xe[2];jg(ie)&&W[G]&&(W[G].skipVerification||V1(ie))&&CO(W[G].filters,ie)&&(W[G],(ne[G]?.event||[]).forEach(fe=>fe(ie)));return}case"COUNT":let Pt=Xe[1],Y=Xe[2];W[Pt]&&(ne[Pt]?.count||[]).forEach(G=>G(Y));return;case"EOSE":{let G=Xe[1];G in ne&&(ne[G].eose.forEach(ie=>ie()),ne[G].eose=[]);return}case"OK":{let G=Xe[1],ie=Xe[2],fe=Xe[3]||"";G in ce&&(ie?ce[G].ok.forEach(xe=>xe()):ce[G].failed.forEach(xe=>xe(fe)),ce[G].ok=[],ce[G].failed=[]);return}case"NOTICE":let Q=Xe[1];z.notice.forEach(G=>G(Q));return;case"AUTH":{let G=Xe[1];z.auth?.forEach(ie=>ie(G));return}}}catch{return}}}),re)}function V(){return H?.readyState===1}async function K(){V()||await le()}async function ee(ge){let Le=JSON.stringify(ge);if(!(!V()&&(await new Promise(Ae=>setTimeout(Ae,1e3)),!V())))try{H.send(Le)}catch(Ae){console.log(Ae)}}const oe=(ge,{verb:Le="REQ",skipVerification:Ae=!1,alreadyHaveEvent:ze=null,id:Pe=Math.random().toString().slice(2)}={})=>{let Ne=Pe;return W[Ne]={id:Ne,filters:ge,skipVerification:Ae,alreadyHaveEvent:ze},ee([Le,Ne,...ge]),{sub:(Ve,Xe={})=>oe(Ve||ge,{skipVerification:Xe.skipVerification||Ae,alreadyHaveEvent:Xe.alreadyHaveEvent||ze,id:Ne}),unsub:()=>{delete W[Ne],delete ne[Ne],ee(["CLOSE",Ne])},on:(Ve,Xe)=>{ne[Ne]=ne[Ne]||{event:[],count:[],eose:[]},ne[Ne][Ve].push(Xe)},off:(Ve,Xe)=>{let Pt=ne[Ne],Y=Pt[Ve].indexOf(Xe);Y>=0&&Pt[Ve].splice(Y,1)}}};function he(ge,Le){if(!ge.id)throw new Error(`event ${ge} has no id`);let Ae=ge.id;return ee([Le,ge]),{on:(ze,Pe)=>{ce[Ae]=ce[Ae]||{ok:[],failed:[]},ce[Ae][ze].push(Pe)},off:(ze,Pe)=>{let Ne=ce[Ae];if(!Ne)return;let Ve=Ne[ze].indexOf(Pe);Ve>=0&&Ne[ze].splice(Ve,1)}}}return{url:b,sub:oe,on:(ge,Le)=>{z[ge].push(Le),ge==="connect"&&H?.readyState===1&&Le()},off:(ge,Le)=>{let Ae=z[ge].indexOf(Le);Ae!==-1&&z[ge].splice(Ae,1)},list:(ge,Le)=>new Promise(Ae=>{let ze=oe(ge,Le),Pe=[],Ne=setTimeout(()=>{ze.unsub(),Ae(Pe)},w);ze.on("eose",()=>{ze.unsub(),clearTimeout(Ne),Ae(Pe)}),ze.on("event",Ve=>{Pe.push(Ve)})}),get:(ge,Le)=>new Promise(Ae=>{let ze=oe([ge],Le),Pe=setTimeout(()=>{ze.unsub(),Ae(null)},I);ze.on("event",Ne=>{ze.unsub(),clearTimeout(Pe),Ae(Ne)})}),count:ge=>new Promise(Le=>{let Ae=oe(ge,{...oe,verb:"COUNT"}),ze=setTimeout(()=>{Ae.unsub(),Le(null)},R);Ae.on("count",Pe=>{Ae.unsub(),clearTimeout(ze),Le(Pe)})}),publish(ge){return he(ge,"EVENT")},auth(ge){return he(ge,"AUTH")},connect:K,close(){z=K1(),ne={},ce={},H.readyState===WebSocket.OPEN&&H?.close()},get status(){return H?.readyState??3}}}var G1=class{_conn;_seenOn={};eoseSubTimeout;getTimeout;constructor(b={}){this._conn={},this.eoseSubTimeout=b.eoseSubTimeout||3400,this.getTimeout=b.getTimeout||3400}close(b){b.forEach(y=>{let w=this._conn[Fg(y)];w&&w.close()})}async ensureRelay(b){const y=Fg(b);this._conn[y]||(this._conn[y]=LO(y,{getTimeout:this.getTimeout*.9,listTimeout:this.getTimeout*.9}));const w=this._conn[y];return await w.connect(),w}sub(b,y,w){let I=new Set,R={...w||{}};R.alreadyHaveEvent=(V,K)=>{if(w?.alreadyHaveEvent?.(V,K))return!0;let ee=this._seenOn[V]||new Set;return ee.add(K),this._seenOn[V]=ee,I.has(V)};let H=[],W=new Set,z=new Set,ne=b.length,ce=!1,re=setTimeout(()=>{ce=!0;for(let V of z.values())V()},this.eoseSubTimeout);b.forEach(async V=>{let K;try{K=await this.ensureRelay(V)}catch{oe();return}if(!K)return;let ee=K.sub(y,R);ee.on("event",he=>{I.add(he.id);for(let ge of W.values())ge(he)}),ee.on("eose",()=>{ce||oe()}),H.push(ee);function oe(){if(ne--,ne===0){clearTimeout(re);for(let he of z.values())he()}}});let le={sub(V,K){return H.forEach(ee=>ee.sub(V,K)),le},unsub(){H.forEach(V=>V.unsub())},on(V,K){V==="event"?W.add(K):V==="eose"&&z.add(K)},off(V,K){V==="event"?W.delete(K):V==="eose"&&z.delete(K)}};return le}get(b,y,w){return new Promise(I=>{let R=this.sub(b,[y],w),H=setTimeout(()=>{R.unsub(),I(null)},this.getTimeout);R.on("event",W=>{I(W),clearTimeout(H),R.unsub()})})}list(b,y,w){return new Promise(I=>{let R=[],H=this.sub(b,y,w);H.on("event",W=>{R.push(W)}),H.on("eose",()=>{H.unsub(),I(R)})})}publish(b,y){const w=b.map(async R=>{let H;try{return H=await this.ensureRelay(R),H.publish(y)}catch{return{on(){},off(){}}}}),I=new Map;return{on(R,H){b.forEach(async(W,z)=>{let ne=await w[z],ce=()=>H(W);I.set(H,ce),ne.on(R,ce)})},off(R,H){b.forEach(async(W,z)=>{let ne=I.get(H);ne&&(await w[z]).off(R,ne)})}}}seenOn(b){return Array.from(this._seenOn[b]?.values?.()||[])}},Vg={};Mr(Vg,{decode:()=>qf,naddrEncode:()=>BO,neventEncode:()=>DO,noteEncode:()=>PO,nprofileEncode:()=>RO,npubEncode:()=>NO,nrelayEncode:()=>UO,nsecEncode:()=>$O});var Tl=5e3;function qf(b){let{prefix:y,words:w}=Or.decode(b,Tl),I=new Uint8Array(Or.fromWords(w));switch(y){case"nprofile":{let R=Wf(I);if(!R[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(R[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:gt.bytesToHex(R[0][0]),relays:R[1]?R[1].map(H=>vo.decode(H)):[]}}}case"nevent":{let R=Wf(I);if(!R[0]?.[0])throw new Error("missing TLV 0 for nevent");if(R[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(R[2]&&R[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");return{type:"nevent",data:{id:gt.bytesToHex(R[0][0]),relays:R[1]?R[1].map(H=>vo.decode(H)):[],author:R[2]?.[0]?gt.bytesToHex(R[2][0]):void 0}}}case"naddr":{let R=Wf(I);if(!R[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!R[2]?.[0])throw new Error("missing TLV 2 for naddr");if(R[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!R[3]?.[0])throw new Error("missing TLV 3 for naddr");if(R[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:vo.decode(R[0][0]),pubkey:gt.bytesToHex(R[2][0]),kind:parseInt(gt.bytesToHex(R[3][0]),16),relays:R[1]?R[1].map(H=>vo.decode(H)):[]}}}case"nrelay":{let R=Wf(I);if(!R[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:vo.decode(R[0][0])}}case"nsec":case"npub":case"note":return{type:y,data:gt.bytesToHex(I)};default:throw new Error(`unknown prefix ${y}`)}}function Wf(b){let y={},w=b;for(;w.length>0;){let I=w[0],R=w[1],H=w.slice(2,2+R);w=w.slice(2+R),!(H.length<R)&&(y[I]=y[I]||[],y[I].push(H))}return y}function $O(b){return qg("nsec",b)}function NO(b){return qg("npub",b)}function PO(b){return qg("note",b)}function qg(b,y){let w=gt.hexToBytes(y),I=Or.toWords(w);return Or.encode(b,I,Tl)}function RO(b){let y=Kf({0:[gt.hexToBytes(b.pubkey)],1:(b.relays||[]).map(I=>Vi.encode(I))}),w=Or.toWords(y);return Or.encode("nprofile",w,Tl)}function DO(b){let y=Kf({0:[gt.hexToBytes(b.id)],1:(b.relays||[]).map(I=>Vi.encode(I)),2:b.author?[gt.hexToBytes(b.author)]:[]}),w=Or.toWords(y);return Or.encode("nevent",w,Tl)}function BO(b){let y=new ArrayBuffer(4);new DataView(y).setUint32(0,b.kind,!1);let w=Kf({0:[Vi.encode(b.identifier)],1:(b.relays||[]).map(R=>Vi.encode(R)),2:[gt.hexToBytes(b.pubkey)],3:[new Uint8Array(y)]}),I=Or.toWords(w);return Or.encode("naddr",I,Tl)}function UO(b){let y=Kf({0:[Vi.encode(b)]}),w=Or.toWords(y);return Or.encode("nrelay",w,Tl)}function Kf(b){let y=[];return Object.entries(b).forEach(([w,I])=>{I.forEach(R=>{let H=new Uint8Array(R.length+2);H.set([parseInt(w)],0),H.set([R.length],1),H.set(R,2),y.push(H)})}),gt.concatBytes(...y)}var HO={};Mr(HO,{decrypt:()=>zO,encrypt:()=>FO});async function FO(b,y,w){const I=ct(b,"02"+y),R=Z1(I);let H=Uint8Array.from((0,Ie.randomBytes)(16)),W=Vi.encode(w),z=await crypto.subtle.importKey("raw",R,{name:"AES-CBC"},!1,["encrypt"]),ne=await crypto.subtle.encrypt({name:"AES-CBC",iv:H},z,W),ce=qc.encode(new Uint8Array(ne)),re=qc.encode(new Uint8Array(H.buffer));return`${ce}?iv=${re}`}async function zO(b,y,w){let[I,R]=w.split("?iv="),H=ct(b,"02"+y),W=Z1(H),z=await crypto.subtle.importKey("raw",W,{name:"AES-CBC"},!1,["decrypt"]),ne=qc.decode(I),ce=qc.decode(R),re=await crypto.subtle.decrypt({name:"AES-CBC",iv:ce},z,ne);return vo.decode(re)}function Z1(b){return b.slice(1,33)}var jO={};Mr(jO,{queryProfile:()=>WO,searchDomain:()=>qO,useFetchImplementation:()=>VO});var Gf;try{Gf=fetch}catch{}function VO(b){Gf=b}async function qO(b,y=""){try{return(await(await Gf(`https://${b}/.well-known/nostr.json?name=${y}`)).json()).names}catch{return{}}}async function WO(b){let[y,w]=b.split("@");if(w||(w=y,y="_"),!y.match(/^[A-Za-z0-9-_.]+$/)||!w.includes("."))return null;let I;try{I=await(await Gf(`https://${w}/.well-known/nostr.json?name=${y}`)).json()}catch{return null}if(!I?.names?.[y])return null;let R=I.names[y],H=I.relays?.[R]||[];return{pubkey:R,relays:H}}var KO={};Mr(KO,{generateSeedWords:()=>ZO,privateKeyFromSeedWords:()=>GO,validateWords:()=>YO});function GO(b,y){let I=Oa.fromMasterSeed((0,tr.mnemonicToSeedSync)(b,y)).derive("m/44'/1237'/0'/0/0").privateKey;if(!I)throw new Error("could not derive private key");return gt.bytesToHex(I)}function ZO(){return(0,tr.generateMnemonic)(Kc.wordlist)}function YO(b){return(0,tr.validateMnemonic)(b,Kc.wordlist)}var JO={};Mr(JO,{parse:()=>XO});function XO(b){const y={reply:void 0,root:void 0,mentions:[],profiles:[]},w=[];for(const I of b.tags)I[0]==="e"&&I[1]&&w.push(I),I[0]==="p"&&I[1]&&y.profiles.push({pubkey:I[1],relays:I[2]?[I[2]]:[]});for(let I=0;I<w.length;I++){const R=w[I],[H,W,z,ne]=R,ce={id:W,relays:z?[z]:[]},re=I===0,le=I===w.length-1;if(ne==="root"){y.root=ce;continue}if(ne==="reply"){y.reply=ce;continue}if(ne==="mention"){y.mentions.push(ce);continue}if(re){y.root=ce;continue}if(le){y.reply=ce;continue}y.mentions.push(ce)}return y}var QO={};Mr(QO,{getPow:()=>eM});function eM(b){return tM(gt.hexToBytes(b))}function tM(b){let y,w,I;for(w=0,y=0;w<b.length&&(I=nM(b[w]),y+=I,I===8);w++);return y}function nM(b){let y=0;if(b===0)return 8;for(;b>>=1;)y++;return 7-y}var rM={};Mr(rM,{BECH32_REGEX:()=>Y1,NOSTR_URI_REGEX:()=>Zf,parse:()=>sM,test:()=>iM});var Y1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/,Zf=new RegExp(`nostr:(${Y1.source})`);function iM(b){return typeof b=="string"&&new RegExp(`^${Zf.source}$`).test(b)}function sM(b){const y=b.match(new RegExp(`^${Zf.source}$`));if(!y)throw new Error(`Invalid Nostr URI: ${b}`);return{uri:y[0],value:y[1],decoded:qf(y[1])}}var oM={};Mr(oM,{createDelegation:()=>aM,getDelegator:()=>lM});function aM(b,y){let w=[];(y.kind||-1)>=0&&w.push(`kind=${y.kind}`),y.until&&w.push(`created_at<${y.until}`),y.since&&w.push(`created_at>${y.since}`);let I=w.join("&");if(I==="")throw new Error("refusing to create a delegation without any conditions");let R=(0,er.sha256)(Vi.encode(`nostr:delegation:${y.pubkey}:${I}`)),H=gt.bytesToHex(Tr.signSync(R,b));return{from:j1(b),to:y.pubkey,cond:I,sig:H}}function lM(b){let y=b.tags.find(z=>z[0]==="delegation"&&z.length>=4);if(!y)return null;let w=y[1],I=y[2],R=y[3],H=I.split("&");for(let z=0;z<H.length;z++){let[ne,ce,re]=H[z].split(/\b/);if(!(ne==="kind"&&ce==="="&&b.kind===parseInt(re))){if(ne==="created_at"&&ce==="<"&&b.created_at<parseInt(re))continue;if(ne==="created_at"&&ce===">"&&b.created_at>parseInt(re))continue;return null}}let W=(0,er.sha256)(Vi.encode(`nostr:delegation:${b.pubkey}:${I}`));return Tr.verifySync(R,W,w)?w:null}var cM={};Mr(cM,{matchAll:()=>uM,regex:()=>Wg,replaceAll:()=>fM});var Wg=()=>new RegExp(`\\b${Zf.source}\\b`,"g");function*uM(b){const y=b.matchAll(Wg());for(const w of y){const[I,R]=w;yield{uri:I,value:R,decoded:qf(R),start:w.index,end:w.index+I.length}}}function fM(b,y){return b.replaceAll(Wg(),(w,I)=>y({uri:w,value:I,decoded:qf(I)}))}var dM={};Mr(dM,{useFetchImplementation:()=>hM,validateGithub:()=>pM});var Kg;try{Kg=fetch}catch{}function hM(b){Kg=b}async function pM(b,y,w){try{return await(await Kg(`https://gist.github.com/${y}/${w}/raw`)).text()===`Verifying that I control the following Nostr public key: ${b}`}catch{return!1}}var gM={};Mr(gM,{authenticate:()=>mM});var mM=async({challenge:b,relay:y,sign:w})=>{const I={kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",y.url],["challenge",b]],content:""},R=y.auth(await w(I));return new Promise((H,W)=>{R.on("ok",function z(){R.off("ok",z),H()}),R.on("failed",function z(ne){R.off("failed",z),W(ne)})})},Gg={};Mr(Gg,{getZapEndpoint:()=>bM,makeZapReceipt:()=>EM,makeZapRequest:()=>vM,useFetchImplementation:()=>yM,validateZapRequest:()=>wM});var Zg;try{Zg=fetch}catch{}function yM(b){Zg=b}async function bM(b){try{let y="",{lud06:w,lud16:I}=JSON.parse(b.content);if(w){let{words:W}=Or.decode(w,1e3),z=Or.fromWords(W);y=vo.decode(z)}else if(I){let[W,z]=I.split("@");y=`https://${z}/.well-known/lnurlp/${W}`}else return null;let H=await(await Zg(y)).json();if(H.allowsNostr&&H.nostrPubkey)return H.callback}catch{}return null}function vM({profile:b,event:y,amount:w,relays:I,comment:R=""}){if(!w)throw new Error("amount not given");if(!b)throw new Error("profile not given");let H={kind:9734,created_at:Math.round(Date.now()/1e3),content:R,tags:[["p",b],["amount",w.toString()],["relays",...I]]};return y&&H.tags.push(["e",y]),H}function wM(b){let y;try{y=JSON.parse(b)}catch{return"Invalid zap request JSON."}if(!jg(y))return"Zap request is not a valid Nostr event.";if(!V1(y))return"Invalid signature on zap request.";let w=y.tags.find(([H,W])=>H==="p"&&W);if(!w)return"Zap request doesn't have a 'p' tag.";if(!w[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let I=y.tags.find(([H,W])=>H==="e"&&W);return I&&!I[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":y.tags.find(([H,W])=>H==="relays"&&W)?null:"Zap request doesn't have a 'relays' tag."}function EM({zapRequest:b,preimage:y,bolt11:w,paidAt:I}){let H=JSON.parse(b).tags.filter(([z])=>z==="e"||z==="p"||z==="a"),W={kind:9735,created_at:Math.round(I.getTime()/1e3),content:"",tags:[...H,["bolt11",w],["description",b]]};return y&&W.tags.push(["preimage",y]),W}gt.hmacSha256Sync=(b,...y)=>(0,Ss.hmac)(er.sha256,b,gt.concatBytes(...y)),gt.sha256Sync=(...b)=>(0,er.sha256)(gt.concatBytes(...b));const xM=b=>Vg.decode(b).data,J1=b=>Vg.decode(b).data;let X1={};const SM=async b=>{if(X1[b])return X1[b];const y=new G1,w=["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine"];try{return await y.get(w,{authors:[b],kinds:[0]})}catch{throw new Error("failed to fetch user profile :(")}finally{y.close(w)}},AM=b=>JSON.parse(b.content),_M=async b=>{const y=await Gg.getZapEndpoint(b);if(!y)throw new Error("failed to retrieve zap endpoint :(");return y},kM=async(b,y)=>{if(Q1()&&!y)try{return await window.nostr.signEvent(b)}catch{}return xO(b,bO())},CM=async({profile:b,nip19Target:y,amount:w,relays:I,comment:R,anon:H})=>{const W=Gg.makeZapRequest({profile:b,event:y&&y.startsWith("note")?J1(y):void 0,amount:w,relays:I,comment:R}),z=y&&y.startsWith("naddr")?J1(y):void 0;if(z){const ne=z.relays?z.relays.reduce((ce,re)=>`${re},${ce}`,""):"";W.tags.push(["a",`${z.kind}:${z.pubkey}:${z.identifier}`,ne])}return(!Q1()||H)&&W.tags.push(["anon"]),kM(W,H)},TM=async({zapEndpoint:b,amount:y,comment:w,authorId:I,nip19Target:R,normalizedRelays:H,anon:W})=>{const z=await CM({profile:I,nip19Target:R,amount:y,relays:H,comment:w,anon:W});let ne=`${b}?amount=${y}&nostr=${encodeURIComponent(JSON.stringify(z))}`;w&&(ne=`${ne}&comment=${encodeURIComponent(w)}`);const ce=await fetch(ne),{pr:re,reason:le,status:V}=await ce.json();if(re)return re;throw V==="ERROR"?new Error(le??"Unable to fetch invoice"):new Error("Unable to fetch invoice")},Q1=()=>window!==void 0&&window.nostr!==void 0,IM=({relays:b,invoice:y,onSuccess:w})=>{const I=new G1,R=Array.from(new Set([...b,"wss://relay.nostr.band"])),H=()=>{I&&I.close(R)},W=Math.round(Date.now()/1e3),z=setInterval(()=>{I.sub(R,[{kinds:[9735],since:W}]).on("event",ce=>{ce.tags.find(re=>re[0]==="bolt11"&&re[1]===y)&&(w(),H(),clearInterval(z))})},5e3);return()=>{H(),clearInterval(z)}},e2="nostrZap.",t2="lightningUri",n2=()=>typeof localStorage<"u",OM=b=>{if(n2())return localStorage.getItem(`${e2}${b}`)},MM=(b,y)=>{n2()&&localStorage.setItem(`${e2}${b}`,y)},LM=()=>OM(t2),$M=b=>MM(t2,b);let Yg=null;const NM=b=>{b=b.replace(/^#/,""),b.length===3&&(b=b.split("").map(H=>H+H).join(""));const y=parseInt(b,16),w=y>>16&255,I=y>>8&255,R=y&255;return{r:w,g:I,b:R}},PM=({r:b,g:y,b:w})=>(b*299+y*587+w*114)/1e3,r2=b=>{const y=NM(b);return PM(y)<128?"#fff":"#000"},Jg=b=>{const y=document.createElement("dialog");return y.classList.add("nostr-zap-dialog"),y.innerHTML=b,y.addEventListener("click",function({clientX:w,clientY:I}){const{left:R,right:H,top:W,bottom:z}=y.getBoundingClientRect();w===0&&I===0||(w<R||w>H||I<W||I>z)&&y.close()}),Yg.appendChild(y),y},RM=({dialogHeader:b,invoice:y,relays:w,buttonColor:I})=>{const R=LM(),W=Jg(`
        <button class="close-button">X</button>
        ${b}
        <div class="qrcode">
          <div class="overlay">copied invoice to clipboard</div>
        </div>
        <p>click QR code to copy invoice</p>
        <select name="lightning-wallet">
          ${[{label:"Default Wallet",value:"lightning:"},{label:"Strike",value:"strike:lightning:"},{label:"Cash App",value:"https://cash.app/launch/lightning/"},{label:"Muun",value:"muun:"},{label:"Blue Wallet",value:"bluewallet:lightning:"},{label:"Wallet of Satoshi",value:"walletofsatoshi:lightning:"},{label:"Zebedee",value:"zebedee:lightning:"},{label:"Zeus LN",value:"zeusln:lightning:"},{label:"Phoenix",value:"phoenix://"},{label:"Breez",value:"breez:"},{label:"Bitcoin Beach",value:"bitcoinbeach://"},{label:"Blixt",value:"blixtwallet:lightning:"},{label:"River",value:"river://"}].map(({label:V,value:K})=>`<option value="${K}" ${R===K?"selected":""}>${V}</option>`).join("")}
        </select>
        <button class="cta-button"
          ${I?`style="background-color: ${I}; color: ${r2(I)}"`:""} 
        >Open Wallet</button>
      `),z=W.querySelector(".qrcode"),ne=W.querySelector('select[name="lightning-wallet"]'),ce=W.querySelector(".cta-button"),re=z.querySelector(".overlay"),le=IM({relays:w,invoice:y,onSuccess:()=>{W.close()}});return new(e(s))(z,{text:y,quietZone:10}),z.addEventListener("click",function(){navigator.clipboard.writeText(y),re.classList.add("show"),setTimeout(()=>re.classList.remove("show"),2e3)}),ce.addEventListener("click",function(){$M(ne.value),window.location.href=`${ne.value}${y}`}),W.addEventListener("close",function(){le(),W.remove()}),W.querySelector(".close-button").addEventListener("click",function(){W.close()}),W},DM=async({npub:b,nip19Target:y,relays:w,buttonColor:I,anon:R})=>{const H=Ve=>`${Ve.substring(0,12)}...${Ve.substring(Ve.length-12)}`,W=w?w.split(","):["wss://relay.nostr.band","wss://relay.damus.io","wss://nos.lol"],z=xM(b),ne=SM(z),ce="https://pbs.twimg.com/profile_images/1604195803748306944/LxHDoJ7P_400x400.jpg",re=async()=>{const{picture:Ve,display_name:Xe,name:Pt}=AM(await ne);return`
      <h2>${Xe||Pt}</h2>
        <img
          src="${Ve||ce}"
          width="80"
          height="80"
          alt="nostr user avatar"
        />
      <p>${H(y||b)}</p>
    `},le=Jg(`
      <button class="close-button">X</button>
      <div class="dialog-header-container">
        <h2 class="skeleton-placeholder"></h2>
          <img
            src="${ce}"
            width="80"
            height="80"
            alt="placeholder avatar"
          />
        <p class="skeleton-placeholder"></p>
      </div>
      <div class="preset-zap-options-container">
        <button data-value="21">21 ⚡️</button>
        <button data-value="69">69 ⚡️</button>
        <button data-value="420">420 ⚡️</button>
        <button data-value="1337">1337 ⚡️</button>
        <button data-value="5000">5k ⚡️</button>
        <button data-value="10000">10k ⚡️</button>
        <button data-value="21000">21k ⚡️</button>
        <button data-value="1000000">1M ⚡️</button>
      </div>
      <form>
        <input name="amount" type="number" placeholder="amount in sats" required />
        <input name="comment" placeholder="optional comment" />
        <button class="cta-button" 
          ${I?`style="background-color: ${I}; color: ${r2(I)}"`:""} 
          type="submit" disabled>Zap</button>
      </form>
    `),V=le.querySelector(".preset-zap-options-container"),K=le.querySelector("form"),ee=le.querySelector('input[name="amount"]'),oe=le.querySelector('input[name="comment"]'),he=le.querySelector('button[type="submit"]'),ge=le.querySelector(".dialog-header-container"),Le=Ve=>{le.close(),i2(Ve,b).showModal()};re().then(Ve=>{ge.innerHTML=Ve,he.disabled=!1}).catch(Le);const Ae=()=>{he.disabled=!0,he.innerHTML='<div class="spinner">Loading</div>'},ze=()=>{he.disabled=!1,he.innerHTML="Zap"},Pe=Ve=>{ee.value=Ve};le.addEventListener("close",function(){ze(),K.reset()}),le.querySelector(".close-button").addEventListener("click",function(){le.close()}),V.addEventListener("click",function(Ve){Ve.target.matches("button")&&(Pe(Ve.target.getAttribute("data-value")),ee.focus())});const Ne=ne.then(_M);return K.addEventListener("submit",async function(Ve){Ve.preventDefault(),Ae();const Xe=Number(ee.value)*1e3,Pt=oe.value;try{const Y=await TM({zapEndpoint:await Ne,amount:Xe,comment:Pt,authorId:z,nip19Target:y,normalizedRelays:W,anon:R}),Q=async()=>{const G=RM({dialogHeader:await re(),invoice:Y,relays:W,buttonColor:I}),ie=G.querySelector(".cta-button");le.close(),G.showModal(),ie.focus()};if(window.webln)try{await window.webln.enable(),await window.webln.sendPayment(Y),le.close()}catch{Q()}else Q()}catch(Y){Le(Y)}}),le},i2=(b,y)=>{const w=Jg(`
    <button class="close-button">X</button>
    <p class="error-message">${b}</p>
    <a href="https://nosta.me/${y}" target="_blank">
      <button class="cta-button">View Nostr Profile</button>
    </a>
  `);return w.addEventListener("close",function(){w.remove()}),w.querySelector(".close-button").addEventListener("click",function(){w.close()}),w},s2=async({npub:b,noteId:y,naddr:w,relays:I,cachedAmountDialog:R,buttonColor:H,anon:W})=>{let z=R;try{return z||(z=await DM({npub:b,nip19Target:w||y,relays:I,buttonColor:H,anon:W})),z.showModal(),window.matchMedia("(max-height: 932px)").matches||z.querySelector('input[name="amount"]').focus(),z}catch(ne){z&&z.close(),i2(ne,b).showModal()}},o2=b=>{let y=null,w=null;b.addEventListener("click",async function(){const I=b.getAttribute("data-npub"),R=b.getAttribute("data-note-id"),H=b.getAttribute("data-naddr"),W=b.getAttribute("data-relays"),z=b.getAttribute("data-button-color"),ne=b.getAttribute("data-anon")==="true";w&&(w.npub!==I||w.noteId!==R||w.naddr!==H||w.relays!==W||w.buttonColor!==z||w.anon!==ne)&&(y=null),w={npub:I,noteId:R,naddr:H,relays:W,buttonColor:z,anon:ne},y=await s2({npub:I,noteId:R,naddr:H,relays:W,cachedAmountDialog:y,buttonColor:z,anon:ne})})},a2=b=>{document.querySelectorAll(b||"[data-npub]").forEach(o2)};return(()=>{const b=document.createElement("style");b.innerHTML=`
      .nostr-zap-dialog {
        width: 424px;
        min-width: 376px;
        margin: auto;
        box-sizing: content-box;
        border: none;
        border-radius: 10px;
        padding: 36px;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        background-color: white;
      }
      .nostr-zap-dialog[open],
      .nostr-zap-dialog form {
        display: block;
        max-width: fit-content;
      }
      .nostr-zap-dialog form {
        padding: 0;
        width: 100%;
      }
      .nostr-zap-dialog img {
        display: inline;
        border-radius: 50%;
      }
      .nostr-zap-dialog h2 {
        font-size: 1.5em;
        font-weight: bold;
        color: black;
      }
      .nostr-zap-dialog p {
        font-size: 1em;
        font-weight: normal;
        color: black;
      }
      .nostr-zap-dialog h2,
      .nostr-zap-dialog p,
      .nostr-zap-dialog .skeleton-placeholder {
        margin: 4px;
        word-wrap: break-word;
      }
      .nostr-zap-dialog button {
        background-color: inherit;
        padding: 12px 0;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid rgb(226, 232, 240);
        width: 100px;
        max-width: 100px;
        max-height: 52px;
        white-space: nowrap;
        color: black;
        box-sizing: border-box;
      }
      .nostr-zap-dialog button:hover {
        background-color: #edf2f7;
      }
      .nostr-zap-dialog button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .nostr-zap-dialog .cta-button {
        background-color: #7f00ff;
        color: #fff;
        width: 100%;
        max-width: 100%;
        margin-top: 16px;
      }
      .nostr-zap-dialog .cta-button:hover {
        background-color: indigo;
      }
      .nostr-zap-dialog .close-button {
        background-color: inherit;
        color: black;
        border-radius: 50%;
        width: 42px;
        height: 42px;
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 12px;
        border: none;
      }
      .nostr-zap-dialog .preset-zap-options-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin: 24px 0 8px 0;
        height: 120px;
      }
      .nostr-zap-dialog input {
        padding: 12px;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        width: 100%;
        max-width: 100%;
        background-color: #f7fafc;
        color: #1a202c;
        box-shadow: none;
        box-sizing: border-box;
        margin-bottom: 16px;
        border: 1px solid lightgray;
      }
      .nostr-zap-dialog .spinner {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .nostr-zap-dialog .spinner:after {
        content: " ";
        display: block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 4px solid #fff;
        border-color: #fff transparent #fff transparent;
        animation: nostr-zap-dialog-spinner 1.2s linear infinite;
        margin-left: 8px;
      }
      .nostr-zap-dialog .error-message {
        text-align: left;
        color: red;
        margin-top: 8px;
      }
      .nostr-zap-dialog .qrcode {
        position: relative;
        display: inline-block;
        margin-top: 24px;
      }
      .nostr-zap-dialog .qrcode .overlay {
        position: absolute;
        color: white;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(127, 17, 224, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }
      .nostr-zap-dialog .qrcode .overlay.show {
        opacity: 1;
      }
      @keyframes nostr-zap-dialog-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes nostr-zap-dialog-skeleton-pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.8;
        }
        100% {
          opacity: 0.6;
        }
      }
      .nostr-zap-dialog .skeleton-placeholder {
        animation-name: nostr-zap-dialog-skeleton-pulse;
        animation-duration: 1.5s;
        animation-iteration-count: infinite;
        animation-timing-function: ease-in-out;
        background-color: #e8e8e8;
        border-radius: 4px;
        margin: 4px auto;
      }
      .nostr-zap-dialog p.skeleton-placeholder {
        height: 20px;
        width: 200px;
      }
      .nostr-zap-dialog h2.skeleton-placeholder {
        height: 28px;
        width: 300px;
      }
      .nostr-zap-dialog select[name="lightning-wallet"] {
        appearance: none;
        background-color: white;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%232D3748" width="24" height="24" viewBox="0 0 24 24"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" /></svg>');
        background-repeat: no-repeat;
        background-position: right 0.7rem center;
        background-size: 16px;
        border: 1px solid #CBD5E0;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: 0.25rem;
        width: 100%;
        margin-top: 24px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        cursor: pointer;
      }
      .nostr-zap-dialog select[name="lightning-wallet"]:focus {
        outline: none;
        border-color: #4FD1C5;
        box-shadow: 0 0 0 2px #4FD1C5;
      }
      @media only screen and (max-width: 480px) {
        .nostr-zap-dialog {
          padding: 18px;
        }

        .nostr-zap-dialog button {
          width: 92px;
          max-width: 92px;
        }
      }
      @media only screen and (max-width: 413px) {
        .nostr-zap-dialog {
          min-width: 324px;
        }
        .nostr-zap-dialog button {
          width: 78px;
          max-width: 78px;
        }
      }
  `;const y=document.createElement("div");document.body.appendChild(y),Yg=y.attachShadow({mode:"open"}),Yg.appendChild(b)})(),a2(),window.nostrZap={init:s2,initTarget:o2,initTargets:a2},cA}cte();var ute=je('<div class="help-icon svg-icon" aria-label="Help"></div>'),fte=je('<div class="github-icon svg-icon svelte-3i2yg5" aria-label="GitHub"></div>'),dte=je('<div class="rotate-right-icon svg-icon svelte-3i2yg5"></div> <span class="btn-text"> </span>',1),hte=je('<div class="setting-section sw-update-section svelte-3i2yg5"><span class="setting-label sw-update-label svelte-3i2yg5"> </span> <div class="setting-control svelte-3i2yg5"><!></div></div>'),pte=je('<div class="lang-icon-btn svg-icon svelte-3i2yg5"></div> <span class="btn-text"> </span>',1),gte=je("<option> </option>"),mte=je("<option> </option>"),yte=je("<option> </option>"),bte=je('<div class="rotate-right-icon svg-icon svelte-3i2yg5"></div> <span class="btn-text"> </span>',1),vte=(t,e)=>By.set(!$(e)),wte=je('<li class="svelte-3i2yg5"> </li>'),Ete=je('<ul class="svelte-3i2yg5"></ul>'),xte=je('<span style="color: #888;"> </span>'),Ste=je('<div class="setting-control relay-list svelte-3i2yg5"><!></div>'),Ate=je('<div class="settings-header svelte-3i2yg5"><div class="first-row svelte-3i2yg5"><div class="site-title svelte-3i2yg5"><span class="site-name svelte-3i2yg5">eHagaki</span> <span class="cache-version svelte-3i2yg5"> </span></div> <div class="author-info svelte-3i2yg5"><span> </span><a href="https://lokuyow.github.io/" target="_blank" rel="noopener noreferrer" class="svelte-3i2yg5"> </a></div></div> <div class="second-row svelte-3i2yg5"><!> <!> <div><div class="zap-view-btn-group svelte-3i2yg5"><button class="zap-btn svelte-3i2yg5" data-npub="npub1a3pvwe2p3v7mnjz6hle63r628wl9w567aw7u23fzqs062v5vqcqqu3sgh3" data-note-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-relays="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">Support</button> <span class="divider svelte-3i2yg5"></span> <button class="view-btn svelte-3i2yg5" data-title="Thanks for the Support!" data-nzv-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-zap-color-mode="true" data-relay-urls="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">View</button></div></div></div></div> <div class="modal-body svelte-3i2yg5"><!> <div class="setting-section svelte-3i2yg5"><span class="setting-label svelte-3i2yg5">Language/言語</span> <div class="setting-control svelte-3i2yg5"><!></div></div> <div class="setting-section svelte-3i2yg5"><span class="setting-label svelte-3i2yg5"> </span> <div class="setting-control svelte-3i2yg5"><select id="compression-select" class="svelte-3i2yg5"></select></div></div> <div class="setting-section svelte-3i2yg5"><span class="setting-label svelte-3i2yg5"> </span> <div class="setting-control svelte-3i2yg5"><select id="video-compression-select" class="svelte-3i2yg5"></select></div></div> <div class="setting-section svelte-3i2yg5"><span class="setting-label svelte-3i2yg5"> </span> <div class="setting-control svelte-3i2yg5"><select id="endpoint-select" class="svelte-3i2yg5"></select></div></div> <div class="setting-section svelte-3i2yg5"><span class="setting-label svelte-3i2yg5"> </span> <div class="setting-control svelte-3i2yg5"><label class="toggle-switch svelte-3i2yg5" for="client-tag-toggle"><input id="client-tag-toggle" type="checkbox" class="svelte-3i2yg5"/> <span class="slider svelte-3i2yg5"></span></label></div></div> <div class="setting-section svelte-3i2yg5"><span class="setting-label svelte-3i2yg5"> </span> <div class="setting-control svelte-3i2yg5"><!></div> <div class="setting-info svelte-3i2yg5"><button type="button" class="relay-toggle-label svelte-3i2yg5" style="cursor:pointer; background:none; border:none; padding:0; font: inherit;"><span class="relay-toggle-icon svelte-3i2yg5" aria-label="toggle"><!></span> </button> <!></div></div></div>',1);function _te(t,e){un(e,!0);const n=()=>_n(mr,"$_",s),r=()=>_n(Di,"$locale",s),i=()=>_n(Zv,"$swNeedRefresh",s),[s,o]=ii();let a=dt(e,"show",3,!1),l=dt(e,"onRefreshRelaysAndProfile",3,()=>{}),c=dt(e,"selectedCompression",3,"medium"),u=dt(e,"onSelectedCompressionChange",3,void 0),f=dt(e,"selectedEndpoint",3,""),d=dt(e,"onSelectedEndpointChange",3,void 0),h=dt(e,"onOpenWelcomeDialog",3,void 0),p=Qe(()=>eH(n())),g=Qe(()=>tH(n())),m=Se(!0),v=Se(Et(c())),x=Se("medium"),C=Se(Et(f())),N=Se(!1);qe(()=>{const B=c();B!==void 0&&B!==""&&se(v,B,!0)}),qe(()=>{u()&&$(v)!==c()&&u()($(v))}),qe(()=>{const B=f();B!==void 0&&B!==""&&se(C,B,!0)}),qe(()=>{d()&&$(C)!==f()&&d()($(C))}),qe(()=>{$(N)&&$(v)&&localStorage.setItem(Pr.IMAGE_COMPRESSION_LEVEL,$(v))}),qe(()=>{$(N)&&$(x)&&localStorage.setItem(Pr.VIDEO_COMPRESSION_LEVEL,$(x))}),qe(()=>{$(N)&&$(C)&&localStorage.setItem(Pr.UPLOAD_ENDPOINT,$(C))}),qe(()=>{$(N)&&localStorage.setItem(Pr.CLIENT_TAG_ENABLED,$(m)?"true":"false")});let O=Se(null);tC.subscribe(B=>se(O,B,!0));function A(){wF(jU,B=>jE.set(B),{timeout:XU})}function P(){const B=pF($i.value.pubkey);zE.set(B)}function S(){const B=vF({selectedEndpoint:f(),selectedCompression:c()});se(C,B.endpoint,!0),se(m,B.clientTagEnabled,!0),se(v,B.compression,!0);const M=localStorage.getItem(Pr.VIDEO_COMPRESSION_LEVEL);M?M==="skip"?(se(x,"none"),localStorage.setItem(Pr.VIDEO_COMPRESSION_LEVEL,"none")):se(x,M,!0):(se(x,"medium"),localStorage.setItem(Pr.VIDEO_COMPRESSION_LEVEL,"medium")),se(N,!0)}Ti(()=>{S(),P(),VU()}),qe(()=>{a()&&P()}),qe(()=>{a()&&(async()=>(await ua(),lte(),window.nostrZap&&window.nostrZap.initTargets()))()}),qe(()=>{a()||By.set(!1)}),qe(()=>{r()&&!localStorage.getItem(Pr.UPLOAD_ENDPOINT)&&se(C,Yv(r()),!0)});function E(){Di.set(r()==="ja"?"en":"ja")}function _(){P()}Uy.subscribe(()=>{setTimeout(P,QU)});let k=Qe(()=>zE.value),D=Qe(()=>By.value),U=Qe(()=>jE.value);{let B=Qe(()=>n()("settings")||"設定");$f(t,{get show(){return a()},useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return $(B)},className:"settings-dialog",showFooter:!0,$$events:{"relays-updated":_},children:(M,T)=>{var L=Ate(),q=vt(L),F=pe(q),j=pe(F),Z=Me(pe(j),2),J=pe(Z),ue=Me(j,2),ae=pe(ue),X=pe(ae),be=Me(ae),De=pe(be),de=Me(F,2),ke=pe(de);Gt(ke,{shape:"circle",variant:"default",className:"help-btn",onClick:()=>{e.onClose(),h()?.()},ariaLabel:"Help",children:(Fe,It)=>{var Mt=ute();we(Fe,Mt)},$$slots:{default:!0}});var Ze=Me(ke,2);Gt(Ze,{shape:"circle",variant:"default",className:"github-link-btn",onClick:()=>window.open("https://github.com/Lokuyow/ehagaki","_blank"),ariaLabel:"GitHub Repository",children:(Fe,It)=>{var Mt=fte();we(Fe,Mt)},$$slots:{default:!0}});var me=Me(q,2),Ee=pe(me);{var ve=Fe=>{var It=hte(),Mt=pe(It),hn=pe(Mt),tn=Me(Mt,2),Hn=pe(tn);{let On=Qe(()=>$(U)?"loading":""),Zr=Qe(()=>n()("settingsDialog.update_app")||"アプリを更新");Gt(Hn,{variant:"primary",shape:"rounded",get className(){return`sw-update-btn ${$(On)??""}`},onClick:A,get disabled(){return $(U)},get ariaLabel(){return $(Zr)},children:(Ie,Ii)=>{var _l=Xt(),_g=vt(_l);{var kg=po=>{{let kl=Qe(()=>n()("settingsDialog.updating")||"更新中...");ma(po,{showLoader:!0,get text(){return $(kl)}})}},Cg=po=>{var kl=dte(),Pf=vt(kl),Tg=Me(Pf,2),Ig=pe(Tg);Je((Rf,jc)=>{an(Pf,"aria-label",Rf),Ye(Ig,jc)},[()=>n()("settingsDialog.refresh")||"更新",()=>n()("settingsDialog.update_app")||"更新"]),we(po,kl)};rt(_g,po=>{$(U)?po(kg):po(Cg,!1)})}we(Ie,_l)},$$slots:{default:!0}})}Je(On=>Ye(hn,On),[()=>n()("settingsDialog.sw_update_available")||"アプリの更新があります"]),we(Fe,It)};rt(Ee,Fe=>{i()&&Fe(ve)})}var Oe=Me(Ee,2),Re=Me(pe(Oe),2),nt=pe(Re);Gt(nt,{variant:"default",shape:"rounded",className:"lang-btn",onClick:E,children:(Fe,It)=>{var Mt=pte(),hn=vt(Mt),tn=Me(hn,2),Hn=pe(tn);Je((On,Zr)=>{an(hn,"aria-label",On),Ye(Hn,Zr)},[()=>n()("settingsDialog.change")||"変更",()=>n()("settingsDialog.change")||"変更"]),we(Fe,Mt)},$$slots:{default:!0}});var He=Me(Oe,2),it=pe(He),at=pe(it),At=Me(it,2),ht=pe(At);Hl(ht,21,()=>$(p),du,(Fe,It)=>{var Mt=gte(),hn=pe(Mt),tn={};Je(()=>{Ye(hn,$(It).label),tn!==(tn=$(It).value)&&(Mt.value=(Mt.__value=$(It).value)??"")}),we(Fe,Mt)});var Tt=Me(He,2),Ce=pe(Tt),Be=pe(Ce),ot=Me(Ce,2),ct=pe(ot);Hl(ct,21,()=>$(g),du,(Fe,It)=>{var Mt=mte(),hn=pe(Mt),tn={};Je(()=>{Ye(hn,$(It).label),tn!==(tn=$(It).value)&&(Mt.value=(Mt.__value=$(It).value)??"")}),we(Fe,Mt)});var Zt=Me(Tt,2),Ut=pe(Zt),jt=pe(Ut),Nt=Me(Ut,2),_t=pe(Nt);Hl(_t,21,()=>rC,du,(Fe,It)=>{var Mt=yte(),hn=pe(Mt),tn={};Je(()=>{Ye(hn,$(It).label),tn!==(tn=$(It).url)&&(Mt.value=(Mt.__value=$(It).url)??"")}),we(Fe,Mt)});var xt=Me(Zt,2),Ht=pe(xt),Cn=pe(Ht),Qn=Me(Ht,2),kr=pe(Qn),oi=pe(kr),Cr=Me(xt,2),ka=pe(Cr),Es=pe(ka),Ca=Me(ka,2),Kr=pe(Ca);{let Fe=Qe(()=>n()("settingsDialog.refresh_relays_and_profile")||"再取得");Gt(Kr,{variant:"default",shape:"rounded",className:"refresh-relays-profile-btn",onClick:()=>l()&&l()(),get ariaLabel(){return $(Fe)},children:(It,Mt)=>{var hn=bte(),tn=vt(hn),Hn=Me(tn,2),On=pe(Hn);Je((Zr,Ie)=>{an(tn,"aria-label",Zr),Ye(On,Ie)},[()=>n()("settingsDialog.refresh")||"更新",()=>n()("settingsDialog.refresh")||"更新"]),we(It,hn)},$$slots:{default:!0}})}var Gr=Me(Ca,2),br=pe(Gr);br.__click=[vte,D];var Tr=pe(br),Tn=pe(Tr);{var In=Fe=>{var It=Wn("▼");we(Fe,It)},Ir=Fe=>{var It=Wn("▶");we(Fe,It)};rt(Tn,Fe=>{$(D)?Fe(In):Fe(Ir,!1)})}var gt=Me(Tr),er=Me(br,2);{var ho=Fe=>{var It=Ste(),Mt=pe(It);{var hn=Hn=>{var On=Ete();Hl(On,21,()=>$(k),du,(Zr,Ie)=>{var Ii=wte(),_l=pe(Ii);Je(()=>Ye(_l,$(Ie))),we(Zr,Ii)}),we(Hn,On)},tn=Hn=>{var On=xte(),Zr=pe(On);Je(Ie=>Ye(Zr,Ie),[()=>n()("settingsDialog.no_relay_info")||"リレー情報なし"]),we(Hn,On)};rt(Mt,Hn=>{$(k).length>0?Hn(hn):Hn(tn,!1)})}we(Fe,It)};rt(er,Fe=>{$(D)&&Fe(ho)})}Je((Fe,It,Mt,hn,tn,Hn,On,Zr,Ie)=>{Ye(J,$(O)?`v${$(O)}`:""),Ye(X,Fe),Ye(De,It),Ye(at,Mt),Ye(Be,hn),Ye(jt,tn),Ye(Cn,Hn),Ye(Es,On),an(br,"aria-pressed",$(D)),an(br,"aria-label",Zr),Ye(gt,` ${Ie??""}`)},[()=>n()("settingsDialog.author_info")||"制作：",()=>n()("settingsDialog.author_name")||" Lokuyow",()=>n()("settingsDialog.compression_setting")||"画像圧縮設定",()=>n()("settingsDialog.video_compression_setting")||"動画圧縮設定",()=>n()("settingsDialog.upload_destination")||"アップロード先",()=>n()("settingsDialog.client_tag_label")||"投稿詳細にクライアント名をつける（Client tag）",()=>n()("settingsDialog.refresh_relays_and_profile")||"リレーリスト・プロフィール再取得",()=>n()("settingsDialog.toggle_write_relays_list")||"投稿先リレーの表示切替",()=>n()("settingsDialog.write_relays_list")||"書き込み先リレーリスト"]),om(ht,()=>$(v),Fe=>se(v,Fe)),om(ct,()=>$(x),Fe=>se(x,Fe)),om(_t,()=>$(C),Fe=>se(C,Fe)),h$(oi,()=>$(m),Fe=>se(m,Fe)),we(M,L)},$$slots:{default:!0}})}fn(),o()}Ci(["click"]);var kte=je('<h2 class="svelte-1fg3vpn"> </h2> <p> </p> <div class="dialog-buttons svelte-1fg3vpn"><!> <!></div>',1);function Cte(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii();let s=dt(e,"isLoggingOut",3,!1);function o(){e.onLogout?.()}{const a=(c,u)=>{let f=()=>u?.().close;var d=kte(),h=vt(d),p=pe(h),g=Me(h,2),m=pe(g),v=Me(g,2),x=pe(v);{let N=Qe(()=>s()?"loading":"");Gt(x,{onClick:o,get className(){return`logout-btn ${$(N)??""}`},variant:"danger",shape:"square",get disabled(){return s()},children:(O,A)=>{var P=Xt(),S=vt(P);{var E=k=>{ma(k,{text:!0,showLoader:!0})},_=k=>{var D=Wn();Je(U=>Ye(D,U),[()=>n()("logoutDialog.logout")]),we(k,D)};rt(S,k=>{s()?k(E):k(_,!1)})}we(O,P)},$$slots:{default:!0}})}var C=Me(x,2);Gt(C,{get onClick(){return f()},className:"cancel-btn",variant:"secondary",shape:"square",get disabled(){return s()},children:(N,O)=>{var A=Wn();Je(P=>Ye(A,P),[()=>n()("logoutDialog.cancel")]),we(N,A)},$$slots:{default:!0}}),Je((N,O)=>{Ye(p,N),Ye(m,O)},[()=>n()("logoutDialog.logout_confirmation"),()=>n()("logoutDialog.logout_warning")]),we(c,d)};let l=Qe(()=>n()("logoutDialog.logout_confirmation"));$f(t,{get show(){return e.show},useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return $(l)},className:"logout-dialog",children:a,$$slots:{default:!0}})}fn(),i()}var Tte=je('<div><span style="word-break:break-all"> </span></div>'),Ite=je('<div><span style="word-break:break-all"> </span></div>'),Ote=je('<div class="toast npub-toast svelte-1x8c881"><!> <!></div>'),Mte=je('<img src="./icons/nostr-login.svg" alt="nostr-login" class="nostr-login-icon svelte-1x8c881"/> <span class="btn-text svelte-1x8c881">Nostr Login</span>',1),Lte=(t,e)=>{t.key==="Enter"&&e()},$te=(t,e)=>{$(e)&&$(e).setCustomValidity("")},Nte=je('<!> <div class="divider svelte-1x8c881"><span class="svelte-1x8c881"> </span></div> <h3 class="svelte-1x8c881"> </h3> <form class="svelte-1x8c881"><input type="password" placeholder="nsec1…" class="secret-input svelte-1x8c881" id="secretKey" name="secretKey" autocomplete="current-password" required minlength="63" maxlength="63"/> <div class="dialog-buttons svelte-1x8c881"><!> <!></div></form>',1),Pte=je("<!> <!>",1);function Rte(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii();let s=dt(e,"secretKey",15),o=dt(e,"isLoadingNostrLogin",3,!1);const a=new iI;let l=Se(null);qe(()=>{s()!==void 0&&(a.setNsec(s()),$(l)&&(s()||$(l).setCustomValidity("")))});let c=Se(!1),u=Se(""),f=Se("");qe(()=>{a.isValid.subscribe(N=>se(c,N,!0))}),qe(()=>{a.npub.subscribe(N=>se(u,N,!0))}),qe(()=>{a.nprofile.subscribe(N=>se(f,N,!0))});function d(){if($(l)){const N=$(l).validity,O=$(l).value??"";if(N.valueMissing){$(l).setCustomValidity(n()("loginDialog.secret_required")),$(l).reportValidity();return}if(!O.startsWith("nsec1")){$(l).setCustomValidity(n()("loginDialog.secret_must_start_nsec1")),$(l).reportValidity();return}if(O.length!==63){O.length<63?$(l).setCustomValidity(n()("loginDialog.secret_too_short")):$(l).setCustomValidity(n()("loginDialog.secret_too_long")),$(l).reportValidity();return}if(!$(c)){$(l).setCustomValidity(n()("loginDialog.invalid_secret")),$(l).reportValidity();return}$(l).setCustomValidity("")}e.onSave?.()}function h(){s(""),$(l)&&$(l).setCustomValidity("")}function p(){e.onNostrLogin?.()}function g(N){N.preventDefault(),d()}var m=Pte(),v=vt(m);{var x=N=>{var O=Ote(),A=pe(O);{var P=_=>{var k=Tte(),D=pe(k),U=pe(D);Je(()=>Ye(U,$(u))),we(_,k)};rt(A,_=>{$(u)&&_(P)})}var S=Me(A,2);{var E=_=>{var k=Ite(),D=pe(k),U=pe(D);Je(()=>Ye(U,$(f))),we(_,k)};rt(S,_=>{$(f)&&_(E)})}we(N,O)};rt(v,N=>{($(u)||$(f))&&N(x)})}var C=Me(v,2);{const N=A=>{var P=Nte(),S=vt(P);{let F=Qe(()=>o()?"loading":"");Gt(S,{variant:"default",shape:"rounded",get className(){return`nostr-login-button ${$(F)??""}`},onClick:p,get disabled(){return o()},children:(j,Z)=>{var J=Xt(),ue=vt(J);{var ae=be=>{ma(be,{text:!0,showLoader:!0,customClass:"nostr-login-placeholder"})},X=be=>{var De=Mte();we(be,De)};rt(ue,be=>{o()?be(ae):be(X,!1)})}we(j,J)},$$slots:{default:!0}})}var E=Me(S,2),_=pe(E),k=pe(_),D=Me(E,2),U=pe(D),B=Me(D,2),M=pe(B);M.__keydown=[Lte,d],M.__input=[$te,l],Rn(M,F=>se(l,F),()=>$(l));var T=Me(M,2),L=pe(T);Gt(L,{variant:"warning",shape:"square",type:"button",onClick:h,className:"clear-btn",children:(F,j)=>{var Z=Wn();Je(J=>Ye(Z,J),[()=>n()("loginDialog.clear")]),we(F,Z)},$$slots:{default:!0}});var q=Me(L,2);Gt(q,{variant:"primary",shape:"square",type:"submit",className:"save-btn",children:(F,j)=>{var Z=Wn();Je(J=>Ye(Z,J),[()=>n()("loginDialog.save")]),we(F,Z)},$$slots:{default:!0}}),Je((F,j,Z)=>{Ye(k,F),Ye(U,j),an(M,"title",Z)},[()=>n()("loginDialog.or"),()=>n()("loginDialog.input_secret"),()=>n()("loginDialog.hint_input_secret")]),Ni("submit",B,g),d$(M,s),we(A,P)};let O=Qe(()=>n()("loginDialog.input_secret"));$f(C,{get show(){return e.show},useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return $(O)},className:"login-dialog",showFooter:!0,children:N,$$slots:{default:!0}})}we(t,m),fn(),i()}Ci(["keydown","input"]);var Dte=je('<div class="welcome-content svelte-jq4530"><div class="title-section svelte-jq4530"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-jq4530"/> <h2 class="svelte-jq4530"> </h2></div> <p class="svelte-jq4530"> </p> <pre class="features svelte-jq4530"> </pre></div>');function Bte(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii();let s=dt(e,"show",3,!1);{const o=l=>{Gt(l,{variant:"primary",shape:"square",get onClick(){return e.onClose},className:"get-started-btn",children:(c,u)=>{var f=Wn();Je(d=>Ye(f,d),[()=>n()("welcomeDialog.get_started")]),we(c,f)},$$slots:{default:!0}})};let a=Qe(()=>n()("welcomeDialog.title"));$f(t,{get show(){return s()},get onClose(){return e.onClose},get ariaLabel(){return $(a)},showFooter:!0,className:"welcome-dialog",footer:o,children:(l,c)=>{var u=Dte(),f=pe(u),d=Me(pe(f),2),h=pe(d),p=Me(f,2),g=pe(p),m=Me(p,2),v=pe(m);Je((x,C,N)=>{Ye(h,x),Ye(g,C),Ye(v,N)},[()=>n()("welcomeDialog.title"),()=>n()("welcomeDialog.description"),()=>n()("welcomeDialog.features")]),we(l,u)},$$slots:{footer:!0,default:!0}})}fn(),i()}class up{static createMergedOptions(e){return{theme:"default",noBanner:!0,methods:"connect, extension, local",perms:"get_public_key,sign_event:1,sign_event:27235",startScreen:"welcome",...e}}static processBunkers(e){return Array.isArray(e)?e.join(","):void 0}static async npubToPubkey(e){try{if(!e)return{success:!1,error:{type:"decode",message:"npub is empty or null"}};const n=ha.decode(e);return n.type==="npub"?{success:!0,pubkey:n.data}:{success:!1,error:{type:"decode",message:"Invalid npub format"}}}catch(n){return{success:!1,error:{type:"decode",message:"Failed to decode npub",originalError:n}}}}static getCurrentUserFromWindow(e){try{const n=e.nostrLogin;if(n&&n.pubkey)return{pubkey:n.pubkey,npub:n.npub}}catch{return null}return null}}class Ute{constructor(e,n,r){this.console=e,this.getAuthHandler=n,this.isLoggingOut=r}async handleAuthCallback(e,n){const r=this.getAuthHandler();if(!(!r||this.isLoggingOut()))try{if(!e){r({type:"logout"});return}const i=await up.npubToPubkey(e);if(!i.success||!i.pubkey){this.console.warn("NostrLogin: Failed to get pubkey from npub",i.error);return}const s=n?.type||"login";r({type:s,pubkey:i.pubkey,npub:e,otpData:n?.otpData})}catch(i){this.console.error("NostrLogin auth callback error:",i)}}}class Hte{constructor(e,n,r){this.console=e,this.importNostrLogin=n,this.authHandler=r}async initialize(e){try{const r=(await this.importNostrLogin()).init;if(!r)throw new TypeError("nostr-login: init function is missing");const i=up.createMergedOptions(e),s=this.authHandler.handleAuthCallback.bind(this.authHandler),o=i.bunkers!==void 0?up.processBunkers(i.bunkers):void 0,a={...i,bunkers:o,startScreen:i.startScreen,onAuth:s};return await Promise.resolve(r(a)),this.console.log("nostr-login初期化完了"),{success:!0}}catch(n){const r={type:"initialization",message:"Failed to initialize nostr-login",originalError:n};return this.console.error("nostr-login初期化エラー:",n),{success:!1,error:r}}}}class Fte{constructor(e){this.importNostrLogin=e}async launch(e){try{const{launch:n}=await this.importNostrLogin();return await n(e||"welcome"),{success:!0}}catch(n){return{success:!1,error:{type:"launch",message:"Failed to launch nostr-login",originalError:n}}}}}class zte{constructor(e,n){this.document=e,this.setTimeout=n}logout(e){e(!0);try{const n=new Event("nlLogout");this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlLogout event:",n)}try{this.setTimeout(()=>{e(!1)},100)}catch(n){console.error("Failed to set logout flag timeout:",n),e(!1)}}setDarkMode(e){try{const n=new CustomEvent("nlDarkMode",{detail:e});this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlDarkMode event:",n)}}}class jte{initialized=!1;authHandler=null;isLoggingOutFlag=!1;initPromise=null;resolvedPromise=null;initializer;launcher;eventEmitter;authCallbackHandler;windowObj;documentObj;consoleObj;setTimeoutFn;constructor(e={}){this.windowObj=e.window||(typeof window<"u"?window:{}),this.documentObj=e.document||(typeof window<"u"?window.document:{}),this.consoleObj=e.console||(typeof window<"u"?window.console:{}),this.setTimeoutFn=e.setTimeout||(typeof window<"u"&&window.setTimeout?window.setTimeout.bind(window):(()=>{}));const n=e.importNostrLogin||(()=>Tp(()=>import("./index.esm-B6zogCv1.js"),[]));this.authCallbackHandler=new Ute(this.consoleObj,()=>this.authHandler,()=>this.isLoggingOutFlag),this.initializer=new Hte(this.consoleObj,n,this.authCallbackHandler),this.launcher=new Fte(n),this.eventEmitter=new zte(this.documentObj,this.setTimeoutFn)}init(e={}){return this.initPromise!==null?this.initPromise:this.initialized?this.resolvedPromise:(this.initPromise=new Promise((n,r)=>{this.initializer.initialize(e).then(i=>{if(i.success)this.initialized=!0,this.resolvedPromise=this.initPromise,n();else{this._resetInitializationState();const s=i.error?.message||"Initialization failed",o=i.error?.originalError;o instanceof Error?r(o):r(new Error(s))}}).catch(i=>{this._resetInitializationState(),r(i)})}),this.initPromise)}_resetInitializationState(){this.initialized=!1,this.initPromise=null,this.resolvedPromise=null}setAuthHandler(e){this.authHandler=e}async showLogin(e){if(!this._ensureInitialized())throw new Error("nostr-login is not initialized");const n=await this.launcher.launch(e);if(!n.success)throw n.error?.originalError instanceof Error?n.error.originalError:new Error(n.error?.message||"Failed to launch login")}logout(){try{if(!this._ensureInitialized())return;this.eventEmitter.logout(e=>{this.isLoggingOutFlag=e})}catch(e){this.consoleObj.error("NostrLogin logout error:",e)}}setDarkMode(e){this._ensureInitialized()&&this.eventEmitter.setDarkMode(e)}getCurrentUser(){return this.initialized?up.getCurrentUserFromWindow(this.windowObj):null}_ensureInitialized(){return this.initialized?!0:(this.consoleObj.warn("nostr-loginが初期化されていません"),!1)}get isInitialized(){return this.initialized}getInitializer(){return this.initializer}getLauncher(){return this.launcher}getEventEmitter(){return this.eventEmitter}getAuthCallbackHandler(){return this.authCallbackHandler}}const fA=new jte;class fp{static isValidSecretKey(e,n){return n.isValidNsec(e)}static hasRequiredPubkey(e){return e.type!=="logout"&&!!e.pubkey}static isLogoutAuth(e){return e.type==="logout"}}class Vte{constructor(e,n,r){this.keyManager=e,this.setNsecAuth=n,this.console=r}async authenticate(e){if(!fp.isValidSecretKey(e,this.keyManager))return{success:!1,error:"invalid_secret"};const{success:n}=this.keyManager.saveToStorage(e);if(!n)return{success:!1,error:"error_saving"};try{const r=this.keyManager.derivePublicKey(e);return r.hex?(this.setNsecAuth(r.hex,r.npub,r.nprofile),{success:!0,pubkeyHex:r.hex}):{success:!1,error:"derivation_failed"}}catch(r){return this.console.error("nsec認証処理中にエラー:",r),{success:!1,error:"authentication_error"}}}}class qte{constructor(e,n){this.publicKeyState=e,this.console=n}async authenticate(e){if(fp.isLogoutAuth(e))return{success:!0};if(!fp.hasRequiredPubkey(e))return this.console.warn("NostrLoginAuth: pubkey is required for login/signup"),{success:!1,error:"missing_pubkey"};try{return this.publicKeyState.setNostrLoginAuth(e),{success:!0,pubkeyHex:e.pubkey}}catch(n){return this.console.error("nostr-login認証処理中にエラー:",n),{success:!1,error:"nostr_login_error"}}}}class Wte{constructor(e){this.window=e}async waitForExternalAuth(e=5e3){const n=Date.now(),r=100;return new Promise(i=>{const s=()=>{if(this.isWindowNostrAvailable()){i(!0);return}if(Date.now()-n>=e){i(!1);return}setTimeout(s,r)};s()})}isWindowNostrAvailable(){return typeof this.window<"u"&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}}class Kte{constructor(e,n){this.navigator=e,this.console=n}async clearProfileImageCache(){try{if(!this.hasServiceWorker())return;const e=new MessageChannel;return new Promise((n,r)=>{e.port1.onmessage=i=>{i.data.success?(this.console.log("プロフィール画像キャッシュをクリアしました"),n()):(this.console.error("プロフィール画像キャッシュクリア失敗:",i.data.error),r(new Error(i.data.error)))},this.navigator.serviceWorker.controller?this.navigator.serviceWorker.controller.postMessage({action:"clearProfileCache"},[e.port2]):r(new Error("Service worker controller is null."))})}catch(e){this.console.error("プロフィール画像キャッシュクリア中にエラー:",e)}}hasServiceWorker(){return"serviceWorker"in this.navigator&&!!this.navigator.serviceWorker.controller}}class Gte{constructor(e){this.localStorage=e}getStoredNostrLoginData(){try{const e=this.localStorage.getItem("__nostrlogin_nip46");if(!e)return null;const n=JSON.parse(e);return n?.pubkey?{pubkey:n.pubkey,npub:n.npub}:null}catch{return null}}}class Zte{constructor(e,n,r,i,s,o,a){this.keyManager=e,this.publicKeyState=n,this.nostrLoginManager=r,this.externalAuthWaiter=i,this.storageManager=s,this.setNsecAuth=o,this.console=a}async initialize(e){try{const n=await this.checkNsecAuth();if(n.hasAuth)return n;await this.externalAuthWaiter.waitForExternalAuth(100);const r=await this.checkNostrLoginAuth(e);if(r.hasAuth)return r}catch(n){this.console.error("nostr-login初期化失敗:",n)}return{hasAuth:!1}}async checkNsecAuth(){const e=this.keyManager.loadFromStorage();if(!e)return{hasAuth:!1};this.publicKeyState.setNsec(e);try{const n=this.keyManager.derivePublicKey(e);return n.hex?(this.setNsecAuth(n.hex,n.npub,n.nprofile),{hasAuth:!0,pubkeyHex:n.hex,isNostrLogin:!1}):(this.keyManager.saveToStorage(""),{hasAuth:!1})}catch{return this.keyManager.saveToStorage(""),{hasAuth:!1}}}async checkNostrLoginAuth(e){await this.nostrLoginManager.init(e),await new Promise(i=>setTimeout(i,100));const n=this.nostrLoginManager.getCurrentUser();if(n?.pubkey)return this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:n.pubkey,npub:n.npub}),{hasAuth:!0,pubkeyHex:n.pubkey,isNostrLogin:!0};const r=this.storageManager.getStoredNostrLoginData();return r?.pubkey?(this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:r.pubkey,npub:r.npub}),{hasAuth:!0,pubkeyHex:r.pubkey,isNostrLogin:!0}):{hasAuth:!1}}}class Yte{publicKeyState;nsecAuthenticator;nostrLoginAuthenticator;profileCacheCleaner;authInitializer;nostrLoginMgr;keyManager;nostrLoginOptions={theme:"default",noBanner:!0,methods:"connect, extension, local"};constructor(e={}){const n=e.keyManager||new sI({secretKeyStore:e.secretKeyStore||DU,setNostrLoginAuthFn:e.setNsecAuth||NE,clearAuthStateFn:e.clearAuthState||$E}),r=e.localStorage||(typeof window<"u"?window.localStorage:{}),i=e.window||(typeof window<"u"?window:{}),s=e.navigator||(typeof window<"u"?window.navigator:{}),o=e.console||(typeof window<"u"?window.console:{}),a=e.setNsecAuth||NE;this.nostrLoginMgr=e.nostrLoginManager||fA,this.publicKeyState=new iI({setNostrLoginAuthFn:e.setNostrLoginAuth||TU,clearAuthStateFn:e.clearAuthState||$E}),this.nsecAuthenticator=new Vte(n,a,o),this.nostrLoginAuthenticator=new qte(this.publicKeyState,o),this.profileCacheCleaner=new Kte(s,o);const l=new Wte(i),c=new Gte(r);this.authInitializer=new Zte(n,this.publicKeyState,this.nostrLoginMgr,l,c,a,o),this.keyManager=n}async authenticateWithNsec(e){return await this.nsecAuthenticator.authenticate(e)}async authenticateWithNostrLogin(e){return fp.isLogoutAuth(e)?(this.logout(),{success:!0}):await this.nostrLoginAuthenticator.authenticate(e)}async showNostrLoginDialog(){const e=fA;if(!e.isInitialized)throw new Error("nostr-login is not initialized");try{await e.showLogin()}catch(n){if(!(n instanceof Error&&n.message==="Cancelled"))throw console.error("nostr-loginでエラー:",n),n}}logout(){try{if(this.publicKeyState.currentIsNostrLogin&&this.nostrLoginMgr.isInitialized)try{this.nostrLoginMgr.logout()}catch(e){console.error("nostr-loginログアウト中にエラー:",e)}try{const e=localStorage.getItem("firstVisit");localStorage.clear(),e&&localStorage.setItem("firstVisit",e)}catch(e){console.error("ローカルストレージクリア中にエラー:",e)}this.profileCacheCleaner.clearProfileImageCache().catch(e=>{console.error("プロフィール画像キャッシュクリア中にエラー:",e)}),setTimeout(()=>{try{typeof window<"u"&&window.location&&typeof window.location.replace=="function"?window.location.replace(window.location.pathname):typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(e){console.error("ページリロード中にエラー:",e)}},500)}catch(e){console.error("ログアウト処理中に予期しないエラー:",e),setTimeout(()=>{try{typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(n){console.error("ページリロード中にエラー:",n)}},2e3)}}async initializeAuth(){return await this.authInitializer.initialize(this.nostrLoginOptions)}getPublicKeyState(){return this.publicKeyState}setNostrLoginHandler(e){this.nostrLoginMgr.setAuthHandler(e)}markAuthInitialized(){IU()}getNsecAuthenticator(){return this.nsecAuthenticator}getNostrLoginAuthenticator(){return this.nostrLoginAuthenticator}getProfileCacheCleaner(){return this.profileCacheCleaner}getAuthInitializer(){return this.authInitializer}}const Po=new Yte;var Jte=je('<div><div class="balloon-message svelte-q1o25a"> </div></div>');function Xte(t,e){let n=dt(e,"type",3,"success"),r=dt(e,"message",3,"");var i=Jte(),s=pe(i),o=pe(s);Je(()=>{ri(i,1,`balloon-message-wrapper ${n()??""}`,"svelte-q1o25a"),Ye(o,r())}),we(t,i)}class o8{constructor(e){this.$_=e}showTimeout=null;lastMessageTime=0;debounceDelay=500;getRandomInfoMessage(){const e=rH,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getRandomSuccessMessage(){const e=iH,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getErrorMessage(){return this.$_(sH)??""}createMessage(e,n,r=!1){const i=Date.now();if(!r&&i-this.lastMessageTime<this.debounceDelay)return{type:e,message:""};this.lastMessageTime=i;let s=n;if(!s)switch(e){case"info":s=this.getRandomInfoMessage();break;case"success":s=this.getRandomSuccessMessage();break;case"error":s=this.getErrorMessage();break;default:s=""}return{type:e,message:s}}scheduleHide(e,n=3e3){this.showTimeout&&clearTimeout(this.showTimeout),this.showTimeout=setTimeout(e,n)}cancelScheduledHide(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}createMessageImmediate(e,n){return this.createMessage(e,n,!0)}dispose(){this.cancelScheduledHide(),this.lastMessageTime=0}}var Qte=je('<div class="trash-icon svg-icon svelte-18r58hh"></div>'),ene=je('<div class="image-icon svg-icon svelte-18r58hh"></div>'),tne=je('<div class="plane-icon svg-icon svelte-18r58hh"></div>'),nne=je('<div class="header-container svelte-18r58hh"><div class="header-left svelte-18r58hh"><a href="https://lokuyow.github.io/ehagaki/" rel="noopener noreferrer" class="site-icon-link svelte-18r58hh" aria-label="ehagaki"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-18r58hh"/></a> <!></div> <div class="post-actions svelte-18r58hh"><div class="buttons-container svelte-18r58hh"><!> <!> <!></div></div></div>  <label id="vibrateSwitch" style="display: none;" aria-hidden="true"><input type="checkbox" checked/></label>',1);function rne(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii();let s=dt(e,"balloonMessage",3,null),o=null;qe(()=>{n()&&!o&&(o=new o8(n()))});let a=Se(!1);qe(()=>$i.subscribe(q=>{se(a,q&&q.isAuthenticated,!0)}));let l=Qe(()=>Qt.postStatus),c=Qe(()=>Qt.isUploading),u=Qe(()=>Qt.canPost),f=Se(!1);qe(()=>{$(l).sending?se(f,!0):$(f)&&setTimeout(()=>{se(f,!1)},400)});let d=Se(null),h=Se(!1);function p(){o&&!$(h)&&(se(d,o.createMessage("success"),!0),se(h,!0),o.scheduleHide(()=>{se(d,null),se(h,!1),Ls({...Qt.postStatus,success:!1,message:"",completed:!1})},3e3))}qe(()=>{$(l).success&&$(l).completed&&!$(d)&&!$(h)&&p()}),qe(()=>{(!$(l).success||!$(l).completed)&&($(d)||$(h))&&(se(d,null),se(h,!1),o&&o.cancelScheduledHide())});let g=Qe(()=>$(l).error&&o!==null?o.createMessage("error"):null),m=Se(null);const v=typeof window<"u"&&(window.location.port==="4173"||window.location.hostname==="localhost");let x=Se(null);qe(()=>{if(typeof window<"u"&&o){const L=new URLSearchParams(window.location.search),q=L.get("error");if(q&&L.get("shared")==="true"){if(["processing-error","no-image","upload-failed","network-error","client-error"].includes(q)){setTimeout(()=>{const Z=new URL(window.location.href);Z.searchParams.delete("error"),Z.searchParams.delete("shared"),window.history.replaceState({},"",Z.toString())},1e3);return}let j="";switch(q){case"messaging-error":j="Service Workerとの通信でエラーが発生しました。ページを更新してもう一度お試しください。";break;case"window-error":j="新しいウィンドウの作成に失敗しました";break;default:setTimeout(()=>{const Z=new URL(window.location.href);Z.searchParams.delete("error"),Z.searchParams.delete("shared"),window.history.replaceState({},"",Z.toString())},1e3);return}se(x,{type:"error",message:j},!0),setTimeout(()=>{const Z=new URL(window.location.href);Z.searchParams.delete("error"),Z.searchParams.delete("shared"),window.history.replaceState({},"",Z.toString()),setTimeout(()=>{se(x,null)},5e3)},1e3)}}}),v&&(window.showInfoBalloonDebug=L=>{se(m,{type:"info",message:L},!0)},window.hideInfoBalloonDebug=()=>{se(m,null)});let C=Qe(()=>$(x)||(v?$(m)||s()||$(g)||$(d):s()||$(g)||$(d)));qe(()=>()=>{o&&o.dispose()});let N=Se(void 0);qe(()=>{$(N)&&$(N).setAttribute("switch","")});var O=nne(),A=vt(O),P=pe(A),S=Me(pe(P),2);{var E=L=>{Xte(L,{get type(){return $(C).type},get message(){return $(C).message}})};rt(S,L=>{$(C)&&L(E)})}var _=Me(P,2),k=pe(_),D=pe(k);{let L=Qe(()=>!$(u)||$(l).sending||$(c)||$(f)),q=Qe(()=>n()("postComponent.clear_editor"));Gt(D,{variant:"header",shape:"square",className:"clear-button",get disabled(){return $(L)},get onClick(){return e.onResetPostContent},get ariaLabel(){return $(q)},children:(F,j)=>{var Z=Qte();we(F,Z)},$$slots:{default:!0}})}var U=Me(D,2);{let L=Qe(()=>!$(a)||$(l).sending||$(c)||$(f)),q=Qe(()=>n()("postComponent.upload_image"));Gt(U,{variant:"header",shape:"square",className:"image-button",get disabled(){return $(L)},get onClick(){return e.onUploadImage},get ariaLabel(){return $(q)},children:(F,j)=>{var Z=ene();we(F,Z)},$$slots:{default:!0}})}var B=Me(U,2);{let L=Qe(()=>$(f)?"loading":""),q=Qe(()=>!$(u)||$(l).sending||$(c)||!$(a)||$(l).completed),F=Qe(()=>n()("postComponent.post"));Gt(B,{variant:"header",shape:"square",get className(){return`post-button ${$(L)??""}`},get disabled(){return $(q)},onClick:()=>{gH(30),II()},get ariaLabel(){return $(F)},children:(j,Z)=>{var J=Xt(),ue=vt(J);{var ae=be=>{ma(be,{showLoader:!0,text:!1,customClass:"post-button-loading"})},X=be=>{var De=tne();we(be,De)};rt(ue,be=>{$(f)?be(ae):be(X,!1)})}we(j,J)},$$slots:{default:!0}})}var M=Me(A,2),T=pe(M);Rn(T,L=>se(N,L),()=>$(N)),we(t,O),fn(),i()}var ine=je("<img/>"),sne=je('<div class="profile-picture default svg-icon svelte-cux0j3" aria-label="User"></div>'),one=je('<!> <span class="profile-name svelte-cux0j3"> </span>',1);function ane(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii(),s=!1;let o=dt(e,"profileData",3,null),a=dt(e,"hasStoredKey",3,!1),l=dt(e,"isLoadingProfile",3,!1),c=Se(!1);const u=()=>o()?.name?o().name:o()?.npub?o().npub:"User",f=()=>o()?.name&&o().name!==""?o().name:o()?.npub?o().npub:"User";function d(N){console.log("プロフィール画像の読み込みに失敗しました:",N),se(c,!0),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&console.log("Service Workerによるキャッシュ処理の可能性があります")}qe(()=>{o()?.picture?(se(c,!1),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&o().picture.includes("profile=true")&&console.log("Service Workerでプロフィール画像をキャッシュ処理予定:",o().picture),se(p,h(o().picture),!0)):se(p,!1)});function h(N){if(!N)return!1;try{return new URL(N,location.href).origin===location.origin}catch{return!1}}let p=Se(!1);var g={profileLoaded:s,isSameOriginPictureUrl:h},m=Xt(),v=vt(m);{var x=N=>{{let O=Qe(()=>`profile-display${l()?" loading":""}`);Gt(N,{variant:"default",shape:"pill",get className(){return $(O)},get disabled(){return l()},onClick:()=>{l()||e.showLogoutDialog()},children:(A,P)=>{var S=Xt(),E=vt(S);{var _=D=>{{let U=Qe(()=>n()("loading"));ma(D,{get text(){return $(U)},showImage:!0})}},k=D=>{var U=one(),B=vt(U);{var M=F=>{var j=ine();s_(j,Z=>({src:o().picture,alt:Z,class:"profile-picture",loading:"lazy",...$(p)?{crossorigin:"anonymous",referrerpolicy:"no-referrer"}:{},onerror:d}),[u],void 0,"svelte-cux0j3"),we(F,j)},T=F=>{var j=sne();we(F,j)};rt(B,F=>{o()?.picture&&!$(c)?F(M):F(T,!1)})}var L=Me(B,2),q=pe(L);Je(F=>Ye(q,F),[f]),we(D,U)};rt(E,D=>{l()?D(_):D(k,!1)})}we(A,S)},$$slots:{default:!0}})}};rt(v,N=>{a()&&N(x)})}we(t,m);var C=fn(g);return i(),C}async function dA(t,e,n){try{t?.preventDefault()}catch{}try{const r=[...e()].reverse();await bY(r),(r?.length??0)>0&&(se(n,!0),setTimeout(()=>se(n,!1),1500))}catch(r){console.warn("dev log copy failed:",r)}}var lne=je('<li class="svelte-jjlhed"> </li>'),cne=je('<button type="button" class="floating-dev-console-log svelte-jjlhed" title="タップで全コピー" aria-label="開発者ログをコピー"><ul class="svelte-jjlhed"></ul></button>'),une=je('<div class="shared-image-error svelte-jjlhed"><div class="error-text svelte-jjlhed"> </div></div>'),fne=je('<div class="stop-icon svg-icon"></div>'),dne=je('<div class="compression-container svelte-jjlhed"><!> <div class="upload-progress svelte-jjlhed"><div class="progress-text svelte-jjlhed"> </div> <div class="progress-bar svelte-jjlhed"><div class="progress-fill svelte-jjlhed"></div></div></div></div>'),hne=je('<div class="stop-icon svg-icon"></div>'),pne=je('<div class="compression-container svelte-jjlhed"><!> <div class="upload-progress svelte-jjlhed"><div class="progress-text svelte-jjlhed"> </div> <div class="progress-bar svelte-jjlhed"><div class="progress-fill svelte-jjlhed"></div></div></div></div>'),gne=je('<div class="stop-icon svg-icon"></div>'),mne=je('<div class="compression-container svelte-jjlhed"><!> <div class="upload-progress svelte-jjlhed"><div class="progress-text svelte-jjlhed"> <!> <!></div> <div class="progress-bar svelte-jjlhed"><div class="progress-fill svelte-jjlhed"></div></div></div></div>'),yne=je('<div class="upload-progress svelte-jjlhed"><div class="progress-text svelte-jjlhed"> <!> <!></div> <div class="progress-bar svelte-jjlhed"><div class="progress-fill svelte-jjlhed"></div></div></div>'),bne=je(" <br/> <!>",1),vne=je('<div class="image-size-info svelte-jjlhed"><div class="size-label svelte-jjlhed"> </div> <div class="size-details svelte-jjlhed"><!></div></div>'),wne=je('<!> <div class="footer-center svelte-jjlhed"><!></div>',1);function Ene(t,e){un(e,!0);const n=()=>_n(Nw,"$devLog",i),r=()=>_n(mr,"$_",i),[i,s]=ii();let o=Se(!1),a=Se(null);qe(()=>{if(typeof window<"u"){const F=new URLSearchParams(window.location.search),j=F.get("error");if(j&&F.get("shared")==="true"){const Z=()=>{const J=localStorage.getItem("sharedImageProcessed")==="1",X=!new URLSearchParams(window.location.search).get("error");return J||X};if(Z()){console.log("Shared image was processed successfully, ignoring error parameter");return}setTimeout(()=>{if(Z()){console.log("Shared image processing detected after delay, not showing error");return}let J="";switch(j){case"processing-error":J="共有画像の処理中にエラーが発生しました";break;case"no-image":J="共有画像が見つかりませんでした";break;case"upload-failed":J="画像のアップロードに失敗しました";break;case"network-error":J="ネットワークエラーが発生しました";break;case"client-error":J="画像共有処理でエラーが発生しました";break;default:return}se(a,J,!0),setTimeout(()=>{const ue=new URL(window.location.href);ue.searchParams.delete("error"),ue.searchParams.delete("shared"),window.history.replaceState({},"",ue.toString()),setTimeout(()=>{se(a,null)},5e3)},1e3)},100)}}});let l=dt(e,"uploadProgress",31,()=>Et({total:0,completed:0,failed:0,aborted:0,inProgress:!1})),c=Qe(()=>_u.value),u=Qe(()=>ku.value),f=Se(null),d=Se(0),h=null;qe(()=>{$(c)>0&&$(c)<100?$(f)||(se(f,Date.now(),!0),E({imageSizeInfoOnly:!0}),h=window.setInterval(()=>{$(f)&&se(d,Math.floor((Date.now()-$(f))/1e3),!0)},1e3)):(h!==null&&(clearInterval(h),h=null),se(f,null),se(d,0))}),qe(()=>{$(u)>0&&$(u)<100?$(f)||(se(f,Date.now(),!0),E({imageSizeInfoOnly:!0}),h=window.setInterval(()=>{$(f)&&se(d,Math.floor((Date.now()-$(f))/1e3),!0)},1e3)):(h!==null&&(clearInterval(h),h=null),se(f,null),se(d,0))});let p=Qe(()=>zl.value.info),g=Qe(()=>zl.value.visible),m=Se(!1);qe(()=>{l().inProgress&&!$(m)&&E({imageSizeInfoOnly:!0}),se(m,l().inProgress,!0)});function v(F){if(F<60)return`${F}s`;const j=Math.floor(F/60),Z=F%60;return`${j}m ${Z}s`}function x(){_u.set(0),ku.set(0),h!==null&&(clearInterval(h),h=null),se(f,null),se(d,0),l({total:0,completed:0,failed:0,aborted:0,inProgress:!1});const j=TI.value;j&&uI(j,!1),CU()}function C(){x()}function N(){x()}function O(F){if(!F)return"";const j=F.match(/\.([a-zA-Z0-9]+)$/);if(!j)return"";const Z=j[1].toUpperCase();return Z==="JPEG"?"JPG":Z}function A(){return typeof window>"u"?"medium":localStorage.getItem("videoCompressionLevel")||"medium"}function P(F){switch(F){case"none":return r()("settingsDialog.compression_none");case"low":return r()("settingsDialog.compression_low");case"medium":return r()("settingsDialog.compression_medium");case"high":return r()("settingsDialog.compression_high");default:return r()("settingsDialog.compression_medium")}}function S(F){l(F),!F.inProgress&&F.total>0&&setTimeout(()=>{l({total:0,completed:0,failed:0,aborted:0,inProgress:!1})},1e3)}function E(F){if(F?.imageSizeInfoOnly){zl.set({info:null,visible:!1});return}l({total:0,completed:0,failed:0,aborted:0,inProgress:!1}),_u.set(0),ku.set(0),h!==null&&(clearInterval(h),h=null),se(f,null),se(d,0),zl.set({info:null,visible:!1}),se(a,null)}var _={updateProgress:S,reset:E},k=wne(),D=vt(k);{var U=F=>{var j=cne();j.__click=[dA,n,o],j.__touchend=[dA,n,o];var Z=pe(j);Hl(Z,5,()=>[...n()].reverse(),du,(J,ue)=>{var ae=lne(),X=pe(ae);Je(()=>Ye(X,$(ue))),we(J,ae)}),we(F,j)};rt(D,F=>{zI()&&n().length&&F(U)})}var B=Me(D,2),M=pe(B);{var T=F=>{var j=une(),Z=pe(j),J=pe(Z);Je(()=>Ye(J,$(a))),we(F,j)},L=F=>{var j=Xt(),Z=vt(j);{var J=ae=>{var X=dne(),be=pe(X);Gt(be,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"圧縮中止",onClick:N,children:(Ee,ve)=>{var Oe=fne();we(Ee,Oe)},$$slots:{default:!0}});var De=Me(be,2),de=pe(De),ke=pe(de),Ze=Me(de,2),me=pe(Ze);Je((Ee,ve)=>{Ye(ke,`${Ee??""}: ${$(u)??""}%
                    (${ve??""})`),Wo(me,`width: ${$(u)??""}%`)},[()=>r()("imageCompression.compressing"),()=>v($(d))]),we(ae,X)},ue=ae=>{var X=Xt(),be=vt(X);{var De=ke=>{var Ze=pne(),me=pe(Ze);Gt(me,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"圧縮中止",onClick:C,children:(He,it)=>{var at=hne();we(He,at)},$$slots:{default:!0}});var Ee=Me(me,2),ve=pe(Ee),Oe=pe(ve),Re=Me(ve,2),nt=pe(Re);Je((He,it,at)=>{Ye(Oe,`${He??""}${it??""}: ${$(c)??""}%
                    (${at??""})`),Wo(nt,`width: ${$(c)??""}%`)},[()=>P(A()),()=>r()("videoCompressionLabelSuffix"),()=>v($(d))]),we(ke,Ze)},de=ke=>{var Ze=Xt(),me=vt(Ze);{var Ee=Oe=>{var Re=Xt(),nt=vt(Re);{var He=at=>{var At=mne(),ht=pe(At);Gt(ht,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"アップロード中止",onClick:N,children:(_t,xt)=>{var Ht=gne();we(_t,Ht)},$$slots:{default:!0}});var Tt=Me(ht,2),Ce=pe(Tt),Be=pe(Ce),ot=Me(Be);{var ct=_t=>{var xt=Wn();Je(Ht=>Ye(xt,`(${Ht??""}: ${l().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),we(_t,xt)};rt(ot,_t=>{l().failed>0&&_t(ct)})}var Zt=Me(ot,2);{var Ut=_t=>{var xt=Wn();Je(Ht=>Ye(xt,`(${Ht??""}: ${l().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),we(_t,xt)};rt(Zt,_t=>{l().aborted>0&&_t(Ut)})}var jt=Me(Ce,2),Nt=pe(jt);Je((_t,xt)=>{Ye(Be,`${_t??""}: ${l().completed??""}/${l().total??""} `),Wo(Nt,`width: ${xt??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>l().total>0?Math.round(l().completed/l().total*100):0]),we(at,At)},it=at=>{var At=yne(),ht=pe(At),Tt=pe(ht),Ce=Me(Tt);{var Be=jt=>{var Nt=Wn();Je(_t=>Ye(Nt,`(${_t??""}: ${l().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),we(jt,Nt)};rt(Ce,jt=>{l().failed>0&&jt(Be)})}var ot=Me(Ce,2);{var ct=jt=>{var Nt=Wn();Je(_t=>Ye(Nt,`(${_t??""}: ${l().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),we(jt,Nt)};rt(ot,jt=>{l().aborted>0&&jt(ct)})}var Zt=Me(ht,2),Ut=pe(Zt);Je((jt,Nt)=>{Ye(Tt,`${jt??""}: ${l().completed??""}/${l().total??""} `),Wo(Ut,`width: ${Nt??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>l().total>0?Math.round(l().completed/l().total*100):0]),we(at,At)};rt(nt,at=>{l().inProgress?at(He):at(it,!1)})}we(Oe,Re)},ve=Oe=>{var Re=Xt(),nt=vt(Re);{var He=it=>{var at=vne(),At=pe(at),ht=pe(At),Tt=Me(At,2),Ce=pe(Tt);{var Be=ot=>{var ct=bne(),Zt=vt(ct),Ut=Me(Zt,2),jt=Me(Ut);{var Nt=xt=>{var Ht=Wn();Je(Cn=>Ye(Ht,Cn),[()=>r()("footerInfoDisplay.no_compression")||"圧縮なし"]),we(xt,Ht)},_t=xt=>{var Ht=Xt(),Cn=vt(Ht);{var Qn=oi=>{var Cr=Wn();Je(()=>Ye(Cr,`${$(p).compressedSize??""}
                        (${$(p).compressionRatio??""}%)`)),we(oi,Cr)},kr=oi=>{var Cr=Wn();Je(()=>Ye(Cr,`${$(p).compressedSize??""}
                        (${$(p).compressionRatio??""}%)`)),we(oi,Cr)};rt(Cn,oi=>{$(p).wasCompressed?oi(Qn):oi(kr,!1)},!0)}we(xt,Ht)};rt(jt,xt=>{$(p).wasSkipped?xt(Nt):xt(_t,!1)})}Je((xt,Ht)=>{Ye(Zt,`${xt??""}
                    ${$(p).originalSize??""}`),Ye(Ut,` → ${Ht??""} `)},[()=>O($(p).originalFilename),()=>O($(p).compressedFilename)]),we(ot,ct)};rt(Ce,ot=>{$(p).originalFilename&&$(p).compressedFilename&&ot(Be)})}Je(ot=>Ye(ht,`${ot??""}:`),[()=>r()("footerInfoDisplay.data_size")]),we(it,at)};rt(nt,it=>{$(g)&&$(p)&&it(He)},!0)}we(Oe,Re)};rt(me,Oe=>{l().inProgress||l().total>0?Oe(Ee):Oe(ve,!1)},!0)}we(ke,Ze)};rt(be,ke=>{$(c)>0&&$(c)<100?ke(De):ke(de,!1)},!0)}we(ae,X)};rt(Z,ae=>{$(u)>0&&$(u)<100?ae(J):ae(ue,!1)},!0)}we(F,j)};rt(M,F=>{$(a)?F(T):F(L,!1)})}we(t,k);var q=fn(_);return s(),q}Ci(["click","touchend"]);var xne=je('<div class="update-indicator svelte-a01dso"></div>'),Sne=je('<div class="settings-icon svg-icon svelte-a01dso" aria-label="Settings"></div> <!>',1),Ane=je('<div class="footer-bar svelte-a01dso"><!> <!> <!></div>');function _ne(t,e){un(e,!0);const n=()=>_n(mr,"$_",r),[r,i]=ii();let s=Se(void 0);function o(m){$(s)?.updateProgress(m)}function a(){$(s)?.reset()}var l={updateProgress:o,reset:a},c=Ane(),u=pe(c);{var f=m=>{Gt(m,{shape:"pill",className:"profile-display loading",disabled:!0,children:(v,x)=>{ma(v,{text:!0,showImage:!0})},$$slots:{default:!0}})},d=m=>{var v=Xt(),x=vt(v);{var C=O=>{Gt(O,{shape:"pill",className:"profile-display loading",disabled:!0,children:(A,P)=>{ma(A,{text:!0,showImage:!0})},$$slots:{default:!0}})},N=O=>{var A=Xt(),P=vt(A);{var S=_=>{ane(_,{get profileData(){return e.profileData},get hasStoredKey(){return e.isAuthenticated},get isLoadingProfile(){return e.isLoadingProfile},get showLogoutDialog(){return e.onOpenLogoutDialog}})},E=_=>{var k=Xt(),D=vt(k);{var U=B=>{Gt(B,{className:"login-btn",variant:"primary",shape:"pill",get onClick(){return e.onShowLoginDialog},children:(M,T)=>{var L=Wn();Je(q=>Ye(L,q),[()=>n()("app.login")]),we(M,L)},$$slots:{default:!0}})};rt(D,B=>{!e.isLoadingProfile&&!e.isAuthenticated&&B(U)},!0)}we(_,k)};rt(P,_=>{e.isAuthenticated&&(e.profileLoaded||e.isLoadingProfile)?_(S):_(E,!1)},!0)}we(O,A)};rt(x,O=>{e.isAuthenticated&&e.isLoadingProfile?O(C):O(N,!1)},!0)}we(m,v)};rt(u,m=>{e.isAuthInitialized?m(d,!1):m(f)})}var h=Me(u,2);Rn(Ene(h,{}),m=>se(s,m,!0),()=>$(s));var p=Me(h,2);{let m=Qe(()=>e.swNeedRefresh?"has-update":"");Gt(p,{variant:"default",shape:"circle",get className(){return`settings-btn ${$(m)??""}`},get onClick(){return e.onOpenSettingsDialog},ariaLabel:"設定",children:(v,x)=>{var C=Sne(),N=Me(vt(C),2);{var O=A=>{var P=xne();we(A,P)};rt(N,A=>{e.swNeedRefresh&&A(O)})}we(v,C)},$$slots:{default:!0}})}we(t,c);var g=fn(l);return i(),g}class kne{fileUploadManager;isProcessingSharedImage=!1;constructor(e){this.fileUploadManager=new jI(e),this.setupServiceWorkerListeners()}setupServiceWorkerListeners(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}handleServiceWorkerMessage(e){const{data:n,type:r}=e.data||{};r==="SHARED_IMAGE"&&n?.image&&PE(n.image,n.metadata)}checkIfOpenedFromShareInternal(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).get("shared")==="true"}async checkForSharedImageOnLaunch(){if(this.isProcessingSharedImage)return{success:!1,error:"既に処理中です"};if(!this.checkIfOpenedFromShareInternal())return{success:!1,error:"共有経由での起動ではありません"};this.isProcessingSharedImage=!0;try{const e=await this.fileUploadManager.processSharedImageOnLaunch();return e.success&&e.data&&PE(e.data.image,e.data.metadata),e}finally{this.isProcessingSharedImage=!1}}async getSharedImageFromServiceWorker(){return await this.fileUploadManager.getSharedImageFromServiceWorker()}checkIfOpenedFromShare(){return this.fileUploadManager.checkIfOpenedFromShare()}isProcessing(){return this.isProcessingSharedImage}getSharedImageFile(){return $U()}getSharedImageMetadata(){return NU()}clearSharedImage(){OU()}}let Y0=null;function Cne(){return Y0||(Y0=new kne),Y0}function hA(){return Cne().checkIfOpenedFromShare()}function Tne(){if(typeof window>"u"||!window.location)return null;const e=new URLSearchParams(window.location.search).get("content");if(!e)return null;try{const n=decodeURIComponent(e);return lI(n)}catch(n){return console.error("URLクエリパラメータのデコードに失敗:",n),null}}function Ine(){if(typeof window>"u"||!window.location)return;const t=new URLSearchParams(window.location.search),e=[];let n=!1;if(t.has("content")){const i=t.get("content");(!i||i.trim()==="")&&(n=!0),t.delete("content"),n=!0}const r=[];if(t.forEach((i,s)=>{e.includes(s)||(r.push(s),n=!0)}),r.forEach(i=>t.delete(i)),n){const i=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",i)}}function One(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).has("content")}var Mne=je('<main class="svelte-830cve"><div class="main-content svelte-830cve"><!> <!></div> <!> <!> <!> <!> <!></main>');function Lne(t,e){un(e,!0);const n=()=>_n(Di,"$locale",s),r=()=>_n(mr,"$_",s),i=()=>_n(Zv,"$swNeedRefresh",s),[s,o]=ii();let a=Se(""),l=Se("");const c=Po.getPublicKeyState();qe(()=>{c.setNsec($(l))}),qe(()=>{Au.value&&(se(l,""),se(a,""))});let u=Qe(()=>$i.value?.isAuthenticated??!1),f=Qe(()=>$i.value?.isInitialized??!1),d=!1,h="";if(!d){const ve=localStorage.getItem("nsec"),Oe=localStorage.getItem("__nostrlogin_nip46");if(!ve){if(Oe)try{const Re=JSON.parse(Oe);Re?.pubkey&&(h=Re.pubkey)}catch{}}d=!0}let p=Se(void 0),g,m,v=Se(!1),x=Se(void 0),C=Se(void 0),N=Se(!1);async function O(ve){se(p,K6({verifier:iP}),!0),g=new PF($(p)),m=new BF($(p),{relayListUpdatedStore:{value:Uy.value,set:Oe=>Uy.set(Oe)}}),ci.set(!0),ve&&m.useRelaysFromLocalStorageIfExists(ve)||m.setBootstrapRelays(),ci.set(!1)}async function A(ve){const Oe=await Po.authenticateWithNostrLogin(ve);if(!Oe.success){console.error("nostr-login認証失敗:",Oe.error);return}if(Oe.pubkeyHex){se(v,!0),ci.set(!0),Jm();try{await O(),await m.fetchUserRelays(Oe.pubkeyHex),await P(Oe.pubkeyHex)}catch(Re){console.error("nostr-login認証処理中にエラー:",Re),ci.set(!1)}finally{se(v,!1),ci.set(!1)}}}async function P(ve,Oe){if(ve){(!m||!g)&&await O(),ci.set(!0);try{const Re=await g.fetchProfileData(ve,Oe);Re&&(jm.set(Re),Vm.set(!0))}catch(Re){console.error("プロフィール読み込み中にエラー:",Re)}finally{ci.set(!1)}}}async function S(){const ve=await Po.authenticateWithNsec($(l));if(!ve.success){se(a,ve.error||"authentication_error",!0);return}ci.set(!0),Jm(),se(a,"");try{ve.pubkeyHex?(m&&!m.useRelaysFromLocalStorageIfExists(ve.pubkeyHex)&&await m.fetchUserRelays(ve.pubkeyHex),await P(ve.pubkeyHex)):ci.set(!1)}catch{ci.set(!1)}}function E(){se(N,!0),Po.logout(),jm.set({name:"",picture:""}),Vm.set(!1),$(x)?.resetPostContent&&$(x).resetPostContent(),nC(),se(l,""),se(a,"")}async function _(){se(v,!0);try{await Po.showNostrLoginDialog()}catch(ve){ve instanceof Error&&ve.message==="Cancelled"||console.error("nostr-loginでエラー:",ve)}finally{se(v,!1)}}qe(()=>{n()&&localStorage.setItem("locale",n())}),qe(()=>{if(n()){const ve=r()("postComponent.enter_your_text")||"テキストを入力してください";TS(ve)}});let k=Se(!1);const D=localStorage.getItem("sharedImageProcessed")==="1";Ti(()=>((async()=>{const Oe=localStorage.getItem("locale");Oe&&Oe!==n()&&Di.set(Oe),await FR(),se(k,!0);const Re=r()("postComponent.enter_your_text")||"テキストを入力してください";if(TS(Re),Po.setNostrLoginHandler(A),hA()){const He=await TF(),it=await IF();(!He.isReady||!He.hasController||!it)&&console.warn("Service Worker not ready for shared image processing:",He)}if((async()=>{try{const He=await Po.initializeAuth();He.hasAuth&&He.pubkeyHex?(await O(He.pubkeyHex),await P(He.pubkeyHex)):await O()}catch(He){console.error("認証初期化中にエラー:",He),await O()}finally{ci.set(!1),Po.markAuthInitialized()}})(),hA()&&!D)try{const He=await CF();if(He?.image)qn.file=He.image,qn.metadata=He.metadata,qn.received=!0,localStorage.setItem("sharedImageProcessed","1");else{console.warn("No shared image data received");const at=new URLSearchParams(window.location.search).get("error");at&&console.error("Shared image processing failed with error parameter:",{error:at,location:window.location.href})}}catch(He){console.error("共有画像の処理中にエラー:",He)}if(localStorage.getItem("firstVisit")!=="1"?(nu.set(!0),localStorage.setItem("firstVisit","1")):setTimeout(()=>{$(x)?.focusEditor()},300),One()){const He=Tne();He&&MU(He)}Ine()})(),ue=document.visibilityState==="hidden",document.addEventListener("visibilitychange",X),()=>{document.removeEventListener("visibilitychange",X)})),qe(()=>{qn.received&&qn.file&&$(x)&&($(x).uploadFiles([qn.file]),qn.file=null,qn.metadata=void 0,qn.received=!1,localStorage.setItem("sharedImageProcessed","1"),setTimeout(()=>localStorage.removeItem("sharedImageProcessed"),500))}),qe(()=>{Xa.received&&Xa.content&&$(x)&&($(x).insertTextContent(Xa.content),LU())});function U(ve){RU.set(ve)}function B(ve){$(C)&&$(C).updateProgress(ve)}function M(){$(C)?.reset&&$(C).reset(),localStorage.removeItem("sharedImageProcessed")}function T(){$(x)?.resetPostContent()}let L=null;async function q(){!$(u)||!$i.value.pubkey||((!m||!g)&&await O($i.value.pubkey),m&&await m.fetchUserRelays($i.value.pubkey,{forceRemote:!0}),g&&(g.saveToLocalStorage($i.value.pubkey,null),await P($i.value.pubkey,{forceRemote:!0})))}let F=Se(!1),j=Se(null),Z=Se(!1);qe(()=>{r()&&!L&&(L=new o8(r()))}),qe(()=>{$(k)&&L&&!$(F)&&!$(Z)&&(J(),se(Z,!0))});function J(){!L||$(F)||(se(j,L.createMessage("info"),!0),se(F,!0),L.scheduleHide(()=>{se(F,!1),se(j,null)},3e3))}let ue=!1,ae=0;function X(){const ve=Date.now();if(ve-ae<1e3){ue=document.visibilityState==="hidden";return}document.visibilityState==="visible"&&ue&&$(k)&&L&&!$(F)&&(J(),ae=ve),ue=document.visibilityState==="hidden"}let be=Se(Et(localStorage.getItem("imageCompressionLevel")||"medium"));function De(ve){se(be,ve,!0)}let de=Se(Et(localStorage.getItem("uploadEndpoint")||Yv(n())));function ke(ve){se(de,ve,!0)}qe(()=>()=>{L&&L.dispose()});var Ze=Xt(),me=vt(Ze);{var Ee=ve=>{var Oe=Mne(),Re=pe(Oe),nt=pe(Re);{let ct=Qe(()=>$(F)&&$(j)?$(j):null);rne(nt,{onUploadImage:()=>$(x)?.openFileDialog(),onResetPostContent:T,get balloonMessage(){return $(ct)}})}var He=Me(nt,2);Rn(dJ(He,{get rxNostr(){return $(p)},get hasStoredKey(){return $(u)},onPostSuccess:M,onUploadStatusChange:U,onUploadProgress:B}),ct=>se(x,ct,!0),()=>$(x));var it=Me(Re,2);Rn(_ne(it,{get isAuthenticated(){return $(u)},get isAuthInitialized(){return $(f)},get isLoadingProfile(){return ci.value},get profileLoaded(){return Vm.value},get profileData(){return jm.value},get swNeedRefresh(){return i()},get onShowLoginDialog(){return BU},get onOpenSettingsDialog(){return FU},get onOpenLogoutDialog(){return UU}}),ct=>se(C,ct,!0),()=>$(C));var at=Me(it,2);{var At=ct=>{Rte(ct,{get show(){return Au.value},get onClose(){return Jm},onSave:S,onNostrLogin:_,get isLoadingNostrLogin(){return $(v)},get secretKey(){return $(l)},set secretKey(Zt){se(l,Zt,!0)}})};rt(at,ct=>{Au.value&&ct(At)})}var ht=Me(at,2);{var Tt=ct=>{Cte(ct,{get show(){return ah.value},get onClose(){return HU},onLogout:E,get isLoggingOut(){return $(N)}})};rt(ht,ct=>{ah.value&&ct(Tt)})}var Ce=Me(ht,2);{var Be=ct=>{Bte(ct,{get show(){return nu.value},onClose:()=>nu.set(!1)})};rt(Ce,ct=>{nu.value&&ct(Be)})}var ot=Me(Ce,2);_te(ot,{get show(){return Gv.value},get onClose(){return zU},onRefreshRelaysAndProfile:q,get selectedCompression(){return $(be)},onSelectedCompressionChange:De,get selectedEndpoint(){return $(de)},onSelectedEndpointChange:ke,onOpenWelcomeDialog:()=>nu.set(!0)}),we(ve,Oe)};rt(me,ve=>{n()&&$(k)&&ve(Ee)})}we(t,Ze),fn(),o()}JA(Lne,{target:document.getElementById("app")});
