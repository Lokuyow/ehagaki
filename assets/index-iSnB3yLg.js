(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const WA=!1;var Eh=Array.isArray,ZD=Array.prototype.indexOf,J1=Array.from,nm=Object.defineProperty,Pu=Object.getOwnPropertyDescriptor,qA=Object.getOwnPropertyDescriptors,KA=Object.prototype,QD=Array.prototype,Wg=Object.getPrototypeOf,ek=Object.isExtensible;const Oi=()=>{};function e2(t){for(var e=0;e<t.length;e++)t[e]()}function XD(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}const Li=2,t2=4,n2=8,bd=16,aa=32,$c=64,GA=128,Yi=256,rm=512,Br=1024,ns=2048,Ll=4096,Es=8192,Fc=16384,r2=32768,kh=65536,tk=1<<17,YD=1<<18,Th=1<<19,JD=1<<20,Qw=1<<21,i2=1<<22,pc=1<<23,Go=Symbol("$state"),eB=Symbol("legacy props"),tB=Symbol(""),s2=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function nB(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function o2(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function rB(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function iB(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function sB(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function oB(t){throw new Error("https://svelte.dev/e/effect_orphan")}function aB(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function lB(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function cB(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function uB(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function dB(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const qg=1,Kg=2,ZA=4,fB=8,hB=16,pB=1,mB=4,gB=8,yB=16,bB=1,wB=2,Jn=Symbol(),vB="http://www.w3.org/1999/xhtml",xB="http://www.w3.org/2000/svg",SB="@attach";function EB(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let kB=!1;function QA(t){return t===this.v}function a2(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function XA(t){return!a2(t,this.v)}let TB=!1;const _B=[];function CB(t,e=!1,n=!1){return Dp(t,new Map,"",_B,null,n)}function Dp(t,e,n,r,i=null,s=!1){if(typeof t=="object"&&t!==null){var o=e.get(t);if(o!==void 0)return o;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(Eh(t)){var a=Array(t.length);e.set(t,a),i!==null&&e.set(i,a);for(var l=0;l<t.length;l+=1){var c=t[l];l in t&&(a[l]=Dp(c,e,n,r,null,s))}return a}if(Wg(t)===KA){a={},e.set(t,a),i!==null&&e.set(i,a);for(var u in t)a[u]=Dp(t[u],e,n,r,null,s);return a}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return Dp(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let Ur=null;function im(t){Ur=t}function AB(t){return IB().get(t)}function Mn(t,e=!1,n){Ur={p:Ur,c:null,e:null,s:t,x:null,l:null}}function On(t){var e=Ur,n=e.e;if(n!==null){e.e=null;for(var r of n)pI(r)}return t!==void 0&&(e.x=t),Ur=e.p,t??{}}function YA(){return!0}function IB(t){return Ur===null&&o2(),Ur.c??=new Map(PB(Ur)||void 0)}function PB(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}const MB=new WeakMap;function OB(t){var e=Ut;if(e===null)return jt.f|=pc,t;if((e.f&r2)===0){if((e.f&GA)===0)throw!e.parent&&t instanceof Error&&JA(t),t;e.b.error(t)}else l2(t,e)}function l2(t,e){for(;e!==null;){if((e.f&GA)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t instanceof Error&&JA(t),t}function JA(t){const e=MB.get(t);e&&(nm(t,"message",{value:e.message}),nm(t,"stack",{value:e.stack}))}let Wf=[],Xw=[];function eI(){var t=Wf;Wf=[],e2(t)}function NB(){var t=Xw;Xw=[],e2(t)}function Gg(t){Wf.length===0&&queueMicrotask(eI),Wf.push(t)}function RB(){Wf.length>0&&eI(),Xw.length>0&&NB()}function LB(){for(var t=Ut.b;t!==null&&!t.has_pending_snippet();)t=t.parent;return t===null&&nB(),t}function Zg(t){var e=Li|ns,n=jt!==null&&(jt.f&Li)!==0?jt:null;return Ut===null||n!==null&&(n.f&Yi)!==0?e|=Yi:Ut.f|=Th,{ctx:Ur,deps:null,effects:null,equals:QA,f:e,fn:t,reactions:null,rv:0,v:Jn,wv:0,parent:n??Ut,ac:null}}function DB(t,e){let n=Ut;n===null&&rB();var r=n.b,i=void 0,s=Ku(Jn),o=null,a=!jt;return ZB(()=>{try{var l=t();o&&Promise.resolve(l).catch(()=>{})}catch(h){l=Promise.reject(h)}var c=()=>l;i=o?.then(c,c)??Promise.resolve(l),o=i;var u=gn,d=r.pending;a&&(r.update_pending_count(1),d||u.increment());const f=(h,p=void 0)=>{o=null,d||u.activate(),p?p!==s2&&(s.f|=pc,qf(s,p)):((s.f&pc)!==0&&(s.f^=pc),qf(s,h)),a&&(r.update_pending_count(-1),d||u.decrement()),sI()};if(i.then(f,h=>f(null,h||"unknown")),u)return()=>{queueMicrotask(()=>u.neuter())}}),new Promise(l=>{function c(u){function d(){u===i?l(s):c(i)}u.then(d,d)}c(i)})}function Xe(t){const e=Zg(t);return vI(e),e}function tI(t){const e=Zg(t);return e.equals=XA,e}function nI(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)wi(e[n])}}function BB(t){for(var e=t.parent;e!==null;){if((e.f&Li)===0)return e;e=e.parent}return null}function c2(t){var e,n=Ut;kl(BB(t));try{nI(t),e=kI(t)}finally{kl(n)}return e}function rI(t){var e=c2(t);if(t.equals(e)||(t.v=e,t.wv=SI()),!Uc){var n=(tl||(t.f&Yi)!==0)&&t.deps!==null?Ll:Br;pi(t,n)}}function iI(t,e,n){const r=Zg;if(e.length===0){n(t.map(r));return}var i=gn,s=Ut,o=$B(),a=LB();Promise.all(e.map(l=>DB(l))).then(l=>{i?.activate(),o();try{n([...t.map(r),...l])}catch(c){(s.f&Fc)===0&&l2(c,s)}i?.deactivate(),sI()}).catch(l=>{a.error(l)})}function $B(){var t=Ut,e=jt,n=Ur,r=gn;return function(){kl(t),ao(e),im(n),r?.activate()}}function sI(){kl(null),ao(null),im(null)}const zy=new Set;let gn=null,Bp=null,nk=new Set,sm=[];function oI(){const t=sm.shift();sm.length>0&&queueMicrotask(oI),t()}let Ec=[],Qg=null,Yw=!1,$p=!1;class Wu{current=new Map;#e=new Map;#t=new Set;#n=0;#s=null;#r=!1;#o=[];#i=[];#a=[];#l=[];#u=[];#c=[];#d=[];skipped_effects=new Set;process(e){Ec=[],Bp=null;for(const i of e)this.#g(i);if(this.#o.length===0&&this.#n===0){this.#h();var n=this.#a,r=this.#l;this.#a=[],this.#l=[],this.#u=[],Bp=gn,gn=null,rk(n),rk(r),gn===null?gn=this:zy.delete(this),this.#s?.resolve()}else this.#f(this.#a),this.#f(this.#l),this.#f(this.#u);for(const i of this.#o)Ou(i);for(const i of this.#i)Ou(i);this.#o=[],this.#i=[]}#g(e){e.f^=Br;for(var n=e.first;n!==null;){var r=n.f,i=(r&(aa|$c))!==0,s=i&&(r&Br)!==0,o=s||(r&Es)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){if(i)n.f^=Br;else if((r&t2)!==0)this.#l.push(n);else if((r&Br)===0)if((r&i2)!==0){var a=n.b?.pending?this.#i:this.#o;a.push(n)}else n0(n)&&((n.f&bd)!==0&&this.#u.push(n),Ou(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)n=c.next,c=c.parent}}#f(e){for(const n of e)((n.f&ns)!==0?this.#c:this.#d).push(n),pi(n,Br);e.length=0}capture(e,n){this.#e.has(e)||this.#e.set(e,n),this.current.set(e,e.v)}activate(){gn=this}deactivate(){gn=null,Bp=null;for(const e of nk)if(nk.delete(e),e(),gn!==null)break}neuter(){this.#r=!0}flush(){Ec.length>0?aI():this.#h(),gn===this&&(this.#n===0&&zy.delete(this),this.deactivate())}#h(){if(!this.#r)for(const e of this.#t)e();this.#t.clear()}increment(){this.#n+=1}decrement(){if(this.#n-=1,this.#n===0){for(const e of this.#c)pi(e,ns),qu(e);for(const e of this.#d)pi(e,Ll),qu(e);this.#a=[],this.#l=[],this.flush()}else this.deactivate()}add_callback(e){this.#t.add(e)}settled(){return(this.#s??=XD()).promise}static ensure(){if(gn===null){const e=gn=new Wu;zy.add(gn),$p||Wu.enqueue(()=>{gn===e&&e.flush()})}return gn}static enqueue(e){sm.length===0&&queueMicrotask(oI),sm.unshift(e)}}function FB(t){var e=$p;$p=!0;try{for(var n;;){if(RB(),Ec.length===0&&(gn?.flush(),Ec.length===0))return Qg=null,n;aI()}}finally{$p=e}}function aI(){var t=Mu;Yw=!0;try{var e=0;for(ak(!0);Ec.length>0;){var n=Wu.ensure();if(e++>1e3){var r,i;zB()}n.process(Ec),fl.clear()}}finally{Yw=!1,ak(t),Qg=null}}function zB(){try{aB()}catch(t){l2(t,Qg)}}let Yl=null;function rk(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(Fc|Es))===0&&n0(r)&&(Yl=[],Ou(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?yI(r):r.fn=null),Yl?.length>0)){fl.clear();for(const i of Yl)Ou(i);Yl=[]}}Yl=null}}function qu(t){for(var e=Qg=t;e.parent!==null;){e=e.parent;var n=e.f;if(Yw&&e===Ut&&(n&bd)!==0)return;if((n&($c|aa))!==0){if((n&Br)===0)return;e.f^=Br}}Ec.push(e)}const fl=new Map;function Ku(t,e){var n={f:0,v:t,reactions:null,equals:QA,rv:0,wv:0};return n}function Ee(t,e){const n=Ku(t);return vI(n),n}function lI(t,e=!1,n=!0){const r=Ku(t);return e||(r.equals=XA),r}function se(t,e,n=!1){jt!==null&&(!Zs||(jt.f&tk)!==0)&&YA()&&(jt.f&(Li|bd|i2|tk))!==0&&!Zo?.includes(t)&&dB();let r=n?At(e):e;return qf(t,r)}function qf(t,e){if(!t.equals(e)){var n=t.v;Uc?fl.set(t,e):fl.set(t,n),t.v=e;var r=Wu.ensure();r.capture(t,n),(t.f&Li)!==0&&((t.f&ns)!==0&&c2(t),pi(t,(t.f&Yi)===0?Br:Ll)),t.wv=SI(),cI(t,ns),Ut!==null&&(Ut.f&Br)!==0&&(Ut.f&(aa|$c))===0&&(Hi===null?YB([t]):Hi.push(t))}return e}function Za(t){se(t,t.v+1)}function cI(t,e){var n=t.reactions;if(n!==null)for(var r=n.length,i=0;i<r;i++){var s=n[i],o=s.f,a=(o&ns)===0;a&&pi(s,e),(o&Li)!==0?cI(s,Ll):a&&((o&bd)!==0&&Yl!==null&&Yl.push(s),qu(s))}}function At(t){if(typeof t!="object"||t===null||Go in t)return t;const e=Wg(t);if(e!==KA&&e!==QD)return t;var n=new Map,r=Eh(t),i=Ee(0),s=Qo,o=a=>{if(Qo===s)return a();var l=jt,c=Qo;ao(null),ck(s);var u=a();return ao(l),ck(c),u};return r&&n.set("length",Ee(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&cB();var u=n.get(l);return u===void 0?u=o(()=>{var d=Ee(c.value);return n.set(l,d),d}):se(u,c.value,!0),!0},deleteProperty(a,l){var c=n.get(l);if(c===void 0){if(l in a){const u=o(()=>Ee(Jn));n.set(l,u),Za(i)}}else se(c,Jn),Za(i);return!0},get(a,l,c){if(l===Go)return t;var u=n.get(l),d=l in a;if(u===void 0&&(!d||Pu(a,l)?.writable)&&(u=o(()=>{var h=At(d?a[l]:Jn),p=Ee(h);return p}),n.set(l,u)),u!==void 0){var f=M(u);return f===Jn?void 0:f}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=M(u))}else if(c===void 0){var d=n.get(l),f=d?.v;if(d!==void 0&&f!==Jn)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(a,l){if(l===Go)return!0;var c=n.get(l),u=c!==void 0&&c.v!==Jn||Reflect.has(a,l);if(c!==void 0||Ut!==null&&(!u||Pu(a,l)?.writable)){c===void 0&&(c=o(()=>{var f=u?At(a[l]):Jn,h=Ee(f);return h}),n.set(l,c));var d=M(c);if(d===Jn)return!1}return u},set(a,l,c,u){var d=n.get(l),f=l in a;if(r&&l==="length")for(var h=c;h<d.v;h+=1){var p=n.get(h+"");p!==void 0?se(p,Jn):h in a&&(p=o(()=>Ee(Jn)),n.set(h+"",p))}if(d===void 0)(!f||Pu(a,l)?.writable)&&(d=o(()=>Ee(void 0)),se(d,At(c)),n.set(l,d));else{f=d.v!==Jn;var m=o(()=>At(c));se(d,m)}var g=Reflect.getOwnPropertyDescriptor(a,l);if(g?.set&&g.set.call(u,c),!f){if(r&&typeof l=="string"){var y=n.get("length"),w=Number(l);Number.isInteger(w)&&w>=y.v&&se(y,w+1)}Za(i)}return!0},ownKeys(a){M(i);var l=Reflect.ownKeys(a).filter(d=>{var f=n.get(d);return f===void 0||f.v!==Jn});for(var[c,u]of n)u.v!==Jn&&!(c in a)&&l.push(c);return l},setPrototypeOf(){uB()}})}function ik(t){try{if(t!==null&&typeof t=="object"&&Go in t)return t[Go]}catch{}return t}function UB(t,e){return Object.is(ik(t),ik(e))}var sk,uI,dI,fI;function HB(){if(sk===void 0){sk=window,uI=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;dI=Pu(e,"firstChild").get,fI=Pu(e,"nextSibling").get,ek(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),ek(n)&&(n.__t=void 0)}}function zc(t=""){return document.createTextNode(t)}function om(t){return dI.call(t)}function Xg(t){return fI.call(t)}function ye(t,e){return om(t)}function Et(t,e){{var n=om(t);return n instanceof Comment&&n.data===""?Xg(n):n}}function Le(t,e=1,n=!1){let r=t;for(;e--;)r=Xg(r);return r}function VB(t){t.textContent=""}function hI(){return!1}function jB(t,e){if(e){const n=document.body;t.autofocus=!0,Gg(()=>{document.activeElement===n&&t.focus()})}}let ok=!1;function WB(){ok||(ok=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Yg(t){var e=jt,n=Ut;ao(null),kl(null);try{return t()}finally{ao(e),kl(n)}}function u2(t,e,n,r=n){t.addEventListener(e,()=>Yg(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),WB()}function qB(t){Ut===null&&jt===null&&oB(),jt!==null&&(jt.f&Yi)!==0&&Ut===null&&sB(),Uc&&iB()}function KB(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function la(t,e,n,r=!0){var i=Ut;i!==null&&(i.f&Es)!==0&&(t|=Es);var s={ctx:Ur,deps:null,nodes_start:null,nodes_end:null,f:t|ns,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{Ou(s),s.f|=r2}catch(l){throw wi(s),l}else e!==null&&qu(s);if(r){var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes_start===null&&o.first===o.last&&(o.f&Th)===0&&(o=o.first),o!==null&&(o.parent=i,i!==null&&KB(o,i),jt!==null&&(jt.f&Li)!==0&&(t&$c)===0)){var a=jt;(a.effects??=[]).push(o)}}return s}function d2(t){const e=la(n2,null,!1);return pi(e,Br),e.teardown=t,e}function Ze(t){qB();var e=Ut.f,n=!jt&&(e&aa)!==0&&(e&r2)===0;if(n){var r=Ur;(r.e??=[]).push(t)}else return pI(t)}function pI(t){return la(t2|JD,t,!1)}function GB(t){Wu.ensure();const e=la($c|Th,t,!0);return(n={})=>new Promise(r=>{n.outro?e0(e,()=>{wi(e),r(void 0)}):(wi(e),r(void 0))})}function _h(t){return la(t2,t,!1)}function ZB(t){return la(i2|Th,t,!0)}function Jg(t,e=0){return la(n2|e,t,!0)}function Ge(t,e=[],n=[]){iI(e,n,r=>{la(n2,()=>t(...r.map(M)),!0)})}function wd(t,e=0){var n=la(bd|e,t,!0);return n}function ia(t,e=!0){return la(aa|Th,t,!0,e)}function mI(t){var e=t.teardown;if(e!==null){const n=Uc,r=jt;lk(!0),ao(null);try{e.call(null)}finally{lk(n),ao(r)}}}function gI(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&Yg(()=>{i.abort(s2)});var r=n.next;(n.f&$c)!==0?n.parent=null:wi(n,e),n=r}}function QB(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&aa)===0&&wi(e),e=n}}function wi(t,e=!0){var n=!1;(e||(t.f&YD)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(XB(t.nodes_start,t.nodes_end),n=!0),gI(t,e&&!n),am(t,0),pi(t,Fc);var r=t.transitions;if(r!==null)for(const s of r)s.stop();mI(t);var i=t.parent;i!==null&&i.first!==null&&yI(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function XB(t,e){for(;t!==null;){var n=t===e?null:Xg(t);t.remove(),t=n}}function yI(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function e0(t,e){var n=[];f2(t,n,!0),bI(n,()=>{wi(t),e&&e()})}function bI(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var i of t)i.out(r)}else e()}function f2(t,e,n){if((t.f&Es)===0){if(t.f^=Es,t.transitions!==null)for(const o of t.transitions)(o.is_global||n)&&e.push(o);for(var r=t.first;r!==null;){var i=r.next,s=(r.f&kh)!==0||(r.f&aa)!==0;f2(r,e,s?n:!1),r=i}}}function t0(t){wI(t,!0)}function wI(t,e){if((t.f&Es)!==0){t.f^=Es,(t.f&Br)===0&&(pi(t,ns),qu(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&kh)!==0||(n.f&aa)!==0;wI(n,i?e:!1),n=r}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}let Mu=!1;function ak(t){Mu=t}let Uc=!1;function lk(t){Uc=t}let jt=null,Zs=!1;function ao(t){jt=t}let Ut=null;function kl(t){Ut=t}let Zo=null;function vI(t){jt!==null&&(Zo===null?Zo=[t]:Zo.push(t))}let Kr=null,Ci=0,Hi=null;function YB(t){Hi=t}let xI=1,Kf=0,Qo=Kf;function ck(t){Qo=t}let tl=!1;function SI(){return++xI}function n0(t){var e=t.f;if((e&ns)!==0)return!0;if((e&Ll)!==0){var n=t.deps,r=(e&Yi)!==0;if(n!==null){var i,s,o=(e&rm)!==0,a=r&&Ut!==null&&!tl,l=n.length;if((o||a)&&(Ut===null||(Ut.f&Fc)===0)){var c=t,u=c.parent;for(i=0;i<l;i++)s=n[i],(o||!s?.reactions?.includes(c))&&(s.reactions??=[]).push(c);o&&(c.f^=rm),a&&u!==null&&(u.f&Yi)===0&&(c.f^=Yi)}for(i=0;i<l;i++)if(s=n[i],n0(s)&&rI(s),s.wv>t.wv)return!0}(!r||Ut!==null&&!tl)&&pi(t,Br)}return!1}function EI(t,e,n=!0){var r=t.reactions;if(r!==null&&!Zo?.includes(t))for(var i=0;i<r.length;i++){var s=r[i];(s.f&Li)!==0?EI(s,e,!1):e===s&&(n?pi(s,ns):(s.f&Br)!==0&&pi(s,Ll),qu(s))}}function kI(t){var e=Kr,n=Ci,r=Hi,i=jt,s=tl,o=Zo,a=Ur,l=Zs,c=Qo,u=t.f;Kr=null,Ci=0,Hi=null,tl=(u&Yi)!==0&&(Zs||!Mu||jt===null),jt=(u&(aa|$c))===0?t:null,Zo=null,im(t.ctx),Zs=!1,Qo=++Kf,t.ac!==null&&(Yg(()=>{t.ac.abort(s2)}),t.ac=null);try{t.f|=Qw;var d=t.fn,f=d(),h=t.deps;if(Kr!==null){var p;if(am(t,Ci),h!==null&&Ci>0)for(h.length=Ci+Kr.length,p=0;p<Kr.length;p++)h[Ci+p]=Kr[p];else t.deps=h=Kr;if(!tl||(u&Li)!==0&&t.reactions!==null)for(p=Ci;p<h.length;p++)(h[p].reactions??=[]).push(t)}else h!==null&&Ci<h.length&&(am(t,Ci),h.length=Ci);if(YA()&&Hi!==null&&!Zs&&h!==null&&(t.f&(Li|Ll|ns))===0)for(p=0;p<Hi.length;p++)EI(Hi[p],t);return i!==null&&i!==t&&(Kf++,Hi!==null&&(r===null?r=Hi:r.push(...Hi))),(t.f&pc)!==0&&(t.f^=pc),f}catch(m){return OB(m)}finally{t.f^=Qw,Kr=e,Ci=n,Hi=r,jt=i,tl=s,Zo=o,im(a),Zs=l,Qo=c}}function JB(t,e){let n=e.reactions;if(n!==null){var r=ZD.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}n===null&&(e.f&Li)!==0&&(Kr===null||!Kr.includes(e))&&(pi(e,Ll),(e.f&(Yi|rm))===0&&(e.f^=rm),nI(e),am(e,0))}function am(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)JB(t,n[r])}function Ou(t){var e=t.f;if((e&Fc)===0){pi(t,Br);var n=Ut,r=Mu;Ut=t,Mu=!0;try{(e&bd)!==0?QB(t):gI(t),mI(t);var i=kI(t);t.teardown=typeof i=="function"?i:null,t.wv=xI;var s;WA&&TB&&(t.f&ns)!==0&&t.deps}finally{Mu=r,Ut=n}}}async function Tl(){await Promise.resolve(),FB()}function M(t){var e=t.f,n=(e&Li)!==0;if(jt!==null&&!Zs){var r=Ut!==null&&(Ut.f&Fc)!==0;if(!r&&!Zo?.includes(t)){var i=jt.deps;if((jt.f&Qw)!==0)t.rv<Kf&&(t.rv=Kf,Kr===null&&i!==null&&i[Ci]===t?Ci++:Kr===null?Kr=[t]:(!tl||!Kr.includes(t))&&Kr.push(t));else{(jt.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[jt]:s.includes(jt)||s.push(jt)}}}else if(n&&t.deps===null&&t.effects===null){var o=t,a=o.parent;a!==null&&(a.f&Yi)===0&&(o.f^=Yi)}if(Uc){if(fl.has(t))return fl.get(t);if(n){o=t;var l=o.v;return((o.f&Br)===0&&o.reactions!==null||TI(o))&&(l=c2(o)),fl.set(o,l),l}}else n&&(o=t,n0(o)&&rI(o));if((t.f&pc)!==0)throw t.v;return t.v}function TI(t){if(t.v===Jn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(fl.has(e)||(e.f&Li)!==0&&TI(e))return!0;return!1}function Dl(t){var e=Zs;try{return Zs=!0,t()}finally{Zs=e}}const e$=-7169;function pi(t,e){t.f=t.f&e$|e}function t$(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Go in t)Jw(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Go in n&&Jw(n)}}}function Jw(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{Jw(t[r],e)}catch{}const n=Wg(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=qA(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}function n$(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const r$=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function i$(t){return r$.includes(t)}const s$={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function o$(t){return t=t.toLowerCase(),s$[t]??t}const a$=["touchstart","touchmove"];function l$(t){return a$.includes(t)}const _I=new Set,ev=new Set;function CI(t,e,n,r={}){function i(s){if(r.capture||lf.call(e,s),!s.cancelBubble)return Yg(()=>n?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Gg(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function bs(t,e,n,r,i){var s={capture:r,passive:i},o=CI(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&d2(()=>{e.removeEventListener(t,o,s)})}function xi(t){for(var e=0;e<t.length;e++)_I.add(t[e]);for(var n of ev)n(t)}let uk=null;function lf(t){var e=this,n=e.ownerDocument,r=t.type,i=t.composedPath?.()||[],s=i[0]||t.target;uk=t;var o=0,a=uk===t&&t.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=i.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=i[o]||t.target,s!==e){nm(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=jt,d=Ut;ao(null),kl(null);try{for(var f,h=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+r];if(m!=null&&(!s.disabled||t.target===s))if(Eh(m)){var[g,...y]=m;g.apply(s,[t,...y])}else m.call(s,t)}catch(w){f?h.push(w):f=w}if(t.cancelBubble||p===e||p===null)break;s=p}if(f){for(let w of h)queueMicrotask(()=>{throw w});throw f}}finally{t.__root=e,delete t.currentTarget,ao(u),kl(d)}}}function c$(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Gf(t,e){var n=Ut;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function Ve(t,e){var n=(e&bB)!==0,r=(e&wB)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=c$(s?t:"<!>"+t),n||(i=om(i)));var o=r||uI?document.importNode(i,!0):i.cloneNode(!0);if(n){var a=om(o),l=o.lastChild;Gf(a,l)}else Gf(o,o);return o}}function Sn(t=""){{var e=zc(t+"");return Gf(e,e),e}}function en(){var t=document.createDocumentFragment(),e=document.createComment(""),n=zc();return t.append(e,n),Gf(e,n),t}function we(t,e){t!==null&&t.before(e)}function Qe(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function AI(t,e){return u$(t,e)}const eu=new Map;function u$(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:o=!0}){HB();var a=new Set,l=d=>{for(var f=0;f<d.length;f++){var h=d[f];if(!a.has(h)){a.add(h);var p=l$(h);e.addEventListener(h,lf,{passive:p});var m=eu.get(h);m===void 0?(document.addEventListener(h,lf,{passive:p}),eu.set(h,1)):eu.set(h,m+1)}}};l(J1(_I)),ev.add(l);var c=void 0,u=GB(()=>{var d=n??e.appendChild(zc());return ia(()=>{if(s){Mn({});var f=Ur;f.c=s}i&&(r.$$events=i),c=t(d,r)||{},s&&On()}),()=>{for(var f of a){e.removeEventListener(f,lf);var h=eu.get(f);--h===0?(document.removeEventListener(f,lf),eu.delete(f)):eu.set(f,h)}ev.delete(l),d!==n&&d.parentNode?.removeChild(d)}});return tv.set(c,u),c}let tv=new WeakMap;function d$(t,e){const n=tv.get(t);return n?(tv.delete(t),n(e)):Promise.resolve()}function Ye(t,e,n=!1){var r=t,i=null,s=null,o=Jn,a=n?kh:0,l=!1;const c=(h,p=!0)=>{l=!0,f(p,h)};var u=null;function d(){u!==null&&(u.lastChild.remove(),r.before(u),u=null);var h=o?i:s,p=o?s:i;h&&t0(h),p&&e0(p,()=>{o?s=null:i=null})}const f=(h,p)=>{if(o!==(o=h)){var m=hI(),g=r;if(m&&(u=document.createDocumentFragment(),u.append(g=zc())),o?i??=p&&ia(()=>p(g)):s??=p&&ia(()=>p(g)),m){var y=gn,w=o?i:s,k=o?s:i;w&&y.skipped_effects.delete(w),k&&y.skipped_effects.add(k),y.add_callback(d)}else d()}};wd(()=>{l=!1,e(c),l||f(null,null)},a)}function cf(t,e){return e}function f$(t,e,n){for(var r=t.items,i=[],s=e.length,o=0;o<s;o++)f2(e[o].e,i,!0);var a=s>0&&i.length===0&&n!==null;if(a){var l=n.parentNode;VB(l),l.append(n),r.clear(),Hs(t,e[0].prev,e[s-1].next)}bI(i,()=>{for(var c=0;c<s;c++){var u=e[c];a||(r.delete(u.k),Hs(t,u.prev,u.next)),wi(u.e,!a)}})}function bu(t,e,n,r,i,s=null){var o=t,a={flags:e,items:new Map,first:null},l=(e&ZA)!==0;if(l){var c=t;o=c.appendChild(zc())}var u=null,d=!1,f=new Map,h=tI(()=>{var y=n();return Eh(y)?y:y==null?[]:J1(y)}),p,m;function g(){h$(m,p,a,f,o,i,e,r,n),s!==null&&(p.length===0?u?t0(u):u=ia(()=>s(o)):u!==null&&e0(u,()=>{u=null}))}wd(()=>{m??=Ut,p=M(h);var y=p.length;if(!(d&&y===0)){d=y===0;var w,k,C,A;if(hI()){var E=new Set,P=gn;for(k=0;k<y;k+=1){C=p[k],A=r(C,k);var S=a.items.get(A)??f.get(A);S?(e&(qg|Kg))!==0&&II(S,C,k,e):(w=PI(null,a,null,null,C,A,k,i,e,n,!0),f.set(A,w)),E.add(A)}for(const[x,_]of a.items)E.has(x)||P.skipped_effects.add(_.e);P.add_callback(g)}else g();M(h)}})}function h$(t,e,n,r,i,s,o,a,l){var c=(o&fB)!==0,u=(o&(qg|Kg))!==0,d=e.length,f=n.items,h=n.first,p=h,m,g=null,y,w=[],k=[],C,A,E,P;if(c)for(P=0;P<d;P+=1)C=e[P],A=a(C,P),E=f.get(A),E!==void 0&&(E.a?.measure(),(y??=new Set).add(E));for(P=0;P<d;P+=1){if(C=e[P],A=a(C,P),E=f.get(A),E===void 0){var S=r.get(A);if(S!==void 0){r.delete(A),f.set(A,S);var x=g?g.next:p;Hs(n,g,S),Hs(n,S,x),Uy(S,x,i),g=S}else{var _=p?p.e.nodes_start:i;g=PI(_,n,g,g===null?n.first:g.next,C,A,P,s,o,l)}f.set(A,g),w=[],k=[],p=g.next;continue}if(u&&II(E,C,P,o),(E.e.f&Es)!==0&&(t0(E.e),c&&(E.a?.unfix(),(y??=new Set).delete(E))),E!==p){if(m!==void 0&&m.has(E)){if(w.length<k.length){var I=k[0],D;g=I.prev;var B=w[0],F=w[w.length-1];for(D=0;D<w.length;D+=1)Uy(w[D],I,i);for(D=0;D<k.length;D+=1)m.delete(k[D]);Hs(n,B.prev,F.next),Hs(n,g,B),Hs(n,F,I),p=I,g=F,P-=1,w=[],k=[]}else m.delete(E),Uy(E,p,i),Hs(n,E.prev,E.next),Hs(n,E,g===null?n.first:g.next),Hs(n,g,E),g=E;continue}for(w=[],k=[];p!==null&&p.k!==A;)(p.e.f&Es)===0&&(m??=new Set).add(p),k.push(p),p=p.next;if(p===null)continue;E=p}w.push(E),g=E,p=E.next}if(p!==null||m!==void 0){for(var R=m===void 0?[]:J1(m);p!==null;)(p.e.f&Es)===0&&R.push(p),p=p.next;var O=R.length;if(O>0){var L=(o&ZA)!==0&&d===0?i:null;if(c){for(P=0;P<O;P+=1)R[P].a?.measure();for(P=0;P<O;P+=1)R[P].a?.fix()}f$(n,R,L)}}c&&Gg(()=>{if(y!==void 0)for(E of y)E.a?.apply()}),t.first=n.first&&n.first.e,t.last=g&&g.e;for(var H of r.values())wi(H.e);r.clear()}function II(t,e,n,r){(r&qg)!==0&&qf(t.v,e),(r&Kg)!==0?qf(t.i,n):t.i=n}function PI(t,e,n,r,i,s,o,a,l,c,u){var d=(l&qg)!==0,f=(l&hB)===0,h=d?f?lI(i,!1,!1):Ku(i):i,p=(l&Kg)===0?o:Ku(o),m={i:p,v:h,k:s,a:null,e:null,prev:n,next:r};try{if(t===null){var g=document.createDocumentFragment();g.append(t=zc())}return m.e=ia(()=>a(t,h,p,c),kB),m.e.prev=n&&n.e,m.e.next=r&&r.e,n===null?u||(e.first=m):(n.next=m,n.e.next=m.e),r!==null&&(r.prev=m,r.e.prev=m.e),m}finally{}}function Uy(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==null&&s!==r;){var o=Xg(s);i.before(s),s=o}}function Hs(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function kc(t,e,...n){var r=t,i=Oi,s;wd(()=>{i!==(i=e())&&(s&&(wi(s),s=null),s=ia(()=>i(r,...n)))},kh)}function p$(t,e,n,r,i,s){var o,a,l=null,c=t,u;wd(()=>{const d=e()||null;var f=d==="svg"?xB:null;d!==o&&(u&&(d===null?e0(u,()=>{u=null,a=null}):d===a?t0(u):wi(u)),d&&d!==a&&(u=ia(()=>{if(l=f?document.createElementNS(f,d):document.createElement(d),Gf(l,l),r){var h=l.appendChild(zc());r(l,h)}Ut.nodes_end=l,c.before(l)})),o=d,o&&(a=o))},kh)}function up(t,e,n){_h(()=>{var r=Dl(()=>e(t,n?.())||{});if(n&&r?.update){var i=!1,s={};Jg(()=>{var o=n();t$(o),i&&a2(s,o)&&(s=o,r.update(o))}),i=!0}if(r?.destroy)return()=>r.destroy()})}function m$(t,e){var n=void 0,r;wd(()=>{n!==(n=e())&&(r&&(wi(r),r=null),n&&(r=ia(()=>{_h(()=>n(t))})))})}function MI(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=MI(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function g$(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=MI(t))&&(r&&(r+=" "),r+=e);return r}function OI(t){return typeof t=="object"?g$(t):t??""}const dk=[...` 	
\r\fÂ \v\uFEFF`];function y$(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,o=0;(o=r.indexOf(i,o))>=0;){var a=o+s;(o===0||dk.includes(r[o-1]))&&(a===r.length||dk.includes(r[a]))?r=(o===0?"":r.substring(0,o))+r.substring(a+1):o=a}}return r===""?null:r}function fk(t,e=!1){var n=e?" !important;":";",r="";for(var i in t){var s=t[i];s!=null&&s!==""&&(r+=" "+i+": "+s+n)}return r}function Hy(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function b$(t,e){if(e){var n="",r,i;if(Array.isArray(e)?(r=e[0],i=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,o=0,a=!1,l=[];r&&l.push(...Object.keys(r).map(Hy)),i&&l.push(...Object.keys(i).map(Hy));var c=0,u=-1;const m=t.length;for(var d=0;d<m;d++){var f=t[d];if(a?f==="/"&&t[d-1]==="*"&&(a=!1):s?s===f&&(s=!1):f==="/"&&t[d+1]==="*"?a=!0:f==='"'||f==="'"?s=f:f==="("?o++:f===")"&&o--,!a&&s===!1&&o===0){if(f===":"&&u===-1)u=d;else if(f===";"||d===m-1){if(u!==-1){var h=Hy(t.substring(c,u).trim());if(!l.includes(h)){f!==";"&&d++;var p=t.substring(c,d).trim();n+=" "+p+";"}}c=d+1,u=-1}}}}return r&&(n+=fk(r)),i&&(n+=fk(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function rs(t,e,n,r,i,s){var o=t.__className;if(o!==n||o===void 0){var a=y$(n,r,s);a==null?t.removeAttribute("class"):e?t.className=a:t.setAttribute("class",a),t.__className=n}else if(s&&i!==s)for(var l in s){var c=!!s[l];(i==null||c!==!!i[l])&&t.classList.toggle(l,c)}return s}function Vy(t,e={},n,r){for(var i in n){var s=n[i];e[i]!==s&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,s,r))}}function nl(t,e,n,r){var i=t.__style;if(i!==e){var s=b$(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(Vy(t,n?.[0],r[0]),Vy(t,n?.[1],r[1],"important")):Vy(t,n,r));return r}function lm(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Eh(e))return EB();for(var r of t.options)r.selected=e.includes(vf(r));return}for(r of t.options){var i=vf(r);if(UB(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function NI(t){var e=new MutationObserver(()=>{lm(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),d2(()=>{e.disconnect()})}function w$(t,e,n=e){var r=!0;u2(t,"change",i=>{var s=i?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(s),vf);else{var a=t.querySelector(s)??t.querySelector("option:not([disabled])");o=a&&vf(a)}n(o)}),_h(()=>{var i=e();if(lm(t,i,r),r&&i===void 0){var s=t.querySelector(":checked");s!==null&&(i=vf(s),n(i))}t.__value=i,r=!1}),NI(t)}function vf(t){return"__value"in t?t.__value:t.value}const Fd=Symbol("class"),zd=Symbol("style"),RI=Symbol("is custom element"),LI=Symbol("is html");function v$(t,e){var n=r0(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function x$(t,e){var n=r0(t);n.checked!==(n.checked=e??void 0)&&(t.checked=e)}function S$(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function ln(t,e,n,r){var i=r0(t);i[e]!==(i[e]=n)&&(e==="loading"&&(t[tB]=n),n==null?t.removeAttribute(e):typeof n!="string"&&BI(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function E$(t,e,n,r,i=!1){var s=r0(t),o=s[RI],a=!s[LI],l=e||{},c=t.tagName==="OPTION";for(var u in e)u in n||(n[u]=null);n.class?n.class=OI(n.class):(r||n[Fd])&&(n.class=null),n[zd]&&(n.style??=null);var d=BI(t);for(const w in n){let k=n[w];if(c&&w==="value"&&k==null){t.value=t.__value="",l[w]=k;continue}if(w==="class"){var f=t.namespaceURI==="http://www.w3.org/1999/xhtml";rs(t,f,k,r,e?.[Fd],n[Fd]),l[w]=k,l[Fd]=n[Fd];continue}if(w==="style"){nl(t,k,e?.[zd],n[zd]),l[w]=k,l[zd]=n[zd];continue}var h=l[w];if(!(k===h&&!(k===void 0&&t.hasAttribute(w)))){l[w]=k;var p=w[0]+w[1];if(p!=="$$")if(p==="on"){const C={},A="$$"+w;let E=w.slice(2);var m=i$(E);if(n$(E)&&(E=E.slice(0,-7),C.capture=!0),!m&&h){if(k!=null)continue;t.removeEventListener(E,l[A],C),l[A]=null}if(k!=null)if(m)t[`__${E}`]=k,xi([E]);else{let P=function(S){l[w].call(this,S)};l[A]=CI(E,t,P,C)}else m&&(t[`__${E}`]=void 0)}else if(w==="style")ln(t,w,k);else if(w==="autofocus")jB(t,!!k);else if(!o&&(w==="__value"||w==="value"&&k!=null))t.value=t.__value=k;else if(w==="selected"&&c)S$(t,k);else{var g=w;a||(g=o$(g));var y=g==="defaultValue"||g==="defaultChecked";if(k==null&&!o&&!y)if(s[w]=null,g==="value"||g==="checked"){let C=t;const A=e===void 0;if(g==="value"){let E=C.defaultValue;C.removeAttribute(g),C.defaultValue=E,C.value=C.__value=A?E:null}else{let E=C.defaultChecked;C.removeAttribute(g),C.defaultChecked=E,C.checked=A?E:!1}}else t.removeAttribute(w);else y||d.includes(g)&&(o||typeof k!="string")?(t[g]=k,g in s&&(s[g]=Jn)):typeof k!="function"&&ln(t,g,k)}}}return l}function DI(t,e,n=[],r=[],i,s=!1){iI(n,r,o=>{var a=void 0,l={},c=t.nodeName==="SELECT",u=!1;if(wd(()=>{var f=e(...o.map(M)),h=E$(t,a,f,i,s);u&&c&&"value"in f&&lm(t,f.value);for(let m of Object.getOwnPropertySymbols(l))f[m]||wi(l[m]);for(let m of Object.getOwnPropertySymbols(f)){var p=f[m];m.description===SB&&(!a||p!==a[m])&&(l[m]&&wi(l[m]),l[m]=ia(()=>m$(t,()=>p))),h[m]=p}a=h}),c){var d=t;_h(()=>{lm(d,a.value,!0),NI(d)})}u=!0})}function r0(t){return t.__attributes??={[RI]:t.nodeName.includes("-"),[LI]:t.namespaceURI===vB}}var hk=new Map;function BI(t){var e=t.getAttribute("is")||t.nodeName,n=hk.get(e);if(n)return n;hk.set(e,n=[]);for(var r,i=t,s=Element.prototype;s!==i;){r=qA(i);for(var o in r)r[o].set&&n.push(o);i=Wg(i)}return n}function k$(t,e,n=e){var r=new WeakSet;u2(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=jy(t)?Wy(s):s,n(s),gn!==null&&r.add(gn),await Tl(),s!==(s=e())){var o=t.selectionStart,a=t.selectionEnd;t.value=s??"",a!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(a,t.value.length))}}),Dl(e)==null&&t.value&&(n(jy(t)?Wy(t.value):t.value),gn!==null&&r.add(gn)),Jg(()=>{var i=e();if(t===document.activeElement){var s=Bp??gn;if(r.has(s))return}jy(t)&&i===Wy(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function T$(t,e,n=e){u2(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),Dl(e)==null&&n(t.checked),Jg(()=>{var r=e();t.checked=!!r})}function jy(t){var e=t.type;return e==="number"||e==="range"}function Wy(t){return t===""?null:+t}function pk(t,e){return t===e||t?.[Go]===e}function Xn(t={},e,n,r){return _h(()=>{var i,s;return Jg(()=>{i=s,s=[],Dl(()=>{t!==n(...s)&&(e(t,...s),i&&pk(n(...i),t)&&e(null,...i))})}),()=>{Gg(()=>{s&&pk(n(...s),t)&&e(null,...s)})}}),t}function h2(t,e,n){if(t==null)return e(void 0),n&&n(void 0),Oi;const r=Dl(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const tu=[];function $I(t,e){return{subscribe:Qi(t,e).subscribe}}function Qi(t,e=Oi){let n=null;const r=new Set;function i(a){if(a2(t,a)&&(t=a,n)){const l=!tu.length;for(const c of r)c[1](),tu.push(c,t);if(l){for(let c=0;c<tu.length;c+=2)tu[c][0](tu[c+1]);tu.length=0}}}function s(a){i(a(t))}function o(a,l=Oi){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,s)||Oi),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function Xo(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return $I(n,(o,a)=>{let l=!1;const c=[];let u=0,d=Oi;const f=()=>{if(u)return;d();const p=e(r?c[0]:c,o,a);s?o(p):d=typeof p=="function"?p:Oi},h=i.map((p,m)=>h2(p,g=>{c[m]=g,u&=~(1<<m),l&&f()},()=>{u|=1<<m}));return l=!0,f(),function(){e2(h),d(),l=!1}})}function mc(t){let e;return h2(t,n=>e=n)(),e}let dp=!1,nv=Symbol();function or(t,e,n){const r=n[e]??={store:null,source:lI(void 0),unsubscribe:Oi};if(r.store!==t&&!(nv in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=Oi;else{var i=!0;r.unsubscribe=h2(t,s=>{i?r.source.v=s:se(r.source,s)}),i=!1}return t&&nv in n?mc(t):M(r.source)}function as(){const t={};function e(){d2(()=>{for(var n in t)t[n].unsubscribe();nm(t,nv,{enumerable:!1,value:!0})})}return[t,e]}function _$(t){var e=dp;try{return dp=!1,[t(),dp]}finally{dp=e}}const C$={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function A$(t,e,n){return new Proxy({props:t,exclude:e},C$)}function ht(t,e,n,r){var i=(n&gB)!==0,s=(n&yB)!==0,o=r,a=!0,l=()=>(a&&(a=!1,o=s?Dl(r):r),o),c;if(i){var u=Go in t||eB in t;c=Pu(t,e)?.set??(u&&e in t?w=>t[e]=w:void 0)}var d,f=!1;i?[d,f]=_$(()=>t[e]):d=t[e],d===void 0&&r!==void 0&&(d=l(),c&&(lB(),c(d)));var h;if(h=()=>{var w=t[e];return w===void 0?l():(a=!0,w)},(n&mB)===0)return h;if(c){var p=t.$$legacy;return(function(w,k){return arguments.length>0?((!k||p||f)&&c(k?h():w),w):h()})}var m=!1,g=((n&pB)!==0?Zg:tI)(()=>(m=!1,h()));i&&M(g);var y=Ut;return(function(w,k){if(arguments.length>0){const C=k?M(g):i?At(w):w;return se(g,C),m=!0,o!==void 0&&(o=C),w}return Uc&&m||(y.f&Fc)!==0?g.v:M(g)})}function ls(t){Ur===null&&o2(),Ze(()=>{const e=Dl(t);if(typeof e=="function")return e})}function Tc(t){Ur===null&&o2(),ls(()=>()=>Dl(t))}const I$="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(I$);var P$=Object.defineProperty,M$=(t,e,n)=>e in t?P$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tt=(t,e,n)=>(M$(t,typeof e!="symbol"?e+"":e,n),n);let Ch=class extends Error{},mk=class extends Ch{constructor(e){super(`RxNostrWebSocketError: WebSocket was closed with code ${e} by relay.`),this.code=e,this.name="RxNostrWebSocketError"}},Fp=class extends Ch{constructor(e){super(`RxNostrInvalidUsageError: ${e}`),this.name="RxNostrInvalidUsageError"}},qy=class extends Ch{constructor(e){super(`RxNostrEnvironmentError: ${e}`),this.name="RxNostrEnvironmentError"}},FI=class extends Ch{constructor(){super("RxNostrLogicError: This is rx-nostr's internal bug. Please report to the author of the library."),this.name="RxNostrLogicError"}},Io=class extends Ch{constructor(){super("RxNostrAlreadyDisposedError: Attempted to access a disposed resource."),this.name="RxNostrAlreadyDisposedError"}};const Ah=(t,e)=>({...e,...t});function O$(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function Ky(t){throw t}function N$(t){return{async signEvent(e){var n,r;const i={...e,pubkey:e.pubkey??await((n=window?.nostr)==null?void 0:n.getPublicKey())??Ky(new qy("window.nostr.getPublicKey() is not found")),tags:[...e.tags??[]],created_at:e.created_at??Math.floor(Date.now()/1e3)};return O$(i)?i:await((r=window?.nostr)==null?void 0:r.signEvent(i))??Ky(new qy("window.nostr.signEvent() is not found"))},getPublicKey(){var e;return((e=window?.nostr)==null?void 0:e.getPublicKey())??Ky(new qy("window.nostr.getPublicKey() is not found"))}}}const R$=t=>Ah(t,{signer:N$(),connectionStrategy:"lazy",retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},disconnectTimeout:1e4,eoseTimeout:30*1e3,okTimeout:30*1e3,authTimeout:30*1e3,skipVerify:!1,skipValidateFilterMatching:!1,skipExpirationCheck:!1,skipFetchNip11:!1});function L$(t){return"length"in t?t.map(gk):[gk(t)]}function gk(t){return{...t,since:t.since?yk(t.since):void 0,until:t.until?yk(t.until):void 0}}function yk(t){return typeof t=="number"?t:t()}async function D$(t){try{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws(s?):/,"http$1:"),await(await fetch(e.toString(),{headers:{Accept:"application/nostr+json"}})).json()}catch{return{}}}function bk(t,e){try{return t()}catch(n){return e instanceof Function?e(n):e}}function No(t){let e="";try{e=t.trim();const n=new URL(e);n.hash="",n.pathname=bk(()=>decodeURI(n.pathname),n.pathname),n.pathname=n.pathname.replace(/\/$/,""),n.hostname=n.hostname.replace(/\.$/,""),n.searchParams.sort(),n.search=bk(()=>decodeURIComponent(n.search),n.search);let r=n.toString();return n.search||(r=r.replace(/\/$/,"")),r}catch{return e}}let zp=class zI extends Map{constructor(e){if(super(),!!e)for(const[n,r]of Object.entries(e))this.set(No(n),r)}get(e){return super.get(No(e))}getMany(e){const n=[];for(const r of new Set(e.map(No))){const i=this.get(r);i!==void 0&&n.push(i)}return n}set(e,n){return super.set(No(e),n)}has(e){return super.has(No(e))}delete(e){return super.delete(No(e))}toObject(){const e={};for(const[n,r]of this.entries())e[n]=r;return e}toKeys(){return[...super.keys()]}toValues(){return[...super.values()]}copy(){return new zI(this.toObject())}},cm=class{static async getValue(e,n,r){if(!(r!=null&&r.skipCache)){const i=await this.cache.get(e);if(i)return n(i)}if(!(r!=null&&r.skipFetch)){const i=await this.fetch(e);if(i)return n(i)}return n(this.default)}static get(e){const n=this.cache.get(e);if(n&&!(n instanceof Promise))return n}static async fetch(e){const n=D$(e);return this.cache.set(e,n),n.then(r=>{this.cache.set(e,r)}),n}static async getOrFetch(e){return this.cache.get(e)??this.fetch(e)}static set(e,n){this.cache.set(e,n)}static getDefault(){return this.default}static setDefault(e){this.default=e}static forget(e){this.cache.delete(e)}static forgetAll(){this.cache.clear()}};tt(cm,"cache",new zp),tt(cm,"default",{});/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */new Uint8Array(new Uint32Array([287454020]).buffer)[0];function B$(t,e,n){return Array.isArray(e)?e.some(r=>wk(t,r)):wk(t,e)}function wk(t,e,n){const{sinceInclusive:r,untilInclusive:i}=Ah({},{sinceInclusive:!0,untilInclusive:!0});if(e.ids&&e.ids.every(s=>!t.id.startsWith(s))||e.kinds&&!e.kinds.includes(t.kind)||e.authors&&e.authors.every(s=>!t.pubkey.startsWith(s))||e.since&&(r&&!(e.since<=t.created_at)||!r&&!(e.since<t.created_at))||e.until&&(i&&!(t.created_at<=e.until)||!i&&!(t.created_at<e.until)))return!1;for(const[s,o]of Object.entries(e)){if(!s.startsWith("#")||!Array.isArray(o))continue;const a=s.slice(1);if(!t.tags.find(([l,c])=>a===l&&o.includes(c)))return!1}return!0}function $$(t,e){const n=t.tags.find(r=>r[0]==="expiration");if(!n)return!1;try{const r=Number(n[1]);return Number.isInteger(r)?r<=(e??Math.floor(Date.now()/1e3)):!1}catch{return!1}}var rv=function(t,e){return rv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},rv(t,e)};function ca(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");rv(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function F$(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}function UI(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Gu(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Zu(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Qu(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Nu(t){return this instanceof Nu?(this.v=t,this):new Nu(t)}function z$(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(h){return new Promise(function(p,m){s.push([f,h,p,m])>1||a(f,h)})})}function a(f,h){try{l(r[f](h))}catch(p){d(s[0][3],p)}}function l(f){f.value instanceof Nu?Promise.resolve(f.value.v).then(c,u):d(s[0][2],f)}function c(f){a("next",f)}function u(f){a("throw",f)}function d(f,h){f(h),s.shift(),s.length&&a(s[0][0],s[0][1])}}function U$(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Gu=="function"?Gu(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function Fn(t){return typeof t=="function"}function i0(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Gy=i0(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function um(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Ih=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Gu(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(m){e={error:m}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Fn(u))try{u()}catch(m){s=m instanceof Gy?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Gu(d),h=f.next();!h.done;h=f.next()){var p=h.value;try{vk(p)}catch(m){s=s??[],m instanceof Gy?s=Qu(Qu([],Zu(s)),Zu(m.errors)):s.push(m)}}}catch(m){r={error:m}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(s)throw new Gy(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)vk(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&um(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&um(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),HI=Ih.EMPTY;function VI(t){return t instanceof Ih||t&&"closed"in t&&Fn(t.remove)&&Fn(t.add)&&Fn(t.unsubscribe)}function vk(t){Fn(t)?t():t.unsubscribe()}var H$={Promise:void 0},V$={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Qu([t,e],Zu(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function jI(t){V$.setTimeout(function(){throw t})}function iv(){}function Up(t){t()}var p2=(function(t){ca(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,VI(n)&&n.add(r)):r.destination=q$,r}return e.create=function(n,r,i){return new dm(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Ih),j$=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){fp(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){fp(r)}else fp(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){fp(n)}},t})(),dm=(function(t){ca(e,t);function e(n,r,i){var s=t.call(this)||this,o;return Fn(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new j$(o),s}return e})(p2);function fp(t){jI(t)}function W$(t){throw t}var q$={closed:!0,next:iv,error:W$,complete:iv},m2=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function ua(t){return t}function K$(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return WI(t)}function WI(t){return t.length===0?ua:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var vi=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=Z$(e)?e:new dm(e,n,r);return Up(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=xk(n),new n(function(i,s){var o=new dm({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[m2]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return WI(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=xk(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function xk(t){var e;return(e=t??H$.Promise)!==null&&e!==void 0?e:Promise}function G$(t){return t&&Fn(t.next)&&Fn(t.error)&&Fn(t.complete)}function Z$(t){return t&&t instanceof p2||G$(t)&&VI(t)}function Q$(t){return Fn(t?.lift)}function Hr(t){return function(e){if(Q$(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Er(t,e,n,r,i){return new X$(t,e,n,r,i)}var X$=(function(t){ca(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(p2),Y$=i0(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),An=(function(t){ca(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new Sk(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Y$},e.prototype.next=function(n){var r=this;Up(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Gu(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;Up(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Up(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?HI:(this.currentObservers=null,a.push(n),new Ih(function(){r.currentObservers=null,um(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new vi;return n.source=this,n},e.create=function(n,r){return new Sk(n,r)},e})(vi),Sk=(function(t){ca(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:HI},e})(An),J$=(function(t){ca(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(An),eF={now:function(){return Date.now()}},tF=(function(t){ca(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(Ih),sv={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=sv.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Qu([t,e],Zu(n))):setInterval.apply(void 0,Qu([t,e],Zu(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},nF=(function(t){ca(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),sv.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&sv.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,um(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(tF),Ek=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=eF.now,t})(),rF=(function(t){ca(e,t);function e(n,r){r===void 0&&(r=Ek.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(Ek),qI=new rF(nF),iF=qI,Ph=new vi(function(t){return t.complete()});function sF(t){return t&&Fn(t.schedule)}function g2(t){return t[t.length-1]}function oF(t){return Fn(g2(t))?t.pop():void 0}function y2(t){return sF(g2(t))?t.pop():void 0}function aF(t,e){return typeof g2(t)=="number"?t.pop():e}var KI=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function GI(t){return Fn(t?.then)}function ZI(t){return Fn(t[m2])}function QI(t){return Symbol.asyncIterator&&Fn(t?.[Symbol.asyncIterator])}function XI(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function lF(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var YI=lF();function JI(t){return Fn(t?.[YI])}function e3(t){return z$(this,arguments,function(){var e,n,r,i;return UI(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,Nu(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,Nu(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,Nu(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function t3(t){return Fn(t?.getReader)}function mo(t){if(t instanceof vi)return t;if(t!=null){if(ZI(t))return cF(t);if(KI(t))return uF(t);if(GI(t))return dF(t);if(QI(t))return n3(t);if(JI(t))return fF(t);if(t3(t))return hF(t)}throw XI(t)}function cF(t){return new vi(function(e){var n=t[m2]();if(Fn(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function uF(t){return new vi(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function dF(t){return new vi(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,jI)})}function fF(t){return new vi(function(e){var n,r;try{for(var i=Gu(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function n3(t){return new vi(function(e){pF(t,e).catch(function(n){return e.error(n)})})}function hF(t){return n3(e3(t))}function pF(t,e){var n,r,i,s;return F$(this,void 0,void 0,function(){var o,a;return UI(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=U$(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function so(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function r3(t,e){return e===void 0&&(e=0),Hr(function(n,r){n.subscribe(Er(r,function(i){return so(r,t,function(){return r.next(i)},e)},function(){return so(r,t,function(){return r.complete()},e)},function(i){return so(r,t,function(){return r.error(i)},e)}))})}function i3(t,e){return e===void 0&&(e=0),Hr(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function mF(t,e){return mo(t).pipe(i3(e),r3(e))}function gF(t,e){return mo(t).pipe(i3(e),r3(e))}function yF(t,e){return new vi(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function bF(t,e){return new vi(function(n){var r;return so(n,e,function(){r=t[YI](),so(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return Fn(r?.return)&&r.return()}})}function s3(t,e){if(!t)throw new Error("Iterable cannot be null");return new vi(function(n){so(n,e,function(){var r=t[Symbol.asyncIterator]();so(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function wF(t,e){return s3(e3(t),e)}function vF(t,e){if(t!=null){if(ZI(t))return mF(t,e);if(KI(t))return yF(t,e);if(GI(t))return gF(t,e);if(QI(t))return s3(t,e);if(JI(t))return bF(t,e);if(t3(t))return wF(t,e)}throw XI(t)}function Mh(t,e){return e?vF(t,e):mo(t)}function o3(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=y2(t);return Mh(t,n)}var b2=i0(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function a3(t,e){return new Promise(function(n,r){var i=new dm({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new b2)}});t.subscribe(i)})}function l3(t){return t instanceof Date&&!isNaN(t)}var c3=i0(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function u3(t,e){var n=l3(t)?{first:t}:typeof t=="number"?{each:t}:t,r=n.first,i=n.each,s=n.with,o=s===void 0?xF:s,a=n.scheduler,l=a===void 0?qI:a,c=n.meta,u=c===void 0?null:c;if(r==null&&i==null)throw new TypeError("No timeout provided.");return Hr(function(d,f){var h,p,m=null,g=0,y=function(w){p=so(f,l,function(){try{h.unsubscribe(),mo(o({meta:u,lastValue:m,seen:g})).subscribe(f)}catch(k){f.error(k)}},w)};h=d.subscribe(Er(f,function(w){p?.unsubscribe(),g++,f.next(m=w),i>0&&y(i)},void 0,void 0,function(){p!=null&&p.closed||p==null||p.unsubscribe(),m=null})),!g&&y(r!=null?typeof r=="number"?r:+r-l.now():i)})}function xF(t){throw new c3(t)}function hl(t,e){return Hr(function(n,r){var i=0;n.subscribe(Er(r,function(s){r.next(t.call(e,s,i++))}))})}var SF=Array.isArray;function EF(t,e){return SF(e)?t.apply(void 0,Qu([],Zu(e))):t(e)}function kF(t){return hl(function(e){return EF(t,e)})}var TF=Array.isArray,_F=Object.getPrototypeOf,CF=Object.prototype,AF=Object.keys;function IF(t){if(t.length===1){var e=t[0];if(TF(e))return{args:e,keys:null};if(PF(e)){var n=AF(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function PF(t){return t&&typeof t=="object"&&_F(t)===CF}function MF(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function OF(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=y2(t),r=oF(t),i=IF(t),s=i.args,o=i.keys;if(s.length===0)return Mh([],n);var a=new vi(NF(s,n,o?function(l){return MF(o,l)}:ua));return r?a.pipe(kF(r)):a}function NF(t,e,n){return n===void 0&&(n=ua),function(r){kk(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(u){kk(e,function(){var d=Mh(t[u],e),f=!1;d.subscribe(Er(r,function(h){s[u]=h,f||(f=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function kk(t,e,n){t?so(n,t,e):e()}function RF(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,d=!1,f=function(){d&&!l.length&&!c&&e.complete()},h=function(m){return c<r?p(m):l.push(m)},p=function(m){c++;var g=!1;mo(n(m,u++)).subscribe(Er(e,function(y){e.next(y)},function(){g=!0},void 0,function(){if(g)try{c--;for(var y=function(){var w=l.shift();o?so(e,o,function(){return p(w)}):p(w)};l.length&&c<r;)y();f()}catch(w){e.error(w)}}))};return t.subscribe(Er(e,h,function(){d=!0,f()})),function(){}}function fm(t,e,n){return n===void 0&&(n=1/0),Fn(e)?fm(function(r,i){return hl(function(s,o){return e(r,s,i,o)})(mo(t(r,i)))},n):(typeof e=="number"&&(n=e),Hr(function(r,i){return RF(r,i,t,n)}))}function d3(t){return t===void 0&&(t=1/0),fm(ua,t)}function Tk(t,e,n){return t===void 0&&(t=0),n===void 0&&(n=iF),new vi(function(r){var i=l3(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){r.closed||(r.next(s++),r.complete())},i)})}function LF(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=y2(t),r=aF(t,1/0),i=t;return i.length?i.length===1?mo(i[0]):d3(r)(Mh(i,n)):Ph}function Gi(t,e){return Hr(function(n,r){var i=0;n.subscribe(Er(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function f3(t){return Hr(function(e,n){var r=null,i=!1,s;r=e.subscribe(Er(n,void 0,void 0,function(o){s=mo(t(o,f3(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function DF(t){return Hr(function(e,n){var r=!1;e.subscribe(Er(n,function(i){r=!0,n.next(i)},function(){r||n.next(t),n.complete()}))})}function BF(t){return t<=0?function(){return Ph}:Hr(function(e,n){var r=0;e.subscribe(Er(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function $F(t,e){return e===void 0&&(e=ua),t=t??FF,Hr(function(n,r){var i,s=!0;n.subscribe(Er(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function FF(t,e){return t===e}function zF(t){return t===void 0&&(t=UF),Hr(function(e,n){var r=!1;e.subscribe(Er(n,function(i){r=!0,n.next(i)},function(){return r?n.complete():n.error(t())}))})}function UF(){return new b2}function Zy(t){return Hr(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function ov(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?Gi(function(i,s){return t(i,s,r)}):ua,BF(1),n?DF(e):zF(function(){return new b2}))}}function HF(t,e){return Hr(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Er(r,function(l){i?.unsubscribe();var c=0,u=s++;mo(t(l,u)).subscribe(i=Er(r,function(d){return r.next(e?e(l,d,u,c++):d)},function(){i=null,a()}))},function(){o=!0,a()}))})}function VF(){return HF(ua)}function Ud(t){return Hr(function(e,n){mo(t).subscribe(Er(n,function(){return n.complete()},iv)),!n.closed&&e.subscribe(n)})}function jF(t,e){return Hr(function(n,r){var i=0;n.subscribe(Er(r,function(s){var o=t(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function hp(t,e,n){var r=Fn(t)||e||n?{next:t,error:e,complete:n}:t;return r?Hr(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Er(s,function(l){var c;(c=r.next)===null||c===void 0||c.call(r,l),s.next(l)},function(){var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),s.complete()},function(l){var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),s.error(l)},function(){var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):ua}function WF(t){return fm((e,n)=>Mh(t(e,n)).pipe(fm(r=>r?o3(e):Ph)))}function _k(t){return K$(u3(t),f3(e=>{if(e instanceof c3)return Ph;throw e}))}function Qy(t,e){const{not:n}=Ah(e,{not:!1});return Gi(r=>qF(r.subId===t,n))}function qF(t,e){return!t&&e||t&&!e}let KF=class{constructor(e){tt(this,"relay"),tt(this,"config"),tt(this,"authenticator"),tt(this,"ongoings",new Set),tt(this,"authResult$",new An),tt(this,"disposed",!1),this.relay=e.relay,this.config=e.config,this.authenticator=e.authenticator;const n=this.relay.getOKObservable().subscribe(i=>{const{eventId:s,ok:o}=i;this.ongoings.has(s)&&(this.ongoings.delete(s),this.authResult$.next(o),o||(n.unsubscribe(),r.unsubscribe()))}),r=this.relay.getAUTHObservable().subscribe(({challenge:i})=>{this.challenge(i)})}getAuthResultObservable(){return this.authResult$.asObservable()}async challenge(e){try{const n=await this.signer.signEvent({kind:22242,content:"",tags:[["relay",this.relay.url],["challenge",e]]});this.ongoings.add(n.id),this.relay.send(["AUTH",n])}catch{}}get signer(){return this.authenticator.signer??this.config.signer}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.authResult$];for(const n of e)n.complete()}},h3=class extends J${constructor(e){super(e??0)}increment(){this.next(this.getValue()+1)}decrement(){this.next(this.getValue()-1)}next(e){typeof e=="number"?super.next(e):super.next(e(this.getValue()))}},GF=class extends An{waitNext(){return a3(this.pipe(ov(null,void 0)))}},ZF=class{constructor(e){tt(this,"relay"),tt(this,"authProxy"),tt(this,"pubs",new Map),tt(this,"authRequiredPubs",new Set),tt(this,"count$",new h3(0)),tt(this,"ok$",new An),tt(this,"disposed",!1);var n;this.relay=e.relay,this.authProxy=e.authProxy,this.relay.getReconnectedObservable().subscribe(r=>{for(const[i,s]of r)i==="EVENT"&&this.pubs.has(s.id)&&this.sendEVENT(s)}),this.relay.getOKObservable().subscribe(async r=>{const{eventId:i,notice:s}=r;this.pubs.get(i)&&(this.authProxy&&s!=null&&s.startsWith("auth-required:")?(this.authRequiredPubs.add(i),this.ok$.next({...r,done:!1})):(this.ok$.next({...r,done:!0}),this.confirmOK(i)))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{if(r)for(const i of this.authRequiredPubs){const s=this.pubs.get(i);s&&this.sendEVENT(s)}else for(const i of this.authRequiredPubs)this.confirmOK(i);this.authRequiredPubs.clear()})}async publish(e){if(!this.disposed)return this.pubs.has(e.id)||(this.pubs.set(e.id,e),this.count$.increment()),this.sendEVENT(e)}confirmOK(e){this.disposed||this.pubs.has(e)||(this.pubs.delete(e),this.count$.decrement())}getOkAgainstEventObservable(){return this.ok$.asObservable()}getLogicalConnectionSizeObservable(){return this.count$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.count$,this.ok$];for(const n of e)n.complete()}sendEVENT(e){return this.relay.send(["EVENT",e])}};const Ck={OPEN:1};let QF=class{constructor(e,n){tt(this,"socket",null),tt(this,"buffer",[]),tt(this,"unsent",[]),tt(this,"reconnected$",new An),tt(this,"outgoing$",new An),tt(this,"message$",new An),tt(this,"error$",new An),tt(this,"retryTimer",null),tt(this,"sendAttempted$",new GF),tt(this,"isFirstTry",!0),tt(this,"maybeDown",!1),tt(this,"disposed",!1),tt(this,"state$",new An),tt(this,"_state","initialized"),this.url=e,this.config=n,n.skipFetchNip11||cm.getOrFetch(e),this.setState("initialized")}get state(){return this._state}setState(e){this._state=e,this.state$.next(e)}connectManually(){this.connect()}connect(e){if(this.state==="terminated")return;const n=typeof e=="number";(this.state==="initialized"||this.state==="dormant"||this.state==="error"||this.state==="rejected"||n)&&(this.socket=this.createSocket(e??0))}createSocket(e){const n=this.isFirstTry;this.isFirstTry=!1;let r=!1;const i=e>0,s=this.state==="error"||this.state==="rejected";i?this.setState("retrying"):this.setState("connecting");const o=async()=>{if(this.state==="terminated"){u?.close(cu.RX_NOSTR_DISPOSED);return}this.setState("connected"),r=!0,(i||s)&&(this.reconnected$.next(this.unsent),this.unsent=[]);try{for(const d of this.buffer)this.send(d)}catch(d){this.error$.next(d)}finally{this.buffer=[]}},a=({data:d})=>{if(this.state!=="terminated")try{this.message$.next(this.pack(JSON.parse(d)))}catch(f){this.error$.next(f)}},l=({code:d})=>{var f;if(u?.removeEventListener("open",o),u?.removeEventListener("message",a),u?.removeEventListener("close",l),this.socket===u&&(this.socket=null),this.state==="terminated"||d===cu.RX_NOSTR_DISPOSED){this.unsent=[],this.buffer=[];return}if(d===cu.RX_NOSTR_IDLE)this.setState("dormant"),this.buffer.length>0&&this.connect();else if(d===cu.DONT_RETRY)this.unsent=[],this.buffer=[],this.error$.next(new mk(d)),this.setState("rejected");else{n&&!r&&(this.maybeDown=!0),this.unsent.push(...this.buffer),this.buffer=[],this.error$.next(new mk(d));const h=e+1;this.config.retry.strategy!=="off"&&!(this.config.retry.polite&&this.maybeDown)&&h<=this.config.retry.maxCount?(this.setState("waiting-for-retrying"),(f=this.retryTimer)==null||f.unsubscribe(),this.retryTimer=XF(this.config.retry,h).subscribe(()=>{this.disposed||this.connect(h)})):this.setState("error")}},c=this.config.websocketCtor??globalThis.WebSocket;if(!c)throw new Fp("WebSocket constructor is missing");const u=(()=>{try{return new c(this.url)}catch{return l({code:0}),null}})();return u?.addEventListener("open",o),u?.addEventListener("message",a),u?.addEventListener("close",l),u}pack(e){const n=e[0],r=this.url;switch(n){case"EVENT":return{from:r,type:n,message:e,subId:e[1],event:e[2]};case"EOSE":return{from:r,type:n,message:e,subId:e[1]};case"OK":return{from:r,type:n,message:e,eventId:e[1],ok:e[2],notice:e[3]};case"CLOSED":return{from:r,type:n,message:e,subId:e[1],notice:e[2]};case"NOTICE":return{from:r,type:n,message:e,notice:e[1]};case"AUTH":return{from:r,type:n,message:e,challenge:e[1]};case"COUNT":return{from:r,type:n,message:e,subId:e[1],count:e[2]};default:return{from:r,type:"unknown",message:e}}}disconnect(e){var n;((n=this.socket)==null?void 0:n.readyState)===Ck.OPEN&&this.socket.close(e)}send(e){const n=this.sendAttempted$.waitNext();switch(this.state){case"terminated":case"rejected":return this.sendAttempted$.next(),n;case"initialized":case"connecting":case"dormant":return this.buffer.push(e),this.connect(),n;case"connected":{if(!this.socket)throw new FI;return this.socket.readyState===Ck.OPEN?(this.outgoing$.next({to:this.url,message:e}),this.socket.send(JSON.stringify(e)),this.sendAttempted$.next(),n):(this.buffer.push(e),n)}case"waiting-for-retrying":case"retrying":case"error":return this.sendAttempted$.next(),this.unsent.push(e),n}}getEVENTObservable(){return this.message$.pipe(Gi(e=>e.type==="EVENT"))}getEOSEObservable(){return this.message$.pipe(Gi(e=>e.type==="EOSE"))}getCLOSEDObservable(){return this.message$.pipe(Gi(e=>e.type==="CLOSED"))}getOKObservable(){return this.message$.pipe(Gi(e=>e.type==="OK"))}getAUTHObservable(){return this.message$.pipe(Gi(e=>e.type==="AUTH"))}getAllMessageObservable(){return this.message$.asObservable()}getOutgoingMessageObservable(){return this.outgoing$.asObservable()}getReconnectedObservable(){return this.reconnected$.asObservable()}getConnectionStateObservable(){return this.state$.pipe($F(),hl(e=>({from:this.url,state:e})))}getErrorObservable(){return this.error$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){var e,n;if(this.disposed)return;this.disposed=!0,this.setState("terminated"),(e=this.retryTimer)==null||e.unsubscribe(),(n=this.socket)==null||n.close(cu.RX_NOSTR_DISPOSED),this.socket=null;const r=[this.state$,this.outgoing$,this.message$,this.error$,this.reconnected$,this.sendAttempted$];for(const i of r)i.complete()}};function XF(t,e){switch(t.strategy){case"exponential":{const n=Math.max(t.initialDelay*2**(e-1)+(Math.random()-.5)*1e3,1e3);return Tk(n)}case"immediately":return o3(0);case"linear":return Tk(t.interval);case"off":return Ph}}const cu={DONT_RETRY:4e3,RX_NOSTR_IDLE:4537,RX_NOSTR_DISPOSED:4538};let YF=class{constructor(e){tt(this,"relay"),tt(this,"authProxy"),tt(this,"config"),tt(this,"subs",new Map),tt(this,"authRequiredSubs",new Set),tt(this,"fin$",new An),tt(this,"disposed",!1),tt(this,"queue");var n;this.relay=e.relay,this.authProxy=e.authProxy,this.config=e.config,this.queue=new JF(this.relay.url,this.config),this.queue.getActivationObservable().subscribe(r=>{for(const{req:i}of r)this.sendREQ(i)}),this.relay.getReconnectedObservable().subscribe(()=>{for(const{req:r}of this.queue.ongoings)this.sendREQ(r)}),this.relay.getEOSEObservable().subscribe(({subId:r})=>{var i;(i=this.subs.get(r))!=null&&i.autoclose&&this.unsubscribe(r)}),this.relay.getCLOSEDObservable().subscribe(async({subId:r,notice:i})=>{this.subs.get(r)&&(this.authProxy&&i!=null&&i.startsWith("auth-required:")?this.authRequiredSubs.add(r):this.fin(r))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{var i;if(r)for(const s of this.authRequiredSubs){const o=(i=this.subs.get(s))==null?void 0:i.req;o&&this.sendREQ(o)}else for(const s of this.authRequiredSubs)this.fin(s);this.authRequiredSubs.clear()})}subscribe(e,n){if(this.disposed)return;const r=e[1],i={subId:r,req:e,autoclose:n};this.subs.set(r,i),this.queue.enqueue(i)}unsubscribe(e){this.disposed||(this.subs.has(e)&&this.sendCLOSE(e),this.fin(e))}isOngoingOrQueued(e){return this.subs.has(e)}getEventObservable(){return this.relay.getEVENTObservable().pipe(Gi(({subId:e,event:n})=>{var r;const i=(r=this.subs.get(e))==null?void 0:r.filters;return i?this.config.skipValidateFilterMatching||B$(n,i):!1}))}getFinObservable(){return this.fin$.asObservable()}getLogicalConnectionSizeObservable(){return this.queue.getSizeObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.fin$];for(const n of e)n.complete();this.queue.dispose()}sendREQ([,e,...n]){const r=L$(n),i=this.subs.get(e);i&&(i.filters=r,this.relay.send(["REQ",e,...r]))}sendCLOSE(e){this.relay.send(["CLOSE",e])}fin(e){this.subs.delete(e),this.queue.drop(e),this.fin$.next({from:this.relay.url,subId:e})}},JF=class{constructor(e,n){tt(this,"_queuings",[]),tt(this,"_ongoings",[]),tt(this,"activated$",new An),tt(this,"count$",new h3),this.url=e,this.config=n}get queuings(){return this._queuings}set queuings(e){this._queuings=e}get ongoings(){return this._ongoings}set ongoings(e){this._ongoings=e}enqueue(e){this.queuings=[...this.queuings,e],this.count$.increment(),this.shift()}drop(e){const n=(a,l)=>{const c=a.length,u=a.filter(f=>f.subId!==l),d=c-u.length;return[u,d]},[r,i]=n(this.queuings,e),[s,o]=n(this.ongoings,e);this.queuings=r,this.ongoings=s,this.count$.next(a=>a-(i+o)),this.shift()}getActivationObservable(){return this.activated$.asObservable()}getSizeObservable(){return this.count$.asObservable()}dispose(){const e=[this.activated$,this.count$];for(const n of e)n.complete()}async shift(){const e=await this.capacity(),n=[...this.ongoings,...this.queuings],r=n.slice(0,e),i=n.slice(e),s=this.queuings.slice(0,e-this.ongoings.length);this.ongoings=r,this.queuings=i,s.length>0&&this.activated$.next(s)}async capacity(){return await cm.getValue(this.url,e=>{var n;return(n=e.limitation)==null?void 0:n.max_subscriptions},{skipFetch:this.config.skipFetchNip11})??1/0}},ez=class{constructor(e,n){tt(this,"relay"),tt(this,"pubProxy"),tt(this,"subProxy"),tt(this,"defaultSubscriptionIds",new Set),tt(this,"communicating",!1),tt(this,"strategy","lazy"),tt(this,"disconnectTimeout"),tt(this,"disconnectTimer"),tt(this,"isDefaultRelay",!1),tt(this,"disposed",!1),tt(this,"_url"),this._url=No(e);const r=tz(e,n),i=new QF(this.url,n),s=r?new KF({relay:i,config:n,authenticator:r}):null,o=new ZF({relay:i,authProxy:s}),a=new YF({relay:i,authProxy:s,config:n});this.relay=i,this.pubProxy=o,this.subProxy=a,this.disconnectTimeout=n.disconnectTimeout,OF([this.pubProxy.getLogicalConnectionSizeObservable(),this.subProxy.getLogicalConnectionSizeObservable()]).pipe(hl(([l,c])=>l+c)).subscribe(l=>{this.communicating=l>0,this.resetConnection()})}get url(){return this._url}setConnectionStrategy(e){this.disposed||(this.strategy=e,this.resetConnection())}resetConnection(){let e=this.strategy;switch(this.isDefaultRelay||(e="lazy"),e){case"lazy":{const n=()=>{this.communicating||this.relay.disconnect(cu.RX_NOSTR_IDLE)};this.disconnectTimeout>0?(this.disconnectTimeout&&(clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0),this.disconnectTimer=setTimeout(n,this.disconnectTimeout)):n();break}case"lazy-keep":break;case"aggressive":{(this.connectionState==="initialized"||this.connectionState==="dormant")&&this.relay.connectManually();break}}}markAsDefault(e){if(!this.disposed){if(this.isDefaultRelay=e,!this.isDefaultRelay){for(const n of this.defaultSubscriptionIds)this.subProxy.unsubscribe(n);this.defaultSubscriptionIds.clear()}this.resetConnection()}}async publish(e){if(!this.disposed)return this.pubProxy.publish(e)}confirmOK(e){this.disposed||this.pubProxy.confirmOK(e)}subscribe(e,n){if(this.disposed)return;const{mode:r,overwrite:i,autoclose:s}=Ah(n??{},{overwrite:!1,autoclose:!1,mode:"default"}),[,o]=e;r==="default"&&!this.isDefaultRelay||!i&&this.subProxy.isOngoingOrQueued(o)||(r==="default"&&this.defaultSubscriptionIds.add(o),this.subProxy.subscribe(e,s))}unsubscribe(e){this.disposed||(this.defaultSubscriptionIds.delete(e),this.subProxy.unsubscribe(e))}getEventObservable(){if(this.disposed)throw new Io;return this.subProxy.getEventObservable()}getFinObservable(){if(this.disposed)throw new Io;return this.subProxy.getFinObservable()}getOkAgainstEventObservable(){if(this.disposed)throw new Io;return this.pubProxy.getOkAgainstEventObservable()}getAllMessageObservable(){if(this.disposed)throw new Io;return this.relay.getAllMessageObservable()}getOutgoingMessageObservable(){if(this.disposed)throw new Io;return this.relay.getOutgoingMessageObservable()}getConnectionStateObservable(){if(this.disposed)throw new Io;return this.relay.getConnectionStateObservable()}get connectionState(){return this.relay.state}getErrorObservable(){if(this.disposed)throw new Io;return this.relay.getErrorObservable().pipe(hl(e=>({from:this.url,reason:e})))}connectManually(){this.relay.connectManually()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){this.disposed||(this.disposed=!0,this.disconnectTimer&&clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0,this.relay.dispose(),this.pubProxy.dispose(),this.subProxy.dispose())}};function tz(t,e){const n=e.authenticator;if(!n)return;const r=n instanceof Function?n(t):n;return r==="auto"?{}:r}function nz(t,e){return t.filter(n=>!e.includes(n))}function rz(t){const{rxReq:e,index:n}=t,{rxReqId:r,strategy:i}=e;return`${r}:${i==="backward"?n:0}`}function iz(t){const{rxReq:e,filters:n,index:r}=t;return["REQ",rz({rxReq:e,index:r}),...n]}function Ak(t){if(Array.isArray(t)){const e=t.map(n=>{let r="",i=!1,s=!1;if(typeof n=="string")r=n,i=!0,s=!0;else if(Array.isArray(n)){const o=n[2];r=n[1],i=!o||o==="read",s=!o||o==="write"}else r=n.url,i=n.read,s=n.write;return{url:r,read:i,write:s}});return Object.fromEntries(e.map(n=>[n.url,n]))}else{const e=Object.entries(t).map(([n,r])=>({url:n,...r}));return Object.fromEntries(e.map(n=>[n.url,n]))}}function Ik(t,e){const n=new Set;if(e!=null&&e.on){const r=e.on;if(!r.defaultReadRelays&&!r.defaultWriteRelays&&!r.relays)return;const i=t.getDefaultRelays();if(r.defaultReadRelays)for(const{url:s}of Object.values(i).filter(o=>o.read))n.add(s);if(r.defaultWriteRelays)for(const{url:s}of Object.values(i).filter(o=>o.write))n.add(s);if(r.relays)for(const s of r.relays)n.add(No(s));return[...n]}else if(e!=null&&e.relays){for(const r of e.relays)n.add(No(r));return[...n]}else return}function sz(t){return new oz(R$(t??{}))}let oz=class{constructor(e){tt(this,"connections",new zp),tt(this,"defaultRelays",new zp),tt(this,"defaultSubscriptions",new Map),tt(this,"event$",new An),tt(this,"fin$",new An),tt(this,"ok$",new An),tt(this,"all$",new An),tt(this,"error$",new An),tt(this,"connectionState$",new An),tt(this,"outgoing$",new An),tt(this,"dispose$",new An),tt(this,"disposed",!1),this.config=e}get defaultReadables(){const e=[];for(const{url:n,read:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}get defaultWritables(){const e=[];for(const{url:n,write:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}getDefaultRelays(){if(this.disposed)throw new Io;return this.defaultRelays.toObject()}getDefaultRelay(e){return this.defaultRelays.get(e)}setDefaultRelays(e){if(this.disposed)throw new Io;const n=new zp(Ak(e)),r=[];for(const{read:i,url:s}of n.values()){const o=this.ensureNostrConnection(s);o.setConnectionStrategy(this.config.connectionStrategy),i&&r.push(o)}this.updateDefaultSubscriptions(r),this.defaultRelays=n}ensureNostrConnection(e){let n=this.connections.get(e);return n||(n=new ez(e,this.config),this.attachNostrConnection(n),this.connections.set(e,n),n)}attachNostrConnection(e){e.getEventObservable().subscribe(this.event$),e.getFinObservable().subscribe(this.fin$),e.getOkAgainstEventObservable().subscribe(this.ok$),e.getAllMessageObservable().subscribe(this.all$),e.getConnectionStateObservable().subscribe(this.connectionState$),e.getErrorObservable().subscribe(this.error$),e.getOutgoingMessageObservable().subscribe(this.outgoing$)}updateDefaultSubscriptions(e){const n=nz(this.defaultReadables,e);for(const r of n)r.markAsDefault(!1);for(const r of e){r.markAsDefault(!0);for(const{req:i,autoclose:s}of this.defaultSubscriptions.values())r?.subscribe(i,{mode:"default",overwrite:!1,autoclose:s})}}addDefaultRelays(e){const n=Ak(e);this.setDefaultRelays({...this.defaultRelays.toObject(),...n})}removeDefaultRelays(e){const n=this.defaultRelays.copy(),r=Array.isArray(e)?e:[e];for(const i of r)n.delete(i);this.setDefaultRelays(n.toObject())}getAllRelayStatus(){return Object.fromEntries(Array.from(this.connections.values()).map(e=>[e.url,{connection:e.connectionState}]))}getRelayStatus(e){const n=this.connections.get(e);if(n)return{connection:n.connectionState}}reconnect(e){const n=this.getDefaultRelay(e);if(!n)throw new Fp(`The relay (${e}) is not a default relay. \`reconnect()\` can be used only for a readable default relay.`);if(!n.read)throw new Fp(`The relay (${e}) is not readable. \`reconnect()\` can be used only for a readable default relay.`);const r=this.connections.get(e);if(!r)throw new FI;(r.connectionState==="error"||r.connectionState==="rejected")&&r.connectManually()}use(e,n){const r=Ik(this,n),i=({filters:u,relays:d},f)=>{var h;const p=e.strategy==="backward"?d:void 0,m=iz({rxReq:e,filters:u,index:f});return{subId:m[1],req:m,targetConnections:((h=p??r)==null?void 0:h.map(g=>this.ensureNostrConnection(g)))??this.defaultReadables,mode:p===void 0&&r===void 0?"default":"temporary"}},s=({req:u,targetConnections:d,mode:f})=>{this.startSubscription({req:u,targetConnections:d,mode:f,overwrite:e.strategy==="forward",autoclose:e.strategy==="backward"})},o=({subId:u,targetConnections:d,mode:f})=>{this.teardownSubscription({subId:u,targetConnections:d,mode:f})},a=({req:u,targetConnections:d})=>e.strategy==="forward"?this.createForwardEventObservable({req:u}).pipe(Ud(this.dispose$)):this.createBackwardEventObservable({req:u,targetConnections:d}).pipe(Ud(this.dispose$)),l=e.getReqPacketObservable().pipe(Gi(({filters:u})=>u.length>0),hl(i),Ud(this.dispose$)),c=()=>WF(async({event:u})=>(this.config.skipVerify||await this.config.verifier(u))&&(this.config.skipExpirationCheck||!$$(u)));if(e.strategy==="forward"){let u;return l.pipe(hp(d=>{u=d}),hp(s),hl(a),Zy(()=>{u&&o(u)}),VF(),c())}else return l.pipe(hp(s),hl(u=>a(u).pipe(Zy(()=>{o(u)}))),d3(),c())}createForwardEventObservable(e){const{req:n}=e,r=n[1];return this.event$.pipe(Qy(r))}createBackwardEventObservable(e){const{req:n,targetConnections:r}=e,i=n[1],s=new Set,o=u=>u==="error"||u==="rejected"||u==="terminated",a=()=>r.every(({connectionState:u,url:d})=>o(u)||s.has(d)),l=this.fin$.pipe(Qy(i),hp(({from:u})=>{s.add(u)})),c=LF(l,this.connectionState$.asObservable()).pipe(Gi(()=>a()),ov(null,void 0));return this.event$.pipe(Ud(c),_k(this.config.eoseTimeout),Qy(i),Gi(u=>!s.has(u.from)))}startSubscription(e){const{req:n,targetConnections:r,mode:i,overwrite:s,autoclose:o}=e,a=n[1];i==="default"&&this.defaultSubscriptions.set(a,{req:n,autoclose:o});for(const l of r)l.subscribe(n,{mode:i,overwrite:s,autoclose:o})}teardownSubscription(e){const{subId:n,targetConnections:r,mode:i}=e;i==="default"&&this.defaultSubscriptions.delete(n);for(const s of r)s.unsubscribe(n)}createAllEventObservable(){return this.event$.asObservable()}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.all$.asObservable()}createConnectionStateObservable(){return this.connectionState$.asObservable()}createOutgoingMessageObservable(){return this.outgoing$.asObservable()}send(e,n){const{signer:r,errorOnTimeout:i,completeOn:s}=Ah(n??{},{signer:this.config.signer,errorOnTimeout:!1,completeOn:"all-ok"}),o=Ik(this,n),a=o===void 0?this.defaultWritables:o.map(h=>this.ensureNostrConnection(h)),l=new An,c=new Set;let u="";const d=()=>{l.closed||l.complete();for(const h of a)h.confirmOK(u)};r.signEvent(e).then(async h=>{l.closed||(u=h.id,this.ok$.pipe(Gi(({eventId:p})=>p===h.id)).subscribe(l),await Promise.all(a.map(p=>p.publish(h))),s==="sent"&&l.complete())}).catch(h=>{throw d(),new Fp(h instanceof Error?h.message:"Failed to sign the given event")});const f=(()=>{switch(s){case"sent":return ua;case"all-ok":return jF(({from:h,done:p})=>(p&&c.add(h),c.size<a.length),!0);case"any-ok":return ov(h=>h.ok)}})();return l.pipe(f,Ud(this.dispose$),i?u3(this.config.okTimeout):_k(this.config.okTimeout),Zy(d))}async cast(e,n){await a3(this.send(e,{...n,completeOn:"sent"}))}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;for(const n of this.connections.values())n.dispose();this.connections.clear();const e=[this.event$,this.ok$,this.fin$,this.all$,this.connectionState$,this.error$,this.outgoing$];for(const n of e)n.complete();this.dispose$.next(),this.dispose$.complete()}};const p3=t=>{const{strategy:e}=t,n=t.operators??[],r=t.rxReqId??az(),i=t.subject??new An;return{strategy:e,rxReqId:r,getReqPacketObservable(){return i.pipe(...n)},pipe(...s){return p3({strategy:e,rxReqId:r,operators:[...n,...s],subject:i})},emit(s,o){i.next({filters:cz(s),...o??{}})},over(){i.complete()}}};function hm(t){return p3({strategy:"forward",rxReqId:t})}function az(){return`${Math.floor(Math.random()*1e6)}`}function lz(t){var e,n;const r={},i=s=>/^#[a-zA-Z]$/.test(s);for(const s of Object.keys(t)){if(s==="limit"&&(t[s]??-1)>=0){r[s]=t[s];continue}if(s==="since"||s==="until"){const o=t[s];if(typeof o!="number"||(o??-1)>=0){r[s]=o;continue}}if((i(s)||s==="ids"||s==="authors")&&t[s]!==void 0&&(((e=t[s])==null?void 0:e.length)??-1)>0){r[s]=t[s];continue}if(s==="kinds"&&t[s]!==void 0&&(((n=t[s])==null?void 0:n.length)??-1)>0){r[s]=t[s];continue}if(s==="search"&&t[s]!==void 0){r[s]=t[s];continue}}return typeof r.since!="number"||typeof r.until!="number"||r.since<=r.until?r:null}function cz(t){return(Array.isArray(t)?t:[t]).map(e=>lz(e)).filter(e=>e!==null)}function Pk(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function uz(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Oh(t,...e){if(!uz(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function dz(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Pk(t.outputLen),Pk(t.blockLen)}function pm(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function fz(t,e){Oh(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Xy=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Yy=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ns=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const hz=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function mm(t){Oh(t);let e="";for(let n=0;n<t.length;n++)e+=hz[t[n]];return e}function pz(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function w2(t){return typeof t=="string"&&(t=pz(t)),Oh(t),t}function mz(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Oh(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}let m3=class{clone(){return this._cloneInto()}};function gz(t){const e=r=>t().update(w2(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function g3(t=32){if(Xy&&typeof Xy.getRandomValues=="function")return Xy.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function yz(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const bz=(t,e,n)=>t&e^~t&n,wz=(t,e,n)=>t&e^t&n^e&n;let vz=class extends m3{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Yy(this.buffer)}update(e){pm(this);const{view:n,buffer:r,blockLen:i}=this;e=w2(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=Yy(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){pm(this),fz(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;yz(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Yy(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const xz=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ca=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Aa=new Uint32Array(64);let Sz=class extends vz{constructor(){super(64,32,8,!1),this.A=Ca[0]|0,this.B=Ca[1]|0,this.C=Ca[2]|0,this.D=Ca[3]|0,this.E=Ca[4]|0,this.F=Ca[5]|0,this.G=Ca[6]|0,this.H=Ca[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)Aa[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=Aa[d-15],h=Aa[d-2],p=Ns(f,7)^Ns(f,18)^f>>>3,m=Ns(h,17)^Ns(h,19)^h>>>10;Aa[d]=m+Aa[d-7]+p+Aa[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=Ns(a,6)^Ns(a,11)^Ns(a,25),h=u+f+bz(a,l,c)+xz[d]+Aa[d]|0,p=(Ns(r,2)^Ns(r,13)^Ns(r,22))+wz(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Aa.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const gm=gz(()=>new Sz);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const y3=BigInt(0),s0=BigInt(1),Ez=BigInt(2);function _c(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Nh(t){if(!_c(t))throw new Error("Uint8Array expected")}const kz=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Xu(t){Nh(t);let e="";for(let n=0;n<t.length;n++)e+=kz[t[n]];return e}function b3(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function v2(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}const So={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Mk(t){if(t>=So._0&&t<=So._9)return t-So._0;if(t>=So._A&&t<=So._F)return t-(So._A-10);if(t>=So._a&&t<=So._f)return t-(So._a-10)}function Yu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Mk(t.charCodeAt(s)),a=Mk(t.charCodeAt(s+1));if(o===void 0||a===void 0){const l=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function mi(t){return v2(Xu(t))}function x2(t){return Nh(t),v2(Xu(Uint8Array.from(t).reverse()))}function _l(t,e){return Yu(t.toString(16).padStart(e*2,"0"))}function S2(t,e){return _l(t,e).reverse()}function Tz(t){return Yu(b3(t))}function Or(t,e,n){let r;if(typeof e=="string")try{r=Yu(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(_c(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Cc(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Nh(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}function _z(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function Cz(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Az(t){let e;for(e=0;t>y3;t>>=s0,e+=1);return e}function Iz(t,e){return t>>BigInt(e)&s0}function Pz(t,e,n){return t|(n?s0:y3)<<BigInt(e)}const E2=t=>(Ez<<BigInt(t-1))-s0,Jy=t=>new Uint8Array(t),Ok=t=>Uint8Array.from(t);function w3(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Jy(t),i=Jy(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=Jy())=>{i=a(Ok([0]),u),r=a(),u.length!==0&&(i=a(Ok([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){r=a();const f=r.slice();d.push(f),u+=r.length}return Cc(...d)};return(u,d)=>{o(),l(u);let f;for(;!(f=d(c()));)l();return o(),f}}const Mz={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||_c(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Rh(t,e,n={}){const r=(i,s,o)=>{const a=Mz[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const Oz=Object.freeze(Object.defineProperty({__proto__:null,abytes:Nh,bitGet:Iz,bitLen:Az,bitMask:E2,bitSet:Pz,bytesToHex:Xu,bytesToNumberBE:mi,bytesToNumberLE:x2,concatBytes:Cc,createHmacDrbg:w3,ensureBytes:Or,equalBytes:_z,hexToBytes:Yu,hexToNumber:v2,isBytes:_c,numberToBytesBE:_l,numberToBytesLE:S2,numberToHexUnpadded:b3,numberToVarBytesBE:Tz,utf8ToBytes:Cz,validateObject:Rh},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const rr=BigInt(0),Bn=BigInt(1),Jl=BigInt(2),Nz=BigInt(3),av=BigInt(4),Nk=BigInt(5),Rk=BigInt(8);BigInt(9);BigInt(16);function gr(t,e){const n=t%e;return n>=rr?n:e+n}function Rz(t,e,n){if(n<=rr||e<rr)throw new Error("Expected power/modulo > 0");if(n===Bn)return rr;let r=Bn;for(;e>rr;)e&Bn&&(r=r*t%n),t=t*t%n,e>>=Bn;return r}function Bi(t,e,n){let r=t;for(;e-- >rr;)r*=r,r%=n;return r}function lv(t,e){if(t===rr||e<=rr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=gr(t,e),r=e,i=rr,s=Bn;for(;n!==rr;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==Bn)throw new Error("invert: does not exist");return gr(i,e)}function Lz(t){const e=(t-Bn)/Jl;let n,r,i;for(n=t-Bn,r=0;n%Jl===rr;n/=Jl,r++);for(i=Jl;i<t&&Rz(i,e,t)!==t-Bn;i++);if(r===1){const o=(t+Bn)/av;return function(a,l){const c=a.pow(l,o);if(!a.eql(a.sqr(c),l))throw new Error("Cannot find square root");return c}}const s=(n+Bn)/Jl;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let l=r,c=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),d=o.pow(a,n);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let f=1;for(let p=o.sqr(d);f<l&&!o.eql(p,o.ONE);f++)p=o.sqr(p);const h=o.pow(c,Bn<<BigInt(l-f-1));c=o.sqr(h),u=o.mul(u,h),d=o.mul(d,c),l=f}return u}}function Dz(t){if(t%av===Nz){const e=(t+Bn)/av;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%Rk===Nk){const e=(t-Nk)/Rk;return function(n,r){const i=n.mul(r,Jl),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Jl),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return Lz(t)}const Bz=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function $z(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Bz.reduce((r,i)=>(r[i]="function",r),e);return Rh(t,n)}function Fz(t,e,n){if(n<rr)throw new Error("Expected power > 0");if(n===rr)return t.ONE;if(n===Bn)return e;let r=t.ONE,i=e;for(;n>rr;)n&Bn&&(r=t.mul(r,i)),i=t.sqr(i),n>>=Bn;return r}function zz(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function v3(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Uz(t,e,n=!1,r={}){if(t<=rr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=v3(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=Dz(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:E2(i),ZERO:rr,ONE:Bn,create:l=>gr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return rr<=l&&l<t},is0:l=>l===rr,isOdd:l=>(l&Bn)===Bn,neg:l=>gr(-l,t),eql:(l,c)=>l===c,sqr:l=>gr(l*l,t),add:(l,c)=>gr(l+c,t),sub:(l,c)=>gr(l-c,t),mul:(l,c)=>gr(l*c,t),pow:(l,c)=>Fz(a,l,c),div:(l,c)=>gr(l*lv(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>lv(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>zz(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?S2(l,s):_l(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?x2(l):mi(l)}});return Object.freeze(a)}function x3(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function S3(t){const e=x3(t);return e+Math.ceil(e/2)}function Hz(t,e,n=!1){const r=t.length,i=x3(e),s=S3(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?mi(t):x2(t),a=gr(o,e-Bn)+Bn;return n?S2(a,i):_l(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Vz=BigInt(0),eb=BigInt(1);function jz(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>Vz;)s&eb&&(o=o.add(a)),a=a.double(),s>>=eb;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let d=0;d<o;d++){u=c,l.push(u);for(let f=1;f<a;f++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const d=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const m=p*l;let g=Number(o&d);o>>=h,g>l&&(g-=f,o+=eb);const y=m,w=m+Math.abs(g)-1,k=p%2!==0,C=g<0;g===0?u=u.add(n(k,s[y])):c=c.add(n(C,s[w]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function E3(t){return $z(t.Fp),Rh(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...v3(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Wz(t){const e=E3(t);Rh(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:qz,hexToBytes:Kz}=Oz,nc={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=nc;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:qz(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=nc,n=typeof t=="string"?Kz(t):t;Nh(n);let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=nc._parseInt(n.subarray(2)),{d:o,l:a}=nc._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},$o=BigInt(0),Vi=BigInt(1);BigInt(2);const Lk=BigInt(3);BigInt(4);function Gz(t){const e=Wz(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return Cc(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1),g=n.fromBytes(m.subarray(0,n.BYTES)),y=n.fromBytes(m.subarray(n.BYTES,2*n.BYTES));return{x:g,y}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),w=n.mul(y,p);return n.add(n.add(w,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&$o<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:w}=e;if(m&&typeof p!="bigint"){if(_c(p)&&(p=Xu(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let k;try{k=typeof p=="bigint"?p:mi(Or("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(k=gr(k,w)),a(k),k}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const w=k=>n.eql(k,n.ZERO);return w(g)&&w(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map(y=>y.pz));return m.map((y,w)=>y.toAffine(g[w])).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(Or("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),w=s(m);if(!n.eql(y,w))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:w}=this,{px:k,py:C,pz:A}=m,E=n.eql(n.mul(g,A),n.mul(k,w)),P=n.eql(n.mul(y,A),n.mul(C,w));return E&&P}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,Lk),{px:w,py:k,pz:C}=this;let A=n.ZERO,E=n.ZERO,P=n.ZERO,S=n.mul(w,w),x=n.mul(k,k),_=n.mul(C,C),I=n.mul(w,k);return I=n.add(I,I),P=n.mul(w,C),P=n.add(P,P),A=n.mul(m,P),E=n.mul(y,_),E=n.add(A,E),A=n.sub(x,E),E=n.add(x,E),E=n.mul(A,E),A=n.mul(I,A),P=n.mul(y,P),_=n.mul(m,_),I=n.sub(S,_),I=n.mul(m,I),I=n.add(I,P),P=n.add(S,S),S=n.add(P,S),S=n.add(S,_),S=n.mul(S,I),E=n.add(E,S),_=n.mul(k,C),_=n.add(_,_),S=n.mul(_,I),A=n.sub(A,S),P=n.mul(_,x),P=n.add(P,P),P=n.add(P,P),new d(A,E,P)}add(m){u(m);const{px:g,py:y,pz:w}=this,{px:k,py:C,pz:A}=m;let E=n.ZERO,P=n.ZERO,S=n.ZERO;const x=e.a,_=n.mul(e.b,Lk);let I=n.mul(g,k),D=n.mul(y,C),B=n.mul(w,A),F=n.add(g,y),R=n.add(k,C);F=n.mul(F,R),R=n.add(I,D),F=n.sub(F,R),R=n.add(g,w);let O=n.add(k,A);return R=n.mul(R,O),O=n.add(I,B),R=n.sub(R,O),O=n.add(y,w),E=n.add(C,A),O=n.mul(O,E),E=n.add(D,B),O=n.sub(O,E),S=n.mul(x,R),E=n.mul(_,B),S=n.add(E,S),E=n.sub(D,S),S=n.add(D,S),P=n.mul(E,S),D=n.add(I,I),D=n.add(D,I),B=n.mul(x,B),R=n.mul(_,R),D=n.add(D,B),B=n.sub(I,B),B=n.mul(x,B),R=n.add(R,B),I=n.mul(D,R),P=n.add(P,I),I=n.mul(O,R),E=n.mul(F,E),E=n.sub(E,I),I=n.mul(F,D),S=n.mul(O,S),S=n.add(S,I),new d(E,P,S)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,g=>{const y=n.invertBatch(g.map(w=>w.pz));return g.map((w,k)=>w.toAffine(y[k])).map(d.fromAffine)})}multiplyUnsafe(m){const g=d.ZERO;if(m===$o)return g;if(a(m),m===Vi)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:w,k1:k,k2neg:C,k2:A}=y.splitScalar(m),E=g,P=g,S=this;for(;k>$o||A>$o;)k&Vi&&(E=E.add(S)),A&Vi&&(P=P.add(S)),S=S.double(),k>>=Vi,A>>=Vi;return w&&(E=E.negate()),C&&(P=P.negate()),P=new d(n.mul(P.px,y.beta),P.py,P.pz),E.add(P)}multiply(m){a(m);let g=m,y,w;const{endo:k}=e;if(k){const{k1neg:C,k1:A,k2neg:E,k2:P}=k.splitScalar(g);let{p:S,f:x}=this.wNAF(A),{p:_,f:I}=this.wNAF(P);S=h.constTimeNegate(C,S),_=h.constTimeNegate(E,_),_=new d(n.mul(_.px,k.beta),_.py,_.pz),y=S.add(_),w=x.add(I)}else{const{p:C,f:A}=this.wNAF(g);y=C,w=A}return d.normalizeZ([y,w])[0]}multiplyAndAddUnsafe(m,g,y){const w=d.BASE,k=(A,E)=>E===$o||E===Vi||!A.equals(w)?A.multiplyUnsafe(E):A.multiply(E),C=k(this,g).add(k(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:w}=this,k=this.is0();m==null&&(m=k?n.ONE:n.inv(w));const C=n.mul(g,m),A=n.mul(y,m),E=n.mul(w,m);if(k)return{x:n.ZERO,y:n.ZERO};if(!n.eql(E,n.ONE))throw new Error("invZ was invalid");return{x:C,y:A}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===Vi)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===Vi?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return Xu(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=jz(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function Zz(t){const e=E3(t);return Rh(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Qz(t){const e=Zz(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(R){return $o<R&&R<n.ORDER}function a(R){return gr(R,r)}function l(R){return lv(R,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=Gz({...e,toBytes(R,O,L){const H=O.toAffine(),U=n.toBytes(H.x),j=Cc;return L?j(Uint8Array.from([O.hasEvenY()?2:3]),U):j(Uint8Array.from([4]),U,n.toBytes(H.y))},fromBytes(R){const O=R.length,L=R[0],H=R.subarray(1);if(O===i&&(L===2||L===3)){const U=mi(H);if(!o(U))throw new Error("Point is not on curve");const j=d(U);let Q;try{Q=n.sqrt(j)}catch(de){const le=de instanceof Error?": "+de.message:"";throw new Error("Point is not on curve"+le)}const X=(Q&Vi)===Vi;return(L&1)===1!==X&&(Q=n.neg(Q)),{x:U,y:Q}}else if(O===s&&L===4){const U=n.fromBytes(H.subarray(0,n.BYTES)),j=n.fromBytes(H.subarray(n.BYTES,2*n.BYTES));return{x:U,y:j}}else throw new Error(`Point of length ${O} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=R=>Xu(_l(R,e.nByteLength));function p(R){const O=r>>Vi;return R>O}function m(R){return p(R)?a(-R):R}const g=(R,O,L)=>mi(R.slice(O,L));class y{constructor(O,L,H){this.r=O,this.s=L,this.recovery=H,this.assertValidity()}static fromCompact(O){const L=e.nByteLength;return O=Or("compactSignature",O,L*2),new y(g(O,0,L),g(O,L,2*L))}static fromDER(O){const{r:L,s:H}=nc.toSig(Or("DER",O));return new y(L,H)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(O){return new y(this.r,this.s,O)}recoverPublicKey(O){const{r:L,s:H,recovery:U}=this,j=P(Or("msgHash",O));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const Q=U===2||U===3?L+e.n:L;if(Q>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const X=U&1?"03":"02",de=c.fromHex(X+h(Q)),le=l(Q),J=a(-j*le),he=a(H*le),Me=c.BASE.multiplyAndAddUnsafe(de,J,he);if(!Me)throw new Error("point at infinify");return Me.assertValidity(),Me}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Yu(this.toDERHex())}toDERHex(){return nc.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Yu(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const w={isValidPrivateKey(R){try{return u(R),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const R=S3(e.n);return Hz(e.randomBytes(R),e.n)},precompute(R=8,O=c.BASE){return O._setWindowSize(R),O.multiply(BigInt(3)),O}};function k(R,O=!0){return c.fromPrivateKey(R).toRawBytes(O)}function C(R){const O=_c(R),L=typeof R=="string",H=(O||L)&&R.length;return O?H===i||H===s:L?H===2*i||H===2*s:R instanceof c}function A(R,O,L=!0){if(C(R))throw new Error("first arg must be private key");if(!C(O))throw new Error("second arg must be public key");return c.fromHex(O).multiply(u(R)).toRawBytes(L)}const E=e.bits2int||function(R){const O=mi(R),L=R.length*8-e.nBitLength;return L>0?O>>BigInt(L):O},P=e.bits2int_modN||function(R){return a(E(R))},S=E2(e.nBitLength);function x(R){if(typeof R!="bigint")throw new Error("bigint expected");if(!($o<=R&&R<S))throw new Error(`bigint expected < 2^${e.nBitLength}`);return _l(R,e.nByteLength)}function _(R,O,L=I){if(["recovered","canonical"].some(Te=>Te in L))throw new Error("sign() legacy options not supported");const{hash:H,randomBytes:U}=e;let{lowS:j,prehash:Q,extraEntropy:X}=L;j==null&&(j=!0),R=Or("msgHash",R),Q&&(R=Or("prehashed msgHash",H(R)));const de=P(R),le=u(O),J=[x(le),x(de)];if(X!=null&&X!==!1){const Te=X===!0?U(n.BYTES):X;J.push(Or("extraEntropy",Te))}const he=Cc(...J),Me=de;function pe(Te){const je=E(Te);if(!f(je))return;const oe=l(je),ge=c.BASE.multiply(je).toAffine(),Ie=a(ge.x);if(Ie===$o)return;const _e=a(oe*a(Me+Ie*le));if(_e===$o)return;let Ue=(ge.x===Ie?0:2)|Number(ge.y&Vi),Je=_e;return j&&p(_e)&&(Je=m(_e),Ue^=1),new y(Ie,Je,Ue)}return{seed:he,k2sig:pe}}const I={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function B(R,O,L=I){const{seed:H,k2sig:U}=_(R,O,L),j=e;return w3(j.hash.outputLen,j.nByteLength,j.hmac)(H,U)}c.BASE._setWindowSize(8);function F(R,O,L,H=D){var U;const j=R;if(O=Or("msgHash",O),L=Or("publicKey",L),"strict"in H)throw new Error("options.strict was renamed to lowS");const{lowS:Q,prehash:X}=H;let de,le;try{if(typeof j=="string"||_c(j))try{de=y.fromDER(j)}catch(ge){if(!(ge instanceof nc.Err))throw ge;de=y.fromCompact(j)}else if(typeof j=="object"&&typeof j.r=="bigint"&&typeof j.s=="bigint"){const{r:ge,s:Ie}=j;de=new y(ge,Ie)}else throw new Error("PARSE");le=c.fromHex(L)}catch(ge){if(ge.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Q&&de.hasHighS())return!1;X&&(O=e.hash(O));const{r:J,s:he}=de,Me=P(O),pe=l(he),Te=a(Me*pe),je=a(J*pe),oe=(U=c.BASE.multiplyAndAddUnsafe(le,Te,je))==null?void 0:U.toAffine();return oe?a(oe.x)===J:!1}return{CURVE:e,getPublicKey:k,getSharedSecret:A,sign:B,verify:F,ProjectivePoint:c,Signature:y,utils:w}}let k3=class extends m3{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,dz(e);const r=w2(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return pm(this),this.iHash.update(e),this}digestInto(e){pm(this),Oh(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const T3=(t,e,n)=>new k3(t,e).update(n).digest();T3.create=(t,e)=>new k3(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Xz(t){return{hash:t,hmac:(e,...n)=>T3(t,e,mz(...n)),randomBytes:g3}}function Yz(t,e){const n=r=>Qz({...t,...Xz(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const o0=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ym=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_3=BigInt(1),bm=BigInt(2),Dk=(t,e)=>(t+e/bm)/e;function C3(t){const e=o0,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=Bi(u,n,e)*u%e,f=Bi(d,n,e)*u%e,h=Bi(f,bm,e)*c%e,p=Bi(h,i,e)*h%e,m=Bi(p,s,e)*p%e,g=Bi(m,a,e)*m%e,y=Bi(g,l,e)*g%e,w=Bi(y,a,e)*m%e,k=Bi(w,n,e)*u%e,C=Bi(k,o,e)*p%e,A=Bi(C,r,e)*c%e,E=Bi(A,bm,e);if(!cv.eql(cv.sqr(E),t))throw new Error("Cannot find square root");return E}const cv=Uz(o0,void 0,void 0,{sqrt:C3}),k2=Yz({a:BigInt(0),b:BigInt(7),Fp:cv,n:ym,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=ym,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_3*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Dk(s*t,e),l=Dk(-r*t,e);let c=gr(t-a*n-l*i,e),u=gr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},gm),a0=BigInt(0),A3=t=>typeof t=="bigint"&&a0<t&&t<o0,Jz=t=>typeof t=="bigint"&&a0<t&&t<ym,Bk={};function wm(t,...e){let n=Bk[t];if(n===void 0){const r=gm(Uint8Array.from(t,i=>i.charCodeAt(0)));n=Cc(r,r),Bk[t]=n}return gm(Cc(n,...e))}const T2=t=>t.toRawBytes(!0).slice(1),uv=t=>_l(t,32),tb=t=>gr(t,o0),Zf=t=>gr(t,ym),_2=k2.ProjectivePoint,e7=(t,e,n)=>_2.BASE.multiplyAndAddUnsafe(t,e,n);function dv(t){let e=k2.utils.normPrivateKeyToScalar(t),n=_2.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Zf(-e),bytes:T2(n)}}function I3(t){if(!A3(t))throw new Error("bad x: need 0 < x < p");const e=tb(t*t),n=tb(e*t+BigInt(7));let r=C3(n);r%bm!==a0&&(r=tb(-r));const i=new _2(t,r,_3);return i.assertValidity(),i}function P3(...t){return Zf(mi(wm("BIP0340/challenge",...t)))}function t7(t){return dv(t).bytes}function n7(t,e,n=g3(32)){const r=Or("message",t),{bytes:i,scalar:s}=dv(e),o=Or("auxRand",n,32),a=uv(s^mi(wm("BIP0340/aux",o))),l=wm("BIP0340/nonce",a,i,r),c=Zf(mi(l));if(c===a0)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=dv(c),f=P3(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(uv(Zf(d+f*s)),32),!M3(h,r,i))throw new Error("sign: Invalid signature produced");return h}function M3(t,e,n){const r=Or("signature",t,64),i=Or("message",e),s=Or("publicKey",n,32);try{const o=I3(mi(s)),a=mi(r.subarray(0,32));if(!A3(a))return!1;const l=mi(r.subarray(32,64));if(!Jz(l))return!1;const c=P3(uv(a),T2(o),i),u=e7(o,l,Zf(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const nb={getPublicKey:t7,sign:n7,verify:M3,utils:{randomPrivateKey:k2.utils.randomPrivateKey,lift_x:I3,pointToBytes:T2,numberToBytesBE:_l,bytesToNumberBE:mi,taggedHash:wm,mod:gr}};/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function r7(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function i7(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function s7(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function o7(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}const O3=(t,e)=>e?O3(e,t%e):t,vm=(t,e)=>t+(e-O3(t,e));function fv(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(vm(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${vm(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function a7(t,e=!1){if(vm(8,t)>32||vm(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!r7(n))throw new Error("radix2.encode input should be Uint8Array");return fv(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(fv(n,t,8,e))}}}function $k(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const hv=i7(s7("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o7("")),Fk=[996825010,642813549,513874426,1027748829,705979059];function Hd(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<Fk.length;r++)(e>>r&1)===1&&(n^=Fk[r]);return n}function zk(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Hd(i)^o>>5}i=Hd(i);for(let s=0;s<r;s++)i=Hd(i)^t.charCodeAt(s)&31;for(let s of e)i=Hd(i)^s;for(let s=0;s<6;s++)i=Hd(i);return i^=n,hv.encode(fv([i%2**30],30,5,!1))}function l7(t){const n=a7(5),r=n.decode,i=n.encode,s=$k(r);function o(u,d,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof d}`);if(u.length===0)throw new TypeError(`Invalid prefix length ${u.length}`);const h=u.length+7+d.length;if(f!==!1&&h>f)throw new TypeError(`Length ${h} exceeds limit ${f}`);const p=u.toLowerCase(),m=zk(p,d,1);return`${p}1${hv.encode(d)}${m}`}function a(u,d=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||d!==!1&&u.length>d)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${d})`);const f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");const h=f.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=f.slice(0,h),m=f.slice(h+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const g=hv.decode(m).slice(0,-6),y=zk(p,g,1);if(!m.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:g}}const l=$k(a);function c(u){const{prefix:d,words:f}=a(u,!1);return{prefix:d,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const Uk=l7(),c7=new TextEncoder;function u7(t){return mm(gm(c7.encode(t)))}const C2={sign:(t,e)=>mm(nb.sign(t,e)),verify:nb.verify,getPublicKey:t=>mm(nb.getPublicKey(t))};function d7(t){return C2.getPublicKey(t)}function N3(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return u7(e)}function f7(t,e){return C2.sign(t,e)}function h7(t){try{return C2.verify(t.sig,N3(t),t.pubkey)}catch(e){return console.warn("The following error occurred during verify():",e),!1}}function p7(t){const{words:e}=Uk.decode(t),n=new Uint8Array(Uk.fromWords(e));return mm(n)}function pv(t,e){const n=t.startsWith("nsec1")?p7(t):t,r=d7(n);return{async signEvent(i){const s={...i,pubkey:i.pubkey??r,tags:[...i.tags??[],...e?.tags??[]],created_at:i.created_at??Math.floor(Date.now()/1e3)};if(m7(s))return s;const o=s.id??N3(s),a=s.sig??f7(o,n);return{...s,id:o,sig:a}},async getPublicKey(){return r}}}function m7(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}const g7=async t=>h7(t),y7="modulepreload",b7=function(t){return"/ehagaki/"+t},Hk={},l0=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=l(n.map(c=>{if(c=b7(c),c in Hk)return;Hk[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":y7,u||(f.as="script"),f.crossOrigin="",f.href=c,a&&f.setAttribute("nonce",a),document.head.appendChild(f),u)return new Promise((h,p)=>{f.addEventListener("load",h),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var Vk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function w7(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rb,jk;function v7(){if(jk)return rb;jk=1;var t=function(w){return e(w)&&!n(w)};function e(y){return!!y&&typeof y=="object"}function n(y){var w=Object.prototype.toString.call(y);return w==="[object RegExp]"||w==="[object Date]"||s(y)}var r=typeof Symbol=="function"&&Symbol.for,i=r?Symbol.for("react.element"):60103;function s(y){return y.$$typeof===i}function o(y){return Array.isArray(y)?[]:{}}function a(y,w){return w.clone!==!1&&w.isMergeableObject(y)?m(o(y),y,w):y}function l(y,w,k){return y.concat(w).map(function(C){return a(C,k)})}function c(y,w){if(!w.customMerge)return m;var k=w.customMerge(y);return typeof k=="function"?k:m}function u(y){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(y).filter(function(w){return Object.propertyIsEnumerable.call(y,w)}):[]}function d(y){return Object.keys(y).concat(u(y))}function f(y,w){try{return w in y}catch{return!1}}function h(y,w){return f(y,w)&&!(Object.hasOwnProperty.call(y,w)&&Object.propertyIsEnumerable.call(y,w))}function p(y,w,k){var C={};return k.isMergeableObject(y)&&d(y).forEach(function(A){C[A]=a(y[A],k)}),d(w).forEach(function(A){h(y,A)||(f(y,A)&&k.isMergeableObject(w[A])?C[A]=c(A,k)(y[A],w[A],k):C[A]=a(w[A],k))}),C}function m(y,w,k){k=k||{},k.arrayMerge=k.arrayMerge||l,k.isMergeableObject=k.isMergeableObject||t,k.cloneUnlessOtherwiseSpecified=a;var C=Array.isArray(w),A=Array.isArray(y),E=C===A;return E?C?k.arrayMerge(y,w,k):p(y,w,k):a(w,k)}m.all=function(w,k){if(!Array.isArray(w))throw new Error("first argument should be an array");return w.reduce(function(C,A){return m(C,A,k)},{})};var g=m;return rb=g,rb}var x7=v7();const S7=w7(x7);var mv=function(t,e){return mv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},mv(t,e)};function c0(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");mv(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Kt=function(){return Kt=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Kt.apply(this,arguments)};function E7(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function ib(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function sb(t,e){var n=e&&e.cache?e.cache:P7,r=e&&e.serializer?e.serializer:A7,i=e&&e.strategy?e.strategy:_7;return i(t,{cache:n,serializer:r})}function k7(t){return t==null||typeof t=="number"||typeof t=="boolean"}function T7(t,e,n,r){var i=k7(r)?r:n(r),s=e.get(i);return typeof s>"u"&&(s=t.call(this,r),e.set(i,s)),s}function R3(t,e,n){var r=Array.prototype.slice.call(arguments,3),i=n(r),s=e.get(i);return typeof s>"u"&&(s=t.apply(this,r),e.set(i,s)),s}function L3(t,e,n,r,i){return n.bind(e,t,r,i)}function _7(t,e){var n=t.length===1?T7:R3;return L3(t,this,n,e.cache.create(),e.serializer)}function C7(t,e){return L3(t,this,R3,e.cache.create(),e.serializer)}var A7=function(){return JSON.stringify(arguments)},I7=(function(){function t(){this.cache=Object.create(null)}return t.prototype.get=function(e){return this.cache[e]},t.prototype.set=function(e,n){this.cache[e]=n},t})(),P7={create:function(){return new I7}},ob={variadic:C7},Rt;(function(t){t[t.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",t[t.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",t[t.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",t[t.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",t[t.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",t[t.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",t[t.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",t[t.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",t[t.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",t[t.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",t[t.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",t[t.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",t[t.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",t[t.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",t[t.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",t[t.INVALID_TAG=23]="INVALID_TAG",t[t.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",t[t.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",t[t.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(Rt||(Rt={}));var yn;(function(t){t[t.literal=0]="literal",t[t.argument=1]="argument",t[t.number=2]="number",t[t.date=3]="date",t[t.time=4]="time",t[t.select=5]="select",t[t.plural=6]="plural",t[t.pound=7]="pound",t[t.tag=8]="tag"})(yn||(yn={}));var Ju;(function(t){t[t.number=0]="number",t[t.dateTime=1]="dateTime"})(Ju||(Ju={}));function Wk(t){return t.type===yn.literal}function M7(t){return t.type===yn.argument}function D3(t){return t.type===yn.number}function B3(t){return t.type===yn.date}function $3(t){return t.type===yn.time}function F3(t){return t.type===yn.select}function z3(t){return t.type===yn.plural}function O7(t){return t.type===yn.pound}function U3(t){return t.type===yn.tag}function H3(t){return!!(t&&typeof t=="object"&&t.type===Ju.number)}function gv(t){return!!(t&&typeof t=="object"&&t.type===Ju.dateTime)}var V3=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,N7=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function R7(t){var e={};return t.replace(N7,function(n){var r=n.length;switch(n[0]){case"G":e.era=r===4?"long":r===5?"narrow":"short";break;case"y":e.year=r===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":e.month=["numeric","2-digit","short","long","narrow"][r-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":e.day=["numeric","2-digit"][r-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":e.weekday=r===4?"long":r===5?"narrow":"short";break;case"e":if(r<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"c":if(r<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"a":e.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":e.hourCycle="h12",e.hour=["numeric","2-digit"][r-1];break;case"H":e.hourCycle="h23",e.hour=["numeric","2-digit"][r-1];break;case"K":e.hourCycle="h11",e.hour=["numeric","2-digit"][r-1];break;case"k":e.hourCycle="h24",e.hour=["numeric","2-digit"][r-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":e.minute=["numeric","2-digit"][r-1];break;case"s":e.second=["numeric","2-digit"][r-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":e.timeZoneName=r<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),e}var L7=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function D7(t){if(t.length===0)throw new Error("Number skeleton cannot be empty");for(var e=t.split(L7).filter(function(f){return f.length>0}),n=[],r=0,i=e;r<i.length;r++){var s=i[r],o=s.split("/");if(o.length===0)throw new Error("Invalid number skeleton");for(var a=o[0],l=o.slice(1),c=0,u=l;c<u.length;c++){var d=u[c];if(d.length===0)throw new Error("Invalid number skeleton")}n.push({stem:a,options:l})}return n}function B7(t){return t.replace(/^(.*?)-/,"")}var qk=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,j3=/^(@+)?(\+|#+)?[rs]?$/g,$7=/(\*)(0+)|(#+)(0+)|(0+)/g,W3=/^(0+)$/;function Kk(t){var e={};return t[t.length-1]==="r"?e.roundingPriority="morePrecision":t[t.length-1]==="s"&&(e.roundingPriority="lessPrecision"),t.replace(j3,function(n,r,i){return typeof i!="string"?(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length):i==="+"?e.minimumSignificantDigits=r.length:r[0]==="#"?e.maximumSignificantDigits=r.length:(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length+(typeof i=="string"?i.length:0)),""}),e}function q3(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function F7(t){var e;if(t[0]==="E"&&t[1]==="E"?(e={notation:"engineering"},t=t.slice(2)):t[0]==="E"&&(e={notation:"scientific"},t=t.slice(1)),e){var n=t.slice(0,2);if(n==="+!"?(e.signDisplay="always",t=t.slice(2)):n==="+?"&&(e.signDisplay="exceptZero",t=t.slice(2)),!W3.test(t))throw new Error("Malformed concise eng/scientific notation");e.minimumIntegerDigits=t.length}return e}function Gk(t){var e={},n=q3(t);return n||e}function z7(t){for(var e={},n=0,r=t;n<r.length;n++){var i=r[n];switch(i.stem){case"percent":case"%":e.style="percent";continue;case"%x100":e.style="percent",e.scale=100;continue;case"currency":e.style="currency",e.currency=i.options[0];continue;case"group-off":case",_":e.useGrouping=!1;continue;case"precision-integer":case".":e.maximumFractionDigits=0;continue;case"measure-unit":case"unit":e.style="unit",e.unit=B7(i.options[0]);continue;case"compact-short":case"K":e.notation="compact",e.compactDisplay="short";continue;case"compact-long":case"KK":e.notation="compact",e.compactDisplay="long";continue;case"scientific":e=Kt(Kt(Kt({},e),{notation:"scientific"}),i.options.reduce(function(l,c){return Kt(Kt({},l),Gk(c))},{}));continue;case"engineering":e=Kt(Kt(Kt({},e),{notation:"engineering"}),i.options.reduce(function(l,c){return Kt(Kt({},l),Gk(c))},{}));continue;case"notation-simple":e.notation="standard";continue;case"unit-width-narrow":e.currencyDisplay="narrowSymbol",e.unitDisplay="narrow";continue;case"unit-width-short":e.currencyDisplay="code",e.unitDisplay="short";continue;case"unit-width-full-name":e.currencyDisplay="name",e.unitDisplay="long";continue;case"unit-width-iso-code":e.currencyDisplay="symbol";continue;case"scale":e.scale=parseFloat(i.options[0]);continue;case"rounding-mode-floor":e.roundingMode="floor";continue;case"rounding-mode-ceiling":e.roundingMode="ceil";continue;case"rounding-mode-down":e.roundingMode="trunc";continue;case"rounding-mode-up":e.roundingMode="expand";continue;case"rounding-mode-half-even":e.roundingMode="halfEven";continue;case"rounding-mode-half-down":e.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":e.roundingMode="halfExpand";continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace($7,function(l,c,u,d,f,h){if(c)e.minimumIntegerDigits=u.length;else{if(d&&f)throw new Error("We currently do not support maximum integer digits");if(h)throw new Error("We currently do not support exact integer digits")}return""});continue}if(W3.test(i.stem)){e.minimumIntegerDigits=i.stem.length;continue}if(qk.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(qk,function(l,c,u,d,f,h){return u==="*"?e.minimumFractionDigits=c.length:d&&d[0]==="#"?e.maximumFractionDigits=d.length:f&&h?(e.minimumFractionDigits=f.length,e.maximumFractionDigits=f.length+h.length):(e.minimumFractionDigits=c.length,e.maximumFractionDigits=c.length),""});var s=i.options[0];s==="w"?e=Kt(Kt({},e),{trailingZeroDisplay:"stripIfInteger"}):s&&(e=Kt(Kt({},e),Kk(s)));continue}if(j3.test(i.stem)){e=Kt(Kt({},e),Kk(i.stem));continue}var o=q3(i.stem);o&&(e=Kt(Kt({},e),o));var a=F7(i.stem);a&&(e=Kt(Kt({},e),a))}return e}var pp={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function U7(t,e){for(var n="",r=0;r<t.length;r++){var i=t.charAt(r);if(i==="j"){for(var s=0;r+1<t.length&&t.charAt(r+1)===i;)s++,r++;var o=1+(s&1),a=s<2?1:3+(s>>1),l="a",c=H7(e);for((c=="H"||c=="k")&&(a=0);a-- >0;)n+=l;for(;o-- >0;)n=c+n}else i==="J"?n+="H":n+=i}return n}function H7(t){var e=t.hourCycle;if(e===void 0&&t.hourCycles&&t.hourCycles.length&&(e=t.hourCycles[0]),e)switch(e){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var n=t.language,r;n!=="root"&&(r=t.maximize().region);var i=pp[r||""]||pp[n||""]||pp["".concat(n,"-001")]||pp["001"];return i[0]}var ab,V7=new RegExp("^".concat(V3.source,"*")),j7=new RegExp("".concat(V3.source,"*$"));function Ft(t,e){return{start:t,end:e}}var W7=!!String.prototype.startsWith&&"_a".startsWith("a",1),q7=!!String.fromCodePoint,K7=!!Object.fromEntries,G7=!!String.prototype.codePointAt,Z7=!!String.prototype.trimStart,Q7=!!String.prototype.trimEnd,X7=!!Number.isSafeInteger,Y7=X7?Number.isSafeInteger:function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<=9007199254740991},yv=!0;try{var J7=G3("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");yv=((ab=J7.exec("a"))===null||ab===void 0?void 0:ab[0])==="a"}catch{yv=!1}var Zk=W7?function(e,n,r){return e.startsWith(n,r)}:function(e,n,r){return e.slice(r,r+n.length)===n},bv=q7?String.fromCodePoint:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r="",i=e.length,s=0,o;i>s;){if(o=e[s++],o>1114111)throw RangeError(o+" is not a valid code point");r+=o<65536?String.fromCharCode(o):String.fromCharCode(((o-=65536)>>10)+55296,o%1024+56320)}return r},Qk=K7?Object.fromEntries:function(e){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r],o=s[0],a=s[1];n[o]=a}return n},K3=G7?function(e,n){return e.codePointAt(n)}:function(e,n){var r=e.length;if(!(n<0||n>=r)){var i=e.charCodeAt(n),s;return i<55296||i>56319||n+1===r||(s=e.charCodeAt(n+1))<56320||s>57343?i:(i-55296<<10)+(s-56320)+65536}},e9=Z7?function(e){return e.trimStart()}:function(e){return e.replace(V7,"")},t9=Q7?function(e){return e.trimEnd()}:function(e){return e.replace(j7,"")};function G3(t,e){return new RegExp(t,e)}var wv;if(yv){var Xk=G3("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");wv=function(e,n){var r;Xk.lastIndex=n;var i=Xk.exec(e);return(r=i[1])!==null&&r!==void 0?r:""}}else wv=function(e,n){for(var r=[];;){var i=K3(e,n);if(i===void 0||Z3(i)||s9(i))break;r.push(i),n+=i>=65536?2:1}return bv.apply(void 0,r)};var n9=(function(){function t(e,n){n===void 0&&(n={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!n.ignoreTag,this.locale=n.locale,this.requiresOtherClause=!!n.requiresOtherClause,this.shouldParseSkeletons=!!n.shouldParseSkeletons}return t.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},t.prototype.parseMessage=function(e,n,r){for(var i=[];!this.isEOF();){var s=this.char();if(s===123){var o=this.parseArgument(e,r);if(o.err)return o;i.push(o.val)}else{if(s===125&&e>0)break;if(s===35&&(n==="plural"||n==="selectordinal")){var a=this.clonePosition();this.bump(),i.push({type:yn.pound,location:Ft(a,this.clonePosition())})}else if(s===60&&!this.ignoreTag&&this.peek()===47){if(r)break;return this.error(Rt.UNMATCHED_CLOSING_TAG,Ft(this.clonePosition(),this.clonePosition()))}else if(s===60&&!this.ignoreTag&&vv(this.peek()||0)){var o=this.parseTag(e,n);if(o.err)return o;i.push(o.val)}else{var o=this.parseLiteral(e,n);if(o.err)return o;i.push(o.val)}}}return{val:i,err:null}},t.prototype.parseTag=function(e,n){var r=this.clonePosition();this.bump();var i=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:yn.literal,value:"<".concat(i,"/>"),location:Ft(r,this.clonePosition())},err:null};if(this.bumpIf(">")){var s=this.parseMessage(e+1,n,!0);if(s.err)return s;var o=s.val,a=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!vv(this.char()))return this.error(Rt.INVALID_TAG,Ft(a,this.clonePosition()));var l=this.clonePosition(),c=this.parseTagName();return i!==c?this.error(Rt.UNMATCHED_CLOSING_TAG,Ft(l,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:yn.tag,value:i,children:o,location:Ft(r,this.clonePosition())},err:null}:this.error(Rt.INVALID_TAG,Ft(a,this.clonePosition())))}else return this.error(Rt.UNCLOSED_TAG,Ft(r,this.clonePosition()))}else return this.error(Rt.INVALID_TAG,Ft(r,this.clonePosition()))},t.prototype.parseTagName=function(){var e=this.offset();for(this.bump();!this.isEOF()&&i9(this.char());)this.bump();return this.message.slice(e,this.offset())},t.prototype.parseLiteral=function(e,n){for(var r=this.clonePosition(),i="";;){var s=this.tryParseQuote(n);if(s){i+=s;continue}var o=this.tryParseUnquoted(e,n);if(o){i+=o;continue}var a=this.tryParseLeftAngleBracket();if(a){i+=a;continue}break}var l=Ft(r,this.clonePosition());return{val:{type:yn.literal,value:i,location:l},err:null}},t.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!r9(this.peek()||0))?(this.bump(),"<"):null},t.prototype.tryParseQuote=function(e){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(e==="plural"||e==="selectordinal")break;return null;default:return null}this.bump();var n=[this.char()];for(this.bump();!this.isEOF();){var r=this.char();if(r===39)if(this.peek()===39)n.push(39),this.bump();else{this.bump();break}else n.push(r);this.bump()}return bv.apply(void 0,n)},t.prototype.tryParseUnquoted=function(e,n){if(this.isEOF())return null;var r=this.char();return r===60||r===123||r===35&&(n==="plural"||n==="selectordinal")||r===125&&e>0?null:(this.bump(),bv(r))},t.prototype.parseArgument=function(e,n){var r=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(Rt.EXPECT_ARGUMENT_CLOSING_BRACE,Ft(r,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(Rt.EMPTY_ARGUMENT,Ft(r,this.clonePosition()));var i=this.parseIdentifierIfPossible().value;if(!i)return this.error(Rt.MALFORMED_ARGUMENT,Ft(r,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(Rt.EXPECT_ARGUMENT_CLOSING_BRACE,Ft(r,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:yn.argument,value:i,location:Ft(r,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(Rt.EXPECT_ARGUMENT_CLOSING_BRACE,Ft(r,this.clonePosition())):this.parseArgumentOptions(e,n,i,r);default:return this.error(Rt.MALFORMED_ARGUMENT,Ft(r,this.clonePosition()))}},t.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),n=this.offset(),r=wv(this.message,n),i=n+r.length;this.bumpTo(i);var s=this.clonePosition(),o=Ft(e,s);return{value:r,location:o}},t.prototype.parseArgumentOptions=function(e,n,r,i){var s,o=this.clonePosition(),a=this.parseIdentifierIfPossible().value,l=this.clonePosition();switch(a){case"":return this.error(Rt.EXPECT_ARGUMENT_TYPE,Ft(o,l));case"number":case"date":case"time":{this.bumpSpace();var c=null;if(this.bumpIf(",")){this.bumpSpace();var u=this.clonePosition(),d=this.parseSimpleArgStyleIfPossible();if(d.err)return d;var f=t9(d.val);if(f.length===0)return this.error(Rt.EXPECT_ARGUMENT_STYLE,Ft(this.clonePosition(),this.clonePosition()));var h=Ft(u,this.clonePosition());c={style:f,styleLocation:h}}var p=this.tryParseArgumentClose(i);if(p.err)return p;var m=Ft(i,this.clonePosition());if(c&&Zk(c?.style,"::",0)){var g=e9(c.style.slice(2));if(a==="number"){var d=this.parseNumberSkeletonFromString(g,c.styleLocation);return d.err?d:{val:{type:yn.number,value:r,location:m,style:d.val},err:null}}else{if(g.length===0)return this.error(Rt.EXPECT_DATE_TIME_SKELETON,m);var y=g;this.locale&&(y=U7(g,this.locale));var f={type:Ju.dateTime,pattern:y,location:c.styleLocation,parsedOptions:this.shouldParseSkeletons?R7(y):{}},w=a==="date"?yn.date:yn.time;return{val:{type:w,value:r,location:m,style:f},err:null}}}return{val:{type:a==="number"?yn.number:a==="date"?yn.date:yn.time,value:r,location:m,style:(s=c?.style)!==null&&s!==void 0?s:null},err:null}}case"plural":case"selectordinal":case"select":{var k=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(Rt.EXPECT_SELECT_ARGUMENT_OPTIONS,Ft(k,Kt({},k)));this.bumpSpace();var C=this.parseIdentifierIfPossible(),A=0;if(a!=="select"&&C.value==="offset"){if(!this.bumpIf(":"))return this.error(Rt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Ft(this.clonePosition(),this.clonePosition()));this.bumpSpace();var d=this.tryParseDecimalInteger(Rt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Rt.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(d.err)return d;this.bumpSpace(),C=this.parseIdentifierIfPossible(),A=d.val}var E=this.tryParsePluralOrSelectOptions(e,a,n,C);if(E.err)return E;var p=this.tryParseArgumentClose(i);if(p.err)return p;var P=Ft(i,this.clonePosition());return a==="select"?{val:{type:yn.select,value:r,options:Qk(E.val),location:P},err:null}:{val:{type:yn.plural,value:r,options:Qk(E.val),offset:A,pluralType:a==="plural"?"cardinal":"ordinal",location:P},err:null}}default:return this.error(Rt.INVALID_ARGUMENT_TYPE,Ft(o,l))}},t.prototype.tryParseArgumentClose=function(e){return this.isEOF()||this.char()!==125?this.error(Rt.EXPECT_ARGUMENT_CLOSING_BRACE,Ft(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},t.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,n=this.clonePosition();!this.isEOF();){var r=this.char();switch(r){case 39:{this.bump();var i=this.clonePosition();if(!this.bumpUntil("'"))return this.error(Rt.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,Ft(i,this.clonePosition()));this.bump();break}case 123:{e+=1,this.bump();break}case 125:{if(e>0)e-=1;else return{val:this.message.slice(n.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(n.offset,this.offset()),err:null}},t.prototype.parseNumberSkeletonFromString=function(e,n){var r=[];try{r=D7(e)}catch{return this.error(Rt.INVALID_NUMBER_SKELETON,n)}return{val:{type:Ju.number,tokens:r,location:n,parsedOptions:this.shouldParseSkeletons?z7(r):{}},err:null}},t.prototype.tryParsePluralOrSelectOptions=function(e,n,r,i){for(var s,o=!1,a=[],l=new Set,c=i.value,u=i.location;;){if(c.length===0){var d=this.clonePosition();if(n!=="select"&&this.bumpIf("=")){var f=this.tryParseDecimalInteger(Rt.EXPECT_PLURAL_ARGUMENT_SELECTOR,Rt.INVALID_PLURAL_ARGUMENT_SELECTOR);if(f.err)return f;u=Ft(d,this.clonePosition()),c=this.message.slice(d.offset,this.offset())}else break}if(l.has(c))return this.error(n==="select"?Rt.DUPLICATE_SELECT_ARGUMENT_SELECTOR:Rt.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,u);c==="other"&&(o=!0),this.bumpSpace();var h=this.clonePosition();if(!this.bumpIf("{"))return this.error(n==="select"?Rt.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:Rt.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,Ft(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,n,r);if(p.err)return p;var m=this.tryParseArgumentClose(h);if(m.err)return m;a.push([c,{value:p.val,location:Ft(h,this.clonePosition())}]),l.add(c),this.bumpSpace(),s=this.parseIdentifierIfPossible(),c=s.value,u=s.location}return a.length===0?this.error(n==="select"?Rt.EXPECT_SELECT_ARGUMENT_SELECTOR:Rt.EXPECT_PLURAL_ARGUMENT_SELECTOR,Ft(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!o?this.error(Rt.MISSING_OTHER_CLAUSE,Ft(this.clonePosition(),this.clonePosition())):{val:a,err:null}},t.prototype.tryParseDecimalInteger=function(e,n){var r=1,i=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(r=-1);for(var s=!1,o=0;!this.isEOF();){var a=this.char();if(a>=48&&a<=57)s=!0,o=o*10+(a-48),this.bump();else break}var l=Ft(i,this.clonePosition());return s?(o*=r,Y7(o)?{val:o,err:null}:this.error(n,l)):this.error(e,l)},t.prototype.offset=function(){return this.position.offset},t.prototype.isEOF=function(){return this.offset()===this.message.length},t.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},t.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var n=K3(this.message,e);if(n===void 0)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return n},t.prototype.error=function(e,n){return{val:null,err:{kind:e,message:this.message,location:n}}},t.prototype.bump=function(){if(!this.isEOF()){var e=this.char();e===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},t.prototype.bumpIf=function(e){if(Zk(this.message,e,this.offset())){for(var n=0;n<e.length;n++)this.bump();return!0}return!1},t.prototype.bumpUntil=function(e){var n=this.offset(),r=this.message.indexOf(e,n);return r>=0?(this.bumpTo(r),!0):(this.bumpTo(this.message.length),!1)},t.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var n=this.offset();if(n===e)break;if(n>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},t.prototype.bumpSpace=function(){for(;!this.isEOF()&&Z3(this.char());)this.bump()},t.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),n=this.offset(),r=this.message.charCodeAt(n+(e>=65536?2:1));return r??null},t})();function vv(t){return t>=97&&t<=122||t>=65&&t<=90}function r9(t){return vv(t)||t===47}function i9(t){return t===45||t===46||t>=48&&t<=57||t===95||t>=97&&t<=122||t>=65&&t<=90||t==183||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}function Z3(t){return t>=9&&t<=13||t===32||t===133||t>=8206&&t<=8207||t===8232||t===8233}function s9(t){return t>=33&&t<=35||t===36||t>=37&&t<=39||t===40||t===41||t===42||t===43||t===44||t===45||t>=46&&t<=47||t>=58&&t<=59||t>=60&&t<=62||t>=63&&t<=64||t===91||t===92||t===93||t===94||t===96||t===123||t===124||t===125||t===126||t===161||t>=162&&t<=165||t===166||t===167||t===169||t===171||t===172||t===174||t===176||t===177||t===182||t===187||t===191||t===215||t===247||t>=8208&&t<=8213||t>=8214&&t<=8215||t===8216||t===8217||t===8218||t>=8219&&t<=8220||t===8221||t===8222||t===8223||t>=8224&&t<=8231||t>=8240&&t<=8248||t===8249||t===8250||t>=8251&&t<=8254||t>=8257&&t<=8259||t===8260||t===8261||t===8262||t>=8263&&t<=8273||t===8274||t===8275||t>=8277&&t<=8286||t>=8592&&t<=8596||t>=8597&&t<=8601||t>=8602&&t<=8603||t>=8604&&t<=8607||t===8608||t>=8609&&t<=8610||t===8611||t>=8612&&t<=8613||t===8614||t>=8615&&t<=8621||t===8622||t>=8623&&t<=8653||t>=8654&&t<=8655||t>=8656&&t<=8657||t===8658||t===8659||t===8660||t>=8661&&t<=8691||t>=8692&&t<=8959||t>=8960&&t<=8967||t===8968||t===8969||t===8970||t===8971||t>=8972&&t<=8991||t>=8992&&t<=8993||t>=8994&&t<=9e3||t===9001||t===9002||t>=9003&&t<=9083||t===9084||t>=9085&&t<=9114||t>=9115&&t<=9139||t>=9140&&t<=9179||t>=9180&&t<=9185||t>=9186&&t<=9254||t>=9255&&t<=9279||t>=9280&&t<=9290||t>=9291&&t<=9311||t>=9472&&t<=9654||t===9655||t>=9656&&t<=9664||t===9665||t>=9666&&t<=9719||t>=9720&&t<=9727||t>=9728&&t<=9838||t===9839||t>=9840&&t<=10087||t===10088||t===10089||t===10090||t===10091||t===10092||t===10093||t===10094||t===10095||t===10096||t===10097||t===10098||t===10099||t===10100||t===10101||t>=10132&&t<=10175||t>=10176&&t<=10180||t===10181||t===10182||t>=10183&&t<=10213||t===10214||t===10215||t===10216||t===10217||t===10218||t===10219||t===10220||t===10221||t===10222||t===10223||t>=10224&&t<=10239||t>=10240&&t<=10495||t>=10496&&t<=10626||t===10627||t===10628||t===10629||t===10630||t===10631||t===10632||t===10633||t===10634||t===10635||t===10636||t===10637||t===10638||t===10639||t===10640||t===10641||t===10642||t===10643||t===10644||t===10645||t===10646||t===10647||t===10648||t>=10649&&t<=10711||t===10712||t===10713||t===10714||t===10715||t>=10716&&t<=10747||t===10748||t===10749||t>=10750&&t<=11007||t>=11008&&t<=11055||t>=11056&&t<=11076||t>=11077&&t<=11078||t>=11079&&t<=11084||t>=11085&&t<=11123||t>=11124&&t<=11125||t>=11126&&t<=11157||t===11158||t>=11159&&t<=11263||t>=11776&&t<=11777||t===11778||t===11779||t===11780||t===11781||t>=11782&&t<=11784||t===11785||t===11786||t===11787||t===11788||t===11789||t>=11790&&t<=11798||t===11799||t>=11800&&t<=11801||t===11802||t===11803||t===11804||t===11805||t>=11806&&t<=11807||t===11808||t===11809||t===11810||t===11811||t===11812||t===11813||t===11814||t===11815||t===11816||t===11817||t>=11818&&t<=11822||t===11823||t>=11824&&t<=11833||t>=11834&&t<=11835||t>=11836&&t<=11839||t===11840||t===11841||t===11842||t>=11843&&t<=11855||t>=11856&&t<=11857||t===11858||t>=11859&&t<=11903||t>=12289&&t<=12291||t===12296||t===12297||t===12298||t===12299||t===12300||t===12301||t===12302||t===12303||t===12304||t===12305||t>=12306&&t<=12307||t===12308||t===12309||t===12310||t===12311||t===12312||t===12313||t===12314||t===12315||t===12316||t===12317||t>=12318&&t<=12319||t===12320||t===12336||t===64830||t===64831||t>=65093&&t<=65094}function xv(t){t.forEach(function(e){if(delete e.location,F3(e)||z3(e))for(var n in e.options)delete e.options[n].location,xv(e.options[n].value);else D3(e)&&H3(e.style)||(B3(e)||$3(e))&&gv(e.style)?delete e.style.location:U3(e)&&xv(e.children)})}function o9(t,e){e===void 0&&(e={}),e=Kt({shouldParseSkeletons:!0,requiresOtherClause:!0},e);var n=new n9(t,e).parse();if(n.err){var r=SyntaxError(Rt[n.err.kind]);throw r.location=n.err.location,r.originalMessage=n.err.message,r}return e?.captureLocation||xv(n.val),n.val}var ed;(function(t){t.MISSING_VALUE="MISSING_VALUE",t.INVALID_VALUE="INVALID_VALUE",t.MISSING_INTL_API="MISSING_INTL_API"})(ed||(ed={}));var u0=(function(t){c0(e,t);function e(n,r,i){var s=t.call(this,n)||this;return s.code=r,s.originalMessage=i,s}return e.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},e})(Error),Yk=(function(t){c0(e,t);function e(n,r,i,s){return t.call(this,'Invalid values for "'.concat(n,'": "').concat(r,'". Options are "').concat(Object.keys(i).join('", "'),'"'),ed.INVALID_VALUE,s)||this}return e})(u0),a9=(function(t){c0(e,t);function e(n,r,i){return t.call(this,'Value for "'.concat(n,'" must be of type ').concat(r),ed.INVALID_VALUE,i)||this}return e})(u0),l9=(function(t){c0(e,t);function e(n,r){return t.call(this,'The intl string context variable "'.concat(n,'" was not provided to the string "').concat(r,'"'),ed.MISSING_VALUE,r)||this}return e})(u0),qr;(function(t){t[t.literal=0]="literal",t[t.object=1]="object"})(qr||(qr={}));function c9(t){return t.length<2?t:t.reduce(function(e,n){var r=e[e.length-1];return!r||r.type!==qr.literal||n.type!==qr.literal?e.push(n):r.value+=n.value,e},[])}function u9(t){return typeof t=="function"}function Hp(t,e,n,r,i,s,o){if(t.length===1&&Wk(t[0]))return[{type:qr.literal,value:t[0].value}];for(var a=[],l=0,c=t;l<c.length;l++){var u=c[l];if(Wk(u)){a.push({type:qr.literal,value:u.value});continue}if(O7(u)){typeof s=="number"&&a.push({type:qr.literal,value:n.getNumberFormat(e).format(s)});continue}var d=u.value;if(!(i&&d in i))throw new l9(d,o);var f=i[d];if(M7(u)){(!f||typeof f=="string"||typeof f=="number")&&(f=typeof f=="string"||typeof f=="number"?String(f):""),a.push({type:typeof f=="string"?qr.literal:qr.object,value:f});continue}if(B3(u)){var h=typeof u.style=="string"?r.date[u.style]:gv(u.style)?u.style.parsedOptions:void 0;a.push({type:qr.literal,value:n.getDateTimeFormat(e,h).format(f)});continue}if($3(u)){var h=typeof u.style=="string"?r.time[u.style]:gv(u.style)?u.style.parsedOptions:r.time.medium;a.push({type:qr.literal,value:n.getDateTimeFormat(e,h).format(f)});continue}if(D3(u)){var h=typeof u.style=="string"?r.number[u.style]:H3(u.style)?u.style.parsedOptions:void 0;h&&h.scale&&(f=f*(h.scale||1)),a.push({type:qr.literal,value:n.getNumberFormat(e,h).format(f)});continue}if(U3(u)){var p=u.children,m=u.value,g=i[m];if(!u9(g))throw new a9(m,"function",o);var y=Hp(p,e,n,r,i,s),w=g(y.map(function(A){return A.value}));Array.isArray(w)||(w=[w]),a.push.apply(a,w.map(function(A){return{type:typeof A=="string"?qr.literal:qr.object,value:A}}))}if(F3(u)){var k=u.options[f]||u.options.other;if(!k)throw new Yk(u.value,f,Object.keys(u.options),o);a.push.apply(a,Hp(k.value,e,n,r,i));continue}if(z3(u)){var k=u.options["=".concat(f)];if(!k){if(!Intl.PluralRules)throw new u0(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,ed.MISSING_INTL_API,o);var C=n.getPluralRules(e,{type:u.pluralType}).select(f-(u.offset||0));k=u.options[C]||u.options.other}if(!k)throw new Yk(u.value,f,Object.keys(u.options),o);a.push.apply(a,Hp(k.value,e,n,r,i,f-(u.offset||0)));continue}}return c9(a)}function d9(t,e){return e?Kt(Kt(Kt({},t||{}),e||{}),Object.keys(t).reduce(function(n,r){return n[r]=Kt(Kt({},t[r]),e[r]||{}),n},{})):t}function f9(t,e){return e?Object.keys(t).reduce(function(n,r){return n[r]=d9(t[r],e[r]),n},Kt({},t)):t}function lb(t){return{create:function(){return{get:function(e){return t[e]},set:function(e,n){t[e]=n}}}}}function h9(t){return t===void 0&&(t={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:sb(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.NumberFormat).bind.apply(e,ib([void 0],n,!1)))},{cache:lb(t.number),strategy:ob.variadic}),getDateTimeFormat:sb(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.DateTimeFormat).bind.apply(e,ib([void 0],n,!1)))},{cache:lb(t.dateTime),strategy:ob.variadic}),getPluralRules:sb(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.PluralRules).bind.apply(e,ib([void 0],n,!1)))},{cache:lb(t.pluralRules),strategy:ob.variadic})}}var Q3=(function(){function t(e,n,r,i){n===void 0&&(n=t.defaultLocale);var s=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(l){var c=s.formatToParts(l);if(c.length===1)return c[0].value;var u=c.reduce(function(d,f){return!d.length||f.type!==qr.literal||typeof d[d.length-1]!="string"?d.push(f.value):d[d.length-1]+=f.value,d},[]);return u.length<=1?u[0]||"":u},this.formatToParts=function(l){return Hp(s.ast,s.locales,s.formatters,s.formats,l,void 0,s.message)},this.resolvedOptions=function(){var l;return{locale:((l=s.resolvedLocale)===null||l===void 0?void 0:l.toString())||Intl.NumberFormat.supportedLocalesOf(s.locales)[0]}},this.getAst=function(){return s.ast},this.locales=n,this.resolvedLocale=t.resolveLocale(n),typeof e=="string"){if(this.message=e,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var o=i||{};o.formatters;var a=E7(o,["formatters"]);this.ast=t.__parse(e,Kt(Kt({},a),{locale:this.resolvedLocale}))}else this.ast=e;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=f9(t.formats,r),this.formatters=i&&i.formatters||h9(this.formatterCache)}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.resolveLocale=function(e){if(!(typeof Intl.Locale>"u")){var n=Intl.NumberFormat.supportedLocalesOf(e);return n.length>0?new Intl.Locale(n[0]):new Intl.Locale(typeof e=="string"?e:e[0])}},t.__parse=o9,t.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t})();function p9(t,e){if(e==null)return;if(e in t)return t[e];const n=e.split(".");let r=t;for(let i=0;i<n.length;i++)if(typeof r=="object"){if(i>0){const s=n.slice(i,n.length).join(".");if(s in r){r=r[s];break}}r=r[n[i]]}else r=void 0;return r}const rl={},m9=(t,e,n)=>n&&(e in rl||(rl[e]={}),t in rl[e]||(rl[e][t]=n),n),X3=(t,e)=>{if(e==null)return;if(e in rl&&t in rl[e])return rl[e][t];const n=Lh(e);for(let r=0;r<n.length;r++){const i=n[r],s=y9(i,t);if(s)return m9(t,e,s)}};let A2;const vd=Qi({});function g9(t){return A2[t]||null}function I2(t){return t in A2}function y9(t,e){if(!I2(t))return null;const n=g9(t);return p9(n,e)}function b9(t){if(t==null)return;const e=Lh(t);for(let n=0;n<e.length;n++){const r=e[n];if(I2(r))return r}}function w9(t,...e){delete rl[t],vd.update(n=>(n[t]=S7.all([n[t]||{},...e]),n))}Xo([vd],([t])=>Object.keys(t));vd.subscribe(t=>A2=t);const xf={};function v9(t){xf[t]=new Set}function x9(t,e){xf[t].delete(e),xf[t].size===0&&delete xf[t]}function Sf(t){return xf[t]}function S9(t){return Lh(t).map(e=>{const n=Sf(e);return[e,n?[...n]:[]]}).filter(([,e])=>e.length>0)}function xm(t){return t==null?!1:Lh(t).some(e=>{var n;return(n=Sf(e))==null?void 0:n.size})}function E9(t,e){return Promise.all(e.map(r=>(x9(t,r),r().then(i=>i.default||i)))).then(r=>w9(t,...r))}const Vd={};function P2(t){if(!xm(t))return t in Vd?Vd[t]:Promise.resolve();const e=S9(t);return Vd[t]=Promise.all(e.map(([n,r])=>E9(n,r))).then(()=>{if(xm(t))return P2(t);delete Vd[t]}),Vd[t]}function Y3(t,e){Sf(t)||v9(t);const n=Sf(t);Sf(t).has(e)||(I2(t)||vd.update(r=>(r[t]={},r)),n.add(e))}var Jk=Object.getOwnPropertySymbols,k9=Object.prototype.hasOwnProperty,T9=Object.prototype.propertyIsEnumerable,_9=(t,e)=>{var n={};for(var r in t)k9.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Jk)for(var r of Jk(t))e.indexOf(r)<0&&T9.call(t,r)&&(n[r]=t[r]);return n};const C9={number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};function A9({locale:t,id:e}){console.warn(`[svelte-i18n] The message "${e}" was not found in "${Lh(t).join('", "')}".${xm(da())?`

Note: there are at least one loader still registered to this locale that wasn't executed.`:""}`)}const I9={fallbackLocale:null,loadingDelay:200,formats:C9,warnOnMissingMessages:!0,handleMissingMessage:void 0,ignoreTag:!0},uf=I9;function Ac(){return uf}function P9(t){const e=t,{formats:n}=e,r=_9(e,["formats"]);let i=t.fallbackLocale;if(t.initialLocale)try{Q3.resolveLocale(t.initialLocale)&&(i=t.initialLocale)}catch{console.warn(`[svelte-i18n] The initial locale "${t.initialLocale}" is not a valid locale.`)}return r.warnOnMissingMessages&&(delete r.warnOnMissingMessages,r.handleMissingMessage==null?r.handleMissingMessage=A9:console.warn('[svelte-i18n] The "warnOnMissingMessages" option is deprecated. Please use the "handleMissingMessage" option instead.')),Object.assign(uf,r,{initialLocale:i}),n&&("number"in n&&Object.assign(uf.formats.number,n.number),"date"in n&&Object.assign(uf.formats.date,n.date),"time"in n&&Object.assign(uf.formats.time,n.time)),ks.set(i)}const cb=Qi(!1);var M9=Object.defineProperty,O9=Object.defineProperties,N9=Object.getOwnPropertyDescriptors,eT=Object.getOwnPropertySymbols,R9=Object.prototype.hasOwnProperty,L9=Object.prototype.propertyIsEnumerable,tT=(t,e,n)=>e in t?M9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,D9=(t,e)=>{for(var n in e||(e={}))R9.call(e,n)&&tT(t,n,e[n]);if(eT)for(var n of eT(e))L9.call(e,n)&&tT(t,n,e[n]);return t},B9=(t,e)=>O9(t,N9(e));let Sv;const Sm=Qi(null);function nT(t){return t.split("-").map((e,n,r)=>r.slice(0,n+1).join("-")).reverse()}function Lh(t,e=Ac().fallbackLocale){const n=nT(t);return e?[...new Set([...n,...nT(e)])]:n}function da(){return Sv??void 0}Sm.subscribe(t=>{Sv=t??void 0,typeof window<"u"&&t!=null&&document.documentElement.setAttribute("lang",t)});const $9=t=>{if(t&&b9(t)&&xm(t)){const{loadingDelay:e}=Ac();let n;return typeof window<"u"&&da()!=null&&e?n=window.setTimeout(()=>cb.set(!0),e):cb.set(!0),P2(t).then(()=>{Sm.set(t)}).finally(()=>{clearTimeout(n),cb.set(!1)})}return Sm.set(t)},ks=B9(D9({},Sm),{set:$9}),F9=()=>typeof window>"u"?null:window.navigator.language||window.navigator.languages[0],d0=t=>{const e=Object.create(null);return r=>{const i=JSON.stringify(r);return i in e?e[i]:e[i]=t(r)}};var z9=Object.defineProperty,Em=Object.getOwnPropertySymbols,J3=Object.prototype.hasOwnProperty,eP=Object.prototype.propertyIsEnumerable,rT=(t,e,n)=>e in t?z9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M2=(t,e)=>{for(var n in e||(e={}))J3.call(e,n)&&rT(t,n,e[n]);if(Em)for(var n of Em(e))eP.call(e,n)&&rT(t,n,e[n]);return t},xd=(t,e)=>{var n={};for(var r in t)J3.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Em)for(var r of Em(t))e.indexOf(r)<0&&eP.call(t,r)&&(n[r]=t[r]);return n};const Qf=(t,e)=>{const{formats:n}=Ac();if(t in n&&e in n[t])return n[t][e];throw new Error(`[svelte-i18n] Unknown "${e}" ${t} format.`)},U9=d0(t=>{var e=t,{locale:n,format:r}=e,i=xd(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return r&&(i=Qf("number",r)),new Intl.NumberFormat(n,i)}),H9=d0(t=>{var e=t,{locale:n,format:r}=e,i=xd(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return r?i=Qf("date",r):Object.keys(i).length===0&&(i=Qf("date","short")),new Intl.DateTimeFormat(n,i)}),V9=d0(t=>{var e=t,{locale:n,format:r}=e,i=xd(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return r?i=Qf("time",r):Object.keys(i).length===0&&(i=Qf("time","short")),new Intl.DateTimeFormat(n,i)}),j9=(t={})=>{var e=t,{locale:n=da()}=e,r=xd(e,["locale"]);return U9(M2({locale:n},r))},W9=(t={})=>{var e=t,{locale:n=da()}=e,r=xd(e,["locale"]);return H9(M2({locale:n},r))},q9=(t={})=>{var e=t,{locale:n=da()}=e,r=xd(e,["locale"]);return V9(M2({locale:n},r))},K9=d0((t,e=da())=>new Q3(t,e,Ac().formats,{ignoreTag:Ac().ignoreTag})),G9=(t,e={})=>{var n,r,i,s;let o=e;typeof t=="object"&&(o=t,t=o.id);const{values:a,locale:l=da(),default:c}=o;if(l==null)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let u=X3(t,l);if(!u)u=(s=(i=(r=(n=Ac()).handleMissingMessage)==null?void 0:r.call(n,{locale:l,id:t,defaultValue:c}))!=null?i:c)!=null?s:t;else if(typeof u!="string")return console.warn(`[svelte-i18n] Message with id "${t}" must be of type "string", found: "${typeof u}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),u;if(!a)return u;let d=u;try{d=K9(u,l).format(a)}catch(f){f instanceof Error&&console.warn(`[svelte-i18n] Message "${t}" has syntax error:`,f.message)}return d},Z9=(t,e)=>q9(e).format(t),Q9=(t,e)=>W9(e).format(t),X9=(t,e)=>j9(e).format(t),Y9=(t,e=da())=>X3(t,e),Jr=Xo([ks,vd],()=>G9);Xo([ks],()=>Z9);Xo([ks],()=>Q9);Xo([ks],()=>X9);Xo([ks,vd],()=>Y9);function J9(t){return P2(da()||Ac().initialLocale)}Y3("ja",()=>l0(()=>import("./ja-Bx_foTOC.js"),[]));Y3("en",()=>l0(()=>import("./en-9IF4mgFS.js"),[]));function eU(){const t=localStorage.getItem("locale"),e=F9();return t&&(t==="ja"||t==="en")?t:e&&e.startsWith("ja")?"ja":"en"}const tP=eU();P9({fallbackLocale:"ja",initialLocale:tP,loadingDelay:0});ks.set(tP);function iT(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function nP(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function tU(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");iT(t.outputLen),iT(t.blockLen)}function km(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function nU(t,e){nP(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ub=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const rP=t=>t instanceof Uint8Array,db=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Rs=(t,e)=>t<<32-e|t>>>e,rU=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!rU)throw new Error("Non little-endian hardware is not supported");function iU(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function O2(t){if(typeof t=="string"&&(t=iU(t)),!rP(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function sU(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!rP(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let iP=class{clone(){return this._cloneInto()}};function oU(t){const e=r=>t().update(O2(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function sP(t=32){if(ub&&typeof ub.getRandomValues=="function")return ub.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function aU(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}let lU=class extends iP{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=db(this.buffer)}update(e){km(this);const{view:n,buffer:r,blockLen:i}=this;e=O2(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=db(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){km(this),nU(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;aU(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=db(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const cU=(t,e,n)=>t&e^~t&n,uU=(t,e,n)=>t&e^t&n^e&n,dU=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ia=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Pa=new Uint32Array(64);let fU=class extends lU{constructor(){super(64,32,8,!1),this.A=Ia[0]|0,this.B=Ia[1]|0,this.C=Ia[2]|0,this.D=Ia[3]|0,this.E=Ia[4]|0,this.F=Ia[5]|0,this.G=Ia[6]|0,this.H=Ia[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)Pa[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=Pa[d-15],h=Pa[d-2],p=Rs(f,7)^Rs(f,18)^f>>>3,m=Rs(h,17)^Rs(h,19)^h>>>10;Pa[d]=m+Pa[d-7]+p+Pa[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=Rs(a,6)^Rs(a,11)^Rs(a,25),h=u+f+cU(a,l,c)+dU[d]+Pa[d]|0,m=(Rs(r,2)^Rs(r,13)^Rs(r,22))+uU(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Pa.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Ev=oU(()=>new fU);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const oP=BigInt(0),f0=BigInt(1),hU=BigInt(2),h0=t=>t instanceof Uint8Array,pU=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function td(t){if(!h0(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=pU[t[n]];return e}function aP(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function N2(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function nd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function gi(t){return N2(td(t))}function R2(t){if(!h0(t))throw new Error("Uint8Array expected");return N2(td(Uint8Array.from(t).reverse()))}function Cl(t,e){return nd(t.toString(16).padStart(e*2,"0"))}function L2(t,e){return Cl(t,e).reverse()}function mU(t){return nd(aP(t))}function Nr(t,e,n){let r;if(typeof e=="string")try{r=nd(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(h0(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Ic(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!h0(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function gU(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function yU(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function bU(t){let e;for(e=0;t>oP;t>>=f0,e+=1);return e}function wU(t,e){return t>>BigInt(e)&f0}const vU=(t,e,n)=>t|(n?f0:oP)<<BigInt(e),D2=t=>(hU<<BigInt(t-1))-f0,fb=t=>new Uint8Array(t),sT=t=>Uint8Array.from(t);function lP(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=fb(t),i=fb(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...d)=>n(i,r,...d),l=(d=fb())=>{i=a(sT([0]),d),r=a(),d.length!==0&&(i=a(sT([1]),d),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<e;){r=a();const h=r.slice();f.push(h),d+=r.length}return Ic(...f)};return(d,f)=>{o(),l(d);let h;for(;!(h=f(c()));)l();return o(),h}}const xU={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Dh(t,e,n={}){const r=(i,s,o)=>{const a=xU[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const SU=Object.freeze(Object.defineProperty({__proto__:null,bitGet:wU,bitLen:bU,bitMask:D2,bitSet:vU,bytesToHex:td,bytesToNumberBE:gi,bytesToNumberLE:R2,concatBytes:Ic,createHmacDrbg:lP,ensureBytes:Nr,equalBytes:gU,hexToBytes:nd,hexToNumber:N2,numberToBytesBE:Cl,numberToBytesLE:L2,numberToHexUnpadded:aP,numberToVarBytesBE:mU,utf8ToBytes:yU,validateObject:Dh},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ir=BigInt(0),$n=BigInt(1),ec=BigInt(2),EU=BigInt(3),kv=BigInt(4),oT=BigInt(5),aT=BigInt(8);BigInt(9);BigInt(16);function yr(t,e){const n=t%e;return n>=ir?n:e+n}function kU(t,e,n){if(n<=ir||e<ir)throw new Error("Expected power/modulo > 0");if(n===$n)return ir;let r=$n;for(;e>ir;)e&$n&&(r=r*t%n),t=t*t%n,e>>=$n;return r}function $i(t,e,n){let r=t;for(;e-- >ir;)r*=r,r%=n;return r}function Tv(t,e){if(t===ir||e<=ir)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=yr(t,e),r=e,i=ir,s=$n;for(;n!==ir;){const a=r/n,l=r%n,c=i-s*a;r=n,n=l,i=s,s=c}if(r!==$n)throw new Error("invert: does not exist");return yr(i,e)}function TU(t){const e=(t-$n)/ec;let n,r,i;for(n=t-$n,r=0;n%ec===ir;n/=ec,r++);for(i=ec;i<t&&kU(i,e,t)!==t-$n;i++);if(r===1){const o=(t+$n)/kv;return function(l,c){const u=l.pow(c,o);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+$n)/ec;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=r,u=a.pow(a.mul(a.ONE,i),n),d=a.pow(l,s),f=a.pow(l,n);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let m=a.sqr(f);h<c&&!a.eql(m,a.ONE);h++)m=a.sqr(m);const p=a.pow(u,$n<<BigInt(c-h-1));u=a.sqr(p),d=a.mul(d,p),f=a.mul(f,u),c=h}return d}}function _U(t){if(t%kv===EU){const e=(t+$n)/kv;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%aT===oT){const e=(t-oT)/aT;return function(r,i){const s=r.mul(i,ec),o=r.pow(s,e),a=r.mul(i,o),l=r.mul(r.mul(a,ec),o),c=r.mul(a,r.sub(l,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return TU(t)}const CU=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function AU(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=CU.reduce((r,i)=>(r[i]="function",r),e);return Dh(t,n)}function IU(t,e,n){if(n<ir)throw new Error("Expected power > 0");if(n===ir)return t.ONE;if(n===$n)return e;let r=t.ONE,i=e;for(;n>ir;)n&$n&&(r=t.mul(r,i)),i=t.sqr(i),n>>=$n;return r}function PU(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function cP(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function MU(t,e,n=!1,r={}){if(t<=ir)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=cP(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=_U(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:D2(i),ZERO:ir,ONE:$n,create:l=>yr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return ir<=l&&l<t},is0:l=>l===ir,isOdd:l=>(l&$n)===$n,neg:l=>yr(-l,t),eql:(l,c)=>l===c,sqr:l=>yr(l*l,t),add:(l,c)=>yr(l+c,t),sub:(l,c)=>yr(l-c,t),mul:(l,c)=>yr(l*c,t),pow:(l,c)=>IU(a,l,c),div:(l,c)=>yr(l*Tv(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>Tv(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>PU(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?L2(l,s):Cl(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?R2(l):gi(l)}});return Object.freeze(a)}function uP(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function dP(t){const e=uP(t);return e+Math.ceil(e/2)}function OU(t,e,n=!1){const r=t.length,i=uP(e),s=dP(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?gi(t):R2(t),a=yr(o,e-$n)+$n;return n?L2(a,i):Cl(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const NU=BigInt(0),hb=BigInt(1);function RU(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>NU;)s&hb&&(o=o.add(a)),a=a.double(),s>>=hb;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let d=0;d<o;d++){u=c,l.push(u);for(let f=1;f<a;f++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const d=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const m=p*l;let g=Number(o&d);o>>=h,g>l&&(g-=f,o+=hb);const y=m,w=m+Math.abs(g)-1,k=p%2!==0,C=g<0;g===0?u=u.add(n(k,s[y])):c=c.add(n(C,s[w]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function fP(t){return AU(t.Fp),Dh(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...cP(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function LU(t){const e=fP(t);Dh(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:DU,hexToBytes:BU}=SU,rc={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=rc;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:DU(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=rc,n=typeof t=="string"?BU(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=rc._parseInt(n.subarray(2)),{d:o,l:a}=rc._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Fo=BigInt(0),ji=BigInt(1);BigInt(2);const lT=BigInt(3);BigInt(4);function $U(t){const e=LU(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return Ic(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1),g=n.fromBytes(m.subarray(0,n.BYTES)),y=n.fromBytes(m.subarray(n.BYTES,2*n.BYTES));return{x:g,y}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),w=n.mul(y,p);return n.add(n.add(w,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Fo<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:w}=e;if(m&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=td(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let k;try{k=typeof p=="bigint"?p:gi(Nr("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(k=yr(k,w)),a(k),k}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const w=k=>n.eql(k,n.ZERO);return w(g)&&w(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map(y=>y.pz));return m.map((y,w)=>y.toAffine(g[w])).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(Nr("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),w=s(m);if(!n.eql(y,w))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:w}=this,{px:k,py:C,pz:A}=m,E=n.eql(n.mul(g,A),n.mul(k,w)),P=n.eql(n.mul(y,A),n.mul(C,w));return E&&P}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,lT),{px:w,py:k,pz:C}=this;let A=n.ZERO,E=n.ZERO,P=n.ZERO,S=n.mul(w,w),x=n.mul(k,k),_=n.mul(C,C),I=n.mul(w,k);return I=n.add(I,I),P=n.mul(w,C),P=n.add(P,P),A=n.mul(m,P),E=n.mul(y,_),E=n.add(A,E),A=n.sub(x,E),E=n.add(x,E),E=n.mul(A,E),A=n.mul(I,A),P=n.mul(y,P),_=n.mul(m,_),I=n.sub(S,_),I=n.mul(m,I),I=n.add(I,P),P=n.add(S,S),S=n.add(P,S),S=n.add(S,_),S=n.mul(S,I),E=n.add(E,S),_=n.mul(k,C),_=n.add(_,_),S=n.mul(_,I),A=n.sub(A,S),P=n.mul(_,x),P=n.add(P,P),P=n.add(P,P),new d(A,E,P)}add(m){u(m);const{px:g,py:y,pz:w}=this,{px:k,py:C,pz:A}=m;let E=n.ZERO,P=n.ZERO,S=n.ZERO;const x=e.a,_=n.mul(e.b,lT);let I=n.mul(g,k),D=n.mul(y,C),B=n.mul(w,A),F=n.add(g,y),R=n.add(k,C);F=n.mul(F,R),R=n.add(I,D),F=n.sub(F,R),R=n.add(g,w);let O=n.add(k,A);return R=n.mul(R,O),O=n.add(I,B),R=n.sub(R,O),O=n.add(y,w),E=n.add(C,A),O=n.mul(O,E),E=n.add(D,B),O=n.sub(O,E),S=n.mul(x,R),E=n.mul(_,B),S=n.add(E,S),E=n.sub(D,S),S=n.add(D,S),P=n.mul(E,S),D=n.add(I,I),D=n.add(D,I),B=n.mul(x,B),R=n.mul(_,R),D=n.add(D,B),B=n.sub(I,B),B=n.mul(x,B),R=n.add(R,B),I=n.mul(D,R),P=n.add(P,I),I=n.mul(O,R),E=n.mul(F,E),E=n.sub(E,I),I=n.mul(F,D),S=n.mul(O,S),S=n.add(S,I),new d(E,P,S)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,g=>{const y=n.invertBatch(g.map(w=>w.pz));return g.map((w,k)=>w.toAffine(y[k])).map(d.fromAffine)})}multiplyUnsafe(m){const g=d.ZERO;if(m===Fo)return g;if(a(m),m===ji)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:w,k1:k,k2neg:C,k2:A}=y.splitScalar(m),E=g,P=g,S=this;for(;k>Fo||A>Fo;)k&ji&&(E=E.add(S)),A&ji&&(P=P.add(S)),S=S.double(),k>>=ji,A>>=ji;return w&&(E=E.negate()),C&&(P=P.negate()),P=new d(n.mul(P.px,y.beta),P.py,P.pz),E.add(P)}multiply(m){a(m);let g=m,y,w;const{endo:k}=e;if(k){const{k1neg:C,k1:A,k2neg:E,k2:P}=k.splitScalar(g);let{p:S,f:x}=this.wNAF(A),{p:_,f:I}=this.wNAF(P);S=h.constTimeNegate(C,S),_=h.constTimeNegate(E,_),_=new d(n.mul(_.px,k.beta),_.py,_.pz),y=S.add(_),w=x.add(I)}else{const{p:C,f:A}=this.wNAF(g);y=C,w=A}return d.normalizeZ([y,w])[0]}multiplyAndAddUnsafe(m,g,y){const w=d.BASE,k=(A,E)=>E===Fo||E===ji||!A.equals(w)?A.multiplyUnsafe(E):A.multiply(E),C=k(this,g).add(k(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:w}=this,k=this.is0();m==null&&(m=k?n.ONE:n.inv(w));const C=n.mul(g,m),A=n.mul(y,m),E=n.mul(w,m);if(k)return{x:n.ZERO,y:n.ZERO};if(!n.eql(E,n.ONE))throw new Error("invZ was invalid");return{x:C,y:A}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===ji)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===ji?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return td(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=RU(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function FU(t){const e=fP(t);return Dh(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function zU(t){const e=FU(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(R){return Fo<R&&R<n.ORDER}function a(R){return yr(R,r)}function l(R){return Tv(R,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=$U({...e,toBytes(R,O,L){const H=O.toAffine(),U=n.toBytes(H.x),j=Ic;return L?j(Uint8Array.from([O.hasEvenY()?2:3]),U):j(Uint8Array.from([4]),U,n.toBytes(H.y))},fromBytes(R){const O=R.length,L=R[0],H=R.subarray(1);if(O===i&&(L===2||L===3)){const U=gi(H);if(!o(U))throw new Error("Point is not on curve");const j=d(U);let Q=n.sqrt(j);const X=(Q&ji)===ji;return(L&1)===1!==X&&(Q=n.neg(Q)),{x:U,y:Q}}else if(O===s&&L===4){const U=n.fromBytes(H.subarray(0,n.BYTES)),j=n.fromBytes(H.subarray(n.BYTES,2*n.BYTES));return{x:U,y:j}}else throw new Error(`Point of length ${O} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=R=>td(Cl(R,e.nByteLength));function p(R){const O=r>>ji;return R>O}function m(R){return p(R)?a(-R):R}const g=(R,O,L)=>gi(R.slice(O,L));class y{constructor(O,L,H){this.r=O,this.s=L,this.recovery=H,this.assertValidity()}static fromCompact(O){const L=e.nByteLength;return O=Nr("compactSignature",O,L*2),new y(g(O,0,L),g(O,L,2*L))}static fromDER(O){const{r:L,s:H}=rc.toSig(Nr("DER",O));return new y(L,H)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(O){return new y(this.r,this.s,O)}recoverPublicKey(O){const{r:L,s:H,recovery:U}=this,j=P(Nr("msgHash",O));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const Q=U===2||U===3?L+e.n:L;if(Q>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const X=(U&1)===0?"02":"03",de=c.fromHex(X+h(Q)),le=l(Q),J=a(-j*le),he=a(H*le),Me=c.BASE.multiplyAndAddUnsafe(de,J,he);if(!Me)throw new Error("point at infinify");return Me.assertValidity(),Me}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return nd(this.toDERHex())}toDERHex(){return rc.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return nd(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const w={isValidPrivateKey(R){try{return u(R),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const R=dP(e.n);return OU(e.randomBytes(R),e.n)},precompute(R=8,O=c.BASE){return O._setWindowSize(R),O.multiply(BigInt(3)),O}};function k(R,O=!0){return c.fromPrivateKey(R).toRawBytes(O)}function C(R){const O=R instanceof Uint8Array,L=typeof R=="string",H=(O||L)&&R.length;return O?H===i||H===s:L?H===2*i||H===2*s:R instanceof c}function A(R,O,L=!0){if(C(R))throw new Error("first arg must be private key");if(!C(O))throw new Error("second arg must be public key");return c.fromHex(O).multiply(u(R)).toRawBytes(L)}const E=e.bits2int||function(R){const O=gi(R),L=R.length*8-e.nBitLength;return L>0?O>>BigInt(L):O},P=e.bits2int_modN||function(R){return a(E(R))},S=D2(e.nBitLength);function x(R){if(typeof R!="bigint")throw new Error("bigint expected");if(!(Fo<=R&&R<S))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Cl(R,e.nByteLength)}function _(R,O,L=I){if(["recovered","canonical"].some(Te=>Te in L))throw new Error("sign() legacy options not supported");const{hash:H,randomBytes:U}=e;let{lowS:j,prehash:Q,extraEntropy:X}=L;j==null&&(j=!0),R=Nr("msgHash",R),Q&&(R=Nr("prehashed msgHash",H(R)));const de=P(R),le=u(O),J=[x(le),x(de)];if(X!=null){const Te=X===!0?U(n.BYTES):X;J.push(Nr("extraEntropy",Te))}const he=Ic(...J),Me=de;function pe(Te){const je=E(Te);if(!f(je))return;const oe=l(je),ge=c.BASE.multiply(je).toAffine(),Ie=a(ge.x);if(Ie===Fo)return;const _e=a(oe*a(Me+Ie*le));if(_e===Fo)return;let Ue=(ge.x===Ie?0:2)|Number(ge.y&ji),Je=_e;return j&&p(_e)&&(Je=m(_e),Ue^=1),new y(Ie,Je,Ue)}return{seed:he,k2sig:pe}}const I={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function B(R,O,L=I){const{seed:H,k2sig:U}=_(R,O,L),j=e;return lP(j.hash.outputLen,j.nByteLength,j.hmac)(H,U)}c.BASE._setWindowSize(8);function F(R,O,L,H=D){const U=R;if(O=Nr("msgHash",O),L=Nr("publicKey",L),"strict"in H)throw new Error("options.strict was renamed to lowS");const{lowS:j,prehash:Q}=H;let X,de;try{if(typeof U=="string"||U instanceof Uint8Array)try{X=y.fromDER(U)}catch(ge){if(!(ge instanceof rc.Err))throw ge;X=y.fromCompact(U)}else if(typeof U=="object"&&typeof U.r=="bigint"&&typeof U.s=="bigint"){const{r:ge,s:Ie}=U;X=new y(ge,Ie)}else throw new Error("PARSE");de=c.fromHex(L)}catch(ge){if(ge.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(j&&X.hasHighS())return!1;Q&&(O=e.hash(O));const{r:le,s:J}=X,he=P(O),Me=l(J),pe=a(he*Me),Te=a(le*Me),je=c.BASE.multiplyAndAddUnsafe(de,pe,Te)?.toAffine();return je?a(je.x)===le:!1}return{CURVE:e,getPublicKey:k,getSharedSecret:A,sign:B,verify:F,ProjectivePoint:c,Signature:y,utils:w}}let hP=class extends iP{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,tU(e);const r=O2(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return km(this),this.iHash.update(e),this}digestInto(e){km(this),nP(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const pP=(t,e,n)=>new hP(t,e).update(n).digest();pP.create=(t,e)=>new hP(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function UU(t){return{hash:t,hmac:(e,...n)=>pP(t,e,sU(...n)),randomBytes:sP}}function HU(t,e){const n=r=>zU({...t,...UU(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const p0=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Tm=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),mP=BigInt(1),_m=BigInt(2),cT=(t,e)=>(t+e/_m)/e;function gP(t){const e=p0,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=$i(u,n,e)*u%e,f=$i(d,n,e)*u%e,h=$i(f,_m,e)*c%e,p=$i(h,i,e)*h%e,m=$i(p,s,e)*p%e,g=$i(m,a,e)*m%e,y=$i(g,l,e)*g%e,w=$i(y,a,e)*m%e,k=$i(w,n,e)*u%e,C=$i(k,o,e)*p%e,A=$i(C,r,e)*c%e,E=$i(A,_m,e);if(!_v.eql(_v.sqr(E),t))throw new Error("Cannot find square root");return E}const _v=MU(p0,void 0,void 0,{sqrt:gP}),Sd=HU({a:BigInt(0),b:BigInt(7),Fp:_v,n:Tm,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Tm,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-mP*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=cT(s*t,e),l=cT(-r*t,e);let c=yr(t-a*n-l*i,e),u=yr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},Ev),m0=BigInt(0),yP=t=>typeof t=="bigint"&&m0<t&&t<p0,VU=t=>typeof t=="bigint"&&m0<t&&t<Tm,uT={};function Cm(t,...e){let n=uT[t];if(n===void 0){const r=Ev(Uint8Array.from(t,i=>i.charCodeAt(0)));n=Ic(r,r),uT[t]=n}return Ev(Ic(n,...e))}const B2=t=>t.toRawBytes(!0).slice(1),Cv=t=>Cl(t,32),pb=t=>yr(t,p0),Xf=t=>yr(t,Tm),$2=Sd.ProjectivePoint,jU=(t,e,n)=>$2.BASE.multiplyAndAddUnsafe(t,e,n);function Av(t){let e=Sd.utils.normPrivateKeyToScalar(t),n=$2.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Xf(-e),bytes:B2(n)}}function bP(t){if(!yP(t))throw new Error("bad x: need 0 < x < p");const e=pb(t*t),n=pb(e*t+BigInt(7));let r=gP(n);r%_m!==m0&&(r=pb(-r));const i=new $2(t,r,mP);return i.assertValidity(),i}function wP(...t){return Xf(gi(Cm("BIP0340/challenge",...t)))}function WU(t){return Av(t).bytes}function qU(t,e,n=sP(32)){const r=Nr("message",t),{bytes:i,scalar:s}=Av(e),o=Nr("auxRand",n,32),a=Cv(s^gi(Cm("BIP0340/aux",o))),l=Cm("BIP0340/nonce",a,i,r),c=Xf(gi(l));if(c===m0)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=Av(c),f=wP(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(Cv(Xf(d+f*s)),32),!vP(h,r,i))throw new Error("sign: Invalid signature produced");return h}function vP(t,e,n){const r=Nr("signature",t,64),i=Nr("message",e),s=Nr("publicKey",n,32);try{const o=bP(gi(s)),a=gi(r.subarray(0,32));if(!yP(a))return!1;const l=gi(r.subarray(32,64));if(!VU(l))return!1;const c=wP(Cv(a),B2(o),i),u=jU(o,l,Xf(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const Qs={getPublicKey:WU,sign:qU,verify:vP,utils:{randomPrivateKey:Sd.utils.randomPrivateKey,lift_x:bP,pointToBytes:B2,numberToBytesBE:Cl,bytesToNumberBE:gi,taggedHash:Cm,mod:yr}},mb=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const F2=t=>t instanceof Uint8Array,gb=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ls=(t,e)=>t<<32-e|t>>>e,KU=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!KU)throw new Error("Non little-endian hardware is not supported");const GU=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Vn(t){if(!F2(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=GU[t[n]];return e}function Pc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function ZU(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Yf(t){if(typeof t=="string"&&(t=ZU(t)),!F2(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function g0(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!F2(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class xP{clone(){return this._cloneInto()}}function SP(t){const e=r=>t().update(Yf(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function EP(t=32){if(mb&&typeof mb.getRandomValues=="function")return mb.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Iv(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function QU(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function kP(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function XU(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Iv(t.outputLen),Iv(t.blockLen)}function YU(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function JU(t,e){kP(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const eo={number:Iv,bool:QU,bytes:kP,hash:XU,exists:YU,output:JU};function eH(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}class tH extends xP{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=gb(this.buffer)}update(e){eo.exists(this);const{view:n,buffer:r,blockLen:i}=this;e=Yf(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=gb(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){eo.exists(this),eo.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;eH(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=gb(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const nH=(t,e,n)=>t&e^~t&n,rH=(t,e,n)=>t&e^t&n^e&n,iH=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ma=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Oa=new Uint32Array(64);class TP extends tH{constructor(){super(64,32,8,!1),this.A=Ma[0]|0,this.B=Ma[1]|0,this.C=Ma[2]|0,this.D=Ma[3]|0,this.E=Ma[4]|0,this.F=Ma[5]|0,this.G=Ma[6]|0,this.H=Ma[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)Oa[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=Oa[d-15],h=Oa[d-2],p=Ls(f,7)^Ls(f,18)^f>>>3,m=Ls(h,17)^Ls(h,19)^h>>>10;Oa[d]=m+Oa[d-7]+p+Oa[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=Ls(a,6)^Ls(a,11)^Ls(a,25),h=u+f+nH(a,l,c)+iH[d]+Oa[d]|0,m=(Ls(r,2)^Ls(r,13)^Ls(r,22))+rH(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Oa.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class sH extends TP{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Hc=SP(()=>new TP);SP(()=>new sH);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ed(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function fa(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce((i,s)=>i?e(i,s.encode):s.encode,void 0),r=t.reduce((i,s)=>i?e(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function ha(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(Ed(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function pa(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function y0(t,e="="){if(Ed(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function _P(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function dT(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach(o=>{if(Ed(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!==e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[l]?a=!1:r=l;else continue}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const CP=(t,e)=>e?CP(e,t%e):t,Am=(t,e)=>t+(e-CP(t,e));function Pv(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Am(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Am(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(Ed(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function oH(t){return Ed(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return dT(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(dT(e,t,2**8))}}}function Bl(t,e=!1){if(Ed(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Am(8,t)>32||Am(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Pv(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Pv(n,t,8,e))}}}function fT(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const aH=fa(Bl(4),ha("0123456789ABCDEF"),pa("")),lH=fa(Bl(5),ha("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),y0(5),pa(""));fa(Bl(5),ha("0123456789ABCDEFGHIJKLMNOPQRSTUV"),y0(5),pa(""));fa(Bl(5),ha("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),pa(""),_P(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const lo=fa(Bl(6),ha("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),y0(6),pa("")),cH=fa(Bl(6),ha("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),y0(6),pa("")),z2=t=>fa(oH(58),ha(t),pa("")),Mv=z2("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");z2("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");z2("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const hT=[0,2,3,5,6,7,9,10,11],uH={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=Mv.encode(r).padStart(hT[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),i=hT.indexOf(r.length),s=Mv.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(e)}},Ov=fa(ha("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),pa("")),pT=[996825010,642813549,513874426,1027748829,705979059];function jd(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<pT.length;r++)(e>>r&1)===1&&(n^=pT[r]);return n}function mT(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=jd(i)^o>>5}i=jd(i);for(let s=0;s<r;s++)i=jd(i)^t.charCodeAt(s)&31;for(let s of e)i=jd(i)^s;for(let s=0;s<6;s++)i=jd(i);return i^=n,Ov.encode(Pv([i%2**30],30,5,!1))}function AP(t){const e=t==="bech32"?1:734539939,n=Bl(5),r=n.decode,i=n.encode,s=fT(r);function o(u,d,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof d}`);const h=u.length+7+d.length;if(f!==!1&&h>f)throw new TypeError(`Length ${h} exceeds limit ${f}`);return u=u.toLowerCase(),`${u}1${Ov.encode(d)}${mT(u,d,e)}`}function a(u,d=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||d!==!1&&u.length>d)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${d})`);const f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=f;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=u.slice(0,h),m=u.slice(h+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const g=Ov.decode(m).slice(0,-6),y=mT(p,g,e);if(!m.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:g}}const l=fT(a);function c(u){const{prefix:d,words:f}=a(u,!1);return{prefix:d,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const rd=AP("bech32");AP("bech32m");const dH={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},fH=fa(Bl(4),ha("0123456789abcdef"),pa(""),_P(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),hH={utf8:dH,hex:fH,base16:aH,base32:lH,base64:lo,base64url:cH,base58:Mv,base58xmr:uH};`${Object.keys(hH).join(", ")}`;function yb(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function gT(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function pH(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Vo(t,...e){if(!pH(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const Fr=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),mH=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!mH)throw new Error("Non little-endian hardware is not supported");function gH(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function yH(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const bH=(t,e)=>(Object.assign(e,t),e),pl=16,wH=283;function U2(t){return t<<1^wH&-(t>>7)}function wu(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=U2(t);return n}const Nv=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=U2(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),vH=Nv.map((t,e)=>Nv.indexOf(e)),xH=t=>t<<24|t>>>8,bb=t=>t<<8|t>>>24;function IP(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((c,u)=>e(t[u])),r=n.map(bb),i=r.map(bb),s=i.map(bb),o=new Uint32Array(256*256),a=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const d=c*256+u;o[d]=n[c]^r[u],a[d]=i[c]^s[u],l[d]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const H2=IP(Nv,t=>wu(t,3)<<24|t<<16|t<<8|wu(t,2)),PP=IP(vH,t=>wu(t,11)<<24|wu(t,13)<<16|wu(t,9)<<8|wu(t,14)),SH=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=U2(n))t[e]=n;return t})();function MP(t){Vo(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=H2,r=Fr(t),i=r.length,s=a=>to(n,a,a,a,a),o=new Uint32Array(e+28);o.set(r);for(let a=i;a<o.length;a++){let l=o[a-1];a%i===0?l=s(xH(l))^SH[a/i-1]:i>6&&a%i===4&&(l=s(l)),o[a]=o[a-i]^l}return o}function EH(t){const e=MP(t),n=e.slice(),r=e.length,{sbox2:i}=H2,{T0:s,T1:o,T2:a,T3:l}=PP;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],d=to(i,u,u,u,u);n[c]=s[d&255]^o[d>>>8&255]^a[d>>>16&255]^l[d>>>24]}return n}function il(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function to(t,e,n,r,i){return t[e&255|n&65280]|t[r>>>16&255|i>>>16&65280]<<16}function yT(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=H2;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const m=t[l++]^il(o,a,e,n,r,i),g=t[l++]^il(o,a,n,r,i,e),y=t[l++]^il(o,a,r,i,e,n),w=t[l++]^il(o,a,i,e,n,r);e=m,n=g,r=y,i=w}const u=t[l++]^to(s,e,n,r,i),d=t[l++]^to(s,n,r,i,e),f=t[l++]^to(s,r,i,e,n),h=t[l++]^to(s,i,e,n,r);return{s0:u,s1:d,s2:f,s3:h}}function kH(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=PP;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const m=t[l++]^il(o,a,e,i,r,n),g=t[l++]^il(o,a,n,e,i,r),y=t[l++]^il(o,a,r,n,e,i),w=t[l++]^il(o,a,i,r,n,e);e=m,n=g,r=y,i=w}const u=t[l++]^to(s,e,i,r,n),d=t[l++]^to(s,n,e,i,r),f=t[l++]^to(s,r,n,e,i),h=t[l++]^to(s,i,r,n,e);return{s0:u,s1:d,s2:f,s3:h}}function OP(t,e){if(!e)return new Uint8Array(t);if(Vo(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function TH(t){if(Vo(t),t.length%pl!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${pl}`)}function _H(t,e,n){let r=t.length;const i=r%pl;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=Fr(t);if(e){let l=pl-i;l||(l=pl),r=r+l}const o=OP(r,n),a=Fr(o);return{b:s,o:a,out:o}}function CH(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function AH(t){const e=new Uint8Array(16),n=Fr(e);e.set(t);const r=pl-t.length;for(let i=pl-r;i<pl;i++)e[i]=r;return n}const NP=bH({blockSize:16,nonceLength:16},function(e,n,r={}){Vo(e),Vo(n,16);const i=!r.disablePadding;return{encrypt:(s,o)=>{const a=MP(e),{b:l,o:c,out:u}=_H(s,i,o),d=Fr(n);let f=d[0],h=d[1],p=d[2],m=d[3],g=0;for(;g+4<=l.length;)f^=l[g+0],h^=l[g+1],p^=l[g+2],m^=l[g+3],{s0:f,s1:h,s2:p,s3:m}=yT(a,f,h,p,m),c[g++]=f,c[g++]=h,c[g++]=p,c[g++]=m;if(i){const y=AH(s.subarray(g*4));f^=y[0],h^=y[1],p^=y[2],m^=y[3],{s0:f,s1:h,s2:p,s3:m}=yT(a,f,h,p,m),c[g++]=f,c[g++]=h,c[g++]=p,c[g++]=m}return a.fill(0),u},decrypt:(s,o)=>{TH(s);const a=EH(e),l=Fr(n),c=OP(s.length,o),u=Fr(s),d=Fr(c);let f=l[0],h=l[1],p=l[2],m=l[3];for(let g=0;g+4<=u.length;){const y=f,w=h,k=p,C=m;f=u[g+0],h=u[g+1],p=u[g+2],m=u[g+3];const{s0:A,s1:E,s2:P,s3:S}=kH(a,f,h,p,m);d[g++]=A^y,d[g++]=E^w,d[g++]=P^k,d[g++]=S^C}return a.fill(0),CH(c,i)}}}),RP=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),IH=RP("expand 16-byte k"),PH=RP("expand 32-byte k"),MH=Fr(IH),LP=Fr(PH);LP.slice();function qt(t,e){return t<<e|t>>>32-e}function Rv(t){return t.byteOffset%4===0}const mp=64,OH=16,DP=2**32-1,bT=new Uint32Array;function NH(t,e,n,r,i,s,o,a){const l=i.length,c=new Uint8Array(mp),u=Fr(c),d=Rv(i)&&Rv(s),f=d?Fr(i):bT,h=d?Fr(s):bT;for(let p=0;p<l;o++){if(t(e,n,r,u,o,a),o>=DP)throw new Error("arx: counter overflow");const m=Math.min(mp,l-p);if(d&&m===mp){const g=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let y=0,w;y<OH;y++)w=g+y,h[w]=f[w]^u[y];p+=mp;continue}for(let g=0,y;g<m;g++)y=p+g,s[y]=i[y]^c[g];p+=m}}function RH(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=gH({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return yb(i),yb(o),gT(s),gT(n),(a,l,c,u,d=0)=>{Vo(a),Vo(l),Vo(c);const f=c.length;if(u||(u=new Uint8Array(f)),Vo(u),yb(d),d<0||d>=DP)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const h=[];let p=a.length,m,g;if(p===32)m=a.slice(),h.push(m),g=LP;else if(p===16&&n)m=new Uint8Array(32),m.set(a),m.set(a,16),g=MH,h.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Rv(l)||(l=l.slice(),h.push(l));const y=Fr(m);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,y,Fr(l.subarray(0,16)),y),l=l.subarray(16)}const w=16-i;if(w!==l.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const C=new Uint8Array(12);C.set(l,s?0:12-l.length),l=C,h.push(l)}const k=Fr(l);for(NH(t,g,y,k,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function LH(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],d=e[1],f=e[2],h=e[3],p=e[4],m=e[5],g=e[6],y=e[7],w=i,k=n[0],C=n[1],A=n[2],E=o,P=a,S=l,x=c,_=u,I=d,D=f,B=h,F=p,R=m,O=g,L=y,H=w,U=k,j=C,Q=A;for(let de=0;de<s;de+=2)E=E+_|0,H=qt(H^E,16),F=F+H|0,_=qt(_^F,12),E=E+_|0,H=qt(H^E,8),F=F+H|0,_=qt(_^F,7),P=P+I|0,U=qt(U^P,16),R=R+U|0,I=qt(I^R,12),P=P+I|0,U=qt(U^P,8),R=R+U|0,I=qt(I^R,7),S=S+D|0,j=qt(j^S,16),O=O+j|0,D=qt(D^O,12),S=S+D|0,j=qt(j^S,8),O=O+j|0,D=qt(D^O,7),x=x+B|0,Q=qt(Q^x,16),L=L+Q|0,B=qt(B^L,12),x=x+B|0,Q=qt(Q^x,8),L=L+Q|0,B=qt(B^L,7),E=E+I|0,Q=qt(Q^E,16),O=O+Q|0,I=qt(I^O,12),E=E+I|0,Q=qt(Q^E,8),O=O+Q|0,I=qt(I^O,7),P=P+D|0,H=qt(H^P,16),L=L+H|0,D=qt(D^L,12),P=P+D|0,H=qt(H^P,8),L=L+H|0,D=qt(D^L,7),S=S+B|0,U=qt(U^S,16),F=F+U|0,B=qt(B^F,12),S=S+B|0,U=qt(U^S,8),F=F+U|0,B=qt(B^F,7),x=x+_|0,j=qt(j^x,16),R=R+j|0,_=qt(_^R,12),x=x+_|0,j=qt(j^x,8),R=R+j|0,_=qt(_^R,7);let X=0;r[X++]=o+E|0,r[X++]=a+P|0,r[X++]=l+S|0,r[X++]=c+x|0,r[X++]=u+_|0,r[X++]=d+I|0,r[X++]=f+D|0,r[X++]=h+B|0,r[X++]=p+F|0,r[X++]=m+R|0,r[X++]=g+O|0,r[X++]=y+L|0,r[X++]=w+H|0,r[X++]=k+U|0,r[X++]=C+j|0,r[X++]=A+Q|0}const BP=RH(LH,{counterRight:!1,counterLength:4,allowShortKeys:!1});class $P extends xP{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,eo.hash(e);const r=Yf(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return eo.exists(this),this.iHash.update(e),this}digestInto(e){eo.exists(this),eo.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const b0=(t,e,n)=>new $P(t,e).update(n).digest();b0.create=(t,e)=>new $P(t,e);function DH(t,e,n){return eo.hash(t),b0(t,Yf(n),Yf(e))}const wb=new Uint8Array([0]),wT=new Uint8Array;function BH(t,e,n,r=32){if(eo.hash(t),eo.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=wT);const s=new Uint8Array(i*t.outputLen),o=b0.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)wb[0]=c+1,a.update(c===0?wT:l).update(n).update(wb).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),wb.fill(0),s.slice(0,r)}var $H=Object.defineProperty,vn=(t,e)=>{for(var n in e)$H(t,n,{get:e[n],enumerable:!0})},nu=Symbol("verified"),FH=t=>t instanceof Object;function V2(t){if(!FH(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var zH={};vn(zH,{Queue:()=>jH,QueueNode:()=>FP,binarySearch:()=>j2,bytesToHex:()=>Vn,hexToBytes:()=>Pc,insertEventIntoAscendingList:()=>VH,insertEventIntoDescendingList:()=>HH,normalizeURL:()=>UH,utf8Decoder:()=>jo,utf8Encoder:()=>Ts});var jo=new TextDecoder("utf-8"),Ts=new TextEncoder;function UH(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function HH(t,e){const[n,r]=j2(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at);return r||t.splice(n,0,e),t}function VH(t,e){const[n,r]=j2(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at);return r||t.splice(n,0,e),t}function j2(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var FP=class{value;next=null;prev=null;constructor(t){this.value=t}},jH=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new FP(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},WH=class{generateSecretKey(){return Qs.utils.randomPrivateKey()}getPublicKey(e){return Vn(Qs.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=Vn(Qs.getPublicKey(n)),r.id=Vp(r),r.sig=Vn(Qs.sign(Vp(r),n)),r[nu]=!0,r}verifyEvent(e){if(typeof e[nu]=="boolean")return e[nu];const n=Vp(e);if(n!==e.id)return e[nu]=!1,!1;try{const r=Qs.verify(e.sig,n,e.pubkey);return e[nu]=r,r}catch{return e[nu]=!1,!1}}};function qH(t){if(!V2(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Vp(t){let e=Hc(Ts.encode(qH(t)));return Vn(e)}var w0=new WH,KH=w0.generateSecretKey,v0=w0.getPublicKey,go=w0.finalizeEvent,W2=w0.verifyEvent,GH={};vn(GH,{Application:()=>KV,BadgeAward:()=>nV,BadgeDefinition:()=>zV,BlockedRelaysList:()=>kV,BookmarkList:()=>xV,Bookmarksets:()=>BV,Calendar:()=>ej,CalendarEventRSVP:()=>tj,ChannelCreation:()=>WP,ChannelHideMessage:()=>GP,ChannelMessage:()=>KP,ChannelMetadata:()=>qP,ChannelMuteUser:()=>ZP,ClassifiedListing:()=>QV,ClientAuth:()=>XP,CommunitiesList:()=>SV,CommunityDefinition:()=>ij,CommunityPostApproval:()=>uV,Contacts:()=>JH,CreateOrUpdateProduct:()=>VV,CreateOrUpdateStall:()=>HV,Curationsets:()=>$V,Date:()=>YV,DirectMessageRelaysList:()=>AV,DraftClassifiedListing:()=>XV,DraftLong:()=>WV,Emojisets:()=>qV,EncryptedDirectMessage:()=>eV,EventDeletion:()=>tV,FileMetadata:()=>iV,FileServerPreference:()=>IV,Followsets:()=>RV,GenericRepost:()=>Q2,Genericlists:()=>LV,GiftWrap:()=>QP,HTTPAuth:()=>X2,Handlerinformation:()=>rj,Handlerrecommendation:()=>nj,Highlights:()=>yV,InterestsList:()=>_V,Interestsets:()=>UV,JobFeedback:()=>hV,JobRequest:()=>dV,JobResult:()=>fV,Label:()=>cV,LightningPubRPC:()=>MV,LiveChatMessage:()=>sV,LiveEvent:()=>GV,LongFormArticle:()=>jV,Metadata:()=>XH,Mutelist:()=>bV,NWCWalletInfo:()=>PV,NWCWalletRequest:()=>YP,NWCWalletResponse:()=>OV,NostrConnect:()=>NV,OpenTimestamps:()=>rV,Pinlist:()=>wV,PrivateDirectMessage:()=>jP,ProblemTracker:()=>oV,ProfileBadges:()=>FV,PublicChatsList:()=>EV,Reaction:()=>Z2,RecommendRelay:()=>YH,RelayList:()=>vV,Relaysets:()=>DV,Report:()=>aV,Reporting:()=>lV,Repost:()=>G2,Seal:()=>VP,SearchRelaysList:()=>TV,ShortTextNote:()=>HP,Time:()=>JV,UserEmojiList:()=>CV,UserStatuses:()=>ZV,Zap:()=>gV,ZapGoal:()=>pV,ZapRequest:()=>mV,classifyKind:()=>ZH,isAddressableKind:()=>K2,isEphemeralKind:()=>UP,isKind:()=>QH,isRegularKind:()=>zP,isReplaceableKind:()=>q2});function zP(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function q2(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function UP(t){return 2e4<=t&&t<3e4}function K2(t){return 3e4<=t&&t<4e4}function ZH(t){return zP(t)?"regular":q2(t)?"replaceable":UP(t)?"ephemeral":K2(t)?"parameterized":"unknown"}function QH(t,e){const n=e instanceof Array?e:[e];return V2(t)&&n.includes(t.kind)||!1}var XH=0,HP=1,YH=2,JH=3,eV=4,tV=5,G2=6,Z2=7,nV=8,VP=13,jP=14,Q2=16,WP=40,qP=41,KP=42,GP=43,ZP=44,rV=1040,QP=1059,iV=1063,sV=1311,oV=1971,aV=1984,lV=1984,cV=1985,uV=4550,dV=5999,fV=6999,hV=7e3,pV=9041,mV=9734,gV=9735,yV=9802,bV=1e4,wV=10001,vV=10002,xV=10003,SV=10004,EV=10005,kV=10006,TV=10007,_V=10015,CV=10030,AV=10050,IV=10096,PV=13194,MV=21e3,XP=22242,YP=23194,OV=23195,NV=24133,X2=27235,RV=3e4,LV=30001,DV=30002,BV=30003,$V=30004,FV=30008,zV=30009,UV=30015,HV=30017,VV=30018,jV=30023,WV=30024,qV=30030,KV=30078,GV=30311,ZV=30315,QV=30402,XV=30403,YV=31922,JV=31923,ej=31924,tj=31925,nj=31989,rj=31990,ij=34550,sj={};vn(sj,{getHex64:()=>Y2,getInt:()=>JP,getSubscriptionId:()=>oj,matchEventId:()=>aj,matchEventKind:()=>cj,matchEventPubkey:()=>lj});function Y2(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function JP(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function oj(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function aj(t,e){return e===Y2(t,"id")}function lj(t,e){return e===Y2(t,"pubkey")}function cj(t,e){return e===JP(t,"kind")}var uj={};vn(uj,{makeAuthEvent:()=>dj});function dj(t,e){return{kind:XP,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var fj;try{fj=WebSocket}catch{}var hj;try{hj=WebSocket}catch{}var sa={};vn(sa,{BECH32_REGEX:()=>e4,Bech32MaxSize:()=>J2,NostrTypeGuard:()=>pj,decode:()=>x0,decodeNostrURI:()=>gj,encodeBytes:()=>E0,naddrEncode:()=>Sj,neventEncode:()=>xj,noteEncode:()=>wj,nprofileEncode:()=>vj,npubEncode:()=>bj,nsecEncode:()=>yj});var pj={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},J2=5e3,e4=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function mj(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function gj(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),x0(t)}catch{return{type:"invalid",data:null}}}function x0(t){let{prefix:e,words:n}=rd.decode(t,J2),r=new Uint8Array(rd.fromWords(n));switch(e){case"nprofile":{let i=vb(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Vn(i[0][0]),relays:i[1]?i[1].map(s=>jo.decode(s)):[]}}}case"nevent":{let i=vb(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Vn(i[0][0]),relays:i[1]?i[1].map(s=>jo.decode(s)):[],author:i[2]?.[0]?Vn(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(Vn(i[3][0]),16):void 0}}}case"naddr":{let i=vb(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:jo.decode(i[0][0]),pubkey:Vn(i[2][0]),kind:parseInt(Vn(i[3][0]),16),relays:i[1]?i[1].map(s=>jo.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:Vn(r)};default:throw new Error(`unknown prefix ${e}`)}}function vb(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function yj(t){return E0("nsec",t)}function bj(t){return E0("npub",Pc(t))}function wj(t){return E0("note",Pc(t))}function S0(t,e){let n=rd.toWords(e);return rd.encode(t,n,J2)}function E0(t,e){return S0(t,e)}function vj(t){let e=ex({0:[Pc(t.pubkey)],1:(t.relays||[]).map(n=>Ts.encode(n))});return S0("nprofile",e)}function xj(t){let e;t.kind!==void 0&&(e=mj(t.kind));let n=ex({0:[Pc(t.id)],1:(t.relays||[]).map(r=>Ts.encode(r)),2:t.author?[Pc(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return S0("nevent",n)}function Sj(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=ex({0:[Ts.encode(t.identifier)],1:(t.relays||[]).map(r=>Ts.encode(r)),2:[Pc(t.pubkey)],3:[new Uint8Array(e)]});return S0("naddr",n)}function ex(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)})}),g0(...e)}var Ej={};vn(Ej,{decrypt:()=>kj,encrypt:()=>t4});function t4(t,e,n){const r=t instanceof Uint8Array?Vn(t):t,i=Sd.getSharedSecret(r,"02"+e),s=n4(i);let o=Uint8Array.from(EP(16)),a=Ts.encode(n),l=NP(s,o).encrypt(a),c=lo.encode(new Uint8Array(l)),u=lo.encode(new Uint8Array(o.buffer));return`${c}?iv=${u}`}function kj(t,e,n){const r=t instanceof Uint8Array?Vn(t):t;let[i,s]=n.split("?iv="),o=Sd.getSharedSecret(r,"02"+e),a=n4(o),l=lo.decode(s),c=lo.decode(i),u=NP(a,l).decrypt(c);return jo.decode(u)}function n4(t){return t.slice(1,33)}var Tj={};vn(Tj,{NIP05_REGEX:()=>tx,isNip05:()=>_j,isValid:()=>Ij,queryProfile:()=>r4,searchDomain:()=>Aj,useFetchImplementation:()=>Cj});var tx=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,_j=t=>tx.test(t||""),k0;try{k0=fetch}catch{}function Cj(t){k0=t}async function Aj(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await k0(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function r4(t){const e=t.match(tx);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await k0(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function Ij(t,e){const n=await r4(e);return n?n.pubkey===t:!1}var Pj={};vn(Pj,{parse:()=>Mj});function Mj(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,d={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=d;continue}if(c==="reply"){e.reply=d;continue}if(c==="mention"){e.mentions.push(d);continue}n?r=d:n=d,e.mentions.push(d);continue}if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),e.mentions.forEach(i=>{if(i.author){let s=e.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),e}var Oj={};vn(Oj,{fetchRelayInformation:()=>Rj,useFetchImplementation:()=>Nj});var i4;try{i4=fetch}catch{}function Nj(t){i4=t}async function Rj(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var Lj={};vn(Lj,{fastEventHash:()=>o4,getPow:()=>s4,minePow:()=>Dj});function s4(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function Dj(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=o4(r),s4(r.id)>=e)break}return r}function o4(t){return Vn(Hc(Ts.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var Bj={};vn(Bj,{unwrapEvent:()=>Zj,unwrapManyEvents:()=>Qj,wrapEvent:()=>w4,wrapManyEvents:()=>Gj});var $j={};vn($j,{createRumor:()=>m4,createSeal:()=>g4,createWrap:()=>y4,unwrapEvent:()=>ox,unwrapManyEvents:()=>b4,wrapEvent:()=>Im,wrapManyEvents:()=>qj});var Fj={};vn(Fj,{decrypt:()=>sx,encrypt:()=>ix,getConversationKey:()=>nx,v2:()=>jj});var a4=1,l4=65535;function nx(t,e){const n=Sd.getSharedSecret(t,"02"+e).subarray(1,33);return DH(Hc,n,"nip44-v2")}function c4(t,e){const n=BH(Hc,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function rx(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function zj(t){if(!Number.isSafeInteger(t)||t<a4||t>l4)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function Uj(t){const e=Ts.encode(t),n=e.length,r=zj(n),i=new Uint8Array(rx(n)-n);return g0(r,e,i)}function Hj(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<a4||e>l4||n.length!==e||t.length!==2+rx(e))throw new Error("invalid padding");return jo.decode(n)}function u4(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=g0(n,e);return b0(Hc,t,r)}function Vj(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=lo.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function ix(t,e,n=EP(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=c4(e,n),o=Uj(t),a=BP(r,i,o),l=u4(s,a,n);return lo.encode(g0(new Uint8Array([2]),n,a,l))}function sx(t,e){const{nonce:n,ciphertext:r,mac:i}=Vj(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=c4(e,n),l=u4(a,r,n);if(!yH(l,i))throw new Error("invalid MAC");const c=BP(s,o,r);return Hj(c)}var jj={utils:{getConversationKey:nx,calcPaddedLen:rx},encrypt:ix,decrypt:sx},Wj=2880*60,d4=()=>Math.round(Date.now()/1e3),f4=()=>Math.round(d4()-Math.random()*Wj),h4=(t,e)=>nx(t,e),p4=(t,e,n)=>ix(JSON.stringify(t),h4(e,n)),vT=(t,e)=>JSON.parse(sx(t.content,h4(e,t.pubkey)));function m4(t,e){const n={created_at:d4(),content:"",tags:[],...t,pubkey:v0(e)};return n.id=Vp(n),n}function g4(t,e,n){return go({kind:VP,content:p4(t,e,n),created_at:f4(),tags:[]},e)}function y4(t,e){const n=KH();return go({kind:QP,content:p4(t,n,e),created_at:f4(),tags:[["p",e]]},n)}function Im(t,e,n){const r=m4(t,e),i=g4(r,e,n);return y4(i,n)}function qj(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=v0(e),i=[Im(t,e,r)];return n.forEach(s=>{i.push(Im(t,e,s))}),i}function ox(t,e){const n=vT(t,e);return vT(n,e)}function b4(t,e){let n=[];return t.forEach(r=>{n.push(ox(r,e))}),n.sort((r,i)=>r.created_at-i.created_at),n}function Kj(t,e,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:jP,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function w4(t,e,n,r,i){const s=Kj(e,n,r,i);return Im(s,t,e.publicKey)}function Gj(t,e,n,r,i){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:v0(t)},...e].map(o=>w4(t,o,n,r,i))}var Zj=ox,Qj=b4,Xj={};vn(Xj,{finishRepostEvent:()=>Yj,getRepostedEvent:()=>Jj,getRepostedEventPointer:()=>v4});function Yj(t,e,n,r){let i;const s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===HP?i=G2:(i=Q2,s.push(["k",String(e.kind)])),go({kind:i,tags:s,content:t.content===""||e.tags?.find(o=>o[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function v4(t){if(![G2,Q2].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function Jj(t,{skipVerification:e}={}){const n=v4(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!W2(r)))return r}var eW={};vn(eW,{NOSTR_URI_REGEX:()=>ax,parse:()=>nW,test:()=>tW});var ax=new RegExp(`nostr:(${e4.source})`);function tW(t){return typeof t=="string"&&new RegExp(`^${ax.source}$`).test(t)}function nW(t){const e=t.match(new RegExp(`^${ax.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:x0(e[1])}}var rW={};vn(rW,{finishReactionEvent:()=>iW,getReactedEventPointer:()=>sW});function iW(t,e,n){const r=e.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return go({...t,kind:Z2,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function sW(t){if(t.kind!==Z2)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var oW={};vn(oW,{parse:()=>lW});var aW=/\W/m,xT=/\W |\W$|$|,| /m;function*lW(t){const e=t.length;let n=0,r=0;for(;r<e;){let i=t.indexOf(":",r);if(i===-1)break;if(t.substring(i-5,i)==="nostr"){const s=t.substring(i+60).match(aW),o=s?i+60+s.index:e;try{let a,{data:l,type:c}=x0(t.substring(i+1,o));switch(c){case"npub":a={pubkey:l};break;case"nsec":case"note":r=o+1;continue;default:a=l}n!==i-5&&(yield{type:"text",text:t.substring(n,i-5)}),yield{type:"reference",pointer:a},r=o,n=r;continue}catch{r=i+1;continue}}else if(t.substring(i-5,i)==="https"||t.substring(i-4,i)==="http"){const s=t.substring(i+4).match(xT),o=s?i+4+s.index:e,a=t[i-1]==="s"?5:4;try{let l=new URL(t.substring(i-a,o));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==i-a&&(yield{type:"text",text:t.substring(n,i-a)}),l.pathname.endsWith(".png")||l.pathname.endsWith(".jpg")||l.pathname.endsWith(".jpeg")||l.pathname.endsWith(".gif")||l.pathname.endsWith(".webp")){yield{type:"image",url:l.toString()},r=o,n=r;continue}if(l.pathname.endsWith(".mp4")||l.pathname.endsWith(".avi")||l.pathname.endsWith(".webm")||l.pathname.endsWith(".mkv")){yield{type:"video",url:l.toString()},r=o,n=r;continue}if(l.pathname.endsWith(".mp3")||l.pathname.endsWith(".aac")||l.pathname.endsWith(".ogg")||l.pathname.endsWith(".opus")){yield{type:"audio",url:l.toString()},r=o,n=r;continue}yield{type:"url",url:l.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else if(t.substring(i-3,i)==="wss"||t.substring(i-2,i)==="ws"){const s=t.substring(i+4).match(xT),o=s?i+4+s.index:e,a=t[i-1]==="s"?3:2;try{let l=new URL(t.substring(i-a,o));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==i-a&&(yield{type:"text",text:t.substring(n,i-a)}),yield{type:"relay",url:l.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else{r=i+1;continue}}n!==e&&(yield{type:"text",text:t.substring(n)})}var cW={};vn(cW,{channelCreateEvent:()=>uW,channelHideMessageEvent:()=>hW,channelMessageEvent:()=>fW,channelMetadataEvent:()=>dW,channelMuteUserEvent:()=>pW});var uW=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return go({kind:WP,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},dW=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return go({kind:qP,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},fW=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),go({kind:KP,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},hW=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return go({kind:GP,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},pW=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return go({kind:ZP,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},mW={};vn(mW,{EMOJI_SHORTCODE_REGEX:()=>x4,matchAll:()=>gW,regex:()=>lx,replaceAll:()=>yW});var x4=/:(\w+):/,lx=()=>new RegExp(`\\B${x4.source}\\B`,"g");function*gW(t){const e=t.matchAll(lx());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function yW(t,e){return t.replaceAll(lx(),(n,r)=>e({shortcode:n,name:r}))}var bW={};vn(bW,{useFetchImplementation:()=>wW,validateGithub:()=>vW});var cx;try{cx=fetch}catch{}function wW(t){cx=t}async function vW(t,e,n){try{return await(await cx(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var xW={};vn(xW,{makeNwcRequestEvent:()=>EW,parseConnectionString:()=>SW});function SW(t){const{host:e,pathname:n,searchParams:r}=new URL(t),i=n||e,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function EW(t,e,n){const i=t4(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:YP,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return go(s,e)}var kW={};vn(kW,{normalizeIdentifier:()=>TW});function TW(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var _W={};vn(_W,{getSatoshisAmountFromBolt11:()=>OW,getZapEndpoint:()=>AW,makeZapReceipt:()=>MW,makeZapRequest:()=>IW,useFetchImplementation:()=>CW,validateZapRequest:()=>PW});var ux;try{ux=fetch}catch{}function CW(t){ux=t}async function AW(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=rd.decode(n,1e3),a=rd.fromWords(o);e=jo.decode(a)}else if(r){let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let s=await(await ux(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function IW(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),q2(t.event.kind)){const n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(K2(t.event.kind)){let n=t.event.tags.find(([i,s])=>i==="d"&&s);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function PW(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!V2(e))return"Zap request is not a valid Nostr event.";if(!W2(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function MW({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}function OW(t){if(t.length<50)return 0;t=t.substring(0,50);const e=t.lastIndexOf("1");if(e===-1)return 0;const n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const l=parseInt(r.substring(0,a));switch(i){case"m":return l*1e5;case"u":return l*100;case"n":return l/10;case"p":return l/1e4;default:return l*1e8}}var NW={};vn(NW,{getToken:()=>RW,hashPayload:()=>dx,unpackEventFromToken:()=>E4,validateEvent:()=>I4,validateEventKind:()=>T4,validateEventMethodTag:()=>C4,validateEventPayloadTag:()=>A4,validateEventTimestamp:()=>k4,validateEventUrlTag:()=>_4,validateToken:()=>LW});var S4="Nostr ";async function RW(t,e,n,r=!1,i){const s={kind:X2,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",dx(i)]);const o=await n(s);return(r?S4:"")+lo.encode(Ts.encode(JSON.stringify(o)))}async function LW(t,e,n){const r=await E4(t).catch(s=>{throw s});return await I4(r,e,n).catch(s=>{throw s})}async function E4(t){if(!t)throw new Error("Missing token");t=t.replace(S4,"");const e=jo.decode(lo.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function k4(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function T4(t){return t.kind===X2}function _4(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function C4(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function dx(t){const e=Hc(Ts.encode(JSON.stringify(t)));return Vn(e)}function A4(t,e){const n=t.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=dx(e);return n.length>0&&n[1]===r}async function I4(t,e,n,r){if(!W2(t))throw new Error("Invalid nostr event, signature invalid");if(!T4(t))throw new Error("Invalid nostr event, kind invalid");if(!k4(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!_4(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!C4(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!A4(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function DW(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t;let a,l,c;const u=async(f=!0)=>{await l,c?.()};async function d(){if("serviceWorker"in navigator){if(a=await l0(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-CwtvwXb3.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/ehagaki/sw.js",{scope:"/ehagaki/",type:"classic"})).catch(f=>{o?.(f)}),!a)return;c=()=>{a?.messageSkipWaiting()};{let f=!1;const h=()=>{f=!0,a?.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),n?.()};a.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"&&p.isExternal?h():!f&&r?.():p.isUpdate||r?.()}),a.addEventListener("waiting",h)}a.register({immediate:e}).then(f=>{s?s("/ehagaki/sw.js",f):i?.(f)}).catch(f=>{o?.(f)})}}return l=d(),u}function ST(t={}){const{immediate:e=!0,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t,a=Qi(!1),l=Qi(!1),c=DW({immediate:e,onOfflineReady(){l.set(!0),r?.()},onNeedRefresh(){a.set(!0),n?.()},onRegistered:i,onRegisteredSW:s,onRegisterError:o});return{needRefresh:a,offlineReady:l,updateServiceWorker:c}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */function K(t){if(!t)throw new Error("Assertion failed.")}const fx=t=>{const e=(t%360+360)%360;if(e===0||e===90||e===180||e===270)return e;throw new Error(`Invalid rotation ${t}.`)},Qn=t=>t&&t[t.length-1],id=t=>t>=0&&t<2**32;class Wn{constructor(e){this.bytes=e,this.pos=0}seekToByte(e){this.pos=8*e}readBit(){const e=Math.floor(this.pos/8),n=this.bytes[e]??0,r=7-(this.pos&7),i=(n&1<<r)>>r;return this.pos++,i}readBits(e){if(e===1)return this.readBit();let n=0;for(let r=0;r<e;r++)n<<=1,n|=this.readBit();return n}writeBits(e,n){const r=this.pos+e;for(let i=this.pos;i<r;i++){const s=Math.floor(i/8);let o=this.bytes[s];const a=7-(i&7);o&=~(1<<a),o|=(n&1<<r-i-1)>>r-i-1<<a,this.bytes[s]=o}this.pos=r}readAlignedByte(){if(this.pos%8!==0)throw new Error("Bitstream is not byte-aligned.");const e=this.pos/8,n=this.bytes[e]??0;return this.pos+=8,n}skipBits(e){this.pos+=e}getBitsLeft(){return this.bytes.length*8-this.pos}clone(){const e=new Wn(this.bytes);return e.pos=this.pos,e}}const nt=t=>{let e=0;for(;t.readBits(1)===0&&e<32;)e++;if(e>=32)throw new Error("Invalid exponential-Golomb code.");return(1<<e)-1+t.readBits(e)},Ef=t=>{const e=nt(t);return(e&1)===0?-(e>>1):e+1>>1},oo=t=>t.constructor===Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength),$r=t=>t.constructor===DataView?t:t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),Ji=new TextDecoder,no=new TextEncoder,hx=t=>Object.fromEntries(Object.entries(t).map(([e,n])=>[n,e])),Bh={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},P4=hx(Bh),$h={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pq:16,hlg:18},M4=hx($h),Fh={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},O4=hx(Fh),BW=t=>!!t&&!!t.primaries&&!!t.transfer&&!!t.matrix&&t.fullRange!==void 0,T0=t=>t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer||ArrayBuffer.isView(t);class kd{constructor(){this.currentPromise=Promise.resolve()}async acquire(){let e;const n=new Promise(i=>{e=i}),r=this.currentPromise;return this.currentPromise=n,await r,e}}const ET=t=>[...t].map(e=>e.toString(16).padStart(2,"0")).join(""),kT=t=>(t=t>>1&1431655765|(t&1431655765)<<1,t=t>>2&858993459|(t&858993459)<<2,t=t>>4&252645135|(t&252645135)<<4,t=t>>8&16711935|(t&16711935)<<8,t=t>>16&65535|(t&65535)<<16,t>>>0),px=(t,e,n)=>{let r=0,i=t.length-1,s=-1;for(;r<=i;){const o=r+i>>1,a=n(t[o]);a===e?(s=o,i=o-1):a<e?r=o+1:i=o-1}return s},cn=(t,e,n)=>{let r=0,i=t.length-1,s=-1;for(;r<=i;){const o=r+(i-r+1)/2|0;n(t[o])<=e?(s=o,r=o+1):i=o-1}return s},TT=(t,e,n)=>{const r=cn(t,n(e),n);t.splice(r+1,0,e)},Rr=()=>{let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}},N4=(t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n]))return t[n]},R4=(t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n]))return n;return-1},$W=async function*(t){Symbol.iterator in t?yield*t[Symbol.iterator]():yield*t[Symbol.asyncIterator]()},FW=t=>{if(!(Symbol.iterator in t)&&!(Symbol.asyncIterator in t))throw new TypeError("Argument must be an iterable or async iterable.")},Al=t=>{throw new Error(`Unexpected value: ${t}`)},_0=(t,e,n)=>{const r=t.getUint8(e),i=t.getUint8(e+1),s=t.getUint8(e+2);return n?r|i<<8|s<<16:r<<16|i<<8|s},zW=(t,e,n)=>_0(t,e,n)<<8>>8,L4=(t,e,n,r)=>{n=n>>>0,n=n&16777215,r?(t.setUint8(e,n&255),t.setUint8(e+1,n>>>8&255),t.setUint8(e+2,n>>>16&255)):(t.setUint8(e,n>>>16&255),t.setUint8(e+1,n>>>8&255),t.setUint8(e+2,n&255))},UW=(t,e,n,r)=>{n=pr(n,-8388608,8388607),n<0&&(n=n+16777216&16777215),L4(t,e,n,r)},_T=(t,e)=>({async next(){const n=await t.next();return n.done?{value:void 0,done:!0}:{value:e(n.value),done:!1}},return(){return t.return()},throw(n){return t.throw(n)},[Symbol.asyncIterator](){return this}}),pr=(t,e,n)=>Math.max(e,Math.min(n,t)),Xi="und",Pm=(t,e)=>{const n=10**e;return Math.round(t*n)/n},HW=(t,e)=>Math.round(t/e)*e,VW=t=>{let e=0;for(;t;)e++,t>>=1;return e},jW=/^[a-z]{3}$/,Jf=t=>jW.test(t),sl=1e6*(1+Number.EPSILON),WW=(t,e)=>{const n=t<0?-1:1;t=Math.abs(t);let r=0,i=1,s=1,o=0,a=t;for(;;){const l=Math.floor(a),c=l*s+r,u=l*o+i;if(u>e)return{numerator:n*s,denominator:o};if(r=s,i=o,s=c,o=u,a=1/(a-l),!isFinite(a))break}return{numerator:n*s,denominator:o}};class C0{constructor(){this.currentPromise=Promise.resolve()}call(e){return this.currentPromise=this.currentPromise.then(e)}}let xb=null;const Sb=()=>{if(xb!==null)return xb;const t=!!(typeof navigator<"u"&&navigator.vendor?.match(/apple/i)&&!navigator.userAgent?.match(/crios/i)&&!navigator.userAgent?.match(/fxios/i)&&!navigator.userAgent?.match(/Opera|OPT\//));return xb=t,t};let Eb=null;const eh=()=>Eb!==null?Eb:Eb=typeof navigator<"u"&&navigator.userAgent?.includes("Firefox"),uu=(t,e)=>t!==-1?t:e,CT=(t,e,n,r)=>t<=r&&n<=e,D4=function*(t){for(const e in t){const n=t[e];n!==void 0&&(yield{key:e,value:n})}},qW=t=>{const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},B4=()=>{Symbol.dispose??=Symbol("Symbol.dispose")},$4=t=>typeof t=="number"&&!Number.isNaN(t);/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Ru{constructor(e,n){if(this.data=e,this.mimeType=n,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(typeof n!="string")throw new TypeError("mimeType must be a string.")}}class F4{constructor(e,n,r,i){if(this.data=e,this.mimeType=n,this.name=r,this.description=i,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(n!==void 0&&typeof n!="string")throw new TypeError("mimeType, when provided, must be a string.");if(r!==void 0&&typeof r!="string")throw new TypeError("name, when provided, must be a string.");if(i!==void 0&&typeof i!="string")throw new TypeError("description, when provided, must be a string.")}}const Lv=t=>{if(!t||typeof t!="object")throw new TypeError("tags must be an object.");if(t.title!==void 0&&typeof t.title!="string")throw new TypeError("tags.title, when provided, must be a string.");if(t.description!==void 0&&typeof t.description!="string")throw new TypeError("tags.description, when provided, must be a string.");if(t.artist!==void 0&&typeof t.artist!="string")throw new TypeError("tags.artist, when provided, must be a string.");if(t.album!==void 0&&typeof t.album!="string")throw new TypeError("tags.album, when provided, must be a string.");if(t.albumArtist!==void 0&&typeof t.albumArtist!="string")throw new TypeError("tags.albumArtist, when provided, must be a string.");if(t.trackNumber!==void 0&&(!Number.isInteger(t.trackNumber)||t.trackNumber<=0))throw new TypeError("tags.trackNumber, when provided, must be a positive integer.");if(t.tracksTotal!==void 0&&(!Number.isInteger(t.tracksTotal)||t.tracksTotal<=0))throw new TypeError("tags.tracksTotal, when provided, must be a positive integer.");if(t.discNumber!==void 0&&(!Number.isInteger(t.discNumber)||t.discNumber<=0))throw new TypeError("tags.discNumber, when provided, must be a positive integer.");if(t.discsTotal!==void 0&&(!Number.isInteger(t.discsTotal)||t.discsTotal<=0))throw new TypeError("tags.discsTotal, when provided, must be a positive integer.");if(t.genre!==void 0&&typeof t.genre!="string")throw new TypeError("tags.genre, when provided, must be a string.");if(t.date!==void 0&&(!(t.date instanceof Date)||Number.isNaN(t.date.getTime())))throw new TypeError("tags.date, when provided, must be a valid Date.");if(t.lyrics!==void 0&&typeof t.lyrics!="string")throw new TypeError("tags.lyrics, when provided, must be a string.");if(t.images!==void 0){if(!Array.isArray(t.images))throw new TypeError("tags.images, when provided, must be an array.");for(const e of t.images){if(!e||typeof e!="object")throw new TypeError("Each image in tags.images must be an object.");if(!(e.data instanceof Uint8Array))throw new TypeError("Each image.data must be a Uint8Array.");if(typeof e.mimeType!="string")throw new TypeError("Each image.mimeType must be a string.");if(!["coverFront","coverBack","unknown"].includes(e.kind))throw new TypeError("Each image.kind must be 'coverFront', 'coverBack', or 'unknown'.")}}if(t.comment!==void 0&&typeof t.comment!="string")throw new TypeError("tags.comment, when provided, must be a string.");if(t.raw!==void 0){if(!t.raw||typeof t.raw!="object")throw new TypeError("tags.raw, when provided, must be an object.");for(const e of Object.values(t.raw))if(e!==null&&typeof e!="string"&&!(e instanceof Uint8Array)&&!(e instanceof Ru)&&!(e instanceof F4))throw new TypeError("Each value in tags.raw must be a string, Uint8Array, RichImageData, AttachedFile, or null.")}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const co=["avc","hevc","vp9","av1","vp8"],Zr=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],kf=["aac","opus","mp3","vorbis","flac"],uo=[...kf,...Zr],Mm=["webvtt"],AT=[{maxMacroblocks:99,maxBitrate:64e3,level:10},{maxMacroblocks:396,maxBitrate:192e3,level:11},{maxMacroblocks:396,maxBitrate:384e3,level:12},{maxMacroblocks:396,maxBitrate:768e3,level:13},{maxMacroblocks:396,maxBitrate:2e6,level:20},{maxMacroblocks:792,maxBitrate:4e6,level:21},{maxMacroblocks:1620,maxBitrate:4e6,level:22},{maxMacroblocks:1620,maxBitrate:1e7,level:30},{maxMacroblocks:3600,maxBitrate:14e6,level:31},{maxMacroblocks:5120,maxBitrate:2e7,level:32},{maxMacroblocks:8192,maxBitrate:2e7,level:40},{maxMacroblocks:8192,maxBitrate:5e7,level:41},{maxMacroblocks:8704,maxBitrate:5e7,level:42},{maxMacroblocks:22080,maxBitrate:135e6,level:50},{maxMacroblocks:36864,maxBitrate:24e7,level:51},{maxMacroblocks:36864,maxBitrate:24e7,level:52},{maxMacroblocks:139264,maxBitrate:24e7,level:60},{maxMacroblocks:139264,maxBitrate:48e7,level:61},{maxMacroblocks:139264,maxBitrate:8e8,level:62}],IT=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:35651584,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:35651584,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:35651584,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:186}],ol=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:35651584,maxBitrate:18e7,level:60},{maxPictureSize:35651584,maxBitrate:24e7,level:61},{maxPictureSize:35651584,maxBitrate:48e7,level:62}],PT=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:35651584,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:19}],MT=".01.01.01.01.00",OT=".0.110.01.01.01.0",KW=(t,e,n,r)=>{if(t==="avc"){const s=Math.ceil(e/16)*Math.ceil(n/16),o=AT.find(d=>s<=d.maxMacroblocks&&r<=d.maxBitrate)??Qn(AT),a=o?o.level:0,l="64".padStart(2,"0"),c="00",u=a.toString(16).padStart(2,"0");return`avc1.${l}${c}${u}`}else if(t==="hevc"){const a=e*n,l=IT.find(u=>a<=u.maxPictureSize&&r<=u.maxBitrate)??Qn(IT);return`hev1.1.6.${l.tier}${l.level}.B0`}else{if(t==="vp8")return"vp8";if(t==="vp9"){const s=e*n;return`vp09.00.${(ol.find(l=>s<=l.maxPictureSize&&r<=l.maxBitrate)??Qn(ol)).level.toString().padStart(2,"0")}.08`}else if(t==="av1"){const s=e*n,o=PT.find(c=>s<=c.maxPictureSize&&r<=c.maxBitrate)??Qn(PT);return`av01.0.${o.level.toString().padStart(2,"0")}${o.tier}.08`}}throw new TypeError(`Unhandled codec '${t}'.`)},GW=t=>{const e=t.split("."),i=(1<<7)+1,s=Number(e[1]),o=e[2],a=Number(o.slice(0,-1)),l=(s<<5)+a,c=o.slice(-1)==="H"?1:0,d=Number(e[3])===8?0:1,f=0,h=e[4]?Number(e[4]):0,p=e[5]?Number(e[5][0]):1,m=e[5]?Number(e[5][1]):1,g=e[5]?Number(e[5][2]):0,y=(c<<7)+(d<<6)+(f<<5)+(h<<4)+(p<<3)+(m<<2)+g;return[i,l,y,0]},z4=t=>{const{codec:e,codecDescription:n,colorSpace:r,avcCodecInfo:i,hevcCodecInfo:s,vp9CodecInfo:o,av1CodecInfo:a}=t;if(e==="avc"){if(i){const l=new Uint8Array([i.avcProfileIndication,i.profileCompatibility,i.avcLevelIndication]);return`avc1.${ET(l)}`}if(!n||n.byteLength<4)throw new TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return`avc1.${ET(n.subarray(1,4))}`}else if(e==="hevc"){let l,c,u,d,f,h;if(s)l=s.generalProfileSpace,c=s.generalProfileIdc,u=kT(s.generalProfileCompatibilityFlags),d=s.generalTierFlag,f=s.generalLevelIdc,h=[...s.generalConstraintIndicatorFlags];else{if(!n||n.byteLength<23)throw new TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");const m=$r(n),g=m.getUint8(1);l=g>>6&3,c=g&31,u=kT(m.getUint32(2)),d=g>>5&1,f=m.getUint8(12),h=[];for(let y=0;y<6;y++)h.push(m.getUint8(6+y))}let p="hev1.";for(p+=["","A","B","C"][l]+c,p+=".",p+=u.toString(16).toUpperCase(),p+=".",p+=d===0?"L":"H",p+=f;h.length>0&&h[h.length-1]===0;)h.pop();return h.length>0&&(p+=".",p+=h.map(m=>m.toString(16).toUpperCase()).join(".")),p}else{if(e==="vp8")return"vp8";if(e==="vp9"){if(!o){const y=t.width*t.height;let w=Qn(ol).level;for(const k of ol)if(y<=k.maxPictureSize){w=k.level;break}return`vp09.00.${w.toString().padStart(2,"0")}.08`}const l=o.profile.toString().padStart(2,"0"),c=o.level.toString().padStart(2,"0"),u=o.bitDepth.toString().padStart(2,"0"),d=o.chromaSubsampling.toString().padStart(2,"0"),f=o.colourPrimaries.toString().padStart(2,"0"),h=o.transferCharacteristics.toString().padStart(2,"0"),p=o.matrixCoefficients.toString().padStart(2,"0"),m=o.videoFullRangeFlag.toString().padStart(2,"0");let g=`vp09.${l}.${c}.${u}.${d}`;return g+=`.${f}.${h}.${p}.${m}`,g.endsWith(MT)&&(g=g.slice(0,-MT.length)),g}else if(e==="av1"){if(!a){const k=t.width*t.height;let C=Qn(ol).level;for(const A of ol)if(k<=A.maxPictureSize){C=A.level;break}return`av01.0.${C.toString().padStart(2,"0")}M.08`}const l=a.profile,c=a.level.toString().padStart(2,"0"),u=a.tier?"H":"M",d=a.bitDepth.toString().padStart(2,"0"),f=a.monochrome?"1":"0",h=100*a.chromaSubsamplingX+10*a.chromaSubsamplingY+1*(a.chromaSubsamplingX&&a.chromaSubsamplingY?a.chromaSamplePosition:0),p=r?.primaries?Bh[r.primaries]:1,m=r?.transfer?$h[r.transfer]:1,g=r?.matrix?Fh[r.matrix]:1,y=r?.fullRange?1:0;let w=`av01.${l}.${c}${u}.${d}`;return w+=`.${f}.${h.toString().padStart(3,"0")}`,w+=`.${p.toString().padStart(2,"0")}`,w+=`.${m.toString().padStart(2,"0")}`,w+=`.${g.toString().padStart(2,"0")}`,w+=`.${y}`,w.endsWith(OT)&&(w=w.slice(0,-OT.length)),w}}throw new TypeError(`Unhandled codec '${e}'.`)},ZW=(t,e,n)=>{if(t==="aac")return e>=2&&n<=24e3?"mp4a.40.29":n<=24e3?"mp4a.40.5":"mp4a.40.2";if(t==="mp3")return"mp3";if(t==="opus")return"opus";if(t==="vorbis")return"vorbis";if(t==="flac")return"flac";if(Zr.includes(t))return t;throw new TypeError(`Unhandled codec '${t}'.`)},U4=t=>{const{codec:e,codecDescription:n,aacCodecInfo:r}=t;if(e==="aac"){if(!r)throw new TypeError("AAC codec info must be provided.");return r.isMpeg2?"mp4a.67":`mp4a.40.${V4(n).objectType}`}else{if(e==="mp3")return"mp3";if(e==="opus")return"opus";if(e==="vorbis")return"vorbis";if(e==="flac")return"flac";if(e&&Zr.includes(e))return e}throw new TypeError(`Unhandled codec '${e}'.`)},Om=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],H4=[-1,1,2,3,4,5,6,8],V4=t=>{if(!t||t.byteLength<2)throw new TypeError("AAC description must be at least 2 bytes long.");const e=new Wn(t);let n=e.readBits(5);n===31&&(n=32+e.readBits(6));const r=e.readBits(4);let i=null;r===15?i=e.readBits(24):r<Om.length&&(i=Om[r]);const s=e.readBits(4);let o=null;return s>=1&&s<=7&&(o=H4[s]),{objectType:n,frequencyIndex:r,sampleRate:i,channelConfiguration:s,numberOfChannels:o}},A0=48e3,j4=/^pcm-([usf])(\d+)+(be)?$/,$l=t=>{if(K(Zr.includes(t)),t==="ulaw")return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if(t==="alaw")return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};const e=j4.exec(t);K(e);let n;e[1]==="u"?n="unsigned":e[1]==="s"?n="signed":n="float";const r=Number(e[2])/8,i=e[3]!=="be",s=t==="pcm-u8"?2**7:0;return{dataType:n,sampleSize:r,littleEndian:i,silentValue:s}},W4=t=>t.startsWith("avc1")||t.startsWith("avc3")?"avc":t.startsWith("hev1")||t.startsWith("hvc1")?"hevc":t==="vp8"?"vp8":t.startsWith("vp09")?"vp9":t.startsWith("av01")?"av1":t.startsWith("mp4a.40")||t==="mp4a.67"?"aac":t==="mp3"||t==="mp4a.69"||t==="mp4a.6B"||t==="mp4a.6b"?"mp3":t==="opus"?"opus":t==="vorbis"?"vorbis":t==="flac"?"flac":t==="ulaw"?"ulaw":t==="alaw"?"alaw":j4.test(t)?t:t==="webvtt"?"webvtt":null,QW=t=>t==="avc"?{avc:{format:"avc"}}:t==="hevc"?{hevc:{format:"hevc"}}:{},XW=t=>t==="aac"?{aac:{format:"aac"}}:t==="opus"?{opus:{format:"opus"}}:{},YW=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],JW=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,eq=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,tq=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,nq=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,rq=t=>{if(!t)throw new TypeError("Video chunk metadata must be provided.");if(typeof t!="object")throw new TypeError("Video chunk metadata must be an object.");if(!t.decoderConfig)throw new TypeError("Video chunk metadata must include a decoder configuration.");if(typeof t.decoderConfig!="object")throw new TypeError("Video chunk metadata decoder configuration must be an object.");if(typeof t.decoderConfig.codec!="string")throw new TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!YW.some(e=>t.decoderConfig.codec.startsWith(e)))throw new TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(t.decoderConfig.codedWidth)||t.decoderConfig.codedWidth<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(t.decoderConfig.codedHeight)||t.decoderConfig.codedHeight<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(t.decoderConfig.description!==void 0&&!T0(t.decoderConfig.description))throw new TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(t.decoderConfig.colorSpace!==void 0){const{colorSpace:e}=t.decoderConfig;if(typeof e!="object")throw new TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");const n=Object.keys(Bh);if(e.primaries!=null&&!n.includes(e.primaries))throw new TypeError(`Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of ${n.join(", ")}.`);const r=Object.keys($h);if(e.transfer!=null&&!r.includes(e.transfer))throw new TypeError(`Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of ${r.join(", ")}.`);const i=Object.keys(Fh);if(e.matrix!=null&&!i.includes(e.matrix))throw new TypeError(`Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of ${i.join(", ")}.`);if(e.fullRange!=null&&typeof e.fullRange!="boolean")throw new TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(t.decoderConfig.codec.startsWith("avc1")||t.decoderConfig.codec.startsWith("avc3")){if(!JW.test(t.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(t.decoderConfig.codec.startsWith("hev1")||t.decoderConfig.codec.startsWith("hvc1")){if(!eq.test(t.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(t.decoderConfig.codec.startsWith("vp8")){if(t.decoderConfig.codec!=="vp8")throw new TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(t.decoderConfig.codec.startsWith("vp09")){if(!tq.test(t.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(t.decoderConfig.codec.startsWith("av01")&&!nq.test(t.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},iq=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],sq=t=>{if(!t)throw new TypeError("Audio chunk metadata must be provided.");if(typeof t!="object")throw new TypeError("Audio chunk metadata must be an object.");if(!t.decoderConfig)throw new TypeError("Audio chunk metadata must include a decoder configuration.");if(typeof t.decoderConfig!="object")throw new TypeError("Audio chunk metadata decoder configuration must be an object.");if(typeof t.decoderConfig.codec!="string")throw new TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!iq.some(e=>t.decoderConfig.codec.startsWith(e)))throw new TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(t.decoderConfig.sampleRate)||t.decoderConfig.sampleRate<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(t.decoderConfig.numberOfChannels)||t.decoderConfig.numberOfChannels<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(t.decoderConfig.description!==void 0&&!T0(t.decoderConfig.description))throw new TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(t.decoderConfig.codec.startsWith("mp4a")&&t.decoderConfig.codec!=="mp4a.69"&&t.decoderConfig.codec!=="mp4a.6B"&&t.decoderConfig.codec!=="mp4a.6b"){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(t.decoderConfig.codec))throw new TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.");if(!t.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for AAC must include a description, which is expected to be an AudioSpecificConfig as specified in ISO 14496-3.")}else if(t.decoderConfig.codec.startsWith("mp3")||t.decoderConfig.codec.startsWith("mp4a")){if(t.decoderConfig.codec!=="mp3"&&t.decoderConfig.codec!=="mp4a.69"&&t.decoderConfig.codec!=="mp4a.6B"&&t.decoderConfig.codec!=="mp4a.6b")throw new TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(t.decoderConfig.codec.startsWith("opus")){if(t.decoderConfig.codec!=="opus")throw new TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(t.decoderConfig.description&&t.decoderConfig.description.byteLength<18)throw new TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(t.decoderConfig.codec.startsWith("vorbis")){if(t.decoderConfig.codec!=="vorbis")throw new TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!t.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(t.decoderConfig.codec.startsWith("flac")){if(t.decoderConfig.codec!=="flac")throw new TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');if(!t.decoderConfig.description||t.decoderConfig.description.byteLength<42)throw new TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((t.decoderConfig.codec.startsWith("pcm")||t.decoderConfig.codec.startsWith("ulaw")||t.decoderConfig.codec.startsWith("alaw"))&&!Zr.includes(t.decoderConfig.codec))throw new TypeError(`Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM codecs (${Zr.join(", ")}).`)},oq=t=>{if(!t)throw new TypeError("Subtitle metadata must be provided.");if(typeof t!="object")throw new TypeError("Subtitle metadata must be an object.");if(!t.config)throw new TypeError("Subtitle metadata must include a config object.");if(typeof t.config!="object")throw new TypeError("Subtitle metadata config must be an object.");if(typeof t.config.description!="string")throw new TypeError("Subtitle metadata config description must be a string.")};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class aq{constructor(e){this.mutex=new kd,this.firstMediaStreamTimestamp=null,this.trackTimestampInfo=new WeakMap,this.output=e}onTrackClose(e){}validateAndNormalizeTimestamp(e,n,r){n+=e.source._timestampOffset;let i=this.trackTimestampInfo.get(e);if(!i){if(!r)throw new Error("First frame must be a key frame.");i={maxTimestamp:n,maxTimestampBeforeLastKeyFrame:n},this.trackTimestampInfo.set(e,i)}if(n<0)throw new Error(`Timestamps must be non-negative (got ${n}s).`);if(r&&(i.maxTimestampBeforeLastKeyFrame=i.maxTimestamp),n<i.maxTimestampBeforeLastKeyFrame)throw new Error(`Timestamps cannot be smaller than the highest timestamp of the previous GOP (a GOP begins with a key frame and ends right before the next key frame). Got ${n}s, but highest timestamp is ${i.maxTimestampBeforeLastKeyFrame}s.`);return i.maxTimestamp=Math.max(i.maxTimestamp,n),n}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var Lu;(function(t){t[t.IDR=5]="IDR",t[t.SPS=7]="SPS",t[t.PPS=8]="PPS",t[t.SPS_EXT=13]="SPS_EXT"})(Lu||(Lu={}));var ci;(function(t){t[t.RASL_N=8]="RASL_N",t[t.RASL_R=9]="RASL_R",t[t.BLA_W_LP=16]="BLA_W_LP",t[t.RSV_IRAP_VCL23=23]="RSV_IRAP_VCL23",t[t.VPS_NUT=32]="VPS_NUT",t[t.SPS_NUT=33]="SPS_NUT",t[t.PPS_NUT=34]="PPS_NUT",t[t.PREFIX_SEI_NUT=39]="PREFIX_SEI_NUT",t[t.SUFFIX_SEI_NUT=40]="SUFFIX_SEI_NUT"})(ci||(ci={}));const zh=t=>{const e=[];let n=0;for(;n<t.length;){let r=-1,i=0;for(let s=n;s<t.length-3;s++){if(t[s]===0&&t[s+1]===0&&t[s+2]===1){r=s,i=3;break}if(s<t.length-4&&t[s]===0&&t[s+1]===0&&t[s+2]===0&&t[s+3]===1){r=s,i=4;break}}if(r===-1)break;if(n>0&&r>n){const s=t.subarray(n,r);s.length>0&&e.push(s)}n=r+i}if(n<t.length){const r=t.subarray(n);r.length>0&&e.push(r)}return e},q4=(t,e)=>{const n=[];let r=0;const i=new DataView(t.buffer,t.byteOffset,t.byteLength);for(;r+e<=t.length;){let s;e===1?s=i.getUint8(r):e===2?s=i.getUint16(r,!1):e===3?s=_0(i,r,!1):e===4?s=i.getUint32(r,!1):(Al(e),K(!1)),r+=e;const o=t.subarray(r,r+s);n.push(o),r+=s}return n},Dv=t=>{const e=[],n=t.length;for(let r=0;r<n;r++)r+2<n&&t[r]===0&&t[r+1]===0&&t[r+2]===3?(e.push(0,0),r+=2):e.push(t[r]);return new Uint8Array(e)},lq=t=>{const n=zh(t);if(n.length===0)return null;let r=0;for(const a of n)r+=4+a.byteLength;const i=new Uint8Array(r),s=new DataView(i.buffer);let o=0;for(const a of n){const l=a.byteLength;s.setUint32(o,l,!1),o+=4,i.set(a,o),o+=a.byteLength}return i},cq=(t,e)=>{if(e.description){const i=(oo(e.description)[4]&3)+1;return q4(t,i)}else return zh(t)},jp=t=>t[0]&31,K4=t=>{try{const e=zh(t),n=e.filter(f=>jp(f)===Lu.SPS),r=e.filter(f=>jp(f)===Lu.PPS),i=e.filter(f=>jp(f)===Lu.SPS_EXT);if(n.length===0||r.length===0)return null;const s=n[0],o=new Wn(Dv(s));if(o.skipBits(1),o.skipBits(2),o.readBits(5)!==7)return console.error("Invalid SPS NAL unit type"),null;const l=o.readAlignedByte(),c=o.readAlignedByte(),u=o.readAlignedByte(),d={configurationVersion:1,avcProfileIndication:l,profileCompatibility:c,avcLevelIndication:u,lengthSizeMinusOne:3,sequenceParameterSets:n,pictureParameterSets:r,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if(l===100||l===110||l===122||l===144){nt(o);const f=nt(o);f===3&&o.skipBits(1);const h=nt(o),p=nt(o);d.chromaFormat=f,d.bitDepthLumaMinus8=h,d.bitDepthChromaMinus8=p,d.sequenceParameterSetExt=i}return d}catch(e){return console.error("Error building AVC Decoder Configuration Record:",e),null}},uq=t=>{const e=[];e.push(t.configurationVersion),e.push(t.avcProfileIndication),e.push(t.profileCompatibility),e.push(t.avcLevelIndication),e.push(252|t.lengthSizeMinusOne&3),e.push(224|t.sequenceParameterSets.length&31);for(const n of t.sequenceParameterSets){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}e.push(t.pictureParameterSets.length);for(const n of t.pictureParameterSets){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}if(t.avcProfileIndication===100||t.avcProfileIndication===110||t.avcProfileIndication===122||t.avcProfileIndication===144){K(t.chromaFormat!==null),K(t.bitDepthLumaMinus8!==null),K(t.bitDepthChromaMinus8!==null),K(t.sequenceParameterSetExt!==null),e.push(252|t.chromaFormat&3),e.push(248|t.bitDepthLumaMinus8&7),e.push(248|t.bitDepthChromaMinus8&7),e.push(t.sequenceParameterSetExt.length);for(const n of t.sequenceParameterSetExt){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}}return new Uint8Array(e)},G4=(t,e)=>{if(e.description){const i=(oo(e.description)[21]&3)+1;return q4(t,i)}else return zh(t)},Va=t=>t[0]>>1&63,Z4=t=>{try{const e=zh(t),n=e.filter(_=>Va(_)===ci.VPS_NUT),r=e.filter(_=>Va(_)===ci.SPS_NUT),i=e.filter(_=>Va(_)===ci.PPS_NUT),s=e.filter(_=>Va(_)===ci.PREFIX_SEI_NUT||Va(_)===ci.SUFFIX_SEI_NUT);if(r.length===0||i.length===0)return null;const o=r[0],a=new Wn(Dv(o));a.skipBits(16),a.readBits(4);const l=a.readBits(3),c=a.readBits(1),{general_profile_space:u,general_tier_flag:d,general_profile_idc:f,general_profile_compatibility_flags:h,general_constraint_indicator_flags:p,general_level_idc:m}=dq(a,l);nt(a);const g=nt(a);g===3&&a.skipBits(1),nt(a),nt(a),a.readBits(1)&&(nt(a),nt(a),nt(a),nt(a));const y=nt(a),w=nt(a);nt(a);const C=a.readBits(1)?0:l;for(let _=C;_<=l;_++)nt(a),nt(a),nt(a);nt(a),nt(a),nt(a),nt(a),nt(a),nt(a),a.readBits(1)&&a.readBits(1)&&fq(a),a.skipBits(1),a.skipBits(1),a.readBits(1)&&(a.skipBits(4),a.skipBits(4),nt(a),nt(a),a.skipBits(1));const A=nt(a);if(hq(a,A),a.readBits(1)){const _=nt(a);for(let I=0;I<_;I++)nt(a),a.skipBits(1)}a.skipBits(1),a.skipBits(1);let E=0;a.readBits(1)&&(E=mq(a,l));let P=0;if(i.length>0){const _=i[0],I=new Wn(Dv(_));I.skipBits(16),nt(I),nt(I),I.skipBits(1),I.skipBits(1),I.skipBits(3),I.skipBits(1),I.skipBits(1),nt(I),nt(I),Ef(I),I.skipBits(1),I.skipBits(1),I.readBits(1)&&nt(I),Ef(I),Ef(I),I.skipBits(1),I.skipBits(1),I.skipBits(1),I.skipBits(1);const D=I.readBits(1),B=I.readBits(1);!D&&!B?P=0:D&&!B?P=2:!D&&B?P=3:P=0}const S=[...n.length?[{arrayCompleteness:1,nalUnitType:ci.VPS_NUT,nalUnits:n}]:[],...r.length?[{arrayCompleteness:1,nalUnitType:ci.SPS_NUT,nalUnits:r}]:[],...i.length?[{arrayCompleteness:1,nalUnitType:ci.PPS_NUT,nalUnits:i}]:[],...s.length?[{arrayCompleteness:1,nalUnitType:Va(s[0]),nalUnits:s}]:[]];return{configurationVersion:1,generalProfileSpace:u,generalTierFlag:d,generalProfileIdc:f,generalProfileCompatibilityFlags:h,generalConstraintIndicatorFlags:p,generalLevelIdc:m,minSpatialSegmentationIdc:E,parallelismType:P,chromaFormatIdc:g,bitDepthLumaMinus8:y,bitDepthChromaMinus8:w,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:l+1,temporalIdNested:c,lengthSizeMinusOne:3,arrays:S}}catch(e){return console.error("Error building HEVC Decoder Configuration Record:",e),null}},dq=(t,e)=>{const n=t.readBits(2),r=t.readBits(1),i=t.readBits(5);let s=0;for(let u=0;u<32;u++)s=s<<1|t.readBits(1);const o=new Uint8Array(6);for(let u=0;u<6;u++)o[u]=t.readBits(8);const a=t.readBits(8),l=[],c=[];for(let u=0;u<e;u++)l.push(t.readBits(1)),c.push(t.readBits(1));if(e>0)for(let u=e;u<8;u++)t.skipBits(2);for(let u=0;u<e;u++)l[u]&&t.skipBits(88),c[u]&&t.skipBits(8);return{general_profile_space:n,general_tier_flag:r,general_profile_idc:i,general_profile_compatibility_flags:s,general_constraint_indicator_flags:o,general_level_idc:a}},fq=t=>{for(let e=0;e<4;e++)for(let n=0;n<(e===3?2:6);n++)if(!t.readBits(1))nt(t);else{const i=Math.min(64,1<<4+(e<<1));e>1&&Ef(t);for(let s=0;s<i;s++)Ef(t)}},hq=(t,e)=>{const n=[];for(let r=0;r<e;r++)n[r]=pq(t,r,e,n)},pq=(t,e,n,r)=>{let i=0,s=0,o=0;if(e!==0&&(s=t.readBits(1)),s){if(e===n){const l=nt(t);o=e-(l+1)}else o=e-1;t.readBits(1),nt(t);const a=r[o]??0;for(let l=0;l<=a;l++)t.readBits(1)||t.readBits(1);i=r[o]}else{const a=nt(t),l=nt(t);for(let c=0;c<a;c++)nt(t),t.readBits(1);for(let c=0;c<l;c++)nt(t),t.readBits(1);i=a+l}return i},mq=(t,e)=>{if(t.readBits(1)&&t.readBits(8)===255&&(t.readBits(16),t.readBits(16)),t.readBits(1)&&t.readBits(1),t.readBits(1)&&(t.readBits(3),t.readBits(1),t.readBits(1)&&(t.readBits(8),t.readBits(8),t.readBits(8))),t.readBits(1)&&(nt(t),nt(t)),t.readBits(1),t.readBits(1),t.readBits(1),t.readBits(1)&&(nt(t),nt(t),nt(t),nt(t)),t.readBits(1)&&(t.readBits(32),t.readBits(32),t.readBits(1)&&nt(t),t.readBits(1)&&gq(t,!0,e)),t.readBits(1)){t.readBits(1),t.readBits(1),t.readBits(1);const n=nt(t);return nt(t),nt(t),nt(t),nt(t),n}return 0},gq=(t,e,n)=>{let r=!1,i=!1,s=!1;r=t.readBits(1)===1,i=t.readBits(1)===1,(r||i)&&(s=t.readBits(1)===1,s&&(t.readBits(8),t.readBits(5),t.readBits(1),t.readBits(5)),t.readBits(4),t.readBits(4),s&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let o=0;o<=n;o++){const a=t.readBits(1)===1;let l=!0;a||(l=t.readBits(1)===1);let c=!1;l?nt(t):c=t.readBits(1)===1;let u=1;c||(u=nt(t)+1),r&&NT(t,u,s),i&&NT(t,u,s)}},NT=(t,e,n)=>{for(let r=0;r<e;r++)nt(t),nt(t),n&&(nt(t),nt(t)),t.readBits(1)},yq=t=>{const e=[];e.push(t.configurationVersion),e.push((t.generalProfileSpace&3)<<6|(t.generalTierFlag&1)<<5|t.generalProfileIdc&31),e.push(t.generalProfileCompatibilityFlags>>>24&255),e.push(t.generalProfileCompatibilityFlags>>>16&255),e.push(t.generalProfileCompatibilityFlags>>>8&255),e.push(t.generalProfileCompatibilityFlags&255),e.push(...t.generalConstraintIndicatorFlags),e.push(t.generalLevelIdc&255),e.push(240|t.minSpatialSegmentationIdc>>8&15),e.push(t.minSpatialSegmentationIdc&255),e.push(252|t.parallelismType&3),e.push(252|t.chromaFormatIdc&3),e.push(248|t.bitDepthLumaMinus8&7),e.push(248|t.bitDepthChromaMinus8&7),e.push(t.avgFrameRate>>8&255),e.push(t.avgFrameRate&255),e.push((t.constantFrameRate&3)<<6|(t.numTemporalLayers&7)<<3|(t.temporalIdNested&1)<<2|t.lengthSizeMinusOne&3),e.push(t.arrays.length&255);for(const n of t.arrays){e.push((n.arrayCompleteness&1)<<7|0|n.nalUnitType&63),e.push(n.nalUnits.length>>8&255),e.push(n.nalUnits.length&255);for(const r of n.nalUnits){e.push(r.length>>8&255),e.push(r.length&255);for(let i=0;i<r.length;i++)e.push(r[i])}}return new Uint8Array(e)},Q4=t=>{const e=new Wn(t);if(e.readBits(2)!==2)return null;const r=e.readBits(1),s=(e.readBits(1)<<1)+r;if(s===3&&e.skipBits(1),e.readBits(1)===1||e.readBits(1)!==0||(e.skipBits(2),e.readBits(24)!==4817730))return null;let c=8;s>=2&&(c=e.readBits(1)?12:10);const u=e.readBits(3);let d=0,f=0;if(u!==7)if(f=e.readBits(1),s===1||s===3){const P=e.readBits(1),S=e.readBits(1);d=!P&&!S?3:P&&!S?2:1,e.skipBits(1)}else d=1;else d=3,f=1;const h=e.readBits(16),p=e.readBits(16),m=h+1,g=p+1,y=m*g;let w=Qn(ol).level;for(const E of ol)if(y<=E.maxPictureSize){w=E.level;break}return{profile:s,level:w,bitDepth:c,chromaSubsampling:d,videoFullRangeFlag:f,colourPrimaries:u===2?1:u===1?6:2,transferCharacteristics:u===2?1:u===1?6:2,matrixCoefficients:u===7?0:u===2?1:u===1?6:2}},X4=function*(t){const e=new Wn(t),n=()=>{let r=0;for(let i=0;i<8;i++){const s=e.readAlignedByte();if(r|=(s&127)<<i*7,!(s&128))break;if(i===7&&s&128)return null}return r>=2**32-1?null:r};for(;e.getBitsLeft()>=8;){e.skipBits(1);const r=e.readBits(4),i=e.readBits(1),s=e.readBits(1);e.skipBits(1),i&&e.skipBits(8);let o;if(s){const a=n();if(a===null)return;o=a}else o=Math.floor(e.getBitsLeft()/8);K(e.pos%8===0),yield{type:r,data:t.subarray(e.pos/8,e.pos/8+o)},e.skipBits(o*8)}},Y4=t=>{for(const{type:e,data:n}of X4(t)){if(e!==1)continue;const r=new Wn(n),i=r.readBits(3);r.readBits(1);const s=r.readBits(1);let o=0,a=0,l=0;if(s)o=r.readBits(5);else{if(r.readBits(1)&&(r.skipBits(32),r.skipBits(32),r.readBits(1)))return null;const g=r.readBits(1);g&&(l=r.readBits(5),r.skipBits(32),r.skipBits(5),r.skipBits(5));const y=r.readBits(5);for(let w=0;w<=y;w++){r.skipBits(12);const k=r.readBits(5);if(w===0&&(o=k),k>7){const A=r.readBits(1);w===0&&(a=A)}if(g&&r.readBits(1)){const E=l+1;r.skipBits(E),r.skipBits(E),r.skipBits(1)}r.readBits(1)&&r.skipBits(4)}}const c=r.readBits(1);let u=8;i===2&&c?u=r.readBits(1)?12:10:i<=2&&(u=c?10:8);let d=0;i!==1&&(d=r.readBits(1));let f=1,h=1,p=0;return d||(i===0?(f=1,h=1):i===1?(f=0,h=0):u===12&&(f=r.readBits(1),f&&(h=r.readBits(1))),f&&h&&(p=r.readBits(2))),{profile:i,level:o,tier:a,bitDepth:u,monochrome:d,chromaSubsamplingX:f,chromaSubsamplingY:h,chromaSamplePosition:p}}return null},J4=t=>{const e=$r(t),n=e.getUint8(9),r=e.getUint16(10,!0),i=e.getUint32(12,!0),s=e.getInt16(16,!0),o=e.getUint8(18);let a=null;return o&&(a=t.subarray(19,21+n)),{outputChannelCount:n,preSkip:r,inputSampleRate:i,outputGain:s,channelMappingFamily:o,channelMappingTable:a}},bq=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],wq=t=>{const e=t[0]>>3;return{durationInSamples:bq[e]}},vq=t=>{if(t.length<7)throw new Error("Setup header is too short.");if(t[0]!==5)throw new Error("Wrong packet type in Setup header.");if(String.fromCharCode(...t.slice(1,7))!=="vorbis")throw new Error("Invalid packet signature in Setup header.");const n=t.length,r=new Uint8Array(n);for(let d=0;d<n;d++)r[d]=t[n-1-d];const i=new Wn(r);let s=0;for(;i.getBitsLeft()>97;)if(i.readBits(1)===1){s=i.pos;break}if(s===0)throw new Error("Invalid Setup header: framing bit not found.");let o=0,a=!1,l=0;for(;i.getBitsLeft()>=97;){const d=i.pos,f=i.readBits(8),h=i.readBits(16),p=i.readBits(16);if(f>63||h!==0||p!==0){i.pos=d;break}if(i.skipBits(1),o++,o>64)break;i.clone().readBits(6)+1===o&&(a=!0,l=o)}if(!a)throw new Error("Invalid Setup header: mode header not found.");if(l>63)throw new Error(`Unsupported mode count: ${l}.`);const c=l;i.pos=0,i.skipBits(s);const u=Array(c).fill(0);for(let d=c-1;d>=0;d--)i.skipBits(40),u[d]=i.readBits(1);return{modeBlockflags:u}},eM=(t,e,n)=>{switch(t){case"avc":return cq(n,e).some(s=>jp(s)===Lu.IDR)?"key":"delta";case"hevc":return G4(n,e).some(s=>{const o=Va(s);return ci.BLA_W_LP<=o&&o<=ci.RSV_IRAP_VCL23})?"key":"delta";case"vp8":return(n[0]&1)===0?"key":"delta";case"vp9":{const r=new Wn(n);if(r.readBits(2)!==2)return null;const i=r.readBits(1);return(r.readBits(1)<<1)+i===3&&r.skipBits(1),r.readBits(1)?null:r.readBits(1)===0?"key":"delta"}case"av1":{let r=!1;for(const{type:i,data:s}of X4(n))if(i===1){const o=new Wn(s);o.skipBits(4),r=!!o.readBits(1)}else if(i===3||i===6||i===7){if(r)return"key";const o=new Wn(s);return o.readBits(1)?null:o.readBits(2)===0?"key":"delta"}return null}default:Al(t),K(!1)}};var Du;(function(t){t[t.STREAMINFO=0]="STREAMINFO",t[t.VORBIS_COMMENT=4]="VORBIS_COMMENT",t[t.PICTURE=6]="PICTURE"})(Du||(Du={}));const Bv=(t,e)=>{const n=$r(t);let r=0;const i=n.getUint32(r,!0);r+=4;const s=Ji.decode(t.subarray(r,r+i));r+=i,i>0&&(e.raw??={},e.raw.vendor??=s);const o=n.getUint32(r,!0);r+=4;for(let a=0;a<o;a++){const l=n.getUint32(r,!0);r+=4;const c=Ji.decode(t.subarray(r,r+l));r+=l;const u=c.indexOf("=");if(u===-1)continue;const d=c.slice(0,u).toUpperCase(),f=c.slice(u+1);switch(e.raw??={},e.raw[d]??=f,d){case"TITLE":e.title??=f;break;case"DESCRIPTION":e.description??=f;break;case"ARTIST":e.artist??=f;break;case"ALBUM":e.album??=f;break;case"ALBUMARTIST":e.albumArtist??=f;break;case"COMMENT":e.comment??=f;break;case"LYRICS":e.lyrics??=f;break;case"TRACKNUMBER":{const h=f.split("/"),p=Number.parseInt(h[0],10),m=h[1]&&Number.parseInt(h[1],10);Number.isInteger(p)&&p>0&&(e.trackNumber??=p),m&&Number.isInteger(m)&&m>0&&(e.tracksTotal??=m)}break;case"TRACKTOTAL":{const h=Number.parseInt(f,10);Number.isInteger(h)&&h>0&&(e.tracksTotal??=h)}break;case"DISCNUMBER":{const h=f.split("/"),p=Number.parseInt(h[0],10),m=h[1]&&Number.parseInt(h[1],10);Number.isInteger(p)&&p>0&&(e.discNumber??=p),m&&Number.isInteger(m)&&m>0&&(e.discsTotal??=m)}break;case"DISCTOTAL":{const h=Number.parseInt(f,10);Number.isInteger(h)&&h>0&&(e.discsTotal??=h)}break;case"DATE":{const h=new Date(f);Number.isNaN(h.getTime())||(e.date??=h)}break;case"GENRE":e.genre??=f;break;case"METADATA_BLOCK_PICTURE":{const h=qW(f),p=$r(h),m=p.getUint32(0,!1),g=p.getUint32(4,!1),y=String.fromCharCode(...h.subarray(8,8+g)),w=p.getUint32(8+g,!1),k=Ji.decode(h.subarray(12+g,12+g+w)),C=p.getUint32(g+w+28),A=h.subarray(g+w+32,g+w+32+C);e.images??=[],e.images.push({data:A,mimeType:y,kind:m===3?"coverFront":m===4?"coverBack":"unknown",name:void 0,description:k||void 0})}break}}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Vc{constructor(e){this.input=e}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const tM=[],nM=[],$v=[],Fv=[];/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const is=new Uint8Array(0);class wn{constructor(e,n,r,i,s=-1,o,a){if(this.data=e,this.type=n,this.timestamp=r,this.duration=i,this.sequenceNumber=s,e===is&&o===void 0)throw new Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(o===void 0&&(o=e.byteLength),!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(n!=="key"&&n!=="delta")throw new TypeError('type must be either "key" or "delta".');if(!Number.isFinite(r))throw new TypeError("timestamp must be a number.");if(!Number.isFinite(i)||i<0)throw new TypeError("duration must be a non-negative number.");if(!Number.isFinite(s))throw new TypeError("sequenceNumber must be a number.");if(!Number.isInteger(o)||o<0)throw new TypeError("byteLength must be a non-negative integer.");if(a!==void 0&&(typeof a!="object"||!a))throw new TypeError("sideData, when provided, must be an object.");if(a?.alpha!==void 0&&!(a.alpha instanceof Uint8Array))throw new TypeError("sideData.alpha, when provided, must be a Uint8Array.");if(a?.alphaByteLength!==void 0&&(!Number.isInteger(a.alphaByteLength)||a.alphaByteLength<0))throw new TypeError("sideData.alphaByteLength, when provided, must be a non-negative integer.");this.byteLength=o,this.sideData=a??{},this.sideData.alpha&&this.sideData.alphaByteLength===void 0&&(this.sideData.alphaByteLength=this.sideData.alpha.byteLength)}get isMetadataOnly(){return this.data===is}get microsecondTimestamp(){return Math.trunc(sl*this.timestamp)}get microsecondDuration(){return Math.trunc(sl*this.duration)}toEncodedVideoChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}alphaToEncodedVideoChunk(e=this.type){if(!this.sideData.alpha)throw new TypeError("This packet does not contain alpha side data.");if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.sideData.alpha,type:e,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}toEncodedAudioChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to an audio chunk.");if(typeof EncodedAudioChunk>"u")throw new Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}static fromEncodedChunk(e,n){if(!(e instanceof EncodedVideoChunk||e instanceof EncodedAudioChunk))throw new TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");const r=new Uint8Array(e.byteLength);return e.copyTo(r),new wn(r,e.type,e.timestamp/1e6,(e.duration??0)/1e6,void 0,void 0,n)}clone(e){if(e!==void 0&&(typeof e!="object"||e===null))throw new TypeError("options, when provided, must be an object.");if(e?.timestamp!==void 0&&!Number.isFinite(e.timestamp))throw new TypeError("options.timestamp, when provided, must be a number.");if(e?.duration!==void 0&&!Number.isFinite(e.duration))throw new TypeError("options.duration, when provided, must be a number.");return new wn(this.data,this.type,e?.timestamp??this.timestamp,e?.duration??this.duration,this.sequenceNumber,this.byteLength)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const xq=t=>{let r=t,i=4096,s=0,o=12,a=0;for(r<0&&(r=-r,s=128),r+=33,r>8191&&(r=8191);(r&i)!==i&&o>=5;)i>>=1,o--;return a=r>>o-4&15,~(s|o-5<<4|a)&255},Sq=t=>{let n=0,r=0,i=~t;i&128&&(i&=-129,n=-1),r=((i&240)>>4)+5;const s=(1<<r|(i&15)<<r-4|1<<r-5)-33;return n===0?s:-s},Eq=t=>{let n=2048,r=0,i=11,s=0,o=t;for(o<0&&(o=-o,r=128),o>4095&&(o=4095);(o&n)!==n&&i>=5;)n>>=1,i--;return s=o>>(i===4?1:i-4)&15,(r|i-4<<4|s)^85},kq=t=>{let e=0,n=0,r=t^85;r&128&&(r&=-129,e=-1),n=((r&240)>>4)+4;let i=0;return n!==4?i=1<<n|(r&15)<<n-4|1<<n-5:i=r<<1|1,e===0?i:-i};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */B4();class Gr{get displayWidth(){return this.rotation%180===0?this.codedWidth:this.codedHeight}get displayHeight(){return this.rotation%180===0?this.codedHeight:this.codedWidth}get microsecondTimestamp(){return Math.trunc(sl*this.timestamp)}get microsecondDuration(){return Math.trunc(sl*this.duration)}get hasAlpha(){return this.format&&this.format.includes("A")}constructor(e,n){if(this._closed=!1,e instanceof ArrayBuffer||ArrayBuffer.isView(e)){if(!n||typeof n!="object")throw new TypeError("init must be an object.");if(!("format"in n)||typeof n.format!="string")throw new TypeError("init.format must be a string.");if(!Number.isInteger(n.codedWidth)||n.codedWidth<=0)throw new TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(n.codedHeight)||n.codedHeight<=0)throw new TypeError("init.codedHeight must be a positive integer.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(n.timestamp))throw new TypeError("init.timestamp must be a number.");if(n.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=oo(e).slice(),this.format=n.format,this.codedWidth=n.codedWidth,this.codedHeight=n.codedHeight,this.rotation=n.rotation??0,this.timestamp=n.timestamp,this.duration=n.duration??0,this.colorSpace=new VideoColorSpace(n.colorSpace)}else if(typeof VideoFrame<"u"&&e instanceof VideoFrame){if(n?.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(n?.timestamp!==void 0&&!Number.isFinite(n?.timestamp))throw new TypeError("init.timestamp, when provided, must be a number.");if(n?.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=e,this.format=e.format,this.codedWidth=e.displayWidth,this.codedHeight=e.displayHeight,this.rotation=n?.rotation??0,this.timestamp=n?.timestamp??e.timestamp/1e6,this.duration=n?.duration??(e.duration??0)/1e6,this.colorSpace=e.colorSpace}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof SVGImageElement<"u"&&e instanceof SVGImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){if(!n||typeof n!="object")throw new TypeError("init must be an object.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(n.timestamp))throw new TypeError("init.timestamp must be a number.");if(n.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");if(typeof VideoFrame<"u")return new Gr(new VideoFrame(e,{timestamp:Math.trunc(n.timestamp*sl),duration:Math.trunc((n.duration??0)*sl)||void 0}),n);let r=0,i=0;if("naturalWidth"in e?(r=e.naturalWidth,i=e.naturalHeight):"videoWidth"in e?(r=e.videoWidth,i=e.videoHeight):"width"in e&&(r=Number(e.width),i=Number(e.height)),!r||!i)throw new TypeError("Could not determine dimensions.");const s=new OffscreenCanvas(r,i),o=s.getContext("2d",{alpha:eh(),willReadFrequently:!0});K(o),o.drawImage(e,0,0),this._data=s,this.format="RGBX",this.codedWidth=r,this.codedHeight=i,this.rotation=n.rotation??0,this.timestamp=n.timestamp,this.duration=n.duration??0,this.colorSpace=new VideoColorSpace({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}else throw new TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.")}clone(){if(this._closed)throw new Error("VideoSample is closed.");return K(this._data!==null),Wd(this._data)?new Gr(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?new Gr(this._data.slice(),{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation}):new Gr(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}close(){this._closed||(Wd(this._data)?this._data.close():this._data=null,this._closed=!0)}allocationSize(){if(this._closed)throw new Error("VideoSample is closed.");return K(this._data!==null),Wd(this._data)?this._data.allocationSize():this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}async copyTo(e){if(!T0(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(this._closed)throw new Error("VideoSample is closed.");if(K(this._data!==null),Wd(this._data))await this._data.copyTo(e);else if(this._data instanceof Uint8Array)oo(e).set(this._data);else{const r=this._data.getContext("2d");K(r);const i=r.getImageData(0,0,this.codedWidth,this.codedHeight);oo(e).set(i.data)}}toVideoFrame(){if(this._closed)throw new Error("VideoSample is closed.");return K(this._data!==null),Wd(this._data)?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0})}draw(e,n,r,i,s,o,a,l,c){let u=0,d=0,f=this.displayWidth,h=this.displayHeight,p=0,m=0,g=this.displayWidth,y=this.displayHeight;if(o!==void 0?(u=n,d=r,f=i,h=s,p=o,m=a,l!==void 0?(g=l,y=c):(g=f,y=h)):(p=n,m=r,i!==void 0&&(g=i,y=s)),!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(u))throw new TypeError("sx must be a number.");if(!Number.isFinite(d))throw new TypeError("sy must be a number.");if(!Number.isFinite(f)||f<0)throw new TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(h)||h<0)throw new TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(p))throw new TypeError("dx must be a number.");if(!Number.isFinite(m))throw new TypeError("dy must be a number.");if(!Number.isFinite(g)||g<0)throw new TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(y)||y<0)throw new TypeError("dHeight must be a non-negative number.");if(this._closed)throw new Error("VideoSample is closed.");({sx:u,sy:d,sWidth:f,sHeight:h}=this._rotateSourceRegion(u,d,f,h,this.rotation));const w=this.toCanvasImageSource();e.save();const k=p+g/2,C=m+y/2;e.translate(k,C),e.rotate(this.rotation*Math.PI/180);const A=this.rotation%180===0?1:g/y;e.scale(1/A,A),e.drawImage(w,u,d,f,h,-g/2,-y/2,g,y),e.restore()}drawWithFit(e,n){if(!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(!["fill","contain","cover"].includes(n.fit))throw new TypeError("options.fit must be 'fill', 'contain', or 'cover'.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180, or 270.");n.crop!==void 0&&gx(n.crop,"options.");const r=e.canvas.width,i=e.canvas.height,s=n.rotation??this.rotation,[o,a]=s%180===0?[this.codedWidth,this.codedHeight]:[this.codedHeight,this.codedWidth];n.crop&&mx(n.crop,o,a);let l,c,u,d;const{sx:f,sy:h,sWidth:p,sHeight:m}=this._rotateSourceRegion(n.crop?.left??0,n.crop?.top??0,n.crop?.width??o,n.crop?.height??a,s);if(n.fit==="fill")l=0,c=0,u=r,d=i;else{const[y,w]=n.crop?[n.crop.width,n.crop.height]:[o,a],k=n.fit==="contain"?Math.min(r/y,i/w):Math.max(r/y,i/w);u=y*k,d=w*k,l=(r-u)/2,c=(i-d)/2}const g=s%180===0?1:u/d;e.translate(r/2,i/2),e.rotate(s*Math.PI/180),e.scale(1/g,g),e.translate(-r/2,-i/2),e.drawImage(this.toCanvasImageSource(),f,h,p,m,l,c,u,d)}_rotateSourceRegion(e,n,r,i,s){return s===90?[e,n,r,i]=[n,this.codedHeight-e-r,i,r]:s===180?[e,n]=[this.codedWidth-e-r,this.codedHeight-n-i]:s===270&&([e,n,r,i]=[this.codedWidth-n-i,e,i,r]),{sx:e,sy:n,sWidth:r,sHeight:i}}toCanvasImageSource(){if(this._closed)throw new Error("VideoSample is closed.");if(K(this._data!==null),this._data instanceof Uint8Array){const e=this.toVideoFrame();return queueMicrotask(()=>e.close()),e}else return this._data}setRotation(e){if(![0,90,180,270].includes(e))throw new TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}setDuration(e){if(!Number.isFinite(e)||e<0)throw new TypeError("newDuration must be a non-negative number.");this.duration=e}[Symbol.dispose](){this.close()}}const Wd=t=>typeof VideoFrame<"u"&&t instanceof VideoFrame,mx=(t,e,n)=>{t.left=Math.min(t.left,e),t.top=Math.min(t.top,n),t.width=Math.min(t.width,e-t.left),t.height=Math.min(t.height,n-t.top),K(t.width>=0),K(t.height>=0)},gx=(t,e)=>{if(!t||typeof t!="object")throw new TypeError(e+"crop, when provided, must be an object.");if(!Number.isInteger(t.left)||t.left<0)throw new TypeError(e+"crop.left must be a non-negative integer.");if(!Number.isInteger(t.top)||t.top<0)throw new TypeError(e+"crop.top must be a non-negative integer.");if(!Number.isInteger(t.width)||t.width<0)throw new TypeError(e+"crop.width must be a non-negative integer.");if(!Number.isInteger(t.height)||t.height<0)throw new TypeError(e+"crop.height must be a non-negative integer.")},kb=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]);class xs{get microsecondTimestamp(){return Math.trunc(sl*this.timestamp)}get microsecondDuration(){return Math.trunc(sl*this.duration)}constructor(e){if(this._closed=!1,Kd(e)){if(e.format===null)throw new TypeError("AudioData with null format is not supported.");this._data=e,this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=e.numberOfFrames,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp/1e6,this.duration=e.numberOfFrames/e.sampleRate}else{if(!e||typeof e!="object")throw new TypeError("Invalid AudioDataInit: must be an object.");if(!kb.has(e.format))throw new TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(e.sampleRate)||e.sampleRate<=0)throw new TypeError("Invalid AudioDataInit: sampleRate must be > 0.");if(!Number.isInteger(e.numberOfChannels)||e.numberOfChannels===0)throw new TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(e?.timestamp))throw new TypeError("init.timestamp must be a number.");const n=e.data.byteLength/(qd(e.format)*e.numberOfChannels);if(!Number.isInteger(n))throw new TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=n,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp,this.duration=n/e.sampleRate;let r;if(e.data instanceof ArrayBuffer)r=new Uint8Array(e.data);else if(ArrayBuffer.isView(e.data))r=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);else throw new TypeError("Invalid AudioDataInit: data is not a BufferSource.");const i=this.numberOfFrames*this.numberOfChannels*qd(this.format);if(r.byteLength<i)throw new TypeError("Invalid AudioDataInit: insufficient data size.");this._data=r}}allocationSize(e){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(e.format!==void 0&&!kb.has(e.format))throw new TypeError("Invalid format.");if(e.frameOffset!==void 0&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(e.frameCount!==void 0&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const n=e.format??this.format,r=e.frameOffset??0;if(r>=this.numberOfFrames)throw new RangeError("frameOffset out of range");const i=e.frameCount!==void 0?e.frameCount:this.numberOfFrames-r;if(i>this.numberOfFrames-r)throw new RangeError("frameCount out of range");const s=qd(n),o=gp(n);if(o&&e.planeIndex>=this.numberOfChannels)throw new RangeError("planeIndex out of range");if(!o&&e.planeIndex!==0)throw new RangeError("planeIndex out of range");return(o?i:i*this.numberOfChannels)*s}copyTo(e,n){if(!T0(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(n.planeIndex)||n.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(n.format!==void 0&&!kb.has(n.format))throw new TypeError("Invalid format.");if(n.frameOffset!==void 0&&(!Number.isInteger(n.frameOffset)||n.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(n.frameCount!==void 0&&(!Number.isInteger(n.frameCount)||n.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const{planeIndex:r,format:i,frameCount:s,frameOffset:o}=n,a=i??this.format;if(!a)throw new Error("Destination format not determined");const l=this.numberOfFrames,c=this.numberOfChannels,u=o??0;if(u>=l)throw new RangeError("frameOffset out of range");const d=s!==void 0?s:l-u;if(d>l-u)throw new RangeError("frameCount out of range");const f=qd(a),h=gp(a);if(h&&r>=c)throw new RangeError("planeIndex out of range");if(!h&&r!==0)throw new RangeError("planeIndex out of range");const m=(h?d:d*c)*f;if(e.byteLength<m)throw new RangeError("Destination buffer is too small");const g=$r(e),y=_q(a);if(Kd(this._data))if(h)if(a==="f32-planar")this._data.copyTo(e,{planeIndex:r,frameOffset:u,frameCount:d,format:"f32-planar"});else{const w=new ArrayBuffer(d*4),k=new Float32Array(w);this._data.copyTo(k,{planeIndex:r,frameOffset:u,frameCount:d,format:"f32-planar"});const C=new DataView(w);for(let A=0;A<d;A++){const E=A*f,P=C.getFloat32(A*4,!0);y(g,E,P)}}else{const w=c,k=new Float32Array(d);for(let C=0;C<w;C++){this._data.copyTo(k,{planeIndex:C,frameOffset:u,frameCount:d,format:"f32-planar"});for(let A=0;A<d;A++){const P=(A*w+C)*f;y(g,P,k[A])}}}else{const w=this._data,k=new DataView(w.buffer,w.byteOffset,w.byteLength),C=this.format,A=Tq(C),E=qd(C),P=gp(C);for(let S=0;S<d;S++)if(h){const x=S*f;let _;P?_=(r*l+(S+u))*E:_=((S+u)*c+r)*E;const I=A(k,_);y(g,x,I)}else for(let x=0;x<c;x++){const I=(S*c+x)*f;let D;P?D=(x*l+(S+u))*E:D=((S+u)*c+x)*E;const B=A(k,D);y(g,I,B)}}}clone(){if(this._closed)throw new Error("AudioSample is closed.");if(Kd(this._data)){const e=new xs(this._data.clone());return e.setTimestamp(this.timestamp),e}else return new xs({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data})}close(){this._closed||(Kd(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}toAudioData(){if(this._closed)throw new Error("AudioSample is closed.");if(Kd(this._data)){if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(gp(this.format)){const e=this.allocationSize({planeIndex:0,format:this.format}),n=new ArrayBuffer(e*this.numberOfChannels);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(new Uint8Array(n,r*e,e),{planeIndex:r,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:n})}else{const e=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(e,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:e})}}else return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data})}toAudioBuffer(){if(this._closed)throw new Error("AudioSample is closed.");const e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),n=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(n,{planeIndex:r,format:"f32-planar"}),e.copyToChannel(n,r);return e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}[Symbol.dispose](){this.close()}static*_fromAudioBuffer(e,n){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const r=48e3*5,i=e.numberOfChannels,s=e.sampleRate,o=e.length,a=Math.floor(r/i);let l=0,c=o;for(;c>0;){const u=Math.min(a,c),d=new Float32Array(i*u);for(let f=0;f<i;f++)e.copyFromChannel(d.subarray(f*u,(f+1)*u),f,l);yield new xs({format:"f32-planar",sampleRate:s,numberOfFrames:u,numberOfChannels:i,timestamp:n+l/s,data:d}),l+=u,c-=u}}static fromAudioBuffer(e,n){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const r=48e3*5,i=e.numberOfChannels,s=e.sampleRate,o=e.length,a=Math.floor(r/i);let l=0,c=o;const u=[];for(;c>0;){const d=Math.min(a,c),f=new Float32Array(i*d);for(let p=0;p<i;p++)e.copyFromChannel(f.subarray(p*d,(p+1)*d),p,l);const h=new xs({format:"f32-planar",sampleRate:s,numberOfFrames:d,numberOfChannels:i,timestamp:n+l/s,data:f});u.push(h),l+=d,c-=d}return u}}const qd=t=>{switch(t){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":return 4;case"f32":case"f32-planar":return 4;default:throw new Error("Unknown AudioSampleFormat")}},gp=t=>{switch(t){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},Tq=t=>{switch(t){case"u8":case"u8-planar":return(e,n)=>(e.getUint8(n)-128)/128;case"s16":case"s16-planar":return(e,n)=>e.getInt16(n,!0)/32768;case"s32":case"s32-planar":return(e,n)=>e.getInt32(n,!0)/2147483648;case"f32":case"f32-planar":return(e,n)=>e.getFloat32(n,!0)}},_q=t=>{switch(t){case"u8":case"u8-planar":return(e,n,r)=>e.setUint8(n,pr((r+1)*127.5,0,255));case"s16":case"s16-planar":return(e,n,r)=>e.setInt16(n,pr(Math.round(r*32767),-32768,32767),!0);case"s32":case"s32-planar":return(e,n,r)=>e.setInt32(n,pr(Math.round(r*2147483647),-2147483648,2147483647),!0);case"f32":case"f32-planar":return(e,n,r)=>e.setFloat32(n,r,!0)}},Kd=t=>typeof AudioData<"u"&&t instanceof AudioData;/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const ru=t=>{if(!t||typeof t!="object")throw new TypeError("options must be an object.");if(t.metadataOnly!==void 0&&typeof t.metadataOnly!="boolean")throw new TypeError("options.metadataOnly, when defined, must be a boolean.");if(t.verifyKeyPackets!==void 0&&typeof t.verifyKeyPackets!="boolean")throw new TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(t.verifyKeyPackets&&t.metadataOnly)throw new TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},ml=t=>{if(!$4(t))throw new TypeError("timestamp must be a number.")},Tb=(t,e,n)=>n.verifyKeyPackets?e.then(async r=>{if(!r||r.type==="delta")return r;const i=await t.determinePacketType(r);return i&&(r.type=i),r}):e;class th{constructor(e){if(!(e instanceof bx))throw new TypeError("track must be an InputTrack.");this._track=e}getFirstPacket(e={}){if(ru(e),this._track.input._disposed)throw new Pi;return Tb(this._track,this._track._backing.getFirstPacket(e),e)}getPacket(e,n={}){if(ml(e),ru(n),this._track.input._disposed)throw new Pi;return Tb(this._track,this._track._backing.getPacket(e,n),n)}getNextPacket(e,n={}){if(!(e instanceof wn))throw new TypeError("packet must be an EncodedPacket.");if(ru(n),this._track.input._disposed)throw new Pi;return Tb(this._track,this._track._backing.getNextPacket(e,n),n)}async getKeyPacket(e,n={}){if(ml(e),ru(n),this._track.input._disposed)throw new Pi;if(!n.verifyKeyPackets)return this._track._backing.getKeyPacket(e,n);const r=await this._track._backing.getKeyPacket(e,n);return!r||r.type==="delta"?r:await this._track.determinePacketType(r)==="delta"?this.getKeyPacket(r.timestamp-1/this._track.timeResolution,n):r}async getNextKeyPacket(e,n={}){if(!(e instanceof wn))throw new TypeError("packet must be an EncodedPacket.");if(ru(n),this._track.input._disposed)throw new Pi;if(!n.verifyKeyPackets)return this._track._backing.getNextKeyPacket(e,n);const r=await this._track._backing.getNextKeyPacket(e,n);return!r||r.type==="delta"?r:await this._track.determinePacketType(r)==="delta"?this.getNextKeyPacket(r,n):r}packets(e,n,r={}){if(e!==void 0&&!(e instanceof wn))throw new TypeError("startPacket must be an EncodedPacket.");if(e!==void 0&&e.isMetadataOnly&&!r?.metadataOnly)throw new TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(n!==void 0&&!(n instanceof wn))throw new TypeError("endPacket must be an EncodedPacket.");if(ru(r),this._track.input._disposed)throw new Pi;const i=[];let{promise:s,resolve:o}=Rr(),{promise:a,resolve:l}=Rr(),c=!1,u=!1,d=null;const f=[],h=()=>Math.max(2,f.length);(async()=>{let m=e??await this.getFirstPacket(r);for(;m&&!u&&!this._track.input._disposed&&!(n&&m.sequenceNumber>=n?.sequenceNumber);){if(i.length>h()){({promise:a,resolve:l}=Rr()),await a;continue}i.push(m),o(),{promise:s,resolve:o}=Rr(),m=await this.getNextPacket(m,r)}c=!0,o()})().catch(m=>{d||(d=m,o())});const p=this._track;return{async next(){for(;;){if(p.input._disposed)throw new Pi;if(u)return{value:void 0,done:!0};if(d)throw d;if(i.length>0){const m=i.shift(),g=performance.now();for(f.push(g);f.length>0&&g-f[0]>=1e3;)f.shift();return l(),{value:m,done:!1}}else{if(c)return{value:void 0,done:!0};await s}}},async return(){return u=!0,l(),o(),{value:void 0,done:!0}},async throw(m){throw m},[Symbol.asyncIterator](){return this}}}}class yx{constructor(e,n){this.onSample=e,this.onError=n}}class rM{mediaSamplesInRange(e=0,n=1/0){ml(e),ml(n);const r=[];let i=!1,s=null,{promise:o,resolve:a}=Rr(),{promise:l,resolve:c}=Rr(),u=!1,d=!1,f=!1,h=null;(async()=>{const g=new Error,y=await this._createDecoder(P=>{if(c(),P.timestamp>=n&&(d=!0),d){P.close();return}s&&(P.timestamp>e?(r.push(s),i=!0):s.close()),P.timestamp>=e&&(r.push(P),i=!0),s=i?null:P,r.length>0&&(a(),{promise:o,resolve:a}=Rr())},P=>{h||(P.stack=g.stack,h=P,a())}),w=this._createPacketSink(),k=await w.getKeyPacket(e,{verifyKeyPackets:!0})??await w.getFirstPacket();if(!k)return;let C=k,A;if(n<1/0){const P=await w.getPacket(n),S=P?P.type==="key"&&P.timestamp===n?P:await w.getNextKeyPacket(P,{verifyKeyPackets:!0}):null;S&&(A=S)}const E=w.packets(k,A);for(await E.next();C&&!d&&!this._track.input._disposed;){const P=RT(r.length);if(r.length+y.getDecodeQueueSize()>P){({promise:l,resolve:c}=Rr()),await l;continue}y.decode(C);const S=await E.next();if(S.done)break;C=S.value}await E.return(),!f&&!this._track.input._disposed&&await y.flush(),y.close(),!i&&s&&r.push(s),u=!0,a()})().catch(g=>{h||(h=g,a())});const p=this._track,m=()=>{s?.close();for(const g of r)g.close()};return{async next(){for(;;){if(p.input._disposed)throw m(),new Pi;if(f)return{value:void 0,done:!0};if(h)throw m(),h;if(r.length>0){const g=r.shift();return c(),{value:g,done:!1}}else if(!u)await o;else return{value:void 0,done:!0}}},async return(){return f=!0,d=!0,c(),a(),m(),{value:void 0,done:!0}},async throw(g){throw g},[Symbol.asyncIterator](){return this}}}mediaSamplesAtTimestamps(e){FW(e);const n=$W(e),r=[],i=[];let{promise:s,resolve:o}=Rr(),{promise:a,resolve:l}=Rr(),c=!1,u=!1,d=null;const f=m=>{i.push(m),o(),{promise:s,resolve:o}=Rr()};(async()=>{const m=new Error,g=await this._createDecoder(P=>{if(l(),u){P.close();return}let S=0;for(;r.length>0&&P.timestamp-r[0]>-1e-10;)S++,r.shift();if(S>0)for(let x=0;x<S;x++)f(x<S-1?P.clone():P);else P.close()},P=>{d||(P.stack=m.stack,d=P,o())}),y=this._createPacketSink();let w=null,k=null,C=-1;const A=async()=>{K(k);let P=k;for(g.decode(P);P.sequenceNumber<C;){const S=RT(i.length);for(;i.length+g.getDecodeQueueSize()>S&&!u;)({promise:a,resolve:l}=Rr()),await a;if(u)break;const x=await y.getNextPacket(P);K(x),g.decode(x),P=x}C=-1},E=async()=>{await g.flush();for(let P=0;P<r.length;P++)f(null);r.length=0};for await(const P of n){if(ml(P),u||this._track.input._disposed)break;const S=await y.getPacket(P),x=S&&await y.getKeyPacket(P,{verifyKeyPackets:!0});if(!x){C!==-1&&(await A(),await E()),f(null),w=null;continue}w&&(x.sequenceNumber!==k.sequenceNumber||S.timestamp<w.timestamp)&&(await A(),await E()),r.push(S.timestamp),C=Math.max(S.sequenceNumber,C),w=S,k=x}!u&&!this._track.input._disposed&&(C!==-1&&await A(),await E()),g.close(),c=!0,o()})().catch(m=>{d||(d=m,o())});const h=this._track,p=()=>{for(const m of i)m?.close()};return{async next(){for(;;){if(h.input._disposed)throw p(),new Pi;if(u)return{value:void 0,done:!0};if(d)throw p(),d;if(i.length>0){const m=i.shift();return K(m!==void 0),l(),{value:m,done:!1}}else if(!c)await s;else return{value:void 0,done:!0}}},async return(){return u=!0,l(),o(),p(),{value:void 0,done:!0}},async throw(m){throw m},[Symbol.asyncIterator](){return this}}}}const RT=t=>t===0?40:8;class Cq extends yx{constructor(e,n,r,i,s,o){super(e,n),this.codec=r,this.decoderConfig=i,this.rotation=s,this.timeResolution=o,this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new C0,this.customDecoderQueueSize=0,this.inputTimestamps=[],this.sampleQueue=[],this.currentPacketIndex=0,this.raslSkipped=!1,this.alphaDecoder=null,this.alphaHadKeyframe=!1,this.colorQueue=[],this.alphaQueue=[],this.merger=null,this.mergerCreationFailed=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue=[],this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1;const a=tM.find(l=>l.supports(r,i));if(a)this.customDecoder=new a,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=l=>{if(!(l instanceof Gr))throw new TypeError("The argument passed to onSample must be a VideoSample.");this.finalizeAndEmitSample(l)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const l=c=>{if(this.alphaQueue.length>0){const u=this.alphaQueue.shift();K(u!==void 0),this.mergeAlpha(c,u)}else this.colorQueue.push(c)};this.decoder=new VideoDecoder({output:c=>{try{l(c)}catch(u){this.onError(u)}},error:n}),this.decoder.configure(i)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(K(this.decoder),Math.max(this.decoder.decodeQueueSize,this.alphaDecoder?.decodeQueueSize??0))}decode(e){if(this.codec==="hevc"&&this.currentPacketIndex>0&&!this.raslSkipped){if(this.hasHevcRaslPicture(e.data))return;this.raslSkipped=!0}this.currentPacketIndex++,this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(K(this.decoder),Sb()||TT(this.inputTimestamps,e.timestamp,n=>n),this.decoder.decode(e.toEncodedVideoChunk()),this.decodeAlphaData(e))}decodeAlphaData(e){if(!e.sideData.alpha||this.mergerCreationFailed){this.pushNullAlphaFrame();return}if(!this.merger)try{this.merger=new Aq}catch(r){console.error("Due to an error, only color data will be decoded.",r),this.mergerCreationFailed=!0,this.decodeAlphaData(e);return}if(!this.alphaDecoder){const r=i=>{if(this.alphaDecoderQueueSize--,this.colorQueue.length>0){const s=this.colorQueue.shift();K(s!==void 0),this.mergeAlpha(s,i)}else this.alphaQueue.push(i);for(this.decodedAlphaChunkCount++;this.nullAlphaFrameQueue.length>0&&this.nullAlphaFrameQueue[0]===this.decodedAlphaChunkCount;)if(this.nullAlphaFrameQueue.shift(),this.colorQueue.length>0){const s=this.colorQueue.shift();K(s!==void 0),this.mergeAlpha(s,null)}else this.alphaQueue.push(null)};this.alphaDecoder=new VideoDecoder({output:i=>{try{r(i)}catch(s){this.onError(s)}},error:this.onError}),this.alphaDecoder.configure(this.decoderConfig)}const n=eM(this.codec,this.decoderConfig,e.sideData.alpha);if(this.alphaHadKeyframe||(this.alphaHadKeyframe=n==="key"),this.alphaHadKeyframe){if(this.codec==="hevc"&&this.currentAlphaPacketIndex>0&&!this.alphaRaslSkipped){if(this.hasHevcRaslPicture(e.sideData.alpha)){this.pushNullAlphaFrame();return}this.alphaRaslSkipped=!0}this.currentAlphaPacketIndex++,this.alphaDecoder.decode(e.alphaToEncodedVideoChunk(n??e.type)),this.alphaDecoderQueueSize++}else this.pushNullAlphaFrame()}pushNullAlphaFrame(){this.alphaDecoderQueueSize===0?this.alphaQueue.push(null):this.nullAlphaFrameQueue.push(this.decodedAlphaChunkCount+this.alphaDecoderQueueSize)}hasHevcRaslPicture(e){return G4(e,this.decoderConfig).some(r=>{const i=Va(r);return i===ci.RASL_N||i===ci.RASL_R})}sampleHandler(e){if(Sb()){if(this.sampleQueue.length>0&&e.timestamp>=Qn(this.sampleQueue).timestamp){for(const n of this.sampleQueue)this.finalizeAndEmitSample(n);this.sampleQueue.length=0}TT(this.sampleQueue,e,n=>n.timestamp)}else{const n=this.inputTimestamps.shift();K(n!==void 0),e.setTimestamp(n),this.finalizeAndEmitSample(e)}}finalizeAndEmitSample(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}mergeAlpha(e,n){if(!n){const s=new Gr(e);this.sampleHandler(s);return}K(this.merger),this.merger.update(e,n),e.close(),n.close();const r=new VideoFrame(this.merger.canvas,{timestamp:e.timestamp,duration:e.duration??void 0}),i=new Gr(r);this.sampleHandler(i)}async flush(){if(this.customDecoder?await this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(K(this.decoder),await Promise.all([this.decoder.flush(),this.alphaDecoder?.flush()]),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.alphaHadKeyframe=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue.length=0,this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1),Sb()){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}this.currentPacketIndex=0,this.raslSkipped=!1}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(K(this.decoder),this.decoder.close(),this.alphaDecoder?.close(),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.merger?.close());for(const e of this.sampleQueue)e.close();this.sampleQueue.length=0}}class Aq{constructor(){typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(300,150):this.canvas=document.createElement("canvas");const e=this.canvas.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=e,this.program=this.createProgram(),this.vao=this.createVAO(),this.colorTexture=this.createTexture(),this.alphaTexture=this.createTexture(),this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_colorTexture"),0),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_alphaTexture"),1)}createProgram(){const e=this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_colorTexture;
			uniform sampler2D u_alphaTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec3 color = texture(u_colorTexture, v_texCoord).rgb;
				float alpha = texture(u_alphaTexture, v_texCoord).r;
				fragColor = vec4(color, alpha);
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createShader(e,n){const r=this.gl.createShader(e);return this.gl.shaderSource(r,n),this.gl.compileShader(r),r}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const n=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(this.program,"a_position"),s=this.gl.getAttribLocation(this.program,"a_texCoord");return this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}update(e,n){(e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.alphaTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class zv extends rM{constructor(e){if(!(e instanceof Uh))throw new TypeError("videoTrack must be an InputVideoTrack.");super(),this._track=e}async _createDecoder(e,n){if(!await this._track.canDecode())throw new Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._track.codec,i=this._track.rotation,s=await this._track.getDecoderConfig(),o=this._track.timeResolution;return K(r&&s),new Cq(e,n,r,s,i,o)}_createPacketSink(){return new th(this._track)}async getSample(e){ml(e);for await(const n of this.mediaSamplesAtTimestamps([e]))return n;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,n=1/0){return this.mediaSamplesInRange(e,n)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class Iq{constructor(e,n={}){if(this._nextCanvasIndex=0,!(e instanceof Uh))throw new TypeError("videoTrack must be an InputVideoTrack.");if(n&&typeof n!="object")throw new TypeError("options must be an object.");if(n.alpha!==void 0&&typeof n.alpha!="boolean")throw new TypeError("options.alpha, when provided, must be a boolean.");if(n.width!==void 0&&(!Number.isInteger(n.width)||n.width<=0))throw new TypeError("options.width, when defined, must be a positive integer.");if(n.height!==void 0&&(!Number.isInteger(n.height)||n.height<=0))throw new TypeError("options.height, when defined, must be a positive integer.");if(n.fit!==void 0&&!["fill","contain","cover"].includes(n.fit))throw new TypeError('options.fit, when provided, must be one of "fill", "contain", or "cover".');if(n.width!==void 0&&n.height!==void 0&&n.fit===void 0)throw new TypeError("When both options.width and options.height are provided, options.fit must also be provided.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180 or 270.");if(n.crop!==void 0&&gx(n.crop,"options."),n.poolSize!==void 0&&(typeof n.poolSize!="number"||!Number.isInteger(n.poolSize)||n.poolSize<0))throw new TypeError("poolSize must be a non-negative integer.");const r=n.rotation??e.rotation,[i,s]=r%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],o=n.crop;o&&mx(o,i,s);let[a,l]=o?[o.width,o.height]:[i,s];const c=a/l;n.width!==void 0&&n.height===void 0?(a=n.width,l=Math.round(a/c)):n.width===void 0&&n.height!==void 0?(l=n.height,a=Math.round(l*c)):n.width!==void 0&&n.height!==void 0&&(a=n.width,l=n.height),this._videoTrack=e,this._alpha=n.alpha??!1,this._width=a,this._height=l,this._rotation=r,this._crop=o,this._fit=n.fit??"fill",this._videoSampleSink=new zv(e),this._canvasPool=Array.from({length:n.poolSize??0},()=>null)}_videoSampleToWrappedCanvas(e){let n=this._canvasPool[this._nextCanvasIndex],r=!1;n||(typeof document<"u"?(n=document.createElement("canvas"),n.width=this._width,n.height=this._height):n=new OffscreenCanvas(this._width,this._height),this._canvasPool.length>0&&(this._canvasPool[this._nextCanvasIndex]=n),r=!0),this._canvasPool.length>0&&(this._nextCanvasIndex=(this._nextCanvasIndex+1)%this._canvasPool.length);const i=n.getContext("2d",{alpha:this._alpha||eh()});K(i),i.resetTransform(),r||(!this._alpha&&eh()?(i.fillStyle="black",i.fillRect(0,0,this._width,this._height)):i.clearRect(0,0,this._width,this._height)),e.drawWithFit(i,{fit:this._fit,rotation:this._rotation,crop:this._crop});const s={canvas:n,timestamp:e.timestamp,duration:e.duration};return e.close(),s}async getCanvas(e){ml(e);const n=await this._videoSampleSink.getSample(e);return n&&this._videoSampleToWrappedCanvas(n)}canvases(e=0,n=1/0){return _T(this._videoSampleSink.samples(e,n),r=>this._videoSampleToWrappedCanvas(r))}canvasesAtTimestamps(e){return _T(this._videoSampleSink.samplesAtTimestamps(e),n=>n&&this._videoSampleToWrappedCanvas(n))}}class Pq extends yx{constructor(e,n,r,i){super(e,n),this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new C0,this.customDecoderQueueSize=0,this.currentTimestamp=null;const s=a=>{(this.currentTimestamp===null||Math.abs(a.timestamp-this.currentTimestamp)>=a.duration)&&(this.currentTimestamp=a.timestamp);const l=this.currentTimestamp;if(this.currentTimestamp+=a.duration,a.numberOfFrames===0){a.close();return}const c=i.sampleRate;a.setTimestamp(Math.round(l*c)/c),e(a)},o=nM.find(a=>a.supports(r,i));o?(this.customDecoder=new o,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=a=>{if(!(a instanceof xs))throw new TypeError("The argument passed to onSample must be an AudioSample.");s(a)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init())):(this.decoder=new AudioDecoder({output:a=>{try{s(new xs(a))}catch(l){this.onError(l)}},error:n}),this.decoder.configure(i))}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(K(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(K(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}flush(){return this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(K(this.decoder),this.decoder.flush())}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(K(this.decoder),this.decoder.close())}}class Mq extends yx{constructor(e,n,r){super(e,n),this.decoderConfig=r,this.currentTimestamp=null,K(Zr.includes(r.codec)),this.codec=r.codec;const{dataType:i,sampleSize:s,littleEndian:o}=$l(this.codec);switch(this.inputSampleSize=s,s){case 1:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint8(l)-2**7:i==="signed"?this.readInputValue=(a,l)=>a.getInt8(l):i==="ulaw"?this.readInputValue=(a,l)=>Sq(a.getUint8(l)):i==="alaw"?this.readInputValue=(a,l)=>kq(a.getUint8(l)):K(!1);break;case 2:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint16(l,o)-2**15:i==="signed"?this.readInputValue=(a,l)=>a.getInt16(l,o):K(!1);break;case 3:i==="unsigned"?this.readInputValue=(a,l)=>_0(a,l,o)-2**23:i==="signed"?this.readInputValue=(a,l)=>zW(a,l,o):K(!1);break;case 4:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint32(l,o)-2**31:i==="signed"?this.readInputValue=(a,l)=>a.getInt32(l,o):i==="float"?this.readInputValue=(a,l)=>a.getFloat32(l,o):K(!1);break;case 8:i==="float"?this.readInputValue=(a,l)=>a.getFloat64(l,o):K(!1);break;default:Al(s),K(!1)}switch(s){case 1:i==="ulaw"||i==="alaw"?(this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(a,l,c)=>a.setInt16(l,c,!0)):(this.outputSampleSize=1,this.outputFormat="u8",this.writeOutputValue=(a,l,c)=>a.setUint8(l,c+2**7));break;case 2:this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(a,l,c)=>a.setInt16(l,c,!0);break;case 3:this.outputSampleSize=4,this.outputFormat="s32",this.writeOutputValue=(a,l,c)=>a.setInt32(l,c<<8,!0);break;case 4:this.outputSampleSize=4,i==="float"?(this.outputFormat="f32",this.writeOutputValue=(a,l,c)=>a.setFloat32(l,c,!0)):(this.outputFormat="s32",this.writeOutputValue=(a,l,c)=>a.setInt32(l,c,!0));break;case 8:this.outputSampleSize=4,this.outputFormat="f32",this.writeOutputValue=(a,l,c)=>a.setFloat32(l,c,!0);break;default:Al(s),K(!1)}}getDecodeQueueSize(){return 0}decode(e){const n=$r(e.data),r=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,i=r*this.decoderConfig.numberOfChannels*this.outputSampleSize,s=new ArrayBuffer(i),o=new DataView(s);for(let u=0;u<r*this.decoderConfig.numberOfChannels;u++){const d=u*this.inputSampleSize,f=u*this.outputSampleSize,h=this.readInputValue(n,d);this.writeOutputValue(o,f,h)}const a=r/this.decoderConfig.sampleRate;(this.currentTimestamp===null||Math.abs(e.timestamp-this.currentTimestamp)>=a)&&(this.currentTimestamp=e.timestamp);const l=this.currentTimestamp;this.currentTimestamp+=a;const c=new xs({format:this.outputFormat,data:s,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:r,timestamp:l});this.onSample(c)}async flush(){}close(){}}class LT extends rM{constructor(e){if(!(e instanceof ma))throw new TypeError("audioTrack must be an InputAudioTrack.");super(),this._track=e}async _createDecoder(e,n){if(!await this._track.canDecode())throw new Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._track.codec,i=await this._track.getDecoderConfig();return K(r&&i),Zr.includes(i.codec)?new Mq(e,n,i):new Pq(e,n,r,i)}_createPacketSink(){return new th(this._track)}async getSample(e){ml(e);for await(const n of this.mediaSamplesAtTimestamps([e]))return n;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,n=1/0){return this.mediaSamplesInRange(e,n)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class bx{constructor(e,n){this.input=e,this._backing=n}isVideoTrack(){return this instanceof Uh}isAudioTrack(){return this instanceof ma}get id(){return this._backing.getId()}get internalCodecId(){return this._backing.getInternalCodecId()}get languageCode(){return this._backing.getLanguageCode()}get name(){return this._backing.getName()}get timeResolution(){return this._backing.getTimeResolution()}getFirstTimestamp(){return this._backing.getFirstTimestamp()}computeDuration(){return this._backing.computeDuration()}async computePacketStats(e=1/0){const n=new th(this);let r=1/0,i=-1/0,s=0,o=0;for await(const a of n.packets(void 0,void 0,{metadataOnly:!0})){if(s>=e&&a.timestamp>=i)break;r=Math.min(r,a.timestamp),i=Math.max(i,a.timestamp+a.duration),s++,o+=a.byteLength}return{packetCount:s,averagePacketRate:s?Number((s/(i-r)).toPrecision(16)):0,averageBitrate:s?Number((8*o/(i-r)).toPrecision(16)):0}}}class Uh extends bx{constructor(e,n){super(e,n),this._backing=n}get type(){return"video"}get codec(){return this._backing.getCodec()}get codedWidth(){return this._backing.getCodedWidth()}get codedHeight(){return this._backing.getCodedHeight()}get rotation(){return this._backing.getRotation()}get displayWidth(){return this._backing.getRotation()%180===0?this._backing.getCodedWidth():this._backing.getCodedHeight()}get displayHeight(){return this._backing.getRotation()%180===0?this._backing.getCodedHeight():this._backing.getCodedWidth()}getColorSpace(){return this._backing.getColorSpace()}async hasHighDynamicRange(){const e=await this._backing.getColorSpace();return e.primaries==="bt2020"||e.primaries==="smpte432"||e.transfer==="pg"||e.transfer==="hlg"||e.matrix==="bt2020-ncl"}canBeTransparent(){return this._backing.canBeTransparent()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const n=this._backing.getCodec();return K(n!==null),tM.some(i=>i.supports(n,e))?!0:typeof VideoDecoder>"u"?!1:(await VideoDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof wn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("packet must not be metadata-only to determine its type.");if(this.codec===null)return null;const n=await this.getDecoderConfig();return K(n),eM(this.codec,n,e.data)}}class ma extends bx{constructor(e,n){super(e,n),this._backing=n}get type(){return"audio"}get codec(){return this._backing.getCodec()}get numberOfChannels(){return this._backing.getNumberOfChannels()}get sampleRate(){return this._backing.getSampleRate()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const n=this._backing.getCodec();return K(n!==null),nM.some(r=>r.supports(n,e))||e.codec.startsWith("pcm-")?!0:typeof AudioDecoder>"u"?!1:(await AudioDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof wn))throw new TypeError("packet must be an EncodedPacket.");return this.codec===null?null:"key"}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const iM=t=>{let n=(t.hasVideo?"video/":t.hasAudio?"audio/":"application/")+(t.isQuickTime?"quicktime":"mp4");if(t.codecStrings.length>0){const r=[...new Set(t.codecStrings)];n+=`; codecs="${r.join(", ")}"`}return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const zo=8,ic=16,ja=t=>{let e=He(t);const n=Sr(t,4);let r=8;e===1&&(e=ps(t),r=16);const s=e-r;return s<0?null:{name:n,totalSize:e,headerSize:r,contentSize:s}},Kl=t=>oc(t)/65536,_b=t=>oc(t)/1073741824,Cb=t=>{let e=0;for(let n=0;n<4;n++){e<<=7;const r=lt(t);if(e|=r&127,(r&128)===0)break}return e},Ds=t=>{let e=Ir(t);return t.skip(2),e=Math.min(e,t.remainingLength),Ji.decode(xt(t,e))},Oq=t=>{const e=ja(t);if(!e||e.name!=="data"||t.remainingLength<8)return null;const n=He(t);t.skip(4);const r=xt(t,e.contentSize-8);switch(n){case 1:return Ji.decode(r);case 2:return new TextDecoder("utf-16be").decode(r);case 13:return new Ru(r,"image/jpeg");case 14:return new Ru(r,"image/png");case 27:return new Ru(r,"image/bmp");default:return r}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Nq extends Vc{constructor(e){super(e),this.moovSlice=null,this.currentTrack=null,this.tracks=[],this.metadataPromise=null,this.movieTimescale=-1,this.movieDurationInTimescale=-1,this.isQuickTime=!1,this.metadataTags={},this.currentMetadataKeys=null,this.isFragmented=!1,this.fragmentTrackDefaults=[],this.currentFragment=null,this.lastReadFragment=null,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getTracks(){return await this.readMetadata(),this.tracks.map(e=>e.inputTrack)}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(n=>n.inputTrack.getCodecParameterString()));return iM({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some(n=>n.info?.type==="video"),hasAudio:this.tracks.some(n=>n.info?.type==="audio"),codecStrings:e.filter(Boolean)})}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,zo,ic);if(n instanceof Promise&&(n=await n),!n)break;const r=e,i=ja(n);if(!i)break;if(i.name==="ftyp"){const s=Sr(n,4);this.isQuickTime=s==="qt  "}else if(i.name==="moov"){let s=this.reader.requestSlice(n.filePos,i.contentSize);if(s instanceof Promise&&(s=await s),!s)break;this.moovSlice=s,this.readContiguousBoxes(this.moovSlice);for(const o of this.tracks){const a=o.editListPreviousSegmentDurations/this.movieTimescale;o.editListOffset-=Math.round(a*o.timescale)}break}e=r+i.totalSize}if(this.isFragmented&&this.reader.fileSize!==null){let n=this.reader.requestSlice(this.reader.fileSize-4,4);n instanceof Promise&&(n=await n),K(n);const r=He(n),i=this.reader.fileSize-r;if(i>=0&&i<=this.reader.fileSize-ic){let s=this.reader.requestSliceRange(i,zo,ic);if(s instanceof Promise&&(s=await s),s){const o=ja(s);if(o&&o.name==="mfra"){let a=this.reader.requestSlice(s.filePos,o.contentSize);a instanceof Promise&&(a=await a),a&&this.readContiguousBoxes(a)}}}}})()}getSampleTableForTrack(e){if(e.sampleTable)return e.sampleTable;const n={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};e.sampleTable=n,K(this.moovSlice);const r=this.moovSlice.slice(e.sampleTableByteOffset);if(this.currentTrack=e,this.traverseBox(r),this.currentTrack=null,e.info?.type==="audio"&&e.info.codec&&Zr.includes(e.info.codec)&&n.sampleCompositionTimeOffsets.length===0){K(e.info?.type==="audio");const s=$l(e.info.codec),o=[],a=[];for(let l=0;l<n.sampleToChunk.length;l++){const c=n.sampleToChunk[l],u=n.sampleToChunk[l+1],d=(u?u.startChunkIndex:n.chunkOffsets.length)-c.startChunkIndex;for(let f=0;f<d;f++){const h=c.startSampleIndex+f*c.samplesPerChunk,p=h+c.samplesPerChunk,m=cn(n.sampleTimingEntries,h,S=>S.startIndex),g=n.sampleTimingEntries[m],y=cn(n.sampleTimingEntries,p,S=>S.startIndex),w=n.sampleTimingEntries[y],k=g.startDecodeTimestamp+(h-g.startIndex)*g.delta,A=w.startDecodeTimestamp+(p-w.startIndex)*w.delta-k,E=Qn(o);E&&E.delta===A?E.count++:o.push({startIndex:c.startChunkIndex+f,startDecodeTimestamp:k,count:1,delta:A});const P=c.samplesPerChunk*s.sampleSize*e.info.numberOfChannels;a.push(P)}c.startSampleIndex=c.startChunkIndex,c.samplesPerChunk=1}n.sampleTimingEntries=o,n.sampleSizes=a}if(n.sampleCompositionTimeOffsets.length>0){n.presentationTimestamps=[];for(const s of n.sampleTimingEntries)for(let o=0;o<s.count;o++)n.presentationTimestamps.push({presentationTimestamp:s.startDecodeTimestamp+o*s.delta,sampleIndex:s.startIndex+o});for(const s of n.sampleCompositionTimeOffsets)for(let o=0;o<s.count;o++){const a=s.startIndex+o,l=n.presentationTimestamps[a];l&&(l.presentationTimestamp+=s.offset)}n.presentationTimestamps.sort((s,o)=>s.presentationTimestamp-o.presentationTimestamp),n.presentationTimestampIndexMap=Array(n.presentationTimestamps.length).fill(-1);for(let s=0;s<n.presentationTimestamps.length;s++)n.presentationTimestampIndexMap[n.presentationTimestamps[s].sampleIndex]=s}return n}async readFragment(e){if(this.lastReadFragment?.moofOffset===e)return this.lastReadFragment;let n=this.reader.requestSliceRange(e,zo,ic);n instanceof Promise&&(n=await n),K(n);const r=ja(n);K(r?.name==="moof");let i=this.reader.requestSlice(e,r.totalSize);i instanceof Promise&&(i=await i),K(i),this.traverseBox(i);const s=this.lastReadFragment;K(s&&s.moofOffset===e);for(const[,o]of s.trackData){const a=o.track,{fragmentPositionCache:l}=a;if(!o.startTimestampIsFinal){const u=a.fragmentLookupTable.find(d=>d.moofOffset===s.moofOffset);if(u)Ab(o,u.timestamp);else{const d=cn(l,s.moofOffset-1,f=>f.moofOffset);if(d!==-1){const f=l[d];Ab(o,f.endTimestamp)}}o.startTimestampIsFinal=!0}const c=cn(l,o.startTimestamp,u=>u.startTimestamp);(c===-1||l[c].moofOffset!==s.moofOffset)&&l.splice(c+1,0,{moofOffset:s.moofOffset,startTimestamp:o.startTimestamp,endTimestamp:o.endTimestamp})}return s}readContiguousBoxes(e){const n=e.filePos;for(;e.filePos-n<=e.length-zo&&this.traverseBox(e););}*iterateContiguousBoxes(e){const n=e.filePos;for(;e.filePos-n<=e.length-zo;){const r=e.filePos,i=ja(e);if(!i)break;yield{boxInfo:i,slice:e},e.filePos=r+i.totalSize}}traverseBox(e){const n=e.filePos,r=ja(e);if(!r)return!1;const i=e.filePos,s=n+r.totalSize;switch(r.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"mvhd":{const o=lt(e);e.skip(3),o===1?(e.skip(16),this.movieTimescale=He(e),this.movieDurationInTimescale=ps(e)):(e.skip(8),this.movieTimescale=He(e),this.movieDurationInTimescale=He(e))}break;case"trak":{const o={id:-1,demuxer:this,inputTrack:null,info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,internalCodecId:null,name:null,languageCode:Xi,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:[],currentFragmentState:null,fragmentPositionCache:[],editListPreviousSegmentDurations:0,editListOffset:0};if(this.currentTrack=o,this.readContiguousBoxes(e.slice(i,r.contentSize)),o.id!==-1&&o.timescale!==-1&&o.info!==null){if(o.info.type==="video"&&o.info.width!==-1){const a=o;o.inputTrack=new Uh(this.input,new Rq(a)),this.tracks.push(o)}else if(o.info.type==="audio"&&o.info.numberOfChannels!==-1){const a=o;o.inputTrack=new ma(this.input,new Lq(a)),this.tracks.push(o)}}this.currentTrack=null}break;case"tkhd":{const o=this.currentTrack;if(!o)break;const a=lt(e);if(!((fu(e)&1)!==0))break;if(a===0)e.skip(8),o.id=He(e),e.skip(4),o.durationInMovieTimescale=He(e);else if(a===1)e.skip(16),o.id=He(e),e.skip(4),o.durationInMovieTimescale=ps(e);else throw new Error(`Incorrect track header version ${a}.`);e.skip(16);const u=[Kl(e),Kl(e),_b(e),Kl(e),Kl(e),_b(e),Kl(e),Kl(e),_b(e)],d=fx(HW(Fq(u),90));K(d===0||d===90||d===180||d===270),o.rotation=d}break;case"elst":{const o=this.currentTrack;if(!o)break;const a=lt(e);e.skip(3);let l=!1,c=0;const u=He(e);for(let d=0;d<u;d++){const f=a===1?ps(e):He(e),h=a===1?qK(e):oc(e),p=Kl(e);if(f!==0){if(l){console.warn("Unsupported edit list: multiple edits are not currently supported. Only using first edit.");break}if(h===-1){c+=f;continue}if(p!==1){console.warn("Unsupported edit list entry: media rate must be 1.");break}o.editListPreviousSegmentDurations=c,o.editListOffset=h,l=!0}}}break;case"mdhd":{const o=this.currentTrack;if(!o)break;const a=lt(e);e.skip(3),a===0?(e.skip(8),o.timescale=He(e),o.durationInMediaTimescale=He(e)):a===1&&(e.skip(16),o.timescale=He(e),o.durationInMediaTimescale=ps(e));let l=Ir(e);if(l>0){o.languageCode="";for(let c=0;c<3;c++)o.languageCode=String.fromCharCode(96+(l&31))+o.languageCode,l>>=5;Jf(o.languageCode)||(o.languageCode=Xi)}}break;case"hdlr":{const o=this.currentTrack;if(!o)break;e.skip(8);const a=Sr(e,4);a==="vide"?o.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:a==="soun"&&(o.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case"stbl":{const o=this.currentTrack;if(!o)break;o.sampleTableByteOffset=n,this.readContiguousBoxes(e.slice(i,r.contentSize))}break;case"stsd":{const o=this.currentTrack;if(!o||o.info===null||o.sampleTable)break;const a=lt(e);e.skip(3);const l=He(e);for(let c=0;c<l;c++){const u=e.filePos,d=ja(e);if(!d)break;o.internalCodecId=d.name;const f=d.name.toLowerCase();if(o.info.type==="video")f==="avc1"?o.info.codec="avc":f==="hvc1"||f==="hev1"?o.info.codec="hevc":f==="vp08"?o.info.codec="vp8":f==="vp09"?o.info.codec="vp9":f==="av01"?o.info.codec="av1":console.warn(`Unsupported video codec (sample entry type '${d.name}').`),e.skip(24),o.info.width=Ir(e),o.info.height=Ir(e),e.skip(50),this.readContiguousBoxes(e.slice(e.filePos,u+d.totalSize-e.filePos));else{f==="mp4a"||(f==="opus"?o.info.codec="opus":f==="flac"?o.info.codec="flac":f==="twos"||f==="sowt"||f==="raw "||f==="in24"||f==="in32"||f==="fl32"||f==="fl64"||f==="lpcm"||f==="ipcm"||f==="fpcm"||(f==="ulaw"?o.info.codec="ulaw":f==="alaw"?o.info.codec="alaw":console.warn(`Unsupported audio codec (sample entry type '${d.name}').`))),e.skip(8);const h=Ir(e);e.skip(6);let p=Ir(e),m=Ir(e);e.skip(4);let g=He(e)/65536;if(a===0&&h>0){if(h===1)e.skip(4),m=8*He(e),e.skip(8);else if(h===2){e.skip(4),g=bM(e),p=He(e),e.skip(4),m=He(e);const y=He(e);if(e.skip(8),f==="lpcm"){const w=m+7>>3,k=!!(y&1),C=!!(y&2),A=y&4?-1:0;m>0&&m<=64&&(k?m===32&&(o.info.codec=C?"pcm-f32be":"pcm-f32"):A&1<<w-1?w===1?o.info.codec="pcm-s8":w===2?o.info.codec=C?"pcm-s16be":"pcm-s16":w===3?o.info.codec=C?"pcm-s24be":"pcm-s24":w===4&&(o.info.codec=C?"pcm-s32be":"pcm-s32"):w===1&&(o.info.codec="pcm-u8")),o.info.codec===null&&console.warn("Unsupported PCM format.")}}}o.info.codec==="opus"&&(g=A0),o.info.numberOfChannels=p,o.info.sampleRate=g,f==="twos"?m===8?o.info.codec="pcm-s8":m===16?o.info.codec="pcm-s16be":(console.warn(`Unsupported sample size ${m} for codec 'twos'.`),o.info.codec=null):f==="sowt"?m===8?o.info.codec="pcm-s8":m===16?o.info.codec="pcm-s16":(console.warn(`Unsupported sample size ${m} for codec 'sowt'.`),o.info.codec=null):f==="raw "?o.info.codec="pcm-u8":f==="in24"?o.info.codec="pcm-s24be":f==="in32"?o.info.codec="pcm-s32be":f==="fl32"?o.info.codec="pcm-f32be":f==="fl64"?o.info.codec="pcm-f64be":f==="ipcm"?o.info.codec="pcm-s16be":f==="fpcm"&&(o.info.codec="pcm-f32be"),this.readContiguousBoxes(e.slice(e.filePos,u+d.totalSize-e.filePos))}}}break;case"avcC":{const o=this.currentTrack;if(!o)break;K(o.info),o.info.codecDescription=xt(e,r.contentSize)}break;case"hvcC":{const o=this.currentTrack;if(!o)break;K(o.info),o.info.codecDescription=xt(e,r.contentSize)}break;case"vpcC":{const o=this.currentTrack;if(!o)break;K(o.info?.type==="video"),e.skip(4);const a=lt(e),l=lt(e),c=lt(e),u=c>>4,d=c>>1&7,f=c&1,h=lt(e),p=lt(e),m=lt(e);o.info.vp9CodecInfo={profile:a,level:l,bitDepth:u,chromaSubsampling:d,videoFullRangeFlag:f,colourPrimaries:h,transferCharacteristics:p,matrixCoefficients:m}}break;case"av1C":{const o=this.currentTrack;if(!o)break;K(o.info?.type==="video"),e.skip(1);const a=lt(e),l=a>>5,c=a&31,u=lt(e),d=u>>7,f=u>>6&1,h=u>>5&1,p=u>>4&1,m=u>>3&1,g=u>>2&1,y=u&3,w=l===2&&f?h?12:10:f?10:8;o.info.av1CodecInfo={profile:l,level:c,tier:d,bitDepth:w,monochrome:p,chromaSubsamplingX:m,chromaSubsamplingY:g,chromaSamplePosition:y}}break;case"colr":{const o=this.currentTrack;if(!o||(K(o.info?.type==="video"),Sr(e,4)!=="nclx"))break;const l=Ir(e),c=Ir(e),u=Ir(e),d=!!(lt(e)&128);o.info.colorSpace={primaries:P4[l],transfer:M4[c],matrix:O4[u],fullRange:d}}break;case"wave":this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"esds":{const o=this.currentTrack;if(!o)break;K(o.info?.type==="audio"),e.skip(4);const a=lt(e);K(a===3),Cb(e),e.skip(2);const l=lt(e),c=(l&128)!==0,u=(l&64)!==0,d=(l&32)!==0;if(c&&e.skip(2),u){const g=lt(e);e.skip(g)}d&&e.skip(2);const f=lt(e);K(f===4);const h=Cb(e),p=e.filePos,m=lt(e);if(m===64||m===103?(o.info.codec="aac",o.info.aacCodecInfo={isMpeg2:m===103}):m===105||m===107?o.info.codec="mp3":m===221?o.info.codec="vorbis":console.warn(`Unsupported audio codec (objectTypeIndication ${m}) - discarding track.`),e.skip(12),h>e.filePos-p){const g=lt(e);K(g===5);const y=Cb(e);if(o.info.codecDescription=xt(e,y),o.info.codec==="aac"){const w=V4(o.info.codecDescription);w.numberOfChannels!==null&&(o.info.numberOfChannels=w.numberOfChannels),w.sampleRate!==null&&(o.info.sampleRate=w.sampleRate)}}}break;case"enda":{const o=this.currentTrack;if(!o)break;K(o.info?.type==="audio"),Ir(e)&255&&(o.info.codec==="pcm-s16be"?o.info.codec="pcm-s16":o.info.codec==="pcm-s24be"?o.info.codec="pcm-s24":o.info.codec==="pcm-s32be"?o.info.codec="pcm-s32":o.info.codec==="pcm-f32be"?o.info.codec="pcm-f32":o.info.codec==="pcm-f64be"&&(o.info.codec="pcm-f64"))}break;case"pcmC":{const o=this.currentTrack;if(!o)break;K(o.info?.type==="audio"),e.skip(4);const l=!!(lt(e)&1),c=lt(e);o.info.codec==="pcm-s16be"?l?c===16?o.info.codec="pcm-s16":c===24?o.info.codec="pcm-s24":c===32?o.info.codec="pcm-s32":(console.warn(`Invalid ipcm sample size ${c}.`),o.info.codec=null):c===16?o.info.codec="pcm-s16be":c===24?o.info.codec="pcm-s24be":c===32?o.info.codec="pcm-s32be":(console.warn(`Invalid ipcm sample size ${c}.`),o.info.codec=null):o.info.codec==="pcm-f32be"&&(l?c===32?o.info.codec="pcm-f32":c===64?o.info.codec="pcm-f64":(console.warn(`Invalid fpcm sample size ${c}.`),o.info.codec=null):c===32?o.info.codec="pcm-f32be":c===64?o.info.codec="pcm-f64be":(console.warn(`Invalid fpcm sample size ${c}.`),o.info.codec=null));break}case"dOps":{const o=this.currentTrack;if(!o)break;K(o.info?.type==="audio"),e.skip(1);const a=lt(e),l=Ir(e),c=He(e),u=Gv(e),d=lt(e);let f;d!==0?f=xt(e,2+a):f=new Uint8Array(0);const h=new Uint8Array(19+f.byteLength),p=new DataView(h.buffer);p.setUint32(0,1332770163,!1),p.setUint32(4,1214603620,!1),p.setUint8(8,1),p.setUint8(9,a),p.setUint16(10,l,!0),p.setUint32(12,c,!0),p.setInt16(16,u,!0),p.setUint8(18,d),h.set(f,19),o.info.codecDescription=h,o.info.numberOfChannels=a}break;case"dfLa":{const o=this.currentTrack;if(!o)break;K(o.info?.type==="audio"),e.skip(4);const a=127,l=128,c=e.filePos;for(;e.filePos<s;){const p=lt(e),m=fu(e);if((p&a)===Du.STREAMINFO){e.skip(10);const y=He(e),w=y>>>12,k=(y>>9&7)+1;o.info.sampleRate=w,o.info.numberOfChannels=k,e.skip(20)}else e.skip(m);if(p&l)break}const u=e.filePos;e.filePos=c;const d=xt(e,u-c),f=new Uint8Array(4+d.byteLength);new DataView(f.buffer).setUint32(0,1716281667,!1),f.set(d,4),o.info.codecDescription=f}break;case"stts":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=He(e);let l=0,c=0;for(let u=0;u<a;u++){const d=He(e),f=He(e);o.sampleTable.sampleTimingEntries.push({startIndex:l,startDecodeTimestamp:c,count:d,delta:f}),l+=d,c+=d*f}}break;case"ctts":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=He(e);let l=0;for(let c=0;c<a;c++){const u=He(e),d=oc(e);o.sampleTable.sampleCompositionTimeOffsets.push({startIndex:l,count:u,offset:d}),l+=u}}break;case"stsz":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=He(e),l=He(e);if(a===0)for(let c=0;c<l;c++){const u=He(e);o.sampleTable.sampleSizes.push(u)}else o.sampleTable.sampleSizes.push(a)}break;case"stz2":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4),e.skip(3);const a=lt(e),l=He(e),c=xt(e,Math.ceil(l*a/8)),u=new Wn(c);for(let d=0;d<l;d++){const f=u.readBits(a);o.sampleTable.sampleSizes.push(f)}}break;case"stss":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4),o.sampleTable.keySampleIndices=[];const a=He(e);for(let l=0;l<a;l++){const c=He(e)-1;o.sampleTable.keySampleIndices.push(c)}o.sampleTable.keySampleIndices[0]!==0&&o.sampleTable.keySampleIndices.unshift(0)}break;case"stsc":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=He(e);for(let c=0;c<a;c++){const u=He(e)-1,d=He(e),f=He(e);o.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:u,samplesPerChunk:d,sampleDescriptionIndex:f})}let l=0;for(let c=0;c<o.sampleTable.sampleToChunk.length;c++)if(o.sampleTable.sampleToChunk[c].startSampleIndex=l,c<o.sampleTable.sampleToChunk.length-1){const d=o.sampleTable.sampleToChunk[c+1].startChunkIndex-o.sampleTable.sampleToChunk[c].startChunkIndex;l+=d*o.sampleTable.sampleToChunk[c].samplesPerChunk}}break;case"stco":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=He(e);for(let l=0;l<a;l++){const c=He(e);o.sampleTable.chunkOffsets.push(c)}}break;case"co64":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=He(e);for(let l=0;l<a;l++){const c=ps(e);o.sampleTable.chunkOffsets.push(c)}}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"mehd":{const o=lt(e);e.skip(3);const a=o===1?ps(e):He(e);this.movieDurationInTimescale=a}break;case"trex":{e.skip(4);const o=He(e),a=He(e),l=He(e),c=He(e),u=He(e);this.fragmentTrackDefaults.push({trackId:o,defaultSampleDescriptionIndex:a,defaultSampleDuration:l,defaultSampleSize:c,defaultSampleFlags:u})}break;case"tfra":{const o=lt(e);e.skip(3);const a=He(e),l=this.tracks.find(w=>w.id===a);if(!l)break;const c=He(e),u=(c&48)>>4,d=(c&12)>>2,f=c&3,h=[lt,Ir,fu,He],p=h[u],m=h[d],g=h[f],y=He(e);for(let w=0;w<y;w++){const k=o===1?ps(e):He(e),C=o===1?ps(e):He(e);p(e),m(e),g(e),l.fragmentLookupTable.push({timestamp:k,moofOffset:C})}l.fragmentLookupTable.sort((w,k)=>w.timestamp-k.timestamp);for(let w=0;w<l.fragmentLookupTable.length-1;w++){const k=l.fragmentLookupTable[w],C=l.fragmentLookupTable[w+1];k.timestamp===C.timestamp&&(l.fragmentLookupTable.splice(w+1,1),w--)}}break;case"moof":this.currentFragment={moofOffset:n,moofSize:r.totalSize,implicitBaseDataOffset:n,trackData:new Map},this.readContiguousBoxes(e.slice(i,r.contentSize)),this.lastReadFragment=this.currentFragment,this.currentFragment=null;break;case"traf":if(K(this.currentFragment),this.readContiguousBoxes(e.slice(i,r.contentSize)),this.currentTrack){const o=this.currentFragment.trackData.get(this.currentTrack.id);if(o){const{currentFragmentState:a}=this.currentTrack;K(a),a.startTimestamp!==null&&(Ab(o,a.startTimestamp),o.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":{K(this.currentFragment),e.skip(1);const o=fu(e),a=!!(o&1),l=!!(o&2),c=!!(o&8),u=!!(o&16),d=!!(o&32),f=!!(o&65536),h=!!(o&131072),p=He(e),m=this.tracks.find(y=>y.id===p);if(!m)break;const g=this.fragmentTrackDefaults.find(y=>y.trackId===p);this.currentTrack=m,m.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:g?.defaultSampleDescriptionIndex??null,defaultSampleDuration:g?.defaultSampleDuration??null,defaultSampleSize:g?.defaultSampleSize??null,defaultSampleFlags:g?.defaultSampleFlags??null,startTimestamp:null},a?m.currentFragmentState.baseDataOffset=ps(e):h&&(m.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),l&&(m.currentFragmentState.sampleDescriptionIndex=He(e)),c&&(m.currentFragmentState.defaultSampleDuration=He(e)),u&&(m.currentFragmentState.defaultSampleSize=He(e)),d&&(m.currentFragmentState.defaultSampleFlags=He(e)),f&&(m.currentFragmentState.defaultSampleDuration=0)}break;case"tfdt":{const o=this.currentTrack;if(!o)break;K(o.currentFragmentState);const a=lt(e);e.skip(3);const l=a===0?He(e):ps(e);o.currentFragmentState.startTimestamp=l}break;case"trun":{const o=this.currentTrack;if(!o)break;if(K(this.currentFragment),K(o.currentFragmentState),this.currentFragment.trackData.has(o.id)){console.warn("Can't have two trun boxes for the same track in one fragment. Ignoring...");break}const a=lt(e),l=fu(e),c=!!(l&1),u=!!(l&4),d=!!(l&256),f=!!(l&512),h=!!(l&1024),p=!!(l&2048),m=He(e);let g=o.currentFragmentState.baseDataOffset;c&&(g+=oc(e));let y=null;u&&(y=He(e));let w=g;if(m===0){this.currentFragment.implicitBaseDataOffset=w;break}let k=0;const C={track:o,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(o.id,C);for(let P=0;P<m;P++){let S;d?S=He(e):(K(o.currentFragmentState.defaultSampleDuration!==null),S=o.currentFragmentState.defaultSampleDuration);let x;f?x=He(e):(K(o.currentFragmentState.defaultSampleSize!==null),x=o.currentFragmentState.defaultSampleSize);let _;h?_=He(e):(K(o.currentFragmentState.defaultSampleFlags!==null),_=o.currentFragmentState.defaultSampleFlags),P===0&&y!==null&&(_=y);let I=0;p&&(a===0?I=He(e):I=oc(e));const D=!(_&65536);C.samples.push({presentationTimestamp:k+I,duration:S,byteOffset:w,byteSize:x,isKeyFrame:D}),w+=x,k+=S}C.presentationTimestamps=C.samples.map((P,S)=>({presentationTimestamp:P.presentationTimestamp,sampleIndex:S})).sort((P,S)=>P.presentationTimestamp-S.presentationTimestamp);for(let P=0;P<C.presentationTimestamps.length;P++){const S=C.presentationTimestamps[P],x=C.samples[S.sampleIndex];if(C.firstKeyFrameTimestamp===null&&x.isKeyFrame&&(C.firstKeyFrameTimestamp=x.presentationTimestamp),P<C.presentationTimestamps.length-1){const _=C.presentationTimestamps[P+1];x.duration=_.presentationTimestamp-S.presentationTimestamp}}const A=C.samples[C.presentationTimestamps[0].sampleIndex],E=C.samples[Qn(C.presentationTimestamps).sampleIndex];C.startTimestamp=A.presentationTimestamp,C.endTimestamp=E.presentationTimestamp+E.duration,this.currentFragment.implicitBaseDataOffset=w}break;case"udta":{const o=this.iterateContiguousBoxes(e.slice(i,r.contentSize));for(const{boxInfo:a,slice:l}of o){if(a.name!=="meta"&&!this.currentTrack){const c=l.filePos;this.metadataTags.raw??={},a.name[0]==="Â©"?this.metadataTags.raw[a.name]??=Ds(l):this.metadataTags.raw[a.name]??=xt(l,a.contentSize),l.filePos=c}switch(a.name){case"meta":l.skip(-a.headerSize),this.traverseBox(l);break;case"Â©nam":case"name":this.currentTrack?this.currentTrack.name=Ji.decode(xt(l,a.contentSize)):this.metadataTags.title??=Ds(l);break;case"Â©des":this.currentTrack||(this.metadataTags.description??=Ds(l));break;case"Â©ART":this.currentTrack||(this.metadataTags.artist??=Ds(l));break;case"Â©alb":this.currentTrack||(this.metadataTags.album??=Ds(l));break;case"albr":this.currentTrack||(this.metadataTags.albumArtist??=Ds(l));break;case"Â©gen":this.currentTrack||(this.metadataTags.genre??=Ds(l));break;case"Â©day":if(!this.currentTrack){const c=new Date(Ds(l));Number.isNaN(c.getTime())||(this.metadataTags.date??=c)}break;case"Â©cmt":this.currentTrack||(this.metadataTags.comment??=Ds(l));break;case"Â©lyr":this.currentTrack||(this.metadataTags.lyrics??=Ds(l));break}}}break;case"meta":{if(this.currentTrack)break;const a=He(e)!==0;this.currentMetadataKeys=new Map,a?this.readContiguousBoxes(e.slice(i,r.contentSize)):this.readContiguousBoxes(e.slice(i+4,r.contentSize-4)),this.currentMetadataKeys=null}break;case"keys":{if(!this.currentMetadataKeys)break;e.skip(4);const o=He(e);for(let a=0;a<o;a++){const l=He(e);e.skip(4);const c=Ji.decode(xt(e,l-8));this.currentMetadataKeys.set(a+1,c)}}break;case"ilst":{if(!this.currentMetadataKeys)break;const o=this.iterateContiguousBoxes(e.slice(i,r.contentSize));for(const{boxInfo:a,slice:l}of o){let c=a.name;const u=(c.charCodeAt(0)<<24)+(c.charCodeAt(1)<<16)+(c.charCodeAt(2)<<8)+c.charCodeAt(3);this.currentMetadataKeys.has(u)&&(c=this.currentMetadataKeys.get(u));const d=Oq(l);switch(this.metadataTags.raw??={},this.metadataTags.raw[c]??=d,c){case"Â©nam":case"titl":case"com.apple.quicktime.title":case"title":typeof d=="string"&&(this.metadataTags.title??=d);break;case"Â©des":case"desc":case"dscp":case"com.apple.quicktime.description":case"description":typeof d=="string"&&(this.metadataTags.description??=d);break;case"Â©ART":case"com.apple.quicktime.artist":case"artist":typeof d=="string"&&(this.metadataTags.artist??=d);break;case"Â©alb":case"albm":case"com.apple.quicktime.album":case"album":typeof d=="string"&&(this.metadataTags.album??=d);break;case"aART":case"album_artist":typeof d=="string"&&(this.metadataTags.albumArtist??=d);break;case"Â©cmt":case"com.apple.quicktime.comment":case"comment":typeof d=="string"&&(this.metadataTags.comment??=d);break;case"Â©gen":case"gnre":case"com.apple.quicktime.genre":case"genre":typeof d=="string"&&(this.metadataTags.genre??=d);break;case"Â©lyr":case"lyrics":typeof d=="string"&&(this.metadataTags.lyrics??=d);break;case"Â©day":case"rldt":case"com.apple.quicktime.creationdate":case"date":if(typeof d=="string"){const f=new Date(d);Number.isNaN(f.getTime())||(this.metadataTags.date??=f)}break;case"covr":case"com.apple.quicktime.artwork":d instanceof Ru?(this.metadataTags.images??=[],this.metadataTags.images.push({data:d.data,kind:"coverFront",mimeType:d.mimeType})):d instanceof Uint8Array&&(this.metadataTags.images??=[],this.metadataTags.images.push({data:d,kind:"coverFront",mimeType:"image/*"}));break;case"track":if(typeof d=="string"){const f=d.split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(this.metadataTags.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(this.metadataTags.tracksTotal??=p)}break;case"trkn":if(d instanceof Uint8Array&&d.length>=6){const f=$r(d),h=f.getUint16(2,!1),p=f.getUint16(4,!1);h>0&&(this.metadataTags.trackNumber??=h),p>0&&(this.metadataTags.tracksTotal??=p)}break;case"disc":case"disk":if(d instanceof Uint8Array&&d.length>=6){const f=$r(d),h=f.getUint16(2,!1),p=f.getUint16(4,!1);h>0&&(this.metadataTags.discNumber??=h),p>0&&(this.metadataTags.discsTotal??=p)}break}}}break}return e.filePos=s,!0}}class sM{constructor(e){this.internalTrack=e,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.internalCodecId}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}getTimeResolution(){return this.internalTrack.timescale}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}async getFirstPacket(e){const n=await this.fetchPacketForSampleIndex(0,e);return n||!this.internalTrack.demuxer.isFragmented?n:this.performFragmentedLookup(null,r=>r.trackData.get(this.internalTrack.id)?{sampleIndex:0,correctSampleFound:!0}:{sampleIndex:-1,correctSampleFound:!1},-1/0,1/0,e)}mapTimestampIntoTimescale(e){return Pm(e*this.internalTrack.timescale,14)+this.internalTrack.editListOffset}async getPacket(e,n){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=DT(i,r),o=await this.fetchPacketForSampleIndex(s,n);return!BT(i)||!this.internalTrack.demuxer.isFragmented?o:this.performFragmentedLookup(null,a=>{const l=a.trackData.get(this.internalTrack.id);if(!l)return{sampleIndex:-1,correctSampleFound:!1};const c=cn(l.presentationTimestamps,r,f=>f.presentationTimestamp),u=c!==-1?l.presentationTimestamps[c].sampleIndex:-1,d=c!==-1&&r<l.endTimestamp;return{sampleIndex:u,correctSampleFound:d}},r,r,n)}async getNextPacket(e,n){const r=this.packetToSampleIndex.get(e);if(r!==void 0)return this.fetchPacketForSampleIndex(r+1,n);const i=this.packetToFragmentLocation.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(i.fragment,s=>{if(s===i.fragment){const o=s.trackData.get(this.internalTrack.id);if(i.sampleIndex+1<o.samples.length)return{sampleIndex:i.sampleIndex+1,correctSampleFound:!0}}else if(s.trackData.get(this.internalTrack.id))return{sampleIndex:0,correctSampleFound:!0};return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,n)}async getKeyPacket(e,n){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=DT(i,r),o=s===-1?-1:Bq(i,s),a=await this.fetchPacketForSampleIndex(o,n);return!BT(i)||!this.internalTrack.demuxer.isFragmented?a:this.performFragmentedLookup(null,l=>{const c=l.trackData.get(this.internalTrack.id);if(!c)return{sampleIndex:-1,correctSampleFound:!1};const u=R4(c.presentationTimestamps,h=>c.samples[h.sampleIndex].isKeyFrame&&h.presentationTimestamp<=r),d=u!==-1?c.presentationTimestamps[u].sampleIndex:-1,f=u!==-1&&r<c.endTimestamp;return{sampleIndex:d,correctSampleFound:f}},r,r,n)}async getNextKeyPacket(e,n){const r=this.packetToSampleIndex.get(e);if(r!==void 0){const s=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),o=$q(s,r);return this.fetchPacketForSampleIndex(o,n)}const i=this.packetToFragmentLocation.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(i.fragment,s=>{if(s===i.fragment){const a=s.trackData.get(this.internalTrack.id).samples.findIndex((l,c)=>l.isKeyFrame&&c>i.sampleIndex);if(a!==-1)return{sampleIndex:a,correctSampleFound:!0}}else{const o=s.trackData.get(this.internalTrack.id);if(o&&o.firstKeyFrameTimestamp!==null){const a=o.samples.findIndex(l=>l.isKeyFrame);return K(a!==-1),{sampleIndex:a,correctSampleFound:!0}}}return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,n)}async fetchPacketForSampleIndex(e,n){if(e===-1)return null;const r=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),i=Dq(r,e);if(!i)return null;let s;if(n.metadataOnly)s=is;else{let c=this.internalTrack.demuxer.reader.requestSlice(i.sampleOffset,i.sampleSize);c instanceof Promise&&(c=await c),K(c),s=xt(c,i.sampleSize)}const o=(i.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,a=i.duration/this.internalTrack.timescale,l=new wn(s,i.isKeyFrame?"key":"delta",o,a,e,i.sampleSize);return this.packetToSampleIndex.set(l,e),l}async fetchPacketInFragment(e,n,r){if(n===-1)return null;const s=e.trackData.get(this.internalTrack.id).samples[n];K(s);let o;if(r.metadataOnly)o=is;else{let u=this.internalTrack.demuxer.reader.requestSlice(s.byteOffset,s.byteSize);u instanceof Promise&&(u=await u),K(u),o=xt(u,s.byteSize)}const a=(s.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,l=s.duration/this.internalTrack.timescale,c=new wn(o,s.isKeyFrame?"key":"delta",a,l,e.moofOffset+n,s.byteSize);return this.packetToFragmentLocation.set(c,{fragment:e,sampleIndex:n}),c}async performFragmentedLookup(e,n,r,i,s){const o=this.internalTrack.demuxer;let a=null,l=null,c=-1;if(e){const{sampleIndex:g,correctSampleFound:y}=n(e);if(y)return this.fetchPacketInFragment(e,g,s);g!==-1&&(l=e,c=g)}const u=cn(this.internalTrack.fragmentLookupTable,r,g=>g.timestamp),d=u!==-1?this.internalTrack.fragmentLookupTable[u]:null,f=cn(this.internalTrack.fragmentPositionCache,r,g=>g.startTimestamp),h=f!==-1?this.internalTrack.fragmentPositionCache[f]:null,p=Math.max(d?.moofOffset??0,h?.moofOffset??0)||null;let m;for(e?p===null||e.moofOffset>=p?(m=e.moofOffset+e.moofSize,a=e):m=p:m=p??0;;){if(a){const k=a.trackData.get(this.internalTrack.id);if(k&&k.startTimestamp>i)break}let g=o.reader.requestSliceRange(m,zo,ic);if(g instanceof Promise&&(g=await g),!g)break;const y=m,w=ja(g);if(!w)break;if(w.name==="moof"){a=await o.readFragment(y);const{sampleIndex:k,correctSampleFound:C}=n(a);if(C)return this.fetchPacketInFragment(a,k,s);k!==-1&&(l=a,c=k)}m=y+w.totalSize}if(d&&(!l||l.moofOffset<d.moofOffset)){const g=this.internalTrack.fragmentLookupTable[u-1];K(!g||g.timestamp<d.timestamp);const y=g?.timestamp??-1/0;return this.performFragmentedLookup(null,n,y,i,s)}return l?this.fetchPacketInFragment(l,c,s):null}}class Rq extends sM{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return!1}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{if(this.internalTrack.info.codec==="vp9"&&!this.internalTrack.info.vp9CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.vp9CodecInfo=e&&Q4(e.data)}else if(this.internalTrack.info.codec==="av1"&&!this.internalTrack.info.av1CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.av1CodecInfo=e&&Y4(e.data)}return{codec:z4(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class Lq extends sM{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:U4(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const DT=(t,e)=>{if(t.presentationTimestamps){const n=cn(t.presentationTimestamps,e,r=>r.presentationTimestamp);return n===-1?-1:t.presentationTimestamps[n].sampleIndex}else{const n=cn(t.sampleTimingEntries,e,i=>i.startDecodeTimestamp);if(n===-1)return-1;const r=t.sampleTimingEntries[n];return r.startIndex+Math.min(Math.floor((e-r.startDecodeTimestamp)/r.delta),r.count-1)}},Dq=(t,e)=>{const n=cn(t.sampleTimingEntries,e,y=>y.startIndex),r=t.sampleTimingEntries[n];if(!r||r.startIndex+r.count<=e)return null;let s=r.startDecodeTimestamp+(e-r.startIndex)*r.delta;const o=cn(t.sampleCompositionTimeOffsets,e,y=>y.startIndex),a=t.sampleCompositionTimeOffsets[o];a&&e-a.startIndex<a.count&&(s+=a.offset);const l=t.sampleSizes[Math.min(e,t.sampleSizes.length-1)],c=cn(t.sampleToChunk,e,y=>y.startSampleIndex),u=t.sampleToChunk[c];K(u);const d=u.startChunkIndex+Math.floor((e-u.startSampleIndex)/u.samplesPerChunk),f=t.chunkOffsets[d],h=u.startSampleIndex+(d-u.startChunkIndex)*u.samplesPerChunk;let p=0,m=f;if(t.sampleSizes.length===1)m+=l*(e-h),p+=l*u.samplesPerChunk;else for(let y=h;y<h+u.samplesPerChunk;y++){const w=t.sampleSizes[y];y<e&&(m+=w),p+=w}let g=r.delta;if(t.presentationTimestamps){const y=t.presentationTimestampIndexMap[e];K(y!==void 0),y<t.presentationTimestamps.length-1&&(g=t.presentationTimestamps[y+1].presentationTimestamp-s)}return{presentationTimestamp:s,duration:g,sampleOffset:m,sampleSize:l,chunkOffset:f,chunkSize:p,isKeyFrame:t.keySampleIndices?px(t.keySampleIndices,e,y=>y)!==-1:!0}},Bq=(t,e)=>{if(!t.keySampleIndices)return e;const n=cn(t.keySampleIndices,e,r=>r);return t.keySampleIndices[n]??-1},$q=(t,e)=>{if(!t.keySampleIndices)return e+1;const n=cn(t.keySampleIndices,e,r=>r);return t.keySampleIndices[n+1]??-1},Ab=(t,e)=>{t.startTimestamp+=e,t.endTimestamp+=e;for(const n of t.samples)n.presentationTimestamp+=e;for(const n of t.presentationTimestamps)n.presentationTimestamp+=e},Fq=t=>{const[e,,,n]=t,r=Math.hypot(e,n),i=e/r,s=n/r,o=-Math.atan2(s,i)*(180/Math.PI);return Number.isFinite(o)?o:0},BT=t=>t.sampleSizes.length===0;/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var Se;(function(t){t[t.EBML=440786851]="EBML",t[t.EBMLVersion=17030]="EBMLVersion",t[t.EBMLReadVersion=17143]="EBMLReadVersion",t[t.EBMLMaxIDLength=17138]="EBMLMaxIDLength",t[t.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",t[t.DocType=17026]="DocType",t[t.DocTypeVersion=17031]="DocTypeVersion",t[t.DocTypeReadVersion=17029]="DocTypeReadVersion",t[t.Void=236]="Void",t[t.Segment=408125543]="Segment",t[t.SeekHead=290298740]="SeekHead",t[t.Seek=19899]="Seek",t[t.SeekID=21419]="SeekID",t[t.SeekPosition=21420]="SeekPosition",t[t.Duration=17545]="Duration",t[t.Info=357149030]="Info",t[t.TimestampScale=2807729]="TimestampScale",t[t.MuxingApp=19840]="MuxingApp",t[t.WritingApp=22337]="WritingApp",t[t.Tracks=374648427]="Tracks",t[t.TrackEntry=174]="TrackEntry",t[t.TrackNumber=215]="TrackNumber",t[t.TrackUID=29637]="TrackUID",t[t.TrackType=131]="TrackType",t[t.FlagEnabled=185]="FlagEnabled",t[t.FlagDefault=136]="FlagDefault",t[t.FlagForced=21930]="FlagForced",t[t.FlagLacing=156]="FlagLacing",t[t.Name=21358]="Name",t[t.Language=2274716]="Language",t[t.LanguageBCP47=2274717]="LanguageBCP47",t[t.CodecID=134]="CodecID",t[t.CodecPrivate=25506]="CodecPrivate",t[t.CodecDelay=22186]="CodecDelay",t[t.SeekPreRoll=22203]="SeekPreRoll",t[t.DefaultDuration=2352003]="DefaultDuration",t[t.Video=224]="Video",t[t.PixelWidth=176]="PixelWidth",t[t.PixelHeight=186]="PixelHeight",t[t.AlphaMode=21440]="AlphaMode",t[t.Audio=225]="Audio",t[t.SamplingFrequency=181]="SamplingFrequency",t[t.Channels=159]="Channels",t[t.BitDepth=25188]="BitDepth",t[t.SimpleBlock=163]="SimpleBlock",t[t.BlockGroup=160]="BlockGroup",t[t.Block=161]="Block",t[t.BlockAdditions=30113]="BlockAdditions",t[t.BlockMore=166]="BlockMore",t[t.BlockAdditional=165]="BlockAdditional",t[t.BlockAddID=238]="BlockAddID",t[t.BlockDuration=155]="BlockDuration",t[t.ReferenceBlock=251]="ReferenceBlock",t[t.Cluster=524531317]="Cluster",t[t.Timestamp=231]="Timestamp",t[t.Cues=475249515]="Cues",t[t.CuePoint=187]="CuePoint",t[t.CueTime=179]="CueTime",t[t.CueTrackPositions=183]="CueTrackPositions",t[t.CueTrack=247]="CueTrack",t[t.CueClusterPosition=241]="CueClusterPosition",t[t.Colour=21936]="Colour",t[t.MatrixCoefficients=21937]="MatrixCoefficients",t[t.TransferCharacteristics=21946]="TransferCharacteristics",t[t.Primaries=21947]="Primaries",t[t.Range=21945]="Range",t[t.Projection=30320]="Projection",t[t.ProjectionType=30321]="ProjectionType",t[t.ProjectionPoseRoll=30325]="ProjectionPoseRoll",t[t.Attachments=423732329]="Attachments",t[t.AttachedFile=24999]="AttachedFile",t[t.FileDescription=18046]="FileDescription",t[t.FileName=18030]="FileName",t[t.FileMediaType=18016]="FileMediaType",t[t.FileData=18012]="FileData",t[t.FileUID=18094]="FileUID",t[t.Chapters=272869232]="Chapters",t[t.Tags=307544935]="Tags",t[t.Tag=29555]="Tag",t[t.Targets=25536]="Targets",t[t.TargetTypeValue=26826]="TargetTypeValue",t[t.TargetType=25546]="TargetType",t[t.TagTrackUID=25541]="TagTrackUID",t[t.TagEditionUID=25545]="TagEditionUID",t[t.TagChapterUID=25540]="TagChapterUID",t[t.TagAttachmentUID=25542]="TagAttachmentUID",t[t.SimpleTag=26568]="SimpleTag",t[t.TagName=17827]="TagName",t[t.TagLanguage=17530]="TagLanguage",t[t.TagString=17543]="TagString",t[t.TagBinary=17541]="TagBinary",t[t.ContentEncodings=28032]="ContentEncodings",t[t.ContentEncoding=25152]="ContentEncoding",t[t.ContentEncodingOrder=20529]="ContentEncodingOrder",t[t.ContentEncodingScope=20530]="ContentEncodingScope",t[t.ContentCompression=20532]="ContentCompression",t[t.ContentCompAlgo=16980]="ContentCompAlgo",t[t.ContentCompSettings=16981]="ContentCompSettings",t[t.ContentEncryption=20533]="ContentEncryption"})(Se||(Se={}));const zq=[Se.EBML,Se.Segment],nh=[Se.SeekHead,Se.Info,Se.Cluster,Se.Tracks,Se.Cues,Se.Attachments,Se.Chapters,Se.Tags],Wp=[...zq,...nh],Uv=8,ws=2,Uo=2*Uv,oM=t=>{const e=lt(t);if(t.skip(-1),e===0)return null;let n=1,r=128;for(;(e&r)===0;)n++,r>>=1;return n},df=t=>{const e=lt(t);if(e===0)return null;let n=1,r=128;for(;(e&r)===0;)n++,r>>=1;let i=e&r-1;for(let s=1;s<n;s++)i*=256,i+=lt(t);return i},Vt=(t,e)=>{if(e<1||e>8)throw new Error("Bad unsigned int size "+e);let n=0;for(let r=0;r<e;r++)n*=256,n+=lt(t);return n},Uq=(t,e)=>{if(e<1)throw new Error("Bad unsigned int size "+e);let n=0n;for(let r=0;r<e;r++)n<<=8n,n+=BigInt(lt(t));return n},Hq=(t,e)=>{let n=Vt(t,e);return n&1<<e*8-1&&(n-=2**(e*8)),n},wx=t=>{const e=oM(t);return e===null?null:Vt(t,e)},aM=t=>{let e=lt(t);return e===255?e=null:(t.skip(-1),e=df(t),e===72057594037927940&&(e=null)),e},Ro=t=>{const e=wx(t);if(e===null)return null;const n=aM(t);return{id:e,size:n}},du=(t,e)=>{const n=xt(t,e);let r=0;for(;r<e&&n[r]!==0;)r+=1;return String.fromCharCode(...n.subarray(0,r))},Gd=(t,e)=>{const n=xt(t,e);let r=0;for(;r<e&&n[r]!==0;)r+=1;return Ji.decode(n.subarray(0,r))},Ib=(t,e)=>{if(e===0)return 0;if(e!==4&&e!==8)throw new Error("Bad float size "+e);return e===4?GK(t):bM(t)},Hv=async(t,e,n,r)=>{const i=new Set(n);let s=e;for(;r===null||s<r;){let o=t.requestSliceRange(s,ws,Uo);if(o instanceof Promise&&(o=await o),!o)break;const a=Ro(o);if(!a)break;if(i.has(a.id))return{pos:s,found:!0};Ua(a.size),s=o.filePos+a.size}return{pos:r!==null&&r>s?r:s,found:!1}},lM=async(t,e,n,r)=>{const s=new Set(n);let o=e;for(;o<r;){let a=t.requestSliceRange(o,0,Math.min(65536,r-o));if(a instanceof Promise&&(a=await a),!a||a.length<Uv)break;for(let l=0;l<a.length-Uv;l++){a.filePos=o;const c=wx(a);if(c!==null&&s.has(c))return o;o++}}return null},Bs={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC"};function Ua(t){if(t===null)throw new Error("Undefined element size is used in a place where it is not supported.")}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Vq=t=>{let n=(t.hasVideo?"video/":t.hasAudio?"audio/":"application/")+(t.isWebM?"webm":"x-matroska");if(t.codecStrings.length>0){const r=[...new Set(t.codecStrings.filter(Boolean))];n+=`; codecs="${r.join(", ")}"`}return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var Po;(function(t){t[t.None=0]="None",t[t.Xiph=1]="Xiph",t[t.FixedSize=2]="FixedSize",t[t.Ebml=3]="Ebml"})(Po||(Po={}));var Nm;(function(t){t[t.Block=1]="Block",t[t.Private=2]="Private",t[t.Next=4]="Next"})(Nm||(Nm={}));var Tf;(function(t){t[t.Zlib=0]="Zlib",t[t.Bzlib=1]="Bzlib",t[t.lzo1x=2]="lzo1x",t[t.HeaderStripping=3]="HeaderStripping"})(Tf||(Tf={}));const Pb=[{id:Se.SeekHead,flag:"seekHeadSeen"},{id:Se.Info,flag:"infoSeen"},{id:Se.Tracks,flag:"tracksSeen"},{id:Se.Cues,flag:"cuesSeen"}],cM=10*2**20;class jq extends Vc{constructor(e){super(e),this.readMetadataPromise=null,this.segments=[],this.currentSegment=null,this.currentTrack=null,this.currentCluster=null,this.currentBlock=null,this.currentBlockAdditional=null,this.currentCueTime=null,this.currentDecodingInstruction=null,this.currentTagTargetIsMovie=!0,this.currentSimpleTagName=null,this.currentAttachedFile=null,this.isWebM=!1,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getTracks(){return await this.readMetadata(),this.segments.flatMap(e=>e.tracks.map(n=>n.inputTrack))}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.getCodecParameterString()));return Vq({isWebM:this.isWebM,hasVideo:this.segments.some(r=>r.tracks.some(i=>i.info?.type==="video")),hasAudio:this.segments.some(r=>r.tracks.some(i=>i.info?.type==="audio")),codecStrings:n.filter(Boolean)})}async getMetadataTags(){await this.readMetadata();for(const n of this.segments)n.metadataTagsCollected||(this.reader.fileSize!==null&&await this.loadSegmentMetadata(n),n.metadataTagsCollected=!0);let e={};for(const n of this.segments)e={...e,...n.metadataTags};return e}readMetadata(){return this.readMetadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,ws,Uo);if(n instanceof Promise&&(n=await n),!n)break;const r=Ro(n);if(!r)break;const i=r.id;let s=r.size;const o=n.filePos;if(i===Se.EBML){Ua(s);let a=this.reader.requestSlice(o,s);if(a instanceof Promise&&(a=await a),!a)break;this.readContiguousElements(a)}else if(i===Se.Segment){if(await this.readSegment(o,s),s===null||this.reader.fileSize===null)break}else if(i===Se.Cluster){if(this.reader.fileSize===null)break;s===null&&(s=(await Hv(this.reader,o,Wp,this.reader.fileSize)).pos-o);const a=Qn(this.segments);a&&(a.elementEndPos=o+s)}Ua(s),e=o+s}})()}async readSegment(e,n){this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,tagsSeen:!1,attachmentsSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:e,elementEndPos:n===null?null:e+n,clusterSeekStartPos:e,lastReadCluster:null,metadataTags:{},metadataTagsCollected:!1},this.segments.push(this.currentSegment);let r=e;for(;this.currentSegment.elementEndPos===null||r<this.currentSegment.elementEndPos;){let a=this.reader.requestSliceRange(r,ws,Uo);if(a instanceof Promise&&(a=await a),!a)break;const l=r,c=Ro(a);if(!c||!nh.includes(c.id)&&c.id!==Se.Void){const p=await lM(this.reader,l,nh,Math.min(this.currentSegment.elementEndPos??1/0,l+cM));if(p){r=p;continue}else break}const{id:u,size:d}=c,f=a.filePos,h=Pb.findIndex(p=>p.id===u);if(h!==-1){const p=Pb[h].flag;this.currentSegment[p]=!0,Ua(d);let m=this.reader.requestSlice(f,d);m instanceof Promise&&(m=await m),m&&this.readContiguousElements(m)}else if(u===Se.Tags||u===Se.Attachments){u===Se.Tags?this.currentSegment.tagsSeen=!0:this.currentSegment.attachmentsSeen=!0,Ua(d);let p=this.reader.requestSlice(f,d);p instanceof Promise&&(p=await p),p&&this.readContiguousElements(p)}else if(u===Se.Cluster){this.currentSegment.clusterSeekStartPos=l;break}if(d===null)break;r=f+d}if(this.currentSegment.seekEntries.sort((a,l)=>a.segmentPosition-l.segmentPosition),this.reader.fileSize!==null)for(const a of this.currentSegment.seekEntries){const l=Pb.find(p=>p.id===a.id);if(!l||this.currentSegment[l.flag])continue;let c=this.reader.requestSliceRange(e+a.segmentPosition,ws,Uo);if(c instanceof Promise&&(c=await c),!c)continue;const u=Ro(c);if(!u)continue;const{id:d,size:f}=u;if(d!==l.id)continue;Ua(f),this.currentSegment[l.flag]=!0;let h=this.reader.requestSlice(c.filePos,f);h instanceof Promise&&(h=await h),h&&this.readContiguousElements(h)}this.currentSegment.timestampScale===-1&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e9/1e6),this.currentSegment.tracks.sort((a,l)=>Number(l.isDefault)-Number(a.isDefault));const i=new Map(this.currentSegment.tracks.map(a=>[a.id,a]));for(const a of this.currentSegment.cuePoints){const l=i.get(a.trackId);l&&l.cuePoints.push(a)}for(const a of this.currentSegment.tracks){a.cuePoints.sort((l,c)=>l.time-c.time);for(let l=0;l<a.cuePoints.length-1;l++){const c=a.cuePoints[l],u=a.cuePoints[l+1];c.time===u.time&&(a.cuePoints.splice(l+1,1),l--)}}let s=null,o=-1/0;for(const a of this.currentSegment.tracks)a.cuePoints.length>o&&(o=a.cuePoints.length,s=a);for(const a of this.currentSegment.tracks)a.cuePoints.length===0&&(a.cuePoints=s.cuePoints);this.currentSegment=null}async readCluster(e,n){if(n.lastReadCluster?.elementStartPos===e)return n.lastReadCluster;let r=this.reader.requestSliceRange(e,ws,Uo);r instanceof Promise&&(r=await r),K(r);const i=e,s=Ro(r);K(s);const o=s.id;K(o===Se.Cluster);let a=s.size;const l=r.filePos;a===null&&(a=(await Hv(this.reader,l,Wp,n.elementEndPos)).pos-l);let c=this.reader.requestSlice(l,a);c instanceof Promise&&(c=await c);const u={segment:n,elementStartPos:i,elementEndPos:l+a,dataStartPos:l,timestamp:-1,trackData:new Map};if(this.currentCluster=u,c){const d=this.readContiguousElements(c,Wp);u.elementEndPos=d}for(const[,d]of u.trackData){const f=d.track;K(d.blocks.length>0);let h=!1,p=!1;for(let w=0;w<d.blocks.length;w++){const k=d.blocks[w];k.timestamp+=u.timestamp,h||=k.referencedTimestamps.length>0,p||=k.lacing!==Po.None}h&&(d.blocks=Kq(d.blocks)),d.presentationTimestamps=d.blocks.map((w,k)=>({timestamp:w.timestamp,blockIndex:k})).sort((w,k)=>w.timestamp-k.timestamp);for(let w=0;w<d.presentationTimestamps.length;w++){const k=d.presentationTimestamps[w],C=d.blocks[k.blockIndex];if(d.firstKeyFrameTimestamp===null&&C.isKeyFrame&&(d.firstKeyFrameTimestamp=C.timestamp),w<d.presentationTimestamps.length-1){const A=d.presentationTimestamps[w+1];C.duration=A.timestamp-C.timestamp}else C.duration===0&&f.defaultDuration!=null&&C.lacing===Po.None&&(C.duration=f.defaultDuration)}p&&(this.expandLacedBlocks(d.blocks,f),d.presentationTimestamps=d.blocks.map((w,k)=>({timestamp:w.timestamp,blockIndex:k})).sort((w,k)=>w.timestamp-k.timestamp));const m=d.blocks[d.presentationTimestamps[0].blockIndex],g=d.blocks[Qn(d.presentationTimestamps).blockIndex];d.startTimestamp=m.timestamp,d.endTimestamp=g.timestamp+g.duration;const y=cn(f.clusterPositionCache,d.startTimestamp,w=>w.startTimestamp);(y===-1||f.clusterPositionCache[y].elementStartPos!==i)&&f.clusterPositionCache.splice(y+1,0,{elementStartPos:u.elementStartPos,startTimestamp:d.startTimestamp})}return n.lastReadCluster=u,u}getTrackDataInCluster(e,n){let r=e.trackData.get(n);if(!r){const i=e.segment.tracks.find(s=>s.id===n);if(!i)return null;r={track:i,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(n,r)}return r}expandLacedBlocks(e,n){for(let r=0;r<e.length;r++){const i=e[r];if(i.lacing===Po.None)continue;i.decoded||(i.data=this.decodeBlockData(n,i.data),i.decoded=!0);const s=sd.tempFromBytes(i.data),o=[],a=lt(s)+1;switch(i.lacing){case Po.Xiph:{let l=0;for(let c=0;c<a-1;c++){let u=0;for(;s.bufferPos<s.length;){const d=lt(s);if(u+=d,d<255){o.push(u),l+=u;break}}}o.push(s.length-(s.bufferPos+l))}break;case Po.FixedSize:{const l=s.length-1,c=Math.floor(l/a);for(let u=0;u<a;u++)o.push(c)}break;case Po.Ebml:{const l=df(s);K(l!==null);let c=l;o.push(c);let u=c;for(let d=1;d<a-1;d++){const f=s.bufferPos,h=df(s);K(h!==null);const p=h,g=(1<<(s.bufferPos-f)*7-1)-1,y=p-g;c+=y,o.push(c),u+=c}o.push(s.length-(s.bufferPos+u))}break;default:K(!1)}K(o.length===a),e.splice(r,1);for(let l=0;l<a;l++){const c=o[l],u=xt(s,c),d=i.duration||a*(n.defaultDuration??0),f=i.timestamp+d*l/a,h=d/a;e.splice(r+l,0,{timestamp:f,duration:h,isKeyFrame:i.isKeyFrame,referencedTimestamps:i.referencedTimestamps,data:u,lacing:Po.None,decoded:!0,mainAdditional:i.mainAdditional})}r+=a,r--}}async loadSegmentMetadata(e){for(const n of e.seekEntries){if(!(n.id===Se.Tags&&!e.tagsSeen)){if(!(n.id===Se.Attachments&&!e.attachmentsSeen))continue}let r=this.reader.requestSliceRange(e.dataStartPos+n.segmentPosition,ws,Uo);if(r instanceof Promise&&(r=await r),!r)continue;const i=Ro(r);if(!i||i.id!==n.id)continue;const{size:s}=i;Ua(s),K(!this.currentSegment),this.currentSegment=e;let o=this.reader.requestSlice(r.filePos,s);o instanceof Promise&&(o=await o),o&&this.readContiguousElements(o),this.currentSegment=null,n.id===Se.Tags?e.tagsSeen=!0:n.id===Se.Attachments&&(e.attachmentsSeen=!0)}}readContiguousElements(e,n){const r=e.filePos;for(;e.filePos-r<=e.length-ws;){const i=e.filePos;if(!this.traverseElement(e,n))return i}return e.filePos}traverseElement(e,n){const r=Ro(e);if(!r||n&&n.includes(r.id))return!1;const{id:i,size:s}=r,o=e.filePos;switch(Ua(s),i){case Se.DocType:this.isWebM=du(e,s)==="webm";break;case Se.Seek:{if(!this.currentSegment)break;const a={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(a),this.readContiguousElements(e.slice(o,s)),(a.id===-1||a.segmentPosition===-1)&&this.currentSegment.seekEntries.pop()}break;case Se.SeekID:{const a=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!a)break;a.id=Vt(e,s)}break;case Se.SeekPosition:{const a=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!a)break;a.segmentPosition=Vt(e,s)}break;case Se.TimestampScale:{if(!this.currentSegment)break;this.currentSegment.timestampScale=Vt(e,s),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale}break;case Se.Duration:{if(!this.currentSegment)break;this.currentSegment.duration=Ib(e,s)}break;case Se.TrackEntry:{if(!this.currentSegment)break;if(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusterPositionCache:[],cuePoints:[],isDefault:!1,inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,name:null,languageCode:Xi,decodingInstructions:[],info:null},this.readContiguousElements(e.slice(o,s)),this.currentTrack.decodingInstructions.some(a=>a.data?.type!=="decompress"||a.scope!==Nm.Block||a.data.algorithm!==Tf.HeaderStripping)&&(console.warn(`Track #${this.currentTrack.id} has an unsupported content encoding; dropping.`),this.currentTrack=null),this.currentTrack&&this.currentTrack.id!==-1&&this.currentTrack.codecId&&this.currentTrack.info){const a=this.currentTrack.codecId.indexOf("/"),l=a===-1?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,a);if(this.currentTrack.info.type==="video"&&this.currentTrack.info.width!==-1&&this.currentTrack.info.height!==-1){this.currentTrack.codecId===Bs.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===Bs.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):l===Bs.vp8?this.currentTrack.info.codec="vp8":l===Bs.vp9?this.currentTrack.info.codec="vp9":l===Bs.av1&&(this.currentTrack.info.codec="av1");const c=this.currentTrack,u=new Uh(this.input,new Wq(c));this.currentTrack.inputTrack=u,this.currentSegment.tracks.push(this.currentTrack)}else if(this.currentTrack.info.type==="audio"&&this.currentTrack.info.numberOfChannels!==-1&&this.currentTrack.info.sampleRate!==-1){l===Bs.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2")},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===Bs.mp3?this.currentTrack.info.codec="mp3":l===Bs.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate,this.currentTrack.info.sampleRate=A0):l===Bs.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):l===Bs.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId==="A_PCM/INT/LIT"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32"):this.currentTrack.codecId==="A_PCM/INT/BIG"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16be":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24be":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32be"):this.currentTrack.codecId==="A_PCM/FLOAT/IEEE"&&(this.currentTrack.info.bitDepth===32?this.currentTrack.info.codec="pcm-f32":this.currentTrack.info.bitDepth===64&&(this.currentTrack.info.codec="pcm-f64"));const c=this.currentTrack,u=new ma(this.input,new qq(c));this.currentTrack.inputTrack=u,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null}break;case Se.TrackNumber:{if(!this.currentTrack)break;this.currentTrack.id=Vt(e,s)}break;case Se.TrackType:{if(!this.currentTrack)break;const a=Vt(e,s);a===1?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null,alphaMode:!1}:a===2&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case Se.FlagEnabled:{if(!this.currentTrack)break;Vt(e,s)||(this.currentSegment.tracks.pop(),this.currentTrack=null)}break;case Se.FlagDefault:{if(!this.currentTrack)break;this.currentTrack.isDefault=!!Vt(e,s)}break;case Se.CodecID:{if(!this.currentTrack)break;this.currentTrack.codecId=du(e,s)}break;case Se.CodecPrivate:{if(!this.currentTrack)break;this.currentTrack.codecPrivate=xt(e,s)}break;case Se.DefaultDuration:{if(!this.currentTrack)break;this.currentTrack.defaultDuration=this.currentTrack.segment.timestampFactor*Vt(e,s)/1e9}break;case Se.Name:{if(!this.currentTrack)break;this.currentTrack.name=Gd(e,s)}break;case Se.Language:{if(!this.currentTrack||this.currentTrack.languageCode!==Xi)break;this.currentTrack.languageCode=du(e,s),Jf(this.currentTrack.languageCode)||(this.currentTrack.languageCode=Xi)}break;case Se.LanguageBCP47:{if(!this.currentTrack)break;const l=du(e,s).split("-")[0];l?this.currentTrack.languageCode=l:this.currentTrack.languageCode=Xi}break;case Se.Video:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(o,s))}break;case Se.PixelWidth:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.width=Vt(e,s)}break;case Se.PixelHeight:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.height=Vt(e,s)}break;case Se.AlphaMode:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.alphaMode=Vt(e,s)===1}break;case Se.Colour:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e.slice(o,s))}break;case Se.MatrixCoefficients:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Vt(e,s),l=O4[a]??null;this.currentTrack.info.colorSpace.matrix=l}break;case Se.Range:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=Vt(e,s)===2}break;case Se.TransferCharacteristics:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Vt(e,s),l=M4[a]??null;this.currentTrack.info.colorSpace.transfer=l}break;case Se.Primaries:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Vt(e,s),l=P4[a]??null;this.currentTrack.info.colorSpace.primaries=l}break;case Se.Projection:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(o,s))}break;case Se.ProjectionPoseRoll:{if(this.currentTrack?.info?.type!=="video")break;const l=-Ib(e,s);try{this.currentTrack.info.rotation=fx(l)}catch{}}break;case Se.Audio:{if(this.currentTrack?.info?.type!=="audio")break;this.readContiguousElements(e.slice(o,s))}break;case Se.SamplingFrequency:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.sampleRate=Ib(e,s)}break;case Se.Channels:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.numberOfChannels=Vt(e,s)}break;case Se.BitDepth:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.bitDepth=Vt(e,s)}break;case Se.CuePoint:{if(!this.currentSegment)break;this.readContiguousElements(e.slice(o,s)),this.currentCueTime=null}break;case Se.CueTime:this.currentCueTime=Vt(e,s);break;case Se.CueTrackPositions:{if(this.currentCueTime===null)break;K(this.currentSegment);const a={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(a),this.readContiguousElements(e.slice(o,s)),(a.trackId===-1||a.clusterPosition===-1)&&this.currentSegment.cuePoints.pop()}break;case Se.CueTrack:{const a=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!a)break;a.trackId=Vt(e,s)}break;case Se.CueClusterPosition:{const a=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!a)break;K(this.currentSegment),a.clusterPosition=this.currentSegment.dataStartPos+Vt(e,s)}break;case Se.Timestamp:{if(!this.currentCluster)break;this.currentCluster.timestamp=Vt(e,s)}break;case Se.SimpleBlock:{if(!this.currentCluster)break;const a=df(e);if(a===null)break;const l=this.getTrackDataInCluster(this.currentCluster,a);if(!l)break;const c=Gv(e),u=lt(e),d=!!(u&128),f=u>>1&3,h=xt(e,s-(e.filePos-o)),p=l.track.decodingInstructions.length>0;l.blocks.push({timestamp:c,duration:0,isKeyFrame:d,referencedTimestamps:[],data:h,lacing:f,decoded:!p,mainAdditional:null})}break;case Se.BlockGroup:{if(!this.currentCluster)break;if(this.readContiguousElements(e.slice(o,s)),this.currentBlock){for(let a=0;a<this.currentBlock.referencedTimestamps.length;a++)this.currentBlock.referencedTimestamps[a]+=this.currentBlock.timestamp;this.currentBlock=null}}break;case Se.Block:{if(!this.currentCluster)break;const a=df(e);if(a===null)break;const l=this.getTrackDataInCluster(this.currentCluster,a);if(!l)break;const c=Gv(e),d=lt(e)>>1&3,f=xt(e,s-(e.filePos-o)),h=l.track.decodingInstructions.length>0;this.currentBlock={timestamp:c,duration:0,isKeyFrame:!0,referencedTimestamps:[],data:f,lacing:d,decoded:!h,mainAdditional:null},l.blocks.push(this.currentBlock)}break;case Se.BlockAdditions:this.readContiguousElements(e.slice(o,s));break;case Se.BlockMore:{if(!this.currentBlock)break;this.currentBlockAdditional={addId:1,data:null},this.readContiguousElements(e.slice(o,s)),this.currentBlockAdditional.data&&this.currentBlockAdditional.addId===1&&(this.currentBlock.mainAdditional=this.currentBlockAdditional.data),this.currentBlockAdditional=null}break;case Se.BlockAdditional:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.data=xt(e,s)}break;case Se.BlockAddID:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.addId=Vt(e,s)}break;case Se.BlockDuration:{if(!this.currentBlock)break;this.currentBlock.duration=Vt(e,s)}break;case Se.ReferenceBlock:{if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1;const a=Hq(e,s);this.currentBlock.referencedTimestamps.push(a)}break;case Se.Tag:this.currentTagTargetIsMovie=!0,this.readContiguousElements(e.slice(o,s));break;case Se.Targets:this.readContiguousElements(e.slice(o,s));break;case Se.TargetTypeValue:Vt(e,s)!==50&&(this.currentTagTargetIsMovie=!1);break;case Se.TagTrackUID:case Se.TagEditionUID:case Se.TagChapterUID:case Se.TagAttachmentUID:this.currentTagTargetIsMovie=!1;break;case Se.SimpleTag:{if(!this.currentTagTargetIsMovie)break;this.currentSimpleTagName=null,this.readContiguousElements(e.slice(o,s))}break;case Se.TagName:this.currentSimpleTagName=Gd(e,s);break;case Se.TagString:{if(!this.currentSimpleTagName)break;const a=Gd(e,s);this.processTagValue(this.currentSimpleTagName,a)}break;case Se.TagBinary:{if(!this.currentSimpleTagName)break;const a=xt(e,s);this.processTagValue(this.currentSimpleTagName,a)}break;case Se.AttachedFile:{if(!this.currentSegment)break;this.currentAttachedFile={fileUid:null,fileName:null,fileMediaType:null,fileData:null,fileDescription:null},this.readContiguousElements(e.slice(o,s));const a=this.currentSegment.metadataTags;if(this.currentAttachedFile.fileUid&&this.currentAttachedFile.fileData&&(a.raw??={},a.raw[this.currentAttachedFile.fileUid.toString()]=new F4(this.currentAttachedFile.fileData,this.currentAttachedFile.fileMediaType??void 0,this.currentAttachedFile.fileName??void 0,this.currentAttachedFile.fileDescription??void 0)),this.currentAttachedFile.fileMediaType?.startsWith("image/")&&this.currentAttachedFile.fileData){const l=this.currentAttachedFile.fileName;let c="unknown";if(l){const u=l.toLowerCase();u.startsWith("cover.")?c="coverFront":u.startsWith("back.")&&(c="coverBack")}a.images??=[],a.images.push({data:this.currentAttachedFile.fileData,mimeType:this.currentAttachedFile.fileMediaType,kind:c,name:this.currentAttachedFile.fileName??void 0,description:this.currentAttachedFile.fileDescription??void 0})}this.currentAttachedFile=null}break;case Se.FileUID:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileUid=Uq(e,s)}break;case Se.FileName:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileName=Gd(e,s)}break;case Se.FileMediaType:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileMediaType=du(e,s)}break;case Se.FileData:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileData=xt(e,s)}break;case Se.FileDescription:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileDescription=Gd(e,s)}break;case Se.ContentEncodings:{if(!this.currentTrack)break;this.readContiguousElements(e.slice(o,s)),this.currentTrack.decodingInstructions.sort((a,l)=>l.order-a.order)}break;case Se.ContentEncoding:this.currentDecodingInstruction={order:0,scope:Nm.Block,data:null},this.readContiguousElements(e.slice(o,s)),this.currentDecodingInstruction.data&&this.currentTrack.decodingInstructions.push(this.currentDecodingInstruction),this.currentDecodingInstruction=null;break;case Se.ContentEncodingOrder:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.order=Vt(e,s)}break;case Se.ContentEncodingScope:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.scope=Vt(e,s)}break;case Se.ContentCompression:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decompress",algorithm:Tf.Zlib,settings:null},this.readContiguousElements(e.slice(o,s))}break;case Se.ContentCompAlgo:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.algorithm=Vt(e,s)}break;case Se.ContentCompSettings:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.settings=xt(e,s)}break;case Se.ContentEncryption:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decrypt"}}break}return e.filePos=o+s,!0}decodeBlockData(e,n){K(e.decodingInstructions.length>0);let r=n;for(const i of e.decodingInstructions)switch(K(i.data),i.data.type){case"decompress":switch(i.data.algorithm){case Tf.HeaderStripping:if(i.data.settings&&i.data.settings.length>0){const s=i.data.settings,o=new Uint8Array(s.length+r.length);o.set(s,0),o.set(r,s.length),r=o}break}break}return r}processTagValue(e,n){if(!this.currentSegment?.metadataTags)return;const r=this.currentSegment.metadataTags;if(r.raw??={},r.raw[e]??=n,typeof n=="string")switch(e.toLowerCase()){case"title":r.title??=n;break;case"description":r.description??=n;break;case"artist":r.artist??=n;break;case"album":r.album??=n;break;case"album_artist":r.albumArtist??=n;break;case"genre":r.genre??=n;break;case"comment":r.comment??=n;break;case"lyrics":r.lyrics??=n;break;case"date":{const i=new Date(n);Number.isNaN(i.getTime())||(r.date??=i)}break;case"track_number":case"part_number":{const i=n.split("/"),s=Number.parseInt(i[0],10),o=i[1]&&Number.parseInt(i[1],10);Number.isInteger(s)&&s>0&&(r.trackNumber??=s),o&&Number.isInteger(o)&&o>0&&(r.tracksTotal??=o)}break;case"disc_number":case"disc":{const i=n.split("/"),s=Number.parseInt(i[0],10),o=i[1]&&Number.parseInt(i[1],10);Number.isInteger(s)&&s>0&&(r.discNumber??=s),o&&Number.isInteger(o)&&o>0&&(r.discsTotal??=o)}break}}}class uM{constructor(e){this.internalTrack=e,this.packetToClusterLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.codecId}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}getTimeResolution(){return this.internalTrack.segment.timestampFactor}async getFirstPacket(e){return this.performClusterLookup(null,n=>n.trackData.get(this.internalTrack.id)?{blockIndex:0,correctBlockFound:!0}:{blockIndex:-1,correctBlockFound:!1},-1/0,1/0,e)}intoTimescale(e){return Pm(e*this.internalTrack.segment.timestampFactor,14)}async getPacket(e,n){const r=this.intoTimescale(e);return this.performClusterLookup(null,i=>{const s=i.trackData.get(this.internalTrack.id);if(!s)return{blockIndex:-1,correctBlockFound:!1};const o=cn(s.presentationTimestamps,r,c=>c.timestamp),a=o!==-1?s.presentationTimestamps[o].blockIndex:-1,l=o!==-1&&r<s.endTimestamp;return{blockIndex:a,correctBlockFound:l}},r,r,n)}async getNextPacket(e,n){const r=this.packetToClusterLocation.get(e);if(r===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(r.cluster,i=>{if(i===r.cluster){const s=i.trackData.get(this.internalTrack.id);if(r.blockIndex+1<s.blocks.length)return{blockIndex:r.blockIndex+1,correctBlockFound:!0}}else if(i.trackData.get(this.internalTrack.id))return{blockIndex:0,correctBlockFound:!0};return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,n)}async getKeyPacket(e,n){const r=this.intoTimescale(e);return this.performClusterLookup(null,i=>{const s=i.trackData.get(this.internalTrack.id);if(!s)return{blockIndex:-1,correctBlockFound:!1};const o=R4(s.presentationTimestamps,c=>s.blocks[c.blockIndex].isKeyFrame&&c.timestamp<=r),a=o!==-1?s.presentationTimestamps[o].blockIndex:-1,l=o!==-1&&r<s.endTimestamp;return{blockIndex:a,correctBlockFound:l}},r,r,n)}async getNextKeyPacket(e,n){const r=this.packetToClusterLocation.get(e);if(r===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(r.cluster,i=>{if(i===r.cluster){const o=i.trackData.get(this.internalTrack.id).blocks.findIndex((a,l)=>a.isKeyFrame&&l>r.blockIndex);if(o!==-1)return{blockIndex:o,correctBlockFound:!0}}else{const s=i.trackData.get(this.internalTrack.id);if(s&&s.firstKeyFrameTimestamp!==null){const o=s.blocks.findIndex(a=>a.isKeyFrame);return K(o!==-1),{blockIndex:o,correctBlockFound:!0}}}return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,n)}async fetchPacketInCluster(e,n,r){if(n===-1)return null;const s=e.trackData.get(this.internalTrack.id).blocks[n];K(s),s.decoded||(s.data=this.internalTrack.demuxer.decodeBlockData(this.internalTrack,s.data),s.decoded=!0);const o=r.metadataOnly?is:s.data,a=s.timestamp/this.internalTrack.segment.timestampFactor,l=s.duration/this.internalTrack.segment.timestampFactor,c={};s.mainAdditional&&this.internalTrack.info?.type==="video"&&this.internalTrack.info.alphaMode&&(c.alpha=r.metadataOnly?is:s.mainAdditional,c.alphaByteLength=s.mainAdditional.byteLength);const u=new wn(o,s.isKeyFrame?"key":"delta",a,l,e.dataStartPos+n,s.data.byteLength,c);return this.packetToClusterLocation.set(u,{cluster:e,blockIndex:n}),u}async performClusterLookup(e,n,r,i,s){const{demuxer:o,segment:a}=this.internalTrack;let l=null,c=null,u=-1;if(e){const{blockIndex:y,correctBlockFound:w}=n(e);if(w)return this.fetchPacketInCluster(e,y,s);y!==-1&&(c=e,u=y)}const d=cn(this.internalTrack.cuePoints,r,y=>y.time),f=d!==-1?this.internalTrack.cuePoints[d]:null,h=cn(this.internalTrack.clusterPositionCache,r,y=>y.startTimestamp),p=h!==-1?this.internalTrack.clusterPositionCache[h]:null,m=Math.max(f?.clusterPosition??0,p?.elementStartPos??0)||null;let g;for(e?m===null||e.elementStartPos>=m?(g=e.elementEndPos,l=e):g=m:g=m??a.clusterSeekStartPos;a.elementEndPos===null||g<=a.elementEndPos-ws;){if(l){const S=l.trackData.get(this.internalTrack.id);if(S&&S.startTimestamp>i)break}let y=o.reader.requestSliceRange(g,ws,Uo);if(y instanceof Promise&&(y=await y),!y)break;const w=g,k=Ro(y);if(!k||!nh.includes(k.id)&&k.id!==Se.Void){const S=await lM(o.reader,w,nh,Math.min(a.elementEndPos??1/0,w+cM));if(S){g=S;continue}else break}const C=k.id;let A=k.size;const E=y.filePos;if(C===Se.Cluster){l=await o.readCluster(w,a),A=l.elementEndPos-E;const{blockIndex:S,correctBlockFound:x}=n(l);if(x)return this.fetchPacketInCluster(l,S,s);S!==-1&&(c=l,u=S)}A===null&&(K(C!==Se.Cluster),A=(await Hv(o.reader,E,Wp,a.elementEndPos)).pos-E);const P=E+A;if(a.elementEndPos===null){let S=o.reader.requestSliceRange(P,ws,Uo);if(S instanceof Promise&&(S=await S),!S)break;if(wx(S)===Se.Segment){a.elementEndPos=P;break}}g=P}if(f&&(!c||c.elementStartPos<f.clusterPosition)){const y=this.internalTrack.cuePoints[d-1];K(!y||y.time<f.time);const w=y?.time??-1/0;return this.performClusterLookup(null,n,w,i,s)}return c?this.fetchPacketInCluster(c,u,s):null}}class Wq extends uM{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.info.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return this.internalTrack.info.alphaMode}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{let e=null;return(this.internalTrack.info.codec==="vp9"||this.internalTrack.info.codec==="av1"||this.internalTrack.info.codec==="avc"&&!this.internalTrack.info.codecDescription||this.internalTrack.info.codec==="hevc"&&!this.internalTrack.info.codecDescription)&&(e=await this.getFirstPacket({})),{codec:z4({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcCodecInfo:this.internalTrack.info.codec==="avc"&&e?K4(e.data):null,hevcCodecInfo:this.internalTrack.info.codec==="hevc"&&e?Z4(e.data):null,vp9CodecInfo:this.internalTrack.info.codec==="vp9"&&e?Q4(e.data):null,av1CodecInfo:this.internalTrack.info.codec==="av1"&&e?Y4(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class qq extends uM{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:U4({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const Kq=t=>{const e=new Map;for(let s=0;s<t.length;s++){const o=t[s];e.set(o.timestamp,o)}const n=new Set,r=[],i=s=>{if(!n.has(s)){n.add(s);for(let o=0;o<s.referencedTimestamps.length;o++){const a=s.referencedTimestamps[o],l=e.get(a);l&&i(l)}r.push(s)}};for(let s=0;s<t.length;s++)i(t[s]);return r};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const dM=4,Gq=[44100,48e3,32e3],Zq=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1,-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1,-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],Qq=1483304551,Xq=1231971951,Yq=(t,e,n,r,i)=>e===0?0:e===1?Math.floor(144*n/(r<<t))+i:e===2?Math.floor(144*n/r)+i:(Math.floor(12*n/r)+i)*4,Jq=(t,e)=>t===3?e===3?21:36:e===3?13:21,eK=(t,e)=>{const n=t>>>24,r=t>>>16&255,i=t>>>8&255,s=t&255;if(n!==255&&r!==255&&i!==255&&s!==255)return{header:null,bytesAdvanced:4};if(n!==255)return{header:null,bytesAdvanced:1};if((r&224)!==224)return{header:null,bytesAdvanced:1};let o=0,a=0;r&16?o=r&8?0:1:(o=1,a=1);const l=r>>3&3,c=r>>1&3,u=i>>4&15,d=(i>>2&3)%3,f=i>>1&1,h=s>>6&3,p=s>>4&3,m=s>>3&1,g=s>>2&1,y=s&3,w=Zq[o*16*4+c*16+u];if(w===-1)return{header:null,bytesAdvanced:1};const k=w*1e3,C=Gq[d]>>o+a,A=Yq(o,c,k,C,f);if(e!==null&&e<A)return{header:null,bytesAdvanced:1};let E;return l===3?E=c===3?384:1152:c===3?E=384:c===2?E=1152:E=576,{header:{totalSize:A,mpegVersionId:l,layer:c,bitrate:k,frequencyIndex:d,sampleRate:C,channel:h,modeExtension:p,copyright:m,original:g,emphasis:y,audioSamplesInFrame:E},bytesAdvanced:1}},Vv=t=>{let e=2130706432,n=0;for(;e!==0;)n>>=1,n|=t&e,e>>=8;return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var vu;(function(t){t[t.Unsynchronisation=128]="Unsynchronisation",t[t.ExtendedHeader=64]="ExtendedHeader",t[t.ExperimentalIndicator=32]="ExperimentalIndicator",t[t.Footer=16]="Footer"})(vu||(vu={}));var xu;(function(t){t[t.ISO_8859_1=0]="ISO_8859_1",t[t.UTF_16_WITH_BOM=1]="UTF_16_WITH_BOM",t[t.UTF_16_BE_NO_BOM=2]="UTF_16_BE_NO_BOM",t[t.UTF_8=3]="UTF_8"})(xu||(xu={}));const qp=128,Rm=10,Su=["Blues","Classic rock","Country","Dance","Disco","Funk","Grunge","Hip-hop","Jazz","Metal","New age","Oldies","Other","Pop","Rhythm and blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death metal","Pranks","Soundtrack","Euro-techno","Ambient","Trip-hop","Vocal","Jazz & funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound clip","Gospel","Noise","Alternative rock","Bass","Soul","Punk","Space","Meditative","Instrumental pop","Instrumental rock","Ethnic","Gothic","Darkwave","Techno-industrial","Electronic","Pop-folk","Eurodance","Dream","Southern rock","Comedy","Cult","Gangsta","Top 40","Christian rap","Pop/funk","Jungle music","Native US","Cabaret","New wave","Psychedelic","Rave","Showtunes","Trailer","Lo-fi","Tribal","Acid punk","Acid jazz","Polka","Retro","Musical","Rock 'n' roll","Hard rock","Folk","Folk rock","National folk","Swing","Fast fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic rock","Progressive rock","Psychedelic rock","Symphonic rock","Slow rock","Big band","Chorus","Easy listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber music","Sonata","Symphony","Booty bass","Primus","Porn groove","Satire","Slow jam","Club","Tango","Samba","Folklore","Ballad","Power ballad","Rhythmic Soul","Freestyle","Duet","Punk rock","Drum solo","A cappella","Euro-house","Dance hall","Goa music","Drum & bass","Club-house","Hardcore techno","Terror","Indie","Britpop","Negerpunk","Polsk punk","Beat","Christian gangsta rap","Heavy metal","Black metal","Crossover","Contemporary Christian","Christian rock","Merengue","Salsa","Thrash metal","Anime","Jpop","Synthpop","Christmas","Art rock","Baroque","Bhangra","Big beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math rock","New romantic","Nu-breakz","Post-punk","Post-rock","Psytrance","Shoegaze","Space rock","Trop rock","World music","Neoclassical","Audiobook","Audio theatre","Neue Deutsche Welle","Podcast","Indie rock","G-Funk","Dubstep","Garage rock","Psybient"],tK=(t,e)=>{const n=t.filePos;e.raw??={},e.raw.TAG??=xt(t,qp-3),t.filePos=n;const r=iu(t,30);r&&(e.title??=r);const i=iu(t,30);i&&(e.artist??=i);const s=iu(t,30);s&&(e.album??=s);const o=iu(t,4),a=Number.parseInt(o,10);Number.isInteger(a)&&a>0&&(e.date??=new Date(a,0,1));const l=xt(t,30);let c;if(l[28]===0&&l[29]!==0){const d=l[29];d>0&&(e.trackNumber??=d),t.skip(-30),c=iu(t,28),t.skip(2)}else t.skip(-30),c=iu(t,30);c&&(e.comment??=c);const u=lt(t);u<Su.length&&(e.genre??=Su[u])},iu=(t,e)=>{const n=xt(t,e),r=uu(n.indexOf(0),n.length),i=n.subarray(0,r);let s="";for(let o=0;o<i.length;o++)s+=String.fromCharCode(i[o]);return s.trimEnd()},Lm=t=>{const e=t.filePos,n=Sr(t,3),r=lt(t),i=lt(t),s=lt(t),o=He(t);if(n!=="ID3"||r===255||i===255||(o&2155905152)!==0)return t.filePos=e,null;const a=Vv(o);return{majorVersion:r,revision:i,flags:s,size:a}},fM=(t,e,n)=>{if(![2,3,4].includes(e.majorVersion)){console.warn(`Unsupported ID3v2 major version: ${e.majorVersion}`);return}const r=xt(t,e.size),i=new nK(e,r);if(e.flags&vu.Footer&&i.removeFooter(),e.flags&vu.Unsynchronisation&&e.majorVersion===3&&i.ununsynchronizeAll(),e.flags&vu.ExtendedHeader){const s=i.readU32();e.majorVersion===3?i.pos+=s:i.pos+=s-4}for(;i.pos<=i.bytes.length-i.frameHeaderSize();){const s=i.readId3V2Frame();if(!s)break;const o=i.pos,a=i.pos+s.size;let l=!1,c=!1,u=!1;if(e.majorVersion===3?(l=!!(s.flags&64),c=!!(s.flags&128)):e.majorVersion===4&&(l=!!(s.flags&4),c=!!(s.flags&8),u=!!(s.flags&2)||!!(e.flags&vu.Unsynchronisation)),l){console.warn(`Skipping encrypted ID3v2 frame ${s.id}`),i.pos=a;continue}if(c){console.warn(`Skipping compressed ID3v2 frame ${s.id}`),i.pos=a;continue}switch(u&&i.ununsynchronizeRegion(i.pos,a),n.raw??={},s.id[0]==="T"?n.raw[s.id]??=i.readId3V2EncodingAndText(a):n.raw[s.id]??=i.readBytes(s.size),i.pos=o,s.id){case"TIT2":case"TT2":n.title??=i.readId3V2EncodingAndText(a);break;case"TIT3":case"TT3":n.description??=i.readId3V2EncodingAndText(a);break;case"TPE1":case"TP1":n.artist??=i.readId3V2EncodingAndText(a);break;case"TALB":case"TAL":n.album??=i.readId3V2EncodingAndText(a);break;case"TPE2":case"TP2":n.albumArtist??=i.readId3V2EncodingAndText(a);break;case"TRCK":case"TRK":{const f=i.readId3V2EncodingAndText(a).split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(n.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(n.tracksTotal??=p)}break;case"TPOS":case"TPA":{const f=i.readId3V2EncodingAndText(a).split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(n.discNumber??=h),p&&Number.isInteger(p)&&p>0&&(n.discsTotal??=p)}break;case"TCON":case"TCO":{const d=i.readId3V2EncodingAndText(a);let f=/^\((\d+)\)/.exec(d);if(f){const h=Number.parseInt(f[1]);if(Su[h]!==void 0){n.genre??=Su[h];break}}if(f=/^\d+$/.exec(d),f){const h=Number.parseInt(f[0]);if(Su[h]!==void 0){n.genre??=Su[h];break}}n.genre??=d}break;case"TDRC":case"TDAT":{const d=i.readId3V2EncodingAndText(a),f=new Date(d);Number.isNaN(f.getTime())||(n.date??=f)}break;case"TYER":case"TYE":{const d=i.readId3V2EncodingAndText(a),f=Number.parseInt(d,10);Number.isInteger(f)&&(n.date??=new Date(f,0,1))}break;case"USLT":case"ULT":{const d=i.readU8();i.pos+=3,i.readId3V2Text(d,a),n.lyrics??=i.readId3V2Text(d,a)}break;case"COMM":case"COM":{const d=i.readU8();i.pos+=3,i.readId3V2Text(d,a),n.comment??=i.readId3V2Text(d,a)}break;case"APIC":case"PIC":{const d=i.readId3V2TextEncoding();let f;if(e.majorVersion===2){const g=i.readAscii(3);f=g==="PNG"?"image/png":g==="JPG"?"image/jpeg":"image/*"}else f=i.readId3V2Text(d,a);const h=i.readU8(),p=i.readId3V2Text(d,a).trimEnd(),m=a-i.pos;if(m>=0){const g=i.readBytes(m);n.images||(n.images=[]),n.images.push({data:g,mimeType:f,kind:h===3?"coverFront":h===4?"coverBack":"unknown",description:p})}}break;default:i.pos+=s.size;break}i.pos=a}};class nK{constructor(e,n){this.header=e,this.bytes=n,this.pos=0,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength)}frameHeaderSize(){return this.header.majorVersion===2?6:10}ununsynchronizeAll(){const e=[];for(let n=0;n<this.bytes.length;n++){const r=this.bytes[n];e.push(r),r===255&&n!==this.bytes.length-1&&this.bytes[n]===0&&n++}this.bytes=new Uint8Array(e),this.view=new DataView(this.bytes.buffer)}ununsynchronizeRegion(e,n){const r=[];for(let o=e;o<n;o++){const a=this.bytes[o];r.push(a),a===255&&o!==n-1&&this.bytes[o+1]===0&&o++}const i=this.bytes.subarray(0,e),s=this.bytes.subarray(n);this.bytes=new Uint8Array(i.length+r.length+s.length),this.bytes.set(i,0),this.bytes.set(r,i.length),this.bytes.set(s,i.length+r.length),this.view=new DataView(this.bytes.buffer)}removeFooter(){this.bytes=this.bytes.subarray(0,this.bytes.length-Rm),this.view=new DataView(this.bytes.buffer)}readBytes(e){const n=this.bytes.subarray(this.pos,this.pos+e);return this.pos+=e,n}readU8(){const e=this.view.getUint8(this.pos);return this.pos+=1,e}readU16(){const e=this.view.getUint16(this.pos,!1);return this.pos+=2,e}readU24(){const e=this.view.getUint16(this.pos,!1),n=this.view.getUint8(this.pos+1);return this.pos+=3,e*256+n}readU32(){const e=this.view.getUint32(this.pos,!1);return this.pos+=4,e}readAscii(e){let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(this.view.getUint8(this.pos+r));return this.pos+=e,n}readId3V2Frame(){if(this.header.majorVersion===2){const e=this.readAscii(3);if(e==="\0\0\0")return null;const n=this.readU24();return{id:e,size:n,flags:0}}else{const e=this.readAscii(4);if(e==="\0\0\0\0")return null;const n=this.readU32();let r=this.header.majorVersion===4?Vv(n):n;const i=this.readU16(),s=this.pos,o=a=>{const l=this.pos+a;if(l>this.bytes.length)return!1;if(l<=this.bytes.length-this.frameHeaderSize()){this.pos+=a;const c=this.readAscii(4);if(c!=="\0\0\0\0"&&!/[0-9A-Z]{4}/.test(c))return!1}return!0};if(!o(r)){const a=this.header.majorVersion===4?n:Vv(n);o(a)&&(r=a)}return this.pos=s,{id:e,size:r,flags:i}}}readId3V2TextEncoding(){const e=this.readU8();if(e>3)throw new Error(`Unsupported text encoding: ${e}`);return e}readId3V2Text(e,n){const r=this.pos,i=this.readBytes(n-this.pos);switch(e){case xu.ISO_8859_1:{let s="";for(let o=0;o<i.length;o++){const a=i[o];if(a===0){this.pos=r+o+1;break}s+=String.fromCharCode(a)}return s}case xu.UTF_16_WITH_BOM:if(i[0]===255&&i[1]===254){const s=new TextDecoder("utf-16le"),o=uu(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(2,o))}else if(i[0]===254&&i[1]===255){const s=new TextDecoder("utf-16be"),o=uu(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(2,o))}else{const s=uu(i.findIndex(o=>o===0),i.length);return this.pos=r+Math.min(s+1,i.length),Ji.decode(i.subarray(0,s))}case xu.UTF_16_BE_NO_BOM:{const s=new TextDecoder("utf-16be"),o=uu(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(0,o))}case xu.UTF_8:{const s=uu(i.findIndex(o=>o===0),i.length);return this.pos=r+Math.min(s+1,i.length),Ji.decode(i.subarray(0,s))}}}readId3V2EncodingAndText(e){if(this.pos>=e)return"";const n=this.readId3V2TextEncoding();return this.readId3V2Text(n,e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const jv=async(t,e,n)=>{let r=e;for(;n===null||r<n;){let i=t.requestSlice(r,dM);if(i instanceof Promise&&(i=await i),!i)break;const s=He(i),o=eK(s,t.fileSize!==null?t.fileSize-r:null);if(o.header)return{header:o.header,startPos:r};r+=o.bytesAdvanced}return null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class rK extends Vc{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.metadataTags=null,this.tracks=[],this.readingMutex=new kd,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();if(!this.firstFrameHeader)throw new Error("No valid MP3 frame found.");this.tracks=[new ma(this.input,new iK(this))]})()}async advanceReader(){if(this.lastLoadedPos===0)for(;;){let a=this.reader.requestSlice(this.lastLoadedPos,Rm);if(a instanceof Promise&&(a=await a),!a){this.lastSampleLoaded=!0;return}const l=Lm(a);if(!l)break;this.lastLoadedPos=a.filePos+l.size}const e=await jv(this.reader,this.lastLoadedPos,this.reader.fileSize);if(!e){this.lastSampleLoaded=!0;return}const n=e.header;this.lastLoadedPos=e.startPos+n.totalSize-1;const r=Jq(n.mpegVersionId,n.channel);let i=this.reader.requestSlice(e.startPos+r,4);if(i instanceof Promise&&(i=await i),i){const a=He(i);if(a===Qq||a===Xq)return}this.firstFrameHeader||(this.firstFrameHeader=n),n.sampleRate!==this.firstFrameHeader.sampleRate&&console.warn(`MP3 changed sample rate mid-file: ${this.firstFrameHeader.sampleRate} Hz to ${n.sampleRate} Hz. Might be a bug, so please report this file.`);const s=n.audioSamplesInFrame/this.firstFrameHeader.sampleRate,o={timestamp:this.nextTimestampInSamples/this.firstFrameHeader.sampleRate,duration:s,dataStart:e.startPos,dataSize:n.totalSize};this.loadedSamples.push(o),this.nextTimestampInSamples+=n.audioSamplesInFrame}async getMimeType(){return"audio/mpeg"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return K(e),e.computeDuration()}async getMetadataTags(){const e=await this.readingMutex.acquire();try{if(await this.readMetadata(),this.metadataTags)return this.metadataTags;this.metadataTags={};let n=0,r=!1;for(;;){let i=this.reader.requestSlice(n,Rm);if(i instanceof Promise&&(i=await i),!i)break;const s=Lm(i);if(!s)break;r=!0;let o=this.reader.requestSlice(i.filePos,s.size);if(o instanceof Promise&&(o=await o),!o)break;fM(o,s,this.metadataTags),n=i.filePos+s.size}if(!r&&this.reader.fileSize!==null&&this.reader.fileSize>=qp){let i=this.reader.requestSlice(this.reader.fileSize-qp,qp);i instanceof Promise&&(i=await i),K(i),Sr(i,3)==="TAG"&&tK(i,this.metadataTags)}return this.metadataTags}finally{e()}}}class iK{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return K(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return Xi}getCodec(){return"mp3"}getInternalCodecId(){return null}getNumberOfChannels(){return K(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.channel===3?1:2}getSampleRate(){return K(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}async getDecoderConfig(){return K(this.demuxer.firstFrameHeader),{codec:"mp3",numberOfChannels:this.demuxer.firstFrameHeader.channel===3?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}}async getPacketAtIndex(e,n){if(e===-1)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=is;else{let s=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize);if(s instanceof Promise&&(s=await s),!s)return null;i=xt(s,r.dataSize)}return new wn(i,"key",r.timestamp,r.duration,e,r.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=px(this.demuxer.loadedSamples,e.timestamp,o=>o.timestamp);if(i===-1)throw new Error("Packet was not created from this track.");const s=i+1;for(;s>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(s,n)}finally{r()}}async getPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=cn(this.demuxer.loadedSamples,e,s=>s.timestamp);if(i===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(i,n);if(i>=0&&i+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(i,n);await this.demuxer.advanceReader()}}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const hM=1399285583,sK=79764919,pM=new Uint32Array(256);for(let t=0;t<256;t++){let e=t<<24;for(let n=0;n<8;n++)e=e&2147483648?e<<1^sK:e<<1;pM[t]=e>>>0&4294967295}const oK=t=>{const e=$r(t),n=e.getUint32(22,!0);e.setUint32(22,0,!0);let r=0;for(let i=0;i<t.length;i++){const s=t[i];r=(r<<8^pM[r>>>24^s])>>>0}return e.setUint32(22,n,!0),r},aK=(t,e,n)=>{let r=0,i=null;if(t.length>0)if(e.codec==="vorbis"){K(e.vorbisInfo);const s=e.vorbisInfo.modeBlockflags.length,a=(1<<VW(s-1))-1<<1,l=(t[0]&a)>>1;if(l>=e.vorbisInfo.modeBlockflags.length)throw new Error("Invalid mode number.");let c=n;const u=e.vorbisInfo.modeBlockflags[l];if(i=e.vorbisInfo.blocksizes[u],u===1){const d=(a|1)+1,f=t[0]&d?1:0;c=e.vorbisInfo.blocksizes[f]}r=c!==null?c+i>>2:0}else e.codec==="opus"&&(r=wq(t).durationInSamples);return{durationInSamples:r,vorbisBlockSize:i}},lK=t=>{let e="audio/ogg";if(t.codecStrings){const n=[...new Set(t.codecStrings)];e+=`; codecs="${n.join(", ")}"`}return e};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const sc=27,Bu=282,cK=Bu+65025,_f=t=>{const e=t.filePos;if(Eu(t)!==hM)return null;t.skip(1);const r=lt(t),i=KK(t),s=Eu(t),o=Eu(t),a=Eu(t),l=lt(t),c=new Uint8Array(l);for(let h=0;h<l;h++)c[h]=lt(t);const u=27+l,d=c.reduce((h,p)=>h+p,0),f=u+d;return{headerStartPos:e,totalSize:f,dataStartPos:e+u,dataSize:d,headerType:r,granulePosition:i,serialNumber:s,sequenceNumber:o,checksum:a,lacingValues:c}},uK=(t,e)=>{for(;t.filePos<e-3;){const n=Eu(t),r=n&255,i=n>>>8&255,s=n>>>16&255,o=n>>>24&255,a=79;if(!(r!==a&&i!==a&&s!==a&&o!==a)){if(t.skip(-4),n===hM)return!0;t.skip(1)}}return!1};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class dK extends Vc{constructor(e){super(e),this.metadataPromise=null,this.bitstreams=[],this.tracks=[],this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,sc,Bu);if(n instanceof Promise&&(n=await n),!n)break;const r=_f(n);if(!r||!!!(r.headerType&2))break;this.bitstreams.push({serialNumber:r.serialNumber,bosPage:r,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),e=r.headerStartPos+r.totalSize}for(const n of this.bitstreams){const r=await this.readPacket(n.bosPage,0);r&&(r.data.byteLength>=7&&r.data[0]===1&&r.data[1]===118&&r.data[2]===111&&r.data[3]===114&&r.data[4]===98&&r.data[5]===105&&r.data[6]===115?await this.readVorbisMetadata(r,n):r.data.byteLength>=8&&r.data[0]===79&&r.data[1]===112&&r.data[2]===117&&r.data[3]===115&&r.data[4]===72&&r.data[5]===101&&r.data[6]===97&&r.data[7]===100&&await this.readOpusMetadata(r,n),n.codecInfo.codec!==null&&this.tracks.push(new ma(this.input,new fK(n,this))))}})()}async readVorbisMetadata(e,n){let r=await this.findNextPacketStart(e);if(!r)return;const i=await this.readPacket(r.startPage,r.startSegmentIndex);if(!i||(r=await this.findNextPacketStart(i),!r))return;const s=await this.readPacket(r.startPage,r.startSegmentIndex);if(!s||i.data[0]!==3||s.data[0]!==5)return;const o=[],a=d=>{for(;o.push(Math.min(255,d)),!(d<255);)d-=255};a(e.data.length),a(i.data.length);const l=new Uint8Array(1+o.length+e.data.length+i.data.length+s.data.length);l[0]=2,l.set(o,1),l.set(e.data,1+o.length),l.set(i.data,1+o.length+e.data.length),l.set(s.data,1+o.length+e.data.length+i.data.length),n.codecInfo.codec="vorbis",n.description=l,n.lastMetadataPacket=s;const c=$r(e.data);n.numberOfChannels=c.getUint8(11),n.sampleRate=c.getUint32(12,!0);const u=c.getUint8(28);n.codecInfo.vorbisInfo={blocksizes:[1<<(u&15),1<<(u>>4)],modeBlockflags:vq(s.data).modeBlockflags},Bv(i.data.subarray(7),this.metadataTags)}async readOpusMetadata(e,n){const r=await this.findNextPacketStart(e);if(!r)return;const i=await this.readPacket(r.startPage,r.startSegmentIndex);if(!i)return;n.codecInfo.codec="opus",n.description=e.data,n.lastMetadataPacket=i;const s=J4(e.data);n.numberOfChannels=s.outputChannelCount,n.sampleRate=A0,n.codecInfo.opusInfo={preSkip:s.preSkip},Bv(i.data.subarray(8),this.metadataTags)}async readPacket(e,n){K(n<e.lacingValues.length);let r=0;for(let d=0;d<n;d++)r+=e.lacingValues[d];let i=e,s=r,o=n;const a=[];e:for(;;){let d=this.reader.requestSlice(i.dataStartPos,i.dataSize);d instanceof Promise&&(d=await d),K(d);const f=xt(d,i.dataSize);for(;;){if(o===i.lacingValues.length){a.push(f.subarray(r,s));break}const p=i.lacingValues[o];if(s+=p,p<255){a.push(f.subarray(r,s));break e}o++}let h=i.headerStartPos+i.totalSize;for(;;){let p=this.reader.requestSliceRange(h,sc,Bu);if(p instanceof Promise&&(p=await p),!p)return null;const m=_f(p);if(!m)return null;if(i=m,i.serialNumber===e.serialNumber)break;h=i.headerStartPos+i.totalSize}r=0,s=0,o=0}const l=a.reduce((d,f)=>d+f.length,0),c=new Uint8Array(l);let u=0;for(let d=0;d<a.length;d++){const f=a[d];c.set(f,u),u+=f.length}return{data:c,endPage:i,endSegmentIndex:o}}async findNextPacketStart(e){if(e.endSegmentIndex<e.endPage.lacingValues.length-1)return{startPage:e.endPage,startSegmentIndex:e.endSegmentIndex+1};if(!!(e.endPage.headerType&4))return null;let r=e.endPage.headerStartPos+e.endPage.totalSize;for(;;){let i=this.reader.requestSliceRange(r,sc,Bu);if(i instanceof Promise&&(i=await i),!i)return null;const s=_f(i);if(!s)return null;if(s.serialNumber===e.endPage.serialNumber)return{startPage:s,startSegmentIndex:0};r=s.headerStartPos+s.totalSize}}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(n=>n.getCodecParameterString()));return lK({codecStrings:e.filter(Boolean)})}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}class fK{constructor(e,n){this.bitstream=e,this.demuxer=n,this.encodedPacketToMetadata=new WeakMap,this.sequentialScanCache=[],this.sequentialScanMutex=new kd,this.internalSampleRate=e.codecInfo.codec==="opus"?A0:e.sampleRate}getId(){return this.bitstream.serialNumber}getNumberOfChannels(){return this.bitstream.numberOfChannels}getSampleRate(){return this.bitstream.sampleRate}getTimeResolution(){return this.bitstream.sampleRate}getCodec(){return this.bitstream.codecInfo.codec}getInternalCodecId(){return null}async getDecoderConfig(){return K(this.bitstream.codecInfo.codec),{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:this.bitstream.description??void 0}}getName(){return null}getLanguageCode(){return Xi}async getFirstTimestamp(){return 0}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}granulePositionToTimestampInSamples(e){return this.bitstream.codecInfo.codec==="opus"?(K(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}createEncodedPacketFromOggPacket(e,n,r){if(!e)return null;const{durationInSamples:i,vorbisBlockSize:s}=aK(e.data,this.bitstream.codecInfo,n.vorbisLastBlocksize),o=new wn(r.metadataOnly?is:e.data,"key",Math.max(0,n.timestampInSamples)/this.internalSampleRate,i/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(o,{packet:e,timestampInSamples:n.timestampInSamples,durationInSamples:i,vorbisLastBlockSize:n.vorbisLastBlocksize,vorbisBlockSize:s}),o}async getFirstPacket(e){K(this.bitstream.lastMetadataPacket);const n=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!n)return null;let r=0;this.bitstream.codecInfo.codec==="opus"&&(K(this.bitstream.codecInfo.opusInfo),r-=this.bitstream.codecInfo.opusInfo.preSkip);const i=await this.demuxer.readPacket(n.startPage,n.startSegmentIndex);return this.createEncodedPacketFromOggPacket(i,{timestampInSamples:r,vorbisLastBlocksize:null},e)}async getNextPacket(e,n){const r=this.encodedPacketToMetadata.get(e);if(!r)throw new Error("Packet was not created from this track.");const i=await this.demuxer.findNextPacketStart(r.packet);if(!i)return null;const s=r.timestampInSamples+r.durationInSamples,o=await this.demuxer.readPacket(i.startPage,i.startSegmentIndex);return this.createEncodedPacketFromOggPacket(o,{timestampInSamples:s,vorbisLastBlocksize:r.vorbisBlockSize},n)}async getPacket(e,n){if(this.demuxer.reader.fileSize===null)return this.getPacketSequential(e,n);const r=Pm(e*this.internalSampleRate,14);if(r===0)return this.getFirstPacket(n);if(r<0)return null;K(this.bitstream.lastMetadataPacket);const i=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!i)return null;let s=i.startPage,o=this.demuxer.reader.fileSize;const a=[s];e:for(;s.headerStartPos+s.totalSize<o;){const w=s.headerStartPos,k=Math.floor((w+o)/2);let C=k;for(;;){const A=Math.min(C+cK,o-sc);let E=this.demuxer.reader.requestSlice(C,A-C);if(E instanceof Promise&&(E=await E),K(E),!uK(E,A)){o=k+sc;continue e}let S=this.demuxer.reader.requestSliceRange(E.filePos,sc,Bu);S instanceof Promise&&(S=await S),K(S);const x=_f(S);K(x);let _=!1;if(x.serialNumber===this.bitstream.serialNumber)_=!0;else{let D=this.demuxer.reader.requestSlice(x.headerStartPos,x.totalSize);D instanceof Promise&&(D=await D),K(D);const B=xt(D,x.totalSize);_=oK(B)===x.checksum}if(!_){C=x.headerStartPos+4;continue}if(_&&x.serialNumber!==this.bitstream.serialNumber){C=x.headerStartPos+x.totalSize;continue}if(x.granulePosition===-1){C=x.headerStartPos+x.totalSize;continue}this.granulePositionToTimestampInSamples(x.granulePosition)>r?o=x.headerStartPos:(s=x,a.push(x));continue e}}let l=i.startPage;for(const w of a){if(w.granulePosition===s.granulePosition)break;(!l||w.headerStartPos>l.headerStartPos)&&(l=w)}let c=l;const u=[c];for(;!(c.serialNumber===this.bitstream.serialNumber&&c.granulePosition===s.granulePosition);){const w=c.headerStartPos+c.totalSize;let k=this.demuxer.reader.requestSliceRange(w,sc,Bu);k instanceof Promise&&(k=await k),K(k);const C=_f(k);K(C),c=C,c.serialNumber===this.bitstream.serialNumber&&u.push(c)}K(c.granulePosition!==-1);let d=null,f,h,p=c,m=0;if(c.headerStartPos===i.startPage.headerStartPos)f=this.granulePositionToTimestampInSamples(0),h=!0,d=0;else{f=0,h=!1;for(let C=c.lacingValues.length-1;C>=0;C--)if(c.lacingValues[C]<255){d=C+1;break}if(d===null)throw new Error("Invalid page with granule position: no packets end on this page.");m=d-1;const w={data:is,endPage:p,endSegmentIndex:m};if(await this.demuxer.findNextPacketStart(w)){const C=FT(u,c,d);K(C);const A=$T(u,C.page,C.segmentIndex);A&&(c=A.page,d=A.segmentIndex)}else for(;;){const C=FT(u,c,d);if(!C)break;const A=$T(u,C.page,C.segmentIndex);if(!A)break;if(c=A.page,d=A.segmentIndex,C.page.headerStartPos!==p.headerStartPos){p=C.page,m=C.segmentIndex;break}}}let g=null,y=null;for(;c!==null;){K(d!==null);const w=await this.demuxer.readPacket(c,d);if(!w)break;if(!(c.headerStartPos===i.startPage.headerStartPos&&d<i.startSegmentIndex)){let A=this.createEncodedPacketFromOggPacket(w,{timestampInSamples:f,vorbisLastBlocksize:y?.vorbisBlockSize??null},n);K(A);let E=this.encodedPacketToMetadata.get(A);if(K(E),!h&&w.endPage.headerStartPos===p.headerStartPos&&w.endSegmentIndex===m?(f=this.granulePositionToTimestampInSamples(c.granulePosition),h=!0,A=this.createEncodedPacketFromOggPacket(w,{timestampInSamples:f-E.durationInSamples,vorbisLastBlocksize:y?.vorbisBlockSize??null},n),K(A),E=this.encodedPacketToMetadata.get(A),K(E)):f+=E.durationInSamples,g=A,y=E,h&&(Math.max(f,0)>r||Math.max(E.timestampInSamples,0)===r))break}const C=await this.demuxer.findNextPacketStart(w);if(!C)break;c=C.startPage,d=C.startSegmentIndex}return g}async getPacketSequential(e,n){const r=await this.sequentialScanMutex.acquire();try{const i=Pm(e*this.internalSampleRate,14);e=i/this.internalSampleRate;const s=cn(this.sequentialScanCache,i,l=>l.timestampInSamples);let o;if(s!==-1){const l=this.sequentialScanCache[s];o=this.createEncodedPacketFromOggPacket(l.packet,{timestampInSamples:l.timestampInSamples,vorbisLastBlocksize:l.vorbisLastBlockSize},n)}else o=await this.getFirstPacket(n);let a=0;for(;o&&o.timestamp<e;){const l=await this.getNextPacket(o,n);if(!l||l.timestamp>e)break;if(o=l,a++,a===100){a=0;const c=this.encodedPacketToMetadata.get(o);K(c),this.sequentialScanCache.length>0&&K(Qn(this.sequentialScanCache).timestampInSamples<=c.timestampInSamples),this.sequentialScanCache.push(c)}}return o}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const $T=(t,e,n)=>{let r=e,i=n;e:for(;;){for(i--,i;i>=0;i--)if(r.lacingValues[i]<255){i++;break e}if(K(i===-1),!(r.headerType&1)){i=0;break}const o=N4(t,a=>a.headerStartPos<r.headerStartPos);if(!o)return null;r=o,i=r.lacingValues.length}if(K(i!==-1),i===r.lacingValues.length){const s=t[t.indexOf(r)+1];K(s),r=s,i=0}return{page:r,segmentIndex:i}},FT=(t,e,n)=>{if(n>0)return{page:e,segmentIndex:n-1};const r=N4(t,i=>i.headerStartPos<e.headerStartPos);return r?{page:r,segmentIndex:r.lacingValues.length-1}:null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */var Mo;(function(t){t[t.PCM=1]="PCM",t[t.IEEE_FLOAT=3]="IEEE_FLOAT",t[t.ALAW=6]="ALAW",t[t.MULAW=7]="MULAW",t[t.EXTENSIBLE=65534]="EXTENSIBLE"})(Mo||(Mo={}));class hK extends Vc{constructor(e){super(e),this.metadataPromise=null,this.dataStart=-1,this.dataSize=-1,this.audioInfo=null,this.tracks=[],this.lastKnownPacketIndex=0,this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=this.reader.requestSlice(0,12);e instanceof Promise&&(e=await e),K(e);const n=Sr(e,4),r=n!=="RIFX",i=n==="RF64",s=al(e,r);let o=i?this.reader.fileSize:Math.min(s+8,this.reader.fileSize??1/0);if(Sr(e,4)!=="WAVE")throw new Error("Invalid WAVE file - wrong format");let l=0,c=null,u=e.filePos;for(;o===null||u<o;){let f=this.reader.requestSlice(u,8);if(f instanceof Promise&&(f=await f),!f)break;const h=Sr(f,4),p=al(f,r),m=f.filePos;if(i&&l===0&&h!=="ds64")throw new Error('Invalid RF64 file: First chunk must be "ds64".');if(h==="fmt ")await this.parseFmtChunk(m,p,r);else if(h==="data"){if(c??=p,this.dataStart=f.filePos,this.dataSize=Math.min(c,(o??1/0)-this.dataStart),this.reader.fileSize===null)break}else if(h==="ds64"){let g=this.reader.requestSlice(m,p);if(g instanceof Promise&&(g=await g),!g)break;const y=HT(g,r);c=HT(g,r),o=Math.min(y+8,this.reader.fileSize??1/0)}else h==="LIST"?await this.parseListChunk(m,p,r):(h==="ID3 "||h==="id3 ")&&await this.parseId3Chunk(m,p);u=m+p+(p&1),l++}if(!this.audioInfo)throw new Error('Invalid WAVE file - missing "fmt " chunk');if(this.dataStart===-1)throw new Error('Invalid WAVE file - missing "data" chunk');const d=this.audioInfo.blockSizeInBytes;this.dataSize=Math.floor(this.dataSize/d)*d,this.tracks.push(new ma(this.input,new pK(this)))})()}async parseFmtChunk(e,n,r){let i=this.reader.requestSlice(e,n);if(i instanceof Promise&&(i=await i),!i)return;let s=Zd(i,r);const o=Zd(i,r),a=al(i,r);i.skip(4);const l=Zd(i,r);let c;if(n===14?c=8:c=Zd(i,r),n>=18&&s!==357){const u=Zd(i,r),d=n-18;if(Math.min(d,u)>=22&&s===Mo.EXTENSIBLE){i.skip(6);const h=xt(i,16);s=h[0]|h[1]<<8}}(s===Mo.MULAW||s===Mo.ALAW)&&(c=8),this.audioInfo={format:s,numberOfChannels:o,sampleRate:a,sampleSizeInBytes:Math.ceil(c/8),blockSizeInBytes:l}}async parseListChunk(e,n,r){let i=this.reader.requestSlice(e,n);if(i instanceof Promise&&(i=await i),!i)return;const s=Sr(i,4);if(s!=="INFO"&&s!=="INF0")return;let o=i.filePos;for(;o<=e+n-8;){i.filePos=o;const a=Sr(i,4),l=al(i,r),c=xt(i,l);let u=0;for(let f=0;f<c.length&&c[f]!==0;f++)u++;const d=String.fromCharCode(...c.subarray(0,u));switch(this.metadataTags.raw??={},this.metadataTags.raw[a]=d,a){case"INAM":case"TITL":this.metadataTags.title??=d;break;case"TIT3":this.metadataTags.description??=d;break;case"IART":this.metadataTags.artist??=d;break;case"IPRD":this.metadataTags.album??=d;break;case"IPRT":case"ITRK":case"TRCK":{const f=d.split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(this.metadataTags.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(this.metadataTags.tracksTotal??=p)}break;case"ICRD":case"IDIT":{const f=new Date(d);Number.isNaN(f.getTime())||(this.metadataTags.date??=f)}break;case"YEAR":{const f=Number.parseInt(d,10);Number.isInteger(f)&&f>0&&(this.metadataTags.date??=new Date(f,0,1))}break;case"IGNR":case"GENR":this.metadataTags.genre??=d;break;case"ICMT":case"CMNT":case"COMM":this.metadataTags.comment??=d;break}o+=8+l+(l&1)}}async parseId3Chunk(e,n){let r=this.reader.requestSlice(e,n);if(r instanceof Promise&&(r=await r),!r)return;const i=Lm(r);if(i){const s=r.slice(e+10,i.size);fM(s,i,this.metadataTags)}}getCodec(){if(K(this.audioInfo),this.audioInfo.format===Mo.MULAW)return"ulaw";if(this.audioInfo.format===Mo.ALAW)return"alaw";if(this.audioInfo.format===Mo.PCM){if(this.audioInfo.sampleSizeInBytes===1)return"pcm-u8";if(this.audioInfo.sampleSizeInBytes===2)return"pcm-s16";if(this.audioInfo.sampleSizeInBytes===3)return"pcm-s24";if(this.audioInfo.sampleSizeInBytes===4)return"pcm-s32"}return this.audioInfo.format===Mo.IEEE_FLOAT&&this.audioInfo.sampleSizeInBytes===4?"pcm-f32":null}async getMimeType(){return"audio/wav"}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return K(e),e.computeDuration()}async getTracks(){return await this.readMetadata(),this.tracks}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}const su=2048;class pK{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return this.demuxer.getCodec()}getInternalCodecId(){return K(this.demuxer.audioInfo),this.demuxer.audioInfo.format}async getDecoderConfig(){const e=this.demuxer.getCodec();return e?(K(this.demuxer.audioInfo),{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}):null}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getNumberOfChannels(){return K(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}getSampleRate(){return K(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getTimeResolution(){return K(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return Xi}async getFirstTimestamp(){return 0}async getPacketAtIndex(e,n){K(this.demuxer.audioInfo);const r=e*su*this.demuxer.audioInfo.blockSizeInBytes;if(r>=this.demuxer.dataSize)return null;const i=Math.min(su*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-r);if(this.demuxer.reader.fileSize===null){let l=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,i);if(l instanceof Promise&&(l=await l),!l)return null}let s;if(n.metadataOnly)s=is;else{let l=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,i);l instanceof Promise&&(l=await l),K(l),s=xt(l,i)}const o=e*su/this.demuxer.audioInfo.sampleRate,a=i/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate;return this.demuxer.lastKnownPacketIndex=Math.max(e,o),new wn(s,"key",o,a,e,i)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getPacket(e,n){K(this.demuxer.audioInfo);const r=Math.floor(Math.min(e*this.demuxer.audioInfo.sampleRate/su,(this.demuxer.dataSize-1)/(su*this.demuxer.audioInfo.blockSizeInBytes))),i=await this.getPacketAtIndex(r,n);if(i)return i;if(r===0)return null;K(this.demuxer.reader.fileSize===null);let s=await this.getPacketAtIndex(this.demuxer.lastKnownPacketIndex,n);for(;s;){const o=await this.getNextPacket(s,n);if(!o)break;s=o}return s}getNextPacket(e,n){K(this.demuxer.audioInfo);const r=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/su);return this.getPacketAtIndex(r+1,n)}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Dm=7,Bm=9,Wv=t=>{const e=t.filePos,n=xt(t,9),r=new Wn(n);if(r.readBits(12)!==4095||(r.skipBits(1),r.readBits(2)!==0))return null;const o=r.readBits(1),a=r.readBits(2)+1,l=r.readBits(4);if(l===15)return null;r.skipBits(1);const c=r.readBits(3);if(c===0)throw new Error("ADTS frames with channel configuration 0 are not supported.");r.skipBits(1),r.skipBits(1),r.skipBits(1),r.skipBits(1);const u=r.readBits(13);r.skipBits(11);const d=r.readBits(2)+1;if(d!==1)throw new Error("ADTS frames with more than one AAC frame are not supported.");let f=null;return o===1?t.filePos-=2:f=r.readBits(16),{objectType:a,samplingFrequencyIndex:l,channelConfiguration:c,frameLength:u,numberOfAacFrames:d,crcCheck:f,startPos:e}};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const qv=1024;class mK extends Vc{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.tracks=[],this.readingMutex=new kd,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();K(this.firstFrameHeader),this.tracks=[new ma(this.input,new gK(this))]})()}async advanceReader(){let e=this.reader.requestSliceRange(this.lastLoadedPos,Dm,Bm);if(e instanceof Promise&&(e=await e),!e){this.lastSampleLoaded=!0;return}const n=Wv(e);if(!n){this.lastSampleLoaded=!0;return}if(this.reader.fileSize!==null&&n.startPos+n.frameLength>this.reader.fileSize){this.lastSampleLoaded=!0;return}this.firstFrameHeader||(this.firstFrameHeader=n);const r=Om[n.samplingFrequencyIndex];K(r!==void 0);const i=qv/r,s=n.crcCheck?Bm:Dm,o={timestamp:this.nextTimestampInSamples/r,duration:i,dataStart:n.startPos+s,dataSize:n.frameLength-s};this.loadedSamples.push(o),this.nextTimestampInSamples+=qv,this.lastLoadedPos=n.startPos+n.frameLength}async getMimeType(){return"audio/aac"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return K(e),e.computeDuration()}async getMetadataTags(){return{}}}class gK{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return this.getSampleRate()/qv}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return Xi}getCodec(){return"aac"}getInternalCodecId(){return K(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.objectType}getNumberOfChannels(){K(this.demuxer.firstFrameHeader);const e=H4[this.demuxer.firstFrameHeader.channelConfiguration];return K(e!==void 0),e}getSampleRate(){K(this.demuxer.firstFrameHeader);const e=Om[this.demuxer.firstFrameHeader.samplingFrequencyIndex];return K(e!==void 0),e}async getDecoderConfig(){K(this.demuxer.firstFrameHeader);const e=new Uint8Array(3),n=new Wn(e),{objectType:r,samplingFrequencyIndex:i,channelConfiguration:s}=this.demuxer.firstFrameHeader;return r>31?(n.writeBits(5,31),n.writeBits(6,r-32)):n.writeBits(5,r),n.writeBits(4,i),n.writeBits(4,s),{codec:`mp4a.40.${this.demuxer.firstFrameHeader.objectType}`,numberOfChannels:this.getNumberOfChannels(),sampleRate:this.getSampleRate(),description:e.subarray(0,Math.ceil((n.pos-1)/8))}}async getPacketAtIndex(e,n){if(e===-1)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=is;else{let s=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize);if(s instanceof Promise&&(s=await s),!s)return null;i=xt(s,r.dataSize)}return new wn(i,"key",r.timestamp,r.duration,e,r.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=px(this.demuxer.loadedSamples,e.timestamp,o=>o.timestamp);if(i===-1)throw new Error("Packet was not created from this track.");const s=i+1;for(;s>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(s,n)}finally{r()}}async getPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=cn(this.demuxer.loadedSamples,e,s=>s.timestamp);if(i===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(i,n);if(i>=0&&i+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(i,n);await this.demuxer.advanceReader()}}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const yK=t=>t===0?null:t===1?192:t>=2&&t<=5?144*2**t:t===6?"uncommon-u8":t===7?"uncommon-u16":t>=8&&t<=15?2**t:null,bK=(t,e)=>{switch(t){case 0:return e;case 1:return 88200;case 2:return 176400;case 3:return 192e3;case 4:return 8e3;case 5:return 16e3;case 6:return 22050;case 7:return 24e3;case 8:return 32e3;case 9:return 44100;case 10:return 48e3;case 11:return 96e3;case 12:return"uncommon-u8";case 13:return"uncommon-u16";case 14:return"uncommon-u16-10";default:return null}},wK=t=>{let e=0;const n=new Wn(xt(t,1));for(;n.readBits(1)===1;)e++;if(e===0)return n.readBits(7);const r=[],i=e-1,s=new Wn(xt(t,i)),o=8-e-1;for(let l=0;l<o;l++)r.unshift(n.readBits(1));for(let l=0;l<i;l++)for(let c=0;c<8;c++){const u=s.readBits(1);c<2||r.unshift(u)}return r.reduce((l,c,u)=>l|c<<u,0)},vK=(t,e)=>{if(e==="uncommon-u16")return Ir(t)+1;if(e==="uncommon-u8")return lt(t)+1;if(typeof e=="number")return e;Al(e),K(!1)},xK=(t,e)=>e==="uncommon-u16"?Ir(t):e==="uncommon-u16-10"?Ir(t)*10:e==="uncommon-u8"?lt(t):typeof e=="number"?e:null,SK=t=>{let n=0;for(const r of t){n^=r;for(let i=0;i<8;i++)(n&128)!==0?n=n<<1^7:n<<=1,n&=255}return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class EK extends Vc{constructor(e){super(e),this.loadedSamples=[],this.metadataPromise=null,this.track=null,this.metadataTags={},this.audioInfo=null,this.lastLoadedPos=null,this.blockingBit=null,this.readingMutex=new kd,this.lastSampleLoaded=!1,this.reader=e._reader}async computeDuration(){return await this.readMetadata(),K(this.track),this.track.computeDuration()}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}async getTracks(){return await this.readMetadata(),K(this.track),[this.track]}async getMimeType(){return"audio/flac"}async readMetadata(){let e=4;return this.metadataPromise??=(async()=>{for(;this.reader.fileSize===null||e<this.reader.fileSize;){let n=this.reader.requestSlice(e,4);if(n instanceof Promise&&(n=await n),e+=4,n===null)throw new Error(`Metadata block at position ${e} is too small! Corrupted file.`);K(n);const r=lt(n),i=fu(n),s=(r&128)!==0;switch(r&127){case Du.STREAMINFO:{let a=this.reader.requestSlice(e,i);if(a instanceof Promise&&(a=await a),K(a),a===null)throw new Error(`StreamInfo block at position ${e} is too small! Corrupted file.`);const l=xt(a,34),c=new Wn(l),u=c.readBits(16),d=c.readBits(16),f=c.readBits(24),h=c.readBits(24),p=c.readBits(20),m=c.readBits(3)+1;c.readBits(5);const g=c.readBits(36);c.skipBits(128);const y=new Uint8Array(42);y.set(new Uint8Array([102,76,97,67]),0),y.set(new Uint8Array([128,0,0,34]),4),y.set(l,8),this.audioInfo={numberOfChannels:m,sampleRate:p,totalSamples:g,minimumBlockSize:u,maximumBlockSize:d,minimumFrameSize:f,maximumFrameSize:h,description:y},this.track=new ma(this.input,new kK(this));break}case Du.VORBIS_COMMENT:{let a=this.reader.requestSlice(e,i);a instanceof Promise&&(a=await a),K(a),Bv(xt(a,i),this.metadataTags);break}case Du.PICTURE:{let a=this.reader.requestSlice(e,i);a instanceof Promise&&(a=await a),K(a);const l=He(a),c=He(a),u=Ji.decode(xt(a,c)),d=He(a),f=Ji.decode(xt(a,d));a.skip(16);const h=He(a),p=xt(a,h);this.metadataTags.images??=[],this.metadataTags.images.push({data:p,mimeType:u,kind:l===3?"coverFront":l===4?"coverBack":"unknown",description:f});break}}if(e+=i,s){this.lastLoadedPos=e;break}}})()}async readNextFlacFrame({startPos:e,isFirstPacket:n}){K(this.audioInfo);const r=6,s=this.audioInfo.maximumFrameSize+16,o=await this.reader.requestSliceRange(e,this.audioInfo.minimumFrameSize,s);if(!o)return null;const a=this.readFlacFrameHeader({slice:o,isFirstPacket:n});if(!a)return null;for(o.filePos=e+this.audioInfo.minimumFrameSize;;){if(o.filePos>o.end-r)return{num:a.num,blockSize:a.blockSize,sampleRate:a.sampleRate,size:o.end-e,isLastFrame:!0};if(lt(o)===255){const c=lt(o),u=this.blockingBit===1?249:248;if(c!==u){o.skip(-1);continue}o.skip(-2);const d=o.filePos-e;if(!this.readFlacFrameHeader({slice:o,isFirstPacket:!1})){o.skip(-1);continue}return{num:a.num,blockSize:a.blockSize,sampleRate:a.sampleRate,size:d,isLastFrame:!1}}}}readFlacFrameHeader({slice:e,isFirstPacket:n}){const r=e.filePos,i=xt(e,4),s=new Wn(i);if(s.readBits(15)!==32764)return null;if(this.blockingBit===null){K(n);const g=s.readBits(1);this.blockingBit=g}else if(this.blockingBit===1){if(K(!n),s.readBits(1)!==1)return null}else if(this.blockingBit===0){if(K(!n),s.readBits(1)!==0)return null}else throw new Error("Invalid blocking bit");const a=yK(s.readBits(4));if(!a)return null;K(this.audioInfo);const l=bK(s.readBits(4),this.audioInfo.sampleRate);if(!l||(s.readBits(4),s.readBits(3),s.readBits(1)!==0))return null;const u=wK(e),d=vK(e,a),f=xK(e,l);if(f===null)return null;const h=e.filePos-r,p=lt(e);e.skip(-h),e.skip(-1);const m=SK(xt(e,h));return p!==m?null:{num:u,blockSize:d,sampleRate:f}}async advanceReader(){await this.readMetadata(),K(this.lastLoadedPos!==null),K(this.audioInfo);const e=this.lastLoadedPos,n=await this.readNextFlacFrame({startPos:e,isFirstPacket:this.loadedSamples.length===0});if(!n){this.lastSampleLoaded=!0;return}const r=this.loadedSamples[this.loadedSamples.length-1],s={blockOffset:r?r.blockOffset+r.blockSize:0,blockSize:n.blockSize,byteOffset:e,byteSize:n.size};if(this.lastLoadedPos=this.lastLoadedPos+n.size,this.loadedSamples.push(s),n.isLastFrame){this.lastSampleLoaded=!0;return}}}class kK{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return"flac"}getInternalCodecId(){return null}getNumberOfChannels(){return K(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getSampleRate(){return K(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return Xi}getTimeResolution(){return K(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}async getFirstTimestamp(){return 0}async getDecoderConfig(){return K(this.demuxer.audioInfo),{codec:"flac",numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate,description:this.demuxer.audioInfo.description}}async getPacket(e,n){if(K(this.demuxer.audioInfo),e<0)throw new Error("Timestamp cannot be negative");const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=cn(this.demuxer.loadedSamples,e,l=>l.blockOffset/this.demuxer.audioInfo.sampleRate);if(i===-1){await this.demuxer.advanceReader();continue}const s=this.demuxer.loadedSamples[i],o=s.blockOffset/this.demuxer.audioInfo.sampleRate,a=s.blockSize/this.demuxer.audioInfo.sampleRate;if(o+a<=e){if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(this.demuxer.loadedSamples.length-1,n);await this.demuxer.advanceReader();continue}return this.getPacketAtIndex(i,n)}}finally{r()}}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=e.sequenceNumber+1;if(this.demuxer.lastSampleLoaded&&i>=this.demuxer.loadedSamples.length)return null;for(;i>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(i,n)}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}async getPacketAtIndex(e,n){const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=is;else{let a=this.demuxer.reader.requestSlice(r.byteOffset,r.byteSize);if(a instanceof Promise&&(a=await a),!a)return null;i=xt(a,r.byteSize)}K(this.demuxer.audioInfo);const s=r.blockOffset/this.demuxer.audioInfo.sampleRate,o=r.blockSize/this.demuxer.audioInfo.sampleRate;return new wn(i,"key",s,o,e,r.byteSize)}async getFirstPacket(e){for(;this.demuxer.loadedSamples.length===0&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(0,e)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Fl{}class mM extends Fl{async _getMajorBrand(e){let n=e._reader.requestSlice(0,12);return n instanceof Promise&&(n=await n),!n||(n.skip(4),Sr(n,4)!=="ftyp")?null:Sr(n,4)}_createDemuxer(e){return new Nq(e)}}class TK extends mM{async _canReadInput(e){const n=await this._getMajorBrand(e);return!!n&&n!=="qt  "}get name(){return"MP4"}get mimeType(){return"video/mp4"}}class _K extends mM{async _canReadInput(e){return await this._getMajorBrand(e)==="qt  "}get name(){return"QuickTime File Format"}get mimeType(){return"video/quicktime"}}class gM extends Fl{async isSupportedEBMLOfDocType(e,n){let r=e._reader.requestSlice(0,Uo);if(r instanceof Promise&&(r=await r),!r)return!1;const i=oM(r);if(i===null||i<1||i>8||Vt(r,i)!==Se.EBML)return!1;const o=aM(r);if(o===null)return!1;let a=e._reader.requestSlice(r.filePos,o);if(a instanceof Promise&&(a=await a),!a)return!1;const l=r.filePos;for(;a.filePos<=l+o-ws;){const c=Ro(a);if(!c)break;const{id:u,size:d}=c,f=a.filePos;if(d===null)return!1;switch(u){case Se.EBMLVersion:if(Vt(a,d)!==1)return!1;break;case Se.EBMLReadVersion:if(Vt(a,d)!==1)return!1;break;case Se.DocType:if(du(a,d)!==n)return!1;break;case Se.DocTypeVersion:if(Vt(a,d)>4)return!1;break}a.filePos=f+d}return!0}_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"matroska")}_createDemuxer(e){return new jq(e)}get name(){return"Matroska"}get mimeType(){return"video/x-matroska"}}class CK extends gM{_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"webm")}get name(){return"WebM"}get mimeType(){return"video/webm"}}class AK extends Fl{async _canReadInput(e){let n=e._reader.requestSlice(0,10);if(n instanceof Promise&&(n=await n),!n)return!1;let r=0,i=!1;for(;;){let c=e._reader.requestSlice(r,Rm);if(c instanceof Promise&&(c=await c),!c)break;const u=Lm(c);if(!u)break;i=!0,r=c.filePos+u.size}const s=await jv(e._reader,r,r+4096);if(!s)return!1;if(i)return!0;r=s.startPos+s.header.totalSize;const o=await jv(e._reader,r,r+dM);if(!o)return!1;const a=s.header,l=o.header;return!(a.channel!==l.channel||a.sampleRate!==l.sampleRate)}_createDemuxer(e){return new rK(e)}get name(){return"MP3"}get mimeType(){return"audio/mpeg"}}class IK extends Fl{async _canReadInput(e){let n=e._reader.requestSlice(0,12);if(n instanceof Promise&&(n=await n),!n)return!1;const r=Sr(n,4);return r!=="RIFF"&&r!=="RIFX"&&r!=="RF64"?!1:(n.skip(4),Sr(n,4)==="WAVE")}_createDemuxer(e){return new hK(e)}get name(){return"WAVE"}get mimeType(){return"audio/wav"}}class PK extends Fl{async _canReadInput(e){let n=e._reader.requestSlice(0,4);return n instanceof Promise&&(n=await n),n?Sr(n,4)==="OggS":!1}_createDemuxer(e){return new dK(e)}get name(){return"Ogg"}get mimeType(){return"application/ogg"}}class MK extends Fl{async _canReadInput(e){let n=e._reader.requestSlice(0,4);return n instanceof Promise&&(n=await n),n?Sr(n,4)==="fLaC":!1}get name(){return"FLAC"}get mimeType(){return"audio/flac"}_createDemuxer(e){return new EK(e)}}class OK extends Fl{async _canReadInput(e){let n=e._reader.requestSliceRange(0,Dm,Bm);if(n instanceof Promise&&(n=await n),!n)return!1;const r=Wv(n);if(!r||(n=e._reader.requestSliceRange(r.frameLength,Dm,Bm),n instanceof Promise&&(n=await n),!n))return!1;const i=Wv(n);return i?r.objectType===i.objectType&&r.samplingFrequencyIndex===i.samplingFrequencyIndex&&r.channelConfiguration===i.channelConfiguration:!1}_createDemuxer(e){return new mK(e)}get name(){return"ADTS"}get mimeType(){return"audio/aac"}}const NK=new TK,RK=new _K,LK=new gM,DK=new CK,BK=new AK,$K=new IK,FK=new PK,zK=new OK,UK=new MK,zT=[NK,RK,LK,DK,$K,FK,UK,BK,zK];/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class yM{constructor(){this._disposed=!1,this._sizePromise=null,this.onread=null}async getSizeOrNull(){if(this._disposed)throw new Pi;return this._sizePromise??=Promise.resolve(this._retrieveSize())}async getSize(){if(this._disposed)throw new Pi;const e=await this.getSizeOrNull();if(e===null)throw new Error("Cannot determine the size of an unsized source.");return e}}class UT extends yM{constructor(e,n={}){if(!(e instanceof Blob))throw new TypeError("blob must be a Blob.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(n.maxCacheSize!==void 0&&(!$4(n.maxCacheSize)||n.maxCacheSize<0))throw new TypeError("options.maxCacheSize, when provided, must be a non-negative number.");super(),this._readers=new WeakMap,this._blob=e,this._orchestrator=new VK({maxCacheSize:n.maxCacheSize??8*2**20,maxWorkerCount:4,runWorker:this._runWorker.bind(this),prefetchProfile:HK.fileSystem})}_retrieveSize(){const e=this._blob.size;return this._orchestrator.fileSize=e,e}_read(e,n){return this._orchestrator.read(e,n)}async _runWorker(e){let n=this._readers.get(e);for(n===void 0&&("stream"in this._blob?n=this._blob.slice(e.currentPos).stream().getReader():n=null,this._readers.set(e,n));e.currentPos<e.targetPos&&!e.aborted;)if(n){const{done:r,value:i}=await n.read();if(r){if(this._orchestrator.forgetWorker(e),e.currentPos<e.targetPos)throw new Error("Blob reader stopped unexpectedly before all requested data was read.");break}this.onread?.(e.currentPos,e.currentPos+i.length),this._orchestrator.supplyWorkerData(e,i)}else{const r=await this._blob.slice(e.currentPos,e.targetPos).arrayBuffer();this.onread?.(e.currentPos,e.currentPos+r.byteLength),this._orchestrator.supplyWorkerData(e,new Uint8Array(r))}e.running=!1}_dispose(){this._orchestrator.dispose()}}const HK={fileSystem:(t,e)=>(t=Math.floor((t-65536)/65536)*65536,e=Math.ceil((e+65536)/65536)*65536,{start:t,end:e})};class VK{constructor(e){this.options=e,this.fileSize=null,this.nextAge=0,this.workers=[],this.cache=[],this.currentCacheSize=0,this.disposed=!1}read(e,n){K(this.fileSize!==null);const r=this.options.prefetchProfile(e,n,this.workers),i=Math.max(r.start,0),s=Math.min(r.end,this.fileSize);K(i<=e&&n<=s);let o=null;const a=cn(this.cache,e,w=>w.start),l=a!==-1?this.cache[a]:null;l&&l.start<=e&&n<=l.end&&(l.age=this.nextAge++,o={bytes:l.bytes,view:l.view,offset:l.start});const c=cn(this.cache,i,w=>w.start),u=o?null:new Uint8Array(n-e);let d=0,f=i;const h=[];if(c!==-1){for(let w=c;w<this.cache.length;w++){const k=this.cache[w];if(k.start>=s)break;if(k.end<=i)continue;const C=Math.max(i,k.start),A=Math.min(s,k.end);if(K(C<=A),f<C&&h.push({start:f,end:C}),f=A,u){const E=Math.max(e,k.start),P=Math.min(n,k.end);if(E<P){const S=E-e;u.set(k.bytes.subarray(E-k.start,P-k.start),S),S===d&&(d=P-e)}}k.age=this.nextAge++}f<s&&h.push({start:f,end:s})}else h.push({start:i,end:s});if(u&&d>=u.length&&(o={bytes:u,view:$r(u),offset:e}),h.length===0)return K(o),o;const{promise:p,resolve:m,reject:g}=Rr(),y=[];for(const w of h){const k=Math.max(e,w.start),C=Math.min(n,w.end);k===w.start&&C===w.end?y.push(w):k<C&&y.push({start:k,end:C})}for(const w of h){const k=u&&{start:e,bytes:u,holes:y,resolve:m,reject:g};let C=!1;for(const A of this.workers)if(CT(w.start-131072,w.start,A.currentPos,A.targetPos)){A.targetPos=Math.max(A.targetPos,w.end),C=!0,k&&!A.pendingSlices.includes(k)&&A.pendingSlices.push(k),A.running||this.runWorker(A);break}if(!C){const A=this.createWorker(w.start,w.end);k&&(A.pendingSlices=[k]),this.runWorker(A)}}return o||(K(u),o=p.then(w=>({bytes:w,view:$r(w),offset:e}))),o}createWorker(e,n){const r={startPos:e,currentPos:e,targetPos:n,running:!1,aborted:!1,pendingSlices:[],age:this.nextAge++};for(this.workers.push(r);this.workers.length>this.options.maxWorkerCount;){let i=0,s=this.workers[0];for(let o=1;o<this.workers.length;o++){const a=this.workers[o];a.age<s.age&&(i=o,s=a)}if(s.running&&s.pendingSlices.length>0)break;s.aborted=!0,this.workers.splice(i,1)}return r}runWorker(e){K(!e.running),K(e.currentPos<e.targetPos),e.running=!0,e.age=this.nextAge++,this.options.runWorker(e).catch(n=>{if(e.running=!1,e.pendingSlices.length>0)e.pendingSlices.forEach(r=>r.reject(n)),e.pendingSlices.length=0;else throw n})}supplyWorkerData(e,n){if(this.disposed)return;const r=e.currentPos,i=r+n.length;this.insertIntoCache({start:r,end:i,bytes:n,view:$r(n),age:this.nextAge++}),e.currentPos+=n.length,e.targetPos=Math.max(e.targetPos,e.currentPos);for(let s=0;s<e.pendingSlices.length;s++){const o=e.pendingSlices[s],a=Math.max(r,o.start),l=Math.min(i,o.start+o.bytes.length);a<l&&o.bytes.set(n.subarray(a-r,l-r),a-o.start);for(let c=0;c<o.holes.length;c++){const u=o.holes[c];r<=u.start&&i>u.start&&(u.start=i),u.end<=u.start&&(o.holes.splice(c,1),c--)}o.holes.length===0&&(o.resolve(o.bytes),e.pendingSlices.splice(s,1),s--)}for(let s=0;s<this.workers.length;s++){const o=this.workers[s];e===o||o.running||CT(r,i,o.currentPos,o.targetPos)&&(this.workers.splice(s,1),s--)}}forgetWorker(e){const n=this.workers.indexOf(e);K(n!==-1),this.workers.splice(n,1)}insertIntoCache(e){if(this.options.maxCacheSize===0)return;let n=cn(this.cache,e.start,r=>r.start)+1;if(n>0){const r=this.cache[n-1];if(r.end>=e.end)return;if(r.end>e.start){const i=new Uint8Array(e.end-r.start);i.set(r.bytes,0),i.set(e.bytes,e.start-r.start),this.currentCacheSize+=e.end-r.end,r.bytes=i,r.view=$r(i),r.end=e.end,n--,e=r}else this.cache.splice(n,0,e),this.currentCacheSize+=e.bytes.length}else this.cache.splice(n,0,e),this.currentCacheSize+=e.bytes.length;for(let r=n+1;r<this.cache.length;r++){const i=this.cache[r];if(e.end<=i.start)break;if(e.end>=i.end){this.cache.splice(r,1),this.currentCacheSize-=i.bytes.length,r--;continue}const s=new Uint8Array(i.end-e.start);s.set(e.bytes,0),s.set(i.bytes,i.start-e.start),this.currentCacheSize-=e.end-i.start,e.bytes=s,e.view=$r(s),e.end=i.end,this.cache.splice(r,1);break}for(;this.currentCacheSize>this.options.maxCacheSize;){let r=0,i=this.cache[0];for(let s=1;s<this.cache.length;s++){const o=this.cache[s];o.age<i.age&&(r=s,i=o)}if(this.currentCacheSize-i.bytes.length<=this.options.maxCacheSize)break;this.cache.splice(r,1),this.currentCacheSize-=i.bytes.length}}dispose(){for(const e of this.workers)e.aborted=!0;this.workers.length=0,this.cache.length=0,this.disposed=!0}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */B4();class Kv{get disposed(){return this._disposed}constructor(e){if(this._demuxerPromise=null,this._format=null,this._disposed=!1,!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Array.isArray(e.formats)||e.formats.some(n=>!(n instanceof Fl)))throw new TypeError("options.formats must be an array of InputFormat.");if(!(e.source instanceof yM))throw new TypeError("options.source must be a Source.");if(e.source._disposed)throw new Error("options.source must not be disposed.");this._formats=e.formats,this._source=e.source,this._reader=new jK(e.source)}_getDemuxer(){return this._demuxerPromise??=(async()=>{this._reader.fileSize=await this._source.getSizeOrNull();for(const e of this._formats)if(await e._canReadInput(this))return this._format=e,e._createDemuxer(this);throw new Error("Input has an unsupported or unrecognizable format.")})()}get source(){return this._source}async getFormat(){return await this._getDemuxer(),K(this._format),this._format}async computeDuration(){return(await this._getDemuxer()).computeDuration()}async getTracks(){return(await this._getDemuxer()).getTracks()}async getVideoTracks(){return(await this.getTracks()).filter(n=>n.isVideoTrack())}async getAudioTracks(){return(await this.getTracks()).filter(n=>n.isAudioTrack())}async getPrimaryVideoTrack(){return(await this.getTracks()).find(n=>n.isVideoTrack())??null}async getPrimaryAudioTrack(){return(await this.getTracks()).find(n=>n.isAudioTrack())??null}async getMimeType(){return(await this._getDemuxer()).getMimeType()}async getMetadataTags(){return(await this._getDemuxer()).getMetadataTags()}dispose(){this._disposed||(this._disposed=!0,this._source._disposed=!0,this._source._dispose())}[Symbol.dispose](){this.dispose()}}class Pi extends Error{constructor(e="Input has been disposed."){super(e),this.name="InputDisposedError"}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class jK{constructor(e){this.source=e}requestSlice(e,n){if(this.source._disposed)throw new Pi;if(this.fileSize!==null&&e+n>this.fileSize)return null;const r=e+n,i=this.source._read(e,r);return i instanceof Promise?i.then(s=>s?new sd(s.bytes,s.view,s.offset,e,r):null):i?new sd(i.bytes,i.view,i.offset,e,r):null}requestSliceRange(e,n,r){if(this.source._disposed)throw new Pi;if(this.fileSize!==null)return this.requestSlice(e,pr(this.fileSize-e,n,r));{const i=this.requestSlice(e,r),s=o=>{if(o)return o;const a=c=>(K(c!==null),this.requestSlice(e,pr(c-e,n,r))),l=this.source._retrieveSize();return l instanceof Promise?l.then(a):a(l)};return i instanceof Promise?i.then(s):s(i)}}}class sd{constructor(e,n,r,i,s){this.bytes=e,this.view=n,this.offset=r,this.start=i,this.end=s,this.bufferPos=i-r}static tempFromBytes(e){return new sd(e,$r(e),0,0,e.length)}get length(){return this.end-this.start}get filePos(){return this.offset+this.bufferPos}set filePos(e){this.bufferPos=e-this.offset}get remainingLength(){return Math.max(this.end-this.filePos,0)}skip(e){this.bufferPos+=e}slice(e,n=this.end-e){if(e<this.start||e+n>this.end)throw new RangeError("Slicing outside of original slice.");return new sd(this.bytes,this.view,this.offset,e,e+n)}}const Si=(t,e)=>{if(t.filePos<t.start||t.filePos+e>t.end)throw new RangeError(`Tried reading [${t.filePos}, ${t.filePos+e}), but slice is [${t.start}, ${t.end}). This is likely an internal error, please report it alongside the file that caused it.`)},xt=(t,e)=>{Si(t,e);const n=t.bytes.subarray(t.bufferPos,t.bufferPos+e);return t.bufferPos+=e,n},lt=t=>(Si(t,1),t.view.getUint8(t.bufferPos++)),Zd=(t,e)=>{Si(t,2);const n=t.view.getUint16(t.bufferPos,e);return t.bufferPos+=2,n},Ir=t=>{Si(t,2);const e=t.view.getUint16(t.bufferPos,!1);return t.bufferPos+=2,e},fu=t=>{Si(t,3);const e=_0(t.view,t.bufferPos,!1);return t.bufferPos+=3,e},Gv=t=>{Si(t,2);const e=t.view.getInt16(t.bufferPos,!1);return t.bufferPos+=2,e},al=(t,e)=>{Si(t,4);const n=t.view.getUint32(t.bufferPos,e);return t.bufferPos+=4,n},He=t=>{Si(t,4);const e=t.view.getUint32(t.bufferPos,!1);return t.bufferPos+=4,e},Eu=t=>{Si(t,4);const e=t.view.getUint32(t.bufferPos,!0);return t.bufferPos+=4,e},oc=t=>{Si(t,4);const e=t.view.getInt32(t.bufferPos,!1);return t.bufferPos+=4,e},WK=t=>{Si(t,4);const e=t.view.getInt32(t.bufferPos,!0);return t.bufferPos+=4,e},HT=(t,e)=>{let n,r;return e?(n=al(t,!0),r=al(t,!0)):(r=al(t,!1),n=al(t,!1)),r*4294967296+n},ps=t=>{const e=He(t),n=He(t);return e*4294967296+n},qK=t=>{const e=oc(t),n=He(t);return e*4294967296+n},KK=t=>{const e=Eu(t);return WK(t)*4294967296+e},GK=t=>{Si(t,4);const e=t.view.getFloat32(t.bufferPos,!1);return t.bufferPos+=4,e},bM=t=>{Si(t,8);const e=t.view.getFloat64(t.bufferPos,!1);return t.bufferPos+=8,e},Sr=(t,e)=>{Si(t,e);let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t.bytes[t.bufferPos++]);return n};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const VT=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,ZK=t=>{const e=Math.floor(t/36e5),n=Math.floor(t%(3600*1e3)/(60*1e3)),r=Math.floor(t%(60*1e3)/1e3),i=t%1e3;return e.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+"."+i.toString().padStart(3,"0")};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class jT{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,Math.floor(e/2**32),!1),this.helperView.setUint32(4,e,!1),this.writer.write(this.helper.subarray(0,8))}writeAscii(e){for(let n=0;n<e.length;n++)this.helperView.setUint8(n%8,e.charCodeAt(n)),n%8===7&&this.writer.write(this.helper);e.length%8!==0&&this.writer.write(this.helper.subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.writer.getPos()),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.writer.write(e.contents);else{const n=this.writer.getPos();if(this.writeBoxHeader(e,0),e.contents&&this.writer.write(e.contents),e.children)for(const s of e.children)s&&this.writeBox(s);const r=this.writer.getPos(),i=e.size??r-n;this.writer.seek(n),this.writeBoxHeader(e,i),this.writer.seek(r)}}writeBoxHeader(e,n){this.writeU32(e.largeSize?1:n),this.writeAscii(e.type),e.largeSize&&this.writeU64(n)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){const n=this.offsets.get(e);K(n!==void 0);const r=this.writer.getPos();this.writer.seek(n),this.writeBox(e),this.writer.seek(r)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let n=this.measureBoxHeader(e);if(e.contents&&(n+=e.contents.byteLength),e.children)for(const r of e.children)r&&(n+=this.measureBox(r));return n}}}const zt=new Uint8Array(8),fo=new DataView(zt.buffer),In=t=>[(t%256+256)%256],dt=t=>(fo.setUint16(0,t,!1),[zt[0],zt[1]]),wM=t=>(fo.setInt16(0,t,!1),[zt[0],zt[1]]),vM=t=>(fo.setUint32(0,t,!1),[zt[1],zt[2],zt[3]]),Be=t=>(fo.setUint32(0,t,!1),[zt[0],zt[1],zt[2],zt[3]]),Qa=t=>(fo.setInt32(0,t,!1),[zt[0],zt[1],zt[2],zt[3]]),Mc=t=>(fo.setUint32(0,Math.floor(t/2**32),!1),fo.setUint32(4,t,!1),[zt[0],zt[1],zt[2],zt[3],zt[4],zt[5],zt[6],zt[7]]),xM=t=>(fo.setInt16(0,2**8*t,!1),[zt[0],zt[1]]),Lo=t=>(fo.setInt32(0,2**16*t,!1),[zt[0],zt[1],zt[2],zt[3]]),Mb=t=>(fo.setInt32(0,2**30*t,!1),[zt[0],zt[1],zt[2],zt[3]]),Ob=(t,e)=>{const n=[];let r=t;do{let i=r&127;r>>=7,n.length>0&&(i|=128),n.push(i)}while(r>0||e);return n.reverse()},Pr=(t,e=!1)=>{const n=Array(t.length).fill(null).map((r,i)=>t.charCodeAt(i));return e&&n.push(0),n},vx=t=>{let e=null;for(const n of t)(!e||n.timestamp>e.timestamp)&&(e=n);return e},SM=t=>{const e=t*(Math.PI/180),n=Math.round(Math.cos(e)),r=Math.round(Math.sin(e));return[n,r,0,-r,n,0,0,0,1]},EM=SM(0),kM=t=>[Lo(t[0]),Lo(t[1]),Mb(t[2]),Lo(t[3]),Lo(t[4]),Mb(t[5]),Lo(t[6]),Lo(t[7]),Mb(t[8])],pt=(t,e,n)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:n}),Zt=(t,e,n,r,i)=>pt(t,[In(e),vM(n),r??[]],i),QK=t=>t.isQuickTime?pt("ftyp",[Pr("qt  "),Be(512),Pr("qt  ")]):t.fragmented?pt("ftyp",[Pr("iso5"),Be(512),Pr("iso5"),Pr("iso6"),Pr("mp41")]):pt("ftyp",[Pr("isom"),Be(512),Pr("isom"),t.holdsAvc?Pr("avc1"):[],Pr("mp41")]),yp=t=>({type:"mdat",largeSize:t}),XK=t=>({type:"free",size:t}),Qd=t=>pt("moov",void 0,[YK(t.creationTime,t.trackDatas),...t.trackDatas.map(e=>JK(e,t.creationTime)),t.isFragmented?RG(t.trackDatas):null,KG(t)]),YK=(t,e)=>{const n=er(Math.max(0,...e.filter(o=>o.samples.length>0).map(o=>{const a=vx(o.samples);return a.timestamp+a.duration})),Zv),r=Math.max(0,...e.map(o=>o.track.id))+1,i=!id(t)||!id(n),s=i?Mc:Be;return Zt("mvhd",+i,0,[s(t),s(t),Be(Zv),s(n),Lo(1),xM(1),Array(10).fill(0),kM(EM),Array(24).fill(0),Be(r)])},JK=(t,e)=>{const n=sZ(t);return pt("trak",void 0,[eG(t,e),tG(t,e),n.name!==void 0?pt("udta",void 0,[pt("name",[...no.encode(n.name)])]):null])},eG=(t,e)=>{const n=vx(t.samples),r=er(n?n.timestamp+n.duration:0,Zv),i=!id(e)||!id(r),s=i?Mc:Be;let o;if(t.type==="video"){const a=t.track.metadata.rotation;o=SM(a??0)}else o=EM;return Zt("tkhd",+i,3,[s(e),s(e),Be(t.track.id),Be(0),s(r),Array(8).fill(0),dt(0),dt(t.track.id),xM(t.type==="audio"?1:0),dt(0),kM(o),Lo(t.type==="video"?t.info.width:0),Lo(t.type==="video"?t.info.height:0)])},tG=(t,e)=>pt("mdia",void 0,[nG(t,e),xx(!0,rG[t.type],iG[t.type]),sG(t)]),nG=(t,e)=>{const n=vx(t.samples),r=er(n?n.timestamp+n.duration:0,t.timescale),i=!id(e)||!id(r),s=i?Mc:Be;return Zt("mdhd",+i,0,[s(e),s(e),Be(t.timescale),s(r),dt(AM(t.track.metadata.languageCode??Xi)),dt(0)])},rG={video:"vide",audio:"soun",subtitle:"text"},iG={video:"MediabunnyVideoHandler",audio:"MediabunnySoundHandler",subtitle:"MediabunnyTextHandler"},xx=(t,e,n,r="\0\0\0\0")=>Zt("hdlr",0,0,[t?Pr("mhlr"):Be(0),Pr(e),Pr(r),Be(0),Be(0),Pr(n,!0)]),sG=t=>pt("minf",void 0,[cG[t.type](),uG(),hG(t)]),oG=()=>Zt("vmhd",0,1,[dt(0),dt(0),dt(0),dt(0)]),aG=()=>Zt("smhd",0,0,[dt(0),dt(0)]),lG=()=>Zt("nmhd",0,0),cG={video:oG,audio:aG,subtitle:lG},uG=()=>pt("dinf",void 0,[dG()]),dG=()=>Zt("dref",0,0,[Be(1)],[fG()]),fG=()=>Zt("url ",0,1),hG=t=>{const e=t.compositionTimeOffsetTable.length>1||t.compositionTimeOffsetTable.some(n=>n.sampleCompositionTimeOffset!==0);return pt("stbl",void 0,[pG(t),CG(t),e?OG(t):null,e?NG(t):null,IG(t),PG(t),MG(t),AG(t)])},pG=t=>{let e;if(t.type==="video")e=mG(XG[t.track.source._codec],t);else if(t.type==="audio"){const n=CM(t.track.source._codec,t.muxer.isQuickTime);K(n),e=vG(n,t)}else t.type==="subtitle"&&(e=TG(eZ[t.track.source._codec],t));return K(e),Zt("stsd",0,0,[Be(1)],[e])},mG=(t,e)=>pt(t,[Array(6).fill(0),dt(1),dt(0),dt(0),Array(12).fill(0),dt(e.info.width),dt(e.info.height),Be(4718592),Be(4718592),Be(0),dt(1),Array(32).fill(0),dt(24),wM(65535)],[YG[e.track.source._codec](e),BW(e.info.decoderConfig.colorSpace)?gG(e):null]),gG=t=>pt("colr",[Pr("nclx"),dt(Bh[t.info.decoderConfig.colorSpace.primaries]),dt($h[t.info.decoderConfig.colorSpace.transfer]),dt(Fh[t.info.decoderConfig.colorSpace.matrix]),In((t.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),yG=t=>t.info.decoderConfig&&pt("avcC",[...oo(t.info.decoderConfig.description)]),bG=t=>t.info.decoderConfig&&pt("hvcC",[...oo(t.info.decoderConfig.description)]),WT=t=>{if(!t.info.decoderConfig)return null;const e=t.info.decoderConfig,n=e.codec.split("."),r=Number(n[1]),i=Number(n[2]),s=Number(n[3]),o=n[4]?Number(n[4]):1,a=n[8]?Number(n[8]):Number(e.colorSpace?.fullRange??0),l=(s<<4)+(o<<1)+a,c=n[5]?Number(n[5]):e.colorSpace?.primaries?Bh[e.colorSpace.primaries]:2,u=n[6]?Number(n[6]):e.colorSpace?.transfer?$h[e.colorSpace.transfer]:2,d=n[7]?Number(n[7]):e.colorSpace?.matrix?Fh[e.colorSpace.matrix]:2;return Zt("vpcC",1,0,[In(r),In(i),In(l),In(c),In(u),In(d),dt(0)])},wG=t=>pt("av1C",GW(t.info.decoderConfig.codec)),vG=(t,e)=>{let n=0,r,i=16;if(Zr.includes(e.track.source._codec)){const s=e.track.source._codec,{sampleSize:o}=$l(s);i=8*o,i>16&&(n=1)}return n===0?r=[Array(6).fill(0),dt(1),dt(n),dt(0),Be(0),dt(e.info.numberOfChannels),dt(i),dt(0),dt(0),dt(e.info.sampleRate<2**16?e.info.sampleRate:0),dt(0)]:r=[Array(6).fill(0),dt(1),dt(n),dt(0),Be(0),dt(e.info.numberOfChannels),dt(Math.min(i,16)),dt(0),dt(0),dt(e.info.sampleRate<2**16?e.info.sampleRate:0),dt(0),Be(1),Be(i/8),Be(e.info.numberOfChannels*i/8),Be(2)],pt(t,r,[JG(e.track.source._codec,e.muxer.isQuickTime)?.(e)??null])},Nb=t=>{let e;switch(t.track.source._codec){case"aac":e=64;break;case"mp3":e=107;break;case"vorbis":e=221;break;default:throw new Error(`Unhandled audio codec: ${t.track.source._codec}`)}let n=[...In(e),...In(21),...vM(0),...Be(0),...Be(0)];if(t.info.decoderConfig.description){const r=oo(t.info.decoderConfig.description);n=[...n,...In(5),...Ob(r.byteLength),...r]}return n=[...dt(1),...In(0),...In(4),...Ob(n.length),...n,...In(6),...In(1),...In(2)],n=[...In(3),...Ob(n.length),...n],Zt("esds",0,0,n)},Na=t=>pt("wave",void 0,[xG(t),SG(t),pt("\0\0\0\0")]),xG=t=>pt("frma",[Pr(CM(t.track.source._codec,t.muxer.isQuickTime))]),SG=t=>{const{littleEndian:e}=$l(t.track.source._codec);return pt("enda",[dt(+e)])},EG=t=>{let e=t.info.numberOfChannels,n=3840,r=t.info.sampleRate,i=0,s=0,o=new Uint8Array(0);const a=t.info.decoderConfig?.description;if(a){K(a.byteLength>=18);const l=oo(a),c=J4(l);e=c.outputChannelCount,n=c.preSkip,r=c.inputSampleRate,i=c.outputGain,s=c.channelMappingFamily,c.channelMappingTable&&(o=c.channelMappingTable)}return pt("dOps",[In(0),In(e),dt(n),Be(r),wM(i),In(s),...o])},kG=t=>{const e=t.info.decoderConfig?.description;K(e);const n=oo(e);return Zt("dfLa",0,0,[...n.subarray(4)])},$s=t=>{const{littleEndian:e,sampleSize:n}=$l(t.track.source._codec),r=+e;return Zt("pcmC",0,0,[In(r),In(8*n)])},TG=(t,e)=>pt(t,[Array(6).fill(0),dt(1)],[tZ[e.track.source._codec](e)]),_G=t=>pt("vttC",[...no.encode(t.info.config.description)]),CG=t=>Zt("stts",0,0,[Be(t.timeToSampleTable.length),t.timeToSampleTable.map(e=>[Be(e.sampleCount),Be(e.sampleDelta)])]),AG=t=>{if(t.samples.every(n=>n.type==="key"))return null;const e=[...t.samples.entries()].filter(([,n])=>n.type==="key");return Zt("stss",0,0,[Be(e.length),e.map(([n])=>Be(n+1))])},IG=t=>Zt("stsc",0,0,[Be(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(e=>[Be(e.firstChunk),Be(e.samplesPerChunk),Be(1)])]),PG=t=>{if(t.type==="audio"&&t.info.requiresPcmTransformation){const{sampleSize:e}=$l(t.track.source._codec);return Zt("stsz",0,0,[Be(e*t.info.numberOfChannels),Be(t.samples.reduce((n,r)=>n+er(r.duration,t.timescale),0))])}return Zt("stsz",0,0,[Be(0),Be(t.samples.length),t.samples.map(e=>Be(e.size))])},MG=t=>t.finalizedChunks.length>0&&Qn(t.finalizedChunks).offset>=2**32?Zt("co64",0,0,[Be(t.finalizedChunks.length),t.finalizedChunks.map(e=>Mc(e.offset))]):Zt("stco",0,0,[Be(t.finalizedChunks.length),t.finalizedChunks.map(e=>Be(e.offset))]),OG=t=>Zt("ctts",1,0,[Be(t.compositionTimeOffsetTable.length),t.compositionTimeOffsetTable.map(e=>[Be(e.sampleCount),Qa(e.sampleCompositionTimeOffset)])]),NG=t=>{let e=1/0,n=-1/0,r=1/0,i=-1/0;K(t.compositionTimeOffsetTable.length>0),K(t.samples.length>0);for(let o=0;o<t.compositionTimeOffsetTable.length;o++){const a=t.compositionTimeOffsetTable[o];e=Math.min(e,a.sampleCompositionTimeOffset),n=Math.max(n,a.sampleCompositionTimeOffset)}for(let o=0;o<t.samples.length;o++){const a=t.samples[o];r=Math.min(r,er(a.timestamp,t.timescale)),i=Math.max(i,er(a.timestamp+a.duration,t.timescale))}const s=Math.max(-e,0);return i>=2**31?null:Zt("cslg",0,0,[Qa(s),Qa(e),Qa(n),Qa(r),Qa(i)])},RG=t=>pt("mvex",void 0,t.map(LG)),LG=t=>Zt("trex",0,0,[Be(t.track.id),Be(1),Be(0),Be(0),Be(0)]),qT=(t,e)=>pt("moof",void 0,[DG(t),...e.map(BG)]),DG=t=>Zt("mfhd",0,0,[Be(t)]),TM=t=>{let e=0,n=0;const r=0,i=0,s=t.type==="delta";return n|=+s,s?e|=1:e|=2,e<<24|n<<16|r<<8|i},BG=t=>pt("traf",void 0,[$G(t),FG(t),zG(t)]),$G=t=>{K(t.currentChunk);let e=0;e|=8,e|=16,e|=32,e|=131072;const n=t.currentChunk.samples[1]??t.currentChunk.samples[0],r={duration:n.timescaleUnitsToNextSample,size:n.size,flags:TM(n)};return Zt("tfhd",0,e,[Be(t.track.id),Be(r.duration),Be(r.size),Be(r.flags)])},FG=t=>(K(t.currentChunk),Zt("tfdt",1,0,[Mc(er(t.currentChunk.startTimestamp,t.timescale))])),zG=t=>{K(t.currentChunk);const e=t.currentChunk.samples.map(m=>m.timescaleUnitsToNextSample),n=t.currentChunk.samples.map(m=>m.size),r=t.currentChunk.samples.map(TM),i=t.currentChunk.samples.map(m=>er(m.timestamp-m.decodeTimestamp,t.timescale)),s=new Set(e),o=new Set(n),a=new Set(r),l=new Set(i),c=a.size===2&&r[0]!==r[1],u=s.size>1,d=o.size>1,f=!c&&a.size>1,h=l.size>1||[...l].some(m=>m!==0);let p=0;return p|=1,p|=4*+c,p|=256*+u,p|=512*+d,p|=1024*+f,p|=2048*+h,Zt("trun",1,p,[Be(t.currentChunk.samples.length),Be(t.currentChunk.offset-t.currentChunk.moofOffset||0),c?Be(r[0]):[],t.currentChunk.samples.map((m,g)=>[u?Be(e[g]):[],d?Be(n[g]):[],f?Be(r[g]):[],h?Qa(i[g]):[]])])},UG=t=>pt("mfra",void 0,[...t.map(HG),VG()]),HG=(t,e)=>Zt("tfra",1,0,[Be(t.track.id),Be(63),Be(t.finalizedChunks.length),t.finalizedChunks.map(r=>[Mc(er(r.samples[0].timestamp,t.timescale)),Mc(r.moofOffset),Be(e+1),Be(1),Be(1)])]),VG=()=>Zt("mfro",0,0,[Be(0)]),jG=()=>pt("vtte"),WG=(t,e,n,r,i)=>pt("vttc",void 0,[i!==null?pt("vsid",[Qa(i)]):null,n!==null?pt("iden",[...no.encode(n)]):null,e!==null?pt("ctim",[...no.encode(ZK(e))]):null,r!==null?pt("sttg",[...no.encode(r)]):null,pt("payl",[...no.encode(t)])]),qG=t=>pt("vtta",[...no.encode(t)]),KG=t=>{const e=[],n=t.format._options.metadataFormat??"auto",r=t.output._metadataTags;if(n==="mdir"||n==="auto"&&!t.isQuickTime){const i=ZG(r);i&&e.push(i)}else if(n==="mdta"){const i=QG(r);i&&e.push(i)}else(n==="udta"||n==="auto"&&t.isQuickTime)&&GG(e,t.output._metadataTags);return e.length===0?null:pt("udta",void 0,e)},GG=(t,e)=>{for(const{key:n,value:r}of D4(e))switch(n){case"title":t.push(Fs("Â©nam",r));break;case"description":t.push(Fs("Â©des",r));break;case"artist":t.push(Fs("Â©ART",r));break;case"album":t.push(Fs("Â©alb",r));break;case"albumArtist":t.push(Fs("albr",r));break;case"genre":t.push(Fs("Â©gen",r));break;case"date":t.push(Fs("Â©day",r.toISOString().slice(0,10)));break;case"comment":t.push(Fs("Â©cmt",r));break;case"lyrics":t.push(Fs("Â©lyr",r));break;case"raw":break;case"discNumber":case"discsTotal":case"trackNumber":case"tracksTotal":case"images":break;default:Al(n)}if(e.raw)for(const n in e.raw){const r=e.raw[n];r==null||n.length!==4||t.some(i=>i.type===n)||(typeof r=="string"?t.push(Fs(n,r)):r instanceof Uint8Array&&t.push(pt(n,Array.from(r))))}},Fs=(t,e)=>{const n=no.encode(e);return pt(t,[dt(n.length),dt(AM("und")),Array.from(n)])},KT={"image/jpeg":13,"image/png":14,"image/bmp":27},_M=(t,e)=>{const n=[];for(const{key:r,value:i}of D4(t))switch(r){case"title":n.push({key:e?"title":"Â©nam",value:hs(i)});break;case"description":n.push({key:e?"description":"Â©des",value:hs(i)});break;case"artist":n.push({key:e?"artist":"Â©ART",value:hs(i)});break;case"album":n.push({key:e?"album":"Â©alb",value:hs(i)});break;case"albumArtist":n.push({key:e?"album_artist":"aART",value:hs(i)});break;case"comment":n.push({key:e?"comment":"Â©cmt",value:hs(i)});break;case"genre":n.push({key:e?"genre":"Â©gen",value:hs(i)});break;case"lyrics":n.push({key:e?"lyrics":"Â©lyr",value:hs(i)});break;case"date":n.push({key:e?"date":"Â©day",value:hs(i.toISOString().slice(0,10))});break;case"images":for(const s of i)s.kind==="coverFront"&&n.push({key:"covr",value:pt("data",[Be(KT[s.mimeType]??0),Be(0),Array.from(s.data)])});break;case"trackNumber":if(e){const s=t.tracksTotal!==void 0?`${i}/${t.tracksTotal}`:i.toString();n.push({key:"track",value:hs(s)})}else n.push({key:"trkn",value:pt("data",[Be(0),Be(0),dt(0),dt(i),dt(t.tracksTotal??0),dt(0)])});break;case"discNumber":e||n.push({key:"disc",value:pt("data",[Be(0),Be(0),dt(0),dt(i),dt(t.discsTotal??0),dt(0)])});break;case"tracksTotal":case"discsTotal":break;case"raw":break;default:Al(r)}if(t.raw)for(const r in t.raw){const i=t.raw[r];i==null||!e&&r.length!==4||n.some(s=>s.key===r)||(typeof i=="string"?n.push({key:r,value:hs(i)}):i instanceof Uint8Array?n.push({key:r,value:pt("data",[Be(0),Be(0),Array.from(i)])}):i instanceof Ru&&n.push({key:r,value:pt("data",[Be(KT[i.mimeType]??0),Be(0),Array.from(i.data)])}))}return n},ZG=t=>{const e=_M(t,!1);return e.length===0?null:Zt("meta",0,0,void 0,[xx(!1,"mdir","","appl"),pt("ilst",void 0,e.map(n=>pt(n.key,void 0,[n.value])))])},QG=t=>{const e=_M(t,!0);return e.length===0?null:pt("meta",void 0,[xx(!1,"mdta",""),Zt("keys",0,0,[Be(e.length)],e.map(n=>pt("mdta",[...no.encode(n.key)]))),pt("ilst",void 0,e.map((n,r)=>{const i=String.fromCharCode(...Be(r+1));return pt(i,void 0,[n.value])}))])},hs=t=>pt("data",[Be(1),Be(0),...no.encode(t)]),XG={avc:"avc1",hevc:"hvc1",vp8:"vp08",vp9:"vp09",av1:"av01"},YG={avc:yG,hevc:bG,vp8:WT,vp9:WT,av1:wG},CM=(t,e)=>{switch(t){case"aac":return"mp4a";case"mp3":return"mp4a";case"opus":return"Opus";case"vorbis":return"mp4a";case"flac":return"fLaC";case"ulaw":return"ulaw";case"alaw":return"alaw";case"pcm-u8":return"raw ";case"pcm-s8":return"sowt"}if(e)switch(t){case"pcm-s16":return"sowt";case"pcm-s16be":return"twos";case"pcm-s24":return"in24";case"pcm-s24be":return"in24";case"pcm-s32":return"in32";case"pcm-s32be":return"in32";case"pcm-f32":return"fl32";case"pcm-f32be":return"fl32";case"pcm-f64":return"fl64";case"pcm-f64be":return"fl64"}else switch(t){case"pcm-s16":return"ipcm";case"pcm-s16be":return"ipcm";case"pcm-s24":return"ipcm";case"pcm-s24be":return"ipcm";case"pcm-s32":return"ipcm";case"pcm-s32be":return"ipcm";case"pcm-f32":return"fpcm";case"pcm-f32be":return"fpcm";case"pcm-f64":return"fpcm";case"pcm-f64be":return"fpcm"}},JG=(t,e)=>{switch(t){case"aac":return Nb;case"mp3":return Nb;case"opus":return EG;case"vorbis":return Nb;case"flac":return kG}if(e)switch(t){case"pcm-s24":return Na;case"pcm-s24be":return Na;case"pcm-s32":return Na;case"pcm-s32be":return Na;case"pcm-f32":return Na;case"pcm-f32be":return Na;case"pcm-f64":return Na;case"pcm-f64be":return Na}else switch(t){case"pcm-s16":return $s;case"pcm-s16be":return $s;case"pcm-s24":return $s;case"pcm-s24be":return $s;case"pcm-s32":return $s;case"pcm-s32be":return $s;case"pcm-f32":return $s;case"pcm-f32be":return $s;case"pcm-f64":return $s;case"pcm-f64be":return $s}return null},eZ={webvtt:"wvtt"},tZ={webvtt:_G},AM=t=>{K(t.length===3);let e=0;for(let n=0;n<3;n++)e<<=5,e+=t.charCodeAt(n)-96;return e};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class IM{constructor(){this.ensureMonotonicity=!1,this.trackedWrites=null,this.trackedStart=-1,this.trackedEnd=-1}start(){}maybeTrackWrites(e){if(!this.trackedWrites)return;let n=this.getPos();if(n<this.trackedStart){if(n+e.byteLength<=this.trackedStart)return;e=e.subarray(this.trackedStart-n),n=0}const r=n+e.byteLength-this.trackedStart;let i=this.trackedWrites.byteLength;for(;i<r;)i*=2;if(i!==this.trackedWrites.byteLength){const s=new Uint8Array(i);s.set(this.trackedWrites,0),this.trackedWrites=s}this.trackedWrites.set(e,n-this.trackedStart),this.trackedEnd=Math.max(this.trackedEnd,n+e.byteLength)}startTrackingWrites(){this.trackedWrites=new Uint8Array(2**10),this.trackedStart=this.getPos(),this.trackedEnd=this.trackedStart}stopTrackingWrites(){if(!this.trackedWrites)throw new Error("Internal error: Can't get tracked writes since nothing was tracked.");const n={data:this.trackedWrites.subarray(0,this.trackedEnd-this.trackedStart),start:this.trackedStart,end:this.trackedEnd};return this.trackedWrites=null,n}}const Rb=2**16,Lb=2**32;class PM extends IM{constructor(e){if(super(),this.pos=0,this.maxPos=0,this.target=e,this.supportsResize="resize"in new ArrayBuffer(0),this.supportsResize)try{this.buffer=new ArrayBuffer(Rb,{maxByteLength:Lb})}catch{this.buffer=new ArrayBuffer(Rb),this.supportsResize=!1}else this.buffer=new ArrayBuffer(Rb);this.bytes=new Uint8Array(this.buffer)}ensureSize(e){let n=this.buffer.byteLength;for(;n<e;)n*=2;if(n!==this.buffer.byteLength){if(n>Lb)throw new Error(`ArrayBuffer exceeded maximum size of ${Lb} bytes. Please consider using another target.`);if(this.supportsResize)this.buffer.resize(n);else{const r=new ArrayBuffer(n),i=new Uint8Array(r);i.set(this.bytes,0),this.buffer=r,this.bytes=i}}}write(e){this.maybeTrackWrites(e),this.ensureSize(this.pos+e.byteLength),this.bytes.set(e,this.pos),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength,this.maxPos=Math.max(this.maxPos,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){}async finalize(){this.ensureSize(this.pos),this.target.buffer=this.buffer.slice(0,Math.max(this.maxPos,this.pos))}async close(){}getSlice(e,n){return this.bytes.slice(e,n)}}class nZ extends IM{constructor(e){super(),this.target=e,this.pos=0}write(e){this.maybeTrackWrites(e),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength}getPos(){return this.pos}seek(e){this.pos=e}async flush(){}async finalize(){}async close(){}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class Sx{constructor(){this._output=null,this.onwrite=null}}class MM extends Sx{constructor(){super(...arguments),this.buffer=null}_createWriter(){return new PM(this)}}class rZ extends Sx{_createWriter(){return new nZ(this)}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const Zv=1e3,iZ=2082844800,sZ=t=>{const e={},n=t.track;return n.metadata.name!==void 0&&(e.name=n.metadata.name),e},er=(t,e,n=!0)=>{const r=t*e;return n?Math.round(r):r};class oZ extends aq{constructor(e,n){super(e),this.auxTarget=new MM,this.auxWriter=this.auxTarget._createWriter(),this.auxBoxWriter=new jT(this.auxWriter),this.mdat=null,this.ftypSize=null,this.trackDatas=[],this.allTracksKnown=Rr(),this.creationTime=Math.floor(Date.now()/1e3)+iZ,this.finalizedChunks=[],this.nextFragmentNumber=1,this.maxWrittenTimestamp=-1/0,this.format=n,this.writer=e._writer,this.boxWriter=new jT(this.writer),this.isQuickTime=n instanceof RM;const r=this.writer instanceof PM?"in-memory":!1;this.fastStart=n._options.fastStart??r,this.isFragmented=this.fastStart==="fragmented",(this.fastStart==="in-memory"||this.isFragmented)&&(this.writer.ensureMonotonicity=!0),this.minimumFragmentDuration=n._options.minimumFragmentDuration??1}async start(){const e=await this.mutex.acquire(),n=this.output._tracks.some(r=>r.type==="video"&&r.source._codec==="avc");if(this.format._options.onFtyp&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(QK({isQuickTime:this.isQuickTime,holdsAvc:n,fragmented:this.isFragmented})),this.format._options.onFtyp){const{data:r,start:i}=this.writer.stopTrackingWrites();this.format._options.onFtyp(r,i)}if(this.ftypSize=this.writer.getPos(),this.fastStart!=="in-memory")if(this.fastStart==="reserve"){for(const r of this.output._tracks)if(r.metadata.maximumPacketCount===void 0)throw new Error("All tracks must specify maximumPacketCount in their metadata when using fastStart: 'reserve'.")}else this.isFragmented||(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=yp(!0),this.boxWriter.writeBox(this.mdat));await this.writer.flush(),e()}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(n=>n.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map(n=>n.type==="video"||n.type==="audio"?n.info.decoderConfig.codec:{webvtt:"wvtt"}[n.track.source._codec]);return iM({isQuickTime:this.isQuickTime,hasVideo:this.trackDatas.some(n=>n.type==="video"),hasAudio:this.trackDatas.some(n=>n.type==="audio"),codecStrings:e})}getVideoTrackData(e,n,r){const i=this.trackDatas.find(c=>c.track===e);if(i)return i;rq(r),K(r),K(r.decoderConfig);const s={...r.decoderConfig};K(s.codedWidth!==void 0),K(s.codedHeight!==void 0);let o=!1;if(e.source._codec==="avc"&&!s.description){const c=K4(n.data);if(!c)throw new Error("Couldn't extract an AVCDecoderConfigurationRecord from the AVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.264) when not providing a description, or provide a description (must be an AVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in AVCC format.");s.description=uq(c),o=!0}else if(e.source._codec==="hevc"&&!s.description){const c=Z4(n.data);if(!c)throw new Error("Couldn't extract an HEVCDecoderConfigurationRecord from the HEVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.265) when not providing a description, or provide a description (must be an HEVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in HEVC format.");s.description=yq(c),o=!0}const a=WW(1/(e.metadata.frameRate??57600),1e6).denominator,l={muxer:this,track:e,type:"video",info:{width:s.codedWidth,height:s.codedHeight,decoderConfig:s,requiresAnnexBTransformation:o},timescale:a,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(l),this.trackDatas.sort((c,u)=>c.track.id-u.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),l}getAudioTrackData(e,n){const r=this.trackDatas.find(s=>s.track===e);if(r)return r;sq(n),K(n),K(n.decoderConfig);const i={muxer:this,track:e,type:"audio",info:{numberOfChannels:n.decoderConfig.numberOfChannels,sampleRate:n.decoderConfig.sampleRate,decoderConfig:n.decoderConfig,requiresPcmTransformation:!this.isFragmented&&Zr.includes(e.source._codec)},timescale:n.decoderConfig.sampleRate,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(i),this.trackDatas.sort((s,o)=>s.track.id-o.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}getSubtitleTrackData(e,n){const r=this.trackDatas.find(s=>s.track===e);if(r)return r;oq(n),K(n),K(n.config);const i={muxer:this,track:e,type:"subtitle",info:{config:n.config},timescale:1e3,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[],lastCueEndTimestamp:0,cueQueue:[],nextSourceId:0,cueToSourceId:new WeakMap};return this.trackDatas.push(i),this.trackDatas.sort((s,o)=>s.track.id-o.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}async addEncodedVideoPacket(e,n,r){const i=await this.mutex.acquire();try{const s=this.getVideoTrackData(e,n,r);let o=n.data;if(s.info.requiresAnnexBTransformation){const c=lq(o);if(!c)throw new Error("Failed to transform packet data. Make sure all packets are provided in Annex B format, as specified in ITU-T-REC-H.264 and ITU-T-REC-H.265.");o=c}const a=this.validateAndNormalizeTimestamp(s.track,n.timestamp,n.type==="key"),l=this.createSampleForTrack(s,o,a,n.duration,n.type);await this.registerSample(s,l)}finally{i()}}async addEncodedAudioPacket(e,n,r){const i=await this.mutex.acquire();try{const s=this.getAudioTrackData(e,r),o=this.validateAndNormalizeTimestamp(s.track,n.timestamp,n.type==="key"),a=this.createSampleForTrack(s,n.data,o,n.duration,n.type);s.info.requiresPcmTransformation&&await this.maybePadWithSilence(s,o),await this.registerSample(s,a)}finally{i()}}async maybePadWithSilence(e,n){const r=Qn(e.samples),i=r?r.timestamp+r.duration:0,s=n-i,o=er(s,e.timescale);if(o>0){const{sampleSize:a,silentValue:l}=$l(e.info.decoderConfig.codec),c=o*e.info.numberOfChannels,u=new Uint8Array(a*c).fill(l),d=this.createSampleForTrack(e,new Uint8Array(u.buffer),i,s,"key");await this.registerSample(e,d)}}async addSubtitleCue(e,n,r){const i=await this.mutex.acquire();try{const s=this.getSubtitleTrackData(e,r);this.validateAndNormalizeTimestamp(s.track,n.timestamp,!0),e.source._codec==="webvtt"&&(s.cueQueue.push(n),await this.processWebVTTCues(s,n.timestamp))}finally{i()}}async processWebVTTCues(e,n){for(;e.cueQueue.length>0;){const r=new Set([]);for(const c of e.cueQueue)K(c.timestamp<=n),K(e.lastCueEndTimestamp<=c.timestamp+c.duration),r.add(Math.max(c.timestamp,e.lastCueEndTimestamp)),r.add(c.timestamp+c.duration);const i=[...r].sort((c,u)=>c-u),s=i[0],o=i[1]??s;if(n<o)break;if(e.lastCueEndTimestamp<s){this.auxWriter.seek(0);const c=jG();this.auxBoxWriter.writeBox(c);const u=this.auxWriter.getSlice(0,this.auxWriter.getPos()),d=this.createSampleForTrack(e,u,e.lastCueEndTimestamp,s-e.lastCueEndTimestamp,"key");await this.registerSample(e,d),e.lastCueEndTimestamp=s}this.auxWriter.seek(0);for(let c=0;c<e.cueQueue.length;c++){const u=e.cueQueue[c];if(u.timestamp>=o)break;VT.lastIndex=0;const d=VT.test(u.text),f=u.timestamp+u.duration;let h=e.cueToSourceId.get(u);if(h===void 0&&o<f&&(h=e.nextSourceId++,e.cueToSourceId.set(u,h)),u.notes){const m=qG(u.notes);this.auxBoxWriter.writeBox(m)}const p=WG(u.text,d?s:null,u.identifier??null,u.settings??null,h??null);this.auxBoxWriter.writeBox(p),f===o&&e.cueQueue.splice(c--,1)}const a=this.auxWriter.getSlice(0,this.auxWriter.getPos()),l=this.createSampleForTrack(e,a,s,o-s,"key");await this.registerSample(e,l),e.lastCueEndTimestamp=o}}createSampleForTrack(e,n,r,i,s){return{timestamp:r,decodeTimestamp:r,duration:i,data:n,size:n.byteLength,type:s,timescaleUnitsToNextSample:er(i,e.timescale)}}processTimestamps(e,n){if(e.timestampProcessingQueue.length===0)return;if(e.type==="audio"&&e.info.requiresPcmTransformation){let i=0;for(let s=0;s<e.timestampProcessingQueue.length;s++){const o=e.timestampProcessingQueue[s],a=er(o.duration,e.timescale);i+=a}if(e.timeToSampleTable.length===0)e.timeToSampleTable.push({sampleCount:i,sampleDelta:1});else{const s=Qn(e.timeToSampleTable);s.sampleCount+=i}e.timestampProcessingQueue.length=0;return}const r=e.timestampProcessingQueue.map(i=>i.timestamp).sort((i,s)=>i-s);for(let i=0;i<e.timestampProcessingQueue.length;i++){const s=e.timestampProcessingQueue[i];s.decodeTimestamp=r[i],!this.isFragmented&&e.lastTimescaleUnits===null&&(s.decodeTimestamp=0);const o=er(s.timestamp-s.decodeTimestamp,e.timescale),a=er(s.duration,e.timescale);if(e.lastTimescaleUnits!==null){K(e.lastSample);const l=er(s.decodeTimestamp,e.timescale,!1),c=Math.round(l-e.lastTimescaleUnits);if(K(c>=0),e.lastTimescaleUnits+=c,e.lastSample.timescaleUnitsToNextSample=c,!this.isFragmented){let u=Qn(e.timeToSampleTable);if(K(u),u.sampleCount===1){u.sampleDelta=c;const f=e.timeToSampleTable[e.timeToSampleTable.length-2];f&&f.sampleDelta===c&&(f.sampleCount++,e.timeToSampleTable.pop(),u=f)}else u.sampleDelta!==c&&(u.sampleCount--,e.timeToSampleTable.push(u={sampleCount:1,sampleDelta:c}));u.sampleDelta===a?u.sampleCount++:e.timeToSampleTable.push({sampleCount:1,sampleDelta:a});const d=Qn(e.compositionTimeOffsetTable);K(d),d.sampleCompositionTimeOffset===o?d.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:o})}}else e.lastTimescaleUnits=er(s.decodeTimestamp,e.timescale,!1),this.isFragmented||(e.timeToSampleTable.push({sampleCount:1,sampleDelta:a}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:o}));e.lastSample=s}if(e.timestampProcessingQueue.length=0,K(e.lastSample),K(e.lastTimescaleUnits!==null),n!==void 0&&e.lastSample.timescaleUnitsToNextSample===0){K(n.type==="key");const i=er(n.timestamp,e.timescale,!1),s=Math.round(i-e.lastTimescaleUnits);e.lastSample.timescaleUnitsToNextSample=s}}async registerSample(e,n){n.type==="key"&&this.processTimestamps(e,n),e.timestampProcessingQueue.push(n),this.isFragmented?(e.sampleQueue.push(n),await this.interleaveSamples()):this.fastStart==="reserve"?await this.registerSampleFastStartReserve(e,n):await this.addSampleToTrack(e,n)}async addSampleToTrack(e,n){if(!this.isFragmented&&(e.samples.push(n),this.fastStart==="reserve")){const i=e.track.metadata.maximumPacketCount;if(K(i!==void 0),e.samples.length>i)throw new Error(`Track #${e.track.id} has already reached the maximum packet count (${i}). Either add less packets or increase the maximum packet count.`)}let r=!1;if(!e.currentChunk)r=!0;else{e.currentChunk.startTimestamp=Math.min(e.currentChunk.startTimestamp,n.timestamp);const i=n.timestamp-e.currentChunk.startTimestamp;if(this.isFragmented){const s=this.trackDatas.every(o=>{if(e===o)return n.type==="key";const a=o.sampleQueue[0];return a?a.type==="key":o.track.source._closed});i>=this.minimumFragmentDuration&&s&&n.timestamp>this.maxWrittenTimestamp&&(r=!0,await this.finalizeFragment())}else r=i>=.5}r&&(e.currentChunk&&await this.finalizeCurrentChunk(e),e.currentChunk={startTimestamp:n.timestamp,samples:[],offset:null,moofOffset:null}),K(e.currentChunk),e.currentChunk.samples.push(n),this.isFragmented&&(this.maxWrittenTimestamp=Math.max(this.maxWrittenTimestamp,n.timestamp))}async finalizeCurrentChunk(e){if(K(!this.isFragmented),!e.currentChunk)return;e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk);let n=e.currentChunk.samples.length;if(e.type==="audio"&&e.info.requiresPcmTransformation&&(n=e.currentChunk.samples.reduce((r,i)=>r+er(i.duration,e.timescale),0)),(e.compactlyCodedChunkTable.length===0||Qn(e.compactlyCodedChunkTable).samplesPerChunk!==n)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:n}),this.fastStart==="in-memory"){e.currentChunk.offset=0;return}e.currentChunk.offset=this.writer.getPos();for(const r of e.currentChunk.samples)K(r.data),this.writer.write(r.data),r.data=null;await this.writer.flush()}async interleaveSamples(e=!1){if(K(this.isFragmented),!(!e&&!this.allTracksAreKnown()))e:for(;;){let n=null,r=1/0;for(const s of this.trackDatas){if(!e&&s.sampleQueue.length===0&&!s.track.source._closed)break e;s.sampleQueue.length>0&&s.sampleQueue[0].timestamp<r&&(n=s,r=s.sampleQueue[0].timestamp)}if(!n)break;const i=n.sampleQueue.shift();await this.addSampleToTrack(n,i)}}async finalizeFragment(e=!0){K(this.isFragmented);const n=this.nextFragmentNumber++;if(n===1){this.format._options.onMoov&&this.writer.startTrackingWrites();const h=Qd(this);if(this.boxWriter.writeBox(h),this.format._options.onMoov){const{data:p,start:m}=this.writer.stopTrackingWrites();this.format._options.onMoov(p,m)}}const r=this.trackDatas.filter(h=>h.currentChunk),i=qT(n,r),s=this.writer.getPos(),o=s+this.boxWriter.measureBox(i);let a=o+zo,l=1/0;for(const h of r){h.currentChunk.offset=a,h.currentChunk.moofOffset=s;for(const p of h.currentChunk.samples)a+=p.size;l=Math.min(l,h.currentChunk.startTimestamp)}const c=a-o,u=c>=2**32;if(u)for(const h of r)h.currentChunk.offset+=ic-zo;this.format._options.onMoof&&this.writer.startTrackingWrites();const d=qT(n,r);if(this.boxWriter.writeBox(d),this.format._options.onMoof){const{data:h,start:p}=this.writer.stopTrackingWrites();this.format._options.onMoof(h,p,l)}K(this.writer.getPos()===o),this.format._options.onMdat&&this.writer.startTrackingWrites();const f=yp(u);f.size=c,this.boxWriter.writeBox(f),this.writer.seek(o+(u?ic:zo));for(const h of r)for(const p of h.currentChunk.samples)this.writer.write(p.data),p.data=null;if(this.format._options.onMdat){const{data:h,start:p}=this.writer.stopTrackingWrites();this.format._options.onMdat(h,p)}for(const h of r)h.finalizedChunks.push(h.currentChunk),this.finalizedChunks.push(h.currentChunk),h.currentChunk=null;e&&await this.writer.flush()}async registerSampleFastStartReserve(e,n){if(this.allTracksAreKnown()){if(!this.mdat){const r=Qd(this),s=this.boxWriter.measureBox(r)+this.computeSampleTableSizeUpperBound()+4096;K(this.ftypSize!==null),this.writer.seek(this.ftypSize+s),this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=yp(!0),this.boxWriter.writeBox(this.mdat);for(const o of this.trackDatas){for(const a of o.sampleQueue)await this.addSampleToTrack(o,a);o.sampleQueue.length=0}}await this.addSampleToTrack(e,n)}else e.sampleQueue.push(n)}computeSampleTableSizeUpperBound(){K(this.fastStart==="reserve");let e=0;for(const n of this.trackDatas){const r=n.track.metadata.maximumPacketCount;K(r!==void 0),e+=8*Math.ceil(2/3*r),e+=4*r,e+=8*Math.ceil(2/3*r),e+=12*Math.ceil(2/3*r),e+=4*r,e+=8*r}return e}async onTrackClose(e){const n=await this.mutex.acquire();if(e.type==="subtitle"&&e.source._codec==="webvtt"){const r=this.trackDatas.find(i=>i.track===e);r&&await this.processWebVTTCues(r,1/0)}this.allTracksAreKnown()&&this.allTracksKnown.resolve(),this.isFragmented&&await this.interleaveSamples(),n()}async finalize(){const e=await this.mutex.acquire();this.allTracksKnown.resolve();for(const n of this.trackDatas)n.type==="subtitle"&&n.track.source._codec==="webvtt"&&await this.processWebVTTCues(n,1/0);if(this.isFragmented){await this.interleaveSamples(!0);for(const n of this.trackDatas)this.processTimestamps(n);await this.finalizeFragment(!1)}else for(const n of this.trackDatas)this.processTimestamps(n),await this.finalizeCurrentChunk(n);if(this.fastStart==="in-memory"){this.mdat=yp(!1);let n;for(let i=0;i<2;i++){const s=Qd(this),o=this.boxWriter.measureBox(s);n=this.boxWriter.measureBox(this.mdat);let a=this.writer.getPos()+o+n;for(const l of this.finalizedChunks){l.offset=a;for(const{data:c}of l.samples)K(c),a+=c.byteLength,n+=c.byteLength}if(a<2**32)break;n>=2**32&&(this.mdat.largeSize=!0)}this.format._options.onMoov&&this.writer.startTrackingWrites();const r=Qd(this);if(this.boxWriter.writeBox(r),this.format._options.onMoov){const{data:i,start:s}=this.writer.stopTrackingWrites();this.format._options.onMoov(i,s)}this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat.size=n,this.boxWriter.writeBox(this.mdat);for(const i of this.finalizedChunks)for(const s of i.samples)K(s.data),this.writer.write(s.data),s.data=null;if(this.format._options.onMdat){const{data:i,start:s}=this.writer.stopTrackingWrites();this.format._options.onMdat(i,s)}}else if(this.isFragmented){const n=this.writer.getPos(),r=UG(this.trackDatas);this.boxWriter.writeBox(r);const i=this.writer.getPos()-n;this.writer.seek(this.writer.getPos()-4),this.boxWriter.writeU32(i)}else{K(this.mdat);const n=this.boxWriter.offsets.get(this.mdat);K(n!==void 0);const r=this.writer.getPos()-n;if(this.mdat.size=r,this.mdat.largeSize=r>=2**32,this.boxWriter.patchBox(this.mdat),this.format._options.onMdat){const{data:s,start:o}=this.writer.stopTrackingWrites();this.format._options.onMdat(s,o)}const i=Qd(this);if(this.fastStart==="reserve"){K(this.ftypSize!==null),this.writer.seek(this.ftypSize),this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(i);const s=this.boxWriter.offsets.get(this.mdat)-this.writer.getPos();this.boxWriter.writeBox(XK(s))}else this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(i);if(this.format._options.onMoov){const{data:s,start:o}=this.writer.stopTrackingWrites();this.format._options.onMoov(s,o)}}e()}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class OM{getSupportedVideoCodecs(){return this.getSupportedCodecs().filter(e=>co.includes(e))}getSupportedAudioCodecs(){return this.getSupportedCodecs().filter(e=>uo.includes(e))}getSupportedSubtitleCodecs(){return this.getSupportedCodecs().filter(e=>Mm.includes(e))}_codecUnsupportedHint(e){return""}}class NM extends OM{constructor(e={}){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(e.fastStart!==void 0&&![!1,"in-memory","reserve","fragmented"].includes(e.fastStart))throw new TypeError("options.fastStart, when provided, must be false, 'in-memory', 'reserve', or 'fragmented'.");if(e.minimumFragmentDuration!==void 0&&(!Number.isFinite(e.minimumFragmentDuration)||e.minimumFragmentDuration<0))throw new TypeError("options.minimumFragmentDuration, when provided, must be a non-negative number.");if(e.onFtyp!==void 0&&typeof e.onFtyp!="function")throw new TypeError("options.onFtyp, when provided, must be a function.");if(e.onMoov!==void 0&&typeof e.onMoov!="function")throw new TypeError("options.onMoov, when provided, must be a function.");if(e.onMdat!==void 0&&typeof e.onMdat!="function")throw new TypeError("options.onMdat, when provided, must be a function.");if(e.onMoof!==void 0&&typeof e.onMoof!="function")throw new TypeError("options.onMoof, when provided, must be a function.");if(e.metadataFormat!==void 0&&!["mdir","mdta","udta","auto"].includes(e.metadataFormat))throw new TypeError("options.metadataFormat, when provided, must be either 'auto', 'mdir', 'mdta', or 'udta'.");super(),this._options=e}getSupportedTrackCounts(){return{video:{min:0,max:1/0},audio:{min:0,max:1/0},subtitle:{min:0,max:1/0},total:{min:1,max:2**32-1}}}get supportsVideoRotationMetadata(){return!0}_createMuxer(e){return new oZ(e,this)}}class Ex extends NM{constructor(e){super(e)}get _name(){return"MP4"}get fileExtension(){return".mp4"}get mimeType(){return"video/mp4"}getSupportedCodecs(){return[...co,...kf,"pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be",...Mm]}_codecUnsupportedHint(e){return new RM().getSupportedCodecs().includes(e)?" Switching to MOV will grant support for this codec.":""}}class RM extends NM{constructor(e){super(e)}get _name(){return"MOV"}get fileExtension(){return".mov"}get mimeType(){return"video/quicktime"}getSupportedCodecs(){return[...co,...uo]}_codecUnsupportedHint(e){return new Ex().getSupportedCodecs().includes(e)?" Switching to MP4 will grant support for this codec.":""}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const aZ=t=>{if(!t||typeof t!="object")throw new TypeError("Encoding config must be an object.");if(!co.includes(t.codec))throw new TypeError(`Invalid video codec '${t.codec}'. Must be one of: ${co.join(", ")}.`);if(!(t.bitrate instanceof Cs)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("config.bitrate must be a positive integer or a quality.");if(t.keyFrameInterval!==void 0&&(!Number.isFinite(t.keyFrameInterval)||t.keyFrameInterval<0))throw new TypeError("config.keyFrameInterval, when provided, must be a non-negative number.");if(t.sizeChangeBehavior!==void 0&&!["deny","passThrough","fill","contain","cover"].includes(t.sizeChangeBehavior))throw new TypeError("config.sizeChangeBehavior, when provided, must be 'deny', 'passThrough', 'fill', 'contain' or 'cover'.");if(t.onEncodedPacket!==void 0&&typeof t.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(t.onEncoderConfig!==void 0&&typeof t.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");LM(t.codec,t)},LM=(t,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.alpha!==void 0&&!["discard","keep"].includes(e.alpha))throw new TypeError("options.alpha, when provided, must be 'discard' or 'keep'.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.latencyMode!==void 0&&!["quality","realtime"].includes(e.latencyMode))throw new TypeError("latencyMode, when provided, must be 'quality' or 'realtime'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&W4(e.fullCodecString)!==t)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${t}).`);if(e.hardwareAcceleration!==void 0&&!["no-preference","prefer-hardware","prefer-software"].includes(e.hardwareAcceleration))throw new TypeError("hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.");if(e.scalabilityMode!==void 0&&typeof e.scalabilityMode!="string")throw new TypeError("scalabilityMode, when provided, must be a string.");if(e.contentHint!==void 0&&typeof e.contentHint!="string")throw new TypeError("contentHint, when provided, must be a string.")},Qv=t=>{const e=t.bitrate instanceof Cs?t.bitrate._toVideoBitrate(t.codec,t.width,t.height):t.bitrate;return{codec:t.fullCodecString??KW(t.codec,t.width,t.height,e),width:t.width,height:t.height,bitrate:e,bitrateMode:t.bitrateMode,alpha:t.alpha??"discard",framerate:t.framerate,latencyMode:t.latencyMode,hardwareAcceleration:t.hardwareAcceleration,scalabilityMode:t.scalabilityMode,contentHint:t.contentHint,...QW(t.codec)}},lZ=t=>{if(!t||typeof t!="object")throw new TypeError("Encoding config must be an object.");if(!uo.includes(t.codec))throw new TypeError(`Invalid audio codec '${t.codec}'. Must be one of: ${uo.join(", ")}.`);if(t.bitrate===void 0&&(!Zr.includes(t.codec)||t.codec==="flac"))throw new TypeError("config.bitrate must be provided for compressed audio codecs.");if(t.bitrate!==void 0&&!(t.bitrate instanceof Cs)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("config.bitrate, when provided, must be a positive integer or a quality.");if(t.onEncodedPacket!==void 0&&typeof t.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(t.onEncoderConfig!==void 0&&typeof t.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");DM(t.codec,t)},DM=(t,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&W4(e.fullCodecString)!==t)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${t}).`)},Xv=t=>{const e=t.bitrate instanceof Cs?t.bitrate._toAudioBitrate(t.codec):t.bitrate;return{codec:t.fullCodecString??ZW(t.codec,t.numberOfChannels,t.sampleRate),numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate,bitrate:e,bitrateMode:t.bitrateMode,...XW(t.codec)}};class Cs{constructor(e){this._factor=e}_toVideoBitrate(e,n,r){const i=n*r,s={avc:1,hevc:.6,vp9:.6,av1:.4,vp8:1.2},o=1920*1080,a=3e6,l=Math.pow(i/o,.95),d=a*l*s[e]*this._factor;return Math.ceil(d/1e3)*1e3}_toAudioBitrate(e){if(Zr.includes(e)||e==="flac")return;const r={aac:128e3,opus:64e3,mp3:16e4,vorbis:64e3}[e];if(!r)throw new Error(`Unhandled codec: ${e}`);let i=r*this._factor;return e==="aac"?i=[96e3,128e3,16e4,192e3].reduce((o,a)=>Math.abs(a-i)<Math.abs(o-i)?a:o):e==="opus"||e==="vorbis"?i=Math.max(6e3,i):e==="mp3"&&(i=[8e3,16e3,24e3,32e3,4e4,48e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4].reduce((o,a)=>Math.abs(a-i)<Math.abs(o-i)?a:o)),Math.round(i/1e3)*1e3}}const GT=new Cs(.3),ZT=new Cs(1),$m=new Cs(2),cZ=async(t,e={})=>{const{width:n=1280,height:r=720,bitrate:i=1e6,...s}=e;if(!co.includes(t))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("width must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("height must be a positive integer.");if(!(i instanceof Cs)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer or a quality.");LM(t,s);let o=null;return $v.length>0&&(o??=Qv({codec:t,width:n,height:r,bitrate:i,framerate:void 0,...s}),$v.some(c=>c.supports(t,o)))?!0:typeof VideoEncoder>"u"||(n%2===1||r%2===1)&&(t==="avc"||t==="hevc")?!1:(o??=Qv({codec:t,width:n,height:r,bitrate:i,framerate:void 0,...s,alpha:"discard"}),(await VideoEncoder.isConfigSupported(o)).supported===!0)},uZ=async(t,e={})=>{const{numberOfChannels:n=2,sampleRate:r=48e3,bitrate:i=128e3,...s}=e;if(!uo.includes(t))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("numberOfChannels must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("sampleRate must be a positive integer.");if(!(i instanceof Cs)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer.");DM(t,s);let o=null;return Fv.length>0&&(o??=Xv({codec:t,numberOfChannels:n,sampleRate:r,bitrate:i,...s}),Fv.some(l=>l.supports(t,o)))||Zr.includes(t)?!0:typeof AudioEncoder>"u"?!1:(o??=Xv({codec:t,numberOfChannels:n,sampleRate:r,bitrate:i,...s}),(await AudioEncoder.isConfigSupported(o)).supported===!0)},Yv=async(t=uo,e)=>{const n=await Promise.all(t.map(r=>uZ(r,e)));return t.filter((r,i)=>n[i])},dZ=async(t,e)=>{for(const n of t)if(await cZ(n,e))return n;return null};/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */class kx{constructor(){this._connectedTrack=null,this._closingPromise=null,this._closed=!1,this._timestampOffset=0}_ensureValidAdd(){if(!this._connectedTrack)throw new Error("Source is not connected to an output track.");if(this._connectedTrack.output.state==="canceled")throw new Error("Output has been canceled.");if(this._connectedTrack.output.state==="finalizing"||this._connectedTrack.output.state==="finalized")throw new Error("Output has been finalized.");if(this._connectedTrack.output.state==="pending")throw new Error("Output has not started.");if(this._closed)throw new Error("Source is closed.")}async _start(){}async _flushAndClose(e){}close(){if(this._closingPromise)return;const e=this._connectedTrack;if(!e)throw new Error("Cannot call close without connecting the source to an output track.");if(e.output.state==="pending")throw new Error("Cannot call close before output has been started.");this._closingPromise=(async()=>{await this._flushAndClose(!1),this._closed=!0,!(e.output.state==="finalizing"||e.output.state==="finalized")&&e.output._muxer.onTrackClose(e)})()}async _flushOrWaitForOngoingClose(e){return this._closingPromise?this._closingPromise:this._flushAndClose(e)}}class Tx extends kx{constructor(e){if(super(),this._connectedTrack=null,!co.includes(e))throw new TypeError(`Invalid video codec '${e}'. Must be one of: ${co.join(", ")}.`);this._codec=e}}class fZ extends Tx{constructor(e){super(e)}add(e,n){if(!(e instanceof wn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedVideoPacket(this._connectedTrack,e,n)}}class hZ{constructor(e,n){this.source=e,this.encodingConfig=n,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastMultipleOfKeyFrameInterval=-1,this.codedWidth=null,this.codedHeight=null,this.resizeCanvas=null,this.customEncoder=null,this.customEncoderCallSerializer=new C0,this.customEncoderQueueSize=0,this.alphaEncoder=null,this.splitter=null,this.splitterCreationFailed=!1,this.alphaFrameQueue=[],this.error=null,this.errorNeedsNewStack=!0}async add(e,n,r){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.codedWidth!==null&&this.codedHeight!==null){if(e.codedWidth!==this.codedWidth||e.codedHeight!==this.codedHeight){const a=this.encodingConfig.sizeChangeBehavior??"deny";if(a!=="passThrough"){if(a==="deny")throw new Error(`Video sample size must remain constant. Expected ${this.codedWidth}x${this.codedHeight}, got ${e.codedWidth}x${e.codedHeight}. To allow the sample size to change over time, set \`sizeChangeBehavior\` to a value other than 'strict' in the encoding options.`);{let l=!1;this.resizeCanvas||(typeof document<"u"?(this.resizeCanvas=document.createElement("canvas"),this.resizeCanvas.width=this.codedWidth,this.resizeCanvas.height=this.codedHeight):this.resizeCanvas=new OffscreenCanvas(this.codedWidth,this.codedHeight),l=!0);const c=this.resizeCanvas.getContext("2d",{alpha:eh()});K(c),l||(eh()?(c.fillStyle="black",c.fillRect(0,0,this.codedWidth,this.codedHeight)):c.clearRect(0,0,this.codedWidth,this.codedHeight)),e.drawWithFit(c,{fit:a}),n&&e.close(),e=new Gr(this.resizeCanvas,{timestamp:e.timestamp,duration:e.duration,rotation:e.rotation}),n=!0}}}}else this.codedWidth=e.codedWidth,this.codedHeight=e.codedHeight;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),K(this.encoderInitialized);const i=this.encodingConfig.keyFrameInterval??5,s=Math.floor(e.timestamp/i),o={...r,keyFrame:r?.keyFrame||i===0||s!==this.lastMultipleOfKeyFrameInterval};if(this.lastMultipleOfKeyFrameInterval=s,this.customEncoder){this.customEncoderQueueSize++;const a=e.clone(),l=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(a,o)).then(()=>this.customEncoderQueueSize--).catch(c=>this.error??=c).finally(()=>{a.close()});this.customEncoderQueueSize>=4&&await l}else{K(this.encoder);const a=e.toVideoFrame();if(!this.alphaEncoder)this.encoder.encode(a,o),a.close();else if(!!a.format&&!a.format.includes("A")||this.splitterCreationFailed)this.alphaFrameQueue.push(null),this.encoder.encode(a,o),a.close();else{const c=a.displayWidth,u=a.displayHeight;if(!this.splitter)try{this.splitter=new pZ(c,u)}catch(d){console.error("Due to an error, only color data will be encoded.",d),this.splitterCreationFailed=!0,this.alphaFrameQueue.push(null),this.encoder.encode(a,o),a.close()}if(this.splitter){const d=this.splitter.extractColor(a),f=this.splitter.extractAlpha(a);this.alphaFrameQueue.push(f),this.encoder.encode(d,o),d.close(),a.close()}}n&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(l=>this.encoder.addEventListener("dequeue",l,{once:!0}))}await this.muxer.mutex.currentPromise}finally{n&&e.close()}}ensureEncoder(e){const n=new Error;this.ensureEncoderPromise=(async()=>{const r=Qv({width:e.codedWidth,height:e.codedHeight,...this.encodingConfig,framerate:this.source._connectedTrack?.metadata.frameRate});this.encodingConfig.onEncoderConfig?.(r);const i=$v.find(s=>s.supports(this.encodingConfig.codec,r));if(i)this.customEncoder=new i,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=r,this.customEncoder.onPacket=(s,o)=>{if(!(s instanceof wn))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(o!==void 0&&(!o||typeof o!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(s,o),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,s,o).catch(a=>{this.error??=a,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else{if(typeof VideoEncoder>"u")throw new Error("VideoEncoder is not supported by this browser.");if(r.alpha="discard",this.encodingConfig.alpha==="keep"&&(r.latencyMode="quality"),(r.width%2===1||r.height%2===1)&&(this.encodingConfig.codec==="avc"||this.encodingConfig.codec==="hevc"))throw new Error(`The dimensions ${r.width}x${r.height} are not supported for codec '${this.encodingConfig.codec}'; both width and height must be even numbers. Make sure to round your dimensions to the nearest even number.`);if(!(await VideoEncoder.isConfigSupported(r)).supported)throw new Error(`This specific encoder configuration (${r.codec}, ${r.bitrate} bps, ${r.width}x${r.height}, hardware acceleration: ${r.hardwareAcceleration??"no-preference"}) is not supported by this browser. Consider using another codec or changing your video parameters.`);const a=[],l=[];let c=0,u=0;const d=(f,h,p)=>{const m={};if(h){const y=new Uint8Array(h.byteLength);h.copyTo(y),m.alpha=y}const g=wn.fromEncodedChunk(f,m);this.encodingConfig.onEncodedPacket?.(g,p),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,g,p).catch(y=>{this.error??=y,this.errorNeedsNewStack=!1})};this.encoder=new VideoEncoder({output:(f,h)=>{if(!this.alphaEncoder){d(f,null,h);return}const p=this.alphaFrameQueue.shift();K(p!==void 0),p?(this.alphaEncoder.encode(p,{keyFrame:f.type==="key"}),u++,p.close(),a.push({chunk:f,meta:h})):u===0?d(f,null,h):(l.push(c+u),a.push({chunk:f,meta:h}))},error:f=>{f.stack=n.stack,this.error??=f}}),this.encoder.configure(r),this.encodingConfig.alpha==="keep"&&(this.alphaEncoder=new VideoEncoder({output:(f,h)=>{u--;const p=a.shift();for(K(p!==void 0),d(p.chunk,f,p.meta),c++;l.length>0&&l[0]===c;){l.shift();const m=a.shift();K(m!==void 0),d(m.chunk,null,m.meta)}},error:f=>{f.stack=n.stack,this.error??=f}}),this.alphaEncoder.configure(r))}K(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||(await this.encoder.flush(),await this.alphaEncoder?.flush()),this.encoder.state!=="closed"&&this.encoder.close(),this.alphaEncoder&&this.alphaEncoder.state!=="closed"&&this.alphaEncoder.close(),this.alphaFrameQueue.forEach(n=>n?.close()),this.splitter?.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class pZ{constructor(e,n){this.lastFrame=null,typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(e,n):(this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=n);const r=this.canvas.getContext("webgl2",{alpha:!0});if(!r)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=r,this.colorProgram=this.createColorProgram(),this.alphaProgram=this.createAlphaProgram(),this.vao=this.createVAO(),this.sourceTexture=this.createTexture(),this.alphaResolutionLocation=this.gl.getUniformLocation(this.alphaProgram,"u_resolution"),this.gl.useProgram(this.colorProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.colorProgram,"u_sourceTexture"),0),this.gl.useProgram(this.alphaProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.alphaProgram,"u_sourceTexture"),0)}createVertexShader(){return this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`)}createColorProgram(){const e=this.createVertexShader(),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec4 source = texture(u_sourceTexture, v_texCoord);
				fragColor = vec4(source.rgb, 1.0);
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createAlphaProgram(){const e=this.createVertexShader(),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			uniform vec2 u_resolution; // The width and height of the canvas
			in vec2 v_texCoord;
			out vec4 fragColor;

			// This function determines the value for a single byte in the YUV stream
			float getByteValue(float byteOffset) {
				float width = u_resolution.x;
				float height = u_resolution.y;

				float yPlaneSize = width * height;

				if (byteOffset < yPlaneSize) {
					// This byte is in the luma plane. Find the corresponding pixel coordinates to sample from
					float y = floor(byteOffset / width);
					float x = mod(byteOffset, width);
					
					// Add 0.5 to sample the center of the texel
					vec2 sampleCoord = (vec2(x, y) + 0.5) / u_resolution;
					
					// The luma value is the alpha from the source texture
					return texture(u_sourceTexture, sampleCoord).a;
				} else {
					// Write a fixed value for chroma and beyond
					return 128.0 / 255.0;
				}
			}
			
			void main() {
				// Each fragment writes 4 bytes (R, G, B, A)
				float pixelIndex = floor(gl_FragCoord.y) * u_resolution.x + floor(gl_FragCoord.x);
				float baseByteOffset = pixelIndex * 4.0;

				vec4 result;
				for (int i = 0; i < 4; i++) {
					float currentByteOffset = baseByteOffset + float(i);
					result[i] = getByteValue(currentByteOffset);
				}
				
				fragColor = result;
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createShader(e,n){const r=this.gl.createShader(e);return this.gl.shaderSource(r,n),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)||console.error("Shader compile error:",this.gl.getShaderInfoLog(r)),r}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const n=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(this.colorProgram,"a_position"),s=this.gl.getAttribLocation(this.colorProgram,"a_texCoord");return this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}updateTexture(e){this.lastFrame!==e&&((e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sourceTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.lastFrame=e)}extractColor(e){return this.updateTexture(e),this.gl.useProgram(this.colorProgram),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),new VideoFrame(this.canvas,{timestamp:e.timestamp,duration:e.duration??void 0,alpha:"discard"})}extractAlpha(e){this.updateTexture(e),this.gl.useProgram(this.alphaProgram),this.gl.uniform2f(this.alphaResolutionLocation,this.canvas.width,this.canvas.height),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const{width:n,height:r}=this.canvas,i=Math.ceil(n/2)*Math.ceil(r/2),s=n*r+i*2,o=Math.ceil(s/(n*4));let a=new Uint8Array(4*n*o);this.gl.readPixels(0,0,n,o,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),a=a.subarray(0,s),K(a[n*r]===128),K(a[a.length-1]===128);const l={format:"I420",codedWidth:n,codedHeight:r,timestamp:e.timestamp,duration:e.duration??void 0,transfer:[a.buffer]};return new VideoFrame(a,l)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class QT extends Tx{constructor(e){aZ(e),super(e.codec),this._encoder=new hZ(this,e)}add(e,n){if(!(e instanceof Gr))throw new TypeError("videoSample must be a VideoSample.");return this._encoder.add(e,!1,n)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class _x extends kx{constructor(e){if(super(),this._connectedTrack=null,!uo.includes(e))throw new TypeError(`Invalid audio codec '${e}'. Must be one of: ${uo.join(", ")}.`);this._codec=e}}class mZ extends _x{constructor(e){super(e)}add(e,n){if(!(e instanceof wn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedAudioPacket(this._connectedTrack,e,n)}}class gZ{constructor(e,n){this.source=e,this.encodingConfig=n,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastNumberOfChannels=null,this.lastSampleRate=null,this.isPcmEncoder=!1,this.outputSampleSize=null,this.writeOutputValue=null,this.customEncoder=null,this.customEncoderCallSerializer=new C0,this.customEncoderQueueSize=0,this.error=null,this.errorNeedsNewStack=!0}async add(e,n){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.lastNumberOfChannels!==null&&this.lastSampleRate!==null){if(e.numberOfChannels!==this.lastNumberOfChannels||e.sampleRate!==this.lastSampleRate)throw new Error(`Audio parameters must remain constant. Expected ${this.lastNumberOfChannels} channels at ${this.lastSampleRate} Hz, got ${e.numberOfChannels} channels at ${e.sampleRate} Hz.`)}else this.lastNumberOfChannels=e.numberOfChannels,this.lastSampleRate=e.sampleRate;if(this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),K(this.encoderInitialized),this.customEncoder){this.customEncoderQueueSize++;const r=e.clone(),i=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(r)).then(()=>this.customEncoderQueueSize--).catch(s=>this.error??=s).finally(()=>{r.close()});this.customEncoderQueueSize>=4&&await i,await this.muxer.mutex.currentPromise}else if(this.isPcmEncoder)await this.doPcmEncoding(e,n);else{K(this.encoder);const r=e.toAudioData();this.encoder.encode(r),r.close(),n&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(i=>this.encoder.addEventListener("dequeue",i,{once:!0})),await this.muxer.mutex.currentPromise}}finally{n&&e.close()}}async doPcmEncoding(e,n){K(this.outputSampleSize),K(this.writeOutputValue);const{numberOfChannels:r,numberOfFrames:i,sampleRate:s,timestamp:o}=e,a=2048,l=[];for(let f=0;f<i;f+=a){const h=Math.min(a,e.numberOfFrames-f),p=h*r*this.outputSampleSize,m=new ArrayBuffer(p),g=new DataView(m);l.push({frameCount:h,view:g})}const c=e.allocationSize({planeIndex:0,format:"f32-planar"}),u=new Float32Array(c/Float32Array.BYTES_PER_ELEMENT);for(let f=0;f<r;f++){e.copyTo(u,{planeIndex:f,format:"f32-planar"});for(let h=0;h<l.length;h++){const{frameCount:p,view:m}=l[h];for(let g=0;g<p;g++)this.writeOutputValue(m,(g*r+f)*this.outputSampleSize,u[h*a+g])}}n&&e.close();const d={decoderConfig:{codec:this.encodingConfig.codec,numberOfChannels:r,sampleRate:s}};for(let f=0;f<l.length;f++){const{frameCount:h,view:p}=l[f],m=p.buffer,g=f*a,y=new wn(new Uint8Array(m),"key",o+g/s,h/s);this.encodingConfig.onEncodedPacket?.(y,d),await this.muxer.addEncodedAudioPacket(this.source._connectedTrack,y,d)}}ensureEncoder(e){const n=new Error;this.ensureEncoderPromise=(async()=>{const{numberOfChannels:r,sampleRate:i}=e,s=Xv({numberOfChannels:r,sampleRate:i,...this.encodingConfig});this.encodingConfig.onEncoderConfig?.(s);const o=Fv.find(a=>a.supports(this.encodingConfig.codec,s));if(o)this.customEncoder=new o,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=s,this.customEncoder.onPacket=(a,l)=>{if(!(a instanceof wn))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(l!==void 0&&(!l||typeof l!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(a,l),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,a,l).catch(c=>{this.error??=c,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else if(Zr.includes(this.encodingConfig.codec))this.initPcmEncoder();else{if(typeof AudioEncoder>"u")throw new Error("AudioEncoder is not supported by this browser.");if(!(await AudioEncoder.isConfigSupported(s)).supported)throw new Error(`This specific encoder configuration (${s.codec}, ${s.bitrate} bps, ${s.numberOfChannels} channels, ${s.sampleRate} Hz) is not supported by this browser. Consider using another codec or changing your audio parameters.`);this.encoder=new AudioEncoder({output:(l,c)=>{const u=wn.fromEncodedChunk(l);this.encodingConfig.onEncodedPacket?.(u,c),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,u,c).catch(d=>{this.error??=d,this.errorNeedsNewStack=!1})},error:l=>{l.stack=n.stack,this.error??=l}}),this.encoder.configure(s)}K(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}initPcmEncoder(){this.isPcmEncoder=!0;const e=this.encodingConfig.codec,{dataType:n,sampleSize:r,littleEndian:i}=$l(e);switch(this.outputSampleSize=r,r){case 1:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint8(o,pr((a+1)*127.5,0,255)):n==="signed"?this.writeOutputValue=(s,o,a)=>{s.setInt8(o,pr(Math.round(a*128),-128,127))}:n==="ulaw"?this.writeOutputValue=(s,o,a)=>{const l=pr(Math.floor(a*32767),-32768,32767);s.setUint8(o,xq(l))}:n==="alaw"?this.writeOutputValue=(s,o,a)=>{const l=pr(Math.floor(a*32767),-32768,32767);s.setUint8(o,Eq(l))}:K(!1);break;case 2:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint16(o,pr((a+1)*32767.5,0,65535),i):n==="signed"?this.writeOutputValue=(s,o,a)=>s.setInt16(o,pr(Math.round(a*32767),-32768,32767),i):K(!1);break;case 3:n==="unsigned"?this.writeOutputValue=(s,o,a)=>L4(s,o,pr((a+1)*83886075e-1,0,16777215),i):n==="signed"?this.writeOutputValue=(s,o,a)=>UW(s,o,pr(Math.round(a*8388607),-8388608,8388607),i):K(!1);break;case 4:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint32(o,pr((a+1)*21474836475e-1,0,4294967295),i):n==="signed"?this.writeOutputValue=(s,o,a)=>s.setInt32(o,pr(Math.round(a*2147483647),-2147483648,2147483647),i):n==="float"?this.writeOutputValue=(s,o,a)=>s.setFloat32(o,a,i):K(!1);break;case 8:n==="float"?this.writeOutputValue=(s,o,a)=>s.setFloat64(o,a,i):K(!1);break;default:Al(r),K(!1)}}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||await this.encoder.flush(),this.encoder.state!=="closed"&&this.encoder.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.isPcmEncoder?0:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class XT extends _x{constructor(e){lZ(e),super(e.codec),this._encoder=new gZ(this,e)}add(e){if(!(e instanceof xs))throw new TypeError("audioSample must be an AudioSample.");return this._encoder.add(e,!1)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class yZ extends kx{constructor(e){if(super(),this._connectedTrack=null,!Mm.includes(e))throw new TypeError(`Invalid subtitle codec '${e}'. Must be one of: ${Mm.join(", ")}.`);this._codec=e}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const bZ=["video","audio","subtitle"],Db=t=>{if(!t||typeof t!="object")throw new TypeError("metadata must be an object.");if(t.languageCode!==void 0&&!Jf(t.languageCode))throw new TypeError("metadata.languageCode, when provided, must be a three-letter, ISO 639-2/T language code.");if(t.name!==void 0&&typeof t.name!="string")throw new TypeError("metadata.name, when provided, must be a string.");if(t.maximumPacketCount!==void 0&&(!Number.isInteger(t.maximumPacketCount)||t.maximumPacketCount<0))throw new TypeError("metadata.maximumPacketCount, when provided, must be a non-negative integer.")};class Jv{constructor(e){if(this.state="pending",this._tracks=[],this._startPromise=null,this._cancelPromise=null,this._finalizePromise=null,this._mutex=new kd,this._metadataTags={},!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.format instanceof OM))throw new TypeError("options.format must be an OutputFormat.");if(!(e.target instanceof Sx))throw new TypeError("options.target must be a Target.");if(e.target._output)throw new Error("Target is already used for another output.");e.target._output=this,this.format=e.format,this.target=e.target,this._writer=e.target._createWriter(),this._muxer=e.format._createMuxer(this)}addVideoTrack(e,n={}){if(!(e instanceof Tx))throw new TypeError("source must be a VideoSource.");if(Db(n),n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError(`Invalid video rotation: ${n.rotation}. Has to be 0, 90, 180 or 270.`);if(!this.format.supportsVideoRotationMetadata&&n.rotation)throw new Error(`${this.format._name} does not support video rotation metadata.`);if(n.frameRate!==void 0&&(!Number.isFinite(n.frameRate)||n.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${n.frameRate}. Must be a positive number.`);this._addTrack("video",e,n)}addAudioTrack(e,n={}){if(!(e instanceof _x))throw new TypeError("source must be an AudioSource.");Db(n),this._addTrack("audio",e,n)}addSubtitleTrack(e,n={}){if(!(e instanceof yZ))throw new TypeError("source must be a SubtitleSource.");Db(n),this._addTrack("subtitle",e,n)}setMetadataTags(e){if(Lv(e),this.state!=="pending")throw new Error("Cannot set metadata tags after output has been started or canceled.");this._metadataTags=e}_addTrack(e,n,r){if(this.state!=="pending")throw new Error("Cannot add track after output has been started or canceled.");if(n._connectedTrack)throw new Error("Source is already used for a track.");const i=this.format.getSupportedTrackCounts(),s=this._tracks.reduce((c,u)=>c+(u.type===e?1:0),0),o=i[e].max;if(s===o)throw new Error(o===0?`${this.format._name} does not support ${e} tracks.`:`${this.format._name} does not support more than ${o} ${e} track${o===1?"":"s"}.`);const a=i.total.max;if(this._tracks.length===a)throw new Error(`${this.format._name} does not support more than ${a} tracks${a===1?"":"s"} in total.`);const l={id:this._tracks.length+1,output:this,type:e,source:n,metadata:r};if(l.type==="video"){const c=this.format.getSupportedVideoCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support video tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported video codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}else if(l.type==="audio"){const c=this.format.getSupportedAudioCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support audio tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported audio codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}else if(l.type==="subtitle"){const c=this.format.getSupportedSubtitleCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support subtitle tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported subtitle codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}this._tracks.push(l),n._connectedTrack=l}async start(){const e=this.format.getSupportedTrackCounts();for(const r of bZ){const i=this._tracks.reduce((o,a)=>o+(a.type===r?1:0),0),s=e[r].min;if(i<s)throw new Error(s===e[r].max?`${this.format._name} requires exactly ${s} ${r} track${s===1?"":"s"}.`:`${this.format._name} requires at least ${s} ${r} track${s===1?"":"s"}.`)}const n=e.total.min;if(this._tracks.length<n)throw new Error(n===e.total.max?`${this.format._name} requires exactly ${n} track${n===1?"":"s"}.`:`${this.format._name} requires at least ${n} track${n===1?"":"s"}.`);if(this.state==="canceled")throw new Error("Output has been canceled.");return this._startPromise?(console.warn("Output has already been started."),this._startPromise):this._startPromise=(async()=>{this.state="started",this._writer.start();const r=await this._mutex.acquire();await this._muxer.start();const i=this._tracks.map(s=>s.source._start());await Promise.all(i),r()})()}getMimeType(){return this._muxer.getMimeType()}async cancel(){if(this._cancelPromise)return console.warn("Output has already been canceled."),this._cancelPromise;if(this.state==="finalizing"||this.state==="finalized"){console.warn("Output has already been finalized.");return}return this._cancelPromise=(async()=>{this.state="canceled";const e=await this._mutex.acquire(),n=this._tracks.map(r=>r.source._flushOrWaitForOngoingClose(!0));await Promise.all(n),await this._writer.close(),e()})()}async finalize(){if(this.state==="pending")throw new Error("Cannot finalize before starting.");if(this.state==="canceled")throw new Error("Cannot finalize after canceling.");return this._finalizePromise?(console.warn("Output has already been finalized."),this._finalizePromise):this._finalizePromise=(async()=>{this.state="finalizing";const e=await this._mutex.acquire(),n=this._tracks.map(r=>r.source._flushOrWaitForOngoingClose(!1));await Promise.all(n),await this._muxer.finalize(),await this._writer.flush(),await this._writer.finalize(),this.state="finalized",e()})()}}/*!
 * Copyright (c) 2025-present, Vanilagy and contributors
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
 */const YT=t=>{if(t!==void 0&&(!t||typeof t!="object"))throw new TypeError("options.video, when provided, must be an object.");if(t?.discard!==void 0&&typeof t.discard!="boolean")throw new TypeError("options.video.discard, when provided, must be a boolean.");if(t?.forceTranscode!==void 0&&typeof t.forceTranscode!="boolean")throw new TypeError("options.video.forceTranscode, when provided, must be a boolean.");if(t?.codec!==void 0&&!co.includes(t.codec))throw new TypeError(`options.video.codec, when provided, must be one of: ${co.join(", ")}.`);if(t?.bitrate!==void 0&&!(t.bitrate instanceof Cs)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("options.video.bitrate, when provided, must be a positive integer or a quality.");if(t?.width!==void 0&&(!Number.isInteger(t.width)||t.width<=0))throw new TypeError("options.video.width, when provided, must be a positive integer.");if(t?.height!==void 0&&(!Number.isInteger(t.height)||t.height<=0))throw new TypeError("options.video.height, when provided, must be a positive integer.");if(t?.fit!==void 0&&!["fill","contain","cover"].includes(t.fit))throw new TypeError("options.video.fit, when provided, must be one of 'fill', 'contain', or 'cover'.");if(t?.width!==void 0&&t.height!==void 0&&t.fit===void 0)throw new TypeError("When both options.video.width and options.video.height are provided, options.video.fit must also be provided.");if(t?.rotate!==void 0&&![0,90,180,270].includes(t.rotate))throw new TypeError("options.video.rotate, when provided, must be 0, 90, 180 or 270.");if(t?.crop!==void 0&&gx(t.crop,"options.video."),t?.frameRate!==void 0&&(!Number.isFinite(t.frameRate)||t.frameRate<=0))throw new TypeError("options.video.frameRate, when provided, must be a finite positive number.");if(t?.alpha!==void 0&&!["discard","keep"].includes(t.alpha))throw new TypeError("options.video.alpha, when provided, must be either 'discard' or 'keep'.");if(t?.keyFrameInterval!==void 0&&(!Number.isFinite(t.keyFrameInterval)||t.keyFrameInterval<0))throw new TypeError("options.video.keyFrameInterval, when provided, must be a non-negative number.");if(t?.process!==void 0&&typeof t.process!="function")throw new TypeError("options.video.process, when provided, must be a function.");if(t?.processedWidth!==void 0&&(!Number.isInteger(t.processedWidth)||t.processedWidth<=0))throw new TypeError("options.video.processedWidth, when provided, must be a positive integer.");if(t?.processedHeight!==void 0&&(!Number.isInteger(t.processedHeight)||t.processedHeight<=0))throw new TypeError("options.video.processedHeight, when provided, must be a positive integer.")},JT=t=>{if(t!==void 0&&(!t||typeof t!="object"))throw new TypeError("options.audio, when provided, must be an object.");if(t?.discard!==void 0&&typeof t.discard!="boolean")throw new TypeError("options.audio.discard, when provided, must be a boolean.");if(t?.forceTranscode!==void 0&&typeof t.forceTranscode!="boolean")throw new TypeError("options.audio.forceTranscode, when provided, must be a boolean.");if(t?.codec!==void 0&&!uo.includes(t.codec))throw new TypeError(`options.audio.codec, when provided, must be one of: ${uo.join(", ")}.`);if(t?.bitrate!==void 0&&!(t.bitrate instanceof Cs)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("options.audio.bitrate, when provided, must be a positive integer or a quality.");if(t?.numberOfChannels!==void 0&&(!Number.isInteger(t.numberOfChannels)||t.numberOfChannels<=0))throw new TypeError("options.audio.numberOfChannels, when provided, must be a positive integer.");if(t?.sampleRate!==void 0&&(!Number.isInteger(t.sampleRate)||t.sampleRate<=0))throw new TypeError("options.audio.sampleRate, when provided, must be a positive integer.");if(t?.process!==void 0&&typeof t.process!="function")throw new TypeError("options.audio.process, when provided, must be a function.");if(t?.processedNumberOfChannels!==void 0&&(!Number.isInteger(t.processedNumberOfChannels)||t.processedNumberOfChannels<=0))throw new TypeError("options.audio.processedNumberOfChannels, when provided, must be a positive integer.");if(t?.processedSampleRate!==void 0&&(!Number.isInteger(t.processedSampleRate)||t.processedSampleRate<=0))throw new TypeError("options.audio.processedSampleRate, when provided, must be a positive integer.")},Bb=2,$b=48e3;class Cx{static async init(e){const n=new Cx(e);return await n._init(),n}constructor(e){if(this._addedCounts={video:0,audio:0,subtitle:0},this._totalTrackCount=0,this._trackPromises=[],this._executed=!1,this._synchronizer=new wZ,this._totalDuration=null,this._maxTimestamps=new Map,this._canceled=!1,this.onProgress=void 0,this._computeProgress=!1,this._lastProgress=0,this.isValid=!1,this.utilizedTracks=[],this.discardedTracks=[],!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.input instanceof Kv))throw new TypeError("options.input must be an Input.");if(!(e.output instanceof Jv))throw new TypeError("options.output must be an Output.");if(e.output._tracks.length>0||Object.keys(e.output._metadataTags).length>0||e.output.state!=="pending")throw new TypeError("options.output must be fresh: no tracks or metadata tags added and not started.");if(typeof e.video!="function"&&YT(e.video),typeof e.audio!="function"&&JT(e.audio),e.trim!==void 0&&(!e.trim||typeof e.trim!="object"))throw new TypeError("options.trim, when provided, must be an object.");if(e.trim?.start!==void 0&&(!Number.isFinite(e.trim.start)||e.trim.start<0))throw new TypeError("options.trim.start, when provided, must be a non-negative number.");if(e.trim?.end!==void 0&&(!Number.isFinite(e.trim.end)||e.trim.end<0))throw new TypeError("options.trim.end, when provided, must be a non-negative number.");if(e.trim?.start!==void 0&&e.trim.end!==void 0&&e.trim.start>=e.trim.end)throw new TypeError("options.trim.start must be less than options.trim.end.");if(e.tags!==void 0&&(typeof e.tags!="object"||!e.tags)&&typeof e.tags!="function")throw new TypeError("options.tags, when provided, must be an object or a function.");if(typeof e.tags=="object"&&Lv(e.tags),e.showWarnings!==void 0&&typeof e.showWarnings!="boolean")throw new TypeError("options.showWarnings, when provided, must be a boolean.");this._options=e,this.input=e.input,this.output=e.output,this._startTimestamp=e.trim?.start??0,this._endTimestamp=e.trim?.end??1/0;const{promise:n,resolve:r}=Rr();this._started=n,this._start=r}async _init(){const e=await this.input.getTracks(),n=this.output.format.getSupportedTrackCounts();let r=1,i=1;for(const c of e){let u;if(c.isVideoTrack()?this._options.video&&(typeof this._options.video=="function"?(u=await this._options.video(c,r),YT(u),r++):u=this._options.video):c.isAudioTrack()?this._options.audio&&(typeof this._options.audio=="function"?(u=await this._options.audio(c,i),JT(u),i++):u=this._options.audio):K(!1),u?.discard){this.discardedTracks.push({track:c,reason:"discarded_by_user"});continue}if(this._totalTrackCount===n.total.max){this.discardedTracks.push({track:c,reason:"max_track_count_reached"});continue}if(this._addedCounts[c.type]===n[c.type].max){this.discardedTracks.push({track:c,reason:"max_track_count_of_type_reached"});continue}c.isVideoTrack()?await this._processVideoTrack(c,u??{}):c.isAudioTrack()&&await this._processAudioTrack(c,u??{})}const s=await this.input.getMetadataTags();let o;if(this._options.tags){const c=typeof this._options.tags=="function"?await this._options.tags(s):this._options.tags;Lv(c),o=c}else o=s;const a=(await this.input.getFormat()).mimeType===this.output.format.mimeType,l=s.raw===o.raw;if(s.raw&&l&&!a&&delete o.raw,this.output.setMetadataTags(o),this.isValid=this._totalTrackCount>=n.total.min&&this._addedCounts.video>=n.video.min&&this._addedCounts.audio>=n.audio.min&&this._addedCounts.subtitle>=n.subtitle.min,this._options.showWarnings??!0){const c=[],u=this.discardedTracks.filter(d=>d.reason!=="discarded_by_user");u.length>0&&c.push("Some tracks had to be discarded from the conversion:",u),this.isValid||c.push(`

`+this._getInvalidityExplanation().join("")),c.length>0&&console.warn(...c)}}_getInvalidityExplanation(){const e=[];if(this.discardedTracks.length===0)e.push("Due to missing tracks, this conversion cannot be executed.");else{const n=this.discardedTracks.every(r=>r.reason==="discarded_by_user"||r.reason==="no_encodable_target_codec");if(e.push("Due to discarded tracks, this conversion cannot be executed."),n){const r=this.discardedTracks.flatMap(i=>i.reason==="discarded_by_user"?[]:i.track.type==="video"?this.output.format.getSupportedVideoCodecs():i.track.type==="audio"?this.output.format.getSupportedAudioCodecs():this.output.format.getSupportedSubtitleCodecs());r.length===1?e.push(`
Tracks were discarded because your environment is not able to encode '${r[0]}'.`):e.push(`
Tracks were discarded because your environment is not able to encode any of the following codecs: ${r.map(i=>`'${i}'`).join(", ")}.`),r.includes("mp3")&&e.push(`
The @mediabunny/mp3-encoder extension package provides support for encoding MP3.`)}else e.push(`
Check the discardedTracks field for more info.`)}return e}async execute(){if(!this.isValid)throw new Error(`Cannot execute this conversion because its output configuration is invalid. Make sure to always check the isValid field before executing a conversion.
`+this._getInvalidityExplanation().join(""));if(this._executed)throw new Error("Conversion cannot be executed twice.");if(this._executed=!0,this.onProgress){this._computeProgress=!0,this._totalDuration=Math.min(await this.input.computeDuration()-this._startTimestamp,this._endTimestamp-this._startTimestamp);for(const e of this.utilizedTracks)this._maxTimestamps.set(e.id,0);this.onProgress?.(0)}await this.output.start(),this._start();try{await Promise.all(this._trackPromises)}catch(e){throw this._canceled||this.cancel(),e}this._canceled&&await new Promise(()=>{}),await this.output.finalize(),this._computeProgress&&this.onProgress?.(1)}async cancel(){if(!(this.output.state==="finalizing"||this.output.state==="finalized")){if(this._canceled){console.warn("Conversion already canceled.");return}this._canceled=!0,await this.output.cancel()}}async _processVideoTrack(e,n){const r=e.codec;if(!r){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let i;const s=fx(e.rotation+(n.rotate??0)),o=this.output.format.supportsVideoRotationMetadata,[a,l]=s%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],c=n.crop;c&&mx(c,a,l);const[u,d]=c?[c.width,c.height]:[a,l];let f=u,h=d;const p=f/h,m=A=>Math.ceil(A/2)*2;n.width!==void 0&&n.height===void 0?(f=m(n.width),h=m(Math.round(f/p))):n.width===void 0&&n.height!==void 0?(h=m(n.height),f=m(Math.round(h*p))):n.width!==void 0&&n.height!==void 0&&(f=m(n.width),h=m(n.height));const g=await e.getFirstTimestamp(),y=!!n.forceTranscode||this._startTimestamp>0||g<0||!!n.frameRate||n.keyFrameInterval!==void 0||n.process!==void 0;let w=f!==u||h!==d||s!==0&&!o||!!c;const k=n.alpha??"discard";let C=this.output.format.getSupportedVideoCodecs();if(!y&&!n.bitrate&&!w&&C.includes(r)&&(!n.codec||n.codec===r)){const A=new fZ(r);i=A,this._trackPromises.push((async()=>{await this._started;const E=new th(e),S={decoderConfig:await e.getDecoderConfig()??void 0},x=Number.isFinite(this._endTimestamp)?await E.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const _ of E.packets(void 0,x,{verifyKeyPackets:!0})){if(this._canceled)return;k==="discard"&&(delete _.sideData.alpha,delete _.sideData.alphaByteLength),this._reportProgress(e.id,_.timestamp),await A.add(_,S),this._synchronizer.shouldWait(e.id,_.timestamp)&&await this._synchronizer.wait(_.timestamp)}A.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}n.codec&&(C=C.filter(_=>_===n.codec));const E=n.bitrate??$m,P=await dZ(C,{width:n.process&&n.processedWidth?n.processedWidth:f,height:n.process&&n.processedHeight?n.processedHeight:h,bitrate:E});if(!P){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}const S={codec:P,bitrate:E,keyFrameInterval:n.keyFrameInterval,sizeChangeBehavior:n.fit??"passThrough",alpha:k},x=new QT(S);if(i=x,!w){const _=new Jv({format:new Ex,target:new rZ}),I=new QT(S);_.addVideoTrack(I),await _.start();const B=await new zv(e).getSample(g);if(B)try{await I.add(B),B.close(),await _.finalize()}catch(F){console.info("Error when probing encoder support. Falling back to rerender path.",F),w=!0,_.cancel()}else await _.cancel()}w?this._trackPromises.push((async()=>{await this._started;const I=new Iq(e,{width:f,height:h,fit:n.fit??"fill",rotation:s,crop:n.crop,poolSize:1,alpha:k==="keep"}).canvases(this._startTimestamp,this._endTimestamp),D=n.frameRate;let B=null,F=null,R=null;const O=async L=>{K(B),K(D!==void 0);const H=Math.round((L-F)*D);for(let U=1;U<H;U++){const j=new Gr(B,{timestamp:F+U/D,duration:1/D});await this._registerVideoSample(e,n,x,j)}};for await(const{canvas:L,timestamp:H,duration:U}of I){if(this._canceled)return;let j=Math.max(H-this._startTimestamp,0);if(R=j+U,D!==void 0){const X=Math.floor(j*D)/D;if(B!==null)if(X<=F){B=L,F=X;continue}else await O(X);j=X}const Q=new Gr(L,{timestamp:j,duration:D!==void 0?1/D:U});await this._registerVideoSample(e,n,x,Q),D!==void 0?(B=L,F=j):Q.close()}B&&(K(R!==null),K(D!==void 0),await O(Math.floor(R*D)/D)),x.close(),this._synchronizer.closeTrack(e.id)})()):this._trackPromises.push((async()=>{await this._started;const _=new zv(e),I=n.frameRate;let D=null,B=null,F=null;const R=async O=>{K(D),K(I!==void 0);const L=Math.round((O-B)*I);for(let H=1;H<L;H++)D.setTimestamp(B+H/I),D.setDuration(1/I),await this._registerVideoSample(e,n,x,D);D.close()};for await(const O of _.samples(this._startTimestamp,this._endTimestamp)){if(this._canceled){D?.close();return}let L=Math.max(O.timestamp-this._startTimestamp,0);if(F=L+O.duration,I!==void 0){const H=Math.floor(L*I)/I;if(D!==null)if(H<=B){D.close(),D=O,B=H;continue}else await R(H);L=H,O.setDuration(1/I)}O.setTimestamp(L),await this._registerVideoSample(e,n,x,O),I!==void 0?(D=O,B=L):O.close()}D&&(K(F!==null),K(I!==void 0),await R(Math.floor(F*I)/I)),x.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addVideoTrack(i,{frameRate:n.frameRate,languageCode:Jf(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,rotation:w?0:s}),this._addedCounts.video++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerVideoSample(e,n,r,i){if(this._canceled)return;this._reportProgress(e.id,i.timestamp);let s;if(!n.process)s=[i];else{let o=n.process(i);o instanceof Promise&&(o=await o),Array.isArray(o)||(o=o===null?[]:[o]),s=o.map(a=>a instanceof Gr?a:typeof VideoFrame<"u"&&a instanceof VideoFrame?new Gr(a):new Gr(a,{timestamp:i.timestamp,duration:i.duration}))}for(const o of s){if(this._canceled)break;await r.add(o),this._synchronizer.shouldWait(e.id,o.timestamp)&&await this._synchronizer.wait(o.timestamp)}for(const o of s)o!==i&&o.close()}async _processAudioTrack(e,n){const r=e.codec;if(!r){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let i;const s=e.numberOfChannels,o=e.sampleRate,a=await e.getFirstTimestamp();let l=n.numberOfChannels??s,c=n.sampleRate??o,u=l!==s||c!==o||this._startTimestamp>0||a<0,d=this.output.format.getSupportedAudioCodecs();if(!n.forceTranscode&&!n.bitrate&&!u&&d.includes(r)&&(!n.codec||n.codec===r)&&!n.process){const f=new mZ(r);i=f,this._trackPromises.push((async()=>{await this._started;const h=new th(e),m={decoderConfig:await e.getDecoderConfig()??void 0},g=Number.isFinite(this._endTimestamp)?await h.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const y of h.packets(void 0,g)){if(this._canceled)return;this._reportProgress(e.id,y.timestamp),await f.add(y,m),this._synchronizer.shouldWait(e.id,y.timestamp)&&await this._synchronizer.wait(y.timestamp)}f.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}let h=null;n.codec&&(d=d.filter(g=>g===n.codec));const p=n.bitrate??$m,m=await Yv(d,{numberOfChannels:n.process&&n.processedNumberOfChannels?n.processedNumberOfChannels:l,sampleRate:n.process&&n.processedSampleRate?n.processedSampleRate:c,bitrate:p});if(!m.some(g=>kf.includes(g))&&d.some(g=>kf.includes(g))&&(l!==Bb||c!==$b)){const y=(await Yv(d,{numberOfChannels:Bb,sampleRate:$b,bitrate:p})).find(w=>kf.includes(w));y&&(u=!0,h=y,l=Bb,c=$b)}else h=m[0]??null;if(h===null){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}if(u)i=this._resampleAudio(e,n,h,l,c,p);else{const g=new XT({codec:h,bitrate:p});i=g,this._trackPromises.push((async()=>{await this._started;const y=new LT(e);for await(const w of y.samples(void 0,this._endTimestamp)){if(this._canceled)return;await this._registerAudioSample(e,n,g,w),w.close()}g.close(),this._synchronizer.closeTrack(e.id)})())}}this.output.addAudioTrack(i,{languageCode:Jf(e.languageCode)?e.languageCode:void 0,name:e.name??void 0}),this._addedCounts.audio++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerAudioSample(e,n,r,i){if(this._canceled)return;this._reportProgress(e.id,i.timestamp);let s;if(!n.process)s=[i];else{let o=n.process(i);if(o instanceof Promise&&(o=await o),Array.isArray(o)||(o=o===null?[]:[o]),!o.every(a=>a instanceof xs))throw new TypeError("The audio process function must return an AudioSample, null, or an array of AudioSamples.");s=o}for(const o of s){if(this._canceled)break;await r.add(o),this._synchronizer.shouldWait(e.id,o.timestamp)&&await this._synchronizer.wait(o.timestamp)}for(const o of s)o!==i&&o.close()}_resampleAudio(e,n,r,i,s,o){const a=new XT({codec:r,bitrate:o});return this._trackPromises.push((async()=>{await this._started;const l=new vZ({targetNumberOfChannels:i,targetSampleRate:s,startTime:this._startTimestamp,endTime:this._endTimestamp,onSample:d=>this._registerAudioSample(e,n,a,d)}),u=new LT(e).samples(this._startTimestamp,this._endTimestamp);for await(const d of u){if(this._canceled)return;await l.add(d)}await l.finalize(),a.close(),this._synchronizer.closeTrack(e.id)})()),a}_reportProgress(e,n){if(!this._computeProgress)return;K(this._totalDuration!==null),this._maxTimestamps.set(e,Math.max(n,this._maxTimestamps.get(e)));const r=Math.min(...this._maxTimestamps.values()),i=pr(r/this._totalDuration,0,1);i!==this._lastProgress&&(this._lastProgress=i,this.onProgress?.(i))}}const e_=5;class wZ{constructor(){this.maxTimestamps=new Map,this.resolvers=[]}computeMinAndMaybeResolve(){let e=1/0;for(const[,n]of this.maxTimestamps)e=Math.min(e,n);for(let n=0;n<this.resolvers.length;n++){const r=this.resolvers[n];r.timestamp-e<e_&&(r.resolve(),this.resolvers.splice(n,1),n--)}return e}shouldWait(e,n){this.maxTimestamps.set(e,Math.max(n,this.maxTimestamps.get(e)??-1/0));const r=this.computeMinAndMaybeResolve();return n-r>=e_}wait(e){const{promise:n,resolve:r}=Rr();return this.resolvers.push({timestamp:e,resolve:r}),n}closeTrack(e){this.maxTimestamps.delete(e),this.computeMinAndMaybeResolve()}}class vZ{constructor(e){this.sourceSampleRate=null,this.sourceNumberOfChannels=null,this.targetSampleRate=e.targetSampleRate,this.targetNumberOfChannels=e.targetNumberOfChannels,this.startTime=e.startTime,this.endTime=e.endTime,this.onSample=e.onSample,this.bufferSizeInFrames=Math.floor(this.targetSampleRate*5),this.bufferSizeInSamples=this.bufferSizeInFrames*this.targetNumberOfChannels,this.outputBuffer=new Float32Array(this.bufferSizeInSamples),this.bufferStartFrame=0,this.maxWrittenFrame=-1}doChannelMixerSetup(){K(this.sourceNumberOfChannels!==null);const e=this.sourceNumberOfChannels,n=this.targetNumberOfChannels;e===1&&n===2?this.channelMixer=(r,i)=>r[i*e]:e===1&&n===4?this.channelMixer=(r,i,s)=>r[i*e]*+(s<2):e===1&&n===6?this.channelMixer=(r,i,s)=>r[i*e]*+(s===2):e===2&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return .5*(r[s]+r[s+1])}:e===2&&n===4?this.channelMixer=(r,i,s)=>r[i*e+s]*+(s<2):e===2&&n===6?this.channelMixer=(r,i,s)=>r[i*e+s]*+(s<2):e===4&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return .25*(r[s]+r[s+1]+r[s+2]+r[s+3])}:e===4&&n===2?this.channelMixer=(r,i,s)=>{const o=i*e;return .5*(r[o+s]+r[o+s+2])}:e===4&&n===6?this.channelMixer=(r,i,s)=>{const o=i*e;return s<2?r[o+s]:s===2||s===3?0:r[o+s-2]}:e===6&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return Math.SQRT1_2*(r[s]+r[s+1])+r[s+2]+.5*(r[s+4]+r[s+5])}:e===6&&n===2?this.channelMixer=(r,i,s)=>{const o=i*e;return r[o+s]+Math.SQRT1_2*(r[o+2]+r[o+s+4])}:e===6&&n===4?this.channelMixer=(r,i,s)=>{const o=i*e;return s<2?r[o+s]+Math.SQRT1_2*r[o+2]:r[o+s+2]}:this.channelMixer=(r,i,s)=>s<e?r[i*e+s]:0}ensureTempBufferSize(e){let n=this.tempSourceBuffer.length;for(;n<e;)n*=2;if(n!==this.tempSourceBuffer.length){const r=new Float32Array(n);r.set(this.tempSourceBuffer),this.tempSourceBuffer=r}}async add(e){this.sourceSampleRate===null&&(this.sourceSampleRate=e.sampleRate,this.sourceNumberOfChannels=e.numberOfChannels,this.tempSourceBuffer=new Float32Array(this.sourceSampleRate*this.sourceNumberOfChannels),this.doChannelMixerSetup());const n=e.numberOfFrames*e.numberOfChannels;this.ensureTempBufferSize(n);const r=e.allocationSize({planeIndex:0,format:"f32"}),i=new Float32Array(this.tempSourceBuffer.buffer,0,r/4);e.copyTo(i,{planeIndex:0,format:"f32"});const s=e.timestamp-this.startTime,o=e.numberOfFrames/this.sourceSampleRate,a=Math.min(s+o,this.endTime-this.startTime),l=Math.floor(s*this.targetSampleRate),c=Math.ceil(a*this.targetSampleRate);for(let u=l;u<c;u++){if(u<this.bufferStartFrame)continue;for(;u>=this.bufferStartFrame+this.bufferSizeInFrames;)await this.finalizeCurrentBuffer(),this.bufferStartFrame+=this.bufferSizeInFrames;const d=u-this.bufferStartFrame;K(d<this.bufferSizeInFrames);const p=(u/this.targetSampleRate-s)*this.sourceSampleRate,m=Math.floor(p),g=Math.ceil(p),y=p-m;for(let w=0;w<this.targetNumberOfChannels;w++){let k=0,C=0;m>=0&&m<e.numberOfFrames&&(k=this.channelMixer(i,m,w)),g>=0&&g<e.numberOfFrames&&(C=this.channelMixer(i,g,w));const A=k+y*(C-k),E=d*this.targetNumberOfChannels+w;this.outputBuffer[E]+=A}this.maxWrittenFrame=Math.max(this.maxWrittenFrame,d)}}async finalizeCurrentBuffer(){if(this.maxWrittenFrame<0)return;const e=(this.maxWrittenFrame+1)*this.targetNumberOfChannels,n=new Float32Array(e);n.set(this.outputBuffer.subarray(0,e));const r=this.bufferStartFrame/this.targetSampleRate,i=new xs({format:"f32",sampleRate:this.targetSampleRate,numberOfChannels:this.targetNumberOfChannels,timestamp:r,data:n});await this.onSample(i),this.outputBuffer.fill(0),this.maxWrittenFrame=-1}finalize(){return this.finalizeCurrentBuffer()}}const bp=["wss://purplepag.es/","wss://directory.yabu.me/","wss://indexer.coracle.social/","wss://user.kindpag.es/"],wp=["wss://relay.nostr.band/","wss://nos.lol/","wss://relay.damus.io/","wss://relay-jp.nostr.wirednet.jp/","wss://yabu.me/","wss://r.kojira.io/","wss://nrelay-jp.c-stellar.net/"],Xd="https://nostr.build/api/v2/upload/files",t_=1024*1024*1024,xZ={none:{skip:!0},low:{maxWidthOrHeight:2048,fileType:"image/webp",initialQuality:.95,useWebWorker:!0},medium:{maxWidthOrHeight:1024,fileType:"image/webp",initialQuality:.8,useWebWorker:!0},high:{maxWidthOrHeight:800,fileType:"image/webp",initialQuality:.5,useWebWorker:!0}},SZ={none:{skip:!0},low:{crf:20,preset:"superfast",maxSize:1280,audioBitrate:"128k",mediabunnyVideoQuality:$m,mediabunnyAudioQuality:$m},medium:{crf:26,preset:"superfast",maxSize:640,audioBitrate:"64k",audioSampleRate:44100,mediabunnyVideoQuality:ZT,mediabunnyAudioQuality:ZT},high:{crf:28,preset:"medium",maxSize:320,audioBitrate:"32k",audioSampleRate:16e3,audioChannels:1,mediabunnyVideoQuality:GT,mediabunnyAudioQuality:GT}},e1=/(?:^|[\s\n\u3000])#([^\s\n\u3000#]+)/g,EZ=["http:","https:"],kZ=[".png",".jpg",".jpeg",".gif",".webp",".svg"],TZ=[".mp4",".webm",".mov",".avi",".mkv"],_Z=400,CZ=10,n_=100,r_=1,AZ=10,Ai={LOCALE:"locale",UPLOAD_ENDPOINT:"uploadEndpoint",CLIENT_TAG_ENABLED:"clientTagEnabled",IMAGE_COMPRESSION_LEVEL:"imageCompressionLevel",VIDEO_COMPRESSION_LEVEL:"videoCompressionLevel"},IZ=1e3,BM=[{label:"share.yabu.me",url:"https://share.yabu.me/api/v2/media"},{label:"nostpic.com",url:"https://nostpic.com/api/v2/media"},{label:"nostrcheck.me",url:"https://nostrcheck.me/api/v2/media"},{label:"files.sovbit.host",url:"https://files.sovbit.host/api/v2/media"},{label:"nostr.build",url:"https://nostr.build/api/v2/nip96/upload"}];function Ax(t){return t==="ja"?"https://share.yabu.me/api/v2/media":"https://nostrcheck.me/api/v2/media"}function PZ(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}function MZ(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}const Hn={MIN_SCALE:1,MAX_SCALE:100,DEFAULT_SCALE:1,DOUBLE_CLICK_SCALE:2.5,RESET_THRESHOLD:1.3,ZOOM_DELTA:{IN:1.1,OUT:.9},THRESHOLD:.1,PINCH_MIN_DISTANCE:10},i_={FRICTION:.92,MIN_VELOCITY:.1},$M={EDITOR_FOCUS_DELAY:100,TRANSITION_DURATION:"0.3s"},OZ={EDITOR:".tiptap-editor"},Vs={URL_REGEX:/https?:\/\/[^\s\u3000]+/gi,DEBOUNCE_DELAY:300,ENABLE_HASHTAGS:!0,ENABLE_AUTO_LINK:!0,ENABLE_IMAGE_CONVERSION:!0,HASHTAG_CLASS:"hashtag",PLUGIN_KEYS:{HASHTAG_DECORATION:"hashtag-decoration",LINK_AND_IMAGE_CONVERSION:"link-and-image-conversion",CONTENT_UPDATE_TRACKER:"content-update-tracker"}},NZ=["balloonMessage.info.hello","balloonMessage.info.hello2","balloonMessage.info.welcome","balloonMessage.info.waited","balloonMessage.info.relax","balloonMessage.info.good_weather","balloonMessage.info.thwomp","balloonMessage.info.sleep_on_floor","balloonMessage.info.home_here","balloonMessage.info.donai","balloonMessage.info.kita_na","balloonMessage.info.no_licking","balloonMessage.info.not_thwomp","balloonMessage.info.kitte_origin","balloonMessage.info.normal_stamp","balloonMessage.info.backside_curious","balloonMessage.info.corner_weapon","balloonMessage.info.square_peace","balloonMessage.info.how_much_stamp","balloonMessage.info.cancellation_done","balloonMessage.info.want_to_roll","balloonMessage.info.want_candy","balloonMessage.info.tetris_gone","balloonMessage.info.comfy_here","balloonMessage.info.what_did_you_eat","balloonMessage.info.go_to_bed_early","balloonMessage.info.did_you_brush_teeth","balloonMessage.info.kit-ten_ketten","balloonMessage.info.such_is_life"],RZ=["balloonMessage.success.post_success","balloonMessage.success.sent","balloonMessage.success.to_everyone"],LZ="balloonMessage.error.post_error",Fb={MAX_WAIT_TIME:15e3,RETRY_INTERVAL:1e3,TIMEOUT_MESSAGE:"Upload processing timeout"},DZ=/nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{10,}/,BZ=/^nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58}$/,Do={INDEXEDDB_NAME:"share-handler-db",INDEXEDDB_VERSION:1,STORE_NAME:"flags",REQUEST_TIMEOUT:3e3,SW_CONTROLLER_WAIT_TIMEOUT:100};class Fm{static parseKind10002Tags(e){const n={};return e.filter(r=>Array.isArray(r)&&r.length>=2&&r[0]==="r").forEach(r=>{const i=r[1];if(!i||typeof i!="string")return;let s=!0,o=!0;r.length>2&&(r.length===3?r[2]==="read"?o=!1:r[2]==="write"&&(s=!1):(s=r.includes("read"),o=r.includes("write"))),n[i]={read:s,write:o}}),n}static parseKind3Content(e){try{const n=JSON.parse(e);return n&&typeof n=="object"&&!Array.isArray(n)?n:null}catch{return null}}static isValidRelayConfig(e){return e?Array.isArray(e)?e.every(n=>typeof n=="string"):typeof e=="object"?Object.entries(e).every(([n,r])=>typeof n=="string"&&r&&typeof r=="object"&&"read"in r&&"write"in r&&typeof r.read=="boolean"&&typeof r.write=="boolean"):!1:!1}}class ff{static normalizeRelayUrl(e){return e.endsWith("/")?e:e+"/"}static mergeRelayConfigs(...e){const n=new Set;return e.forEach(r=>{Array.isArray(r)?r.forEach(i=>n.add(this.normalizeRelayUrl(i))):typeof r=="object"&&Object.keys(r).forEach(i=>{n.add(this.normalizeRelayUrl(i))})}),Array.from(n)}static extractWriteRelays(e){return Array.isArray(e)?e.map(n=>this.normalizeRelayUrl(n)):typeof e=="object"?Object.keys(e).filter(n=>e[n]?.write!==!1).map(n=>this.normalizeRelayUrl(n)):[]}static extractAllRelays(e){return Array.isArray(e)?e.map(n=>this.normalizeRelayUrl(n)):typeof e=="object"?Object.keys(e).map(n=>this.normalizeRelayUrl(n)):[]}}class $Z{constructor(e,n,r,i){this.localStorage=e,this.console=n,this.relayListUpdatedStore=r,this.pubkeyHex=i}setPubkey(e){this.pubkeyHex=e}save(e,n){try{const r=`nostr-relays-${e}`;if(n===null){if(this.localStorage.removeItem(r),this.console.log(`ãªã¬ã¼ãªã¹ããåé¤: ${e}`),typeof window<"u")try{y_(e,{})}catch{}return}if(!Fm.isValidRelayConfig(n)){this.console.warn("ç¡å¹ãªãªã¬ã¼è¨­å®ã®ããä¿å­ãã¹ã­ãã:",n);return}if(this.localStorage.setItem(r,JSON.stringify(n)),typeof window<"u")try{y_(e,n)}catch(i){this.console.warn("ã¹ãã¢ã®æ´æ°ã«å¤±æ:",i)}this.relayListUpdatedStore&&this.relayListUpdatedStore.set(this.relayListUpdatedStore.value+1),this.console.log("ãªã¬ã¼ãªã¹ããã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){this.console.error("ãªã¬ã¼ãªã¹ãã®ä¿å­ã«å¤±æ:",r)}}get(e){try{const n=`nostr-relays-${e}`,r=this.localStorage.getItem(n);if(!r)return null;const i=JSON.parse(r);return Fm.isValidRelayConfig(i)?i:null}catch(n){return this.console.error("ãªã¬ã¼ãªã¹ãã®åå¾ã«å¤±æ:",n),null}}clear(e){this.save(e,null)}}class FZ{constructor(e,n,r,i){this.rxNostr=e,this.console=n,this.setTimeoutFn=r,this.clearTimeoutFn=i}async fetchKind10002(e,n,r=3e3){return this.console.log(`Kind 10002åå¾è©¦è¡: ${e}`),new Promise(i=>{const s=hm();let o=!1,a=null,l=!1,c;const u=()=>{a!=null&&(this.clearTimeoutFn(a),a=null),c&&typeof c.unsubscribe=="function"&&(c.unsubscribe(),c=void 0)},d=f=>{l||(l=!0,u(),i(f))};try{c=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:f=>{if(!l&&f.event?.kind===10002&&f.event.pubkey===e)try{const h=Fm.parseKind10002Tags(f.event.tags);Object.keys(h).length>0&&(o=!0,this.console.log("Kind 10002ãããªã¬ã¼ãåå¾:",h),d({success:!0,relayConfig:h,source:"kind10002"}))}catch(h){this.console.error("Kind 10002ã®ãã¼ã¹ã¨ã©ã¼:",h)}},error:f=>{l||(this.console.error("Kind 10002åå¾ã¨ã©ã¼:",f),d({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[10002]}),a=this.setTimeoutFn(()=>{l||(o||this.console.log("Kind 10002: ã¿ã¤ã ã¢ã¦ã"),d({success:o,error:o?void 0:"timeout"}))},r)}catch(f){this.console.error("Kind 10002ãªã¯ã¨ã¹ãä½æã¨ã©ã¼:",f),d({success:!1,error:"request_error"})}})}async fetchKind3(e,n,r=3e3){return this.console.log(`Kind 3åå¾è©¦è¡: ${e}`),new Promise(i=>{const s=hm();let o=!1,a=null,l=!1,c;const u=()=>{a!=null&&(this.clearTimeoutFn(a),a=null),c&&typeof c.unsubscribe=="function"&&(c.unsubscribe(),c=void 0)},d=f=>{l||(l=!0,u(),i(f))};try{c=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:f=>{if(!l&&f.event?.kind===3&&f.event.pubkey===e){const h=Fm.parseKind3Content(f.event.content);h&&(o=!0,this.console.log("Kind 3ãããªã¬ã¼ãåå¾:",h),d({success:!0,relayConfig:h,source:"kind3"}))}},error:f=>{l||(this.console.error("Kind 3åå¾ã¨ã©ã¼:",f),d({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[3]}),a=this.setTimeoutFn(()=>{l||(o||this.console.log("Kind 3: ã¿ã¤ã ã¢ã¦ã"),d({success:o,error:o?void 0:"timeout"}))},r)}catch(f){this.console.error("Kind 3ãªã¯ã¨ã¹ãä½æã¨ã©ã¼:",f),d({success:!1,error:"request_error"})}})}}class zZ{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.console||(typeof window<"u"?window.console:{}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.relayListUpdatedStore||(typeof window<"u"?{value:0,set:l=>{}}:void 0);this.storage=new $Z(r,i,a),this.networkFetcher=new FZ(e,i,s,o)}storage;networkFetcher;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}setBootstrapRelays(){try{this.rxNostr.use(hm(),{on:{relays:bp}}).subscribe()}catch(e){console.error("Bootstrap relaysè¨­å®ã¨ã©ã¼:",e)}}useRelaysFromLocalStorageIfExists(e){const n=this.storage.get(e);if(n)try{return this.rxNostr.setDefaultRelays(n),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼ãªã¹ããä½¿ç¨:",n),!0}catch(r){return console.error("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼è¨­å®ã¨ã©ã¼:",r),this.storage.clear(e),!1}return!1}async fetchUserRelays(e,n={}){const r=n.timeoutMs||3e3;if(console.log(`ãªã¬ã¼åå¾éå§: ${e}`),!n.forceRemote){const o=this.storage.get(e);if(o)return this.rxNostr.setDefaultRelays(o),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ãããªã¬ã¼ãå¾©åãã¾ãã"),{success:!0,relayConfig:o,source:"localStorage"}}console.log("ãªã¢ã¼ããããªã¬ã¼æå ±ãåå¾ä¸­...");const i=await this.networkFetcher.fetchKind10002(e,bp,r);if(i.success&&i.relayConfig)return this.rxNostr.setDefaultRelays(i.relayConfig),this.storage.save(e,i.relayConfig),console.log("Kind 10002ãããªã¬ã¼åå¾æå"),{success:!0,relayConfig:i.relayConfig,source:"kind10002"};const s=await this.networkFetcher.fetchKind3(e,bp,r);return s.success&&s.relayConfig?(this.rxNostr.setDefaultRelays(s.relayConfig),this.storage.save(e,s.relayConfig),console.log("Kind 3ãããªã¬ã¼åå¾æå"),{success:!0,relayConfig:s.relayConfig,source:"kind3"}):(console.log("ãªã¢ã¼ãåå¾å¤±æããã©ã¼ã«ããã¯ãªã¬ã¼ãä½¿ç¨"),this.rxNostr.setDefaultRelays(wp),console.log("ãã©ã¼ã«ããã¯ãªã¬ã¼ãè¨­å®:",wp),this.storage.save(e,wp),{success:!1,relayConfig:wp,source:"fallback"})}getRelayListsForProfile(e,n=bp){const r=this.storage.get(e);let i=[],s=[];return r?(i=ff.extractWriteRelays(r),s=ff.mergeRelayConfigs(r,n)):s=n.map(o=>ff.normalizeRelayUrl(o)),{writeRelays:i,additionalRelays:s}}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}loadRelayConfigForUI(e){const n=this.storage.get(e);if(!n)return null;const r=ff.extractWriteRelays(n);return{relayConfig:n,writeRelays:r}}}let s_=Ee(At({info:null,visible:!1}));const ku={get value(){return M(s_)},set:t=>{se(s_,t,!0)}};let zb=Ee(!1);const Gt={get value(){return M(zb)},set:t=>{se(zb,t,!0)},reset:()=>{se(zb,!1)}};let zm=null;function UZ(t){zm=t}function HZ(){return zm}let Um=null;function VZ(t){Um=t}function jZ(){return Um}function WZ(){Gt.set(!0),zm&&zm.abort(),Um&&Um.abort(),Af.set(0),If.set(0)}const Hm={type:"none",isAuthenticated:!1,pubkey:"",npub:"",nprofile:"",isValid:!1,isInitialized:!1,isExtensionLogin:!1};let od=Ee(At({...Hm}));const br={get value(){return M(od)||Hm},subscribe:t=>{Ze(()=>{t(M(od)||Hm)})}};function Ix(t){const n={...M(od),...t};n.isAuthenticated=n.type!=="none"&&n.isValid,n.isExtensionLogin=n.isAuthenticated&&n.type==="nostr-login"&&typeof window<"u"&&typeof window.nostr=="object"&&typeof window.nostr.signEvent=="function",se(od,n,!0),console.log("[updateAuthState] èªè¨¼ç¶æãæ´æ°:",{type:n.type,isAuthenticated:n.isAuthenticated,isValid:n.isValid,pubkey:n.pubkey?n.pubkey.substring(0,8)+"...":"empty"})}function o_(t=!0){se(od,{...Hm,isInitialized:t?M(od).isInitialized:!1},!0)}function qZ(t,e,n){if(!t||!e||!n){console.warn("setNsecAuth: All parameters are required");return}Ix({type:"nsec",pubkey:t,npub:e,nprofile:n,isValid:!0})}function a_(t,e,n,r){if(!t||!e||!n){console.warn("setNostrLoginAuth: All parameters are required");return}console.log("[setNostrLoginAuth] NostrLoginèªè¨¼ç¶æãæ´æ°:",{pubkey:t.substring(0,8)+"...",npub:e.substring(0,12)+"...",type:"nostr-login",nostrLoginAuthMethod:r}),Ix({type:"nostr-login",pubkey:t,npub:e,nprofile:n,isValid:!0,nostrLoginAuthMethod:r})}function KZ(){Ix({isInitialized:!0})}const mr=At({file:null,metadata:void 0,received:!1});function l_(t,e){mr.file=t,mr.metadata=e,mr.received=!!t}function GZ(){mr.file=null,mr.metadata=void 0,mr.received=!1}const gc=At({content:null,received:!1});function ZZ(t){gc.content=t,gc.received=!!t}function QZ(){gc.content=null,gc.received=!1}function XZ(){return mr.file}function YZ(){return mr.metadata}let c_=Ee(!1),u_=Ee(!1),d_=Ee(!1),f_=Ee(!1);const Cf={get value(){return M(c_)},set:t=>{se(c_,t,!0)}},Vm={get value(){return M(u_)},set:t=>{se(u_,t,!0)}},Px={get value(){return M(d_)},set:t=>{se(d_,t,!0)}},Yd={get value(){return M(f_)},set:t=>{se(f_,t,!0)}},FM=(()=>{try{if(typeof ST=="function")return ST({onRegistered:t=>{console.log("SW registered successfully",t)},onRegisterError(t){console.warn("SW registration error",t)},onNeedRefresh(){console.log("SW needs refresh - showing prompt")},immediate:!0,onOfflineReady(){console.log("App ready to work offline")}})}catch(t){console.warn("Failed to initialize Service Worker:",t)}return{needRefresh:{subscribe:()=>{}},updateServiceWorker:()=>{}}})(),Mx=FM.needRefresh,JZ=FM.updateServiceWorker;let Ub=Ee(null);const zM={get value(){return M(Ub)},set:t=>{se(Ub,t,!0)},subscribe:t=>{Ze(()=>{t(M(Ub))})}};let Hb=Ee(At({name:"",picture:"",npub:"",nprofile:""})),Vb=Ee(!1),jb=Ee(!1);const Xa={get value(){return M(Hb)},set:t=>{se(Hb,t,!0)},subscribe:t=>{Ze(()=>{t(M(Hb))})}},hu={get value(){return M(Vb)},set:t=>{se(Vb,t,!0)},subscribe:t=>{Ze(()=>{t(M(Vb))})}},ms={get value(){return M(jb)},set:t=>{se(jb,t,!0)},subscribe:t=>{Ze(()=>{t(M(jb))})}};let Wb=Ee(!1);const eQ={get value(){return M(Wb)},set:t=>{se(Wb,t,!0)},subscribe:t=>{Ze(()=>{t(M(Wb))})}};let qb=Ee(0);const Af={get value(){return M(qb)},set:t=>{se(qb,t,!0)},subscribe:t=>{Ze(()=>{t(M(qb))})}};let Kb=Ee(0);const If={get value(){return M(Kb)},set:t=>{se(Kb,t,!0)},subscribe:t=>{Ze(()=>{t(M(Kb))})}};At({content:"",hashtags:[],tags:[]});let Gb=Ee(null);const tQ={get value(){return M(Gb)},set:t=>{se(Gb,t,!0)},subscribe:t=>{Ze(()=>{t(M(Gb))})}};let t1=null,Zb=Ee(At([])),Qb=Ee(null),h_=Ee(!1),p_=Ee(!1);const Pf={get value(){return M(Zb)},set:t=>{se(Zb,t,!0)},subscribe:t=>{Ze(()=>{t(M(Zb))})}},Kp={get value(){return M(Qb)},set:t=>{se(Qb,t,!0)},subscribe:t=>{Ze(()=>{t(M(Qb))})}},n1={get value(){return M(h_)},set:t=>{se(h_,t,!0)}},m_={get value(){return M(p_)},set:t=>{se(p_,t,!0)}};let Gp=Ee(0);const r1={get value(){return M(Gp)},set:t=>{se(Gp,t,!0)},subscribe:t=>{Ze(()=>{t(M(Gp))})}};function nQ(t){t1=t}function g_(t){if(!t1||!t){Kp.set(null),Pf.set([]);return}const e=t1.loadRelayConfigForUI(t);if(!e){Kp.set(null),Pf.set([]);return}Kp.set(e.relayConfig),Pf.set(e.writeRelays)}function y_(t,e){if(!t)return;const n=`nostr-relays-${t}`;try{localStorage.setItem(n,JSON.stringify(e)),Kp.set(e);const r=ff.extractWriteRelays(e);Pf.set(r),r1.set(M(Gp)+1)}catch(r){console.error("ãªã¬ã¼è¨­å®ã®ä¿å­ã¨ã©ã¼:",r)}}const Ni=Qi({open:!1,nodeId:void 0,src:void 0});let b_=Ee(null);const Yo={get value(){return M(b_)},set:t=>{se(b_,t,!0)}};let Gn=At({showSecretKeyDialog:!1,pendingPost:"",showImageFullscreen:!1,fullscreenImageSrc:"",fullscreenImageAlt:"",showPopupModal:!1,popupX:0,popupY:0,popupMessage:""});const Eo={get value(){return Gn},subscribe:t=>{Ze(()=>{t(Gn)})},showSecretKeyDialog:t=>{Gn.pendingPost=t,Gn.showSecretKeyDialog=!0},hideSecretKeyDialog:()=>{Gn.showSecretKeyDialog=!1,Gn.pendingPost=""},getPendingPost:()=>Gn.pendingPost,showImageFullscreen:(t,e="")=>{Gn.fullscreenImageSrc=t,Gn.fullscreenImageAlt=e,Gn.showImageFullscreen=!0},hideImageFullscreen:()=>{Gn.showImageFullscreen=!1,Gn.fullscreenImageSrc="",Gn.fullscreenImageAlt=""},showPopupMessage:(t,e,n,r=1800)=>{Gn.popupX=t,Gn.popupY=e,Gn.popupMessage=n,Gn.showPopupModal=!0,setTimeout(()=>{Gn.showPopupModal=!1},r)},hidePopupMessage:()=>{Gn.showPopupModal=!1}};function w_(t,e=3e3){if(t===null){UM();return}ku.set({info:t,visible:!0})}function UM(){ku.set({info:null,visible:!1})}function rQ(){Cf.set(!0)}function Xb(){Cf.set(!1)}function iQ(){Vm.set(!0)}function sQ(){Vm.set(!1)}function oQ(){Px.set(!0)}function aQ(){Px.set(!1)}function lQ(){JZ(!0)}function cQ(){return navigator.serviceWorker?.controller?new Promise(t=>{const e=new MessageChannel;if(e.port1.onmessage=n=>{n.data?.version?(zM.set(n.data.version),t(n.data.version)):t(null)},navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({type:"GET_VERSION"},[e.port2]);else{t(null);return}setTimeout(()=>t(null),2e3)}):Promise.resolve(null)}const Il={setBodyStyle(t,e){document.body.style.setProperty(t,e)},querySelector(t){return document.querySelector(t)},querySelectorAll(t){return document.querySelectorAll(t)},focusElement(t){t.focus()}};function yc(t,e){Il.setBodyStyle(t,e)}function uQ(){yc("overflow",""),yc("user-select",""),yc("-webkit-user-select","")}function dQ(){return document.activeElement}function fQ(t){return t.classList?.contains?.("tiptap-editor")||!!t.closest?.(".tiptap-editor")}function hQ(t){return["INPUT","TEXTAREA"].includes(t.tagName)||t.isContentEditable}function pQ(){const t=dQ();t&&(fQ(t)||hQ(t))&&(t.blur?.(),document.body?.focus?.())}function Wo(){return typeof window<"u"&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0||navigator&&!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|Mobile/i))}function HM(){try{if(pQ(),Wo()){const t=document.querySelector(".tiptap-editor");t&&t.blur?.()}}catch{}}const mQ={setTimeout:(t,e)=>setTimeout(t,e)};function gQ(t,e,n=mQ){n.setTimeout(()=>{const r=Il.querySelector(t);r&&Il.focusElement(r)},e)}function yQ(t=200){if(!(typeof window>"u"||typeof navigator>"u"))if("vibrate"in navigator)try{navigator.vibrate(t)}catch{}else try{const e=document.getElementById("vibrateSwitch");e&&e.click()}catch{}}var bQ=1063;function wQ(t){const e={content:t.content,created_at:Math.floor(Date.now()/1e3),kind:bQ,tags:[["url",t.url],["m",t.m],["x",t.x],["ox",t.ox]]};return t.size&&e.tags.push(["size",t.size]),t.dim&&e.tags.push(["dim",t.dim]),t.i&&e.tags.push(["i",t.i]),t.blurhash&&e.tags.push(["blurhash",t.blurhash]),t.thumb&&e.tags.push(["thumb",t.thumb]),t.image&&e.tags.push(["image",t.image]),t.summary&&e.tags.push(["summary",t.summary]),t.alt&&e.tags.push(["alt",t.alt]),t.fallback&&t.fallback.forEach(n=>e.tags.push(["fallback",n])),e}var VM=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],hf=t=>{let e=0;for(let n=0;n<t.length;n++){let r=t[n],i=VM.indexOf(r);e=e*83+i}return e},Jd=(t,e)=>{var n="";for(let r=1;r<=e;r++){let i=Math.floor(t)/Math.pow(83,e-r)%83;n+=VM[Math.floor(i)]}return n},$u=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},Fu=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},vQ=t=>t<0?-1:1,zu=(t,e)=>vQ(t)*Math.pow(Math.abs(t),e),jm=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},xQ=t=>{if(!t||t.length<6)throw new jm("The blurhash string must be at least 6 characters");let e=hf(t[0]),n=Math.floor(e/9)+1,r=e%9+1;if(t.length!==4+2*r*n)throw new jm(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*r*n}`)},SQ=t=>{let e=t>>16,n=t>>8&255,r=t&255;return[$u(e),$u(n),$u(r)]},EQ=(t,e)=>{let n=Math.floor(t/361),r=Math.floor(t/19)%19,i=t%19;return[zu((n-9)/9,2)*e,zu((r-9)/9,2)*e,zu((i-9)/9,2)*e]},kQ=(t,e,n,r)=>{xQ(t),r=r|1;let i=hf(t[0]),s=Math.floor(i/9)+1,o=i%9+1,a=(hf(t[1])+1)/166,l=new Array(o*s);for(let d=0;d<l.length;d++)if(d===0){let f=hf(t.substring(2,6));l[d]=SQ(f)}else{let f=hf(t.substring(4+d*2,6+d*2));l[d]=EQ(f,a*r)}let c=e*4,u=new Uint8ClampedArray(c*n);for(let d=0;d<n;d++)for(let f=0;f<e;f++){let h=0,p=0,m=0;for(let k=0;k<s;k++)for(let C=0;C<o;C++){let A=Math.cos(Math.PI*f*C/e)*Math.cos(Math.PI*d*k/n),E=l[C+k*o];h+=E[0]*A,p+=E[1]*A,m+=E[2]*A}let g=Fu(h),y=Fu(p),w=Fu(m);u[4*f+0+d*c]=g,u[4*f+1+d*c]=y,u[4*f+2+d*c]=w,u[4*f+3+d*c]=255}return u},TQ=kQ,v_=4,_Q=(t,e,n,r)=>{let i=0,s=0,o=0,a=e*v_;for(let c=0;c<e;c++){let u=v_*c;for(let d=0;d<n;d++){let f=u+d*a,h=r(c,d);i+=h*$u(t[f]),s+=h*$u(t[f+1]),o+=h*$u(t[f+2])}}let l=1/(e*n);return[i*l,s*l,o*l]},CQ=t=>{let e=Fu(t[0]),n=Fu(t[1]),r=Fu(t[2]);return(e<<16)+(n<<8)+r},AQ=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor(zu(t[0]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(zu(t[1]/e,.5)*9+9.5)))),i=Math.floor(Math.max(0,Math.min(18,Math.floor(zu(t[2]/e,.5)*9+9.5))));return n*19*19+r*19+i},IQ=(t,e,n,r,i)=>{if(r<1||r>9||i<1||i>9)throw new jm("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new jm("Width and height must match the pixels array");let s=[];for(let d=0;d<i;d++)for(let f=0;f<r;f++){let h=f==0&&d==0?1:2,p=_Q(t,e,n,(m,g)=>h*Math.cos(Math.PI*f*m/e)*Math.cos(Math.PI*d*g/n));s.push(p)}let o=s[0],a=s.slice(1),l="",c=r-1+(i-1)*9;l+=Jd(c,1);let u;if(a.length>0){let d=Math.max(...a.map(h=>Math.max(...h))),f=Math.floor(Math.max(0,Math.min(82,Math.floor(d*166-.5))));u=(f+1)/166,l+=Jd(f,1)}else u=1,l+=Jd(0,1);return l+=Jd(CQ(o),4),a.forEach(d=>{l+=Jd(AQ(d,u),2)}),l},PQ=IQ;async function jM(t){if(!t.url)throw new Error("url is required for imeta tag");if(!t.m)throw new Error("m (MIME type) is required for imeta tag");let e=t.dim;if(!e&&t.url)try{e=await new Promise(i=>{const s=new window.Image;s.onload=()=>{i(`${s.naturalWidth}x${s.naturalHeight}`)},s.onerror=()=>i(void 0),s.src=t.url})}catch{e=void 0}const n=wQ({content:t.content||"",url:t.url,m:t.m,x:t.x||"",ox:t.ox||"",size:t.size,dim:e,blurhash:t.blurhash,thumb:t.thumb,image:t.image,summary:t.summary,alt:t.alt,fallback:t.fallback}),r=[`url ${t.url}`];for(const i of n.tags){const[s,...o]=i;s!=="url"&&(o.length===1?r.push(`${s} ${o[0]}`):o.length>1&&r.push(`${s} ${o.join(" ")}`))}return["imeta",...r]}async function MQ(t){try{if(Gt.value)return null;const e=await new Promise((o,a)=>{const l=URL.createObjectURL(t),c=new window.Image;c.onload=()=>{URL.revokeObjectURL(l),o(c)},c.onerror=u=>{URL.revokeObjectURL(l),a(u)},c.src=l});if(Gt.value)return null;const n=document.createElement("canvas");n.width=Math.min(e.width,64),n.height=Math.min(e.height,64);const r=n.getContext("2d");if(!r)return null;r.drawImage(e,0,0,n.width,n.height);const i=r.getImageData(0,0,n.width,n.height);return PQ(i.data,i.width,i.height,4,4)}catch{return null}}async function OQ(t){try{return URL.createObjectURL(t)}catch{return null}}async function NQ(t){return await MQ(t)}function WM(t){const e={};return t&&t.state&&t.state.doc&&t.state.doc.descendants(n=>{n.type?.name==="image"&&n.attrs?.src&&n.attrs?.blurhash&&!n.attrs?.isPlaceholder&&!n.attrs?.src?.startsWith("placeholder-")&&(e[n.attrs.src]=n.attrs.blurhash)}),e}function RQ(t,e,n,r){try{const i=TQ(t,n,r),s=e.getContext("2d");if(!s)return!1;const o=new ImageData(new Uint8ClampedArray(Array.from(i)),n,r);return s.putImageData(o,0,0),!0}catch(i){return console.warn("Failed to decode blurhash:",i),!1}}function qM(t){const e=t.split(".").pop()?.toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",svg:"image/svg+xml"}[e||""]||"image/jpeg"}async function LQ(t){try{const e=await fetch(t);if(!e.ok)return null;const n=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}catch(e){return console.warn("Failed to calculate image hash:",e),null}}const x_={maxWidth:780,maxHeight:240};function KM(t,e,n=x_.maxWidth,r=x_.maxHeight){if(t<=n&&e<=r)return{width:t,height:e,displayWidth:t,displayHeight:e};const i=t/e;let s,o;return t/n>e/r?(s=n,o=Math.round(n/i)):(o=r,s=Math.round(r*i)),{width:t,height:e,displayWidth:s,displayHeight:o}}function DQ(t){if(!t)return null;const e=t.match(/^(\d+)x(\d+)$/);return e?{width:parseInt(e[1],10),height:parseInt(e[2],10)}:null}function Yb(){return{width:200,height:150,displayWidth:200,displayHeight:150}}function BQ(t,e,n){return{start:{nodePos:n?.()},move:e,end:{nodeData:e?.nodeData||{pos:n?.()},dropX:0,dropY:0,target:null,dropPosition:null,...e}}[t]}function $Q(t){return{start:"touch-image-drag-start",move:"touch-image-drag-move",end:"touch-image-drop"}[t]}function ef(t,e,n){const r=$Q(t),i=BQ(t,e,n),s=new CustomEvent(r,{detail:i,bubbles:!0,cancelable:!0});window.dispatchEvent(s),document.dispatchEvent(new CustomEvent(r,{detail:s.detail}))}function FQ(t,e){return document.elementFromPoint(t,e)?.closest(".drop-zone-indicator")||null}function zQ(){Il.querySelectorAll(".drop-zone-indicator").forEach(t=>{t.classList.remove("drop-zone-hover")})}function UQ(t){t?.classList.add("drop-zone-hover")}function HQ(t,e){zQ();const n=FQ(t,e);UQ(n)}function VQ(t,e=140){const n=Math.min(e,t.width||e),r=t.width>0?Math.round(t.height/t.width*n):n;return{width:n,height:r}}function jQ(t){if(!t)return null;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n&&n.drawImage(t,0,0),e}function WQ(t){if(!t)return null;const e=document.createElement("img");return e.src=t.src,e.alt=t.alt||"",e}function qQ(t,e,n){Object.assign(t.style,{width:`${e.width}px`,height:`${e.height}px`,left:`${n.x-e.width/2}px`,top:`${n.y-e.height/2}px`,transformOrigin:"center center",transition:"transform 120ms ease, opacity 120ms ease"})}function KQ(t,e,n,r=!1){const i=t.getBoundingClientRect(),s=VQ(i);let o=null;if(r){const a=t.querySelector("canvas");a&&(o=jQ(a))}else{const a=t.querySelector("img");a&&(o=WQ(a))}return o?(qQ(o,s,{x:e,y:n}),o.classList.add("drag-preview"),document.body.appendChild(o),requestAnimationFrame(()=>{o.style.transform="scale(0.8) rotate(0deg)",o.style.opacity="0.95"}),o):null}function GQ(t,e,n){if(!t)return;const r=t.getBoundingClientRect(),i=r.width||100,s=r.height||100;t.style.left=`${e-i/2}px`,t.style.top=`${n-s/2}px`}function Jb(t){t?.parentNode?.removeChild(t)}function ZQ(t,e,n,r,i){const s=t-n,o=e-r;return s*s+o*o>i*i}function QQ(t,e,n,r){return!!(t||e||n&&!r)}function Hh(t){const e=t();if(e===void 0)return;Wo()&&HM();const n=new CustomEvent("select-image-node",{detail:{pos:e}});window.dispatchEvent(n),document.dispatchEvent(n)}function XQ(t,e,n,r,i,s,o,a,l){return QQ(n,r,s,e)?(t.preventDefault(),!1):(Hh(l),t.preventDefault(),e||t.stopPropagation(),!0)}function YQ(t,e,n){return!!(t&&e&&n.displayWidth>0&&n.displayHeight>0)}function JQ(t,e){t.width=e.displayWidth,t.height=e.displayHeight}function S_(t,e,n,r,i=!1){YQ(t,e,n)&&(JQ(e,n),RQ(t,e,n.displayWidth,n.displayHeight))}const eX={getItem:t=>localStorage.getItem(t),setItem:(t,e)=>localStorage.setItem(t,e)},tX={language:navigator.language},nX={location:{reload:()=>window.location.reload()}},rX={setTimeout:(t,e)=>setTimeout(t,e)};function iX(t,e){if(t<=0)return 100;const n=e/t*100;return Number(n.toPrecision(2))}function sX(t,e){const n=t/1024>=1e3,r=i=>n?`${(i/1048576).toFixed(2)}MB`:`${Math.round(i/1024)}KB`;return`${r(t)} â ${r(e)}`}function oX(t,e,n,r,i,s){return{originalSize:t,compressedSize:e,wasCompressed:n,compressionRatio:iX(t,e),sizeReduction:sX(t,e),originalFilename:r,compressedFilename:i,wasSkipped:s}}function aX(t){return t.wasCompressed||t.originalFilename!==t.compressedFilename||t.originalSize!==t.compressedSize||!!t.wasSkipped}function E_(t){if(!t||!aX(t))return null;const e=t.originalSize/1024>=1e3,n=r=>e?`${(r/1048576).toFixed(2)}MB`:`${Math.round(r/1024)}KB`;return{wasCompressed:t.wasCompressed,originalSize:n(t.originalSize),compressedSize:n(t.compressedSize),compressionRatio:t.compressionRatio,originalFilename:t.originalFilename,compressedFilename:t.compressedFilename,wasSkipped:t.wasSkipped}}function lX(t){return DZ.test(t)}function cX(t){return BZ.test(t)}function uX(t){return v0(t)}function dX(t){return{npub:sa.npubEncode(t),nprofile:sa.nprofileEncode({pubkey:t,relays:[]})}}function fX(t){try{const{type:e,data:n}=sa.decode(t);if(e!=="nsec")return console.warn("ç¡å¹ãªnsecå½¢å¼ã§ã"),{hex:"",npub:"",nprofile:""};const r=uX(n),{npub:i,nprofile:s}=dX(r);return{hex:r,npub:i,nprofile:s}}catch{return{hex:"",npub:"",nprofile:""}}}function GM(t){try{return sa.npubEncode(t)}catch{return`npub1${t.slice(0,10)}...`}}function hX(t,e=[],n=[]){try{const r=[];e.length>0&&r.push(e[0]);const i=3-r.length;if(i>0){const s=n.filter(o=>!r.includes(o));r.push(...s.slice(0,Math.min(i,2)))}return sa.nprofileEncode({pubkey:t,relays:r})}catch{return""}}async function ZM(t,e=window.crypto.subtle){if(Gt.value)throw new Error("Upload aborted by user");const n=await t.arrayBuffer(),r=await e.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function pX(t,e){try{return await ZM(t,e)}catch{return}}async function mX(t){return new Promise(e=>{if(!t.type.startsWith("image/")){e(null);return}const n=new Image,r=URL.createObjectURL(t);n.onload=()=>{try{const i=KM(n.naturalWidth,n.naturalHeight);URL.revokeObjectURL(r),e(i)}catch(i){console.error("Failed to calculate image display size:",i),URL.revokeObjectURL(r),e(null)}},n.onerror=()=>{URL.revokeObjectURL(r),e(null)},n.src=r})}function gX(t,e){const r={"image/webp":".webp","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/avif":".avif","image/bmp":".bmp"}[e];return r?`${t.replace(/\.[^.]+$/,"")}${r}`:t}function yX(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function bX(t,e){const n=t.getItem(Ai.LOCALE),r=e.language;return n||(r&&r.startsWith("ja")?"ja":"en")}function wX(t,e,n){const r=e.getItem(Ai.UPLOAD_ENDPOINT);return r&&BM.some(i=>i.url===r)?r:n||Ax(t)}function vX(t){const e=t.getItem(Ai.CLIENT_TAG_ENABLED),n=e===null?!0:e==="true";return e===null&&t.setItem(Ai.CLIENT_TAG_ENABLED,"true"),n}function xX(t,e){return t.getItem(Ai.IMAGE_COMPRESSION_LEVEL)||e||"medium"}function SX(t={}){const{selectedEndpoint:e,selectedCompression:n,storage:r=eX,navigator:i=tX}=t,s=bX(r,i),o=wX(s,r,e),a=vX(r),l=xX(r,n);return{endpoint:o,clientTagEnabled:a,compression:l}}function EX(t,e,n={}){const{timeout:r=1e3,windowAdapter:i=nX,timeoutAdapter:s=rX}=n;e(!0),t(),s.setTimeout(()=>{i.location.reload()},r)}async function QM(t,e,n,r="readonly"){return new Promise(i=>{try{const s=indexedDB.open(t,e);s.onupgradeneeded=o=>{const a=o.target.result;a.objectStoreNames.contains(n)||a.createObjectStore(n,{keyPath:"id"})},s.onerror=()=>i(null),s.onsuccess=o=>{try{const a=o.target.result;if(!a.objectStoreNames.contains(n)){a.close(),i(null);return}const l=a.transaction([n],r),c=l.objectStore(n);i({db:a,transaction:l,store:c})}catch{i(null)}}}catch{i(null)}})}async function kX(t,e,n,r){const i=await QM(t,e,n,"readonly");if(!i)return null;const{db:s,store:o}=i;return new Promise(a=>{const l=o.get(r);l.onsuccess=()=>{s.close(),a(l.result)},l.onerror=()=>{s.close(),a(null)}})}async function TX(t,e,n,r){const i=await QM(t,e,n,"readwrite");if(!i)return!1;const{db:s,store:o}=i;return new Promise(a=>{const l=o.delete(r);l.onsuccess=()=>{s.close(),a(!0)},l.onerror=()=>{s.close(),a(!1)}})}function _X(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function Ox(t,e=Do.REQUEST_TIMEOUT){if(!navigator.serviceWorker.controller)throw new Error("No ServiceWorker controller available");const n=new MessageChannel,r=_X();return new Promise((i,s)=>{const o=setTimeout(()=>{n.port1.close(),s(new Error("ServiceWorker communication timeout"))},e);n.port1.onmessage=a=>{clearTimeout(o),n.port1.close();const{data:l}=a.data||{};i(l)},n.port1.addEventListener("error",a=>{clearTimeout(o),n.port1.close(),s(a)});try{if(navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({...t,requestId:r},[n.port2]);else throw new Error("ServiceWorker controller became unavailable")}catch(a){clearTimeout(o),n.port1.close(),s(a)}})}async function CX(){if(!navigator.serviceWorker.controller)return new Promise((t,e)=>{const n=setTimeout(()=>{navigator.serviceWorker.removeEventListener("controllerchange",r),e(new Error("ServiceWorkerã³ã³ãã­ã¼ã©ã¼å¾æ©ã¿ã¤ã ã¢ã¦ã"))},Do.REQUEST_TIMEOUT),r=()=>{clearTimeout(n),navigator.serviceWorker.removeEventListener("controllerchange",r),setTimeout(t,Do.SW_CONTROLLER_WAIT_TIMEOUT)};navigator.serviceWorker.addEventListener("controllerchange",r)})}async function AX(){const t=await kX(Do.INDEXEDDB_NAME,Do.INDEXEDDB_VERSION,Do.STORE_NAME,"sharedImageData");return t?.data?(await TX(Do.INDEXEDDB_NAME,Do.INDEXEDDB_VERSION,Do.STORE_NAME,"sharedImageData"),t.data.image?.arrayBuffer&&t.data.image._isFile?{image:new File([t.data.image.arrayBuffer],t.data.image.name||"shared-image",{type:t.data.image.type||"image/jpeg"}),metadata:t.data.metadata}:t.data):null}async function IX(){try{const t=await Ox({action:"getSharedImage"});return t&&t.image?t:null}catch(t){return console.error("Failed to send message to ServiceWorker:",t),null}}async function PX(){try{try{await Promise.race([CX(),new Promise((t,e)=>setTimeout(()=>e(new Error("SW controller timeout")),2e3))])}catch(t){console.warn("Service Worker controller not ready, trying alternatives:",t)}try{const t=await IX();if(t)return console.log("Shared image retrieved via ServiceWorker MessageChannel"),t}catch(t){console.warn("Service Worker MessageChannel failed:",t)}try{const t=await AX();if(t)return console.log("Shared image retrieved via IndexedDB fallback"),t}catch(t){console.warn("IndexedDB fallback failed:",t)}try{const t=await Ox({action:"getSharedImageForce"},1e3),e=t&&t.image?t:null;if(e)return console.log("Shared image retrieved via forced Service Worker request"),e}catch(t){console.warn("Forced Service Worker request failed:",t)}return console.log("No shared image found through any method"),null}catch(t){return console.error("Error in getSharedImageWithFallback:",t),null}}async function MX(){if(!("serviceWorker"in navigator))return{isReady:!1,hasController:!1,error:"Service Worker not supported"};const t=await navigator.serviceWorker.getRegistration(),e=!!navigator.serviceWorker.controller;return t?{isReady:t.active!==null,hasController:e}:{isReady:!1,hasController:e,error:"Service Worker not registered"}}async function OX(){try{const t=await Ox({type:"PING_TEST"},3e3);return console.log("ServiceWorker communication test successful:",t),!0}catch(t){return console.warn("ServiceWorker communication test timeout"),console.error("ServiceWorker communication test error:",t),!1}}function Tu(t){if(t.type.startsWith("touch")){const e=t,n=e.touches[0]||e.changedTouches[0];return{x:n.clientX,y:n.clientY}}else{const e=t;return{x:e.clientX,y:e.clientY}}}function Uu(t,e,n,r,i){const s=window.innerWidth||document.documentElement.clientWidth||0,o=window.innerHeight||document.documentElement.clientHeight||0,a=typeof n=="number"?n:0,l=r?s-r-a:s-a,c=i?o-i-a:o-a;return{x:Math.max(a,Math.min(l,t)),y:Math.max(a,Math.min(c,e))}}async function NX(t,e){const n=[];if(Gt.value)throw new Error("Upload aborted by user");for(let r=0;r<t.length;r++){const i=t[r],[s,o]=await Promise.all([pX(i,e.crypto),e.getImageDimensions(i)]);n.push({file:i,index:r,ox:s,dimensions:o??void 0})}return n}function RX(t){return t.map(e=>({caption:e.name,expiration:"",size:e.size,alt:e.name,media_type:void 0,content_type:e.type||"",no_transform:"true"}))}class k_{static addCacheBuster(e){if(!e)return e;try{const n=new URL(e);return n.searchParams.set("cb",Date.now().toString()),n.toString()}catch{return e}}static addProfileMarker(e,n=!1,r=!0){if(!e)return e;try{const i=new URL(e);return i.searchParams.set("profile","true"),n&&r?i.searchParams.has("cb")&&i.searchParams.set("cb",Date.now().toString()):i.searchParams.delete("cb"),i.toString()}catch{return e}}}class LX{constructor(e={}){this.deps=e}createProfileData(e,n,r){const i=r?.profileRelays||[],s=r?.writeRelays||[],o=r?.forceRemote||!1;let a=e?.picture||"";if(a){o&&(a=k_.addCacheBuster(a));const l=this.deps.navigator?.onLine??!0;a=k_.addProfileMarker(a,o,l)}return{name:e?.name||"",picture:a,npub:GM(n),nprofile:hX(n,i,s),profileRelays:i.length>0?i:void 0}}}class DX{constructor(e,n,r){this.localStorage=e,this.console=n,this.profileDataFactory=r}save(e,n){try{if(n===null){this.localStorage.removeItem(`nostr-profile-${e}`);return}this.localStorage.setItem(`nostr-profile-${e}`,JSON.stringify(n)),this.console.log("ãã­ãã£ã¼ã«æå ±ãã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){this.console.error("ãã­ãã£ã¼ã«æå ±ã®ä¿å­ã«å¤±æ:",r)}}get(e){try{const n=this.localStorage.getItem(`nostr-profile-${e}`);if(!n)return null;const r=JSON.parse(n);return r.npub&&r.nprofile?{...r,profileRelays:r.profileRelays||void 0}:this.profileDataFactory.createProfileData(r,e,{forceRemote:!1})}catch(n){return this.console.error("ãã­ãã£ã¼ã«æå ±ã®åå¾ã«å¤±æ:",n),null}}clear(e){this.save(e,null)}}class BX{constructor(e,n,r,i,s){this.rxNostr=e,this.profileDataFactory=n,this.setTimeoutFn=r,this.clearTimeoutFn=i,this.console=s}async fetchFromNetwork(e,n){const r=n?.timeoutMs??3e3,i=n?.additionalRelays??[];return new Promise(s=>{const o=hm();let a=!1,l=null,c=!1,u;const d=()=>{l!=null&&(this.clearTimeoutFn(l),l=null),u&&typeof u.unsubscribe=="function"&&(u.unsubscribe(),u=void 0)},f=m=>{c||(c=!0,d(),s(m))},h=i.length>0?{on:{relays:i}}:void 0;u=(h?this.rxNostr.use(o,h):this.rxNostr.use(o)).subscribe({next:m=>{if(!c&&m.event?.kind===0&&m.event.pubkey===e){a=!0;try{const g=JSON.parse(m.event.content),y=[];if(m.from&&typeof m.from=="string"){const k=m.from.endsWith("/")?m.from:m.from+"/";y.push(k)}const w=this.profileDataFactory.createProfileData(g,e,{profileRelays:y,writeRelays:n?.writeRelays,forceRemote:n?.forceRemote});this.console.log("Kind 0ãããã­ãã£ã¼ã«æå ±ãåå¾:",w,"from relay:",m.from),f(w)}catch(g){this.console.error("Kind 0ã®ãã¼ã¹ã¨ã©ã¼:",g),f(null)}}},error:m=>{c||(this.console.error("ãã­ãã£ã¼ã«åå¾ã¨ã©ã¼:",m),f(null))}}),l=this.setTimeoutFn(()=>{if(!c&&!a){this.console.log("ãã­ãã£ã¼ã«åå¾ã¿ã¤ã ã¢ã¦ããããã©ã«ããã­ãã£ã¼ã«ãä½¿ç¨");const m=this.profileDataFactory.createProfileData({},e,{writeRelays:n?.writeRelays,forceRemote:n?.forceRemote});f(m)}},r),o.emit({authors:[e],kinds:[0]})})}}class $X{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.navigator||(typeof window<"u"?window.navigator:{onLine:!0}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.console||(typeof window<"u"?window.console:{});this.profileDataFactory=new LX({navigator:i}),this.storage=new DX(r,a,this.profileDataFactory),this.networkFetcher=new BX(e,this.profileDataFactory,s,o,a)}storage;networkFetcher;profileDataFactory;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}async fetchProfileData(e,n){const r=this.networkFetcher.console;if(r.log(`ãã­ãã£ã¼ã«åå¾éå§: ${e}`),!n?.forceRemote){const s=this.storage.get(e);if(s)return r.log("ã­ã£ãã·ã¥ãããã­ãã£ã¼ã«ãå¾©å:",s),s}r.log("ãªã¢ã¼ããããã­ãã£ã¼ã«æå ±ãåå¾ä¸­...");const i=await this.networkFetcher.fetchFromNetwork(e,n);return i&&this.storage.save(e,i),i}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}getProfileDataFactory(){return this.profileDataFactory}}class FX{relayManager;profileManager;constructor(e,n,r){this.relayManager=n,this.profileManager=r}async initializeRelays(e){e?this.relayManager.useRelaysFromLocalStorageIfExists(e)||this.relayManager.setBootstrapRelays():this.relayManager.setBootstrapRelays()}async fetchRelays(e,n=!1){if(!n){const i=this.relayManager.getFromLocalStorage(e);if(i)return console.log("ã­ã£ãã·ã¥ãããªã¬ã¼ãªã¹ããå¾©å:",i),{success:!0,relayConfig:i,source:"localStorage"}}return await this.relayManager.fetchUserRelays(e,{forceRemote:n})}async fetchProfile(e,n=!1){if(!e)return null;n&&this.profileManager.saveToLocalStorage(e,null);const{writeRelays:r,additionalRelays:i}=this.relayManager.getRelayListsForProfile(e);return await this.profileManager.fetchProfileData(e,{forceRemote:n,writeRelays:r,additionalRelays:i})}async initializeForLogin(e){console.log(`ã­ã°ã¤ã³åæåéå§: ${e}`),await this.fetchRelays(e,!1);const n=await this.fetchProfile(e,!1);return console.log(`ã­ã°ã¤ã³åæåå®äº: ${e}`),n}async refreshRelaysAndProfile(e){console.log(`ãªã¬ã¼ã»ãã­ãã£ã¼ã«ååå¾éå§: ${e}`),await this.fetchRelays(e,!0);const n=await this.fetchProfile(e,!0);return console.log(`ãªã¬ã¼ã»ãã­ãã£ã¼ã«ååå¾å®äº: ${e}`),n}getRelayManager(){return this.relayManager}getProfileManager(){return this.profileManager}}function hr(t){this.content=t}hr.prototype={constructor:hr,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new hr(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new hr(n)},addToStart:function(t,e){return new hr([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new hr(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new hr(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=hr.from(t),t.size?new hr(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=hr.from(t),t.size?new hr(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=hr.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};hr.from=function(t){if(t instanceof hr)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new hr(e)};function XM(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=XM(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function YM(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=YM(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class Ae{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:s+=r),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new Ae(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new Ae(r,i)}cutByIndex(e,n){return e==n?Ae.empty:e==0&&n==this.content.length?this:new Ae(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new Ae(i,s)}addToStart(e){return new Ae([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Ae(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return XM(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return YM(this,e,n,r)}findIndex(e){if(e==0)return vp(0,e);if(e==this.size)return vp(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),s=r+i.nodeSize;if(s>=e)return s==e?vp(n+1,s):vp(n,r);r=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Ae.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Ae(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Ae.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new Ae(n||e,r)}static from(e){if(!e)return Ae.empty;if(e instanceof Ae)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Ae([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Ae.empty=new Ae([],0);const ew={index:0,offset:0};function vp(t,e){return ew.index=t,ew.offset=e,ew}function Wm(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Wm(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Wm(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let sn=class i1{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Wm(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let i=r.create(n.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return i1.none;if(e instanceof i1)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}};sn.none=[];class qm extends Error{}class We{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=e8(this.content,e+this.openStart,n);return r&&new We(r,this.openStart,this.openEnd)}removeBetween(e,n){return new We(JM(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return We.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new We(Ae.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new We(e,r,i)}}We.empty=new We(Ae.empty,0,0);function JM(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(JM(s.content,e-i-1,n-i-1)))}function e8(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=e8(o.content,e-s-1,n,o);return a&&t.replaceChild(i,o.copy(a))}function zX(t,e,n){if(n.openStart>t.depth)throw new qm("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new qm("Inconsistent open depths");return t8(t,e,n,0)}function t8(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=t8(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return wc(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=UX(n,t);return wc(s,r8(t,o,a,e,r))}else return wc(s,Km(t,e,r))}function n8(t,e){if(!e.type.compatibleContent(t.type))throw new qm("Cannot join "+e.type.name+" onto "+t.type.name)}function s1(t,e,n){let r=t.node(n);return n8(r,e.node(n)),r}function bc(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Mf(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(bc(t.nodeAfter,r),s++));for(let a=s;a<o;a++)bc(i.child(a),r);e&&e.depth==n&&e.textOffset&&bc(e.nodeBefore,r)}function wc(t,e){return t.type.checkContent(e),t.copy(e)}function r8(t,e,n,r,i){let s=t.depth>i&&s1(t,e,i+1),o=r.depth>i&&s1(n,r,i+1),a=[];return Mf(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(n8(s,o),bc(wc(s,r8(t,e,n,r,i+1)),a)):(s&&bc(wc(s,Km(t,e,i+1)),a),Mf(e,n,i,a),o&&bc(wc(o,Km(n,r,i+1)),a)),Mf(r,null,i,a),new Ae(a)}function Km(t,e,n){let r=[];if(Mf(null,t,n,r),t.depth>n){let i=s1(t,e,n+1);bc(wc(i,Km(t,e,n+1)),r)}return Mf(e,null,n,r),new Ae(r)}function UX(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(Ae.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class rh{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return sn.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new Gm(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new rh(n,r,s)}static resolveCached(e,n){let r=T_.get(e);if(r)for(let s=0;s<r.elts.length;s++){let o=r.elts[s];if(o.pos==n)return o}else T_.set(e,r=new HX);let i=r.elts[r.i]=rh.resolve(e,n);return r.i=(r.i+1)%VX,i}}class HX{constructor(){this.elts=[],this.i=0}}const VX=12,T_=new WeakMap;class Gm{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const jX=Object.create(null);let gl=class o1{constructor(e,n,r,i=sn.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||Ae.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Wm(this.attrs,n||e.defaultAttrs||jX)&&sn.sameSet(this.marks,r||sn.none)}copy(e=null){return e==this.content?this:new o1(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new o1(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return We.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new We(c,i.depth-o,s.depth-o)}replace(e,n,r){return zX(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return rh.resolveCached(this,e)}resolveNoCache(e){return rh.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),i8(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=Ae.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=sn.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!sn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=Ae.fromJSON(e,n.content),s=e.nodeType(n.type).create(n.attrs,i,r);return s.type.checkAttrs(s.attrs),s}};gl.prototype.text=void 0;class Zm extends gl{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):i8(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Zm(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Zm(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function i8(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Oc{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new WX(e,n);if(r.next==null)return Oc.empty;let i=s8(r);r.next&&r.err("Unexpected trailing text");let s=YX(XX(i));return JX(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return Ae.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let f=s(d,a.concat(u));if(f)return f}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}Oc.empty=new Oc(!0);class WX{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function s8(t){let e=[];do e.push(qX(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function qX(t){let e=[];do e.push(KX(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function KX(t){let e=QX(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=GX(t,e);else break;return e}function __(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function GX(t,e){let n=__(t),r=n;return t.eat(",")&&(t.next!="}"?r=__(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function ZX(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function QX(t){if(t.eat("(")){let e=s8(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=ZX(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function XX(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function o8(t,e){return e-t}function C_(t,e){let n=[];return r(e),n.sort(o8);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function YX(t){let e=Object.create(null);return n(C_(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);C_(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new Oc(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(o8);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function JX(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function a8(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function l8(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function c8(t,e,n,r){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${n} of type ${i}`);for(let i in t){let s=t[i];s.validate&&s.validate(e[i])}}function u8(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new tY(t,r,e[r]);return n}let A_=class d8{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=u8(e,r.attrs),this.defaultAttrs=a8(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Oc.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:l8(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new gl(this,this.computeAttrs(e),Ae.from(n),sn.setFrom(r))}createChecked(e=null,n,r){return n=Ae.from(n),this.checkContent(n),new gl(this,this.computeAttrs(e),n,sn.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=Ae.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(Ae.empty,!0);return s?new gl(this,e,n.append(s),sn.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){c8(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:sn.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new d8(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function eY(t,e,n){let r=n.split("|");return i=>{let s=i===null?"null":typeof i;if(r.indexOf(s)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${s}`)}}class tY{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?eY(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class I0{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=u8(e,i.attrs),this.excluded=null;let s=a8(this.attrs);this.instance=s?new sn(this,s):null}create(e=null){return!e&&this.instance?this.instance:new sn(this,l8(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new I0(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){c8(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class f8{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let i in e)n[i]=e[i];n.nodes=hr.from(e.nodes),n.marks=hr.from(e.marks||{}),this.nodes=A_.compile(this.spec.nodes,this),this.marks=I0.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=r[o]||(r[o]=Oc.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?I_(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:I_(this,o.split(" "))}this.nodeFromJSON=i=>gl.fromJSON(this,i),this.markFromJSON=i=>sn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof A_){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new Zm(r,r.defaultAttrs,e,sn.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function I_(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function nY(t){return t.tag!=null}function rY(t){return t.style!=null}class yl{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(i=>{if(nY(i))this.tags.push(i);else if(rY(i)){let s=/[^=]*/.exec(i.style)[0];r.indexOf(s)<0&&r.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,n={}){let r=new M_(this,n,!1);return r.addAll(e,sn.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new M_(this,n,!0);return r.addAll(e,sn.none,n.from,n.to),We.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(oY(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=O_(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=O_(o)),o.node||o.ignore||o.mark||(o.node=i)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new yl(e,yl.schemaRules(e)))}}const h8={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},iY={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},p8={ol:!0,ul:!0},ih=1,a1=2,Of=4;function P_(t,e,n){return e!=null?(e?ih:0)|(e==="full"?a1:0):t&&t.whitespace=="pre"?ih|a1:n&~Of}class xp{constructor(e,n,r,i,s,o){this.type=e,this.attrs=n,this.marks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=sn.none,this.match=s||(o&Of?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Ae.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&ih)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=Ae.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Ae.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!h8.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class M_{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let i=n.topNode,s,o=P_(null,n.preserveWhitespace,0)|(r?Of:0);i?s=new xp(i.type,i.attrs,sn.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new xp(null,null,sn.none,!0,null,o):s=new xp(e.schema.topNodeType,null,sn.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,i=this.top,s=i.options&a1?"full":this.localPreserveWS||(i.options&ih)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(s)if(s==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;p8.hasOwnProperty(o)&&this.parser.normalizeLists&&sY(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:iY.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(h8.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let d=l&&l.skip?n:this.readStyles(e,n);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=r.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,i){let s,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(s=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,n,r,i){let s=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,n);this.findAtPoint(e,s)}findPlace(e,n,r){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)n=this.enterInner(i[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(n=this.enterInner(s,null,n))}let i=this.findPlace(e,n,r);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=sn.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):N_(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,n,r,i){let s=this.findPlace(e.create(n),r,!1);return s&&(s=this.enterInner(e,n,r,!0,i)),s}enterInner(e,n,r,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=P_(e,s,o.options);o.options&Of&&o.content.length==0&&(a|=Of);let l=sn.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):N_(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new xp(e,n,l,i,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=ih)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function sY(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&p8.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function oY(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function O_(t){let e={};for(let n in t)e[n]=t[n];return e}function N_(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class jc{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=tw(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=Zp(tw(n),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&Zp(tw(r),i(e,n),null,e.attrs)}static renderSpec(e,n,r=null,i){return Zp(e,n,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new jc(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=R_(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return R_(e.marks)}}function R_(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function tw(t){return t.document||window.document}const L_=new WeakMap;function aY(t){let e=L_.get(t);return e===void 0&&L_.set(t,e=lY(t)),e}function lY(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)n(r[i]);else for(let i in r)n(r[i])}return n(t),e}function Zp(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(s=aY(r))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));let a,l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let f=d.indexOf(" ");f>0?l.setAttributeNS(d.slice(0,f),d.slice(f+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let f=e[d];if(f===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:h,contentDOM:p}=Zp(t,f,n,r);if(l.appendChild(h),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const m8=65535,g8=Math.pow(2,16);function cY(t,e){return t+e*g8}function D_(t){return t&m8}function uY(t){return(t-(t&m8))/g8}const y8=1,b8=2,Qp=4,w8=8;class l1{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&w8)>0}get deletedBefore(){return(this.delInfo&(y8|Qp))>0}get deletedAfter(){return(this.delInfo&(b8|Qp))>0}get deletedAcross(){return(this.delInfo&Qp)>0}}class Mi{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Mi.empty)return Mi.empty}recover(e){let n=0,r=D_(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+uY(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let f=c?e==l?-1:e==d?1:n:n,h=l+i+(f<0?0:u);if(r)return h;let p=e==(n<0?l:d)?null:cY(a/3,e-l),m=e==l?b8:e==d?y8:Qp;return(n<0?e!=l:e!=d)&&(m|=w8),new l1(h,m,p)}i+=u-c}return r?e+i:new l1(e+i,0,null)}touches(e,n){let r=0,i=D_(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Mi(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Mi.empty:new Mi(e<0?[0,-e,0]:[0,0,e])}}Mi.empty=new Mi([]);class sh{constructor(e,n,r=0,i=e?e.length:0){this.mirror=n,this.from=r,this.to=i,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new sh(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let i=e.getMirror(n);this.appendMap(e._maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e._maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new sh;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new l1(e,i,null)}}const nw=Object.create(null);class Vr{getMap(){return Mi.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=nw[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in nw)throw new RangeError("Duplicate use of step JSON ID "+e);return nw[e]=n,n.prototype.jsonID=e,n}}class jn{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new jn(e,null)}static fail(e){return new jn(null,e)}static fromReplace(e,n,r,i){try{return jn.ok(e.replace(n,r,i))}catch(s){if(s instanceof qm)return jn.fail(s.message);throw s}}}function Nx(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(Nx(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return Ae.fromArray(r)}class ll extends Vr{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new We(Nx(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return jn.fromReplace(e,this.from,this.to,s)}invert(){return new Ss(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new ll(n.pos,r.pos,this.mark)}merge(e){return e instanceof ll&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ll(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ll(n.from,n.to,e.markFromJSON(n.mark))}}Vr.jsonID("addMark",ll);class Ss extends Vr{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new We(Nx(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return jn.fromReplace(e,this.from,this.to,r)}invert(){return new ll(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Ss(n.pos,r.pos,this.mark)}merge(e){return e instanceof Ss&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ss(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Ss(n.from,n.to,e.markFromJSON(n.mark))}}Vr.jsonID("removeMark",Ss);class cl extends Vr{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return jn.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return jn.fromReplace(e,this.pos,this.pos+1,new We(Ae.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new cl(this.pos,n.marks[i]);return new cl(this.pos,this.mark)}}return new Nc(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new cl(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new cl(n.pos,e.markFromJSON(n.mark))}}Vr.jsonID("addNodeMark",cl);class Nc extends Vr{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return jn.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return jn.fromReplace(e,this.pos,this.pos+1,new We(Ae.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new cl(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Nc(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Nc(n.pos,e.markFromJSON(n.mark))}}Vr.jsonID("removeNodeMark",Nc);class nr extends Vr{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&c1(e,this.from,this.to)?jn.fail("Structure replace would overwrite content"):jn.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Mi([this.from,this.to-this.from,this.slice.size])}invert(e){return new nr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new nr(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof nr)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?We.empty:new We(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new nr(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?We.empty:new We(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new nr(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new nr(n.from,n.to,We.fromJSON(e,n.slice),!!n.structure)}}Vr.jsonID("replace",nr);class ar extends Vr{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(c1(e,this.from,this.gapFrom)||c1(e,this.gapTo,this.to)))return jn.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return jn.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?jn.fromReplace(e,this.from,this.to,r):jn.fail("Content does not fit in gap")}getMap(){return new Mi([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new ar(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new ar(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ar(n.from,n.to,n.gapFrom,n.gapTo,We.fromJSON(e,n.slice),n.insert,!!n.structure)}}Vr.jsonID("replaceAround",ar);function c1(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function dY(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!r.isInSet(d)&&u.type.allowsMarkType(r.type)){let f=Math.max(c,e),h=Math.min(c+l.nodeSize,n),p=r.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==f&&o.mark.eq(d[m])?o.to=h:i.push(o=new Ss(f,h,d[m])));a&&a.to==f?a.to=h:s.push(a=new ll(f,h,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function fY(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof I0){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let d=l[u],f;for(let h=0;h<i.length;h++){let p=i[h];p.step==s-1&&d.eq(i[h].style)&&(f=p)}f?(f.to=c,f.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new Ss(o.from,o.to,o.style)))}function Rx(t,e,n,r=n.contentMatch,i=!0){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=r.matchType(c.type);if(!d)o.push(new nr(a,u,We.empty));else{r=d;for(let f=0;f<c.marks.length;f++)n.allowsMarkType(c.marks[f].type)||t.step(new Ss(a,u,c.marks[f]));if(i&&c.isText&&n.whitespace!="pre"){let f,h=/\r?\n|\r/g,p;for(;f=h.exec(c.text);)p||(p=new We(Ae.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new nr(a+f.index,a+f.index+f[0].length,p))}}a=u}if(!r.validEnd){let l=r.fillBefore(Ae.empty,!0);t.replace(a,a,new We(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function hY(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Td(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let i=t.$from.node(r),s=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&i.canReplace(s,o,n))return r;if(r==0||i.type.spec.isolating||!hY(i,s,o))break}return null}function pY(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=Ae.empty,d=0;for(let p=s,m=!1;p>n;p--)m||r.index(p)>0?(m=!0,u=Ae.from(r.node(p).copy(u)),d++):l--;let f=Ae.empty,h=0;for(let p=s,m=!1;p>n;p--)m||i.after(p+1)<i.end(p)?(m=!0,f=Ae.from(i.node(p).copy(f)),h++):c++;t.step(new ar(l,c,o,a,new We(u.append(f),d,h),u.size-d,!0))}function Lx(t,e,n=null,r=t){let i=mY(t,e),s=i&&gY(r,e);return s?i.map(B_).concat({type:e,attrs:n}).concat(s.map(B_)):null}function B_(t){return{type:t,attrs:null}}function mY(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function gY(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function yY(t,e,n){let r=Ae.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Ae.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new ar(i,s,i,s,new We(r,0,0),n.length,!0))}function bY(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(r,l)&&wY(t.doc,t.mapping.slice(s).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let h=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);h&&!p?c=!1:!h&&p&&(c=!0)}c===!1&&x8(t,o,a,s),Rx(t,t.mapping.slice(s).map(a,1),r,void 0,c===null);let u=t.mapping.slice(s),d=u.map(a,1),f=u.map(a+o.nodeSize,1);return t.step(new ar(d,f,d+1,f-1,new We(Ae.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&v8(t,o,a,s),!1}})}function v8(t,e,n,r){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=t.mapping.slice(r).map(n+1+s+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function x8(t,e,n,r){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+s);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function wY(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function vY(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new ar(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new We(Ae.from(o),0,0),1,!0))}function Jo(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let d=i.node(c),f=i.index(c);if(d.type.spec.isolating)return!1;let h=d.content.cutByIndex(f,d.childCount),p=r&&r[u+1];p&&(h=h.replaceChild(0,p.type.create(p.attrs)));let m=r&&r[u]||d;if(!d.canReplace(f+1,d.childCount)||!m.type.validContent(h))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function xY(t,e,n=1,r){let i=t.doc.resolve(e),s=Ae.empty,o=Ae.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=Ae.from(i.node(a).copy(s));let u=r&&r[c];o=Ae.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new nr(e,e,new We(s.append(o),n,n),!0))}function zl(t,e){let n=t.resolve(e),r=n.index();return S8(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function SY(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==r?t.type.schema.nodes.text:s.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(s.marks))return!1}return n.validEnd}function S8(t,e){return!!(t&&e&&!t.isLeaf&&SY(t,e))}function P0(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let s,o,a=r.index(i);if(i==r.depth?(s=r.nodeBefore,o=r.nodeAfter):n>0?(s=r.node(i+1),a++,o=r.node(i).maybeChild(a)):(s=r.node(i).maybeChild(a-1),o=r.node(i+1)),s&&!s.isTextblock&&S8(s,o)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=n<0?r.before(i):r.after(i)}}function EY(t,e,n){let r=null,{linebreakReplacement:i}=t.doc.type.schema,s=t.doc.resolve(e-n),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?r=!1:!u&&d&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);x8(t,u.node(),u.before(),a)}o.inlineContent&&Rx(t,e+n-1,o,s.node().contentMatchAt(s.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new nr(c,l.map(e+n,-1),We.empty,!0)),r===!0){let u=t.doc.resolve(c);v8(t,u.node(),u.before(),t.steps.length)}return t}function kY(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function E8(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let d=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function M0(t,e,n=e,r=We.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return k8(i,s,r)?new nr(e,n,r):new TY(i,s,r).fit()}function k8(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class TY{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=Ae.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Ae.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new We(s,o,a);return e>-1?new ar(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new nr(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let s=n.firstChild;if(n.childCount>1&&(i=0),s.type.spec.isolating&&i<=r){e=r;break}n=s.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let i,s=null;r?(s=rw(this.unplaced.content,r-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(n==1&&(o?c.matchType(o.type)||(d=c.fillBefore(Ae.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:r,frontierDepth:a,parent:s,inject:d};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=rw(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new We(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=rw(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new We(pf(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new We(pf(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:f}=this.frontier[n];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let h=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(T8(m.mark(f.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?h:-1)))}let p=c==a.childCount;p||(h=-1),this.placed=mf(this.placed,n,Ae.from(u)),this.frontier[n].match=d,p&&h<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<h;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?We.empty:new We(pf(o.content,e-1,1),e-1,h<0?o.openEnd:e-1):new We(pf(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!iw(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=iw(e,n,i,r,s);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=iw(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=mf(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=mf(this.placed,this.depth,Ae.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Ae.empty,!0);n.childCount&&(this.placed=mf(this.placed,this.frontier.length,n))}}function pf(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(pf(t.firstChild.content,e-1,n)))}function mf(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(mf(t.lastChild.content,e-1,n)))}function rw(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function T8(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,T8(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Ae.empty,!0)))),t.copy(r)}function iw(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!_Y(n,s.content,o)?a:null}function _Y(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function CY(t){return t.spec.defining||t.spec.definingForContent}function AY(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(k8(i,s,r))return t.step(new nr(e,n,r));let o=C8(i,t.doc.resolve(n));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let f=i.depth,h=i.pos-1;f>0;f--,h--){let p=i.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(f)>-1?a=f:i.before(f)==h&&o.splice(1,0,-f)}let l=o.indexOf(a),c=[],u=r.openStart;for(let f=r.content,h=0;;h++){let p=f.firstChild;if(c.push(p),h==r.openStart)break;f=p.content}for(let f=u-1;f>=0;f--){let h=c[f],p=CY(h.type);if(p&&!h.sameMarkup(i.node(Math.abs(a)-1)))u=f;else if(p||!h.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let h=(f+u+1)%(r.openStart+1),p=c[h];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let w=i.node(g-1),k=i.index(g-1);if(w.canReplaceWith(k,k,p.type,p.marks))return t.replace(i.before(g),y?s.after(g):n,new We(_8(r.content,0,r.openStart,h),h,r.openEnd))}}let d=t.steps.length;for(let f=o.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>d));f--){let h=o[f];h<0||(e=i.before(h),n=s.after(h))}}function _8(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(_8(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(Ae.empty,!0))}return t}function IY(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=kY(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new We(Ae.from(r),0,0))}function PY(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=C8(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function C8(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class Hu extends Vr{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return jn.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return jn.fromReplace(e,this.pos,this.pos+1,new We(Ae.from(i),0,n.isLeaf?0:1))}getMap(){return Mi.empty}invert(e){return new Hu(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Hu(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Hu(n.pos,n.attr,n.value)}}Vr.jsonID("attr",Hu);class oh extends Vr{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return jn.ok(r)}getMap(){return Mi.empty}invert(e){return new oh(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new oh(n.attr,n.value)}}Vr.jsonID("docAttr",oh);let ad=class extends Error{};ad=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};ad.prototype=Object.create(Error.prototype);ad.prototype.constructor=ad;ad.prototype.name="TransformError";class A8{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new sh}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new ad(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=We.empty){let i=M0(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new We(Ae.from(r),0,0))}delete(e,n){return this.replace(e,n,We.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return AY(this,e,n,r),this}replaceRangeWith(e,n,r){return IY(this,e,n,r),this}deleteRange(e,n){return PY(this,e,n),this}lift(e,n){return pY(this,e,n),this}join(e,n=1){return EY(this,e,n),this}wrap(e,n){return yY(this,e,n),this}setBlockType(e,n=e,r,i=null){return bY(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i){return vY(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new Hu(e,n,r)),this}setDocAttribute(e,n){return this.step(new oh(e,n)),this}addNodeMark(e,n){return this.step(new cl(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof sn)n.isInSet(r.marks)&&this.step(new Nc(e,n));else{let i=r.marks,s,o=[];for(;s=n.isInSet(i);)o.push(new Nc(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return xY(this,e,n,r),this}addMark(e,n,r){return dY(this,e,n,r),this}removeMark(e,n,r){return fY(this,e,n,r),this}clearIncompatible(e,n,r){return Rx(this,e,n,r),this}}const sw=Object.create(null);class Tt{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new MY(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=We.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?We.empty:n),a==0&&z_(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),z_(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new wt(e):pu(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?pu(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):pu(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Ri(e.node(0))}static atStart(e){return pu(e,e,0,0,1)||new Ri(e)}static atEnd(e){return pu(e,e,e.content.size,e.childCount,-1)||new Ri(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=sw[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in sw)throw new RangeError("Duplicate use of selection JSON ID "+e);return sw[e]=n,n.prototype.jsonID=e,n}getBookmark(){return wt.between(this.$anchor,this.$head).getBookmark()}}Tt.prototype.visible=!0;class MY{constructor(e,n){this.$from=e,this.$to=n}}let $_=!1;function F_(t){!$_&&!t.parent.inlineContent&&($_=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class wt extends Tt{constructor(e,n=e){F_(e),F_(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return Tt.near(r);let i=e.resolve(n.map(this.anchor));return new wt(i.parent.inlineContent?i:r,r)}replace(e,n=We.empty){if(super.replace(e,n),n==We.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof wt&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new O0(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new wt(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=Tt.findFrom(n,r,!0)||Tt.findFrom(n,-r,!0);if(s)n=s.$head;else return Tt.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(Tt.findFrom(e,-r,!0)||Tt.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new wt(e,n)}}Tt.jsonID("text",wt);class O0{constructor(e,n){this.anchor=e,this.head=n}map(e){return new O0(e.map(this.anchor),e.map(this.head))}resolve(e){return wt.between(e.resolve(this.anchor),e.resolve(this.head))}}class rt extends Tt{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?Tt.near(s):new rt(s)}content(){return new We(Ae.from(this.node),0,0)}eq(e){return e instanceof rt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Dx(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new rt(e.resolve(n.anchor))}static create(e,n){return new rt(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}rt.prototype.visible=!1;Tt.jsonID("node",rt);class Dx{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new O0(r,r):new Dx(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&rt.isSelectable(r)?new rt(n):Tt.near(n)}}class Ri extends Tt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=We.empty){if(n==We.empty){e.delete(0,e.doc.content.size);let r=Tt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ri(e)}map(e){return new Ri(e)}eq(e){return e instanceof Ri}getBookmark(){return OY}}Tt.jsonID("all",Ri);const OY={map(){return this},resolve(t){return new Ri(t)}};function pu(t,e,n,r,i,s=!1){if(e.inlineContent)return wt.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&rt.isSelectable(a))return rt.create(t,n-(i<0?a.nodeSize:0))}else{let l=pu(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function z_(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof nr||i instanceof ar))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(Tt.near(t.doc.resolve(o),n))}const U_=1,Sp=2,H_=4;class NY extends A8{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|U_)&~Sp,this.storedMarks=null,this}get selectionSet(){return(this.updated&U_)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Sp,this}ensureMarks(e){return sn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Sp)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Sp,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||sn.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(Tt.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=H_,this}get scrolledIntoView(){return(this.updated&H_)>0}}function V_(t,e){return!e||!t?t:t.bind(e)}class gf{constructor(e,n,r){this.name=e,this.init=V_(n.init,r),this.apply=V_(n.apply,r)}}const RY=[new gf("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new gf("selection",{init(t,e){return t.selection||Tt.atStart(e.doc)},apply(t){return t.selection}}),new gf("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new gf("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class ow{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=RY.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new gf(r.key,r.spec.state,r))})}}class _u{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new _u(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new NY(this)}static create(e){let n=new ow(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new _u(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new ow(this.schema,e.plugins),r=n.fields,i=new _u(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new ow(e.schema,e.plugins),s=new _u(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=gl.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=Tt.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function I8(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=I8(i,e,{})),n[r]=i}return n}class Qt{constructor(e){this.spec=e,this.props={},e.props&&I8(e.props,this,this.props),this.key=e.key?e.key.key:P8("plugin")}getState(e){return e[this.key]}}const aw=Object.create(null);function P8(t){return t in aw?t+"$"+ ++aw[t]:(aw[t]=0,t+"$")}class on{constructor(e="key"){this.key=P8(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Bx=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function M8(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const O8=(t,e,n)=>{let r=M8(t,n);if(!r)return!1;let i=$x(r);if(!i){let o=r.blockRange(),a=o&&Td(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(U8(t,i,e,-1))return!0;if(r.parent.content.size==0&&(ld(s,"end")||rt.isSelectable(s)))for(let o=r.depth;;o--){let a=M0(t.doc,r.before(o),r.after(o),We.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(ld(s,"end")?Tt.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):rt.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1},LY=(t,e,n)=>{let r=M8(t,n);if(!r)return!1;let i=$x(r);return i?N8(t,i,e):!1},DY=(t,e,n)=>{let r=L8(t,n);if(!r)return!1;let i=Fx(r);return i?N8(t,i,e):!1};function N8(t,e,n){let r=e.nodeBefore,i=r,s=e.pos-1;for(;!i.isTextblock;s--){if(i.type.spec.isolating)return!1;let u=i.lastChild;if(!u)return!1;i=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=M0(t.doc,s,l,We.empty);if(!c||c.from!=s||c instanceof nr&&c.slice.size>=l-s)return!1;if(n){let u=t.tr.step(c);u.setSelection(wt.create(u.doc,s)),n(u.scrollIntoView())}return!0}function ld(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const R8=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=$x(r)}let o=s&&s.nodeBefore;return!o||!rt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(rt.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function $x(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function L8(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const D8=(t,e,n)=>{let r=L8(t,n);if(!r)return!1;let i=Fx(r);if(!i)return!1;let s=i.nodeAfter;if(U8(t,i,e,1))return!0;if(r.parent.content.size==0&&(ld(s,"start")||rt.isSelectable(s))){let o=M0(t.doc,r.before(),r.after(),We.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(ld(s,"start")?Tt.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):rt.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},B8=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=Fx(r)}let o=s&&s.nodeAfter;return!o||!rt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(rt.create(t.doc,s.pos)).scrollIntoView()),!0)};function Fx(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const BY=(t,e)=>{let n=t.selection,r=n instanceof rt,i;if(r){if(n.node.isTextblock||!zl(t.doc,n.from))return!1;i=n.from}else if(i=P0(t.doc,n.from,-1),i==null)return!1;if(e){let s=t.tr.join(i);r&&s.setSelection(rt.create(s.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},$Y=(t,e)=>{let n=t.selection,r;if(n instanceof rt){if(n.node.isTextblock||!zl(t.doc,n.to))return!1;r=n.to}else if(r=P0(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},FY=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&Td(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},$8=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function zx(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const zY=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=zx(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(Tt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},F8=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof Ri||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=zx(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(wt.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},z8=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(Jo(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&Td(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function UY(t){return(e,n)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof rt&&e.selection.node.isBlock)return!r.parentOffset||!Jo(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let s=[],o,a,l=!1,c=!1;for(let h=r.depth;;h--)if(r.node(h).isBlock){l=r.end(h)==r.pos+(r.depth-h),c=r.start(h)==r.pos-(r.depth-h),a=zx(r.node(h-1).contentMatchAt(r.indexAfter(h-1))),s.unshift(l&&a?{type:a}:null),o=h;break}else{if(h==1)return!1;s.unshift(null)}let u=e.tr;(e.selection instanceof wt||e.selection instanceof Ri)&&u.deleteSelection();let d=u.mapping.map(r.pos),f=Jo(u.doc,d,s.length,s);if(f||(s[0]=a?{type:a}:null,f=Jo(u.doc,d,s.length,s)),!f)return!1;if(u.split(d,s.length,s),!l&&c&&r.node(o).type!=a){let h=u.mapping.map(r.before(o)),p=u.doc.resolve(h);a&&r.node(o-1).canReplaceWith(p.index(),p.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const HY=UY(),VY=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(rt.create(t.doc,i))),!0)};function jY(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||zl(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function U8(t,e,n,r){let i=e.nodeBefore,s=e.nodeAfter,o,a,l=i.type.spec.isolating||s.type.spec.isolating;if(!l&&jY(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(n){let h=e.pos+s.nodeSize,p=Ae.empty;for(let y=o.length-1;y>=0;y--)p=Ae.from(o[y].create(null,p));p=Ae.from(i.copy(p));let m=t.tr.step(new ar(e.pos-1,h,e.pos,h,new We(p,1,0),o.length,!0)),g=m.doc.resolve(h+2*o.length);g.nodeAfter&&g.nodeAfter.type==i.type&&zl(m.doc,g.pos)&&m.join(g.pos),n(m.scrollIntoView())}return!0}let u=s.type.spec.isolating||r>0&&l?null:Tt.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),f=d&&Td(d);if(f!=null&&f>=e.depth)return n&&n(t.tr.lift(d,f).scrollIntoView()),!0;if(c&&ld(s,"start",!0)&&ld(i,"end")){let h=i,p=[];for(;p.push(h),!h.isTextblock;)h=h.lastChild;let m=s,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(h.canReplace(h.childCount,h.childCount,m.content)){if(n){let y=Ae.empty;for(let k=p.length-1;k>=0;k--)y=Ae.from(p[k].copy(y));let w=t.tr.step(new ar(e.pos-p.length,e.pos+s.nodeSize,e.pos+g,e.pos+s.nodeSize-g,new We(y,p.length,0),0,!0));n(w.scrollIntoView())}return!0}}return!1}function H8(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(wt.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const WY=H8(-1),qY=H8(1);function KY(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&Lx(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function j_(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[s];n.doc.nodesBetween(o,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let u=n.doc.resolve(c),d=u.index();i=u.parent.canReplaceWith(d,d+1,t)}})}if(!i)return!1;if(r){let s=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];s.setBlockType(a,l,t,e)}r(s.scrollIntoView())}return!0}}function Ux(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}Ux(Bx,O8,R8);Ux(Bx,D8,B8);Ux($8,F8,z8,HY);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function GY(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s);if(!o)return!1;let a=r?n.tr:null;return ZY(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function ZY(t,e,n,r=null){let i=!1,s=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);s=new Gm(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Gm(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=Lx(s,n,r,e);return a?(t&&QY(t,e,a,i,n),!0):!1}function QY(t,e,n,r,i){let s=Ae.empty;for(let u=n.length-1;u>=0;u--)s=Ae.from(n[u].type.create(n[u].attrs,s));t.step(new ar(e.start-(r?2:0),e.end,e.start,e.end,new We(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,f=!0;u<d;u++,f=!1)!f&&Jo(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function XY(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?YY(e,n,t,s):JY(e,n,s):!0:!1}}function YY(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new ar(s-1,o,s,o,new We(Ae.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Gm(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=Td(r);if(a==null)return!1;i.lift(r,a);let l=i.doc.resolve(i.mapping.map(s,-1)-1);return zl(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function JY(t,e,n){let r=t.tr,i=n.parent;for(let h=n.end,p=n.endIndex-1,m=n.startIndex;p>m;p--)h-=i.child(p).nodeSize,r.delete(h-1,h+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?Ae.empty:Ae.from(i))))return!1;let d=s.pos,f=d+o.nodeSize;return r.step(new ar(d-(a?1:0),f+(l?1:0),d+1,f-1,new We((a?Ae.empty:Ae.from(i.copy(Ae.empty))).append(l?Ae.empty:Ae.from(i.copy(Ae.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function eJ(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=Ae.from(c?t.create():null),d=new We(Ae.from(t.create(null,Ae.from(a.type.create(null,u)))),c?3:1,0),f=s.start,h=s.end;n(e.tr.step(new ar(f-(c?3:1),h,f,h,d,1,!0)).scrollIntoView())}return!0}}const vr=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},cd=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let u1=null;const Oo=function(t,e,n){let r=u1||(u1=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},tJ=function(){u1=null},Rc=function(t,e,n,r){return n&&(W_(t,e,n,r,-1)||W_(t,e,n,r,1))},nJ=/^(img|br|input|textarea|hr)$/i;function W_(t,e,n,r,i){for(var s;;){if(t==n&&e==r)return!0;if(e==(i<0?0:Zi(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Vh(t)||nJ.test(t.nodeName)||t.contentEditable=="false")return!1;e=vr(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else t=o,e=i<0?Zi(t):0}else return!1}}function Zi(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function rJ(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Zi(t)}else if(t.parentNode&&!Vh(t))e=vr(t),t=t.parentNode;else return null}}function iJ(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Vh(t))e=vr(t)+1,t=t.parentNode;else return null}}function sJ(t,e,n){for(let r=e==0,i=e==Zi(t);r||i;){if(t==n)return!0;let s=vr(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==Zi(t)}}function Vh(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const N0=function(t){return t.focusNode&&Rc(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function tc(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function oJ(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function aJ(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(Zi(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(Zi(r.startContainer),r.startOffset)}}}const ho=typeof navigator<"u"?navigator:null,q_=typeof document<"u"?document:null,Ul=ho&&ho.userAgent||"",d1=/Edge\/(\d+)/.exec(Ul),V8=/MSIE \d/.exec(Ul),f1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ul),yi=!!(V8||f1||d1),bl=V8?document.documentMode:f1?+f1[1]:d1?+d1[1]:0,es=!yi&&/gecko\/(\d+)/i.test(Ul);es&&+(/Firefox\/(\d+)/.exec(Ul)||[0,0])[1];const h1=!yi&&/Chrome\/(\d+)/.exec(Ul),zr=!!h1,j8=h1?+h1[1]:0,Qr=!yi&&!!ho&&/Apple Computer/.test(ho.vendor),ud=Qr&&(/Mobile\/\w+/.test(Ul)||!!ho&&ho.maxTouchPoints>2),Ki=ud||(ho?/Mac/.test(ho.platform):!1),lJ=ho?/Win/.test(ho.platform):!1,qo=/Android \d/.test(Ul),jh=!!q_&&"webkitFontSmoothing"in q_.documentElement.style,cJ=jh?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function uJ(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function ko(t,e){return typeof t=="number"?t:t[e]}function dJ(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function K_(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=cd(o);continue}let a=o,l=a==s.body,c=l?uJ(s):dJ(a),u=0,d=0;if(e.top<c.top+ko(r,"top")?d=-(c.top-e.top+ko(i,"top")):e.bottom>c.bottom-ko(r,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+ko(i,"top")-c.top:e.bottom-c.bottom+ko(i,"bottom")),e.left<c.left+ko(r,"left")?u=-(c.left-e.left+ko(i,"left")):e.right>c.right-ko(r,"right")&&(u=e.right-c.right+ko(i,"right")),u||d)if(l)s.defaultView.scrollBy(u,d);else{let h=a.scrollLeft,p=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let m=a.scrollLeft-h,g=a.scrollTop-p;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}let f=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:cd(o)}}function fJ(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:W8(t.dom)}}function W8(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=cd(r));return e}function hJ({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;q8(n,r==0?0:r-e)}function q8(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let ou=null;function pJ(t){if(t.setActive)return t.setActive();if(ou)return t.focus(ou);let e=W8(t);t.focus(ou==null?{get preventScroll(){return ou={preventScroll:!0},!0}}:void 0),ou||(ou=!1,q8(e,0))}function K8(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,d=0;u;u=u.nextSibling,d++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=Oo(u).getClientRects();else continue;for(let h=0;h<f.length;h++){let p=f[h];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<r){n=u,r=m,i=m&&n.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&m&&(s=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(s=d+1)}}return!n&&l&&(n=l,i=c,r=0),n&&n.nodeType==3?mJ(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:K8(n,i)}function mJ(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let s=Ha(r,1);if(s.top!=s.bottom&&Hx(e,s))return{node:t,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:t,offset:0}}function Hx(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function gJ(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function yJ(t,e,n){let{node:r,offset:i}=K8(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function bJ(t,e,n,r){let i=-1;for(let s=e,o=!1;s!=t.dom;){let a=t.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?i=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function G8(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(Hx(e,c))return G8(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function wJ(t,e){let n=t.dom.ownerDocument,r,i=0,s=aJ(n,e.left,e.top);s&&({node:r,offset:i}=s);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!Hx(e,c)||(o=G8(t.dom,e,c),!o))return null}if(Qr)for(let c=o;r&&c;c=cd(c))c.draggable&&(r=void 0);if(o=gJ(o,e),r){if(es&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let u=r.childNodes[i],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&i++}let c;jh&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=bJ(t,r,i,e))}a==null&&(a=yJ(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function G_(t){return t.top<t.bottom||t.left<t.right}function Ha(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(G_(r))return r}return Array.prototype.find.call(n,G_)||t.getBoundingClientRect()}const vJ=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Z8(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=jh||es;if(r.nodeType==3)if(o&&(vJ.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=Ha(Oo(r,i,i),n);if(es&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=Ha(Oo(r,i-1,i-1),-1);if(c.top==l.top){let u=Ha(Oo(r,i,i+1),-1);if(u.top!=l.top)return tf(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,tf(Ha(Oo(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==Zi(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return lw(l.getBoundingClientRect(),!1)}if(s==null&&i<Zi(r)){let l=r.childNodes[i];if(l.nodeType==1)return lw(l.getBoundingClientRect(),!0)}return lw(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==Zi(r))){let l=r.childNodes[i-1],c=l.nodeType==3?Oo(l,Zi(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return tf(Ha(c,1),!1)}if(s==null&&i<Zi(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Oo(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return tf(Ha(c,-1),!0)}return tf(Ha(r.nodeType==3?Oo(r):r,-n),n>=0)}function tf(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function lw(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function Q8(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function xJ(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return Q8(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=Z8(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Oo(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const SJ=/[\u0590-\u08ac]/;function EJ(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return a?!SJ.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:Q8(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=t.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",n,"character");let h=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:p,focusOffset:m}=t.domSelectionRange(),g=p&&!h.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==m;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return f!=null&&(a.caretBidiLevel=f),g}):r.pos==r.start()||r.pos==r.end()}let Z_=null,Q_=null,X_=!1;function kJ(t,e,n){return Z_==e&&Q_==n?X_:(Z_=e,Q_=n,X_=n=="up"||n=="down"?xJ(t,e,n):EJ(t,e,n))}const ts=0,Y_=1,ac=2,po=3;class Wh{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=ts,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>vr(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof Y8){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof X8&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?vr(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?vr(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let d=a;d>0;d--){let f=this.children[d-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){i=vr(f.dom)+1;break}e-=f.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=vr(d.dom);break}n+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let h=0,p=0;h<this.children.length;h++){let m=this.children[h],g=p+m.size;if(s>p&&o<g)return m.setSelection(e-p-m.border,n-p-m.border,r,i);p=g}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),d=!1;if((es||Qr)&&e==n){let{node:h,offset:p}=a;if(h.nodeType==3){if(d=!!(p&&h.nodeValue[p-1]==`
`),d&&p==h.nodeValue.length)for(let m=h,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:vr(g)+1});break}let y=m.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let m=h.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(es&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let h=u.focusNode.childNodes[u.focusOffset];h&&h.contentEditable=="false"&&(i=!0)}if(!(i||d&&Qr)&&Rc(a.node,a.offset,u.anchorNode,u.anchorOffset)&&Rc(l.node,l.offset,u.focusNode,u.focusOffset))return;let f=!1;if((c.extend||e==n)&&!(d&&es)){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>n){let p=a;a=l,l=p}let h=document.createRange();h.setEnd(l.node,l.offset),h.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(h)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?ac:Y_,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=po:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?ac:po}r=o}this.dirty=ac}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?ac:Y_;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class X8 extends Wh{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==ts&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class TJ extends Wh{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Lc extends Wh{constructor(e,n,r,i,s){super(e,[],r,i),this.mark=n,this.spec=s}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=jc.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new Lc(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&po||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=po&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=ts){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=ts}}slice(e,n,r){let i=Lc.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=m1(s,n,o,r)),e>0&&(s=m1(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class wl extends Wh{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,d=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=jc.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!d&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let f=u;return u=tO(u,r,n),c?l=new _J(e,n,r,i,u,d||null,f,c,s,o+1):n.isText?new R0(e,n,r,i,u,f,s):new wl(e,n,r,i,u,d||null,f,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Ae.empty)}return e}matchesNode(e,n,r){return this.dirty==ts&&e.eq(this.node)&&Qm(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new AJ(this,o&&o.node,e);MJ(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?sn.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,i)},(c,u,d,f)=>{l.syncToMarks(c.marks,r,e);let h;l.findNodeMatch(c,u,d,f)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(h=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,d,h,e)||l.updateNextNode(c,u,d,e,f,i)||l.addNode(c,u,d,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==ac)&&(o&&this.protectLocalComposition(e,o),J8(this.contentDOM,this.children,e),ud&&OJ(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof wt)||r<n||i>n+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=NJ(this.node.content,o,r-n,i-n);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new TJ(this,s,n,i);e.input.compositionNodes.push(o),this.children=m1(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==po||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=ts}updateOuterDeco(e){if(Qm(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=eO(this.dom,this.nodeDOM,p1(this.outerDeco,this.node,n),p1(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function J_(t,e,n,r,i){tO(r,e,t);let s=new wl(void 0,t,e,n,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class R0 extends wl{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==po||this.dirty!=ts&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=ts||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=ts,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new R0(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=po)}get domAtom(){return!1}isText(e){return this.node.text==e}}class Y8 extends Wh{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==ts&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class _J extends wl{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==po)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function J8(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=eC(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof Lc){let l=r?r.previousSibling:t.lastChild;J8(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=eC(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const Nf=function(t){t&&(this.nodeName=t)};Nf.prototype=Object.create(null);const lc=[new Nf];function p1(t,e,n){if(t.length==0)return lc;let r=n?lc[0]:new Nf,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new Nf(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new Nf(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function eO(t,e,n,r){if(n==lc&&r==lc)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=lc[0]),i=l}CJ(i,a||lc[0],o)}return i}function CJ(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function tO(t,e,n){return eO(t,t,lc,p1(e,n,t.nodeType!=1))}function Qm(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function eC(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class AJ{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=IJ(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=ts,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[s])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Lc.create(this.top,e[s],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==po&&o.dom==o.contentDOM&&(o.dirty=ac),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof wl){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,d,f=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=po&&Qm(n,l.outerDeco));if(!f&&l.update(e,n,r,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(d=this.recreateWrapper(l,e,n,r,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=ac,d.updateChildren(i,o+1),d.dirty=ts),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,i,s,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Qm(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=wl.create(this.top,n,r,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,i,s){let o=wl.create(this.top,e,n,r,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new X8(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Lc;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof R0)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Qr||zr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new Y8(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function IJ(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof Lc)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function PJ(t,e){return t.type.side-e.type.side}function MJ(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<i.length&&i[o].to==s;){let g=i[o++];g.widget&&(u?(d||(d=[u])).push(g):u=g)}if(u)if(d){d.sort(PJ);for(let g=0;g<d.length;g++)n(d[g],c,!!l)}else n(u,c,!!l);let f,h;if(l)h=-1,f=l,l=null;else if(c<t.childCount)h=c,f=t.child(c++);else break;for(let g=0;g<a.length;g++)a[g].to<=s&&a.splice(g--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+f.nodeSize;if(f.isText){let g=p;o<i.length&&i[o].from<g&&(g=i[o].from);for(let y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<p&&(l=f.cut(g-s),f=f.cut(0,g-s),p=g,h=-1)}else for(;o<i.length&&i[o].to<p;)o++;let m=f.isInline&&!f.isLeaf?a.filter(g=>!g.inline):a.slice();r(f,m,e.forChild(s,f),h),s=p}}function OJ(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function NJ(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function m1(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function Vx(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(N0(n)){for(l=o;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&rt.isSelectable(d)&&i.parent&&!(d.isInline&&sJ(n.focusNode,n.focusOffset,i.dom))){let f=i.posBefore;c=new rt(o==f?a:r.resolve(f))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let d=o,f=o;for(let h=0;h<n.rangeCount;h++){let p=n.getRangeAt(h);d=Math.min(d,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=f==t.state.selection.anchor?[f,d]:[d,f],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let d=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=jx(t,u,a,d)}return c}function nO(t){return t.editable?t.hasFocus():iO(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function ea(t,e=!1){let n=t.state.selection;if(rO(t,n),!!nO(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&zr){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&Rc(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)LJ(t);else{let{anchor:r,head:i}=n,s,o;tC&&!(n instanceof wt)&&(n.$from.parent.inlineContent||(s=nC(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=nC(t,n.to))),t.docView.setSelection(r,i,t,e),tC&&(s&&rC(s),o&&rC(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&RJ(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const tC=Qr||zr&&j8<63;function nC(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(Qr&&i&&i.contentEditable=="false")return cw(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return cw(i);if(s)return cw(s)}}function cw(t){return t.contentEditable="true",Qr&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function rC(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function RJ(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!nO(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function LJ(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,vr(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&yi&&bl<=11&&(n.disabled=!0,n.disabled=!1)}function rO(t,e){if(e instanceof rt){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(iC(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else iC(t)}function iC(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function jx(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||wt.between(e,n,r)}function sC(t){return t.editable&&!t.hasFocus()?!1:iO(t)}function iO(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function DJ(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return Rc(e.node,e.offset,n.anchorNode,n.anchorOffset)}function g1(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&Tt.findFrom(s,e)}function Wa(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function oC(t,e,n){let r=t.state.selection;if(r instanceof wt)if(n.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return Wa(t,new wt(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=g1(t.state,e);return i&&i instanceof rt?Wa(t,i):!1}else if(!(Ki&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?rt.isSelectable(s)?Wa(t,new rt(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):jh?Wa(t,new wt(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof rt&&r.node.isInline)return Wa(t,new wt(e>0?r.$to:r.$from));{let i=g1(t.state,e);return i?Wa(t,i):!1}}}function Xm(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Rf(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function au(t,e){return e<0?BJ(t):$J(t)}function BJ(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for(es&&n.nodeType==1&&r<Xm(n)&&Rf(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Rf(a,-1))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(sO(n))break;{let a=n.previousSibling;for(;a&&Rf(a,-1);)i=n.parentNode,s=vr(a),a=a.previousSibling;if(a)n=a,r=Xm(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?y1(t,n,r):i&&y1(t,i,s)}function $J(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=Xm(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Rf(a,1))s=n,o=++r;else break}else{if(sO(n))break;{let a=n.nextSibling;for(;a&&Rf(a,1);)s=a.parentNode,o=vr(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=Xm(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&y1(t,s,o)}function sO(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function FJ(t,e){for(;t&&e==t.childNodes.length&&!Vh(t);)e=vr(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function zJ(t,e){for(;t&&!e&&!Vh(t);)e=vr(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function y1(t,e,n){if(e.nodeType!=3){let s,o;(o=FJ(e,n))?(e=o,n=0):(s=zJ(e,n))&&(e=s,n=s.nodeValue.length)}let r=t.domSelection();if(!r)return;if(N0(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&ea(t)},50)}function aC(t,e){let n=t.state.doc.resolve(e);if(!(zr||lJ)&&n.parent.inlineContent){let i=t.coordsAtPos(e);if(e>n.start()){let s=t.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<n.end()){let s=t.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function lC(t,e,n){let r=t.state.selection;if(r instanceof wt&&!r.empty||n.indexOf("s")>-1||Ki&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=g1(t.state,e);if(o&&o instanceof rt)return Wa(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof Ri?Tt.near(o,e):Tt.findFrom(o,e);return a?Wa(t,a):!1}return!1}function cC(t,e){if(!(t.state.selection instanceof wt))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function uC(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function UJ(t){if(!Qr||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;uC(t,r,"true"),setTimeout(()=>uC(t,r,"false"),20)}return!1}function HJ(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function VJ(t,e){let n=e.keyCode,r=HJ(e);if(n==8||Ki&&n==72&&r=="c")return cC(t,-1)||au(t,-1);if(n==46&&!e.shiftKey||Ki&&n==68&&r=="c")return cC(t,1)||au(t,1);if(n==13||n==27)return!0;if(n==37||Ki&&n==66&&r=="c"){let i=n==37?aC(t,t.state.selection.from)=="ltr"?-1:1:-1;return oC(t,i,r)||au(t,i)}else if(n==39||Ki&&n==70&&r=="c"){let i=n==39?aC(t,t.state.selection.from)=="ltr"?1:-1:1;return oC(t,i,r)||au(t,i)}else{if(n==38||Ki&&n==80&&r=="c")return lC(t,-1,r)||au(t,-1);if(n==40||Ki&&n==78&&r=="c")return UJ(t)||lC(t,1,r)||au(t,1);if(r==(Ki?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function Wx(t,e){t.someProp("transformCopied",h=>{e=h(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let h=r.firstChild;n.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let o=t.someProp("clipboardSerializer")||jc.fromSchema(t.state.schema),a=dO(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=uO[c.nodeName.toLowerCase()]);){for(let h=u.length-1;h>=0;h--){let p=a.createElement(u[h]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",h=>h(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:f,slice:e}}function oO(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",f=>{e=f(e,s||r,t)}),s)return a=new We(Ae.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{a=f(a,t,!0)}),a;let d=t.someProp("clipboardTextParser",f=>f(e,i,r,t));if(d)a=d;else{let f=i.marks(),{schema:h}=t.state,p=jc.fromSchema(h);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(h.text(m,f)))})}}else t.someProp("transformPastedHTML",d=>{n=d(n,t)}),o=KJ(n),jh&&GJ(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||yl.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!jJ.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)a=ZJ(dC(a,+u[1],+u[2]),u[4]);else if(a=We.maxOpen(WJ(a.content,i),!0),a.openStart||a.openEnd){let d=0,f=0;for(let h=a.content.firstChild;d<a.openStart&&!h.type.spec.isolating;d++,h=h.firstChild);for(let h=a.content.lastChild;f<a.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);a=dC(a,d,f)}return t.someProp("transformPasted",d=>{a=d(a,t,l)}),a}const jJ=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function WJ(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&lO(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=cO(o[o.length-1],s.length));let u=aO(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return Ae.from(o)}return t}function aO(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Ae.from(t));return t}function lO(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=lO(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(Ae.from(aO(n,t,i+1))))}}function cO(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,cO(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Ae.empty,!0);return t.copy(n.append(r))}function b1(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),i<r-1&&(a=b1(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Ae.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function dC(t,e,n){return e<t.openStart&&(t=new We(b1(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new We(b1(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const uO={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let fC=null;function dO(){return fC||(fC=document.implementation.createHTMLDocument("title"))}let uw=null;function qJ(t){let e=window.trustedTypes;return e?(uw||(uw=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),uw.createHTML(t)):t}function KJ(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=dO().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&uO[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=qJ(t),i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function GJ(t){let e=t.querySelectorAll(zr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent=="Â "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function ZJ(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=Ae.from(l.create(r[a+1],i)),s++,o++}return new We(i,s,o)}const Xr={},Yr={},QJ={touchstart:!0,touchmove:!0};class XJ{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function YJ(t){for(let e in Xr){let n=Xr[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{eee(t,r)&&!qx(t,r)&&(t.editable||!(r.type in Yr))&&n(t,r)},QJ[e]?{passive:!0}:void 0)}Qr&&t.dom.addEventListener("input",()=>null),w1(t)}function ul(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function JJ(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function w1(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>qx(t,r))})}function qx(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function eee(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function tee(t,e){!qx(t,e)&&Xr[e.type]&&(t.editable||!(e.type in Yr))&&Xr[e.type](t,e)}Yr.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!hO(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(qo&&zr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),ud&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,tc(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||VJ(t,n)?n.preventDefault():ul(t,"key")};Yr.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Yr.keypress=(t,e)=>{let n=e;if(hO(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ki&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof wt)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode),s=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,i,s))&&t.dispatch(s()),n.preventDefault()}};function L0(t){return{left:t.clientX,top:t.clientY}}function nee(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function Kx(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function Vu(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function ree(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&rt.isSelectable(r)?(Vu(t,new rt(n)),!0):!1}function iee(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof rt&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(rt.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(Vu(t,rt.create(t.state.doc,i)),!0):!1}function see(t,e,n,r,i){return Kx(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?iee(t,n):ree(t,n))}function oee(t,e,n,r){return Kx(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function aee(t,e,n,r){return Kx(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||lee(t,n,r)}function lee(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(Vu(t,wt.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)Vu(t,wt.create(r,a+1,a+1+o.content.size));else if(rt.isSelectable(o))Vu(t,rt.create(r,a));else continue;return!0}}function Gx(t){return Ym(t)}const fO=Ki?"metaKey":"ctrlKey";Xr.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Gx(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&nee(n,t.input.lastClick)&&!n[fO]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s,button:n.button};let o=t.posAtCoords(L0(n));o&&(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new cee(t,o,n,!!r)):(s=="doubleClick"?oee:aee)(t,o.pos,o.inside,n)?n.preventDefault():ul(t,"pointer"))};class cee{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[fO],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof rt&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&es&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),ul(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ea(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(L0(e))),this.updateAllowDefault(e),this.allowDefault||!n?ul(this.view,"pointer"):see(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Qr&&this.mightDrag&&!this.mightDrag.node.isAtom||zr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Vu(this.view,Tt.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):ul(this.view,"pointer")}move(e){this.updateAllowDefault(e),ul(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Xr.touchstart=t=>{t.input.lastTouch=Date.now(),Gx(t),ul(t,"pointer")};Xr.touchmove=t=>{t.input.lastTouch=Date.now(),ul(t,"pointer")};Xr.contextmenu=t=>Gx(t);function hO(t,e){return t.composing?!0:Qr&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const uee=qo?5e3:-1;Yr.compositionstart=Yr.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof wt&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),Ym(t,!0),t.markCursor=null;else if(Ym(t,!e.selection.empty),es&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}pO(t,uee)};Yr.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,pO(t,20))};function pO(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Ym(t),e))}function mO(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=fee());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function dee(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=rJ(e.focusNode,e.focusOffset),r=iJ(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let i=r.pmViewDesc,s=t.domObserver.lastChangedTextNode;if(n==s||r==s)return s;if(!i||!i.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function fee(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Ym(t,e=!1){if(!(qo&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),mO(t),e||t.docView&&t.docView.dirty){let n=Vx(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function hee(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const ah=yi&&bl<15||ud&&cJ<604;Xr.copy=Yr.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=ah?null:n.clipboardData,o=r.content(),{dom:a,text:l}=Wx(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):hee(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function pee(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function mee(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?lh(t,r.value,null,i,e):lh(t,r.textContent,r.innerHTML,i,e)},50)}function lh(t,e,n,r,i){let s=oO(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,s||We.empty)))return!0;if(!s)return!1;let o=pee(s),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function gO(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Yr.paste=(t,e)=>{let n=e;if(t.composing&&!qo)return;let r=ah?null:n.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&lh(t,gO(r),r.getData("text/html"),i,n)?n.preventDefault():mee(t,n)};class yO{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const gee=Ki?"altKey":"ctrlKey";function bO(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[gee]}Xr.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(L0(n)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof rt?i.to-1:i.to))){if(r&&r.mightDrag)o=rt.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let d=t.docView.nearestDesc(n.target,!0);d&&d.node.type.spec.draggable&&d!=t.docView&&(o=rt.create(t.state.doc,d.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=Wx(t,a);(!n.dataTransfer.files.length||!zr||j8>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(ah?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",ah||n.dataTransfer.setData("text/plain",c),t.dragging=new yO(u,bO(t,n),o)};Xr.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Yr.dragover=Yr.dragenter=(t,e)=>e.preventDefault();Yr.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(L0(n));if(!i)return;let s=t.state.doc.resolve(i.pos),o=r&&r.slice;o?t.someProp("transformPasted",p=>{o=p(o,t,!1)}):o=oO(t,gO(n.dataTransfer),ah?null:n.dataTransfer.getData("text/html"),!1,s);let a=!!(r&&bO(t,n));if(t.someProp("handleDrop",p=>p(t,n,o||We.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?E8(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let c=t.state.tr;if(a){let{node:p}=r;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,f=c.doc;if(d?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(f))return;let h=c.doc.resolve(u);if(d&&rt.isSelectable(o.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new rt(h));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((m,g,y,w)=>p=w),c.setSelection(jx(t,h,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};Xr.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&ea(t)},20))};Xr.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Xr.beforeinput=(t,e)=>{if(zr&&qo&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,tc(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Yr)Xr[t]=Yr[t];function ch(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Jm{constructor(e,n){this.toDOM=e,this.spec=n||vc,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new sr(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Jm&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&ch(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class vl{constructor(e,n){this.attrs=e,this.spec=n||vc}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new sr(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof vl&&ch(this.attrs,e.attrs)&&ch(this.spec,e.spec)}static is(e){return e.type instanceof vl}destroy(){}}class Zx{constructor(e,n){this.attrs=e,this.spec=n||vc}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new sr(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof Zx&&ch(this.attrs,e.attrs)&&ch(this.spec,e.spec)}destroy(){}}class sr{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new sr(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new sr(e,e,new Jm(n,r))}static inline(e,n,r,i){return new sr(e,n,new vl(r,i))}static node(e,n,r,i){return new sr(e,n,new Zx(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof vl}get widget(){return this.type instanceof Jm}}const mu=[],vc={};class nn{constructor(e,n){this.local=e.length?e:mu,this.children=n.length?n:mu}static create(e,n){return n.length?eg(n,e,0,vc):Mr}find(e,n,r){let i=[];return this.findInner(e??0,n??1e9,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==Mr||e.maps.length==0?this:this.mapInner(e,n,0,0,r||vc)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?yee(this.children,o||[],e,n,r,i,s):o?new nn(o.sort(xc),mu):Mr}add(e,n){return n.length?this==Mr?nn.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(u=vO(n,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,eg(u,a,c+1,vc)),s+=3}});let o=wO(s?xO(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new nn(o.length?this.local.concat(o).sort(xc):this.local,i||this.children)}remove(e){return e.length==0||this==Mr?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=Mr?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new nn(i,r):Mr}forChild(e,n){if(this==Mr)return this;if(n.isLeaf)return nn.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof vl){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new nn(i.sort(xc),mu);return r?new Ya([a,r]):a}return r||Mr}eq(e){if(this==e)return!0;if(!(e instanceof nn)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Qx(this.localsInner(e))}localsInner(e){if(this==Mr)return mu;if(e.inlineContent||!this.local.some(vl.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof vl||n.push(this.local[r]);return n}forEachSet(e){e(this)}}nn.empty=new nn([],[]);nn.removeOverlap=Qx;const Mr=nn.empty;class Ya{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,vc));return Ya.from(r)}forChild(e,n){if(n.isLeaf)return nn.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=Mr&&(s instanceof Ya?r=r.concat(s.members):r.push(s))}return Ya.from(r)}eq(e){if(!(e instanceof Ya)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?Qx(r?n:n.sort(xc)):mu}static from(e){switch(e.length){case 0:return Mr;case 1:return e[0];default:return new Ya(e.every(n=>n instanceof nn)?e:e.reduce((n,r)=>n.concat(r instanceof nn?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function yee(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let d=0;n.maps[c].forEach((f,h,p,m)=>{let g=m-p-(h-f);for(let y=0;y<a.length;y+=3){let w=a[y+1];if(w<0||f>w+u-d)continue;let k=a[y]+u-d;h>=k?a[y+1]=f<=k?-2:-1:f>=u&&g&&(a[y]+=g,a[y+1]+=g)}d+=g}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),d=u-i;if(d<0||d>=r.content.size){l=!0;continue}let f=n.map(t[c+1]+s,-1),h=f-i,{index:p,offset:m}=r.content.findIndex(d),g=r.maybeChild(p);if(g&&m==d&&m+g.nodeSize==h){let y=a[c+2].mapInner(n,g,u+1,t[c]+s+1,o);y!=Mr?(a[c]=d,a[c+1]=h,a[c+2]=y):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=bee(a,t,e,n,i,s,o),u=eg(c,r,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,f=0;d<u.children.length;d+=3){let h=u.children[d];for(;f<a.length&&a[f]<h;)f+=3;a.splice(f,0,u.children[d],u.children[d+1],u.children[d+2])}}return new nn(e.sort(xc),a)}function wO(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new sr(i.from+e,i.to+e,i.type))}return n}function bee(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(r,i,c);d?n.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function vO(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function xO(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function eg(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=vO(t,a,l+n);if(c){s=!0;let u=eg(c,a,n+l+1,r);u!=Mr&&i.push(l,l+a.nodeSize,u)}});let o=wO(s?xO(t):t,-n).sort(xc);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new nn(o,i):Mr}function xc(t,e){return t.from-e.from||t.to-e.to}function Qx(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),hC(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),hC(e,i,r.copy(s.from,r.to)));break}}}return e}function hC(t,e,n){for(;e<t.length&&xc(n,t[e])>0;)e++;t.splice(e,0,n)}function dw(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=Mr&&e.push(r)}),t.cursorWrapper&&e.push(nn.create(t.state.doc,[t.cursorWrapper.deco])),Ya.from(e)}const wee={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},vee=yi&&bl<=11;class xee{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class See{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new xee,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);yi&&bl<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),vee&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,wee)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(sC(this.view)){if(this.suppressingSelectionUpdates)return ea(this.view);if(yi&&bl<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Rc(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=cd(s))n.add(s);for(let s=e.anchorNode;s;s=cd(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&sC(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let d=this.registerMutation(n[u],l);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if(es&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,f]=u;d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let f of u){let h=f.parentNode;h&&h.nodeName=="LI"&&(!d||Tee(e,d)!=h)&&f.remove()}}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&N0(r)&&(c=Vx(e))&&c.eq(Tt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ea(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),Eee(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||ea(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];n.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(yi&&bl<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:f}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f)}let o=i&&i.parentNode==e.target?vr(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?vr(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let pC=new WeakMap,mC=!1;function Eee(t){if(!pC.has(t)&&(pC.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=es,mC)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),mC=!0}}function gC(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return Rc(o.node,o.offset,i,s)&&([n,r,i,s]=[i,s,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}}function kee(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return gC(t,i)}let n;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?gC(t,n):null}function Tee(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function _ee(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],N0(l)||c.push({node:l.focusNode,offset:l.focusOffset})),zr&&t.input.lastKeyCode===8)for(let g=s;g>i;g--){let y=r.childNodes[g-1],w=y.pmViewDesc;if(y.nodeName=="BR"&&!w){s=g;break}if(!w||w.size)break}let d=t.state.doc,f=t.someProp("domParser")||yl.fromSchema(t.state.schema),h=d.resolve(o),p=null,m=f.parse(r,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:i,to:s,preserveWhitespace:h.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:Cee,context:h});if(c&&c[0].pos!=null){let g=c[0].pos,y=c[1]&&c[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:m,sel:p,from:o,to:a}}function Cee(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Qr&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Qr&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Aee=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Iee(t,e,n,r,i){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let P=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,S=Vx(t,P);if(S&&!t.state.selection.eq(S)){if(zr&&qo&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",_=>_(t,tc(13,"Enter"))))return;let x=t.state.tr.setSelection(S);P=="pointer"?x.setMeta("pointer",!0):P=="key"&&x.scrollIntoView(),s&&x.setMeta("composition",s),t.dispatch(x)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=_ee(t,e,n),u=t.state.doc,d=u.slice(c.from,c.to),f,h;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,h="end"):(f=t.state.selection.from,h="start"),t.input.lastKeyCode=null;let p=Oee(d.content,c.doc.content,c.from,f,h);if(p&&t.input.domChangeCount++,(ud&&t.input.lastIOSEnter>Date.now()-225||qo)&&i.some(P=>P.nodeType==1&&!Aee.test(P.nodeName))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",P=>P(t,tc(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!p)if(r&&l instanceof wt&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let P=yC(t,t.state.doc,c.sel);if(P&&!P.eq(t.state.selection)){let S=t.state.tr.setSelection(P);s&&S.setMeta("composition",s),t.dispatch(S)}}return}t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof wt&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),yi&&bl<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" Â "&&(p.start--,p.endA--,p.endB--);let m=c.doc.resolveNoCache(p.start-c.from),g=c.doc.resolveNoCache(p.endB-c.from),y=u.resolve(p.start),w=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=p.endA;if((ud&&t.input.lastIOSEnter>Date.now()-225&&(!w||i.some(P=>P.nodeName=="DIV"||P.nodeName=="P"))||!w&&m.pos<c.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&m.pos<g.pos&&!/\S/.test(c.doc.textBetween(m.pos,g.pos,"","")))&&t.someProp("handleKeyDown",P=>P(t,tc(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>p.start&&Mee(u,p.start,p.endA,m,g)&&t.someProp("handleKeyDown",P=>P(t,tc(8,"Backspace")))){qo&&zr&&t.domObserver.suppressSelectionUpdates();return}zr&&p.endB==p.start&&(t.input.lastChromeDelete=Date.now()),qo&&!w&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,g=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(P){return P(t,tc(13,"Enter"))})},20));let k=p.start,C=p.endA,A=P=>{let S=P||t.state.tr.replace(k,C,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let x=yC(t,S.doc,c.sel);x&&!(zr&&t.composing&&x.empty&&(p.start!=p.endB||t.input.lastChromeDelete<Date.now()-100)&&(x.head==k||x.head==S.mapping.map(C)-1)||yi&&x.empty&&x.head==k)&&S.setSelection(x)}return s&&S.setMeta("composition",s),S.scrollIntoView()},E;if(w)if(m.pos==g.pos){yi&&bl<=11&&m.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>ea(t),20));let P=A(t.state.tr.delete(k,C)),S=u.resolve(p.start).marksAcross(u.resolve(p.endA));S&&P.ensureMarks(S),t.dispatch(P)}else if(p.endA==p.endB&&(E=Pee(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start())))){let P=A(t.state.tr);E.type=="add"?P.addMark(k,C,E.mark):P.removeMark(k,C,E.mark),t.dispatch(P)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let P=m.parent.textBetween(m.parentOffset,g.parentOffset),S=()=>A(t.state.tr.insertText(P,k,C));t.someProp("handleTextInput",x=>x(t,k,C,P,S))||t.dispatch(S())}else t.dispatch(A());else t.dispatch(A())}function yC(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:jx(t,e.resolve(n.anchor),e.resolve(n.head))}function Pee(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(Ae.from(c).eq(t))return{mark:a,type:o}}function Mee(t,e,n,r,i){if(n-e<=i.pos-r.pos||fw(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(!r.parent.isTextblock){let a=s.nodeAfter;return a!=null&&n==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(fw(s,!0,!0));return!o.parent.isTextblock||o.pos>n||fw(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function fw(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function Oee(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}if(o<s&&t.size<e.size){let l=r<=s&&r>=o?s-r:0;s-=l,s&&s<e.size&&bC(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=r<=s&&r>=a?s-r:0;s-=l,s&&s<t.size&&bC(t.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function bC(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class SO{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new XJ,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(EC),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=xC(this),vC(this),this.nodeViews=SC(this),this.docView=J_(this.state.doc,wC(this),dw(this),this.dom,this),this.domObserver=new See(this,(r,i,s,o)=>Iee(this,r,i,s,o)),this.domObserver.start(),YJ(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&w1(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(EC),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&(mO(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let h=SC(this);Ree(h,this.nodeViews)&&(this.nodeViews=h,s=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&w1(this),this.editable=xC(this),vC(this);let l=dw(this),c=wC(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(i.selection))&&(o=!0);let f=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&fJ(this);if(o){this.domObserver.stop();let h=d&&(yi||zr)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&Nee(i.selection,e.selection);if(d){let p=zr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=dee(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=J_(e.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(h=!0)}h||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&DJ(this))?ea(this,h):(rO(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&hJ(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof rt){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&K_(this,n.getBoundingClientRect(),e)}else K_(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let s=r.from+(this.state.doc.content.size-n.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==r.node&&(i=s)}this.dragging=new yO(e.slice,e.move,i<0?void 0:rt.create(this.state.doc,i))}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(yi){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&pJ(this.dom),ea(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return wJ(this,e)}coordsAtPos(e,n=1){return Z8(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return kJ(this,n||this.state,e)}pasteHTML(e,n){return lh(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return lh(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return Wx(this,e)}destroy(){this.docView&&(JJ(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],dw(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,tJ())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return tee(this,e)}domSelectionRange(){let e=this.domSelection();return e?Qr&&this.root.nodeType===11&&oJ(this.dom.ownerDocument)==this.dom&&kee(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}SO.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function wC(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[sr.node(0,t.state.doc.content.size,e)]}function vC(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:sr.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function xC(t){return!t.someProp("editable",e=>e(t.state)===!1)}function Nee(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function SC(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function Ree(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function EC(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Pl={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},tg={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Lee=typeof navigator<"u"&&/Mac/.test(navigator.platform),Dee=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var xr=0;xr<10;xr++)Pl[48+xr]=Pl[96+xr]=String(xr);for(var xr=1;xr<=24;xr++)Pl[xr+111]="F"+xr;for(var xr=65;xr<=90;xr++)Pl[xr]=String.fromCharCode(xr+32),tg[xr]=String.fromCharCode(xr);for(var hw in Pl)tg.hasOwnProperty(hw)||(tg[hw]=Pl[hw]);function Bee(t){var e=Lee&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||Dee&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?tg:Pl)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const $ee=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Fee=typeof navigator<"u"&&/Win/.test(navigator.platform);function zee(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))$ee?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function Uee(t){let e=Object.create(null);for(let n in t)e[zee(n)]=t[n];return e}function pw(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function Hee(t){return new Qt({props:{handleKeyDown:EO(t)}})}function EO(t){let e=Uee(t);return function(n,r){let i=Bee(r),s,o=e[pw(i,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[pw(i,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(Fee&&r.ctrlKey&&r.altKey)&&(s=Pl[r.keyCode])&&s!=i){let a=e[pw(s,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}var Vee=Object.defineProperty,Xx=(t,e)=>{for(var n in e)Vee(t,n,{get:e[n],enumerable:!0})};function D0(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}var B0=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:i}=n,s=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([o,a])=>[o,(...c)=>{const u=a(...c)(s);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(i),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o=[],a=!!t,l=t||i.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(l),o.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(n).map(([d,f])=>[d,(...p)=>{const m=this.buildProps(l,e),g=f(...p)(m);return o.push(g),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,r=!1,i=t||n.tr,s=this.buildProps(i,r);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...s,dispatch:void 0})])),chain:()=>this.createChain(i,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o={tr:t,editor:r,view:s,state:D0({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},kO={};Xx(kO,{blur:()=>jee,clearContent:()=>Wee,clearNodes:()=>qee,command:()=>Kee,createParagraphNear:()=>Gee,cut:()=>Zee,deleteCurrentNode:()=>Qee,deleteNode:()=>Xee,deleteRange:()=>Yee,deleteSelection:()=>Jee,enter:()=>ete,exitCode:()=>tte,extendMarkRange:()=>nte,first:()=>rte,focus:()=>ite,forEach:()=>ste,insertContent:()=>ote,insertContentAt:()=>cte,joinBackward:()=>fte,joinDown:()=>dte,joinForward:()=>hte,joinItemBackward:()=>pte,joinItemForward:()=>mte,joinTextblockBackward:()=>gte,joinTextblockForward:()=>yte,joinUp:()=>ute,keyboardShortcut:()=>wte,lift:()=>vte,liftEmptyBlock:()=>xte,liftListItem:()=>Ste,newlineInCode:()=>Ete,resetAttributes:()=>kte,scrollIntoView:()=>Tte,selectAll:()=>_te,selectNodeBackward:()=>Cte,selectNodeForward:()=>Ate,selectParentNode:()=>Ite,selectTextblockEnd:()=>Pte,selectTextblockStart:()=>Mte,setContent:()=>Ote,setMark:()=>Qte,setMeta:()=>Xte,setNode:()=>Yte,setNodeSelection:()=>Jte,setTextSelection:()=>ene,sinkListItem:()=>tne,splitBlock:()=>nne,splitListItem:()=>rne,toggleList:()=>ine,toggleMark:()=>sne,toggleNode:()=>one,toggleWrap:()=>ane,undoInputRule:()=>lne,unsetAllMarks:()=>cne,unsetMark:()=>une,updateAttributes:()=>dne,wrapIn:()=>fne,wrapInList:()=>hne});var jee=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())==null||n.removeAllRanges())}),!0),Wee=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),qee=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),f=c.resolve(u.map(l+a.nodeSize)),h=d.blockRange(f);if(!h)return;const p=Td(h);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(h.start,m)}(p||p===0)&&e.lift(h,p)})}),!0},Kee=t=>e=>t(e),Gee=()=>({state:t,dispatch:e})=>F8(t,e),Zee=(t,e)=>({editor:n,tr:r})=>{const{state:i}=n,s=i.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,s.content),r.setSelection(new wt(r.doc.resolve(Math.max(o-1,0)))),!0},Qee=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===r.type){if(e){const a=i.before(s),l=i.after(s);t.delete(a,l).scrollIntoView()}return!0}return!1};function qn(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var Xee=t=>({tr:e,state:n,dispatch:r})=>{const i=qn(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},Yee=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},Jee=()=>({state:t,dispatch:e})=>Bx(t,e),ete=()=>({commands:t})=>t.keyboardShortcut("Enter"),tte=()=>({state:t,dispatch:e})=>zY(t,e);function Yx(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function ng(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:Yx(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function TO(t,e,n={}){return t.find(r=>r.type===e&&ng(Object.fromEntries(Object.keys(n).map(i=>[i,r.attrs[i]])),n))}function kC(t,e,n={}){return!!TO(t,e,n)}function Jx(t,e,n){var r;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(n=n||((r=i.node.marks[0])==null?void 0:r.attrs),!TO([...i.node.marks],e,n)))return;let o=i.index,a=t.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&kC([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&kC([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function ga(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var nte=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=ga(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const d=Jx(l,s,e);if(d&&d.from<=c&&d.to>=u){const f=wt.create(o,d.from,d.to);n.setSelection(f)}}return!0},rte=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function _O(t){return t instanceof wt}function cc(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function CO(t,e=null){if(!e)return null;const n=Tt.atStart(t),r=Tt.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?wt.create(t,cc(0,i,s),cc(t.content.size,i,s)):wt.create(t,cc(e,i,s),cc(e,i,s))}function AO(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function $0(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var ite=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{($0()||AO())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!_O(n.state.selection))return o(),!0;const a=CO(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},ste=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),ote=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),IO=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&IO(r)}return t};function Ep(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return IO(n)}function uh(t,e,n){if(t instanceof gl||t instanceof Ae)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,i=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return Ae.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(s){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),uh("",e,n)}if(i){if(n.errorOnInvalidContent){let o=!1,a="";const l=new f8({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?yl.fromSchema(l).parseSlice(Ep(t),n.parseOptions):yl.fromSchema(l).parse(Ep(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=yl.fromSchema(e);return n.slice?s.parseSlice(Ep(t),n.parseOptions).content:s.parse(Ep(t),n.parseOptions)}return uh("",e,n)}function ate(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof nr||i instanceof ar))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(Tt.near(t.doc.resolve(o),n))}var lte=t=>!("type"in t),cte=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{var o;if(i){n={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{uh(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=uh(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,h=!0;if((lte(a)?a:[a]).forEach(g=>{g.check(),f=f?g.isText&&g.marks.length===0:!1,h=h?g.isBlock:!1}),u===d&&h){const{parent:g}=r.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(f){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof Ae){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;r.insertText(m,u,d)}else{m=a;const g=r.doc.resolve(u),y=g.node(),w=g.parentOffset===0,k=y.isText||y.isTextblock,C=y.content.size>0;w&&k&&C&&(u=Math.max(0,u-1)),r.replaceWith(u,d,m)}n.updateSelection&&ate(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:m}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:m})}return!0},ute=()=>({state:t,dispatch:e})=>BY(t,e),dte=()=>({state:t,dispatch:e})=>$Y(t,e),fte=()=>({state:t,dispatch:e})=>O8(t,e),hte=()=>({state:t,dispatch:e})=>D8(t,e),pte=()=>({state:t,dispatch:e,tr:n})=>{try{const r=P0(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},mte=()=>({state:t,dispatch:e,tr:n})=>{try{const r=P0(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},gte=()=>({state:t,dispatch:e})=>LY(t,e),yte=()=>({state:t,dispatch:e})=>DY(t,e);function PO(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function bte(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))$0()||PO()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}var wte=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=bte(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l?.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function Ml(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?qn(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(d,f)=>{if(d.isText)return;const h=Math.max(r,f),p=Math.min(i,f+d.nodeSize);a.push({node:d,from:h,to:p})});const l=i-r,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>ng(d.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((d,f)=>d+f.to-f.from,0)>=l}var vte=(t,e={})=>({state:n,dispatch:r})=>{const i=qn(t,n.schema);return Ml(n,i,e)?FY(n,r):!1},xte=()=>({state:t,dispatch:e})=>z8(t,e),Ste=t=>({state:e,dispatch:n})=>{const r=qn(t,e.schema);return XY(r)(e,n)},Ete=()=>({state:t,dispatch:e})=>$8(t,e);function F0(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function TC(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}var kte=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=F0(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=qn(t,r.schema)),a==="mark"&&(o=ga(t,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&n.setNodeMarkup(u,void 0,TC(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(d=>{o===d.type&&n.addMark(u,u+c.nodeSize,o.create(TC(d.attrs,e)))})})}),!0):!1},Tte=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),_te=()=>({tr:t,dispatch:e})=>{if(e){const n=new Ri(t.doc);t.setSelection(n)}return!0},Cte=()=>({state:t,dispatch:e})=>R8(t,e),Ate=()=>({state:t,dispatch:e})=>B8(t,e),Ite=()=>({state:t,dispatch:e})=>VY(t,e),Pte=()=>({state:t,dispatch:e})=>qY(t,e),Mte=()=>({state:t,dispatch:e})=>WY(t,e);function v1(t,e,n={},r={}){return uh(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var Ote=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(r.preserveWhitespace!=="full"){const c=v1(t,i.schema,r,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return o&&s.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:r,errorOnInvalidContent:e??i.options.enableContentCheck})};function MO(t,e){const n=ga(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function eS(t,e){const n=new A8(t);return e.forEach(r=>{r.steps.forEach(i=>{n.step(i)})}),n}function Nte(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Rte(t,e){const n=[];return t.descendants((r,i)=>{e(r)&&n.push({node:r,pos:i})}),n}function OO(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(i,s)=>{n(i)&&r.push({node:i,pos:s})}),r}function Lte(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function z0(t){return e=>Lte(e.$from,t)}function ct(t,e,n){return t.config[e]===void 0&&t.parent?ct(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?ct(t.parent,e,n):null}):t.config[e]}function tS(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},r=ct(e,"addExtensions",n);return r?[e,...tS(r())]:e}).flat(10)}function nS(t,e){const n=jc.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}function NO(t){return typeof t=="function"}function Jt(t,e=void 0,...n){return NO(t)?e?t.bind(e)(...n):t(...n):t}function Dte(t={}){return Object.keys(t).length===0&&t.constructor===Object}function dh(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function RO(t){const e=[],{nodeExtensions:n,markExtensions:r}=dh(t),i=[...n,...r],s={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=ct(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([f,h])=>{e.push({type:d,name:f,attribute:{...s,...h}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=ct(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const f={...s,...d};typeof f?.default=="function"&&(f.default=f.default()),f?.isRequired&&f?.default===void 0&&delete f.default,e.push({type:o.name,name:u,attribute:f})})}),e}function Pn(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(u=>!l.includes(u));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),a.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),r[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[i]=s}),r},{})}function fh(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>Pn(n,r),{})}function Bte(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function _C(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):Bte(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function CC(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&Dte(n)?!1:n!=null))}function $te(t,e){var n;const r=RO(t),{nodeExtensions:i,markExtensions:s}=dh(t),o=(n=i.find(c=>ct(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(i.map(c=>{const u=r.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((y,w)=>{const k=ct(w,"extendNodeSchema",d);return{...y,...k?k(c):{}}},{}),h=CC({...f,content:Jt(ct(c,"content",d)),marks:Jt(ct(c,"marks",d)),group:Jt(ct(c,"group",d)),inline:Jt(ct(c,"inline",d)),atom:Jt(ct(c,"atom",d)),selectable:Jt(ct(c,"selectable",d)),draggable:Jt(ct(c,"draggable",d)),code:Jt(ct(c,"code",d)),whitespace:Jt(ct(c,"whitespace",d)),linebreakReplacement:Jt(ct(c,"linebreakReplacement",d)),defining:Jt(ct(c,"defining",d)),isolating:Jt(ct(c,"isolating",d)),attrs:Object.fromEntries(u.map(y=>{var w,k;return[y.name,{default:(w=y?.attribute)==null?void 0:w.default,validate:(k=y?.attribute)==null?void 0:k.validate}]}))}),p=Jt(ct(c,"parseHTML",d));p&&(h.parseDOM=p.map(y=>_C(y,u)));const m=ct(c,"renderHTML",d);m&&(h.toDOM=y=>m({node:y,HTMLAttributes:fh(y,u)}));const g=ct(c,"renderText",d);return g&&(h.toText=g),[c.name,h]})),l=Object.fromEntries(s.map(c=>{const u=r.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((g,y)=>{const w=ct(y,"extendMarkSchema",d);return{...g,...w?w(c):{}}},{}),h=CC({...f,inclusive:Jt(ct(c,"inclusive",d)),excludes:Jt(ct(c,"excludes",d)),group:Jt(ct(c,"group",d)),spanning:Jt(ct(c,"spanning",d)),code:Jt(ct(c,"code",d)),attrs:Object.fromEntries(u.map(g=>{var y,w;return[g.name,{default:(y=g?.attribute)==null?void 0:y.default,validate:(w=g?.attribute)==null?void 0:w.validate}]}))}),p=Jt(ct(c,"parseHTML",d));p&&(h.parseDOM=p.map(g=>_C(g,u)));const m=ct(c,"renderHTML",d);return m&&(h.toDOM=g=>m({mark:g,HTMLAttributes:fh(g,u)})),[c.name,h]}));return new f8({topNode:o,nodes:a,marks:l})}function Fte(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}function rS(t){return t.sort((n,r)=>{const i=ct(n,"priority")||100,s=ct(r,"priority")||100;return i>s?-1:i<s?1:0})}function LO(t){const e=rS(tS(t)),n=Fte(e.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}function DO(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,i,(l,c,u,d)=>{var f;l.isBlock&&c>r&&(a+=s);const h=o?.[l.type.name];if(h)return u&&(a+=h({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(f=l?.text)==null?void 0:f.slice(Math.max(r,c)-c,i-c))}),a}function zte(t,e){const n={from:0,to:t.content.size};return DO(t,n,e)}function BO(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function Ute(t,e){const n=qn(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function $O(t,e){const n=F0(typeof e=="string"?e:e.name,t.schema);return n==="node"?Ute(t,e):n==="mark"?MO(t,e):{}}function Hte(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function Vte(t){const e=Hte(t);return e.length===1?e:e.filter((n,r)=>!e.filter((s,o)=>o!==r).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function iS(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),f=e.invert().map(u);r.push({oldRange:{from:d,to:f},newRange:{from:c,to:u}})})}),Vte(r)}function sS(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t),o=Jx(s,i.type);o&&r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{!i||i?.nodeSize===void 0||r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}var jte=(t,e,n,r=20)=>{const i=t.doc.resolve(n);let s=r,o=null;for(;s>0&&o===null;){const a=i.node(s);a?.type.name===e?o=a:s-=1}return[o,s]};function mw(t,e){return e.nodes[t]||e.marks[t]||null}function Xp(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}var Wte=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)==null?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";n+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,r-s))}),n};function x1(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?ga(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>ng(d.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:f})=>{const h=d.pos,p=f.pos;t.doc.nodesBetween(h,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(h,g),w=Math.min(p,g+m.nodeSize),k=w-y;o+=k,a.push(...m.marks.map(C=>({mark:C,from:y,to:w})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>ng(d.mark.attrs,n,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,f)=>d+f.to-f.from,0);return(l>0?l+c:l)>=o}function qte(t,e,n={}){if(!e)return Ml(t,null,n)||x1(t,null,n);const r=F0(e,t.schema);return r==="node"?Ml(t,e,n):r==="mark"?x1(t,e,n):!1}var Kte=(t,e)=>{const{$from:n,$to:r,$anchor:i}=t.selection;if(e){const s=z0(a=>a.type.name===e)(t.selection);if(!s)return!1;const o=t.doc.resolve(s.pos+1);return i.pos+1===o.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)},Gte=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function AC(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function IC(t,e){const{nodeExtensions:n}=dh(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=Jt(ct(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function U0(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!=null?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(s=>{i!==!1&&(U0(s,{ignoreWhitespace:n,checkChildren:e})||(i=!1))}),i}return!1}function FO(t){return t instanceof rt}function Zte(t,e,n){var r;const{selection:i}=e;let s=null;if(_O(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!=null?r:s.marks();return s.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,f)=>{if(c)return!1;if(u.isInline){const h=!f||f.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(n));c=h&&p}return!c}),c})}var Qte=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=ga(t,r.schema);if(i)if(o){const c=MO(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(u,d,(f,h)=>{const p=Math.max(h,u),m=Math.min(h+f.nodeSize,d);f.marks.find(y=>y.type===l)?f.marks.forEach(y=>{l===y.type&&n.addMark(p,m,l.create({...y.attrs,...e}))}):n.addMark(p,m,l.create(e))})});return Zte(r,n,l)},Xte=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),Yte=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=qn(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>j_(s,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>j_(s,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Jte=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=cc(t,0,r.content.size),s=rt.create(r,i);e.setSelection(s)}return!0},ene=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=wt.atStart(r).from,a=wt.atEnd(r).to,l=cc(i,o,a),c=cc(s,o,a),u=wt.create(r,l,c);e.setSelection(u)}return!0},tne=t=>({state:e,dispatch:n})=>{const r=qn(t,e.schema);return eJ(r)(e,n)};function PC(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(r)}}var nne=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=Xp(c,a.node().type.name,a.node().attrs);if(s instanceof rt&&s.node.isBlock)return!a.parentOffset||!Jo(o,a.pos)?!1:(r&&(t&&PC(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:Nte(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=d&&f?[{type:f,attrs:u}]:void 0,p=Jo(e.doc,e.mapping.map(a.pos),1,h);if(!h&&!p&&Jo(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(p=!0,h=f?[{type:f,attrs:u}]:void 0),r){if(p&&(s instanceof wt&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,h),f&&!d&&!a.parentOffset&&a.parent.type!==f)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}t&&PC(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},rne=(t,e={})=>({tr:n,state:r,dispatch:i,editor:s})=>{var o;const a=qn(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const f=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=Ae.empty;const w=l.index(-1)?1:l.index(-2)?2:3;for(let S=l.depth-w;S>=l.depth-3;S-=1)y=Ae.from(l.node(S).copy(y));const k=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,C={...Xp(f,l.node().type.name,l.node().attrs),...e},A=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(C))||void 0;y=y.append(Ae.from(a.createAndFill(null,A)||void 0));const E=l.before(l.depth-(w-1));n.replace(E,l.after(-k),new We(y,4-w,0));let P=-1;n.doc.nodesBetween(E,n.doc.content.size,(S,x)=>{if(P>-1)return!1;S.isTextblock&&S.content.size===0&&(P=x+1)}),P>-1&&n.setSelection(wt.near(n.doc.resolve(P))),n.scrollIntoView()}return!0}const h=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...Xp(f,d.type.name,d.attrs),...e},m={...Xp(f,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const g=h?[{type:a,attrs:p},{type:h,attrs:m}]:[{type:a,attrs:p}];if(!Jo(n.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:w}=r,{splittableMarks:k}=s.extensionManager,C=w||y.$to.parentOffset&&y.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!C||!i)return!0;const A=C.filter(E=>k.includes(E.type.name));n.ensureMarks(A)}return!0},gw=(t,e)=>{const n=z0(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&zl(t.doc,n.pos)&&t.join(n.pos),!0},yw=(t,e)=>{const n=z0(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&zl(t.doc,r)&&t.join(r),!0},ine=(t,e,n,r={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:f}=i.extensionManager,h=qn(t,o.schema),p=qn(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:w}=m,k=y.blockRange(w),C=g||m.$to.parentOffset&&m.$from.marks();if(!k)return!1;const A=z0(E=>IC(E.type.name,d))(m);if(k.depth>=1&&A&&k.depth-A.depth<=1){if(A.node.type===h)return c.liftListItem(p);if(IC(A.node.type.name,d)&&h.validContent(A.node.content)&&a)return l().command(()=>(s.setNodeMarkup(A.pos,h),!0)).command(()=>gw(s,h)).command(()=>yw(s,h)).run()}return!n||!C||!a?l().command(()=>u().wrapInList(h,r)?!0:c.clearNodes()).wrapInList(h,r).command(()=>gw(s,h)).command(()=>yw(s,h)).run():l().command(()=>{const E=u().wrapInList(h,r),P=C.filter(S=>f.includes(S.type.name));return s.ensureMarks(P),E?!0:c.clearNodes()}).wrapInList(h,r).command(()=>gw(s,h)).command(()=>yw(s,h)).run()},sne=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=ga(t,r.schema);return x1(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},one=(t,e,n={})=>({state:r,commands:i})=>{const s=qn(t,r.schema),o=qn(e,r.schema),a=Ml(r,s,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...n})},ane=(t,e={})=>({state:n,commands:r})=>{const i=qn(t,n.schema);return Ml(n,i,e)?r.lift(i):r.wrapIn(i,e)},lne=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},cne=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},une=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=ga(t,r.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:f,to:h}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=Jx(c,l,p);m&&(f=m.from,h=m.to),n.removeMark(f,h,l)}else d.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,l)});return n.removeStoredMark(l),!0},dne=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=F0(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=qn(t,r.schema)),a==="mark"&&(o=ga(t,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let d,f,h,p;n.selection.empty?r.doc.nodesBetween(c,u,(m,g)=>{s&&s===m.type&&(h=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,f=m)}):r.doc.nodesBetween(c,u,(m,g)=>{g<c&&s&&s===m.type&&(h=Math.max(g,c),p=Math.min(g+m.nodeSize,u),d=g,f=m),g>=c&&g<=u&&(s&&s===m.type&&n.setNodeMarkup(g,void 0,{...m.attrs,...e}),o&&m.marks.length&&m.marks.forEach(y=>{if(o===y.type){const w=Math.max(g,c),k=Math.min(g+m.nodeSize,u);n.addMark(w,k,o.create({...y.attrs,...e}))}}))}),f&&(d!==void 0&&n.setNodeMarkup(d,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(m=>{o===m.type&&n.addMark(h,p,o.create({...m.attrs,...e}))}))}),!0):!1},fne=(t,e={})=>({state:n,dispatch:r})=>{const i=qn(t,n.schema);return KY(i,e)(n,r)},hne=(t,e={})=>({state:n,dispatch:r})=>{const i=qn(t,n.schema);return GY(i,e)(n,r)},pne=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(r=>r.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(r=>r!==e):delete this.callbacks[t]),this}once(t,e){const n=(...r)=>{this.off(t,n),e.apply(this,r)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},H0=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},mne=(t,e)=>{if(Yx(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function kp(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const d=Wte(c)+s;return o.forEach(f=>{if(u)return;const h=mne(d,f.find);if(!h)return;const p=l.state.tr,m=D0({state:l.state,transaction:p}),g={from:r-(h[0].length-s.length),to:i},{commands:y,chain:w,can:k}=new B0({editor:n,state:m});f.handler({state:m,range:g,match:h,commands:y,chain:w,can:k})===null||!p.steps.length||(f.undoable&&p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function gne(t){const{editor:e,rules:n}=t,r=new Qt({state:{init(){return null},apply(i,s,o){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=nS(Ae.from(u),o.schema);const{from:d}=l,f=d+u.length;kp({editor:e,from:d,to:f,text:u,rules:n,plugin:r})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return kp({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&kp({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?kp({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function yne(t){return Object.prototype.toString.call(t).slice(8,-1)}function Tp(t){return yne(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function zO(t,e){const n={...t};return Tp(t)&&Tp(e)&&Object.keys(e).forEach(r=>{Tp(e[r])&&Tp(t[r])?n[r]=zO(t[r],e[r]):n[r]=e[r]}),n}var oS=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...Jt(ct(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Jt(ct(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>zO(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Wc=class UO extends oS{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new UO(n)}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===n.name))return!1;const l=o.find(c=>c?.type.name===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function bne(t){return typeof t=="number"}var wne=class{constructor(t){this.find=t.find,this.handler=t.handler}},vne=(t,e,n)=>{if(Yx(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(i=>{const s=[i.text];return s.index=i.index,s.input=t,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function xne(t){const{editor:e,state:n,from:r,to:i,rule:s,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new B0({editor:e,state:n}),d=[];return n.doc.nodesBetween(r,i,(h,p)=>{var m,g,y,w,k;if((g=(m=h.type)==null?void 0:m.spec)!=null&&g.code||!(h.isText||h.isTextblock||h.isInline))return;const C=(k=(w=(y=h.content)==null?void 0:y.size)!=null?w:h.nodeSize)!=null?k:0,A=Math.max(r,p),E=Math.min(i,p+C);if(A>=E)return;const P=h.isText?h.text||"":h.textBetween(A-p,E-p,void 0,"ï¿¼");vne(P,s.find,o).forEach(x=>{if(x.index===void 0)return;const _=A+x.index+1,I=_+x[0].length,D={from:n.tr.mapping.map(_),to:n.tr.mapping.map(I)},B=s.handler({state:n,range:D,match:x,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(B)})}),d.every(h=>h!==null)}var _p=null,Sne=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function Ene(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:f,rule:h,pasteEvt:p})=>{const m=u.tr,g=D0({state:u,transaction:m});if(!(!xne({editor:e,state:g,from:Math.max(d-1,0),to:f.b-1,rule:h,pasteEvent:p,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return n.map(u=>new Qt({view(d){const f=p=>{var m;r=(m=d.dom.parentElement)!=null&&m.contains(p.target)?d.dom.parentElement:null,r&&(_p=e)},h=()=>{_p&&(_p=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",h),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",h)}}},props:{handleDOMEvents:{drop:(d,f)=>{if(s=r===d.dom.parentElement,a=f,!s){const h=_p;h?.isEditable&&setTimeout(()=>{const p=h.state.selection;p&&h.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,f)=>{var h;const p=(h=f.clipboardData)==null?void 0:h.getData("text/html");return o=f,i=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(d,f,h)=>{const p=d[0],m=p.getMeta("uiEvent")==="paste"&&!i,g=p.getMeta("uiEvent")==="drop"&&!s,y=p.getMeta("applyPasteRules"),w=!!y;if(!m&&!g&&!w)return;if(w){let{text:A}=y;typeof A=="string"?A=A:A=nS(Ae.from(A),h.schema);const{from:E}=y,P=E+A.length,S=Sne(A);return l({rule:u,state:h,from:E,to:{b:P},pasteEvt:S})}const k=f.doc.content.findDiffStart(h.doc.content),C=f.doc.content.findDiffEnd(h.doc.content);if(!(!bne(k)||!C||k===C.b))return l({rule:u,state:h,from:k,to:C,pasteEvt:o})}}))}var V0=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=LO(t),this.schema=$te(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:mw(e.name,this.schema)},r=ct(e,"addCommands",n);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this;return rS([...this.extensions].reverse()).flatMap(r=>{const i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:mw(r.name,this.schema)},s=[],o=ct(r,"addKeyboardShortcuts",i);let a={};if(r.type==="mark"&&ct(r,"exitable",i)&&(a.ArrowRight=()=>Wc.handleExit({editor:t,mark:r})),o){const f=Object.fromEntries(Object.entries(o()).map(([h,p])=>[h,()=>p({editor:t})]));a={...a,...f}}const l=Hee(a);s.push(l);const c=ct(r,"addInputRules",i);if(AC(r,t.options.enableInputRules)&&c){const f=c();if(f&&f.length){const h=gne({editor:t,rules:f}),p=Array.isArray(h)?h:[h];s.push(...p)}}const u=ct(r,"addPasteRules",i);if(AC(r,t.options.enablePasteRules)&&u){const f=u();if(f&&f.length){const h=Ene({editor:t,rules:f});s.push(...h)}}const d=ct(r,"addProseMirrorPlugins",i);if(d){const f=d();s.push(...f)}return s})}get attributes(){return RO(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=dh(this.extensions);return Object.fromEntries(e.filter(n=>!!ct(n,"addNodeView")).map(n=>{const r=this.attributes.filter(l=>l.type===n.name),i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:qn(n.name,this.schema)},s=ct(n,"addNodeView",i);if(!s)return[];const o=s();if(!o)return[];const a=(l,c,u,d,f)=>{const h=fh(l,r);return o({node:l,view:c,getPos:u,decorations:d,innerDecorations:f,editor:t,extension:n,HTMLAttributes:h})};return[n.name,a]}))}get markViews(){const{editor:t}=this,{markExtensions:e}=dh(this.extensions);return Object.fromEntries(e.filter(n=>!!ct(n,"addMarkView")).map(n=>{const r=this.attributes.filter(a=>a.type===n.name),i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:ga(n.name,this.schema)},s=ct(n,"addMarkView",i);if(!s)return[];const o=(a,l,c)=>{const u=fh(a,r);return s()({mark:a,view:l,inline:c,editor:t,extension:n,HTMLAttributes:u,updateAttributes:d=>{$ne(a,t,d)}})};return[n.name,o]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:mw(e.name,this.schema)};e.type==="mark"&&((n=Jt(ct(e,"keepOnSplit",r)))==null||n)&&this.splittableMarks.push(e.name);const i=ct(e,"onBeforeCreate",r),s=ct(e,"onCreate",r),o=ct(e,"onUpdate",r),a=ct(e,"onSelectionUpdate",r),l=ct(e,"onTransaction",r),c=ct(e,"onFocus",r),u=ct(e,"onBlur",r),d=ct(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};V0.resolve=LO;V0.sort=rS;V0.flatten=tS;var kne={};Xx(kne,{ClipboardTextSerializer:()=>VO,Commands:()=>jO,Delete:()=>WO,Drop:()=>qO,Editable:()=>KO,FocusEvents:()=>ZO,Keymap:()=>QO,Paste:()=>XO,Tabindex:()=>YO,focusEventsPluginKey:()=>GO});var an=class HO extends oS{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new HO(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},VO=an.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Qt({key:new on("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=BO(n);return DO(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),jO=an.create({name:"commands",addCommands(){return{...kO}}}),WO=an.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=eS(t.before,[t,...e]);iS(u).forEach(h=>{u.mapping.mapResult(h.oldRange.from).deletedAfter&&u.mapping.mapResult(h.oldRange.to).deletedBefore&&u.before.nodesBetween(h.oldRange.from,h.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=h.oldRange.from<=m&&g<=h.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:h.oldRange,newRange:h.newRange,partial:!y,editor:this.editor,transaction:t,combinedTransform:u})})});const f=u.mapping;u.steps.forEach((h,p)=>{var m,g;if(h instanceof Ss){const y=f.slice(p).map(h.from,-1),w=f.slice(p).map(h.to),k=f.invert().map(y,-1),C=f.invert().map(w),A=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(P=>P.eq(h.mark)),E=(g=u.doc.nodeAt(w))==null?void 0:g.marks.some(P=>P.eq(h.mark));this.editor.emit("delete",{type:"mark",mark:h.mark,from:h.from,to:h.to,deletedRange:{from:k,to:C},newRange:{from:y,to:w},partial:!!(E||A),editor:this.editor,transaction:t,combinedTransform:u})}})};(i=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||i?setTimeout(s,0):s()}}),qO=an.create({name:"drop",addProseMirrorPlugins(){return[new Qt({key:new on("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),KO=an.create({name:"editable",addProseMirrorPlugins(){return[new Qt({key:new on("editable"),props:{editable:()=>this.editor.options.editable}})]}}),GO=new on("focusEvents"),ZO=an.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Qt({key:GO,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),QO=an.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:f,parent:h}=d,p=d.parent.isTextblock&&f>0?a.doc.resolve(f-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Tt.atStart(c).from===f;return!u||!h.type.isTextblock||h.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return $0()||PO()?s:i},addProseMirrorPlugins(){return[new Qt({key:new on("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(m=>m.getMeta("composition")))return;const r=t.some(m=>m.docChanged)&&!e.doc.eq(n.doc),i=t.some(m=>m.getMeta("preventClearDocument"));if(!r||i)return;const{empty:s,from:o,to:a}=e.selection,l=Tt.atStart(e.doc).from,c=Tt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!U0(n.doc))return;const f=n.tr,h=D0({state:n,transaction:f}),{commands:p}=new B0({editor:this.editor,state:h});if(p.clearNodes(),!!f.steps.length)return f}})]}}),XO=an.create({name:"paste",addProseMirrorPlugins(){return[new Qt({key:new on("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),YO=an.create({name:"tabindex",addProseMirrorPlugins(){return[new Qt({key:new on("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),Tne=class gu{constructor(e,n,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You canât set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new gu(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new gu(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new gu(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const i=n.isBlock&&!n.isTextblock,s=n.isAtom&&!n.isText,o=this.pos+r+(s?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new gu(a,this.editor,i,i?n:null);i&&(l.actualDepth=this.depth+1),e.push(new gu(a,this.editor,i,i?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(n).length>0){const s=i.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==n[l])break}}else r=i;i=i.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(n);return this.children.forEach(o=>{r&&i.length>0||(o.node.type.name===e&&s.every(l=>n[l]===o.node.attrs[l])&&i.push(o),!(r&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,n,r))))}),i}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},_ne=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function Cne(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var Ane=class extends pne{constructor(e={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:i})=>{throw i},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:i,slice:s,moved:o})=>this.options.onDrop(i,s,o)),this.on("paste",({event:i,slice:s})=>this.options.onPaste(i,s)),this.on("delete",this.options.onDelete);const n=this.createDoc(),r=CO(n,this.options.autofocus);this.editorState=_u.create({doc:n,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(e){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(e),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const e=this.editorView.dom;e?.editor&&delete e.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(e){console.warn("Failed to remove CSS element:",e)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=Cne(_ne,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:e=>{this.editorState=e},dispatch:e=>{this.dispatchTransaction(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(e,n)=>{if(this.editorView)return this.editorView[n];if(n==="state")return this.editorState;if(n in e)return Reflect.get(e,n);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${n}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(e,n){const r=NO(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,n;const i=[...this.options.enableCoreExtensions?[KO,VO.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)==null?void 0:e.clipboardTextSerializer)==null?void 0:n.blockSeparator}),jO,ZO,QO,YO,qO,XO,WO].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s?.type));this.extensionManager=new V0(i,this)}createCommandManager(){this.commandManager=new B0({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let e;try{e=v1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(n){if(!(n instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(n.message))throw n;this.emit("contentError",{editor:this,error:n,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),e=v1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return e}createView(e){var n;this.editorView=new SO(e,{...this.options.editorProps,attributes:{role:"textbox",...(n=this.options.editorProps)==null?void 0:n.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.prependClass(),this.injectCSS();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(u=>{var d;return(d=this.capturedTransaction)==null?void 0:d.step(u)});return}const{state:n,transactions:r}=this.state.applyTransaction(e),i=!this.state.selection.eq(n.selection),s=r.includes(e),o=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),!s)return;this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e,appendedTransactions:r.slice(1)}),i&&this.emit("selectionUpdate",{editor:this,transaction:e});const a=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),l=a?.getMeta("focus"),c=a?.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:a}),c&&this.emit("blur",{editor:this,event:c.event,transaction:a}),!(e.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||o.doc.eq(n.doc))&&this.emit("update",{editor:this,transaction:e,appendedTransactions:r.slice(1)})}getAttributes(e){return $O(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return qte(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return nS(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return zte(this.state.doc,{blockSeparator:n,textSerializers:{...BO(this.schema),...r}})}get isEmpty(){return U0(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var e,n;return(n=(e=this.editorView)==null?void 0:e.isDestroyed)!=null?n:!0}$node(e,n){var r;return((r=this.$doc)==null?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new Tne(n,this)}get $doc(){return this.$pos(0)}};function dd(t){return new H0({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Jt(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(sS(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(m=>m===t.type&&m!==h.mark.type)).filter(h=>h.to>c).length)return null;u<n.to&&s.delete(u,n.to),c>n.from&&s.delete(n.from+l,c);const f=n.from+l+o.length;s.addMark(n.from+l,f,t.type.create(i||{})),s.removeStoredMark(t.type)}},undoable:t.undoable})}function JO(t){return new H0({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Jt(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;const l=t.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const d=r[0][r[0].length-1];s.insertText(d,o+r[0].length-1),s.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;s.insert(c,t.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()},undoable:t.undoable})}function S1(t){return new H0({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=Jt(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)},undoable:t.undoable})}function fd(t){return new H0({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const s=Jt(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&Lx(l,t.type,s);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:f}=e,{splittableMarks:h}=t.editor.extensionManager,p=f||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(g=>h.includes(g.type.name));o.ensureMarks(m)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(d,s).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&zl(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)},undoable:t.undoable})}var Ine=t=>"touches"in t,Pne=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.handleMouseMove=o=>{if(!this.isResizing||!this.activeHandle)return;const a=o.clientX-this.startX,l=o.clientY-this.startY;this.handleResize(a,l)},this.handleTouchMove=o=>{if(!this.isResizing||!this.activeHandle)return;const a=o.touches[0];if(!a)return;const l=a.clientX-this.startX,c=a.clientY-this.startY;this.handleResize(l,c)},this.handleMouseUp=()=>{if(!this.isResizing)return;const o=this.element.offsetWidth,a=this.element.offsetHeight;this.onCommit(o,a),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=o=>{o.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=o=>{o.key==="Shift"&&(this.isShiftKeyPressed=!1)};var e,n,r,i,s;this.node=t.node,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(e=t.options)!=null&&e.min&&(this.minSize={...this.minSize,...t.options.min}),(n=t.options)!=null&&n.max&&(this.maxSize=t.options.max),(r=t?.options)!=null&&r.directions&&(this.directions=t.options.directions),(i=t.options)!=null&&i.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(s=t.options)!=null&&s.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles()}get dom(){return this.container}get contentDOM(){return this.contentElement}update(t,e,n){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,e,n):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",t.style.justifyContent="flex-start",t.style.alignItems="flex-start",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const e=document.createElement("div");return e.dataset.resizeHandle=t,e.style.position="absolute",this.classNames.handle&&(e.className=this.classNames.handle),e}positionHandle(t,e){const n=e.includes("top"),r=e.includes("bottom"),i=e.includes("left"),s=e.includes("right");n&&(t.style.top="0"),r&&(t.style.bottom="0"),i&&(t.style.left="0"),s&&(t.style.right="0"),(e==="top"||e==="bottom")&&(t.style.left="0",t.style.right="0"),(e==="left"||e==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{const e=this.createHandle(t);this.positionHandle(e,t),e.addEventListener("mousedown",n=>this.handleResizeStart(n,t)),e.addEventListener("touchstart",n=>this.handleResizeStart(n,t)),this.wrapper.appendChild(e)})}applyInitialSize(){const t=this.node.attrs.width,e=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,e?(this.element.style.height=`${e}px`,this.initialHeight=e):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=e,Ine(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,e){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:r,height:i}=this.calculateNewDimensions(this.activeHandle,t,e),s=this.applyConstraints(r,i,n);this.element.style.width=`${s.width}px`,this.element.style.height=`${s.height}px`,this.onResize&&this.onResize(s.width,s.height)}calculateNewDimensions(t,e,n){let r=this.startWidth,i=this.startHeight;const s=t.includes("right"),o=t.includes("left"),a=t.includes("bottom"),l=t.includes("top");return s?r=this.startWidth+e:o&&(r=this.startWidth-e),a?i=this.startHeight+n:l&&(i=this.startHeight-n),(t==="right"||t==="left")&&(r=this.startWidth+(s?e:-e)),(t==="top"||t==="bottom")&&(i=this.startHeight+(a?n:-n)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(r,i,t):{width:r,height:i}}applyConstraints(t,e,n){var r,i,s,o;if(!n){let c=Math.max(this.minSize.width,t),u=Math.max(this.minSize.height,e);return(r=this.maxSize)!=null&&r.width&&(c=Math.min(this.maxSize.width,c)),(i=this.maxSize)!=null&&i.height&&(u=Math.min(this.maxSize.height,u)),{width:c,height:u}}let a=t,l=e;return a<this.minSize.width&&(a=this.minSize.width,l=a/this.aspectRatio),l<this.minSize.height&&(l=this.minSize.height,a=l*this.aspectRatio),(s=this.maxSize)!=null&&s.width&&a>this.maxSize.width&&(a=this.maxSize.width,l=a/this.aspectRatio),(o=this.maxSize)!=null&&o.height&&l>this.maxSize.height&&(l=this.maxSize.height,a=l*this.aspectRatio),{width:a,height:l}}applyAspectRatio(t,e,n){const r=n==="left"||n==="right",i=n==="top"||n==="bottom";return r?{width:t,height:t/this.aspectRatio}:i?{width:e*this.aspectRatio,height:e}:{width:t,height:t/this.aspectRatio}}};function Mne(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof rt){const s=r.index();return r.parent.canReplaceWith(s,s+1,e)}let i=r.depth;for(;i>=0;){const s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}var One={};Xx(One,{createAtomBlockMarkdownSpec:()=>Nne,createBlockMarkdownSpec:()=>Rne,createInlineMarkdownSpec:()=>Bne,parseAttributes:()=>aS,parseIndentedBlocks:()=>E1,renderNestedMarkdownContent:()=>cS,serializeAttributes:()=>lS});function aS(t){if(!t?.trim())return{};const e={},n=[],r=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),i=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(o)).forEach(([,c,u])=>{var d;const f=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),h=n[f];h&&(e[c]=h.slice(1,-1))});const l=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function lS(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?e.push(n):r!==!1&&r!=null&&e.push(`${n}="${String(r)}"`))}),e.join(" ")}function Nne(t){const{nodeName:e,name:n,parseAttributes:r=aS,serializeAttributes:i=lS,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=t,l=n||e,c=u=>{if(!a)return u;const d={};return a.forEach(f=>{f in u&&(d[f]=u[f])}),d};return{parseMarkdown:(u,d)=>{const f={...s,...u.attributes};return d.createNode(e,f,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const f=new RegExp(`^:::${l}(?:\\s|$)`,"m"),h=(d=u.match(f))==null?void 0:d.index;return h!==void 0?h:-1},tokenize(u,d,f){const h=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(h);if(!p)return;const m=p[1]||"",g=r(m);if(!o.find(w=>!(w in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),f=i(d),h=f?` {${f}}`:"";return`:::${l}${h} :::`}}}function Rne(t){const{nodeName:e,name:n,getContent:r,parseAttributes:i=aS,serializeAttributes:s=lS,defaultAttributes:o={},content:a="block",allowedAttributes:l}=t,c=n||e,u=d=>{if(!l)return d;const f={};return l.forEach(h=>{h in d&&(f[h]=d[h])}),f};return{parseMarkdown:(d,f)=>{let h;if(r){const m=r(d);h=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?h=f.parseChildren(d.tokens||[]):h=f.parseInline(d.tokens||[]);const p={...o,...d.attributes};return f.createNode(e,p,h)},markdownTokenizer:{name:e,level:"block",start(d){var f;const h=new RegExp(`^:::${c}`,"m"),p=(f=d.match(h))==null?void 0:f.index;return p!==void 0?p:-1},tokenize(d,f,h){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,w=""]=g,k=i(w);let C=1;const A=y.length;let E="";const P=/^:::([\w-]*)(\s.*)?/gm,S=d.slice(A);for(P.lastIndex=0;;){const x=P.exec(S);if(x===null)break;const _=x.index,I=x[1];if(!((p=x[2])!=null&&p.endsWith(":::"))){if(I)C+=1;else if(C-=1,C===0){const D=S.slice(0,_);E=D.trim();const B=d.slice(0,A+_+x[0].length);let F=[];if(E)if(a==="block")for(F=h.blockTokens(D),F.forEach(R=>{R.text&&(!R.tokens||R.tokens.length===0)&&(R.tokens=h.inlineTokens(R.text))});F.length>0;){const R=F[F.length-1];if(R.type==="paragraph"&&(!R.text||R.text.trim()===""))F.pop();else break}else F=h.inlineTokens(E);return{type:e,raw:B,attributes:k,content:E,tokens:F}}}}}},renderMarkdown:(d,f)=>{const h=u(d.attrs||{}),p=s(h),m=p?` {${p}}`:"",g=f.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function Lne(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(t);for(;r!==null;){const[,i,s,o]=r;e[i]=s||o,r=n.exec(t)}return e}function Dne(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function Bne(t){const{nodeName:e,name:n,getContent:r,parseAttributes:i=Lne,serializeAttributes:s=Dne,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=t,c=n||e,u=f=>{if(!l)return f;const h={};return l.forEach(p=>{p in f&&(h[p]=f[p])}),h},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(f,h)=>{const p={...o,...f.attributes};if(a)return h.createNode(e,p);const m=r?r(f):f.content||"";return m?h.createNode(e,p,[h.createTextNode(m)]):h.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(f){const h=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=f.match(h),m=p?.index;return m!==void 0?m:-1},tokenize(f,h,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=f.match(m);if(!g)return;let y="",w="";if(a){const[,C]=g;w=C}else{const[,C,A]=g;w=C,y=A||""}const k=i(w.trim());return{type:e,raw:g[0],content:y.trim(),attributes:k}}},renderMarkdown:f=>{let h="";r?h=r(f):f.content&&f.content.length>0&&(h=f.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(f.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${h}[/${c}]`}}}function E1(t,e,n){var r,i,s,o;const a=t.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const f=a[u],h=f.match(e.itemPattern);if(!h){if(l.length>0)break;if(f.trim()===""){u+=1;continue}else return}const p=e.extractItemData(h),{indentLevel:m,mainContent:g}=p;c=`${c}${f}
`;const y=[g];for(u+=1;u<a.length;){const A=a[u];if(A.trim()===""){const P=a.slice(u+1).findIndex(_=>_.trim()!=="");if(P===-1)break;if((((i=(r=a[u+1+P].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:i.length)||0)>m){y.push(A),c=`${c}${A}
`,u+=1;continue}else break}if((((o=(s=A.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(A),c=`${c}${A}
`,u+=1;else break}let w;const k=y.slice(1);if(k.length>0){const A=k.map(E=>E.slice(m+d)).join(`
`);A.trim()&&(e.customNestedParser?w=e.customNestedParser(A):w=n.blockTokens(A))}const C=e.createToken(p,w);l.push(C)}if(l.length!==0)return{items:l,raw:c.trim()}}function cS(t,e,n,r){if(!t||!Array.isArray(t.content))return"";const i=typeof n=="function"?n(r):n,[s,...o]=t.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(f=>f?e.indent(f):"").join(`
`);l.push(d)}}),l.join(`
`)}function $ne(t,e,n={}){const{state:r}=e,{doc:i,tr:s}=r,o=t;i.descendants((a,l)=>{const c=s.mapping.map(l),u=s.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(h=>{if(h!==o)return!1;d=h}),!d)return;let f=!1;if(Object.keys(n).forEach(h=>{n[h]!==d.attrs[h]&&(f=!0)}),f){const h=t.type.create({...t.attrs,...n});s.removeMark(c,u,t.type),s.addMark(c,u,h)}}),s.docChanged&&e.view.dispatch(s)}var ei=class eN extends oS{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new eN(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},Fne=class{constructor(t,e,n){this.isDragging=!1,this.component=t,this.editor=e.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=e.extension,this.node=e.node,this.decorations=e.decorations,this.innerDecorations=e.innerDecorations,this.view=e.view,this.HTMLAttributes=e.HTMLAttributes,this.getPos=e.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(t){var e,n,r,i,s,o,a;const{view:l}=this.editor,c=t.target,u=c.nodeType===3?(e=c.parentElement)==null?void 0:e.closest("[data-drag-handle]"):c.closest("[data-drag-handle]");if(!this.dom||(n=this.contentDOM)!=null&&n.contains(c)||!u)return;let d=0,f=0;if(this.dom!==u){const w=this.dom.getBoundingClientRect(),k=u.getBoundingClientRect(),C=(i=t.offsetX)!=null?i:(r=t.nativeEvent)==null?void 0:r.offsetX,A=(o=t.offsetY)!=null?o:(s=t.nativeEvent)==null?void 0:s.offsetY;d=k.x-w.x+C,f=k.y-w.y+A}const h=this.dom.cloneNode(!0);try{const w=this.dom.getBoundingClientRect();h.style.width=`${Math.round(w.width)}px`,h.style.height=`${Math.round(w.height)}px`,h.style.boxSizing="border-box",h.style.pointerEvents="none"}catch{}let p=null;try{p=document.createElement("div"),p.style.position="absolute",p.style.top="-9999px",p.style.left="-9999px",p.style.pointerEvents="none",p.appendChild(h),document.body.appendChild(p),(a=t.dataTransfer)==null||a.setDragImage(h,d,f)}finally{p&&setTimeout(()=>{try{p?.remove()}catch{}},0)}const m=this.getPos();if(typeof m!="number")return;const g=rt.create(l.state.doc,m),y=l.state.tr.setSelection(g);l.dispatch(y)}stopEvent(t){var e;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:t});const n=t.target;if(!(this.dom.contains(n)&&!((e=this.contentDOM)!=null&&e.contains(n))))return!1;const i=t.type.startsWith("drag"),s=t.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable)&&!s&&!i)return!0;const{isEditable:a}=this.editor,{isDragging:l}=this,c=!!this.node.type.spec.draggable,u=rt.isSelectable(this.node),d=t.type==="copy",f=t.type==="paste",h=t.type==="cut",p=t.type==="mousedown";if(!c&&u&&i&&t.target===this.dom&&t.preventDefault(),c&&i&&!l&&t.target===this.dom)return t.preventDefault(),!1;if(c&&a&&!l&&p){const m=n.closest("[data-drag-handle]");m&&(this.dom===m||this.dom.contains(m))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(l||s||d||f||h||p&&u)}ignoreMutation(t){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:t}):this.node.isLeaf||this.node.isAtom?!0:t.type==="selection"||this.dom.contains(t.target)&&t.type==="childList"&&($0()||AO())&&this.editor.isFocused&&[...Array.from(t.addedNodes),...Array.from(t.removedNodes)].every(n=>n.isContentEditable)?!1:this.contentDOM===t.target&&t.type==="attributes"?!0:!this.contentDOM.contains(t.target)}updateAttributes(t){this.editor.commands.command(({tr:e})=>{const n=this.getPos();return typeof n!="number"?!1:(e.setNodeMarkup(n,void 0,{...this.node.attrs,...t}),!0)})}deleteNode(){const t=this.getPos();if(typeof t!="number")return;const e=t+this.node.nodeSize;this.editor.commands.deleteRange({from:t,to:e})}};function Dc(t){return new wne({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:i})=>{const s=Jt(t.getAttributes,void 0,r,i);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),f=d+a.length;if(sS(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===t.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;f<n.to&&o.delete(f,n.to),d>n.from&&o.delete(n.from+u,d),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}class zne extends Ane{contentElement=null}const Une=t=>{const e=new zne(t);return $I(e,n=>(e.on("transaction",()=>{n(e)}),()=>{e.destroy()}))};class Hne{component;props;dom;constructor(e,{element:n,props:r}){this.component=e,this.props=r,this.dom=n,this.dom.classList.add("svelte-renderer")}updateProps(e){Object.assign(this.props,e)}updateAttributes(e){Object.keys(e).forEach(n=>{this.dom.setAttribute(n,e[n])})}destroy(){d$(this.component)}}const tN="TipTapNodeView",Vne=(t,e)=>{if(!t)throw new Error(e)};class jne extends Map{#e=new Map;#t=Ee(0);#n=Ee(0);#s=Qo||-1;constructor(e){if(super(),e){for(var[n,r]of e)super.set(n,r);this.#n.v=super.size}}#r(e){return Qo===this.#s?Ee(e):Ku(e)}has(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#r(0),n.set(e,r);else return M(this.#t),!1}return M(r),!0}forEach(e,n){this.#o(),super.forEach(e,n)}get(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#r(0),n.set(e,r);else{M(this.#t);return}}return M(r),super.get(e)}set(e,n){var r=this.#e,i=r.get(e),s=super.get(e),o=super.set(e,n),a=this.#t;if(i===void 0)i=this.#r(0),r.set(e,i),se(this.#n,super.size),Za(a);else if(s!==n){Za(i);var l=a.reactions===null?null:new Set(a.reactions),c=l===null||!i.reactions?.every(u=>l.has(u));c&&Za(a)}return o}delete(e){var n=this.#e,r=n.get(e),i=super.delete(e);return r!==void 0&&(n.delete(e),se(this.#n,super.size),se(r,-1),Za(this.#t)),i}clear(){if(super.size!==0){super.clear();var e=this.#e;se(this.#n,0);for(var n of e.values())se(n,-1);Za(this.#t),e.clear()}}#o(){M(this.#t);var e=this.#e;if(this.#n.v!==e.size){for(var n of super.keys())if(!e.has(n)){var r=this.#r(0);e.set(n,r)}}for([,r]of this.#e)M(r)}keys(){return M(this.#t),super.keys()}values(){return this.#o(),super.values()}entries(){return this.#o(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return M(this.#n),super.size}}class Wne extends Fne{mount(){const e=this.component,n=At({editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(a={})=>this.updateAttributes(a),deleteNode:()=>this.deleteNode()});this.contentDOMElement=this.node.isLeaf?null:document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");const r=this.options.context||new jne;r.set(tN,{onDragStart:this.onDragStart.bind(this)});const i=this.options.as??(this.node.isInline?"span":"div"),s=document.createElement(i);s.classList.add(`node-${this.node.type.name}`),this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate);const o=AI(e,{target:s,props:n,context:r});this.renderer=new Hne(o,{element:s,props:n}),this.appendContendDom(),this.updateElementAttributes()}appendContendDom(){const e=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&e&&!e.contains(this.contentDOMElement)&&e.appendChild(this.contentDOMElement)}get dom(){return Vne(this.renderer.dom.firstElementChild?.hasAttribute("data-node-view-wrapper"),"Please use the NodeViewWrapper component for your node view."),this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection,r=this.getPos();if(typeof r=="number")if(e<=r&&n>=r+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n,r){const i=s=>{this.renderer.updateProps(s),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(typeof this.options.update=="function"){const s=this.node,o=this.decorations,a=this.innerDecorations;return this.node=e,this.decorations=n,this.innerDecorations=r,this.options.update({oldNode:s,oldDecorations:o,oldInnerDecorations:a,newNode:e,newDecorations:n,newInnerDecorations:r,updateProps:()=>i({node:e,decorations:n,innerDecorations:r})})}return e.type!==this.node.type?!1:(e===this.node&&this.decorations===n&&this.innerDecorations===r||(this.node=e,this.decorations=n,this.innerDecorations=r,i({node:e,decorations:n,innerDecorations:r})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.dom.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.dom.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const n=this.editor.extensionManager.attributes,r=fh(this.node,n);e=this.options.attrs({node:this.node,HTMLAttributes:r})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}const nN=(t,e)=>n=>new Wne(t,n,e);var qne=Ve("<div></div> <!>",1);function Kne(t,e){Mn(e,!0);const n=ht(e,"editor",7);let r;ls(async()=>{await Tl(),r&&n()?.options.element&&(n().contentElement||(r.append(...Array.from(n().options.element?.childNodes||[])),n().setOptions({element:r}),n().contentElement=r))}),Tc(()=>{if(!n()||(n().contentElement=null,!n().options.element?.firstChild))return;const c=document.createElement("div");c.append(...Array.from(n().options.element?.childNodes||[])),n().setOptions({element:c})});var s=qne(),o=Et(s);Xn(o,c=>r=c,()=>r);var a=Le(o,2);{var l=c=>{var u=en(),d=Et(u);kc(d,()=>e.children),we(c,u)};Ye(a,c=>{e.children&&c(l)})}Ge(()=>rs(o,1,OI(e.class))),we(t,s),On()}function rN(t,e){Mn(e,!0);const n=ht(e,"as",3,"div"),r=A$(e,["$$slots","$$events","$$legacy","as","children"]),{onDragStart:i}=AB(tN);let s;ls(async()=>{await Tl(),s.style.whiteSpace="normal"});var o=en(),a=Et(o);p$(a,n,!1,(l,c)=>{Xn(l,h=>s=h,()=>s),DI(l,()=>({"data-node-view-wrapper":"",role:"none",...r,ondragstart:i}));var u=en(),d=Et(u);{var f=h=>{var p=en(),m=Et(p);kc(m,()=>e.children),we(h,p)};Ye(d,h=>{e.children&&h(f)})}we(c,u)}),we(t,o),On()}class Lf{static isValidNsec(e){return cX(e)}static derivePublicKey(e){return fX(e)}static pubkeyToNpub(e){try{return e?GM(e):""}catch(n){return console.error("pubkeyããnpubã¸ã®å¤æã¨ã©ã¼:",n),""}}}class Gne{constructor(e,n,r){this.localStorage=e,this.console=n,this.secretKeyStore=r}saveToStorage(e){if(!e?.trim())return{success:!1,error:{type:"validation",message:"Key cannot be empty"}};try{const n=e.trim();return this.localStorage.setItem("nostr-secret-key",n),this.secretKeyStore.set(n),{success:!0}}catch(n){const r={type:"storage",message:"éµã®ä¿å­ã«å¤±æãã¾ãã",originalError:n};return this.console.error("éµã®ä¿å­ã«å¤±æ:",n),{success:!1,error:r}}}loadFromStorage(){let e=this.secretKeyStore.value;if(e)return e;try{return e=this.localStorage.getItem("nostr-secret-key"),e&&this.secretKeyStore.set(e),e}catch(n){return this.console.error("éµã®èª­ã¿è¾¼ã¿ã«å¤±æ:",n),null}}getFromStore(){return this.secretKeyStore.value}hasStoredKey(){try{return!!this.localStorage.getItem("nostr-secret-key")}catch(e){return this.console.error("ã¹ãã¬ã¼ã¸ã¢ã¯ã»ã¹ã¨ã©ã¼:",e),!1}}}class Zne{constructor(e){this.window=e}isWindowNostrAvailable(){return typeof this.window<"u"&&"nostr"in this.window&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}async getPublicKeyFromWindowNostr(){if(!this.isWindowNostrAvailable()||!this.window?.nostr)return{success:!1,error:{type:"validation",message:"window.nostr is not available"}};try{return{success:!0,pubkey:await this.window.nostr.getPublicKey()}}catch(e){const n={type:"network",message:"window.nostrããå¬ééµã®åå¾ã«å¤±æãã¾ãã",originalError:e};return console.error("window.nostrããå¬ééµã®åå¾ã«å¤±æ:",e),{success:!1,error:n}}}}class iN{constructor(e={}){this.deps=e,this._nsecStore.subscribe(n=>this.updateFromNsec(n))}_nsecStore=Qi("");_dataStore=Qi({hex:"",npub:"",nprofile:""});_isValidStore=Qi(!1);_isNostrLoginStore=Qi(!1);nsec={subscribe:this._nsecStore.subscribe};data={subscribe:this._dataStore.subscribe};isValid={subscribe:this._isValidStore.subscribe};isNostrLogin={subscribe:this._isNostrLoginStore.subscribe};hex=Xo(this._dataStore,e=>e.hex);npub=Xo(this._dataStore,e=>e.npub);nprofile=Xo(this._dataStore,e=>e.nprofile);setNsec(e){const n=e?.trim()||"";this._nsecStore.set(n),this._isNostrLoginStore.set(!1)}setNostrLoginAuth(e){if(e.type==="logout"){this.clear();return}if(!e.pubkey){console.warn("NostrLoginAuth: pubkey is required for login/signup");return}try{const n=e.npub||sa.npubEncode(e.pubkey),r=sa.nprofileEncode({pubkey:e.pubkey,relays:[]});let i;if(this.deps.localStorage&&typeof this.deps.localStorage.getItem=="function")try{const s=this.deps.localStorage.getItem("__nostrlogin_accounts");if(s){const o=JSON.parse(s);if(Array.isArray(o)){const a=o.find(l=>l?.pubkey===e.pubkey);if(a?.authMethod){const l=a.authMethod;(l==="connect"||l==="extension"||l==="local")&&(i=l)}}}}catch(s){console.warn("Failed to get authMethod from localStorage:",s)}this._dataStore.set({hex:e.pubkey,npub:n,nprofile:r}),this._isValidStore.set(!0),this._isNostrLoginStore.set(!0),this._nsecStore.set(""),this.deps.setNostrLoginAuthFn?this.deps.setNostrLoginAuthFn(e.pubkey,n,r,i):setTimeout(()=>{this.deps.setNostrLoginAuthFn&&this.deps.setNostrLoginAuthFn(e.pubkey,n,r,i)},10),console.log("[PublicKeyState] NostrLoginèªè¨¼ç¶æãè¨­å®:",{pubkey:e.pubkey,npub:n,type:e.type,authMethod:i})}catch(n){console.error("Failed to set NostrLogin auth:",n),this.clear()}}updateFromNsec(e){if(!e||!Lf.isValidNsec(e)){this._resetState();return}try{const n=Lf.derivePublicKey(e);n.hex?(this._dataStore.set(n),this._isValidStore.set(!0)):this._resetState()}catch(n){console.error("Failed to derive public key from nsec:",n),this._resetState()}}_resetState(){this._dataStore.set({hex:"",npub:"",nprofile:""}),this._isValidStore.set(!1)}clear(){this._nsecStore.set(""),this._isNostrLoginStore.set(!1),this.deps.clearAuthStateFn&&this.deps.clearAuthStateFn()}get currentIsValid(){return mc(this._isValidStore)}get currentHex(){return mc(this.hex)}get currentIsNostrLogin(){return mc(this._isNostrLoginStore)}}class sN{storage;externalAuth;constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.console||(typeof window<"u"?window.console:{}),i=e.secretKeyStore||{value:null,set:()=>{}},s=e.window||(typeof window<"u"?window:void 0);this.storage=new Gne(n,r,i),this.externalAuth=new Zne(s)}isValidNsec(e){return Lf.isValidNsec(e)}derivePublicKey(e){return Lf.derivePublicKey(e)}pubkeyToNpub(e){return Lf.pubkeyToNpub(e)}saveToStorage(e){return this.storage.saveToStorage(e)}loadFromStorage(){return this.storage.loadFromStorage()}getFromStore(){return this.storage.getFromStore()}hasStoredKey(){return this.storage.hasStoredKey()}isWindowNostrAvailable(){return this.externalAuth.isWindowNostrAvailable()}async getPublicKeyFromWindowNostr(){return await this.externalAuth.getPublicKeyFromWindowNostr()}getStorage(){return this.storage}getExternalAuth(){return this.externalAuth}}const k1=new sN;let oN=At({content:"",hashtags:[],tags:[]});const Ja=oN;function Qne(){return CB(oN)}At({});let nf=At({});const T1={get value(){return nf},set:t=>{Object.assign(nf,t)},update:t=>{const e=t(nf);Object.assign(nf,e)},subscribe:t=>(Ze(()=>{t(nf)}),()=>{})},MC=["client","eHagaki","31990:ec42c765418b3db9c85abff3a88f4a3bbe57535eebbdc54522041fa5328c0600:1754918316480","wss://relay.nostr.band"];function Xne(){try{const t=localStorage.getItem("clientTagEnabled");return(t===null?!0:t==="true")?[...MC]:null}catch{return[...MC]}}function Yne(t){return encodeURI(t.trim())}function Jne(t){return EZ.includes(t)}function ere(t){const e=t.toLowerCase();return kZ.some(n=>e.endsWith(n))}function tre(t){const e=t.toLowerCase();return TZ.some(n=>e.endsWith(n))}function aN(t){try{const e=Yne(t),n=new URL(e);return Jne(n.protocol)?n.href:null}catch{return null}}function lN(t){const e=aN(t);if(!e)return null;try{const n=new URL(e);return ere(n.pathname)?e:null}catch{return null}}function nre(t){const e=aN(t);if(!e)return null;try{const n=new URL(e);return tre(n.pathname)?e:null}catch{return null}}function cN(t){return t.replace(/\r\n/g,`
`).replace(/\r/g,`
`)}function rre(t){return!t||/[\s\n\u3000]/.test(t)}function ire(t){const e=/([.,;:!?ï¼ãããããã\]}>ï¼]){2,}$/,n=t.match(e);if(n){const r=n[0];return{cleanUrl:t.slice(0,-r.length),trailingChars:r}}return{cleanUrl:t,trailingChars:""}}function sre(t){const{cleanUrl:e}=ire(t);return{cleanUrl:e,actualLength:e.length}}function ore(t){if(t.childCount===1){const e=t.firstChild;return e?.type.name==="paragraph"&&e.content.size===0}return t.childCount===0}function are(t){return ore(t.doc)}function lre(t,e){return t.type.name==="paragraph"&&t.content.size===e&&t.textContent.trim().length===e}function cre(t){const e=[];return t.descendants(n=>{if(n.type.name==="paragraph"){const r=n.textContent;e.push(r)}else if(n.type.name==="image"){const r=n.attrs?.src;r&&e.push(r)}else if(n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}}),e}function ure(t){if(!t)return null;try{const e=typeof t=="function"?t():t;return e?.state?.doc??e?.view?.state?.doc??null}catch{return null}}function uN(t){const e=ure(t);return e?cre(e).join(`
`):""}function dre(t,e,n){if(t===e)return null;let r=t;if(n){const i=n.resolve(t);i.parent.type.name==="paragraph"&&(r=i.after())}return r<e?{insertPos:r,deleteStart:e+1,deleteEnd:e+2}:r>e+1?{insertPos:r-1,deleteStart:e,deleteEnd:e+1}:null}function fre(t,e,n){return n.insertPos<n.deleteStart?t.insert(n.insertPos,e).delete(n.deleteStart,n.deleteEnd):t.delete(n.deleteStart,n.deleteEnd).insert(n.insertPos,e)}function bw(t,e,n){const{tr:r,doc:i,schema:s}=t.state,o=e.pos,a=dre(n,o,i);if(!a)return!0;const l=s.nodes.image.create(e.attrs);try{const c=fre(r,l,a);return t.dispatch(c),!0}catch(c){return console.error("Error moving image:",c),!1}}function OC(t){t.dispatch(t.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null}))}function uS(t,e,n){if(!t)return;t.state.doc.descendants((i,s)=>{if(e(i,s))return n(i,s),!1})}function hre(t,e,n,r){t.update(i=>{const s={...i};return e&&delete s[e],s})}function ww(t,e,n,r,i=!1){n&&(hre(r,t),uS(n,(s,o)=>{const a=s.type?.name;return(e&&a==="video"||!e&&a==="image")&&(s.attrs?.src===t||s.attrs?.id===t)},(s,o)=>{const a=n.state.tr.delete(o,o+s.nodeSize);n.view.dispatch(a),i&&console.log("[uploadHelper] Deleted placeholder:",t)}))}function dN(t,e=!1){if(!t)return;const{state:n}=t,{doc:r}=n,i=n.tr;let s=0;const o=[];r.descendants((a,l)=>{const c=a.type?.name,u=a.attrs?.isPlaceholder===!0||a.attrs?.src?.startsWith("placeholder-")||a.attrs?.src?.startsWith("blob:");(c==="image"||c==="video")&&u&&o.push({pos:l,size:a.nodeSize})}),o.reverse().forEach(({pos:a,size:l})=>{i.delete(a,a+l),s++}),s>0&&(t.view.dispatch(i),e&&console.log(`[editorUtils] Deleted ${s} placeholder(s)`))}function _1(t){if(!t||!t.types)return!1;try{return Array.from(t.types).some(e=>e==="application/x-tiptap-node")}catch{return!1}}function fN(t){if(!t)return!1;try{return Array.from(t.types).includes("Files")||t.files&&t.files.length>0}catch{return!!(t.files&&t.files.length>0)}}function pre(t){let e=Ee(!1);function n(s){const o=s.dataTransfer,a=_1(o);fN(o)&&!a?(s.preventDefault(),M(e)||(se(e,!0),t.classList.add("drag-over"))):M(e)&&(se(e,!1),t.classList.remove("drag-over"))}function r(s){M(e)&&(se(e,!1),t.classList.remove("drag-over"))}async function i(s){se(e,!1),t.classList.remove("drag-over");const o=s.dataTransfer;_1(o)||o?.files&&o.files.length>0&&typeof t.__uploadFiles=="function"&&(s.preventDefault(),t.__uploadFiles(o.files))}return t.addEventListener("dragover",n),t.addEventListener("dragleave",r),t.addEventListener("drop",i),{destroy(){t.removeEventListener("dragover",n),t.removeEventListener("dragleave",r),t.removeEventListener("drop",i)}}}function mre(t,e){const n=pre(t);function r(o){const a=o.dataTransfer,l=_1(a);fN(a)&&!l?e.dragOver(!0):e.dragOver(!1)}function i(o){e.dragOver(!1)}function s(o){e.dragOver(!1)}return t.addEventListener("dragover",r),t.addEventListener("dragleave",i),t.addEventListener("drop",s),{destroy(){n?.destroy?.(),t.removeEventListener("dragover",r),t.removeEventListener("dragleave",i),t.removeEventListener("drop",s)}}}function gre(t){function e(n){if(!n.clipboardData)return;const r=[];for(const i of n.clipboardData.items)if(i.kind==="file"&&i.type.startsWith("image/")){const s=i.getAsFile();s&&r.push(s)}r.length>0&&(n.preventDefault(),t.__uploadFiles?.(r))}return t.addEventListener("paste",e),{destroy(){t.removeEventListener("paste",e)}}}function yre(t){function e(r){const i=r.target;if(i&&i.closest('.editor-image-button[data-dragging="true"]')){const s=r.touches[0],o=120,a=Il.querySelector(".tiptap-editor");if(a){const l=a.getBoundingClientRect(),c=s.clientY<l.top+o,u=s.clientY>l.bottom-o;if(!c&&!u)return r.preventDefault(),!1}}}function n(r){const i=Il.querySelectorAll(".drop-zone-indicator");i.forEach(s=>{s.classList.remove("drop-zone-hover"),s.classList.add("drop-zone-fade-out")}),setTimeout(()=>{i.forEach(s=>{s.parentNode&&s.parentNode.removeChild(s)})},300)}return t.addEventListener("touchmove",e),t.addEventListener("touchend",n),{destroy(){t.removeEventListener("touchmove",e),t.removeEventListener("touchend",n)}}}function bre(t){function e(n){if((n.ctrlKey||n.metaKey)&&(n.key==="Enter"||n.key==="NumpadEnter")){n.preventDefault();const r=t.__currentEditor,i=typeof r=="function"?r():r,s=t.__hasStoredKey,o=typeof s=="function"?s():s,a=t.__postStatus,l=typeof a=="function"?a():a,c=i?uN(i):"";!l?.sending&&c.trim()&&o&&t.__submitPost?.()}}return t.addEventListener("keydown",e),{destroy(){t.removeEventListener("keydown",e)}}}function wre(t){let e=!1;return t?.descendants(n=>{n.type?.name==="image"&&(e=!0)}),e}function vre(t){let e=!1;return t?.descendants(n=>{n.type?.name==="video"&&(e=!0)}),e}function xre(t){return wre(t)||vre(t)}function Sre(t){const{currentEditor:e,editorContainerEl:n,callbacks:r}=t,i=a=>{const c=a.detail.plainText,u=e?xre(e.state?.doc):!1;r.onContentUpdate?.(c,u)},s=a=>{const l=a;r.onImageFullscreenRequest?.(l.detail.src,l.detail.alt||"")},o=a=>{const c=a?.detail?.pos;if(c!=null&&!(!e||!e.view)){try{"ontouchstart"in window||navigator.maxTouchPoints>0||e.view.focus();const u=rt.create(e.state.doc,c);e.view.dispatch(e.state.tr.setSelection(u).scrollIntoView())}catch(u){console.warn("select-image-node handler failed:",u)}r.onSelectImageNode?.(c)}};return window.addEventListener("editor-content-changed",i),window.addEventListener("image-fullscreen-request",s),window.addEventListener("select-image-node",o),n&&(n.addEventListener("image-fullscreen-request",s),n.addEventListener("select-image-node",o)),{handleContentUpdate:i,handleImageFullscreenRequest:s,handleSelectImageNode:o}}function Ere(t,e){window.removeEventListener("editor-content-changed",t.handleContentUpdate),window.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),window.removeEventListener("select-image-node",t.handleSelectImageNode),e&&(e.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),e.removeEventListener("select-image-node",t.handleSelectImageNode))}function hN(t){const e=[],n=e1.source;return t.descendants((r,i)=>{if(!r.isText||!r.text)return;const s=r.text,o=new RegExp(n,"g");let a;for(;(a=o.exec(s))!==null;){const l=a[0].indexOf("#");if(l===-1)continue;const c=i+a.index+l,u=c+1+a[1].length;e.push({from:c,to:u,hashtag:a[1]})}}),e}function kre(t){const e=[],n=new Set;e1.lastIndex=0;let r;for(;(r=e1.exec(t))!==null;){const i=r[1];i&&i.trim()&&(n.has(i)||(n.add(i),e.push(i)))}return e}function Tre(t){const e=hN(t),n=[],r=new Set;for(const i of e)r.has(i.hashtag)||(r.add(i.hashtag),n.push(i.hashtag));return n}function _re(t){Array.isArray(Ja.hashtags)&&[...Ja.hashtags];let e,n;typeof t=="string"?(n=t,e=kre(n)):(e=Tre(t),n=t.textContent);const r=e.map(i=>["t",i.toLowerCase()]);Ja.content=n,Ja.hashtags=e,Ja.tags=r}function NC(t){const n=hN(t).map(({from:r,to:i})=>sr.inline(r,i,{class:Vs.HASHTAG_CLASS}));return nn.create(t,n)}function Cre(t,e,n,r,i,s){const o=e.doc.resolve(i),a=o.parent,l=a.type.name==="paragraph"&&a.textContent.trim().length===0,c=lre(a,s-i),u=are(e),d=n.create({src:r,alt:"Image"});if(l||c){const f=o.depth,h=o.start(f),p=o.end(f);return u||e.doc.childCount===1&&c?t.delete(0,e.doc.content.size).insert(0,d):t.replaceWith(h,p,d)}return t.replaceWith(i,s,d)}function Are(t,e,n){const r=t.schema.marks.link,i=t.schema.nodes.image;if(!r)return null;let s=t.tr,o=!1;const a=[];e&&t.doc.descendants((l,c)=>{if(!l.isText)return;l.marks.find(d=>d.type===r)&&a.push({type:"removeMark",from:c,to:c+l.nodeSize})}),t.doc.descendants((l,c)=>{if(!l.isTextblock||l.childCount===0)return;let u="";const d=[];if(l.forEach((h,p)=>{h.isText&&h.text&&(d.push({textOffset:u.length,docPos:c+1+p}),u+=h.text)}),!u)return;let f;for(;(f=Vs.URL_REGEX.exec(u))!==null;){if(typeof f.index!="number")continue;const h=f.index,p=f[0],m=h>0?u[h-1]:void 0;if(!rre(m))continue;const{cleanUrl:g,actualLength:y}=sre(p),w=h+y,k=c+1+h,C=c+1+w;if(n){const A=lN(g);if(A&&i){a.push({type:"replaceImage",from:k,to:C,imageUrl:A});break}}if(e){if(g.length<8||!/^https?:\/\/[a-zA-Z0-9]/.test(g))continue;try{const E=new URL(g).hostname;if(E.length>0&&E.includes(".")){const P=E.split("."),S=P[P.length-1];if(S&&S.length>=2){const x=r.create({href:g});a.push({type:"addMark",from:k,to:C,mark:x})}}}catch{continue}}}}),a.sort((l,c)=>c.from-l.from);for(const l of a)l.type==="removeMark"?(s=s.removeMark(l.from,l.to,r),o=!0):l.type==="addMark"&&l.mark?(s=s.addMark(l.from,l.to,l.mark),o=!0):l.type==="replaceImage"&&l.imageUrl&&(s=Cre(s,t,i,l.imageUrl,l.from,l.to),o=!0);return o&&s.docChanged?s:null}const Ire=an.create({name:"contentTracking",addOptions(){return{debounceDelay:Vs.DEBOUNCE_DELAY,enableHashtags:Vs.ENABLE_HASHTAGS,enableAutoLink:Vs.ENABLE_AUTO_LINK,enableImageConversion:Vs.ENABLE_IMAGE_CONVERSION}},addStorage(){return{updateTimeout:null}},addProseMirrorPlugins(){const t=this.storage,e=this.options;return[...e.enableHashtags?[new Qt({key:new on(Vs.PLUGIN_KEYS.HASHTAG_DECORATION),state:{init:(n,{doc:r})=>NC(r),apply(n,r){return n.docChanged?NC(n.doc):r.map(n.mapping,n.doc)}},props:{decorations(n){return this.getState(n)}}})]:[],...e.enableAutoLink||e.enableImageConversion?[new Qt({key:new on(Vs.PLUGIN_KEYS.LINK_AND_IMAGE_CONVERSION),appendTransaction:(n,r,i)=>{if(!n.some(l=>l.docChanged))return null;const o=!n.some(l=>l.getMeta("paste")),a=Are(i,e.enableAutoLink??!0,o&&(e.enableImageConversion??!0));return a&&a.setMeta("addToHistory",!1),a}})]:[],new Qt({key:new on(Vs.PLUGIN_KEYS.CONTENT_UPDATE_TRACKER),state:{init:()=>null,apply(n){return n.docChanged&&(t.updateTimeout&&clearTimeout(t.updateTimeout),t.updateTimeout=setTimeout(()=>{_re(n.doc),window.dispatchEvent(new CustomEvent("editor-content-changed",{detail:{plainText:n.doc.textContent}}))},e.debounceDelay??Vs.DEBOUNCE_DELAY)),null}}})]},onDestroy(){this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout)}});function RC(t){return t.split(/[\n ]+/).map(e=>e.trim()).filter(Boolean).map(e=>{const n=lN(e);if(n)return{url:n,type:"image"};const r=nre(e);return r?{url:r,type:"video"}:null}).filter(e=>e!==null)}function Pre(t,e){const n=e.parent;return n.type.name==="paragraph"&&n.textContent.trim().length===0}function Mre(t){const{selection:e}=t,n=t.doc.resolve(e.from);if(Pre(e,n)){const r=n.depth,i=n.start(r),s=n.end(r);return{start:i,end:s}}return null}function LC(t,e){return t.map((n,r)=>{const i=Date.now();if(n.type==="image")return e.nodes.image.create({src:n.url,alt:"Pasted image"});{const s=`pasted-video-${i}-${r}`;return e.nodes.video.create({src:n.url,id:s})}})}function DC(t){const e=t.doc;if(!e)return t;const n=[];return e.descendants((r,i)=>{if(r.type.name==="paragraph"&&r.textContent.trim().length===0){if(e.childCount===1&&e.firstChild===r)return;let s=!1;r.descendants(o=>o.type&&(o.type.name==="image"||o.type.name==="video")?(s=!0,!1):!0),s||n.push([i,i+r.nodeSize])}}),n.sort((r,i)=>i[0]-r[0]),n.forEach(([r,i])=>{t=t.delete(r,i)}),t}const Ore=an.create({name:"mediaPaste",addProseMirrorPlugins(){return[new Qt({key:new on("image-paste"),props:{handlePaste:(t,e)=>{const n=e.clipboardData?.getData("text/plain")||"",r=RC(n);if(r.length>0){e.preventDefault();const{state:i,dispatch:s}=t,{tr:o,selection:a,schema:l}=i,c=LC(r,l);let u=o;const d=Mre(i);if(d&&c.length>0){u=u.replaceWith(d.start,d.end,c[0]);let f=d.start+c[0].nodeSize;for(let h=1;h<c.length;h++)u=u.insert(f,c[h]),f+=c[h].nodeSize}else{let f=a.from;c.forEach(h=>{u=u.insert(f,h),f+=h.nodeSize})}return u=DC(u),s(u),!0}return!1},handleTextInput:(t,e,n,r)=>{if(r.includes(`
`)||r.length>20){const i=RC(r);if(i.length>0){const{state:s,dispatch:o}=t,{tr:a,schema:l}=s,c=LC(i,l);let u=a;u=u.delete(e,n);let d=e;return c.forEach(f=>{u=u.insert(d,f),d+=f.nodeSize}),u=DC(u),o(u),!0}}return!1}}})]}}),Nre=an.create({name:"imageDragDrop",addProseMirrorPlugins(){const t=new on("image-drag-drop"),e=new on("drop-zone-indicator");return[new Qt({key:t,state:{init:()=>({isDragging:!1,draggedNodePos:null,autoScrollInterval:null}),apply:(n,r)=>{const i=n.getMeta("imageDrag");return i?i.isDragging===!1&&r.autoScrollInterval?(clearInterval(r.autoScrollInterval),{...r,...i,autoScrollInterval:null}):{...r,...i}:r}},props:{handleDrop:(n,r,i,s)=>{const o=r.dataTransfer?.getData("application/x-tiptap-node");if(!s&&o)try{const a=JSON.parse(o);if(a.type==="image"){r.preventDefault();const l=n.posAtCoords({left:r.clientX,top:r.clientY});if(l&&typeof a.pos=="number")return OC(n),bw(n,a,l.pos),!0}}catch(a){console.warn("Failed to parse drag data:",a)}return!1},handleDOMEvents:{dragstart:(n,r)=>Wo()?(r.preventDefault(),!0):!1,dragover:(n,r)=>Wo()?(r.preventDefault(),!0):!1,drop:(n,r)=>Wo()?(r.preventDefault(),!0):!1}},view:n=>{let r=null;const i=(c,u)=>{r&&(cancelAnimationFrame(r),r=null);const d=n.dom;if(!d)return;const f=d.getBoundingClientRect(),h=n_;let p=0;c==="up"?p=u-f.top:p=f.bottom-u;const m=Math.max(0,Math.min(1,p/h)),g=r_+(AZ-r_)*(1-m),y=()=>{const w=d.scrollTop,k=d.scrollHeight,C=d.clientHeight;if(c==="up"&&w>0){const A=Math.max(0,w-g);d.scrollTop=A,A>0&&(r=requestAnimationFrame(y))}else if(c==="down"&&w<k-C){const A=Math.min(k-C,w+g);d.scrollTop=A,A<k-C&&(r=requestAnimationFrame(y))}};r=requestAnimationFrame(y)},s=()=>{r&&(cancelAnimationFrame(r),r=null)},o=c=>{const{nodeData:u,dropPosition:d,dropX:f,dropY:h}=c.detail;if(s(),n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null})),u&&u.type==="image"){let p;typeof d=="number"?p=d:p=n.posAtCoords({left:f,top:h})?.pos||u.pos,typeof u.pos=="number"&&bw(n,u,p)}},a=c=>{const{nodePos:u}=c.detail;n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!0,draggedNodePos:u}))},l=c=>{const{touchY:u}=c.detail;if(typeof u!="number"||!t.getState(n.state)?.isDragging)return;const f=n.dom;if(!f)return;const h=f.getBoundingClientRect(),p=n_;u<h.top+p?i("up",u):u>h.bottom-p?i("down",u):s()};return window.addEventListener("touch-image-drop",o),window.addEventListener("touch-image-drag-start",a),window.addEventListener("touch-image-drag-move",l),{destroy(){s(),window.removeEventListener("touch-image-drop",o),window.removeEventListener("touch-image-drag-start",a),window.removeEventListener("touch-image-drag-move",l)}}}}),new Qt({key:e,state:{init(){return nn.empty},apply(n,r,i,s){if(!Wo())return nn.empty;const o=t.getState(s);if(!o?.isDragging)return nn.empty;const a=[],l=s.doc;let c=!1;if(typeof o.draggedNodePos=="number"){const u=l.firstChild;u&&u.type.name==="image"&&u.attrs&&o.draggedNodePos===0&&(c=!0)}return c||a.push(sr.widget(0,()=>{const u=document.createElement("div");u.className="drop-zone-indicator drop-zone-top",u.setAttribute("data-drop-pos","0");const d=document.createElement("div");return d.className="drop-zone-bar",u.appendChild(d),u},{side:-1})),l.descendants((u,d)=>{if(u.type.name==="paragraph"||u.type.name==="image"){const f=d+u.nodeSize;if(typeof o.draggedNodePos=="number"&&f===o.draggedNodePos)return;o.draggedNodePos!==d&&a.push(sr.widget(f,()=>{const h=document.createElement("div");h.className="drop-zone-indicator drop-zone-between",h.setAttribute("data-drop-pos",f.toString());const p=document.createElement("div");return p.className="drop-zone-bar",h.appendChild(p),h},{side:1}))}}),nn.create(l,a)}},props:{decorations(n){return this.getState(n)}}})]},addStorage(){return{moveImageNode:(t,e,n)=>(OC(t),bw(t,e,n))}}}),Rre=an.create({name:"smartBackspace",addProseMirrorPlugins(){return[new Qt({key:new on("smart-backspace"),props:{handleKeyDown(t,e){if(e.key!=="Backspace"||Wo()&&document.activeElement!==t.dom)return!1;const{state:n}=t,{selection:r,doc:i}=n;if(r.empty&&r.from===1){const s=i.firstChild,o=i.childCount>1?i.child(1):null;if(s&&s.type.name==="paragraph"&&s.content.size===0&&o&&o.type.name==="image")return t.dispatch(n.tr.delete(0,s.nodeSize)),!0}return!1}}})]}});var Lre=Ve('<div class="loader-container svelte-zx73mp"><div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div> <div class="square svelte-zx73mp"></div></div>'),Dre=Ve('<div class="placeholder-image svelte-zx73mp" aria-hidden="true"></div>'),Bre=Ve('<span class="placeholder-text loading-text svelte-zx73mp"> </span>'),$re=Ve("<div><!> <!> <!></div>");function xl(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",r),[r,i]=as();let s=ht(e,"text",3,!1),o=ht(e,"showImage",3,!1),a=ht(e,"showLoader",3,!1),l=ht(e,"customClass",3,""),c=Xe(()=>typeof s()=="string"?s():s()===!0?n()("loadingPlaceholder.loading"):"");var u=$re(),d=ye(u);{var f=y=>{var w=Lre();we(y,w)};Ye(d,y=>{a()&&y(f)})}var h=Le(d,2);{var p=y=>{var w=Dre();we(y,w)};Ye(h,y=>{o()&&y(p)})}var m=Le(h,2);{var g=y=>{var w=Bre(),k=ye(w);Ge(()=>Qe(k,M(c))),we(y,w)};Ye(m,y=>{M(c)&&y(g)})}Ge(()=>{rs(u,1,`loading-placeholder ${l()??""}`,"svelte-zx73mp"),ln(u,"aria-label",M(c))}),we(t,u),On(),i()}function Fre(t,e={}){const{collapseEmptyLines:n=!1,maxConsecutiveEmptyLines:r=2}=e;let i=cN(t);if(n){const o=new RegExp(`\\n{${r+2},}`,"g");i=i.replace(o,`
`.repeat(r+1))}let s=i.split(`
`);return s.length>0&&s[s.length-1]===""&&(s=s.slice(0,-1)),s.length===1&&s[0]===""&&(s=[]),{normalized:i,lines:s}}function zre(t){return t.join(`
`)}async function j0(t,e="",n,r){const i=n??navigator;try{if(i?.clipboard&&typeof i.clipboard.writeText=="function"){await i.clipboard.writeText(t),console.log(`${e} copied to clipboard`);return}}catch(s){console.error(`Failed to copy ${e}:`,s),await BC(t,e,r);return}await BC(t,e,r)}async function BC(t,e="",n){const r=n??window;try{const i=r&&r.document||document,s=i.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-9999px",s.style.top="0",s.setAttribute("readonly","true"),i.body.appendChild(s),s.focus(),s.select();const o=i.execCommand&&i.execCommand("copy");if(i.body.removeChild(s),o)console.log(`${e} copied to clipboard (fallback)`);else throw new Error("fallback_copy_failed")}catch(i){console.warn(`Failed to copy ${e} (both clipboard API and fallback failed):`,i)}}function Ure(t,e,n,r,i,s){const o=window,a=navigator,l=s?.editorObj??window.__currentEditor,c=Jr,u=typeof c=="function"?c:mc(c);return[{label:u("videoContextMenu.playPause"),action:()=>{const d=document.querySelector(`video[data-node-id="${i}"]`);d?d.paused?d.play().catch(f=>{console.warn("Failed to play video:",f)}):d.pause():console.warn("Video element not found for nodeId:",i)},src:t,icon:"/icons/play_pause_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg"},{label:u("videoContextMenu.copyUrl"),action:async()=>{j0(t,"video URL",a,o)},src:t,icon:"/icons/copy-solid-full.svg"},{label:u("videoContextMenu.delete"),action:()=>{const d=l?.view;if(d?.state&&d?.dispatch){let f=!1;d.state.doc.descendants((h,p)=>{if(!f&&h.type.name==="video"&&h.attrs.id===i)return d.dispatch(d.state.tr.delete(p,p+h.nodeSize)),f=!0,!1})}},disabled:!1,src:t,icon:"/icons/trash-solid-full.svg"}]}function W0(t,e,n,r,i,s){const o=((c,u,...d)=>setTimeout(c,u,...d));let a=!1,l;if(t.update(c=>(a=c.open&&c.nodeId!==e,l=c.nodeId,c)),a&&l){t.set({open:!1,nodeId:void 0,src:void 0,videoElement:void 0}),o(()=>{t.set({open:!0,nodeId:e,src:r,videoElement:i})},0);return}t.set({open:!0,nodeId:e,src:r,videoElement:i})}function Hre(t,e,n,r){if(!t.open||!t.nodeId)return null;const i=t.nodeId,s=t.src||"";t.videoElement;let o=0,a=1;e?.state?.doc&&e.state.doc.descendants((d,f)=>{if(d.attrs.id===i)return o=f,a=d.nodeSize,!1});const c=Ure(s,()=>o,a,!0,i,{editorObj:e});let u={x:0,y:0};return n&&(u=Uu(n.x,n.y)),{items:c,x:u.x,y:u.y}}function Vre(t,e,n,r,i,s){if(M(e)||n()||t.target===M(r))return;t.stopPropagation(),t.preventDefault(),Hh(i.getPos);const o=Tu(t);Yo.set(o),W0(Ni,M(s),o,i.node.attrs.src||"",M(r))}function jre(t,e,n,r,i,s){if(M(e)||n())return;if(M(r)){const a=M(r).getBoundingClientRect(),l=t.clientY,c=a.bottom;if(l>c-48)return}if(t.button===2)return;t.stopPropagation(),t.preventDefault(),Hh(i.getPos);const o=Tu(t);Yo.set(o),W0(Ni,M(s),o,i.node.attrs.src||"",M(r))}function Wre(t,e,n,r,i){if(t.key==="Enter"||t.key===" "){t.preventDefault(),Hh(e.getPos);const s={x:0,y:0};Yo.set(s),M(n)||W0(Ni,M(r),s,e.node.attrs.src||"",M(i))}}var qre=Ve('<video controls playsinline="" autoplay loop preload="metadata"><track kind="captions"/> </video>',2),Kre=Ve('<div class="video-wrapper svelte-1rghf39" data-video-node="" role="button" tabindex="0"><!></div>');function Gre(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",r),[r,i]=as();let s=Ee(void 0),o=Ee(!1),a=Ee(void 0),l=Xe(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src?.startsWith("placeholder-")||e.node.attrs.src?.startsWith("blob:")||!e.node.attrs.src),c=Xe(()=>e.node.attrs.id||(typeof e.getPos=="function"?(e.getPos()??"unknown").toString():"unknown"));function u(){se(o,!0)}function d(){M(l)||console.error("Failed to load video:",e.node.attrs.src)}function f(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}let h=0,p={x:0,y:0};const m=200,g=10;function y(k){if(M(l)||k.touches.length!==1)return;h=Date.now();const C=k.touches[0];p={x:C.clientX,y:C.clientY}}function w(k){if(M(l)||f())return;if(Date.now()-h<m&&k.changedTouches.length===1){const E=k.changedTouches[0],P={x:E.clientX,y:E.clientY};if(Math.sqrt(Math.pow(P.x-p.x,2)+Math.pow(P.y-p.y,2))<g){if(M(s)){const _=M(s).getBoundingClientRect(),I=E.clientY,D=_.bottom;if(I>D-48)return}k.stopPropagation(),k.preventDefault(),Hh(e.getPos);const x={x:E.clientX,y:E.clientY};Yo.set(x),W0(Ni,M(c),x,e.node.attrs.src||"")}}}ls(()=>(M(s)&&(M(s).addEventListener("touchstart",y,{passive:!1}),M(s).addEventListener("touchend",w,{passive:!1})),()=>{M(s)&&(M(s).removeEventListener("touchstart",y),M(s).removeEventListener("touchend",w))})),rN(t,{children:(k,C)=>{var A=Kre();A.__click=[Vre,l,f,s,e,c],A.__keydown=[Wre,e,l,c,s];var E=ye(A);{var P=x=>{{let _=Xe(()=>n()("videoNode.uploading"));xl(x,{get text(){return M(_)},showLoader:!0})}},S=x=>{var _=qre();_.muted=!0;let I;_.__click=[jre,l,f,s,e,c],_.__touchstart=y,_.__touchend=w;var D=Le(ye(_));Xn(_,B=>se(s,B),()=>M(s)),Ge((B,F)=>{ln(_,"src",e.node.attrs.src),I=rs(_,1,"editor-video svelte-1rghf39",null,I,B),ln(_,"data-node-id",M(c)),Qe(D,` ${F??""}`)},[()=>({loaded:M(o)}),()=>n()("videoNode.not_supported")]),bs("loadeddata",_,u),bs("error",_,d),we(x,_)};Ye(E,x=>{M(l)?x(P):x(S,!1)})}Xn(A,x=>se(a,x),()=>M(a)),we(k,A)},$$slots:{default:!0}}),On(),i()}xi(["click","keydown","touchstart","touchend"]);const Zre=ei.create({name:"video",group:"block",draggable:!1,addAttributes(){return{src:{default:null},isPlaceholder:{default:!1}}},parseHTML(){return[{tag:"video[src]"}]},renderHTML({HTMLAttributes:t}){return["video",Pn(t,{controls:!0})]},addNodeView(){return nN(Gre)}});function Qre(t,e){return t.map(n=>{const r=n.length>0?[e.text(n)]:[];return e.nodes.paragraph.create(null,r)})}function Xre(t){const e=[];return t.content.forEach(n=>{if(n.type.name==="paragraph"){let r="";n.content.forEach(i=>{i.isText&&(r+=i.text||"")}),e.push(r)}else if(n.type.name==="image"||n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}else n.isTextblock&&e.push(n.textContent)}),e}const Yre=an.create({name:"clipboardExtension",addProseMirrorPlugins(){return[new Qt({key:new on("clipboardExtension"),props:{handlePaste(t,e,n){const{state:r,dispatch:i}=t,{clipboardData:s}=e;if(!s||s.files&&s.files.length>0)return!1;const a=s.getData("text/plain");if(!a)return!1;const l=s.types.includes("text/html");let c=!1;if(l){const m=s.getData("text/html");if(m.includes("<strong>")||m.includes("<b>")||m.includes("<em>")||m.includes("<i>")||m.includes("<a ")||m.includes("<a>"))return!1;c=m.includes('data-block="true"')&&m.includes("data-editor=")}const{lines:u}=Fre(a,{collapseEmptyLines:c,maxConsecutiveEmptyLines:1});if(u.length===0)return!1;const d=Qre(u,r.schema),f=Ae.from(d),h=new We(f,0,0),p=r.tr.replaceSelection(h).setMeta("paste",!0).setMeta("uiEvent","paste").setMeta("addToHistory",!0);return i(p),!0},clipboardTextSerializer(t){const e=Xre(t);return zre(e)}}})]}});var rg=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...r}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,r,n]},Jre=/^\s*>\s$/,eie=ei.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return rg("blockquote",{...Pn(this.options.HTMLAttributes,t),children:rg("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=[];return t.content.forEach(i=>{const o=e.renderChildren(i).split(`
`).map(a=>`> ${a}`).join(`
`);n.push(o)}),n.flatMap(i=>[i,"> "]).slice(0,-1).join(`
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[fd({find:Jre,type:this.type})]}}),tie=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,nie=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,rie=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,iie=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,sie=Wc.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return rg("strong",{...Pn(this.options.HTMLAttributes,t),children:rg("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[dd({find:tie,type:this.type}),dd({find:rie,type:this.type})]},addPasteRules(){return[Dc({find:nie,type:this.type}),Dc({find:iie,type:this.type})]}}),oie=/(^|[^`])`([^`]+)`(?!`)$/,aie=/(^|[^`])`([^`]+)`(?!`)/g,lie=Wc.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Pn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[dd({find:oie,type:this.type})]},addPasteRules(){return[Dc({find:aie,type:this.type})]}}),vw=4,cie=/^```([a-z]+)?[\s\n]$/,uie=/^~~~([a-z]+)?[\s\n]$/,die=ei.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:vw,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const s=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Pn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let r="";const i=((n=t.attrs)==null?void 0:n.language)||"";return t.content?r=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):r=`\`\`\`${i}

\`\`\``,r},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:vw,{state:r}=t,{selection:i}=r,{$from:s,empty:o}=i;if(s.parent.type!==this.type)return!1;const a=" ".repeat(n);return o?t.commands.insertContent(a):t.commands.command(({tr:l})=>{const{from:c,to:u}=i,h=r.doc.textBetween(c,u,`
`,`
`).split(`
`).map(p=>a+p).join(`
`);return l.replaceWith(c,u,r.schema.text(h)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:vw,{state:r}=t,{selection:i}=r,{$from:s,empty:o}=i;return s.parent.type!==this.type?!1:o?t.commands.command(({tr:a})=>{var l;const{pos:c}=s,u=s.start(),d=s.end(),h=r.doc.textBetween(u,d,`
`,`
`).split(`
`);let p=0,m=0;const g=c-u;for(let E=0;E<h.length;E+=1){if(m+h[E].length>=g){p=E;break}m+=h[E].length+1}const w=((l=h[p].match(/^ */))==null?void 0:l[0])||"",k=Math.min(w.length,n);if(k===0)return!0;let C=u;for(let E=0;E<p;E+=1)C+=h[E].length+1;return a.delete(C,C+k),c-C<=k&&a.setSelection(wt.create(a.doc,C)),!0}):t.commands.command(({tr:a})=>{const{from:l,to:c}=i,f=r.doc.textBetween(l,c,`
`,`
`).split(`
`).map(h=>{var p;const m=((p=h.match(/^ */))==null?void 0:p[0])||"",g=Math.min(m.length,n);return h.slice(g)}).join(`
`);return a.replaceWith(l,c,r.schema.text(f)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(Tt.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[S1({find:cie,type:this.type,getAttributes:t=>({language:t[1]})}),S1({find:uie,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Qt({key:new on("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i?.mode;if(!n||!s)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(wt.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),fie=ei.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),hie=ei.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Pn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:(t,e)=>e.indent(`
`),parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(f=>a.includes(f.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),pie=ei.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Pn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const r=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,i="#".repeat(r);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>S1({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),mie=ei.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Pn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!Mne(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:r}=n,i=t();return FO(n)?i.insertContentAt(r.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:s,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(wt.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(rt.create(o.doc,l.pos)):o.setSelection(wt.create(o.doc,l.pos));else{const u=s.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,d=u?.create();d&&(o.insert(c,d),o.setSelection(wt.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[JO({find:/^(?:---|â-|___\s|\*\*\*\s)$/,type:this.type})]}}),gie=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,yie=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,bie=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,wie=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,vie=Wc.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Pn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[dd({find:gie,type:this.type}),dd({find:bie,type:this.type})]},addPasteRules(){return[Dc({find:yie,type:this.type}),Dc({find:wie,type:this.type})]}});const xie="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Sie="ÎµÎ»1Ï2Ð±Ð³1ÐµÐ»3Ð´ÐµÑÐ¸4ÐµÑ2ÐºÐ°ÑÐ¾Ð»Ð¸Ðº6Ð¾Ð¼3Ð¼ÐºÐ´2Ð¾Ð½1ÑÐºÐ²Ð°6Ð¾Ð½Ð»Ð°Ð¹Ð½5ÑÐ³3ÑÑÑ2Ñ2ÑÐ°Ð¹Ñ3ÑÐ±3ÑÐºÑ3ÒÐ°Ð·3Õ°Õ¡Õµ3××©×¨××5×§××3Ø§Ø¨ÙØ¸Ø¨Ù5Ø±Ø§ÙÙÙ5ÙØ§Ø±Ø¯Ù4Ø¨Ø­Ø±ÙÙ5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙØ¯ÙØ©6Ø¹ÙÙØ§Ù5ÙØºØ±Ø¨5ÙØ§Ø±Ø§Øª5ÛØ±Ø§Ù5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙØªÙ3Ú¾Ø§Ø±Øª5ØªÙÙØ³4Ø³ÙØ¯Ø§Ù3Ø±ÙØ©5Ø´Ø¨ÙØ©4Ø¹Ø±Ø§Ù2Ø¨2ÙØ§Ù4ÙÙØ³Ø·ÙÙ6ÙØ·Ø±3ÙØ§Ø«ÙÙÙÙ6ÙÙ3ÙØµØ±2ÙÙØ³ÙØ§5ÙØ±ÙØªØ§ÙÙØ§7ÙØ¹4ÙÙØ±Ø§Ù5Ù¾Ø§Ú©Ø³ØªØ§Ù7ÚØ§Ø±Øª4à¤à¥à¤®3à¤¨à¥à¤3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥à¤¤5à¤¸à¤à¤à¤ à¤¨5à¦¬à¦¾à¦à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®à®¨à¯à®¤à®¿à®¯à®¾6à®²à®à¯à®à¯6à®à®¿à®à¯à®à®ªà¯à®ªà¯à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´5à¶½à¶à¶à·4à¸à¸­à¸¡3à¹à¸à¸¢3àº¥àº²àº§3áá2ã¿ããª3ã¢ãã¾ã³4ã¯ã©ã¦ã4ã°ã¼ã°ã«4ã³ã 2ã¹ãã¢3ã»ã¼ã«3ãã¡ãã·ã§ã³6ãã¤ã³ã4ä¸ç2ä¸­ä¿¡1å½1å1æç½3äºé©¬é3ä¼ä¸2ä½å±±2ä¿¡æ¯2å¥åº·2å«å¦2å¬å¸1ç2å°æ¹¾1ç£2åå1åº1æ 2åé0å¤§éåº5å¨çº¿2å¤§æ¿2å¤©ä¸»æ3å¨±ä¹2å®¶é»2å¹¿ä¸2å¾®å2æå2æç±ä½ 3ææº2æè2æ¿å¡1åº2æ°å å¡2é»2æ¶å°2æ¸ç±2æºæ2æ·¡é©¬é¡3æ¸¸æ2æ¾³é2ç¹ç2ç§»å¨2ç»ç»æºæ4ç½å1åº1ç«1ç»2èé2è°·æ­2è´­ç©2éè²©2éå¢2é»è¨çç§4é£å©æµ¦3é£å2é¤å2é¦æ ¼éæ3æ¸¯2ë·ë·1ì»´2ì¼ì±2íêµ­2",C1="numeric",A1="ascii",I1="alpha",Df="asciinumeric",yf="alphanumeric",P1="domain",pN="emoji",Eie="scheme",kie="slashscheme",xw="whitespace";function Tie(t,e){return t in e||(e[t]=[]),e[t]}function uc(t,e,n){e[C1]&&(e[Df]=!0,e[yf]=!0),e[A1]&&(e[Df]=!0,e[I1]=!0),e[Df]&&(e[yf]=!0),e[I1]&&(e[yf]=!0),e[yf]&&(e[P1]=!0),e[pN]&&(e[P1]=!0);for(const r in e){const i=Tie(r,n);i.indexOf(t)<0&&i.push(t)}}function _ie(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function ui(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}ui.groups={};ui.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(t))return s}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let i=0;i<t.length;i++)this.tt(t[i],e,n,r)},tr(t,e,n,r){r=r||ui.groups;let i;return e&&e.j?i=e:(i=new ui(e),n&&r&&uc(e,n,r)),this.jr.push([t,i]),i},ts(t,e,n,r){let i=this;const s=t.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(t[o]);return i.tt(t[s-1],e,n,r)},tt(t,e,n,r){r=r||ui.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const s=e;let o,a=i.go(t);if(a?(o=new ui,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new ui,s){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(_ie(o.t,r),n);uc(s,l,r)}else n&&uc(s,n,r);o.t=s}return i.j[t]=o,o}};const kt=(t,e,n,r,i)=>t.ta(e,n,r,i),Cn=(t,e,n,r,i)=>t.tr(e,n,r,i),$C=(t,e,n,r,i)=>t.ts(e,n,r,i),Re=(t,e,n,r,i)=>t.tt(e,n,r,i),Co="WORD",M1="UWORD",mN="ASCIINUMERICAL",gN="ALPHANUMERICAL",hh="LOCALHOST",O1="TLD",N1="UTLD",Yp="SCHEME",yu="SLASH_SCHEME",dS="NUM",R1="WS",fS="NL",Bf="OPENBRACE",$f="CLOSEBRACE",ig="OPENBRACKET",sg="CLOSEBRACKET",og="OPENPAREN",ag="CLOSEPAREN",lg="OPENANGLEBRACKET",cg="CLOSEANGLEBRACKET",ug="FULLWIDTHLEFTPAREN",dg="FULLWIDTHRIGHTPAREN",fg="LEFTCORNERBRACKET",hg="RIGHTCORNERBRACKET",pg="LEFTWHITECORNERBRACKET",mg="RIGHTWHITECORNERBRACKET",gg="FULLWIDTHLESSTHAN",yg="FULLWIDTHGREATERTHAN",bg="AMPERSAND",wg="APOSTROPHE",vg="ASTERISK",qa="AT",xg="BACKSLASH",Sg="BACKTICK",Eg="CARET",el="COLON",hS="COMMA",kg="DOLLAR",js="DOT",Tg="EQUALS",pS="EXCLAMATION",Ui="HYPHEN",Ff="PERCENT",_g="PIPE",Cg="PLUS",Ag="POUND",zf="QUERY",mS="QUOTE",yN="FULLWIDTHMIDDLEDOT",gS="SEMI",Ws="SLASH",Uf="TILDE",Ig="UNDERSCORE",bN="EMOJI",Pg="SYM";var wN=Object.freeze({__proto__:null,ALPHANUMERICAL:gN,AMPERSAND:bg,APOSTROPHE:wg,ASCIINUMERICAL:mN,ASTERISK:vg,AT:qa,BACKSLASH:xg,BACKTICK:Sg,CARET:Eg,CLOSEANGLEBRACKET:cg,CLOSEBRACE:$f,CLOSEBRACKET:sg,CLOSEPAREN:ag,COLON:el,COMMA:hS,DOLLAR:kg,DOT:js,EMOJI:bN,EQUALS:Tg,EXCLAMATION:pS,FULLWIDTHGREATERTHAN:yg,FULLWIDTHLEFTPAREN:ug,FULLWIDTHLESSTHAN:gg,FULLWIDTHMIDDLEDOT:yN,FULLWIDTHRIGHTPAREN:dg,HYPHEN:Ui,LEFTCORNERBRACKET:fg,LEFTWHITECORNERBRACKET:pg,LOCALHOST:hh,NL:fS,NUM:dS,OPENANGLEBRACKET:lg,OPENBRACE:Bf,OPENBRACKET:ig,OPENPAREN:og,PERCENT:Ff,PIPE:_g,PLUS:Cg,POUND:Ag,QUERY:zf,QUOTE:mS,RIGHTCORNERBRACKET:hg,RIGHTWHITECORNERBRACKET:mg,SCHEME:Yp,SEMI:gS,SLASH:Ws,SLASH_SCHEME:yu,SYM:Pg,TILDE:Uf,TLD:O1,UNDERSCORE:Ig,UTLD:N1,UWORD:M1,WORD:Co,WS:R1});const To=/[a-z]/,rf=new RegExp("\\p{L}","u"),Sw=new RegExp("\\p{Emoji}","u"),_o=/\d/,Ew=/\s/,FC="\r",kw=`
`,Cie="ï¸",Aie="â",Tw="ï¿¼";let Cp=null,Ap=null;function Iie(t=[]){const e={};ui.groups=e;const n=new ui;Cp==null&&(Cp=zC(xie)),Ap==null&&(Ap=zC(Sie)),Re(n,"'",wg),Re(n,"{",Bf),Re(n,"}",$f),Re(n,"[",ig),Re(n,"]",sg),Re(n,"(",og),Re(n,")",ag),Re(n,"<",lg),Re(n,">",cg),Re(n,"ï¼",ug),Re(n,"ï¼",dg),Re(n,"ã",fg),Re(n,"ã",hg),Re(n,"ã",pg),Re(n,"ã",mg),Re(n,"ï¼",gg),Re(n,"ï¼",yg),Re(n,"&",bg),Re(n,"*",vg),Re(n,"@",qa),Re(n,"`",Sg),Re(n,"^",Eg),Re(n,":",el),Re(n,",",hS),Re(n,"$",kg),Re(n,".",js),Re(n,"=",Tg),Re(n,"!",pS),Re(n,"-",Ui),Re(n,"%",Ff),Re(n,"|",_g),Re(n,"+",Cg),Re(n,"#",Ag),Re(n,"?",zf),Re(n,'"',mS),Re(n,"/",Ws),Re(n,";",gS),Re(n,"~",Uf),Re(n,"_",Ig),Re(n,"\\",xg),Re(n,"ã»",yN);const r=Cn(n,_o,dS,{[C1]:!0});Cn(r,_o,r);const i=Cn(r,To,mN,{[Df]:!0}),s=Cn(r,rf,gN,{[yf]:!0}),o=Cn(n,To,Co,{[A1]:!0});Cn(o,_o,i),Cn(o,To,o),Cn(i,_o,i),Cn(i,To,i);const a=Cn(n,rf,M1,{[I1]:!0});Cn(a,To),Cn(a,_o,s),Cn(a,rf,a),Cn(s,_o,s),Cn(s,To),Cn(s,rf,s);const l=Re(n,kw,fS,{[xw]:!0}),c=Re(n,FC,R1,{[xw]:!0}),u=Cn(n,Ew,R1,{[xw]:!0});Re(n,Tw,u),Re(c,kw,l),Re(c,Tw,u),Cn(c,Ew,u),Re(u,FC),Re(u,kw),Cn(u,Ew,u),Re(u,Tw,u);const d=Cn(n,Sw,bN,{[pN]:!0});Re(d,"#"),Cn(d,Sw,d),Re(d,Cie,d);const f=Re(d,Aie);Re(f,"#"),Cn(f,Sw,d);const h=[[To,o],[_o,i]],p=[[To,null],[rf,a],[_o,s]];for(let m=0;m<Cp.length;m++)Ra(n,Cp[m],O1,Co,h);for(let m=0;m<Ap.length;m++)Ra(n,Ap[m],N1,M1,p);uc(O1,{tld:!0,ascii:!0},e),uc(N1,{utld:!0,alpha:!0},e),Ra(n,"file",Yp,Co,h),Ra(n,"mailto",Yp,Co,h),Ra(n,"http",yu,Co,h),Ra(n,"https",yu,Co,h),Ra(n,"ftp",yu,Co,h),Ra(n,"ftps",yu,Co,h),uc(Yp,{scheme:!0,ascii:!0},e),uc(yu,{slashscheme:!0,ascii:!0},e),t=t.sort((m,g)=>m[0]>g[0]?1:-1);for(let m=0;m<t.length;m++){const g=t[m][0],w=t[m][1]?{[Eie]:!0}:{[kie]:!0};g.indexOf("-")>=0?w[P1]=!0:To.test(g)?_o.test(g)?w[Df]=!0:w[A1]=!0:w[C1]=!0,$C(n,g,g,w)}return $C(n,"localhost",hh,{ascii:!0}),n.jd=new ui(Pg),{start:n,tokens:Object.assign({groups:e},wN)}}function vN(t,e){const n=Pie(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,i=[];let s=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,d=-1,f=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(d=0,f=0,u=a):d>=0&&(d+=n[o].length,f++),c+=n[o].length,s+=n[o].length,o++;s-=d,o-=f,c-=d,i.push({t:u.t,v:e.slice(s-c,s),s:s-c,e:s})}return i}function Pie(t){const e=[],n=t.length;let r=0;for(;r<n;){let i=t.charCodeAt(r),s,o=i<55296||i>56319||r+1===n||(s=t.charCodeAt(r+1))<56320||s>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function Ra(t,e,n,r,i){let s;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?s=t.j[l]:(s=new ui(r),s.jr=i.slice(),t.j[l]=s),t=s}return s=new ui(n),s.jr=i.slice(),t.j[e[o-1]]=s,s}function zC(t){const e=[],n=[];let r=0,i="0123456789";for(;r<t.length;){let s=0;for(;i.indexOf(t[r+s])>=0;)s++;if(s>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+s),10);o>0;o--)n.pop();r+=s}else n.push(t[r]),r++}return e}const ph={defaultProtocol:"http",events:null,format:UC,formatHref:UC,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function yS(t,e=null){let n=Object.assign({},ph);t&&(n=Object.assign(n,t instanceof yS?t.o:t));const r=n.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=i}yS.prototype={o:ph,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:ph[t],typeof i=="function"&&r&&(i=i(e,n))):typeof i=="function"&&r&&(i=i(e,n.t,n)),i)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function UC(t){return t}function xN(t,e){this.t="token",this.v=t,this.tk=e}xN.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"â¦":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=ph.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),i=t.get("tagName",n,e),s=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),d=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:i,attributes:o,content:s,eventListeners:d}}};function q0(t,e){class n extends xN{constructor(i,s){super(i,s),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const HC=q0("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),VC=q0("text"),Mie=q0("nl"),Ip=q0("url",{isLink:!0,toHref(t=ph.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==hh&&t[1].t===el}}),Fi=t=>new ui(t);function Oie({groups:t}){const e=t.domain.concat([bg,vg,qa,xg,Sg,Eg,kg,Tg,Ui,dS,Ff,_g,Cg,Ag,Ws,Pg,Uf,Ig]),n=[wg,el,hS,js,pS,Ff,zf,mS,gS,lg,cg,Bf,$f,sg,ig,og,ag,ug,dg,fg,hg,pg,mg,gg,yg],r=[bg,wg,vg,xg,Sg,Eg,kg,Tg,Ui,Bf,$f,Ff,_g,Cg,Ag,zf,Ws,Pg,Uf,Ig],i=Fi(),s=Re(i,Uf);kt(s,r,s),kt(s,t.domain,s);const o=Fi(),a=Fi(),l=Fi();kt(i,t.domain,o),kt(i,t.scheme,a),kt(i,t.slashscheme,l),kt(o,r,s),kt(o,t.domain,o);const c=Re(o,qa);Re(s,qa,c),Re(a,qa,c),Re(l,qa,c);const u=Re(s,js);kt(u,r,s),kt(u,t.domain,s);const d=Fi();kt(c,t.domain,d),kt(d,t.domain,d);const f=Re(d,js);kt(f,t.domain,d);const h=Fi(HC);kt(f,t.tld,h),kt(f,t.utld,h),Re(c,hh,h);const p=Re(d,Ui);Re(p,Ui,p),kt(p,t.domain,d),kt(h,t.domain,d),Re(h,js,f),Re(h,Ui,p);const m=Re(h,el);kt(m,t.numeric,HC);const g=Re(o,Ui),y=Re(o,js);Re(g,Ui,g),kt(g,t.domain,o),kt(y,r,s),kt(y,t.domain,o);const w=Fi(Ip);kt(y,t.tld,w),kt(y,t.utld,w),kt(w,t.domain,o),kt(w,r,s),Re(w,js,y),Re(w,Ui,g),Re(w,qa,c);const k=Re(w,el),C=Fi(Ip);kt(k,t.numeric,C);const A=Fi(Ip),E=Fi();kt(A,e,A),kt(A,n,E),kt(E,e,A),kt(E,n,E),Re(w,Ws,A),Re(C,Ws,A);const P=Re(a,el),S=Re(l,el),x=Re(S,Ws),_=Re(x,Ws);kt(a,t.domain,o),Re(a,js,y),Re(a,Ui,g),kt(l,t.domain,o),Re(l,js,y),Re(l,Ui,g),kt(P,t.domain,A),Re(P,Ws,A),Re(P,zf,A),kt(_,t.domain,A),kt(_,e,A),Re(_,Ws,A);const I=[[Bf,$f],[ig,sg],[og,ag],[lg,cg],[ug,dg],[fg,hg],[pg,mg],[gg,yg]];for(let D=0;D<I.length;D++){const[B,F]=I[D],R=Re(A,B);Re(E,B,R),Re(R,F,A);const O=Fi(Ip);kt(R,e,O);const L=Fi();kt(R,n),kt(O,e,O),kt(O,n,L),kt(L,e,O),kt(L,n,L),Re(O,F,A),Re(L,F,A)}return Re(i,hh,w),Re(i,fS,Mie),{start:i,tokens:wN}}function Nie(t,e,n){let r=n.length,i=0,s=[],o=[];for(;i<r;){let a=t,l=null,c=null,u=0,d=null,f=-1;for(;i<r&&!(l=a.go(n[i].t));)o.push(n[i++]);for(;i<r&&(c=l||a.go(n[i].t));)l=null,a=c,a.accepts()?(f=0,d=a):f>=0&&f++,i++,u++;if(f<0)i-=u,i<r&&(o.push(n[i]),i++);else{o.length>0&&(s.push(_w(VC,e,o)),o=[]),i-=f,u-=f;const h=d.t,p=n.slice(i-u,i);s.push(_w(h,e,p))}}return o.length>0&&s.push(_w(VC,e,o)),s}function _w(t,e,n){const r=n[0].s,i=n[n.length-1].e,s=e.slice(r,i);return new t(s,n)}const Rie=typeof console<"u"&&console&&console.warn||(()=>{}),Lie="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",pn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Die(){return ui.groups={},pn.scanner=null,pn.parser=null,pn.tokenQueue=[],pn.pluginQueue=[],pn.customSchemes=[],pn.initialized=!1,pn}function jC(t,e=!1){if(pn.initialized&&Rie(`linkifyjs: already initialized - will not register custom scheme "${t}" ${Lie}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);pn.customSchemes.push([t,e])}function Bie(){pn.scanner=Iie(pn.customSchemes);for(let t=0;t<pn.tokenQueue.length;t++)pn.tokenQueue[t][1]({scanner:pn.scanner});pn.parser=Oie(pn.scanner.tokens);for(let t=0;t<pn.pluginQueue.length;t++)pn.pluginQueue[t][1]({scanner:pn.scanner,parser:pn.parser});return pn.initialized=!0,pn}function bS(t){return pn.initialized||Bie(),Nie(pn.parser.start,t,vN(pn.scanner.start,t))}bS.scan=vN;function SN(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new yS(n),i=bS(t),s=[];for(let o=0;o<i.length;o++){const a=i[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&s.push(a.toFormattedObject(r))}return s}var wS="[\0- Â áá â-\u2029âã]",$ie=new RegExp(wS),Fie=new RegExp(`${wS}$`),zie=new RegExp(wS,"g");function Uie(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function Hie(t){return new Qt({key:new on("autolink"),appendTransaction:(e,n,r)=>{const i=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=r,a=eS(n.doc,[...e]);if(iS(a).forEach(({newRange:c})=>{const u=OO(r.doc,c,h=>h.isTextblock);let d,f;if(u.length>1)d=u[0],f=r.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const h=r.doc.textBetween(c.from,c.to," "," ");if(!Fie.test(h))return;d=u[0],f=r.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&f){const h=f.split($ie).filter(Boolean);if(h.length<=0)return!1;const p=h[h.length-1],m=d.pos+f.lastIndexOf(p);if(!p)return!1;const g=bS(p).map(y=>y.toObject(t.defaultProtocol));if(!Uie(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:m+y.start+1,to:m+y.end+1})).filter(y=>r.schema.marks.code?!r.doc.rangeHasMark(y.from,y.to,r.schema.marks.code):!0).filter(y=>t.validate(y.value)).filter(y=>t.shouldAutoLink(y.value)).forEach(y=>{sS(y.from,y.to,r.doc).some(w=>w.mark.type===t.type)||o.addMark(y.from,y.to,t.type.create({href:y.href}))})}}),!!o.steps.length)return o}})}function Vie(t){return new Qt({key:new on("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,s;if(r.button!==0||!e.editable)return!1;let o=null;if(r.target instanceof HTMLAnchorElement)o=r.target;else{let u=r.target;const d=[];for(;u.nodeName!=="DIV";)d.push(u),u=u.parentNode;o=d.find(f=>f.nodeName==="A")}if(!o)return!1;const a=$O(e.state,t.type.name),l=(i=o?.href)!=null?i:a.href,c=(s=o?.target)!=null?s:a.target;return t.enableClickSelection&&t.editor.commands.extendMarkRange(t.type.name),o&&l?(window.open(l,c),!0):!1}}})}function jie(t){return new Qt({key:new on("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{shouldAutoLink:i}=t,{state:s}=e,{selection:o}=s,{empty:a}=o;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=SN(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||i!==void 0&&!i(c.href)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function Gl(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const i=typeof r=="string"?r:r.scheme;i&&n.push(i)}),!t||t.replace(zie,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var EN=Wc.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){jC(t);return}jC(t.scheme,t.optionalSlashes)})},onDestroy(){Die()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!Gl(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!Gl(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!Gl(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Pn(this.options.HTMLAttributes,t),0]:["a",Pn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n;const r=((n=t.attrs)==null?void 0:n.href)||"";return`[${e.renderChildren(t)}](${r})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!Gl(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!Gl(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Dc({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,i=SN(t).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:o=>!!Gl(o,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(s=>{this.options.shouldAutoLink(s.value)&&e.push({text:s.value,data:{href:s.href},index:s.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(Hie({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:i=>!!Gl(i,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(Vie({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(jie({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),Wie=EN,qie=Object.defineProperty,Kie=(t,e)=>{for(var n in e)qie(t,n,{get:e[n],enumerable:!0})},Gie="listItem",WC="textStyle",qC=/^\s*([-+*])\s$/,kN=ei.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Pn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Gie,this.editor.getAttributes(WC)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=fd({find:qC,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=fd({find:qC,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(WC),editor:this.editor})),[t]}}),TN=ei.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Pn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))n=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const o=t.tokens.slice(1),a=e.parseChildren(o);n.push(...a)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>cS(t,e,r=>r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${r.index+1}. `:"- ",n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Zie={};Kie(Zie,{findListItemPos:()=>qh,getNextListDepth:()=>vS,handleBackspace:()=>L1,handleDelete:()=>D1,hasListBefore:()=>_N,hasListItemAfter:()=>Qie,hasListItemBefore:()=>CN,listItemHasSubList:()=>AN,nextListIsDeeper:()=>IN,nextListIsHigher:()=>PN});var qh=(t,e)=>{const{$from:n}=e.selection,r=qn(t,e.schema);let i=null,s=n.depth,o=n.pos,a=null;for(;s>0&&a===null;)i=n.node(s),i.type===r?a=s:(s-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},vS=(t,e)=>{const n=qh(t,e);if(!n)return!1;const[,r]=jte(e,t,n.$pos.pos+4);return r},_N=(t,e,n)=>{const{$anchor:r}=t.selection,i=Math.max(0,r.pos-2),s=t.doc.resolve(i).node();return!(!s||!n.includes(s.type.name))},CN=(t,e)=>{var n;const{$anchor:r}=e.selection,i=e.doc.resolve(r.pos-2);return!(i.index()===0||((n=i.nodeBefore)==null?void 0:n.type.name)!==t)},AN=(t,e,n)=>{if(!n)return!1;const r=qn(t,e.schema);let i=!1;return n.descendants(s=>{s.type===r&&(i=!0)}),i},L1=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!Ml(t.state,e)&&_N(t.state,e,n)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((f,h)=>{f.type.name===e&&c.push({node:f,pos:h})});const u=c.at(-1);if(!u)return!1;const d=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!Ml(t.state,e)||!Gte(t.state))return!1;const r=qh(e,t.state);if(!r)return!1;const s=t.state.doc.resolve(r.$pos.pos-2).node(r.depth),o=AN(e,t.state,s);return CN(e,t.state)&&!o?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},IN=(t,e)=>{const n=vS(t,e),r=qh(t,e);return!r||!n?!1:n>r.depth},PN=(t,e)=>{const n=vS(t,e),r=qh(t,e);return!r||!n?!1:n<r.depth},D1=(t,e)=>{if(!Ml(t.state,e)||!Kte(t.state,e))return!1;const{selection:n}=t.state,{$from:r,$to:i}=n;return!n.empty&&r.sameParent(i)?!1:IN(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():PN(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},Qie=(t,e)=>{var n;const{$anchor:r}=e.selection,i=e.doc.resolve(r.pos-r.parentOffset-2);return!(i.index()===i.parent.childCount-1||((n=i.nodeAfter)==null?void 0:n.type.name)!==t)},MN=an.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&D1(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&D1(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&L1(t,n,r)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&L1(t,n,r)&&(e=!0)}),e}}}}),KC=/^(\s*)(\d+)\.\s+(.*)$/,Xie=/^\s/;function Yie(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n],s=i.match(KC);if(!s)break;const[,o,a,l]=s,c=o.length;let u=l,d=n+1;const f=[i];for(;d<t.length;){const h=t[d];if(h.match(KC))break;if(h.trim()==="")f.push(h),u+=`
`,d+=1;else if(h.match(Xie))f.push(h),u+=`
${h.slice(c+2)}`,d+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:f.join(`
`)}),r=d,n=d}return[e,r]}function ON(t,e,n){var r;const i=[];let s=0;for(;s<t.length;){const o=t[s];if(o.indent===e){const a=o.content.split(`
`),l=((r=a[0])==null?void 0:r.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const h=n.blockTokens(u);c.push(...h)}let d=s+1;const f=[];for(;d<t.length&&t[d].indent>e;)f.push(t[d]),d+=1;if(f.length>0){const h=Math.min(...f.map(m=>m.indent)),p=ON(f,h,n);c.push({type:"list",ordered:!0,start:f[0].number,items:p,raw:f.map(m=>m.raw).join(`
`)})}i.push({type:"list_item",raw:o.raw,tokens:c}),s=d}else s+=1}return i}function Jie(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const r=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")r.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const s=e.parseChildren([i]);r.push({type:"paragraph",content:s})}else{const s=e.parseChildren([i]);s.length>0&&r.push(...s)}}),{type:"listItem",content:r}})}var ese="listItem",GC="textStyle",ZC=/^(\d+)\.\s$/,NN=ei.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",Pn(this.options.HTMLAttributes,n),0]:["ol",Pn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,r=t.items?Jie(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e?.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var r;const i=t.split(`
`),[s,o]=Yie(i);if(s.length===0)return;const a=ON(s,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((r=s[0])==null?void 0:r.number)||1,items:a,raw:i.slice(0,o).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ese,this.editor.getAttributes(GC)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=fd({find:ZC,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=fd({find:ZC,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(GC)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),tse=/^\s*(\[([( |x])?\])\s$/,nse=ei.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Pn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const r=e.parseChildren(t.nestedTokens);n.push(...r)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const i=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return cS(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const i=document.createElement("li"),s=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var d,f;a.ariaLabel=((f=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:f.call(d,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(t),s.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const h=n();if(typeof h!="number")return!1;const p=f.doc.nodeAt(h);return f.setNodeMarkup(h,void 0,{...p?.attrs,checked:d}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{i.setAttribute(u,d)}),i.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,s.append(a,o),i.append(s,l),Object.entries(e).forEach(([u,d])=>{i.setAttribute(u,d)}),{dom:i,contentDOM:l,update:u=>u.type!==this.type?!1:(i.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[fd({find:tse,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),rse=ei.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Pn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const r=s=>{const o=E1(s,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:r},n);return o?[{type:"taskList",raw:o.raw,items:o.items}]:n.blockTokens(s)},i=E1(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:s=>({indentLevel:s[1].length,mainContent:s[4],checked:s[3].toLowerCase()==="x"}),createToken:(s,o)=>({type:"taskItem",raw:"",mainContent:s.mainContent,indentLevel:s.indentLevel,checked:s.checked,text:s.mainContent,tokens:n.inlineTokens(s.mainContent),nestedTokens:o}),customNestedParser:r},n);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});an.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(kN.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(TN.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(MN.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(NN.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(nse.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(rse.configure(this.options.taskList)),t}});var ise=ei.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Pn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];return n.length===1&&n[0].type==="image"?e.parseChildren([n[0]]):e.createNode("paragraph",void 0,e.parseInline(n))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),sse=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,ose=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,ase=Wc.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Pn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[dd({find:sse,type:this.type})]},addPasteRules(){return[Dc({find:ose,type:this.type})]}}),lse=ei.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),cse=Wc.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Pn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const s=i[2].trim();return{type:"underline",raw:i[0],text:s,tokens:n.inlineTokens(s)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function use(t={}){return new Qt({view(e){return new dse(e,t)}})}class dse{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,i=this.editorView.dom,s=i.getBoundingClientRect(),o=s.width/i.offsetWidth,a=s.height/i.offsetHeight;if(n){let d=e.nodeBefore,f=e.nodeAfter;if(d||f){let h=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(h){let p=h.getBoundingClientRect(),m=d?p.bottom:p.top;d&&f&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*a;r={left:p.left,right:p.right,top:m-g,bottom:m+g}}}}if(!r){let d=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;r={left:d.left-f,right:d.left+f,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),f=d.width/l.offsetWidth,h=d.height/l.offsetHeight;c=d.left-l.scrollLeft*f,u=d.top-l.scrollTop*h}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n,e):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=E8(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class En extends Tt{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return En.valid(r)?new En(r):Tt.near(r)}content(){return We.empty}eq(e){return e instanceof En&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new En(e.resolve(n.pos))}getBookmark(){return new xS(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!fse(e)||!hse(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&En.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(En.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!rt.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(En.valid(a))return a}return null}}}En.prototype.visible=!1;En.findFrom=En.findGapCursorFrom;Tt.jsonID("gapcursor",En);class xS{constructor(e){this.pos=e}map(e){return new xS(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return En.valid(n)?new En(n):Tt.near(n)}}function RN(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function fse(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||RN(i.type))return!0;if(i.inlineContent)return!1}}return!0}function hse(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||RN(i.type))return!0;if(i.inlineContent)return!1}}return!0}function pse(){return new Qt({props:{decorations:bse,createSelectionBetween(t,e,n){return e.pos==n.pos&&En.valid(n)?new En(n):null},handleClick:gse,handleKeyDown:mse,handleDOMEvents:{beforeinput:yse}}})}const mse=EO({ArrowLeft:Pp("horiz",-1),ArrowRight:Pp("horiz",1),ArrowUp:Pp("vert",-1),ArrowDown:Pp("vert",1)});function Pp(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof wt){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=En.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new En(c))),!0):!1}}function gse(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!En.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&rt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new En(r))),!0)}function yse(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof En))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=Ae.empty;for(let o=r.length-1;o>=0;o--)i=Ae.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new We(i,0,0));return s.setSelection(wt.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function bse(t){if(!(t.selection instanceof En))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",nn.create(t.doc,[sr.widget(t.selection.head,e,{key:"gapcursor"})])}var Mg=200,lr=function(){};lr.prototype.append=function(e){return e.length?(e=lr.from(e),!this.length&&e||e.length<Mg&&this.leafAppend(e)||this.length<Mg&&e.leafPrepend(this)||this.appendInner(e)):this};lr.prototype.prepend=function(e){return e.length?lr.from(e).append(this):this};lr.prototype.appendInner=function(e){return new wse(this,e)};lr.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?lr.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};lr.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};lr.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};lr.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};lr.from=function(e){return e instanceof lr?e:e&&e.length?new LN(e):lr.empty};var LN=(function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=Mg)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=Mg)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(lr);lr.empty=new LN([]);var wse=(function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(lr);const vse=500;class vs{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((d,f)=>{if(!d.step){i||(i=this.remapping(r,f+1),s=i.maps.length),s--,u.push(d);return}if(i){u.push(new qs(d.map));let h=d.step.map(i.slice(s)),p;h&&o.maybeStep(h).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new qs(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(d.step);if(d.selection)return a=i?d.selection.map(i.slice(s)):d.selection,l=new vs(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let d=e.steps[u].invert(e.docs[u]),f=new qs(e.mapping.maps[u],d,n),h;(h=l&&l.merge(f))&&(f=h,u?s.pop():a=a.slice(0,a.length-1)),s.push(f),n&&(o++,n=void 0),i||(l=f)}let c=o-r.depth;return c>Sse&&(a=xse(a,c),o-=c),new vs(a.append(s),o)}remapping(e,n){let r=new sh;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new vs(this.items.append(e.map(n=>new qs(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(f=>{f.selection&&a--},i);let l=n;this.items.forEach(f=>{let h=s.getMirror(--l);if(h==null)return;o=Math.min(o,h);let p=s.maps[h];if(f.step){let m=e.steps[h].invert(e.docs[h]),g=f.selection&&f.selection.map(s.slice(l+1,h));g&&a++,r.push(new qs(p,m,g))}else r.push(new qs(p))},i);let c=[];for(let f=n;f<o;f++)c.push(new qs(s.maps[f]));let u=this.items.slice(0,i).append(c).append(r),d=new vs(u,a);return d.emptyItemCount()>vse&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let d=new qs(c.invert(),l,u),f,h=i.length-1;(f=i.length&&i[h].merge(d))?i[h]=f:i.push(d)}}else o.map&&r--},this.items.length,0),new vs(lr.from(i.reverse()),s)}}vs.empty=new vs(lr.empty,0);function xse(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class qs{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new qs(n.getMap().invert(),n,this.selection)}}}class Ka{constructor(e,n,r,i,s){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const Sse=20;function Ese(t,e,n,r){let i=n.getMeta(Sc),s;if(i)return i.historyState;n.getMeta(_se)&&(t=new Ka(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Sc))return o.getMeta(Sc).redo?new Ka(t.done.addTransform(n,void 0,r,Jp(e)),t.undone,QC(n.mapping.maps),t.prevTime,t.prevComposition):new Ka(t.done,t.undone.addTransform(n,void 0,r,Jp(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!kse(n,t.prevRanges)),c=o?Cw(t.prevRanges,n.mapping):QC(n.mapping.maps);return new Ka(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,Jp(e)),vs.empty,c,n.time,a??t.prevComposition)}else return(s=n.getMeta("rebased"))?new Ka(t.done.rebased(n,s),t.undone.rebased(n,s),Cw(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Ka(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),Cw(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function kse(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function QC(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,i,s,o)=>e.push(s,o));return e}function Cw(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function Tse(t,e,n){let r=Jp(e),i=Sc.get(e).spec.config,s=(n?t.undone:t.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(n?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),l=new Ka(n?a:s.remaining,n?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(Sc,{redo:n,historyState:l})}let Aw=!1,XC=null;function Jp(t){let e=t.plugins;if(XC!=e){Aw=!1,XC=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Aw=!0;break}}return Aw}const Sc=new on("history"),_se=new on("closeHistory");function Cse(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Qt({key:Sc,state:{init(){return new Ka(vs.empty,vs.empty,null,0,-1)},apply(e,n,r){return Ese(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?BN:r=="historyRedo"?$N:null;return i?(n.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function DN(t,e){return(n,r)=>{let i=Sc.getState(n);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(r){let s=Tse(i,n,t);s&&r(e?s.scrollIntoView():s)}return!0}}const BN=DN(!1,!0),$N=DN(!0,!0);an.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new Qt({key:new on("characterCount"),appendTransaction:(e,n,r)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const s=this.storage.characters({node:r.doc});if(s>i){const o=s-i,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const i=this.storage.characters({node:n.doc}),s=this.storage.characters({node:e.doc});if(s<=r||i>r&&s>r&&s<=i)return!0;if(i>r&&s>r&&s>i||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=s-r,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>r)}})]}});var Ase=an.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[use(this.options)]}}),Ise=an.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new Qt({key:new on("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:i}=e,s=[];if(!n||!r)return nn.create(t,[]);let o=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(i>=c&&i<=c+l.nodeSize-1))return!1;o+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(i>=c&&i<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";s.push(sr.node(c,c+l.nodeSize,{class:this.options.className}))}),nn.create(t,s)}}})]}}),Pse=an.create({name:"gapCursor",addProseMirrorPlugins(){return[pse()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Jt(ct(t,"allowGapCursor",n)))!=null?e:null}}}),Mse=an.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something â¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Qt({key:new on("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,i=[];if(!n)return null;const s=this.editor.isEmpty;return t.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&U0(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];s&&u.push(this.options.emptyEditorClass);const d=sr.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});i.push(d)}return this.options.includeChildren}),nn.create(t,i)}}})]}});an.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new Qt({key:new on("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||FO(n.selection)||t.view.dragging?null:nn.create(n.doc,[sr.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function YC({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var Ose=an.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new on(this.name),n=((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||this.options.node||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(n).includes(i.name));return[new Qt({key:e,appendTransaction:(i,s,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),d=a.content.size,f=c.nodes[n];if(u)return l.insert(d,f.create())},state:{init:(i,s)=>{const o=s.tr.doc.lastChild;return!YC({node:o,types:r})},apply:(i,s)=>{if(!i.docChanged)return s;const o=i.doc.lastChild;return!YC({node:o,types:r})}}})]}}),Nse=an.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>BN(t,e),redo:()=>({state:t,dispatch:e})=>$N(t,e)}},addProseMirrorPlugins(){return[Cse(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),Rse=an.create({name:"starterKit",addExtensions(){var t,e,n,r;const i=[];return this.options.bold!==!1&&i.push(sie.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(eie.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(kN.configure(this.options.bulletList)),this.options.code!==!1&&i.push(lie.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(die.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(fie.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(Ase.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(Pse.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(hie.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(pie.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(Nse.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(mie.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(vie.configure(this.options.italic)),this.options.listItem!==!1&&i.push(TN.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(MN.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(EN.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(NN.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(ise.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(ase.configure(this.options.strike)),this.options.text!==!1&&i.push(lse.configure(this.options.text)),this.options.underline!==!1&&i.push(cse.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&i.push(Ose.configure((r=this.options)==null?void 0:r.trailingNode)),i}}),Lse=Rse,Dse=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Bse=ei.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",Pn(this.options.HTMLAttributes,t)]},parseMarkdown:(t,e)=>e.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var e,n,r,i,s,o;const a=(n=(e=t.attrs)==null?void 0:e.src)!=null?n:"",l=(i=(r=t.attrs)==null?void 0:r.alt)!=null?i:"",c=(o=(s=t.attrs)==null?void 0:s.title)!=null?o:"";return c?`![${l}](${a} "${c}")`:`![${l}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u"||!this.editor.isEditable)return null;const{directions:t,minWidth:e,minHeight:n,alwaysPreserveAspectRatio:r}=this.options.resize;return({node:i,getPos:s,HTMLAttributes:o})=>{const a=document.createElement("img");Object.entries(o).forEach(([u,d])=>{if(d!=null)switch(u){case"width":case"height":break;default:a.setAttribute(u,d);break}}),a.src=o.src;const l=new Pne({element:a,node:i,getPos:s,onResize:(u,d)=>{a.style.width=`${u}px`,a.style.height=`${d}px`},onCommit:(u,d)=>{const f=s();f!==void 0&&this.editor.chain().setNodeSelection(f).updateAttributes(this.name,{width:u,height:d}).run()},onUpdate:(u,d,f)=>u.type===i.type,options:{directions:t,min:{width:e,height:n},preserveAspectRatio:r===!0}}),c=l.dom;return c.style.visibility="hidden",c.style.pointerEvents="none",a.onload=()=>{c.style.visibility="",c.style.pointerEvents=""},l}},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[JO({find:Dse,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),$se=Bse,fr=[];for(var Iw=0;Iw<256;++Iw)fr.push((Iw+256).toString(16).slice(1));function Fse(t,e=0){return(fr[t[e+0]]+fr[t[e+1]]+fr[t[e+2]]+fr[t[e+3]]+"-"+fr[t[e+4]]+fr[t[e+5]]+"-"+fr[t[e+6]]+fr[t[e+7]]+"-"+fr[t[e+8]]+fr[t[e+9]]+"-"+fr[t[e+10]]+fr[t[e+11]]+fr[t[e+12]]+fr[t[e+13]]+fr[t[e+14]]+fr[t[e+15]]).toLowerCase()}var Mp,zse=new Uint8Array(16);function Use(){if(!Mp&&(Mp=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Mp))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mp(zse)}var Hse=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const JC={randomUUID:Hse};function Vse(t,e,n){if(JC.randomUUID&&!t)return JC.randomUUID();t=t||{};var r=t.random||(t.rng||Use)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Fse(r)}function jse(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function Wse(t){const e=t.filter((r,i)=>t.indexOf(r)!==i);return jse(e)}var qse=an.create({name:"uniqueID",priority:1e4,addOptions(){return{attributeName:"id",types:[],generateID:()=>Vse(),filterTransaction:null,updateDocument:!0}},addGlobalAttributes(){return[{types:this.options.types,attributes:{[this.options.attributeName]:{default:null,parseHTML:t=>t.getAttribute(`data-${this.options.attributeName}`),renderHTML:t=>t[this.options.attributeName]?{[`data-${this.options.attributeName}`]:t[this.options.attributeName]}:{}}}}]},onCreate(){var t;if(!this.options.updateDocument)return;const e=this.editor.extensionManager.extensions.find(a=>a.name==="collaboration"),n=this.editor.extensionManager.extensions.find(a=>a.name==="collaborationCaret"),i=[e,n].filter(Boolean).find(a=>{var l;return(l=a?.options)==null?void 0:l.provider}),s=(t=i?.options)==null?void 0:t.provider,o=()=>{const{view:a,state:l}=this.editor,{tr:c,doc:u}=l,{types:d,attributeName:f,generateID:h}=this.options;Rte(u,m=>d.includes(m.type.name)&&m.attrs[f]===null).forEach(({node:m,pos:g})=>{c.setNodeMarkup(g,void 0,{...m.attrs,[f]:h({node:m,pos:g})})}),c.setMeta("addToHistory",!1),a.dispatch(c),s&&s.off("synced",o)};if(i){if(!s)return o();s.on("synced",o)}else return o()},addProseMirrorPlugins(){if(!this.options.updateDocument)return[];let t=null,e=!1;return[new Qt({key:new on("uniqueID"),appendTransaction:(n,r,i)=>{const s=n.some(m=>m.docChanged)&&!r.doc.eq(i.doc),o=this.options.filterTransaction&&n.some(m=>{var g,y;return!((y=(g=this.options).filterTransaction)!=null&&y.call(g,m))});if(n.find(m=>m.getMeta("y-sync$"))||!s||o)return;const{tr:l}=i,{types:c,attributeName:u,generateID:d}=this.options,f=eS(r.doc,n),{mapping:h}=f;if(iS(f).forEach(({newRange:m})=>{const g=OO(i.doc,m,w=>c.includes(w.type.name)),y=g.map(({node:w})=>w.attrs[u]).filter(w=>w!==null);g.forEach(({node:w,pos:k},C)=>{var A;const E=(A=l.doc.nodeAt(k))==null?void 0:A.attrs[u];if(E===null){l.setNodeMarkup(k,void 0,{...w.attrs,[u]:d({node:w,pos:k})});return}const P=g[C+1];if(P&&w.content.size===0){if(l.setNodeMarkup(P.pos,void 0,{...P.node.attrs,[u]:E}),y[C+1]=E,P.node.attrs[u])return;const I=d({node:w,pos:k});return l.setNodeMarkup(k,void 0,{...w.attrs,[u]:I}),y[C]=I,l}const S=Wse(y),{deleted:x}=h.invert().mapResult(k);x&&S.includes(E)&&l.setNodeMarkup(k,void 0,{...w.attrs,[u]:d({node:w,pos:k})})})}),!!l.steps.length)return l.setStoredMarks(i.tr.storedMarks),l},view(n){const r=i=>{var s;t=(s=n.dom.parentElement)!=null&&s.contains(i.target)?n.dom.parentElement:null};return window.addEventListener("dragstart",r),{destroy(){window.removeEventListener("dragstart",r)}}},props:{handleDOMEvents:{drop:(n,r)=>{var i,s;return(t!==n.dom.parentElement||((i=r.dataTransfer)==null?void 0:i.effectAllowed)==="copyMove"||((s=r.dataTransfer)==null?void 0:s.effectAllowed)==="copy")&&(t=null,e=!0),!1},paste:()=>(e=!0,!1)},transformPasted:n=>{if(!e)return n;const{types:r,attributeName:i}=this.options,s=o=>{const a=[];return o.forEach(l=>{if(l.isText){a.push(l);return}if(!r.includes(l.type.name)){a.push(l.copy(s(l.content)));return}const c=l.type.create({...l.attrs,[i]:null},s(l.content),l.marks);a.push(c)}),Ae.from(a)};return e=!1,new We(s(n.content),n.openStart,n.openEnd)}}})]}}),Kse=qse;function Gse(t,e,n,r,i,s,o){const a=window,l=navigator,c=o?.editorObj??window.__currentEditor,u=Jr,d=typeof u=="function"?u:mc(u);return[{label:d("imageContextMenu.fullscreen"),action:()=>{let f=c?.view?.dom||document.querySelector(".editor-container")||a;typeof f.dispatchEvent!="function"&&(f=window),f.dispatchEvent(new CustomEvent("image-fullscreen-request",{detail:{src:t,alt:e},bubbles:!0,composed:!0}))},src:t,icon:"/icons/expand-solid-full.svg"},{label:d("imageContextMenu.copyUrl"),action:async()=>{j0(t,"image URL",l,a)},src:t,icon:"/icons/copy-solid-full.svg"},{label:d("imageContextMenu.delete"),action:()=>{const f=c?.view;if(f?.state&&f?.dispatch){let h=!1;f.state.doc.descendants((p,m)=>{if(!h&&p.type.name==="image"&&p.attrs.id===s)return f.dispatch(f.state.tr.delete(m,m+p.nodeSize)),h=!0,!1})}},disabled:!1,src:t,icon:"/icons/trash-solid-full.svg"}]}function Zse(t,e,n,r,i){const s=((l,c,...u)=>setTimeout(l,c,...u));let o=!1,a;if(t.update(l=>(o=l.open&&l.nodeId!==e,a=l.nodeId,l)),o&&a){t.set({open:!1,nodeId:void 0,src:void 0}),s(()=>{t.set({open:!0,nodeId:e,src:r})},0);return}t.set({open:!0,nodeId:e,src:r})}function Qse(t,e,n,r){if(!t.open||!t.nodeId)return null;const i=t.nodeId,s=t.src||"",o="Image";let a=0,l=1;e?.state?.doc&&e.state.doc.descendants((f,h)=>{if(f.attrs.id===i)return a=h,l=f.nodeSize,!1});const u=Gse(s,o,()=>a,l,!0,i,{editorObj:e});let d={x:0,y:0};return n&&(d=Uu(n.x,n.y)),{items:u,x:d.x,y:d.y}}function Xse(t,e,n){e(t,!1),n()}function Yse(t){t.preventDefault()}var Jse=Ve("<canvas></canvas>"),eoe=Ve('<img draggable="false" style="z-index:2; position:relative;"/>'),toe=Ve('<button type="button" class="editor-image-button svelte-bckq2i" tabindex="0"><!> <!></button>');function noe(t,e){Mn(e,!0);let n=rA,r=iA,i=Ee(!1),s=Ee(!1),o=Ee(void 0),a=Ee(void 0);const l=Wo(),c=400;let u=Xe(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src&&e.node.attrs.src.startsWith("placeholder-")),d=Xe(()=>!M(u)&&e.node.attrs.src&&!e.node.attrs.src.startsWith("placeholder-")),f=Xe(()=>e.node.attrs.blurhash&&(M(u)||!M(i)||M(s))),h=Ee(null);const p=!1;Ze(()=>{const B=e.node.attrs.src;if(!B)return;const F=T1.value[B];if(F){se(h,F,!0);return}const R=DQ(e.node.attrs.dim);if(R){const O=KM(R.width,R.height);se(h,O,!0),T1.update(L=>({...L,[B]:O}))}else M(u)&&se(h,Yb(),!0)});let m=Ee(!1),g=Xe(()=>Yo.value);const y=Xe(()=>e.node.attrs.id||`fallback-${typeof e.getPos=="function"?e.getPos():"unknown"}`);Ze(()=>{Ni.subscribe(B=>{(!B.open||B.nodeId!==M(y))&&se(m,!1)})});function w(){M(g)&&Zse(Ni,M(y),M(g),e.node.attrs.src)}function k(B,F=!1){const R=Tu(B);Yo.set(R),XQ(B,F,n.isDragging,M(u),e.selected,r.justSelected,e.node.attrs.src,e.node.attrs.alt||"Image",e.getPos)&&!e.selected&&(r.justSelectedTimeout&&clearTimeout(r.justSelectedTimeout),r.justSelected=!0,r.justSelectedTimeout=setTimeout(()=>{r.justSelected=!1,r.justSelectedTimeout=null},c))}function C(){n.isDragging=!0,ef("start",{},e.getPos),n.preview=KQ(n.startTarget,n.startPos.x,n.startPos.y,M(u))}function A(){n.longPressTimeout&&(clearTimeout(n.longPressTimeout),n.longPressTimeout=null),n.startTarget=null}function E(B,F,R){A(),n.startPos={x:F,y:R},n.startTarget=B,n.longPressTimeout=setTimeout(()=>{C()},_Z)}function P(){se(i,!0),se(s,!0),setTimeout(()=>{se(s,!1)},400)}function S(){se(i,!1)}function x(B,F){if(B==="start"){const R=F;if(!R?.dataTransfer&&!l)return;if(l){F?.preventDefault();return}R?.dataTransfer&&(R.dataTransfer.setData("application/x-tiptap-node",JSON.stringify({type:"image",attrs:e.node.attrs,pos:e.getPos()})),R.dataTransfer.effectAllowed="move"),n.isDragging=!0,ef("start")}else n.isDragging=!1,Jb(n.preview),ef("end")}function _(B){if(B.touches.length!==1)return;HM();const F=Tu(B);Yo.set(F),E(B.currentTarget,F.x,F.y)}function I(B){if(B.touches.length!==1){A();return}const F=Tu(B);if(!n.isDragging&&n.longPressTimeout&&ZQ(F.x,F.y,n.startPos.x,n.startPos.y,CZ)){A();return}n.isDragging&&(B.preventDefault(),GQ(n.preview,F.x,F.y),HQ(F.x,F.y),ef("move",{touchX:F.x,touchY:F.y,nodePos:e.getPos()}))}function D(B){if(n.longPressTimeout&&(A(),!n.isDragging)){k(B,!0),w();return}if(!n.isDragging)return;B.preventDefault();const F=Tu(B),R=document.elementFromPoint(F.x,F.y);if(R){const L=R.closest(".drop-zone-indicator")?.getAttribute("data-drop-pos");ef("end",{nodeData:{type:"image",attrs:e.node.attrs,pos:e.getPos()},dropX:F.x,dropY:F.y,target:R,dropPosition:L?parseInt(L,10):null})}n.isDragging=!1,Jb(n.preview),n.preview=null}ls(()=>{e.node.attrs.blurhash&&M(o)&&S_(e.node.attrs.blurhash,M(o),M(h)||Yb(),M(u),p),l&&M(a)&&(M(a).addEventListener("touchstart",_,{passive:!1}),M(a).addEventListener("touchmove",I,{passive:!1}),M(a).addEventListener("touchend",D,{passive:!1}))}),Ze(()=>{e.node.attrs.blurhash&&M(o)&&S_(e.node.attrs.blurhash,M(o),M(h)||Yb(),M(u),p)}),Tc(()=>{A(),r.justSelectedTimeout&&clearTimeout(r.justSelectedTimeout),Jb(n.preview),Ni.set({open:!1,nodeId:void 0}),l&&M(a)&&(M(a).removeEventListener("touchstart",_),M(a).removeEventListener("touchmove",I),M(a).removeEventListener("touchend",D)),Object.assign(rA,{isDragging:!1,longPressTimeout:null,startTarget:null,preview:null}),Object.assign(iA,{justSelected:!1,justSelectedTimeout:null}),se(o,void 0)}),rN(t,{children:(B,F)=>{var R=toe();R.__click=[Xse,k,w];var O=ye(R);{var L=j=>{var Q=Jse();let X;Xn(Q,de=>se(o,de),()=>M(o)),Ge(de=>X=rs(Q,1,"blurhash-canvas svelte-bckq2i",null,X,de),[()=>({"is-placeholder":M(u),"fade-out":M(i)&&M(s)&&M(d)})]),we(j,Q)};Ye(O,j=>{M(f)&&j(L)})}var H=Le(O,2);{var U=j=>{var Q=eoe();let X;Q.__contextmenu=[Yse],Ge(de=>{ln(Q,"src",e.node?.attrs?.src),ln(Q,"alt",e.node?.attrs?.alt||""),X=rs(Q,1,"editor-image svelte-bckq2i",null,X,de)},[()=>({"image-loading":!M(i)})]),bs("load",Q,P),bs("error",Q,S),we(j,Q)};Ye(H,j=>{M(d)&&j(U)})}Xn(R,j=>se(a,j),()=>M(a)),Ge(()=>{ln(R,"data-dragging",n.isDragging),ln(R,"aria-label",e.node?.attrs?.alt||"Image"),ln(R,"draggable",!l)}),bs("dragstart",R,j=>x("start",j)),bs("dragend",R,()=>x("end")),bs("dragover",R,function(...j){(l?Q=>Q.preventDefault():void 0)?.apply(this,j)}),bs("drop",R,function(...j){(l?Q=>Q.preventDefault():void 0)?.apply(this,j)}),we(B,R)},$$slots:{default:!0}}),On()}xi(["click","contextmenu"]);const eA=new Set(["image","video"]),tA=".node-image.is-node-focused, .node-video.is-node-focused",roe=an.create({name:"gapCursorFocusReset",onSelectionUpdate(){const{state:t,view:e}=this.editor,n=t.selection,r=i=>{e.dom.querySelectorAll(tA).forEach(s=>{i&&s===i||s.classList.remove("is-node-focused")})};if(n instanceof rt&&eA.has(n.node.type.name)){const i=e.nodeDOM(n.from),s=i?.matches(".node-image, .node-video")?i:i?.closest(".node-image, .node-video");if(s){r(s),s.classList.add("is-node-focused");return}}if(n instanceof En){r();return}r()},onCreate(){const t=e=>{const{view:n}=this.editor,r=e.target;if(n.dom.contains(r))return;n.dom.querySelectorAll(tA).forEach(o=>{o.classList.remove("is-node-focused")});const{state:i}=n,{selection:s}=i;if(s instanceof rt&&eA.has(s.node.type.name)){const o=i.doc.content.size,a=i.doc.resolve(o),l=i.tr.setSelection(wt.near(a)).setMeta("addToHistory",!1);n.dispatch(l)}};document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),this.editor.__outsideClickHandler=t},onDestroy(){const t=this.editor.__outsideClickHandler;t&&(document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t),delete this.editor.__outsideClickHandler)}});function ioe(t){const{placeholderText:e,onSubmitPost:n,onUpdate:r,onCreate:i,onDestroy:s}=t;return Une({extensions:[Lse.configure({paragraph:{HTMLAttributes:{class:"editor-paragraph"}},undoRedo:{depth:100,newGroupDelay:500},dropcursor:{color:"dodgerblue",width:5},link:!1}),Wie.extend({renderHTML({mark:a,HTMLAttributes:l}){return["a",{...l,href:a.attrs.href},0]}}).configure({HTMLAttributes:{class:"preview-link",rel:null,target:"_blank"},autolink:!1,linkOnPaste:!1,defaultProtocol:"https",isAllowedUri:(a,l)=>{if(!l.defaultValidate(a)||a.startsWith("./")||a.startsWith("../"))return!1;try{const c=new URL(a,`${l.defaultProtocol}://`);return l.protocols.includes(c.protocol.replace(":",""))}catch{return!1}},shouldAutoLink:a=>{if(a.length<8)return!1;try{return new URL(a).hostname.length>0&&/^https?:\/\/[a-zA-Z0-9]/.test(a)}catch{return!1}},protocols:[{scheme:"http",optionalSlashes:!1},{scheme:"https",optionalSlashes:!1}]}),$se.configure({HTMLAttributes:{class:"editor-image"},allowBase64:!1}).extend({addAttributes(){return{src:{default:null},blurhash:{default:null},isPlaceholder:{default:null},dim:{default:null},alt:{default:null}}},addNodeView(){return nN(noe)}}),Kse.configure({types:["image","video"],attributeName:"id"}),Ise.configure({className:"is-node-focused",mode:"all"}),roe,Ire,Zre,Yre,Ore,Nre,Rre,Mse.configure({placeholder:e,emptyEditorClass:"is-editor-empty",showOnlyWhenEditable:!0,showOnlyCurrent:!1,includeChildren:!1})],enablePasteRules:["clipboardExtension"],content:{type:"doc",content:[{type:"paragraph"}]},editorProps:{attributes:{class:"tiptap-editor"},handleClickOn(a,l,c,u,d,f){let h=d.target;for(;h&&h!==a.dom;){if(h.tagName==="A"&&h.hasAttribute("href"))return d.ctrlKey||d.metaKey?!1:(d.preventDefault(),!0);h=h.parentElement}return!1},handleKeyDown:(a,l)=>(l.ctrlKey||l.metaKey)&&(l.key==="Enter"||l.key==="NumpadEnter")?(l.preventDefault(),n(),!0):!1},onCreate({editor:a}){window.__currentEditor=a,i?.(a)},onUpdate(){r?.()},onDestroy(){delete window.__currentEditor,s?.()}})}function soe(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function ooe(t,e,n,r,i,s,o=!1){const a=[],l=new s,c=Date.now();if(!n)return a;const u=n.state,d=u.selection,f=d instanceof rt&&d.node?.type?.name==="image";o&&console.log("[dev] insertPlaceholdersIntoEditor:",{fileCount:t.length,isImageNodeSelected:f,selectionType:d.constructor.name,selectionFrom:d.from,selectionTo:d.to,docSize:u.doc.content.size});const h=u.doc.childCount===1&&u.doc.firstChild?.type.name==="paragraph"&&u.doc.firstChild.content.size===0;let p=u.tr,m=f?d.to:d.from;return t.forEach((g,y)=>{const w=g.type.startsWith("video/"),k=l.validateMediaFile(g);if(!k.isValid){r(k.errorMessage||"postComponent.upload_failed");return}const C=`placeholder-${c}-${y}-${soe()}`,A=e[y],E=A?.ox,P=A?.dimensions;try{let S;if(w){const x={src:C,isPlaceholder:!0};S=u.schema.nodes.video.create(x)}else{const x={src:C,isPlaceholder:!0};P&&(x.dim=`${P.width}x${P.height}`,i.update(_=>({..._,[C]:P}))),S=u.schema.nodes.image.create(x)}h&&y===0?(p=p.replaceWith(0,u.doc.content.size,S),m=S.nodeSize):(p=p.insert(m,S),m+=S.nodeSize),a.push({file:g,placeholderId:C,ox:E,dimensions:P})}catch(S){o&&console.error("[uploadHelper] failed to insert media node",{placeholderId:C,file:g.name,isVideo:w,error:S,insertPos:m,docSize:u.doc.content.size}),r(w?"åç»ã®æ¿å¥ã«å¤±æãã¾ãã":"ç»åã®æ¿å¥ã«å¤±æãã¾ãã")}}),a.length>0&&n.view.dispatch(p),a}async function aoe(t,e,n,r=!1){if(Gt.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted before blurhash generation");return}const i=new n,s=t.map(async o=>{if(Gt.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted during blurhash generation");return}try{const a=await i.generateBlurhashForFile(o.file);if(Gt.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted after blurhash generation");return}a&&(o.blurhash=a,e&&uS(e,(l,c)=>{const u=l.type?.name,d=o.file.type.startsWith("video/")&&u==="video",f=!o.file.type.startsWith("video/")&&u==="image";return(d||f)&&(l.attrs?.src===o.placeholderId||l.attrs?.id===o.placeholderId)},(l,c)=>{const u=e.state.tr.setNodeMarkup(c,void 0,{...l.attrs,blurhash:a});e.view.dispatch(u)}))}catch(a){r&&console.warn("[uploadHelper] blurhash generation failed",{file:o.file.name,error:a})}});await Promise.all(s)}async function loe(t,e,n,r,i,s,o,a,l,c,u=!1){const d=[],f={};let h="";const p=[...e];for(let m=0;m<t.length;m++){const g=t[m];if(u&&console.log("[uploadHelper] Processing result",m,":",{success:g.success,url:g.url,filename:g.filename,sizeInfo:g.sizeInfo,aborted:g.aborted}),g.aborted){const y=p.shift();if(y){const w=y.file.type.startsWith("video/");ww(y.placeholderId,w,n,s,u)}continue}if(g.success&&g.url){let y,w=-1;if(g.sizeInfo&&g.sizeInfo.originalFilename&&(w=p.findIndex(k=>k.file.name===g.sizeInfo.originalFilename),w!==-1&&(y=p[w])),!y&&p.length>0&&(y=p[0],w=0),y&&w!==-1&&n){p.splice(w,1);const k=y.file.type.startsWith("video/");if(u&&console.log("[uploadHelper] Replacing placeholder",{placeholderId:y.placeholderId,url:g.url,isVideo:k}),uS(n,(C,A)=>{const E=C.type?.name;return(k&&E==="video"||!k&&E==="image")&&C.attrs?.src===y.placeholderId},(C,A)=>{if(k){const E={...C.attrs,src:g.url,isPlaceholder:!1},P=n.state.tr.setNodeMarkup(A,void 0,E);n.view.dispatch(P)}else{const E={...C.attrs,src:g.url,isPlaceholder:!1,blurhash:y.blurhash??void 0};y.dimensions&&(E.dim=`${y.dimensions.width}x${y.dimensions.height}`);const P=n.state.tr.setNodeMarkup(A,void 0,E);n.view.dispatch(P),s.update(S=>{const x={...S};return delete x[y.placeholderId],y.dimensions&&(x[g.url]=y.dimensions),x})}}),!k){const C=g.nip94||{},A=C.blurhash??C.b??void 0;A&&g.url&&(f[g.url]=A);const E=C.ox??C.o??void 0,P=C.x??void 0;if(E&&g.url?r[g.url]=E:y.ox&&g.url&&(r[g.url]=y.ox),g.url)if(P)i[g.url]=P;else try{const S=await l(g.url);S&&(i[g.url]=S)}catch(S){u&&console.warn("[uploadHelper] failed to calculate x hash (fallback)",{url:g.url,error:S})}}}}else if(!g.success){d.push(g);const y=p.shift();if(y){const w=y.file.type.startsWith("video/");ww(y.placeholderId,w,n,s,u)}}}for(const m of p){const g=m.file.type.startsWith("video/");ww(m.placeholderId,g,n,s,u)}return d.length&&(h=d.length===1?d[0].error||"postComponent.upload_failed":`${d.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`),{failedResults:d,errorMessage:h,imageServerBlurhashMap:f}}let coe=At({value:""}),nA=Ee(null);const SS={get value(){return M(nA)},set:t=>{se(nA,t,!0)}};let bn=At({content:"",canPost:!1,isUploading:!1,uploadErrorMessage:"",postStatus:{sending:!1,success:!1,error:!1,message:""},hasImage:!1});const rA=At({isDragging:!1,startPos:{x:0,y:0},longPressTimeout:null,startTarget:null,preview:null}),iA=At({justSelected:!1,justSelectedTimeout:null});function uoe(t,e){return!!t.trim()||e}function doe(t,e=!1){bn.content=t,bn.hasImage=e,bn.canPost=uoe(t,e)}function Ao(t){bn.postStatus=t}function foe(){bn.content="",bn.canPost=!1,bn.uploadErrorMessage="",bn.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1},bn.hasImage=!1}function hoe(){bn.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1}}let B1;function poe(t){B1=t}async function moe(){B1&&await B1()}function goe(t){const{placeholderText:e,editorContainerEl:n,hasStoredKey:r,submitPost:i,uploadFiles:s,eventCallbacks:o}=t;coe.value=e;const a=ioe({placeholderText:e,onSubmitPost:i,onCreate:d=>{SS.set(d)}});let l=null;const c=a.subscribe(d=>{l=d}),u=Sre({currentEditor:l,editorContainerEl:n,callbacks:o});return poe(i),n&&Object.assign(n,{__uploadFiles:s,__currentEditor:()=>l,__hasStoredKey:()=>r,__postStatus:()=>bn.postStatus,__submitPost:i}),{editor:a,unsubscribe:c,handlers:u}}function yoe(t){const{unsubscribe:e,handlers:n,currentEditor:r,editorContainerEl:i}=t;Ere(n,i),e(),r?.destroy?.(),i&&(delete i.__uploadFiles,delete i.__currentEditor,delete i.__hasStoredKey,delete i.__postStatus,delete i.__submitPost)}class boe{allowedOrigins;console;windowObj;constructor(e={}){this.allowedOrigins=e.allowedOrigins||[],this.console=e.console||(typeof console<"u"?console:{log:()=>{},warn:()=>{},error:()=>{}}),this.windowObj=e.window||(typeof window<"u"?window:void 0)}isInIframe(){if(!this.windowObj)return!1;try{return this.windowObj.self!==this.windowObj.top}catch{return!0}}getParentOrigin(){if(!this.windowObj||!this.isInIframe())return null;try{return this.windowObj.parent.location.origin}catch{if(this.windowObj.document&&this.windowObj.document.referrer)try{return new URL(this.windowObj.document.referrer).origin}catch(n){return this.console.warn("è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ãåå¾ã§ãã¾ããã§ãã:",n),null}return null}}isOriginAllowed(e){return e?this.allowedOrigins.length===0?!0:this.allowedOrigins.includes(e):!1}sendMessageToParent(e){if(!this.windowObj||!this.isInIframe())return!1;const n=this.getParentOrigin();if(!n)return this.console.warn("è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ãç¹å®ã§ããªããããpostMessageãéä¿¡ã§ãã¾ãã"),!1;if(!this.isOriginAllowed(n))return this.console.warn(`è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ ${n} ã¯è¨±å¯ããã¦ãã¾ãã`),!1;try{return this.windowObj.parent.postMessage(e,n),this.console.log(`è¦ªã¦ã£ã³ãã¦ (${n}) ã«ã¡ãã»ã¼ã¸ãéä¿¡ãã¾ãã:`,e),!0}catch(r){return this.console.error("postMessageã®éä¿¡ã«å¤±æãã¾ãã:",r),!1}}notifyPostSuccess(){return this.sendMessageToParent({type:"POST_SUCCESS",timestamp:Date.now()})}notifyPostError(e){return this.sendMessageToParent({type:"POST_ERROR",timestamp:Date.now(),error:e})}setAllowedOrigins(e){this.allowedOrigins=e}addAllowedOrigin(e){this.allowedOrigins.includes(e)||this.allowedOrigins.push(e)}}const woe=new boe;class voe{static validatePost(e,n,r){return e.trim()?r?n?{valid:!0}:{valid:!1,error:"login_required"}:{valid:!1,error:"nostr_not_ready"}:{valid:!1,error:"empty_content"}}}class sA{static async buildEvent(e,n,r,i,s,o,a){const l=Array.isArray(r)&&r.length?[...r]:Array.isArray(n)?n.map(u=>["t",u.toLowerCase()]):[];if(a){const u=a();u&&l.push(u)}if(s&&o){for(const[u,d]of Object.entries(s))if(u&&d&&d.m){const f=await o({url:u,...d});l.push(f)}}const c={kind:1,content:e,tags:l,created_at:Math.floor(Date.now()/1e3)};return i&&(c.pubkey=i),c}}class xoe{constructor(e,n){this.rxNostr=e,this.console=n}sendEvent(e,n){return new Promise(r=>{let i=!1,s=!1,o=null;const a=()=>{try{o?.unsubscribe()}catch{}},l={next:c=>{this.console.log(`ãªã¬ã¼ ${c.from} ã¸ã®éä¿¡çµæ:`,c.ok?"æå":"å¤±æ"),c.ok&&!i&&(s=!0,i=!0,a(),r({success:!0}))},error:c=>{this.console.error("éä¿¡ã¨ã©ã¼:",c),i||(i=!0,a(),r({success:!1,error:"post_error"}))},complete:()=>{!i&&!s&&(i=!0,a(),r({success:!1,error:"post_error"}))}};o=this.rxNostr.send(e,n?{signer:n}:void 0).subscribe(l),setTimeout(()=>{i||(i=!0,a(),r(s?{success:!0}:{success:!1,error:"post_error"}))},1e4)})}}class Soe{constructor(e,n={}){this.deps=n,e&&this.setRxNostr(e),this.deps.console=n.console||(typeof window<"u"?window.console:{}),this.deps.createImetaTagFn=n.createImetaTagFn||jM,this.deps.getClientTagFn=n.getClientTagFn||Xne,this.deps.seckeySignerFn=n.seckeySignerFn||pv,this.deps.extractContentWithImagesFn=n.extractContentWithImagesFn||uN,this.deps.extractImageBlurhashMapFn=n.extractImageBlurhashMapFn||WM,this.deps.resetEditorStateFn=n.resetEditorStateFn||foe,this.deps.resetPostStatusFn=n.resetPostStatusFn||hoe,this.deps.iframeMessageService=n.iframeMessageService||woe}rxNostr=null;eventSender=null;setRxNostr(e){this.rxNostr=e,this.eventSender=new xoe(e,this.deps.console||console)}validatePost(e){const n=this.deps.authStateStore||{value:br.value};return voe.validatePost(e,n.value.isAuthenticated,!!this.rxNostr)}async submitPost(e,n){const r=this.validatePost(e);if(!r.valid)return this.deps.iframeMessageService?.notifyPostError(r.error),{success:!1,error:r.error};if(!this.eventSender)return this.deps.iframeMessageService?.notifyPostError("nostr_not_ready"),{success:!1,error:"nostr_not_ready"};try{const i=this.deps.authStateStore||{value:br.value},s=this.deps.hashtagStore||Ja,{hashtags:o,tags:a}=this.getHashtagArrays(s),l=this.deps.keyManager||k1,c=this.deps.window||(typeof window<"u"?window:void 0),u=i.value;if(u.type==="nostr-login"&&l.isWindowNostrAvailable()&&c?.nostr)try{const g=u.pubkey;if(!g)return this.deps.iframeMessageService?.notifyPostError("pubkey_not_found"),{success:!1,error:"pubkey_not_found"};const y=await sA.buildEvent(e,o,a,g,n,this.deps.createImetaTagFn,this.deps.getClientTagFn);if(typeof c.nostr.signEvent=="function"){const w=await c.nostr.signEvent(y);this.deps.console?.log("ç½²åæ¸ã¿ã¤ãã³ã:",w);const k=await this.eventSender.sendEvent(w);return k.success?this.deps.iframeMessageService?.notifyPostSuccess():this.deps.iframeMessageService?.notifyPostError(k.error),k}else return this.deps.iframeMessageService?.notifyPostError("nostr_sign_event_not_supported"),{success:!1,error:"nostr_sign_event_not_supported"}}catch(g){return this.deps.console?.error("window.nostrã§ã®æç¨¿ã¨ã©ã¼:",g),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}const f=l.getFromStore()||l.loadFromStorage();if(!f)return this.deps.iframeMessageService?.notifyPostError("key_not_found"),{success:!1,error:"key_not_found"};const h=await sA.buildEvent(e,o,a,void 0,n,this.deps.createImetaTagFn,this.deps.getClientTagFn),p=this.deps.seckeySignerFn?this.deps.seckeySignerFn(f):pv(f),m=await this.eventSender.sendEvent(h,p);return m.success?this.deps.iframeMessageService?.notifyPostSuccess():this.deps.iframeMessageService?.notifyPostError(m.error),m}catch(i){return this.deps.console?.error("æç¨¿ã¨ã©ã¼:",i),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}}getEventSender(){return this.eventSender}getHashtagArrays(e){const n=e||Ja,r=this.deps.hashtagSnapshotFn;if(r){const i=r(n);return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}if(n===Ja)try{const i=Qne();return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}catch(i){this.deps.console?.warn("hashtag_snapshot_failed",i)}return{hashtags:Array.isArray(n?.hashtags)?[...n.hashtags]:[],tags:Array.isArray(n?.tags)?n.tags.map(i=>[...i]):[]}}preparePostContent(e){return this.deps.extractContentWithImagesFn(e)||""}prepareImageBlurhashMap(e,n,r){const i=this.deps.extractImageBlurhashMapFn(e),s={};for(const[o,a]of Object.entries(i))s[o]={m:qM(o),blurhash:a,ox:n[o],x:r[o]};return s}async performPostSubmission(e,n,r,i,s,o){const a=this.preparePostContent(e),l=this.prepareImageBlurhashMap(e,n,r);i?.();try{const c=await this.submitPost(a,l);c.success?s?.():o?.(c.error||"post_error")}catch{o?.("post_error")}}applyEmptyStateToEditor(e){e.chain().clearContent().run()}resetPostContent(e){this.applyEmptyStateToEditor(e),this.deps.resetEditorStateFn?.(),this.deps.resetPostStatusFn?.()}clearContentAfterSuccess(e){this.applyEmptyStateToEditor(e)}}function Eoe(t,e){return e.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}}))})),Object.freeze(t)}function FN(t,e){return new Promise((function(n,r){let i;return koe(t).then((function(s){try{return i=s,n(new Blob([e.slice(0,2),i,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}}),r)}))}const koe=t=>new Promise(((e,n)=>{const r=new FileReader;r.addEventListener("load",(({target:{result:i}})=>{const s=new DataView(i);let o=0;if(s.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=s.getUint16(o);if(a===65498)break;const l=s.getUint16(o+2);if(a===65505&&s.getUint32(o+4)===1165519206){const c=o+10;let u;switch(s.getUint16(c)){case 18761:u=!0;break;case 19789:u=!1;break;default:return n("TIFF header contains invalid endian")}if(s.getUint16(c+2,u)!==42)return n("TIFF header contains invalid version");const d=s.getUint32(c+4,u),f=c+d+2+12*s.getUint16(c+d,u);for(let h=c+d+2;h<f;h+=12)if(s.getUint16(h,u)==274){if(s.getUint16(h+2,u)!==3)return n("Orientation data type is invalid");if(s.getUint32(h+4,u)!==1)return n("Orientation data count is invalid");s.setUint16(h+8,1,u);break}return e(i.slice(o,o+2+l))}o+=2+l}return e(new Blob)})),r.readAsArrayBuffer(t)}));var Og={},Toe={get exports(){return Og},set exports(t){Og=t}};(function(t){var e,n,r={};Toe.exports=r,r.parse=function(i,s){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,c={},u=new Uint8Array(i),d=u.length-4;a(u,d)!=101010256;)d--;l=d,l+=4;var f=o(u,l+=4);o(u,l+=2);var h=a(u,l+=2),p=a(u,l+=4);l+=4,l=p;for(var m=0;m<f;m++){a(u,l),l+=4,l+=4,l+=4,a(u,l+=4),h=a(u,l+=4);var g=a(u,l+=4),y=o(u,l+=4),w=o(u,l+2),k=o(u,l+4);l+=6;var C=a(u,l+=8);l+=4,l+=y+w+k,r._readLocal(u,C,c,h,g,s)}return c},r._readLocal=function(i,s,o,a,l,c){var u=r.bin.readUshort,d=r.bin.readUint;d(i,s),u(i,s+=4),u(i,s+=2);var f=u(i,s+=2);d(i,s+=2),d(i,s+=4),s+=4;var h=u(i,s+=8),p=u(i,s+=2);s+=2;var m=r.bin.readUTF8(i,s,h);if(s+=h,s+=p,c)o[m]={size:l,csize:a};else{var g=new Uint8Array(i.buffer,s);if(f==0)o[m]=new Uint8Array(g.buffer.slice(s,s+a));else{if(f!=8)throw"unknown compression method: "+f;var y=new Uint8Array(l);r.inflateRaw(g,y),o[m]=y}}},r.inflateRaw=function(i,s){return r.F.inflate(i,s)},r.inflate=function(i,s){return i[0],i[1],r.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-6),s)},r.deflate=function(i,s){s==null&&(s={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*i.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(i,a,o,s.level);var l=r.adler(i,0,i.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(i,s){s==null&&(s={level:6});var o=new Uint8Array(50+Math.floor(1.1*i.length)),a=r.F.deflateRaw(i,o,a,s.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(i,s){s==null&&(s=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,c={};for(var u in i){var d=!r._noNeed(u)&&!s,f=i[u],h=r.crc.crc(f,0,f.length);c[u]={cpr:d,usize:f.length,crc:h,file:d?r.deflateRaw(f):f}}for(var u in c)o+=c[u].file.length+30+46+2*r.bin.sizeUTF8(u);o+=22;var p=new Uint8Array(o),m=0,g=[];for(var u in c){var y=c[u];g.push(m),m=r._writeHeader(p,m,u,y,0)}var w=0,k=m;for(var u in c)y=c[u],g.push(m),m=r._writeHeader(p,m,u,y,1,g[w++]);var C=m-k;return a(p,m,101010256),m+=4,l(p,m+=4,w),l(p,m+=2,w),a(p,m+=2,C),a(p,m+=4,k),m+=4,m+=2,p.buffer},r._noNeed=function(i){var s=i.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(s)!=-1},r._writeHeader=function(i,s,o,a,l,c){var u=r.bin.writeUint,d=r.bin.writeUshort,f=a.file;return u(i,s,l==0?67324752:33639248),s+=4,l==1&&(s+=2),d(i,s,20),d(i,s+=2,0),d(i,s+=2,a.cpr?8:0),u(i,s+=2,0),u(i,s+=4,a.crc),u(i,s+=4,f.length),u(i,s+=4,a.usize),d(i,s+=4,r.bin.sizeUTF8(o)),d(i,s+=2,0),s+=2,l==1&&(s+=2,s+=2,u(i,s+=6,c),s+=4),s+=r.bin.writeUTF8(i,s,o),l==0&&(i.set(f,s),s+=f.length),s},r.crc={table:(function(){for(var i=new Uint32Array(256),s=0;s<256;s++){for(var o=s,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;i[s]=o}return i})(),update:function(i,s,o,a){for(var l=0;l<a;l++)i=r.crc.table[255&(i^s[o+l])]^i>>>8;return i},crc:function(i,s,o){return 4294967295^r.crc.update(4294967295,i,s,o)}},r.adler=function(i,s,o){for(var a=1,l=0,c=s,u=s+o;c<u;){for(var d=Math.min(c+5552,u);c<d;)l+=a+=i[c++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(i,s){return i[s]|i[s+1]<<8},writeUshort:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255},readUint:function(i,s){return 16777216*i[s+3]+(i[s+2]<<16|i[s+1]<<8|i[s])},writeUint:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255,i[s+2]=o>>16&255,i[s+3]=o>>24&255},readASCII:function(i,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(i[s+l]);return a},writeASCII:function(i,s,o){for(var a=0;a<o.length;a++)i[s+a]=o.charCodeAt(a)},pad:function(i){return i.length<2?"0"+i:i},readUTF8:function(i,s,o){for(var a,l="",c=0;c<o;c++)l+="%"+r.bin.pad(i[s+c].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(i,s,o)}return a},writeUTF8:function(i,s,o){for(var a=o.length,l=0,c=0;c<a;c++){var u=o.charCodeAt(c);if((4294967168&u)==0)i[s+l]=u,l++;else if((4294965248&u)==0)i[s+l]=192|u>>6,i[s+l+1]=128|u>>0&63,l+=2;else if((4294901760&u)==0)i[s+l]=224|u>>12,i[s+l+1]=128|u>>6&63,i[s+l+2]=128|u>>0&63,l+=3;else{if((4292870144&u)!=0)throw"e";i[s+l]=240|u>>18,i[s+l+1]=128|u>>12&63,i[s+l+2]=128|u>>6&63,i[s+l+3]=128|u>>0&63,l+=4}}return l},sizeUTF8:function(i){for(var s=i.length,o=0,a=0;a<s;a++){var l=i.charCodeAt(a);if((4294967168&l)==0)o++;else if((4294965248&l)==0)o+=2;else if((4294901760&l)==0)o+=3;else{if((4292870144&l)!=0)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(i,s,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],c=r.F.U,u=r.F._goodIndex;r.F._hash;var d=r.F._putsE,f=0,h=o<<3,p=0,m=i.length;if(a==0){for(;f<m;)d(s,h,f+(I=Math.min(65535,m-f))==m?1:0),h=r.F._copyExact(i,f,I,s,h+8),f+=I;return h>>>3}var g=c.lits,y=c.strt,w=c.prev,k=0,C=0,A=0,E=0,P=0,S=0;for(m>2&&(y[S=r.F._hash(i,0)]=0),f=0;f<m;f++){if(P=S,f+1<m-2){S=r.F._hash(i,f+1);var x=f+1&32767;w[x]=y[S],y[S]=x}if(p<=f){(k>14e3||C>26697)&&m-f>100&&(p<f&&(g[k]=f-p,k+=2,p=f),h=r.F._writeBlock(f==m-1||p==m?1:0,g,k,E,i,A,f-A,s,h),k=C=E=0,A=f);var _=0;f<m-2&&(_=r.F._bestMatch(i,f,w,P,Math.min(l[2],m-f),l[3]));var I=_>>>16,D=65535&_;if(_!=0){D=65535&_;var B=u(I=_>>>16,c.of0);c.lhst[257+B]++;var F=u(D,c.df0);c.dhst[F]++,E+=c.exb[B]+c.dxb[F],g[k]=I<<23|f-p,g[k+1]=D<<16|B<<8|F,k+=2,p=f+I}else c.lhst[i[f]]++;C++}}for(A==f&&i.length!=0||(p<f&&(g[k]=f-p,k+=2,p=f),h=r.F._writeBlock(1,g,k,E,i,A,f-A,s,h),k=0,C=0,k=C=E=0,A=f);(7&h)!=0;)h++;return h>>>3},r.F._bestMatch=function(i,s,o,a,l,c){var u=32767&s,d=o[u],f=u-d+32768&32767;if(d==u||a!=r.F._hash(i,s-f))return 0;for(var h=0,p=0,m=Math.min(32767,s);f<=m&&--c!=0&&d!=u;){if(h==0||i[s+h]==i[s+h-f]){var g=r.F._howLong(i,s,f);if(g>h){if(p=f,(h=g)>=l)break;f+2<g&&(g=f+2);for(var y=0,w=0;w<g-2;w++){var k=s-f+w+32768&32767,C=k-o[k]+32768&32767;C>y&&(y=C,d=k)}}}f+=(u=d)-(d=o[u])+32768&32767}return h<<16|p},r.F._howLong=function(i,s,o){if(i[s]!=i[s-o]||i[s+1]!=i[s+1-o]||i[s+2]!=i[s+2-o])return 0;var a=s,l=Math.min(i.length,s+258);for(s+=3;s<l&&i[s]==i[s-o];)s++;return s-a},r.F._hash=function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(i,s,o,a,l,c,u,d,f){var h,p,m,g,y,w,k,C,A,E=r.F.U,P=r.F._putsF,S=r.F._putsE;E.lhst[256]++,p=(h=r.F.getTrees())[0],m=h[1],g=h[2],y=h[3],w=h[4],k=h[5],C=h[6],A=h[7];var x=32+((f+3&7)==0?0:8-(f+3&7))+(u<<3),_=a+r.F.contSize(E.fltree,E.lhst)+r.F.contSize(E.fdtree,E.dhst),I=a+r.F.contSize(E.ltree,E.lhst)+r.F.contSize(E.dtree,E.dhst);I+=14+3*k+r.F.contSize(E.itree,E.ihst)+(2*E.ihst[16]+3*E.ihst[17]+7*E.ihst[18]);for(var D=0;D<286;D++)E.lhst[D]=0;for(D=0;D<30;D++)E.dhst[D]=0;for(D=0;D<19;D++)E.ihst[D]=0;var B=x<_&&x<I?0:_<I?1:2;if(P(d,f,i),P(d,f+1,B),f+=3,B==0){for(;(7&f)!=0;)f++;f=r.F._copyExact(l,c,u,d,f)}else{var F,R;if(B==1&&(F=E.fltree,R=E.fdtree),B==2){r.F.makeCodes(E.ltree,p),r.F.revCodes(E.ltree,p),r.F.makeCodes(E.dtree,m),r.F.revCodes(E.dtree,m),r.F.makeCodes(E.itree,g),r.F.revCodes(E.itree,g),F=E.ltree,R=E.dtree,S(d,f,y-257),S(d,f+=5,w-1),S(d,f+=5,k-4),f+=4;for(var O=0;O<k;O++)S(d,f+3*O,E.itree[1+(E.ordr[O]<<1)]);f+=3*k,f=r.F._codeTiny(C,E.itree,d,f),f=r.F._codeTiny(A,E.itree,d,f)}for(var L=c,H=0;H<o;H+=2){for(var U=s[H],j=U>>>23,Q=L+(8388607&U);L<Q;)f=r.F._writeLit(l[L++],F,d,f);if(j!=0){var X=s[H+1],de=X>>16,le=X>>8&255,J=255&X;S(d,f=r.F._writeLit(257+le,F,d,f),j-E.of0[le]),f+=E.exb[le],P(d,f=r.F._writeLit(J,R,d,f),de-E.df0[J]),f+=E.dxb[J],L+=j}}f=r.F._writeLit(256,F,d,f)}return f},r.F._copyExact=function(i,s,o,a,l){var c=l>>>3;return a[c]=o,a[c+1]=o>>>8,a[c+2]=255-a[c],a[c+3]=255-a[c+1],c+=4,a.set(new Uint8Array(i.buffer,s,o),c),l+(o+4<<3)},r.F.getTrees=function(){for(var i=r.F.U,s=r.F._hufTree(i.lhst,i.ltree,15),o=r.F._hufTree(i.dhst,i.dtree,15),a=[],l=r.F._lenCodes(i.ltree,a),c=[],u=r.F._lenCodes(i.dtree,c),d=0;d<a.length;d+=2)i.ihst[a[d]]++;for(d=0;d<c.length;d+=2)i.ihst[c[d]]++;for(var f=r.F._hufTree(i.ihst,i.itree,7),h=19;h>4&&i.itree[1+(i.ordr[h-1]<<1)]==0;)h--;return[s,o,f,l,u,h,a,c]},r.F.getSecond=function(i){for(var s=[],o=0;o<i.length;o+=2)s.push(i[o+1]);return s},r.F.nonZero=function(i){for(var s="",o=0;o<i.length;o+=2)i[o+1]!=0&&(s+=(o>>1)+",");return s},r.F.contSize=function(i,s){for(var o=0,a=0;a<s.length;a++)o+=s[a]*i[1+(a<<1)];return o},r.F._codeTiny=function(i,s,o,a){for(var l=0;l<i.length;l+=2){var c=i[l],u=i[l+1];a=r.F._writeLit(c,s,o,a);var d=c==16?2:c==17?3:7;c>15&&(r.F._putsE(o,a,u,d),a+=d)}return a},r.F._lenCodes=function(i,s){for(var o=i.length;o!=2&&i[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=i[a+1],c=a+3<o?i[a+3]:-1,u=a+5<o?i[a+5]:-1,d=a==0?-1:i[a-1];if(l==0&&c==l&&u==l){for(var f=a+5;f+2<o&&i[f+2]==l;)f+=2;(h=Math.min(f+1-a>>>1,138))<11?s.push(17,h-3):s.push(18,h-11),a+=2*h-2}else if(l==d&&c==l&&u==l){for(f=a+5;f+2<o&&i[f+2]==l;)f+=2;var h=Math.min(f+1-a>>>1,6);s.push(16,h-3),a+=2*h-2}else s.push(l,0)}return o>>>1},r.F._hufTree=function(i,s,o){var a=[],l=i.length,c=s.length,u=0;for(u=0;u<c;u+=2)s[u]=0,s[u+1]=0;for(u=0;u<l;u++)i[u]!=0&&a.push({lit:u,f:i[u]});var d=a.length,f=a.slice(0);if(d==0)return 0;if(d==1){var h=a[0].lit;return f=h==0?1:0,s[1+(h<<1)]=1,s[1+(f<<1)]=1,1}a.sort((function(C,A){return C.f-A.f}));var p=a[0],m=a[1],g=0,y=1,w=2;for(a[0]={lit:-1,f:p.f+m.f,l:p,r:m,d:0};y!=d-1;)p=g!=y&&(w==d||a[g].f<a[w].f)?a[g++]:a[w++],m=g!=y&&(w==d||a[g].f<a[w].f)?a[g++]:a[w++],a[y++]={lit:-1,f:p.f+m.f,l:p,r:m};var k=r.F.setDepth(a[y-1],0);for(k>o&&(r.F.restrictDepth(f,o,k),k=o),u=0;u<d;u++)s[1+(f[u].lit<<1)]=f[u].d;return k},r.F.setDepth=function(i,s){return i.lit!=-1?(i.d=s,s):Math.max(r.F.setDepth(i.l,s+1),r.F.setDepth(i.r,s+1))},r.F.restrictDepth=function(i,s,o){var a=0,l=1<<o-s,c=0;for(i.sort((function(d,f){return f.d==d.d?d.f-f.f:f.d-d.d})),a=0;a<i.length&&i[a].d>s;a++){var u=i[a].d;i[a].d=s,c+=l-(1<<o-u)}for(c>>>=o-s;c>0;)(u=i[a].d)<s?(i[a].d++,c-=1<<s-u-1):a++;for(;a>=0;a--)i[a].d==s&&c<0&&(i[a].d--,c++);c!=0&&console.log("debt left")},r.F._goodIndex=function(i,s){var o=0;return s[16|o]<=i&&(o|=16),s[8|o]<=i&&(o|=8),s[4|o]<=i&&(o|=4),s[2|o]<=i&&(o|=2),s[1|o]<=i&&(o|=1),o},r.F._writeLit=function(i,s,o,a){return r.F._putsF(o,a,s[i<<1]),a+s[1+(i<<1)]},r.F.inflate=function(i,s){var o=Uint8Array;if(i[0]==3&&i[1]==0)return s||new o(0);var a=r.F,l=a._bitsF,c=a._bitsE,u=a._decodeTiny,d=a.makeCodes,f=a.codes2map,h=a._get17,p=a.U,m=s==null;m&&(s=new o(i.length>>>2<<3));for(var g,y,w=0,k=0,C=0,A=0,E=0,P=0,S=0,x=0,_=0;w==0;)if(w=l(i,_,1),k=l(i,_+1,2),_+=3,k!=0){if(m&&(s=r.F._check(s,x+(1<<17))),k==1&&(g=p.flmap,y=p.fdmap,P=511,S=31),k==2){C=c(i,_,5)+257,A=c(i,_+5,5)+1,E=c(i,_+10,4)+4,_+=14;for(var I=0;I<38;I+=2)p.itree[I]=0,p.itree[I+1]=0;var D=1;for(I=0;I<E;I++){var B=c(i,_+3*I,3);p.itree[1+(p.ordr[I]<<1)]=B,B>D&&(D=B)}_+=3*E,d(p.itree,D),f(p.itree,D,p.imap),g=p.lmap,y=p.dmap,_=u(p.imap,(1<<D)-1,C+A,i,_,p.ttree);var F=a._copyOut(p.ttree,0,C,p.ltree);P=(1<<F)-1;var R=a._copyOut(p.ttree,C,A,p.dtree);S=(1<<R)-1,d(p.ltree,F),f(p.ltree,F,g),d(p.dtree,R),f(p.dtree,R,y)}for(;;){var O=g[h(i,_)&P];_+=15&O;var L=O>>>4;if(!(L>>>8))s[x++]=L;else{if(L==256)break;var H=x+L-254;if(L>264){var U=p.ldef[L-257];H=x+(U>>>3)+c(i,_,7&U),_+=7&U}var j=y[h(i,_)&S];_+=15&j;var Q=j>>>4,X=p.ddef[Q],de=(X>>>4)+l(i,_,15&X);for(_+=15&X,m&&(s=r.F._check(s,x+(1<<17)));x<H;)s[x]=s[x++-de],s[x]=s[x++-de],s[x]=s[x++-de],s[x]=s[x++-de];x=H}}}else{(7&_)!=0&&(_+=8-(7&_));var le=4+(_>>>3),J=i[le-4]|i[le-3]<<8;m&&(s=r.F._check(s,x+J)),s.set(new o(i.buffer,i.byteOffset+le,J),x),_=le+J<<3,x+=J}return s.length==x?s:s.slice(0,x)},r.F._check=function(i,s){var o=i.length;if(s<=o)return i;var a=new Uint8Array(Math.max(o<<1,s));return a.set(i,0),a},r.F._decodeTiny=function(i,s,o,a,l,c){for(var u=r.F._bitsE,d=r.F._get17,f=0;f<o;){var h=i[d(a,l)&s];l+=15&h;var p=h>>>4;if(p<=15)c[f]=p,f++;else{var m=0,g=0;p==16?(g=3+u(a,l,2),l+=2,m=c[f-1]):p==17?(g=3+u(a,l,3),l+=3):p==18&&(g=11+u(a,l,7),l+=7);for(var y=f+g;f<y;)c[f]=m,f++}}return l},r.F._copyOut=function(i,s,o,a){for(var l=0,c=0,u=a.length>>>1;c<o;){var d=i[c+s];a[c<<1]=0,a[1+(c<<1)]=d,d>l&&(l=d),c++}for(;c<u;)a[c<<1]=0,a[1+(c<<1)]=0,c++;return l},r.F.makeCodes=function(i,s){for(var o,a,l,c,u=r.F.U,d=i.length,f=u.bl_count,h=0;h<=s;h++)f[h]=0;for(h=1;h<d;h+=2)f[i[h]]++;var p=u.next_code;for(o=0,f[0]=0,a=1;a<=s;a++)o=o+f[a-1]<<1,p[a]=o;for(l=0;l<d;l+=2)(c=i[l+1])!=0&&(i[l]=p[c],p[c]++)},r.F.codes2map=function(i,s,o){for(var a=i.length,l=r.F.U.rev15,c=0;c<a;c+=2)if(i[c+1]!=0)for(var u=c>>1,d=i[c+1],f=u<<4|d,h=s-d,p=i[c]<<h,m=p+(1<<h);p!=m;)o[l[p]>>>15-s]=f,p++},r.F.revCodes=function(i,s){for(var o=r.F.U.rev15,a=15-s,l=0;l<i.length;l+=2){var c=i[l]<<s-i[l+1];i[l]=o[c]>>>a}},r.F._putsE=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8},r.F._putsF=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8,i[a+2]|=o>>>16},r.F._bitsE=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8)>>>(7&s)&(1<<o)-1},r.F._bitsF=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)&(1<<o)-1},r.F._get17=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)},r.F._get25=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16|i[3+(s>>>3)]<<24)>>>(7&s)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),(function(){for(var i=r.F.U,s=0;s<32768;s++){var o=s;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,i.rev15[s]=(o>>>16|o<<16)>>>17}function a(l,c,u){for(;c--!=0;)l.push(0,u)}for(s=0;s<32;s++)i.ldef[s]=i.of0[s]<<3|i.exb[s],i.ddef[s]=i.df0[s]<<4|i.dxb[s];a(i.fltree,144,8),a(i.fltree,112,9),a(i.fltree,24,7),a(i.fltree,8,8),r.F.makeCodes(i.fltree,9),r.F.codes2map(i.fltree,9,i.flmap),r.F.revCodes(i.fltree,9),a(i.fdtree,32,5),r.F.makeCodes(i.fdtree,5),r.F.codes2map(i.fdtree,5,i.fdmap),r.F.revCodes(i.fdtree,5),a(i.itree,19,0),a(i.ltree,286,0),a(i.dtree,30,0),a(i.ttree,320,0)})()})();var _oe=Eoe({__proto__:null,default:Og},[Og]);const gs=(function(){var t={nextZero(u,d){for(;u[d]!=0;)d++;return d},readUshort:(u,d)=>u[d]<<8|u[d+1],writeUshort(u,d,f){u[d]=f>>8&255,u[d+1]=255&f},readUint:(u,d)=>16777216*u[d]+(u[d+1]<<16|u[d+2]<<8|u[d+3]),writeUint(u,d,f){u[d]=f>>24&255,u[d+1]=f>>16&255,u[d+2]=f>>8&255,u[d+3]=255&f},readASCII(u,d,f){let h="";for(let p=0;p<f;p++)h+=String.fromCharCode(u[d+p]);return h},writeASCII(u,d,f){for(let h=0;h<f.length;h++)u[d+h]=f.charCodeAt(h)},readBytes(u,d,f){const h=[];for(let p=0;p<f;p++)h.push(u[d+p]);return h},pad:u=>u.length<2?`0${u}`:u,readUTF8(u,d,f){let h,p="";for(let m=0;m<f;m++)p+=`%${t.pad(u[d+m].toString(16))}`;try{h=decodeURIComponent(p)}catch{return t.readASCII(u,d,f)}return h}};function e(u,d,f,h){const p=d*f,m=s(h),g=Math.ceil(d*m/8),y=new Uint8Array(4*p),w=new Uint32Array(y.buffer),{ctype:k}=h,{depth:C}=h,A=t.readUshort;if(k==6){const U=p<<2;if(C==8)for(var E=0;E<U;E+=4)y[E]=u[E],y[E+1]=u[E+1],y[E+2]=u[E+2],y[E+3]=u[E+3];if(C==16)for(E=0;E<U;E++)y[E]=u[E<<1]}else if(k==2){const U=h.tabs.tRNS;if(U==null){if(C==8)for(E=0;E<p;E++){var P=3*E;w[E]=255<<24|u[P+2]<<16|u[P+1]<<8|u[P]}if(C==16)for(E=0;E<p;E++)P=6*E,w[E]=255<<24|u[P+4]<<16|u[P+2]<<8|u[P]}else{var S=U[0];const j=U[1],Q=U[2];if(C==8)for(E=0;E<p;E++){var x=E<<2;P=3*E,w[E]=255<<24|u[P+2]<<16|u[P+1]<<8|u[P],u[P]==S&&u[P+1]==j&&u[P+2]==Q&&(y[x+3]=0)}if(C==16)for(E=0;E<p;E++)x=E<<2,P=6*E,w[E]=255<<24|u[P+4]<<16|u[P+2]<<8|u[P],A(u,P)==S&&A(u,P+2)==j&&A(u,P+4)==Q&&(y[x+3]=0)}}else if(k==3){const U=h.tabs.PLTE,j=h.tabs.tRNS,Q=j?j.length:0;if(C==1)for(var _=0;_<f;_++){var I=_*g,D=_*d;for(E=0;E<d;E++){x=D+E<<2;var B=3*(F=u[I+(E>>3)]>>7-((7&E)<<0)&1);y[x]=U[B],y[x+1]=U[B+1],y[x+2]=U[B+2],y[x+3]=F<Q?j[F]:255}}if(C==2)for(_=0;_<f;_++)for(I=_*g,D=_*d,E=0;E<d;E++)x=D+E<<2,B=3*(F=u[I+(E>>2)]>>6-((3&E)<<1)&3),y[x]=U[B],y[x+1]=U[B+1],y[x+2]=U[B+2],y[x+3]=F<Q?j[F]:255;if(C==4)for(_=0;_<f;_++)for(I=_*g,D=_*d,E=0;E<d;E++)x=D+E<<2,B=3*(F=u[I+(E>>1)]>>4-((1&E)<<2)&15),y[x]=U[B],y[x+1]=U[B+1],y[x+2]=U[B+2],y[x+3]=F<Q?j[F]:255;if(C==8)for(E=0;E<p;E++){var F;x=E<<2,B=3*(F=u[E]),y[x]=U[B],y[x+1]=U[B+1],y[x+2]=U[B+2],y[x+3]=F<Q?j[F]:255}}else if(k==4){if(C==8)for(E=0;E<p;E++){x=E<<2;var R=u[O=E<<1];y[x]=R,y[x+1]=R,y[x+2]=R,y[x+3]=u[O+1]}if(C==16)for(E=0;E<p;E++){var O;x=E<<2,R=u[O=E<<2],y[x]=R,y[x+1]=R,y[x+2]=R,y[x+3]=u[O+2]}}else if(k==0)for(S=h.tabs.tRNS?h.tabs.tRNS:-1,_=0;_<f;_++){const U=_*g,j=_*d;if(C==1)for(var L=0;L<d;L++){var H=(R=255*(u[U+(L>>>3)]>>>7-(7&L)&1))==255*S?0:255;w[j+L]=H<<24|R<<16|R<<8|R}else if(C==2)for(L=0;L<d;L++)H=(R=85*(u[U+(L>>>2)]>>>6-((3&L)<<1)&3))==85*S?0:255,w[j+L]=H<<24|R<<16|R<<8|R;else if(C==4)for(L=0;L<d;L++)H=(R=17*(u[U+(L>>>1)]>>>4-((1&L)<<2)&15))==17*S?0:255,w[j+L]=H<<24|R<<16|R<<8|R;else if(C==8)for(L=0;L<d;L++)H=(R=u[U+L])==S?0:255,w[j+L]=H<<24|R<<16|R<<8|R;else if(C==16)for(L=0;L<d;L++)R=u[U+(L<<1)],H=A(u,U+(L<<1))==S?0:255,w[j+L]=H<<24|R<<16|R<<8|R}return y}function n(u,d,f,h){const p=s(u),m=Math.ceil(f*p/8),g=new Uint8Array((m+1+u.interlace)*h);return d=u.tabs.CgBI?i(d,g):r(d,g),u.interlace==0?d=o(d,u,0,f,h):u.interlace==1&&(d=(function(w,k){const C=k.width,A=k.height,E=s(k),P=E>>3,S=Math.ceil(C*E/8),x=new Uint8Array(A*S);let _=0;const I=[0,0,4,0,2,0,1],D=[0,4,0,2,0,1,0],B=[8,8,8,4,4,2,2],F=[8,8,4,4,2,2,1];let R=0;for(;R<7;){const L=B[R],H=F[R];let U=0,j=0,Q=I[R];for(;Q<A;)Q+=L,j++;let X=D[R];for(;X<C;)X+=H,U++;const de=Math.ceil(U*E/8);o(w,k,_,U,j);let le=0,J=I[R];for(;J<A;){let he=D[R],Me=_+le*de<<3;for(;he<C;){var O;if(E==1&&(O=(O=w[Me>>3])>>7-(7&Me)&1,x[J*S+(he>>3)]|=O<<7-((7&he)<<0)),E==2&&(O=(O=w[Me>>3])>>6-(7&Me)&3,x[J*S+(he>>2)]|=O<<6-((3&he)<<1)),E==4&&(O=(O=w[Me>>3])>>4-(7&Me)&15,x[J*S+(he>>1)]|=O<<4-((1&he)<<2)),E>=8){const pe=J*S+he*P;for(let Te=0;Te<P;Te++)x[pe+Te]=w[(Me>>3)+Te]}Me+=E,he+=H}le++,J+=L}U*j!=0&&(_+=j*(1+de)),R+=1}return x})(d,u)),d}function r(u,d){return i(new Uint8Array(u.buffer,2,u.length-6),d)}var i=(function(){const u={H:{}};return u.H.N=function(d,f){const h=Uint8Array;let p,m,g=0,y=0,w=0,k=0,C=0,A=0,E=0,P=0,S=0;if(d[0]==3&&d[1]==0)return f||new h(0);const x=u.H,_=x.b,I=x.e,D=x.R,B=x.n,F=x.A,R=x.Z,O=x.m,L=f==null;for(L&&(f=new h(d.length>>>2<<5));g==0;)if(g=_(d,S,1),y=_(d,S+1,2),S+=3,y!=0){if(L&&(f=u.H.W(f,P+(1<<17))),y==1&&(p=O.J,m=O.h,A=511,E=31),y==2){w=I(d,S,5)+257,k=I(d,S+5,5)+1,C=I(d,S+10,4)+4,S+=14;let U=1;for(var H=0;H<38;H+=2)O.Q[H]=0,O.Q[H+1]=0;for(H=0;H<C;H++){const X=I(d,S+3*H,3);O.Q[1+(O.X[H]<<1)]=X,X>U&&(U=X)}S+=3*C,B(O.Q,U),F(O.Q,U,O.u),p=O.w,m=O.d,S=D(O.u,(1<<U)-1,w+k,d,S,O.v);const j=x.V(O.v,0,w,O.C);A=(1<<j)-1;const Q=x.V(O.v,w,k,O.D);E=(1<<Q)-1,B(O.C,j),F(O.C,j,p),B(O.D,Q),F(O.D,Q,m)}for(;;){const U=p[R(d,S)&A];S+=15&U;const j=U>>>4;if(!(j>>>8))f[P++]=j;else{if(j==256)break;{let Q=P+j-254;if(j>264){const he=O.q[j-257];Q=P+(he>>>3)+I(d,S,7&he),S+=7&he}const X=m[R(d,S)&E];S+=15&X;const de=X>>>4,le=O.c[de],J=(le>>>4)+_(d,S,15&le);for(S+=15&le;P<Q;)f[P]=f[P++-J],f[P]=f[P++-J],f[P]=f[P++-J],f[P]=f[P++-J];P=Q}}}}else{(7&S)!=0&&(S+=8-(7&S));const U=4+(S>>>3),j=d[U-4]|d[U-3]<<8;L&&(f=u.H.W(f,P+j)),f.set(new h(d.buffer,d.byteOffset+U,j),P),S=U+j<<3,P+=j}return f.length==P?f:f.slice(0,P)},u.H.W=function(d,f){const h=d.length;if(f<=h)return d;const p=new Uint8Array(h<<1);return p.set(d,0),p},u.H.R=function(d,f,h,p,m,g){const y=u.H.e,w=u.H.Z;let k=0;for(;k<h;){const C=d[w(p,m)&f];m+=15&C;const A=C>>>4;if(A<=15)g[k]=A,k++;else{let E=0,P=0;A==16?(P=3+y(p,m,2),m+=2,E=g[k-1]):A==17?(P=3+y(p,m,3),m+=3):A==18&&(P=11+y(p,m,7),m+=7);const S=k+P;for(;k<S;)g[k]=E,k++}}return m},u.H.V=function(d,f,h,p){let m=0,g=0;const y=p.length>>>1;for(;g<h;){const w=d[g+f];p[g<<1]=0,p[1+(g<<1)]=w,w>m&&(m=w),g++}for(;g<y;)p[g<<1]=0,p[1+(g<<1)]=0,g++;return m},u.H.n=function(d,f){const h=u.H.m,p=d.length;let m,g,y,w;const k=h.j;for(var C=0;C<=f;C++)k[C]=0;for(C=1;C<p;C+=2)k[d[C]]++;const A=h.K;for(m=0,k[0]=0,g=1;g<=f;g++)m=m+k[g-1]<<1,A[g]=m;for(y=0;y<p;y+=2)w=d[y+1],w!=0&&(d[y]=A[w],A[w]++)},u.H.A=function(d,f,h){const p=d.length,m=u.H.m.r;for(let g=0;g<p;g+=2)if(d[g+1]!=0){const y=g>>1,w=d[g+1],k=y<<4|w,C=f-w;let A=d[g]<<C;const E=A+(1<<C);for(;A!=E;)h[m[A]>>>15-f]=k,A++}},u.H.l=function(d,f){const h=u.H.m.r,p=15-f;for(let m=0;m<d.length;m+=2){const g=d[m]<<f-d[m+1];d[m]=h[g]>>>p}},u.H.M=function(d,f,h){h<<=7&f;const p=f>>>3;d[p]|=h,d[p+1]|=h>>>8},u.H.I=function(d,f,h){h<<=7&f;const p=f>>>3;d[p]|=h,d[p+1]|=h>>>8,d[p+2]|=h>>>16},u.H.e=function(d,f,h){return(d[f>>>3]|d[1+(f>>>3)]<<8)>>>(7&f)&(1<<h)-1},u.H.b=function(d,f,h){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)&(1<<h)-1},u.H.Z=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)},u.H.i=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16|d[3+(f>>>3)]<<24)>>>(7&f)},u.H.m=(function(){const d=Uint16Array,f=Uint32Array;return{K:new d(16),j:new d(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new d(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new f(32),J:new d(512),_:[],h:new d(32),$:[],w:new d(32768),C:[],v:[],d:new d(32768),D:[],u:new d(512),Q:[],r:new d(32768),s:new f(286),Y:new f(30),a:new f(19),t:new f(15e3),k:new d(65536),g:new d(32768)}})(),(function(){const d=u.H.m;for(var f=0;f<32768;f++){let p=f;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,d.r[f]=(p>>>16|p<<16)>>>17}function h(p,m,g){for(;m--!=0;)p.push(0,g)}for(f=0;f<32;f++)d.q[f]=d.S[f]<<3|d.T[f],d.c[f]=d.p[f]<<4|d.z[f];h(d._,144,8),h(d._,112,9),h(d._,24,7),h(d._,8,8),u.H.n(d._,9),u.H.A(d._,9,d.J),u.H.l(d._,9),h(d.$,32,5),u.H.n(d.$,5),u.H.A(d.$,5,d.h),u.H.l(d.$,5),h(d.Q,19,0),h(d.C,286,0),h(d.D,30,0),h(d.v,320,0)})(),u.H.N})();function s(u){return[1,null,3,1,2,null,4][u.ctype]*u.depth}function o(u,d,f,h,p){let m=s(d);const g=Math.ceil(h*m/8);let y,w;m=Math.ceil(m/8);let k=u[f],C=0;if(k>1&&(u[f]=[0,0,1][k-2]),k==3)for(C=m;C<g;C++)u[C+1]=u[C+1]+(u[C+1-m]>>>1)&255;for(let A=0;A<p;A++)if(y=f+A*g,w=y+A+1,k=u[w-1],C=0,k==0)for(;C<g;C++)u[y+C]=u[w+C];else if(k==1){for(;C<m;C++)u[y+C]=u[w+C];for(;C<g;C++)u[y+C]=u[w+C]+u[y+C-m]}else if(k==2)for(;C<g;C++)u[y+C]=u[w+C]+u[y+C-g];else if(k==3){for(;C<m;C++)u[y+C]=u[w+C]+(u[y+C-g]>>>1);for(;C<g;C++)u[y+C]=u[w+C]+(u[y+C-g]+u[y+C-m]>>>1)}else{for(;C<m;C++)u[y+C]=u[w+C]+a(0,u[y+C-g],0);for(;C<g;C++)u[y+C]=u[w+C]+a(u[y+C-m],u[y+C-g],u[y+C-m-g])}return u}function a(u,d,f){const h=u+d-f,p=h-u,m=h-d,g=h-f;return p*p<=m*m&&p*p<=g*g?u:m*m<=g*g?d:f}function l(u,d,f){f.width=t.readUint(u,d),d+=4,f.height=t.readUint(u,d),d+=4,f.depth=u[d],d++,f.ctype=u[d],d++,f.compress=u[d],d++,f.filter=u[d],d++,f.interlace=u[d],d++}function c(u,d,f,h,p,m,g,y,w){const k=Math.min(d,p),C=Math.min(f,m);let A=0,E=0;for(let R=0;R<C;R++)for(let O=0;O<k;O++)if(g>=0&&y>=0?(A=R*d+O<<2,E=(y+R)*p+g+O<<2):(A=(-y+R)*d-g+O<<2,E=R*p+O<<2),w==0)h[E]=u[A],h[E+1]=u[A+1],h[E+2]=u[A+2],h[E+3]=u[A+3];else if(w==1){var P=u[A+3]*.00392156862745098,S=u[A]*P,x=u[A+1]*P,_=u[A+2]*P,I=h[E+3]*(1/255),D=h[E]*I,B=h[E+1]*I,F=h[E+2]*I;const L=1-P,H=P+I*L,U=H==0?0:1/H;h[E+3]=255*H,h[E+0]=(S+D*L)*U,h[E+1]=(x+B*L)*U,h[E+2]=(_+F*L)*U}else if(w==2)P=u[A+3],S=u[A],x=u[A+1],_=u[A+2],I=h[E+3],D=h[E],B=h[E+1],F=h[E+2],P==I&&S==D&&x==B&&_==F?(h[E]=0,h[E+1]=0,h[E+2]=0,h[E+3]=0):(h[E]=S,h[E+1]=x,h[E+2]=_,h[E+3]=P);else if(w==3){if(P=u[A+3],S=u[A],x=u[A+1],_=u[A+2],I=h[E+3],D=h[E],B=h[E+1],F=h[E+2],P==I&&S==D&&x==B&&_==F)continue;if(P<220&&I>20)return!1}return!0}return{decode:function(d){const f=new Uint8Array(d);let h=8;const p=t,m=p.readUshort,g=p.readUint,y={tabs:{},frames:[]},w=new Uint8Array(f.length);let k,C=0,A=0;const E=[137,80,78,71,13,10,26,10];for(var P=0;P<8;P++)if(f[P]!=E[P])throw"The input is not a PNG file!";for(;h<f.length;){const R=p.readUint(f,h);h+=4;const O=p.readASCII(f,h,4);if(h+=4,O=="IHDR")l(f,h,y);else if(O=="iCCP"){for(var S=h;f[S]!=0;)S++;p.readASCII(f,h,S-h),f[S+1];const L=f.slice(S+2,h+R);let H=null;try{H=r(L)}catch{H=i(L)}y.tabs[O]=H}else if(O=="CgBI")y.tabs[O]=f.slice(h,h+4);else if(O=="IDAT"){for(P=0;P<R;P++)w[C+P]=f[h+P];C+=R}else if(O=="acTL")y.tabs[O]={num_frames:g(f,h),num_plays:g(f,h+4)},k=new Uint8Array(f.length);else if(O=="fcTL"){A!=0&&((F=y.frames[y.frames.length-1]).data=n(y,k.slice(0,A),F.rect.width,F.rect.height),A=0);const L={x:g(f,h+12),y:g(f,h+16),width:g(f,h+4),height:g(f,h+8)};let H=m(f,h+22);H=m(f,h+20)/(H==0?100:H);const U={rect:L,delay:Math.round(1e3*H),dispose:f[h+24],blend:f[h+25]};y.frames.push(U)}else if(O=="fdAT"){for(P=0;P<R-4;P++)k[A+P]=f[h+P+4];A+=R-4}else if(O=="pHYs")y.tabs[O]=[p.readUint(f,h),p.readUint(f,h+4),f[h+8]];else if(O=="cHRM")for(y.tabs[O]=[],P=0;P<8;P++)y.tabs[O].push(p.readUint(f,h+4*P));else if(O=="tEXt"||O=="zTXt"){y.tabs[O]==null&&(y.tabs[O]={});var x=p.nextZero(f,h),_=p.readASCII(f,h,x-h),I=h+R-x-1;if(O=="tEXt")B=p.readASCII(f,x+1,I);else{var D=r(f.slice(x+2,x+2+I));B=p.readUTF8(D,0,D.length)}y.tabs[O][_]=B}else if(O=="iTXt"){y.tabs[O]==null&&(y.tabs[O]={}),x=0,S=h,x=p.nextZero(f,S),_=p.readASCII(f,S,x-S);const L=f[S=x+1];var B;f[S+1],S+=2,x=p.nextZero(f,S),p.readASCII(f,S,x-S),S=x+1,x=p.nextZero(f,S),p.readUTF8(f,S,x-S),I=R-((S=x+1)-h),L==0?B=p.readUTF8(f,S,I):(D=r(f.slice(S,S+I)),B=p.readUTF8(D,0,D.length)),y.tabs[O][_]=B}else if(O=="PLTE")y.tabs[O]=p.readBytes(f,h,R);else if(O=="hIST"){const L=y.tabs.PLTE.length/3;for(y.tabs[O]=[],P=0;P<L;P++)y.tabs[O].push(m(f,h+2*P))}else if(O=="tRNS")y.ctype==3?y.tabs[O]=p.readBytes(f,h,R):y.ctype==0?y.tabs[O]=m(f,h):y.ctype==2&&(y.tabs[O]=[m(f,h),m(f,h+2),m(f,h+4)]);else if(O=="gAMA")y.tabs[O]=p.readUint(f,h)/1e5;else if(O=="sRGB")y.tabs[O]=f[h];else if(O=="bKGD")y.ctype==0||y.ctype==4?y.tabs[O]=[m(f,h)]:y.ctype==2||y.ctype==6?y.tabs[O]=[m(f,h),m(f,h+2),m(f,h+4)]:y.ctype==3&&(y.tabs[O]=f[h]);else if(O=="IEND")break;h+=R,p.readUint(f,h),h+=4}var F;return A!=0&&((F=y.frames[y.frames.length-1]).data=n(y,k.slice(0,A),F.rect.width,F.rect.height)),y.data=n(y,w,y.width,y.height),delete y.compress,delete y.interlace,delete y.filter,y},toRGBA8:function(d){const f=d.width,h=d.height;if(d.tabs.acTL==null)return[e(d.data,f,h,d).buffer];const p=[];d.frames[0].data==null&&(d.frames[0].data=d.data);const m=f*h*4,g=new Uint8Array(m),y=new Uint8Array(m),w=new Uint8Array(m);for(let C=0;C<d.frames.length;C++){const A=d.frames[C],E=A.rect.x,P=A.rect.y,S=A.rect.width,x=A.rect.height,_=e(A.data,S,x,d);if(C!=0)for(var k=0;k<m;k++)w[k]=g[k];if(A.blend==0?c(_,S,x,g,f,h,E,P,0):A.blend==1&&c(_,S,x,g,f,h,E,P,1),p.push(g.buffer.slice(0)),A.dispose!=0){if(A.dispose==1)c(y,S,x,g,f,h,E,P,0);else if(A.dispose==2)for(k=0;k<m;k++)g[k]=w[k]}}return p},_paeth:a,_copyTile:c,_bin:t}})();(function(){const{_copyTile:t}=gs,{_bin:e}=gs,n=gs._paeth;var r={table:(function(){const S=new Uint32Array(256);for(let x=0;x<256;x++){let _=x;for(let I=0;I<8;I++)1&_?_=3988292384^_>>>1:_>>>=1;S[x]=_}return S})(),update(S,x,_,I){for(let D=0;D<I;D++)S=r.table[255&(S^x[_+D])]^S>>>8;return S},crc:(S,x,_)=>4294967295^r.update(4294967295,S,x,_)};function i(S,x,_,I){x[_]+=S[0]*I>>4,x[_+1]+=S[1]*I>>4,x[_+2]+=S[2]*I>>4,x[_+3]+=S[3]*I>>4}function s(S){return Math.max(0,Math.min(255,S))}function o(S,x){const _=S[0]-x[0],I=S[1]-x[1],D=S[2]-x[2],B=S[3]-x[3];return _*_+I*I+D*D+B*B}function a(S,x,_,I,D,B,F){F==null&&(F=1);const R=I.length,O=[];for(var L=0;L<R;L++){const J=I[L];O.push([J>>>0&255,J>>>8&255,J>>>16&255,J>>>24&255])}for(L=0;L<R;L++){let J=4294967295;for(var H=0,U=0;U<R;U++){var j=o(O[L],O[U]);U!=L&&j<J&&(J=j,H=U)}}const Q=new Uint32Array(D.buffer),X=new Int16Array(x*_*4),de=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(L=0;L<de.length;L++)de[L]=255*((de[L]+.5)/16-.5);for(let J=0;J<_;J++)for(let he=0;he<x;he++){var le;L=4*(J*x+he),F!=2?le=[s(S[L]+X[L]),s(S[L+1]+X[L+1]),s(S[L+2]+X[L+2]),s(S[L+3]+X[L+3])]:(j=de[4*(3&J)+(3&he)],le=[s(S[L]+j),s(S[L+1]+j),s(S[L+2]+j),s(S[L+3]+j)]),H=0;let Me=16777215;for(U=0;U<R;U++){const je=o(le,O[U]);je<Me&&(Me=je,H=U)}const pe=O[H],Te=[le[0]-pe[0],le[1]-pe[1],le[2]-pe[2],le[3]-pe[3]];F==1&&(he!=x-1&&i(Te,X,L+4,7),J!=_-1&&(he!=0&&i(Te,X,L+4*x-4,3),i(Te,X,L+4*x,5),he!=x-1&&i(Te,X,L+4*x+4,1))),B[L>>2]=H,Q[L>>2]=I[H]}}function l(S,x,_,I,D){D==null&&(D={});const{crc:B}=r,F=e.writeUint,R=e.writeUshort,O=e.writeASCII;let L=8;const H=S.frames.length>1;let U,j=!1,Q=33+(H?20:0);if(D.sRGB!=null&&(Q+=13),D.pHYs!=null&&(Q+=21),D.iCCP!=null&&(U=pako.deflate(D.iCCP),Q+=21+U.length+4),S.ctype==3){for(var X=S.plte.length,de=0;de<X;de++)S.plte[de]>>>24!=255&&(j=!0);Q+=8+3*X+4+(j?8+1*X+4:0)}for(var le=0;le<S.frames.length;le++)H&&(Q+=38),Q+=(pe=S.frames[le]).cimg.length+12,le!=0&&(Q+=4);Q+=12;const J=new Uint8Array(Q),he=[137,80,78,71,13,10,26,10];for(de=0;de<8;de++)J[de]=he[de];if(F(J,L,13),L+=4,O(J,L,"IHDR"),L+=4,F(J,L,x),L+=4,F(J,L,_),L+=4,J[L]=S.depth,L++,J[L]=S.ctype,L++,J[L]=0,L++,J[L]=0,L++,J[L]=0,L++,F(J,L,B(J,L-17,17)),L+=4,D.sRGB!=null&&(F(J,L,1),L+=4,O(J,L,"sRGB"),L+=4,J[L]=D.sRGB,L++,F(J,L,B(J,L-5,5)),L+=4),D.iCCP!=null){const Te=13+U.length;F(J,L,Te),L+=4,O(J,L,"iCCP"),L+=4,O(J,L,"ICC profile"),L+=11,L+=2,J.set(U,L),L+=U.length,F(J,L,B(J,L-(Te+4),Te+4)),L+=4}if(D.pHYs!=null&&(F(J,L,9),L+=4,O(J,L,"pHYs"),L+=4,F(J,L,D.pHYs[0]),L+=4,F(J,L,D.pHYs[1]),L+=4,J[L]=D.pHYs[2],L++,F(J,L,B(J,L-13,13)),L+=4),H&&(F(J,L,8),L+=4,O(J,L,"acTL"),L+=4,F(J,L,S.frames.length),L+=4,F(J,L,D.loop!=null?D.loop:0),L+=4,F(J,L,B(J,L-12,12)),L+=4),S.ctype==3){for(F(J,L,3*(X=S.plte.length)),L+=4,O(J,L,"PLTE"),L+=4,de=0;de<X;de++){const Te=3*de,je=S.plte[de],oe=255&je,ge=je>>>8&255,Ie=je>>>16&255;J[L+Te+0]=oe,J[L+Te+1]=ge,J[L+Te+2]=Ie}if(L+=3*X,F(J,L,B(J,L-3*X-4,3*X+4)),L+=4,j){for(F(J,L,X),L+=4,O(J,L,"tRNS"),L+=4,de=0;de<X;de++)J[L+de]=S.plte[de]>>>24&255;L+=X,F(J,L,B(J,L-X-4,X+4)),L+=4}}let Me=0;for(le=0;le<S.frames.length;le++){var pe=S.frames[le];H&&(F(J,L,26),L+=4,O(J,L,"fcTL"),L+=4,F(J,L,Me++),L+=4,F(J,L,pe.rect.width),L+=4,F(J,L,pe.rect.height),L+=4,F(J,L,pe.rect.x),L+=4,F(J,L,pe.rect.y),L+=4,R(J,L,I[le]),L+=2,R(J,L,1e3),L+=2,J[L]=pe.dispose,L++,J[L]=pe.blend,L++,F(J,L,B(J,L-30,30)),L+=4);const Te=pe.cimg;F(J,L,(X=Te.length)+(le==0?0:4)),L+=4;const je=L;O(J,L,le==0?"IDAT":"fdAT"),L+=4,le!=0&&(F(J,L,Me++),L+=4),J.set(Te,L),L+=X,F(J,L,B(J,je,L-je)),L+=4}return F(J,L,0),L+=4,O(J,L,"IEND"),L+=4,F(J,L,B(J,L-4,4)),L+=4,J.buffer}function c(S,x,_){for(let I=0;I<S.frames.length;I++){const D=S.frames[I];D.rect.width;const B=D.rect.height,F=new Uint8Array(B*D.bpl+B);D.cimg=h(D.img,B,D.bpp,D.bpl,F,x,_)}}function u(S,x,_,I,D){const B=D[0],F=D[1],R=D[2],O=D[3],L=D[4],H=D[5];let U=6,j=8,Q=255;for(var X=0;X<S.length;X++){const Je=new Uint8Array(S[X]);for(var de=Je.length,le=0;le<de;le+=4)Q&=Je[le+3]}const J=Q!=255,he=(function(ft,ot,mt,It,bt,Lt){const Pe=[];for(var Oe=0;Oe<ft.length;Oe++){const Nt=new Uint8Array(ft[Oe]),Pt=new Uint32Array(Nt.buffer);var at;let _t=0,Dt=0,un=ot,zn=mt,ti=It?1:0;if(Oe!=0){const Di=Lt||It||Oe==1||Pe[Oe-2].dispose!=0?1:2;let ni=0,Kc=1e9;for(let Is=0;Is<Di;Is++){var Ht=new Uint8Array(ft[Oe-1-Is]);const Hl=new Uint32Array(ft[Oe-1-Is]);let Ei=ot,ki=mt,cs=-1,Ti=-1;for(let Kn=0;Kn<mt;Kn++)for(let ri=0;ri<ot;ri++)Pt[Ot=Kn*ot+ri]!=Hl[Ot]&&(ri<Ei&&(Ei=ri),ri>cs&&(cs=ri),Kn<ki&&(ki=Kn),Kn>Ti&&(Ti=Kn));cs==-1&&(Ei=ki=cs=Ti=0),bt&&((1&Ei)==1&&Ei--,(1&ki)==1&&ki--);const kn=(cs-Ei+1)*(Ti-ki+1);kn<Kc&&(Kc=kn,ni=Is,_t=Ei,Dt=ki,un=cs-Ei+1,zn=Ti-ki+1)}Ht=new Uint8Array(ft[Oe-1-ni]),ni==1&&(Pe[Oe-1].dispose=2),at=new Uint8Array(un*zn*4),t(Ht,ot,mt,at,un,zn,-_t,-Dt,0),ti=t(Nt,ot,mt,at,un,zn,-_t,-Dt,3)?1:0,ti==1?f(Nt,ot,mt,at,{x:_t,y:Dt,width:un,height:zn}):t(Nt,ot,mt,at,un,zn,-_t,-Dt,0)}else at=Nt.slice(0);Pe.push({rect:{x:_t,y:Dt,width:un,height:zn},img:at,blend:ti,dispose:0})}if(It)for(Oe=0;Oe<Pe.length;Oe++){if((Wt=Pe[Oe]).blend==1)continue;const Nt=Wt.rect,Pt=Pe[Oe-1].rect,_t=Math.min(Nt.x,Pt.x),Dt=Math.min(Nt.y,Pt.y),un={x:_t,y:Dt,width:Math.max(Nt.x+Nt.width,Pt.x+Pt.width)-_t,height:Math.max(Nt.y+Nt.height,Pt.y+Pt.height)-Dt};Pe[Oe-1].dispose=1,Oe-1!=0&&d(ft,ot,mt,Pe,Oe-1,un,bt),d(ft,ot,mt,Pe,Oe,un,bt)}let xn=0;if(ft.length!=1)for(var Ot=0;Ot<Pe.length;Ot++){var Wt;xn+=(Wt=Pe[Ot]).rect.width*Wt.rect.height}return Pe})(S,x,_,B,F,R),Me={},pe=[],Te=[];if(I!=0){const Je=[];for(le=0;le<he.length;le++)Je.push(he[le].img.buffer);const ft=(function(bt){let Lt=0;for(var Pe=0;Pe<bt.length;Pe++)Lt+=bt[Pe].byteLength;const Oe=new Uint8Array(Lt);let at=0;for(Pe=0;Pe<bt.length;Pe++){const Ht=new Uint8Array(bt[Pe]),xn=Ht.length;for(let Ot=0;Ot<xn;Ot+=4){let Wt=Ht[Ot],Nt=Ht[Ot+1],Pt=Ht[Ot+2];const _t=Ht[Ot+3];_t==0&&(Wt=Nt=Pt=0),Oe[at+Ot]=Wt,Oe[at+Ot+1]=Nt,Oe[at+Ot+2]=Pt,Oe[at+Ot+3]=_t}at+=xn}return Oe.buffer})(Je),ot=m(ft,I);for(le=0;le<ot.plte.length;le++)pe.push(ot.plte[le].est.rgba);let mt=0;for(le=0;le<he.length;le++){const It=(oe=he[le]).img.length;var je=new Uint8Array(ot.inds.buffer,mt>>2,It>>2);Te.push(je);const bt=new Uint8Array(ot.abuf,mt,It);H&&a(oe.img,oe.rect.width,oe.rect.height,pe,bt,je),oe.img.set(bt),mt+=It}}else for(X=0;X<he.length;X++){var oe=he[X];const Je=new Uint32Array(oe.img.buffer);var ge=oe.rect.width;for(de=Je.length,je=new Uint8Array(de),Te.push(je),le=0;le<de;le++){const ft=Je[le];if(le!=0&&ft==Je[le-1])je[le]=je[le-1];else if(le>ge&&ft==Je[le-ge])je[le]=je[le-ge];else{let ot=Me[ft];if(ot==null&&(Me[ft]=ot=pe.length,pe.push(ft),pe.length>=300))break;je[le]=ot}}}const Ie=pe.length;for(Ie<=256&&L==0&&(j=Ie<=2?1:Ie<=4?2:Ie<=16?4:8,j=Math.max(j,O)),X=0;X<he.length;X++){(oe=he[X]).rect.x,oe.rect.y,ge=oe.rect.width;const Je=oe.rect.height;let ft=oe.img;new Uint32Array(ft.buffer);let ot=4*ge,mt=4;if(Ie<=256&&L==0){ot=Math.ceil(j*ge/8);var _e=new Uint8Array(ot*Je);const It=Te[X];for(let bt=0;bt<Je;bt++){le=bt*ot;const Lt=bt*ge;if(j==8)for(var Ue=0;Ue<ge;Ue++)_e[le+Ue]=It[Lt+Ue];else if(j==4)for(Ue=0;Ue<ge;Ue++)_e[le+(Ue>>1)]|=It[Lt+Ue]<<4-4*(1&Ue);else if(j==2)for(Ue=0;Ue<ge;Ue++)_e[le+(Ue>>2)]|=It[Lt+Ue]<<6-2*(3&Ue);else if(j==1)for(Ue=0;Ue<ge;Ue++)_e[le+(Ue>>3)]|=It[Lt+Ue]<<7-1*(7&Ue)}ft=_e,U=3,mt=1}else if(J==0&&he.length==1){_e=new Uint8Array(ge*Je*3);const It=ge*Je;for(le=0;le<It;le++){const bt=3*le,Lt=4*le;_e[bt]=ft[Lt],_e[bt+1]=ft[Lt+1],_e[bt+2]=ft[Lt+2]}ft=_e,U=2,mt=3,ot=3*ge}oe.img=ft,oe.bpl=ot,oe.bpp=mt}return{ctype:U,depth:j,plte:pe,frames:he}}function d(S,x,_,I,D,B,F){const R=Uint8Array,O=Uint32Array,L=new R(S[D-1]),H=new O(S[D-1]),U=D+1<S.length?new R(S[D+1]):null,j=new R(S[D]),Q=new O(j.buffer);let X=x,de=_,le=-1,J=-1;for(let Me=0;Me<B.height;Me++)for(let pe=0;pe<B.width;pe++){const Te=B.x+pe,je=B.y+Me,oe=je*x+Te,ge=Q[oe];ge==0||I[D-1].dispose==0&&H[oe]==ge&&(U==null||U[4*oe+3]!=0)||(Te<X&&(X=Te),Te>le&&(le=Te),je<de&&(de=je),je>J&&(J=je))}le==-1&&(X=de=le=J=0),F&&((1&X)==1&&X--,(1&de)==1&&de--),B={x:X,y:de,width:le-X+1,height:J-de+1};const he=I[D];he.rect=B,he.blend=1,he.img=new Uint8Array(B.width*B.height*4),I[D-1].dispose==0?(t(L,x,_,he.img,B.width,B.height,-B.x,-B.y,0),f(j,x,_,he.img,B)):t(j,x,_,he.img,B.width,B.height,-B.x,-B.y,0)}function f(S,x,_,I,D){t(S,x,_,I,D.width,D.height,-D.x,-D.y,2)}function h(S,x,_,I,D,B,F){const R=[];let O,L=[0,1,2,3,4];B!=-1?L=[B]:(x*I>5e5||_==1)&&(L=[0]),F&&(O={level:0});const H=_oe;for(var U=0;U<L.length;U++){for(let X=0;X<x;X++)p(D,S,X,I,_,L[U]);R.push(H.deflate(D,O))}let j,Q=1e9;for(U=0;U<R.length;U++)R[U].length<Q&&(j=U,Q=R[U].length);return R[j]}function p(S,x,_,I,D,B){const F=_*I;let R=F+_;if(S[R]=B,R++,B==0)if(I<500)for(var O=0;O<I;O++)S[R+O]=x[F+O];else S.set(new Uint8Array(x.buffer,F,I),R);else if(B==1){for(O=0;O<D;O++)S[R+O]=x[F+O];for(O=D;O<I;O++)S[R+O]=x[F+O]-x[F+O-D]+256&255}else if(_==0){for(O=0;O<D;O++)S[R+O]=x[F+O];if(B==2)for(O=D;O<I;O++)S[R+O]=x[F+O];if(B==3)for(O=D;O<I;O++)S[R+O]=x[F+O]-(x[F+O-D]>>1)+256&255;if(B==4)for(O=D;O<I;O++)S[R+O]=x[F+O]-n(x[F+O-D],0,0)+256&255}else{if(B==2)for(O=0;O<I;O++)S[R+O]=x[F+O]+256-x[F+O-I]&255;if(B==3){for(O=0;O<D;O++)S[R+O]=x[F+O]+256-(x[F+O-I]>>1)&255;for(O=D;O<I;O++)S[R+O]=x[F+O]+256-(x[F+O-I]+x[F+O-D]>>1)&255}if(B==4){for(O=0;O<D;O++)S[R+O]=x[F+O]+256-n(0,x[F+O-I],0)&255;for(O=D;O<I;O++)S[R+O]=x[F+O]+256-n(x[F+O-D],x[F+O-I],x[F+O-D-I])&255}}}function m(S,x){const _=new Uint8Array(S),I=_.slice(0),D=new Uint32Array(I.buffer),B=g(I,x),F=B[0],R=B[1],O=_.length,L=new Uint8Array(O>>2);let H;if(_.length<2e7)for(var U=0;U<O;U+=4)H=y(F,j=_[U]*(1/255),Q=_[U+1]*(1/255),X=_[U+2]*(1/255),de=_[U+3]*(1/255)),L[U>>2]=H.ind,D[U>>2]=H.est.rgba;else for(U=0;U<O;U+=4){var j=_[U]*.00392156862745098,Q=_[U+1]*(1/255),X=_[U+2]*(1/255),de=_[U+3]*(1/255);for(H=F;H.left;)H=w(H.est,j,Q,X,de)<=0?H.left:H.right;L[U>>2]=H.ind,D[U>>2]=H.est.rgba}return{abuf:I.buffer,inds:L,plte:R}}function g(S,x,_){_==null&&(_=1e-4);const I=new Uint32Array(S.buffer),D={i0:0,i1:S.length,bst:null,est:null,tdst:0,left:null,right:null};D.bst=A(S,D.i0,D.i1),D.est=E(D.bst);const B=[D];for(;B.length<x;){let R=0,O=0;for(var F=0;F<B.length;F++)B[F].est.L>R&&(R=B[F].est.L,O=F);if(R<_)break;const L=B[O],H=k(S,I,L.i0,L.i1,L.est.e,L.est.eMq255);if(L.i0>=H||L.i1<=H){L.est.L=0;continue}const U={i0:L.i0,i1:H,bst:null,est:null,tdst:0,left:null,right:null};U.bst=A(S,U.i0,U.i1),U.est=E(U.bst);const j={i0:H,i1:L.i1,bst:null,est:null,tdst:0,left:null,right:null};for(j.bst={R:[],m:[],N:L.bst.N-U.bst.N},F=0;F<16;F++)j.bst.R[F]=L.bst.R[F]-U.bst.R[F];for(F=0;F<4;F++)j.bst.m[F]=L.bst.m[F]-U.bst.m[F];j.est=E(j.bst),L.left=U,L.right=j,B[O]=U,B.push(j)}for(B.sort(((R,O)=>O.bst.N-R.bst.N)),F=0;F<B.length;F++)B[F].ind=F;return[D,B]}function y(S,x,_,I,D){if(S.left==null)return S.tdst=(function(U,j,Q,X,de){const le=j-U[0],J=Q-U[1],he=X-U[2],Me=de-U[3];return le*le+J*J+he*he+Me*Me})(S.est.q,x,_,I,D),S;const B=w(S.est,x,_,I,D);let F=S.left,R=S.right;B>0&&(F=S.right,R=S.left);const O=y(F,x,_,I,D);if(O.tdst<=B*B)return O;const L=y(R,x,_,I,D);return L.tdst<O.tdst?L:O}function w(S,x,_,I,D){const{e:B}=S;return B[0]*x+B[1]*_+B[2]*I+B[3]*D-S.eMq}function k(S,x,_,I,D,B){for(I-=4;_<I;){for(;C(S,_,D)<=B;)_+=4;for(;C(S,I,D)>B;)I-=4;if(_>=I)break;const F=x[_>>2];x[_>>2]=x[I>>2],x[I>>2]=F,_+=4,I-=4}for(;C(S,_,D)>B;)_-=4;return _+4}function C(S,x,_){return S[x]*_[0]+S[x+1]*_[1]+S[x+2]*_[2]+S[x+3]*_[3]}function A(S,x,_){const I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],D=[0,0,0,0],B=_-x>>2;for(let F=x;F<_;F+=4){const R=S[F]*.00392156862745098,O=S[F+1]*(1/255),L=S[F+2]*(1/255),H=S[F+3]*(1/255);D[0]+=R,D[1]+=O,D[2]+=L,D[3]+=H,I[0]+=R*R,I[1]+=R*O,I[2]+=R*L,I[3]+=R*H,I[5]+=O*O,I[6]+=O*L,I[7]+=O*H,I[10]+=L*L,I[11]+=L*H,I[15]+=H*H}return I[4]=I[1],I[8]=I[2],I[9]=I[6],I[12]=I[3],I[13]=I[7],I[14]=I[11],{R:I,m:D,N:B}}function E(S){const{R:x}=S,{m:_}=S,{N:I}=S,D=_[0],B=_[1],F=_[2],R=_[3],O=I==0?0:1/I,L=[x[0]-D*D*O,x[1]-D*B*O,x[2]-D*F*O,x[3]-D*R*O,x[4]-B*D*O,x[5]-B*B*O,x[6]-B*F*O,x[7]-B*R*O,x[8]-F*D*O,x[9]-F*B*O,x[10]-F*F*O,x[11]-F*R*O,x[12]-R*D*O,x[13]-R*B*O,x[14]-R*F*O,x[15]-R*R*O],H=L,U=P;let j=[Math.random(),Math.random(),Math.random(),Math.random()],Q=0,X=0;if(I!=0)for(let le=0;le<16&&(j=U.multVec(H,j),X=Math.sqrt(U.dot(j,j)),j=U.sml(1/X,j),!(le!=0&&Math.abs(X-Q)<1e-9));le++)Q=X;const de=[D*O,B*O,F*O,R*O];return{Cov:L,q:de,e:j,L:Q,eMq255:U.dot(U.sml(255,de),j),eMq:U.dot(j,de),rgba:(Math.round(255*de[3])<<24|Math.round(255*de[2])<<16|Math.round(255*de[1])<<8|Math.round(255*de[0])<<0)>>>0}}var P={multVec:(S,x)=>[S[0]*x[0]+S[1]*x[1]+S[2]*x[2]+S[3]*x[3],S[4]*x[0]+S[5]*x[1]+S[6]*x[2]+S[7]*x[3],S[8]*x[0]+S[9]*x[1]+S[10]*x[2]+S[11]*x[3],S[12]*x[0]+S[13]*x[1]+S[14]*x[2]+S[15]*x[3]],dot:(S,x)=>S[0]*x[0]+S[1]*x[1]+S[2]*x[2]+S[3]*x[3],sml:(S,x)=>[S*x[0],S*x[1],S*x[2],S*x[3]]};gs.encode=function(x,_,I,D,B,F,R){D==null&&(D=0),R==null&&(R=!1);const O=u(x,_,I,D,[!1,!1,!1,0,R,!1]);return c(O,-1),l(O,_,I,B,F)},gs.encodeLL=function(x,_,I,D,B,F,R,O){const L={ctype:0+(D==1?0:2)+(B==0?0:4),depth:F,frames:[]},H=(D+B)*F,U=H*_;for(let j=0;j<x.length;j++)L.frames.push({rect:{x:0,y:0,width:_,height:I},img:new Uint8Array(x[j]),blend:0,dispose:1,bpp:Math.ceil(H/8),bpl:Math.ceil(U/8)});return c(L,0,!0),l(L,_,I,R,O)},gs.encode.compress=u,gs.encode.dither=a,gs.quantize=m,gs.quantize.getKDtree=g,gs.quantize.getNearest=y})();const zN={toArrayBuffer(t,e){const n=t.width,r=t.height,i=n<<2,s=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(s.data.buffer),a=(32*n+31)/32<<2,l=a*r,c=122+l,u=new ArrayBuffer(c),d=new DataView(u),f=1<<20;let h,p,m,g,y=f,w=0,k=0,C=0;function A(S){d.setUint16(k,S,!0),k+=2}function E(S){d.setUint32(k,S,!0),k+=4}function P(S){k+=S}A(19778),E(c),P(4),E(122),E(108),E(n),E(-r>>>0),A(1),A(32),E(3),E(l),E(2835),E(2835),P(8),E(16711680),E(65280),E(255),E(4278190080),E(1466527264),(function S(){for(;w<r&&y>0;){for(g=122+w*a,h=0;h<i;)y--,p=o[C++],m=p>>>24,d.setUint32(g+h,p<<8|m),h+=4;w++}C<o.length?(y=f,setTimeout(S,zN._dly)):e(u)})()},toBlob(t,e){this.toArrayBuffer(t,(n=>{e(new Blob([n],{type:"image/bmp"}))}))},_dly:9};var di={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Coe={[di.CHROME]:16384,[di.FIREFOX]:11180,[di.DESKTOP_SAFARI]:16384,[di.IE]:8192,[di.IOS]:4096,[di.ETC]:8192};const ES=typeof window<"u",UN=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Ng=ES&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Aoe=(ES||UN)&&(Ng&&Ng.getOriginalSymbol(window,"File")||typeof File<"u"&&File),HN=(ES||UN)&&(Ng&&Ng.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function kS(t,e,n=Date.now()){return new Promise((r=>{const i=t.split(","),s=i[0].match(/:(.*?);/)[1],o=globalThis.atob(i[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const c=new Blob([l],{type:s});c.name=e,c.lastModified=n,r(c)}))}function VN(t){return new Promise(((e,n)=>{const r=new HN;r.onload=()=>e(r.result),r.onerror=i=>n(i),r.readAsDataURL(t)}))}function jN(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=i=>n(i),r.src=t}))}function dc(){if(dc.cachedResult!==void 0)return dc.cachedResult;let t=di.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=di.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=di.IOS:/Safari/i.test(e)?t=di.DESKTOP_SAFARI:/Firefox/i.test(e)?t=di.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=di.IE),dc.cachedResult=t,dc.cachedResult}function WN(t,e){const n=dc(),r=Coe[n];let i=t,s=e,o=i*s;const a=i>s?s/i:i/s;for(;o>r*r;){const l=(r+i)/2,c=(r+s)/2;l<c?(s=c,i=c*a):(s=l*a,i=l),o=i*s}return{width:i,height:s}}function K0(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function qN(t,e){const{width:n,height:r}=WN(t.width,t.height),[i,s]=K0(n,r);return e&&/jpe?g/.test(e)&&(s.fillStyle="white",s.fillRect(0,0,i.width,i.height)),s.drawImage(t,0,0,i.width,i.height),i}function em(){return em.cachedResult!==void 0||(em.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),em.cachedResult}function Rg(t,e={}){return new Promise((function(n,r){let i,s;var o=function(){try{return s=qN(i,e.fileType||t.type),n([i,s])}catch(l){return r(l)}},a=function(l){try{var c=function(u){try{throw u}catch(d){return r(d)}};try{let u;return VN(t).then((function(d){try{return u=d,jN(u).then((function(f){try{return i=f,(function(){try{return o()}catch(h){return r(h)}})()}catch(h){return c(h)}}),c)}catch(f){return c(f)}}),c)}catch(u){c(u)}}catch(u){return r(u)}};try{if(em()||[di.DESKTOP_SAFARI,di.MOBILE_SAFARI].includes(dc()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then((function(l){try{return i=l,o()}catch{return a()}}),a)}catch{a()}}))}function Lg(t,e,n,r,i=1){return new Promise((function(s,o){let a;if(e==="image/png"){let c,u,d;return c=t.getContext("2d"),{data:u}=c.getImageData(0,0,t.width,t.height),d=gs.encode([u.buffer],t.width,t.height,4096*i),a=new Blob([d],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let c=function(){return l.call(this)};if(e==="image/bmp")return new Promise((u=>zN.toBlob(t,u))).then((function(u){try{return a=u,a.name=n,a.lastModified=r,c.call(this)}catch(d){return o(d)}}).bind(this),o);{let u=function(){return c.call(this)};if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:i}).then((function(d){try{return a=d,a.name=n,a.lastModified=r,u.call(this)}catch(f){return o(f)}}).bind(this),o);{let d;return d=t.toDataURL(e,i),kS(d,n,r).then((function(f){try{return a=f,u.call(this)}catch(h){return o(h)}}).bind(this),o)}}}function l(){return s(a)}}))}function Gs(t){t.width=0,t.height=0}function Cu(){return new Promise((function(t,e){let n,r,i,s;return Cu.cachedResult!==void 0?t(Cu.cachedResult):kS("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(o){try{return n=o,Rg(n).then((function(a){try{return r=a[1],Lg(r,n.type,n.name,n.lastModified).then((function(l){try{return i=l,Gs(r),Rg(i).then((function(c){try{return s=c[0],Cu.cachedResult=s.width===1&&s.height===2,t(Cu.cachedResult)}catch(u){return e(u)}}),e)}catch(c){return e(c)}}),e)}catch(l){return e(l)}}),e)}catch(a){return e(a)}}),e)}))}function KN(t){return new Promise(((e,n)=>{const r=new HN;r.onload=i=>{const s=new DataView(i.target.result);if(s.getUint16(0,!1)!=65496)return e(-2);const o=s.byteLength;let a=2;for(;a<o;){if(s.getUint16(a+2,!1)<=8)return e(-1);const l=s.getUint16(a,!1);if(a+=2,l==65505){if(s.getUint32(a+=2,!1)!=1165519206)return e(-1);const c=s.getUint16(a+=6,!1)==18761;a+=s.getUint32(a+4,c);const u=s.getUint16(a,c);a+=2;for(let d=0;d<u;d++)if(s.getUint16(a+12*d,c)==274)return e(s.getUint16(a+12*d+8,c))}else{if((65280&l)!=65280)break;a+=s.getUint16(a,!1)}}return e(-1)},r.onerror=i=>n(i),r.readAsArrayBuffer(t)}))}function GN(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:i}=e;let s,o=t;return isFinite(i)&&(n>i||r>i)&&([o,s]=K0(n,r),n>r?(o.width=i,o.height=r/n*i):(o.width=n/r*i,o.height=i),s.drawImage(t,0,0,o.width,o.height),Gs(t)),o}function ZN(t,e){const{width:n}=t,{height:r}=t,[i,s]=K0(n,r);switch(e>4&&e<9?(i.width=r,i.height=n):(i.width=n,i.height=r),e){case 2:s.transform(-1,0,0,1,n,0);break;case 3:s.transform(-1,0,0,-1,n,r);break;case 4:s.transform(1,0,0,-1,0,r);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,r,0);break;case 7:s.transform(0,-1,-1,0,r,n);break;case 8:s.transform(0,-1,1,0,0,n)}return s.drawImage(t,0,0,n,r),Gs(t),i}function oA(t,e,n=0){return new Promise((function(r,i){let s,o,a,l,c,u,d,f,h,p,m,g,y,w,k,C,A,E,P,S;function x(I=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;s+=I,e.onProgress(Math.min(s,100))}function _(I){if(e.signal&&e.signal.aborted)throw e.signal.reason;s=Math.min(Math.max(I,s),100),e.onProgress(s)}return s=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,x(),Rg(t,e).then((function(I){try{return[,l]=I,x(),c=GN(l,e),x(),new Promise((function(D,B){var F;if(!(F=e.exifOrientation))return KN(t).then((function(O){try{return F=O,R.call(this)}catch(L){return B(L)}}).bind(this),B);function R(){return D(F)}return R.call(this)})).then((function(D){try{return u=D,x(),Cu().then((function(B){try{return d=B?c:ZN(c,u),x(),f=e.initialQuality||1,h=e.fileType||t.type,Lg(d,h,t.name,t.lastModified,f).then((function(F){try{{let O=function(){if(o--&&(k>a||k>y)){let H,U;return H=S?.95*P.width:P.width,U=S?.95*P.height:P.height,[A,E]=K0(H,U),E.drawImage(P,0,0,H,U),f*=h==="image/png"?.85:.95,Lg(A,h,t.name,t.lastModified,f).then((function(j){try{return C=j,Gs(P),P=A,k=C.size,_(Math.min(99,Math.floor((w-k)/(w-a)*100))),O}catch(Q){return i(Q)}}),i)}return[1]},L=function(){return Gs(P),Gs(A),Gs(c),Gs(d),Gs(l),_(100),r(C)};if(p=F,x(),m=p.size>a,g=p.size>t.size,!m&&!g)return _(100),r(p);var R;return y=t.size,w=p.size,k=w,P=d,S=!e.alwaysKeepResolution&&m,(R=(function(H){for(;H;){if(H.then)return void H.then(R,i);try{if(H.pop){if(H.length)return H.pop()?L.call(this):H;H=O}else H=H.call(this)}catch(U){return i(U)}}}).bind(this))(O)}}catch(O){return i(O)}}).bind(this),i)}catch(F){return i(F)}}).bind(this),i)}catch(B){return i(B)}}).bind(this),i)}catch(D){return i(D)}}).bind(this),i)}))}const Ioe=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Pw;function Poe(t,e){return new Promise(((n,r)=>{Pw||(Pw=(function(o){const a=[];return a.push(o),URL.createObjectURL(new Blob(a))})(Ioe));const i=new Worker(Pw);i.addEventListener("message",(function(o){if(e.signal&&e.signal.aborted)i.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void i.terminate();n(o.data.file),i.terminate()}else e.onProgress(o.data.progress)})),i.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",(()=>{r(e.signal.reason),i.terminate()})),i.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})}))}function Ar(t,e){return new Promise((function(n,r){let i,s,o,a,l,c;if(i={...e},o=0,{onProgress:a}=i,i.maxSizeMB=i.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof i.useWebWorker!="boolean"||i.useWebWorker,delete i.useWebWorker,i.onProgress=h=>{o=h,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof Aoe))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(c=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||c)return oA(t,i).then((function(h){try{return s=h,f.call(this)}catch(p){return r(p)}}).bind(this),r);var u=(function(){try{return f.call(this)}catch(h){return r(h)}}).bind(this),d=function(h){try{return oA(t,i).then((function(p){try{return s=p,u()}catch(m){return r(m)}}),r)}catch(p){return r(p)}};try{return i.libURL=i.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Poe(t,i).then((function(h){try{return s=h,u()}catch{return d()}}),d)}catch{d()}function f(){try{s.name=t.name,s.lastModified=t.lastModified}catch{}try{i.preserveExif&&t.type==="image/jpeg"&&(!i.fileType||i.fileType&&i.fileType===t.type)&&(s=FN(t,s))}catch{}return n(s)}}))}Ar.getDataUrlFromFile=VN,Ar.getFilefromDataUrl=kS,Ar.loadImage=jN,Ar.drawImageInCanvas=qN,Ar.drawFileInCanvas=Rg,Ar.canvasToFile=Lg,Ar.getExifOrientation=KN,Ar.handleMaxWidthOrHeight=GN,Ar.followExifOrientation=ZN,Ar.cleanupCanvasMemory=Gs,Ar.isAutoOrientationInBrowser=Cu,Ar.approximateBelowMaximumCanvasSizeOfBrowser=WN,Ar.copyExifWithoutOrientation=FN,Ar.getBrowserName=dc,Ar.version="2.0.2";function Ks(t,...e){}function ys(t,...e){}function QN(t,e,n){if(t.size>=e.size)return{file:e,wasCompressed:!1};const r=e.name.replace(/\.[^.]+$/,"");return{file:new File([t],`${r}_compressed.mp4`,{type:"video/mp4"}),wasCompressed:!0}}function Moe(t,e,n){return Gt.value?(n&&n(0),{file:t,wasCompressed:!1,wasSkipped:!0,aborted:!0}):null}function Ooe(t,e){return!!(!t||typeof t=="object"&&t&&"skip"in t&&t.skip)}function Noe(t,e=200*1024){return t.size<=e}function Roe(t){return t.type.startsWith("video/")}class XN{onProgress;context;constructor(e){this.context=e}setProgressCallback(e){this.onProgress=e}checkAbort(e){return Moe(e,this.context,this.onProgress)}resetProgress(){this.onProgress&&this.onProgress(0)}updateProgress(e){this.onProgress&&this.onProgress(Math.round(e))}log(...e){Ks(this.context,...e)}}async function Loe(){if(!(typeof VideoEncoder<"u"&&typeof VideoDecoder<"u")||/Android.*Firefox/.test(navigator.userAgent))return!1;try{const r=(await Yv()).includes("opus");return Ks("MediaBunnyCompression","MediaBunny supported - Video encoding available, Opus codec available:",r),!0}catch{return!0}}async function Doe(){if(typeof AudioEncoder>"u")return!1;try{const t={codec:"opus",sampleRate:48e3,numberOfChannels:2,bitrate:128e3};return(await AudioEncoder.isConfigSupported(t)).supported||!1}catch{return!1}}async function Boe(t,e,n){if(typeof AudioEncoder>"u")return!1;try{const r={codec:"opus",sampleRate:t,numberOfChannels:e,bitrate:n};return(await AudioEncoder.isConfigSupported(r)).supported||!1}catch{return!1}}function sf(t,e,n=!1){if(t)try{t.dispose()}catch{}if(e&&n)try{e.finalize()}catch{}}class $oe extends XN{constructor(e,n,r){super("MediaBunnyCompression"),this.parseAudioBitrate=e,this.mergeVideoAndAudioWithFFmpeg=n,this.compressWithFFmpeg=r}abortController=null;abort(){this.log("Abort requested"),this.resetProgress(),this.abortController&&(this.log("Aborting Mediabunny conversion"),this.abortController.abort(),this.abortController=null)}async cleanup(){this.abortController=null}async findSupportedOpusConfig(e,n,r,i){const s=Math.max(i,64e3),o=Array.from(new Set([r,48e3,24e3,e.sampleRate])).filter(l=>Number.isFinite(l)&&l>0),a=[{sampleRate:r,bitrate:i},...o.map(l=>({sampleRate:l,bitrate:s}))];for(const{sampleRate:l,bitrate:c}of a){if(!Number.isFinite(l)||l<=0||!Number.isFinite(c)||c<=0)continue;const u=Math.round(l),d=Math.round(c),f=await Boe(u,n,d);if(this.log("Opus encoding support probe:",{trackId:e.id,codec:e.codec,targetChannels:n,sampleRate:u,bitrate:d,supported:f}),f)return{sampleRate:u,bitrate:d}}return null}async validateMediabunnyAudioConfig(e,n,r){const i=new Map;let s=await Doe(),o=r?null:this.parseAudioBitrate(n?.audioBitrate),a=r?null:typeof n?.audioSampleRate=="number"?n.audioSampleRate:null;if(this.log("Opus encoding supported (global check):",s),s&&e.length>0)for(const l of e){const c=n.audioChannels??l.numberOfChannels,u=n.audioSampleRate??l.sampleRate,d=r?64e3:this.parseAudioBitrate(n.audioBitrate)??128e3,f=await this.findSupportedOpusConfig(l,c,u,d);if(!f){s=!1,this.log("Opus encoder does not support requested settings; will copy audio track as-is via Mediabunny.",{trackId:l.id,preferredSampleRate:u,preferredBitrate:d,targetChannels:c});break}i.set(l.id,{sampleRate:f.sampleRate,bitrate:f.bitrate,channels:c}),(f.sampleRate!==u||f.bitrate!==d)&&this.log("Adjusted Mediabunny audio target due to encoder support limitations.",{trackId:l.id,preferredSampleRate:u,preferredBitrate:d,resolvedSampleRate:f.sampleRate,resolvedBitrate:f.bitrate}),r||(a=f.sampleRate,o=f.bitrate)}return{canEncodeOpus:s,audioConfigByTrack:i,desiredAudioSampleRate:a,desiredAudioBitrate:o}}buildConversionOptions(e,n,r,i,s,o,a,l){return{input:e,output:n,video:u=>{const d={codec:"avc",...o?{bitrate:o}:{}},f=r.maxSize;return typeof f=="number"&&Number.isFinite(f)&&(u.displayWidth>u.displayHeight?d.width=Math.min(u.displayWidth,f):d.height=Math.min(u.displayHeight,f),this.log("Applying video resize:",{originalWidth:u.displayWidth,originalHeight:u.displayHeight,maxSize:f,targetWidth:d.width,targetHeight:d.height,bitrate:o||"custom"})),d},audio:a?i&&s?{codec:"opus",bitrate:s,forceTranscode:!0}:u=>{const d=l.get(u.id),f=d?.channels??r.audioChannels??u.numberOfChannels,h=d?.sampleRate??r.audioSampleRate??u.sampleRate;this.log("Configuring audio track for compression:",{inputCodec:u.codec,inputChannels:u.numberOfChannels,inputSampleRate:u.sampleRate,targetChannels:f,targetSampleRate:h});const p=d?.bitrate??this.parseAudioBitrate(r.audioBitrate)??128e3;return{codec:"opus",forceTranscode:!0,...typeof f=="number"?{numberOfChannels:f}:{},...typeof h=="number"?{sampleRate:h}:{},bitrate:p}}:u=>{this.log("Copying audio track as-is (Opus encoding not supported):",{trackId:u.id,codec:u.codec,channels:u.numberOfChannels,sampleRate:u.sampleRate})},showWarnings:!1}}validateConversion(e,n,r,i){if(e.discardedTracks.length>0){this.log("Discarded tracks:",e.discardedTracks.map(o=>({type:o.track.type,reason:o.reason})));const s=e.discardedTracks.filter(o=>o.track.type==="video"||o.track.type==="audio");if(s.length>0&&(console.warn("[MediaBunnyCompression] Important tracks discarded:",s.map(a=>({type:a.track.type,reason:a.reason,codec:a.track.type==="audio"?a.track.codec:void 0}))),s.some(a=>a.track.type==="audio"&&a.reason==="no_encodable_target_codec")&&i))throw ys(this.context,"Mediabunny cannot encode audio for this environment, falling back to FFmpeg."),sf(n,r,!0),new Error("mediabunny-unsupported-audio-codec")}return e.isValid?null:(ys(this.context,"Conversion is not valid:",e.discardedTracks),sf(n,r,!0),{file:new File([],""),wasCompressed:!1,wasSkipped:!0})}async executeConversion(e,n){const r=new Promise(i=>{this.abortController.signal.addEventListener("abort",()=>{this.log("Mediabunny conversion aborted"),e.cancel().then(i)})});return await Promise.race([e.execute(),r]),this.checkAbort(n)}async compressWithMediabunny(e,n){let r=null,i=null,s=null;const o=typeof n?.mediabunnyAudioQuality<"u",a=n?.mediabunnyAudioQuality,l=n?.mediabunnyVideoQuality??n?.mediabunnyAudioQuality;try{this.log("Starting Mediabunny compression"),this.abortController=new AbortController,r=new Kv({source:new UT(e),formats:zT}),s=new MM,i=new Jv({target:s,format:new Ex({fastStart:"in-memory"})});const c=await r.getAudioTracks(),u=c.length>0;this.log("Input audio tracks:",c.length),c.length>0&&this.log("First audio track codec:",c[0].codec);const d=await this.validateMediabunnyAudioConfig(c,n,o);let{canEncodeOpus:f,audioConfigByTrack:h,desiredAudioSampleRate:p,desiredAudioBitrate:m}=d;const g=this.buildConversionOptions(r,i,n,o,a,l,f,h),y=await Cx.init(g),w=this.validateConversion(y,r,i,f);if(w)return this.abortController=null,w;y.onProgress=P=>{this.onProgress&&this.onProgress(Math.round(P*100))};const k=await this.executeConversion(y,e);if(k)return sf(r,null),this.abortController=null,k;const C=s.buffer;if(!C)throw new Error("Output buffer is null");let A=new Blob([C],{type:"video/mp4"});if(sf(r,null),!f&&u){this.log("Attempting to mux original audio track via FFmpeg copy");const P=await this.mergeVideoAndAudioWithFFmpeg(A,e),S=this.checkAbort(e);if(S)return this.abortController=null,S;if(!P)return ys(this.context,"Audio mux failed; falling back to FFmpeg compression."),this.abortController=null,await this.compressWithFFmpeg(e,n);A=P,this.log("Successfully muxed original audio track.")}const E=QN(A,e,this.context);if(!E.wasCompressed)return this.abortController=null,E;if(f&&u&&(m||p)){if(!(await this.verifyMediabunnyAudio(E.file,p,m)).passed)return this.abortController=null,await this.compressWithFFmpeg(e,n)}else!f&&u&&this.log("Audio was copied as-is, skipping audio verification");return this.onProgress&&this.onProgress(100),this.abortController=null,E}catch(c){sf(r,null);const u=this.checkAbort(e);return u?(this.abortController=null,u):(console.error("[MediaBunnyCompression] Mediabunny compression failed:",c),this.abortController=null,{file:e,wasCompressed:!1,wasSkipped:!0})}}async verifyMediabunnyAudio(e,n,r){const i=typeof r=="number"&&Number.isFinite(r),s=typeof n=="number"&&Number.isFinite(n);if(!i&&!s)return{passed:!0};let o=null;try{o=new Kv({source:new UT(e),formats:zT});const a=await o.getAudioTracks();if(a.length===0)return ys(this.context,"Mediabunny output lost audio track; falling back to FFmpeg"),{passed:!1};const l=a[0],c=await l.computePacketStats(120),u=l.sampleRate,d=c.averageBitrate;if(this.log("Mediabunny audio verification:",{expectedBitrate:r,actualBitrate:d,expectedSampleRate:n,actualSampleRate:u}),s&&Math.abs(u-n)>1)return ys(this.context,"Audio sample rate mismatch detected, falling back to FFmpeg"),{passed:!1};if(i){const f=r*1.25;if(!Number.isFinite(d)||d>f)return ys(this.context,"Audio bitrate exceeds expected range, falling back to FFmpeg",{actualBitrate:d,allowedUpperBitrate:f}),{passed:!1}}return{passed:!0}}catch(a){return ys(this.context,"Audio verification error, falling back to FFmpeg:",a),{passed:!1}}finally{o?.dispose()}}}var rn;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(rn||(rn={}));const Foe=(()=>{let t=0;return()=>t++})(),zoe=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Uoe=new Error("called FFmpeg.terminate()");class Hoe{#e=null;#t={};#n={};#s=[];#r=[];loaded=!1;#o=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:n,data:r}})=>{switch(n){case rn.LOAD:this.loaded=!0,this.#t[e](r);break;case rn.MOUNT:case rn.UNMOUNT:case rn.EXEC:case rn.WRITE_FILE:case rn.READ_FILE:case rn.DELETE_FILE:case rn.RENAME:case rn.CREATE_DIR:case rn.LIST_DIR:case rn.DELETE_DIR:this.#t[e](r);break;case rn.LOG:this.#s.forEach(i=>i(r));break;case rn.PROGRESS:this.#r.forEach(i=>i(r));break;case rn.ERROR:this.#n[e](r);break}delete this.#t[e],delete this.#n[e]})};#i=({type:e,data:n},r=[],i)=>this.#e?new Promise((s,o)=>{const a=Foe();this.#e&&this.#e.postMessage({id:a,type:e,data:n},r),this.#t[a]=s,this.#n[a]=o,i?.addEventListener("abort",()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(zoe);on(e,n){e==="log"?this.#s.push(n):e==="progress"&&this.#r.push(n)}off(e,n){e==="log"?this.#s=this.#s.filter(r=>r!==n):e==="progress"&&(this.#r=this.#r.filter(r=>r!==n))}load=({classWorkerURL:e,...n}={},{signal:r}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/ehagaki/assets/worker-0l8QF2aX.js",import.meta.url),{type:"module"}),this.#o()),this.#i({type:rn.LOAD,data:n},void 0,r));exec=(e,n=-1,{signal:r}={})=>this.#i({type:rn.EXEC,data:{args:e,timeout:n}},void 0,r);terminate=()=>{const e=Object.keys(this.#n);for(const n of e)this.#n[n](Uoe),delete this.#n[n],delete this.#t[n];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,n,{signal:r}={})=>{const i=[];return n instanceof Uint8Array&&i.push(n.buffer),this.#i({type:rn.WRITE_FILE,data:{path:e,data:n}},i,r)};mount=(e,n,r)=>{const i=[];return this.#i({type:rn.MOUNT,data:{fsType:e,options:n,mountPoint:r}},i)};unmount=e=>{const n=[];return this.#i({type:rn.UNMOUNT,data:{mountPoint:e}},n)};readFile=(e,n="binary",{signal:r}={})=>this.#i({type:rn.READ_FILE,data:{path:e,encoding:n}},void 0,r);deleteFile=(e,{signal:n}={})=>this.#i({type:rn.DELETE_FILE,data:{path:e}},void 0,n);rename=(e,n,{signal:r}={})=>this.#i({type:rn.RENAME,data:{oldPath:e,newPath:n}},void 0,r);createDir=(e,{signal:n}={})=>this.#i({type:rn.CREATE_DIR,data:{path:e}},void 0,n);listDir=(e,{signal:n}={})=>this.#i({type:rn.LIST_DIR,data:{path:e}},void 0,n);deleteDir=(e,{signal:n}={})=>this.#i({type:rn.DELETE_DIR,data:{path:e}},void 0,n)}const Voe=t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{const{result:i}=r;i instanceof ArrayBuffer?e(new Uint8Array(i)):e(new Uint8Array)},r.onerror=i=>{n(Error(`File could not be read! Code=${i?.target?.error?.code||-1}`))},r.readAsArrayBuffer(t)}),Mw=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await Voe(t);else return new Uint8Array;return new Uint8Array(e)};class joe extends XN{ffmpeg=null;isLoaded=!1;loadPromise=null;isCompressing=!1;constructor(){super("FFmpegCompression")}abort(){if(this.log("Abort requested"),this.resetProgress(),this.ffmpeg&&this.isCompressing){this.log("Terminating FFmpeg");try{this.ffmpeg.terminate()}catch(e){ys(this.context,"Error terminating FFmpeg:",e)}}}async loadFFmpeg(){if(!this.isLoaded)return this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{this.log("Loading FFmpeg from node_modules"),this.ffmpeg=new Hoe,this.ffmpeg.on("log",({message:e})=>{console.log("[FFmpeg]",e)}),this.ffmpeg.on("progress",({progress:e})=>{this.updateProgress(e*100)});try{const e="/ehagaki/",n=new URL(e,window.location.origin).href,r=new URL("ffmpeg-core/ffmpeg-core.js",n).href,i=new URL("ffmpeg-core/ffmpeg-core.wasm",n).href;this.log("Base URL:",n),this.log("Core URL:",r),this.log("WASM URL:",i),await this.ffmpeg.load({coreURL:r,wasmURL:i}),this.isLoaded=!0,this.log("FFmpeg loaded successfully")}catch(e){throw ys(this.context,"Failed to load FFmpeg:",e),e}})(),this.loadPromise)}async mergeVideoAndAudioWithFFmpeg(e,n){const r="mediabunny-video.mp4",i="mediabunny-audio-source.mp4",s="mediabunny-merged.mp4",o=async a=>{if(!a)return;const l=[r,i,s];for(const c of l)try{await a.deleteFile(c)}catch{}};try{if(Gt.value)return this.log("Abort detected before audio mux"),null;await this.loadFFmpeg();const a=this.ffmpeg;if(!a)return ys(this.context,"FFmpeg instance unavailable for audio mux"),null;await a.writeFile(r,await Mw(e)),await a.writeFile(i,await Mw(n));const l=["-i",r,"-i",i,"-map","0:v:0","-map","1:a:0","-c:v","copy","-c:a","copy","-movflags","+faststart","-shortest","-y",s];if(this.log("Executing FFmpeg audio mux with args:",l),this.isCompressing=!0,await a.exec(l),Gt.value)return this.log("Abort detected during audio mux"),await o(a),null;const c=await a.readFile(s),u=new Blob([c],{type:"video/mp4"});return await o(a),u}catch(a){return Gt.value?this.log("Audio mux aborted, returning null"):ys(this.context,"Failed to mux audio with FFmpeg copy:",a),await o(this.ffmpeg),null}finally{this.isCompressing=!1}}buildFFmpegArgs(e,n,r){const i=["-i",e,"-c:v","libx264","-crf",String(r.crf),"-preset",r.preset,"-c:a","aac","-b:a",r.audioBitrate||"128k"];if(r.audioSampleRate&&i.push("-ar",String(r.audioSampleRate)),r.audioChannels&&i.push("-ac",String(r.audioChannels)),r.maxSize){const s=`scale='if(gte(iw,ih),min(${r.maxSize},iw),-2)':'if(lt(iw,ih),min(${r.maxSize},ih),-2)'`;i.push("-vf",s)}return i.push("-movflags","+faststart","-y",n),i}async compressWithFFmpeg(e,n){try{this.log("Loading FFmpeg..."),await this.loadFFmpeg();const r=this.checkAbort(e);if(r)return r;if(!this.ffmpeg)throw new Error("FFmpeg not loaded");const i="input.mp4",s="output.mp4";await this.ffmpeg.writeFile(i,await Mw(e));const o=this.buildFFmpegArgs(i,s,n),a=this.checkAbort(e);if(a)return await this.ffmpeg.deleteFile(i),a;this.log("Starting compression with args:",o),this.isCompressing=!0;try{await this.ffmpeg.exec(o)}catch(u){if(Gt.value)this.log("Compression aborted during execution");else throw console.error("[FFmpegCompression] FFmpeg execution error:",u),u}finally{this.isCompressing=!1}if(Gt.value){this.log("Cleaning up after abort");try{await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s)}catch{}return{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}}const l=await this.ffmpeg.readFile(s),c=new Blob([l],{type:"video/mp4"});return await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s),QN(c,e,this.context)}catch(r){return this.isCompressing=!1,Gt.value?(this.log("Compression aborted, using original file"),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}):(console.error("[FFmpegCompression] Compression failed:",r),{file:e,wasCompressed:!1,wasSkipped:!0})}}async cleanup(){if(this.ffmpeg&&this.isLoaded)try{this.isLoaded=!1,this.ffmpeg=null,this.loadPromise=null}catch(e){console.error("[FFmpegCompression] Cleanup error:",e)}}}class aA{constructor(e){this.localStorage=e,this.ffmpegCompression=new joe,this.mediabunnyCompression=new $oe(this.parseAudioBitrate.bind(this),this.ffmpegCompression.mergeVideoAndAudioWithFFmpeg.bind(this.ffmpegCompression),this.ffmpegCompression.compressWithFFmpeg.bind(this.ffmpegCompression))}context="VideoCompressionService";mediabunnyCompression;ffmpegCompression;useMediabunny=null;mediabunnyCheckPromise=null;onProgress;async checkMediaBunnySupport(){return this.useMediabunny!==null?this.useMediabunny:this.mediabunnyCheckPromise?this.mediabunnyCheckPromise:(this.mediabunnyCheckPromise=(async()=>{const e=await Loe();return this.useMediabunny=e,Ks(this.context,`Using ${e?"Mediabunny":"FFmpeg"} for compression`),e})(),this.mediabunnyCheckPromise)}abort(){Ks(this.context,"Abort requested"),this.onProgress&&this.onProgress(0),this.mediabunnyCompression.abort(),this.ffmpegCompression.abort()}setProgressCallback(e){this.onProgress=e,this.mediabunnyCompression.setProgressCallback(e),this.ffmpegCompression.setProgressCallback(e)}getCompressionOptions(){const e=this.localStorage.getItem("videoCompressionLevel")||"medium",n=SZ[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n||null}hasCompressionSettings(){return this.getCompressionOptions()!==null}parseAudioBitrate(e){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const n=Number.parseInt(e,10);if(Number.isFinite(n)&&n>0)return n*1e3}return null}async compress(e){if(!Roe(e))return Ks(this.context,"Skipping non-video file"),{file:e,wasCompressed:!1};if(Noe(e))return Ks(this.context,"Skipping small video file"),{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(Ooe(n,this.context))return{file:e,wasCompressed:!1,wasSkipped:!0};if(Gt.value)return Ks(this.context,"Compression aborted"),this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0};try{if(await this.checkMediaBunnySupport()){Ks(this.context,"Attempting compression with MediaBunny");const i=await this.mediabunnyCompression.compressWithMediabunny(e,n);return!i.wasCompressed&&!i.wasSkipped?(Ks(this.context,"MediaBunny failed, falling back to FFmpeg"),await this.ffmpegCompression.compressWithFFmpeg(e,n)):i}else return Ks(this.context,"Using FFmpeg for compression"),await this.ffmpegCompression.compressWithFFmpeg(e,n)}catch(r){return console.error("[VideoCompressionService] Compression failed:",r),{file:e,wasCompressed:!1,wasSkipped:!0}}}async cleanup(){await this.ffmpegCompression.cleanup(),await this.mediabunnyCompression.cleanup()}}var lu=Symbol("verified"),Woe=t=>t instanceof Object;function qoe(t){if(!Woe(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}new TextDecoder("utf-8");var YN=new TextEncoder,Koe=class{generateSecretKey(){return Qs.utils.randomPrivateKey()}getPublicKey(t){return Vn(Qs.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=Vn(Qs.getPublicKey(e)),n.id=Ow(n),n.sig=Vn(Qs.sign(Ow(n),e)),n[lu]=!0,n}verifyEvent(t){if(typeof t[lu]=="boolean")return t[lu];const e=Ow(t);if(e!==t.id)return t[lu]=!1,!1;try{const n=Qs.verify(t.sig,e,t.pubkey);return t[lu]=n,n}catch{return t[lu]=!1,!1}}};function Goe(t){if(!qoe(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Ow(t){let e=Hc(YN.encode(Goe(t)));return Vn(e)}var G0=new Koe;G0.generateSecretKey;G0.getPublicKey;G0.finalizeEvent;G0.verifyEvent;var Zoe=27235,Qoe="Nostr ";async function Xoe(t,e,n,r=!1,i){const s={kind:Zoe,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""},o=await n(s);return(r?Qoe:"")+lo.encode(YN.encode(JSON.stringify(o)))}const TS=Qi([]);function Yoe(){return window.location.port==="4173"||window.location.hostname==="localhost"}function JN(){return Yoe()}function Joe(...t){const e=t.map(n=>typeof n=="object"?JSON.stringify(n):String(n)).join(" ");TS.update(n=>[e,...n].slice(0,250))}const eae=console.log;typeof window<"u"&&(window.__originalConsoleLog=eae);async function tae(t){let e=[];t?e=t:TS.subscribe(r=>e=r)();const n=e?.join(`
`)??"";n&&j0(n,"dev log",navigator,window)}typeof window<"u"&&(window.showSwUpdateModalDebug=()=>{Mx.set(!0),console.log("SWæ´æ°ãã¿ã³ãå¼·å¶è¡¨ç¤ºãã¾ããï¼è¨­å®ãã¿ã³ã©ã³ãï¼SettingsDialogåï¼")});JN()&&(window.testDevLog=()=>{console.log("ãã¹ãç¨ã­ã°åºå:",new Date().toISOString()),Joe("ç´æ¥devLogã«è¿½å :",Math.random())},window.showPostSuccessDebug=()=>{bn.postStatus={...bn.postStatus,success:!0,error:!1,message:"post_success",completed:!0}},window.showPostErrorDebug=()=>{bn.postStatus={...bn.postStatus,success:!1,error:!0,message:"post_error",completed:!1}});class nae{constructor(e){this.document=e}mimeSupportCache={};webpQualitySupport;async canEncodeWebpWithQuality(){if(this.webpQualitySupport!==void 0)return this.webpQualitySupport;try{if(!this.document)return this.webpQualitySupport=!1;const e=this.document.createElement("canvas");e.width=2,e.height=2;const n=e.getContext("2d");if(!n)return this.webpQualitySupport=!1;n.fillStyle="#f00",n.fillRect(0,0,2,2);const r=e.toDataURL("image/webp",.2),i=e.toDataURL("image/webp",.9),s=r.startsWith("data:image/webp")&&i.startsWith("data:image/webp")&&r.length!==i.length;return this.webpQualitySupport=s,s}catch{return this.webpQualitySupport=!1,!1}}canEncodeMimeType(e){if(!e)return!1;if(e in this.mimeSupportCache)return this.mimeSupportCache[e];try{if(!this.document)return this.mimeSupportCache[e]=!1;const n=this.document.createElement("canvas");n.width=2,n.height=2;const r=n.getContext("2d");if(!r)return this.mimeSupportCache[e]=!1;r.fillStyle="#000",r.fillRect(0,0,2,2);const i=n.toDataURL(e),s=typeof i=="string"&&i.startsWith(`data:${e}`);return this.mimeSupportCache[e]=s,s}catch{return this.mimeSupportCache[e]=!1,!1}}}class lA{constructor(e,n){this.mimeSupport=e,this.localStorage=n}onProgress;abort(){this.onProgress&&this.onProgress(0)}setProgressCallback(e){this.onProgress=e}getCompressionOptions(){const e=this.localStorage.getItem("imageCompressionLevel")||"medium",n=xZ[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n?{...n,preserveExif:!1}:null}hasCompressionSettings(){return this.getCompressionOptions()!==null}async compress(e){if(Gt.value)return{file:e,wasCompressed:!1,aborted:!0};if(!e.type.startsWith("image/"))return{file:e,wasCompressed:!1};if(e.size<=20*1024)return{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(!n)return{file:e,wasCompressed:!1,wasSkipped:!0};let r={...n,onProgress:s=>{this.onProgress&&this.onProgress(Math.round(s*100))}};if(r.fileType==="image/webp"&&(await this.mimeSupport.canEncodeWebpWithQuality()||(r.fileType=e.type==="image/png"?"image/png":"image/jpeg")),Gt.value)return{file:e,wasCompressed:!1,aborted:!0};let i=r.fileType||e.type;this.mimeSupport.canEncodeMimeType(i)||(i=e.type,delete r.fileType);try{const s=await Ar(e,r);if(Gt.value)return this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0};if(s.size>=e.size)return{file:e,wasCompressed:!1};const o=r.fileType||s.type||i||e.type,a=gX(e.name,o),l=new File([s],a,{type:o});return{file:l,wasCompressed:!0}}catch(s){return Gt.value?(this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0}):(console.warn("[ImageCompressionService] Compression failed:",s),{file:e,wasCompressed:!1,wasSkipped:!0})}}}class rae{async buildAuthHeader(e,n="POST"){const r=k1.getFromStore()||k1.loadFromStorage();let i;if(r)i=s=>pv(r).signEvent(s);else{const s=window?.nostr;if(s?.signEvent)i=o=>s.signEvent(o);else throw new Error("Authentication required")}return await Xoe(e,n,i,!0)}}class e5{constructor(e={localStorage:window.localStorage,fetch:window.fetch.bind(window),crypto:window.crypto.subtle,document:window.document,window,navigator:window.navigator},n,r,i,s){this.dependencies=e,this.mimeSupport=s||new nae(e.document),this.imageCompressionService=r||new lA(this.mimeSupport,e.localStorage),this.videoCompressionService=i||new aA(e.localStorage),this.authService=n||new rae,this.videoCompressionService instanceof aA&&!HZ()&&(UZ(this.videoCompressionService),console.log("[FileUploadManager] VideoCompressionService registered to store")),this.imageCompressionService instanceof lA&&!jZ()&&(VZ(this.imageCompressionService),console.log("[FileUploadManager] ImageCompressionService registered to store"))}imageCompressionService;videoCompressionService;mimeSupport;authService;validateImageFile(e){return e.type.startsWith("image/")?e.size>t_?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}:{isValid:!1,errorMessage:"only_images_allowed"}}validateMediaFile(e){const n=e.type.startsWith("image/"),r=e.type.startsWith("video/");return!n&&!r?{isValid:!1,errorMessage:"only_images_or_videos_allowed"}:e.size>t_?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}}async generateBlurhashForFile(e){return await NQ(e)}async createPlaceholderUrl(e){return await OQ(e)}getUploadEndpoint(e){const n=this.dependencies.localStorage.getItem("uploadEndpoint"),r=i=>i&&i.trim().length>0?i:void 0;return r(n)??r(e)??Xd}async pollUploadStatus(e,n,r=Fb.MAX_WAIT_TIME){const i=Date.now();for(;;){if(Gt.value)throw new Error("Upload aborted by user");if(Date.now()-i>r)throw new Error(Fb.TIMEOUT_MESSAGE);const s=await this.dependencies.fetch(e,{method:"GET",headers:{Authorization:n}});if(!s.ok)throw new Error(`Unexpected status code ${s.status} while polling processing_url`);let o=null;try{o=await s.json()}catch{o=null}if(s.status===201&&o)return o;if(o?.status==="processing"){await new Promise(a=>setTimeout(a,Fb.RETRY_INTERVAL));continue}if(o?.status==="success")return o;if(o?.status==="error")throw new Error(o?.message||"File processing failed");if(s.status===200)return o;throw new Error("Unexpected processing status")}}async uploadFile(e,n=Xd,r=!1,i,s){let o;try{if(!e)return{success:!1,error:"No file selected"};let a;try{a=await ZM(e,this.dependencies.crypto)}catch{a=void 0}const l=e.size;if(Gt.value)return r&&console.log("[FileUploadManager] Upload aborted before compression"),{success:!1,error:"Upload aborted by user",aborted:!0};const c=e.type.startsWith("video/"),u=c?this.videoCompressionService:this.imageCompressionService;c&&s?.onVideoCompressionProgress&&this.videoCompressionService.setProgressCallback(s.onVideoCompressionProgress),!c&&s?.onImageCompressionProgress&&this.imageCompressionService.setProgressCallback(s.onImageCompressionProgress);const{file:d,wasCompressed:f,wasSkipped:h,aborted:p}=await u.compress(e);if(c?this.videoCompressionService.setProgressCallback(void 0):this.imageCompressionService.setProgressCallback(void 0),p)return r&&console.log("[FileUploadManager] Upload aborted by user"),{success:!1,error:"Upload aborted by user",aborted:!0};const m=d.size,g=c?this.videoCompressionService.hasCompressionSettings():this.imageCompressionService.hasCompressionSettings();o=oX(l,m,g||f,e.name,d.name,h);const y=this.getUploadEndpoint(n),w=await this.authService.buildAuthHeader(y,"POST"),k=new FormData;k.append("file",d),i?.caption&&k.append("caption",String(i.caption)),i?.expiration!==void 0&&k.append("expiration",String(i.expiration)),k.append("size",String(d.size)),i?.alt&&k.append("alt",String(i.alt)),i?.media_type&&k.append("media_type",String(i.media_type)),k.append("content_type",i?.content_type?String(i.content_type):d.type||""),k.append("no_transform",i?.no_transform?String(i.no_transform):"true");const C=await this.dependencies.fetch(y,{method:"POST",headers:{Authorization:w},body:k});if(Gt.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};if(!C.ok){const P=await C.text().catch(()=>"Unknown error");return{success:!1,error:`Upload failed: ${C.status} ${C.statusText} - ${P}`,sizeInfo:o}}let A;try{A=await C.json()}catch(P){return r&&console.error("[dev] JSON parse error:",P),{success:!1,error:"Could not parse upload response",sizeInfo:o}}if((C.status===200||C.status===202)&&A.processing_url)try{const P=await this.authService.buildAuthHeader(A.processing_url,"GET");if(A=await this.pollUploadStatus(A.processing_url,P),Gt.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0}}catch(P){return{success:!1,error:P instanceof Error?P.message:String(P),sizeInfo:o}}const E={};if(A?.nip94_event?.tags&&Array.isArray(A.nip94_event.tags))for(const P of A.nip94_event.tags){if(!Array.isArray(P)||P.length<2)continue;const S=String(P[0]),x=P.slice(1).join(" ");S in E||(E[S]=x)}if(A.status==="success"&&A.nip94_event?.tags){const P=A.nip94_event.tags.find(S=>S[0]==="url");if(P?.[1])return{success:!0,url:P[1],sizeInfo:o,nip94:E}}return{success:!1,error:A.message||"Could not extract URL from response",sizeInfo:o,nip94:Object.keys(E).length?E:void 0}}catch(a){if(Gt.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};r&&console.error("[dev] Upload error:",a);const l=a instanceof Error?a.message:String(a);return l.includes("aborted by user")?{success:!1,error:l,sizeInfo:o,aborted:!0}:{success:!1,error:l.includes("Failed to fetch")?`${l} (Service Workerãç»åã¢ããã­ã¼ãããã­ãã¯ãã¦ããå¯è½æ§ãããã¾ã)`:l}}}async uploadMultipleFiles(e,n=Xd,r,i=!1,s,o){if(!e?.length)return[];const a=new Array(e.length);let l=0,c=0,u=0;const d=()=>r?.({completed:l,failed:c,aborted:u,total:e.length,inProgress:l+c+u<e.length});d();for(let f=0;f<e.length;f++){if(Gt.value){for(let p=f;p<e.length;p++)a[p]={success:!1,aborted:!0},u++;d();break}const h=e[f];try{const p=s?s[f]:void 0,m=await this.uploadFile(h,n,i,p,o);a[f]=m,m.success?l++:m.aborted?u++:c++,d()}catch(p){a[f]={success:!1,error:p instanceof Error?p.message:String(p)},c++,d()}}return a}async uploadFileWithCallbacks(e,n=Xd,r,i=!1,s){r?.onProgress?.({completed:0,failed:0,aborted:0,total:1,inProgress:!0});try{const o=await this.uploadFile(e,n,i,s,r);if(r?.onProgress?.({completed:o.success?1:0,failed:!o.success&&!o.aborted?1:0,aborted:o.aborted?1:0,total:1,inProgress:!1}),o.success&&o.sizeInfo&&!o.aborted){const a=E_(o.sizeInfo);a&&w_(a)}return o}catch(o){return r?.onProgress?.({completed:0,failed:1,aborted:0,total:1,inProgress:!1}),{success:!1,error:o instanceof Error?o.message:String(o)}}}async uploadMultipleFilesWithCallbacks(e,n=Xd,r,i){if(!e?.length)return[];r?.onProgress?.({completed:0,failed:0,aborted:0,total:e.length,inProgress:!0});const s=await this.uploadMultipleFiles(e,n,r?.onProgress,!1,i,r);if(!Gt.value){const o=s.find(a=>a.success&&a.sizeInfo);if(o?.sizeInfo){const a=E_(o.sizeInfo);a&&w_(a)}}return s}async getSharedImageFromServiceWorker(){if(!this.dependencies.navigator?.serviceWorker?.controller)return null;try{const e=new MessageChannel,n=new Promise(r=>{e.port1.onmessage=i=>{i.data?.type==="SHARED_IMAGE"?r(i.data.data):r(null)},setTimeout(()=>r(null),3e3)});return this.dependencies.navigator.serviceWorker.controller.postMessage({action:"getSharedImage"},[e.port2]),await n}catch(e){return console.error("Service Workerããã®å±æç»ååå¾ã«å¤±æ:",e),null}}checkIfOpenedFromShare(){return this.dependencies.window?.location?new URLSearchParams(this.dependencies.window.location.search).get("shared")==="true":!1}async processSharedImageOnLaunch(){try{const e=await this.getSharedImageFromServiceWorker();return e?.image?{success:!0,data:e,fromServiceWorker:!0}:{success:!1,error:"å±æç»åãè¦ã¤ããã¾ãã"}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}}class iae{dependencies;devMode;fileUploadManager;constructor(e,n){this.dependencies=e,this.devMode=n,this.fileUploadManager=new this.dependencies.FileUploadManager}async uploadFiles(e,n,r,i){try{if(e.length===1)return[await this.fileUploadManager.uploadFileWithCallbacks(e[0],n,r,this.devMode,i?.[0])];if(e.length>1)return await this.fileUploadManager.uploadMultipleFilesWithCallbacks(e,n,r,i)}catch(s){if(this.devMode){const a=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";console.error(`${a} [uploadHelper] Upload error:`,s)}throw s}return null}}function Nw(t,e,n,r,i,s=!1,o=!1){return r(!1),o&&n&&dN(n,s),i?.onProgress&&i.onProgress({completed:0,failed:0,aborted:t.length,total:t.length,inProgress:!1}),{placeholderMap:o?[]:e,results:null,imageOxMap:{},imageXMap:{},failedResults:[],errorMessage:"Upload aborted by user"}}const t5=()=>({localStorage:window.localStorage,crypto:window.crypto.subtle,tick:Tl,FileUploadManager:e5,getImageDimensions:mX,extractImageBlurhashMap:WM,calculateImageHash:LQ,getMimeTypeFromUrl:qM,createImetaTag:async t=>await jM(t),imageSizeMapStore:T1});async function sae({files:t,currentEditor:e,fileInput:n,uploadCallbacks:r,showUploadError:i,updateUploadState:s,devMode:o,dependencies:a=t5()}){const l=Array.from(t),c=a.localStorage.getItem("uploadEndpoint")||"",u={},d={},h=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:0,total:l.length,inProgress:!0}),Gt.reset();const p=new iae(a,o);let m;try{m=await NX(l,a)}catch(E){if(E instanceof Error&&E.message==="Upload aborted by user")return s(!1),r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:l.length,total:l.length,inProgress:!1}),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:"Upload aborted by user"};throw E}if(Gt.value)return Nw(l,[],e,s,r,o,!1);let g=ooe(l,m,e,i,a.imageSizeMapStore,a.FileUploadManager,o);if(g.length===0)return{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:""};if(Gt.value||(s(!0,""),await aoe(g,e,a.FileUploadManager,o),Gt.value))return Nw(l,g,e,s,r,o,!0);const y=g.map(E=>E.file);let w=null;try{const E=RX(y);w=await p.uploadFiles(y,c,r,E)}catch(E){const P=E instanceof Error?E.message:String(E);i(P,5e3),w=null}finally{s(!1)}if(Gt.value)return n&&(n.value=""),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:"Upload aborted by user"};await a.tick();const k=[];let C="",A={};if(w&&g.length>0){const E=await loe(w,g,e,u,d,a.imageSizeMapStore,a.extractImageBlurhashMap,a.getMimeTypeFromUrl,a.calculateImageHash,a.createImetaTag,o);k.push(...E.failedResults),C=E.errorMessage,A=E.imageServerBlurhashMap,g=[]}if(o&&e)try{const E=a.extractImageBlurhashMap(e),P=new Set([...Object.keys(E),...Object.keys(A)]);await Promise.all(Array.from(P).map(async x=>{if(!d[x]){const _=await a.calculateImageHash(x);_&&(d[x]=_)}}));const S=await Promise.all(Array.from(P).map(async x=>{const _=A[x]??E[x],I=a.getMimeTypeFromUrl(x),D=u[x],B=d[x];return(await a.createImetaTag({url:x,m:I,blurhash:_,ox:D,x:B})).join(" ")}))}catch(E){console.warn(`${h} [dev] imetaã¿ã°çæå¤±æ`,E)}return n&&(n.value=""),{placeholderMap:g,results:w,imageOxMap:u,imageXMap:d,failedResults:k,errorMessage:C}}function oae(t){const{onUploadProgress:e,videoCompressionProgressStore:n,imageCompressionProgressStore:r}=t;return e?{onProgress:e,onVideoCompressionProgress:i=>{n.set(i)},onImageCompressionProgress:i=>{r.set(i)}}:void 0}function cA(t,e=3e3,n){n.updateUploadState(!1,t),setTimeout(()=>n.updateUploadState(!1,""),e)}async function aae(t){const{files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,updateUploadState:s,devMode:o,imageOxMap:a,imageXMap:l,dependencies:c=t5(),getUploadFailedText:u}=t;if(!e||e.length===0)return;const d=await sae({files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,showUploadError:(f,h)=>cA(f,h,{updateUploadState:s}),updateUploadState:s,devMode:o,dependencies:c});Object.assign(a,d.imageOxMap),Object.assign(l,d.imageXMap),d.failedResults?.length&&cA(d.errorMessage||(d.failedResults.length===1?d.failedResults[0].error||u("postComponent.upload_failed"):`${d.failedResults.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`),5e3,{updateUploadState:s}),r&&(r.value="")}async function lae(t){const{files:e,currentEditor:n,fileInput:r,onUploadProgress:i,updateUploadState:s,imageOxMap:o,imageXMap:a,videoCompressionProgressStore:l,imageCompressionProgressStore:c,getUploadFailedText:u,dependencies:d}=t,f=oae({onUploadProgress:i,videoCompressionProgressStore:l,imageCompressionProgressStore:c});await aae({files:e,currentEditor:n,fileInput:r,uploadCallbacks:f,updateUploadState:s,devMode:!1,imageOxMap:o,imageXMap:a,dependencies:d,getUploadFailedText:u})}var cae=Ve('<div class="context-menu-header svelte-1ea8bn9"> </div>'),uae=async(t,e,n,r,i)=>{if(M(e).icon==="/icons/copy-solid-full.svg"||/copy/i.test(String(M(e).label)))try{M(e).action(),n(t)}catch(o){console.warn("Copy failed:",o),r(t)}else M(e).action();i.onClose()},dae=Ve('<span aria-hidden="true"></span>'),fae=Ve('<button role="menuitem"><!> </button>'),hae=Ve('<div class="context-menu svelte-1ea8bn9" role="menu" aria-label="Image context menu"><!> <!></div>');function pae(t,e){Mn(e,!0);let n=e.x,r=e.y,i=Ee(At(e.x)),s=Ee(At(e.y)),o=Ee(void 0),a=Ee(!0),l=0,c=!1;function u(S){if(M(a))return;const x=Date.now();c&&x-l<500||M(o)&&!M(o).contains(S.target)&&(e.onClose(),Ni.set({open:!1,nodeId:void 0}))}function d(S){M(a)||(c=!0,l=Date.now(),M(o)&&S.target instanceof Node&&!M(o).contains(S.target)&&(e.onClose(),Ni.set({open:!1,nodeId:void 0})))}function f(S){S.key==="Escape"&&(e.onClose(),Ni.set({open:!1,nodeId:void 0}))}async function h(){await Tl();let S=M(o)?M(o).getBoundingClientRect().width:0,x=M(o)?M(o).getBoundingClientRect().height:0;(!S||S<8)&&(S=M(o)?.offsetWidth??160),(!x||x<4)&&(x=M(o)?.offsetHeight??40);const I=Uu(n,r,8,S,x);se(i,I.x,!0),se(s,I.y,!0)}Ze(()=>{n=e.x,r=e.y,h()});function p(){h()}ls(()=>{setTimeout(()=>{se(a,!1),document.addEventListener("click",u),document.addEventListener("touchend",d)},0),document.addEventListener("keydown",f),window.addEventListener("resize",p),h()}),Tc(()=>{document.removeEventListener("click",u),document.removeEventListener("touchend",d),document.removeEventListener("keydown",f),window.removeEventListener("resize",p)});let m=Ee(null);Ze(()=>{const S=e.items[0]?.src;if(typeof S=="string"){let x=S.replace(/^https?:\/\//,"");x.length>26?se(m,`${x.slice(0,18)}...${x.slice(-8)}`):se(m,x,!0)}else se(m,null)});const g=S=>{const x=mc(Jr);return typeof x=="function"?x(S):String(S)},y=Xe(()=>()=>{const S=e.items[0];if(S&&S.label){const x=typeof S.label=="string"?S.label:"";if(x===g("videoContextMenu.copyUrl")||x===g("videoContextMenu.delete"))return"video"}return"image"});function w(S){let x;S&&typeof S.clientX=="number"&&typeof S.clientY=="number"?x={x:S.clientX,y:S.clientY}:x={x:e.x,y:e.y};const _=Uu(x.x,x.y),D=M(y)()==="video"?"videoContextMenu.copySuccess":"imageContextMenu.copySuccess";e.onShowPopup(_.x,_.y,g(D))}function k(S){let x;S&&typeof S.clientX=="number"&&typeof S.clientY=="number"?x={x:S.clientX,y:S.clientY}:x={x:e.x,y:e.y};const _=Uu(x.x,x.y),D=M(y)()==="video"?"videoContextMenu.copyFailed":"imageContextMenu.copyFailed";e.onShowPopup(_.x,_.y,g(D))}var C=hae(),A=ye(C);{var E=S=>{var x=cae(),_=ye(x);Ge(()=>Qe(_,M(m))),we(S,x)};Ye(A,S=>{M(m)&&S(E)})}var P=Le(A,2);bu(P,17,()=>e.items,S=>S.label,(S,x)=>{var _=fae();let I;_.__click=[uae,x,w,k,e];var D=ye(_);{var B=R=>{var O=dae();let L;Ge(H=>L=rs(O,1,"menu-icon svg-icon svelte-1ea8bn9",null,L,H),[()=>({"expand-icon":M(x).icon==="/icons/expand-solid-full.svg","copy-icon":M(x).icon==="/icons/copy-solid-full.svg","play-pause-icon":M(x).icon==="/icons/play_pause_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg","trash-icon":M(x).icon==="/icons/trash-solid-full.svg"})]),we(R,O)};Ye(D,R=>{M(x).icon&&R(B)})}var F=Le(D);Ge(R=>{I=rs(_,1,"context-menu-item svelte-1ea8bn9",null,I,R),_.disabled=M(x).disabled,Qe(F,` ${M(x).label??""}`)},[()=>({disabled:M(x).disabled})]),we(S,_)}),Xn(C,S=>se(o,S),()=>M(o)),Ge(()=>nl(C,`left: ${M(i)??""}px; top: ${M(s)??""}px;`)),we(t,C),On()}xi(["click"]);var mae=t=>t.stopPropagation?.(),gae=(t,e)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e())},yae=Ve('<div class="popup-modal svelte-1i030h4" role="dialog" aria-modal="true" tabindex="0"><div class="popup-body svelte-1i030h4" role="document"><span class="info-icon svg-icon svelte-1i030h4" aria-hidden="true"></span> <div class="popup-children svelte-1i030h4"><!></div></div></div>');function n5(t,e){Mn(e,!0);let n=ht(e,"show",3,!1),r=ht(e,"x",3,0),i=ht(e,"y",3,0),s=ht(e,"onClose",3,void 0),o=ht(e,"children",3,void 0);function a(){try{s()&&s()()}catch{}}function l(g){g.key==="Escape"&&a()}ls(()=>{window.addEventListener("keydown",l)}),Tc(()=>{window.removeEventListener("keydown",l)});let c=Ee(void 0);Ze(()=>{n()&&M(c)&&(async()=>(await Tl(),M(c).parentElement!==document.body&&document.body.appendChild(M(c))))()}),Tc(()=>{if(M(c)&&M(c).parentElement===document.body)try{document.body.removeChild(M(c))}catch{}});let u=Ee(At(r())),d=Ee(At(i()));const f=10;Ze(()=>{n()&&M(c)&&(async()=>{if(await Tl(),M(c).parentElement===document.body){const g=M(c).getBoundingClientRect(),y=g.width,w=g.height,k=window.innerWidth,C=window.innerHeight;let A=r(),E=i();A+y+f>k&&(A=k-y-f),A-f<0&&(A=f),E+w+f>C&&(E=C-w-f),E-f<0&&(E=f),se(u,A,!0),se(d,E,!0)}})()});var h=en(),p=Et(h);{var m=g=>{var y=yae();y.__click=[mae],y.__keydown=[gae,a];var w=ye(y),k=Le(ye(w),2),C=ye(k);kc(C,()=>o()??Oi),Xn(y,A=>se(c,A),()=>M(c)),Ge(()=>nl(y,`left: ${M(u)??""}px; top: ${M(d)??""}px;`)),we(g,y)};Ye(p,g=>{n()&&g(m)})}we(t,h),On()}xi(["click","keydown"]);function bae(t,e){e()&&e()(t)}var wae=Ve("<button><!></button>");function mn(t,e){Mn(e,!0);let n=ht(e,"className",3,""),r=ht(e,"disabled",3,!1),i=ht(e,"type",3,"button"),s=ht(e,"ariaLabel",3,""),o=ht(e,"style",3,""),a=ht(e,"variant",3,"default"),l=ht(e,"shape",3,"rounded"),c=ht(e,"onClick",3,void 0),u=ht(e,"selected",3,!1);var d=wae();d.__click=[bae,c];var f=ye(d);kc(f,()=>e.children??Oi),Ge(()=>{ln(d,"type",i()),rs(d,1,`${n()} ${a()} ${l()} ${u()?"selected":""}`,"svelte-zkaaa9"),d.disabled=r(),ln(d,"aria-label",s()),nl(d,o())}),we(t,d),On()}xi(["click"]);var vae=t=>t.stopPropagation(),xae=(t,e)=>{t.key==="Escape"&&e()},Sae=Ve('<div class="xmark-icon svg-icon svelte-k7dyf5" aria-label="éãã"></div>'),Eae=Ve('<div class="dialog-footer svelte-k7dyf5"><!></div>'),kae=Ve('<div class="dialog-overlay svelte-k7dyf5" role="presentation"><div role="dialog" aria-modal="true" tabindex="0"><div class="dialog-content svelte-k7dyf5"><!></div> <!></div></div>');function Kh(t,e){Mn(e,!0);let n=ht(e,"show",15,!1),r=ht(e,"ariaLabel",3,"Dialog"),i=ht(e,"className",3,""),s=ht(e,"showFooter",3,!1),o=ht(e,"useHistory",3,!0),a=Ee(!1),l=Ee(null);const c=()=>{n(!1)},u=p=>{M(a)&&p.state?.modalId!==M(l)&&c()};Ze(()=>{if(typeof window>"u"){se(a,n(),!0),n()||e.onClose?.();return}if(!o()){se(a,n(),!0),n()||e.onClose?.();return}if(n()&&!M(a)){se(a,!0),M(l)||(se(l,`modal-${yX()}`),history.pushState({modalId:M(l)},"",window.location.href));return}if(!n()&&M(a)){const p=history.state?.modalId===M(l);se(a,!1),se(l,null),p&&history.back(),e.onClose?.()}}),ls(()=>{o()&&window.addEventListener("popstate",u)}),Tc(()=>{o()&&(window.removeEventListener("popstate",u),M(a)&&history.state?.modalId===M(l)&&history.back())});var d=en(),f=Et(d);{var h=p=>{var m=kae();m.__click=c;var g=ye(m);let y;g.__click=[vae],g.__keydown=[xae,c];var w=ye(g),k=ye(w);kc(k,()=>e.children??Oi,()=>({close:c}));var C=Le(w,2);{var A=E=>{var P=Eae(),S=ye(P);{var x=I=>{var D=en(),B=Et(D);kc(B,()=>e.footer,()=>({close:c})),we(I,D)},_=I=>{mn(I,{className:"modal-close",variant:"default",shape:"square",onClick:c,ariaLabel:"éãã",children:(D,B)=>{var F=Sae();we(D,F)},$$slots:{default:!0}})};Ye(S,I=>{e.footer?I(x):I(_,!1)})}we(E,P)};Ye(C,E=>{s()&&E(A)})}Ge(()=>{ln(m,"aria-label",r()),y=rs(g,1,`dialog ${i()??""}`,"svelte-k7dyf5",y,{dialog:!0})}),we(p,m)};Ye(f,p=>{M(a)&&p(h)})}we(t,d),On()}xi(["click","keydown"]);var Tae=Ve('<div class="secretkey-dialog-content svelte-1xq3xpu"><div class="secretkey-dialog-message svelte-1xq3xpu"> </div> <div class="secretkey-dialog-buttons svelte-1xq3xpu"><!> <!></div></div>');function _ae(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",r),[r,i]=as();let s=ht(e,"show",15,!1);{let o=Xe(()=>n()("postComponent.warning"));Kh(t,{get ariaLabel(){return M(o)},get onClose(){return e.onCancel},get show(){return s()},set show(a){s(a)},children:(a,l)=>{var c=Tae(),u=ye(c),d=ye(u),f=Le(u,2),h=ye(f);mn(h,{className:"btn-confirm",variant:"danger",shape:"square",get onClick(){return e.onConfirm},children:(m,g)=>{var y=Sn();Ge(w=>Qe(y,w),[()=>n()("postComponent.post")]),we(m,y)},$$slots:{default:!0}});var p=Le(h,2);mn(p,{className:"btn-cancel",variant:"secondary",shape:"square",get onClick(){return e.onCancel},children:(m,g)=>{var y=Sn();Ge(w=>Qe(y,w),[()=>n()("postComponent.cancel")]),we(m,y)},$$slots:{default:!0}}),Ge(m=>Qe(d,m),[()=>n()("postComponent.secret_key_detected")]),we(a,c)},$$slots:{default:!0}})}On(),i()}function Cae(t,e,n){const r=t.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{centerX:i.x,centerY:i.y,offsetX:e-r.left-i.x,offsetY:n-r.top-i.y}}function Aae(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Iae(t,e,n){const r=e.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{scale:n,offsetX:t.clientX-r.left-i.x,offsetY:t.clientY-r.top-i.y}}function Pae({scale:t,translate:e,useTransition:n},r){const i=r??document.querySelector(".image-container");i&&(i.style.transition=n?`transform ${$M.TRANSITION_DURATION} ease`:"none",i.style.transform=`scale(${t}) translate(${e.x/t}px, ${e.y/t}px)`,i.style.transformOrigin="center")}function Mae(t,e,n,r){const i=r??document.querySelector(".image-container");i&&(i.style.transition="none",i.style.transform=`scale(${t}) translate(${e/t}px, ${n/t}px)`)}function Zl(t,e){const n=e??document.querySelector(".image-container");n&&(n.style.cursor=t>Hn.DEFAULT_SCALE?"grab":"default")}function of(t,e){const n=e??document.querySelector(".fullscreen-overlay");n&&(n.style.cursor=t>Hn.DEFAULT_SCALE?"grab":"default")}function La(t){Ii.setTransition(t)}function uA(t){const e=t?"":"none";yc("user-select",e),yc("-webkit-user-select",e)}function mh(t){t!==null&&clearTimeout(t)}function dA(t,e){if(t&&e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i={imageWidth:n.width,imageHeight:n.height,containerWidth:r.width,containerHeight:r.height};Ii.setBoundaryConstraints(i)}}function Op(t,e,n,r,i){t!==null&&cancelAnimationFrame(t),e!==null&&cancelAnimationFrame(e),t=null,e=null,Ii.reset(),Ii.setBoundaryConstraints(null),n.isDragging=!1,r.isPinching=!1,mh(i),uQ()}function Oae(t,e,n,r,i,s,o){if(!s)return{isDoubleTap:!1,newLastTapTime:t,newLastTapPosition:e,newTapTimeoutId:n};const a=Date.now(),l=e?Math.sqrt(Math.pow(r-e.x,2)+Math.pow(i-e.y,2)):0;if(a-t<200&&l<50&&n!==null)return mh(n),o(r,i),{isDoubleTap:!0,newLastTapTime:0,newLastTapPosition:null,newTapTimeoutId:null};const c=a,u={x:r,y:i};mh(n);const d=window.setTimeout(()=>{},300);return{isDoubleTap:!1,newLastTapTime:c,newLastTapPosition:u,newTapTimeoutId:d}}function fA(t,e,n,r,i,s,o,a,l,c){let u={...n},d=r,f=i,h=s;const p=Oae(r,i,s,o,a,l,c);return d=p.newLastTapTime,f=p.newLastTapPosition,h=p.newTapTimeoutId,p.isDoubleTap&&l?{newDragState:u,newLastTapTime:d,newLastTapPosition:f,newTapTimeoutId:h}:(t>Hn.DEFAULT_SCALE&&(u.start={x:o,y:a},u.startTranslate={...e}),{newDragState:u,newLastTapTime:d,newLastTapPosition:f,newTapTimeoutId:h})}function hA(t,e,n,r,i,s,o,a){let l={...t},c=!1;return r&&(l.start?Math.sqrt(Math.pow(e-l.start.x,2)+Math.pow(n-l.start.y,2)):0)>i&&(c=!0,!l.isDragging&&s>Hn.DEFAULT_SCALE&&(o(l.start.x,l.start.y),l.isDragging=!0)),l.isDragging&&a(e,n),{newDragState:l,touchMoved:c}}function pA(t,e,n,r,i){e&&Date.now()-n<200&&!r||i()}function $1(t,e,n){return Math.max(e,Math.min(n,t))}function Nae(t,e,n){return Math.abs(t-e)<n}function Rae(t,e,n){const r=e.x-t.x,i=e.y-t.y;return{x:r/n*16,y:i/n*16}}function Lae(t,e,n,r,i,s,o){s!==null&&cancelAnimationFrame(s);let a={...t},l={...e};const c=i_.FRICTION,u=i_.MIN_VELOCITY;function d(){if(a.x*=c,a.y*=c,Math.abs(a.x)<u&&Math.abs(a.y)<u){o(null),i();return}l.x+=a.x,l.y+=a.y,l=Ii.applyBoundaryConstraints(l,n),r(l),o(requestAnimationFrame(d))}o(requestAnimationFrame(d))}let hn=At({scale:Hn.DEFAULT_SCALE,translate:{x:0,y:0},useTransition:!0}),F1=null;function mA(t,e){if(!F1)return t;const{imageWidth:n,imageHeight:r,containerWidth:i}=F1,s=n*e,o=r*e;let a=t.x,l=t.y;if(s>i){const d=(s-i)/2,f=-d;a=$1(a,f,d)}else a=0;const c=o/2,u=-c;return l=$1(l,u,c),{x:a,y:l}}const Ii={get state(){return hn},reset(){hn.scale=Hn.DEFAULT_SCALE,hn.translate={x:0,y:0},hn.useTransition=!0},setDirectState(t){hn.scale=t.scale,hn.translate={...t.translate},hn.useTransition=t.useTransition??hn.useTransition},zoom(t){const e=$1(t.scale,Hn.MIN_SCALE,Hn.MAX_SCALE);if(Nae(e,Hn.DEFAULT_SCALE,Hn.THRESHOLD)){this.reset();return}const n=e/hn.scale;hn.translate.x=hn.translate.x*n-t.offsetX*(n-1),hn.translate.y=hn.translate.y*n-t.offsetY*(n-1),hn.scale=e},zoomToPoint(t,e=0,n=0){if(hn.scale>=Hn.RESET_THRESHOLD){this.reset();return}const r=t/hn.scale;hn.translate.x=hn.translate.x*r-e*(r-1),hn.translate.y=hn.translate.y*r-n*(r-1),hn.scale=t},drag(t,e,n){const r={x:n.x+t,y:n.y+e},i=mA(r,hn.scale);hn.translate.x=i.x,hn.translate.y=i.y},setTransition(t){hn.useTransition=t},setBoundaryConstraints(t){F1=t},applyBoundaryConstraints(t,e){return mA(t,e)}};function Dae(){return{isDragging:!1,start:{x:0,y:0},startTranslate:{x:0,y:0}}}function Bae(){return{isPinching:!1,initialDistance:0,initialScale:1,centerX:0,centerY:0}}function $ae(t,e,n){e(),n(t.clientX,t.clientY)}function Fae(t,e){t.key==="Escape"&&e()}var zae=t=>t.stopPropagation(),Uae=(t,e)=>{t.stopPropagation(),e()},Hae=Ve('<div class="fullscreen-overlay svelte-mot0ha" tabindex="0" role="dialog" aria-label="ç»åå¨ç»é¢è¡¨ç¤º"><div class="close-button-container svelte-mot0ha"><button type="button" class="close-button svelte-mot0ha" aria-label="Close fullscreen image"><span class="svg-icon close-icon svelte-mot0ha"></span></button></div> <div class="image-container svelte-mot0ha"><img class="fullscreen-image svelte-mot0ha" draggable="false"/></div></div>');function Vae(t,e){Mn(e,!0);let n=ht(e,"src",3,""),r=ht(e,"alt",3,""),i=ht(e,"show",15,!1),s=ht(e,"onClose",3,()=>{}),o=Ee(void 0),a=Ee(void 0),l=Ee(void 0),c=Ii.state,u=Dae(),d=Bae(),f=null,h=null,p=null,m=!1,g=0,y=null,w=null,k=0,C=!1,A=10,E=0,P={x:0,y:0},S={x:0,y:0};Ze(()=>{c=Ii.state,Pae({scale:c.scale,translate:c.translate,useTransition:c.useTransition??!1},M(l))});function x(oe){if(oe.preventDefault(),!M(l)||!M(a))return;const ge=oe.deltaY>0?Hn.ZOOM_DELTA.OUT:Hn.ZOOM_DELTA.IN,Ie=c.scale*ge,_e=Iae(oe,M(a),Ie);Ii.zoom(_e),Zl(c.scale,M(l)),of(c.scale,M(a))}function _(oe,ge){La(!0),setTimeout(()=>{if(c.scale>=Hn.RESET_THRESHOLD)Ii.reset();else{const Ie=oe!==void 0&&ge!==void 0&&M(a)?Cae(M(a),oe,ge):{offsetX:0,offsetY:0};Ii.zoomToPoint(Hn.DOUBLE_CLICK_SCALE,Ie.offsetX,Ie.offsetY)}Zl(c.scale,M(l))},100)}function I(oe,ge){c.scale<=Hn.DEFAULT_SCALE||(u.isDragging=!0,u.start={x:oe,y:ge},u.startTranslate={...c.translate},E=Date.now(),P={x:oe,y:ge},S={x:0,y:0},M(l)&&(M(l).style.cursor="grabbing",La(!1)),M(a)&&(M(a).style.cursor="grabbing"),uA(!1))}function D(oe,ge){u.isDragging&&(f!==null&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{const Ie=Aae({x:oe,y:ge},u.start);Ii.drag(Ie.x,Ie.y,u.startTranslate);const _e=Date.now(),Ue=_e-E;Ue>0&&(S=Rae(P,{x:oe,y:ge},Ue)),E=_e,P={x:oe,y:ge}}))}function B(){u.isDragging&&(u.isDragging=!1,f!==null&&(cancelAnimationFrame(f),f=null),Wo()?Lae(S,c.translate,c.scale,oe=>{Ii.setDirectState({...c,translate:oe,useTransition:!1})},()=>{La(!0),Zl(c.scale,M(l)),of(c.scale,M(a))},p,oe=>{p=oe}):(Zl(c.scale,M(l)),of(c.scale,M(a)),setTimeout(()=>La(!0),50)),uA(!0))}function F(){u.isDragging&&B()}function R(oe){const[ge,Ie]=[oe.touches[0],oe.touches[1]],_e=ge.clientX-Ie.clientX,Ue=ge.clientY-Ie.clientY,Je=Math.sqrt(_e*_e+Ue*Ue);Je>Hn.PINCH_MIN_DISTANCE&&(d.isPinching=!0,d.initialDistance=Je,d.initialScale=c.scale,d.centerX=(ge.clientX+Ie.clientX)/2,d.centerY=(ge.clientY+Ie.clientY)/2,La(!1))}function O(oe){!d.isPinching||!M(a)||(h!==null&&cancelAnimationFrame(h),h=requestAnimationFrame(()=>{const[ge,Ie]=[oe.touches[0],oe.touches[1]],_e=ge.clientX-Ie.clientX,Ue=ge.clientY-Ie.clientY,Je=Math.sqrt(_e*_e+Ue*Ue);if(Je>Hn.PINCH_MIN_DISTANCE){const ft=Je/d.initialDistance,ot=Math.max(Hn.MIN_SCALE,Math.min(Hn.MAX_SCALE,d.initialScale*ft));if(!M(a))return;const mt=M(a).getBoundingClientRect(),It=mt.width/2,bt=mt.height/2,Lt=d.centerX-mt.left-It,Pe=d.centerY-mt.top-bt,Oe=ot/c.scale,at=c.translate.x*Oe-Lt*(Oe-1),Ht=c.translate.y*Oe-Pe*(Oe-1);Mae(ot,at,Ht,M(l))}}))}function L(){if(d.isPinching){if(h!==null&&(cancelAnimationFrame(h),h=null),d.isPinching=!1,M(l)){const oe=M(l).style.transform,ge=oe.match(/scale\(([^)]+)\)/),Ie=oe.match(/translate\(([^,]+)px,\s*([^)]+)px\)/);if(ge&&Ie){const _e=parseFloat(ge[1]),Ue=parseFloat(Ie[1])*_e,Je=parseFloat(Ie[2])*_e;Ii.setDirectState({scale:_e,translate:{x:Ue,y:Je},useTransition:!0})}}La(!0),Zl(c.scale,M(l))}}function H(oe){if(!oe.target?.closest(".close-button-container"))if(oe.preventDefault(),p!==null&&(cancelAnimationFrame(p),p=null,La(!0),Zl(c.scale,M(l)),of(c.scale,M(a))),oe.touches.length===1){const ge=oe.touches[0],Ie=fA(c.scale,c.translate,u,g,w,y,ge.clientX,ge.clientY,!0,(_e,Ue)=>_(_e,Ue));u=Ie.newDragState,g=Ie.newLastTapTime,w=Ie.newLastTapPosition,y=Ie.newTapTimeoutId}else oe.touches.length===2&&(B(),mh(y),R(oe))}function U(oe){if(oe.preventDefault(),oe.touches.length===1){const ge=oe.touches[0],Ie=hA(u,ge.clientX,ge.clientY,!0,A,c.scale,I,D);u=Ie.newDragState,C=Ie.touchMoved}else oe.touches.length===2&&d.isPinching&&O(oe)}function j(oe){oe.preventDefault(),oe.touches.length===0?(pA(u,!0,k,C,B),L()):oe.touches.length===1&&d.isPinching&&L()}function Q(oe){if(oe.target?.closest(".close-button-container"))return;p!==null&&(cancelAnimationFrame(p),p=null,La(!0),Zl(c.scale,M(l)),of(c.scale,M(a)));const ge=fA(c.scale,c.translate,u,g,w,y,oe.clientX,oe.clientY,!1,(Ie,_e)=>_(Ie,_e));u=ge.newDragState,g=ge.newLastTapTime,w=ge.newLastTapPosition,y=ge.newTapTimeoutId,I(oe.clientX,oe.clientY)}function X(oe){u.isDragging&&(oe.preventDefault(),u=hA(u,oe.clientX,oe.clientY,!1,A,c.scale,I,D).newDragState)}function de(){pA(u,!1,k,C,B)}function le(oe){i()&&m&&(oe.preventDefault(),Op(f,h,u,d,g),f=null,h=null,g=0,y=null,i(!1),s()())}function J(){Op(f,h,u,d,g),f=null,h=null,g=0,y=null,i(!1),s()(),m&&(m=!1,history.back()),gQ(OZ.EDITOR,$M.EDITOR_FOCUS_DELAY)}Ze(()=>{i()?(Op(f,h,u,d,g),f=null,h=null,g=0,y=null,yc("overflow","hidden"),m||(history.pushState({imageFullscreen:!0},"",""),m=!0),M(o)&&M(o).complete&&dA(M(o),M(a))):(yc("overflow",""),m=!1)});function he(){const oe=[{event:"mousemove",handler:X,target:document},{event:"mouseup",handler:de,target:document},{event:"popstate",handler:le,target:window}];return oe.forEach(({event:ge,handler:Ie,target:_e})=>_e.addEventListener(ge,Ie)),oe}function Me(oe){oe.forEach(({event:ge,handler:Ie,target:_e})=>_e.removeEventListener(ge,Ie))}ls(()=>{const oe=he();return()=>{Me(oe),mh(y)}}),Tc(()=>{Op(f,h,u,d,g),m=!1,w=null});var pe=en(),Te=Et(pe);{var je=oe=>{var ge=Hae();ge.__keydown=[Fae,J],ge.__mousedown=Q,ge.__touchstart=H,ge.__touchmove=U,ge.__touchend=j;var Ie=ye(ge),_e=ye(Ie);_e.__click=J,_e.__touchstart=[zae],_e.__touchend=[Uae,J];var Ue=Le(Ie,2),Je=ye(Ue);Je.__dblclick=[$ae,F,_],Xn(Je,ft=>se(o,ft),()=>M(o)),Xn(Ue,ft=>se(l,ft),()=>M(l)),Xn(ge,ft=>se(a,ft),()=>M(a)),Ge(()=>{ln(Je,"src",n()),ln(Je,"alt",r())}),bs("wheel",ge,x),bs("load",Je,ft=>dA(M(o),M(a))),we(oe,ge)};Ye(Te,oe=>{i()&&oe(je)})}we(t,pe),On()}xi(["keydown","mousedown","touchstart","touchmove","touchend","click","dblclick"]);function jae(t,e){const n=t.target;n?.files?.length&&e(n.files)}var Wae=Ve('<div class="upload-error svelte-6td741"> </div>'),qae=Ve('<div class="copy-success-message"> </div>'),Kae=Ve('<div class="post-container svelte-6td741"><div aria-label="ãã­ã¹ãå¥åã¨ãªã¢" role="textbox" tabindex="0"><!></div> <input type="file" accept="image/*,video/*" multiple style="display: none;"/> <!></div> <!> <!> <!> <!>',1);function Gae(t,e){Mn(e,!0);const n=()=>or(Ni,"$globalContextMenuStore",i),r=()=>or(Jr,"$_",i),[i,s]=as();let o=Ee(null),a=Ee(null),l=Ee(!1),c=Ee(void 0),u=Ee(void 0),d=At({}),f=At({}),h=Xe(()=>bn.postStatus),p=Xe(()=>bn.uploadErrorMessage),m=null,g=null,y=Xe(()=>Eo.value),w=Xe(()=>M(y).showSecretKeyDialog),k=Xe(()=>M(y).showImageFullscreen),C=Xe(()=>M(y).fullscreenImageSrc),A=Xe(()=>M(y).fullscreenImageAlt),E=Xe(()=>M(y).showPopupModal),P=Xe(()=>M(y).popupX),S=Xe(()=>M(y).popupY),x=Xe(()=>M(y).popupMessage),_=Ee(At(n())),I=Xe(()=>M(_).open),D=Ee(0),B=Ee(0),F=Ee(At([]));Ze(()=>Ni.subscribe(Oe=>{se(_,Oe,!0)})),Ze(()=>{e.rxNostr&&(M(u)?M(u).setRxNostr(e.rxNostr):se(u,new Soe(e.rxNostr),!0))});async function R(Pe){!Pe||Pe.length===0||await lae({files:Pe,currentEditor:M(a),fileInput:M(c),onUploadProgress:e.onUploadProgress,updateUploadState:(Oe,at)=>{bn.isUploading=Oe,bn.uploadErrorMessage=at||""},imageOxMap:d,imageXMap:f,videoCompressionProgressStore:Af,imageCompressionProgressStore:If,getUploadFailedText:Oe=>r()(Oe)})}ls(()=>{const Pe=r()("postComponent.enter_your_text")||"ãã­ã¹ããå¥åãã¦ãã ãã";return g=goe({placeholderText:Pe,editorContainerEl:m,currentEditor:M(a),hasStoredKey:e.hasStoredKey,submitPost:H,uploadFiles:Oe=>{R(Oe)},eventCallbacks:{onContentUpdate:doe,onImageFullscreenRequest:(Oe,at)=>{Eo.showImageFullscreen(Oe,at)},onSelectImageNode:Oe=>{}}}),se(o,g.editor,!0),M(o).subscribe(Oe=>{se(a,Oe,!0),SS.set(Oe)}),()=>{g&&yoe({unsubscribe:g.unsubscribe,handlers:g.handlers,currentEditor:M(a),editorContainerEl:m})}});async function O(Pe){await R(Pe)}function L(Pe){if(!M(a)||!Pe)return;const Oe=M(a),Ht=Pe.split(`
`).map(xn=>({type:"paragraph",content:xn?[{type:"text",text:xn}]:void 0}));Oe.commands.setContent({type:"doc",content:Ht}),Oe.commands.focus("end")}async function H(){if(!M(u)||!M(a))return;const Pe=M(u).preparePostContent(M(a));if(lX(Pe)){Eo.showSecretKeyDialog(Pe);return}await M(u).performPostSubmission(M(a),d,f,()=>Ao({sending:!0,success:!1,error:!1,message:"",completed:!1}),()=>{Ao({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),j(),e.onPostSuccess?.()},Oe=>Ao({sending:!1,success:!1,error:!0,message:Oe||"postComponent.post_error",completed:!1}))}function U(){M(u)&&M(a)&&M(u).resetPostContent(M(a))}function j(){M(u)&&M(a)&&M(u).clearContentAfterSuccess(M(a))}function Q(){Il.querySelector(".tiptap-editor")?.focus()}async function X(){const Pe=Eo.getPendingPost();if(Eo.hideSecretKeyDialog(),M(u)&&M(a)){const Oe=M(u).prepareImageBlurhashMap(M(a),d,f);Ao({sending:!0,success:!1,error:!1,message:"",completed:!1});try{const at=await M(u).submitPost(Pe,Oe);at.success?(Ao({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),j(),e.onPostSuccess?.()):Ao({sending:!1,success:!1,error:!0,message:at.error||"postComponent.post_error",completed:!1})}catch{Ao({sending:!1,success:!1,error:!0,message:"postComponent.post_error",completed:!1})}}}function de(){Eo.hideSecretKeyDialog()}function le(){Eo.hideImageFullscreen(),setTimeout(()=>{Il.querySelector(".tiptap-editor")?.focus()},150)}Ze(()=>{if(M(I)&&M(_).nodeId){const Pe=M(_).nodeId;let Oe=!1;M(a)?.state?.doc&&M(a).state.doc.descendants(Ht=>{if(Ht.attrs.id===Pe)return Oe=Ht.type.name==="video",!1});let at;Oe?at=Hre(M(_),M(a),Yo.value):at=Qse(M(_),M(a),Yo.value),at&&(se(F,at.items,!0),se(D,at.x,!0),se(B,at.y,!0))}}),Ze(()=>{M(a)&&M(u)&&M(u).preparePostContent(M(a))!==bn.content&&M(h).error&&Ao({...M(h),error:!1,message:""})});function J(){M(c)?.click()}var he={uploadFiles:O,insertTextContent:L,submitPost:H,resetPostContent:U,clearContentAfterSuccess:j,focusEditor:Q,openFileDialog:J},Me=Kae(),pe=Et(Me),Te=ye(pe);let je;var oe=ye(Te);{var ge=Pe=>{Kne(Pe,{get editor(){return M(a)},class:"editor-content"})};Ye(oe,Pe=>{M(o)&&M(a)&&Pe(ge)})}up(Te,(Pe,Oe)=>mre?.(Pe,Oe),()=>({dragOver:Pe=>se(l,Pe,!0)})),up(Te,Pe=>gre?.(Pe)),up(Te,Pe=>yre?.(Pe)),up(Te,Pe=>bre?.(Pe)),Xn(Te,Pe=>m=Pe,()=>m);var Ie=Le(Te,2);Ie.__change=[jae,R],Xn(Ie,Pe=>se(c,Pe),()=>M(c));var _e=Le(Ie,2);{var Ue=Pe=>{var Oe=Wae(),at=ye(Oe);Ge(()=>Qe(at,M(p))),we(Pe,Oe)};Ye(_e,Pe=>{M(p)&&Pe(Ue)})}var Je=Le(pe,2);_ae(Je,{onConfirm:X,onCancel:de,get show(){return M(w)},set show(Pe){se(w,Pe)}});var ft=Le(Je,2);Vae(ft,{get src(){return M(C)},get alt(){return M(A)},onClose:le,get show(){return M(k)},set show(Pe){se(k,Pe)}});var ot=Le(ft,2);{var mt=Pe=>{pae(Pe,{get x(){return M(D)},get y(){return M(B)},get items(){return M(F)},onClose:()=>Ni.set({open:!1,nodeId:void 0,src:void 0}),get onShowPopup(){return Eo.showPopupMessage}})};Ye(ot,Pe=>{M(I)&&Pe(mt)})}var It=Le(ot,2);{var bt=Pe=>{n5(Pe,{get show(){return M(E)},get x(){return M(P)},get y(){return M(S)},onClose:()=>Eo.hidePopupMessage(),children:(Oe,at)=>{var Ht=qae(),xn=ye(Ht);Ge(()=>Qe(xn,M(x))),we(Oe,Ht)},$$slots:{default:!0}})};Ye(It,Pe=>{M(E)&&Pe(bt)})}Ge(Pe=>je=rs(Te,1,"editor-container svelte-6td741",null,je,Pe),[()=>({"drag-over":M(l)})]),we(t,Me);var Lt=On(he);return s(),Lt}xi(["change"]);function Zae(t,e){e.onChange&&e.onChange(e.value)}var Qae=Ve('<input type="radio" style="display: none;"/> <!>',1);function gA(t,e){Mn(e,!0);let n=ht(e,"checked",3,!1),r=ht(e,"disabled",3,!1),i=ht(e,"variant",3,"default"),s=ht(e,"shape",3,"rounded"),o=ht(e,"className",3,""),a=ht(e,"ariaLabel",3,""),l=ht(e,"style",3,""),c;function u(){!r()&&c&&c.click()}var d=Qae(),f=Et(d);f.__change=[Zae,e],Xn(f,p=>c=p,()=>c);var h=Le(f,2);mn(h,{get variant(){return i()},get shape(){return s()},get className(){return o()},get ariaLabel(){return a()},get style(){return l()},get disabled(){return r()},get selected(){return n()},onClick:u,children:(p,m)=>{var g=en(),y=Et(g);kc(y,()=>e.children??Oi),we(p,g)},$$slots:{default:!0}}),Ge(()=>{v$(f,e.value),ln(f,"name",e.name),x$(f,n()),f.disabled=r()}),we(t,d),On()}xi(["change"]);/*! MIT License

Copyright (c) 2024 Lokuyow

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
 */var Xae={203:(t,e)=>{function n(x){if(!Number.isSafeInteger(x))throw new Error(`Wrong integer: ${x}`)}function r(...x){const _=(B,F)=>R=>B(F(R)),I=Array.from(x).reverse().reduce(((B,F)=>B?_(B,F.encode):F.encode),void 0),D=x.reduce(((B,F)=>B?_(B,F.decode):F.decode),void 0);return{encode:I,decode:D}}function i(x){return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return _.map((I=>{if(n(I),I<0||I>=x.length)throw new Error(`Digit index outside alphabet: ${I} (alphabet: ${x.length})`);return x[I]}))},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("alphabet.decode input should be array of strings");return _.map((I=>{if(typeof I!="string")throw new Error(`alphabet.decode: not string element=${I}`);const D=x.indexOf(I);if(D===-1)throw new Error(`Unknown letter: "${I}". Allowed: ${x}`);return D}))}}}function s(x=""){if(typeof x!="string")throw new Error("join separator should be string");return{encode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="string")throw new Error("join.encode input should be array of strings");for(let I of _)if(typeof I!="string")throw new Error(`join.encode: non-string input=${I}`);return _.join(x)},decode:_=>{if(typeof _!="string")throw new Error("join.decode input should be string");return _.split(x)}}}function o(x,_="="){if(n(x),typeof _!="string")throw new Error("padding chr should be string");return{encode(I){if(!Array.isArray(I)||I.length&&typeof I[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of I)if(typeof D!="string")throw new Error(`padding.encode: non-string input=${D}`);for(;I.length*x%8;)I.push(_);return I},decode(I){if(!Array.isArray(I)||I.length&&typeof I[0]!="string")throw new Error("padding.encode input should be array of strings");for(let B of I)if(typeof B!="string")throw new Error(`padding.decode: non-string input=${B}`);let D=I.length;if(D*x%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;D>0&&I[D-1]===_;D--)if(!((D-1)*x%8))throw new Error("Invalid padding: string has too much padding");return I.slice(0,D)}}}function a(x){if(typeof x!="function")throw new Error("normalize fn should be function");return{encode:_=>_,decode:_=>x(_)}}function l(x,_,I){if(_<2)throw new Error(`convertRadix: wrong from=${_}, base cannot be less than 2`);if(I<2)throw new Error(`convertRadix: wrong to=${I}, base cannot be less than 2`);if(!Array.isArray(x))throw new Error("convertRadix: data should be array");if(!x.length)return[];let D=0;const B=[],F=Array.from(x);for(F.forEach((R=>{if(n(R),R<0||R>=_)throw new Error(`Wrong integer: ${R}`)}));;){let R=0,O=!0;for(let L=D;L<F.length;L++){const H=F[L],U=_*R+H;if(!Number.isSafeInteger(U)||_*R/_!==R||U-H!=_*R)throw new Error("convertRadix: carry overflow");if(R=U%I,F[L]=Math.floor(U/I),!Number.isSafeInteger(F[L])||F[L]*I+R!==U)throw new Error("convertRadix: carry overflow");O&&(F[L]?O=!1:D=L)}if(B.push(R),O)break}for(let R=0;R<x.length-1&&x[R]===0;R++)B.push(0);return B.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const c=(x,_)=>_?c(_,x%_):x,u=(x,_)=>x+(_-c(x,_));function d(x,_,I,D){if(!Array.isArray(x))throw new Error("convertRadix2: data should be array");if(_<=0||_>32)throw new Error(`convertRadix2: wrong from=${_}`);if(I<=0||I>32)throw new Error(`convertRadix2: wrong to=${I}`);if(u(_,I)>32)throw new Error(`convertRadix2: carry overflow from=${_} to=${I} carryBits=${u(_,I)}`);let B=0,F=0;const R=2**I-1,O=[];for(const L of x){if(n(L),L>=2**_)throw new Error(`convertRadix2: invalid data word=${L} from=${_}`);if(B=B<<_|L,F+_>32)throw new Error(`convertRadix2: carry overflow pos=${F} from=${_}`);for(F+=_;F>=I;F-=I)O.push((B>>F-I&R)>>>0);B&=2**F-1}if(B=B<<I-F&R,!D&&F>=_)throw new Error("Excess padding");if(!D&&B)throw new Error(`Non-zero padding: ${B}`);return D&&F>0&&O.push(B>>>0),O}function f(x){return n(x),{encode:_=>{if(!(_ instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return l(Array.from(_),256,x)},decode:_=>{if(!Array.isArray(_)||_.length&&typeof _[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(l(_,x,256))}}}function h(x,_=!1){if(n(x),x<=0||x>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,x)>32||u(x,8)>32)throw new Error("radix2: carry overflow");return{encode:I=>{if(!(I instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return d(Array.from(I),8,x,!_)},decode:I=>{if(!Array.isArray(I)||I.length&&typeof I[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(d(I,x,8,_))}}}function p(x){if(typeof x!="function")throw new Error("unsafeWrapper fn should be function");return function(..._){try{return x.apply(null,_)}catch{}}}function m(x,_){if(n(x),typeof _!="function")throw new Error("checksum fn should be function");return{encode(I){if(!(I instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const D=_(I).slice(0,x),B=new Uint8Array(I.length+x);return B.set(I),B.set(D,I.length),B},decode(I){if(!(I instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const D=I.slice(0,-x),B=_(D).slice(0,x),F=I.slice(-x);for(let R=0;R<x;R++)if(B[R]!==F[R])throw new Error("Invalid checksum");return D}}}e.utils={alphabet:i,chain:r,checksum:m,radix:f,radix2:h,join:s,padding:o},e.base16=r(h(4),i("0123456789ABCDEF"),s("")),e.base32=r(h(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),e.base32hex=r(h(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),e.base32crockford=r(h(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((x=>x.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),e.base64url=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const g=x=>r(f(58),i(x),s(""));e.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(x){let _="";for(let I=0;I<x.length;I+=8){const D=x.subarray(I,I+8);_+=e.base58.encode(D).padStart(y[D.length],"1")}return _},decode(x){let _=[];for(let I=0;I<x.length;I+=11){const D=x.slice(I,I+11),B=y.indexOf(D.length),F=e.base58.decode(D);for(let R=0;R<F.length-B;R++)if(F[R]!==0)throw new Error("base58xmr: wrong padding");_=_.concat(Array.from(F.slice(F.length-B)))}return Uint8Array.from(_)}},e.base58check=x=>r(m(4,(_=>x(x(_)))),e.base58);const w=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),k=[996825010,642813549,513874426,1027748829,705979059];function C(x){const _=x>>25;let I=(33554431&x)<<5;for(let D=0;D<k.length;D++)(_>>D&1)==1&&(I^=k[D]);return I}function A(x,_,I=1){const D=x.length;let B=1;for(let F=0;F<D;F++){const R=x.charCodeAt(F);if(R<33||R>126)throw new Error(`Invalid prefix (${x})`);B=C(B)^R>>5}B=C(B);for(let F=0;F<D;F++)B=C(B)^31&x.charCodeAt(F);for(let F of _)B=C(B)^F;for(let F=0;F<6;F++)B=C(B);return B^=I,w.encode(d([B%2**30],30,5,!1))}function E(x){const _=x==="bech32"?1:734539939,I=h(5),D=I.decode,B=I.encode,F=p(D);function R(O,L=90){if(typeof O!="string")throw new Error("bech32.decode input should be string, not "+typeof O);if(O.length<8||L!==!1&&O.length>L)throw new TypeError(`Wrong string length: ${O.length} (${O}). Expected (8..${L})`);const H=O.toLowerCase();if(O!==H&&O!==O.toUpperCase())throw new Error("String must be lowercase or uppercase");const U=(O=H).lastIndexOf("1");if(U===0||U===-1)throw new Error('Letter "1" must be present between prefix and data only');const j=O.slice(0,U),Q=O.slice(U+1);if(Q.length<6)throw new Error("Data must be at least 6 characters long");const X=w.decode(Q).slice(0,-6),de=A(j,X,_);if(!Q.endsWith(de))throw new Error(`Invalid checksum in ${O}: expected "${de}"`);return{prefix:j,words:X}}return{encode:function(O,L,H=90){if(typeof O!="string")throw new Error("bech32.encode prefix should be string, not "+typeof O);if(!Array.isArray(L)||L.length&&typeof L[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof L);const U=O.length+7+L.length;if(H!==!1&&U>H)throw new TypeError(`Length ${U} exceeds limit ${H}`);return`${O=O.toLowerCase()}1${w.encode(L)}${A(O,L,_)}`},decode:R,decodeToBytes:function(O){const{prefix:L,words:H}=R(O,!1);return{prefix:L,words:H,bytes:D(H)}},decodeUnsafe:p(R),fromWords:D,fromWordsUnsafe:F,toWords:B}}e.bech32=E("bech32"),e.bech32m=E("bech32m"),e.utf8={encode:x=>new TextDecoder().decode(x),decode:x=>new TextEncoder().encode(x)},e.hex=r(h(4),i("0123456789abcdef"),s(""),a((x=>{if(typeof x!="string"||x.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof x} with length ${x.length}`);return x.toLowerCase()})));const P={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},S=`Invalid encoding type. Available types: ${Object.keys(P).join(", ")}`;e.bytesToString=(x,_)=>{if(typeof x!="string"||!P.hasOwnProperty(x))throw new TypeError(S);if(!(_ instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return P[x].encode(_)},e.str=e.bytesToString,e.stringToBytes=(x,_)=>{if(!P.hasOwnProperty(x))throw new TypeError(S);if(typeof _!="string")throw new TypeError("stringToBytes() expects string");return P[x].decode(_)},e.bytes=e.stringToBytes},806:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([t.id,`.zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

/* Color Classes Generator */
[class*="zap-amount-"] .zap-sender {
  border-radius: 6px;
}

[class*="zap-amount-"] .zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

[class*="zap-amount-"] .zap-details {
  padding-top: 8px;
  padding-bottom: 8px;
}

/* Amount-based Styles */
.zap-amount-100 .zap-sender {
  background-color: var(--zap-100);
}

.zap-amount-200 .zap-sender {
  background-color: var(--zap-200);
}

.zap-amount-500 .zap-sender {
  background-color: var(--zap-500);
}

.zap-amount-1k .zap-sender {
  background-color: var(--zap-1k);
}

.zap-amount-2k .zap-sender {
  background-color: var(--zap-2k);
}

.zap-amount-5k .zap-sender {
  background-color: var(--zap-5k);
}

.zap-amount-10k .zap-sender {
  background-color: var(--zap-10k);
}

/* Details Background Colors */
.zap-amount-100 .zap-details {
  background-color: var(--zap-100-light);
}

.zap-amount-200 .zap-details {
  background-color: var(--zap-200-light);
}

.zap-amount-500 .zap-details {
  background-color: var(--zap-500-light);
}

.zap-amount-1k .zap-details {
  background-color: var(--zap-1k-light);
}

.zap-amount-2k .zap-details {
  background-color: var(--zap-2k-light);
}

.zap-amount-5k .zap-details {
  background-color: var(--zap-5k-light);
}

.zap-amount-10k .zap-details {
  background-color: var(--zap-10k-light);
}

/* Dark Text Colors */
.zap-amount-100,
.zap-amount-2k,
.zap-amount-5k,
.zap-amount-10k {
  .zap-amount {
    color: var(--text-light);
  }

  .sender-name {
    color: var(--text-light-secondary);
  }

  .sender-pubkey {
    color: var(--text-light-tertiary);
  }

  .zap-comment {
    color: var(--text-light);
  }
}

/* Light Text Colors */
.zap-amount-200,
.zap-amount-500,
.zap-amount-1k {
  .zap-amount {
    color: var(--text-dark);
  }

  .sender-name {
    color: var(--text-dark-secondary);
  }

  .sender-pubkey {
    color: var(--text-dark-tertiary);
  }

  .zap-comment {
    color: var(--text-dark);
  }
}`,""]);const a=o},540:(t,e,n)=>{n.r(e),n.d(e,{default:()=>c});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(806),l=o()(i());l.i(a.A),l.push([t.id,`/* styles.css */

:host {
  --main-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  --main-text: Black;
  --pubkey-text: #888;
  --custom-title-text: #555;
  --stats-item-text: #333;
  --name-text: #444;
  --dialog-bg: #ffffff;
  --zap-stats-bg: #edf2f7;
  --hover-bg: #edf2f7;
  --border: #ddd;
  --skeleton: #fdfdfd;
  --skeleton2: #e2e5ec;
  --zap-stats-skeleton-bg: #bbc5cf;
  --new-mark: #22c55e;

  /* Zap Amount Colors */
  --zap-100: #1565c0;
  --zap-200: #00b8d4;
  --zap-500: #00bfa5;
  --zap-1k: #ffb300;
  --zap-2k: #e65100;
  --zap-5k: #c2185b;
  --zap-10k: #d00000;

  /* Light Variants */
  --zap-100-light: #1e88e5;
  --zap-200-light: #00e5ff;
  --zap-500-light: #1de9b6;
  --zap-1k-light: #ffca28;
  --zap-2k-light: #f57c00;
  --zap-5k-light: #e91e63;
  --zap-10k-light: #e62117;

  /* Text Colors */
  --text-light: #ffffff;
  --text-light-secondary: rgba(255, 255, 255, 0.9);
  --text-light-tertiary: rgba(255, 255, 255, 0.5);
  --text-dark: #000000;
  --text-dark-secondary: rgba(0, 0, 0, 0.7);
  --text-dark-tertiary: rgba(0, 0, 0, 0.5);
}

* {
  box-sizing: border-box;
}

button {
  color: var(--main-text);
  background: none;
  border: none;
  cursor: pointer;
}

.dialog {
  font-family: var(--main-font);
  color: var(--main-text);
  font-size: medium;
  font-weight: normal;
  max-height: 700px;
  height: 100dvh;
  width: 360px;
  margin: auto;
  padding: 0;
  border: none;
  border-radius: 10px;
  background: var(--dialog-bg);
  display: flex;
  flex-direction: column;
}

.close-dialog-button {
  color: var(--custom-title-text);
  font-size: 16px;
  font-weight: 500;
  position: absolute;
  right: 0;
  width: 2.625rem;
  height: 2.625rem;
  border: none;
  border-radius: 50%;
  background: none;
  cursor: pointer;
  padding: 10px;
  text-align: center;
}

.close-dialog-button:hover {
  background-color: var(--hover-bg);
}

.dialog-title {
  height: 42px;
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;

  & a {
    font-size: 0.9rem;
    font-weight: normal;
    color: var(--pubkey-text);
    text-decoration: none;
    cursor: pointer;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
  }

  & a:hover {
    text-decoration: underline;
  }
}

.dialog-title.custom-title a {
  color: var(--custom-title-text);
  font-weight: 600;
  font-size: 1rem;
}

.zap-stats {
  min-height: 80px;
  padding: 6px 14px;
  background: var(--zap-stats-bg);
  border-radius: 6px;
  display: grid;
  grid-template-columns: 90px 1fr 40px;
  grid-template-rows: repeat(3, 1fr);
  gap: 4px;
  margin: 0 8px;

  .stats-item {
    height: 23px;
    color: var(--stats-item-text);
    font-size: 0.9rem;

    .number {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .number.skeleton {
      width: 100%;
      background: linear-gradient(90deg,
          var(--skeleton) 0%,
          var(--zap-stats-skeleton-bg) 50%,
          var(--skeleton) 100%);
      background-size: 200% 100%;
    }
  }
}

.stats-item:nth-child(3n + 1) {
  justify-content: flex-start;
}

.stats-item:nth-child(3n + 2),
.stats-item:nth-child(3n + 3) {
  justify-content: flex-end;
}

.text-muted {
  margin-right: 16px;
  opacity: 0.4;
}

.dialog-zap-list {
  list-style-type: none;
  margin: 10px 0;
  padding: 0 6px;
  flex: 1;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: smooth;

  /* ã¹ã¯ã­ã¼ã«ãã¼ã®ã¹ã¿ã¤ãªã³ã° */
  &::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 3px;
  }

  &::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    transition: background 0.2s;
  }

  &::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.2);
  }

  /* Firefoxç¨ã®ã¹ã¯ã­ã¼ã«ãã¼ã¹ã¿ã¤ã« */
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
}

.zap-list-item {
  display: flex;
  flex-direction: column;
  border-top: 1px solid var(--border);
  padding: 4px 0;
}

.zap-content {
  display: flex;
  flex-direction: column;
}

.reference-container {
  display: flex;
  flex-direction: column;
}

.zap-sender {
  gap: 12px;
  height: 46px;
  justify-content: space-between;
  padding: 6px;
}

.sender-icon {
  flex-shrink: 0;

  & img {
    width: 100%;
    height: 100%;
    border-radius: 4px;
    object-fit: cover;
    object-position: center;
  }
}

.sender-icon.is-new::before {
  content: "";
  position: absolute;
  top: -4px;
  left: -4px;
  width: 8px;
  height: 8px;
  background-color: var(--new-mark);
  border: 1px solid #fff;
  border-radius: 50%;
  z-index: 1;
  animation: pulse 2500ms cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  50% {
    opacity: 0.3;
  }
}

.sender-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  overflow: hidden;
  min-width: 0;
}

.sender-name {
  font-size: 0.9375rem;
  font-weight: bold;
  color: var(--name-text);
}

.sender-pubkey {
  font-size: 0.625rem;
  color: var(--pubkey-text);
  margin-top: -1px;
}

.zap-amount {
  font-size: 0.8rem;
  white-space: nowrap;
  flex-shrink: 0;

  .number {
    font-size: 1.4rem;
    font-weight: 500;
    text-align: right;
  }
}

.zap-details {
  padding: 2px 8px;
  border-radius: 0 0 6px 6px;
  margin: 0;
}

.zap-comment {
  font-size: 0.9375rem;
  margin: 0;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  max-width: 100%;
}

.no-zaps-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

.no-zaps-message {
  text-align: center;
  color: var(--pubkey-text);
  font-size: 1.8rem;
  font-weight: 700;
}

.zap-reference {
  padding: 2px 0 2px 12px;
  margin: 0;
  font-size: 0.875rem;
  color: var(--pubkey-text);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.reference-arrow {
  flex-shrink: 0;

  img {
    height: 16px;
    width: auto;
  }
}

.reference-text {
  font-size: 0.75rem;
  margin: 0 2px;
  flex-grow: 1;
}

.reference-link {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 1.5rem;
  width: 2.6rem;
  text-decoration: none;
  border-left: 1px solid var(--border);
  flex-shrink: 0;

  & img {
    height: 20px;
    width: auto;
  }
}

.zap-placeholder-name {
  height: 30px;
  width: 140px;
}

.zap-placeholder-name.skeleton {
  width: 120px;
  height: 19px;
  margin: 2px 0;
}

.skeleton {
  color: transparent;
  border-radius: 2px;
  background: linear-gradient(90deg,
      var(--skeleton) 0%,
      var(--skeleton2) 50%,
      var(--skeleton) 100%);
  background-size: 200% 100%;
  animation: loading-animation 3.5s infinite;
  opacity: 0.7;
}

@keyframes loading-animation {
  0% {
    background-position: 200% 0;
  }

  100% {
    background-position: -200% 0;
  }
}

/* å±éã®ãã­ã¹ããªã¼ãã¼ãã­ã¼å¦ç */
.dialog-title,
.sender-name,
.sender-pubkey,
.reference-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* å±éã®ãã¬ãã¯ã¹ããã¯ã¹è¨­å® */
.zap-sender,
.stats-item,
.zap-details,
.reference-link,
.zap-reference {
  display: flex;
  align-items: center;
}

/* å±éã®ã¢ã¤ã³ã³ãµã¤ãº */
.zap-placeholder-icon,
.sender-icon {
  width: 32px;
  height: 32px;
  border-radius: 4px;
  position: relative;
}

.load-more-trigger {
  height: 40px;
  margin: 10px 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--zap-stats-bg);
  border-top: 3px solid var(--pubkey-text);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}`,""]);const c=l},314:t=>{t.exports=function(e){var n=[];return n.toString=function(){return this.map((function(r){var i="",s=r[5]!==void 0;return r[4]&&(i+="@supports (".concat(r[4],") {")),r[2]&&(i+="@media ".concat(r[2]," {")),s&&(i+="@layer".concat(r[5].length>0?" ".concat(r[5]):""," {")),i+=e(r),s&&(i+="}"),r[2]&&(i+="}"),r[4]&&(i+="}"),i})).join("")},n.i=function(r,i,s,o,a){typeof r=="string"&&(r=[[null,r,void 0]]);var l={};if(s)for(var c=0;c<this.length;c++){var u=this[c][0];u!=null&&(l[u]=!0)}for(var d=0;d<r.length;d++){var f=[].concat(r[d]);s&&l[f[0]]||(a!==void 0&&(f[5]===void 0||(f[1]="@layer".concat(f[5].length>0?" ".concat(f[5]):""," {").concat(f[1],"}")),f[5]=a),i&&(f[2]&&(f[1]="@media ".concat(f[2]," {").concat(f[1],"}")),f[2]=i),o&&(f[4]?(f[1]="@supports (".concat(f[4],") {").concat(f[1],"}"),f[4]=o):f[4]="".concat(o)),n.push(f))}},n}},601:t=>{t.exports=function(e){return e[1]}},705:(t,e,n)=>{const{bech32:r,hex:i,utf8:s}=n(203),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},d=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],f={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},h=BigInt("2100000000000000000"),p=BigInt(1e11),m={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},g={};for(let A=0,E=Object.keys(m);A<E.length;A++){const P=E[A],S=m[E[A]].toString();g[S]=P}const y={1:A=>i.encode(r.fromWordsUnsafe(A)),16:A=>i.encode(r.fromWordsUnsafe(A)),13:A=>s.encode(r.fromWordsUnsafe(A)),19:A=>i.encode(r.fromWordsUnsafe(A)),23:A=>i.encode(r.fromWordsUnsafe(A)),27:A=>i.encode(r.fromWordsUnsafe(A)),6:k,24:k,3:function(A){const E=[];let P,S,x,_,I,D=r.fromWordsUnsafe(A);for(;D.length>0;)P=i.encode(D.slice(0,33)),S=i.encode(D.slice(33,41)),x=parseInt(i.encode(D.slice(41,45)),16),_=parseInt(i.encode(D.slice(45,49)),16),I=parseInt(i.encode(D.slice(49,51)),16),D=D.slice(51),E.push({pubkey:P,short_channel_id:S,fee_base_msat:x,fee_proportional_millionths:_,cltv_expiry_delta:I});return E},5:function(A){const E=A.slice().reverse().map((x=>[!!(1&x),!!(2&x),!!(4&x),!!(8&x),!!(16&x)])).reduce(((x,_)=>x.concat(_)),[]);for(;E.length<2*d.length;)E.push(!1);const P={};d.forEach(((x,_)=>{let I;I=E[2*_]?"required":E[2*_+1]?"supported":"unsupported",P[x]=I}));const S=E.slice(2*d.length);return P.extra_bits={start_bit:2*d.length,bits:S,has_required:S.reduce(((x,_,I)=>I%2!=0?x||!1:x||_),!1)},P}};function w(A){return E=>({tagCode:parseInt(A),words:r.encode("unknown",E,Number.MAX_SAFE_INTEGER)})}function k(A){return A.reverse().reduce(((E,P,S)=>E+P*Math.pow(32,S)),0)}function C(A,E){let P,S;if(A.slice(-1).match(/^[munp]$/))P=A.slice(-1),S=A.slice(0,-1);else{if(A.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");S=A}if(!S.match(/^\d+$/))throw new Error("Not a valid human readable amount");const x=BigInt(S),_=P?x*p/f[P]:x*p;if(P==="p"&&x%BigInt(10)!==BigInt(0)||_>h)throw new Error("Amount is outside of valid range");return E?_.toString():_}t.exports={decode:function(A,E){if(typeof A!="string")throw new Error("Lightning Payment Request must be string");if(A.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const P=[],S=r.decode(A,Number.MAX_SAFE_INTEGER);A=A.toLowerCase();const x=S.prefix;let _=S.words,I=A.slice(x.length+1),D=_.slice(-104);_=_.slice(0,-104);let B=x.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(B&&!B[2]&&(B=x.match(/^ln(\S+)$/)),!B)throw new Error("Not a proper lightning payment request");P.push({name:"lightning_network",letters:"ln"});const F=B[1];let R;if(E){if(E.bech32===void 0||E.pubKeyHash===void 0||E.scriptHash===void 0||!Array.isArray(E.validWitnessVersions))throw new Error("Invalid network");R=E}else switch(F){case o.bech32:R=o;break;case a.bech32:R=a;break;case l.bech32:R=l;break;case c.bech32:R=c;break;case u.bech32:R=u}if(!R||R.bech32!==F)throw new Error("Unknown coin bech32 prefix");P.push({name:"coin_network",letters:F,value:R});const O=B[2];let L;O?(L=C(O+B[3],!0),P.push({name:"amount",letters:B[2]+B[3],value:L})):L=null,P.push({name:"separator",letters:"1"});const H=k(_.slice(0,7));let U,j,Q,X;for(_=_.slice(7),P.push({name:"timestamp",letters:I.slice(0,7),value:H}),I=I.slice(7);_.length>0;){const J=_[0].toString();U=g[J]||"unknown_tag",j=y[J]||w(J),_=_.slice(1),Q=k(_.slice(0,2)),_=_.slice(2),X=_.slice(0,Q),_=_.slice(Q),P.push({name:U,tag:I[0],letters:I.slice(0,3+Q),value:j(X)}),I=I.slice(3+Q)}P.push({name:"signature",letters:I.slice(0,104),value:i.encode(r.fromWordsUnsafe(D))}),I=I.slice(104),P.push({name:"checksum",letters:I});let de={paymentRequest:A,sections:P,get expiry(){let J=P.find((he=>he.name==="expiry"));if(J)return le("timestamp")+J.value},get route_hints(){return P.filter((J=>J.name==="route_hint")).map((J=>J.value))}};for(let J in m)J!=="route_hint"&&Object.defineProperty(de,J,{get:()=>le(J)});return de;function le(J){let he=P.find((Me=>Me.name===J));return he?he.value:void 0}},hrpToMillisat:C}},0:(t,e,n)=>{var r=n(540);r&&r.__esModule&&(r=r.default),t.exports=typeof r=="string"?r:r.toString()}},yA={};function Dr(t){var e=yA[t];if(e!==void 0)return e.exports;var n=yA[t]={id:t,exports:{}};return Xae[t](n,n.exports,Dr),n.exports}Dr.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return Dr.d(e,{a:e}),e},Dr.d=(t,e)=>{for(var n in e)Dr.o(e,n)&&!Dr.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},Dr.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Dr.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var yo={};Dr.d(yo,{vQ:()=>yt,ZM:()=>vh,yk:()=>st,h0:()=>hc,n_:()=>y6,Xz:()=>Wde,Uv:()=>xh,fU:()=>Sh,Dw:()=>Js});var z1={};Dr.r(z1),Dr.d(z1,{OG:()=>IS,My:()=>hd,Ph:()=>hi,lX:()=>CS,Id:()=>Bc,fg:()=>l5,qj:()=>Lr,aT:()=>gh,lq:()=>Sl,z:()=>AS,Q5:()=>yh});var U1={};Dr.r(U1),Dr.d(U1,{Relay:()=>bR,SimplePool:()=>hue,finalizeEvent:()=>As,fj:()=>dR,generateSecretKey:()=>Q5,getEventHash:()=>Hf,getFilterLimit:()=>sue,getPublicKey:()=>zS,kinds:()=>X5,matchFilter:()=>cR,matchFilters:()=>uR,mergeFilters:()=>iue,nip04:()=>xR,nip05:()=>kR,nip10:()=>_R,nip11:()=>CR,nip13:()=>AR,nip18:()=>MR,nip19:()=>wR,nip21:()=>NR,nip25:()=>RR,nip27:()=>LR,nip28:()=>DR,nip30:()=>BR,nip39:()=>FR,nip42:()=>pR,nip44:()=>zR,nip47:()=>WR,nip57:()=>qR,nip59:()=>KR,nip98:()=>n6,parseReferences:()=>Sue,serializeEvent:()=>Z5,sortEvents:()=>Hle,utils:()=>q5,validateEvent:()=>ty,verifiedSymbol:()=>Ga,verifyEvent:()=>Pd});var Yae=Dr(705);function bA(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function r5(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Jae(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");bA(t.outputLen),bA(t.blockLen)}function Dg(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ele(t,e){r5(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Rw=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,i5=t=>t instanceof Uint8Array,Lw=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),zs=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function _S(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!i5(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class s5{clone(){return this._cloneInto()}}function tle(t){const e=r=>t().update(_S(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function o5(t=32){if(Rw&&typeof Rw.getRandomValues=="function")return Rw.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class nle extends s5{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Lw(this.buffer)}update(e){Dg(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=_S(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=Lw(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Dg(this),ele(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;(function(d,f,h,p){if(typeof d.setBigUint64=="function")return d.setBigUint64(f,h,p);const m=BigInt(32),g=BigInt(4294967295),y=Number(h>>m&g),w=Number(h&g),k=p?4:0,C=p?0:4;d.setUint32(f+k,y,p),d.setUint32(f+C,w,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=Lw(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const rle=(t,e,n)=>t&e^t&n^e&n,ile=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Da=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ba=new Uint32Array(64);class sle extends nle{constructor(){super(64,32,8,!1),this.A=0|Da[0],this.B=0|Da[1],this.C=0|Da[2],this.D=0|Da[3],this.E=0|Da[4],this.F=0|Da[5],this.G=0|Da[6],this.H=0|Da[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let f=0;f<16;f++,n+=4)Ba[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Ba[f-15],p=Ba[f-2],m=zs(h,7)^zs(h,18)^h>>>3,g=zs(p,17)^zs(p,19)^p>>>10;Ba[f]=g+Ba[f-7]+m+Ba[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=u+(zs(a,6)^zs(a,11)^zs(a,25))+((d=a)&l^~d&c)+ile[f]+Ba[f]|0,p=(zs(r,2)^zs(r,13)^zs(r,22))+rle(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var d;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Ba.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const H1=tle((()=>new sle)),ole=(BigInt(0),BigInt(1)),ale=BigInt(2),Z0=t=>t instanceof Uint8Array,lle=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function hd(t){if(!Z0(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=lle[t[n]];return e}function a5(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function gh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function hi(t){return a5(hd(t))}function CS(t){if(!Z0(t))throw new Error("Uint8Array expected");return a5(hd(Uint8Array.from(t).reverse()))}function Sl(t,e){return gh(t.toString(16).padStart(2*e,"0"))}function AS(t,e){return Sl(t,e).reverse()}function Lr(t,e,n){let r;if(typeof e=="string")try{r=gh(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else{if(!Z0(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Bc(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!Z0(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}const IS=t=>(ale<<BigInt(t-1))-ole,Dw=t=>new Uint8Array(t),wA=t=>Uint8Array.from(t);function l5(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Dw(t),i=Dw(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=Dw())=>{i=a(wA([0]),u),r=a(),u.length!==0&&(i=a(wA([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){r=a();const f=r.slice();d.push(f),u+=r.length}return Bc(...d)};return(u,d)=>{let f;for(o(),l(u);!(f=d(c()));)l();return o(),f}}const cle={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function yh(t,e,n={}){const r=(i,s,o)=>{const a=cle[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0||a(l,t)))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const tr=BigInt(0),Dn=BigInt(1),Ql=BigInt(2),ule=BigInt(3),Bw=BigInt(4),vA=BigInt(5),xA=BigInt(8);BigInt(9),BigInt(16);function wr(t,e){const n=t%e;return n>=tr?n:e+n}function dle(t,e,n){if(n<=tr||e<tr)throw new Error("Expected power/modulo > 0");if(n===Dn)return tr;let r=Dn;for(;e>tr;)e&Dn&&(r=r*t%n),t=t*t%n,e>>=Dn;return r}function zi(t,e,n){let r=t;for(;e-- >tr;)r*=r,r%=n;return r}function V1(t,e){if(t===tr||e<=tr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=wr(t,e),r=e,i=tr,s=Dn;for(;n!==tr;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==Dn)throw new Error("invert: does not exist");return wr(i,e)}function fle(t){if(t%Bw===ule){const e=(t+Dn)/Bw;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%xA===vA){const e=(t-vA)/xA;return function(n,r){const i=n.mul(r,Ql),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Ql),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return(function(e){const n=(e-Dn)/Ql;let r,i,s;for(r=e-Dn,i=0;r%Ql===tr;r/=Ql,i++);for(s=Ql;s<e&&dle(s,n,e)!==e-Dn;s++);if(i===1){const a=(e+Dn)/Bw;return function(l,c){const u=l.pow(c,a);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const o=(r+Dn)/Ql;return function(a,l){if(a.pow(l,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,u=a.pow(a.mul(a.ONE,s),r),d=a.pow(l,o),f=a.pow(l,r);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let m=a.sqr(f);h<c&&!a.eql(m,a.ONE);h++)m=a.sqr(m);const p=a.pow(u,Dn<<BigInt(c-h-1));u=a.sqr(p),d=a.mul(d,p),f=a.mul(f,u),c=h}return d}})(t)}const hle=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function c5(t,e){const n=e!==void 0?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function u5(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function SA(t){const e=u5(t);return e+Math.ceil(e/2)}class d5 extends s5{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Jae(e);const r=_S(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Dg(this),this.iHash.update(e),this}digestInto(e){Dg(this),r5(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const f5=(t,e,n)=>new d5(t,e).update(n).digest();f5.create=(t,e)=>new d5(t,e);const ple=BigInt(0),$w=BigInt(1);function h5(t){return yh(t.Fp,hle.reduce(((e,n)=>(e[n]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),yh(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...c5(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:mle,aT:gle}=z1,fc={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=fc;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(r[0]===0&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:mle(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=fc,n=typeof t=="string"?gle(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=fc._parseInt(n.subarray(2)),{d:o,l:a}=fc._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>8&Number.parseInt(c[0],16)?"00"+c:c,n=c=>{const u=c.toString(16);return 1&u.length?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Ho=BigInt(0),Wi=BigInt(1),EA=(BigInt(2),BigInt(3));BigInt(4);function yle(t){const e=(function(p){const m=h5(p);yh(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:g,Fp:y,a:w}=m;if(g){if(!y.eql(w,y.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof g!="object"||typeof g.beta!="bigint"||typeof g.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})})(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return Bc(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1);return{x:n.fromBytes(m.subarray(0,n.BYTES)),y:n.fromBytes(m.subarray(n.BYTES,2*n.BYTES))}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),w=n.mul(y,p);return n.add(n.add(w,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Ho<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:w}=e;if(m&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=hd(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(2*g,"0")}let k;try{k=typeof p=="bigint"?p:hi(Lr("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(k=wr(k,w)),a(k),k}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const w=k=>n.eql(k,n.ZERO);return w(g)&&w(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map((y=>y.pz)));return m.map(((y,w)=>y.toAffine(g[w]))).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(Lr("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),w=s(m);if(!n.eql(y,w))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:w}=this,{px:k,py:C,pz:A}=m,E=n.eql(n.mul(g,A),n.mul(k,w)),P=n.eql(n.mul(y,A),n.mul(C,w));return E&&P}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,EA),{px:w,py:k,pz:C}=this;let A=n.ZERO,E=n.ZERO,P=n.ZERO,S=n.mul(w,w),x=n.mul(k,k),_=n.mul(C,C),I=n.mul(w,k);return I=n.add(I,I),P=n.mul(w,C),P=n.add(P,P),A=n.mul(m,P),E=n.mul(y,_),E=n.add(A,E),A=n.sub(x,E),E=n.add(x,E),E=n.mul(A,E),A=n.mul(I,A),P=n.mul(y,P),_=n.mul(m,_),I=n.sub(S,_),I=n.mul(m,I),I=n.add(I,P),P=n.add(S,S),S=n.add(P,S),S=n.add(S,_),S=n.mul(S,I),E=n.add(E,S),_=n.mul(k,C),_=n.add(_,_),S=n.mul(_,I),A=n.sub(A,S),P=n.mul(_,x),P=n.add(P,P),P=n.add(P,P),new d(A,E,P)}add(m){u(m);const{px:g,py:y,pz:w}=this,{px:k,py:C,pz:A}=m;let E=n.ZERO,P=n.ZERO,S=n.ZERO;const x=e.a,_=n.mul(e.b,EA);let I=n.mul(g,k),D=n.mul(y,C),B=n.mul(w,A),F=n.add(g,y),R=n.add(k,C);F=n.mul(F,R),R=n.add(I,D),F=n.sub(F,R),R=n.add(g,w);let O=n.add(k,A);return R=n.mul(R,O),O=n.add(I,B),R=n.sub(R,O),O=n.add(y,w),E=n.add(C,A),O=n.mul(O,E),E=n.add(D,B),O=n.sub(O,E),S=n.mul(x,R),E=n.mul(_,B),S=n.add(E,S),E=n.sub(D,S),S=n.add(D,S),P=n.mul(E,S),D=n.add(I,I),D=n.add(D,I),B=n.mul(x,B),R=n.mul(_,R),D=n.add(D,B),B=n.sub(I,B),B=n.mul(x,B),R=n.add(R,B),I=n.mul(D,R),P=n.add(P,I),I=n.mul(O,R),E=n.mul(F,E),E=n.sub(E,I),I=n.mul(F,D),S=n.mul(O,S),S=n.add(S,I),new d(E,P,S)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,(g=>{const y=n.invertBatch(g.map((w=>w.pz)));return g.map(((w,k)=>w.toAffine(y[k]))).map(d.fromAffine)}))}multiplyUnsafe(m){const g=d.ZERO;if(m===Ho)return g;if(a(m),m===Wi)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:w,k1:k,k2neg:C,k2:A}=y.splitScalar(m),E=g,P=g,S=this;for(;k>Ho||A>Ho;)k&Wi&&(E=E.add(S)),A&Wi&&(P=P.add(S)),S=S.double(),k>>=Wi,A>>=Wi;return w&&(E=E.negate()),C&&(P=P.negate()),P=new d(n.mul(P.px,y.beta),P.py,P.pz),E.add(P)}multiply(m){a(m);let g,y,w=m;const{endo:k}=e;if(k){const{k1neg:C,k1:A,k2neg:E,k2:P}=k.splitScalar(w);let{p:S,f:x}=this.wNAF(A),{p:_,f:I}=this.wNAF(P);S=h.constTimeNegate(C,S),_=h.constTimeNegate(E,_),_=new d(n.mul(_.px,k.beta),_.py,_.pz),g=S.add(_),y=x.add(I)}else{const{p:C,f:A}=this.wNAF(w);g=C,y=A}return d.normalizeZ([g,y])[0]}multiplyAndAddUnsafe(m,g,y){const w=d.BASE,k=(A,E)=>E!==Ho&&E!==Wi&&A.equals(w)?A.multiply(E):A.multiplyUnsafe(E),C=k(this,g).add(k(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:w}=this,k=this.is0();m==null&&(m=k?n.ONE:n.inv(w));const C=n.mul(g,m),A=n.mul(y,m),E=n.mul(w,m);if(k)return{x:n.ZERO,y:n.ZERO};if(!n.eql(E,n.ONE))throw new Error("invZ was invalid");return{x:C,y:A}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===Wi)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===Wi?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return hd(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=(function(p,m){const g=(w,k)=>{const C=k.negate();return w?C:k},y=w=>({windows:Math.ceil(m/w)+1,windowSize:2**(w-1)});return{constTimeNegate:g,unsafeLadder(w,k){let C=p.ZERO,A=w;for(;k>ple;)k&$w&&(C=C.add(A)),A=A.double(),k>>=$w;return C},precomputeWindow(w,k){const{windows:C,windowSize:A}=y(k),E=[];let P=w,S=P;for(let x=0;x<C;x++){S=P,E.push(S);for(let _=1;_<A;_++)S=S.add(P),E.push(S);P=S.double()}return E},wNAF(w,k,C){const{windows:A,windowSize:E}=y(w);let P=p.ZERO,S=p.BASE;const x=BigInt(2**w-1),_=2**w,I=BigInt(w);for(let D=0;D<A;D++){const B=D*E;let F=Number(C&x);C>>=I,F>E&&(F-=_,C+=$w);const R=B,O=B+Math.abs(F)-1,L=D%2!=0,H=F<0;F===0?S=S.add(g(L,k[R])):P=P.add(g(H,k[O]))}return{p:P,f:S}},wNAFCached(w,k,C,A){const E=w._WINDOW_SIZE||1;let P=k.get(w);return P||(P=this.precomputeWindow(w,E),E!==1&&k.set(w,A(P))),this.wNAF(E,P,C)}}})(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function ble(t){const e=(function(x){const _=h5(x);return yh(_,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,..._})})(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(x){return wr(x,r)}function a(x){return V1(x,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:d}=yle({...e,toBytes(x,_,I){const D=_.toAffine(),B=n.toBytes(D.x),F=Bc;return I?F(Uint8Array.from([_.hasEvenY()?2:3]),B):F(Uint8Array.from([4]),B,n.toBytes(D.y))},fromBytes(x){const _=x.length,I=x[0],D=x.subarray(1);if(_!==i||I!==2&&I!==3){if(_===s&&I===4)return{x:n.fromBytes(D.subarray(0,n.BYTES)),y:n.fromBytes(D.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${_} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const F=hi(D);if(!(Ho<(B=F)&&B<n.ORDER))throw new Error("Point is not on curve");const R=u(F);let O=n.sqrt(R);return!(1&~I)!=((O&Wi)===Wi)&&(O=n.neg(O)),{x:F,y:O}}var B}}),f=x=>hd(Sl(x,e.nByteLength));function h(x){return x>r>>Wi}const p=(x,_,I)=>hi(x.slice(_,I));class m{constructor(_,I,D){this.r=_,this.s=I,this.recovery=D,this.assertValidity()}static fromCompact(_){const I=e.nByteLength;return _=Lr("compactSignature",_,2*I),new m(p(_,0,I),p(_,I,2*I))}static fromDER(_){const{r:I,s:D}=fc.toSig(Lr("DER",_));return new m(I,D)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(_){return new m(this.r,this.s,_)}recoverPublicKey(_){const{r:I,s:D,recovery:B}=this,F=k(Lr("msgHash",_));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");const R=B===2||B===3?I+e.n:I;if(R>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const O=1&B?"03":"02",L=l.fromHex(O+f(R)),H=a(R),U=o(-F*H),j=o(D*H),Q=l.BASE.multiplyAndAddUnsafe(L,U,j);if(!Q)throw new Error("point at infinify");return Q.assertValidity(),Q}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return gh(this.toDERHex())}toDERHex(){return fc.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return gh(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}const g={isValidPrivateKey(x){try{return c(x),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const x=SA(e.n);return(function(_,I,D=!1){const B=_.length,F=u5(I),R=SA(I);if(B<16||B<R||B>1024)throw new Error(`expected ${R}-1024 bytes of input, got ${B}`);const O=wr(D?hi(_):CS(_),I-Dn)+Dn;return D?AS(O,F):Sl(O,F)})(e.randomBytes(x),e.n)},precompute:(x=8,_=l.BASE)=>(_._setWindowSize(x),_.multiply(BigInt(3)),_)};function y(x){const _=x instanceof Uint8Array,I=typeof x=="string",D=(_||I)&&x.length;return _?D===i||D===s:I?D===2*i||D===2*s:x instanceof l}const w=e.bits2int||function(x){const _=hi(x),I=8*x.length-e.nBitLength;return I>0?_>>BigInt(I):_},k=e.bits2int_modN||function(x){return o(w(x))},C=IS(e.nBitLength);function A(x){if(typeof x!="bigint")throw new Error("bigint expected");if(!(Ho<=x&&x<C))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Sl(x,e.nByteLength)}function E(x,_,I=P){if(["recovered","canonical"].some((X=>X in I)))throw new Error("sign() legacy options not supported");const{hash:D,randomBytes:B}=e;let{lowS:F,prehash:R,extraEntropy:O}=I;F==null&&(F=!0),x=Lr("msgHash",x),R&&(x=Lr("prehashed msgHash",D(x)));const L=k(x),H=c(_),U=[A(H),A(L)];if(O!=null){const X=O===!0?B(n.BYTES):O;U.push(Lr("extraEntropy",X))}const j=Bc(...U),Q=L;return{seed:j,k2sig:function(X){const de=w(X);if(!d(de))return;const le=a(de),J=l.BASE.multiply(de).toAffine(),he=o(J.x);if(he===Ho)return;const Me=o(le*o(Q+he*H));if(Me===Ho)return;let pe=(J.x===he?0:2)|Number(J.y&Wi),Te=Me;return F&&h(Me)&&(Te=(function(je){return h(je)?o(-je):je})(Me),pe^=1),new m(he,Te,pe)}}}const P={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(x,_=!0){return l.fromPrivateKey(x).toRawBytes(_)},getSharedSecret:function(x,_,I=!0){if(y(x))throw new Error("first arg must be private key");if(!y(_))throw new Error("second arg must be public key");return l.fromHex(_).multiply(c(x)).toRawBytes(I)},sign:function(x,_,I=P){const{seed:D,k2sig:B}=E(x,_,I),F=e;return l5(F.hash.outputLen,F.nByteLength,F.hmac)(D,B)},verify:function(x,_,I,D=S){const B=x;if(_=Lr("msgHash",_),I=Lr("publicKey",I),"strict"in D)throw new Error("options.strict was renamed to lowS");const{lowS:F,prehash:R}=D;let O,L;try{if(typeof B=="string"||B instanceof Uint8Array)try{O=m.fromDER(B)}catch(J){if(!(J instanceof fc.Err))throw J;O=m.fromCompact(B)}else{if(typeof B!="object"||typeof B.r!="bigint"||typeof B.s!="bigint")throw new Error("PARSE");{const{r:J,s:he}=B;O=new m(J,he)}}L=l.fromHex(I)}catch(J){if(J.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(F&&O.hasHighS())return!1;R&&(_=e.hash(_));const{r:H,s:U}=O,j=k(_),Q=a(U),X=o(j*Q),de=o(H*Q),le=l.BASE.multiplyAndAddUnsafe(L,X,de)?.toAffine();return!!le&&o(le.x)===H},ProjectivePoint:l,Signature:m,utils:g}}function wle(t){return{hash:t,hmac:(e,...n)=>f5(t,e,(function(...r){const i=new Uint8Array(r.reduce(((o,a)=>o+a.length),0));let s=0;return r.forEach((o=>{if(!i5(o))throw new Error("Uint8Array expected");i.set(o,s),s+=o.length})),i})(...n)),randomBytes:o5}}const Q0=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Bg=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),p5=BigInt(1),$g=BigInt(2),kA=(t,e)=>(t+e/$g)/e;function m5(t){const e=Q0,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=zi(u,n,e)*u%e,f=zi(d,n,e)*u%e,h=zi(f,$g,e)*c%e,p=zi(h,i,e)*h%e,m=zi(p,s,e)*p%e,g=zi(m,a,e)*m%e,y=zi(g,l,e)*g%e,w=zi(y,a,e)*m%e,k=zi(w,n,e)*u%e,C=zi(k,o,e)*p%e,A=zi(C,r,e)*c%e,E=zi(A,$g,e);if(!j1.eql(j1.sqr(E),t))throw new Error("Cannot find square root");return E}const j1=(function(t,e,n=!1,r={}){if(t<=tr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=c5(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=fle(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:IS(i),ZERO:tr,ONE:Dn,create:l=>wr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("Invalid field element: expected bigint, got "+typeof l);return tr<=l&&l<t},is0:l=>l===tr,isOdd:l=>(l&Dn)===Dn,neg:l=>wr(-l,t),eql:(l,c)=>l===c,sqr:l=>wr(l*l,t),add:(l,c)=>wr(l+c,t),sub:(l,c)=>wr(l-c,t),mul:(l,c)=>wr(l*c,t),pow:(l,c)=>(function(u,d,f){if(f<tr)throw new Error("Expected power > 0");if(f===tr)return u.ONE;if(f===Dn)return d;let h=u.ONE,p=d;for(;f>tr;)f&Dn&&(h=u.mul(h,p)),p=u.sqr(p),f>>=Dn;return h})(a,l,c),div:(l,c)=>wr(l*V1(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>V1(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>(function(c,u){const d=new Array(u.length),f=u.reduce(((p,m,g)=>c.is0(m)?p:(d[g]=p,c.mul(p,m))),c.ONE),h=c.inv(f);return u.reduceRight(((p,m,g)=>c.is0(m)?p:(d[g]=c.mul(p,d[g]),c.mul(p,m))),h),d})(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?AS(l,s):Sl(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?CS(l):hi(l)}});return Object.freeze(a)})(Q0,void 0,void 0,{sqrt:m5}),_d=(function(t,e){const n=r=>ble({...t,...wle(r)});return Object.freeze({...n(e),create:n})})({a:BigInt(0),b:BigInt(7),Fp:j1,n:Bg,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Bg,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-p5*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=kA(s*t,e),l=kA(-r*t,e);let c=wr(t-a*n-l*i,e),u=wr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},H1),X0=BigInt(0),g5=t=>typeof t=="bigint"&&X0<t&&t<Q0,TA={};function Fg(t,...e){let n=TA[t];if(n===void 0){const r=H1(Uint8Array.from(t,(i=>i.charCodeAt(0))));n=Bc(r,r),TA[t]=n}return H1(Bc(n,...e))}const PS=t=>t.toRawBytes(!0).slice(1),W1=t=>Sl(t,32),Fw=t=>wr(t,Q0),bh=t=>wr(t,Bg),MS=_d.ProjectivePoint;function q1(t){let e=_d.utils.normPrivateKeyToScalar(t),n=MS.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:bh(-e),bytes:PS(n)}}function y5(t){if(!g5(t))throw new Error("bad x: need 0 < x < p");const e=Fw(t*t);let n=m5(Fw(e*t+BigInt(7)));n%$g!==X0&&(n=Fw(-n));const r=new MS(t,n,p5);return r.assertValidity(),r}function b5(...t){return bh(hi(Fg("BIP0340/challenge",...t)))}function vle(t){return q1(t).bytes}function xle(t,e,n=o5(32)){const r=Lr("message",t),{bytes:i,scalar:s}=q1(e),o=Lr("auxRand",n,32),a=W1(s^hi(Fg("BIP0340/aux",o))),l=Fg("BIP0340/nonce",a,i,r),c=bh(hi(l));if(c===X0)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=q1(c),f=b5(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(W1(bh(d+f*s)),32),!w5(h,r,i))throw new Error("sign: Invalid signature produced");return h}function w5(t,e,n){const r=Lr("signature",t,64),i=Lr("message",e),s=Lr("publicKey",n,32);try{const u=y5(hi(s)),d=hi(r.subarray(0,32));if(!g5(d))return!1;const f=hi(r.subarray(32,64));if(!(typeof(c=f)=="bigint"&&X0<c&&c<Bg))return!1;const h=b5(W1(d),PS(u),i),p=(o=u,a=f,l=bh(-h),MS.BASE.multiplyAndAddUnsafe(o,a,l));return!(!p||!p.hasEvenY()||p.toAffine().x!==d)}catch{return!1}var o,a,l,c}const Xs={getPublicKey:vle,sign:xle,verify:w5,utils:{randomPrivateKey:_d.utils.randomPrivateKey,lift_x:y5,pointToBytes:PS,numberToBytesBE:Sl,bytesToNumberBE:hi,taggedHash:Fg,mod:wr}},zw=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,OS=t=>t instanceof Uint8Array,Uw=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Us=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");const Sle=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Zn(t){if(!OS(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Sle[t[n]];return e}function pd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function wh(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!OS(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function Y0(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!OS(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}class v5{clone(){return this._cloneInto()}}function x5(t){const e=r=>t().update(wh(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function S5(t=32){if(zw&&typeof zw.getRandomValues=="function")return zw.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Hw(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function _A(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const Ele={number:Hw,bool:function(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)},bytes:_A,hash:function(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Hw(t.outputLen),Hw(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){_A(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},ro=Ele;class kle extends v5{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Uw(this.buffer)}update(e){ro.exists(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=wh(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=Uw(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){ro.exists(this),ro.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;(function(d,f,h,p){if(typeof d.setBigUint64=="function")return d.setBigUint64(f,h,p);const m=BigInt(32),g=BigInt(4294967295),y=Number(h>>m&g),w=Number(h&g),k=p?4:0,C=p?0:4;d.setUint32(f+k,y,p),d.setUint32(f+C,w,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=Uw(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const Tle=(t,e,n)=>t&e^t&n^e&n,_le=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$a=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Fa=new Uint32Array(64);class E5 extends kle{constructor(){super(64,32,8,!1),this.A=0|$a[0],this.B=0|$a[1],this.C=0|$a[2],this.D=0|$a[3],this.E=0|$a[4],this.F=0|$a[5],this.G=0|$a[6],this.H=0|$a[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let f=0;f<16;f++,n+=4)Fa[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Fa[f-15],p=Fa[f-2],m=Us(h,7)^Us(h,18)^h>>>3,g=Us(p,17)^Us(p,19)^p>>>10;Fa[f]=g+Fa[f-7]+m+Fa[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=u+(Us(a,6)^Us(a,11)^Us(a,25))+((d=a)&l^~d&c)+_le[f]+Fa[f]|0,p=(Us(r,2)^Us(r,13)^Us(r,22))+Tle(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var d;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Fa.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Cle extends E5{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const qc=x5((()=>new E5));x5((()=>new Cle));function Cd(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function ta(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce(((i,s)=>i?e(i,s.encode):s.encode),void 0),r=t.reduce(((i,s)=>i?e(i,s.decode):s.decode),void 0);return{encode:n,decode:r}}function na(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map((n=>{if(Cd(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]}))},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map((n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r}))}}}function ra(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function zg(t,e="="){if(Cd(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function k5(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function CA(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((o=>{if(Cd(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)}));;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!=e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");a&&(s[l]?a=!1:r=l)}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const T5=(t,e)=>e?T5(e,t%e):t,Ug=(t,e)=>t+(e-T5(t,e));function K1(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ug(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Ug(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(Cd(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function Ale(t){return Cd(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return CA(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(CA(e,t,256))}}}function El(t,e=!1){if(Cd(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Ug(8,t)>32||Ug(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return K1(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(K1(n,t,8,e))}}}function AA(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}ta(El(4),na("0123456789ABCDEF"),ra(""));ta(El(5),na("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),zg(5),ra(""));const Ol=(ta(El(5),na("0123456789ABCDEFGHIJKLMNOPQRSTUV"),zg(5),ra("")),ta(El(5),na("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ra(""),k5((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),ta(El(6),na("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),zg(6),ra("")));ta(El(6),na("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),zg(6),ra(""));const G1=t=>ta(Ale(58),na(t),ra(""));G1("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");G1("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),G1("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Z1=ta(na("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ra("")),IA=[996825010,642813549,513874426,1027748829,705979059];function af(t){const e=t>>25;let n=(33554431&t)<<5;for(let r=0;r<IA.length;r++)(e>>r&1)==1&&(n^=IA[r]);return n}function PA(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=af(i)^o>>5}i=af(i);for(let s=0;s<r;s++)i=af(i)^31&t.charCodeAt(s);for(let s of e)i=af(i)^s;for(let s=0;s<6;s++)i=af(i);return i^=n,Z1.encode(K1([i%2**30],30,5,!1))}function _5(t){const e=t==="bech32"?1:734539939,n=El(5),r=n.decode,i=n.encode,s=AA(r);function o(a,l=90){if(typeof a!="string")throw new Error("bech32.decode input should be string, not "+typeof a);if(a.length<8||l!==!1&&a.length>l)throw new TypeError(`Wrong string length: ${a.length} (${a}). Expected (8..${l})`);const c=a.toLowerCase();if(a!==c&&a!==a.toUpperCase())throw new Error("String must be lowercase or uppercase");const u=(a=c).lastIndexOf("1");if(u===0||u===-1)throw new Error('Letter "1" must be present between prefix and data only');const d=a.slice(0,u),f=a.slice(u+1);if(f.length<6)throw new Error("Data must be at least 6 characters long");const h=Z1.decode(f).slice(0,-6),p=PA(d,h,e);if(!f.endsWith(p))throw new Error(`Invalid checksum in ${a}: expected "${p}"`);return{prefix:d,words:h}}return{encode:function(a,l,c=90){if(typeof a!="string")throw new Error("bech32.encode prefix should be string, not "+typeof a);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof l);const u=a.length+7+l.length;if(c!==!1&&u>c)throw new TypeError(`Length ${u} exceeds limit ${c}`);return`${a=a.toLowerCase()}1${Z1.encode(l)}${PA(a,l,e)}`},decode:o,decodeToBytes:function(a){const{prefix:l,words:c}=o(a,!1);return{prefix:l,words:c,bytes:r(c)}},decodeUnsafe:AA(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const md=_5("bech32");_5("bech32m");ta(El(4),na("0123456789abcdef"),ra(""),k5((t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));function Vw(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function MA(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function C5(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function tn(t,...e){if(!C5(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function gd(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function NS(t,e){tn(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const RS=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),Mt=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),J0=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function Nl(t){if(typeof t=="string")t=(function(e){if(typeof e!="string")throw new Error("string expected, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t);else{if(!C5(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function LS(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const Ad=(t,e)=>(Object.assign(e,t),e);function Q1(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const Bo=16,DS=new Uint8Array(16),Ys=Mt(DS),qi=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class A5{constructor(e,n){this.blockLen=Bo,this.outputLen=Bo,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,tn(e=Nl(e),16);const r=J0(e);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const l=[];for(let y=0;y<128;y++)l.push({s0:qi(i),s1:qi(s),s2:qi(o),s3:qi(a)}),{s0:i,s1:s,s2:o,s3:a}={s3:(d=o)<<31|(f=a)>>>1,s2:(u=s)<<31|d>>>1,s1:(c=i)<<31|u>>>1,s0:c>>>1^225<<24&-(1&f)};var c,u,d,f;const h=(y=>y>65536?8:y>1024?4:2)(n||1024);if(![1,2,4,8].includes(h))throw new Error(`ghash: wrong window size=${h}, should be 2, 4 or 8`);this.W=h;const p=128/h,m=this.windowSize=2**h,g=[];for(let y=0;y<p;y++)for(let w=0;w<m;w++){let k=0,C=0,A=0,E=0;for(let P=0;P<h;P++){if(!(w>>>h-P-1&1))continue;const{s0:S,s1:x,s2:_,s3:I}=l[h*y+P];k^=S,C^=x,A^=_,E^=I}g.push({s0:k,s1:C,s2:A,s3:E})}this.t=g}_updateBlock(e,n,r,i){e^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let l=0,c=0,u=0,d=0;const f=(1<<s)-1;let h=0;for(const p of[e,n,r,i])for(let m=0;m<4;m++){const g=p>>>8*m&255;for(let y=8/s-1;y>=0;y--){const w=g>>>s*y&f,{s0:k,s1:C,s2:A,s3:E}=o[h*a+w];l^=k,c^=C,u^=A,d^=E,h+=1}}this.s0=l,this.s1=c,this.s2=u,this.s3=d}update(e){e=Nl(e),gd(this);const n=Mt(e),r=Math.floor(e.length/Bo),i=e.length%Bo;for(let s=0;s<r;s++)this._updateBlock(n[4*s+0],n[4*s+1],n[4*s+2],n[4*s+3]);return i&&(DS.set(e.subarray(r*Bo)),this._updateBlock(Ys[0],Ys[1],Ys[2],Ys[3]),Ys.fill(0)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){gd(this),NS(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Mt(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e}digest(){const e=new Uint8Array(Bo);return this.digestInto(e),this.destroy(),e}}class Ile extends A5{constructor(e,n){const r=(function(i){i.reverse();const s=1&i[15];let o=0;for(let a=0;a<i.length;a++){const l=i[a];i[a]=l>>>1|o,o=(1&l)<<7}return i[0]^=225&-s,i})((e=Nl(e)).slice());super(r,n),r.fill(0)}update(e){e=Nl(e),gd(this);const n=Mt(e),r=e.length%Bo,i=Math.floor(e.length/Bo);for(let s=0;s<i;s++)this._updateBlock(qi(n[4*s+3]),qi(n[4*s+2]),qi(n[4*s+1]),qi(n[4*s+0]));return r&&(DS.set(e.subarray(i*Bo)),this._updateBlock(qi(Ys[3]),qi(Ys[2]),qi(Ys[1]),qi(Ys[0])),Ys.fill(0)),this}digestInto(e){gd(this),NS(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Mt(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e.reverse()}}function I5(t){const e=(r,i)=>t(i,r.length).update(Nl(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,i)=>t(r,i),e}const OA=I5(((t,e)=>new A5(t,e))),Ple=I5(((t,e)=>new Ile(t,e))),bi=16,Np=new Uint8Array(bi);function BS(t){return t<<1^283&-(t>>7)}function Au(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=BS(t);return n}const X1=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=BS(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),Mle=X1.map(((t,e)=>X1.indexOf(e))),jw=t=>t<<8|t>>>24;function P5(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((c,u)=>e(t[u]))),r=n.map(jw),i=r.map(jw),s=i.map(jw),o=new Uint32Array(65536),a=new Uint32Array(65536),l=new Uint16Array(65536);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const d=256*c+u;o[d]=n[c]^r[u],a[d]=i[c]^s[u],l[d]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const $S=P5(X1,(t=>Au(t,3)<<24|t<<16|t<<8|Au(t,2))),M5=P5(Mle,(t=>Au(t,11)<<24|Au(t,13)<<16|Au(t,9)<<8|Au(t,14))),Ole=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=BS(n))t[e]=n;return t})();function Rl(t){tn(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=$S,r=Mt(t),i=r.length,s=l=>io(n,l,l,l,l),o=new Uint32Array(e+28);o.set(r);for(let l=i;l<o.length;l++){let c=o[l-1];l%i==0?c=s((a=c)<<24|a>>>8)^Ole[l/i-1]:i>6&&l%i==4&&(c=s(c)),o[l]=o[l-i]^c}var a;return o}function O5(t){const e=Rl(t),n=e.slice(),r=e.length,{sbox2:i}=$S,{T0:s,T1:o,T2:a,T3:l}=M5;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],d=io(i,u,u,u,u);n[c]=s[255&d]^o[d>>>8&255]^a[d>>>16&255]^l[d>>>24]}return n}function dl(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function io(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function ss(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=$S;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const d=t[l++]^dl(o,a,e,n,r,i),f=t[l++]^dl(o,a,n,r,i,e),h=t[l++]^dl(o,a,r,i,e,n),p=t[l++]^dl(o,a,i,e,n,r);e=d,n=f,r=h,i=p}return{s0:t[l++]^io(s,e,n,r,i),s1:t[l++]^io(s,n,r,i,e),s2:t[l++]^io(s,r,i,e,n),s3:t[l++]^io(s,i,e,n,r)}}function N5(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=M5;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const d=t[l++]^dl(o,a,e,i,r,n),f=t[l++]^dl(o,a,n,e,i,r),h=t[l++]^dl(o,a,r,n,e,i),p=t[l++]^dl(o,a,i,r,n,e);e=d,n=f,r=h,i=p}return{s0:t[l++]^io(s,e,i,r,n),s1:t[l++]^io(s,n,e,i,r),s2:t[l++]^io(s,r,n,e,i),s3:t[l++]^io(s,i,r,n,e)}}function Id(t,e){if(!e)return new Uint8Array(t);if(tn(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function Nle(t,e,n,r){tn(e,bi),tn(n);const i=n.length;r=Id(i,r);const s=e,o=Mt(s);let{s0:a,s1:l,s2:c,s3:u}=ss(t,o[0],o[1],o[2],o[3]);const d=Mt(n),f=Mt(r);for(let p=0;p+4<=d.length;p+=4){f[p+0]=d[p+0]^a,f[p+1]=d[p+1]^l,f[p+2]=d[p+2]^c,f[p+3]=d[p+3]^u;let m=1;for(let g=s.length-1;g>=0;g--)m=m+(255&s[g])|0,s[g]=255&m,m>>>=8;({s0:a,s1:l,s2:c,s3:u}=ss(t,o[0],o[1],o[2],o[3]))}const h=bi*Math.floor(d.length/4);if(h<i){const p=new Uint32Array([a,l,c,u]),m=RS(p);for(let g=h,y=0;g<i;g++,y++)r[g]=n[g]^m[y]}return r}function bf(t,e,n,r,i){tn(n,bi),tn(r),i=Id(r.length,i);const s=n,o=Mt(s),a=J0(s),l=Mt(r),c=Mt(i),u=e?0:12,d=r.length;let f=a.getUint32(u,e),{s0:h,s1:p,s2:m,s3:g}=ss(t,o[0],o[1],o[2],o[3]);for(let w=0;w+4<=l.length;w+=4)c[w+0]=l[w+0]^h,c[w+1]=l[w+1]^p,c[w+2]=l[w+2]^m,c[w+3]=l[w+3]^g,f=f+1>>>0,a.setUint32(u,f,e),{s0:h,s1:p,s2:m,s3:g}=ss(t,o[0],o[1],o[2],o[3]);const y=bi*Math.floor(l.length/4);if(y<d){const w=new Uint32Array([h,p,m,g]),k=RS(w);for(let C=y,A=0;C<d;C++,A++)i[C]=r[C]^k[A]}return i}Ad({blockSize:16,nonceLength:16},(function(t,e){function n(r,i){const s=Rl(t),o=e.slice(),a=Nle(s,o,r,i);return s.fill(0),o.fill(0),a}return tn(t),tn(e,bi),{encrypt:(r,i)=>n(r,i),decrypt:(r,i)=>n(r,i)}}));function R5(t){if(tn(t),t.length%bi!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function L5(t,e,n){let r=t.length;const i=r%bi;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=Mt(t);if(e){let a=bi-i;a||(a=bi),r+=a}const o=Id(r,n);return{b:s,o:Mt(o),out:o}}function D5(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function B5(t){const e=new Uint8Array(16),n=Mt(e);e.set(t);const r=bi-t.length;for(let i=bi-r;i<bi;i++)e[i]=r;return n}Ad({blockSize:16},(function(t,e={}){tn(t);const n=!e.disablePadding;return{encrypt:(r,i)=>{tn(r);const{b:s,o,out:a}=L5(r,n,i),l=Rl(t);let c=0;for(;c+4<=s.length;){const{s0:u,s1:d,s2:f,s3:h}=ss(l,s[c+0],s[c+1],s[c+2],s[c+3]);o[c++]=u,o[c++]=d,o[c++]=f,o[c++]=h}if(n){const u=B5(r.subarray(4*c)),{s0:d,s1:f,s2:h,s3:p}=ss(l,u[0],u[1],u[2],u[3]);o[c++]=d,o[c++]=f,o[c++]=h,o[c++]=p}return l.fill(0),a},decrypt:(r,i)=>{R5(r);const s=O5(t),o=Id(r.length,i),a=Mt(r),l=Mt(o);for(let c=0;c+4<=a.length;){const{s0:u,s1:d,s2:f,s3:h}=N5(s,a[c+0],a[c+1],a[c+2],a[c+3]);l[c++]=u,l[c++]=d,l[c++]=f,l[c++]=h}return s.fill(0),D5(o,n)}}}));const $5=Ad({blockSize:16,nonceLength:16},(function(t,e,n={}){tn(t),tn(e,16);const r=!n.disablePadding;return{encrypt:(i,s)=>{const o=Rl(t),{b:a,o:l,out:c}=L5(i,r,s),u=Mt(e);let d=u[0],f=u[1],h=u[2],p=u[3],m=0;for(;m+4<=a.length;)d^=a[m+0],f^=a[m+1],h^=a[m+2],p^=a[m+3],{s0:d,s1:f,s2:h,s3:p}=ss(o,d,f,h,p),l[m++]=d,l[m++]=f,l[m++]=h,l[m++]=p;if(r){const g=B5(i.subarray(4*m));d^=g[0],f^=g[1],h^=g[2],p^=g[3],{s0:d,s1:f,s2:h,s3:p}=ss(o,d,f,h,p),l[m++]=d,l[m++]=f,l[m++]=h,l[m++]=p}return o.fill(0),c},decrypt:(i,s)=>{R5(i);const o=O5(t),a=Mt(e),l=Id(i.length,s),c=Mt(i),u=Mt(l);let d=a[0],f=a[1],h=a[2],p=a[3];for(let m=0;m+4<=c.length;){const g=d,y=f,w=h,k=p;d=c[m+0],f=c[m+1],h=c[m+2],p=c[m+3];const{s0:C,s1:A,s2:E,s3:P}=N5(o,d,f,h,p);u[m++]=C^g,u[m++]=A^y,u[m++]=E^w,u[m++]=P^k}return o.fill(0),D5(l,r)}}}));Ad({blockSize:16,nonceLength:16},(function(t,e){function n(r,i,s){const o=Rl(t),a=r.length;s=Id(a,s);const l=Mt(r),c=Mt(s),u=i?c:l,d=Mt(e);let f=d[0],h=d[1],p=d[2],m=d[3];for(let y=0;y+4<=l.length;){const{s0:w,s1:k,s2:C,s3:A}=ss(o,f,h,p,m);c[y+0]=l[y+0]^w,c[y+1]=l[y+1]^k,c[y+2]=l[y+2]^C,c[y+3]=l[y+3]^A,f=u[y++],h=u[y++],p=u[y++],m=u[y++]}const g=bi*Math.floor(l.length/4);if(g<a){({s0:f,s1:h,s2:p,s3:m}=ss(o,f,h,p,m));const y=RS(new Uint32Array([f,h,p,m]));for(let w=g,k=0;w<a;w++,k++)s[w]=r[w]^y[k];y.fill(0)}return o.fill(0),s}return tn(t),tn(e,16),{encrypt:(r,i)=>n(r,!0,i),decrypt:(r,i)=>n(r,!1,i)}}));function F5(t,e,n,r,i){const s=t.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=J0(o);return i&&Q1(a,0,BigInt(8*i.length),e),Q1(a,8,BigInt(8*r.length),e),s.update(o),s.digest()}Ad({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(tn(e),e.length===0)throw new Error("aes/gcm: empty nonce");const r=16;function i(o,a,l){const c=F5(OA,!1,o,l,n);for(let u=0;u<a.length;u++)c[u]^=a[u];return c}function s(){const o=Rl(t),a=Np.slice(),l=Np.slice();if(bf(o,!1,l,l,a),e.length===12)l.set(e);else{const c=Np.slice();Q1(J0(c),8,BigInt(8*e.length),!1),OA.create(a).update(e).update(c).digestInto(l)}return{xk:o,authKey:a,counter:l,tagMask:bf(o,!1,l,Np)}}return{encrypt:o=>{tn(o);const{xk:a,authKey:l,counter:c,tagMask:u}=s(),d=new Uint8Array(o.length+r);bf(a,!1,c,o,d);const f=i(l,u,d.subarray(0,d.length-r));return d.set(f,o.length),a.fill(0),d},decrypt:o=>{if(tn(o),o.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:a,authKey:l,counter:c,tagMask:u}=s(),d=o.subarray(0,-16),f=o.subarray(-16);if(!LS(i(l,u,d),f))throw new Error("aes/gcm: invalid ghash tag");const h=bf(a,!1,c,d);return l.fill(0),u.fill(0),a.fill(0),h}}}));const Rp=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};Ad({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=Rp("AAD",0,68719476736),i=Rp("plaintext",0,2**36),s=Rp("nonce",12,12),o=Rp("ciphertext",16,2**36+16);function a(){const u=t.length;if(u!==16&&u!==24&&u!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${u} bytes`);const d=Rl(t),f=new Uint8Array(u),h=new Uint8Array(16),p=Mt(e);let m=0,g=p[0],y=p[1],w=p[2],k=0;for(const C of[h,f].map(Mt)){const A=Mt(C);for(let E=0;E<A.length;E+=2){const{s0:P,s1:S}=ss(d,m,g,y,w);A[E+0]=P,A[E+1]=S,m=++k}}return d.fill(0),{authKey:h,encKey:Rl(f)}}function l(u,d,f){const h=F5(Ple,!0,d,f,n);for(let k=0;k<12;k++)h[k]^=e[k];h[15]&=127;const p=Mt(h);let m=p[0],g=p[1],y=p[2],w=p[3];return{s0:m,s1:g,s2:y,s3:w}=ss(u,m,g,y,w),p[0]=m,p[1]=g,p[2]=y,p[3]=w,h}function c(u,d,f){let h=d.slice();return h[15]|=128,bf(u,!0,h,f)}return tn(e),s(e.length),n&&(tn(n),r(n.length)),{encrypt:u=>{tn(u),i(u.length);const{encKey:d,authKey:f}=a(),h=l(d,f,u),p=new Uint8Array(u.length+16);return p.set(h,u.length),p.set(c(d,h,u)),d.fill(0),f.fill(0),p},decrypt:u=>{tn(u),o(u.length);const d=u.subarray(-16),{encKey:f,authKey:h}=a(),p=c(f,d,u.subarray(0,-16)),m=l(f,h,p);if(f.fill(0),h.fill(0),!LS(d,m))throw new Error("invalid polyval tag");return p}}}));const dr=(t,e)=>255&t[e++]|(255&t[e++])<<8;class Rle{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,tn(e=Nl(e),32);const n=dr(e,0),r=dr(e,2),i=dr(e,4),s=dr(e,6),o=dr(e,8),a=dr(e,10),l=dr(e,12),c=dr(e,14);this.r[0]=8191&n,this.r[1]=8191&(n>>>13|r<<3),this.r[2]=7939&(r>>>10|i<<6),this.r[3]=8191&(i>>>7|s<<9),this.r[4]=255&(s>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|a<<2),this.r[7]=8065&(a>>>11|l<<5),this.r[8]=8191&(l>>>8|c<<8),this.r[9]=c>>>5&127;for(let u=0;u<8;u++)this.pad[u]=dr(e,16+2*u)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],l=o[1],c=o[2],u=o[3],d=o[4],f=o[5],h=o[6],p=o[7],m=o[8],g=o[9],y=dr(e,n+0),w=dr(e,n+2),k=dr(e,n+4),C=dr(e,n+6),A=dr(e,n+8),E=dr(e,n+10),P=dr(e,n+12),S=dr(e,n+14);let x=s[0]+(8191&y),_=s[1]+(8191&(y>>>13|w<<3)),I=s[2]+(8191&(w>>>10|k<<6)),D=s[3]+(8191&(k>>>7|C<<9)),B=s[4]+(8191&(C>>>4|A<<12)),F=s[5]+(A>>>1&8191),R=s[6]+(8191&(A>>>14|E<<2)),O=s[7]+(8191&(E>>>11|P<<5)),L=s[8]+(8191&(P>>>8|S<<8)),H=s[9]+(S>>>5|i),U=0,j=U+x*a+_*(5*g)+I*(5*m)+D*(5*p)+B*(5*h);U=j>>>13,j&=8191,j+=F*(5*f)+R*(5*d)+O*(5*u)+L*(5*c)+H*(5*l),U+=j>>>13,j&=8191;let Q=U+x*l+_*a+I*(5*g)+D*(5*m)+B*(5*p);U=Q>>>13,Q&=8191,Q+=F*(5*h)+R*(5*f)+O*(5*d)+L*(5*u)+H*(5*c),U+=Q>>>13,Q&=8191;let X=U+x*c+_*l+I*a+D*(5*g)+B*(5*m);U=X>>>13,X&=8191,X+=F*(5*p)+R*(5*h)+O*(5*f)+L*(5*d)+H*(5*u),U+=X>>>13,X&=8191;let de=U+x*u+_*c+I*l+D*a+B*(5*g);U=de>>>13,de&=8191,de+=F*(5*m)+R*(5*p)+O*(5*h)+L*(5*f)+H*(5*d),U+=de>>>13,de&=8191;let le=U+x*d+_*u+I*c+D*l+B*a;U=le>>>13,le&=8191,le+=F*(5*g)+R*(5*m)+O*(5*p)+L*(5*h)+H*(5*f),U+=le>>>13,le&=8191;let J=U+x*f+_*d+I*u+D*c+B*l;U=J>>>13,J&=8191,J+=F*a+R*(5*g)+O*(5*m)+L*(5*p)+H*(5*h),U+=J>>>13,J&=8191;let he=U+x*h+_*f+I*d+D*u+B*c;U=he>>>13,he&=8191,he+=F*l+R*a+O*(5*g)+L*(5*m)+H*(5*p),U+=he>>>13,he&=8191;let Me=U+x*p+_*h+I*f+D*d+B*u;U=Me>>>13,Me&=8191,Me+=F*c+R*l+O*a+L*(5*g)+H*(5*m),U+=Me>>>13,Me&=8191;let pe=U+x*m+_*p+I*h+D*f+B*d;U=pe>>>13,pe&=8191,pe+=F*u+R*c+O*l+L*a+H*(5*g),U+=pe>>>13,pe&=8191;let Te=U+x*g+_*m+I*p+D*h+B*f;U=Te>>>13,Te&=8191,Te+=F*d+R*u+O*c+L*l+H*a,U+=Te>>>13,Te&=8191,U=(U<<2)+U|0,U=U+j|0,j=8191&U,U>>>=13,Q+=U,s[0]=j,s[1]=Q,s[2]=X,s[3]=de,s[4]=le,s[5]=J,s[6]=he,s[7]=Me,s[8]=pe,s[9]=Te}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(1^i)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+n[0];e[0]=65535&o;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=65535&o}update(e){gd(this);const{buffer:n,blockLen:r}=this,i=(e=Nl(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0);else for(;r<=i-s;s+=r)this.process(e,s)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){gd(this),NS(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}(function(t){const e=(r,i)=>t(i).update(Nl(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e})((t=>new Rle(t)));const z5=t=>Uint8Array.from(t.split("").map((e=>e.charCodeAt(0)))),Lle=z5("expand 16-byte k"),Dle=z5("expand 32-byte k"),Ble=Mt(Lle),U5=Mt(Dle);U5.slice();function et(t,e){return t<<e|t>>>32-e}function Ww(t){return t.byteOffset%4==0}const NA=2**32-1,RA=new Uint32Array;function H5(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=(function(a,l){if(l==null||typeof l!="object")throw new Error("options must be defined");return Object.assign(a,l)})({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Vw(i),Vw(o),MA(s),MA(n),(a,l,c,u,d=0)=>{tn(a),tn(l),tn(c);const f=c.length;if(u||(u=new Uint8Array(f)),tn(u),Vw(d),d<0||d>=NA)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const h=[];let p,m,g=a.length;if(g===32)p=a.slice(),h.push(p),m=U5;else{if(g!==16||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);p=new Uint8Array(32),p.set(a),p.set(a,16),m=Ble,h.push(p)}Ww(l)||(l=l.slice(),h.push(l));const y=Mt(p);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,y,Mt(l.subarray(0,16)),y),l=l.subarray(16)}const w=16-i;if(w!==l.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(w!==12){const C=new Uint8Array(12);C.set(l,s?0:12-l.length),l=C,h.push(l)}const k=Mt(l);for(!(function(C,A,E,P,S,x,_,I){const D=S.length,B=new Uint8Array(64),F=Mt(B),R=Ww(S)&&Ww(x),O=R?Mt(S):RA,L=R?Mt(x):RA;for(let H=0;H<D;_++){if(C(A,E,P,F,_,I),_>=NA)throw new Error("arx: counter overflow");const U=Math.min(64,D-H);if(R&&U===64){const j=H/4;if(H%4!=0)throw new Error("arx: invalid block position");for(let Q,X=0;X<16;X++)Q=j+X,L[Q]=O[Q]^F[X];H+=64}else{for(let j,Q=0;Q<U;Q++)j=H+Q,x[j]=S[j]^B[Q];H+=U}}})(t,m,y,k,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function V5(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],d=e[1],f=e[2],h=e[3],p=e[4],m=e[5],g=e[6],y=e[7],w=i,k=n[0],C=n[1],A=n[2],E=o,P=a,S=l,x=c,_=u,I=d,D=f,B=h,F=p,R=m,O=g,L=y,H=w,U=k,j=C,Q=A;for(let de=0;de<s;de+=2)E=E+_|0,H=et(H^E,16),F=F+H|0,_=et(_^F,12),E=E+_|0,H=et(H^E,8),F=F+H|0,_=et(_^F,7),P=P+I|0,U=et(U^P,16),R=R+U|0,I=et(I^R,12),P=P+I|0,U=et(U^P,8),R=R+U|0,I=et(I^R,7),S=S+D|0,j=et(j^S,16),O=O+j|0,D=et(D^O,12),S=S+D|0,j=et(j^S,8),O=O+j|0,D=et(D^O,7),x=x+B|0,Q=et(Q^x,16),L=L+Q|0,B=et(B^L,12),x=x+B|0,Q=et(Q^x,8),L=L+Q|0,B=et(B^L,7),E=E+I|0,Q=et(Q^E,16),O=O+Q|0,I=et(I^O,12),E=E+I|0,Q=et(Q^E,8),O=O+Q|0,I=et(I^O,7),P=P+D|0,H=et(H^P,16),L=L+H|0,D=et(D^L,12),P=P+D|0,H=et(H^P,8),L=L+H|0,D=et(D^L,7),S=S+B|0,U=et(U^S,16),F=F+U|0,B=et(B^F,12),S=S+B|0,U=et(U^S,8),F=F+U|0,B=et(B^F,7),x=x+_|0,j=et(j^x,16),R=R+j|0,_=et(_^R,12),x=x+_|0,j=et(j^x,8),R=R+j|0,_=et(_^R,7);let X=0;r[X++]=o+E|0,r[X++]=a+P|0,r[X++]=l+S|0,r[X++]=c+x|0,r[X++]=u+_|0,r[X++]=d+I|0,r[X++]=f+D|0,r[X++]=h+B|0,r[X++]=p+F|0,r[X++]=m+R|0,r[X++]=g+O|0,r[X++]=y+L|0,r[X++]=w+H|0,r[X++]=k+U|0,r[X++]=C+j|0,r[X++]=A+Q|0}const j5=H5(V5,{counterRight:!1,counterLength:4,allowShortKeys:!1});H5(V5,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let i=t[0],s=t[1],o=t[2],a=t[3],l=e[0],c=e[1],u=e[2],d=e[3],f=e[4],h=e[5],p=e[6],m=e[7],g=n[0],y=n[1],w=n[2],k=n[3];for(let A=0;A<20;A+=2)i=i+l|0,g=et(g^i,16),f=f+g|0,l=et(l^f,12),i=i+l|0,g=et(g^i,8),f=f+g|0,l=et(l^f,7),s=s+c|0,y=et(y^s,16),h=h+y|0,c=et(c^h,12),s=s+c|0,y=et(y^s,8),h=h+y|0,c=et(c^h,7),o=o+u|0,w=et(w^o,16),p=p+w|0,u=et(u^p,12),o=o+u|0,w=et(w^o,8),p=p+w|0,u=et(u^p,7),a=a+d|0,k=et(k^a,16),m=m+k|0,d=et(d^m,12),a=a+d|0,k=et(k^a,8),m=m+k|0,d=et(d^m,7),i=i+c|0,k=et(k^i,16),p=p+k|0,c=et(c^p,12),i=i+c|0,k=et(k^i,8),p=p+k|0,c=et(c^p,7),s=s+u|0,g=et(g^s,16),m=m+g|0,u=et(u^m,12),s=s+u|0,g=et(g^s,8),m=m+g|0,u=et(u^m,7),o=o+d|0,y=et(y^o,16),f=f+y|0,d=et(d^f,12),o=o+d|0,y=et(y^o,8),f=f+y|0,d=et(d^f,7),a=a+l|0,w=et(w^a,16),h=h+w|0,l=et(l^h,12),a=a+l|0,w=et(w^a,8),h=h+w|0,l=et(l^h,7);let C=0;r[C++]=i,r[C++]=s,r[C++]=o,r[C++]=a,r[C++]=g,r[C++]=y,r[C++]=w,r[C++]=k},allowShortKeys:!1});class W5 extends v5{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,ro.hash(e);const r=wh(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return ro.exists(this),this.iHash.update(e),this}digestInto(e){ro.exists(this),ro.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ey=(t,e,n)=>new W5(t,e).update(n).digest();function $le(t,e,n){return ro.hash(t),ey(t,wh(n),wh(e))}ey.create=(t,e)=>new W5(t,e);const qw=new Uint8Array([0]),LA=new Uint8Array;function Fle(t,e,n,r=32){if(ro.hash(t),ro.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=LA);const s=new Uint8Array(i*t.outputLen),o=ey.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)qw[0]=c+1,a.update(c===0?LA:l).update(n).update(qw).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),qw.fill(0),s.slice(0,r)}var zle=Object.defineProperty,Nn=(t,e)=>{for(var n in e)zle(t,n,{get:e[n],enumerable:!0})},Ga=Symbol("verified"),Ule=t=>t instanceof Object;function ty(t){if(!Ule(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function Hle(t){return t.sort(((e,n)=>e.created_at!==n.created_at?n.created_at-e.created_at:e.id.localeCompare(n.id)))}var q5={};Nn(q5,{Queue:()=>G5,QueueNode:()=>K5,binarySearch:()=>FS,insertEventIntoAscendingList:()=>jle,insertEventIntoDescendingList:()=>Vle,normalizeURL:()=>Iu,utf8Decoder:()=>Ko,utf8Encoder:()=>_s});var Ko=new TextDecoder("utf-8"),_s=new TextEncoder;function Iu(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function Vle(t,e){const[n,r]=FS(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at));return r||t.splice(n,0,e),t}function jle(t,e){const[n,r]=FS(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at));return r||t.splice(n,0,e),t}function FS(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var K5=class{value;next=null;prev=null;constructor(t){this.value=t}},G5=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new K5(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function Z5(t){if(!ty(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Hf(t){return Zn(qc(_s.encode(Z5(t))))}var ny=new class{generateSecretKey(){return Xs.utils.randomPrivateKey()}getPublicKey(t){return Zn(Xs.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=Zn(Xs.getPublicKey(e)),n.id=Hf(n),n.sig=Zn(Xs.sign(Hf(n),e)),n[Ga]=!0,n}verifyEvent(t){if(typeof t[Ga]=="boolean")return t[Ga];const e=Hf(t);if(e!==t.id)return t[Ga]=!1,!1;try{const n=Xs.verify(t.sig,e,t.pubkey);return t[Ga]=n,n}catch{return t[Ga]=!1,!1}}},Q5=ny.generateSecretKey,zS=ny.getPublicKey,As=ny.finalizeEvent,Pd=ny.verifyEvent,X5={};function Y5(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function US(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function J5(t){return 2e4<=t&&t<3e4}function HS(t){return 3e4<=t&&t<4e4}function Wle(t){return Y5(t)?"regular":US(t)?"replaceable":J5(t)?"ephemeral":HS(t)?"parameterized":"unknown"}function qle(t,e){const n=e instanceof Array?e:[e];return ty(t)&&n.includes(t.kind)||!1}Nn(X5,{Application:()=>qce,BadgeAward:()=>Jle,BadgeDefinition:()=>Fce,BlockedRelaysList:()=>Ece,BookmarkList:()=>vce,Bookmarksets:()=>Dce,Calendar:()=>Jce,CalendarEventRSVP:()=>eue,ChannelCreation:()=>tR,ChannelHideMessage:()=>iR,ChannelMessage:()=>rR,ChannelMetadata:()=>nR,ChannelMuteUser:()=>sR,ClassifiedListing:()=>Zce,ClientAuth:()=>aR,CommunitiesList:()=>xce,CommunityDefinition:()=>rue,CommunityPostApproval:()=>cce,Contacts:()=>Qle,CreateOrUpdateProduct:()=>Hce,CreateOrUpdateStall:()=>Uce,Curationsets:()=>Bce,Date:()=>Xce,DirectMessageRelaysList:()=>Cce,DraftClassifiedListing:()=>Qce,DraftLong:()=>jce,Emojisets:()=>Wce,EncryptedDirectMessage:()=>Xle,EventDeletion:()=>Yle,FileMetadata:()=>rce,FileServerPreference:()=>Ace,Followsets:()=>Nce,GenericRepost:()=>tce,Genericlists:()=>Rce,GiftWrap:()=>oR,HTTPAuth:()=>WS,Handlerinformation:()=>nue,Handlerrecommendation:()=>tue,Highlights:()=>gce,InterestsList:()=>Tce,Interestsets:()=>zce,JobFeedback:()=>fce,JobRequest:()=>uce,JobResult:()=>dce,Label:()=>lce,LightningPubRPC:()=>Pce,LiveChatMessage:()=>ice,LiveEvent:()=>Kce,LongFormArticle:()=>Vce,Metadata:()=>Kle,Mutelist:()=>yce,NWCWalletInfo:()=>Ice,NWCWalletRequest:()=>lR,NWCWalletResponse:()=>Mce,NostrConnect:()=>Oce,OpenTimestamps:()=>nce,Pinlist:()=>bce,PrivateDirectMessage:()=>ece,ProblemTracker:()=>sce,ProfileBadges:()=>$ce,PublicChatsList:()=>Sce,Reaction:()=>jS,RecommendRelay:()=>Zle,RelayList:()=>wce,Relaysets:()=>Lce,Report:()=>oce,Reporting:()=>ace,Repost:()=>VS,Seal:()=>eR,SearchRelaysList:()=>kce,ShortTextNote:()=>Gle,Time:()=>Yce,UserEmojiList:()=>_ce,UserStatuses:()=>Gce,Zap:()=>mce,ZapGoal:()=>hce,ZapRequest:()=>pce,classifyKind:()=>Wle,isEphemeralKind:()=>J5,isKind:()=>qle,isParameterizedReplaceableKind:()=>HS,isRegularKind:()=>Y5,isReplaceableKind:()=>US});var Kle=0,Gle=1,Zle=2,Qle=3,Xle=4,Yle=5,VS=6,jS=7,Jle=8,eR=13,ece=14,tce=16,tR=40,nR=41,rR=42,iR=43,sR=44,nce=1040,oR=1059,rce=1063,ice=1311,sce=1971,oce=1984,ace=1984,lce=1985,cce=4550,uce=5999,dce=6999,fce=7e3,hce=9041,pce=9734,mce=9735,gce=9802,yce=1e4,bce=10001,wce=10002,vce=10003,xce=10004,Sce=10005,Ece=10006,kce=10007,Tce=10015,_ce=10030,Cce=10050,Ace=10096,Ice=13194,Pce=21e3,aR=22242,lR=23194,Mce=23195,Oce=24133,WS=27235,Nce=3e4,Rce=30001,Lce=30002,Dce=30003,Bce=30004,$ce=30008,Fce=30009,zce=30015,Uce=30017,Hce=30018,Vce=30023,jce=30024,Wce=30030,qce=30078,Kce=30311,Gce=30315,Zce=30402,Qce=30403,Xce=31922,Yce=31923,Jce=31924,eue=31925,tue=31989,nue=31990,rue=34550;function cR(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}function uR(t,e){for(let n=0;n<t.length;n++)if(cR(t[n],e))return!0;return!1}function iue(...t){let e={};for(let n=0;n<t.length;n++){let r=t[n];Object.entries(r).forEach((([i,s])=>{if(i==="kinds"||i==="ids"||i==="authors"||i[0]==="#"){e[i]=e[i]||[];for(let o=0;o<s.length;o++){let a=s[o];e[i].includes(a)||e[i].push(a)}}})),r.limit&&(!e.limit||r.limit>e.limit)&&(e.limit=r.limit),r.until&&(!e.until||r.until>e.until)&&(e.until=r.until),r.since&&(!e.since||r.since<e.since)&&(e.since=r.since)}return e}function sue(t){if(t.ids&&!t.ids.length||t.kinds&&!t.kinds.length||t.authors&&!t.authors.length)return 0;for(const[e,n]of Object.entries(t))if(e[0]==="#"&&Array.isArray(n)&&!n.length)return 0;return Math.min(Math.max(0,t.limit??1/0),t.ids?.length??1/0,t.authors?.length&&t.kinds?.every((e=>US(e)))?t.authors.length*t.kinds.length:1/0,t.authors?.length&&t.kinds?.every((e=>HS(e)))&&t["#d"]?.length?t.authors.length*t.kinds.length*t["#d"].length:1/0)}var dR={};function ry(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function fR(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function hR(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function oue(t,e){return e===ry(t,"id")}function aue(t,e){return e===ry(t,"pubkey")}function lue(t,e){return e===fR(t,"kind")}Nn(dR,{getHex64:()=>ry,getInt:()=>fR,getSubscriptionId:()=>hR,matchEventId:()=>oue,matchEventKind:()=>lue,matchEventPubkey:()=>aue});var pR={};function mR(t,e){return{kind:aR,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function cue(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}Nn(pR,{makeAuthEvent:()=>mR});var gR,uue=t=>(t[Ga]=!0,!0),qS=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new G5;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=Iu(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new qS(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await cue();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=hR(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=ry(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&uR(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t(mR(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new due(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},due=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{gR=WebSocket}catch{}var yR,bR=class extends qS{constructor(t){super(t,{verifyEvent:Pd,websocketImplementation:gR})}static async connect(t){const e=new bR(t);return await e.connect(),e}},fue=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=Iu(t);let n=this.relays.get(t);return n||(n=new qS(t,{verifyEvent:this.trustedRelayURLs.has(t)?uue:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(Iu).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(d,f)=>{let h=this.seenOn.get(f);h||(h=new Set,this.seenOn.set(f,h)),h.add(d)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=d=>{s[d]=!0,s.filter((f=>f)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(d,f)=>{o(d),a[d]=f,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=d=>{if(e.alreadyHaveEvent?.(d))return!0;const f=n.has(d);return n.add(d),f},u=Promise.all(Object.entries(t).map((async(d,f,h)=>{if(h.indexOf(d)!==f)return void l(f,"duplicate url");let p,[m,g]=d;m=Iu(m);try{p=await this.ensureRelay(m,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(w){return void l(f,w?.message||String(w))}let y=p.subscribe(g,{...e,oneose:()=>o(f),onclose:w=>l(f,w),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)})));return{async close(){await u,r.forEach((d=>{d.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(Iu).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{yR=WebSocket}catch{}var hue=class extends fue{constructor(){super({verifyEvent:Pd,websocketImplementation:yR})}},wR={};Nn(wR,{BECH32_REGEX:()=>vR,Bech32MaxSize:()=>KS,NostrTypeGuard:()=>pue,decode:()=>Gh,encodeBytes:()=>sy,naddrEncode:()=>vue,neventEncode:()=>wue,noteEncode:()=>yue,nprofileEncode:()=>bue,npubEncode:()=>gue,nsecEncode:()=>mue});var pue={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},KS=5e3,vR=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Gh(t){let{prefix:e,words:n}=md.decode(t,KS),r=new Uint8Array(md.fromWords(n));switch(e){case"nprofile":{let i=Kw(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Zn(i[0][0]),relays:i[1]?i[1].map((s=>Ko.decode(s))):[]}}}case"nevent":{let i=Kw(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Zn(i[0][0]),relays:i[1]?i[1].map((s=>Ko.decode(s))):[],author:i[2]?.[0]?Zn(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(Zn(i[3][0]),16):void 0}}}case"naddr":{let i=Kw(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ko.decode(i[0][0]),pubkey:Zn(i[2][0]),kind:parseInt(Zn(i[3][0]),16),relays:i[1]?i[1].map((s=>Ko.decode(s))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:Zn(r)};default:throw new Error(`unknown prefix ${e}`)}}function Kw(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function mue(t){return sy("nsec",t)}function gue(t){return sy("npub",pd(t))}function yue(t){return sy("note",pd(t))}function iy(t,e){let n=md.toWords(e);return md.encode(t,n,KS)}function sy(t,e){return iy(t,e)}function bue(t){return iy("nprofile",GS({0:[pd(t.pubkey)],1:(t.relays||[]).map((e=>_s.encode(e)))}))}function wue(t){let e;return t.kind!==void 0&&(e=(function(n){const r=new Uint8Array(4);return r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=255&n,r})(t.kind)),iy("nevent",GS({0:[pd(t.id)],1:(t.relays||[]).map((n=>_s.encode(n))),2:t.author?[pd(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function vue(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),iy("naddr",GS({0:[_s.encode(t.identifier)],1:(t.relays||[]).map((n=>_s.encode(n))),2:[pd(t.pubkey)],3:[new Uint8Array(e)]}))}function GS(t){let e=[];return Object.entries(t).reverse().forEach((([n,r])=>{r.forEach((i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)}))})),Y0(...e)}var xue=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function Sue(t){let e=[];for(let n of t.content.matchAll(xue))if(n[2])try{let{type:r,data:i}=Gh(n[1]);switch(r){case"npub":e.push({text:n[0],profile:{pubkey:i,relays:[]}});break;case"nprofile":e.push({text:n[0],profile:i});break;case"note":e.push({text:n[0],event:{id:i,relays:[]}});break;case"nevent":e.push({text:n[0],event:i});break;case"naddr":e.push({text:n[0],address:i})}}catch{}else if(n[3]){let r=parseInt(n[3],10),i=t.tags[r];if(!i)continue;switch(i[0]){case"p":e.push({text:n[0],profile:{pubkey:i[1],relays:i[2]?[i[2]]:[]}});break;case"e":e.push({text:n[0],event:{id:i[1],relays:i[2]?[i[2]]:[]}});break;case"a":try{let[s,o,a]=i[1].split(":");e.push({text:n[0],address:{identifier:a,pubkey:o,kind:parseInt(s,10),relays:i[2]?[i[2]]:[]}})}catch{}}}return e}var xR={};async function SR(t,e,n){const r=t instanceof Uint8Array?Zn(t):t,i=ER(_d.getSharedSecret(r,"02"+e));let s=Uint8Array.from(S5(16)),o=_s.encode(n),a=$5(i,s).encrypt(o);return`${Ol.encode(new Uint8Array(a))}?iv=${Ol.encode(new Uint8Array(s.buffer))}`}async function Eue(t,e,n){const r=t instanceof Uint8Array?Zn(t):t;let[i,s]=n.split("?iv="),o=ER(_d.getSharedSecret(r,"02"+e)),a=Ol.decode(s),l=Ol.decode(i),c=$5(o,a).decrypt(l);return Ko.decode(c)}function ER(t){return t.slice(1,33)}Nn(xR,{decrypt:()=>Eue,encrypt:()=>SR});var kR={};Nn(kR,{NIP05_REGEX:()=>ZS,isNip05:()=>kue,isValid:()=>Cue,queryProfile:()=>TR,searchDomain:()=>_ue,useFetchImplementation:()=>Tue});var oy,ZS=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,kue=t=>ZS.test(t||"");try{oy=fetch}catch{}function Tue(t){oy=t}async function _ue(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await oy(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function TR(t){const e=t.match(ZS);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await oy(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function Cue(t,e){const n=await TR(e);return!!n&&n.pubkey===t}var _R={};function Aue(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,d={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=d;continue}if(c==="reply"){e.reply=d;continue}if(c==="mention"){e.mentions.push(d);continue}n?r=d:n=d,e.mentions.push(d)}else{if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}s[0]==="p"&&s[1]&&e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find((a=>a.pubkey===i.author));o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach((a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)})),o.relays=i.relays)}})),e.mentions.forEach((i=>{if(i.author){let s=e.profiles.find((o=>o.pubkey===i.author));s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach((o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)})),s.relays=i.relays)}})),e}Nn(_R,{parse:()=>Aue});var CR={};Nn(CR,{fetchRelayInformation:()=>Pue,useFetchImplementation:()=>Iue});function Iue(t){}async function Pue(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var AR={};function IR(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r!==0){e+=Math.clz32(r);break}e+=32}return e}function Mue(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=PR(r),IR(r.id)>=e)break}return r}function PR(t){return Zn(qc(_s.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}Nn(AR,{fastEventHash:()=>PR,getPow:()=>IR,minePow:()=>Mue});var MR={};function Oue(t,e,n,r){return As({kind:VS,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function OR(t){if(t.kind!==VS)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0?{id:e[1],relays:[e[2],n?.[2]].filter((r=>typeof r=="string")),author:n?.[1]}:void 0}function Nue(t,{skipVerification:e}={}){const n=OR(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}return r.id===n.id&&(e||Pd(r))?r:void 0}Nn(MR,{finishRepostEvent:()=>Oue,getRepostedEvent:()=>Nue,getRepostedEventPointer:()=>OR});var NR={};Nn(NR,{NOSTR_URI_REGEX:()=>ay,parse:()=>Lue,test:()=>Rue});var ay=new RegExp(`nostr:(${vR.source})`);function Rue(t){return typeof t=="string"&&new RegExp(`^${ay.source}$`).test(t)}function Lue(t){const e=t.match(new RegExp(`^${ay.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Gh(e[1])}}var RR={};function Due(t,e,n){const r=e.tags.filter((i=>i.length>=2&&(i[0]==="e"||i[0]==="p")));return As({...t,kind:jS,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function Bue(t){if(t.kind!==jS)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0&&n!==void 0?{id:e[1],relays:[e[2],n[2]].filter((r=>r!==void 0)),author:n[1]}:void 0}Nn(RR,{finishReactionEvent:()=>Due,getReactedEventPointer:()=>Bue});var LR={};Nn(LR,{matchAll:()=>$ue,regex:()=>QS,replaceAll:()=>Fue});var QS=()=>new RegExp(`\\b${ay.source}\\b`,"g");function*$ue(t){const e=t.matchAll(QS());for(const n of e)try{const[r,i]=n;yield{uri:r,value:i,decoded:Gh(i),start:n.index,end:n.index+r.length}}catch{}}function Fue(t,e){return t.replaceAll(QS(),((n,r)=>e({uri:n,value:r,decoded:Gh(r)})))}var DR={};Nn(DR,{channelCreateEvent:()=>zue,channelHideMessageEvent:()=>Vue,channelMessageEvent:()=>Hue,channelMetadataEvent:()=>Uue,channelMuteUserEvent:()=>jue});var zue=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return As({kind:tR,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Uue=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return As({kind:nR,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Hue=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),As({kind:rR,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},Vue=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return As({kind:iR,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},jue=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return As({kind:sR,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},BR={};Nn(BR,{EMOJI_SHORTCODE_REGEX:()=>$R,matchAll:()=>Wue,regex:()=>XS,replaceAll:()=>que});var $R=/:(\w+):/,XS=()=>new RegExp(`\\B${$R.source}\\B`,"g");function*Wue(t){const e=t.matchAll(XS());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function que(t,e){return t.replaceAll(XS(),((n,r)=>e({shortcode:n,name:r})))}var YS,FR={};Nn(FR,{useFetchImplementation:()=>Kue,validateGithub:()=>Gue});try{YS=fetch}catch{}function Kue(t){YS=t}async function Gue(t,e,n){try{return await(await YS(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var zR={};Nn(zR,{decrypt:()=>nE,encrypt:()=>tE,getConversationKey:()=>JS,v2:()=>Que});var UR=1,HR=65535;function JS(t,e){const n=_d.getSharedSecret(t,"02"+e).subarray(1,33);return $le(qc,n,"nip44-v2")}function VR(t,e){const n=Fle(qc,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function eE(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function Zue(t){const e=_s.encode(t),n=e.length;return Y0((function(r){if(!Number.isSafeInteger(r)||r<UR||r>HR)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const i=new Uint8Array(2);return new DataView(i.buffer).setUint16(0,r,!1),i})(n),e,new Uint8Array(eE(n)-n))}function jR(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=Y0(n,e);return ey(qc,t,r)}function tE(t,e,n=S5(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=VR(e,n),o=Zue(t),a=j5(r,i,o),l=jR(s,a,n);return Ol.encode(Y0(new Uint8Array([2]),n,a,l))}function nE(t,e){const{nonce:n,ciphertext:r,mac:i}=(function(l){if(typeof l!="string")throw new Error("payload must be a valid string");const c=l.length;if(c<132||c>87472)throw new Error("invalid payload length: "+c);if(l[0]==="#")throw new Error("unknown encryption version");let u;try{u=Ol.decode(l)}catch(h){throw new Error("invalid base64: "+h.message)}const d=u.length;if(d<99||d>65603)throw new Error("invalid data length: "+d);const f=u[0];if(f!==2)throw new Error("unknown encryption version "+f);return{nonce:u.subarray(1,33),ciphertext:u.subarray(33,-32),mac:u.subarray(-32)}})(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=VR(e,n);if(!LS(jR(a,r,n),i))throw new Error("invalid MAC");return(function(l){const c=new DataView(l.buffer).getUint16(0),u=l.subarray(2,2+c);if(c<UR||c>HR||u.length!==c||l.length!==2+eE(c))throw new Error("invalid padding");return Ko.decode(u)})(j5(s,o,r))}var Que={utils:{getConversationKey:JS,calcPaddedLen:eE},encrypt:tE,decrypt:nE},WR={};function Xue(t){const{pathname:e,searchParams:n}=new URL(t),r=e,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function Yue(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},i=await SR(e,t,JSON.stringify(r)),s={kind:lR,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return As(s,e)}Nn(WR,{makeNwcRequestEvent:()=>Yue,parseConnectionString:()=>Xue});var rE,qR={};Nn(qR,{getZapEndpoint:()=>ede,makeZapReceipt:()=>rde,makeZapRequest:()=>tde,useFetchImplementation:()=>Jue,validateZapRequest:()=>nde});try{rE=fetch}catch{}function Jue(t){rE=t}async function ede(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=md.decode(n,1e3),a=md.fromWords(o);e=Ko.decode(a)}else{if(!r)return null;{let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}}let i=await rE(e),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function tde({profile:t,event:e,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function nde(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!ty(e))return"Zap request is not a valid Nostr event.";if(!Pd(e))return"Invalid signature on zap request.";let n=e.tags.find((([i,s])=>i==="p"&&s));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([i,s])=>i==="e"&&s));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([i,s])=>i==="relays"&&s))?null:"Zap request doesn't have a 'relays' tag."}function rde({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter((([a])=>a==="e"||a==="p"||a==="a")),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}var KR={};Nn(KR,{createRumor:()=>YR,createSeal:()=>JR,createWrap:()=>e6,unwrapEvent:()=>t6,unwrapManyEvents:()=>sde,wrapEvent:()=>Y1,wrapManyEvents:()=>ide});var GR=()=>Math.round(Date.now()/1e3),ZR=()=>Math.round(GR()-172800*Math.random()),QR=(t,e)=>JS(t,e),XR=(t,e,n)=>tE(JSON.stringify(t),QR(e,n)),DA=(t,e)=>JSON.parse(nE(t.content,QR(e,t.pubkey)));function YR(t,e){const n={created_at:GR(),content:"",tags:[],...t,pubkey:zS(e)};return n.id=Hf(n),n}function JR(t,e,n){return As({kind:eR,content:XR(t,e,n),created_at:ZR(),tags:[]},e)}function e6(t,e){const n=Q5();return As({kind:oR,content:XR(t,n,e),created_at:ZR(),tags:[["p",e]]},n)}function Y1(t,e,n){return e6(JR(YR(t,e),e,n),n)}function ide(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=zS(e),i=[Y1(t,e,r)];return n.forEach((s=>{i.push(Y1(t,e,s))})),i}function t6(t,e){const n=DA(t,e);return DA(n,e)}function sde(t,e){let n=[];return t.forEach((r=>{n.push(t6(r,e))})),n.sort(((r,i)=>r.created_at-i.created_at)),n}var n6={};Nn(n6,{getToken:()=>ode,hashPayload:()=>iE,unpackEventFromToken:()=>i6,validateEvent:()=>u6,validateEventKind:()=>o6,validateEventMethodTag:()=>l6,validateEventPayloadTag:()=>c6,validateEventTimestamp:()=>s6,validateEventUrlTag:()=>a6,validateToken:()=>ade});var r6="Nostr ";async function ode(t,e,n,r=!1,i){const s={kind:WS,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",iE(i)]);const o=await n(s);return(r?r6:"")+Ol.encode(_s.encode(JSON.stringify(o)))}async function ade(t,e,n){const r=await i6(t).catch((i=>{throw i}));return await u6(r,e,n).catch((i=>{throw i}))}async function i6(t){if(!t)throw new Error("Missing token");t=t.replace(r6,"");const e=Ko.decode(Ol.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function s6(t){return!!t.created_at&&Math.round(new Date().getTime()/1e3)-t.created_at<60}function o6(t){return t.kind===WS}function a6(t,e){const n=t.tags.find((r=>r[0]==="u"));return!!n&&n.length>0&&n[1]===e}function l6(t,e){const n=t.tags.find((r=>r[0]==="method"));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function iE(t){return Zn(qc(_s.encode(JSON.stringify(t))))}function c6(t,e){const n=t.tags.find((i=>i[0]==="payload"));if(!n)return!1;const r=iE(e);return n.length>0&&n[1]===r}async function u6(t,e,n,r){if(!Pd(t))throw new Error("Invalid nostr event, signature invalid");if(!o6(t))throw new Error("Invalid nostr event, kind invalid");if(!s6(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!a6(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!l6(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!c6(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const yt={LIBRARIES:{decodeBolt11:Yae.decode,NostrTools:U1},DEFAULT_OPTIONS:{theme:"light",colorMode:!0},BATCH_SIZE:5,REQ_CONFIG:{INITIAL_LOAD_COUNT:15,ADDITIONAL_LOAD_COUNT:20},LOAD_TIMEOUT:1e4,BUFFER_INTERVAL:500,BUFFER_MIN_INTERVAL:100,INFINITE_SCROLL:{ROOT_MARGIN:"400px",THRESHOLD:.1,DEBOUNCE_TIME:500,RETRY_DELAY:500},ZAP_CONFIG:{DEFAULT_LIMIT:1,DEFAULT_COLOR_MODE:!0,ERRORS:{DIALOG_NOT_FOUND:"Zap dialog not found",BUTTON_NOT_FOUND:"Fetch button not found",DECODE_FAILED:"Failed to decode identifier"}},ZAP_AMOUNT_CONFIG:{DEFAULT_COLOR_MODE:!0,THRESHOLDS:[{value:1e4,className:"zap-amount-10k"},{value:5e3,className:"zap-amount-5k"},{value:2e3,className:"zap-amount-2k"},{value:1e3,className:"zap-amount-1k"},{value:500,className:"zap-amount-500"},{value:200,className:"zap-amount-200"},{value:100,className:"zap-amount-100"}],DEFAULT_CLASS:"default-color",DISABLED_CLASS:""},DIALOG_CONFIG:{DEFAULT_TITLE:"To ",NO_ZAPS_MESSAGE:"No Zaps yet!<br>Send the first Zap!",DEFAULT_NO_ZAPS_DELAY:1500,ZAP_LIST:{INITIAL_BATCH:30,REMAINING_BATCH:30,PROFILE_BATCH:30,MIN_HEIGHT:"100px"}},REQUEST_CONFIG:{METADATA_TIMEOUT:2e4,REQUEST_TIMEOUT:2e3,CACHE_DURATION:3e5},PROFILE_CONFIG:{BATCH_SIZE:20,BATCH_DELAY:100,RELAYS:["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine","wss://directory.yabu.me"]},BATCH_CONFIG:{REFERENCE_PROCESSOR:{BATCH_SIZE:20,BATCH_DELAY:100},SUPPORTED_EVENT_KINDS:[1,30023,30030,30009,40,42,31990]},BATCH_PROCESSOR_CONFIG:{DEFAULT_BATCH_SIZE:20,DEFAULT_BATCH_DELAY:100,DEFAULT_MAX_CACHE_AGE:18e5,DEFAULT_RELAY_URLS:[],TIMEOUT_DURATION:500}};class vh{constructor(e,n,r=null){this.identifier=e,this.relayUrls=n,this.isColorModeEnabled=r===null?yt.ZAP_CONFIG.DEFAULT_COLOR_MODE:String(r).toLowerCase()==="true"}static determineColorMode(e){if(!e||!e.hasAttribute("data-zap-color-mode"))return yt.ZAP_CONFIG.DEFAULT_COLOR_MODE;const n=e.getAttribute("data-zap-color-mode");return n.toLowerCase()!=="true"&&n.toLowerCase()!=="false"||n.toLowerCase()==="true"}static fromButton(e){if(!e)throw new Error(yt.ZAP_CONFIG.ERRORS.BUTTON_NOT_FOUND);const n=vh.determineColorMode(e);return new vh(e.getAttribute("data-nzv-id"),e.getAttribute("data-relay-urls").split(","),n)}}class oa{constructor(e=1e3){this.cache=new Map,this.maxSize=e,this.accessOrder=new Map}set(e,n){if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const r=this.accessOrder.keys().next().value;this.cache.delete(r),this.accessOrder.delete(r)}return this.cache.set(e,n),this.accessOrder.delete(e),this.accessOrder.set(e,Date.now()),n}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.accessOrder.set(e,Date.now()),n}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}}class sE extends oa{#e=new Map;setProfile(e,n){if(!e||!n)return;const r=this.get(e);r&&r._eventCreatedAt&&n._eventCreatedAt&&!(n._eventCreatedAt>r._eventCreatedAt)||(this.set(e,n),this.#t(e,n))}#t(e,n){this.#e.forEach((r=>{try{r(e,n)}catch{}}))}subscribe(e){if(typeof e!="function")return null;const n=Math.random().toString(36).substr(2,9);return this.#e.set(n,e),()=>this.#e.delete(n)}clearSubscriptions(){this.#e.clear()}}class lde extends oa{#e=new Map;initializeView(e){this.#e.set(e,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,batchProcessing:!1})}getViewState(e){return this.#e.get(e)||this.initializeView(e)}updateViewState(e,n){const r=this.getViewState(e);return this.#e.set(e,{...r,...n}),this.#e.get(e)}getEvents(e){return this.get(e)||[]}setEvents(e,n,r=!1){const i=r?this.getEvents(e):[],s=new Map(n.map((a=>[a.id,a]))),o=[...i.filter((a=>!s.has(a.id))),...n];this.set(e,o)}addEvent(e,n){if(!n?.id)return!1;const r=this.getEvents(e);return!this.#t(r,n)&&(r.push(n),r.sort(((i,s)=>s.created_at-i.created_at)),this.setEvents(e,r,!0),!0)}#t(e,n){return e.some((r=>r.id===n.id||r.kind===n.kind&&r.pubkey===n.pubkey&&r.content===n.content&&r.created_at===n.created_at))}}class cde extends oa{#e=new Map;#t=new Map;async getOrFetch(e,n){const r=this.get(e);if(r)return r;const i=this.#e.get(e);if(i)return i;const s=n().then((o=>(o&&this.set(e,o),this.#e.delete(e),o))).catch((o=>(this.#e.delete(e),null)));return this.#e.set(e,s),s}clearPendingFetches(){this.#e.clear()}setComponent(e,n){this.#t.set(e,n)}getComponent(e){return this.#t.get(e)}clearComponents(){this.#t.clear()}clear(){super.clear(),this.clearPendingFetches(),this.clearComponents()}}class ude extends oa{#e=new Map;#t=new Map;setCached(e,n,r){const i=`${e}:${n}`;this.set(i,{stats:r,timestamp:Date.now()}),this.updateViewStats(e,r)}getCached(e,n){const r=`${e}:${n}`;return this.get(r)}updateViewStats(e,n){n&&this.#e.set(e,{...n,lastUpdate:Date.now()})}getViewStats(e){return this.#e.get(e)}clearViewStats(e){this.#e.delete(e)}setNoZapsState(e,n){this.#t.set(e,n)}hasNoZaps(e){return this.#t.get(e)||!1}clearNoZapsState(e){this.#t.delete(e)}clear(){super.clear(),this.#e.clear(),this.#t.clear()}}class dde extends oa{hasDecoded(e){return this.has(e)}setDecoded(e,n){this.set(e,n)}getDecoded(e){return this.get(e)}}class fde extends oa{initializeLoadState(e){const n={isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,currentCount:0};return this.set(e,n),n}getLoadState(e){return this.has(e)?this.get(e):this.initializeLoadState(e)}updateLoadState(e,n){const r={...this.getLoadState(e),...n};return this.set(e,r),r}canLoadMore(e){const n=this.getLoadState(e);return n&&!n.isLoading&&n.lastEventTime}updateLoadProgress(e,n){const r=this.getLoadState(e);return r.currentCount+=n,this.updateLoadState(e,{currentCount:r.currentCount}),r.currentCount}}class hde extends oa{setZapInfo(e,n){this.set(e,n)}getZapInfo(e){return this.get(e)}clearZapInfo(e){this.delete(e)}}class pde extends sE{setImage(e,n){e&&n&&this.set(e,{image:n,timestamp:Date.now()})}getImage(e){return this.get(e)?.image}hasImage(e){return this.has(e)}clearExpired(e=36e5){const n=Date.now();for(const[r,i]of this.cache.entries())n-i.timestamp>e&&this.delete(r)}}class mde extends sE{#e=new Map;setNip05(e,n){e&&this.set(e,{value:n,timestamp:Date.now(),verified:!0})}getNip05(e){return this.get(e)?.value}setPendingVerification(e,n){this.#e.set(e,n)}getPendingVerification(e){return this.#e.get(e)}deletePendingVerification(e){this.#e.delete(e)}clearPendingVerifications(){this.#e.clear()}clear(){super.clear(),this.clearPendingVerifications()}}class Vf{static#e=null;#t=null;#n={};constructor(){if(Vf.#e)return Vf.#e;this.profileCache=new sE,this.zapEventCache=new lde,this.referenceCache=new cde,this.statsCache=new ude,this.decodedCache=new dde,this.loadStateCache=new fde,this.zapInfoCache=new hde,this.imageCache=new pde,this.nip05Cache=new mde,this.nip05PendingCache=new oa,this.#n=["zapInfo","uiComponent","decoded","nip05","nip05PendingFetches","zapLoadStates","imageCache","isEventIdentifier"].reduce(((e,n)=>(e[n]=new oa,e)),{}),this.viewStats=new Map,this.viewStates=new Map,Vf.#e=this}setProfile(e,n){return this.profileCache.setProfile(e,n)}getProfile(e){return this.profileCache.get(e)}subscribeToProfileUpdates(e){return this.profileCache.subscribe(e)}initializeZapView(e){return this.zapEventCache.initializeView(e)}getZapEvents(e){return this.zapEventCache.getEvents(e)}setZapEvents(e,n,r){return this.zapEventCache.setEvents(e,n,r)}addZapEvent(e,n){return this.zapEventCache.addEvent(e,n)}getZapViewState(e){return this.zapEventCache.getViewState(e)}updateZapViewState(e,n){return this.zapEventCache.updateViewState(e,n)}setReference(e,n){return this.referenceCache.set(e,n)}getReference(e){return this.referenceCache.get(e)}getOrFetchReference(e,n){return this.referenceCache.getOrFetch(e,n)}getReferenceComponent(e){return this.referenceCache.getComponent(e)}setReferenceComponent(e,n){return this.referenceCache.setComponent(e,n)}getCachedStats(e,n){return this.statsCache.getCached(e,n)}updateStatsCache(e,n,r){this.statsCache.setCached(e,n,r),this.statsCache.updateViewStats(e,r)}getViewStats(e){return this.statsCache.getViewStats(e)}setNoZapsState(e,n){return this.statsCache.setNoZapsState(e,n)}hasNoZaps(e){return this.statsCache.hasNoZaps(e)}async processCachedData(e,n){this.setRelayUrls(n.relayUrls);const r=this.getZapEvents(e),i=r.some((s=>this.getReference(s.id)));return{stats:(await Promise.all([this.getCachedStats(e,n.identifier)]))[0],hasEnoughCachedEvents:r.length>=yt.REQ_CONFIG.INITIAL_LOAD_COUNT,hasReferences:i}}hasDecoded(e){return this.decodedCache.hasDecoded(e)}setDecoded(e,n){return this.decodedCache.setDecoded(e,n)}getDecoded(e){return this.decodedCache.getDecoded(e)}initializeLoadState(e){return this.loadStateCache.initializeLoadState(e)}getLoadState(e){return this.loadStateCache.getLoadState(e)}updateLoadState(e,n){return this.loadStateCache.updateLoadState(e,n)}canLoadMore(e){return this.loadStateCache.canLoadMore(e)}updateLoadProgress(e,n){return this.loadStateCache.updateLoadProgress(e,n)}setZapInfo(e,n){return this.zapInfoCache.setZapInfo(e,n)}getZapInfo(e){return this.zapInfoCache.getZapInfo(e)}clearZapInfo(e){return this.zapInfoCache.clearZapInfo(e)}setImageCache(e,n){return this.imageCache.setImage(e,n)}getImageCache(e){return this.imageCache.getImage(e)}hasImageCache(e){return this.imageCache.hasImage(e)}setNip05(e,n){return this.nip05Cache.setNip05(e,n)}getNip05(e){return this.nip05Cache.getNip05(e)}setNip05PendingFetch(e,n){this.nip05Cache.setPendingVerification(e,n)}getNip05PendingFetch(e){return this.nip05Cache.getPendingVerification(e)}deleteNip05PendingFetch(e){this.nip05Cache.deletePendingVerification(e)}getOrCreateViewState(e,n={}){return this.viewStates.has(e)||this.viewStates.set(e,{currentStats:null,...n}),this.viewStates.get(e)}getViewState(e){return this.getOrCreateViewState(e)}updateViewState(e,n){const r=this.getOrCreateViewState(e);return this.viewStates.set(e,{...r,...n}),this.viewStates.get(e)}setCacheItem(e,n,r){const i=this.#n[e];return i&&n!==void 0?i.set(n,r):null}getCacheItem(e,n){const r=this.#n[e];return r&&n!==void 0?r.get(n):null}setRelayUrls(e){this.#t=e}getRelayUrls(){return this.#t}clearAll(){this.profileCache.clear(),this.profileCache.clearSubscriptions(),this.zapEventCache.clear(),this.referenceCache.clear(),this.referenceCache.clearPendingFetches(),this.referenceCache.clearComponents(),this.statsCache.clear(),this.decodedCache.clear(),this.loadStateCache.clear(),this.zapInfoCache.clear(),this.imageCache.clear(),this.nip05Cache.clear(),this.nip05Cache.clearPendingVerifications(),Object.values(this.#n).forEach((e=>e.clear())),this.viewStats.clear(),this.viewStates.clear()}}const st=new Vf,BA="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDYuMzMgMjA2LjMzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICA8ZGVmcz4KICAgICAgPHN0eWxlPgogICAgICAgICAuY2xzLTEgewogICAgICAgICAgICBmaWxsOiBub25lOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTIgewogICAgICAgICAgICBmaWxsOiAjZmZmOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTMgewogICAgICAgICAgICBmaWxsOiAjNjY2OwogICAgICAgICB9CiAgICAgIDwvc3R5bGU+CiAgIDwvZGVmcz4KICAgPHBhdGggY2xhc3M9ImNscy0yIgogICAgICBkPSJtMjA2LjMzIDEzNC4zOWMwIDIwLjcxIDAgMzEuMDctMy41MyA0Mi4yMi00LjQzIDEyLjE3LTE0LjAyIDIxLjc2LTI2LjE5IDI2LjE5LTExLjE1IDMuNTMtMjEuNSAzLjUzLTQyLjIyIDMuNTNoLTYyLjQ2Yy0yMC43MSAwLTMxLjA2IDAtNDIuMjEtMy41My0xMi4xNy00LjQzLTIxLjc2LTE0LjAyLTI2LjE5LTI2LjE5LTMuNTMtMTEuMTUtMy41My0yMS41LTMuNTMtNDIuMjJ2LTYyLjQ2YzAtMjAuNzEgMC0zMS4wNyAzLjUzLTQyLjIyIDQuNDMtMTIuMTcgMTQuMDItMjEuNzYgMjYuMTktMjYuMTkgMTEuMTUtMy41MiAyMS41LTMuNTIgNDIuMjEtMy41Mmg2Mi40NmMyMC43MSAwIDMxLjA3IDAgNDIuMjIgMy41MiAxMi4xNyA0LjQzIDIxLjc2IDE0LjAyIDI2LjE5IDI2LjE5IDMuNTMgMTEuMTUgMy41MyAyMS41IDMuNTMgNDIuMjJ6IiAvPgogICA8cGF0aCBjbGFzcz0iY2xzLTMiCiAgICAgIGQ9Im0xODUuOTggOTEuMXY4My4yM2MwIDMuMTMtMi41NCA1LjY3LTUuNjcgNS42N2gtNjguMDRjLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNS41YzAuMzEtMTkgMi4zMi0zNy4yIDYuNTQtNDUuNDggMi41My00Ljk4IDYuNy03LjY5IDExLjQ5LTkuMTQgOS4wNS0yLjcyIDI0LjkzLTAuODYgMzEuNjctMS4xOCAwIDAgMjAuMzYgMC44MSAyMC4zNi0xMC43MiAwLTkuMjgtOS4xLTguNTUtOS4xLTguNTUtMTAuMDMgMC4yNi0xNy42Ny0wLjQyLTIyLjYyLTIuMzctOC4yOS0zLjI2LTguNTctOS4yNC04LjYtMTEuMjQtMC40MS0yMy4xLTM0LjQ3LTI1Ljg3LTY0LjQ4LTIwLjE0LTMyLjgxIDYuMjQgMC4zNiA1My4yNyAwLjM2IDExNi4wNXY4LjM4Yy0wLjA2IDMuMDgtMi41NSA1LjU3LTUuNjUgNS41N2gtMzMuNjljLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNDMuOTVjMC0zLjEzIDIuNTQtNS42NyA1LjY3LTUuNjdoMzEuNjdjMy4xMyAwIDUuNjcgMi41NCA1LjY3IDUuNjcgMCA0LjY1IDUuMjMgNy4yNCA5LjAxIDQuNTMgMTEuMzktOC4xNiAyNi4wMS0xMi41MSA0Mi4zNy0xMi41MSAzNi42NSAwIDY0LjM2IDIxLjM2IDY0LjM2IDY4LjY5em0tNjAuODQtMTYuODljMC02LjctNS40My0xMi4xMy0xMi4xMy0xMi4xM3MtMTIuMTMgNS40My0xMi4xMyAxMi4xMyA1LjQzIDEyLjEzIDEyLjEzIDEyLjEzIDEyLjEzLTUuNDMgMTIuMTMtMTIuMTN6IiAvPgo8L3N2Zz4=",gde=t=>typeof t=="string"&&t.length>0,yde=t=>{try{return window.NostrTools.nip19.decode(t)}catch{return null}},bde=(t,e,n)=>{const r={npub:()=>({kinds:[9735],"#p":[e]}),note:()=>({kinds:[9735],"#e":[e]}),nprofile:()=>({kinds:[9735],"#p":[e.pubkey]}),nevent:()=>({kinds:[9735],"#e":[e.id]}),naddr:()=>({kinds:[9735],"#a":[`${e.kind}:${e.pubkey}:${e.identifier}`]})}[t];if(!r)return null;const i=r();return i.limit=n?yt.REQ_CONFIG.ADDITIONAL_LOAD_COUNT:yt.REQ_CONFIG.INITIAL_LOAD_COUNT,n&&(i.until=n),{req:i}};function $A(t,e=null){const n=`${t}:${e}`;if(st.hasDecoded(n))return st.getDecoded(n);if(!gde(t))throw new Error(yt.ZAP_CONFIG.ERRORS.DECODE_FAILED);const r=yde(t);if(!r)return null;const i=bde(r.type,r.data,e);return i&&st.setDecoded(n,i),i}function d6(t){return t?.display_name||t?.name||"nameless"}async function wde(t,e){if(!t||!e)return null;try{return(await window.NostrTools.nip05.queryProfile(t))?.pubkey===e?t:null}catch{return null}}function tm(t){return new Intl.NumberFormat().format(t)}function f6(t){if(!t||typeof t!="string")return"unknown";try{return`${window.NostrTools.nip19.decode(t).type.toLowerCase()}1${t.slice(5,11)}...${t.slice(-4)}`}catch{return"unknown"}}function ju(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function vde(t){try{return window.NostrTools.nip19.npubEncode(t)}catch{return null}}function yd(t){if(!t||typeof t!="string")return!1;const e=`isEventIdentifier:${t}`,n=st.getCacheItem("isEventIdentifier",e);if(n!==void 0)return n;const r=t.startsWith("note1")||t.startsWith("nevent1")||t.startsWith("naddr1");return st.setCacheItem("isEventIdentifier",e,r),r}async function xde(t){const{pubkey:e,content:n}=(function(i){const s=i.tags.find((o=>o[0]==="description"))?.[1];if(!s)return{pubkey:null,content:""};try{const o=Sde(s);let a;try{a=JSON.parse(o)}catch{const c=o.match(/"pubkey"\s*:\s*"([^"]+)"|"content"\s*:\s*"([^"]+)"/g);if(!c)throw new Error("Invalid JSON structure");a={},c.forEach((u=>{const[d,f]=u.split(":").map((h=>h.trim().replace(/"/g,"")));a[d]=f}))}let l=null;return a.pubkey&&(l=typeof a.pubkey=="string"?a.pubkey:String(a.pubkey)),{pubkey:l,content:typeof a.content=="string"?a.content.trim():""}}catch{return{pubkey:null,content:""}}})(t),r=await(async function(i){const s=i.tags.find((o=>o[0].toLowerCase()==="bolt11"))?.[1];if(!s)return"Amount: Unknown";try{const o=window.decodeBolt11(s),a=o.sections.find((l=>l.name==="amount"))?.value;return a?`${tm(Math.floor(a/1e3))} sats`:"Amount: Unknown"}catch{return"Amount: Unknown"}})(t);return{pubkey:e,content:n,satsText:r}}function FA(t){try{return window.NostrTools.nip19.decode(t)}catch{return null}}function Sde(t){return t.replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/\\\\/g,"\\").replace(/\\(?!(["\\\/bfnrt]|u[0-9a-fA-F]{4}))/g,"").replace(/\\+(["\\/bfnrt])/g,"\\$1").replace(/\\u(?![0-9a-fA-F]{4})/g,"")}class Ede{constructor(e){this.root=e}displayStats(e){requestAnimationFrame((()=>{const n=this.root?.querySelector(".zap-stats");if(n)try{let r;r=e?e.skeleton?this.#e():e.error?this.createTimeoutStats():this.createNormalStats(e):this.createTimeoutStats(),n.innerHTML=r}catch{n.innerHTML=this.createTimeoutStats()}}))}#e(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
    `}createTimeoutStats(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number text-muted">nostr.band</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number text-muted">Stats</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number text-muted">Unavailable</span></div>
      <div class="stats-item">sats</div>
    `}createNormalStats(e){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number">${tm(e.count)}</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number">${tm(Math.floor(e.msats/1e3))}</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number">${tm(Math.floor(e.maxMsats/1e3))}</span></div>
      <div class="stats-item">sats</div>
    `}}class oE{constructor(e={}){this._validateOptions(e),this._initializeProperties(e)}_validateOptions(e){if(!e.pool?.ensureRelay)throw new Error("Invalid pool object: ensureRelay method is required")}_initializeProperties(e){this.pool=e.pool,this.batchSize=e.batchSize||yt.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_SIZE,this.batchDelay=e.batchDelay||yt.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_DELAY,this.relayUrls=e.relayUrls||yt.BATCH_PROCESSOR_CONFIG.DEFAULT_RELAY_URLS,this.batchQueue=new Set,this.pendingFetches=new Map,this.resolvers=new Map,this.processingItems=new Set,this.batchTimer=null,this.eventCache=new Map,this.maxCacheAge=e.maxCacheAge||yt.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}getOrCreateFetchPromise(e){if(this.pendingFetches.has(e))return this.pendingFetches.get(e);const n=new Promise((r=>{this.resolvers.set(e,r)}));return this.pendingFetches.set(e,n),this.batchQueue.add(e),this._scheduleBatchProcess(),n}_scheduleBatchProcess(){this.batchTimer||(this.batchTimer=setTimeout((()=>{this.batchTimer=null,this._processBatchQueue()}),this.batchDelay))}async _processBatchQueue(){if(this.batchQueue.size===0)return;const e=this._getBatchItems();await this._processBatch(e),this.batchQueue.size>0&&this._scheduleBatchProcess()}_getBatchItems(){const e=Array.from(this.batchQueue).slice(0,this.batchSize);return e.forEach((n=>{this.batchQueue.delete(n),this.processingItems.add(n)})),e}async _processBatch(e){try{await this.onBatchProcess(e)}catch(n){this._handleBatchError(e,n)}finally{this._cleanupBatchItems(e)}}_handleBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanupBatchItems(e){e.forEach((n=>{this.processingItems.delete(n),this.pendingFetches.delete(n),this.resolvers.delete(n)}))}resolveItem(e,n){const r=this.resolvers.get(e);r&&(r(n),this.resolvers.delete(e))}async onBatchProcess(e){throw new Error("onBatchProcess must be implemented by derived class")}onBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanup(e,n,r,i){clearTimeout(e),n&&n.close(),r.forEach((s=>{!i.has(s)&&this.resolvers.has(s)&&this.resolveItem(s,null)}))}_getSubscriptionPool(){return this.pool}async _createSubscriptionPromise(e,n,r,i){if(n?.length)return new Promise((s=>{const o=new Set,a=yt.BATCH_PROCESSOR_CONFIG.TIMEOUT_DURATION;let l,c,u=!1;const d=()=>{u||(u=!0,l&&clearTimeout(l),c&&c.close(),e.forEach((f=>{o.has(f)||this.resolveItem(f,null)})),s())};c=this.pool.subscribeMany(n,r,{onevent:f=>{try{u||(i(f,o),o.size===e.length&&d())}catch{}},oneose:()=>{setTimeout(d,100)},onerror:f=>{}}),l=setTimeout((()=>{u||d()}),a)}));e.forEach((s=>this.resolveItem(s,null)))}setRelayUrls(e){this.relayUrls=Array.isArray(e)?e:[]}getCachedItem(e){const n=this.eventCache.get(e);return this._isValidCache(n)?n.event:(this.eventCache.delete(e),null)}_isValidCache(e){return!!e&&Date.now()-e.timestamp<=this.maxCacheAge}setCachedItem(e,n){this.eventCache.set(e,{event:n,timestamp:Date.now()})}}class kde extends oE{constructor(e={}){super(e)}async onBatchProcess(e){if(!e?.length)return;const n=[{ids:e.slice(0,this.batchSize)}];await this._createSubscriptionPromise(e,this.relayUrls,n,((r,i)=>{if(e.includes(r.id)){const s=this.getCachedItem(r.id);(!s||r.created_at>s.created_at)&&(this.setCachedItem(r.id,r),this.resolveItem(r.id,r),i.add(r.id))}}))}}class Tde extends oE{constructor(e={}){super(e)}_parseAtagValue(e){const n=e.split(":");return n.length!==3?null:{kind:parseInt(n[0]),pubkey:n[1],identifier:n[2]}}async onBatchProcess(e){if(!e?.length)return;const n=[],r={kinds:[],authors:[],"#d":[]};if(e.slice(0,this.batchSize).forEach((s=>{const o=this._parseAtagValue(s);o?(r.kinds.push(o.kind),r.authors.push(o.pubkey),r["#d"].push(o.identifier),n.push(s)):this.resolveItem(s,null)})),n.length===0)return;const i=[r];await this._createSubscriptionPromise(n,this.relayUrls,i,((s,o)=>{const a=n.find((l=>{const c=this._parseAtagValue(l);return c&&s.kind===c.kind&&s.pubkey===c.pubkey&&s.tags.some((u=>u[0]==="d"&&u[1]===c.identifier))}));if(a){const l=this.getCachedItem(a);(!l||s.created_at>l.created_at)&&(this.setCachedItem(a,s),this.resolveItem(a,s),o.add(a))}}))}}class _de extends oE{constructor(e={}){const{simplePool:n,config:r}=e;super({pool:n,batchSize:r.BATCH_SIZE||yt.PROFILE_CONFIG.BATCH_SIZE,batchDelay:r.BATCH_DELAY||yt.PROFILE_CONFIG.BATCH_DELAY,relayUrls:r.RELAYS||yt.PROFILE_CONFIG.RELAYS,maxCacheAge:yt.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}),this.config=r}async onBatchProcess(e){if(!this.config.RELAYS?.length)throw new Error("No relays configured for profile fetch");const n=e.filter((o=>{const a=this.getCachedItem(o);return!a||(this.resolveItem(o,a),!1)}));if(n.length===0)return;const r=[{kinds:[0],authors:n}],i=new Map,s=(o,a)=>{const l=i.get(o.pubkey);(!l||o.created_at>l.created_at)&&(i.set(o.pubkey,o),this.setCachedItem(o.pubkey,o)),a.add(o.pubkey)};try{await this._createSubscriptionPromise(n,this.config.RELAYS,r,s),n.forEach((o=>{const a=i.get(o);this.resolveItem(o,a||null)}))}catch(o){this.onBatchError(e,o)}}}var Xl=Symbol("verified");function Cde(t){if(!(t instanceof Object)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var Ade=new TextEncoder;function wf(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}var Ide=class{value;next=null;prev=null;constructor(t){this.value=t}},Pde=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new Ide(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function Gw(t){return Zn(qc(Ade.encode((function(e){if(!Cde(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])})(t))))}var Lp=new class{generateSecretKey(){return Xs.utils.randomPrivateKey()}getPublicKey(t){return Zn(Xs.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=Zn(Xs.getPublicKey(e)),n.id=Gw(n),n.sig=Zn(Xs.sign(Gw(n),e)),n[Xl]=!0,n}verifyEvent(t){if(typeof t[Xl]=="boolean")return t[Xl];const e=Gw(t);if(e!==t.id)return t[Xl]=!1,!1;try{const n=Xs.verify(t.sig,e,t.pubkey);return t[Xl]=n,n}catch{return t[Xl]=!1,!1}}},Mde=(Lp.generateSecretKey,Lp.getPublicKey,Lp.finalizeEvent,Lp.verifyEvent);function Ode(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}async function Nde(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}var h6,Rde=t=>(t[Xl]=!0,!0),p6=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Pde;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=wf(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new p6(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Nde();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=(function(n){let r=n.slice(0,22).indexOf('"EVENT"');if(r===-1)return null;let i=n.slice(r+7+1).indexOf('"');if(i===-1)return null;let s=r+7+1+i,o=n.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return n.slice(s+1,a)})(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=(function(s,o){let a=o.length+3,l=s.indexOf(`"${o}":`)+a,c=s.slice(l).indexOf('"')+l+1;return s.slice(c,c+64)})(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&(function(s,o){for(let a=0;a<s.length;a++)if(Ode(s[a],o))return!0;return!1})(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t((function(r,i){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",i]],content:""}})(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new Lde(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},Lde=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}},Dde=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=wf(t);let n=this.relays.get(t);return n||(n=new p6(t,{verifyEvent:this.trustedRelayURLs.has(t)?Rde:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(wf).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(d,f)=>{let h=this.seenOn.get(f);h||(h=new Set,this.seenOn.set(f,h)),h.add(d)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=d=>{s[d]=!0,s.filter((f=>f)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(d,f)=>{o(d),a[d]=f,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=d=>{if(e.alreadyHaveEvent?.(d))return!0;const f=n.has(d);return n.add(d),f},u=Promise.all(Object.entries(t).map((async(d,f,h)=>{if(h.indexOf(d)!==f)return void l(f,"duplicate url");let p,[m,g]=d;m=wf(m);try{p=await this.ensureRelay(m,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(w){return void l(f,w?.message||String(w))}let y=p.subscribe(g,{...e,oneose:()=>o(f),onclose:w=>l(f,w),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)})));return{async close(){await u,r.forEach((d=>{d.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(wf).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{h6=WebSocket}catch{}var m6=class extends Dde{constructor(){super({verifyEvent:Mde,websocketImplementation:h6})}};class jf{static instance=null;#e;#t;#n=!0;#s;constructor(){return jf.instance?jf.instance:(this.#r(),jf.instance=this,this)}#r(){if(this.#e=yt.PROFILE_CONFIG,this.#t=new m6,!this.#t?.ensureRelay)throw new Error("Failed to initialize SimplePool");this.#s=new _de({simplePool:this.#t,config:{...this.#e,RELAYS:this.#e.RELAYS||[]}})}get isInitialized(){return this.#n}async fetchProfiles(e){if(!Array.isArray(e)||e.length===0)return[];const n=Date.now(),r=new Array(e.length),i=e.reduce(((s,o,a)=>{const l=st.getProfile(o);return this.#o(l,n)?r[a]=l:s.push({index:a,pubkey:o}),s}),[]);return i.length>0&&await this.#a(i,r,e),r}async processBatchProfiles(e){const n=this.#i(e);if(n.length!==0)try{await Promise.all([this.fetchProfiles(n),...n.map((r=>this.verifyNip05Async(r)))])}catch{}}async verifyNip05Async(e){const n=st.getNip05(e);if(n!==void 0)return n;const r=st.getNip05PendingFetch(e);if(r)return r;const i=this.#u(e);return st.setNip05PendingFetch(e,i),i}getNip05(e){return st.getNip05(e)}clearCache(){st.clearAll(),this.#s.clearPendingFetches()}#o(e,n){return e&&e._lastUpdated&&n-e._lastUpdated<18e5}#i(e){return[...new Set(e?.map((n=>n?.pubkey))?.filter((n=>n&&typeof n=="string"&&n.length===64)))]}async#a(e,n,r){if(!e.length)return;const i=Date.now(),s=e.filter((({pubkey:a})=>a&&typeof a=="string"&&a.length===64));if(s.length===0)return;const o=await Promise.all(s.map((({pubkey:a})=>this.#l(a,i))));s.forEach((({index:a},l)=>{a>=0&&a<n.length&&(n[a]=o[l],r[a]&&st.setProfile(r[a],o[l]))}))}async#l(e,n){if(!e||typeof e!="string"||e.length!==64)return this.#c();try{const r={kinds:[0],authors:[e],limit:1},i=await this.#s.getOrCreateFetchPromise(e,r);if(!i?.content)return this.#c();let s;try{s=JSON.parse(i.content)}catch{return this.#c()}return{...s,name:d6(s)||"nameless",_lastUpdated:n,_eventCreatedAt:i.created_at}}catch{return this.#c()}}async#u(e){try{const[n]=await this.fetchProfiles([e]);if(!n?.nip05)return st.setNip05(e,null),null;const r=await Promise.race([wde(n.nip05,e),new Promise(((s,o)=>setTimeout((()=>o(new Error("NIP-05 timeout"))),5e3)))]);if(!r)return st.setNip05(e,null),null;const i=ju(r.startsWith("_@")?r.slice(1):r);return st.setNip05(e,i),i}catch{return st.setNip05(e,null),null}finally{st.deleteNip05PendingFetch(e)}}#c(){return{name:"anonymous",display_name:"anonymous"}}}const xh=new jf;class Bde{async loadAndUpdate(e,n){if(e)try{const r=n.querySelector(".sender-name"),i=n.querySelector(".zap-placeholder-name"),s=n.querySelector(".sender-icon"),o=s?.querySelector(".zap-placeholder-icon"),a=n.querySelector(".sender-pubkey");let l=st.getProfile(e);const c=l?d6(l)||"nameless":"anonymous",u=l?.picture?(function(d){if(!d||typeof d!="string")return null;try{const f=new URL(d);return["http:","https:"].includes(f.protocol)?f.href:null}catch{return null}})(l.picture):null;this.#e(i,r,c),this.#n(o,s,u,c),this.#s(a,e)}catch{this.#r(n)}}#e(e,n,r){e?e.replaceWith(Object.assign(document.createElement("span"),{className:"sender-name",textContent:r})):n&&(n.textContent=r)}#t(e,n="anonymous user's icon"){const r=`https://robohash.org/${e}.png?set=set5&bgset=bg2&size=128x128`,i=st.getImageCache(r),s=Object.assign(document.createElement("img"),{alt:n,loading:"lazy",className:"profile-icon"});if(i)return s.src=r,s;const o=new Image;return o.onerror=()=>{s.src=BA,st.setImageCache(r,BA)},o.onload=()=>{st.setImageCache(r,o)},o.src=r,s.src=r,s}#n(e,n,r,i){if(e&&n){const s=o=>{e.remove();const a=n.querySelector("img"),l=n.querySelector("a");a&&a.remove(),l&&l.remove();const c=o==="robohash"?this.#t(n.closest("[data-pubkey]")?.dataset.pubkey,`${ju(i)}'s icon`):Object.assign(document.createElement("img"),{src:o,alt:`${ju(i)}'s icon`,loading:"lazy",className:"profile-icon"}),u=n.closest("[data-pubkey]")?.dataset.pubkey;if(u){const d=(function(h,p=[]){try{return window.NostrTools.nip19.nprofileEncode({pubkey:h,relays:p})}catch{return null}})(u),f=Object.assign(document.createElement("a"),{href:`https://njump.me/${d}`,target:"_blank",rel:"noopener noreferrer"});f.appendChild(c),n.appendChild(f)}else n.appendChild(c)};if(r){const o=new Image;o.onload=()=>{st.setImageCache(r,o),s(r)},o.onerror=()=>{s("robohash")},o.src=r}else s("robohash")}}#s(e,n){if(e&&!e.getAttribute("data-nip05-updated")){const r=xh.getNip05(n);r?(e.textContent=r,e.setAttribute("data-nip05-updated","true")):xh.verifyNip05Async(n).then((i=>{i&&(e.textContent=i,e.setAttribute("data-nip05-updated","true"))}))}}#r(e){const n=e.querySelector(".zap-placeholder-icon");if(n){const r=n.parentElement,i=e.closest("[data-pubkey]")?.dataset.pubkey;n.remove(),r.appendChild(this.#t(i))}}async updateProfileElement(e,n){if(!e||!n)return;const r=e.querySelector(".sender-icon img, .zap-placeholder-icon");if(r)if(n.picture){const s=document.createElement("img");s.alt=n.name||"Profile Picture",s.width=32,s.height=32,s.className="profile-icon",s.onerror=()=>{const o=e.getAttribute("data-pubkey");if(o){const a=this.#t(o,n.name||"anonymous user");s.parentElement&&s.parentElement.replaceChild(a,s)}},s.src=n.picture,r.parentElement&&r.parentElement.replaceChild(s,r)}else{const s=e.getAttribute("data-pubkey");if(s){const o=this.#t(s,n.name||"anonymous user");r.parentElement&&r.parentElement.replaceChild(o,r)}}const i=e.querySelector(".sender-name, .zap-placeholder-name");if(i&&(i.textContent=n.display_name||n.name||"anonymous",i.className="sender-name"),n.nip05){const s=e.getAttribute("data-pubkey");if(s){const o=e.querySelector('[data-nip05-target="true"]');o&&await this.updateNip05Display(s,o)}}}}class fi{static#e={1:"content",30023:"title",30030:"title",30009:"name",40:"content",42:"name",31990:"alt"};static#t={UI_COMPONENTS:"Failed to create UI components:",ZAP_ITEM:"Failed to create zap item HTML:",REFERENCE:"Reference component creation failed:"};static createUIComponents(e,n,r){try{const i=this.viewConfigs?.get(n),s=r||i?.identifier,o=yd(s)?null:this.#a(e);return{iconComponent:this.#n(),nameComponent:this.#u(e),pubkeyComponent:this.#c(e,s),referenceComponent:this.#d(o)}}catch{return this.#s()}}static#n(){return'<div class="zap-placeholder-icon skeleton"></div>'}static#s(){return{iconComponent:'<div class="zap-placeholder-icon skeleton"></div>',nameComponent:'<div class="zap-placeholder-name skeleton"></div>',pubkeyComponent:"",referenceComponent:""}}static createReferenceComponent(e){return this.#d(this.#a({reference:e}))}static addReferenceToElement(e,n){if(!this.#r(e,n))return;const r=e.querySelector(".zap-content");this.#o(r,n)}static#r(e,n){return e&&n&&e.querySelector(".zap-content")}static#o(e,n){e.querySelectorAll(".zap-reference").forEach((i=>i.remove()));const r=this.createReferenceComponent({reference:n});e.insertAdjacentHTML("beforeend",r)}static getDialogTemplate(){return`
      <dialog class="dialog">
        <h2 class="dialog-title"><a href="#" target="_blank"></a></h2>
        <button class="close-dialog-button">X</button>
        <div class="zap-stats"></div>
        <ul class="dialog-zap-list"></ul>
      </dialog>
    `}static createZapItemHTML(e,n,r,i){try{const s=this.createUIComponents(e,r,i);return this.#i(e,n,s)}catch{return""}}static createNoZapsMessageHTML(e){return`
      <div class="no-zaps-container">
        <div class="no-zaps-message">${e}</div>
      </div>
    `}static#i(e,n,r){const[i,s]=e.satsText.split(" "),o=(a=e.created_at,Math.floor(Date.now()/1e3)-a<86400);var a;return`
      <div class="zap-content">
        <div class="zap-sender${e.comment?" with-comment":""}" data-pubkey="${e.pubkey}">
          <div class="sender-icon${o?" is-new":""}">
            ${r.iconComponent}
          </div>
          <div class="sender-info">
            ${r.nameComponent}
            ${r.pubkeyComponent}
          </div>
          <div class="zap-amount ${n}"><span class="number">${i}</span> ${s}</div>
        </div>
        ${e.comment?`<div class="zap-details"><span class="zap-comment">${ju(e.comment)}</span></div>`:""}
        ${r.referenceComponent}
      </div>
    `}static#a(e){if(!e)return null;if(this.#l(e))return e;if(e.reference&&typeof e.reference=="object"){if(e.reference.reference&&this.#l(e.reference.reference))return e.reference.reference;if(this.#l(e.reference))return e.reference}return null}static#l(e){return e&&typeof e=="object"&&"id"in e&&"tags"in e&&Array.isArray(e.tags)&&"content"in e&&"kind"in e}static#u({senderName:e}){return e?`<span class="sender-name">${ju(e)}</span>`:'<div class="zap-placeholder-name skeleton"></div>'}static#c({pubkey:e,displayIdentifier:n,reference:r},i){const s=!yd(i),o=`class="sender-pubkey" data-pubkey="${e}"`;return r&&s?`<span ${o}>${n}</span>`:`<span ${o} data-nip05-target="true">${n}</span>`}static#d(e){if(!this.#l(e))return"";const n=e.id,r=st.getReferenceComponent(n);if(r)return r;try{const i=this.#g(e),s=this.#h(e),o=this.#p(i,s);return st.setReferenceComponent(n,o),o}catch{return""}}static#g(e){if(!e?.tags)return"";if(e.kind===31990)return this.#f(e)||"";const n=Array.isArray(e.tags)?e.tags.find((r=>Array.isArray(r)&&r[0]==="d")):null;return n?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.naddrEncode({kind:r,pubkey:i,identifier:s,relays:o})}catch{return null}})(e.kind,e.pubkey,n[1])}`:e.id?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.neventEncode({id:r,kind:i,pubkey:s,relays:o})}catch{return null}})(e.id,e.kind,e.pubkey)}`:""}static#f(e){const n=e.tags.filter((i=>i[0]==="r"));return(n.find((i=>!i.includes("source")))||n[0])?.[1]}static#h(e){if(!e)return"";const n=fi.#e[e.kind];if(n){const r=e.tags.find((i=>Array.isArray(i)&&i[0]===n));if(r&&r[1])return r[1]}if(e.kind===40)try{return JSON.parse(e.content).name||e.content}catch{}return e.content||""}static#p(e,n){return`
      <div class="zap-reference">
        <div class="reference-arrow">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aCBkPSJtNTYwLTEyMC01Ny01NyAxNDQtMTQzSDIwMHYtNDgwaDgwdjQwMGgzNjdMNTAzLTU0NGw1Ni01NyAyNDEgMjQxLTI0MCAyNDBaIiAvPg0KPC9zdmc+" alt="Reference" width="18" height="18" />
        </div>
        <div class="reference-text">${ju(n)}</div>
        <a href="${e}" target="_blank" class="reference-link">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aA0KICAgICAgICBkPSJNNDQwLTI4MEgyODBxLTgzIDAtMTQxLjUtNTguNVQ4MC00ODBxMC04MyA1OC41LTE0MS41VDI4MC02ODBoMTYwdjgwSDI4MHEtNTAgMC04NSAzNXQtMzUgODVxMCA1MCAzNSA4NXQ4NSAzNWgxNjB2ODBaTTMyMC00NDB2LTgwaDMyMHY4MEgzMjBabTIwMCAxNjB2LTgwaDE2MHE1MCAwIDg1LTM1dDM1LTg1cTAtNTAtMzUtODV0LTg1LTM1SDUyMHYtODBoMTYwcTgzIDAgMTQxLjUgNTguNVQ4ODAtNDgwcTAgODMtNTguNSAxNDEuNVQ2ODAtMjgwSDUyMFoiIC8+DQo8L3N2Zz4=" alt="Quick Reference" width="16" height="16" />
        </a>
      </div>
    `}static ZapInfo=class{#m;constructor(e){this.#m=e}static async createFromEvent(e,n={}){return await new fi.ZapInfo(e).extractInfo(n)}static getAmountColorClass(e,n){return(n===void 0?yt.ZAP_AMOUNT_CONFIG.DEFAULT_COLOR_MODE:n)?this.#y(e):yt.ZAP_AMOUNT_CONFIG.DISABLED_CLASS}static#y(e){const{THRESHOLDS:n,DEFAULT_CLASS:r}=yt.ZAP_AMOUNT_CONFIG;return n.find((i=>e>=i.value))?.className||r}async extractInfo(e={}){const n=this.#m.id,r=st.getZapInfo(n);if(r)return r.colorClass=fi.ZapInfo.getAmountColorClass(r.satsAmount,e.isColorModeEnabled),r;try{const{pubkey:s,content:o,satsText:a}=await xde(this.#m),l=parseInt(a.replace(/,/g,"").split(" ")[0],10),c=typeof s=="string"?s:null,u=this.#m.reference||null,d={satsText:a,satsAmount:l,comment:o||"",pubkey:c||"",created_at:this.#m.created_at,displayIdentifier:c?f6(vde(c)):"anonymous",senderName:null,senderIcon:null,reference:u,colorClass:fi.ZapInfo.getAmountColorClass(l,e?.isColorModeEnabled)};return st.setZapInfo(n,d),d}catch{const o={satsText:"Amount: Unknown",satsAmount:0,comment:"",pubkey:"",created_at:this.#m.created_at,displayIdentifier:"anonymous",senderName:"anonymous",senderIcon:i,reference:null};return st.setZapInfo(n,o),o}var i}static async batchExtractInfo(e,n=!0){const r=new Map;return await Promise.all(e.map((async i=>{const s=new fi.ZapInfo(i),o=await s.extractInfo({isColorModeEnabled:n});r.set(i.id,o)}))),r}};static viewConfigs=new Map}class $de{constructor(e,n){this.viewId=e,this.config=n}async createListItem(e){const n=await fi.ZapInfo.createFromEvent(e,{isColorModeEnabled:this.config?.isColorModeEnabled}),r=document.createElement("li");return r.className=`zap-list-item ${n.colorClass}${n.comment?" with-comment":""}`,r.setAttribute("data-pubkey",n.pubkey),e?.id&&r.setAttribute("data-event-id",e.id),r.innerHTML=fi.createZapItemHTML(n,n.colorClass,this.viewId),r.setAttribute("data-timestamp",e.created_at.toString()),{li:r,zapInfo:n}}}class Fde{constructor(e,n,r,i){if(!e)throw new Error("shadowRoot is required");if(!i)throw new Error("config is required");this.shadowRoot=e,this.profileUI=n,this.viewId=r,this.config=i,this.itemBuilder=new $de(r,this.config),this.profileUpdateUnsubscribe=null,this.#g()}destroy(){this.profileUpdateUnsubscribe&&(this.profileUpdateUnsubscribe(),this.profileUpdateUnsubscribe=null);const e=this.#e(".dialog-zap-list");e&&(e.innerHTML="")}#e(e){return this.shadowRoot.querySelector(e)}getElementByEventId(e){return this.#e(`.zap-list-item[data-event-id="${e}"]`)}async#t(e){const n=this.#e(".dialog-zap-list");if(n)try{return this.#s(n),await e(n)}catch{n.children.length===0&&this.showNoZapsMessage()}}#n(e,n){const r=e.querySelector(".load-more-trigger");r&&r.remove(),Array.from(n.children).forEach((i=>{const s=i.getAttribute("data-event-id"),o=parseInt(i.getAttribute("data-timestamp"));let a=null;const l=Array.from(e.children);for(let c=0;c<l.length;c++)if(o>parseInt(l[c].getAttribute("data-timestamp"))){a=l[c];break}e.querySelector(`.zap-list-item[data-event-id="${s}"]`)||(a?e.insertBefore(i,a):e.appendChild(i))})),r&&e.appendChild(r)}#s(e){const n=e.querySelector(".no-zaps-message");n&&n.remove()}async#r(e,n){return this.#t((async r=>{const{li:i,zapInfo:s}=await this.itemBuilder.createListItem(e);return n(r,i),await this.#p(s.pubkey,i),{li:i,zapInfo:s}}))}async renderZapListFromCache(e){if(!e?.length)return st.setNoZapsState(this.viewId,!1),this.showNoZapsMessage();await this.#t((async n=>{const{initialBatch:r,remainingBatch:i}=this.#o(e),{fragment:s,profileUpdates:o}=await this.#i(r);this.#n(n,s),i.length>0?this.#a(i,n,o):await this.#h(o)}))}#o(e){const n=this.#y(e),r=yt.DIALOG_CONFIG.ZAP_LIST.INITIAL_BATCH;return{initialBatch:n.slice(0,r),remainingBatch:n.slice(r)}}async#i(e){const n=document.createDocumentFragment(),r=[];for(const i of e){const{li:s,zapInfo:o}=await this.itemBuilder.createListItem(i);this.#b(i.id,s),n.appendChild(s),o.pubkey&&r.push({pubkey:o.pubkey,element:s})}return{fragment:n,profileUpdates:r}}#a(e,n,r){if(!e.length)return;const i=yt.DIALOG_CONFIG.ZAP_LIST.REMAINING_BATCH;let s=0;const o=async()=>{if(s>=e.length)return void await this.#h(r);const a=e.slice(s,s+i);await this.#l(a,n,r),s+=i,setTimeout((()=>o()),0)};requestIdleCallback((()=>o()))}async#l(e,n,r){const i=document.createDocumentFragment();await Promise.all(e.map((async o=>{const{li:a,zapInfo:l}=await this.itemBuilder.createListItem(o);this.#b(o.id,a),i.appendChild(a),l.pubkey&&r.push({pubkey:l.pubkey,element:a})})));const s=n.querySelector(".load-more-trigger");s&&s.remove(),n.appendChild(i),s&&n.appendChild(s),await new Promise((o=>requestAnimationFrame(o)))}async prependZap(e){return this.#r(e,((n,r)=>n.prepend(r)))}async appendZap(e){return this.#r(e,((n,r)=>{const i=this.#d(n,e.created_at);i?n.insertBefore(r,i):n.appendChild(r)}))}async replacePlaceholderWithZap(e,n){const r=this.#e(`[data-index="${n}"]`);if(this.#w(r))try{const{zapInfo:i}=await this.itemBuilder.createListItem(e);this.#v(r,i,e.id),await this.#p(i.pubkey,r)}catch{r.remove()}}async showNoZapsMessage(){const e=this.#e(".dialog-zap-list");if(e){if(st.hasNoZaps(this.viewId))return void this.#c(e);await this.#u()||(this.#c(e),st.setNoZapsState(this.viewId,!0))}}async#u(){const e=this.config.noZapsDelay||yt.DIALOG_CONFIG.DEFAULT_NO_ZAPS_DELAY;await new Promise((r=>setTimeout(r,e)));const n=st.getZapEvents(this.viewId);return!!n?.length&&(await this.renderZapListFromCache(n),!0)}#c(e){const n=this.config.noZapsMessage||yt.DIALOG_CONFIG.NO_ZAPS_MESSAGE;e.innerHTML=fi.createNoZapsMessageHTML(n),e.style.minHeight=yt.DIALOG_CONFIG.ZAP_LIST.MIN_HEIGHT}async batchUpdate(e,n={}){const r=this.#e(".dialog-zap-list");if(r)try{const i=new Map(Array.from(r.querySelectorAll(".zap-list-item")).map((c=>[c.getAttribute("data-event-id"),c]))),s=this.#y(e),o=yd(this.config.identifier),a=s.filter((c=>{const u=i.get(c.id);return o?!u:!u||c.reference&&!u.querySelector(".zap-reference")}));if(a.length===0&&!n.isFullUpdate)return;const l=document.createDocumentFragment();for(const c of a){const{li:u,zapInfo:d}=await this.itemBuilder.createListItem(c);!o&&c.reference&&this.updateZapReference(c),l.appendChild(u),d.pubkey&&await this.#p(d.pubkey,u)}this.#n(r,l)}catch{}}#d(e,n){return Array.from(e.children).find((r=>{const i=parseInt(r.getAttribute("data-timestamp")||"0");return n>i}))}updateZapReference(e){if(e?.id&&e?.reference)try{const n=this.getElementByEventId(e.id);if(!n)return;fi.addReferenceToElement(n,e.reference),st.setReference(e.id,e.reference)}catch{}}#g(){this.profileUpdateUnsubscribe=st.subscribeToProfileUpdates(this.#f.bind(this))}async#f(e,n){const r=this.shadowRoot.querySelectorAll(`[data-pubkey="${e}"]`);await Promise.allSettled(Array.from(r).map((i=>this.profileUI.updateProfileElement(i,n))))}async#h(e){const n=yt.DIALOG_CONFIG.ZAP_LIST.PROFILE_BATCH;for(let r=0;r<e.length;r+=n){const i=e.slice(r,r+n);await Promise.all(i.map((({pubkey:s,element:o})=>this.#p(s,o)))),await new Promise((s=>requestAnimationFrame(s)))}}async#p(e,n){e&&await this.#m(e,n)}async#m(e,n){if(e&&n)try{await this.profileUI.loadAndUpdate(e,n)}catch{}}#y(e){return[...new Map(e.map((n=>[n.id,n]))).values()].sort(((n,r)=>r.created_at-n.created_at))}#b(e,n){if(yd(this.config.identifier))return;const r=st.getReference(e);r&&fi.addReferenceToElement(n,r)}#w(e){return e&&e.classList.contains("placeholder")}#v(e,n,r){const i=this.itemBuilder.getAmountColorClass(n.satsAmount);e.className=`zap-list-item ${i}${n.comment?" with-comment":""}`,e.setAttribute("data-pubkey",n.pubkey),e.setAttribute("data-event-id",r),e.innerHTML=fi.createZapItemHTML(n,i,this.viewId),e.removeAttribute("data-index")}}var zde=Dr(0),Ude=Dr.n(zde);const Sh=new class{#e=new Map;#t=new Map;constructor(){}async getZapStats(t,e){const n=await this.#n(e,t);if(n)return n;const r=await this.fetchStats(t);return r&&st.updateStatsCache(e,t,r),r}async fetchStats(t){try{const e=await this._fetchFromApi(t);return this._formatStats(e)||this.createTimeoutError()}catch(e){return this.handleFetchError(e)}}createTimeoutError(){return{error:!0,timeout:!0}}handleFetchError(t){return{error:!0,timeout:t.message==="STATS_TIMEOUT"}}async _fetchFromApi(t){const e=FA(t);if(!e)return null;const n=`https://api.nostr.band/v0/stats/${e.type==="npub"||e.type==="nprofile"?"profile":"event"}/${t}`,r=new AbortController,i=setTimeout((()=>r.abort()),yt.REQUEST_CONFIG.REQUEST_TIMEOUT);try{return await(await fetch(n,{signal:r.signal})).json()}catch(s){throw s.name==="AbortError"?new Error("STATS_TIMEOUT"):s}finally{clearTimeout(i)}}_formatStats(t){if(!t?.stats)return null;const e=Object.values(t.stats)[0];return e?{count:parseInt(e.zaps_received?.count||e.zaps?.count||0,10),msats:parseInt(e.zaps_received?.msats||e.zaps?.msats||0,10),maxMsats:parseInt(e.zaps_received?.max_msats||e.zaps?.max_msats||0,10)}:null}async initializeStats(t,e,n=!1){if(n&&this.displayStats({skeleton:!0},e),this.#t.has(e))return this.#t.get(e);if(FA(t)?.type==="naddr"){const s=this.createTimeoutError();return this.displayStats(s,e),this.#e.set(e,s),s}const i=(async()=>{try{const s=await this.getZapStats(t,e);return s&&(this.displayStats(s,e),this.#e.set(e,s)),s}catch{return null}finally{this.#t.delete(e)}})();return this.#t.set(e,i),i}async#n(t,e){const n=st.getCachedStats(t,e),r=Date.now();return n&&r-n.timestamp<yt.REQUEST_CONFIG.CACHE_DURATION?n.stats:null}getCurrentStats(t){return this.#e.get(t)}async handleZapEvent(t,e,n){if(t?.isRealTimeEvent)try{const r=t.tags.find((l=>l[0].toLowerCase()==="bolt11"))?.[1],i=this.extractAmountFromBolt11(r);if(i<=0)return;const s=st.getViewStats(e),o={count:s?.count||0,msats:s?.msats||0,maxMsats:s?.maxMsats||0},a={count:o.count+1,msats:o.msats+i,maxMsats:Math.max(o.maxMsats,i)};st.updateStatsCache(e,n,a),this.#e.set(e,a),await this.displayStats(a,e),t.isStatsCalculated=!0,t.amountMsats=i}catch{}}extractAmountFromBolt11(t){try{const e=window.decodeBolt11(t);return parseInt(e.sections.find((n=>n.name==="amount"))?.value??"0",10)}catch{return 0}}async displayStats(t,e){try{await Vde(t,e)}catch{}}},hc=new class{#e;#t;#n;#s;#r;#o;#i;constructor(){this.#e=new m6,this.#a(),this.#l()}#a(){this.#n=new Map,this.#s=new Map,this.#r=new Map,this.#t=!1}#l(){const t={pool:this.#e,batchSize:yt.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_SIZE,batchDelay:yt.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_DELAY};this.#o=new kde(t),this.#i=new Tde(t)}#u(t){this.#n.has(t)||this.#n.set(t,{zap:null}),this.#s.has(t)||this.#s.set(t,{isZapClosed:!1})}#c(t,e,n,r){this.#n.get(t).zap=this.#e.subscribeMany(e.relayUrls,[n.req],r)}#d(t){return t&&t.id&&Array.isArray(t.tags)}#g(t,e){return t&&this.#r.delete(t),null}async connectToRelays(t){this.#t||([this.#o,this.#i].forEach((e=>e.setRelayUrls(t))),this.#t=!0)}subscribeToZaps(t,e,n,r){try{this.#f(n),this.#u(t),this.#s.get(t).isZapClosed=!1,this.#c(t,e,n,this.#h(r))}catch(i){this.#p("Subscription error",i)}}#f(t){if(!t?.req?.kinds||!Array.isArray(t.req.kinds))throw new Error("Invalid subscription settings")}async fetchReference(t,e,n){try{if(!this.#d(e))return null;const r=e.tags.find((l=>Array.isArray(l)&&l[0]===n));if(!r)return null;const i=n==="e"?r[1]:`${r[1]}`,s=st.getReference(i);if(s)return s;const o=this.#r.get(i);if(o)return o;const a=n==="e"?this.#o:this.#i;try{const l=await a.getOrCreateFetchPromise(i);return l&&st.setReference(i,l),this.#r.delete(i),l}finally{this.#r.delete(i)}}catch(r){return this.#g(e?.id,r)}}#h(t){const e=Math.floor(Date.now()/1e3);return{...t,onevent:n=>{n.isRealTimeEvent=n.created_at>=e,t.onevent(n)},oneose:t.oneose}}#p(t,e){throw e}get zapPool(){return this.#e}},{zapPool:Jhe}=hc,Js=new class{constructor(){this.viewConfigs=new Map,this.configStore=new Map,this.observers=new Map,this.#e=new Map,this.#t=new Map}#e;#t;setZapListUI(t){this.zapListUI=t}setViewConfig(t,e){this.viewConfigs.set(t,e),fi.viewConfigs.set(t,e),st.initializeZapView(t)}getViewConfig(t){return this.viewConfigs.get(t)}async updateEventReference(t,e){try{const n=this.getViewConfig(e);if(!n?.relayUrls?.length||yd(n?.identifier||""))return!1;const r=await this._fetchEventReference(t,n);return!!r&&(t.reference=r,!0)}catch{return!1}}async _fetchEventReference(t,e){const n=async()=>{if(!t?.tags||!Array.isArray(t.tags))return null;try{if(t.tags.find((s=>Array.isArray(s)&&s[0]==="a"))?.[1])return await hc.fetchReference(e.relayUrls,t,"a");const i=t.tags.find((s=>Array.isArray(s)&&s[0]==="e"));return i?.[1]&&/^[0-9a-f]{64}$/.test(i[1].toLowerCase())?await hc.fetchReference(e.relayUrls,t,"e"):null}catch{return null}};try{return await st.getOrFetchReference(t.id,n)}catch{return null}}async updateEventReferenceBatch(t,e){const n=this.getViewConfig(e);if(!n?.relayUrls?.length||yd(n?.identifier||""))return;const r=t.map((i=>this.updateEventReference(i,e)));await Promise.allSettled(r)}updateUIReferences(t){this.zapListUI&&t.forEach((e=>{e.reference&&this.zapListUI.updateZapReference(e)}))}async initializeSubscriptions(t,e){try{if(!this._isValidFilter(t))throw new Error("Invalid filter settings");const n=$A(t.identifier);if(!n)throw new Error(yt.ZAP_CONFIG.ERRORS.DECODE_FAILED);this._initializeLoadState(e),this._showInitialLoadingSpinner(e);const{batchEvents:r,lastEventTime:i}=await this._collectInitialEvents(e,t,n);r?.length>0&&this._processBatchEvents(r,e).catch(console.error),await this.finalizeInitialization(e,i)}catch(n){throw n}}_showInitialLoadingSpinner(t){const e=this._getListElement(t);if(e){const n=this._createLoadTrigger();e.appendChild(n)}}async finalizeInitialization(t,e){const n=st.getZapEvents(t),r=this._getListElement(t),i=st.updateLoadState(t,{isInitialFetchComplete:!0,lastEventTime:e});await Promise.all([i,n.length===0?this.zapListUI?.showNoZapsMessage():null,n.length>=yt.REQ_CONFIG.INITIAL_LOAD_COUNT?this.setupInfiniteScroll(t):null]),r?.querySelector(".load-more-trigger")?.remove()}_initializeLoadState(t){st.updateLoadState(t,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1})}_isValidFilter(t){return t&&t.relayUrls&&Array.isArray(t.relayUrls)&&t.relayUrls.length>0&&t.identifier}setupInfiniteScroll(t){try{this._cleanupInfiniteScroll(t);const e=this._getListElement(t);if(!e)return;const n=this._createLoadTrigger();e.appendChild(n),this._observeLoadTrigger(n,t,e)}catch{}}_createLoadTrigger(){const t=document.createElement("div");t.className="load-more-trigger";const e=document.createElement("div");return e.className="loading-spinner",t.appendChild(e),t}_observeLoadTrigger(t,e,n){const r=new IntersectionObserver((i=>this._handleIntersection(i[0],e)),{root:n,rootMargin:yt.INFINITE_SCROLL.ROOT_MARGIN,threshold:yt.INFINITE_SCROLL.THRESHOLD});r.observe(t),this.observers.set(e,r)}async _handleIntersection(t,e){t.isIntersecting&&(st.getLoadState(e).isLoading?setTimeout((()=>{t.isIntersecting&&this._handleIntersection(t,e)}),yt.INFINITE_SCROLL.RETRY_DELAY):this.loadMoreZaps(e).then((n=>{n===0&&this._cleanupInfiniteScroll(e)})).catch((n=>{this._cleanupInfiniteScroll(e)})))}_cleanupInfiniteScroll(t){const e=this.observers.get(t);if(!e)return;e.disconnect(),this._getListElement(t)?.querySelector(".load-more-trigger")?.remove(),this.observers.delete(t)}_getListElement(t){return document.querySelector(`nzv-dialog[data-view-id="${t}"]`)?.shadowRoot?.querySelector(".dialog-zap-list")}async loadMoreZaps(t){const e=st.getLoadState(t),n=this.getViewConfig(t);if(!this._canLoadMore(e,n))return 0;e.isLoading=!0;try{const r=await this._executeLoadMore(t,e,n);if(r>0){const i=st.getZapEvents(t).slice(-r);await this.updateEventReferenceBatch(i,t),this.updateUIReferences(i)}return r}finally{e.isLoading=!1}}async _executeLoadMore(t,e,n){const r=$A(n.identifier,e.lastEventTime);if(!r)return 0;const i=[],s=setTimeout((()=>{i.length===0&&this._cleanupInfiniteScroll(t)}),yt.LOAD_TIMEOUT);try{return await this._collectEvents(t,n,r,i,yt.REQ_CONFIG.ADDITIONAL_LOAD_COUNT,e),i.length>0&&await this._processBatchEvents(i,t),i.length}catch{return 0}finally{clearTimeout(s)}}async _collectEvents(t,e,n,r,i,s){return new Promise(((o,a)=>{const l=setTimeout((()=>a(new Error("Load timeout"))),yt.LOAD_TIMEOUT);hc.subscribeToZaps(t,e,n,{onevent:c=>{c.created_at<s.lastEventTime&&(r.push(c),s.lastEventTime=Math.min(s.lastEventTime,c.created_at),r.length>=i&&(clearTimeout(l),o()))},oneose:()=>{clearTimeout(l),o()}})}))}async _collectInitialEvents(t,e,n){const r=[];let i=null;return new Promise((s=>{const o=this._setupBufferInterval(r,t),a=hc.subscribeToZaps(t,e,n,{onevent:l=>{const c=this._handleInitialEvent(l,r,i,t);c!==null&&(i=c)},oneose:()=>{clearInterval(o),s({batchEvents:[...r],lastEventTime:i})}});this.#e.set(t,{zap:a})}))}_handleInitialEvent(t,e,n,r){const i=Math.min(n||t.created_at,t.created_at);if(st.addZapEvent(r,t)){if(e.push(t),this.updateEventReference(t,r).then((s=>{s&&this.zapListUI&&t.reference&&this.zapListUI.updateZapReference(t)})),t.isRealTimeEvent){const s=this.getViewConfig(r);Sh.handleZapEvent(t,r,s?.identifier),this.zapListUI&&this.zapListUI.prependZap(t).catch(console.error)}e.length>=yt.BATCH_SIZE&&this.zapListUI&&this.zapListUI.batchUpdate(st.getZapEvents(r)).catch(console.error)}return i}async _processBatchEvents(t,e){if(t?.length){t.sort(((n,r)=>r.created_at-n.created_at)),t.forEach((n=>st.addZapEvent(e,n)));try{await Promise.all([xh.processBatchProfiles(t)])}catch{}await this._updateUI(t,e)}}async _updateUI(t,e){this.zapListUI&&await this.zapListUI.batchUpdate(t,{isFullUpdate:!0})}_setupBufferInterval(t,e){let n=0;const r=yt.BUFFER_MIN_INTERVAL;return setInterval((()=>{const i=Date.now();t.length>0&&i-n>=r&&this.zapListUI&&(this.zapListUI.batchUpdate(st.getZapEvents(e),{isBufferUpdate:!0}).catch(console.error),n=i)}),yt.BUFFER_INTERVAL)}_canLoadMore(t,e){return e&&!t.isLoading&&t.lastEventTime}unsubscribe(t){try{const e=this.#e.get(t);e?.zap&&(e.zap(),e.zap=null),this.#t.set(t,{isZapClosed:!0}),this._cleanupInfiniteScroll(t)}catch{}}};class Hde extends HTMLElement{#e;#t;constructor(){super(),this.attachShadow({mode:"open"}),this.#e={isInitialized:!1,theme:yt.DEFAULT_OPTIONS.theme},this.popStateHandler=e=>{e.preventDefault(),this.#a(".dialog")?.open&&this.closeDialog()}}async connectedCallback(){if(this.viewId=this.getAttribute("data-view-id"),this.viewId){this.#t=this.#n();try{await this.#t,this.#e.isInitialized=!0;const e=Js.getViewConfig(this.viewId);if(!e)throw new Error("Config is required for initialization");if(await this.#s(e),this.getAttribute("data-nzv-id")){const n=await Sh.getCurrentStats(this.viewId);n&&this.statsUI.displayStats(n)}this.#e.isInitialized=!0,this.dispatchEvent(new CustomEvent("dialog-initialized",{detail:{viewId:this.viewId}}))}catch{}}}async#n(){return new Promise((e=>{const n=document.createElement("template");n.innerHTML=fi.getDialogTemplate(),this.shadowRoot.appendChild(n.content.cloneNode(!0)),this.#r(),queueMicrotask((()=>e()))}))}async#s(e){const n=document.createElement("style");n.textContent=Ude(),this.shadowRoot.appendChild(n),this.statsUI=new Ede(this.shadowRoot),this.profileUI=new Bde,this.zapListUI=new Fde(this.shadowRoot,this.profileUI,this.viewId,e),Js.setZapListUI(this.zapListUI);const r=st.getZapEvents(this.viewId);r?.length?await this.zapListUI.renderZapListFromCache(r):this.zapListUI.showNoZapsMessage();const i=this.getAttribute("data-nzv-id");if(i){const s=await st.getCachedStats(this.viewId,i);if(s?.stats)this.statsUI.displayStats(s.stats);else{const o=await Sh.getCurrentStats(this.viewId);o&&this.statsUI.displayStats(o)}}}static get observedAttributes(){return["data-theme"]}#r(){const e=this.#a(".dialog");this.#a(".close-dialog-button").addEventListener("click",(()=>this.closeDialog())),e.addEventListener("click",(n=>{n.target===e&&this.closeDialog()})),e.addEventListener("cancel",(n=>{n.preventDefault(),this.closeDialog()})),document.addEventListener("keydown",(n=>{if(e?.open){if(n.key==="Escape")this.closeDialog();else if(n.key===" "){n.preventDefault();const r=this.#a(".dialog-zap-list");r&&(r.scrollTop+=.8*r.clientHeight)}}}))}attributeChangedCallback(e,n,r){n!==r&&e==="data-theme"&&this.#o(r)}#o(e){st.updateThemeState(this.viewId,{theme:e}).isInitialized&&this.#i()}#i(){const e=st.getThemeState(this.viewId).theme==="dark"?"dark-theme":"light-theme";this.shadowRoot.host.classList.add(e)}async showDialog(){await this.#t;const e=this.#a(".dialog");e&&!e.open&&this.#e.isInitialized&&(window.addEventListener("popstate",this.popStateHandler),e.showModal(),queueMicrotask((()=>{document.activeElement&&document.activeElement.blur()})),this.#l())}closeDialog(){const e=this.#a(".dialog");e?.open&&(this.zapListUI?.destroy(),Js.unsubscribe(this.viewId),e.close(),this.remove(),window.removeEventListener("popstate",this.popStateHandler))}displayZapStats(e){this.statsUI.displayStats(e)}#a(e){return this.shadowRoot.querySelector(e)}#l(){const e=this.getAttribute("data-view-id"),n=document.querySelector(`button[data-zap-view-id="${e}"]`);if(!n)return;const r=this.#a(".dialog-title"),i=this.#a(".dialog-title a");if(!i||!r)return;const s=n.getAttribute("data-title"),o=n.getAttribute("data-nzv-id");i.href=o?`https://njump.me/${o}`:"#",s?.trim()?(i.textContent=s,r.classList.add("custom-title")):(i.textContent=yt.DIALOG_CONFIG.DEFAULT_TITLE+f6(o),r.classList.remove("custom-title"))}getOperations(){if(!this.#e.isInitialized)return null;const e={closeDialog:()=>this.closeDialog(),showDialog:()=>this.showDialog()};return this.#e.isInitialized&&Object.assign(e,{prependZap:n=>this.zapListUI?.prependZap(n),displayZapStats:n=>this.statsUI?.displayStats(n),showNoZapsMessage:()=>this.zapListUI?.showNoZapsMessage()}),e}async waitForInitialization(){return this.#t}}customElements.define("nzv-dialog",Hde);const Hg={create:async(t,e)=>{if(!t||!e)return Promise.reject(new Error("Invalid viewId or config"));Js.setViewConfig(t,e);const n=document.querySelector(`nzv-dialog[data-view-id="${t}"]`);if(n)return n;const r=document.createElement("nzv-dialog");r.setAttribute("data-view-id",t),r.setAttribute("data-config",JSON.stringify(e));const i=document.querySelector(`button[data-zap-view-id="${t}"]`);return i?.getAttribute("data-nzv-id")&&r.setAttribute("data-nzv-id",i.getAttribute("data-nzv-id")),document.body.appendChild(r),await r.waitForInitialization(),r},get:t=>document.querySelector(`nzv-dialog[data-view-id="${t}"]`),execute:(t,e,...n)=>{const r=Hg.get(t),i=r?.getOperations();return i?i[e]?.(...n)??null:null}},Vde=(t,e)=>Hg.execute(e,"displayZapStats",t);async function jde(t,e){try{const n=vh.fromButton(t);if(!n)throw new Error("Failed to create config from button");if(Js.setViewConfig(e,n),!await(async function(i){try{const s=Js.getViewConfig(i);if(!s)throw new Error(`View configuration not found for viewId: ${i}`);return Js.setViewConfig(i,s),await Hg.create(i,s)}catch{return null}})(e))throw new Error(yt.ZAP_CONFIG.ERRORS.DIALOG_NOT_FOUND);await(async function(i){try{const s=Hg.get(i);if(!s)throw new Error("Dialog not found");await s.waitForInitialization();const o=s.getOperations();if(!o?.showDialog)throw new Error("Basic dialog operations not available");o.showDialog()}catch{}})(e),setTimeout((async()=>{if(await(async function(i,s){const o=st.getZapEvents(i);if(o.length>0){const l=[...new Set(o.map((c=>c.pubkey)))];xh.fetchProfiles(l)}const{hasEnoughCachedEvents:a}=await st.processCachedData(i,s);return a&&Js.setupInfiniteScroll(i),a})(e,n),!t.hasAttribute("data-initialized")){const i=t.getAttribute("data-nzv-id");await Promise.all([hc.connectToRelays(n.relayUrls),Js.initializeSubscriptions(n,e),i?Sh.initializeStats(i,e,!0):Promise.resolve()]),t.setAttribute("data-initialized","true")}}),0)}catch{}}function g6(){Object.entries(yt.LIBRARIES).forEach((([t,e])=>{window[t]=e})),document.querySelectorAll("button[data-nzv-id]").forEach(((t,e)=>{if(t.hasAttribute("data-zap-view-id"))return;const n=`nostr-zap-view-${e}`;t.setAttribute("data-zap-view-id",n),t.hasAttribute("data-zap-color-mode")||t.setAttribute("data-zap-color-mode",yt.ZAP_CONFIG.DEFAULT_COLOR_MODE),t.addEventListener("click",(()=>jde(t,n)))}))}function y6(t={}){Object.assign(yt,t),typeof window<"u"&&g6()}function Wde(t={}){return y6(t)}typeof window<"u"&&document.addEventListener("DOMContentLoaded",g6);yo.vQ;yo.ZM;yo.yk;yo.h0;yo.n_;var qde=yo.Xz;yo.Uv;yo.fU;yo.Dw;var zA={},UA;function Kde(){if(UA)return zA;UA=1;var t=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Vk<"u"?Vk:{};function e(v){return v&&v.__esModule?v.default:v}var n={},r={},i=t.parcelRequire1faa;i==null&&(i=function(v){if(v in n)return n[v].exports;if(v in r){var b=r[v];delete r[v];var T={id:v,exports:{}};return n[v]=T,b.call(T.exports,T,T.exports),T.exports}var N=new Error("Cannot find module '"+v+"'");throw N.code="MODULE_NOT_FOUND",N},i.register=function(b,T){r[b]=T},t.parcelRequire1faa=i),i.register("58QMB",function(v,b){(function(){function T(W,G){var te,ce=Object.keys(G);for(te=0;te<ce.length;te++)W=W.replace(new RegExp("\\{"+ce[te]+"\\}","gi"),G[ce[te]]);return W}function N(W){var G,te,ce;if(!W)throw new Error("cannot create a random attribute name for an undefined object");G="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",te="";do for(te="",ce=0;ce<12;ce++)te+=G[Math.floor(Math.random()*G.length)];while(W[te]);return te}function $(W){var G={left:"start",right:"end",center:"middle",start:"start",end:"end"};return G[W]||G.start}function z(W){var G={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return G[W]||G.alphabetic}var q,V,re,fe,ie;ie=(function(W,G){var te,ce,be,ve={};for(W=W.split(","),G=G||10,te=0;te<W.length;te+=2)ce="&"+W[te+1]+";",be=parseInt(W[te],G),ve[ce]="&#"+be+";";return ve["\\xa0"]="&#160;",ve})("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),q={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},re=function(W,G){this.__root=W,this.__ctx=G},re.prototype.addColorStop=function(W,G){var te,ce,be=this.__ctx.__createElement("stop");be.setAttribute("offset",W),G.indexOf("rgba")!==-1?(te=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,ce=te.exec(G),be.setAttribute("stop-color",T("rgb({r},{g},{b})",{r:ce[1],g:ce[2],b:ce[3]})),be.setAttribute("stop-opacity",ce[4])):be.setAttribute("stop-color",G),this.__root.appendChild(be)},fe=function(W,G){this.__root=W,this.__ctx=G},V=function(W){var G,te={width:500,height:500,enableMirroring:!1};if(arguments.length>1?(G=te,G.width=arguments[0],G.height=arguments[1]):G=W||te,!(this instanceof V))return new V(G);this.width=G.width||te.width,this.height=G.height||te.height,this.enableMirroring=G.enableMirroring!==void 0?G.enableMirroring:te.enableMirroring,this.canvas=this,this.__document=G.document||document,G.ctx?this.__ctx=G.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)},V.prototype.__createElement=function(W,G,te){G===void 0&&(G={});var ce,be,ve=this.__document.createElementNS("http://www.w3.org/2000/svg",W),De=Object.keys(G);for(te&&(ve.setAttribute("fill","none"),ve.setAttribute("stroke","none")),ce=0;ce<De.length;ce++)be=De[ce],ve.setAttribute(be,G[be]);return ve},V.prototype.__setDefaultStyles=function(){var W,G,te=Object.keys(q);for(W=0;W<te.length;W++)G=te[W],this[G]=q[G].canvas},V.prototype.__applyStyleState=function(W){var G,te,ce=Object.keys(W);for(G=0;G<ce.length;G++)te=ce[G],this[te]=W[te]},V.prototype.__getStyleState=function(){var W,G,te={},ce=Object.keys(q);for(W=0;W<ce.length;W++)G=ce[W],te[G]=this[G];return te},V.prototype.__applyStyleToCurrentElement=function(W){var G=this.__currentElement,te=this.__currentElementsToStyle;te&&(G.setAttribute(W,""),G=te.element,te.children.forEach(function(Xt){Xt.setAttribute(W,"")}));var ce,be,ve,De,Ce,qe,ze=Object.keys(q);for(ce=0;ce<ze.length;ce++)if(be=q[ze[ce]],ve=this[ze[ce]],be.apply){if(ve instanceof fe){if(ve.__ctx)for(;ve.__ctx.__defs.childNodes.length;)De=ve.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[De]=De,this.__defs.appendChild(ve.__ctx.__defs.childNodes[0]);G.setAttribute(be.apply,T("url(#{id})",{id:ve.__root.getAttribute("id")}))}else if(ve instanceof re)G.setAttribute(be.apply,T("url(#{id})",{id:ve.__root.getAttribute("id")}));else if(be.apply.indexOf(W)!==-1&&be.svg!==ve)if(be.svgAttr!=="stroke"&&be.svgAttr!=="fill"||ve.indexOf("rgba")===-1){var Fe=be.svgAttr;if(ze[ce]==="globalAlpha"&&(Fe=W+"-"+be.svgAttr,G.getAttribute(Fe)))continue;G.setAttribute(Fe,ve)}else{Ce=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,qe=Ce.exec(ve),G.setAttribute(be.svgAttr,T("rgb({r},{g},{b})",{r:qe[1],g:qe[2],b:qe[3]}));var Ke=qe[4],it=this.globalAlpha;it!=null&&(Ke*=it),G.setAttribute(be.svgAttr+"-opacity",Ke)}}},V.prototype.__closestGroupOrSvg=function(W){return W=W||this.__currentElement,W.nodeName==="g"||W.nodeName==="svg"?W:this.__closestGroupOrSvg(W.parentNode)},V.prototype.getSerializedSvg=function(W){var G,te,ce,be,ve,De,Ce=new XMLSerializer().serializeToString(this.__root);if(De=/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi,De.test(Ce)&&(Ce=Ce.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),W)for(G=Object.keys(ie),te=0;te<G.length;te++)ce=G[te],be=ie[ce],ve=new RegExp(ce,"gi"),ve.test(Ce)&&(Ce=Ce.replace(ve,be));return Ce},V.prototype.getSvg=function(){return this.__root},V.prototype.save=function(){var W=this.__createElement("g"),G=this.__closestGroupOrSvg();this.__groupStack.push(G),G.appendChild(W),this.__currentElement=W,this.__stack.push(this.__getStyleState())},V.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var W=this.__stack.pop();this.__applyStyleState(W)},V.prototype.__addTransform=function(W){var G=this.__closestGroupOrSvg();if(G.childNodes.length>0){this.__currentElement.nodeName==="path"&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:G,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var te=this.__createElement("g");G.appendChild(te),this.__currentElement=te}var ce=this.__currentElement.getAttribute("transform");ce?ce+=" ":ce="",ce+=W,this.__currentElement.setAttribute("transform",ce)},V.prototype.scale=function(W,G){G===void 0&&(G=W),this.__addTransform(T("scale({x},{y})",{x:W,y:G}))},V.prototype.rotate=function(W){var G=180*W/Math.PI;this.__addTransform(T("rotate({angle},{cx},{cy})",{angle:G,cx:0,cy:0}))},V.prototype.translate=function(W,G){this.__addTransform(T("translate({x},{y})",{x:W,y:G}))},V.prototype.transform=function(W,G,te,ce,be,ve){this.__addTransform(T("matrix({a},{b},{c},{d},{e},{f})",{a:W,b:G,c:te,d:ce,e:be,f:ve}))},V.prototype.beginPath=function(){var W,G;this.__currentDefaultPath="",this.__currentPosition={},W=this.__createElement("path",{},!0),G=this.__closestGroupOrSvg(),G.appendChild(W),this.__currentElement=W},V.prototype.__applyCurrentDefaultPath=function(){var W=this.__currentElement;W.nodeName==="path"?W.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",W.nodeName)},V.prototype.__addPathCommand=function(W){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=W},V.prototype.moveTo=function(W,G){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.__currentPosition={x:W,y:G},this.__addPathCommand(T("M {x} {y}",{x:W,y:G}))},V.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},V.prototype.lineTo=function(W,G){this.__currentPosition={x:W,y:G},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(T("L {x} {y}",{x:W,y:G})):this.__addPathCommand(T("M {x} {y}",{x:W,y:G}))},V.prototype.bezierCurveTo=function(W,G,te,ce,be,ve){this.__currentPosition={x:be,y:ve},this.__addPathCommand(T("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:W,cp1y:G,cp2x:te,cp2y:ce,x:be,y:ve}))},V.prototype.quadraticCurveTo=function(W,G,te,ce){this.__currentPosition={x:te,y:ce},this.__addPathCommand(T("Q {cpx} {cpy} {x} {y}",{cpx:W,cpy:G,x:te,y:ce}))};var ue=function(W){var G=Math.sqrt(W[0]*W[0]+W[1]*W[1]);return[W[0]/G,W[1]/G]};V.prototype.arcTo=function(W,G,te,ce,be){var ve=this.__currentPosition&&this.__currentPosition.x,De=this.__currentPosition&&this.__currentPosition.y;if(ve!==void 0&&De!==void 0){if(be<0)throw new Error("IndexSizeError: The radius provided ("+be+") is negative.");if(ve===W&&De===G||W===te&&G===ce||be===0)return void this.lineTo(W,G);var Ce=ue([ve-W,De-G]),qe=ue([te-W,ce-G]);if(Ce[0]*qe[1]==Ce[1]*qe[0])return void this.lineTo(W,G);var ze=Ce[0]*qe[0]+Ce[1]*qe[1],Fe=Math.acos(Math.abs(ze)),Ke=ue([Ce[0]+qe[0],Ce[1]+qe[1]]),it=be/Math.sin(Fe/2),Xt=W+it*Ke[0],Y=G+it*Ke[1],ee=[-Ce[1],Ce[0]],Z=[qe[1],-qe[0]],ae=function($e){var xe=$e[0];return $e[1]>=0?Math.acos(xe):-Math.acos(xe)},me=ae(ee),ke=ae(Z);this.lineTo(Xt+ee[0]*be,Y+ee[1]*be),this.arc(Xt,Y,be,me,ke)}},V.prototype.stroke=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},V.prototype.fill=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},V.prototype.rect=function(W,G,te,ce){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.moveTo(W,G),this.lineTo(W+te,G),this.lineTo(W+te,G+ce),this.lineTo(W,G+ce),this.lineTo(W,G),this.closePath()},V.prototype.fillRect=function(W,G,te,ce){var be,ve;be=this.__createElement("rect",{x:W,y:G,width:te,height:ce,"shape-rendering":"crispEdges"},!0),ve=this.__closestGroupOrSvg(),ve.appendChild(be),this.__currentElement=be,this.__applyStyleToCurrentElement("fill")},V.prototype.strokeRect=function(W,G,te,ce){var be,ve;be=this.__createElement("rect",{x:W,y:G,width:te,height:ce},!0),ve=this.__closestGroupOrSvg(),ve.appendChild(be),this.__currentElement=be,this.__applyStyleToCurrentElement("stroke")},V.prototype.__clearCanvas=function(){for(var W=this.__closestGroupOrSvg(),G=W.getAttribute("transform"),te=this.__root.childNodes[1],ce=te.childNodes,be=ce.length-1;be>=0;be--)ce[be]&&te.removeChild(ce[be]);this.__currentElement=te,this.__groupStack=[],G&&this.__addTransform(G)},V.prototype.clearRect=function(W,G,te,ce){if(W===0&&G===0&&te===this.width&&ce===this.height)return void this.__clearCanvas();var be,ve=this.__closestGroupOrSvg();be=this.__createElement("rect",{x:W,y:G,width:te,height:ce,fill:"#FFFFFF"},!0),ve.appendChild(be)},V.prototype.createLinearGradient=function(W,G,te,ce){var be=this.__createElement("linearGradient",{id:N(this.__ids),x1:W+"px",x2:te+"px",y1:G+"px",y2:ce+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(be),new re(be,this)},V.prototype.createRadialGradient=function(W,G,te,ce,be,ve){var De=this.__createElement("radialGradient",{id:N(this.__ids),cx:ce+"px",cy:be+"px",r:ve+"px",fx:W+"px",fy:G+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(De),new re(De,this)},V.prototype.__parseFont=function(){var W=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i,G=W.exec(this.font),te={style:G[1]||"normal",size:G[4]||"10px",family:G[6]||"sans-serif",weight:G[3]||"normal",decoration:G[2]||"normal",href:null};return this.__fontUnderline==="underline"&&(te.decoration="underline"),this.__fontHref&&(te.href=this.__fontHref),te},V.prototype.__wrapTextLink=function(W,G){if(W.href){var te=this.__createElement("a");return te.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",W.href),te.appendChild(G),te}return G},V.prototype.__applyText=function(W,G,te,ce){var be=this.__parseFont(),ve=this.__closestGroupOrSvg(),De=this.__createElement("text",{"font-family":be.family,"font-size":be.size,"font-style":be.style,"font-weight":be.weight,"text-decoration":be.decoration,x:G,y:te,"text-anchor":$(this.textAlign),"dominant-baseline":z(this.textBaseline)},!0);De.appendChild(this.__document.createTextNode(W)),this.__currentElement=De,this.__applyStyleToCurrentElement(ce),ve.appendChild(this.__wrapTextLink(be,De))},V.prototype.fillText=function(W,G,te){this.__applyText(W,G,te,"fill")},V.prototype.strokeText=function(W,G,te){this.__applyText(W,G,te,"stroke")},V.prototype.measureText=function(W){return this.__ctx.font=this.font,this.__ctx.measureText(W)},V.prototype.arc=function(W,G,te,ce,be,ve){if(ce!==be){ce%=2*Math.PI,be%=2*Math.PI,ce===be&&(be=(be+2*Math.PI-.001*(ve?-1:1))%(2*Math.PI));var De=W+te*Math.cos(be),Ce=G+te*Math.sin(be),qe=W+te*Math.cos(ce),ze=G+te*Math.sin(ce),Fe=ve?0:1,Ke=0,it=be-ce;it<0&&(it+=2*Math.PI),Ke=ve?it>Math.PI?0:1:it>Math.PI?1:0,this.lineTo(qe,ze),this.__addPathCommand(T("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:te,ry:te,xAxisRotation:0,largeArcFlag:Ke,sweepFlag:Fe,endX:De,endY:Ce})),this.__currentPosition={x:De,y:Ce}}},V.prototype.clip=function(){var W=this.__closestGroupOrSvg(),G=this.__createElement("clipPath"),te=N(this.__ids),ce=this.__createElement("g");this.__applyCurrentDefaultPath(),W.removeChild(this.__currentElement),G.setAttribute("id",te),G.appendChild(this.__currentElement),this.__defs.appendChild(G),W.setAttribute("clip-path",T("url(#{id})",{id:te})),W.appendChild(ce),this.__currentElement=ce},V.prototype.drawImage=function(){var W,G,te,ce,be,ve,De,Ce,qe,ze,Fe,Ke,it,Xt,Y=Array.prototype.slice.call(arguments),ee=Y[0],Z=0,ae=0;if(Y.length===3)W=Y[1],G=Y[2],be=ee.width,ve=ee.height,te=be,ce=ve;else if(Y.length===5)W=Y[1],G=Y[2],te=Y[3],ce=Y[4],be=ee.width,ve=ee.height;else{if(Y.length!==9)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);Z=Y[1],ae=Y[2],be=Y[3],ve=Y[4],W=Y[5],G=Y[6],te=Y[7],ce=Y[8]}De=this.__closestGroupOrSvg(),this.__currentElement;var me="translate("+W+", "+G+")";if(ee instanceof V){if(Ce=ee.getSvg().cloneNode(!0),Ce.childNodes&&Ce.childNodes.length>1){for(qe=Ce.childNodes[0];qe.childNodes.length;)Xt=qe.childNodes[0].getAttribute("id"),this.__ids[Xt]=Xt,this.__defs.appendChild(qe.childNodes[0]);if(ze=Ce.childNodes[1]){var ke,$e=ze.getAttribute("transform");ke=$e?$e+" "+me:me,ze.setAttribute("transform",ke),De.appendChild(ze)}}}else ee.nodeName!=="CANVAS"&&ee.nodeName!=="IMG"||(Fe=this.__createElement("image"),Fe.setAttribute("width",te),Fe.setAttribute("height",ce),Fe.setAttribute("preserveAspectRatio","none"),Fe.setAttribute("opacity",this.globalAlpha),(Z||ae||be!==ee.width||ve!==ee.height)&&(Ke=this.__document.createElement("canvas"),Ke.width=te,Ke.height=ce,it=Ke.getContext("2d"),it.drawImage(ee,Z,ae,be,ve,0,0,te,ce),ee=Ke),Fe.setAttribute("transform",me),Fe.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",ee.nodeName==="CANVAS"?ee.toDataURL():ee.originalSrc),De.appendChild(Fe))},V.prototype.createPattern=function(W,G){var te,ce=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),be=N(this.__ids);return ce.setAttribute("id",be),ce.setAttribute("width",W.width),ce.setAttribute("height",W.height),W.nodeName==="CANVAS"||W.nodeName==="IMG"?(te=this.__document.createElementNS("http://www.w3.org/2000/svg","image"),te.setAttribute("width",W.width),te.setAttribute("height",W.height),te.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",W.nodeName==="CANVAS"?W.toDataURL():W.getAttribute("src")),ce.appendChild(te),this.__defs.appendChild(ce)):W instanceof V&&(ce.appendChild(W.__root.childNodes[1]),this.__defs.appendChild(ce)),new fe(ce,this)},V.prototype.setLineDash=function(W){W&&W.length>0?this.lineDash=W.join(","):this.lineDash=null},V.prototype.drawFocusRing=function(){},V.prototype.createImageData=function(){},V.prototype.getImageData=function(){},V.prototype.putImageData=function(){},V.prototype.globalCompositeOperation=function(){},V.prototype.setTransform=function(){},typeof window=="object"&&(window.C2S=V),typeof v.exports=="object"&&(v.exports=V)})(),(function(){function T(Y,ee,Z){this.mode=De.MODE_8BIT_BYTE,this.data=Y,this.parsedData=[];for(var ae=0,me=this.data.length;ae<me;ae++){var ke=[],$e=this.data.charCodeAt(ae);ee?ke[0]=$e:$e>65536?(ke[0]=240|(1835008&$e)>>>18,ke[1]=128|(258048&$e)>>>12,ke[2]=128|(4032&$e)>>>6,ke[3]=128|63&$e):$e>2048?(ke[0]=224|(61440&$e)>>>12,ke[1]=128|(4032&$e)>>>6,ke[2]=128|63&$e):$e>128?(ke[0]=192|(1984&$e)>>>6,ke[1]=128|63&$e):ke[0]=$e,this.parsedData.push(ke)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),Z||this.parsedData.length==this.data.length||(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function N(Y,ee){this.typeNumber=Y,this.errorCorrectLevel=ee,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function $(Y,ee){if(Y.length==ie)throw new Error(Y.length+"/"+ee);for(var Z=0;Z<Y.length&&Y[Z]==0;)Z++;this.num=new Array(Y.length-Z+ee);for(var ae=0;ae<Y.length-Z;ae++)this.num[ae]=Y[ae+Z]}function z(Y,ee){this.totalCount=Y,this.dataCount=ee}function q(){this.buffer=[],this.length=0}function V(){var Y=!1,ee=navigator.userAgent;if(/android/i.test(ee)){Y=!0;var Z=ee.toString().match(/android ([0-9]\.[0-9])/i);Z&&Z[1]&&(Y=parseFloat(Z[1]))}return Y}function re(Y,ee){for(var Z=ee.correctLevel,ae=1,me=fe(Y),ke=0,$e=it.length;ke<$e;ke++){var xe=0;switch(Z){case Ce.L:xe=it[ke][0];break;case Ce.M:xe=it[ke][1];break;case Ce.Q:xe=it[ke][2];break;case Ce.H:xe=it[ke][3]}if(me<=xe)break;ae++}if(ae>it.length)throw new Error("Too long data. the CorrectLevel."+["M","L","H","Q"][Z]+" limit length is "+xe);return ee.version!=0&&(ae<=ee.version?(ae=ee.version,ee.runVersion=ae):(console.warn("QR Code version "+ee.version+" too small, run version use "+ae),ee.runVersion=ae)),ae}function fe(Y){var ee=encodeURI(Y).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return ee.length+(ee.length!=Y.length?3:0)}var ie,ue,W=typeof t=="object"&&t&&t.Object===Object&&t,G=typeof self=="object"&&self&&self.Object===Object&&self,te=W||G||Function("return this")(),ce=b&&!b.nodeType&&b,be=ce&&!0&&v&&!v.nodeType&&v,ve=te.QRCode;T.prototype={getLength:function(Y){return this.parsedData.length},write:function(Y){for(var ee=0,Z=this.parsedData.length;ee<Z;ee++)Y.put(this.parsedData[ee],8)}},N.prototype={addData:function(Y,ee,Z){var ae=new T(Y,ee,Z);this.dataList.push(ae),this.dataCache=null},isDark:function(Y,ee){if(Y<0||this.moduleCount<=Y||ee<0||this.moduleCount<=ee)throw new Error(Y+","+ee);return this.modules[Y][ee][0]},getEye:function(Y,ee){if(Y<0||this.moduleCount<=Y||ee<0||this.moduleCount<=ee)throw new Error(Y+","+ee);var Z=this.modules[Y][ee];if(Z[1]){var ae="P"+Z[1]+"_"+Z[2];return Z[2]=="A"&&(ae="A"+Z[1]),{isDark:Z[0],type:ae}}return null},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(Y,ee){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var Z=0;Z<this.moduleCount;Z++){this.modules[Z]=new Array(this.moduleCount);for(var ae=0;ae<this.moduleCount;ae++)this.modules[Z][ae]=[]}this.setupPositionProbePattern(0,0,"TL"),this.setupPositionProbePattern(this.moduleCount-7,0,"BL"),this.setupPositionProbePattern(0,this.moduleCount-7,"TR"),this.setupPositionAdjustPattern("A"),this.setupTimingPattern(),this.setupTypeInfo(Y,ee),this.typeNumber>=7&&this.setupTypeNumber(Y),this.dataCache==null&&(this.dataCache=N.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,ee)},setupPositionProbePattern:function(Y,ee,Z){for(var ae=-1;ae<=7;ae++)if(!(Y+ae<=-1||this.moduleCount<=Y+ae))for(var me=-1;me<=7;me++)ee+me<=-1||this.moduleCount<=ee+me||(0<=ae&&ae<=6&&(me==0||me==6)||0<=me&&me<=6&&(ae==0||ae==6)||2<=ae&&ae<=4&&2<=me&&me<=4?(this.modules[Y+ae][ee+me][0]=!0,this.modules[Y+ae][ee+me][2]=Z,this.modules[Y+ae][ee+me][1]=ae==-0||me==-0||ae==6||me==6?"O":"I"):this.modules[Y+ae][ee+me][0]=!1)},getBestMaskPattern:function(){for(var Y=0,ee=0,Z=0;Z<8;Z++){this.makeImpl(!0,Z);var ae=ze.getLostPoint(this);(Z==0||Y>ae)&&(Y=ae,ee=Z)}return ee},createMovieClip:function(Y,ee,Z){var ae=Y.createEmptyMovieClip(ee,Z);this.make();for(var me=0;me<this.modules.length;me++)for(var ke=1*me,$e=0;$e<this.modules[me].length;$e++){var xe=1*$e,ne=this.modules[me][$e][0];ne&&(ae.beginFill(0,100),ae.moveTo(xe,ke),ae.lineTo(xe+1,ke),ae.lineTo(xe+1,ke+1),ae.lineTo(xe,ke+1),ae.endFill())}return ae},setupTimingPattern:function(){for(var Y=8;Y<this.moduleCount-8;Y++)this.modules[Y][6][0]==null&&(this.modules[Y][6][0]=Y%2==0);for(var ee=8;ee<this.moduleCount-8;ee++)this.modules[6][ee][0]==null&&(this.modules[6][ee][0]=ee%2==0)},setupPositionAdjustPattern:function(Y){for(var ee=ze.getPatternPosition(this.typeNumber),Z=0;Z<ee.length;Z++)for(var ae=0;ae<ee.length;ae++){var me=ee[Z],ke=ee[ae];if(this.modules[me][ke][0]==null)for(var $e=-2;$e<=2;$e++)for(var xe=-2;xe<=2;xe++)$e==-2||$e==2||xe==-2||xe==2||$e==0&&xe==0?(this.modules[me+$e][ke+xe][0]=!0,this.modules[me+$e][ke+xe][2]=Y,this.modules[me+$e][ke+xe][1]=$e==-2||xe==-2||$e==2||xe==2?"O":"I"):this.modules[me+$e][ke+xe][0]=!1}},setupTypeNumber:function(Y){for(var ee=ze.getBCHTypeNumber(this.typeNumber),Z=0;Z<18;Z++){var ae=!Y&&(ee>>Z&1)==1;this.modules[Math.floor(Z/3)][Z%3+this.moduleCount-8-3][0]=ae}for(var Z=0;Z<18;Z++){var ae=!Y&&(ee>>Z&1)==1;this.modules[Z%3+this.moduleCount-8-3][Math.floor(Z/3)][0]=ae}},setupTypeInfo:function(Y,ee){for(var Z=this.errorCorrectLevel<<3|ee,ae=ze.getBCHTypeInfo(Z),me=0;me<15;me++){var ke=!Y&&(ae>>me&1)==1;me<6?this.modules[me][8][0]=ke:me<8?this.modules[me+1][8][0]=ke:this.modules[this.moduleCount-15+me][8][0]=ke}for(var me=0;me<15;me++){var ke=!Y&&(ae>>me&1)==1;me<8?this.modules[8][this.moduleCount-me-1][0]=ke:me<9?this.modules[8][15-me-1+1][0]=ke:this.modules[8][15-me-1][0]=ke}this.modules[this.moduleCount-8][8][0]=!Y},mapData:function(Y,ee){for(var Z=-1,ae=this.moduleCount-1,me=7,ke=0,$e=this.moduleCount-1;$e>0;$e-=2)for($e==6&&$e--;;){for(var xe=0;xe<2;xe++)if(this.modules[ae][$e-xe][0]==null){var ne=!1;ke<Y.length&&(ne=(Y[ke]>>>me&1)==1);var Yt=ze.getMask(ee,ae,$e-xe);Yt&&(ne=!ne),this.modules[ae][$e-xe][0]=ne,me--,me==-1&&(ke++,me=7)}if((ae+=Z)<0||this.moduleCount<=ae){ae-=Z,Z=-Z;break}}}},N.PAD0=236,N.PAD1=17,N.createData=function(Y,ee,Z){for(var ae=z.getRSBlocks(Y,ee),me=new q,ke=0;ke<Z.length;ke++){var $e=Z[ke];me.put($e.mode,4),me.put($e.getLength(),ze.getLengthInBits($e.mode,Y)),$e.write(me)}for(var xe=0,ke=0;ke<ae.length;ke++)xe+=ae[ke].dataCount;if(me.getLengthInBits()>8*xe)throw new Error("code length overflow. ("+me.getLengthInBits()+">"+8*xe+")");for(me.getLengthInBits()+4<=8*xe&&me.put(0,4);me.getLengthInBits()%8!=0;)me.putBit(!1);for(;!(me.getLengthInBits()>=8*xe||(me.put(N.PAD0,8),me.getLengthInBits()>=8*xe));)me.put(N.PAD1,8);return N.createBytes(me,ae)},N.createBytes=function(Y,ee){for(var Z=0,ae=0,me=0,ke=new Array(ee.length),$e=new Array(ee.length),xe=0;xe<ee.length;xe++){var ne=ee[xe].dataCount,Yt=ee[xe].totalCount-ne;ae=Math.max(ae,ne),me=Math.max(me,Yt),ke[xe]=new Array(ne);for(var vt=0;vt<ke[xe].length;vt++)ke[xe][vt]=255&Y.buffer[vt+Z];Z+=ne;var Ln=ze.getErrorCorrectPolynomial(Yt),ut=new $(ke[xe],Ln.getLength()-1),oi=ut.mod(Ln);$e[xe]=new Array(Ln.getLength()-1);for(var vt=0;vt<$e[xe].length;vt++){var Wr=vt+oi.getLength()-$e[xe].length;$e[xe][vt]=Wr>=0?oi.get(Wr):0}}for(var vo=0,vt=0;vt<ee.length;vt++)vo+=ee[vt].totalCount;for(var _i=new Array(vo),cr=0,vt=0;vt<ae;vt++)for(var xe=0;xe<ee.length;xe++)vt<ke[xe].length&&(_i[cr++]=ke[xe][vt]);for(var vt=0;vt<me;vt++)for(var xe=0;xe<ee.length;xe++)vt<$e[xe].length&&(_i[cr++]=$e[xe][vt]);return _i};for(var De={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Ce={L:1,M:0,Q:3,H:2},qe={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},ze={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(Y){for(var ee=Y<<10;ze.getBCHDigit(ee)-ze.getBCHDigit(ze.G15)>=0;)ee^=ze.G15<<ze.getBCHDigit(ee)-ze.getBCHDigit(ze.G15);return(Y<<10|ee)^ze.G15_MASK},getBCHTypeNumber:function(Y){for(var ee=Y<<12;ze.getBCHDigit(ee)-ze.getBCHDigit(ze.G18)>=0;)ee^=ze.G18<<ze.getBCHDigit(ee)-ze.getBCHDigit(ze.G18);return Y<<12|ee},getBCHDigit:function(Y){for(var ee=0;Y!=0;)ee++,Y>>>=1;return ee},getPatternPosition:function(Y){return ze.PATTERN_POSITION_TABLE[Y-1]},getMask:function(Y,ee,Z){switch(Y){case qe.PATTERN000:return(ee+Z)%2==0;case qe.PATTERN001:return ee%2==0;case qe.PATTERN010:return Z%3==0;case qe.PATTERN011:return(ee+Z)%3==0;case qe.PATTERN100:return(Math.floor(ee/2)+Math.floor(Z/3))%2==0;case qe.PATTERN101:return ee*Z%2+ee*Z%3==0;case qe.PATTERN110:return(ee*Z%2+ee*Z%3)%2==0;case qe.PATTERN111:return(ee*Z%3+(ee+Z)%2)%2==0;default:throw new Error("bad maskPattern:"+Y)}},getErrorCorrectPolynomial:function(Y){for(var ee=new $([1],0),Z=0;Z<Y;Z++)ee=ee.multiply(new $([1,Fe.gexp(Z)],0));return ee},getLengthInBits:function(Y,ee){if(1<=ee&&ee<10)switch(Y){case De.MODE_NUMBER:return 10;case De.MODE_ALPHA_NUM:return 9;case De.MODE_8BIT_BYTE:case De.MODE_KANJI:return 8;default:throw new Error("mode:"+Y)}else if(ee<27)switch(Y){case De.MODE_NUMBER:return 12;case De.MODE_ALPHA_NUM:return 11;case De.MODE_8BIT_BYTE:return 16;case De.MODE_KANJI:return 10;default:throw new Error("mode:"+Y)}else{if(!(ee<41))throw new Error("type:"+ee);switch(Y){case De.MODE_NUMBER:return 14;case De.MODE_ALPHA_NUM:return 13;case De.MODE_8BIT_BYTE:return 16;case De.MODE_KANJI:return 12;default:throw new Error("mode:"+Y)}}},getLostPoint:function(Y){for(var ee=Y.getModuleCount(),Z=0,ae=0;ae<ee;ae++)for(var me=0;me<ee;me++){for(var ke=0,$e=Y.isDark(ae,me),xe=-1;xe<=1;xe++)if(!(ae+xe<0||ee<=ae+xe))for(var ne=-1;ne<=1;ne++)me+ne<0||ee<=me+ne||xe==0&&ne==0||$e==Y.isDark(ae+xe,me+ne)&&ke++;ke>5&&(Z+=3+ke-5)}for(var ae=0;ae<ee-1;ae++)for(var me=0;me<ee-1;me++){var Yt=0;Y.isDark(ae,me)&&Yt++,Y.isDark(ae+1,me)&&Yt++,Y.isDark(ae,me+1)&&Yt++,Y.isDark(ae+1,me+1)&&Yt++,Yt!=0&&Yt!=4||(Z+=3)}for(var ae=0;ae<ee;ae++)for(var me=0;me<ee-6;me++)Y.isDark(ae,me)&&!Y.isDark(ae,me+1)&&Y.isDark(ae,me+2)&&Y.isDark(ae,me+3)&&Y.isDark(ae,me+4)&&!Y.isDark(ae,me+5)&&Y.isDark(ae,me+6)&&(Z+=40);for(var me=0;me<ee;me++)for(var ae=0;ae<ee-6;ae++)Y.isDark(ae,me)&&!Y.isDark(ae+1,me)&&Y.isDark(ae+2,me)&&Y.isDark(ae+3,me)&&Y.isDark(ae+4,me)&&!Y.isDark(ae+5,me)&&Y.isDark(ae+6,me)&&(Z+=40);for(var vt=0,me=0;me<ee;me++)for(var ae=0;ae<ee;ae++)Y.isDark(ae,me)&&vt++;return Z+=Math.abs(100*vt/ee/ee-50)/5*10}},Fe={glog:function(Y){if(Y<1)throw new Error("glog("+Y+")");return Fe.LOG_TABLE[Y]},gexp:function(Y){for(;Y<0;)Y+=255;for(;Y>=256;)Y-=255;return Fe.EXP_TABLE[Y]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},Ke=0;Ke<8;Ke++)Fe.EXP_TABLE[Ke]=1<<Ke;for(var Ke=8;Ke<256;Ke++)Fe.EXP_TABLE[Ke]=Fe.EXP_TABLE[Ke-4]^Fe.EXP_TABLE[Ke-5]^Fe.EXP_TABLE[Ke-6]^Fe.EXP_TABLE[Ke-8];for(var Ke=0;Ke<255;Ke++)Fe.LOG_TABLE[Fe.EXP_TABLE[Ke]]=Ke;$.prototype={get:function(Y){return this.num[Y]},getLength:function(){return this.num.length},multiply:function(Y){for(var ee=new Array(this.getLength()+Y.getLength()-1),Z=0;Z<this.getLength();Z++)for(var ae=0;ae<Y.getLength();ae++)ee[Z+ae]^=Fe.gexp(Fe.glog(this.get(Z))+Fe.glog(Y.get(ae)));return new $(ee,0)},mod:function(Y){if(this.getLength()-Y.getLength()<0)return this;for(var ee=Fe.glog(this.get(0))-Fe.glog(Y.get(0)),Z=new Array(this.getLength()),ae=0;ae<this.getLength();ae++)Z[ae]=this.get(ae);for(var ae=0;ae<Y.getLength();ae++)Z[ae]^=Fe.gexp(Fe.glog(Y.get(ae))+ee);return new $(Z,0).mod(Y)}},z.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],z.getRSBlocks=function(Y,ee){var Z=z.getRsBlockTable(Y,ee);if(Z==ie)throw new Error("bad rs block @ typeNumber:"+Y+"/errorCorrectLevel:"+ee);for(var ae=Z.length/3,me=[],ke=0;ke<ae;ke++)for(var $e=Z[3*ke+0],xe=Z[3*ke+1],ne=Z[3*ke+2],Yt=0;Yt<$e;Yt++)me.push(new z(xe,ne));return me},z.getRsBlockTable=function(Y,ee){switch(ee){case Ce.L:return z.RS_BLOCK_TABLE[4*(Y-1)+0];case Ce.M:return z.RS_BLOCK_TABLE[4*(Y-1)+1];case Ce.Q:return z.RS_BLOCK_TABLE[4*(Y-1)+2];case Ce.H:return z.RS_BLOCK_TABLE[4*(Y-1)+3];default:return ie}},q.prototype={get:function(Y){var ee=Math.floor(Y/8);return(this.buffer[ee]>>>7-Y%8&1)==1},put:function(Y,ee){for(var Z=0;Z<ee;Z++)this.putBit((Y>>>ee-Z-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(Y){var ee=Math.floor(this.length/8);this.buffer.length<=ee&&this.buffer.push(0),Y&&(this.buffer[ee]|=128>>>this.length%8),this.length++}};var it=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],Xt=(function(){return typeof CanvasRenderingContext2D<"u"})()?(function(){function Y(){if(this._htOption.drawer=="svg"){var ke=this._oContext.getSerializedSvg(!0);this.dataURL=ke,this._el.innerHTML=ke}else try{var $e=this._elCanvas.toDataURL("image/png");this.dataURL=$e}catch(xe){console.error(xe)}this._htOption.onRenderingEnd&&(this.dataURL||console.error("Can not get base64 data, please check: 1. Published the page and image to the server 2. The image request support CORS 3. Configured `crossOrigin:'anonymous'` option"),this._htOption.onRenderingEnd(this._htOption,this.dataURL))}function ee(ke,$e){var xe=this;if(xe._fFail=$e,xe._fSuccess=ke,xe._bSupportDataURI===null){var ne=document.createElement("img"),Yt=function(){xe._bSupportDataURI=!1,xe._fFail&&xe._fFail.call(xe)},vt=function(){xe._bSupportDataURI=!0,xe._fSuccess&&xe._fSuccess.call(xe)};return ne.onabort=Yt,ne.onerror=Yt,ne.onload=vt,void(ne.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}xe._bSupportDataURI===!0&&xe._fSuccess?xe._fSuccess.call(xe):xe._bSupportDataURI===!1&&xe._fFail&&xe._fFail.call(xe)}if(te._android&&te._android<=2.1){var Z=1/window.devicePixelRatio,ae=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(ke,$e,xe,ne,Yt,vt,Ln,ut,oi){if("nodeName"in ke&&/img/i.test(ke.nodeName))for(var Wr=arguments.length-1;Wr>=1;Wr--)arguments[Wr]=arguments[Wr]*Z;else ut===void 0&&(arguments[1]*=Z,arguments[2]*=Z,arguments[3]*=Z,arguments[4]*=Z);ae.apply(this,arguments)}}var me=function(ke,$e){this._bIsPainted=!1,this._android=V(),this._el=ke,this._htOption=$e,this._htOption.drawer=="svg"?(this._oContext={},this._elCanvas={}):(this._elCanvas=document.createElement("canvas"),this._el.appendChild(this._elCanvas),this._oContext=this._elCanvas.getContext("2d")),this._bSupportDataURI=null,this.dataURL=null};return me.prototype.draw=function(ke){function $e(){ne.quietZone>0&&ne.quietZoneColor&&(ut.lineWidth=0,ut.fillStyle=ne.quietZoneColor,ut.fillRect(0,0,oi._elCanvas.width,ne.quietZone),ut.fillRect(0,ne.quietZone,ne.quietZone,oi._elCanvas.height-2*ne.quietZone),ut.fillRect(oi._elCanvas.width-ne.quietZone,ne.quietZone,ne.quietZone,oi._elCanvas.height-2*ne.quietZone),ut.fillRect(0,oi._elCanvas.height-ne.quietZone,oi._elCanvas.width,ne.quietZone))}function xe(vo){function _i(fs){var ur=Math.round(ne.width/3.5),li=Math.round(ne.height/3.5);ur!==li&&(ur=li),ne.logoMaxWidth?ur=Math.round(ne.logoMaxWidth):ne.logoWidth&&(ur=Math.round(ne.logoWidth)),ne.logoMaxHeight?li=Math.round(ne.logoMaxHeight):ne.logoHeight&&(li=Math.round(ne.logoHeight));var Ta,_a;fs.naturalWidth===void 0?(Ta=fs.width,_a=fs.height):(Ta=fs.naturalWidth,_a=fs.naturalHeight),(ne.logoMaxWidth||ne.logoMaxHeight)&&(ne.logoMaxWidth&&Ta<=ur&&(ur=Ta),ne.logoMaxHeight&&_a<=li&&(li=_a),Ta<=ur&&_a<=li&&(ur=Ta,li=_a));var Dy=(ne.width+2*ne.quietZone-ur)/2,By=(ne.height+ne.titleHeight+2*ne.quietZone-li)/2,JE=Math.min(ur/Ta,li/_a),$y=Ta*JE,Fy=_a*JE;(ne.logoMaxWidth||ne.logoMaxHeight)&&(ur=$y,li=Fy,Dy=(ne.width+2*ne.quietZone-ur)/2,By=(ne.height+ne.titleHeight+2*ne.quietZone-li)/2),ne.logoBackgroundTransparent||(ut.fillStyle=ne.logoBackgroundColor,ut.fillRect(Dy,By,ur,li));var KD=ut.imageSmoothingQuality,GD=ut.imageSmoothingEnabled;ut.imageSmoothingEnabled=!0,ut.imageSmoothingQuality="high",ut.drawImage(fs,Dy+(ur-$y)/2,By+(li-Fy)/2,$y,Fy),ut.imageSmoothingEnabled=GD,ut.imageSmoothingQuality=KD,$e(),Jc._bIsPainted=!0,Jc.makeImage()}ne.onRenderingStart&&ne.onRenderingStart(ne);for(var cr=0;cr<Yt;cr++)for(var ai=0;ai<Yt;ai++){var ka=ai*vt+ne.quietZone,ql=cr*Ln+ne.quietZone,$d=vo.isDark(cr,ai),_r=vo.getEye(cr,ai),_n=ne.dotScale;ut.lineWidth=0;var Un,Cr;_r?(Un=ne[_r.type]||ne[_r.type.substring(0,2)]||ne.colorDark,Cr=ne.colorLight):ne.backgroundImage?(Cr="rgba(0,0,0,0)",cr==6?ne.autoColor?(Un=ne.timing_H||ne.timing||ne.autoColorDark,Cr=ne.autoColorLight):Un=ne.timing_H||ne.timing||ne.colorDark:ai==6?ne.autoColor?(Un=ne.timing_V||ne.timing||ne.autoColorDark,Cr=ne.autoColorLight):Un=ne.timing_V||ne.timing||ne.colorDark:ne.autoColor?(Un=ne.autoColorDark,Cr=ne.autoColorLight):Un=ne.colorDark):(Un=cr==6?ne.timing_H||ne.timing||ne.colorDark:ai==6&&(ne.timing_V||ne.timing)||ne.colorDark,Cr=ne.colorLight),ut.strokeStyle=$d?Un:Cr,ut.fillStyle=$d?Un:Cr,_r?(_n=_r.type=="AO"?ne.dotScaleAO:_r.type=="AI"?ne.dotScaleAI:1,ne.backgroundImage&&ne.autoColor?(Un=(_r.type=="AO"?ne.AI:ne.AO)||ne.autoColorDark,Cr=ne.autoColorLight):Un=(_r.type=="AO"?ne.AI:ne.AO)||Un,$d=_r.isDark,ut.fillRect(ka+vt*(1-_n)/2,ne.titleHeight+ql+Ln*(1-_n)/2,vt*_n,Ln*_n)):cr==6?(_n=ne.dotScaleTiming_H,ut.fillRect(ka+vt*(1-_n)/2,ne.titleHeight+ql+Ln*(1-_n)/2,vt*_n,Ln*_n)):ai==6?(_n=ne.dotScaleTiming_V,ut.fillRect(ka+vt*(1-_n)/2,ne.titleHeight+ql+Ln*(1-_n)/2,vt*_n,Ln*_n)):(ne.backgroundImage,ut.fillRect(ka+vt*(1-_n)/2,ne.titleHeight+ql+Ln*(1-_n)/2,vt*_n,Ln*_n)),ne.dotScale==1||_r||(ut.strokeStyle=ne.colorLight)}if(ne.title&&(ut.fillStyle=ne.titleBackgroundColor,ut.fillRect(ne.quietZone,ne.quietZone,ne.width,ne.titleHeight),ut.font=ne.titleFont,ut.fillStyle=ne.titleColor,ut.textAlign="center",ut.fillText(ne.title,this._elCanvas.width/2,+ne.quietZone+ne.titleTop)),ne.subTitle&&(ut.font=ne.subTitleFont,ut.fillStyle=ne.subTitleColor,ut.fillText(ne.subTitle,this._elCanvas.width/2,+ne.quietZone+ne.subTitleTop)),ne.logo){var xo=new Image,Jc=this;xo.onload=function(){_i(xo)},xo.onerror=function(fs){console.error(fs)},ne.crossOrigin!=null&&(xo.crossOrigin=ne.crossOrigin),xo.originalSrc=ne.logo,xo.src=ne.logo}else $e(),this._bIsPainted=!0,this.makeImage()}var ne=this._htOption,Yt=ke.getModuleCount(),vt=Math.round(ne.width/Yt),Ln=Math.round((ne.height-ne.titleHeight)/Yt);vt<=1&&(vt=1),Ln<=1&&(Ln=1),ne.width=vt*Yt,ne.height=Ln*Yt+ne.titleHeight,ne.quietZone=Math.round(ne.quietZone),this._elCanvas.width=ne.width+2*ne.quietZone,this._elCanvas.height=ne.height+2*ne.quietZone,this._htOption.drawer!="canvas"&&(this._oContext=new C2S(this._elCanvas.width,this._elCanvas.height)),this.clear();var ut=this._oContext;ut.lineWidth=0,ut.fillStyle=ne.colorLight,ut.fillRect(0,0,this._elCanvas.width,this._elCanvas.height),ut.clearRect(ne.quietZone,ne.quietZone,ne.width,ne.titleHeight);var oi=this;if(ne.backgroundImage){var Wr=new Image;Wr.onload=function(){ut.globalAlpha=1,ut.globalAlpha=ne.backgroundImageAlpha;var vo=ut.imageSmoothingQuality,_i=ut.imageSmoothingEnabled;ut.imageSmoothingEnabled=!0,ut.imageSmoothingQuality="high",ut.drawImage(Wr,0,ne.titleHeight,ne.width+2*ne.quietZone,ne.height+2*ne.quietZone-ne.titleHeight),ut.imageSmoothingEnabled=_i,ut.imageSmoothingQuality=vo,ut.globalAlpha=1,xe.call(oi,ke)},ne.crossOrigin!=null&&(Wr.crossOrigin=ne.crossOrigin),Wr.originalSrc=ne.backgroundImage,Wr.src=ne.backgroundImage}else xe.call(oi,ke)},me.prototype.makeImage=function(){this._bIsPainted&&ee.call(this,Y)},me.prototype.isPainted=function(){return this._bIsPainted},me.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},me.prototype.remove=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1,this._el.innerHTML=""},me.prototype.round=function(ke){return ke&&Math.floor(1e3*ke)/1e3},me})():(function(){var Y=function(ee,Z){this._el=ee,this._htOption=Z};return Y.prototype.draw=function(ee){var Z=this._htOption,ae=this._el,me=ee.getModuleCount(),ke=Math.round(Z.width/me),$e=Math.round((Z.height-Z.titleHeight)/me);ke<=1&&(ke=1),$e<=1&&($e=1),this._htOption.width=ke*me,this._htOption.height=$e*me+Z.titleHeight,this._htOption.quietZone=Math.round(this._htOption.quietZone);var xe=[],ne="",Yt=Math.round(ke*Z.dotScale),vt=Math.round($e*Z.dotScale);Yt<4&&(Yt=4,vt=4);var Ln=Z.colorDark,ut=Z.colorLight;if(Z.backgroundImage){Z.autoColor?(Z.colorDark="rgba(0, 0, 0, .6);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#99000000', EndColorStr='#99000000');",Z.colorLight="rgba(255, 255, 255, .7);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#B2FFFFFF', EndColorStr='#B2FFFFFF');"):Z.colorLight="rgba(0,0,0,0)";var oi='<div style="display:inline-block; z-index:-10;position:absolute;"><img src="'+Z.backgroundImage+'" widht="'+(Z.width+2*Z.quietZone)+'" height="'+(Z.height+2*Z.quietZone)+'" style="opacity:'+Z.backgroundImageAlpha+";filter:alpha(opacity="+100*Z.backgroundImageAlpha+'); "/></div>';xe.push(oi)}if(Z.quietZone&&(ne="display:inline-block; width:"+(Z.width+2*Z.quietZone)+"px; height:"+(Z.width+2*Z.quietZone)+"px;background:"+Z.quietZoneColor+"; text-align:center;"),xe.push('<div style="font-size:0;'+ne+'">'),xe.push('<table  style="font-size:0;border:0;border-collapse:collapse; margin-top:'+Z.quietZone+'px;" border="0" cellspacing="0" cellspadding="0" align="center" valign="middle">'),xe.push('<tr height="'+Z.titleHeight+'" align="center"><td style="border:0;border-collapse:collapse;margin:0;padding:0" colspan="'+me+'">'),Z.title){var Wr=Z.titleColor,vo=Z.titleFont;xe.push('<div style="width:100%;margin-top:'+Z.titleTop+"px;color:"+Wr+";font:"+vo+";background:"+Z.titleBackgroundColor+'">'+Z.title+"</div>")}Z.subTitle&&xe.push('<div style="width:100%;margin-top:'+(Z.subTitleTop-Z.titleTop)+"px;color:"+Z.subTitleColor+"; font:"+Z.subTitleFont+'">'+Z.subTitle+"</div>"),xe.push("</td></tr>");for(var _i=0;_i<me;_i++){xe.push('<tr style="border:0; padding:0; margin:0;" height="7">');for(var cr=0;cr<me;cr++){var ai=ee.isDark(_i,cr),ka=ee.getEye(_i,cr);if(ka){ai=ka.isDark;var ql=ka.type,$d=Z[ql]||Z[ql.substring(0,2)]||Ln;xe.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+ke+"px;height:"+$e+'px;"><span style="width:'+ke+"px;height:"+$e+"px;background-color:"+(ai?$d:ut)+';display:inline-block"></span></td>')}else{var _r=Z.colorDark;_i==6?(_r=Z.timing_H||Z.timing||Ln,xe.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+ke+"px;height:"+$e+"px;background-color:"+(ai?_r:ut)+';"></td>')):cr==6?(_r=Z.timing_V||Z.timing||Ln,xe.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+ke+"px;height:"+$e+"px;background-color:"+(ai?_r:ut)+';"></td>')):xe.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+ke+"px;height:"+$e+'px;"><div style="display:inline-block;width:'+Yt+"px;height:"+vt+"px;background-color:"+(ai?_r:Z.colorLight)+';"></div></td>')}}xe.push("</tr>")}if(xe.push("</table>"),xe.push("</div>"),Z.logo){var _n=new Image;Z.crossOrigin!=null&&(_n.crossOrigin=Z.crossOrigin),_n.src=Z.logo;var Un=Z.width/3.5,Cr=Z.height/3.5;Un!=Cr&&(Un=Cr),Z.logoWidth&&(Un=Z.logoWidth),Z.logoHeight&&(Cr=Z.logoHeight);var xo="position:relative; z-index:1;display:table-cell;top:-"+((Z.height-Z.titleHeight)/2+Cr/2+Z.quietZone)+"px;text-align:center; width:"+Un+"px; height:"+Cr+"px;line-height:"+Un+"px; vertical-align: middle;";Z.logoBackgroundTransparent||(xo+="background:"+Z.logoBackgroundColor),xe.push('<div style="'+xo+'"><img  src="'+Z.logo+'"  style="max-width: '+Un+"px; max-height: "+Cr+'px;" /> <div style=" display: none; width:1px;margin-left: -1px;"></div></div>')}Z.onRenderingStart&&Z.onRenderingStart(Z),ae.innerHTML=xe.join("");var Jc=ae.childNodes[0],fs=(Z.width-Jc.offsetWidth)/2,ur=(Z.height-Jc.offsetHeight)/2;fs>0&&ur>0&&(Jc.style.margin=ur+"px "+fs+"px"),this._htOption.onRenderingEnd&&this._htOption.onRenderingEnd(this._htOption,null)},Y.prototype.clear=function(){this._el.innerHTML=""},Y})();ue=function(Y,ee){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:Ce.H,dotScale:1,dotScaleTiming:1,dotScaleTiming_H:ie,dotScaleTiming_V:ie,dotScaleA:1,dotScaleAO:ie,dotScaleAI:ie,quietZone:0,quietZoneColor:"rgba(0,0,0,0)",title:"",titleFont:"normal normal bold 16px Arial",titleColor:"#000000",titleBackgroundColor:"#ffffff",titleHeight:0,titleTop:30,subTitle:"",subTitleFont:"normal normal normal 14px Arial",subTitleColor:"#4F4F4F",subTitleTop:60,logo:ie,logoWidth:ie,logoHeight:ie,logoMaxWidth:ie,logoMaxHeight:ie,logoBackgroundColor:"#ffffff",logoBackgroundTransparent:!1,PO:ie,PI:ie,PO_TL:ie,PI_TL:ie,PO_TR:ie,PI_TR:ie,PO_BL:ie,PI_BL:ie,AO:ie,AI:ie,timing:ie,timing_H:ie,timing_V:ie,backgroundImage:ie,backgroundImageAlpha:1,autoColor:!1,autoColorDark:"rgba(0, 0, 0, .6)",autoColorLight:"rgba(255, 255, 255, .7)",onRenderingStart:ie,onRenderingEnd:ie,version:0,tooltip:!1,binary:!1,drawer:"canvas",crossOrigin:null,utf8WithoutBOM:!0},typeof ee=="string"&&(ee={text:ee}),ee)for(var Z in ee)this._htOption[Z]=ee[Z];this._htOption.title||this._htOption.subTitle||(this._htOption.titleHeight=0),(this._htOption.version<0||this._htOption.version>40)&&(console.warn("QR Code version '"+this._htOption.version+"' is invalidate, reset to 0"),this._htOption.version=0),(this._htOption.dotScale<0||this._htOption.dotScale>1)&&(console.warn(this._htOption.dotScale+" , is invalidate, dotScale must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScale=1),(this._htOption.dotScaleTiming<0||this._htOption.dotScaleTiming>1)&&(console.warn(this._htOption.dotScaleTiming+" , is invalidate, dotScaleTiming must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming=1),this._htOption.dotScaleTiming_H?(this._htOption.dotScaleTiming_H<0||this._htOption.dotScaleTiming_H>1)&&(console.warn(this._htOption.dotScaleTiming_H+" , is invalidate, dotScaleTiming_H must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_H=1):this._htOption.dotScaleTiming_H=this._htOption.dotScaleTiming,this._htOption.dotScaleTiming_V?(this._htOption.dotScaleTiming_V<0||this._htOption.dotScaleTiming_V>1)&&(console.warn(this._htOption.dotScaleTiming_V+" , is invalidate, dotScaleTiming_V must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_V=1):this._htOption.dotScaleTiming_V=this._htOption.dotScaleTiming,(this._htOption.dotScaleA<0||this._htOption.dotScaleA>1)&&(console.warn(this._htOption.dotScaleA+" , is invalidate, dotScaleA must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleA=1),this._htOption.dotScaleAO?(this._htOption.dotScaleAO<0||this._htOption.dotScaleAO>1)&&(console.warn(this._htOption.dotScaleAO+" , is invalidate, dotScaleAO must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAO=1):this._htOption.dotScaleAO=this._htOption.dotScaleA,this._htOption.dotScaleAI?(this._htOption.dotScaleAI<0||this._htOption.dotScaleAI>1)&&(console.warn(this._htOption.dotScaleAI+" , is invalidate, dotScaleAI must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAI=1):this._htOption.dotScaleAI=this._htOption.dotScaleA,(this._htOption.backgroundImageAlpha<0||this._htOption.backgroundImageAlpha>1)&&(console.warn(this._htOption.backgroundImageAlpha+" , is invalidate, backgroundImageAlpha must between 0 and 1, now reset to 1. "),this._htOption.backgroundImageAlpha=1),this._htOption.height=this._htOption.height+this._htOption.titleHeight,typeof Y=="string"&&(Y=document.getElementById(Y)),(!this._htOption.drawer||this._htOption.drawer!="svg"&&this._htOption.drawer!="canvas")&&(this._htOption.drawer="canvas"),this._android=V(),this._el=Y,this._oQRCode=null,this._htOption._element=Y;var ae={};for(var Z in this._htOption)ae[Z]=this._htOption[Z];this._oDrawing=new Xt(this._el,ae),this._htOption.text&&this.makeCode(this._htOption.text)},ue.prototype.makeCode=function(Y){this._oQRCode=new N(re(Y,this._htOption),this._htOption.correctLevel),this._oQRCode.addData(Y,this._htOption.binary,this._htOption.utf8WithoutBOM),this._oQRCode.make(),this._htOption.tooltip&&(this._el.title=Y),this._oDrawing.draw(this._oQRCode)},ue.prototype.makeImage=function(){typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},ue.prototype.clear=function(){this._oDrawing.remove()},ue.prototype.resize=function(Y,ee){this._oDrawing._htOption.width=Y,this._oDrawing._htOption.height=ee,this._oDrawing.draw(this._oQRCode)},ue.prototype.noConflict=function(){return te.QRCode===this&&(te.QRCode=ve),ue},ue.CorrectLevel=Ce,be?((be.exports=ue).QRCode=ue,ce.QRCode=ue):te.QRCode=ue}).call(this)});var s=i("58QMB");/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */var o={};const a=BigInt(0),l=BigInt(1),c=BigInt(2),u=BigInt(3),d=BigInt(8),f=Object.freeze({a,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),h=(v,b)=>(v+b/c)/b,p={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(v){const{n:b}=f,T=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),N=-l*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),$=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),z=T,q=BigInt("0x100000000000000000000000000000000"),V=h(z*v,b),re=h(-N*v,b);let fe=pe(v-V*T-re*$,b),ie=pe(-V*N-re*z,b);const ue=fe>q,W=ie>q;if(ue&&(fe=b-fe),W&&(ie=b-ie),fe>q||ie>q)throw new Error("splitScalarEndo: Endomorphism failed, k="+v);return{k1neg:ue,k1:fe,k2neg:W,k2:ie}}},m=32,g=32,y=32,w=m+1,k=2*m+1;function C(v){const{a:b,b:T}=f,N=pe(v*v),$=pe(N*v);return pe($+b*v+T)}const A=f.a===a;class E extends Error{constructor(b){super(b)}}function P(v){if(!(v instanceof S))throw new TypeError("JacobianPoint expected")}class S{constructor(b,T,N){this.x=b,this.y=T,this.z=N}static fromAffine(b){if(!(b instanceof I))throw new TypeError("JacobianPoint#fromAffine: expected Point");return b.equals(I.ZERO)?S.ZERO:new S(b.x,b.y,l)}static toAffineBatch(b){const T=ge(b.map(N=>N.z));return b.map((N,$)=>N.toAffine(T[$]))}static normalizeZ(b){return S.toAffineBatch(b).map(S.fromAffine)}equals(b){P(b);const{x:T,y:N,z:$}=this,{x:z,y:q,z:V}=b,re=pe($*$),fe=pe(V*V),ie=pe(T*fe),ue=pe(z*re),W=pe(pe(N*V)*fe),G=pe(pe(q*$)*re);return ie===ue&&W===G}negate(){return new S(this.x,pe(-this.y),this.z)}double(){const{x:b,y:T,z:N}=this,$=pe(b*b),z=pe(T*T),q=pe(z*z),V=b+z,re=pe(c*(pe(V*V)-$-q)),fe=pe(u*$),ie=pe(fe*fe),ue=pe(ie-c*re),W=pe(fe*(re-ue)-d*q),G=pe(c*T*N);return new S(ue,W,G)}add(b){P(b);const{x:T,y:N,z:$}=this,{x:z,y:q,z:V}=b;if(z===a||q===a)return this;if(T===a||N===a)return b;const re=pe($*$),fe=pe(V*V),ie=pe(T*fe),ue=pe(z*re),W=pe(pe(N*V)*fe),G=pe(pe(q*$)*re),te=pe(ue-ie),ce=pe(G-W);if(te===a)return ce===a?this.double():S.ZERO;const be=pe(te*te),ve=pe(te*be),De=pe(ie*be),Ce=pe(ce*ce-ve-c*De),qe=pe(ce*(De-Ce)-W*ve),ze=pe($*V*te);return new S(Ce,qe,ze)}subtract(b){return this.add(b.negate())}multiplyUnsafe(b){const T=S.ZERO;if(typeof b=="bigint"&&b===a)return T;let N=Me(b);if(N===l)return this;if(!A){let ue=T,W=this;for(;N>a;)N&l&&(ue=ue.add(W)),W=W.double(),N>>=l;return ue}let{k1neg:$,k1:z,k2neg:q,k2:V}=p.splitScalar(N),re=T,fe=T,ie=this;for(;z>a||V>a;)z&l&&(re=re.add(ie)),V&l&&(fe=fe.add(ie)),ie=ie.double(),z>>=l,V>>=l;return $&&(re=re.negate()),q&&(fe=fe.negate()),fe=new S(pe(fe.x*p.beta),fe.y,fe.z),re.add(fe)}precomputeWindow(b){const T=A?128/b+1:256/b+1,N=[];let $=this,z=$;for(let q=0;q<T;q++){z=$,N.push(z);for(let V=1;V<2**(b-1);V++)z=z.add($),N.push(z);$=z.double()}return N}wNAF(b,T){!T&&this.equals(S.BASE)&&(T=I.BASE);const N=T&&T._WINDOW_SIZE||1;if(256%N)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let $=T&&_.get(T);$||($=this.precomputeWindow(N),T&&N!==1&&($=S.normalizeZ($),_.set(T,$)));let z=S.ZERO,q=S.BASE;const V=1+(A?128/N:256/N),re=2**(N-1),fe=BigInt(2**N-1),ie=2**N,ue=BigInt(N);for(let W=0;W<V;W++){const G=W*re;let te=Number(b&fe);b>>=ue,te>re&&(te-=ie,b+=l);const ce=G,be=G+Math.abs(te)-1,ve=W%2!==0,De=te<0;te===0?q=q.add(x(ve,$[ce])):z=z.add(x(De,$[be]))}return{p:z,f:q}}multiply(b,T){let N=Me(b),$,z;if(A){const{k1neg:q,k1:V,k2neg:re,k2:fe}=p.splitScalar(N);let{p:ie,f:ue}=this.wNAF(V,T),{p:W,f:G}=this.wNAF(fe,T);ie=x(q,ie),W=x(re,W),W=new S(pe(W.x*p.beta),W.y,W.z),$=ie.add(W),z=ue.add(G)}else{const{p:q,f:V}=this.wNAF(N,T);$=q,z=V}return S.normalizeZ([$,z])[0]}toAffine(b){const{x:T,y:N,z:$}=this,z=this.equals(S.ZERO);b==null&&(b=z?d:oe($));const q=b,V=pe(q*q),re=pe(V*q),fe=pe(T*V),ie=pe(N*re),ue=pe($*q);if(z)return I.ZERO;if(ue!==l)throw new Error("invZ was invalid");return new I(fe,ie)}}S.BASE=new S(f.Gx,f.Gy,l),S.ZERO=new S(a,l,a);function x(v,b){const T=b.negate();return v?T:b}const _=new WeakMap;class I{constructor(b,T){this.x=b,this.y=T}_setWindowSize(b){this._WINDOW_SIZE=b,_.delete(this)}hasEvenY(){return this.y%c===a}static fromCompressedHex(b){const T=b.length===32,N=J(T?b:b.subarray(1));if(!mt(N))throw new Error("Point is not on curve");const $=C(N);let z=je($);const q=(z&l)===l;T?q&&(z=pe(-z)):(b[0]&1)===1!==q&&(z=pe(-z));const V=new I(N,z);return V.assertValidity(),V}static fromUncompressedHex(b){const T=J(b.subarray(1,m+1)),N=J(b.subarray(m+1,m*2+1)),$=new I(T,N);return $.assertValidity(),$}static fromHex(b){const T=he(b),N=T.length,$=T[0];if(N===m)return this.fromCompressedHex(T);if(N===w&&($===2||$===3))return this.fromCompressedHex(T);if(N===k&&$===4)return this.fromUncompressedHex(T);throw new Error(`Point.fromHex: received invalid point. Expected 32-${w} compressed bytes or ${k} uncompressed bytes, not ${N}`)}static fromPrivateKey(b){return I.BASE.multiply(bt(b))}static fromSignature(b,T,N){const{r:$,s:z}=Pe(T);if(![0,1,2,3].includes(N))throw new Error("Cannot recover: invalid recovery bit");const q=_e(he(b)),{n:V}=f,re=N===2||N===3?$+V:$,fe=oe(re,V),ie=pe(-q*fe,V),ue=pe(z*fe,V),W=N&1?"03":"02",G=I.fromHex(W+j(re)),te=I.BASE.multiplyAndAddUnsafe(G,ie,ue);if(!te)throw new Error("Cannot recover signature: point at infinify");return te.assertValidity(),te}toRawBytes(b=!1){return le(this.toHex(b))}toHex(b=!1){const T=j(this.x);return b?`${this.hasEvenY()?"02":"03"}${T}`:`04${T}${j(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const b="Point is not on elliptic curve",{x:T,y:N}=this;if(!mt(T)||!mt(N))throw new Error(b);const $=pe(N*N),z=C(T);if(pe($-z)!==a)throw new Error(b)}equals(b){return this.x===b.x&&this.y===b.y}negate(){return new I(this.x,pe(-this.y))}double(){return S.fromAffine(this).double().toAffine()}add(b){return S.fromAffine(this).add(S.fromAffine(b)).toAffine()}subtract(b){return this.add(b.negate())}multiply(b){return S.fromAffine(this).multiply(b,this).toAffine()}multiplyAndAddUnsafe(b,T,N){const $=S.fromAffine(this),z=T===a||T===l||this!==I.BASE?$.multiplyUnsafe(T):$.multiply(T),q=S.fromAffine(b).multiplyUnsafe(N),V=z.add(q);return V.equals(S.ZERO)?void 0:V.toAffine()}}I.BASE=new I(f.Gx,f.Gy),I.ZERO=new I(a,a);function D(v){return Number.parseInt(v[0],16)>=8?"00"+v:v}function B(v){if(v.length<2||v[0]!==2)throw new Error(`Invalid signature integer tag: ${H(v)}`);const b=v[1],T=v.subarray(2,b+2);if(!b||T.length!==b)throw new Error("Invalid signature integer: wrong length");if(T[0]===0&&T[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:J(T),left:v.subarray(b+2)}}function F(v){if(v.length<2||v[0]!=48)throw new Error(`Invalid signature tag: ${H(v)}`);if(v[1]!==v.length-2)throw new Error("Invalid signature: incorrect length");const{data:b,left:T}=B(v.subarray(2)),{data:N,left:$}=B(T);if($.length)throw new Error(`Invalid signature: left bytes after parsing: ${H($)}`);return{r:b,s:N}}class R{constructor(b,T){this.r=b,this.s=T,this.assertValidity()}static fromCompact(b){const T=b instanceof Uint8Array,N="Signature.fromCompact";if(typeof b!="string"&&!T)throw new TypeError(`${N}: Expected string or Uint8Array`);const $=T?H(b):b;if($.length!==128)throw new Error(`${N}: Expected 64-byte hex`);return new R(de($.slice(0,64)),de($.slice(64,128)))}static fromDER(b){const T=b instanceof Uint8Array;if(typeof b!="string"&&!T)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:N,s:$}=F(T?b:le(b));return new R(N,$)}static fromHex(b){return this.fromDER(b)}assertValidity(){const{r:b,s:T}=this;if(!ot(b))throw new Error("Invalid Signature: r must be 0 < r < n");if(!ot(T))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const b=f.n>>l;return this.s>b}normalizeS(){return this.hasHighS()?new R(this.r,pe(-this.s,f.n)):this}toDERRawBytes(){return le(this.toDERHex())}toDERHex(){const b=D(X(this.s)),T=D(X(this.r)),N=b.length/2,$=T.length/2,z=X(N),q=X($);return`30${X($+N+4)}02${q}${T}02${z}${b}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return le(this.toCompactHex())}toCompactHex(){return j(this.r)+j(this.s)}}function O(...v){if(!v.every(N=>N instanceof Uint8Array))throw new Error("Uint8Array list expected");if(v.length===1)return v[0];const b=v.reduce((N,$)=>N+$.length,0),T=new Uint8Array(b);for(let N=0,$=0;N<v.length;N++){const z=v[N];T.set(z,$),$+=z.length}return T}const L=Array.from({length:256},(v,b)=>b.toString(16).padStart(2,"0"));function H(v){if(!(v instanceof Uint8Array))throw new Error("Expected Uint8Array");let b="";for(let T=0;T<v.length;T++)b+=L[v[T]];return b}const U=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function j(v){if(typeof v!="bigint")throw new Error("Expected bigint");if(!(a<=v&&v<U))throw new Error("Expected number 0 <= n < 2^256");return v.toString(16).padStart(64,"0")}function Q(v){const b=le(j(v));if(b.length!==32)throw new Error("Error: expected 32 bytes");return b}function X(v){const b=v.toString(16);return b.length&1?`0${b}`:b}function de(v){if(typeof v!="string")throw new TypeError("hexToNumber: expected string, got "+typeof v);return BigInt(`0x${v}`)}function le(v){if(typeof v!="string")throw new TypeError("hexToBytes: expected string, got "+typeof v);if(v.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+v.length);const b=new Uint8Array(v.length/2);for(let T=0;T<b.length;T++){const N=T*2,$=v.slice(N,N+2),z=Number.parseInt($,16);if(Number.isNaN(z)||z<0)throw new Error("Invalid byte sequence");b[T]=z}return b}function J(v){return de(H(v))}function he(v){return v instanceof Uint8Array?Uint8Array.from(v):le(v)}function Me(v){if(typeof v=="number"&&Number.isSafeInteger(v)&&v>0)return BigInt(v);if(typeof v=="bigint"&&ot(v))return v;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function pe(v,b=f.P){const T=v%b;return T>=a?T:b+T}function Te(v,b){const{P:T}=f;let N=v;for(;b-- >a;)N*=N,N%=T;return N}function je(v){const{P:b}=f,T=BigInt(6),N=BigInt(11),$=BigInt(22),z=BigInt(23),q=BigInt(44),V=BigInt(88),re=v*v*v%b,fe=re*re*v%b,ie=Te(fe,u)*fe%b,ue=Te(ie,u)*fe%b,W=Te(ue,c)*re%b,G=Te(W,N)*W%b,te=Te(G,$)*G%b,ce=Te(te,q)*te%b,be=Te(ce,V)*ce%b,ve=Te(be,q)*te%b,De=Te(ve,u)*fe%b,Ce=Te(De,z)*G%b,qe=Te(Ce,T)*re%b,ze=Te(qe,c);if(ze*ze%b!==v)throw new Error("Cannot find square root");return ze}function oe(v,b=f.P){if(v===a||b<=a)throw new Error(`invert: expected positive integers, got n=${v} mod=${b}`);let T=pe(v,b),N=b,$=a,z=l;for(;T!==a;){const V=N/T,re=N%T,fe=$-z*V;N=T,T=re,$=z,z=fe}if(N!==l)throw new Error("invert: does not exist");return pe($,b)}function ge(v,b=f.P){const T=new Array(v.length),N=v.reduce((z,q,V)=>q===a?z:(T[V]=z,pe(z*q,b)),l),$=oe(N,b);return v.reduceRight((z,q,V)=>q===a?z:(T[V]=pe(z*T[V],b),pe(z*q,b)),$),T}function Ie(v){const b=v.length*8-g*8,T=J(v);return b>0?T>>BigInt(b):T}function _e(v,b=!1){const T=Ie(v);if(b)return T;const{n:N}=f;return T>=N?T-N:T}let Ue,Je;class ft{constructor(b,T){if(this.hashLen=b,this.qByteLen=T,typeof b!="number"||b<2)throw new Error("hashLen must be a number");if(typeof T!="number"||T<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(b).fill(1),this.k=new Uint8Array(b).fill(0),this.counter=0}hmac(...b){return St.hmacSha256(this.k,...b)}hmacSync(...b){return Je(this.k,...b)}checkSync(){if(typeof Je!="function")throw new E("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(b=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),b),this.v=await this.hmac(this.v),b.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),b),this.v=await this.hmac(this.v))}reseedSync(b=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),b),this.v=this.hmacSync(this.v),b.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),b),this.v=this.hmacSync(this.v))}async generate(){this.incr();let b=0;const T=[];for(;b<this.qByteLen;){this.v=await this.hmac(this.v);const N=this.v.slice();T.push(N),b+=this.v.length}return O(...T)}generateSync(){this.checkSync(),this.incr();let b=0;const T=[];for(;b<this.qByteLen;){this.v=this.hmacSync(this.v);const N=this.v.slice();T.push(N),b+=this.v.length}return O(...T)}}function ot(v){return a<v&&v<f.n}function mt(v){return a<v&&v<f.P}function It(v,b,T,N=!0){const{n:$}=f,z=_e(v,!0);if(!ot(z))return;const q=oe(z,$),V=I.BASE.multiply(z),re=pe(V.x,$);if(re===a)return;const fe=pe(q*pe(b+T*re,$),$);if(fe===a)return;let ie=new R(re,fe),ue=(V.x===ie.r?0:2)|Number(V.y&l);return N&&ie.hasHighS()&&(ie=ie.normalizeS(),ue^=1),{sig:ie,recovery:ue}}function bt(v){let b;if(typeof v=="bigint")b=v;else if(typeof v=="number"&&Number.isSafeInteger(v)&&v>0)b=BigInt(v);else if(typeof v=="string"){if(v.length!==2*g)throw new Error("Expected 32 bytes of private key");b=de(v)}else if(v instanceof Uint8Array){if(v.length!==g)throw new Error("Expected 32 bytes of private key");b=J(v)}else throw new TypeError("Expected valid private key");if(!ot(b))throw new Error("Expected private key: 0 < key < n");return b}function Lt(v){return v instanceof I?(v.assertValidity(),v):I.fromHex(v)}function Pe(v){if(v instanceof R)return v.assertValidity(),v;try{return R.fromDER(v)}catch{return R.fromCompact(v)}}function Oe(v,b=!1){return I.fromPrivateKey(v).toRawBytes(b)}function at(v){const b=v instanceof Uint8Array,T=typeof v=="string",N=(b||T)&&v.length;return b?N===w||N===k:T?N===w*2||N===k*2:v instanceof I}function Ht(v,b,T=!1){if(at(v))throw new TypeError("getSharedSecret: first arg must be private key");if(!at(b))throw new TypeError("getSharedSecret: second arg must be public key");const N=Lt(b);return N.assertValidity(),N.multiply(bt(v)).toRawBytes(T)}function xn(v){const b=v.length>m?v.slice(0,m):v;return J(b)}function Ot(v){const b=xn(v),T=pe(b,f.n);return Wt(T<a?b:T)}function Wt(v){return Q(v)}function Nt(v,b,T){if(v==null)throw new Error(`sign: expected valid message hash, not "${v}"`);const N=he(v),$=bt(b),z=[Wt($),Ot(N)];if(T!=null){T===!0&&(T=St.randomBytes(m));const re=he(T);if(re.length!==m)throw new Error(`sign: Expected ${m} bytes of extra data`);z.push(re)}const q=O(...z),V=xn(N);return{seed:q,m:V,d:$}}function Pt(v,b){const{sig:T,recovery:N}=v,{der:$,recovered:z}=Object.assign({canonical:!0,der:!0},b),q=$?T.toDERRawBytes():T.toCompactRawBytes();return z?[q,N]:q}function _t(v,b,T={}){const{seed:N,m:$,d:z}=Nt(v,b,T.extraEntropy),q=new ft(y,g);q.reseedSync(N);let V;for(;!(V=It(q.generateSync(),$,z,T.canonical));)q.reseedSync();return Pt(V,T)}const Dt={strict:!0};function un(v,b,T,N=Dt){let $;try{$=Pe(v),b=he(b)}catch{return!1}const{r:z,s:q}=$;if(N.strict&&$.hasHighS())return!1;const V=_e(b);let re;try{re=Lt(T)}catch{return!1}const{n:fe}=f,ie=oe(q,fe),ue=pe(V*ie,fe),W=pe(z*ie,fe),G=I.BASE.multiplyAndAddUnsafe(re,ue,W);return G?pe(G.x,fe)===z:!1}function zn(v){return pe(J(v),f.n)}class ti{constructor(b,T){this.r=b,this.s=T,this.assertValidity()}static fromHex(b){const T=he(b);if(T.length!==64)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${T.length}`);const N=J(T.subarray(0,32)),$=J(T.subarray(32,64));return new ti(N,$)}assertValidity(){const{r:b,s:T}=this;if(!mt(b)||!ot(T))throw new Error("Invalid signature")}toHex(){return j(this.r)+j(this.s)}toRawBytes(){return le(this.toHex())}}function Di(v){return I.fromPrivateKey(v).toRawX()}class ni{constructor(b,T,N=St.randomBytes()){if(b==null)throw new TypeError(`sign: Expected valid message, not "${b}"`);this.m=he(b);const{x:$,scalar:z}=this.getScalar(bt(T));if(this.px=$,this.d=z,this.rand=he(N),this.rand.length!==32)throw new TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(b){const T=I.fromPrivateKey(b),N=T.hasEvenY()?b:f.n-b;return{point:T,scalar:N,x:T.toRawX()}}initNonce(b,T){return Q(b^J(T))}finalizeNonce(b){const T=pe(J(b),f.n);if(T===a)throw new Error("sign: Creation of signature failed. k is zero");const{point:N,x:$,scalar:z}=this.getScalar(T);return{R:N,rx:$,k:z}}finalizeSig(b,T,N,$){return new ti(b.x,pe(T+N*$,f.n)).toRawBytes()}error(){throw new Error("sign: Invalid signature produced")}async calc(){const{m:b,d:T,px:N,rand:$}=this,z=St.taggedHash,q=this.initNonce(T,await z(Kn.aux,$)),{R:V,rx:re,k:fe}=this.finalizeNonce(await z(Kn.nonce,q,N,b)),ie=zn(await z(Kn.challenge,re,N,b)),ue=this.finalizeSig(V,fe,ie,T);return await ki(ue,b,N)||this.error(),ue}calcSync(){const{m:b,d:T,px:N,rand:$}=this,z=St.taggedHashSync,q=this.initNonce(T,z(Kn.aux,$)),{R:V,rx:re,k:fe}=this.finalizeNonce(z(Kn.nonce,q,N,b)),ie=zn(z(Kn.challenge,re,N,b)),ue=this.finalizeSig(V,fe,ie,T);return cs(ue,b,N)||this.error(),ue}}async function Kc(v,b,T){return new ni(v,b,T).calc()}function Is(v,b,T){return new ni(v,b,T).calcSync()}function Hl(v,b,T){const N=v instanceof ti,$=N?v:ti.fromHex(v);return N&&$.assertValidity(),{...$,m:he(b),P:Lt(T)}}function Ei(v,b,T,N){const $=I.BASE.multiplyAndAddUnsafe(b,bt(T),pe(-N,f.n));return!(!$||!$.hasEvenY()||$.x!==v)}async function ki(v,b,T){try{const{r:N,s:$,m:z,P:q}=Hl(v,b,T),V=zn(await St.taggedHash(Kn.challenge,Q(N),q.toRawX(),z));return Ei(N,q,$,V)}catch{return!1}}function cs(v,b,T){try{const{r:N,s:$,m:z,P:q}=Hl(v,b,T),V=zn(St.taggedHashSync(Kn.challenge,Q(N),q.toRawX(),z));return Ei(N,q,$,V)}catch(N){if(N instanceof E)throw N;return!1}}const Ti={Signature:ti,getPublicKey:Di,sign:Kc,verify:ki,signSync:Is,verifySync:cs};I.BASE._setWindowSize(8);const kn={node:o,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},Kn={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},ri={},St={bytesToHex:H,hexToBytes:le,concatBytes:O,mod:pe,invert:oe,isValidPrivateKey(v){try{return bt(v),!0}catch{return!1}},_bigintTo32Bytes:Q,_normalizePrivateKey:bt,hashToPrivateKey:v=>{v=he(v);const b=g+8;if(v.length<b||v.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const T=pe(J(v),f.n-l)+l;return Q(T)},randomBytes:(v=32)=>{if(kn.web)return kn.web.getRandomValues(new Uint8Array(v));if(kn.node){const{randomBytes:b}=kn.node;return Uint8Array.from(b(v))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>St.hashToPrivateKey(St.randomBytes(g+8)),precompute(v=8,b=I.BASE){const T=b===I.BASE?b:new I(b.x,b.y);return T._setWindowSize(v),T.multiply(u),T},sha256:async(...v)=>{if(kn.web){const b=await kn.web.subtle.digest("SHA-256",O(...v));return new Uint8Array(b)}else if(kn.node){const{createHash:b}=kn.node,T=b("sha256");return v.forEach(N=>T.update(N)),Uint8Array.from(T.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(v,...b)=>{if(kn.web){const T=await kn.web.subtle.importKey("raw",v,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),N=O(...b),$=await kn.web.subtle.sign("HMAC",T,N);return new Uint8Array($)}else if(kn.node){const{createHmac:T}=kn.node,N=T("sha256",v);return b.forEach($=>N.update($)),Uint8Array.from(N.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(v,...b)=>{let T=ri[v];if(T===void 0){const N=await St.sha256(Uint8Array.from(v,$=>$.charCodeAt(0)));T=O(N,N),ri[v]=T}return St.sha256(T,...b)},taggedHashSync:(v,...b)=>{if(typeof Ue!="function")throw new E("sha256Sync is undefined, you need to set it");let T=ri[v];if(T===void 0){const N=Ue(Uint8Array.from(v,$=>$.charCodeAt(0)));T=O(N,N),ri[v]=T}return Ue(T,...b)},_JacobianPoint:S};Object.defineProperties(St,{sha256Sync:{configurable:!1,get(){return Ue},set(v){Ue||(Ue=v)}},hmacSha256Sync:{configurable:!1,get(){return Je},set(v){Je||(Je=v)}}});var kr={};Object.defineProperty(kr,"__esModule",{value:!0}),kr.sha224=kr.sha256=void 0;var ya={};Object.defineProperty(ya,"__esModule",{value:!0}),ya.SHA2=void 0;var Bt={};Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.output=Bt.exists=Bt.hash=Bt.bytes=Bt.bool=Bt.number=void 0;function Gc(v){if(!Number.isSafeInteger(v)||v<0)throw new Error(`Wrong positive integer: ${v}`)}Bt.number=Gc;function Ct(v){if(typeof v!="boolean")throw new Error(`Expected boolean, not ${v}`)}Bt.bool=Ct;function $t(v,...b){if(!(v instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(b.length>0&&!b.includes(v.length))throw new TypeError(`Expected Uint8Array of length ${b}, not of length=${v.length}`)}Bt.bytes=$t;function dn(v){if(typeof v!="function"||typeof v.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Gc(v.outputLen),Gc(v.blockLen)}Bt.hash=dn;function fn(v,b=!0){if(v.destroyed)throw new Error("Hash instance has been destroyed");if(b&&v.finished)throw new Error("Hash#digest() has already been called")}Bt.exists=fn;function Yn(v,b){$t(v);const T=b.outputLen;if(v.length<T)throw new Error(`digestInto() expects output buffer of length at least ${T}`)}Bt.output=Yn;const Tn={number:Gc,bool:Ct,bytes:$t,hash:dn,exists:fn,output:Yn};Bt.default=Tn;var Ne={};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.randomBytes=Ne.wrapConstructorWithOpts=Ne.wrapConstructor=Ne.checkOpts=Ne.Hash=Ne.concatBytes=Ne.toBytes=Ne.utf8ToBytes=Ne.asyncLoop=Ne.nextTick=Ne.hexToBytes=Ne.bytesToHex=Ne.isLE=Ne.rotr=Ne.createView=Ne.u32=Ne.u8=void 0;var Rn={};Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.crypto=void 0,Rn.crypto={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};const us=v=>new Uint8Array(v.buffer,v.byteOffset,v.byteLength);Ne.u8=us;const Zc=v=>new Uint32Array(v.buffer,v.byteOffset,Math.floor(v.byteLength/4));Ne.u32=Zc;const Zh=v=>new DataView(v.buffer,v.byteOffset,v.byteLength);Ne.createView=Zh;const Qh=(v,b)=>v<<32-b|v>>>b;if(Ne.rotr=Qh,Ne.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!Ne.isLE)throw new Error("Non little-endian hardware is not supported");const ly=Array.from({length:256},(v,b)=>b.toString(16).padStart(2,"0"));function cy(v){if(!(v instanceof Uint8Array))throw new Error("Uint8Array expected");let b="";for(let T=0;T<v.length;T++)b+=ly[v[T]];return b}Ne.bytesToHex=cy;function uy(v){if(typeof v!="string")throw new TypeError("hexToBytes: expected string, got "+typeof v);if(v.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const b=new Uint8Array(v.length/2);for(let T=0;T<b.length;T++){const N=T*2,$=v.slice(N,N+2),z=Number.parseInt($,16);if(Number.isNaN(z)||z<0)throw new Error("Invalid byte sequence");b[T]=z}return b}Ne.hexToBytes=uy;const ba=async()=>{};Ne.nextTick=ba;async function Qc(v,b,T){let N=Date.now();for(let $=0;$<v;$++){T($);const z=Date.now()-N;z>=0&&z<b||(await(0,Ne.nextTick)(),N+=z)}}Ne.asyncLoop=Qc;function Md(v){if(typeof v!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof v}`);return new TextEncoder().encode(v)}Ne.utf8ToBytes=Md;function Od(v){if(typeof v=="string"&&(v=Md(v)),!(v instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof v})`);return v}Ne.toBytes=Od;function dy(...v){if(!v.every(N=>N instanceof Uint8Array))throw new Error("Uint8Array list expected");if(v.length===1)return v[0];const b=v.reduce((N,$)=>N+$.length,0),T=new Uint8Array(b);for(let N=0,$=0;N<v.length;N++){const z=v[N];T.set(z,$),$+=z.length}return T}Ne.concatBytes=dy;class fy{clone(){return this._cloneInto()}}Ne.Hash=fy;const hy=v=>Object.prototype.toString.call(v)==="[object Object]"&&v.constructor===Object;function w6(v,b){if(b!==void 0&&(typeof b!="object"||!hy(b)))throw new TypeError("Options should be object or undefined");return Object.assign(v,b)}Ne.checkOpts=w6;function v6(v){const b=N=>v().update(Od(N)).digest(),T=v();return b.outputLen=T.outputLen,b.blockLen=T.blockLen,b.create=()=>v(),b}Ne.wrapConstructor=v6;function x6(v){const b=(N,$)=>v($).update(Od(N)).digest(),T=v({});return b.outputLen=T.outputLen,b.blockLen=T.blockLen,b.create=N=>v(N),b}Ne.wrapConstructorWithOpts=x6;function S6(v=32){if(Rn.crypto.web)return Rn.crypto.web.getRandomValues(new Uint8Array(v));if(Rn.crypto.node)return new Uint8Array(Rn.crypto.node.randomBytes(v).buffer);throw new Error("The environment doesn't have randomBytes function")}Ne.randomBytes=S6;function E6(v,b,T,N){if(typeof v.setBigUint64=="function")return v.setBigUint64(b,T,N);const $=BigInt(32),z=BigInt(4294967295),q=Number(T>>$&z),V=Number(T&z),re=N?4:0,fe=N?0:4;v.setUint32(b+re,q,N),v.setUint32(b+fe,V,N)}class k6 extends Ne.Hash{constructor(b,T,N,$){super(),this.blockLen=b,this.outputLen=T,this.padOffset=N,this.isLE=$,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(b),this.view=(0,Ne.createView)(this.buffer)}update(b){Bt.default.exists(this);const{view:T,buffer:N,blockLen:$}=this;b=(0,Ne.toBytes)(b);const z=b.length;for(let q=0;q<z;){const V=Math.min($-this.pos,z-q);if(V===$){const re=(0,Ne.createView)(b);for(;$<=z-q;q+=$)this.process(re,q);continue}N.set(b.subarray(q,q+V),this.pos),this.pos+=V,q+=V,this.pos===$&&(this.process(T,0),this.pos=0)}return this.length+=b.length,this.roundClean(),this}digestInto(b){Bt.default.exists(this),Bt.default.output(b,this),this.finished=!0;const{buffer:T,view:N,blockLen:$,isLE:z}=this;let{pos:q}=this;T[q++]=128,this.buffer.subarray(q).fill(0),this.padOffset>$-q&&(this.process(N,0),q=0);for(let ue=q;ue<$;ue++)T[ue]=0;E6(N,$-8,BigInt(this.length*8),z),this.process(N,0);const V=(0,Ne.createView)(b),re=this.outputLen;if(re%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const fe=re/4,ie=this.get();if(fe>ie.length)throw new Error("_sha2: outputLen bigger than state");for(let ue=0;ue<fe;ue++)V.setUint32(4*ue,ie[ue],z)}digest(){const{buffer:b,outputLen:T}=this;this.digestInto(b);const N=b.slice(0,T);return this.destroy(),N}_cloneInto(b){b||(b=new this.constructor),b.set(...this.get());const{blockLen:T,buffer:N,length:$,finished:z,destroyed:q,pos:V}=this;return b.length=$,b.pos=V,b.finished=z,b.destroyed=q,$%T&&b.buffer.set(N),b}}ya.SHA2=k6;const T6=(v,b,T)=>v&b^~v&T,_6=(v,b,T)=>v&b^v&T^b&T,C6=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),wa=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),va=new Uint32Array(64);class aE extends ya.SHA2{constructor(){super(64,32,8,!1),this.A=wa[0]|0,this.B=wa[1]|0,this.C=wa[2]|0,this.D=wa[3]|0,this.E=wa[4]|0,this.F=wa[5]|0,this.G=wa[6]|0,this.H=wa[7]|0}get(){const{A:b,B:T,C:N,D:$,E:z,F:q,G:V,H:re}=this;return[b,T,N,$,z,q,V,re]}set(b,T,N,$,z,q,V,re){this.A=b|0,this.B=T|0,this.C=N|0,this.D=$|0,this.E=z|0,this.F=q|0,this.G=V|0,this.H=re|0}process(b,T){for(let ue=0;ue<16;ue++,T+=4)va[ue]=b.getUint32(T,!1);for(let ue=16;ue<64;ue++){const W=va[ue-15],G=va[ue-2],te=(0,Ne.rotr)(W,7)^(0,Ne.rotr)(W,18)^W>>>3,ce=(0,Ne.rotr)(G,17)^(0,Ne.rotr)(G,19)^G>>>10;va[ue]=ce+va[ue-7]+te+va[ue-16]|0}let{A:N,B:$,C:z,D:q,E:V,F:re,G:fe,H:ie}=this;for(let ue=0;ue<64;ue++){const W=(0,Ne.rotr)(V,6)^(0,Ne.rotr)(V,11)^(0,Ne.rotr)(V,25),G=ie+W+T6(V,re,fe)+C6[ue]+va[ue]|0,ce=((0,Ne.rotr)(N,2)^(0,Ne.rotr)(N,13)^(0,Ne.rotr)(N,22))+_6(N,$,z)|0;ie=fe,fe=re,re=V,V=q+G|0,q=z,z=$,$=N,N=G+ce|0}N=N+this.A|0,$=$+this.B|0,z=z+this.C|0,q=q+this.D|0,V=V+this.E|0,re=re+this.F|0,fe=fe+this.G|0,ie=ie+this.H|0,this.set(N,$,z,q,V,re,fe,ie)}roundClean(){va.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class A6 extends aE{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}kr.sha256=(0,Ne.wrapConstructor)(()=>new aE),kr.sha224=(0,Ne.wrapConstructor)(()=>new A6);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Vl(v){if(!Number.isSafeInteger(v))throw new Error(`Wrong integer: ${v}`)}function ds(...v){const b=($,z)=>q=>$(z(q)),T=Array.from(v).reverse().reduce(($,z)=>$?b($,z.encode):z.encode,void 0),N=v.reduce(($,z)=>$?b($,z.decode):z.decode,void 0);return{encode:T,decode:N}}function Ps(v){return{encode:b=>{if(!Array.isArray(b)||b.length&&typeof b[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return b.map(T=>{if(Vl(T),T<0||T>=v.length)throw new Error(`Digit index outside alphabet: ${T} (alphabet: ${v.length})`);return v[T]})},decode:b=>{if(!Array.isArray(b)||b.length&&typeof b[0]!="string")throw new Error("alphabet.decode input should be array of strings");return b.map(T=>{if(typeof T!="string")throw new Error(`alphabet.decode: not string element=${T}`);const N=v.indexOf(T);if(N===-1)throw new Error(`Unknown letter: "${T}". Allowed: ${v}`);return N})}}}function Ms(v=""){if(typeof v!="string")throw new Error("join separator should be string");return{encode:b=>{if(!Array.isArray(b)||b.length&&typeof b[0]!="string")throw new Error("join.encode input should be array of strings");for(let T of b)if(typeof T!="string")throw new Error(`join.encode: non-string input=${T}`);return b.join(v)},decode:b=>{if(typeof b!="string")throw new Error("join.decode input should be string");return b.split(v)}}}function Nd(v,b="="){if(Vl(v),typeof b!="string")throw new Error("padding chr should be string");return{encode(T){if(!Array.isArray(T)||T.length&&typeof T[0]!="string")throw new Error("padding.encode input should be array of strings");for(let N of T)if(typeof N!="string")throw new Error(`padding.encode: non-string input=${N}`);for(;T.length*v%8;)T.push(b);return T},decode(T){if(!Array.isArray(T)||T.length&&typeof T[0]!="string")throw new Error("padding.encode input should be array of strings");for(let $ of T)if(typeof $!="string")throw new Error(`padding.decode: non-string input=${$}`);let N=T.length;if(N*v%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;N>0&&T[N-1]===b;N--)if(!((N-1)*v%8))throw new Error("Invalid padding: string has too much padding");return T.slice(0,N)}}}function lE(v){if(typeof v!="function")throw new Error("normalize fn should be function");return{encode:b=>b,decode:b=>v(b)}}function cE(v,b,T){if(b<2)throw new Error(`convertRadix: wrong from=${b}, base cannot be less than 2`);if(T<2)throw new Error(`convertRadix: wrong to=${T}, base cannot be less than 2`);if(!Array.isArray(v))throw new Error("convertRadix: data should be array");if(!v.length)return[];let N=0;const $=[],z=Array.from(v);for(z.forEach(q=>{if(Vl(q),q<0||q>=b)throw new Error(`Wrong integer: ${q}`)});;){let q=0,V=!0;for(let re=N;re<z.length;re++){const fe=z[re],ie=b*q+fe;if(!Number.isSafeInteger(ie)||b*q/b!==q||ie-fe!==b*q)throw new Error("convertRadix: carry overflow");if(q=ie%T,z[re]=Math.floor(ie/T),!Number.isSafeInteger(z[re])||z[re]*T+q!==ie)throw new Error("convertRadix: carry overflow");if(V)z[re]?V=!1:N=re;else continue}if($.push(q),V)break}for(let q=0;q<v.length-1&&v[q]===0;q++)$.push(0);return $.reverse()}const uE=(v,b)=>b?uE(b,v%b):v,Xh=(v,b)=>v+(b-uE(v,b));function py(v,b,T,N){if(!Array.isArray(v))throw new Error("convertRadix2: data should be array");if(b<=0||b>32)throw new Error(`convertRadix2: wrong from=${b}`);if(T<=0||T>32)throw new Error(`convertRadix2: wrong to=${T}`);if(Xh(b,T)>32)throw new Error(`convertRadix2: carry overflow from=${b} to=${T} carryBits=${Xh(b,T)}`);let $=0,z=0;const q=2**T-1,V=[];for(const re of v){if(Vl(re),re>=2**b)throw new Error(`convertRadix2: invalid data word=${re} from=${b}`);if($=$<<b|re,z+b>32)throw new Error(`convertRadix2: carry overflow pos=${z} from=${b}`);for(z+=b;z>=T;z-=T)V.push(($>>z-T&q)>>>0);$&=2**z-1}if($=$<<T-z&q,!N&&z>=b)throw new Error("Excess padding");if(!N&&$)throw new Error(`Non-zero padding: ${$}`);return N&&z>0&&V.push($>>>0),V}function dE(v){return Vl(v),{encode:b=>{if(!(b instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return cE(Array.from(b),256,v)},decode:b=>{if(!Array.isArray(b)||b.length&&typeof b[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(cE(b,v,256))}}}function bo(v,b=!1){if(Vl(v),v<=0||v>32)throw new Error("radix2: bits should be in (0..32]");if(Xh(8,v)>32||Xh(v,8)>32)throw new Error("radix2: carry overflow");return{encode:T=>{if(!(T instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return py(Array.from(T),8,v,!b)},decode:T=>{if(!Array.isArray(T)||T.length&&typeof T[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(py(T,v,8,b))}}}function fE(v){if(typeof v!="function")throw new Error("unsafeWrapper fn should be function");return function(...b){try{return v.apply(null,b)}catch{}}}function hE(v,b){if(Vl(v),typeof b!="function")throw new Error("checksum fn should be function");return{encode(T){if(!(T instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const N=b(T).slice(0,v),$=new Uint8Array(T.length+v);return $.set(T),$.set(N,T.length),$},decode(T){if(!(T instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const N=T.slice(0,-v),$=b(N).slice(0,v),z=T.slice(-v);for(let q=0;q<v;q++)if($[q]!==z[q])throw new Error("Invalid checksum");return N}}}const Yh={alphabet:Ps,chain:ds,checksum:hE,radix:dE,radix2:bo,join:Ms,padding:Nd},I6=ds(bo(4),Ps("0123456789ABCDEF"),Ms("")),P6=ds(bo(5),Ps("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Nd(5),Ms(""));ds(bo(5),Ps("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Nd(5),Ms("")),ds(bo(5),Ps("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Ms(""),lE(v=>v.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Rd=ds(bo(6),Ps("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Nd(6),Ms("")),M6=ds(bo(6),Ps("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Nd(6),Ms("")),my=v=>ds(dE(58),Ps(v),Ms("")),Jh=my("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");my("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),my("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const pE=[0,2,3,5,6,7,9,10,11],O6={encode(v){let b="";for(let T=0;T<v.length;T+=8){const N=v.subarray(T,T+8);b+=Jh.encode(N).padStart(pE[N.length],"1")}return b},decode(v){let b=[];for(let T=0;T<v.length;T+=11){const N=v.slice(T,T+11),$=pE.indexOf(N.length),z=Jh.decode(N);for(let q=0;q<z.length-$;q++)if(z[q]!==0)throw new Error("base58xmr: wrong padding");b=b.concat(Array.from(z.slice(z.length-$)))}return Uint8Array.from(b)}},N6=v=>ds(hE(4,b=>v(v(b))),Jh),gy=ds(Ps("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ms("")),mE=[996825010,642813549,513874426,1027748829,705979059];function Ld(v){const b=v>>25;let T=(v&33554431)<<5;for(let N=0;N<mE.length;N++)(b>>N&1)===1&&(T^=mE[N]);return T}function gE(v,b,T=1){const N=v.length;let $=1;for(let z=0;z<N;z++){const q=v.charCodeAt(z);if(q<33||q>126)throw new Error(`Invalid prefix (${v})`);$=Ld($)^q>>5}$=Ld($);for(let z=0;z<N;z++)$=Ld($)^v.charCodeAt(z)&31;for(let z of b)$=Ld($)^z;for(let z=0;z<6;z++)$=Ld($);return $^=T,gy.encode(py([$%2**30],30,5,!1))}function yE(v){const b=v==="bech32"?1:734539939,T=bo(5),N=T.decode,$=T.encode,z=fE(N);function q(ie,ue,W=90){if(typeof ie!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof ie}`);if(!Array.isArray(ue)||ue.length&&typeof ue[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof ue}`);const G=ie.length+7+ue.length;if(W!==!1&&G>W)throw new TypeError(`Length ${G} exceeds limit ${W}`);return ie=ie.toLowerCase(),`${ie}1${gy.encode(ue)}${gE(ie,ue,b)}`}function V(ie,ue=90){if(typeof ie!="string")throw new Error(`bech32.decode input should be string, not ${typeof ie}`);if(ie.length<8||ue!==!1&&ie.length>ue)throw new TypeError(`Wrong string length: ${ie.length} (${ie}). Expected (8..${ue})`);const W=ie.toLowerCase();if(ie!==W&&ie!==ie.toUpperCase())throw new Error("String must be lowercase or uppercase");ie=W;const G=ie.lastIndexOf("1");if(G===0||G===-1)throw new Error('Letter "1" must be present between prefix and data only');const te=ie.slice(0,G),ce=ie.slice(G+1);if(ce.length<6)throw new Error("Data must be at least 6 characters long");const be=gy.decode(ce).slice(0,-6),ve=gE(te,be,b);if(!ce.endsWith(ve))throw new Error(`Invalid checksum in ${ie}: expected "${ve}"`);return{prefix:te,words:be}}const re=fE(V);function fe(ie){const{prefix:ue,words:W}=V(ie,!1);return{prefix:ue,words:W,bytes:N(W)}}return{encode:q,decode:V,decodeToBytes:fe,decodeUnsafe:re,fromWords:N,fromWordsUnsafe:z,toWords:$}}const ii=yE("bech32");yE("bech32m");const R6={encode:v=>new TextDecoder().decode(v),decode:v=>new TextEncoder().encode(v)},L6=ds(bo(4),Ps("0123456789abcdef"),Ms(""),lE(v=>{if(typeof v!="string"||v.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof v} with length ${v.length}`);return v.toLowerCase()}));`${Object.keys({utf8:R6,hex:L6,base16:I6,base32:P6,base64:Rd,base64url:M6,base58:Jh,base58xmr:O6}).join(", ")}`;var Dd={};Object.defineProperty(Dd,"__esModule",{value:!0}),Dd.wordlist=void 0,Dd.wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);var Tr={};Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.mnemonicToSeedSync=Tr.mnemonicToSeed=Tr.validateMnemonic=Tr.entropyToMnemonic=Tr.mnemonicToEntropy=Tr.generateMnemonic=void 0;var jl={};Object.defineProperty(jl,"__esModule",{value:!0}),jl.pbkdf2Async=jl.pbkdf2=void 0;var wo={};Object.defineProperty(wo,"__esModule",{value:!0}),wo.hmac=void 0;class bE extends Ne.Hash{constructor(b,T){super(),this.finished=!1,this.destroyed=!1,Bt.default.hash(b);const N=(0,Ne.toBytes)(T);if(this.iHash=b.create(),typeof this.iHash.update!="function")throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const $=this.blockLen,z=new Uint8Array($);z.set(N.length>$?b.create().update(N).digest():N);for(let q=0;q<z.length;q++)z[q]^=54;this.iHash.update(z),this.oHash=b.create();for(let q=0;q<z.length;q++)z[q]^=106;this.oHash.update(z),z.fill(0)}update(b){return Bt.default.exists(this),this.iHash.update(b),this}digestInto(b){Bt.default.exists(this),Bt.default.bytes(b,this.outputLen),this.finished=!0,this.iHash.digestInto(b),this.oHash.update(b),this.oHash.digestInto(b),this.destroy()}digest(){const b=new Uint8Array(this.oHash.outputLen);return this.digestInto(b),b}_cloneInto(b){b||(b=Object.create(Object.getPrototypeOf(this),{}));const{oHash:T,iHash:N,finished:$,destroyed:z,blockLen:q,outputLen:V}=this;return b.finished=$,b.destroyed=z,b.blockLen=q,b.outputLen=V,b.oHash=T._cloneInto(b.oHash),b.iHash=N._cloneInto(b.iHash),b}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const D6=(v,b,T)=>new bE(v,b).update(T).digest();wo.hmac=D6,wo.hmac.create=(v,b)=>new bE(v,b);function wE(v,b,T,N){Bt.default.hash(v);const $=(0,Ne.checkOpts)({dkLen:32,asyncTick:10},N),{c:z,dkLen:q,asyncTick:V}=$;if(Bt.default.number(z),Bt.default.number(q),Bt.default.number(V),z<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const re=(0,Ne.toBytes)(b),fe=(0,Ne.toBytes)(T),ie=new Uint8Array(q),ue=wo.hmac.create(v,re),W=ue._cloneInto().update(fe);return{c:z,dkLen:q,asyncTick:V,DK:ie,PRF:ue,PRFSalt:W}}function vE(v,b,T,N,$){return v.destroy(),b.destroy(),N&&N.destroy(),$.fill(0),T}function B6(v,b,T,N){const{c:$,dkLen:z,DK:q,PRF:V,PRFSalt:re}=wE(v,b,T,N);let fe;const ie=new Uint8Array(4),ue=(0,Ne.createView)(ie),W=new Uint8Array(V.outputLen);for(let G=1,te=0;te<z;G++,te+=V.outputLen){const ce=q.subarray(te,te+V.outputLen);ue.setInt32(0,G,!1),(fe=re._cloneInto(fe)).update(ie).digestInto(W),ce.set(W.subarray(0,ce.length));for(let be=1;be<$;be++){V._cloneInto(fe).update(W).digestInto(W);for(let ve=0;ve<ce.length;ve++)ce[ve]^=W[ve]}}return vE(V,re,q,fe,W)}jl.pbkdf2=B6;async function $6(v,b,T,N){const{c:$,dkLen:z,asyncTick:q,DK:V,PRF:re,PRFSalt:fe}=wE(v,b,T,N);let ie;const ue=new Uint8Array(4),W=(0,Ne.createView)(ue),G=new Uint8Array(re.outputLen);for(let te=1,ce=0;ce<z;te++,ce+=re.outputLen){const be=V.subarray(ce,ce+re.outputLen);W.setInt32(0,te,!1),(ie=fe._cloneInto(ie)).update(ue).digestInto(G),be.set(G.subarray(0,be.length)),await(0,Ne.asyncLoop)($-1,q,ve=>{re._cloneInto(ie).update(G).digestInto(G);for(let De=0;De<be.length;De++)be[De]^=G[De]})}return vE(re,fe,V,ie,G)}jl.pbkdf2Async=$6;var jr={};Object.defineProperty(jr,"__esModule",{value:!0}),jr.sha384=jr.sha512_256=jr.sha512_224=jr.sha512=jr.SHA512=void 0;var gt={};Object.defineProperty(gt,"__esModule",{value:!0}),gt.add=gt.toBig=gt.split=gt.fromBig=void 0;const ep=BigInt(2**32-1),yy=BigInt(32);function by(v,b=!1){return b?{h:Number(v&ep),l:Number(v>>yy&ep)}:{h:Number(v>>yy&ep)|0,l:Number(v&ep)|0}}gt.fromBig=by;function xE(v,b=!1){let T=new Uint32Array(v.length),N=new Uint32Array(v.length);for(let $=0;$<v.length;$++){const{h:z,l:q}=by(v[$],b);[T[$],N[$]]=[z,q]}return[T,N]}gt.split=xE;const F6=(v,b)=>BigInt(v>>>0)<<yy|BigInt(b>>>0);gt.toBig=F6;const z6=(v,b,T)=>v>>>T,U6=(v,b,T)=>v<<32-T|b>>>T,H6=(v,b,T)=>v>>>T|b<<32-T,V6=(v,b,T)=>v<<32-T|b>>>T,j6=(v,b,T)=>v<<64-T|b>>>T-32,W6=(v,b,T)=>v>>>T-32|b<<64-T,q6=(v,b)=>b,K6=(v,b)=>v,G6=(v,b,T)=>v<<T|b>>>32-T,Z6=(v,b,T)=>b<<T|v>>>32-T,Q6=(v,b,T)=>b<<T-32|v>>>64-T,X6=(v,b,T)=>v<<T-32|b>>>64-T;function SE(v,b,T,N){const $=(b>>>0)+(N>>>0);return{h:v+T+($/2**32|0)|0,l:$|0}}gt.add=SE;const Y6=(v,b,T)=>(v>>>0)+(b>>>0)+(T>>>0),J6=(v,b,T,N)=>b+T+N+(v/2**32|0)|0,eL=(v,b,T,N)=>(v>>>0)+(b>>>0)+(T>>>0)+(N>>>0),tL=(v,b,T,N,$)=>b+T+N+$+(v/2**32|0)|0,nL=(v,b,T,N,$)=>(v>>>0)+(b>>>0)+(T>>>0)+(N>>>0)+($>>>0),rL=(v,b,T,N,$,z)=>b+T+N+$+z+(v/2**32|0)|0,iL={fromBig:by,split:xE,toBig:gt.toBig,shrSH:z6,shrSL:U6,rotrSH:H6,rotrSL:V6,rotrBH:j6,rotrBL:W6,rotr32H:q6,rotr32L:K6,rotlSH:G6,rotlSL:Z6,rotlBH:Q6,rotlBL:X6,add:SE,add3L:Y6,add3H:J6,add4L:eL,add4H:tL,add5H:rL,add5L:nL};gt.default=iL;const[sL,oL]=gt.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(v=>BigInt(v))),xa=new Uint32Array(80),Sa=new Uint32Array(80);class Bd extends ya.SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:b,Al:T,Bh:N,Bl:$,Ch:z,Cl:q,Dh:V,Dl:re,Eh:fe,El:ie,Fh:ue,Fl:W,Gh:G,Gl:te,Hh:ce,Hl:be}=this;return[b,T,N,$,z,q,V,re,fe,ie,ue,W,G,te,ce,be]}set(b,T,N,$,z,q,V,re,fe,ie,ue,W,G,te,ce,be){this.Ah=b|0,this.Al=T|0,this.Bh=N|0,this.Bl=$|0,this.Ch=z|0,this.Cl=q|0,this.Dh=V|0,this.Dl=re|0,this.Eh=fe|0,this.El=ie|0,this.Fh=ue|0,this.Fl=W|0,this.Gh=G|0,this.Gl=te|0,this.Hh=ce|0,this.Hl=be|0}process(b,T){for(let Ce=0;Ce<16;Ce++,T+=4)xa[Ce]=b.getUint32(T),Sa[Ce]=b.getUint32(T+=4);for(let Ce=16;Ce<80;Ce++){const qe=xa[Ce-15]|0,ze=Sa[Ce-15]|0,Fe=gt.default.rotrSH(qe,ze,1)^gt.default.rotrSH(qe,ze,8)^gt.default.shrSH(qe,ze,7),Ke=gt.default.rotrSL(qe,ze,1)^gt.default.rotrSL(qe,ze,8)^gt.default.shrSL(qe,ze,7),it=xa[Ce-2]|0,Xt=Sa[Ce-2]|0,Y=gt.default.rotrSH(it,Xt,19)^gt.default.rotrBH(it,Xt,61)^gt.default.shrSH(it,Xt,6),ee=gt.default.rotrSL(it,Xt,19)^gt.default.rotrBL(it,Xt,61)^gt.default.shrSL(it,Xt,6),Z=gt.default.add4L(Ke,ee,Sa[Ce-7],Sa[Ce-16]),ae=gt.default.add4H(Z,Fe,Y,xa[Ce-7],xa[Ce-16]);xa[Ce]=ae|0,Sa[Ce]=Z|0}let{Ah:N,Al:$,Bh:z,Bl:q,Ch:V,Cl:re,Dh:fe,Dl:ie,Eh:ue,El:W,Fh:G,Fl:te,Gh:ce,Gl:be,Hh:ve,Hl:De}=this;for(let Ce=0;Ce<80;Ce++){const qe=gt.default.rotrSH(ue,W,14)^gt.default.rotrSH(ue,W,18)^gt.default.rotrBH(ue,W,41),ze=gt.default.rotrSL(ue,W,14)^gt.default.rotrSL(ue,W,18)^gt.default.rotrBL(ue,W,41),Fe=ue&G^~ue&ce,Ke=W&te^~W&be,it=gt.default.add5L(De,ze,Ke,oL[Ce],Sa[Ce]),Xt=gt.default.add5H(it,ve,qe,Fe,sL[Ce],xa[Ce]),Y=it|0,ee=gt.default.rotrSH(N,$,28)^gt.default.rotrBH(N,$,34)^gt.default.rotrBH(N,$,39),Z=gt.default.rotrSL(N,$,28)^gt.default.rotrBL(N,$,34)^gt.default.rotrBL(N,$,39),ae=N&z^N&V^z&V,me=$&q^$&re^q&re;ve=ce|0,De=be|0,ce=G|0,be=te|0,G=ue|0,te=W|0,{h:ue,l:W}=gt.default.add(fe|0,ie|0,Xt|0,Y|0),fe=V|0,ie=re|0,V=z|0,re=q|0,z=N|0,q=$|0;const ke=gt.default.add3L(Y,Z,me);N=gt.default.add3H(ke,Xt,ee,ae),$=ke|0}({h:N,l:$}=gt.default.add(this.Ah|0,this.Al|0,N|0,$|0)),{h:z,l:q}=gt.default.add(this.Bh|0,this.Bl|0,z|0,q|0),{h:V,l:re}=gt.default.add(this.Ch|0,this.Cl|0,V|0,re|0),{h:fe,l:ie}=gt.default.add(this.Dh|0,this.Dl|0,fe|0,ie|0),{h:ue,l:W}=gt.default.add(this.Eh|0,this.El|0,ue|0,W|0),{h:G,l:te}=gt.default.add(this.Fh|0,this.Fl|0,G|0,te|0),{h:ce,l:be}=gt.default.add(this.Gh|0,this.Gl|0,ce|0,be|0),{h:ve,l:De}=gt.default.add(this.Hh|0,this.Hl|0,ve|0,De|0),this.set(N,$,z,q,V,re,fe,ie,ue,W,G,te,ce,be,ve,De)}roundClean(){xa.fill(0),Sa.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}jr.SHA512=Bd;class aL extends Bd{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class lL extends Bd{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class cL extends Bd{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}jr.sha512=(0,Ne.wrapConstructor)(()=>new Bd),jr.sha512_224=(0,Ne.wrapConstructor)(()=>new aL),jr.sha512_256=(0,Ne.wrapConstructor)(()=>new lL),jr.sha384=(0,Ne.wrapConstructor)(()=>new cL);const uL=v=>v[0]==="ãããããã";function EE(v){if(typeof v!="string")throw new TypeError(`Invalid mnemonic type: ${typeof v}`);return v.normalize("NFKD")}function wy(v){const b=EE(v),T=b.split(" ");if(![12,15,18,21,24].includes(T.length))throw new Error("Invalid mnemonic");return{nfkd:b,words:T}}function kE(v){Bt.default.bytes(v,16,20,24,28,32)}function dL(v,b=128){if(Bt.default.number(b),b%32!==0||b>256)throw new TypeError("Invalid entropy");return CE((0,Ne.randomBytes)(b/8),v)}Tr.generateMnemonic=dL;const fL=v=>{const b=8-v.length/4;return new Uint8Array([(0,kr.sha256)(v)[0]>>b<<b])};function TE(v){if(!Array.isArray(v)||v.length!==2048||typeof v[0]!="string")throw new Error("Worlist: expected array of 2048 strings");return v.forEach(b=>{if(typeof b!="string")throw new Error(`Wordlist: non-string element: ${b}`)}),Yh.chain(Yh.checksum(1,fL),Yh.radix2(11,!0),Yh.alphabet(v))}function _E(v,b){const{words:T}=wy(v),N=TE(b).decode(T);return kE(N),N}Tr.mnemonicToEntropy=_E;function CE(v,b){return kE(v),TE(b).encode(v).join(uL(b)?"ã":" ")}Tr.entropyToMnemonic=CE;function hL(v,b){try{_E(v,b)}catch{return!1}return!0}Tr.validateMnemonic=hL;const AE=v=>EE(`mnemonic${v}`);function pL(v,b=""){return(0,jl.pbkdf2Async)(jr.sha512,wy(v).nfkd,AE(b),{c:2048,dkLen:64})}Tr.mnemonicToSeed=pL;function mL(v,b=""){return(0,jl.pbkdf2)(jr.sha512,wy(v).nfkd,AE(b),{c:2048,dkLen:64})}Tr.mnemonicToSeedSync=mL;var Xc={};Object.defineProperty(Xc,"__esModule",{value:!0}),Xc.ripemd160=Xc.RIPEMD160=void 0;const gL=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),IE=Uint8Array.from({length:16},(v,b)=>b),yL=IE.map(v=>(9*v+5)%16);let vy=[IE],xy=[yL];for(let v=0;v<4;v++)for(let b of[vy,xy])b.push(b[v].map(T=>gL[T]));const PE=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(v=>new Uint8Array(v)),bL=vy.map((v,b)=>v.map(T=>PE[b][T])),wL=xy.map((v,b)=>v.map(T=>PE[b][T])),vL=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),xL=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),tp=(v,b)=>v<<b|v>>>32-b;function ME(v,b,T,N){return v===0?b^T^N:v===1?b&T|~b&N:v===2?(b|~T)^N:v===3?b&N|T&~N:b^(T|~N)}const np=new Uint32Array(16);class OE extends ya.SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:b,h1:T,h2:N,h3:$,h4:z}=this;return[b,T,N,$,z]}set(b,T,N,$,z){this.h0=b|0,this.h1=T|0,this.h2=N|0,this.h3=$|0,this.h4=z|0}process(b,T){for(let G=0;G<16;G++,T+=4)np[G]=b.getUint32(T,!0);let N=this.h0|0,$=N,z=this.h1|0,q=z,V=this.h2|0,re=V,fe=this.h3|0,ie=fe,ue=this.h4|0,W=ue;for(let G=0;G<5;G++){const te=4-G,ce=vL[G],be=xL[G],ve=vy[G],De=xy[G],Ce=bL[G],qe=wL[G];for(let ze=0;ze<16;ze++){const Fe=tp(N+ME(G,z,V,fe)+np[ve[ze]]+ce,Ce[ze])+ue|0;N=ue,ue=fe,fe=tp(V,10)|0,V=z,z=Fe}for(let ze=0;ze<16;ze++){const Fe=tp($+ME(te,q,re,ie)+np[De[ze]]+be,qe[ze])+W|0;$=W,W=ie,ie=tp(re,10)|0,re=q,q=Fe}}this.set(this.h1+V+ie|0,this.h2+fe+W|0,this.h3+ue+$|0,this.h4+N+q|0,this.h0+z+re|0)}roundClean(){np.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}Xc.RIPEMD160=OE,Xc.ripemd160=(0,Ne.wrapConstructor)(()=>new OE),St.hmacSha256Sync=(v,...b)=>(0,wo.hmac)(kr.sha256,v,St.concatBytes(...b));const Sy=N6(kr.sha256);function NE(v){return BigInt(`0x${(0,Ne.bytesToHex)(v)}`)}function SL(v){return(0,Ne.hexToBytes)(v.toString(16).padStart(64,"0"))}const EL=(0,Ne.utf8ToBytes)("Bitcoin seed"),Ey={private:76066276,public:76067358},ky=2147483648,kL=v=>(0,Xc.ripemd160)((0,kr.sha256)(v)),TL=v=>(0,Ne.createView)(v).getUint32(0,!1),rp=v=>{if(!Number.isSafeInteger(v)||v<0||v>2**32-1)throw new Error(`Invalid number=${v}. Should be from 0 to 2 ** 32 - 1`);const b=new Uint8Array(4);return(0,Ne.createView)(b).setUint32(0,v,!1),b};class Wl{constructor(b){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!b||typeof b!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=b.versions||Ey,this.depth=b.depth||0,this.chainCode=b.chainCode,this.index=b.index||0,this.parentFingerprint=b.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(b.publicKey&&b.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(b.privateKey){if(!St.isValidPrivateKey(b.privateKey))throw new Error("Invalid private key");this.privKey=typeof b.privateKey=="bigint"?b.privateKey:NE(b.privateKey),this.privKeyBytes=SL(this.privKey),this.pubKey=Oe(b.privateKey,!0)}else if(b.publicKey)this.pubKey=I.fromHex(b.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=kL(this.pubKey)}get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return TL(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const b=this.privateKey;if(!b)throw new Error("No private key");return Sy.encode(this.serialize(this.versions.private,(0,Ne.concatBytes)(new Uint8Array([0]),b)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return Sy.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(b,T=Ey){if((0,Bt.bytes)(b),8*b.length<128||8*b.length>512)throw new Error(`HDKey: wrong seed length=${b.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const N=(0,wo.hmac)(jr.sha512,EL,b);return new Wl({versions:T,chainCode:N.slice(32),privateKey:N.slice(0,32)})}static fromExtendedKey(b,T=Ey){const N=Sy.decode(b),$=(0,Ne.createView)(N),z=$.getUint32(0,!1),q={versions:T,depth:N[4],parentFingerprint:$.getUint32(5,!1),index:$.getUint32(9,!1),chainCode:N.slice(13,45)},V=N.slice(45),re=V[0]===0;if(z!==T[re?"private":"public"])throw new Error("Version mismatch");return re?new Wl({...q,privateKey:V.slice(1)}):new Wl({...q,publicKey:V})}static fromJSON(b){return Wl.fromExtendedKey(b.xpriv)}derive(b){if(!/^[mM]'?/.test(b))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(b))return this;const T=b.replace(/^[mM]'?\//,"").split("/");let N=this;for(const $ of T){const z=/^(\d+)('?)$/.exec($);if(!z||z.length!==3)throw new Error(`Invalid child index: ${$}`);let q=+z[1];if(!Number.isSafeInteger(q)||q>=ky)throw new Error("Invalid index");z[2]==="'"&&(q+=ky),N=N.deriveChild(q)}return N}deriveChild(b){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let T=rp(b);if(b>=ky){const V=this.privateKey;if(!V)throw new Error("Could not derive hardened child key");T=(0,Ne.concatBytes)(new Uint8Array([0]),V,T)}else T=(0,Ne.concatBytes)(this.pubKey,T);const N=(0,wo.hmac)(jr.sha512,this.chainCode,T),$=NE(N.slice(0,32)),z=N.slice(32);if(!St.isValidPrivateKey($))throw new Error("Tweak bigger than curve order");const q={versions:this.versions,chainCode:z,depth:this.depth+1,parentFingerprint:this.fingerprint,index:b};try{if(this.privateKey){const V=St.mod(this.privKey+$,f.n);if(!St.isValidPrivateKey(V))throw new Error("The tweak was out of range or the resulted private key is invalid");q.privateKey=V}else{const V=I.fromHex(this.pubKey).add(I.fromPrivateKey($));if(V.equals(I.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");q.publicKey=V.toRawBytes(!0)}return new Wl(q)}catch{return this.deriveChild(b+1)}}sign(b){if(!this.privateKey)throw new Error("No privateKey set!");return(0,Bt.bytes)(b,32),_t(b,this.privKey,{canonical:!0,der:!1})}verify(b,T){if((0,Bt.bytes)(b,32),(0,Bt.bytes)(T,64),!this.publicKey)throw new Error("No publicKey set!");let N;try{N=R.fromCompact(T)}catch{return!1}return un(N,b,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(b,T){if(!this.chainCode)throw new Error("No chainCode set");return(0,Bt.bytes)(T,33),(0,Ne.concatBytes)(rp(b),new Uint8Array([this.depth]),rp(this.parentFingerprint),rp(this.index),this.chainCode,T)}}var _L=Object.defineProperty,si=(v,b)=>{for(var T in b)_L(v,T,{get:b[T],enumerable:!0})};function CL(){return St.bytesToHex(St.randomPrivateKey())}function RE(v){return St.bytesToHex(Ti.getPublicKey(v))}var AL={};si(AL,{insertEventIntoAscendingList:()=>PL,insertEventIntoDescendingList:()=>IL,normalizeURL:()=>Ty,utf8Decoder:()=>Ea,utf8Encoder:()=>Os});var Ea=new TextDecoder("utf-8"),Os=new TextEncoder;function Ty(v){let b=new URL(v);return b.pathname=b.pathname.replace(/\/+/g,"/"),b.pathname.endsWith("/")&&(b.pathname=b.pathname.slice(0,-1)),(b.port==="80"&&b.protocol==="ws:"||b.port==="443"&&b.protocol==="wss:")&&(b.port=""),b.searchParams.sort(),b.hash="",b.toString()}function IL(v,b){let T=0,N=v.length-1,$,z=T;if(N<0)z=0;else if(b.created_at<v[N].created_at)z=N+1;else if(b.created_at>=v[T].created_at)z=T;else for(;;){if(N<=T+1){z=N;break}if($=Math.floor(T+(N-T)/2),v[$].created_at>b.created_at)T=$;else if(v[$].created_at<b.created_at)N=$;else{z=$;break}}return v[z]?.id!==b.id?[...v.slice(0,z),b,...v.slice(z)]:v}function PL(v,b){let T=0,N=v.length-1,$,z=T;if(N<0)z=0;else if(b.created_at>v[N].created_at)z=N+1;else if(b.created_at<=v[T].created_at)z=T;else for(;;){if(N<=T+1){z=N;break}if($=Math.floor(T+(N-T)/2),v[$].created_at<b.created_at)T=$;else if(v[$].created_at>b.created_at)N=$;else{z=$;break}}return v[z]?.id!==b.id?[...v.slice(0,z),b,...v.slice(z)]:v}function ML(v,b){let T=v;return T.pubkey=RE(b),T.id=_y(T),T.sig=RL(T,b),T}function OL(v){if(!Cy(v))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,v.pubkey,v.created_at,v.kind,v.tags,v.content])}function _y(v){let b=(0,kr.sha256)(Os.encode(OL(v)));return St.bytesToHex(b)}var NL=v=>v instanceof Object;function Cy(v){if(!NL(v)||typeof v.kind!="number"||typeof v.content!="string"||typeof v.created_at!="number"||typeof v.pubkey!="string"||!v.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(v.tags))return!1;for(let b=0;b<v.tags.length;b++){let T=v.tags[b];if(!Array.isArray(T))return!1;for(let N=0;N<T.length;N++)if(typeof T[N]=="object")return!1}return!0}function LE(v){return Ti.verifySync(v.sig,_y(v),v.pubkey)}function RL(v,b){return St.bytesToHex(Ti.signSync(_y(v),b))}function LL(v,b){if(v.ids&&v.ids.indexOf(b.id)===-1&&!v.ids.some(T=>b.id.startsWith(T))||v.kinds&&v.kinds.indexOf(b.kind)===-1||v.authors&&v.authors.indexOf(b.pubkey)===-1&&!v.authors.some(T=>b.pubkey.startsWith(T)))return!1;for(let T in v)if(T[0]==="#"){let N=T.slice(1),$=v[`#${N}`];if($&&!b.tags.find(([z,q])=>z===T.slice(1)&&$.indexOf(q)!==-1))return!1}return!(v.since&&b.created_at<v.since||v.until&&b.created_at>=v.until)}function DL(v,b){for(let T=0;T<v.length;T++)if(LL(v[T],b))return!0;return!1}var BL={};si(BL,{getHex64:()=>ip,getInt:()=>DE,getSubscriptionId:()=>BE,matchEventId:()=>$L,matchEventKind:()=>zL,matchEventPubkey:()=>FL});function ip(v,b){let T=b.length+3,N=v.indexOf(`"${b}":`)+T,$=v.slice(N).indexOf('"')+N+1;return v.slice($,$+64)}function DE(v,b){let T=b.length,N=v.indexOf(`"${b}":`)+T+3,$=v.slice(N),z=Math.min($.indexOf(","),$.indexOf("}"));return parseInt($.slice(0,z),10)}function BE(v){let b=v.slice(0,22).indexOf('"EVENT"');if(b===-1)return null;let T=v.slice(b+7+1).indexOf('"');if(T===-1)return null;let N=b+7+1+T,$=v.slice(N+1,80).indexOf('"');if($===-1)return null;let z=N+1+$;return v.slice(N+1,z)}function $L(v,b){return b===ip(v,"id")}function FL(v,b){return b===ip(v,"pubkey")}function zL(v,b){return b===DE(v,"kind")}var $E=()=>({connect:[],disconnect:[],error:[],notice:[],auth:[]});function UL(v,b={}){let{listTimeout:T=3e3,getTimeout:N=3e3,countTimeout:$=3e3}=b;var z,q={},V=$E(),re={},fe={},ie;async function ue(){return ie||(ie=new Promise((ve,De)=>{try{z=new WebSocket(v)}catch(Fe){De(Fe)}z.onopen=()=>{V.connect.forEach(Fe=>Fe()),ve()},z.onerror=()=>{ie=void 0,V.error.forEach(Fe=>Fe()),De()},z.onclose=async()=>{ie=void 0,V.disconnect.forEach(Fe=>Fe())};let Ce=[],qe;z.onmessage=Fe=>{Ce.push(Fe.data),qe||(qe=setInterval(ze,0))};function ze(){if(Ce.length===0){clearInterval(qe),qe=null;return}var Fe=Ce.shift();if(!Fe)return;let Ke=BE(Fe);if(Ke){let it=q[Ke];if(it&&it.alreadyHaveEvent&&it.alreadyHaveEvent(ip(Fe,"id"),v))return}try{let it=JSON.parse(Fe);switch(it[0]){case"EVENT":{let Z=it[1],ae=it[2];Cy(ae)&&q[Z]&&(q[Z].skipVerification||LE(ae))&&DL(q[Z].filters,ae)&&(q[Z],(re[Z]?.event||[]).forEach(me=>me(ae)));return}case"COUNT":let Xt=it[1],Y=it[2];q[Xt]&&(re[Xt]?.count||[]).forEach(Z=>Z(Y));return;case"EOSE":{let Z=it[1];Z in re&&(re[Z].eose.forEach(ae=>ae()),re[Z].eose=[]);return}case"OK":{let Z=it[1],ae=it[2],me=it[3]||"";Z in fe&&(ae?fe[Z].ok.forEach(ke=>ke()):fe[Z].failed.forEach(ke=>ke(me)),fe[Z].ok=[],fe[Z].failed=[]);return}case"NOTICE":let ee=it[1];V.notice.forEach(Z=>Z(ee));return;case"AUTH":{let Z=it[1];V.auth?.forEach(ae=>ae(Z));return}}}catch{return}}}),ie)}function W(){return z?.readyState===1}async function G(){W()||await ue()}async function te(ve){let De=JSON.stringify(ve);if(!(!W()&&(await new Promise(Ce=>setTimeout(Ce,1e3)),!W())))try{z.send(De)}catch(Ce){console.log(Ce)}}const ce=(ve,{verb:De="REQ",skipVerification:Ce=!1,alreadyHaveEvent:qe=null,id:ze=Math.random().toString().slice(2)}={})=>{let Fe=ze;return q[Fe]={id:Fe,filters:ve,skipVerification:Ce,alreadyHaveEvent:qe},te([De,Fe,...ve]),{sub:(Ke,it={})=>ce(Ke||ve,{skipVerification:it.skipVerification||Ce,alreadyHaveEvent:it.alreadyHaveEvent||qe,id:Fe}),unsub:()=>{delete q[Fe],delete re[Fe],te(["CLOSE",Fe])},on:(Ke,it)=>{re[Fe]=re[Fe]||{event:[],count:[],eose:[]},re[Fe][Ke].push(it)},off:(Ke,it)=>{let Xt=re[Fe],Y=Xt[Ke].indexOf(it);Y>=0&&Xt[Ke].splice(Y,1)}}};function be(ve,De){if(!ve.id)throw new Error(`event ${ve} has no id`);let Ce=ve.id;return te([De,ve]),{on:(qe,ze)=>{fe[Ce]=fe[Ce]||{ok:[],failed:[]},fe[Ce][qe].push(ze)},off:(qe,ze)=>{let Fe=fe[Ce];if(!Fe)return;let Ke=Fe[qe].indexOf(ze);Ke>=0&&Fe[qe].splice(Ke,1)}}}return{url:v,sub:ce,on:(ve,De)=>{V[ve].push(De),ve==="connect"&&z?.readyState===1&&De()},off:(ve,De)=>{let Ce=V[ve].indexOf(De);Ce!==-1&&V[ve].splice(Ce,1)},list:(ve,De)=>new Promise(Ce=>{let qe=ce(ve,De),ze=[],Fe=setTimeout(()=>{qe.unsub(),Ce(ze)},T);qe.on("eose",()=>{qe.unsub(),clearTimeout(Fe),Ce(ze)}),qe.on("event",Ke=>{ze.push(Ke)})}),get:(ve,De)=>new Promise(Ce=>{let qe=ce([ve],De),ze=setTimeout(()=>{qe.unsub(),Ce(null)},N);qe.on("event",Fe=>{qe.unsub(),clearTimeout(ze),Ce(Fe)})}),count:ve=>new Promise(De=>{let Ce=ce(ve,{...ce,verb:"COUNT"}),qe=setTimeout(()=>{Ce.unsub(),De(null)},$);Ce.on("count",ze=>{Ce.unsub(),clearTimeout(qe),De(ze)})}),publish(ve){return be(ve,"EVENT")},auth(ve){return be(ve,"AUTH")},connect:G,close(){V=$E(),re={},fe={},z.readyState===WebSocket.OPEN&&z?.close()},get status(){return z?.readyState??3}}}var FE=class{_conn;_seenOn={};eoseSubTimeout;getTimeout;constructor(v={}){this._conn={},this.eoseSubTimeout=v.eoseSubTimeout||3400,this.getTimeout=v.getTimeout||3400}close(v){v.forEach(b=>{let T=this._conn[Ty(b)];T&&T.close()})}async ensureRelay(v){const b=Ty(v);this._conn[b]||(this._conn[b]=UL(b,{getTimeout:this.getTimeout*.9,listTimeout:this.getTimeout*.9}));const T=this._conn[b];return await T.connect(),T}sub(v,b,T){let N=new Set,$={...T||{}};$.alreadyHaveEvent=(W,G)=>{if(T?.alreadyHaveEvent?.(W,G))return!0;let te=this._seenOn[W]||new Set;return te.add(G),this._seenOn[W]=te,N.has(W)};let z=[],q=new Set,V=new Set,re=v.length,fe=!1,ie=setTimeout(()=>{fe=!0;for(let W of V.values())W()},this.eoseSubTimeout);v.forEach(async W=>{let G;try{G=await this.ensureRelay(W)}catch{ce();return}if(!G)return;let te=G.sub(b,$);te.on("event",be=>{N.add(be.id);for(let ve of q.values())ve(be)}),te.on("eose",()=>{fe||ce()}),z.push(te);function ce(){if(re--,re===0){clearTimeout(ie);for(let be of V.values())be()}}});let ue={sub(W,G){return z.forEach(te=>te.sub(W,G)),ue},unsub(){z.forEach(W=>W.unsub())},on(W,G){W==="event"?q.add(G):W==="eose"&&V.add(G)},off(W,G){W==="event"?q.delete(G):W==="eose"&&V.delete(G)}};return ue}get(v,b,T){return new Promise(N=>{let $=this.sub(v,[b],T),z=setTimeout(()=>{$.unsub(),N(null)},this.getTimeout);$.on("event",q=>{N(q),clearTimeout(z),$.unsub()})})}list(v,b,T){return new Promise(N=>{let $=[],z=this.sub(v,b,T);z.on("event",q=>{$.push(q)}),z.on("eose",()=>{z.unsub(),N($)})})}publish(v,b){const T=v.map(async $=>{let z;try{return z=await this.ensureRelay($),z.publish(b)}catch{return{on(){},off(){}}}}),N=new Map;return{on($,z){v.forEach(async(q,V)=>{let re=await T[V],fe=()=>z(q);N.set(z,fe),re.on($,fe)})},off($,z){v.forEach(async(q,V)=>{let re=N.get(z);re&&(await T[V]).off($,re)})}}}seenOn(v){return Array.from(this._seenOn[v]?.values?.()||[])}},Ay={};si(Ay,{decode:()=>sp,naddrEncode:()=>KL,neventEncode:()=>qL,noteEncode:()=>jL,nprofileEncode:()=>WL,npubEncode:()=>VL,nrelayEncode:()=>GL,nsecEncode:()=>HL});var Yc=5e3;function sp(v){let{prefix:b,words:T}=ii.decode(v,Yc),N=new Uint8Array(ii.fromWords(T));switch(b){case"nprofile":{let $=op(N);if(!$[0]?.[0])throw new Error("missing TLV 0 for nprofile");if($[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:St.bytesToHex($[0][0]),relays:$[1]?$[1].map(z=>Ea.decode(z)):[]}}}case"nevent":{let $=op(N);if(!$[0]?.[0])throw new Error("missing TLV 0 for nevent");if($[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if($[2]&&$[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");return{type:"nevent",data:{id:St.bytesToHex($[0][0]),relays:$[1]?$[1].map(z=>Ea.decode(z)):[],author:$[2]?.[0]?St.bytesToHex($[2][0]):void 0}}}case"naddr":{let $=op(N);if(!$[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!$[2]?.[0])throw new Error("missing TLV 2 for naddr");if($[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!$[3]?.[0])throw new Error("missing TLV 3 for naddr");if($[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ea.decode($[0][0]),pubkey:St.bytesToHex($[2][0]),kind:parseInt(St.bytesToHex($[3][0]),16),relays:$[1]?$[1].map(z=>Ea.decode(z)):[]}}}case"nrelay":{let $=op(N);if(!$[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Ea.decode($[0][0])}}case"nsec":case"npub":case"note":return{type:b,data:St.bytesToHex(N)};default:throw new Error(`unknown prefix ${b}`)}}function op(v){let b={},T=v;for(;T.length>0;){let N=T[0],$=T[1],z=T.slice(2,2+$);T=T.slice(2+$),!(z.length<$)&&(b[N]=b[N]||[],b[N].push(z))}return b}function HL(v){return Iy("nsec",v)}function VL(v){return Iy("npub",v)}function jL(v){return Iy("note",v)}function Iy(v,b){let T=St.hexToBytes(b),N=ii.toWords(T);return ii.encode(v,N,Yc)}function WL(v){let b=ap({0:[St.hexToBytes(v.pubkey)],1:(v.relays||[]).map(N=>Os.encode(N))}),T=ii.toWords(b);return ii.encode("nprofile",T,Yc)}function qL(v){let b=ap({0:[St.hexToBytes(v.id)],1:(v.relays||[]).map(N=>Os.encode(N)),2:v.author?[St.hexToBytes(v.author)]:[]}),T=ii.toWords(b);return ii.encode("nevent",T,Yc)}function KL(v){let b=new ArrayBuffer(4);new DataView(b).setUint32(0,v.kind,!1);let T=ap({0:[Os.encode(v.identifier)],1:(v.relays||[]).map($=>Os.encode($)),2:[St.hexToBytes(v.pubkey)],3:[new Uint8Array(b)]}),N=ii.toWords(T);return ii.encode("naddr",N,Yc)}function GL(v){let b=ap({0:[Os.encode(v)]}),T=ii.toWords(b);return ii.encode("nrelay",T,Yc)}function ap(v){let b=[];return Object.entries(v).forEach(([T,N])=>{N.forEach($=>{let z=new Uint8Array($.length+2);z.set([parseInt(T)],0),z.set([$.length],1),z.set($,2),b.push(z)})}),St.concatBytes(...b)}var ZL={};si(ZL,{decrypt:()=>XL,encrypt:()=>QL});async function QL(v,b,T){const N=Ht(v,"02"+b),$=zE(N);let z=Uint8Array.from((0,Ne.randomBytes)(16)),q=Os.encode(T),V=await crypto.subtle.importKey("raw",$,{name:"AES-CBC"},!1,["encrypt"]),re=await crypto.subtle.encrypt({name:"AES-CBC",iv:z},V,q),fe=Rd.encode(new Uint8Array(re)),ie=Rd.encode(new Uint8Array(z.buffer));return`${fe}?iv=${ie}`}async function XL(v,b,T){let[N,$]=T.split("?iv="),z=Ht(v,"02"+b),q=zE(z),V=await crypto.subtle.importKey("raw",q,{name:"AES-CBC"},!1,["decrypt"]),re=Rd.decode(N),fe=Rd.decode($),ie=await crypto.subtle.decrypt({name:"AES-CBC",iv:fe},V,re);return Ea.decode(ie)}function zE(v){return v.slice(1,33)}var YL={};si(YL,{queryProfile:()=>tD,searchDomain:()=>eD,useFetchImplementation:()=>JL});var lp;try{lp=fetch}catch{}function JL(v){lp=v}async function eD(v,b=""){try{return(await(await lp(`https://${v}/.well-known/nostr.json?name=${b}`)).json()).names}catch{return{}}}async function tD(v){let[b,T]=v.split("@");if(T||(T=b,b="_"),!b.match(/^[A-Za-z0-9-_.]+$/)||!T.includes("."))return null;let N;try{N=await(await lp(`https://${T}/.well-known/nostr.json?name=${b}`)).json()}catch{return null}if(!N?.names?.[b])return null;let $=N.names[b],z=N.relays?.[$]||[];return{pubkey:$,relays:z}}var nD={};si(nD,{generateSeedWords:()=>iD,privateKeyFromSeedWords:()=>rD,validateWords:()=>sD});function rD(v,b){let N=Wl.fromMasterSeed((0,Tr.mnemonicToSeedSync)(v,b)).derive("m/44'/1237'/0'/0/0").privateKey;if(!N)throw new Error("could not derive private key");return St.bytesToHex(N)}function iD(){return(0,Tr.generateMnemonic)(Dd.wordlist)}function sD(v){return(0,Tr.validateMnemonic)(v,Dd.wordlist)}var oD={};si(oD,{parse:()=>aD});function aD(v){const b={reply:void 0,root:void 0,mentions:[],profiles:[]},T=[];for(const N of v.tags)N[0]==="e"&&N[1]&&T.push(N),N[0]==="p"&&N[1]&&b.profiles.push({pubkey:N[1],relays:N[2]?[N[2]]:[]});for(let N=0;N<T.length;N++){const $=T[N],[z,q,V,re]=$,fe={id:q,relays:V?[V]:[]},ie=N===0,ue=N===T.length-1;if(re==="root"){b.root=fe;continue}if(re==="reply"){b.reply=fe;continue}if(re==="mention"){b.mentions.push(fe);continue}if(ie){b.root=fe;continue}if(ue){b.reply=fe;continue}b.mentions.push(fe)}return b}var lD={};si(lD,{getPow:()=>cD});function cD(v){return uD(St.hexToBytes(v))}function uD(v){let b,T,N;for(T=0,b=0;T<v.length&&(N=dD(v[T]),b+=N,N===8);T++);return b}function dD(v){let b=0;if(v===0)return 8;for(;v>>=1;)b++;return 7-b}var fD={};si(fD,{BECH32_REGEX:()=>UE,NOSTR_URI_REGEX:()=>cp,parse:()=>pD,test:()=>hD});var UE=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/,cp=new RegExp(`nostr:(${UE.source})`);function hD(v){return typeof v=="string"&&new RegExp(`^${cp.source}$`).test(v)}function pD(v){const b=v.match(new RegExp(`^${cp.source}$`));if(!b)throw new Error(`Invalid Nostr URI: ${v}`);return{uri:b[0],value:b[1],decoded:sp(b[1])}}var mD={};si(mD,{createDelegation:()=>gD,getDelegator:()=>yD});function gD(v,b){let T=[];(b.kind||-1)>=0&&T.push(`kind=${b.kind}`),b.until&&T.push(`created_at<${b.until}`),b.since&&T.push(`created_at>${b.since}`);let N=T.join("&");if(N==="")throw new Error("refusing to create a delegation without any conditions");let $=(0,kr.sha256)(Os.encode(`nostr:delegation:${b.pubkey}:${N}`)),z=St.bytesToHex(Ti.signSync($,v));return{from:RE(v),to:b.pubkey,cond:N,sig:z}}function yD(v){let b=v.tags.find(V=>V[0]==="delegation"&&V.length>=4);if(!b)return null;let T=b[1],N=b[2],$=b[3],z=N.split("&");for(let V=0;V<z.length;V++){let[re,fe,ie]=z[V].split(/\b/);if(!(re==="kind"&&fe==="="&&v.kind===parseInt(ie))){if(re==="created_at"&&fe==="<"&&v.created_at<parseInt(ie))continue;if(re==="created_at"&&fe===">"&&v.created_at>parseInt(ie))continue;return null}}let q=(0,kr.sha256)(Os.encode(`nostr:delegation:${v.pubkey}:${N}`));return Ti.verifySync($,q,T)?T:null}var bD={};si(bD,{matchAll:()=>wD,regex:()=>Py,replaceAll:()=>vD});var Py=()=>new RegExp(`\\b${cp.source}\\b`,"g");function*wD(v){const b=v.matchAll(Py());for(const T of b){const[N,$]=T;yield{uri:N,value:$,decoded:sp($),start:T.index,end:T.index+N.length}}}function vD(v,b){return v.replaceAll(Py(),(T,N)=>b({uri:T,value:N,decoded:sp(N)}))}var xD={};si(xD,{useFetchImplementation:()=>SD,validateGithub:()=>ED});var My;try{My=fetch}catch{}function SD(v){My=v}async function ED(v,b,T){try{return await(await My(`https://gist.github.com/${b}/${T}/raw`)).text()===`Verifying that I control the following Nostr public key: ${v}`}catch{return!1}}var kD={};si(kD,{authenticate:()=>TD});var TD=async({challenge:v,relay:b,sign:T})=>{const N={kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",b.url],["challenge",v]],content:""},$=b.auth(await T(N));return new Promise((z,q)=>{$.on("ok",function V(){$.off("ok",V),z()}),$.on("failed",function V(re){$.off("failed",V),q(re)})})},Oy={};si(Oy,{getZapEndpoint:()=>CD,makeZapReceipt:()=>PD,makeZapRequest:()=>AD,useFetchImplementation:()=>_D,validateZapRequest:()=>ID});var Ny;try{Ny=fetch}catch{}function _D(v){Ny=v}async function CD(v){try{let b="",{lud06:T,lud16:N}=JSON.parse(v.content);if(T){let{words:q}=ii.decode(T,1e3),V=ii.fromWords(q);b=Ea.decode(V)}else if(N){let[q,V]=N.split("@");b=`https://${V}/.well-known/lnurlp/${q}`}else return null;let z=await(await Ny(b)).json();if(z.allowsNostr&&z.nostrPubkey)return z.callback}catch{}return null}function AD({profile:v,event:b,amount:T,relays:N,comment:$=""}){if(!T)throw new Error("amount not given");if(!v)throw new Error("profile not given");let z={kind:9734,created_at:Math.round(Date.now()/1e3),content:$,tags:[["p",v],["amount",T.toString()],["relays",...N]]};return b&&z.tags.push(["e",b]),z}function ID(v){let b;try{b=JSON.parse(v)}catch{return"Invalid zap request JSON."}if(!Cy(b))return"Zap request is not a valid Nostr event.";if(!LE(b))return"Invalid signature on zap request.";let T=b.tags.find(([z,q])=>z==="p"&&q);if(!T)return"Zap request doesn't have a 'p' tag.";if(!T[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let N=b.tags.find(([z,q])=>z==="e"&&q);return N&&!N[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":b.tags.find(([z,q])=>z==="relays"&&q)?null:"Zap request doesn't have a 'relays' tag."}function PD({zapRequest:v,preimage:b,bolt11:T,paidAt:N}){let z=JSON.parse(v).tags.filter(([V])=>V==="e"||V==="p"||V==="a"),q={kind:9735,created_at:Math.round(N.getTime()/1e3),content:"",tags:[...z,["bolt11",T],["description",v]]};return b&&q.tags.push(["preimage",b]),q}St.hmacSha256Sync=(v,...b)=>(0,wo.hmac)(kr.sha256,v,St.concatBytes(...b)),St.sha256Sync=(...v)=>(0,kr.sha256)(St.concatBytes(...v));const MD=v=>Ay.decode(v).data,HE=v=>Ay.decode(v).data;let VE={};const OD=async v=>{if(VE[v])return VE[v];const b=new FE,T=["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine"];try{return await b.get(T,{authors:[v],kinds:[0]})}catch{throw new Error("failed to fetch user profile :(")}finally{b.close(T)}},ND=v=>JSON.parse(v.content),RD=async v=>{const b=await Oy.getZapEndpoint(v);if(!b)throw new Error("failed to retrieve zap endpoint :(");return b},LD=async(v,b)=>{if(jE()&&!b)try{return await window.nostr.signEvent(v)}catch{}return ML(v,CL())},DD=async({profile:v,nip19Target:b,amount:T,relays:N,comment:$,anon:z})=>{const q=Oy.makeZapRequest({profile:v,event:b&&b.startsWith("note")?HE(b):void 0,amount:T,relays:N,comment:$}),V=b&&b.startsWith("naddr")?HE(b):void 0;if(V){const re=V.relays?V.relays.reduce((fe,ie)=>`${ie},${fe}`,""):"";q.tags.push(["a",`${V.kind}:${V.pubkey}:${V.identifier}`,re])}return(!jE()||z)&&q.tags.push(["anon"]),LD(q,z)},BD=async({zapEndpoint:v,amount:b,comment:T,authorId:N,nip19Target:$,normalizedRelays:z,anon:q})=>{const V=await DD({profile:N,nip19Target:$,amount:b,relays:z,comment:T,anon:q});let re=`${v}?amount=${b}&nostr=${encodeURIComponent(JSON.stringify(V))}`;T&&(re=`${re}&comment=${encodeURIComponent(T)}`);const fe=await fetch(re),{pr:ie,reason:ue,status:W}=await fe.json();if(ie)return ie;throw W==="ERROR"?new Error(ue??"Unable to fetch invoice"):new Error("Unable to fetch invoice")},jE=()=>window!==void 0&&window.nostr!==void 0,$D=({relays:v,invoice:b,onSuccess:T})=>{const N=new FE,$=Array.from(new Set([...v,"wss://relay.nostr.band"])),z=()=>{N&&N.close($)},q=Math.round(Date.now()/1e3),V=setInterval(()=>{N.sub($,[{kinds:[9735],since:q}]).on("event",fe=>{fe.tags.find(ie=>ie[0]==="bolt11"&&ie[1]===b)&&(T(),z(),clearInterval(V))})},5e3);return()=>{z(),clearInterval(V)}},WE="nostrZap.",qE="lightningUri",KE=()=>typeof localStorage<"u",FD=v=>{if(KE())return localStorage.getItem(`${WE}${v}`)},zD=(v,b)=>{KE()&&localStorage.setItem(`${WE}${v}`,b)},UD=()=>FD(qE),HD=v=>zD(qE,v);let Ry=null;const VD=v=>{v=v.replace(/^#/,""),v.length===3&&(v=v.split("").map(z=>z+z).join(""));const b=parseInt(v,16),T=b>>16&255,N=b>>8&255,$=b&255;return{r:T,g:N,b:$}},jD=({r:v,g:b,b:T})=>(v*299+b*587+T*114)/1e3,GE=v=>{const b=VD(v);return jD(b)<128?"#fff":"#000"},Ly=v=>{const b=document.createElement("dialog");return b.classList.add("nostr-zap-dialog"),b.innerHTML=v,b.addEventListener("click",function({clientX:T,clientY:N}){const{left:$,right:z,top:q,bottom:V}=b.getBoundingClientRect();T===0&&N===0||(T<$||T>z||N<q||N>V)&&b.close()}),Ry.appendChild(b),b},WD=({dialogHeader:v,invoice:b,relays:T,buttonColor:N})=>{const $=UD(),q=Ly(`
        <button class="close-button">X</button>
        ${v}
        <div class="qrcode">
          <div class="overlay">copied invoice to clipboard</div>
        </div>
        <p>click QR code to copy invoice</p>
        <select name="lightning-wallet">
          ${[{label:"Default Wallet",value:"lightning:"},{label:"Strike",value:"strike:lightning:"},{label:"Cash App",value:"https://cash.app/launch/lightning/"},{label:"Muun",value:"muun:"},{label:"Blue Wallet",value:"bluewallet:lightning:"},{label:"Wallet of Satoshi",value:"walletofsatoshi:lightning:"},{label:"Zebedee",value:"zebedee:lightning:"},{label:"Zeus LN",value:"zeusln:lightning:"},{label:"Phoenix",value:"phoenix://"},{label:"Breez",value:"breez:"},{label:"Bitcoin Beach",value:"bitcoinbeach://"},{label:"Blixt",value:"blixtwallet:lightning:"},{label:"River",value:"river://"}].map(({label:W,value:G})=>`<option value="${G}" ${$===G?"selected":""}>${W}</option>`).join("")}
        </select>
        <button class="cta-button"
          ${N?`style="background-color: ${N}; color: ${GE(N)}"`:""} 
        >Open Wallet</button>
      `),V=q.querySelector(".qrcode"),re=q.querySelector('select[name="lightning-wallet"]'),fe=q.querySelector(".cta-button"),ie=V.querySelector(".overlay"),ue=$D({relays:T,invoice:b,onSuccess:()=>{q.close()}});return new(e(s))(V,{text:b,quietZone:10}),V.addEventListener("click",function(){navigator.clipboard.writeText(b),ie.classList.add("show"),setTimeout(()=>ie.classList.remove("show"),2e3)}),fe.addEventListener("click",function(){HD(re.value),window.location.href=`${re.value}${b}`}),q.addEventListener("close",function(){ue(),q.remove()}),q.querySelector(".close-button").addEventListener("click",function(){q.close()}),q},qD=async({npub:v,nip19Target:b,relays:T,buttonColor:N,anon:$})=>{const z=Ke=>`${Ke.substring(0,12)}...${Ke.substring(Ke.length-12)}`,q=T?T.split(","):["wss://relay.nostr.band","wss://relay.damus.io","wss://nos.lol"],V=MD(v),re=OD(V),fe="https://pbs.twimg.com/profile_images/1604195803748306944/LxHDoJ7P_400x400.jpg",ie=async()=>{const{picture:Ke,display_name:it,name:Xt}=ND(await re);return`
      <h2>${it||Xt}</h2>
        <img
          src="${Ke||fe}"
          width="80"
          height="80"
          alt="nostr user avatar"
        />
      <p>${z(b||v)}</p>
    `},ue=Ly(`
      <button class="close-button">X</button>
      <div class="dialog-header-container">
        <h2 class="skeleton-placeholder"></h2>
          <img
            src="${fe}"
            width="80"
            height="80"
            alt="placeholder avatar"
          />
        <p class="skeleton-placeholder"></p>
      </div>
      <div class="preset-zap-options-container">
        <button data-value="21">21 â¡ï¸</button>
        <button data-value="69">69 â¡ï¸</button>
        <button data-value="420">420 â¡ï¸</button>
        <button data-value="1337">1337 â¡ï¸</button>
        <button data-value="5000">5k â¡ï¸</button>
        <button data-value="10000">10k â¡ï¸</button>
        <button data-value="21000">21k â¡ï¸</button>
        <button data-value="1000000">1M â¡ï¸</button>
      </div>
      <form>
        <input name="amount" type="number" placeholder="amount in sats" required />
        <input name="comment" placeholder="optional comment" />
        <button class="cta-button" 
          ${N?`style="background-color: ${N}; color: ${GE(N)}"`:""} 
          type="submit" disabled>Zap</button>
      </form>
    `),W=ue.querySelector(".preset-zap-options-container"),G=ue.querySelector("form"),te=ue.querySelector('input[name="amount"]'),ce=ue.querySelector('input[name="comment"]'),be=ue.querySelector('button[type="submit"]'),ve=ue.querySelector(".dialog-header-container"),De=Ke=>{ue.close(),ZE(Ke,v).showModal()};ie().then(Ke=>{ve.innerHTML=Ke,be.disabled=!1}).catch(De);const Ce=()=>{be.disabled=!0,be.innerHTML='<div class="spinner">Loading</div>'},qe=()=>{be.disabled=!1,be.innerHTML="Zap"},ze=Ke=>{te.value=Ke};ue.addEventListener("close",function(){qe(),G.reset()}),ue.querySelector(".close-button").addEventListener("click",function(){ue.close()}),W.addEventListener("click",function(Ke){Ke.target.matches("button")&&(ze(Ke.target.getAttribute("data-value")),te.focus())});const Fe=re.then(RD);return G.addEventListener("submit",async function(Ke){Ke.preventDefault(),Ce();const it=Number(te.value)*1e3,Xt=ce.value;try{const Y=await BD({zapEndpoint:await Fe,amount:it,comment:Xt,authorId:V,nip19Target:b,normalizedRelays:q,anon:$}),ee=async()=>{const Z=WD({dialogHeader:await ie(),invoice:Y,relays:q,buttonColor:N}),ae=Z.querySelector(".cta-button");ue.close(),Z.showModal(),ae.focus()};if(window.webln)try{await window.webln.enable(),await window.webln.sendPayment(Y),ue.close()}catch{ee()}else ee()}catch(Y){De(Y)}}),ue},ZE=(v,b)=>{const T=Ly(`
    <button class="close-button">X</button>
    <p class="error-message">${v}</p>
    <a href="https://nosta.me/${b}" target="_blank">
      <button class="cta-button">View Nostr Profile</button>
    </a>
  `);return T.addEventListener("close",function(){T.remove()}),T.querySelector(".close-button").addEventListener("click",function(){T.close()}),T},QE=async({npub:v,noteId:b,naddr:T,relays:N,cachedAmountDialog:$,buttonColor:z,anon:q})=>{let V=$;try{return V||(V=await qD({npub:v,nip19Target:T||b,relays:N,buttonColor:z,anon:q})),V.showModal(),window.matchMedia("(max-height: 932px)").matches||V.querySelector('input[name="amount"]').focus(),V}catch(re){V&&V.close(),ZE(re,v).showModal()}},XE=v=>{let b=null,T=null;v.addEventListener("click",async function(){const N=v.getAttribute("data-npub"),$=v.getAttribute("data-note-id"),z=v.getAttribute("data-naddr"),q=v.getAttribute("data-relays"),V=v.getAttribute("data-button-color"),re=v.getAttribute("data-anon")==="true";T&&(T.npub!==N||T.noteId!==$||T.naddr!==z||T.relays!==q||T.buttonColor!==V||T.anon!==re)&&(b=null),T={npub:N,noteId:$,naddr:z,relays:q,buttonColor:V,anon:re},b=await QE({npub:N,noteId:$,naddr:z,relays:q,cachedAmountDialog:b,buttonColor:V,anon:re})})},YE=v=>{document.querySelectorAll(v||"[data-npub]").forEach(XE)};return(()=>{const v=document.createElement("style");v.innerHTML=`
      .nostr-zap-dialog {
        width: 424px;
        min-width: 376px;
        margin: auto;
        box-sizing: content-box;
        border: none;
        border-radius: 10px;
        padding: 36px;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        background-color: white;
      }
      .nostr-zap-dialog[open],
      .nostr-zap-dialog form {
        display: block;
        max-width: fit-content;
      }
      .nostr-zap-dialog form {
        padding: 0;
        width: 100%;
      }
      .nostr-zap-dialog img {
        display: inline;
        border-radius: 50%;
      }
      .nostr-zap-dialog h2 {
        font-size: 1.5em;
        font-weight: bold;
        color: black;
      }
      .nostr-zap-dialog p {
        font-size: 1em;
        font-weight: normal;
        color: black;
      }
      .nostr-zap-dialog h2,
      .nostr-zap-dialog p,
      .nostr-zap-dialog .skeleton-placeholder {
        margin: 4px;
        word-wrap: break-word;
      }
      .nostr-zap-dialog button {
        background-color: inherit;
        padding: 12px 0;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid rgb(226, 232, 240);
        width: 100px;
        max-width: 100px;
        max-height: 52px;
        white-space: nowrap;
        color: black;
        box-sizing: border-box;
      }
      .nostr-zap-dialog button:hover {
        background-color: #edf2f7;
      }
      .nostr-zap-dialog button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .nostr-zap-dialog .cta-button {
        background-color: #7f00ff;
        color: #fff;
        width: 100%;
        max-width: 100%;
        margin-top: 16px;
      }
      .nostr-zap-dialog .cta-button:hover {
        background-color: indigo;
      }
      .nostr-zap-dialog .close-button {
        background-color: inherit;
        color: black;
        border-radius: 50%;
        width: 42px;
        height: 42px;
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 12px;
        border: none;
      }
      .nostr-zap-dialog .preset-zap-options-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin: 24px 0 8px 0;
        height: 120px;
      }
      .nostr-zap-dialog input {
        padding: 12px;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        width: 100%;
        max-width: 100%;
        background-color: #f7fafc;
        color: #1a202c;
        box-shadow: none;
        box-sizing: border-box;
        margin-bottom: 16px;
        border: 1px solid lightgray;
      }
      .nostr-zap-dialog .spinner {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .nostr-zap-dialog .spinner:after {
        content: " ";
        display: block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 4px solid #fff;
        border-color: #fff transparent #fff transparent;
        animation: nostr-zap-dialog-spinner 1.2s linear infinite;
        margin-left: 8px;
      }
      .nostr-zap-dialog .error-message {
        text-align: left;
        color: red;
        margin-top: 8px;
      }
      .nostr-zap-dialog .qrcode {
        position: relative;
        display: inline-block;
        margin-top: 24px;
      }
      .nostr-zap-dialog .qrcode .overlay {
        position: absolute;
        color: white;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(127, 17, 224, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }
      .nostr-zap-dialog .qrcode .overlay.show {
        opacity: 1;
      }
      @keyframes nostr-zap-dialog-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes nostr-zap-dialog-skeleton-pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.8;
        }
        100% {
          opacity: 0.6;
        }
      }
      .nostr-zap-dialog .skeleton-placeholder {
        animation-name: nostr-zap-dialog-skeleton-pulse;
        animation-duration: 1.5s;
        animation-iteration-count: infinite;
        animation-timing-function: ease-in-out;
        background-color: #e8e8e8;
        border-radius: 4px;
        margin: 4px auto;
      }
      .nostr-zap-dialog p.skeleton-placeholder {
        height: 20px;
        width: 200px;
      }
      .nostr-zap-dialog h2.skeleton-placeholder {
        height: 28px;
        width: 300px;
      }
      .nostr-zap-dialog select[name="lightning-wallet"] {
        appearance: none;
        background-color: white;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%232D3748" width="24" height="24" viewBox="0 0 24 24"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" /></svg>');
        background-repeat: no-repeat;
        background-position: right 0.7rem center;
        background-size: 16px;
        border: 1px solid #CBD5E0;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: 0.25rem;
        width: 100%;
        margin-top: 24px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        cursor: pointer;
      }
      .nostr-zap-dialog select[name="lightning-wallet"]:focus {
        outline: none;
        border-color: #4FD1C5;
        box-shadow: 0 0 0 2px #4FD1C5;
      }
      @media only screen and (max-width: 480px) {
        .nostr-zap-dialog {
          padding: 18px;
        }

        .nostr-zap-dialog button {
          width: 92px;
          max-width: 92px;
        }
      }
      @media only screen and (max-width: 413px) {
        .nostr-zap-dialog {
          min-width: 324px;
        }
        .nostr-zap-dialog button {
          width: 78px;
          max-width: 78px;
        }
      }
  `;const b=document.createElement("div");document.body.appendChild(b),Ry=b.attachShadow({mode:"open"}),Ry.appendChild(v)})(),YE(),window.nostrZap={init:QE,initTarget:XE,initTargets:YE},zA}Kde();var Gde=Ve('<div class="help-icon svg-icon" aria-label="Help"></div>'),Zde=Ve('<div class="github-icon svg-icon svelte-a75w3s" aria-label="GitHub"></div>'),Qde=Ve('<div class="rotate-right-icon svg-icon svelte-a75w3s"></div> <span class="btn-text"> </span>',1),Xde=Ve('<div class="setting-section sw-update-section svelte-a75w3s"><div class="setting-row svelte-a75w3s"><span class="setting-label sw-update-label svelte-a75w3s"> </span> <div class="setting-control svelte-a75w3s"><!></div></div></div>'),Yde=Ve('<div class="lang-icon-btn svg-icon svelte-a75w3s"></div> <span class="btn-text"> </span>',1),Jde=Ve("<option> </option>"),efe=Ve('<div class="rotate-right-icon svg-icon svelte-a75w3s"></div> <span class="btn-text"> </span>',1),tfe=(t,e)=>n1.set(!M(e)),nfe=Ve('<li class="svelte-a75w3s"> </li>'),rfe=Ve('<ul class="svelte-a75w3s"></ul>'),ife=Ve('<span style="color: #888;"> </span>'),sfe=Ve('<div class="relay-list svelte-a75w3s"><!></div>'),ofe=Ve('<div class="settings-header svelte-a75w3s"><div class="first-row svelte-a75w3s"><div class="site-title svelte-a75w3s"><span class="site-name svelte-a75w3s">eHagaki</span> <span class="cache-version svelte-a75w3s"> </span></div> <div class="author-info svelte-a75w3s"><span> </span><a href="https://lokuyow.github.io/" target="_blank" class="svelte-a75w3s"> </a></div></div> <div class="second-row svelte-a75w3s"><!> <!> <div><div class="zap-view-btn-group svelte-a75w3s"><button class="zap-btn svelte-a75w3s" data-npub="npub1a3pvwe2p3v7mnjz6hle63r628wl9w567aw7u23fzqs062v5vqcqqu3sgh3" data-note-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-relays="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">Support</button> <span class="divider svelte-a75w3s"></span> <button class="view-btn svelte-a75w3s" data-title="Thanks for the Support!" data-nzv-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-zap-color-mode="true" data-relay-urls="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">View</button></div></div></div></div> <div class="modal-body svelte-a75w3s"><!> <div class="setting-section svelte-a75w3s"><div class="setting-row svelte-a75w3s"><span class="setting-label svelte-a75w3s">Language/è¨èª</span> <div class="setting-control svelte-a75w3s"><!></div></div></div> <div class="setting-section svelte-a75w3s"><div class="setting-row svelte-a75w3s"><span class="setting-label svelte-a75w3s"> </span> <div class="setting-control radio-group svelte-a75w3s"></div></div></div> <div class="setting-section svelte-a75w3s"><div class="setting-row svelte-a75w3s"><span class="setting-label svelte-a75w3s"> </span> <div class="setting-control radio-group svelte-a75w3s"></div></div></div> <div class="setting-section svelte-a75w3s"><div class="setting-row svelte-a75w3s"><span class="setting-label svelte-a75w3s"> </span> <div class="setting-control svelte-a75w3s"><select id="endpoint-select" class="svelte-a75w3s"></select></div></div></div> <div class="setting-section svelte-a75w3s"><div class="setting-row svelte-a75w3s"><span class="setting-label svelte-a75w3s"> </span> <div class="setting-control svelte-a75w3s"><label class="toggle-switch svelte-a75w3s" for="client-tag-toggle"><input id="client-tag-toggle" type="checkbox" class="svelte-a75w3s"/> <span class="slider svelte-a75w3s"></span></label></div></div></div> <div class="setting-section svelte-a75w3s"><div class="setting-row svelte-a75w3s"><span class="setting-label svelte-a75w3s"> </span> <div class="setting-control svelte-a75w3s"><!></div></div> <div class="setting-info svelte-a75w3s"><button type="button" class="relay-toggle-label svelte-a75w3s" style="cursor:pointer; background:none; border:none; padding:0; font: inherit;"><span class="relay-toggle-icon svelte-a75w3s" aria-label="toggle"><!></span> </button> <!></div></div></div>',1);function afe(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",s),r=()=>or(ks,"$locale",s),i=()=>or(Mx,"$swNeedRefresh",s),[s,o]=as();let a=ht(e,"show",3,!1),l=ht(e,"onRefreshRelaysAndProfile",3,()=>{}),c=ht(e,"selectedCompression",3,"medium"),u=ht(e,"onSelectedCompressionChange",3,void 0),d=ht(e,"selectedEndpoint",3,""),f=ht(e,"onSelectedEndpointChange",3,void 0),h=ht(e,"onOpenWelcomeDialog",3,void 0),p=Xe(()=>PZ(n())),m=Xe(()=>MZ(n())),g=Ee(!0),y=Ee(At(c())),w=Ee("medium"),k=Ee(At(d())),C=Ee(!1);Ze(()=>{const D=c();D!==void 0&&D!==""&&se(y,D,!0)}),Ze(()=>{u()&&M(y)!==c()&&u()(M(y))}),Ze(()=>{const D=d();D!==void 0&&D!==""&&se(k,D,!0)}),Ze(()=>{f()&&M(k)!==d()&&f()(M(k))}),Ze(()=>{M(C)&&M(y)&&localStorage.setItem(Ai.IMAGE_COMPRESSION_LEVEL,M(y))}),Ze(()=>{M(C)&&M(w)&&localStorage.setItem(Ai.VIDEO_COMPRESSION_LEVEL,M(w))}),Ze(()=>{M(C)&&M(k)&&localStorage.setItem(Ai.UPLOAD_ENDPOINT,M(k))}),Ze(()=>{M(C)&&localStorage.setItem(Ai.CLIENT_TAG_ENABLED,M(g)?"true":"false")});let A=Ee(null);zM.subscribe(D=>se(A,D,!0));function E(){EX(lQ,D=>m_.set(D),{timeout:IZ})}function P(){const D=SX({selectedEndpoint:d(),selectedCompression:c()});se(k,D.endpoint,!0),se(g,D.clientTagEnabled,!0),se(y,D.compression,!0);const B=localStorage.getItem(Ai.VIDEO_COMPRESSION_LEVEL);B?B==="skip"?(se(w,"none"),localStorage.setItem(Ai.VIDEO_COMPRESSION_LEVEL,"none")):se(w,B,!0):(se(w,"medium"),localStorage.setItem(Ai.VIDEO_COMPRESSION_LEVEL,"medium")),se(C,!0)}ls(()=>{P(),cQ(),br.value?.pubkey&&br.value?.isAuthenticated&&g_(br.value.pubkey)}),Ze(()=>{a()&&br.value?.pubkey&&br.value?.isAuthenticated&&g_(br.value.pubkey)}),Ze(()=>{a()&&(async()=>(await Tl(),qde(),window.nostrZap&&window.nostrZap.initTargets()))()}),Ze(()=>{a()||n1.set(!1)}),Ze(()=>{r()&&!localStorage.getItem(Ai.UPLOAD_ENDPOINT)&&se(k,Ax(r()),!0)});function S(){ks.set(r()==="ja"?"en":"ja")}let x=Xe(()=>Pf.value),_=Xe(()=>n1.value),I=Xe(()=>m_.value);{let D=Xe(()=>n()("settings")||"è¨­å®");Kh(t,{get show(){return a()},useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return M(D)},className:"settings-dialog",showFooter:!0,children:(B,F)=>{var R=ofe(),O=Et(R),L=ye(O),H=ye(L),U=Le(ye(H),2),j=ye(U),Q=Le(H,2),X=ye(Q),de=ye(X),le=Le(X),J=ye(le),he=Le(L,2),Me=ye(he);mn(Me,{shape:"circle",variant:"default",className:"help-btn",onClick:()=>{e.onClose(),h()?.()},ariaLabel:"Help",children:(Ct,$t)=>{var dn=Gde();we(Ct,dn)},$$slots:{default:!0}});var pe=Le(Me,2);mn(pe,{shape:"circle",variant:"default",className:"github-link-btn",onClick:()=>window.open("https://github.com/Lokuyow/ehagaki","_blank"),ariaLabel:"GitHub Repository",children:(Ct,$t)=>{var dn=Zde();we(Ct,dn)},$$slots:{default:!0}});var Te=Le(O,2),je=ye(Te);{var oe=Ct=>{var $t=Xde(),dn=ye($t),fn=ye(dn),Yn=ye(fn),Tn=Le(fn,2),Ne=ye(Tn);{let Rn=Xe(()=>M(I)?"loading":""),us=Xe(()=>n()("settingsDialog.update_app")||"ã¢ããªãæ´æ°");mn(Ne,{variant:"primary",shape:"rounded",get className(){return`sw-update-btn ${M(Rn)??""}`},onClick:E,get disabled(){return M(I)},get ariaLabel(){return M(us)},children:(Zc,Zh)=>{var Qh=en(),ly=Et(Qh);{var cy=ba=>{{let Qc=Xe(()=>n()("settingsDialog.updating")||"æ´æ°ä¸­...");xl(ba,{showLoader:!0,get text(){return M(Qc)}})}},uy=ba=>{var Qc=Qde(),Md=Et(Qc),Od=Le(Md,2),dy=ye(Od);Ge((fy,hy)=>{ln(Md,"aria-label",fy),Qe(dy,hy)},[()=>n()("settingsDialog.refresh")||"æ´æ°",()=>n()("settingsDialog.update_app")||"æ´æ°"]),we(ba,Qc)};Ye(ly,ba=>{M(I)?ba(cy):ba(uy,!1)})}we(Zc,Qh)},$$slots:{default:!0}})}Ge(Rn=>Qe(Yn,Rn),[()=>n()("settingsDialog.sw_update_available")||"ã¢ããªã®æ´æ°ãããã¾ã"]),we(Ct,$t)};Ye(je,Ct=>{i()&&Ct(oe)})}var ge=Le(je,2),Ie=ye(ge),_e=Le(ye(Ie),2),Ue=ye(_e);mn(Ue,{variant:"default",shape:"rounded",className:"lang-btn",onClick:S,children:(Ct,$t)=>{var dn=Yde(),fn=Et(dn),Yn=Le(fn,2),Tn=ye(Yn);Ge((Ne,Rn)=>{ln(fn,"aria-label",Ne),Qe(Tn,Rn)},[()=>n()("settingsDialog.change")||"å¤æ´",()=>n()("settingsDialog.change")||"å¤æ´"]),we(Ct,dn)},$$slots:{default:!0}});var Je=Le(ge,2),ft=ye(Je),ot=ye(ft),mt=ye(ot),It=Le(ot,2);bu(It,21,()=>M(p),cf,(Ct,$t)=>{{let dn=Xe(()=>M(y)===M($t).value);gA(Ct,{get value(){return M($t).value},name:"compression",get checked(){return M(dn)},variant:"default",shape:"rounded",onChange:fn=>se(y,fn,!0),get ariaLabel(){return M($t).label},children:(fn,Yn)=>{var Tn=Sn();Ge(()=>Qe(Tn,M($t).label)),we(fn,Tn)},$$slots:{default:!0}})}});var bt=Le(Je,2),Lt=ye(bt),Pe=ye(Lt),Oe=ye(Pe),at=Le(Pe,2);bu(at,21,()=>M(m),cf,(Ct,$t)=>{{let dn=Xe(()=>M(w)===M($t).value);gA(Ct,{get value(){return M($t).value},name:"videoCompression",get checked(){return M(dn)},variant:"default",shape:"rounded",onChange:fn=>se(w,fn,!0),get ariaLabel(){return M($t).label},children:(fn,Yn)=>{var Tn=Sn();Ge(()=>Qe(Tn,M($t).label)),we(fn,Tn)},$$slots:{default:!0}})}});var Ht=Le(bt,2),xn=ye(Ht),Ot=ye(xn),Wt=ye(Ot),Nt=Le(Ot,2),Pt=ye(Nt);bu(Pt,21,()=>BM,cf,(Ct,$t)=>{var dn=Jde(),fn=ye(dn),Yn={};Ge(()=>{Qe(fn,M($t).label),Yn!==(Yn=M($t).url)&&(dn.value=(dn.__value=M($t).url)??"")}),we(Ct,dn)});var _t=Le(Ht,2),Dt=ye(_t),un=ye(Dt),zn=ye(un),ti=Le(un,2),Di=ye(ti),ni=ye(Di),Kc=Le(_t,2),Is=ye(Kc),Hl=ye(Is),Ei=ye(Hl),ki=Le(Hl,2),cs=ye(ki);{let Ct=Xe(()=>n()("settingsDialog.refresh_relays_and_profile")||"ååå¾");mn(cs,{variant:"default",shape:"rounded",className:"refresh-relays-profile-btn",onClick:()=>l()&&l()(),get ariaLabel(){return M(Ct)},children:($t,dn)=>{var fn=efe(),Yn=Et(fn),Tn=Le(Yn,2),Ne=ye(Tn);Ge((Rn,us)=>{ln(Yn,"aria-label",Rn),Qe(Ne,us)},[()=>n()("settingsDialog.refresh")||"æ´æ°",()=>n()("settingsDialog.refresh")||"æ´æ°"]),we($t,fn)},$$slots:{default:!0}})}var Ti=Le(Is,2),kn=ye(Ti);kn.__click=[tfe,_];var Kn=ye(kn),ri=ye(Kn);{var St=Ct=>{var $t=Sn("â¼");we(Ct,$t)},kr=Ct=>{var $t=Sn("â¶");we(Ct,$t)};Ye(ri,Ct=>{M(_)?Ct(St):Ct(kr,!1)})}var ya=Le(Kn),Bt=Le(kn,2);{var Gc=Ct=>{var $t=sfe(),dn=ye($t);{var fn=Tn=>{var Ne=rfe();bu(Ne,21,()=>M(x),cf,(Rn,us)=>{var Zc=nfe(),Zh=ye(Zc);Ge(()=>Qe(Zh,M(us))),we(Rn,Zc)}),we(Tn,Ne)},Yn=Tn=>{var Ne=ife(),Rn=ye(Ne);Ge(us=>Qe(Rn,us),[()=>n()("settingsDialog.no_relay_info")||"ãªã¬ã¼æå ±ãªã"]),we(Tn,Ne)};Ye(dn,Tn=>{M(x).length>0?Tn(fn):Tn(Yn,!1)})}we(Ct,$t)};Ye(Bt,Ct=>{M(_)&&Ct(Gc)})}Ge((Ct,$t,dn,fn,Yn,Tn,Ne,Rn,us)=>{Qe(j,M(A)?`v${M(A)}`:""),Qe(de,Ct),Qe(J,$t),Qe(mt,dn),Qe(Oe,fn),Qe(Wt,Yn),Qe(zn,Tn),Qe(Ei,Ne),ln(kn,"aria-pressed",M(_)),ln(kn,"aria-label",Rn),Qe(ya,` ${us??""}`)},[()=>n()("settingsDialog.author_info")||"å¶ä½ï¼",()=>n()("settingsDialog.author_name")||" Lokuyow",()=>n()("settingsDialog.image_quality_setting"),()=>n()("settingsDialog.video_quality_setting"),()=>n()("settingsDialog.upload_destination")||"ã¢ããã­ã¼ãå",()=>n()("settingsDialog.client_tag_label")||"æç¨¿è©³ç´°ã«ã¯ã©ã¤ã¢ã³ãåãã¤ããï¼Client tagï¼",()=>n()("settingsDialog.refresh_relays_and_profile")||"ãªã¬ã¼ãªã¹ãã»ãã­ãã£ã¼ã«ååå¾",()=>n()("settingsDialog.toggle_write_relays_list")||"æç¨¿åãªã¬ã¼ã®è¡¨ç¤ºåæ¿",()=>n()("settingsDialog.write_relays_list")||"æ¸ãè¾¼ã¿åãªã¬ã¼ãªã¹ã"]),w$(Pt,()=>M(k),Ct=>se(k,Ct)),T$(ni,()=>M(g),Ct=>se(g,Ct)),we(B,R)},$$slots:{default:!0}})}On(),o()}xi(["click"]);var lfe=Ve('<img class="profile-image svelte-1d13tce"/>'),cfe=Ve('<div class="profile-image-placeholder svg-icon svelte-1d13tce" aria-label="Profile image placeholder"></div>'),ufe=(t,e,n)=>e(M(n).npub,"npub",t),dfe=Ve('<div class="profile-info-row svelte-1d13tce"><div class="profile-info-content svelte-1d13tce"><span class="profile-info-text svelte-1d13tce"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-1d13tce" aria-label="Copy npub"></div></button></div></div>'),ffe=(t,e,n)=>e(M(n).nprofile,"nprofile",t),hfe=Ve('<div class="profile-info-row svelte-1d13tce"><div class="profile-info-content svelte-1d13tce"><span class="profile-info-text svelte-1d13tce"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-1d13tce" aria-label="Copy nprofile"></div></button></div></div>'),pfe=Ve('<div class="profile-info-label svelte-1d13tce"> </div> <span class="profile-info-text"><!></span>',1),mfe=Ve('<div class="profile-container svelte-1d13tce"><div class="profile-summary svelte-1d13tce"><div class="profile-image-container svelte-1d13tce"><!></div> <div class="profile-name svelte-1d13tce"> </div></div> <div class="nostr-ids svelte-1d13tce"><div class="profile-info-label svelte-1d13tce"> </div> <div class="profile-info-container svelte-1d13tce"><!> <!></div></div> <div class="auth-controls svelte-1d13tce"><div class="auth-container svelte-1d13tce"><!></div> <!></div></div>'),gfe=Ve('<div class="copy-success-message"> </div>'),yfe=Ve("<!> <!>",1);function bfe(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",r),[r,i]=as();let s=ht(e,"isLoggingOut",3,!1),o=Xe(()=>Xa.value),a=Xe(()=>br.value),l=Ee(At(Xa.value)),c=Ee(!1),u=Ee(0),d=Ee(0);Ze(()=>{!s()&&M(o)&&se(l,M(o),!0)});function f(){e.onLogout?.()}async function h(y,w,k){try{await j0(y,w,navigator,window);const C=Uu(k.clientX,k.clientY);se(u,C.x,!0),se(d,C.y,!0),se(c,!0),setTimeout(()=>{se(c,!1)},1800)}catch(C){console.warn("Copy failed:",C)}}var p=yfe(),m=Et(p);{const y=(k,C)=>{var A=mfe(),E=ye(A),P=ye(E),S=ye(P);{var x=he=>{var Me=lfe();Ge(()=>{ln(Me,"src",M(l).picture),ln(Me,"alt",M(l).name||"Profile")}),we(he,Me)},_=he=>{var Me=cfe();we(he,Me)};Ye(S,he=>{M(l).picture?he(x):he(_,!1)})}var I=Le(P,2),D=ye(I),B=Le(E,2),F=ye(B),R=ye(F),O=Le(F,2),L=ye(O);{var H=he=>{var Me=dfe(),pe=ye(Me),Te=ye(pe),je=ye(Te),oe=Le(Te,2);oe.__click=[ufe,h,l],Ge(ge=>{Qe(je,M(l).npub),ln(oe,"aria-label",ge)},[()=>n()("profileDialog.copy_npub")]),we(he,Me)};Ye(L,he=>{M(l).npub&&he(H)})}var U=Le(L,2);{var j=he=>{var Me=hfe(),pe=ye(Me),Te=ye(pe),je=ye(Te),oe=Le(Te,2);oe.__click=[ffe,h,l],Ge(ge=>{Qe(je,M(l).nprofile),ln(oe,"aria-label",ge)},[()=>n()("profileDialog.copy_nprofile")]),we(he,Me)};Ye(U,he=>{M(l).nprofile&&he(j)})}var Q=Le(B,2),X=ye(Q),de=ye(X);{var le=he=>{var Me=pfe(),pe=Et(Me),Te=ye(pe),je=Le(pe,2),oe=ye(je);{var ge=_e=>{var Ue=Sn();Ge(Je=>Qe(Ue,Je),[()=>n()("profileDialog.login_method_nsec")]),we(_e,Ue)},Ie=_e=>{var Ue=en(),Je=Et(Ue);{var ft=ot=>{var mt=en(),It=Et(mt);{var bt=Pe=>{var Oe=Sn();Ge(at=>Qe(Oe,at),[()=>n()("profileDialog.login_method_nostr_login_connect")]),we(Pe,Oe)},Lt=Pe=>{var Oe=en(),at=Et(Oe);{var Ht=Ot=>{var Wt=Sn();Ge(Nt=>Qe(Wt,Nt),[()=>n()("profileDialog.login_method_nostr_login_extension")]),we(Ot,Wt)},xn=Ot=>{var Wt=en(),Nt=Et(Wt);{var Pt=Dt=>{var un=Sn();Ge(zn=>Qe(un,zn),[()=>n()("profileDialog.login_method_nostr_login_local")]),we(Dt,un)},_t=Dt=>{var un=Sn();Ge(zn=>Qe(un,zn),[()=>n()("profileDialog.login_method_nostr_login_connect")]),we(Dt,un)};Ye(Nt,Dt=>{M(a)?.nostrLoginAuthMethod==="local"?Dt(Pt):Dt(_t,!1)},!0)}we(Ot,Wt)};Ye(at,Ot=>{M(a)?.nostrLoginAuthMethod==="extension"?Ot(Ht):Ot(xn,!1)},!0)}we(Pe,Oe)};Ye(It,Pe=>{M(a)?.nostrLoginAuthMethod==="connect"?Pe(bt):Pe(Lt,!1)})}we(ot,mt)};Ye(Je,ot=>{M(a)?.type==="nostr-login"&&ot(ft)},!0)}we(_e,Ue)};Ye(oe,_e=>{M(a)?.type==="nsec"?_e(ge):_e(Ie,!1)})}Ge(_e=>Qe(Te,_e),[()=>n()("profileDialog.login_method")]),we(he,Me)};Ye(de,he=>{(M(a)?.type==="nsec"||M(a)?.type==="nostr-login")&&he(le)})}var J=Le(X,2);{let he=Xe(()=>s()?"loading":"");mn(J,{onClick:f,get className(){return`logout-btn ${M(he)??""}`},variant:"danger",shape:"square",get disabled(){return s()},children:(Me,pe)=>{var Te=en(),je=Et(Te);{var oe=Ie=>{xl(Ie,{text:!0,showLoader:!0})},ge=Ie=>{var _e=Sn();Ge(Ue=>Qe(_e,Ue),[()=>n()("logoutDialog.logout")]),we(Ie,_e)};Ye(je,Ie=>{s()?Ie(oe):Ie(ge,!1)})}we(Me,Te)},$$slots:{default:!0}})}Ge((he,Me)=>{Qe(D,he),Qe(R,Me)},[()=>M(l).name||n()("profileDialog.anonymous"),()=>n()("profileDialog.npub")]),we(k,A)};let w=Xe(()=>n()("profileDialog.title"));Kh(m,{get show(){return e.show},showFooter:!0,useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return M(w)},className:"profile-dialog",children:y,$$slots:{default:!0}})}var g=Le(m,2);n5(g,{get show(){return M(c)},get x(){return M(u)},get y(){return M(d)},onClose:()=>se(c,!1),children:(y,w)=>{var k=gfe(),C=ye(k);Ge(A=>Qe(C,A),[()=>n()("imageContextMenu.copySuccess")]),we(y,k)},$$slots:{default:!0}}),we(t,p),On(),i()}xi(["click"]);var wfe=Ve('<div><span style="word-break:break-all"> </span></div>'),vfe=Ve('<div><span style="word-break:break-all"> </span></div>'),xfe=Ve('<div class="toast npub-toast svelte-3v70tp"><!> <!></div>'),Sfe=Ve('<img src="./icons/nostr-login.svg" alt="nostr-login" class="nostr-login-icon svelte-3v70tp"/> <span class="btn-text svelte-3v70tp">Nostr Login</span>',1),Efe=(t,e)=>{t.key==="Enter"&&e()},kfe=(t,e)=>{M(e)&&M(e).setCustomValidity("")},Tfe=Ve('<!> <div class="divider svelte-3v70tp"><span class="svelte-3v70tp"> </span></div> <h3 class="svelte-3v70tp"> </h3> <form class="svelte-3v70tp"><input type="password" placeholder="nsec1â¦" class="secret-input svelte-3v70tp" id="secretKey" name="secretKey" autocomplete="current-password" required minlength="63" maxlength="63"/> <div class="dialog-buttons svelte-3v70tp"><!> <!></div></form>',1),_fe=Ve("<!> <!>",1);function Cfe(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",r),[r,i]=as();let s=ht(e,"secretKey",15),o=ht(e,"isLoadingNostrLogin",3,!1);const a=new iN;let l=Ee(null);Ze(()=>{s()!==void 0&&(a.setNsec(s()),M(l)&&(s()||M(l).setCustomValidity("")))});let c=Ee(!1),u=Ee(""),d=Ee("");Ze(()=>{a.isValid.subscribe(C=>se(c,C,!0))}),Ze(()=>{a.npub.subscribe(C=>se(u,C,!0))}),Ze(()=>{a.nprofile.subscribe(C=>se(d,C,!0))});function f(){if(M(l)){const C=M(l).validity,A=M(l).value??"";if(C.valueMissing){M(l).setCustomValidity(n()("loginDialog.secret_required")),M(l).reportValidity();return}if(!A.startsWith("nsec1")){M(l).setCustomValidity(n()("loginDialog.secret_must_start_nsec1")),M(l).reportValidity();return}if(A.length!==63){A.length<63?M(l).setCustomValidity(n()("loginDialog.secret_too_short")):M(l).setCustomValidity(n()("loginDialog.secret_too_long")),M(l).reportValidity();return}if(!M(c)){M(l).setCustomValidity(n()("loginDialog.invalid_secret")),M(l).reportValidity();return}M(l).setCustomValidity("")}e.onSave?.()}function h(){s(""),M(l)&&M(l).setCustomValidity("")}function p(){e.onNostrLogin?.()}function m(C){C.preventDefault(),f()}var g=_fe(),y=Et(g);{var w=C=>{var A=xfe(),E=ye(A);{var P=_=>{var I=wfe(),D=ye(I),B=ye(D);Ge(()=>Qe(B,M(u))),we(_,I)};Ye(E,_=>{M(u)&&_(P)})}var S=Le(E,2);{var x=_=>{var I=vfe(),D=ye(I),B=ye(D);Ge(()=>Qe(B,M(d))),we(_,I)};Ye(S,_=>{M(d)&&_(x)})}we(C,A)};Ye(y,C=>{(M(u)||M(d))&&C(w)})}var k=Le(y,2);{const C=E=>{var P=Tfe(),S=Et(P);{let U=Xe(()=>o()?"loading":"");mn(S,{variant:"default",shape:"rounded",get className(){return`nostr-login-button ${M(U)??""}`},onClick:p,get disabled(){return o()},children:(j,Q)=>{var X=en(),de=Et(X);{var le=he=>{xl(he,{text:!0,showLoader:!0,customClass:"nostr-login-placeholder"})},J=he=>{var Me=Sfe();we(he,Me)};Ye(de,he=>{o()?he(le):he(J,!1)})}we(j,X)},$$slots:{default:!0}})}var x=Le(S,2),_=ye(x),I=ye(_),D=Le(x,2),B=ye(D),F=Le(D,2),R=ye(F);R.__keydown=[Efe,f],R.__input=[kfe,l],Xn(R,U=>se(l,U),()=>M(l));var O=Le(R,2),L=ye(O);mn(L,{variant:"warning",shape:"square",type:"button",onClick:h,className:"clear-btn",children:(U,j)=>{var Q=Sn();Ge(X=>Qe(Q,X),[()=>n()("loginDialog.clear")]),we(U,Q)},$$slots:{default:!0}});var H=Le(L,2);mn(H,{variant:"primary",shape:"square",type:"submit",className:"save-btn",children:(U,j)=>{var Q=Sn();Ge(X=>Qe(Q,X),[()=>n()("loginDialog.save")]),we(U,Q)},$$slots:{default:!0}}),Ge((U,j,Q)=>{Qe(I,U),Qe(B,j),ln(R,"title",Q)},[()=>n()("loginDialog.or"),()=>n()("loginDialog.input_secret"),()=>n()("loginDialog.hint_input_secret")]),bs("submit",F,m),k$(R,s),we(E,P)};let A=Xe(()=>n()("loginDialog.input_secret"));Kh(k,{get show(){return e.show},useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return M(A)},className:"login-dialog",showFooter:!0,children:C,$$slots:{default:!0}})}we(t,g),On(),i()}xi(["keydown","input"]);var Afe=Ve('<div class="welcome-content svelte-195daz6"><div class="title-section svelte-195daz6"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-195daz6"/> <h2 class="svelte-195daz6"> </h2></div> <p class="svelte-195daz6"> </p> <pre class="features svelte-195daz6"> </pre></div>');function Ife(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",r),[r,i]=as();let s=ht(e,"show",3,!1);{const o=l=>{mn(l,{variant:"primary",shape:"square",get onClick(){return e.onClose},className:"get-started-btn",children:(c,u)=>{var d=Sn();Ge(f=>Qe(d,f),[()=>n()("welcomeDialog.get_started")]),we(c,d)},$$slots:{default:!0}})};let a=Xe(()=>n()("welcomeDialog.title"));Kh(t,{get show(){return s()},get onClose(){return e.onClose},get ariaLabel(){return M(a)},showFooter:!0,className:"welcome-dialog",footer:o,children:(l,c)=>{var u=Afe(),d=ye(u),f=Le(ye(d),2),h=ye(f),p=Le(d,2),m=ye(p),g=Le(p,2),y=ye(g);Ge((w,k,C)=>{Qe(h,w),Qe(m,k),Qe(y,C)},[()=>n()("welcomeDialog.title"),()=>n()("welcomeDialog.description"),()=>n()("welcomeDialog.features")]),we(l,u)},$$slots:{footer:!0,default:!0}})}On(),i()}class Vg{static createMergedOptions(e){return{theme:"default",noBanner:!0,methods:"connect, extension, local",perms:"get_public_key,sign_event:1,sign_event:27235",startScreen:"welcome",...e}}static processBunkers(e){return Array.isArray(e)?e.join(","):void 0}static async npubToPubkey(e){try{if(!e)return{success:!1,error:{type:"decode",message:"npub is empty or null"}};const n=sa.decode(e);return n.type==="npub"?{success:!0,pubkey:n.data}:{success:!1,error:{type:"decode",message:"Invalid npub format"}}}catch(n){return{success:!1,error:{type:"decode",message:"Failed to decode npub",originalError:n}}}}static getCurrentUserFromWindow(e){try{const n=e.nostrLogin;if(n&&n.pubkey)return{pubkey:n.pubkey,npub:n.npub}}catch{return null}return null}static getNostrLoginAuthMethod(e,n){try{const r=n.getItem("__nostrlogin_accounts");if(!r)return;const i=JSON.parse(r);if(!Array.isArray(i))return;const s=i.find(a=>a?.pubkey===e);if(!s||!s.authMethod)return;const o=s.authMethod;return o==="connect"||o==="extension"||o==="local"?o:void 0}catch{return}}}class Pfe{constructor(e,n,r){this.console=e,this.getAuthHandler=n,this.isLoggingOut=r}async handleAuthCallback(e,n){const r=this.getAuthHandler();if(!(!r||this.isLoggingOut()))try{if(!e){r({type:"logout"});return}const i=await Vg.npubToPubkey(e);if(!i.success||!i.pubkey){this.console.warn("NostrLogin: Failed to get pubkey from npub",i.error);return}const s=n?.type||"login";r({type:s,pubkey:i.pubkey,npub:e,otpData:n?.otpData})}catch(i){this.console.error("NostrLogin auth callback error:",i)}}}class Mfe{constructor(e,n,r){this.console=e,this.importNostrLogin=n,this.authHandler=r}async initialize(e){try{const r=(await this.importNostrLogin()).init;if(!r)throw new TypeError("nostr-login: init function is missing");const i=Vg.createMergedOptions(e),s=this.authHandler.handleAuthCallback.bind(this.authHandler),o=i.bunkers!==void 0?Vg.processBunkers(i.bunkers):void 0,a={...i,bunkers:o,startScreen:i.startScreen,onAuth:s};return await Promise.resolve(r(a)),this.console.log("nostr-loginåæåå®äº"),{success:!0}}catch(n){const r={type:"initialization",message:"Failed to initialize nostr-login",originalError:n};return this.console.error("nostr-loginåæåã¨ã©ã¼:",n),{success:!1,error:r}}}}class Ofe{constructor(e){this.importNostrLogin=e}async launch(e){try{const{launch:n}=await this.importNostrLogin();return await n(e||"welcome"),{success:!0}}catch(n){return{success:!1,error:{type:"launch",message:"Failed to launch nostr-login",originalError:n}}}}}class Nfe{constructor(e,n){this.document=e,this.setTimeout=n}logout(e){e(!0);try{const n=new Event("nlLogout");this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlLogout event:",n)}try{this.setTimeout(()=>{e(!1)},100)}catch(n){console.error("Failed to set logout flag timeout:",n),e(!1)}}setDarkMode(e){try{const n=new CustomEvent("nlDarkMode",{detail:e});this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlDarkMode event:",n)}}}class Rfe{initialized=!1;authHandler=null;isLoggingOutFlag=!1;initPromise=null;resolvedPromise=null;initializer;launcher;eventEmitter;authCallbackHandler;windowObj;documentObj;consoleObj;setTimeoutFn;constructor(e={}){this.windowObj=e.window||(typeof window<"u"?window:{}),this.documentObj=e.document||(typeof window<"u"?window.document:{}),this.consoleObj=e.console||(typeof window<"u"?window.console:{}),this.setTimeoutFn=e.setTimeout||(typeof window<"u"&&window.setTimeout?window.setTimeout.bind(window):(()=>{}));const n=e.importNostrLogin||(()=>l0(()=>import("./index.esm-B6zogCv1.js"),[]));this.authCallbackHandler=new Pfe(this.consoleObj,()=>this.authHandler,()=>this.isLoggingOutFlag),this.initializer=new Mfe(this.consoleObj,n,this.authCallbackHandler),this.launcher=new Ofe(n),this.eventEmitter=new Nfe(this.documentObj,this.setTimeoutFn)}init(e={}){return this.initPromise!==null?this.initPromise:this.initialized?this.resolvedPromise:(this.initPromise=new Promise((n,r)=>{this.initializer.initialize(e).then(i=>{if(i.success)this.initialized=!0,this.resolvedPromise=this.initPromise,n();else{this._resetInitializationState();const s=i.error?.message||"Initialization failed",o=i.error?.originalError;o instanceof Error?r(o):r(new Error(s))}}).catch(i=>{this._resetInitializationState(),r(i)})}),this.initPromise)}_resetInitializationState(){this.initialized=!1,this.initPromise=null,this.resolvedPromise=null}setAuthHandler(e){this.authHandler=e}async showLogin(e){if(!this._ensureInitialized())throw new Error("nostr-login is not initialized");const n=await this.launcher.launch(e);if(!n.success)throw n.error?.originalError instanceof Error?n.error.originalError:new Error(n.error?.message||"Failed to launch login")}logout(){try{if(!this._ensureInitialized())return;this.eventEmitter.logout(e=>{this.isLoggingOutFlag=e})}catch(e){this.consoleObj.error("NostrLogin logout error:",e)}}setDarkMode(e){this._ensureInitialized()&&this.eventEmitter.setDarkMode(e)}getCurrentUser(){return this.initialized?Vg.getCurrentUserFromWindow(this.windowObj):null}_ensureInitialized(){return this.initialized?!0:(this.consoleObj.warn("nostr-loginãåæåããã¦ãã¾ãã"),!1)}get isInitialized(){return this.initialized}getInitializer(){return this.initializer}getLauncher(){return this.launcher}getEventEmitter(){return this.eventEmitter}getAuthCallbackHandler(){return this.authCallbackHandler}}const HA=new Rfe;class jg{static isValidSecretKey(e,n){return n.isValidNsec(e)}static hasRequiredPubkey(e){return e.type!=="logout"&&!!e.pubkey}static isLogoutAuth(e){return e.type==="logout"}}class Lfe{constructor(e,n,r){this.keyManager=e,this.setNsecAuth=n,this.console=r}async authenticate(e){if(!jg.isValidSecretKey(e,this.keyManager))return{success:!1,error:"invalid_secret"};const{success:n}=this.keyManager.saveToStorage(e);if(!n)return{success:!1,error:"error_saving"};try{const r=this.keyManager.derivePublicKey(e);return r.hex?(this.setNsecAuth(r.hex,r.npub,r.nprofile),{success:!0,pubkeyHex:r.hex}):{success:!1,error:"derivation_failed"}}catch(r){return this.console.error("nsecèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",r),{success:!1,error:"authentication_error"}}}}class Dfe{constructor(e,n){this.publicKeyState=e,this.console=n}async authenticate(e){if(jg.isLogoutAuth(e))return{success:!0};if(!jg.hasRequiredPubkey(e))return this.console.warn("NostrLoginAuth: pubkey is required for login/signup"),{success:!1,error:"missing_pubkey"};try{return this.publicKeyState.setNostrLoginAuth(e),{success:!0,pubkeyHex:e.pubkey}}catch(n){return this.console.error("nostr-loginèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",n),{success:!1,error:"nostr_login_error"}}}}class Bfe{constructor(e){this.window=e}async waitForExternalAuth(e=5e3){const n=Date.now(),r=100;return new Promise(i=>{const s=()=>{if(this.isWindowNostrAvailable()){i(!0);return}if(Date.now()-n>=e){i(!1);return}setTimeout(s,r)};s()})}isWindowNostrAvailable(){return typeof this.window<"u"&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}}class $fe{constructor(e,n){this.navigator=e,this.console=n}async clearProfileImageCache(){try{if(!this.hasServiceWorker())return;const e=new MessageChannel;return new Promise((n,r)=>{e.port1.onmessage=i=>{i.data.success?(this.console.log("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ãã¯ãªã¢ãã¾ãã"),n()):(this.console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢å¤±æ:",i.data.error),r(new Error(i.data.error)))},this.navigator.serviceWorker.controller?this.navigator.serviceWorker.controller.postMessage({action:"clearProfileCache"},[e.port2]):r(new Error("Service worker controller is null."))})}catch(e){this.console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}}hasServiceWorker(){return"serviceWorker"in this.navigator&&!!this.navigator.serviceWorker.controller}}class Ffe{constructor(e){this.localStorage=e}getStoredNostrLoginData(){try{const e=this.localStorage.getItem("__nostrlogin_nip46");if(!e)return null;const n=JSON.parse(e);return n?.pubkey?{pubkey:n.pubkey,npub:n.npub}:null}catch{return null}}}class zfe{constructor(e,n,r,i,s,o,a){this.keyManager=e,this.publicKeyState=n,this.nostrLoginManager=r,this.externalAuthWaiter=i,this.storageManager=s,this.setNsecAuth=o,this.console=a}async initialize(e){try{const n=await this.checkNsecAuth();if(n.hasAuth)return n;await this.externalAuthWaiter.waitForExternalAuth(100);const r=await this.checkNostrLoginAuth(e);if(r.hasAuth)return r}catch(n){this.console.error("nostr-loginåæåå¤±æ:",n)}return{hasAuth:!1}}async checkNsecAuth(){const e=this.keyManager.loadFromStorage();if(!e)return{hasAuth:!1};this.publicKeyState.setNsec(e);try{const n=this.keyManager.derivePublicKey(e);return n.hex?(this.setNsecAuth(n.hex,n.npub,n.nprofile),{hasAuth:!0,pubkeyHex:n.hex,isNostrLogin:!1}):(this.keyManager.saveToStorage(""),{hasAuth:!1})}catch{return this.keyManager.saveToStorage(""),{hasAuth:!1}}}async checkNostrLoginAuth(e){await this.nostrLoginManager.init(e),await new Promise(i=>setTimeout(i,100));const n=this.nostrLoginManager.getCurrentUser();if(n?.pubkey)return this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:n.pubkey,npub:n.npub}),{hasAuth:!0,pubkeyHex:n.pubkey,isNostrLogin:!0};const r=this.storageManager.getStoredNostrLoginData();return r?.pubkey?(this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:r.pubkey,npub:r.npub}),{hasAuth:!0,pubkeyHex:r.pubkey,isNostrLogin:!0}):{hasAuth:!1}}}class Ufe{publicKeyState;nsecAuthenticator;nostrLoginAuthenticator;profileCacheCleaner;authInitializer;nostrLoginMgr;keyManager;nostrLoginOptions={theme:"default",noBanner:!0,methods:"connect, extension, local"};constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.keyManager||new sN({secretKeyStore:e.secretKeyStore||tQ,setNostrLoginAuthFn:e.setNostrLoginAuth||a_,clearAuthStateFn:e.clearAuthState||o_,localStorage:n}),i=e.window||(typeof window<"u"?window:{}),s=e.navigator||(typeof window<"u"?window.navigator:{}),o=e.console||(typeof window<"u"?window.console:{}),a=e.setNsecAuth||qZ;this.nostrLoginMgr=e.nostrLoginManager||HA,this.publicKeyState=new iN({setNostrLoginAuthFn:e.setNostrLoginAuth||a_,clearAuthStateFn:e.clearAuthState||o_,localStorage:n}),this.nsecAuthenticator=new Lfe(r,a,o),this.nostrLoginAuthenticator=new Dfe(this.publicKeyState,o),this.profileCacheCleaner=new $fe(s,o);const l=new Bfe(i),c=new Ffe(n);this.authInitializer=new zfe(r,this.publicKeyState,this.nostrLoginMgr,l,c,a,o),this.keyManager=r}async authenticateWithNsec(e){return await this.nsecAuthenticator.authenticate(e)}async authenticateWithNostrLogin(e){return jg.isLogoutAuth(e)?(this.logout(),{success:!0}):await this.nostrLoginAuthenticator.authenticate(e)}async showNostrLoginDialog(){const e=HA;if(!e.isInitialized)throw new Error("nostr-login is not initialized");try{await e.showLogin()}catch(n){if(!(n instanceof Error&&n.message==="Cancelled"))throw console.error("nostr-loginã§ã¨ã©ã¼:",n),n}}logout(){try{if(this.publicKeyState.currentIsNostrLogin&&this.nostrLoginMgr.isInitialized)try{this.nostrLoginMgr.logout()}catch(e){console.error("nostr-loginã­ã°ã¢ã¦ãä¸­ã«ã¨ã©ã¼:",e)}try{const e=localStorage.getItem("firstVisit");localStorage.clear(),e&&localStorage.setItem("firstVisit",e)}catch(e){console.error("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}this.profileCacheCleaner.clearProfileImageCache().catch(e=>{console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}),setTimeout(()=>{try{typeof window<"u"&&window.location&&typeof window.location.replace=="function"?window.location.replace(window.location.pathname):typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(e){console.error("ãã¼ã¸ãªã­ã¼ãä¸­ã«ã¨ã©ã¼:",e)}},500)}catch(e){console.error("ã­ã°ã¢ã¦ãå¦çä¸­ã«äºæããªãã¨ã©ã¼:",e),setTimeout(()=>{try{typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(n){console.error("ãã¼ã¸ãªã­ã¼ãä¸­ã«ã¨ã©ã¼:",n)}},2e3)}}async initializeAuth(){return await this.authInitializer.initialize(this.nostrLoginOptions)}getPublicKeyState(){return this.publicKeyState}setNostrLoginHandler(e){this.nostrLoginMgr.setAuthHandler(e)}markAuthInitialized(){KZ()}getNsecAuthenticator(){return this.nsecAuthenticator}getNostrLoginAuthenticator(){return this.nostrLoginAuthenticator}getProfileCacheCleaner(){return this.profileCacheCleaner}getAuthInitializer(){return this.authInitializer}}const za=new Ufe;var Hfe=Ve('<div><div class="balloon-message svelte-ut8h7c"> </div></div>');function Vfe(t,e){let n=ht(e,"type",3,"success"),r=ht(e,"message",3,"");var i=Hfe(),s=ye(i),o=ye(s);Ge(()=>{rs(i,1,`balloon-message-wrapper ${n()??""}`,"svelte-ut8h7c"),Qe(o,r())}),we(t,i)}class b6{constructor(e){this.$_=e}showTimeout=null;lastMessageTime=0;debounceDelay=500;getRandomInfoMessage(){const e=NZ,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getRandomSuccessMessage(){const e=RZ,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getErrorMessage(){return this.$_(LZ)??""}createMessage(e,n,r=!1){const i=Date.now();if(!r&&i-this.lastMessageTime<this.debounceDelay)return{type:e,message:""};this.lastMessageTime=i;let s=n;if(!s)switch(e){case"info":s=this.getRandomInfoMessage();break;case"success":s=this.getRandomSuccessMessage();break;case"error":s=this.getErrorMessage();break;default:s=""}return{type:e,message:s}}scheduleHide(e,n=3e3){this.showTimeout&&clearTimeout(this.showTimeout),this.showTimeout=setTimeout(e,n)}cancelScheduledHide(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}createMessageImmediate(e,n){return this.createMessage(e,n,!0)}dispose(){this.cancelScheduledHide(),this.lastMessageTime=0}}var jfe=Ve('<div class="trash-icon svg-icon svelte-18r58hh"></div>'),Wfe=Ve('<div class="image-icon svg-icon svelte-18r58hh"></div>'),qfe=Ve('<div class="plane-icon svg-icon svelte-18r58hh"></div>'),Kfe=Ve('<div class="header-container svelte-18r58hh"><div class="header-left svelte-18r58hh"><a href="https://lokuyow.github.io/ehagaki/" class="site-icon-link svelte-18r58hh" aria-label="ehagaki"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-18r58hh"/></a> <!></div> <div class="post-actions svelte-18r58hh"><div class="buttons-container svelte-18r58hh"><!> <!> <!></div></div></div>  <label id="vibrateSwitch" style="display: none;" aria-hidden="true"><input type="checkbox" checked/></label>',1);function Gfe(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",r),[r,i]=as();let s=ht(e,"balloonMessage",3,null),o=null;Ze(()=>{n()&&!o&&(o=new b6(n()))});let a=Ee(!1);Ze(()=>br.subscribe(H=>{se(a,H&&H.isAuthenticated,!0)}));let l=Xe(()=>bn.postStatus),c=Xe(()=>bn.isUploading),u=Xe(()=>bn.canPost),d=Ee(!1);Ze(()=>{M(l).sending?se(d,!0):M(d)&&setTimeout(()=>{se(d,!1)},400)});let f=Ee(null),h=Ee(!1);function p(){o&&!M(h)&&(se(f,o.createMessage("success"),!0),se(h,!0),o.scheduleHide(()=>{se(f,null),se(h,!1),Ao({...bn.postStatus,success:!1,message:"",completed:!1})},3e3))}Ze(()=>{M(l).success&&M(l).completed&&!M(f)&&!M(h)&&p()}),Ze(()=>{(!M(l).success||!M(l).completed)&&(M(f)||M(h))&&(se(f,null),se(h,!1),o&&o.cancelScheduledHide())});let m=Xe(()=>M(l).error&&o!==null?o.createMessage("error"):null),g=Ee(null);const y=typeof window<"u"&&(window.location.port==="4173"||window.location.hostname==="localhost");let w=Ee(null);Ze(()=>{if(typeof window<"u"&&o){const L=new URLSearchParams(window.location.search),H=L.get("error");if(H&&L.get("shared")==="true"){if(["processing-error","no-image","upload-failed","network-error","client-error"].includes(H)){setTimeout(()=>{const Q=new URL(window.location.href);Q.searchParams.delete("error"),Q.searchParams.delete("shared"),window.history.replaceState({},"",Q.toString())},1e3);return}let j="";switch(H){case"messaging-error":j="Service Workerã¨ã®éä¿¡ã§ã¨ã©ã¼ãçºçãã¾ããããã¼ã¸ãæ´æ°ãã¦ããä¸åº¦ãè©¦ããã ããã";break;case"window-error":j="æ°ããã¦ã£ã³ãã¦ã®ä½æã«å¤±æãã¾ãã";break;default:setTimeout(()=>{const Q=new URL(window.location.href);Q.searchParams.delete("error"),Q.searchParams.delete("shared"),window.history.replaceState({},"",Q.toString())},1e3);return}se(w,{type:"error",message:j},!0),setTimeout(()=>{const Q=new URL(window.location.href);Q.searchParams.delete("error"),Q.searchParams.delete("shared"),window.history.replaceState({},"",Q.toString()),setTimeout(()=>{se(w,null)},5e3)},1e3)}}}),y&&(window.showInfoBalloonDebug=L=>{se(g,{type:"info",message:L},!0)},window.hideInfoBalloonDebug=()=>{se(g,null)});let k=Xe(()=>M(w)||(y?M(g)||s()||M(m)||M(f):s()||M(m)||M(f)));Ze(()=>()=>{o&&o.dispose()});let C=Ee(void 0);Ze(()=>{M(C)&&M(C).setAttribute("switch","")});var A=Kfe(),E=Et(A),P=ye(E),S=Le(ye(P),2);{var x=L=>{Vfe(L,{get type(){return M(k).type},get message(){return M(k).message}})};Ye(S,L=>{M(k)&&L(x)})}var _=Le(P,2),I=ye(_),D=ye(I);{let L=Xe(()=>!M(u)||M(l).sending||M(c)||M(d)),H=Xe(()=>n()("postComponent.clear_editor"));mn(D,{variant:"header",shape:"square",className:"clear-button",get disabled(){return M(L)},get onClick(){return e.onResetPostContent},get ariaLabel(){return M(H)},children:(U,j)=>{var Q=jfe();we(U,Q)},$$slots:{default:!0}})}var B=Le(D,2);{let L=Xe(()=>!M(a)||M(l).sending||M(c)||M(d)),H=Xe(()=>n()("postComponent.upload_image"));mn(B,{variant:"header",shape:"square",className:"image-button",get disabled(){return M(L)},get onClick(){return e.onUploadImage},get ariaLabel(){return M(H)},children:(U,j)=>{var Q=Wfe();we(U,Q)},$$slots:{default:!0}})}var F=Le(B,2);{let L=Xe(()=>M(d)?"loading":""),H=Xe(()=>!M(u)||M(l).sending||M(c)||!M(a)||M(l).completed),U=Xe(()=>n()("postComponent.post"));mn(F,{variant:"header",shape:"square",get className(){return`post-button ${M(L)??""}`},get disabled(){return M(H)},onClick:()=>{yQ(30),moe()},get ariaLabel(){return M(U)},children:(j,Q)=>{var X=en(),de=Et(X);{var le=he=>{xl(he,{showLoader:!0,text:!1,customClass:"post-button-loading"})},J=he=>{var Me=qfe();we(he,Me)};Ye(de,he=>{M(d)?he(le):he(J,!1)})}we(j,X)},$$slots:{default:!0}})}var R=Le(E,2),O=ye(R);Xn(O,L=>se(C,L),()=>M(C)),we(t,A),On(),i()}async function VA(t,e,n){try{t?.preventDefault()}catch{}try{const r=[...e()].reverse();await tae(r),(r?.length??0)>0&&(se(n,!0),setTimeout(()=>se(n,!1),1500))}catch(r){console.warn("dev log copy failed:",r)}}var Zfe=Ve('<li class="svelte-1czx13o"> </li>'),Qfe=Ve('<button type="button" class="floating-dev-console-log svelte-1czx13o" title="ã¿ããã§å¨ã³ãã¼" aria-label="éçºèã­ã°ãã³ãã¼"><ul class="svelte-1czx13o"></ul></button>'),Xfe=Ve('<div class="shared-image-error svelte-1czx13o"><div class="error-text svelte-1czx13o"> </div></div>'),Yfe=Ve('<div class="stop-icon svg-icon"></div>'),Jfe=Ve('<div class="compression-container svelte-1czx13o"><!> <div class="upload-progress svelte-1czx13o"><div class="progress-text svelte-1czx13o"> </div> <div class="progress-bar svelte-1czx13o"><div class="progress-fill svelte-1czx13o"></div></div></div></div>'),ehe=Ve('<div class="stop-icon svg-icon"></div>'),the=Ve('<div class="compression-container svelte-1czx13o"><!> <div class="upload-progress svelte-1czx13o"><div class="progress-text svelte-1czx13o"> </div> <div class="progress-bar svelte-1czx13o"><div class="progress-fill svelte-1czx13o"></div></div></div></div>'),nhe=Ve('<div class="stop-icon svg-icon"></div>'),rhe=Ve('<div class="compression-container svelte-1czx13o"><!> <div class="upload-progress svelte-1czx13o"><div class="progress-text svelte-1czx13o"> <!> <!></div> <div class="progress-bar svelte-1czx13o"><div class="progress-fill svelte-1czx13o"></div></div></div></div>'),ihe=Ve('<div class="upload-progress svelte-1czx13o"><div class="progress-text svelte-1czx13o"> <!> <!></div> <div class="progress-bar svelte-1czx13o"><div class="progress-fill svelte-1czx13o"></div></div></div>'),she=Ve(" <br/> <!>",1),ohe=Ve('<div class="image-size-info svelte-1czx13o"><div class="size-label svelte-1czx13o"> </div> <div class="size-details svelte-1czx13o"><!></div></div>'),ahe=Ve('<!> <div class="footer-center svelte-1czx13o"><!></div>',1);function lhe(t,e){Mn(e,!0);const n=()=>or(TS,"$devLog",i),r=()=>or(Jr,"$_",i),[i,s]=as();let o=Ee(!1),a=Ee(null);Ze(()=>{if(typeof window<"u"){const U=new URLSearchParams(window.location.search),j=U.get("error");if(j&&U.get("shared")==="true"){const Q=()=>{const X=localStorage.getItem("sharedImageProcessed")==="1",J=!new URLSearchParams(window.location.search).get("error");return X||J};if(Q()){console.log("Shared image was processed successfully, ignoring error parameter");return}setTimeout(()=>{if(Q()){console.log("Shared image processing detected after delay, not showing error");return}let X="";switch(j){case"processing-error":X="å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼ãçºçãã¾ãã";break;case"no-image":X="å±æç»åãè¦ã¤ããã¾ããã§ãã";break;case"upload-failed":X="ç»åã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã";break;case"network-error":X="ãããã¯ã¼ã¯ã¨ã©ã¼ãçºçãã¾ãã";break;case"client-error":X="ç»åå±æå¦çã§ã¨ã©ã¼ãçºçãã¾ãã";break;default:return}se(a,X,!0),setTimeout(()=>{const de=new URL(window.location.href);de.searchParams.delete("error"),de.searchParams.delete("shared"),window.history.replaceState({},"",de.toString()),setTimeout(()=>{se(a,null)},5e3)},1e3)},100)}}});let l=ht(e,"uploadProgress",31,()=>At({total:0,completed:0,failed:0,aborted:0,inProgress:!1})),c=Xe(()=>Af.value),u=Xe(()=>If.value),d=Ee(null),f=Ee(0),h=null;Ze(()=>{M(c)>0&&M(c)<100?M(d)||(se(d,Date.now(),!0),x({imageSizeInfoOnly:!0}),h=window.setInterval(()=>{M(d)&&se(f,Math.floor((Date.now()-M(d))/1e3),!0)},1e3)):(h!==null&&(clearInterval(h),h=null),se(d,null),se(f,0))}),Ze(()=>{M(u)>0&&M(u)<100?M(d)||(se(d,Date.now(),!0),x({imageSizeInfoOnly:!0}),h=window.setInterval(()=>{M(d)&&se(f,Math.floor((Date.now()-M(d))/1e3),!0)},1e3)):(h!==null&&(clearInterval(h),h=null),se(d,null),se(f,0))});let p=Xe(()=>ku.value.info),m=Xe(()=>ku.value.visible),g=Ee(!1);Ze(()=>{l().inProgress&&!M(g)&&x({imageSizeInfoOnly:!0}),se(g,l().inProgress,!0)});function y(U){if(U<60)return`${U}s`;const j=Math.floor(U/60),Q=U%60;return`${j}m ${Q}s`}function w(){Af.set(0),If.set(0),h!==null&&(clearInterval(h),h=null),se(d,null),se(f,0),l({total:0,completed:0,failed:0,aborted:0,inProgress:!1});const j=SS.value;j&&dN(j,!1),WZ()}function k(){w()}function C(){w()}function A(U){if(!U)return"";const j=U.match(/\.([a-zA-Z0-9]+)$/);if(!j)return"";const Q=j[1].toUpperCase();return Q==="JPEG"?"JPG":Q}function E(){return typeof window>"u"?"medium":localStorage.getItem("videoCompressionLevel")||"medium"}function P(U){switch(U){case"none":return r()("settingsDialog.quality_lossless");case"low":return r()("footerInfoDisplay.videoQualityLevel.high");case"medium":return r()("footerInfoDisplay.videoQualityLevel.medium");case"high":return r()("footerInfoDisplay.videoQualityLevel.low");default:return r()("footerInfoDisplay.videoQualityLevel.medium")}}function S(U){l(U),!U.inProgress&&U.total>0&&setTimeout(()=>{l({total:0,completed:0,failed:0,aborted:0,inProgress:!1})},1e3)}function x(U){if(U?.imageSizeInfoOnly){ku.set({info:null,visible:!1});return}l({total:0,completed:0,failed:0,aborted:0,inProgress:!1}),Af.set(0),If.set(0),h!==null&&(clearInterval(h),h=null),se(d,null),se(f,0),ku.set({info:null,visible:!1}),se(a,null)}var _={updateProgress:S,reset:x},I=ahe(),D=Et(I);{var B=U=>{var j=Qfe();j.__click=[VA,n,o],j.__touchend=[VA,n,o];var Q=ye(j);bu(Q,5,()=>[...n()].reverse(),cf,(X,de)=>{var le=Zfe(),J=ye(le);Ge(()=>Qe(J,M(de))),we(X,le)}),we(U,j)};Ye(D,U=>{JN()&&n().length&&U(B)})}var F=Le(D,2),R=ye(F);{var O=U=>{var j=Xfe(),Q=ye(j),X=ye(Q);Ge(()=>Qe(X,M(a))),we(U,j)},L=U=>{var j=en(),Q=Et(j);{var X=le=>{var J=Jfe(),he=ye(J);mn(he,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"å§ç¸®ä¸­æ­¢",onClick:C,children:(ge,Ie)=>{var _e=Yfe();we(ge,_e)},$$slots:{default:!0}});var Me=Le(he,2),pe=ye(Me),Te=ye(pe),je=Le(pe,2),oe=ye(je);Ge((ge,Ie)=>{Qe(Te,`${ge??""}: ${M(u)??""}%
                    (${Ie??""})`),nl(oe,`width: ${M(u)??""}%`)},[()=>r()("imageCompression.compressing"),()=>y(M(f))]),we(le,J)},de=le=>{var J=en(),he=Et(J);{var Me=Te=>{var je=the(),oe=ye(je);mn(oe,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"å§ç¸®ä¸­æ­¢",onClick:k,children:(ft,ot)=>{var mt=ehe();we(ft,mt)},$$slots:{default:!0}});var ge=Le(oe,2),Ie=ye(ge),_e=ye(Ie),Ue=Le(Ie,2),Je=ye(Ue);Ge((ft,ot,mt)=>{Qe(_e,`${ft??""}${ot??""}: ${M(c)??""}%
                    (${mt??""})`),nl(Je,`width: ${M(c)??""}%`)},[()=>P(E()),()=>r()("videoQualityLabelSuffix"),()=>y(M(f))]),we(Te,je)},pe=Te=>{var je=en(),oe=Et(je);{var ge=_e=>{var Ue=en(),Je=Et(Ue);{var ft=mt=>{var It=rhe(),bt=ye(It);mn(bt,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"ã¢ããã­ã¼ãä¸­æ­¢",onClick:C,children:(Pt,_t)=>{var Dt=nhe();we(Pt,Dt)},$$slots:{default:!0}});var Lt=Le(bt,2),Pe=ye(Lt),Oe=ye(Pe),at=Le(Oe);{var Ht=Pt=>{var _t=Sn();Ge(Dt=>Qe(_t,`(${Dt??""}: ${l().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),we(Pt,_t)};Ye(at,Pt=>{l().failed>0&&Pt(Ht)})}var xn=Le(at,2);{var Ot=Pt=>{var _t=Sn();Ge(Dt=>Qe(_t,`(${Dt??""}: ${l().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),we(Pt,_t)};Ye(xn,Pt=>{l().aborted>0&&Pt(Ot)})}var Wt=Le(Pe,2),Nt=ye(Wt);Ge((Pt,_t)=>{Qe(Oe,`${Pt??""}: ${l().completed??""}/${l().total??""} `),nl(Nt,`width: ${_t??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>l().total>0?Math.round(l().completed/l().total*100):0]),we(mt,It)},ot=mt=>{var It=ihe(),bt=ye(It),Lt=ye(bt),Pe=Le(Lt);{var Oe=Wt=>{var Nt=Sn();Ge(Pt=>Qe(Nt,`(${Pt??""}: ${l().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),we(Wt,Nt)};Ye(Pe,Wt=>{l().failed>0&&Wt(Oe)})}var at=Le(Pe,2);{var Ht=Wt=>{var Nt=Sn();Ge(Pt=>Qe(Nt,`(${Pt??""}: ${l().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),we(Wt,Nt)};Ye(at,Wt=>{l().aborted>0&&Wt(Ht)})}var xn=Le(bt,2),Ot=ye(xn);Ge((Wt,Nt)=>{Qe(Lt,`${Wt??""}: ${l().completed??""}/${l().total??""} `),nl(Ot,`width: ${Nt??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>l().total>0?Math.round(l().completed/l().total*100):0]),we(mt,It)};Ye(Je,mt=>{l().inProgress?mt(ft):mt(ot,!1)})}we(_e,Ue)},Ie=_e=>{var Ue=en(),Je=Et(Ue);{var ft=ot=>{var mt=ohe(),It=ye(mt),bt=ye(It),Lt=Le(It,2),Pe=ye(Lt);{var Oe=at=>{var Ht=she(),xn=Et(Ht),Ot=Le(xn,2),Wt=Le(Ot);{var Nt=_t=>{var Dt=Sn();Ge(un=>Qe(Dt,un),[()=>r()("footerInfoDisplay.no_compression")||"å§ç¸®ãªã"]),we(_t,Dt)},Pt=_t=>{var Dt=en(),un=Et(Dt);{var zn=Di=>{var ni=Sn();Ge(()=>Qe(ni,`${M(p).compressedSize??""}
                        (${M(p).compressionRatio??""}%)`)),we(Di,ni)},ti=Di=>{var ni=Sn();Ge(()=>Qe(ni,`${M(p).compressedSize??""}
                        (${M(p).compressionRatio??""}%)`)),we(Di,ni)};Ye(un,Di=>{M(p).wasCompressed?Di(zn):Di(ti,!1)},!0)}we(_t,Dt)};Ye(Wt,_t=>{M(p).wasSkipped?_t(Nt):_t(Pt,!1)})}Ge((_t,Dt)=>{Qe(xn,`${_t??""}
                    ${M(p).originalSize??""}`),Qe(Ot,` â ${Dt??""} `)},[()=>A(M(p).originalFilename),()=>A(M(p).compressedFilename)]),we(at,Ht)};Ye(Pe,at=>{M(p).originalFilename&&M(p).compressedFilename&&at(Oe)})}Ge(at=>Qe(bt,`${at??""}:`),[()=>r()("footerInfoDisplay.data_size")]),we(ot,mt)};Ye(Je,ot=>{M(m)&&M(p)&&ot(ft)},!0)}we(_e,Ue)};Ye(oe,_e=>{l().inProgress||l().total>0?_e(ge):_e(Ie,!1)},!0)}we(Te,je)};Ye(he,Te=>{M(c)>0&&M(c)<100?Te(Me):Te(pe,!1)},!0)}we(le,J)};Ye(Q,le=>{M(u)>0&&M(u)<100?le(X):le(de,!1)},!0)}we(U,j)};Ye(R,U=>{M(a)?U(O):U(L,!1)})}we(t,I);var H=On(_);return s(),H}xi(["click","touchend"]);var che=Ve("<img/>"),uhe=Ve('<div class="profile-picture default svg-icon svelte-11irzrh" aria-label="User"></div>'),dhe=Ve('<div class="update-indicator svelte-11irzrh"></div>'),fhe=Ve('<div class="settings-icon svg-icon svelte-11irzrh" aria-label="Settings"></div> <!>',1),hhe=Ve('<div class="footer-bar svelte-11irzrh"><!> <!> <!></div>');function phe(t,e){Mn(e,!0);const n=()=>or(Jr,"$_",r),[r,i]=as();let s=Xe(()=>Xa.value),o=Xe(()=>ms.value),a=Xe(()=>hu.value),l=Ee(void 0),c=Ee(!1);const u=()=>M(s)?.name?M(s).name:M(s)?.npub?M(s).npub:"User";function d(S){console.log("ãã­ãã£ã¼ã«ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãã:",S),se(c,!0),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&console.log("Service Workerã«ããã­ã£ãã·ã¥å¦çã®å¯è½æ§ãããã¾ã")}function f(S){if(!S)return!1;try{return new URL(S,location.href).origin===location.origin}catch{return!1}}let h=Ee(!1);Ze(()=>{M(s)?.picture?(se(c,!1),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&M(s).picture.includes("profile=true")&&console.log("Service Workerã§ãã­ãã£ã¼ã«ç»åãã­ã£ãã·ã¥å¦çäºå®:",M(s).picture),se(h,f(M(s).picture),!0)):se(h,!1)});function p(S){M(l)?.updateProgress(S)}function m(){M(l)?.reset()}var g={isSameOriginPictureUrl:f,updateProgress:p,reset:m},y=hhe(),w=ye(y);{var k=S=>{mn(S,{shape:"circle",className:"profile-display loading",disabled:!0,children:(x,_)=>{xl(x,{showLoader:!0})},$$slots:{default:!0}})},C=S=>{var x=en(),_=Et(x);{var I=B=>{mn(B,{shape:"circle",className:"profile-display loading",disabled:!0,children:(F,R)=>{xl(F,{showLoader:!0})},$$slots:{default:!0}})},D=B=>{var F=en(),R=Et(F);{var O=H=>{{let U=Xe(()=>`profile-display${M(o)?" loading":""}`);mn(H,{variant:"default",shape:"circle",get className(){return M(U)},get disabled(){return M(o)},onClick:()=>{M(o)||e.onOpenLogoutDialog()},children:(j,Q)=>{var X=en(),de=Et(X);{var le=he=>{xl(he,{showLoader:!0})},J=he=>{var Me=en(),pe=Et(Me);{var Te=oe=>{var ge=che();DI(ge,Ie=>({src:M(s).picture,alt:Ie,class:"profile-picture",loading:"lazy",...M(h)?{crossorigin:"anonymous",referrerpolicy:"no-referrer"}:{},onerror:d}),[u],void 0,"svelte-11irzrh"),we(oe,ge)},je=oe=>{var ge=uhe();we(oe,ge)};Ye(pe,oe=>{M(s)?.picture&&!M(c)?oe(Te):oe(je,!1)},!0)}we(he,Me)};Ye(de,he=>{M(o)?he(le):he(J,!1)})}we(j,X)},$$slots:{default:!0}})}},L=H=>{var U=en(),j=Et(U);{var Q=X=>{mn(X,{className:"login-btn",variant:"primary",shape:"pill",get onClick(){return e.onShowLoginDialog},children:(de,le)=>{var J=Sn();Ge(he=>Qe(J,he),[()=>n()("app.login")]),we(de,J)},$$slots:{default:!0}})};Ye(j,X=>{!M(o)&&!e.isAuthenticated&&X(Q)},!0)}we(H,U)};Ye(R,H=>{e.isAuthenticated&&(M(a)||M(o))?H(O):H(L,!1)},!0)}we(B,F)};Ye(_,B=>{e.isAuthenticated&&M(o)?B(I):B(D,!1)},!0)}we(S,x)};Ye(w,S=>{e.isAuthInitialized?S(C,!1):S(k)})}var A=Le(w,2);Xn(lhe(A,{}),S=>se(l,S,!0),()=>M(l));var E=Le(A,2);{let S=Xe(()=>e.swNeedRefresh?"has-update":"");mn(E,{variant:"default",shape:"circle",get className(){return`settings-btn ${M(S)??""}`},get onClick(){return e.onOpenSettingsDialog},ariaLabel:"è¨­å®",children:(x,_)=>{var I=fhe(),D=Le(Et(I),2);{var B=F=>{var R=dhe();we(F,R)};Ye(D,F=>{e.swNeedRefresh&&F(B)})}we(x,I)},$$slots:{default:!0}})}we(t,y);var P=On(g);return i(),P}class mhe{fileUploadManager;isProcessingSharedImage=!1;constructor(e){this.fileUploadManager=new e5(e),this.setupServiceWorkerListeners()}setupServiceWorkerListeners(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}handleServiceWorkerMessage(e){const{data:n,type:r}=e.data||{};r==="SHARED_IMAGE"&&n?.image&&l_(n.image,n.metadata)}checkIfOpenedFromShareInternal(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).get("shared")==="true"}async checkForSharedImageOnLaunch(){if(this.isProcessingSharedImage)return{success:!1,error:"æ¢ã«å¦çä¸­ã§ã"};if(!this.checkIfOpenedFromShareInternal())return{success:!1,error:"å±æçµç±ã§ã®èµ·åã§ã¯ããã¾ãã"};this.isProcessingSharedImage=!0;try{const e=await this.fileUploadManager.processSharedImageOnLaunch();return e.success&&e.data&&l_(e.data.image,e.data.metadata),e}finally{this.isProcessingSharedImage=!1}}async getSharedImageFromServiceWorker(){return await this.fileUploadManager.getSharedImageFromServiceWorker()}checkIfOpenedFromShare(){return this.fileUploadManager.checkIfOpenedFromShare()}isProcessing(){return this.isProcessingSharedImage}getSharedImageFile(){return XZ()}getSharedImageMetadata(){return YZ()}clearSharedImage(){GZ()}}let Zw=null;function ghe(){return Zw||(Zw=new mhe),Zw}function jA(){return ghe().checkIfOpenedFromShare()}function yhe(){if(typeof window>"u"||!window.location)return null;const e=new URLSearchParams(window.location.search).get("content");if(!e)return null;try{const n=decodeURIComponent(e);return cN(n)}catch(n){return console.error("URLã¯ã¨ãªãã©ã¡ã¼ã¿ã®ãã³ã¼ãã«å¤±æ:",n),null}}function bhe(){if(typeof window>"u"||!window.location)return;const t=new URLSearchParams(window.location.search),e=[];let n=!1;if(t.has("content")){const i=t.get("content");(!i||i.trim()==="")&&(n=!0),t.delete("content"),n=!0}const r=[];if(t.forEach((i,s)=>{e.includes(s)||(r.push(s),n=!0)}),r.forEach(i=>t.delete(i)),n){const i=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",i)}}function whe(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).has("content")}var vhe=Ve('<main class="svelte-830cve"><div class="main-content svelte-830cve"><!> <!></div> <!> <!> <!> <!> <!></main>');function xhe(t,e){Mn(e,!0);const n=()=>or(ks,"$locale",s),r=()=>or(Jr,"$_",s),i=()=>or(Mx,"$swNeedRefresh",s),[s,o]=as();let a=Ee(""),l=Ee("");const c=za.getPublicKeyState();Ze(()=>{c.setNsec(M(l))}),Ze(()=>{Cf.value&&(se(l,""),se(a,""))});let u=Xe(()=>br.value?.isAuthenticated??!1),d=Xe(()=>br.value?.isInitialized??!1),f=!1,h="";if(!f){const oe=localStorage.getItem("nsec"),ge=localStorage.getItem("__nostrlogin_nip46");if(!oe){if(ge)try{const Ie=JSON.parse(ge);Ie?.pubkey&&(h=Ie.pubkey)}catch{}}f=!0}let p=Ee(void 0),m,g=Ee(!1),y=Ee(void 0),w=Ee(void 0),k=Ee(!1);async function C(oe){se(p,sz({verifier:g7}),!0);const ge=new $X(M(p)),Ie=new zZ(M(p),{relayListUpdatedStore:{value:r1.value,set:_e=>r1.set(_e)}});m=new FX(M(p),Ie,ge),nQ(Ie),await m.initializeRelays(oe)}async function A(oe){const ge=await za.authenticateWithNostrLogin(oe);if(!ge.success){console.error("nostr-loginèªè¨¼å¤±æ:",ge.error);return}if(ge.pubkeyHex){se(g,!0),ms.set(!0),Xb();try{await C();const Ie=await m.initializeForLogin(ge.pubkeyHex);Ie&&(Xa.set(Ie),hu.set(!0)),ms.set(!1)}catch(Ie){console.error("nostr-loginèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",Ie),ms.set(!1)}finally{se(g,!1)}}}async function E(){const oe=await za.authenticateWithNsec(M(l));if(!oe.success){se(a,oe.error||"authentication_error",!0);return}ms.set(!0),Xb(),se(a,"");try{if(oe.pubkeyHex){const ge=await m.initializeForLogin(oe.pubkeyHex);ge&&(Xa.set(ge),hu.set(!0)),ms.set(!1)}else ms.set(!1)}catch{ms.set(!1)}}function P(){se(k,!0),za.logout(),Xa.set({name:"",picture:"",npub:"",nprofile:""}),hu.set(!1),M(y)?.resetPostContent&&M(y).resetPostContent(),UM(),se(l,""),se(a,"")}async function S(){se(g,!0);try{await za.showNostrLoginDialog()}catch(oe){oe instanceof Error&&oe.message==="Cancelled"||console.error("nostr-loginã§ã¨ã©ã¼:",oe)}finally{se(g,!1)}}Ze(()=>{n()&&localStorage.setItem("locale",n())}),Ze(()=>{const oe=br.value?.pubkey;oe&&br.value?.isAuthenticated&&m&&m.getRelayManager().loadRelayConfigForUI(oe)});let x=Ee(!1);const _=localStorage.getItem("sharedImageProcessed")==="1";ls(()=>((async()=>{const ge=localStorage.getItem("locale");if(ge&&ge!==n()&&ks.set(ge),await J9(),se(x,!0),za.setNostrLoginHandler(A),jA()){const _e=await MX(),Ue=await OX();(!_e.isReady||!_e.hasController||!Ue)&&console.warn("Service Worker not ready for shared image processing:",_e)}if((async()=>{try{const _e=await za.initializeAuth();if(_e.hasAuth&&_e.pubkeyHex){await C(_e.pubkeyHex);const Ue=await m.initializeForLogin(_e.pubkeyHex);Ue&&(Xa.set(Ue),hu.set(!0)),ms.set(!1)}else await C(),ms.set(!1)}catch(_e){console.error("èªè¨¼åæåä¸­ã«ã¨ã©ã¼:",_e),await C(),ms.set(!1)}finally{za.markAuthInitialized()}})(),jA()&&!_)try{const _e=await PX();if(_e?.image)mr.file=_e.image,mr.metadata=_e.metadata,mr.received=!0,localStorage.setItem("sharedImageProcessed","1");else{console.warn("No shared image data received");const Je=new URLSearchParams(window.location.search).get("error");Je&&console.error("Shared image processing failed with error parameter:",{error:Je,location:window.location.href})}}catch(_e){console.error("å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼:",_e)}if(localStorage.getItem("firstVisit")!=="1"?(Yd.set(!0),localStorage.setItem("firstVisit","1")):setTimeout(()=>{M(y)?.focusEditor()},300),whe()){const _e=yhe();_e&&ZZ(_e)}bhe()})(),Q=document.visibilityState==="hidden",document.addEventListener("visibilitychange",de),()=>{document.removeEventListener("visibilitychange",de)})),Ze(()=>{mr.received&&mr.file&&M(y)&&(M(y).uploadFiles([mr.file]),mr.file=null,mr.metadata=void 0,mr.received=!1,localStorage.setItem("sharedImageProcessed","1"),setTimeout(()=>localStorage.removeItem("sharedImageProcessed"),500))}),Ze(()=>{gc.received&&gc.content&&M(y)&&(M(y).insertTextContent(gc.content),QZ())});function I(oe){eQ.set(oe)}function D(oe){M(w)&&M(w).updateProgress(oe)}function B(){M(w)?.reset&&M(w).reset(),localStorage.removeItem("sharedImageProcessed")}function F(){M(y)?.resetPostContent()}let R=null;async function O(){if(!M(u)||!br.value.pubkey)return;m||await C(br.value.pubkey);const oe=await m.refreshRelaysAndProfile(br.value.pubkey);oe&&(Xa.set(oe),hu.set(!0))}let L=Ee(!1),H=Ee(null),U=Ee(!1);Ze(()=>{r()&&!R&&(R=new b6(r()))}),Ze(()=>{M(x)&&R&&!M(L)&&!M(U)&&(j(),se(U,!0))});function j(){!R||M(L)||(se(H,R.createMessage("info"),!0),se(L,!0),R.scheduleHide(()=>{se(L,!1),se(H,null)},3e3))}let Q=!1,X=0;function de(){const oe=Date.now();if(oe-X<1e3){Q=document.visibilityState==="hidden";return}document.visibilityState==="visible"&&Q&&M(x)&&R&&!M(L)&&(j(),X=oe),Q=document.visibilityState==="hidden"}let le=Ee(At(localStorage.getItem("imageCompressionLevel")||"medium"));function J(oe){se(le,oe,!0)}let he=Ee(At(localStorage.getItem("uploadEndpoint")||Ax(n())));function Me(oe){se(he,oe,!0)}Ze(()=>()=>{R&&R.dispose()});var pe=en(),Te=Et(pe);{var je=oe=>{var ge=vhe(),Ie=ye(ge),_e=ye(Ie);{let Oe=Xe(()=>M(L)&&M(H)?M(H):null);Gfe(_e,{onUploadImage:()=>M(y)?.openFileDialog(),onResetPostContent:F,get balloonMessage(){return M(Oe)}})}var Ue=Le(_e,2);Xn(Gae(Ue,{get rxNostr(){return M(p)},get hasStoredKey(){return M(u)},onPostSuccess:B,onUploadStatusChange:I,onUploadProgress:D}),Oe=>se(y,Oe,!0),()=>M(y));var Je=Le(Ie,2);Xn(phe(Je,{get isAuthenticated(){return M(u)},get isAuthInitialized(){return M(d)},get swNeedRefresh(){return i()},get onShowLoginDialog(){return rQ},get onOpenSettingsDialog(){return oQ},get onOpenLogoutDialog(){return iQ}}),Oe=>se(w,Oe,!0),()=>M(w));var ft=Le(Je,2);{var ot=Oe=>{Cfe(Oe,{get show(){return Cf.value},get onClose(){return Xb},onSave:E,onNostrLogin:S,get isLoadingNostrLogin(){return M(g)},get secretKey(){return M(l)},set secretKey(at){se(l,at,!0)}})};Ye(ft,Oe=>{Cf.value&&Oe(ot)})}var mt=Le(ft,2);{var It=Oe=>{bfe(Oe,{get show(){return Vm.value},get onClose(){return sQ},onLogout:P,get isLoggingOut(){return M(k)}})};Ye(mt,Oe=>{Vm.value&&Oe(It)})}var bt=Le(mt,2);{var Lt=Oe=>{Ife(Oe,{get show(){return Yd.value},onClose:()=>Yd.set(!1)})};Ye(bt,Oe=>{Yd.value&&Oe(Lt)})}var Pe=Le(bt,2);afe(Pe,{get show(){return Px.value},get onClose(){return aQ},onRefreshRelaysAndProfile:O,get selectedCompression(){return M(le)},onSelectedCompressionChange:J,get selectedEndpoint(){return M(he)},onSelectedEndpointChange:Me,onOpenWelcomeDialog:()=>Yd.set(!0)}),we(oe,ge)};Ye(Te,oe=>{n()&&M(x)&&oe(je)})}we(t,pe),On(),o()}AI(xhe,{target:document.getElementById("app")});
