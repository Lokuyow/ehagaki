(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();const Nf=!1;var Zi=Array.isArray,F0=Array.prototype.indexOf,vl=Array.from,To=Object.defineProperty,_n=Object.getOwnPropertyDescriptor,Cf=Object.getOwnPropertyDescriptors,q0=Object.prototype,j0=Array.prototype,ml=Object.getPrototypeOf,Ku=Object.isExtensible;const sn=()=>{};function z0(e){return e()}function Io(e){for(var t=0;t<e.length;t++)e[t]()}function W0(){var e,t,r=new Promise((n,i)=>{e=n,t=i});return{promise:r,resolve:e,reject:t}}const $t=2,bl=4,is=8,Xi=16,Hr=32,ci=64,Bf=128,jt=256,Oo=512,et=1024,Ot=2048,hn=4096,Kt=8192,Pn=16384,yl=32768,wl=65536,Zu=1<<17,G0=1<<18,El=1<<19,_l=1<<20,Oa=1<<21,xl=1<<22,xn=1<<23,Cr=Symbol("$state"),V0=Symbol("legacy props"),K0=Symbol(""),Al=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Z0(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function $f(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function X0(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Y0(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function Q0(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function J0(e){throw new Error("https://svelte.dev/e/effect_orphan")}function eg(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function tg(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function rg(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ng(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ig(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const os=1,ss=2,Uf=4,og=8,sg=16,ag=1,lg=2,kf=4,ug=8,cg=16,fg=1,hg=2,at=Symbol(),dg="http://www.w3.org/1999/xhtml";function pg(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let gg=!1;function Mf(e){return e===this.v}function Hf(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Df(e){return!Hf(e,this.v)}let fi=!1,vg=!1;function mg(){fi=!0}let ze=null;function Ro(e){ze=e}function Yt(e,t=!1,r){ze={p:ze,c:null,e:null,s:e,x:null,l:fi&&!t?{s:null,u:null,$:[]}:null}}function Qt(e){var t=ze,r=t.e;if(r!==null){t.e=null;for(var n of r)Qf(n)}return e!==void 0&&(t.x=e),ze=t.p,e??{}}function hi(){return!fi||ze!==null&&ze.l===null}const bg=new WeakMap;function yg(e){var t=be;if(t===null)return Ie.f|=xn,e;if((t.f&yl)===0){if((t.f&Bf)===0)throw!t.parent&&e instanceof Error&&Ff(e),e;t.b.error(e)}else Sl(e,t)}function Sl(e,t){for(;t!==null;){if((t.f&Bf)!==0)try{t.b.error(e);return}catch(r){e=r}t=t.parent}throw e instanceof Error&&Ff(e),e}function Ff(e){const t=bg.get(e);t&&(To(e,"message",{value:t.message}),To(e,"stack",{value:t.stack}))}let Lo=[];function wg(){var e=Lo;Lo=[],Io(e)}function Tl(e){Lo.length===0&&queueMicrotask(wg),Lo.push(e)}function Eg(){for(var e=be.b;e!==null&&!e.has_pending_snippet();)e=e.parent;return e===null&&Z0(),e}function as(e){var t=$t|Ot,r=Ie!==null&&(Ie.f&$t)!==0?Ie:null;return be===null||r!==null&&(r.f&jt)!==0?t|=jt:be.f|=El,{ctx:ze,deps:null,effects:null,equals:Mf,f:t,fn:e,reactions:null,rv:0,v:at,wv:0,parent:r??be,ac:null}}function _g(e,t){let r=be;r===null&&X0();var n=r.b,i=void 0,o=Yn(at),s=null,a=!Ie;return Bg(()=>{try{var l=e()}catch(d){l=Promise.reject(d)}var f=()=>l;i=s?.then(f,f)??Promise.resolve(l),s=i;var u=Je,c=n.pending;a&&(n.update_pending_count(1),c||u.increment());const h=(d,p=void 0)=>{s=null,c||u.activate(),p?p!==Al&&(o.f|=xn,Qn(o,p)):((o.f&xn)!==0&&(o.f^=xn),Qn(o,d)),a&&(n.update_pending_count(-1),c||u.decrement()),zf()};if(i.then(h,d=>h(null,d||"unknown")),u)return()=>{queueMicrotask(()=>u.neuter())}}),new Promise(l=>{function f(u){function c(){u===i?l(o):f(i)}u.then(c,c)}f(i)})}function Ct(e){const t=as(e);return t.equals=Df,t}function qf(e){var t=e.effects;if(t!==null){e.effects=null;for(var r=0;r<t.length;r+=1)kr(t[r])}}function xg(e){for(var t=e.parent;t!==null;){if((t.f&$t)===0)return t;t=t.parent}return null}function Il(e){var t,r=be;pr(xg(e));try{qf(e),t=uh(e)}finally{pr(r)}return t}function jf(e){var t=Il(e);if(e.equals(t)||(e.v=t,e.wv=ah()),!Cn)if(Xn!==null)Xn.set(e,e.v);else{var r=(rn||(e.f&jt)!==0)&&e.deps!==null?hn:et;tt(e,r)}}function Ag(e,t,r){const n=hi()?as:Ct;if(t.length===0){r(e.map(n));return}var i=Je,o=be,s=Sg(),a=Eg();Promise.all(t.map(l=>_g(l))).then(l=>{i?.activate(),s();try{r([...e.map(n),...l])}catch(f){(o.f&Pn)===0&&Sl(f,o)}i?.deactivate(),zf()}).catch(l=>{a.error(l)})}function Sg(){var e=be,t=Ie,r=ze;return function(){pr(e),dr(t),Ro(r)}}function zf(){pr(null),dr(null),Ro(null)}const lo=new Set;let Je=null,Xn=null,Xu=new Set,Po=[];function Wf(){const e=Po.shift();Po.length>0&&queueMicrotask(Wf),e()}let Li=[],Ol=null,Ra=!1;class Mi{#l=new Map;#o=new Map;#s=new Set;#t=0;#u=null;#c=!1;#n=[];#a=[];#r=[];#e=[];#i=[];skipped_effects=new Set;#h(t){Li=[];var r=null;if(lo.size>1){r=new Map,Xn=new Map;for(const[o,s]of this.#l)r.set(o,{v:o.v,wv:o.wv}),o.v=s;for(const o of lo)if(o!==this)for(const[s,a]of o.#o)r.has(s)||(r.set(s,{v:s.v,wv:s.wv}),s.v=a)}for(const o of t)this.#d(o);if(this.#n.length===0&&this.#t===0){var n=this.#r,i=this.#e;this.#r=[],this.#e=[],this.#i=[],this.#f(),Yu(n),Yu(i),this.#u?.resolve()}else{for(const o of this.#r)tt(o,et);for(const o of this.#e)tt(o,et);for(const o of this.#i)tt(o,et)}if(r){for(const[o,{v:s,wv:a}]of r)o.wv<=a&&(o.v=s);Xn=null}for(const o of this.#n)Gn(o);for(const o of this.#a)Gn(o);this.#n=[],this.#a=[]}#d(t){t.f^=et;for(var r=t.first;r!==null;){var n=r.f,i=(n&(Hr|ci))!==0,o=i&&(n&et)!==0,s=o||(n&Kt)!==0||this.skipped_effects.has(r);if(!s&&r.fn!==null){if(i)r.f^=et;else if((n&bl)!==0)this.#e.push(r);else if(Yi(r))if((n&xl)!==0){var a=r.b?.pending?this.#a:this.#n;a.push(r)}else(r.f&Xi)!==0&&this.#i.push(r),Gn(r);var l=r.first;if(l!==null){r=l;continue}}var f=r.parent;for(r=r.next;r===null&&f!==null;)r=f.next,f=f.parent}}capture(t,r){this.#o.has(t)||this.#o.set(t,r),this.#l.set(t,t.v)}activate(){Je=this}deactivate(){Je=null;for(const t of Xu)if(Xu.delete(t),t(),Je!==null)break}neuter(){this.#c=!0}flush(){Li.length>0?this.flush_effects():this.#f(),Je===this&&(this.#t===0&&lo.delete(this),this.deactivate())}flush_effects(){var t=Wn;Ra=!0;try{var r=0;for(tc(!0);Li.length>0;){if(r++>1e3){var n,i;Tg()}this.#h(Li),An.clear()}}finally{Ra=!1,tc(t),Ol=null}}#f(){if(!this.#c)for(const t of this.#s)t();this.#s.clear()}increment(){this.#t+=1}decrement(){if(this.#t-=1,this.#t===0){for(const t of this.#r)tt(t,Ot),an(t);for(const t of this.#e)tt(t,Ot),an(t);for(const t of this.#i)tt(t,Ot),an(t);this.#r=[],this.#e=[],this.flush()}else this.deactivate()}add_callback(t){this.#s.add(t)}settled(){return(this.#u??=W0()).promise}static ensure(t=!0){if(Je===null){const r=Je=new Mi;lo.add(Je),t&&Mi.enqueue(()=>{Je===r&&r.flush()})}return Je}static enqueue(t){Po.length===0&&queueMicrotask(Wf),Po.unshift(t)}}function Tg(){try{eg()}catch(e){Sl(e,Ol)}}function Yu(e){var t=e.length;if(t!==0){for(var r=0;r<t;r++){var n=e[r];if((n.f&(Pn|Kt))===0&&Yi(n)){var i=No;if(Gn(n),n.deps===null&&n.first===null&&n.nodes_start===null&&(n.teardown===null&&n.ac===null?ih(n):n.fn=null),No>i&&(n.f&_l)!==0)break}}for(;r<t;r+=1)an(e[r])}}function an(e){for(var t=Ol=e;t.parent!==null;){t=t.parent;var r=t.f;if(Ra&&t===be&&(r&Xi)!==0)return;if((r&(ci|Hr))!==0){if((r&et)===0)return;t.f^=et}}Li.push(t)}const An=new Map;function Yn(e,t){var r={f:0,v:e,reactions:null,equals:Mf,rv:0,wv:0};return r}function Kr(e,t){const r=Yn(e);return Mg(r),r}function Se(e,t=!1,r=!0){const n=Yn(e);return t||(n.equals=Df),fi&&r&&ze!==null&&ze.l!==null&&(ze.l.s??=[]).push(n),n}function Ig(e,t){return W(e,X(()=>H(e))),t}function W(e,t,r=!1){Ie!==null&&(!lr||(Ie.f&Zu)!==0)&&hi()&&(Ie.f&($t|Xi|xl|Zu))!==0&&!Br?.includes(e)&&ig();let n=r?qn(t):t;return Qn(e,n)}function Qn(e,t){if(!e.equals(t)){var r=e.v;Cn?An.set(e,t):An.set(e,r),e.v=t,Mi.ensure().capture(e,r),(e.f&$t)!==0&&((e.f&Ot)!==0&&Il(e),tt(e,(e.f&jt)===0?et:hn)),e.wv=ah(),Gf(e,Ot),hi()&&be!==null&&(be.f&et)!==0&&(be.f&(Hr|ci))===0&&(Mt===null?Hg([e]):Mt.push(e))}return t}function Qu(e,t=1){var r=H(e),n=t===1?r++:r--;return W(e,r),n}function ks(e){W(e,e.v+1)}function Gf(e,t){var r=e.reactions;if(r!==null)for(var n=hi(),i=r.length,o=0;o<i;o++){var s=r[o],a=s.f;!n&&s===be||((a&Ot)===0&&tt(s,t),(a&$t)!==0?Gf(s,hn):(a&Ot)===0&&an(s))}}function qn(e){if(typeof e!="object"||e===null||Cr in e)return e;const t=ml(e);if(t!==q0&&t!==j0)return e;var r=new Map,n=Zi(e),i=Kr(0),o=Sn,s=a=>{if(Sn===o)return a();var l=Ie,f=Sn;dr(null),nc(o);var u=a();return dr(l),nc(f),u};return n&&r.set("length",Kr(e.length)),new Proxy(e,{defineProperty(a,l,f){(!("value"in f)||f.configurable===!1||f.enumerable===!1||f.writable===!1)&&rg();var u=r.get(l);return u===void 0?u=s(()=>{var c=Kr(f.value);return r.set(l,c),c}):W(u,f.value,!0),!0},deleteProperty(a,l){var f=r.get(l);if(f===void 0){if(l in a){const u=s(()=>Kr(at));r.set(l,u),ks(i)}}else W(f,at),ks(i);return!0},get(a,l,f){if(l===Cr)return e;var u=r.get(l),c=l in a;if(u===void 0&&(!c||_n(a,l)?.writable)&&(u=s(()=>{var d=qn(c?a[l]:at),p=Kr(d);return p}),r.set(l,u)),u!==void 0){var h=H(u);return h===at?void 0:h}return Reflect.get(a,l,f)},getOwnPropertyDescriptor(a,l){var f=Reflect.getOwnPropertyDescriptor(a,l);if(f&&"value"in f){var u=r.get(l);u&&(f.value=H(u))}else if(f===void 0){var c=r.get(l),h=c?.v;if(c!==void 0&&h!==at)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return f},has(a,l){if(l===Cr)return!0;var f=r.get(l),u=f!==void 0&&f.v!==at||Reflect.has(a,l);if(f!==void 0||be!==null&&(!u||_n(a,l)?.writable)){f===void 0&&(f=s(()=>{var h=u?qn(a[l]):at,d=Kr(h);return d}),r.set(l,f));var c=H(f);if(c===at)return!1}return u},set(a,l,f,u){var c=r.get(l),h=l in a;if(n&&l==="length")for(var d=f;d<c.v;d+=1){var p=r.get(d+"");p!==void 0?W(p,at):d in a&&(p=s(()=>Kr(at)),r.set(d+"",p))}if(c===void 0)(!h||_n(a,l)?.writable)&&(c=s(()=>Kr(void 0)),W(c,qn(f)),r.set(l,c));else{h=c.v!==at;var g=s(()=>qn(f));W(c,g)}var m=Reflect.getOwnPropertyDescriptor(a,l);if(m?.set&&m.set.call(u,f),!h){if(n&&typeof l=="string"){var v=r.get("length"),A=Number(l);Number.isInteger(A)&&A>=v.v&&W(v,A+1)}ks(i)}return!0},ownKeys(a){H(i);var l=Reflect.ownKeys(a).filter(c=>{var h=r.get(c);return h===void 0||h.v!==at});for(var[f,u]of r)u.v!==at&&!(f in a)&&l.push(f);return l},setPrototypeOf(){ng()}})}function Ju(e){try{if(e!==null&&typeof e=="object"&&Cr in e)return e[Cr]}catch{}return e}function Og(e,t){return Object.is(Ju(e),Ju(t))}var ec,Vf,Kf,Zf;function Rg(){if(ec===void 0){ec=window,Vf=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,r=Text.prototype;Kf=_n(t,"firstChild").get,Zf=_n(t,"nextSibling").get,Ku(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Ku(r)&&(r.__t=void 0)}}function di(e=""){return document.createTextNode(e)}function tn(e){return Kf.call(e)}function ls(e){return Zf.call(e)}function se(e,t){return tn(e)}function rt(e,t){{var r=tn(e);return r instanceof Comment&&r.data===""?ls(r):r}}function pe(e,t=1,r=!1){let n=e;for(;t--;)n=ls(n);return n}function Lg(e){e.textContent=""}function Xf(){return!1}function Yf(e){be===null&&Ie===null&&J0(),Ie!==null&&(Ie.f&jt)!==0&&be===null&&Q0(),Cn&&Y0()}function Pg(e,t){var r=t.last;r===null?t.last=t.first=e:(r.next=e,e.prev=r,t.last=e)}function vr(e,t,r,n=!0){var i=be;i!==null&&(i.f&Kt)!==0&&(e|=Kt);var o={ctx:ze,deps:null,nodes_start:null,nodes_end:null,f:e|Ot,first:null,fn:t,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(r)try{Gn(o),o.f|=yl}catch(l){throw kr(o),l}else t!==null&&an(o);var s=r&&o.deps===null&&o.first===null&&o.nodes_start===null&&o.teardown===null&&(o.f&El)===0;if(!s&&n&&(i!==null&&Pg(o,i),Ie!==null&&(Ie.f&$t)!==0)){var a=Ie;(a.effects??=[]).push(o)}return o}function us(e){const t=vr(is,null,!1);return tt(t,et),t.teardown=e,t}function La(e){Yf();var t=be.f,r=!Ie&&(t&Hr)!==0&&(t&yl)===0;if(r){var n=ze;(n.e??=[]).push(e)}else return Qf(e)}function Qf(e){return vr(bl|_l,e,!1)}function Ng(e){return Yf(),vr(is|_l,e,!0)}function Cg(e){Mi.ensure();const t=vr(ci,e,!0);return(r={})=>new Promise(n=>{r.outro?Rl(t,()=>{kr(t),n(void 0)}):(kr(t),n(void 0))})}function Jf(e){return vr(bl,e,!1)}function De(e,t){var r=ze,n={effect:null,ran:!1,deps:e};r.l.$.push(n),n.effect=cs(()=>{e(),!n.ran&&(n.ran=!0,X(t))})}function Nn(){var e=ze;cs(()=>{for(var t of e.l.$){t.deps();var r=t.effect;(r.f&et)!==0&&tt(r,hn),Yi(r)&&Gn(r),t.ran=!1}})}function Bg(e){return vr(xl|El,e,!0)}function cs(e,t=0){return vr(is|t,e,!0)}function Te(e,t=[],r=[]){Ag(t,r,n=>{vr(is,()=>e(...n.map(H)),!0)})}function eh(e,t=0){var r=vr(Xi|t,e,!0);return r}function Hi(e,t=!0){return vr(Hr,e,!0,t)}function th(e){var t=e.teardown;if(t!==null){const r=Cn,n=Ie;rc(!0),dr(null);try{t.call(null)}finally{rc(r),dr(n)}}}function rh(e,t=!1){var r=e.first;for(e.first=e.last=null;r!==null;){r.ac?.abort(Al);var n=r.next;(r.f&ci)!==0?r.parent=null:kr(r,t),r=n}}function $g(e){for(var t=e.first;t!==null;){var r=t.next;(t.f&Hr)===0&&kr(t),t=r}}function kr(e,t=!0){var r=!1;(t||(e.f&G0)!==0)&&e.nodes_start!==null&&e.nodes_end!==null&&(nh(e.nodes_start,e.nodes_end),r=!0),rh(e,t&&!r),Co(e,0),tt(e,Pn);var n=e.transitions;if(n!==null)for(const o of n)o.stop();th(e);var i=e.parent;i!==null&&i.first!==null&&ih(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function nh(e,t){for(;e!==null;){var r=e===t?null:ls(e);e.remove(),e=r}}function ih(e){var t=e.parent,r=e.prev,n=e.next;r!==null&&(r.next=n),n!==null&&(n.prev=r),t!==null&&(t.first===e&&(t.first=n),t.last===e&&(t.last=r))}function Rl(e,t){var r=[];Ll(e,r,!0),oh(r,()=>{kr(e),t&&t()})}function oh(e,t){var r=e.length;if(r>0){var n=()=>--r||t();for(var i of e)i.out(n)}else t()}function Ll(e,t,r){if((e.f&Kt)===0){if(e.f^=Kt,e.transitions!==null)for(const s of e.transitions)(s.is_global||r)&&t.push(s);for(var n=e.first;n!==null;){var i=n.next,o=(n.f&wl)!==0||(n.f&Hr)!==0;Ll(n,t,o?r:!1),n=i}}}function Pl(e){sh(e,!0)}function sh(e,t){if((e.f&Kt)!==0){e.f^=Kt,(e.f&et)===0&&(tt(e,Ot),an(e));for(var r=e.first;r!==null;){var n=r.next,i=(r.f&wl)!==0||(r.f&Hr)!==0;sh(r,i?t:!1),r=n}if(e.transitions!==null)for(const o of e.transitions)(o.is_global||t)&&o.in()}}let Dn=null;function Ug(e){var t=Dn;try{if(Dn=new Set,X(e),t!==null)for(var r of Dn)t.add(r);return Dn}finally{Dn=t}}function kg(e){for(var t of Ug(e))Qn(t,t.v)}let Wn=!1;function tc(e){Wn=e}let Cn=!1;function rc(e){Cn=e}let Ie=null,lr=!1;function dr(e){Ie=e}let be=null;function pr(e){be=e}let Br=null;function Mg(e){Ie!==null&&(Br===null?Br=[e]:Br.push(e))}let Et=null,Nt=0,Mt=null;function Hg(e){Mt=e}let No=1,Di=0,Sn=Di;function nc(e){Sn=e}let rn=!1;function ah(){return++No}function Yi(e){var t=e.f;if((t&Ot)!==0)return!0;if((t&hn)!==0){var r=e.deps,n=(t&jt)!==0;if(r!==null){var i,o,s=(t&Oo)!==0,a=n&&be!==null&&!rn,l=r.length;if((s||a)&&(be===null||(be.f&Pn)===0)){var f=e,u=f.parent;for(i=0;i<l;i++)o=r[i],(s||!o?.reactions?.includes(f))&&(o.reactions??=[]).push(f);s&&(f.f^=Oo),a&&u!==null&&(u.f&jt)===0&&(f.f^=jt)}for(i=0;i<l;i++)if(o=r[i],Yi(o)&&jf(o),o.wv>e.wv)return!0}(!n||be!==null&&!rn)&&tt(e,et)}return!1}function lh(e,t,r=!0){var n=e.reactions;if(n!==null&&!Br?.includes(e))for(var i=0;i<n.length;i++){var o=n[i];(o.f&$t)!==0?lh(o,t,!1):t===o&&(r?tt(o,Ot):(o.f&et)!==0&&tt(o,hn),an(o))}}function uh(e){var t=Et,r=Nt,n=Mt,i=Ie,o=rn,s=Br,a=ze,l=lr,f=Sn,u=e.f;Et=null,Nt=0,Mt=null,rn=(u&jt)!==0&&(lr||!Wn||Ie===null),Ie=(u&(Hr|ci))===0?e:null,Br=null,Ro(e.ctx),lr=!1,Sn=++Di,e.ac!==null&&(e.ac.abort(Al),e.ac=null);try{e.f|=Oa;var c=(0,e.fn)(),h=e.deps;if(Et!==null){var d;if(Co(e,Nt),h!==null&&Nt>0)for(h.length=Nt+Et.length,d=0;d<Et.length;d++)h[Nt+d]=Et[d];else e.deps=h=Et;if(!rn||(u&$t)!==0&&e.reactions!==null)for(d=Nt;d<h.length;d++)(h[d].reactions??=[]).push(e)}else h!==null&&Nt<h.length&&(Co(e,Nt),h.length=Nt);if(hi()&&Mt!==null&&!lr&&h!==null&&(e.f&($t|hn|Ot))===0)for(d=0;d<Mt.length;d++)lh(Mt[d],e);return i!==null&&i!==e&&(Di++,Mt!==null&&(n===null?n=Mt:n.push(...Mt))),(e.f&xn)!==0&&(e.f^=xn),c}catch(p){return yg(p)}finally{e.f^=Oa,Et=t,Nt=r,Mt=n,Ie=i,rn=o,Br=s,Ro(a),lr=l,Sn=f}}function Dg(e,t){let r=t.reactions;if(r!==null){var n=F0.call(r,e);if(n!==-1){var i=r.length-1;i===0?r=t.reactions=null:(r[n]=r[i],r.pop())}}r===null&&(t.f&$t)!==0&&(Et===null||!Et.includes(t))&&(tt(t,hn),(t.f&(jt|Oo))===0&&(t.f^=Oo),qf(t),Co(t,0))}function Co(e,t){var r=e.deps;if(r!==null)for(var n=t;n<r.length;n++)Dg(e,r[n])}function Gn(e){var t=e.f;if((t&Pn)===0){tt(e,et);var r=be,n=Wn;be=e,Wn=!0;try{(t&Xi)!==0?$g(e):rh(e),th(e);var i=uh(e);e.teardown=typeof i=="function"?i:null,e.wv=No;var o;Nf&&vg&&(e.f&Ot)!==0&&e.deps}finally{Wn=n,be=r}}}function H(e){var t=e.f,r=(t&$t)!==0;if(Dn?.add(e),Ie!==null&&!lr){var n=be!==null&&(be.f&Pn)!==0;if(!n&&!Br?.includes(e)){var i=Ie.deps;if((Ie.f&Oa)!==0)e.rv<Di&&(e.rv=Di,Et===null&&i!==null&&i[Nt]===e?Nt++:Et===null?Et=[e]:(!rn||!Et.includes(e))&&Et.push(e));else{(Ie.deps??=[]).push(e);var o=e.reactions;o===null?e.reactions=[Ie]:o.includes(Ie)||o.push(Ie)}}}else if(r&&e.deps===null&&e.effects===null){var s=e,a=s.parent;a!==null&&(a.f&jt)===0&&(s.f^=jt)}if(Cn){if(An.has(e))return An.get(e);if(r){s=e;var l=s.v;return((s.f&et)===0&&s.reactions!==null||ch(s))&&(l=Il(s)),An.set(s,l),l}}else if(r){if(s=e,Xn?.has(s))return Xn.get(s);Yi(s)&&jf(s)}if((e.f&xn)!==0)throw e.v;return e.v}function ch(e){if(e.v===at)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(An.has(t)||(t.f&$t)!==0&&ch(t))return!0;return!1}function X(e){var t=lr;try{return lr=!0,e()}finally{lr=t}}const Fg=-7169;function tt(e,t){e.f=e.f&Fg|t}function Ve(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(Cr in e)Pa(e);else if(!Array.isArray(e))for(let t in e){const r=e[t];typeof r=="object"&&r&&Cr in r&&Pa(r)}}}function Pa(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let n in e)try{Pa(e[n],t)}catch{}const r=ml(e);if(r!==Object.prototype&&r!==Array.prototype&&r!==Map.prototype&&r!==Set.prototype&&r!==Date.prototype){const n=Cf(r);for(let i in n){const o=n[i].get;if(o)try{o.call(e)}catch{}}}}}const qg=["touchstart","touchmove"];function jg(e){return qg.includes(e)}let ic=!1;function zg(){ic||(ic=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const t of e.target.elements)t.__on_r?.()})},{capture:!0}))}function fh(e){var t=Ie,r=be;dr(null),pr(null);try{return e()}finally{dr(t),pr(r)}}function hh(e,t,r,n=r){e.addEventListener(t,()=>fh(r));const i=e.__on_r;i?e.__on_r=()=>{i(),n(!0)}:e.__on_r=()=>n(!0),zg()}const Wg=new Set,oc=new Set;function Gg(e,t,r,n={}){function i(o){if(n.capture||Pi.call(t,o),!o.cancelBubble)return fh(()=>r?.call(this,o))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Tl(()=>{t.addEventListener(e,i,n)}):t.addEventListener(e,i,n),i}function ur(e,t,r,n,i){var o={capture:n,passive:i},s=Gg(e,t,r,o);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&us(()=>{t.removeEventListener(e,s,o)})}function Pi(e){var t=this,r=t.ownerDocument,n=e.type,i=e.composedPath?.()||[],o=i[0]||e.target,s=0,a=e.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var f=i.indexOf(t);if(f===-1)return;l<=f&&(s=l)}if(o=i[s]||e.target,o!==t){To(e,"currentTarget",{configurable:!0,get(){return o||r}});var u=Ie,c=be;dr(null),pr(null);try{for(var h,d=[];o!==null;){var p=o.assignedSlot||o.parentNode||o.host||null;try{var g=o["__"+n];if(g!=null&&(!o.disabled||e.target===o))if(Zi(g)){var[m,...v]=g;m.apply(o,[e,...v])}else g.call(o,e)}catch(A){h?d.push(A):h=A}if(e.cancelBubble||p===t||p===null)break;o=p}if(h){for(let A of d)queueMicrotask(()=>{throw A});throw h}}finally{e.__root=t,delete e.currentTarget,dr(u),pr(c)}}}function dh(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function Fi(e,t){var r=be;r.nodes_start===null&&(r.nodes_start=e,r.nodes_end=t)}function xe(e,t){var r=(t&fg)!==0,n=(t&hg)!==0,i,o=!e.startsWith("<!>");return()=>{i===void 0&&(i=dh(o?e:"<!>"+e),r||(i=tn(i)));var s=n||Vf?document.importNode(i,!0):i.cloneNode(!0);if(r){var a=tn(s),l=s.lastChild;Fi(a,l)}else Fi(s,s);return s}}function qt(e=""){{var t=di(e+"");return Fi(t,t),t}}function Zt(){var e=document.createDocumentFragment(),t=document.createComment(""),r=di();return e.append(t,r),Fi(t,r),e}function re(e,t){e!==null&&e.before(t)}function Le(e,t){var r=t==null?"":typeof t=="object"?t+"":t;r!==(e.__t??=e.nodeValue)&&(e.__t=r,e.nodeValue=r+"")}function Vg(e,t){return Kg(e,t)}const Un=new Map;function Kg(e,{target:t,anchor:r,props:n={},events:i,context:o,intro:s=!0}){Rg();var a=new Set,l=c=>{for(var h=0;h<c.length;h++){var d=c[h];if(!a.has(d)){a.add(d);var p=jg(d);t.addEventListener(d,Pi,{passive:p});var g=Un.get(d);g===void 0?(document.addEventListener(d,Pi,{passive:p}),Un.set(d,1)):Un.set(d,g+1)}}};l(vl(Wg)),oc.add(l);var f=void 0,u=Cg(()=>{var c=r??t.appendChild(di());return Hi(()=>{if(o){Yt({});var h=ze;h.c=o}i&&(n.$$events=i),f=e(c,n)||{},o&&Qt()}),()=>{for(var h of a){t.removeEventListener(h,Pi);var d=Un.get(h);--d===0?(document.removeEventListener(h,Pi),Un.delete(h)):Un.set(h,d)}oc.delete(l),c!==r&&c.parentNode?.removeChild(c)}});return Zg.set(f,u),f}let Zg=new WeakMap;function Be(e,t,r=!1){var n=e,i=null,o=null,s=at,a=r?wl:0,l=!1;const f=(d,p=!0)=>{l=!0,h(p,d)};var u=null;function c(){u!==null&&(u.lastChild.remove(),n.before(u),u=null);var d=s?i:o,p=s?o:i;d&&Pl(d),p&&Rl(p,()=>{s?o=null:i=null})}const h=(d,p)=>{if(s!==(s=d)){var g=Xf(),m=n;if(g&&(u=document.createDocumentFragment(),u.append(m=di())),s?i??=p&&Hi(()=>p(m)):o??=p&&Hi(()=>p(m)),g){var v=Je,A=s?i:o,S=s?o:i;A&&v.skipped_effects.delete(A),S&&v.skipped_effects.add(S),v.add_callback(c)}else c()}};eh(()=>{l=!1,t(f),l||h(null,null)},a)}function ph(e,t){return t}function Xg(e,t,r){for(var n=e.items,i=[],o=t.length,s=0;s<o;s++)Ll(t[s].e,i,!0);var a=o>0&&i.length===0&&r!==null;if(a){var l=r.parentNode;Lg(l),l.append(r),n.clear(),sr(e,t[0].prev,t[o-1].next)}oh(i,()=>{for(var f=0;f<o;f++){var u=t[f];a||(n.delete(u.k),sr(e,u.prev,u.next)),kr(u.e,!a)}})}function gh(e,t,r,n,i,o=null){var s=e,a={flags:t,items:new Map,first:null},l=(t&Uf)!==0;if(l){var f=e;s=f.appendChild(di())}var u=null,c=!1,h=new Map,d=Ct(()=>{var v=r();return Zi(v)?v:v==null?[]:vl(v)}),p,g;function m(){Yg(g,p,a,h,s,i,t,n,r),o!==null&&(p.length===0?u?Pl(u):u=Hi(()=>o(s)):u!==null&&Rl(u,()=>{u=null}))}eh(()=>{g??=be,p=H(d);var v=p.length;if(!(c&&v===0)){c=v===0;var A,S,O,L;if(Xf()){var E=new Set,I=Je;for(S=0;S<v;S+=1){O=p[S],L=n(O,S);var y=a.items.get(L)??h.get(L);y?(t&(os|ss))!==0&&vh(y,O,S,t):(A=mh(null,a,null,null,O,L,S,i,t,r,!0),h.set(L,A)),E.add(L)}for(const[x,R]of a.items)E.has(x)||I.skipped_effects.add(R.e);I.add_callback(m)}else m();H(d)}})}function Yg(e,t,r,n,i,o,s,a,l){var f=(s&og)!==0,u=(s&(os|ss))!==0,c=t.length,h=r.items,d=r.first,p=d,g,m=null,v,A=[],S=[],O,L,E,I;if(f)for(I=0;I<c;I+=1)O=t[I],L=a(O,I),E=h.get(L),E!==void 0&&(E.a?.measure(),(v??=new Set).add(E));for(I=0;I<c;I+=1){if(O=t[I],L=a(O,I),E=h.get(L),E===void 0){var y=n.get(L);if(y!==void 0){n.delete(L),h.set(L,y);var x=m?m.next:p;sr(r,m,y),sr(r,y,x),Ms(y,x,i),m=y}else{var R=p?p.e.nodes_start:i;m=mh(R,r,m,m===null?r.first:m.next,O,L,I,o,s,l)}h.set(L,m),A=[],S=[],p=m.next;continue}if(u&&vh(E,O,I,s),(E.e.f&Kt)!==0&&(Pl(E.e),f&&(E.a?.unfix(),(v??=new Set).delete(E))),E!==p){if(g!==void 0&&g.has(E)){if(A.length<S.length){var T=S[0],P;m=T.prev;var C=A[0],N=A[A.length-1];for(P=0;P<A.length;P+=1)Ms(A[P],T,i);for(P=0;P<S.length;P+=1)g.delete(S[P]);sr(r,C.prev,N.next),sr(r,m,C),sr(r,N,T),p=T,m=N,I-=1,A=[],S=[]}else g.delete(E),Ms(E,p,i),sr(r,E.prev,E.next),sr(r,E,m===null?r.first:m.next),sr(r,m,E),m=E;continue}for(A=[],S=[];p!==null&&p.k!==L;)(p.e.f&Kt)===0&&(g??=new Set).add(p),S.push(p),p=p.next;if(p===null)continue;E=p}A.push(E),m=E,p=E.next}if(p!==null||g!==void 0){for(var _=g===void 0?[]:vl(g);p!==null;)(p.e.f&Kt)===0&&_.push(p),p=p.next;var b=_.length;if(b>0){var w=(s&Uf)!==0&&c===0?i:null;if(f){for(I=0;I<b;I+=1)_[I].a?.measure();for(I=0;I<b;I+=1)_[I].a?.fix()}Xg(r,_,w)}}f&&Tl(()=>{if(v!==void 0)for(E of v)E.a?.apply()}),e.first=r.first&&r.first.e,e.last=m&&m.e;for(var k of n.values())kr(k.e);n.clear()}function vh(e,t,r,n){(n&os)!==0&&Qn(e.v,t),(n&ss)!==0?Qn(e.i,r):e.i=r}function mh(e,t,r,n,i,o,s,a,l,f,u){var c=(l&os)!==0,h=(l&sg)===0,d=c?h?Se(i,!1,!1):Yn(i):i,p=(l&ss)===0?s:Yn(s),g={i:p,v:d,k:o,a:null,e:null,prev:r,next:n};try{if(e===null){var m=document.createDocumentFragment();m.append(e=di())}return g.e=Hi(()=>a(e,d,p,f),gg),g.e.prev=r&&r.e,g.e.next=n&&n.e,r===null?u||(t.first=g):(r.next=g,r.e.next=g.e),n!==null&&(n.prev=g,n.e.prev=g.e),g}finally{}}function Ms(e,t,r){for(var n=e.next?e.next.e.nodes_start:r,i=t?t.e.nodes_start:r,o=e.e.nodes_start;o!==null&&o!==n;){var s=ls(o);i.before(o),o=s}}function sr(e,t,r){t===null?e.first=r:(t.next=r,t.e.next=r&&r.e),r!==null&&(r.prev=t,r.e.prev=t&&t.e)}function Qg(e,t,r=!1,n=!1,i=!1){var o=e,s="";Te(()=>{var a=be;if(s!==(s=t()??"")&&(a.nodes_start!==null&&(nh(a.nodes_start,a.nodes_end),a.nodes_start=a.nodes_end=null),s!=="")){var l=s+"";r?l=`<svg>${l}</svg>`:n&&(l=`<math>${l}</math>`);var f=dh(l);if((r||n)&&(f=tn(f)),Fi(tn(f),f.lastChild),r||n)for(;tn(f);)o.before(tn(f));else o.before(f)}})}function bh(e,t,r,n,i){var o=t.$$slots?.[r],s=!1;o===!0&&(o=t.children,s=!0),o===void 0||o(e,s?()=>n:n)}function yh(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(r=yh(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Jg(){for(var e,t,r=0,n="",i=arguments.length;r<i;r++)(e=arguments[r])&&(t=yh(e))&&(n&&(n+=" "),n+=t);return n}function ev(e){return typeof e=="object"?Jg(e):e??""}const sc=[...` 	
\r\fÂ \v\uFEFF`];function tv(e,t,r){var n=e==null?"":""+e;if(t&&(n=n?n+" "+t:t),r){for(var i in r)if(r[i])n=n?n+" "+i:i;else if(n.length)for(var o=i.length,s=0;(s=n.indexOf(i,s))>=0;){var a=s+o;(s===0||sc.includes(n[s-1]))&&(a===n.length||sc.includes(n[a]))?n=(s===0?"":n.substring(0,s))+n.substring(a+1):s=a}}return n===""?null:n}function rv(e,t){return e==null?null:String(e)}function Nl(e,t,r,n,i,o){var s=e.__className;if(s!==r||s===void 0){var a=tv(r,n,o);a==null?e.removeAttribute("class"):e.className=a,e.__className=r}else if(o&&i!==o)for(var l in o){var f=!!o[l];(i==null||f!==!!i[l])&&e.classList.toggle(l,f)}return o}function wh(e,t,r,n){var i=e.__style;if(i!==t){var o=rv(t);o==null?e.removeAttribute("style"):e.style.cssText=o,e.__style=t}return n}function Eh(e,t,r=!1){if(e.multiple){if(t==null)return;if(!Zi(t))return pg();for(var n of e.options)n.selected=t.includes(Ci(n));return}for(n of e.options){var i=Ci(n);if(Og(i,t)){n.selected=!0;return}}(!r||t!==void 0)&&(e.selectedIndex=-1)}function nv(e){var t=new MutationObserver(()=>{Eh(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),us(()=>{t.disconnect()})}function iv(e,t,r=t){var n=!0;hh(e,"change",i=>{var o=i?"[selected]":":checked",s;if(e.multiple)s=[].map.call(e.querySelectorAll(o),Ci);else{var a=e.querySelector(o)??e.querySelector("option:not([disabled])");s=a&&Ci(a)}r(s)}),Jf(()=>{var i=t();if(Eh(e,i,n),n&&i===void 0){var o=e.querySelector(":checked");o!==null&&(i=Ci(o),r(i))}e.__value=i,n=!1}),nv(e)}function Ci(e){return"__value"in e?e.__value:e.value}const ov=Symbol("is custom element"),sv=Symbol("is html");function Tn(e,t,r,n){var i=av(e);i[t]!==(i[t]=r)&&(t==="loading"&&(e[K0]=r),r==null?e.removeAttribute(t):typeof r!="string"&&lv(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function av(e){return e.__attributes??={[ov]:e.nodeName.includes("-"),[sv]:e.namespaceURI===dg}}var ac=new Map;function lv(e){var t=ac.get(e.nodeName);if(t)return t;ac.set(e.nodeName,t=[]);for(var r,n=e,i=Element.prototype;i!==n;){r=Cf(n);for(var o in r)r[o].set&&t.push(o);n=ml(n)}return t}function _h(e,t,r=t){var n=hi(),i=new WeakSet;hh(e,"input",o=>{var s=o?e.defaultValue:e.value;if(s=Hs(e)?Ds(s):s,r(s),Je!==null&&i.add(Je),n&&s!==(s=t())){var a=e.selectionStart,l=e.selectionEnd;e.value=s??"",l!==null&&(e.selectionStart=a,e.selectionEnd=Math.min(l,e.value.length))}}),X(t)==null&&e.value&&(r(Hs(e)?Ds(e.value):e.value),Je!==null&&i.add(Je)),cs(()=>{var o=t();e===document.activeElement&&i.has(Je)||Hs(e)&&o===Ds(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function Hs(e){var t=e.type;return t==="number"||t==="range"}function Ds(e){return e===""?null:+e}function Bi(e,t,r){var n=_n(e,t);n&&n.set&&(e[t]=r,us(()=>{e[t]=null}))}function lc(e,t){return e===t||e?.[Cr]===t}function Na(e={},t,r,n){return Jf(()=>{var i,o;return cs(()=>{i=o,o=[],X(()=>{e!==r(...o)&&(t(e,...o),i&&lc(r(...i),e)&&t(null,...i))})}),()=>{Tl(()=>{o&&lc(r(...o),e)&&t(null,...o)})}}),e}function uv(e){return function(...t){var r=t[0];return r.stopPropagation(),e?.apply(this,t)}}function Dr(e=!1){const t=ze,r=t.l.u;if(!r)return;let n=()=>Ve(t.s);if(e){let i=0,o={};const s=as(()=>{let a=!1;const l=t.s;for(const f in l)l[f]!==o[f]&&(o[f]=l[f],a=!0);return a&&i++,i});n=()=>H(s)}r.b.length&&Ng(()=>{uc(t,n),Io(r.b)}),La(()=>{const i=X(()=>r.m.map(z0));return()=>{for(const o of i)typeof o=="function"&&o()}}),r.a.length&&La(()=>{uc(t,n),Io(r.a)})}function uc(e,t){if(e.l.s)for(const r of e.l.s)H(r);t()}function xh(e,t){var r=e.$$events?.[t.type],n=Zi(r)?r.slice():r==null?[]:[r];for(var i of n)i.call(this,t)}function Cl(e,t,r){if(e==null)return t(void 0),r&&r(void 0),sn;const n=X(()=>e.subscribe(t,r));return n.unsubscribe?()=>n.unsubscribe():n}const kn=[];function cv(e,t){return{subscribe:Bt(e,t).subscribe}}function Bt(e,t=sn){let r=null;const n=new Set;function i(a){if(Hf(e,a)&&(e=a,r)){const l=!kn.length;for(const f of n)f[1](),kn.push(f,e);if(l){for(let f=0;f<kn.length;f+=2)kn[f][0](kn[f+1]);kn.length=0}}}function o(a){i(a(e))}function s(a,l=sn){const f=[a,l];return n.add(f),n.size===1&&(r=t(i,o)||sn),a(e),()=>{n.delete(f),n.size===0&&r&&(r(),r=null)}}return{set:i,update:o,subscribe:s}}function $r(e,t,r){const n=!Array.isArray(e),i=n?[e]:e;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=t.length<2;return cv(r,(s,a)=>{let l=!1;const f=[];let u=0,c=sn;const h=()=>{if(u)return;c();const p=t(n?f[0]:f,s,a);o?s(p):c=typeof p=="function"?p:sn},d=i.map((p,g)=>Cl(p,m=>{f[g]=m,u&=~(1<<g),l&&h()},()=>{u|=1<<g}));return l=!0,h(),function(){Io(d),c(),l=!1}})}function Ca(e){let t;return Cl(e,r=>t=r)(),t}let uo=!1,Ba=Symbol();function It(e,t,r){const n=r[t]??={store:null,source:Se(void 0),unsubscribe:sn};if(n.store!==e&&!(Ba in r))if(n.unsubscribe(),n.store=e??null,e==null)n.source.v=void 0,n.unsubscribe=sn;else{var i=!0;n.unsubscribe=Cl(e,o=>{i?n.source.v=o:W(n.source,o)}),i=!1}return e&&Ba in r?Ca(e):H(n.source)}function dn(){const e={};function t(){us(()=>{for(var r in e)e[r].unsubscribe();To(e,Ba,{enumerable:!1,value:!0})})}return[e,t]}function fv(e){var t=uo;try{return uo=!1,[e(),uo]}finally{uo=t}}const hv={get(e,t){if(!e.exclude.includes(t))return H(e.version),t in e.special?e.special[t]():e.props[t]},set(e,t,r){if(!(t in e.special)){var n=be;try{pr(e.parent_effect),e.special[t]=we({get[t](){return e.props[t]}},t,kf)}finally{pr(n)}}return e.special[t](r),Qu(e.version),!0},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},deleteProperty(e,t){return e.exclude.includes(t)||(e.exclude.push(t),Qu(e.version)),!0},has(e,t){return e.exclude.includes(t)?!1:t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter(t=>!e.exclude.includes(t))}};function dv(e,t){return new Proxy({props:e,exclude:t,special:{},version:Yn(0),parent_effect:be},hv)}function we(e,t,r,n){var i=!fi||(r&lg)!==0,o=(r&ug)!==0,s=(r&cg)!==0,a=n,l=!0,f=()=>(l&&(l=!1,a=s?X(n):n),a),u;if(o){var c=Cr in e||V0 in e;u=_n(e,t)?.set??(c&&t in e?S=>e[t]=S:void 0)}var h,d=!1;o?[h,d]=fv(()=>e[t]):h=e[t],h===void 0&&n!==void 0&&(h=f(),u&&(i&&tg(),u(h)));var p;if(i?p=()=>{var S=e[t];return S===void 0?f():(l=!0,S)}:p=()=>{var S=e[t];return S!==void 0&&(a=void 0),S===void 0?a:S},i&&(r&kf)===0)return p;if(u){var g=e.$$legacy;return function(S,O){return arguments.length>0?((!i||!O||g||d)&&u(O?p():S),S):p()}}var m=!1,v=((r&ag)!==0?as:Ct)(()=>(m=!1,p()));o&&H(v);var A=be;return function(S,O){if(arguments.length>0){const L=O?H(v):i&&o?qn(S):S;return W(v,L),m=!0,a!==void 0&&(a=L),S}return Cn&&m||(A.f&Pn)!==0?v.v:H(v)}}function Bl(e){ze===null&&$f(),fi&&ze.l!==null?gv(ze).m.push(e):La(()=>{const t=X(e);if(typeof t=="function")return t})}function pv(e){ze===null&&$f(),Bl(()=>()=>X(e))}function gv(e){var t=e.l;return t.u??={a:[],b:[],m:[]}}const vv="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(vv);mg();var mv=Object.defineProperty,bv=(e,t,r)=>t in e?mv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Q=(e,t,r)=>(bv(e,typeof t!="symbol"?t+"":t,r),r);class Qi extends Error{}let cc=class extends Qi{constructor(t){super(`RxNostrWebSocketError: WebSocket was closed with code ${t} by relay.`),this.code=t,this.name="RxNostrWebSocketError"}};class yo extends Qi{constructor(t){super(`RxNostrInvalidUsageError: ${t}`),this.name="RxNostrInvalidUsageError"}}let Fs=class extends Qi{constructor(t){super(`RxNostrEnvironmentError: ${t}`),this.name="RxNostrEnvironmentError"}},Ah=class extends Qi{constructor(){super("RxNostrLogicError: This is rx-nostr's internal bug. Please report to the author of the library."),this.name="RxNostrLogicError"}},Tr=class extends Qi{constructor(){super("RxNostrAlreadyDisposedError: Attempted to access a disposed resource."),this.name="RxNostrAlreadyDisposedError"}};const Ji=(e,t)=>({...t,...e});function yv(e){if(typeof e.id!="string"||typeof e.sig!="string"||typeof e.kind!="number"||typeof e.pubkey!="string"||typeof e.content!="string"||typeof e.created_at!="number"||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){const r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]=="object")return!1}return!0}function qs(e){throw e}function wv(e){return{async signEvent(t){var r,n;const i={...t,pubkey:t.pubkey??await((r=window?.nostr)==null?void 0:r.getPublicKey())??qs(new Fs("window.nostr.getPublicKey() is not found")),tags:[...t.tags??[]],created_at:t.created_at??Math.floor(Date.now()/1e3)};return yv(i)?i:await((n=window?.nostr)==null?void 0:n.signEvent(i))??qs(new Fs("window.nostr.signEvent() is not found"))},getPublicKey(){var t;return((t=window?.nostr)==null?void 0:t.getPublicKey())??qs(new Fs("window.nostr.getPublicKey() is not found"))}}}const Ev=e=>Ji(e,{signer:wv(),connectionStrategy:"lazy",retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},disconnectTimeout:1e4,eoseTimeout:30*1e3,okTimeout:30*1e3,authTimeout:30*1e3,skipVerify:!1,skipValidateFilterMatching:!1,skipExpirationCheck:!1,skipFetchNip11:!1});function _v(e){return"length"in e?e.map(fc):[fc(e)]}function fc(e){return{...e,since:e.since?hc(e.since):void 0,until:e.until?hc(e.until):void 0}}function hc(e){return typeof e=="number"?e:e()}async function xv(e){try{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws(s?):/,"http$1:"),await(await fetch(t.toString(),{headers:{Accept:"application/nostr+json"}})).json()}catch{return{}}}function dc(e,t){try{return e()}catch(r){return t instanceof Function?t(r):t}}function Or(e){let t="";try{t=e.trim();const r=new URL(t);r.hash="",r.pathname=dc(()=>decodeURI(r.pathname),r.pathname),r.pathname=r.pathname.replace(/\/$/,""),r.hostname=r.hostname.replace(/\.$/,""),r.searchParams.sort(),r.search=dc(()=>decodeURIComponent(r.search),r.search);let n=r.toString();return r.search||(n=n.replace(/\/$/,"")),n}catch{return t}}class Vn extends Map{constructor(t){if(super(),!!t)for(const[r,n]of Object.entries(t))this.set(Or(r),n)}get(t){return super.get(Or(t))}getMany(t){const r=[];for(const n of new Set(t.map(Or))){const i=this.get(n);i!==void 0&&r.push(i)}return r}set(t,r){return super.set(Or(t),r)}has(t){return super.has(Or(t))}delete(t){return super.delete(Or(t))}toObject(){const t={};for(const[r,n]of this.entries())t[r]=n;return t}toKeys(){return[...super.keys()]}toValues(){return[...super.values()]}copy(){return new Vn(this.toObject())}}class Bo{static async getValue(t,r,n){if(!(n!=null&&n.skipCache)){const i=await this.cache.get(t);if(i)return r(i)}if(!(n!=null&&n.skipFetch)){const i=await this.fetch(t);if(i)return r(i)}return r(this.default)}static get(t){const r=this.cache.get(t);if(r&&!(r instanceof Promise))return r}static async fetch(t){const r=xv(t);return this.cache.set(t,r),r.then(n=>{this.cache.set(t,n)}),r}static async getOrFetch(t){return this.cache.get(t)??this.fetch(t)}static set(t,r){this.cache.set(t,r)}static getDefault(){return this.default}static setDefault(t){this.default=t}static forget(t){this.cache.delete(t)}static forgetAll(){this.cache.clear()}}Q(Bo,"cache",new Vn),Q(Bo,"default",{});/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Av(e,t,r){return Array.isArray(t)?t.some(n=>pc(e,n)):pc(e,t)}function pc(e,t,r){const{sinceInclusive:n,untilInclusive:i}=Ji({},{sinceInclusive:!0,untilInclusive:!0});if(t.ids&&t.ids.every(o=>!e.id.startsWith(o))||t.kinds&&!t.kinds.includes(e.kind)||t.authors&&t.authors.every(o=>!e.pubkey.startsWith(o))||t.since&&(n&&!(t.since<=e.created_at)||!n&&!(t.since<e.created_at))||t.until&&(i&&!(e.created_at<=t.until)||!i&&!(e.created_at<t.until)))return!1;for(const[o,s]of Object.entries(t)){if(!o.startsWith("#")||!Array.isArray(s))continue;const a=o.slice(1);if(!e.tags.find(([l,f])=>a===l&&s.includes(f)))return!1}return!0}function Sv(e,t){const r=e.tags.find(n=>n[0]==="expiration");if(!r)return!1;try{const n=Number(r[1]);return Number.isInteger(n)?n<=(t??Math.floor(Date.now()/1e3)):!1}catch{return!1}}var $a=function(e,t){return $a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},$a(e,t)};function Fr(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");$a(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function Tv(e,t,r,n){function i(o){return o instanceof r?o:new r(function(s){s(o)})}return new(r||(r=Promise))(function(o,s){function a(u){try{f(n.next(u))}catch(c){s(c)}}function l(u){try{f(n.throw(u))}catch(c){s(c)}}function f(u){u.done?o(u.value):i(u.value).then(a,l)}f((n=n.apply(e,[])).next())})}function Sh(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(f){return function(u){return l([f,u])}}function l(f){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,f[0]&&(r=0)),r;)try{if(n=1,i&&(o=f[0]&2?i.return:f[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,f[1])).done)return o;switch(i=0,o&&(f=[f[0]&2,o.value]),f[0]){case 0:case 1:o=f;break;case 4:return r.label++,{value:f[1],done:!1};case 5:r.label++,i=f[1],f=[0];continue;case 7:f=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(f[0]===6||f[0]===2)){r=0;continue}if(f[0]===3&&(!o||f[1]>o[0]&&f[1]<o[3])){r.label=f[1];break}if(f[0]===6&&r.label<o[1]){r.label=o[1],o=f;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(f);break}o[2]&&r.ops.pop(),r.trys.pop();continue}f=t.call(e,r)}catch(u){f=[6,u],i=0}finally{n=o=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function Jn(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ei(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function ti(e,t,r){if(arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function Kn(e){return this instanceof Kn?(this.v=e,this):new Kn(e)}function Iv(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(h){n[h]&&(i[h]=function(d){return new Promise(function(p,g){o.push([h,d,p,g])>1||a(h,d)})})}function a(h,d){try{l(n[h](d))}catch(p){c(o[0][3],p)}}function l(h){h.value instanceof Kn?Promise.resolve(h.value.v).then(f,u):c(o[0][2],h)}function f(h){a("next",h)}function u(h){a("throw",h)}function c(h,d){h(d),o.shift(),o.length&&a(o[0][0],o[0][1])}}function Ov(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Jn=="function"?Jn(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(o){r[o]=e[o]&&function(s){return new Promise(function(a,l){s=e[o](s),i(a,l,s.done,s.value)})}}function i(o,s,a,l){Promise.resolve(l).then(function(f){o({value:f,done:a})},s)}}function Xe(e){return typeof e=="function"}function fs(e){var t=function(n){Error.call(n),n.stack=new Error().stack},r=e(t);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var js=fs(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function $o(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var eo=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var a=Jn(s),l=a.next();!l.done;l=a.next()){var f=l.value;f.remove(this)}}catch(g){t={error:g}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}else s.remove(this);var u=this.initialTeardown;if(Xe(u))try{u()}catch(g){o=g instanceof js?g.errors:[g]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var h=Jn(c),d=h.next();!d.done;d=h.next()){var p=d.value;try{gc(p)}catch(g){o=o??[],g instanceof js?o=ti(ti([],ei(o)),ei(g.errors)):o.push(g)}}}catch(g){n={error:g}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}if(o)throw new js(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)gc(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(t)}},e.prototype._hasParent=function(t){var r=this._parentage;return r===t||Array.isArray(r)&&r.includes(t)},e.prototype._addParent=function(t){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t},e.prototype._removeParent=function(t){var r=this._parentage;r===t?this._parentage=null:Array.isArray(r)&&$o(r,t)},e.prototype.remove=function(t){var r=this._finalizers;r&&$o(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),Th=eo.EMPTY;function Ih(e){return e instanceof eo||e&&"closed"in e&&Xe(e.remove)&&Xe(e.add)&&Xe(e.unsubscribe)}function gc(e){Xe(e)?e():e.unsubscribe()}var Rv={Promise:void 0},Lv={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,ti([e,t],ei(r)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function Oh(e){Lv.setTimeout(function(){throw e})}function Ua(){}function wo(e){e()}var $l=function(e){Fr(t,e);function t(r){var n=e.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Ih(r)&&r.add(n)):n.destination=Cv,n}return t.create=function(r,n,i){return new Uo(r,n,i)},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(eo),Pv=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var r=this.partialObserver;if(r.next)try{r.next(t)}catch(n){co(n)}},e.prototype.error=function(t){var r=this.partialObserver;if(r.error)try{r.error(t)}catch(n){co(n)}else co(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(r){co(r)}},e}(),Uo=function(e){Fr(t,e);function t(r,n,i){var o=e.call(this)||this,s;return Xe(r)||!r?s={next:r??void 0,error:n??void 0,complete:i??void 0}:s=r,o.destination=new Pv(s),o}return t}($l);function co(e){Oh(e)}function Nv(e){throw e}var Cv={closed:!0,next:Ua,error:Nv,complete:Ua},Ul=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function qr(e){return e}function Bv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Rh(e)}function Rh(e){return e.length===0?qr:e.length===1?e[0]:function(t){return e.reduce(function(r,n){return n(r)},t)}}var Pt=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var i=this,o=Uv(t)?t:new Uo(t,r,n);return wo(function(){var s=i,a=s.operator,l=s.source;o.add(a?a.call(o,l):l?i._subscribe(o):i._trySubscribe(o))}),o},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){t.error(r)}},e.prototype.forEach=function(t,r){var n=this;return r=vc(r),new r(function(i,o){var s=new Uo({next:function(a){try{t(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},e.prototype._subscribe=function(t){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(t)},e.prototype[Ul]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Rh(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=vc(t),new t(function(n,i){var o;r.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},e.create=function(t){return new e(t)},e}();function vc(e){var t;return(t=e??Rv.Promise)!==null&&t!==void 0?t:Promise}function $v(e){return e&&Xe(e.next)&&Xe(e.error)&&Xe(e.complete)}function Uv(e){return e&&e instanceof $l||$v(e)&&Ih(e)}function kv(e){return Xe(e?.lift)}function bt(e){return function(t){if(kv(t))return t.lift(function(r){try{return e(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ct(e,t,r,n,i){return new Mv(e,t,r,n,i)}var Mv=function(e){Fr(t,e);function t(r,n,i,o,s,a){var l=e.call(this,r)||this;return l.onFinalize=s,l.shouldUnsubscribe=a,l._next=n?function(f){try{n(f)}catch(u){r.error(u)}}:e.prototype._next,l._error=o?function(f){try{o(f)}catch(u){r.error(u)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=i?function(){try{i()}catch(f){r.error(f)}finally{this.unsubscribe()}}:e.prototype._complete,l}return t.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},t}($l),Hv=fs(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ge=function(e){Fr(t,e);function t(){var r=e.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype.lift=function(r){var n=new mc(this,this);return n.operator=r,n},t.prototype._throwIfClosed=function(){if(this.closed)throw new Hv},t.prototype.next=function(r){var n=this;wo(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=Jn(n.currentObservers),a=s.next();!a.done;a=s.next()){var l=a.value;l.next(r)}}catch(f){i={error:f}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},t.prototype.error=function(r){var n=this;wo(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},t.prototype.complete=function(){var r=this;wo(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(r){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},t.prototype._innerSubscribe=function(r){var n=this,i=this,o=i.hasError,s=i.isStopped,a=i.observers;return o||s?Th:(this.currentObservers=null,a.push(r),new eo(function(){n.currentObservers=null,$o(a,r)}))},t.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?r.error(o):s&&r.complete()},t.prototype.asObservable=function(){var r=new Pt;return r.source=this,r},t.create=function(r,n){return new mc(r,n)},t}(Pt),mc=function(e){Fr(t,e);function t(r,n){var i=e.call(this)||this;return i.destination=r,i.source=n,i}return t.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},t.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},t.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},t.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:Th},t}(Ge),Dv=function(e){Fr(t,e);function t(r){var n=e.call(this)||this;return n._value=r,n}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(r){var n=e.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},t.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,o=r._value;if(n)throw i;return this._throwIfClosed(),o},t.prototype.next=function(r){e.prototype.next.call(this,this._value=r)},t}(Ge),Fv={now:function(){return Date.now()}},qv=function(e){Fr(t,e);function t(r,n){return e.call(this)||this}return t.prototype.schedule=function(r,n){return this},t}(eo),ka={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=ka.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,ti([e,t],ei(r))):setInterval.apply(void 0,ti([e,t],ei(r)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},jv=function(e){Fr(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.scheduler=r,i.work=n,i.pending=!1,i}return t.prototype.schedule=function(r,n){var i;if(n===void 0&&(n=0),this.closed)return this;this.state=r;var o=this.id,s=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(s,o,n)),this.pending=!0,this.delay=n,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(s,this.id,n),this},t.prototype.requestAsyncId=function(r,n,i){return i===void 0&&(i=0),ka.setInterval(r.flush.bind(r,this),i)},t.prototype.recycleAsyncId=function(r,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;n!=null&&ka.clearInterval(n)},t.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(r,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(r,n){var i=!1,o;try{this.work(r)}catch(s){i=!0,o=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},t.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,i=r.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,$o(o,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(qv),bc=function(){function e(t,r){r===void 0&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(t,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,t).schedule(n,r)},e.now=Fv.now,e}(),zv=function(e){Fr(t,e);function t(r,n){n===void 0&&(n=bc.now);var i=e.call(this,r,n)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var i;this._active=!0;do if(i=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,i){for(;r=n.shift();)r.unsubscribe();throw i}},t}(bc),Lh=new zv(jv),Wv=Lh,to=new Pt(function(e){return e.complete()});function Gv(e){return e&&Xe(e.schedule)}function kl(e){return e[e.length-1]}function Vv(e){return Xe(kl(e))?e.pop():void 0}function Ml(e){return Gv(kl(e))?e.pop():void 0}function Kv(e,t){return typeof kl(e)=="number"?e.pop():t}var Ph=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Nh(e){return Xe(e?.then)}function Ch(e){return Xe(e[Ul])}function Bh(e){return Symbol.asyncIterator&&Xe(e?.[Symbol.asyncIterator])}function $h(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Zv(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Uh=Zv();function kh(e){return Xe(e?.[Uh])}function Mh(e){return Iv(this,arguments,function(){var t,r,n,i;return Sh(this,function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Kn(t.read())];case 3:return r=o.sent(),n=r.value,i=r.done,i?[4,Kn(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Kn(n)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Hh(e){return Xe(e?.getReader)}function mr(e){if(e instanceof Pt)return e;if(e!=null){if(Ch(e))return Xv(e);if(Ph(e))return Yv(e);if(Nh(e))return Qv(e);if(Bh(e))return Dh(e);if(kh(e))return Jv(e);if(Hh(e))return em(e)}throw $h(e)}function Xv(e){return new Pt(function(t){var r=e[Ul]();if(Xe(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Yv(e){return new Pt(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}function Qv(e){return new Pt(function(t){e.then(function(r){t.closed||(t.next(r),t.complete())},function(r){return t.error(r)}).then(null,Oh)})}function Jv(e){return new Pt(function(t){var r,n;try{for(var i=Jn(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()})}function Dh(e){return new Pt(function(t){tm(e,t).catch(function(r){return t.error(r)})})}function em(e){return Dh(Mh(e))}function tm(e,t){var r,n,i,o;return Tv(this,void 0,void 0,function(){var s,a;return Sh(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=Ov(e),l.label=1;case 1:return[4,r.next()];case 2:if(n=l.sent(),!!n.done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function hr(e,t,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var o=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(o),!i)return o}function Fh(e,t){return t===void 0&&(t=0),bt(function(r,n){r.subscribe(ct(n,function(i){return hr(n,e,function(){return n.next(i)},t)},function(){return hr(n,e,function(){return n.complete()},t)},function(i){return hr(n,e,function(){return n.error(i)},t)}))})}function qh(e,t){return t===void 0&&(t=0),bt(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}function rm(e,t){return mr(e).pipe(qh(t),Fh(t))}function nm(e,t){return mr(e).pipe(qh(t),Fh(t))}function im(e,t){return new Pt(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}function om(e,t){return new Pt(function(r){var n;return hr(r,t,function(){n=e[Uh](),hr(r,t,function(){var i,o,s;try{i=n.next(),o=i.value,s=i.done}catch(a){r.error(a);return}s?r.complete():r.next(o)},0,!0)}),function(){return Xe(n?.return)&&n.return()}})}function jh(e,t){if(!e)throw new Error("Iterable cannot be null");return new Pt(function(r){hr(r,t,function(){var n=e[Symbol.asyncIterator]();hr(r,t,function(){n.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function sm(e,t){return jh(Mh(e),t)}function am(e,t){if(e!=null){if(Ch(e))return rm(e,t);if(Ph(e))return im(e,t);if(Nh(e))return nm(e,t);if(Bh(e))return jh(e,t);if(kh(e))return om(e,t);if(Hh(e))return sm(e,t)}throw $h(e)}function ro(e,t){return t?am(e,t):mr(e)}function zh(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Ml(e);return ro(e,r)}var Hl=fs(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function Wh(e,t){return new Promise(function(r,n){var i=new Uo({next:function(o){r(o),i.unsubscribe()},error:n,complete:function(){n(new Hl)}});e.subscribe(i)})}function Gh(e){return e instanceof Date&&!isNaN(e)}var Vh=fs(function(e){return function(t){t===void 0&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}});function Kh(e,t){var r=Gh(e)?{first:e}:typeof e=="number"?{each:e}:e,n=r.first,i=r.each,o=r.with,s=o===void 0?lm:o,a=r.scheduler,l=a===void 0?Lh:a,f=r.meta,u=f===void 0?null:f;if(n==null&&i==null)throw new TypeError("No timeout provided.");return bt(function(c,h){var d,p,g=null,m=0,v=function(A){p=hr(h,l,function(){try{d.unsubscribe(),mr(s({meta:u,lastValue:g,seen:m})).subscribe(h)}catch(S){h.error(S)}},A)};d=c.subscribe(ct(h,function(A){p?.unsubscribe(),m++,h.next(g=A),i>0&&v(i)},void 0,void 0,function(){p!=null&&p.closed||p==null||p.unsubscribe(),g=null})),!m&&v(n!=null?typeof n=="number"?n:+n-l.now():i)})}function lm(e){throw new Vh(e)}function ln(e,t){return bt(function(r,n){var i=0;r.subscribe(ct(n,function(o){n.next(e.call(t,o,i++))}))})}var um=Array.isArray;function cm(e,t){return um(t)?e.apply(void 0,ti([],ei(t))):e(t)}function fm(e){return ln(function(t){return cm(e,t)})}var hm=Array.isArray,dm=Object.getPrototypeOf,pm=Object.prototype,gm=Object.keys;function vm(e){if(e.length===1){var t=e[0];if(hm(t))return{args:t,keys:null};if(mm(t)){var r=gm(t);return{args:r.map(function(n){return t[n]}),keys:r}}}return{args:e,keys:null}}function mm(e){return e&&typeof e=="object"&&dm(e)===pm}function bm(e,t){return e.reduce(function(r,n,i){return r[n]=t[i],r},{})}function ym(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Ml(e),n=Vv(e),i=vm(e),o=i.args,s=i.keys;if(o.length===0)return ro([],r);var a=new Pt(wm(o,r,s?function(l){return bm(s,l)}:qr));return n?a.pipe(fm(n)):a}function wm(e,t,r){return r===void 0&&(r=qr),function(n){yc(t,function(){for(var i=e.length,o=new Array(i),s=i,a=i,l=function(u){yc(t,function(){var c=ro(e[u],t),h=!1;c.subscribe(ct(n,function(d){o[u]=d,h||(h=!0,a--),a||n.next(r(o.slice()))},function(){--s||n.complete()}))},n)},f=0;f<i;f++)l(f)},n)}}function yc(e,t,r){e?hr(r,e,t):t()}function Em(e,t,r,n,i,o,s,a){var l=[],f=0,u=0,c=!1,h=function(){c&&!l.length&&!f&&t.complete()},d=function(g){return f<n?p(g):l.push(g)},p=function(g){f++;var m=!1;mr(r(g,u++)).subscribe(ct(t,function(v){t.next(v)},function(){m=!0},void 0,function(){if(m)try{f--;for(var v=function(){var A=l.shift();s?hr(t,s,function(){return p(A)}):p(A)};l.length&&f<n;)v();h()}catch(A){t.error(A)}}))};return e.subscribe(ct(t,d,function(){c=!0,h()})),function(){}}function ko(e,t,r){return r===void 0&&(r=1/0),Xe(t)?ko(function(n,i){return ln(function(o,s){return t(n,o,i,s)})(mr(e(n,i)))},r):(typeof t=="number"&&(r=t),bt(function(n,i){return Em(n,i,e,r)}))}function Zh(e){return e===void 0&&(e=1/0),ko(qr,e)}function wc(e,t,r){return e===void 0&&(e=0),r===void 0&&(r=Wv),new Pt(function(n){var i=Gh(e)?+e-r.now():e;i<0&&(i=0);var o=0;return r.schedule(function(){n.closed||(n.next(o++),n.complete())},i)})}function _m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Ml(e),n=Kv(e,1/0),i=e;return i.length?i.length===1?mr(i[0]):Zh(n)(ro(i,r)):to}function Ft(e,t){return bt(function(r,n){var i=0;r.subscribe(ct(n,function(o){return e.call(t,o,i++)&&n.next(o)}))})}function Xh(e){return bt(function(t,r){var n=null,i=!1,o;n=t.subscribe(ct(r,void 0,void 0,function(s){o=mr(e(s,Xh(e)(t))),n?(n.unsubscribe(),n=null,o.subscribe(r)):i=!0})),i&&(n.unsubscribe(),n=null,o.subscribe(r))})}function xm(e){return bt(function(t,r){var n=!1;t.subscribe(ct(r,function(i){n=!0,r.next(i)},function(){n||r.next(e),r.complete()}))})}function Am(e){return e<=0?function(){return to}:bt(function(t,r){var n=0;t.subscribe(ct(r,function(i){++n<=e&&(r.next(i),e<=n&&r.complete())}))})}function Sm(e,t){return t===void 0&&(t=qr),e=e??Tm,bt(function(r,n){var i,o=!0;r.subscribe(ct(n,function(s){var a=t(s);(o||!e(i,a))&&(o=!1,i=a,n.next(s))}))})}function Tm(e,t){return e===t}function Im(e){return e===void 0&&(e=Om),bt(function(t,r){var n=!1;t.subscribe(ct(r,function(i){n=!0,r.next(i)},function(){return n?r.complete():r.error(e())}))})}function Om(){return new Hl}function zs(e){return bt(function(t,r){try{t.subscribe(r)}finally{r.add(e)}})}function Ma(e,t){var r=arguments.length>=2;return function(n){return n.pipe(e?Ft(function(i,o){return e(i,o,n)}):qr,Am(1),r?xm(t):Im(function(){return new Hl}))}}function Rm(e,t){return bt(function(r,n){var i=null,o=0,s=!1,a=function(){return s&&!i&&n.complete()};r.subscribe(ct(n,function(l){i?.unsubscribe();var f=0,u=o++;mr(e(l,u)).subscribe(i=ct(n,function(c){return n.next(t?t(l,c,u,f++):c)},function(){i=null,a()}))},function(){s=!0,a()}))})}function Lm(){return Rm(qr)}function wi(e){return bt(function(t,r){mr(e).subscribe(ct(r,function(){return r.complete()},Ua)),!r.closed&&t.subscribe(r)})}function Pm(e,t){return bt(function(r,n){var i=0;r.subscribe(ct(n,function(o){var s=e(o,i++);(s||t)&&n.next(o),!s&&n.complete()}))})}function fo(e,t,r){var n=Xe(e)||t||r?{next:e,error:t,complete:r}:e;return n?bt(function(i,o){var s;(s=n.subscribe)===null||s===void 0||s.call(n);var a=!0;i.subscribe(ct(o,function(l){var f;(f=n.next)===null||f===void 0||f.call(n,l),o.next(l)},function(){var l;a=!1,(l=n.complete)===null||l===void 0||l.call(n),o.complete()},function(l){var f;a=!1,(f=n.error)===null||f===void 0||f.call(n,l),o.error(l)},function(){var l,f;a&&((l=n.unsubscribe)===null||l===void 0||l.call(n)),(f=n.finalize)===null||f===void 0||f.call(n)}))}):qr}function Nm(e){return ko((t,r)=>ro(e(t,r)).pipe(ko(n=>n?zh(t):to)))}function Ec(e){return Bv(Kh(e),Xh(t=>{if(t instanceof Vh)return to;throw t}))}function Ws(e,t){const{not:r}=Ji(t,{not:!1});return Ft(n=>Cm(n.subId===e,r))}function Cm(e,t){return!e&&t||e&&!t}class Bm{constructor(t){Q(this,"relay"),Q(this,"config"),Q(this,"authenticator"),Q(this,"ongoings",new Set),Q(this,"authResult$",new Ge),Q(this,"disposed",!1),this.relay=t.relay,this.config=t.config,this.authenticator=t.authenticator;const r=this.relay.getOKObservable().subscribe(i=>{const{eventId:o,ok:s}=i;this.ongoings.has(o)&&(this.ongoings.delete(o),this.authResult$.next(s),s||(r.unsubscribe(),n.unsubscribe()))}),n=this.relay.getAUTHObservable().subscribe(({challenge:i})=>{this.challenge(i)})}getAuthResultObservable(){return this.authResult$.asObservable()}async challenge(t){try{const r=await this.signer.signEvent({kind:22242,content:"",tags:[["relay",this.relay.url],["challenge",t]]});this.ongoings.add(r.id),this.relay.send(["AUTH",r])}catch{}}get signer(){return this.authenticator.signer??this.config.signer}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const t=[this.authResult$];for(const r of t)r.complete()}}let Yh=class extends Dv{constructor(t){super(t??0)}increment(){this.next(this.getValue()+1)}decrement(){this.next(this.getValue()-1)}next(t){typeof t=="number"?super.next(t):super.next(t(this.getValue()))}};class $m extends Ge{waitNext(){return Wh(this.pipe(Ma(null,void 0)))}}class Um{constructor(t){Q(this,"relay"),Q(this,"authProxy"),Q(this,"pubs",new Map),Q(this,"authRequiredPubs",new Set),Q(this,"count$",new Yh(0)),Q(this,"ok$",new Ge),Q(this,"disposed",!1);var r;this.relay=t.relay,this.authProxy=t.authProxy,this.relay.getReconnectedObservable().subscribe(n=>{for(const[i,o]of n)i==="EVENT"&&this.pubs.has(o.id)&&this.sendEVENT(o)}),this.relay.getOKObservable().subscribe(async n=>{const{eventId:i,notice:o}=n;this.pubs.get(i)&&(this.authProxy&&o!=null&&o.startsWith("auth-required:")?(this.authRequiredPubs.add(i),this.ok$.next({...n,done:!1})):(this.ok$.next({...n,done:!0}),this.confirmOK(i)))}),(r=this.authProxy)==null||r.getAuthResultObservable().subscribe(n=>{if(n)for(const i of this.authRequiredPubs){const o=this.pubs.get(i);o&&this.sendEVENT(o)}else for(const i of this.authRequiredPubs)this.confirmOK(i);this.authRequiredPubs.clear()})}async publish(t){if(!this.disposed)return this.pubs.has(t.id)||(this.pubs.set(t.id,t),this.count$.increment()),this.sendEVENT(t)}confirmOK(t){this.disposed||this.pubs.has(t)||(this.pubs.delete(t),this.count$.decrement())}getOkAgainstEventObservable(){return this.ok$.asObservable()}getLogicalConnectionSizeObservable(){return this.count$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const t=[this.count$,this.ok$];for(const r of t)r.complete()}sendEVENT(t){return this.relay.send(["EVENT",t])}}const _c={OPEN:1};class km{constructor(t,r){Q(this,"socket",null),Q(this,"buffer",[]),Q(this,"unsent",[]),Q(this,"reconnected$",new Ge),Q(this,"outgoing$",new Ge),Q(this,"message$",new Ge),Q(this,"error$",new Ge),Q(this,"retryTimer",null),Q(this,"sendAttempted$",new $m),Q(this,"isFirstTry",!0),Q(this,"maybeDown",!1),Q(this,"disposed",!1),Q(this,"state$",new Ge),Q(this,"_state","initialized"),this.url=t,this.config=r,r.skipFetchNip11||Bo.getOrFetch(t),this.setState("initialized")}get state(){return this._state}setState(t){this._state=t,this.state$.next(t)}connectManually(){this.connect()}connect(t){if(this.state==="terminated")return;const r=typeof t=="number";(this.state==="initialized"||this.state==="dormant"||this.state==="error"||this.state==="rejected"||r)&&(this.socket=this.createSocket(t??0))}createSocket(t){const r=this.isFirstTry;this.isFirstTry=!1;let n=!1;const i=t>0,o=this.state==="error"||this.state==="rejected";i?this.setState("retrying"):this.setState("connecting");const s=async()=>{if(this.state==="terminated"){u?.close(Fn.RX_NOSTR_DISPOSED);return}this.setState("connected"),n=!0,(i||o)&&(this.reconnected$.next(this.unsent),this.unsent=[]);try{for(const c of this.buffer)this.send(c)}catch(c){this.error$.next(c)}finally{this.buffer=[]}},a=({data:c})=>{if(this.state!=="terminated")try{this.message$.next(this.pack(JSON.parse(c)))}catch(h){this.error$.next(h)}},l=({code:c})=>{var h;if(u?.removeEventListener("open",s),u?.removeEventListener("message",a),u?.removeEventListener("close",l),this.socket===u&&(this.socket=null),this.state==="terminated"||c===Fn.RX_NOSTR_DISPOSED){this.unsent=[],this.buffer=[];return}if(c===Fn.RX_NOSTR_IDLE)this.setState("dormant"),this.buffer.length>0&&this.connect();else if(c===Fn.DONT_RETRY)this.unsent=[],this.buffer=[],this.error$.next(new cc(c)),this.setState("rejected");else{r&&!n&&(this.maybeDown=!0),this.unsent.push(...this.buffer),this.buffer=[],this.error$.next(new cc(c));const d=t+1;this.config.retry.strategy!=="off"&&!(this.config.retry.polite&&this.maybeDown)&&d<=this.config.retry.maxCount?(this.setState("waiting-for-retrying"),(h=this.retryTimer)==null||h.unsubscribe(),this.retryTimer=Mm(this.config.retry,d).subscribe(()=>{this.disposed||this.connect(d)})):this.setState("error")}},f=this.config.websocketCtor??globalThis.WebSocket;if(!f)throw new yo("WebSocket constructor is missing");const u=(()=>{try{return new f(this.url)}catch{return l({code:0}),null}})();return u?.addEventListener("open",s),u?.addEventListener("message",a),u?.addEventListener("close",l),u}pack(t){const r=t[0],n=this.url;switch(r){case"EVENT":return{from:n,type:r,message:t,subId:t[1],event:t[2]};case"EOSE":return{from:n,type:r,message:t,subId:t[1]};case"OK":return{from:n,type:r,message:t,eventId:t[1],ok:t[2],notice:t[3]};case"CLOSED":return{from:n,type:r,message:t,subId:t[1],notice:t[2]};case"NOTICE":return{from:n,type:r,message:t,notice:t[1]};case"AUTH":return{from:n,type:r,message:t,challenge:t[1]};case"COUNT":return{from:n,type:r,message:t,subId:t[1],count:t[2]};default:return{from:n,type:"unknown",message:t}}}disconnect(t){var r;((r=this.socket)==null?void 0:r.readyState)===_c.OPEN&&this.socket.close(t)}send(t){const r=this.sendAttempted$.waitNext();switch(this.state){case"terminated":case"rejected":return this.sendAttempted$.next(),r;case"initialized":case"connecting":case"dormant":return this.buffer.push(t),this.connect(),r;case"connected":{if(!this.socket)throw new Ah;return this.socket.readyState===_c.OPEN?(this.outgoing$.next({to:this.url,message:t}),this.socket.send(JSON.stringify(t)),this.sendAttempted$.next(),r):(this.buffer.push(t),r)}case"waiting-for-retrying":case"retrying":case"error":return this.sendAttempted$.next(),this.unsent.push(t),r}}getEVENTObservable(){return this.message$.pipe(Ft(t=>t.type==="EVENT"))}getEOSEObservable(){return this.message$.pipe(Ft(t=>t.type==="EOSE"))}getCLOSEDObservable(){return this.message$.pipe(Ft(t=>t.type==="CLOSED"))}getOKObservable(){return this.message$.pipe(Ft(t=>t.type==="OK"))}getAUTHObservable(){return this.message$.pipe(Ft(t=>t.type==="AUTH"))}getAllMessageObservable(){return this.message$.asObservable()}getOutgoingMessageObservable(){return this.outgoing$.asObservable()}getReconnectedObservable(){return this.reconnected$.asObservable()}getConnectionStateObservable(){return this.state$.pipe(Sm(),ln(t=>({from:this.url,state:t})))}getErrorObservable(){return this.error$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){var t,r;if(this.disposed)return;this.disposed=!0,this.setState("terminated"),(t=this.retryTimer)==null||t.unsubscribe(),(r=this.socket)==null||r.close(Fn.RX_NOSTR_DISPOSED),this.socket=null;const n=[this.state$,this.outgoing$,this.message$,this.error$,this.reconnected$,this.sendAttempted$];for(const i of n)i.complete()}}function Mm(e,t){switch(e.strategy){case"exponential":{const r=Math.max(e.initialDelay*2**(t-1)+(Math.random()-.5)*1e3,1e3);return wc(r)}case"immediately":return zh(0);case"linear":return wc(e.interval);case"off":return to}}const Fn={DONT_RETRY:4e3,RX_NOSTR_IDLE:4537,RX_NOSTR_DISPOSED:4538};class Hm{constructor(t){Q(this,"relay"),Q(this,"authProxy"),Q(this,"config"),Q(this,"subs",new Map),Q(this,"authRequiredSubs",new Set),Q(this,"fin$",new Ge),Q(this,"disposed",!1),Q(this,"queue");var r;this.relay=t.relay,this.authProxy=t.authProxy,this.config=t.config,this.queue=new Dm(this.relay.url,this.config),this.queue.getActivationObservable().subscribe(n=>{for(const{req:i}of n)this.sendREQ(i)}),this.relay.getReconnectedObservable().subscribe(()=>{for(const{req:n}of this.queue.ongoings)this.sendREQ(n)}),this.relay.getEOSEObservable().subscribe(({subId:n})=>{var i;(i=this.subs.get(n))!=null&&i.autoclose&&this.unsubscribe(n)}),this.relay.getCLOSEDObservable().subscribe(async({subId:n,notice:i})=>{this.subs.get(n)&&(this.authProxy&&i!=null&&i.startsWith("auth-required:")?this.authRequiredSubs.add(n):this.fin(n))}),(r=this.authProxy)==null||r.getAuthResultObservable().subscribe(n=>{var i;if(n)for(const o of this.authRequiredSubs){const s=(i=this.subs.get(o))==null?void 0:i.req;s&&this.sendREQ(s)}else for(const o of this.authRequiredSubs)this.fin(o);this.authRequiredSubs.clear()})}subscribe(t,r){if(this.disposed)return;const n=t[1],i={subId:n,req:t,autoclose:r};this.subs.set(n,i),this.queue.enqueue(i)}unsubscribe(t){this.disposed||(this.subs.has(t)&&this.sendCLOSE(t),this.fin(t))}isOngoingOrQueued(t){return this.subs.has(t)}getEventObservable(){return this.relay.getEVENTObservable().pipe(Ft(({subId:t,event:r})=>{var n;const i=(n=this.subs.get(t))==null?void 0:n.filters;return i?this.config.skipValidateFilterMatching||Av(r,i):!1}))}getFinObservable(){return this.fin$.asObservable()}getLogicalConnectionSizeObservable(){return this.queue.getSizeObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const t=[this.fin$];for(const r of t)r.complete();this.queue.dispose()}sendREQ([,t,...r]){const n=_v(r),i=this.subs.get(t);i&&(i.filters=n,this.relay.send(["REQ",t,...n]))}sendCLOSE(t){this.relay.send(["CLOSE",t])}fin(t){this.subs.delete(t),this.queue.drop(t),this.fin$.next({from:this.relay.url,subId:t})}}class Dm{constructor(t,r){Q(this,"_queuings",[]),Q(this,"_ongoings",[]),Q(this,"activated$",new Ge),Q(this,"count$",new Yh),this.url=t,this.config=r}get queuings(){return this._queuings}set queuings(t){this._queuings=t}get ongoings(){return this._ongoings}set ongoings(t){this._ongoings=t}enqueue(t){this.queuings=[...this.queuings,t],this.count$.increment(),this.shift()}drop(t){const r=(a,l)=>{const f=a.length,u=a.filter(h=>h.subId!==l),c=f-u.length;return[u,c]},[n,i]=r(this.queuings,t),[o,s]=r(this.ongoings,t);this.queuings=n,this.ongoings=o,this.count$.next(a=>a-(i+s)),this.shift()}getActivationObservable(){return this.activated$.asObservable()}getSizeObservable(){return this.count$.asObservable()}dispose(){const t=[this.activated$,this.count$];for(const r of t)r.complete()}async shift(){const t=await this.capacity(),r=[...this.ongoings,...this.queuings],n=r.slice(0,t),i=r.slice(t),o=this.queuings.slice(0,t-this.ongoings.length);this.ongoings=n,this.queuings=i,o.length>0&&this.activated$.next(o)}async capacity(){return await Bo.getValue(this.url,t=>{var r;return(r=t.limitation)==null?void 0:r.max_subscriptions},{skipFetch:this.config.skipFetchNip11})??1/0}}class Fm{constructor(t,r){Q(this,"relay"),Q(this,"pubProxy"),Q(this,"subProxy"),Q(this,"defaultSubscriptionIds",new Set),Q(this,"communicating",!1),Q(this,"strategy","lazy"),Q(this,"disconnectTimeout"),Q(this,"disconnectTimer"),Q(this,"isDefaultRelay",!1),Q(this,"disposed",!1),Q(this,"_url"),this._url=Or(t);const n=qm(t,r),i=new km(this.url,r),o=n?new Bm({relay:i,config:r,authenticator:n}):null,s=new Um({relay:i,authProxy:o}),a=new Hm({relay:i,authProxy:o,config:r});this.relay=i,this.pubProxy=s,this.subProxy=a,this.disconnectTimeout=r.disconnectTimeout,ym([this.pubProxy.getLogicalConnectionSizeObservable(),this.subProxy.getLogicalConnectionSizeObservable()]).pipe(ln(([l,f])=>l+f)).subscribe(l=>{this.communicating=l>0,this.resetConnection()})}get url(){return this._url}setConnectionStrategy(t){this.disposed||(this.strategy=t,this.resetConnection())}resetConnection(){let t=this.strategy;switch(this.isDefaultRelay||(t="lazy"),t){case"lazy":{const r=()=>{this.communicating||this.relay.disconnect(Fn.RX_NOSTR_IDLE)};this.disconnectTimeout>0?(this.disconnectTimeout&&(clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0),this.disconnectTimer=setTimeout(r,this.disconnectTimeout)):r();break}case"lazy-keep":break;case"aggressive":{(this.connectionState==="initialized"||this.connectionState==="dormant")&&this.relay.connectManually();break}}}markAsDefault(t){if(!this.disposed){if(this.isDefaultRelay=t,!this.isDefaultRelay){for(const r of this.defaultSubscriptionIds)this.subProxy.unsubscribe(r);this.defaultSubscriptionIds.clear()}this.resetConnection()}}async publish(t){if(!this.disposed)return this.pubProxy.publish(t)}confirmOK(t){this.disposed||this.pubProxy.confirmOK(t)}subscribe(t,r){if(this.disposed)return;const{mode:n,overwrite:i,autoclose:o}=Ji(r??{},{overwrite:!1,autoclose:!1,mode:"default"}),[,s]=t;n==="default"&&!this.isDefaultRelay||!i&&this.subProxy.isOngoingOrQueued(s)||(n==="default"&&this.defaultSubscriptionIds.add(s),this.subProxy.subscribe(t,o))}unsubscribe(t){this.disposed||(this.defaultSubscriptionIds.delete(t),this.subProxy.unsubscribe(t))}getEventObservable(){if(this.disposed)throw new Tr;return this.subProxy.getEventObservable()}getFinObservable(){if(this.disposed)throw new Tr;return this.subProxy.getFinObservable()}getOkAgainstEventObservable(){if(this.disposed)throw new Tr;return this.pubProxy.getOkAgainstEventObservable()}getAllMessageObservable(){if(this.disposed)throw new Tr;return this.relay.getAllMessageObservable()}getOutgoingMessageObservable(){if(this.disposed)throw new Tr;return this.relay.getOutgoingMessageObservable()}getConnectionStateObservable(){if(this.disposed)throw new Tr;return this.relay.getConnectionStateObservable()}get connectionState(){return this.relay.state}getErrorObservable(){if(this.disposed)throw new Tr;return this.relay.getErrorObservable().pipe(ln(t=>({from:this.url,reason:t})))}connectManually(){this.relay.connectManually()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){this.disposed||(this.disposed=!0,this.disconnectTimer&&clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0,this.relay.dispose(),this.pubProxy.dispose(),this.subProxy.dispose())}}function qm(e,t){const r=t.authenticator;if(!r)return;const n=r instanceof Function?r(e):r;return n==="auto"?{}:n}function jm(e,t){return e.filter(r=>!t.includes(r))}function zm(e){const{rxReq:t,index:r}=e,{rxReqId:n,strategy:i}=t;return`${n}:${i==="backward"?r:0}`}function Wm(e){const{rxReq:t,filters:r,index:n}=e;return["REQ",zm({rxReq:t,index:n}),...r]}function xc(e){if(Array.isArray(e)){const t=e.map(r=>{let n="",i=!1,o=!1;if(typeof r=="string")n=r,i=!0,o=!0;else if(Array.isArray(r)){const s=r[2];n=r[1],i=!s||s==="read",o=!s||s==="write"}else n=r.url,i=r.read,o=r.write;return{url:n,read:i,write:o}});return Object.fromEntries(t.map(r=>[r.url,r]))}else{const t=Object.entries(e).map(([r,n])=>({url:r,...n}));return Object.fromEntries(t.map(r=>[r.url,r]))}}function Ac(e,t){const r=new Set;if(t!=null&&t.on){const n=t.on;if(!n.defaultReadRelays&&!n.defaultWriteRelays&&!n.relays)return;const i=e.getDefaultRelays();if(n.defaultReadRelays)for(const{url:o}of Object.values(i).filter(s=>s.read))r.add(o);if(n.defaultWriteRelays)for(const{url:o}of Object.values(i).filter(s=>s.write))r.add(o);if(n.relays)for(const o of n.relays)r.add(Or(o));return[...r]}else if(t!=null&&t.relays){for(const n of t.relays)r.add(Or(n));return[...r]}else return}function Gm(e){return new Vm(Ev(e??{}))}class Vm{constructor(t){Q(this,"connections",new Vn),Q(this,"defaultRelays",new Vn),Q(this,"defaultSubscriptions",new Map),Q(this,"event$",new Ge),Q(this,"fin$",new Ge),Q(this,"ok$",new Ge),Q(this,"all$",new Ge),Q(this,"error$",new Ge),Q(this,"connectionState$",new Ge),Q(this,"outgoing$",new Ge),Q(this,"dispose$",new Ge),Q(this,"disposed",!1),this.config=t}get defaultReadables(){const t=[];for(const{url:r,read:n}of this.defaultRelays.values()){const i=this.connections.get(r);n&&i&&t.push(i)}return t}get defaultWritables(){const t=[];for(const{url:r,write:n}of this.defaultRelays.values()){const i=this.connections.get(r);n&&i&&t.push(i)}return t}getDefaultRelays(){if(this.disposed)throw new Tr;return this.defaultRelays.toObject()}getDefaultRelay(t){return this.defaultRelays.get(t)}setDefaultRelays(t){if(this.disposed)throw new Tr;const r=new Vn(xc(t)),n=[];for(const{read:i,url:o}of r.values()){const s=this.ensureNostrConnection(o);s.setConnectionStrategy(this.config.connectionStrategy),i&&n.push(s)}this.updateDefaultSubscriptions(n),this.defaultRelays=r}ensureNostrConnection(t){let r=this.connections.get(t);return r||(r=new Fm(t,this.config),this.attachNostrConnection(r),this.connections.set(t,r),r)}attachNostrConnection(t){t.getEventObservable().subscribe(this.event$),t.getFinObservable().subscribe(this.fin$),t.getOkAgainstEventObservable().subscribe(this.ok$),t.getAllMessageObservable().subscribe(this.all$),t.getConnectionStateObservable().subscribe(this.connectionState$),t.getErrorObservable().subscribe(this.error$),t.getOutgoingMessageObservable().subscribe(this.outgoing$)}updateDefaultSubscriptions(t){const r=jm(this.defaultReadables,t);for(const n of r)n.markAsDefault(!1);for(const n of t){n.markAsDefault(!0);for(const{req:i,autoclose:o}of this.defaultSubscriptions.values())n?.subscribe(i,{mode:"default",overwrite:!1,autoclose:o})}}addDefaultRelays(t){const r=xc(t);this.setDefaultRelays({...this.defaultRelays.toObject(),...r})}removeDefaultRelays(t){const r=this.defaultRelays.copy(),n=Array.isArray(t)?t:[t];for(const i of n)r.delete(i);this.setDefaultRelays(r.toObject())}getAllRelayStatus(){return Object.fromEntries(Array.from(this.connections.values()).map(t=>[t.url,{connection:t.connectionState}]))}getRelayStatus(t){const r=this.connections.get(t);if(r)return{connection:r.connectionState}}reconnect(t){const r=this.getDefaultRelay(t);if(!r)throw new yo(`The relay (${t}) is not a default relay. \`reconnect()\` can be used only for a readable default relay.`);if(!r.read)throw new yo(`The relay (${t}) is not readable. \`reconnect()\` can be used only for a readable default relay.`);const n=this.connections.get(t);if(!n)throw new Ah;(n.connectionState==="error"||n.connectionState==="rejected")&&n.connectManually()}use(t,r){const n=Ac(this,r),i=({filters:u,relays:c},h)=>{var d;const p=t.strategy==="backward"?c:void 0,g=Wm({rxReq:t,filters:u,index:h});return{subId:g[1],req:g,targetConnections:((d=p??n)==null?void 0:d.map(m=>this.ensureNostrConnection(m)))??this.defaultReadables,mode:p===void 0&&n===void 0?"default":"temporary"}},o=({req:u,targetConnections:c,mode:h})=>{this.startSubscription({req:u,targetConnections:c,mode:h,overwrite:t.strategy==="forward",autoclose:t.strategy==="backward"})},s=({subId:u,targetConnections:c,mode:h})=>{this.teardownSubscription({subId:u,targetConnections:c,mode:h})},a=({req:u,targetConnections:c})=>t.strategy==="forward"?this.createForwardEventObservable({req:u}).pipe(wi(this.dispose$)):this.createBackwardEventObservable({req:u,targetConnections:c}).pipe(wi(this.dispose$)),l=t.getReqPacketObservable().pipe(Ft(({filters:u})=>u.length>0),ln(i),wi(this.dispose$)),f=()=>Nm(async({event:u})=>(this.config.skipVerify||await this.config.verifier(u))&&(this.config.skipExpirationCheck||!Sv(u)));if(t.strategy==="forward"){let u;return l.pipe(fo(c=>{u=c}),fo(o),ln(a),zs(()=>{u&&s(u)}),Lm(),f())}else return l.pipe(fo(o),ln(u=>a(u).pipe(zs(()=>{s(u)}))),Zh(),f())}createForwardEventObservable(t){const{req:r}=t,n=r[1];return this.event$.pipe(Ws(n))}createBackwardEventObservable(t){const{req:r,targetConnections:n}=t,i=r[1],o=new Set,s=u=>u==="error"||u==="rejected"||u==="terminated",a=()=>n.every(({connectionState:u,url:c})=>s(u)||o.has(c)),l=this.fin$.pipe(Ws(i),fo(({from:u})=>{o.add(u)})),f=_m(l,this.connectionState$.asObservable()).pipe(Ft(()=>a()),Ma(null,void 0));return this.event$.pipe(wi(f),Ec(this.config.eoseTimeout),Ws(i),Ft(u=>!o.has(u.from)))}startSubscription(t){const{req:r,targetConnections:n,mode:i,overwrite:o,autoclose:s}=t,a=r[1];i==="default"&&this.defaultSubscriptions.set(a,{req:r,autoclose:s});for(const l of n)l.subscribe(r,{mode:i,overwrite:o,autoclose:s})}teardownSubscription(t){const{subId:r,targetConnections:n,mode:i}=t;i==="default"&&this.defaultSubscriptions.delete(r);for(const o of n)o.unsubscribe(r)}createAllEventObservable(){return this.event$.asObservable()}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.all$.asObservable()}createConnectionStateObservable(){return this.connectionState$.asObservable()}createOutgoingMessageObservable(){return this.outgoing$.asObservable()}send(t,r){const{signer:n,errorOnTimeout:i,completeOn:o}=Ji(r??{},{signer:this.config.signer,errorOnTimeout:!1,completeOn:"all-ok"}),s=Ac(this,r),a=s===void 0?this.defaultWritables:s.map(d=>this.ensureNostrConnection(d)),l=new Ge,f=new Set;let u="";const c=()=>{l.closed||l.complete();for(const d of a)d.confirmOK(u)};n.signEvent(t).then(async d=>{l.closed||(u=d.id,this.ok$.pipe(Ft(({eventId:p})=>p===d.id)).subscribe(l),await Promise.all(a.map(p=>p.publish(d))),o==="sent"&&l.complete())}).catch(d=>{throw c(),new yo(d instanceof Error?d.message:"Failed to sign the given event")});const h=(()=>{switch(o){case"sent":return qr;case"all-ok":return Pm(({from:d,done:p})=>(p&&f.add(d),f.size<a.length),!0);case"any-ok":return Ma(d=>d.ok)}})();return l.pipe(h,wi(this.dispose$),i?Kh(this.config.okTimeout):Ec(this.config.okTimeout),zs(c))}async cast(t,r){await Wh(this.send(t,{...r,completeOn:"sent"}))}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;for(const r of this.connections.values())r.dispose();this.connections.clear();const t=[this.event$,this.ok$,this.fin$,this.all$,this.connectionState$,this.error$,this.outgoing$];for(const r of t)r.complete();this.dispose$.next(),this.dispose$.complete()}}const Qh=e=>{const{strategy:t}=e,r=e.operators??[],n=e.rxReqId??Km(),i=e.subject??new Ge;return{strategy:t,rxReqId:n,getReqPacketObservable(){return i.pipe(...r)},pipe(...o){return Qh({strategy:t,rxReqId:n,operators:[...r,...o],subject:i})},emit(o,s){i.next({filters:Xm(o),...s??{}})},over(){i.complete()}}};function Eo(e){return Qh({strategy:"forward",rxReqId:e})}function Km(){return`${Math.floor(Math.random()*1e6)}`}function Zm(e){var t,r;const n={},i=o=>/^#[a-zA-Z]$/.test(o);for(const o of Object.keys(e)){if(o==="limit"&&(e[o]??-1)>=0){n[o]=e[o];continue}if(o==="since"||o==="until"){const s=e[o];if(typeof s!="number"||(s??-1)>=0){n[o]=s;continue}}if((i(o)||o==="ids"||o==="authors")&&e[o]!==void 0&&(((t=e[o])==null?void 0:t.length)??-1)>0){n[o]=e[o];continue}if(o==="kinds"&&e[o]!==void 0&&(((r=e[o])==null?void 0:r.length)??-1)>0){n[o]=e[o];continue}if(o==="search"&&e[o]!==void 0){n[o]=e[o];continue}}return typeof n.since!="number"||typeof n.until!="number"||n.since<=n.until?n:null}function Xm(e){return(Array.isArray(e)?e:[e]).map(t=>Zm(t)).filter(t=>t!==null)}function Sc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Ym(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function no(e,...t){if(!Ym(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Qm(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Sc(e.outputLen),Sc(e.blockLen)}function Mo(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Jm(e,t){no(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Gs=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Vs=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),nr=(e,t)=>e<<32-t|e>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const eb=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ho(e){no(e);let t="";for(let r=0;r<e.length;r++)t+=eb[e[r]];return t}function tb(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Dl(e){return typeof e=="string"&&(e=tb(e)),no(e),e}function rb(...e){let t=0;for(let n=0;n<e.length;n++){const i=e[n];no(i),t+=i.length}const r=new Uint8Array(t);for(let n=0,i=0;n<e.length;n++){const o=e[n];r.set(o,i),i+=o.length}return r}let Jh=class{clone(){return this._cloneInto()}};function nb(e){const t=n=>e().update(Dl(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function ed(e=32){if(Gs&&typeof Gs.getRandomValues=="function")return Gs.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function ib(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const i=BigInt(32),o=BigInt(4294967295),s=Number(r>>i&o),a=Number(r&o),l=n?4:0,f=n?0:4;e.setUint32(t+l,s,n),e.setUint32(t+f,a,n)}const ob=(e,t,r)=>e&t^~e&r,sb=(e,t,r)=>e&t^e&r^t&r;class ab extends Jh{constructor(t,r,n,i){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Vs(this.buffer)}update(t){Mo(this);const{view:r,buffer:n,blockLen:i}=this;t=Dl(t);const o=t.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const l=Vs(t);for(;i<=o-s;s+=i)this.process(l,s);continue}n.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Mo(this),Jm(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:o}=this;let{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let c=s;c<i;c++)r[c]=0;ib(n,i-8,BigInt(this.length*8),o),this.process(n,0);const a=Vs(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=l/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<f;c++)a.setUint32(4*c,u[c],o)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return t.length=i,t.pos=a,t.finished=o,t.destroyed=s,i%r&&t.buffer.set(n),t}}const lb=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Zr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xr=new Uint32Array(64);class ub extends ab{constructor(){super(64,32,8,!1),this.A=Zr[0]|0,this.B=Zr[1]|0,this.C=Zr[2]|0,this.D=Zr[3]|0,this.E=Zr[4]|0,this.F=Zr[5]|0,this.G=Zr[6]|0,this.H=Zr[7]|0}get(){const{A:t,B:r,C:n,D:i,E:o,F:s,G:a,H:l}=this;return[t,r,n,i,o,s,a,l]}set(t,r,n,i,o,s,a,l){this.A=t|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=l|0}process(t,r){for(let c=0;c<16;c++,r+=4)Xr[c]=t.getUint32(r,!1);for(let c=16;c<64;c++){const h=Xr[c-15],d=Xr[c-2],p=nr(h,7)^nr(h,18)^h>>>3,g=nr(d,17)^nr(d,19)^d>>>10;Xr[c]=g+Xr[c-7]+p+Xr[c-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:l,G:f,H:u}=this;for(let c=0;c<64;c++){const h=nr(a,6)^nr(a,11)^nr(a,25),d=u+h+ob(a,l,f)+lb[c]+Xr[c]|0,p=(nr(n,2)^nr(n,13)^nr(n,22))+sb(n,i,o)|0;u=f,f=l,l=a,a=s+d|0,s=o,o=i,i=n,n=d+p|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,l=l+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,o,s,a,l,f,u)}roundClean(){Xr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Do=nb(()=>new ub);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const td=BigInt(0),hs=BigInt(1),cb=BigInt(2);function In(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function io(e){if(!In(e))throw new Error("Uint8Array expected")}const fb=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ri(e){io(e);let t="";for(let r=0;r<e.length;r++)t+=fb[e[r]];return t}function rd(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function Fl(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}const Ar={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Tc(e){if(e>=Ar._0&&e<=Ar._9)return e-Ar._0;if(e>=Ar._A&&e<=Ar._F)return e-(Ar._A-10);if(e>=Ar._a&&e<=Ar._f)return e-(Ar._a-10)}function ni(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(r);for(let i=0,o=0;i<r;i++,o+=2){const s=Tc(e.charCodeAt(o)),a=Tc(e.charCodeAt(o+1));if(s===void 0||a===void 0){const l=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}n[i]=s*16+a}return n}function Rt(e){return Fl(ri(e))}function ql(e){return io(e),Fl(ri(Uint8Array.from(e).reverse()))}function cn(e,t){return ni(e.toString(16).padStart(t*2,"0"))}function jl(e,t){return cn(e,t).reverse()}function hb(e){return ni(rd(e))}function pt(e,t,r){let n;if(typeof t=="string")try{n=ni(t)}catch(o){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${o}`)}else if(In(t))n=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(`${e} expected ${r} bytes, got ${i}`);return n}function On(...e){let t=0;for(let n=0;n<e.length;n++){const i=e[n];io(i),t+=i.length}const r=new Uint8Array(t);for(let n=0,i=0;n<e.length;n++){const o=e[n];r.set(o,i),i+=o.length}return r}function db(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}function pb(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function gb(e){let t;for(t=0;e>td;e>>=hs,t+=1);return t}function vb(e,t){return e>>BigInt(t)&hs}function mb(e,t,r){return e|(r?hs:td)<<BigInt(t)}const zl=e=>(cb<<BigInt(e-1))-hs,Ks=e=>new Uint8Array(e),Ic=e=>Uint8Array.from(e);function nd(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=Ks(e),i=Ks(e),o=0;const s=()=>{n.fill(1),i.fill(0),o=0},a=(...u)=>r(i,n,...u),l=(u=Ks())=>{i=a(Ic([0]),u),n=a(),u.length!==0&&(i=a(Ic([1]),u),n=a())},f=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const c=[];for(;u<t;){n=a();const h=n.slice();c.push(h),u+=n.length}return On(...c)};return(u,c)=>{s(),l(u);let h;for(;!(h=c(f()));)l();return s(),h}}const bb={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||In(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function oo(e,t,r={}){const n=(i,o,s)=>{const a=bb[o];if(typeof a!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=e[i];if(!(s&&l===void 0)&&!a(l,e))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${o}`)};for(const[i,o]of Object.entries(t))n(i,o,!1);for(const[i,o]of Object.entries(r))n(i,o,!0);return e}const yb=Object.freeze(Object.defineProperty({__proto__:null,abytes:io,bitGet:vb,bitLen:gb,bitMask:zl,bitSet:mb,bytesToHex:ri,bytesToNumberBE:Rt,bytesToNumberLE:ql,concatBytes:On,createHmacDrbg:nd,ensureBytes:pt,equalBytes:db,hexToBytes:ni,hexToNumber:Fl,isBytes:In,numberToBytesBE:cn,numberToBytesLE:jl,numberToHexUnpadded:rd,numberToVarBytesBE:hb,utf8ToBytes:pb,validateObject:oo},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nt=BigInt(0),Ke=BigInt(1),mn=BigInt(2),wb=BigInt(3),Ha=BigInt(4),Oc=BigInt(5),Rc=BigInt(8);BigInt(9);BigInt(16);function lt(e,t){const r=e%t;return r>=nt?r:t+r}function Eb(e,t,r){if(r<=nt||t<nt)throw new Error("Expected power/modulo > 0");if(r===Ke)return nt;let n=Ke;for(;t>nt;)t&Ke&&(n=n*e%r),e=e*e%r,t>>=Ke;return n}function Ut(e,t,r){let n=e;for(;t-- >nt;)n*=n,n%=r;return n}function Da(e,t){if(e===nt||t<=nt)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=lt(e,t),n=t,i=nt,o=Ke;for(;r!==nt;){const s=n/r,a=n%r,l=i-o*s;n=r,r=a,i=o,o=l}if(n!==Ke)throw new Error("invert: does not exist");return lt(i,t)}function _b(e){const t=(e-Ke)/mn;let r,n,i;for(r=e-Ke,n=0;r%mn===nt;r/=mn,n++);for(i=mn;i<e&&Eb(i,t,e)!==e-Ke;i++);if(n===1){const s=(e+Ke)/Ha;return function(a,l){const f=a.pow(l,s);if(!a.eql(a.sqr(f),l))throw new Error("Cannot find square root");return f}}const o=(r+Ke)/mn;return function(s,a){if(s.pow(a,t)===s.neg(s.ONE))throw new Error("Cannot find square root");let l=n,f=s.pow(s.mul(s.ONE,i),r),u=s.pow(a,o),c=s.pow(a,r);for(;!s.eql(c,s.ONE);){if(s.eql(c,s.ZERO))return s.ZERO;let h=1;for(let p=s.sqr(c);h<l&&!s.eql(p,s.ONE);h++)p=s.sqr(p);const d=s.pow(f,Ke<<BigInt(l-h-1));f=s.sqr(d),u=s.mul(u,d),c=s.mul(c,f),l=h}return u}}function xb(e){if(e%Ha===wb){const t=(e+Ke)/Ha;return function(r,n){const i=r.pow(n,t);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(e%Rc===Oc){const t=(e-Oc)/Rc;return function(r,n){const i=r.mul(n,mn),o=r.pow(i,t),s=r.mul(n,o),a=r.mul(r.mul(s,mn),o),l=r.mul(s,r.sub(a,r.ONE));if(!r.eql(r.sqr(l),n))throw new Error("Cannot find square root");return l}}return _b(e)}const Ab=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Sb(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Ab.reduce((n,i)=>(n[i]="function",n),t);return oo(e,r)}function Tb(e,t,r){if(r<nt)throw new Error("Expected power > 0");if(r===nt)return e.ONE;if(r===Ke)return t;let n=e.ONE,i=t;for(;r>nt;)r&Ke&&(n=e.mul(n,i)),i=e.sqr(i),r>>=Ke;return n}function Ib(e,t){const r=new Array(t.length),n=t.reduce((o,s,a)=>e.is0(s)?o:(r[a]=o,e.mul(o,s)),e.ONE),i=e.inv(n);return t.reduceRight((o,s,a)=>e.is0(s)?o:(r[a]=e.mul(o,r[a]),e.mul(o,s)),i),r}function id(e,t){const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Ob(e,t,r=!1,n={}){if(e<=nt)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:o}=id(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=xb(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:zl(i),ZERO:nt,ONE:Ke,create:l=>lt(l,e),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return nt<=l&&l<e},is0:l=>l===nt,isOdd:l=>(l&Ke)===Ke,neg:l=>lt(-l,e),eql:(l,f)=>l===f,sqr:l=>lt(l*l,e),add:(l,f)=>lt(l+f,e),sub:(l,f)=>lt(l-f,e),mul:(l,f)=>lt(l*f,e),pow:(l,f)=>Tb(a,l,f),div:(l,f)=>lt(l*Da(f,e),e),sqrN:l=>l*l,addN:(l,f)=>l+f,subN:(l,f)=>l-f,mulN:(l,f)=>l*f,inv:l=>Da(l,e),sqrt:n.sqrt||(l=>s(a,l)),invertBatch:l=>Ib(a,l),cmov:(l,f,u)=>u?f:l,toBytes:l=>r?jl(l,o):cn(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return r?ql(l):Rt(l)}});return Object.freeze(a)}function od(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function sd(e){const t=od(e);return t+Math.ceil(t/2)}function Rb(e,t,r=!1){const n=e.length,i=od(t),o=sd(t);if(n<16||n<o||n>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${n}`);const s=r?Rt(e):ql(e),a=lt(s,t-Ke)+Ke;return r?jl(a,i):cn(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lb=BigInt(0),Zs=BigInt(1);function Pb(e,t){const r=(i,o)=>{const s=o.negate();return i?s:o},n=i=>{const o=Math.ceil(t/i)+1,s=2**(i-1);return{windows:o,windowSize:s}};return{constTimeNegate:r,unsafeLadder(i,o){let s=e.ZERO,a=i;for(;o>Lb;)o&Zs&&(s=s.add(a)),a=a.double(),o>>=Zs;return s},precomputeWindow(i,o){const{windows:s,windowSize:a}=n(o),l=[];let f=i,u=f;for(let c=0;c<s;c++){u=f,l.push(u);for(let h=1;h<a;h++)u=u.add(f),l.push(u);f=u.double()}return l},wNAF(i,o,s){const{windows:a,windowSize:l}=n(i);let f=e.ZERO,u=e.BASE;const c=BigInt(2**i-1),h=2**i,d=BigInt(i);for(let p=0;p<a;p++){const g=p*l;let m=Number(s&c);s>>=d,m>l&&(m-=h,s+=Zs);const v=g,A=g+Math.abs(m)-1,S=p%2!==0,O=m<0;m===0?u=u.add(r(S,o[v])):f=f.add(r(O,o[A]))}return{p:f,f:u}},wNAFCached(i,o,s,a){const l=i._WINDOW_SIZE||1;let f=o.get(i);return f||(f=this.precomputeWindow(i,l),l!==1&&o.set(i,a(f))),this.wNAF(l,f,s)}}}function ad(e){return Sb(e.Fp),oo(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...id(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Nb(e){const t=ad(e);oo(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=t;if(r){if(!n.eql(i,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:Cb,hexToBytes:Bb}=yb,yn={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=yn;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(n[0]&128)throw new t("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Cb(n),l:e.subarray(r+2)}},toSig(e){const{Err:t}=yn,r=typeof e=="string"?Bb(e):e;io(r);let n=r.length;if(n<2||r[0]!=48)throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=yn._parseInt(r.subarray(2)),{d:s,l:a}=yn._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s}},hexFromSig(e){const t=f=>Number.parseInt(f[0],16)&8?"00"+f:f,r=f=>{const u=f.toString(16);return u.length&1?`0${u}`:u},n=t(r(e.s)),i=t(r(e.r)),o=n.length/2,s=i.length/2,a=r(o),l=r(s);return`30${r(s+o+4)}02${l}${i}02${a}${n}`}},Rr=BigInt(0),Ht=BigInt(1);BigInt(2);const Lc=BigInt(3);BigInt(4);function $b(e){const t=Nb(e),{Fp:r}=t,n=t.toBytes||((p,g,m)=>{const v=g.toAffine();return On(Uint8Array.from([4]),r.toBytes(v.x),r.toBytes(v.y))}),i=t.fromBytes||(p=>{const g=p.subarray(1),m=r.fromBytes(g.subarray(0,r.BYTES)),v=r.fromBytes(g.subarray(r.BYTES,2*r.BYTES));return{x:m,y:v}});function o(p){const{a:g,b:m}=t,v=r.sqr(p),A=r.mul(v,p);return r.add(r.add(A,r.mul(p,g)),m)}if(!r.eql(r.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(p){return typeof p=="bigint"&&Rr<p&&p<t.n}function a(p){if(!s(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:v,n:A}=t;if(g&&typeof p!="bigint"){if(In(p)&&(p=ri(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(m*2,"0")}let S;try{S=typeof p=="bigint"?p:Rt(pt("private key",p,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof p}`)}return v&&(S=lt(S,A)),a(S),S}const f=new Map;function u(p){if(!(p instanceof c))throw new Error("ProjectivePoint expected")}class c{constructor(g,m,v){if(this.px=g,this.py=m,this.pz=v,g==null||!r.isValid(g))throw new Error("x required");if(m==null||!r.isValid(m))throw new Error("y required");if(v==null||!r.isValid(v))throw new Error("z required")}static fromAffine(g){const{x:m,y:v}=g||{};if(!g||!r.isValid(m)||!r.isValid(v))throw new Error("invalid affine point");if(g instanceof c)throw new Error("projective point not allowed");const A=S=>r.eql(S,r.ZERO);return A(m)&&A(v)?c.ZERO:new c(m,v,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const m=r.invertBatch(g.map(v=>v.pz));return g.map((v,A)=>v.toAffine(m[A])).map(c.fromAffine)}static fromHex(g){const m=c.fromAffine(i(pt("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return c.BASE.multiply(l(g))}_setWindowSize(g){this._WINDOW_SIZE=g,f.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:m}=this.toAffine();if(!r.isValid(g)||!r.isValid(m))throw new Error("bad point: x or y not FE");const v=r.sqr(m),A=o(g);if(!r.eql(v,A))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(r.isOdd)return!r.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:m,py:v,pz:A}=this,{px:S,py:O,pz:L}=g,E=r.eql(r.mul(m,L),r.mul(S,A)),I=r.eql(r.mul(v,L),r.mul(O,A));return E&&I}negate(){return new c(this.px,r.neg(this.py),this.pz)}double(){const{a:g,b:m}=t,v=r.mul(m,Lc),{px:A,py:S,pz:O}=this;let L=r.ZERO,E=r.ZERO,I=r.ZERO,y=r.mul(A,A),x=r.mul(S,S),R=r.mul(O,O),T=r.mul(A,S);return T=r.add(T,T),I=r.mul(A,O),I=r.add(I,I),L=r.mul(g,I),E=r.mul(v,R),E=r.add(L,E),L=r.sub(x,E),E=r.add(x,E),E=r.mul(L,E),L=r.mul(T,L),I=r.mul(v,I),R=r.mul(g,R),T=r.sub(y,R),T=r.mul(g,T),T=r.add(T,I),I=r.add(y,y),y=r.add(I,y),y=r.add(y,R),y=r.mul(y,T),E=r.add(E,y),R=r.mul(S,O),R=r.add(R,R),y=r.mul(R,T),L=r.sub(L,y),I=r.mul(R,x),I=r.add(I,I),I=r.add(I,I),new c(L,E,I)}add(g){u(g);const{px:m,py:v,pz:A}=this,{px:S,py:O,pz:L}=g;let E=r.ZERO,I=r.ZERO,y=r.ZERO;const x=t.a,R=r.mul(t.b,Lc);let T=r.mul(m,S),P=r.mul(v,O),C=r.mul(A,L),N=r.add(m,v),_=r.add(S,O);N=r.mul(N,_),_=r.add(T,P),N=r.sub(N,_),_=r.add(m,A);let b=r.add(S,L);return _=r.mul(_,b),b=r.add(T,C),_=r.sub(_,b),b=r.add(v,A),E=r.add(O,L),b=r.mul(b,E),E=r.add(P,C),b=r.sub(b,E),y=r.mul(x,_),E=r.mul(R,C),y=r.add(E,y),E=r.sub(P,y),y=r.add(P,y),I=r.mul(E,y),P=r.add(T,T),P=r.add(P,T),C=r.mul(x,C),_=r.mul(R,_),P=r.add(P,C),C=r.sub(T,C),C=r.mul(x,C),_=r.add(_,C),T=r.mul(P,_),I=r.add(I,T),T=r.mul(b,_),E=r.mul(N,E),E=r.sub(E,T),T=r.mul(N,P),y=r.mul(b,y),y=r.add(y,T),new c(E,I,y)}subtract(g){return this.add(g.negate())}is0(){return this.equals(c.ZERO)}wNAF(g){return d.wNAFCached(this,f,g,m=>{const v=r.invertBatch(m.map(A=>A.pz));return m.map((A,S)=>A.toAffine(v[S])).map(c.fromAffine)})}multiplyUnsafe(g){const m=c.ZERO;if(g===Rr)return m;if(a(g),g===Ht)return this;const{endo:v}=t;if(!v)return d.unsafeLadder(this,g);let{k1neg:A,k1:S,k2neg:O,k2:L}=v.splitScalar(g),E=m,I=m,y=this;for(;S>Rr||L>Rr;)S&Ht&&(E=E.add(y)),L&Ht&&(I=I.add(y)),y=y.double(),S>>=Ht,L>>=Ht;return A&&(E=E.negate()),O&&(I=I.negate()),I=new c(r.mul(I.px,v.beta),I.py,I.pz),E.add(I)}multiply(g){a(g);let m=g,v,A;const{endo:S}=t;if(S){const{k1neg:O,k1:L,k2neg:E,k2:I}=S.splitScalar(m);let{p:y,f:x}=this.wNAF(L),{p:R,f:T}=this.wNAF(I);y=d.constTimeNegate(O,y),R=d.constTimeNegate(E,R),R=new c(r.mul(R.px,S.beta),R.py,R.pz),v=y.add(R),A=x.add(T)}else{const{p:O,f:L}=this.wNAF(m);v=O,A=L}return c.normalizeZ([v,A])[0]}multiplyAndAddUnsafe(g,m,v){const A=c.BASE,S=(L,E)=>E===Rr||E===Ht||!L.equals(A)?L.multiplyUnsafe(E):L.multiply(E),O=S(this,m).add(S(g,v));return O.is0()?void 0:O}toAffine(g){const{px:m,py:v,pz:A}=this,S=this.is0();g==null&&(g=S?r.ONE:r.inv(A));const O=r.mul(m,g),L=r.mul(v,g),E=r.mul(A,g);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(E,r.ONE))throw new Error("invZ was invalid");return{x:O,y:L}}isTorsionFree(){const{h:g,isTorsionFree:m}=t;if(g===Ht)return!0;if(m)return m(c,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:m}=t;return g===Ht?this:m?m(c,this):this.multiplyUnsafe(t.h)}toRawBytes(g=!0){return this.assertValidity(),n(c,this,g)}toHex(g=!0){return ri(this.toRawBytes(g))}}c.BASE=new c(t.Gx,t.Gy,r.ONE),c.ZERO=new c(r.ZERO,r.ONE,r.ZERO);const h=t.nBitLength,d=Pb(c,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:s}}function Ub(e){const t=ad(e);return oo(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function kb(e){const t=Ub(e),{Fp:r,n}=t,i=r.BYTES+1,o=2*r.BYTES+1;function s(_){return Rr<_&&_<r.ORDER}function a(_){return lt(_,n)}function l(_){return Da(_,n)}const{ProjectivePoint:f,normPrivateKeyToScalar:u,weierstrassEquation:c,isWithinCurveOrder:h}=$b({...t,toBytes(_,b,w){const k=b.toAffine(),B=r.toBytes(k.x),U=On;return w?U(Uint8Array.from([b.hasEvenY()?2:3]),B):U(Uint8Array.from([4]),B,r.toBytes(k.y))},fromBytes(_){const b=_.length,w=_[0],k=_.subarray(1);if(b===i&&(w===2||w===3)){const B=Rt(k);if(!s(B))throw new Error("Point is not on curve");const U=c(B);let F;try{F=r.sqrt(U)}catch(j){const q=j instanceof Error?": "+j.message:"";throw new Error("Point is not on curve"+q)}const D=(F&Ht)===Ht;return(w&1)===1!==D&&(F=r.neg(F)),{x:B,y:F}}else if(b===o&&w===4){const B=r.fromBytes(k.subarray(0,r.BYTES)),U=r.fromBytes(k.subarray(r.BYTES,2*r.BYTES));return{x:B,y:U}}else throw new Error(`Point of length ${b} was invalid. Expected ${i} compressed bytes or ${o} uncompressed bytes`)}}),d=_=>ri(cn(_,t.nByteLength));function p(_){const b=n>>Ht;return _>b}function g(_){return p(_)?a(-_):_}const m=(_,b,w)=>Rt(_.slice(b,w));class v{constructor(b,w,k){this.r=b,this.s=w,this.recovery=k,this.assertValidity()}static fromCompact(b){const w=t.nByteLength;return b=pt("compactSignature",b,w*2),new v(m(b,0,w),m(b,w,2*w))}static fromDER(b){const{r:w,s:k}=yn.toSig(pt("DER",b));return new v(w,k)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(b){return new v(this.r,this.s,b)}recoverPublicKey(b){const{r:w,s:k,recovery:B}=this,U=I(pt("msgHash",b));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");const F=B===2||B===3?w+t.n:w;if(F>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const D=B&1?"03":"02",j=f.fromHex(D+d(F)),q=l(F),M=a(-U*q),Z=a(k*q),ae=f.BASE.multiplyAndAddUnsafe(j,M,Z);if(!ae)throw new Error("point at infinify");return ae.assertValidity(),ae}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return ni(this.toDERHex())}toDERHex(){return yn.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ni(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const A={isValidPrivateKey(_){try{return u(_),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const _=sd(t.n);return Rb(t.randomBytes(_),t.n)},precompute(_=8,b=f.BASE){return b._setWindowSize(_),b.multiply(BigInt(3)),b}};function S(_,b=!0){return f.fromPrivateKey(_).toRawBytes(b)}function O(_){const b=In(_),w=typeof _=="string",k=(b||w)&&_.length;return b?k===i||k===o:w?k===2*i||k===2*o:_ instanceof f}function L(_,b,w=!0){if(O(_))throw new Error("first arg must be private key");if(!O(b))throw new Error("second arg must be public key");return f.fromHex(b).multiply(u(_)).toRawBytes(w)}const E=t.bits2int||function(_){const b=Rt(_),w=_.length*8-t.nBitLength;return w>0?b>>BigInt(w):b},I=t.bits2int_modN||function(_){return a(E(_))},y=zl(t.nBitLength);function x(_){if(typeof _!="bigint")throw new Error("bigint expected");if(!(Rr<=_&&_<y))throw new Error(`bigint expected < 2^${t.nBitLength}`);return cn(_,t.nByteLength)}function R(_,b,w=T){if(["recovered","canonical"].some(V=>V in w))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:B}=t;let{lowS:U,prehash:F,extraEntropy:D}=w;U==null&&(U=!0),_=pt("msgHash",_),F&&(_=pt("prehashed msgHash",k(_)));const j=I(_),q=u(b),M=[x(q),x(j)];if(D!=null&&D!==!1){const V=D===!0?B(r.BYTES):D;M.push(pt("extraEntropy",V))}const Z=On(...M),ae=j;function he(V){const J=E(V);if(!h(J))return;const ie=l(J),Y=f.BASE.multiply(J).toAffine(),K=a(Y.x);if(K===Rr)return;const ce=a(ie*a(ae+K*q));if(ce===Rr)return;let oe=(Y.x===K?0:2)|Number(Y.y&Ht),ve=ce;return U&&p(ce)&&(ve=g(ce),oe^=1),new v(K,ve,oe)}return{seed:Z,k2sig:he}}const T={lowS:t.lowS,prehash:!1},P={lowS:t.lowS,prehash:!1};function C(_,b,w=T){const{seed:k,k2sig:B}=R(_,b,w),U=t;return nd(U.hash.outputLen,U.nByteLength,U.hmac)(k,B)}f.BASE._setWindowSize(8);function N(_,b,w,k=P){var B;const U=_;if(b=pt("msgHash",b),w=pt("publicKey",w),"strict"in k)throw new Error("options.strict was renamed to lowS");const{lowS:F,prehash:D}=k;let j,q;try{if(typeof U=="string"||In(U))try{j=v.fromDER(U)}catch(Y){if(!(Y instanceof yn.Err))throw Y;j=v.fromCompact(U)}else if(typeof U=="object"&&typeof U.r=="bigint"&&typeof U.s=="bigint"){const{r:Y,s:K}=U;j=new v(Y,K)}else throw new Error("PARSE");q=f.fromHex(w)}catch(Y){if(Y.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(F&&j.hasHighS())return!1;D&&(b=t.hash(b));const{r:M,s:Z}=j,ae=I(b),he=l(Z),V=a(ae*he),J=a(M*he),ie=(B=f.BASE.multiplyAndAddUnsafe(q,V,J))==null?void 0:B.toAffine();return ie?a(ie.x)===M:!1}return{CURVE:t,getPublicKey:S,getSharedSecret:L,sign:C,verify:N,ProjectivePoint:f,Signature:v,utils:A}}class ld extends Jh{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,Qm(t);const n=Dl(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(n.length>i?t.create().update(n).digest():n);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(t){return Mo(this),this.iHash.update(t),this}digestInto(t){Mo(this),no(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:o,blockLen:s,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=o,t.blockLen=s,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ud=(e,t,r)=>new ld(e,t).update(r).digest();ud.create=(e,t)=>new ld(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Mb(e){return{hash:e,hmac:(t,...r)=>ud(e,t,rb(...r)),randomBytes:ed}}function Hb(e,t){const r=n=>kb({...e,...Mb(n)});return Object.freeze({...r(t),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ds=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Fo=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),cd=BigInt(1),qo=BigInt(2),Pc=(e,t)=>(e+t/qo)/t;function fd(e){const t=ds,r=BigInt(3),n=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),l=BigInt(88),f=e*e*e%t,u=f*f*e%t,c=Ut(u,r,t)*u%t,h=Ut(c,r,t)*u%t,d=Ut(h,qo,t)*f%t,p=Ut(d,i,t)*d%t,g=Ut(p,o,t)*p%t,m=Ut(g,a,t)*g%t,v=Ut(m,l,t)*m%t,A=Ut(v,a,t)*g%t,S=Ut(A,r,t)*u%t,O=Ut(S,s,t)*p%t,L=Ut(O,n,t)*f%t,E=Ut(L,qo,t);if(!Fa.eql(Fa.sqr(E),e))throw new Error("Cannot find square root");return E}const Fa=Ob(ds,void 0,void 0,{sqrt:fd}),Wl=Hb({a:BigInt(0),b:BigInt(7),Fp:Fa,n:Fo,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Fo,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-cd*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=r,s=BigInt("0x100000000000000000000000000000000"),a=Pc(o*e,t),l=Pc(-n*e,t);let f=lt(e-a*r-l*i,t),u=lt(-a*n-l*o,t);const c=f>s,h=u>s;if(c&&(f=t-f),h&&(u=t-u),f>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:c,k1:f,k2neg:h,k2:u}}}},Do),ps=BigInt(0),hd=e=>typeof e=="bigint"&&ps<e&&e<ds,Db=e=>typeof e=="bigint"&&ps<e&&e<Fo,Nc={};function jo(e,...t){let r=Nc[e];if(r===void 0){const n=Do(Uint8Array.from(e,i=>i.charCodeAt(0)));r=On(n,n),Nc[e]=r}return Do(On(r,...t))}const Gl=e=>e.toRawBytes(!0).slice(1),qa=e=>cn(e,32),Xs=e=>lt(e,ds),qi=e=>lt(e,Fo),Vl=Wl.ProjectivePoint,Fb=(e,t,r)=>Vl.BASE.multiplyAndAddUnsafe(e,t,r);function ja(e){let t=Wl.utils.normPrivateKeyToScalar(e),r=Vl.fromPrivateKey(t);return{scalar:r.hasEvenY()?t:qi(-t),bytes:Gl(r)}}function dd(e){if(!hd(e))throw new Error("bad x: need 0 < x < p");const t=Xs(e*e),r=Xs(t*e+BigInt(7));let n=fd(r);n%qo!==ps&&(n=Xs(-n));const i=new Vl(e,n,cd);return i.assertValidity(),i}function pd(...e){return qi(Rt(jo("BIP0340/challenge",...e)))}function qb(e){return ja(e).bytes}function jb(e,t,r=ed(32)){const n=pt("message",e),{bytes:i,scalar:o}=ja(t),s=pt("auxRand",r,32),a=qa(o^Rt(jo("BIP0340/aux",s))),l=jo("BIP0340/nonce",a,i,n),f=qi(Rt(l));if(f===ps)throw new Error("sign failed: k is zero");const{bytes:u,scalar:c}=ja(f),h=pd(u,i,n),d=new Uint8Array(64);if(d.set(u,0),d.set(qa(qi(c+h*o)),32),!gd(d,n,i))throw new Error("sign: Invalid signature produced");return d}function gd(e,t,r){const n=pt("signature",e,64),i=pt("message",t),o=pt("publicKey",r,32);try{const s=dd(Rt(o)),a=Rt(n.subarray(0,32));if(!hd(a))return!1;const l=Rt(n.subarray(32,64));if(!Db(l))return!1;const f=pd(qa(a),Gl(s),i),u=Fb(s,l,qi(-f));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const Ys={getPublicKey:qb,sign:jb,verify:gd,utils:{randomPrivateKey:Wl.utils.randomPrivateKey,lift_x:dd,pointToBytes:Gl,numberToBytesBE:cn,bytesToNumberBE:Rt,taggedHash:jo,mod:lt}};/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function zb(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Wb(...e){const t=o=>o,r=(o,s)=>a=>o(s(a)),n=e.map(o=>o.encode).reduceRight(r,t),i=e.map(o=>o.decode).reduce(r,t);return{encode:n,decode:i}}function Gb(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(r=>{if(r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const n=e.indexOf(r);if(n===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return n})}}}function Vb(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of t)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}const vd=(e,t)=>t?vd(t,e%t):e,zo=(e,t)=>e+(t-vd(e,t));function za(e,t,r,n){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(zo(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${zo(t,r)}`);let i=0,o=0;const s=2**r-1,a=[];for(const l of e){if(l>=2**t)throw new Error(`convertRadix2: invalid data word=${l} from=${t}`);if(i=i<<t|l,o+t>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=r;o-=r)a.push((i>>o-r&s)>>>0);i&=2**o-1}if(i=i<<r-o&s,!n&&o>=t)throw new Error("Excess padding");if(!n&&i)throw new Error(`Non-zero padding: ${i}`);return n&&o>0&&a.push(i>>>0),a}function Kb(e,t=!1){if(zo(8,e)>32||zo(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!zb(r))throw new Error("radix2.encode input should be Uint8Array");return za(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(za(r,e,8,t))}}}function Cc(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const Wa=Wb(Gb("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Vb("")),Bc=[996825010,642813549,513874426,1027748829,705979059];function Ei(e){const t=e>>25;let r=(e&33554431)<<5;for(let n=0;n<Bc.length;n++)(t>>n&1)===1&&(r^=Bc[n]);return r}function $c(e,t,r=1){const n=e.length;let i=1;for(let o=0;o<n;o++){const s=e.charCodeAt(o);if(s<33||s>126)throw new Error(`Invalid prefix (${e})`);i=Ei(i)^s>>5}i=Ei(i);for(let o=0;o<n;o++)i=Ei(i)^e.charCodeAt(o)&31;for(let o of t)i=Ei(i)^o;for(let o=0;o<6;o++)i=Ei(i);return i^=r,Wa.encode(za([i%2**30],30,5,!1))}function Zb(e){const r=Kb(5),n=r.decode,i=r.encode,o=Cc(n);function s(u,c,h=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(c)||c.length&&typeof c[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof c}`);if(u.length===0)throw new TypeError(`Invalid prefix length ${u.length}`);const d=u.length+7+c.length;if(h!==!1&&d>h)throw new TypeError(`Length ${d} exceeds limit ${h}`);const p=u.toLowerCase(),g=$c(p,c,1);return`${p}1${Wa.encode(c)}${g}`}function a(u,c=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||c!==!1&&u.length>c)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${c})`);const h=u.toLowerCase();if(u!==h&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");const d=h.lastIndexOf("1");if(d===0||d===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=h.slice(0,d),g=h.slice(d+1);if(g.length<6)throw new Error("Data must be at least 6 characters long");const m=Wa.decode(g).slice(0,-6),v=$c(p,m,1);if(!g.endsWith(v))throw new Error(`Invalid checksum in ${u}: expected "${v}"`);return{prefix:p,words:m}}const l=Cc(a);function f(u){const{prefix:c,words:h}=a(u,!1);return{prefix:c,words:h,bytes:n(h)}}return{encode:s,decode:a,decodeToBytes:f,decodeUnsafe:l,fromWords:n,fromWordsUnsafe:o,toWords:i}}const Uc=Zb(),Xb=new TextEncoder;function Yb(e){return Ho(Do(Xb.encode(e)))}const Kl={sign:(e,t)=>Ho(Ys.sign(e,t)),verify:Ys.verify,getPublicKey:e=>Ho(Ys.getPublicKey(e))};function Qb(e){return Kl.getPublicKey(e)}function md(e){const t=JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]);return Yb(t)}function Jb(e,t){return Kl.sign(e,t)}function ey(e){try{return Kl.verify(e.sig,md(e),e.pubkey)}catch(t){return console.warn("The following error occurred during verify():",t),!1}}function ty(e){const{words:t}=Uc.decode(e),r=new Uint8Array(Uc.fromWords(t));return Ho(r)}function bd(e,t){const r=e.startsWith("nsec1")?ty(e):e,n=Qb(r);return{async signEvent(i){const o={...i,pubkey:i.pubkey??n,tags:[...i.tags??[]],created_at:i.created_at??Math.floor(Date.now()/1e3)};if(ry(o))return o;const s=o.id??md(o),a=o.sig??Jb(s,r);return{...o,id:s,sig:a}},async getPublicKey(){return n}}}function ry(e){if(typeof e.id!="string"||typeof e.sig!="string"||typeof e.kind!="number"||typeof e.pubkey!="string"||typeof e.content!="string"||typeof e.created_at!="number"||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){const r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]=="object")return!1}return!0}const ny=async e=>ey(e),iy="modulepreload",oy=function(e){return"/ehagaki/"+e},kc={},ji=function(t,r,n){let i=Promise.resolve();if(r&&r.length>0){let f=function(u){return Promise.all(u.map(c=>Promise.resolve(c).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};var s=f;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=f(r.map(u=>{if(u=oy(u),u in kc)return;kc[u]=!0;const c=u.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":iy,c||(d.as="script"),d.crossOrigin="",d.href=u,l&&d.setAttribute("nonce",l),document.head.appendChild(d),c)return new Promise((p,g)=>{d.addEventListener("load",p),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})};function sy(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Qs,Mc;function ay(){if(Mc)return Qs;Mc=1;var e=function(A){return t(A)&&!r(A)};function t(v){return!!v&&typeof v=="object"}function r(v){var A=Object.prototype.toString.call(v);return A==="[object RegExp]"||A==="[object Date]"||o(v)}var n=typeof Symbol=="function"&&Symbol.for,i=n?Symbol.for("react.element"):60103;function o(v){return v.$$typeof===i}function s(v){return Array.isArray(v)?[]:{}}function a(v,A){return A.clone!==!1&&A.isMergeableObject(v)?g(s(v),v,A):v}function l(v,A,S){return v.concat(A).map(function(O){return a(O,S)})}function f(v,A){if(!A.customMerge)return g;var S=A.customMerge(v);return typeof S=="function"?S:g}function u(v){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(v).filter(function(A){return Object.propertyIsEnumerable.call(v,A)}):[]}function c(v){return Object.keys(v).concat(u(v))}function h(v,A){try{return A in v}catch{return!1}}function d(v,A){return h(v,A)&&!(Object.hasOwnProperty.call(v,A)&&Object.propertyIsEnumerable.call(v,A))}function p(v,A,S){var O={};return S.isMergeableObject(v)&&c(v).forEach(function(L){O[L]=a(v[L],S)}),c(A).forEach(function(L){d(v,L)||(h(v,L)&&S.isMergeableObject(A[L])?O[L]=f(L,S)(v[L],A[L],S):O[L]=a(A[L],S))}),O}function g(v,A,S){S=S||{},S.arrayMerge=S.arrayMerge||l,S.isMergeableObject=S.isMergeableObject||e,S.cloneUnlessOtherwiseSpecified=a;var O=Array.isArray(A),L=Array.isArray(v),E=O===L;return E?O?S.arrayMerge(v,A,S):p(v,A,S):a(A,S)}g.all=function(A,S){if(!Array.isArray(A))throw new Error("first argument should be an array");return A.reduce(function(O,L){return g(O,L,S)},{})};var m=g;return Qs=m,Qs}var ly=ay();const uy=sy(ly);var Ga=function(e,t){return Ga=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Ga(e,t)};function gs(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Ga(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Re=function(){return Re=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},Re.apply(this,arguments)};function cy(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function Js(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function ea(e,t){var r=t&&t.cache?t.cache:my,n=t&&t.serializer?t.serializer:gy,i=t&&t.strategy?t.strategy:dy;return i(e,{cache:r,serializer:n})}function fy(e){return e==null||typeof e=="number"||typeof e=="boolean"}function hy(e,t,r,n){var i=fy(n)?n:r(n),o=t.get(i);return typeof o>"u"&&(o=e.call(this,n),t.set(i,o)),o}function yd(e,t,r){var n=Array.prototype.slice.call(arguments,3),i=r(n),o=t.get(i);return typeof o>"u"&&(o=e.apply(this,n),t.set(i,o)),o}function wd(e,t,r,n,i){return r.bind(t,e,n,i)}function dy(e,t){var r=e.length===1?hy:yd;return wd(e,this,r,t.cache.create(),t.serializer)}function py(e,t){return wd(e,this,yd,t.cache.create(),t.serializer)}var gy=function(){return JSON.stringify(arguments)},vy=function(){function e(){this.cache=Object.create(null)}return e.prototype.get=function(t){return this.cache[t]},e.prototype.set=function(t,r){this.cache[t]=r},e}(),my={create:function(){return new vy}},ta={variadic:py},ye;(function(e){e[e.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",e[e.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",e[e.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",e[e.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",e[e.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",e[e.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",e[e.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",e[e.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",e[e.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",e[e.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",e[e.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",e[e.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",e[e.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",e[e.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",e[e.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",e[e.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",e[e.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",e[e.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",e[e.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",e[e.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",e[e.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",e[e.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",e[e.INVALID_TAG=23]="INVALID_TAG",e[e.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",e[e.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",e[e.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(ye||(ye={}));var He;(function(e){e[e.literal=0]="literal",e[e.argument=1]="argument",e[e.number=2]="number",e[e.date=3]="date",e[e.time=4]="time",e[e.select=5]="select",e[e.plural=6]="plural",e[e.pound=7]="pound",e[e.tag=8]="tag"})(He||(He={}));var ii;(function(e){e[e.number=0]="number",e[e.dateTime=1]="dateTime"})(ii||(ii={}));function Hc(e){return e.type===He.literal}function by(e){return e.type===He.argument}function Ed(e){return e.type===He.number}function _d(e){return e.type===He.date}function xd(e){return e.type===He.time}function Ad(e){return e.type===He.select}function Sd(e){return e.type===He.plural}function yy(e){return e.type===He.pound}function Td(e){return e.type===He.tag}function Id(e){return!!(e&&typeof e=="object"&&e.type===ii.number)}function Va(e){return!!(e&&typeof e=="object"&&e.type===ii.dateTime)}var Od=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,wy=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function Ey(e){var t={};return e.replace(wy,function(r){var n=r.length;switch(r[0]){case"G":t.era=n===4?"long":n===5?"narrow":"short";break;case"y":t.year=n===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":t.month=["numeric","2-digit","short","long","narrow"][n-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":t.day=["numeric","2-digit"][n-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":t.weekday=n===4?"long":n===5?"narrow":"short";break;case"e":if(n<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");t.weekday=["short","long","narrow","short"][n-4];break;case"c":if(n<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");t.weekday=["short","long","narrow","short"][n-4];break;case"a":t.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":t.hourCycle="h12",t.hour=["numeric","2-digit"][n-1];break;case"H":t.hourCycle="h23",t.hour=["numeric","2-digit"][n-1];break;case"K":t.hourCycle="h11",t.hour=["numeric","2-digit"][n-1];break;case"k":t.hourCycle="h24",t.hour=["numeric","2-digit"][n-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":t.minute=["numeric","2-digit"][n-1];break;case"s":t.second=["numeric","2-digit"][n-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":t.timeZoneName=n<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),t}var _y=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function xy(e){if(e.length===0)throw new Error("Number skeleton cannot be empty");for(var t=e.split(_y).filter(function(h){return h.length>0}),r=[],n=0,i=t;n<i.length;n++){var o=i[n],s=o.split("/");if(s.length===0)throw new Error("Invalid number skeleton");for(var a=s[0],l=s.slice(1),f=0,u=l;f<u.length;f++){var c=u[f];if(c.length===0)throw new Error("Invalid number skeleton")}r.push({stem:a,options:l})}return r}function Ay(e){return e.replace(/^(.*?)-/,"")}var Dc=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,Rd=/^(@+)?(\+|#+)?[rs]?$/g,Sy=/(\*)(0+)|(#+)(0+)|(0+)/g,Ld=/^(0+)$/;function Fc(e){var t={};return e[e.length-1]==="r"?t.roundingPriority="morePrecision":e[e.length-1]==="s"&&(t.roundingPriority="lessPrecision"),e.replace(Rd,function(r,n,i){return typeof i!="string"?(t.minimumSignificantDigits=n.length,t.maximumSignificantDigits=n.length):i==="+"?t.minimumSignificantDigits=n.length:n[0]==="#"?t.maximumSignificantDigits=n.length:(t.minimumSignificantDigits=n.length,t.maximumSignificantDigits=n.length+(typeof i=="string"?i.length:0)),""}),t}function Pd(e){switch(e){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function Ty(e){var t;if(e[0]==="E"&&e[1]==="E"?(t={notation:"engineering"},e=e.slice(2)):e[0]==="E"&&(t={notation:"scientific"},e=e.slice(1)),t){var r=e.slice(0,2);if(r==="+!"?(t.signDisplay="always",e=e.slice(2)):r==="+?"&&(t.signDisplay="exceptZero",e=e.slice(2)),!Ld.test(e))throw new Error("Malformed concise eng/scientific notation");t.minimumIntegerDigits=e.length}return t}function qc(e){var t={},r=Pd(e);return r||t}function Iy(e){for(var t={},r=0,n=e;r<n.length;r++){var i=n[r];switch(i.stem){case"percent":case"%":t.style="percent";continue;case"%x100":t.style="percent",t.scale=100;continue;case"currency":t.style="currency",t.currency=i.options[0];continue;case"group-off":case",_":t.useGrouping=!1;continue;case"precision-integer":case".":t.maximumFractionDigits=0;continue;case"measure-unit":case"unit":t.style="unit",t.unit=Ay(i.options[0]);continue;case"compact-short":case"K":t.notation="compact",t.compactDisplay="short";continue;case"compact-long":case"KK":t.notation="compact",t.compactDisplay="long";continue;case"scientific":t=Re(Re(Re({},t),{notation:"scientific"}),i.options.reduce(function(l,f){return Re(Re({},l),qc(f))},{}));continue;case"engineering":t=Re(Re(Re({},t),{notation:"engineering"}),i.options.reduce(function(l,f){return Re(Re({},l),qc(f))},{}));continue;case"notation-simple":t.notation="standard";continue;case"unit-width-narrow":t.currencyDisplay="narrowSymbol",t.unitDisplay="narrow";continue;case"unit-width-short":t.currencyDisplay="code",t.unitDisplay="short";continue;case"unit-width-full-name":t.currencyDisplay="name",t.unitDisplay="long";continue;case"unit-width-iso-code":t.currencyDisplay="symbol";continue;case"scale":t.scale=parseFloat(i.options[0]);continue;case"rounding-mode-floor":t.roundingMode="floor";continue;case"rounding-mode-ceiling":t.roundingMode="ceil";continue;case"rounding-mode-down":t.roundingMode="trunc";continue;case"rounding-mode-up":t.roundingMode="expand";continue;case"rounding-mode-half-even":t.roundingMode="halfEven";continue;case"rounding-mode-half-down":t.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":t.roundingMode="halfExpand";continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(Sy,function(l,f,u,c,h,d){if(f)t.minimumIntegerDigits=u.length;else{if(c&&h)throw new Error("We currently do not support maximum integer digits");if(d)throw new Error("We currently do not support exact integer digits")}return""});continue}if(Ld.test(i.stem)){t.minimumIntegerDigits=i.stem.length;continue}if(Dc.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(Dc,function(l,f,u,c,h,d){return u==="*"?t.minimumFractionDigits=f.length:c&&c[0]==="#"?t.maximumFractionDigits=c.length:h&&d?(t.minimumFractionDigits=h.length,t.maximumFractionDigits=h.length+d.length):(t.minimumFractionDigits=f.length,t.maximumFractionDigits=f.length),""});var o=i.options[0];o==="w"?t=Re(Re({},t),{trailingZeroDisplay:"stripIfInteger"}):o&&(t=Re(Re({},t),Fc(o)));continue}if(Rd.test(i.stem)){t=Re(Re({},t),Fc(i.stem));continue}var s=Pd(i.stem);s&&(t=Re(Re({},t),s));var a=Ty(i.stem);a&&(t=Re(Re({},t),a))}return t}var ho={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function Oy(e,t){for(var r="",n=0;n<e.length;n++){var i=e.charAt(n);if(i==="j"){for(var o=0;n+1<e.length&&e.charAt(n+1)===i;)o++,n++;var s=1+(o&1),a=o<2?1:3+(o>>1),l="a",f=Ry(t);for((f=="H"||f=="k")&&(a=0);a-- >0;)r+=l;for(;s-- >0;)r=f+r}else i==="J"?r+="H":r+=i}return r}function Ry(e){var t=e.hourCycle;if(t===void 0&&e.hourCycles&&e.hourCycles.length&&(t=e.hourCycles[0]),t)switch(t){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var r=e.language,n;r!=="root"&&(n=e.maximize().region);var i=ho[n||""]||ho[r||""]||ho["".concat(r,"-001")]||ho["001"];return i[0]}var ra,Ly=new RegExp("^".concat(Od.source,"*")),Py=new RegExp("".concat(Od.source,"*$"));function _e(e,t){return{start:e,end:t}}var Ny=!!String.prototype.startsWith&&"_a".startsWith("a",1),Cy=!!String.fromCodePoint,By=!!Object.fromEntries,$y=!!String.prototype.codePointAt,Uy=!!String.prototype.trimStart,ky=!!String.prototype.trimEnd,My=!!Number.isSafeInteger,Hy=My?Number.isSafeInteger:function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e&&Math.abs(e)<=9007199254740991},Ka=!0;try{var Dy=Cd("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");Ka=((ra=Dy.exec("a"))===null||ra===void 0?void 0:ra[0])==="a"}catch{Ka=!1}var jc=Ny?function(t,r,n){return t.startsWith(r,n)}:function(t,r,n){return t.slice(n,n+r.length)===r},Za=Cy?String.fromCodePoint:function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n="",i=t.length,o=0,s;i>o;){if(s=t[o++],s>1114111)throw RangeError(s+" is not a valid code point");n+=s<65536?String.fromCharCode(s):String.fromCharCode(((s-=65536)>>10)+55296,s%1024+56320)}return n},zc=By?Object.fromEntries:function(t){for(var r={},n=0,i=t;n<i.length;n++){var o=i[n],s=o[0],a=o[1];r[s]=a}return r},Nd=$y?function(t,r){return t.codePointAt(r)}:function(t,r){var n=t.length;if(!(r<0||r>=n)){var i=t.charCodeAt(r),o;return i<55296||i>56319||r+1===n||(o=t.charCodeAt(r+1))<56320||o>57343?i:(i-55296<<10)+(o-56320)+65536}},Fy=Uy?function(t){return t.trimStart()}:function(t){return t.replace(Ly,"")},qy=ky?function(t){return t.trimEnd()}:function(t){return t.replace(Py,"")};function Cd(e,t){return new RegExp(e,t)}var Xa;if(Ka){var Wc=Cd("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");Xa=function(t,r){var n;Wc.lastIndex=r;var i=Wc.exec(t);return(n=i[1])!==null&&n!==void 0?n:""}}else Xa=function(t,r){for(var n=[];;){var i=Nd(t,r);if(i===void 0||Bd(i)||Gy(i))break;n.push(i),r+=i>=65536?2:1}return Za.apply(void 0,n)};var jy=function(){function e(t,r){r===void 0&&(r={}),this.message=t,this.position={offset:0,line:1,column:1},this.ignoreTag=!!r.ignoreTag,this.locale=r.locale,this.requiresOtherClause=!!r.requiresOtherClause,this.shouldParseSkeletons=!!r.shouldParseSkeletons}return e.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},e.prototype.parseMessage=function(t,r,n){for(var i=[];!this.isEOF();){var o=this.char();if(o===123){var s=this.parseArgument(t,n);if(s.err)return s;i.push(s.val)}else{if(o===125&&t>0)break;if(o===35&&(r==="plural"||r==="selectordinal")){var a=this.clonePosition();this.bump(),i.push({type:He.pound,location:_e(a,this.clonePosition())})}else if(o===60&&!this.ignoreTag&&this.peek()===47){if(n)break;return this.error(ye.UNMATCHED_CLOSING_TAG,_e(this.clonePosition(),this.clonePosition()))}else if(o===60&&!this.ignoreTag&&Ya(this.peek()||0)){var s=this.parseTag(t,r);if(s.err)return s;i.push(s.val)}else{var s=this.parseLiteral(t,r);if(s.err)return s;i.push(s.val)}}}return{val:i,err:null}},e.prototype.parseTag=function(t,r){var n=this.clonePosition();this.bump();var i=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:He.literal,value:"<".concat(i,"/>"),location:_e(n,this.clonePosition())},err:null};if(this.bumpIf(">")){var o=this.parseMessage(t+1,r,!0);if(o.err)return o;var s=o.val,a=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!Ya(this.char()))return this.error(ye.INVALID_TAG,_e(a,this.clonePosition()));var l=this.clonePosition(),f=this.parseTagName();return i!==f?this.error(ye.UNMATCHED_CLOSING_TAG,_e(l,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:He.tag,value:i,children:s,location:_e(n,this.clonePosition())},err:null}:this.error(ye.INVALID_TAG,_e(a,this.clonePosition())))}else return this.error(ye.UNCLOSED_TAG,_e(n,this.clonePosition()))}else return this.error(ye.INVALID_TAG,_e(n,this.clonePosition()))},e.prototype.parseTagName=function(){var t=this.offset();for(this.bump();!this.isEOF()&&Wy(this.char());)this.bump();return this.message.slice(t,this.offset())},e.prototype.parseLiteral=function(t,r){for(var n=this.clonePosition(),i="";;){var o=this.tryParseQuote(r);if(o){i+=o;continue}var s=this.tryParseUnquoted(t,r);if(s){i+=s;continue}var a=this.tryParseLeftAngleBracket();if(a){i+=a;continue}break}var l=_e(n,this.clonePosition());return{val:{type:He.literal,value:i,location:l},err:null}},e.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!zy(this.peek()||0))?(this.bump(),"<"):null},e.prototype.tryParseQuote=function(t){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(t==="plural"||t==="selectordinal")break;return null;default:return null}this.bump();var r=[this.char()];for(this.bump();!this.isEOF();){var n=this.char();if(n===39)if(this.peek()===39)r.push(39),this.bump();else{this.bump();break}else r.push(n);this.bump()}return Za.apply(void 0,r)},e.prototype.tryParseUnquoted=function(t,r){if(this.isEOF())return null;var n=this.char();return n===60||n===123||n===35&&(r==="plural"||r==="selectordinal")||n===125&&t>0?null:(this.bump(),Za(n))},e.prototype.parseArgument=function(t,r){var n=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(ye.EXPECT_ARGUMENT_CLOSING_BRACE,_e(n,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(ye.EMPTY_ARGUMENT,_e(n,this.clonePosition()));var i=this.parseIdentifierIfPossible().value;if(!i)return this.error(ye.MALFORMED_ARGUMENT,_e(n,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(ye.EXPECT_ARGUMENT_CLOSING_BRACE,_e(n,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:He.argument,value:i,location:_e(n,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(ye.EXPECT_ARGUMENT_CLOSING_BRACE,_e(n,this.clonePosition())):this.parseArgumentOptions(t,r,i,n);default:return this.error(ye.MALFORMED_ARGUMENT,_e(n,this.clonePosition()))}},e.prototype.parseIdentifierIfPossible=function(){var t=this.clonePosition(),r=this.offset(),n=Xa(this.message,r),i=r+n.length;this.bumpTo(i);var o=this.clonePosition(),s=_e(t,o);return{value:n,location:s}},e.prototype.parseArgumentOptions=function(t,r,n,i){var o,s=this.clonePosition(),a=this.parseIdentifierIfPossible().value,l=this.clonePosition();switch(a){case"":return this.error(ye.EXPECT_ARGUMENT_TYPE,_e(s,l));case"number":case"date":case"time":{this.bumpSpace();var f=null;if(this.bumpIf(",")){this.bumpSpace();var u=this.clonePosition(),c=this.parseSimpleArgStyleIfPossible();if(c.err)return c;var h=qy(c.val);if(h.length===0)return this.error(ye.EXPECT_ARGUMENT_STYLE,_e(this.clonePosition(),this.clonePosition()));var d=_e(u,this.clonePosition());f={style:h,styleLocation:d}}var p=this.tryParseArgumentClose(i);if(p.err)return p;var g=_e(i,this.clonePosition());if(f&&jc(f?.style,"::",0)){var m=Fy(f.style.slice(2));if(a==="number"){var c=this.parseNumberSkeletonFromString(m,f.styleLocation);return c.err?c:{val:{type:He.number,value:n,location:g,style:c.val},err:null}}else{if(m.length===0)return this.error(ye.EXPECT_DATE_TIME_SKELETON,g);var v=m;this.locale&&(v=Oy(m,this.locale));var h={type:ii.dateTime,pattern:v,location:f.styleLocation,parsedOptions:this.shouldParseSkeletons?Ey(v):{}},A=a==="date"?He.date:He.time;return{val:{type:A,value:n,location:g,style:h},err:null}}}return{val:{type:a==="number"?He.number:a==="date"?He.date:He.time,value:n,location:g,style:(o=f?.style)!==null&&o!==void 0?o:null},err:null}}case"plural":case"selectordinal":case"select":{var S=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(ye.EXPECT_SELECT_ARGUMENT_OPTIONS,_e(S,Re({},S)));this.bumpSpace();var O=this.parseIdentifierIfPossible(),L=0;if(a!=="select"&&O.value==="offset"){if(!this.bumpIf(":"))return this.error(ye.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,_e(this.clonePosition(),this.clonePosition()));this.bumpSpace();var c=this.tryParseDecimalInteger(ye.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,ye.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(c.err)return c;this.bumpSpace(),O=this.parseIdentifierIfPossible(),L=c.val}var E=this.tryParsePluralOrSelectOptions(t,a,r,O);if(E.err)return E;var p=this.tryParseArgumentClose(i);if(p.err)return p;var I=_e(i,this.clonePosition());return a==="select"?{val:{type:He.select,value:n,options:zc(E.val),location:I},err:null}:{val:{type:He.plural,value:n,options:zc(E.val),offset:L,pluralType:a==="plural"?"cardinal":"ordinal",location:I},err:null}}default:return this.error(ye.INVALID_ARGUMENT_TYPE,_e(s,l))}},e.prototype.tryParseArgumentClose=function(t){return this.isEOF()||this.char()!==125?this.error(ye.EXPECT_ARGUMENT_CLOSING_BRACE,_e(t,this.clonePosition())):(this.bump(),{val:!0,err:null})},e.prototype.parseSimpleArgStyleIfPossible=function(){for(var t=0,r=this.clonePosition();!this.isEOF();){var n=this.char();switch(n){case 39:{this.bump();var i=this.clonePosition();if(!this.bumpUntil("'"))return this.error(ye.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,_e(i,this.clonePosition()));this.bump();break}case 123:{t+=1,this.bump();break}case 125:{if(t>0)t-=1;else return{val:this.message.slice(r.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(r.offset,this.offset()),err:null}},e.prototype.parseNumberSkeletonFromString=function(t,r){var n=[];try{n=xy(t)}catch{return this.error(ye.INVALID_NUMBER_SKELETON,r)}return{val:{type:ii.number,tokens:n,location:r,parsedOptions:this.shouldParseSkeletons?Iy(n):{}},err:null}},e.prototype.tryParsePluralOrSelectOptions=function(t,r,n,i){for(var o,s=!1,a=[],l=new Set,f=i.value,u=i.location;;){if(f.length===0){var c=this.clonePosition();if(r!=="select"&&this.bumpIf("=")){var h=this.tryParseDecimalInteger(ye.EXPECT_PLURAL_ARGUMENT_SELECTOR,ye.INVALID_PLURAL_ARGUMENT_SELECTOR);if(h.err)return h;u=_e(c,this.clonePosition()),f=this.message.slice(c.offset,this.offset())}else break}if(l.has(f))return this.error(r==="select"?ye.DUPLICATE_SELECT_ARGUMENT_SELECTOR:ye.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,u);f==="other"&&(s=!0),this.bumpSpace();var d=this.clonePosition();if(!this.bumpIf("{"))return this.error(r==="select"?ye.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:ye.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,_e(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(t+1,r,n);if(p.err)return p;var g=this.tryParseArgumentClose(d);if(g.err)return g;a.push([f,{value:p.val,location:_e(d,this.clonePosition())}]),l.add(f),this.bumpSpace(),o=this.parseIdentifierIfPossible(),f=o.value,u=o.location}return a.length===0?this.error(r==="select"?ye.EXPECT_SELECT_ARGUMENT_SELECTOR:ye.EXPECT_PLURAL_ARGUMENT_SELECTOR,_e(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!s?this.error(ye.MISSING_OTHER_CLAUSE,_e(this.clonePosition(),this.clonePosition())):{val:a,err:null}},e.prototype.tryParseDecimalInteger=function(t,r){var n=1,i=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(n=-1);for(var o=!1,s=0;!this.isEOF();){var a=this.char();if(a>=48&&a<=57)o=!0,s=s*10+(a-48),this.bump();else break}var l=_e(i,this.clonePosition());return o?(s*=n,Hy(s)?{val:s,err:null}:this.error(r,l)):this.error(t,l)},e.prototype.offset=function(){return this.position.offset},e.prototype.isEOF=function(){return this.offset()===this.message.length},e.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},e.prototype.char=function(){var t=this.position.offset;if(t>=this.message.length)throw Error("out of bound");var r=Nd(this.message,t);if(r===void 0)throw Error("Offset ".concat(t," is at invalid UTF-16 code unit boundary"));return r},e.prototype.error=function(t,r){return{val:null,err:{kind:t,message:this.message,location:r}}},e.prototype.bump=function(){if(!this.isEOF()){var t=this.char();t===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=t<65536?1:2)}},e.prototype.bumpIf=function(t){if(jc(this.message,t,this.offset())){for(var r=0;r<t.length;r++)this.bump();return!0}return!1},e.prototype.bumpUntil=function(t){var r=this.offset(),n=this.message.indexOf(t,r);return n>=0?(this.bumpTo(n),!0):(this.bumpTo(this.message.length),!1)},e.prototype.bumpTo=function(t){if(this.offset()>t)throw Error("targetOffset ".concat(t," must be greater than or equal to the current offset ").concat(this.offset()));for(t=Math.min(t,this.message.length);;){var r=this.offset();if(r===t)break;if(r>t)throw Error("targetOffset ".concat(t," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},e.prototype.bumpSpace=function(){for(;!this.isEOF()&&Bd(this.char());)this.bump()},e.prototype.peek=function(){if(this.isEOF())return null;var t=this.char(),r=this.offset(),n=this.message.charCodeAt(r+(t>=65536?2:1));return n??null},e}();function Ya(e){return e>=97&&e<=122||e>=65&&e<=90}function zy(e){return Ya(e)||e===47}function Wy(e){return e===45||e===46||e>=48&&e<=57||e===95||e>=97&&e<=122||e>=65&&e<=90||e==183||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8255&&e<=8256||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function Bd(e){return e>=9&&e<=13||e===32||e===133||e>=8206&&e<=8207||e===8232||e===8233}function Gy(e){return e>=33&&e<=35||e===36||e>=37&&e<=39||e===40||e===41||e===42||e===43||e===44||e===45||e>=46&&e<=47||e>=58&&e<=59||e>=60&&e<=62||e>=63&&e<=64||e===91||e===92||e===93||e===94||e===96||e===123||e===124||e===125||e===126||e===161||e>=162&&e<=165||e===166||e===167||e===169||e===171||e===172||e===174||e===176||e===177||e===182||e===187||e===191||e===215||e===247||e>=8208&&e<=8213||e>=8214&&e<=8215||e===8216||e===8217||e===8218||e>=8219&&e<=8220||e===8221||e===8222||e===8223||e>=8224&&e<=8231||e>=8240&&e<=8248||e===8249||e===8250||e>=8251&&e<=8254||e>=8257&&e<=8259||e===8260||e===8261||e===8262||e>=8263&&e<=8273||e===8274||e===8275||e>=8277&&e<=8286||e>=8592&&e<=8596||e>=8597&&e<=8601||e>=8602&&e<=8603||e>=8604&&e<=8607||e===8608||e>=8609&&e<=8610||e===8611||e>=8612&&e<=8613||e===8614||e>=8615&&e<=8621||e===8622||e>=8623&&e<=8653||e>=8654&&e<=8655||e>=8656&&e<=8657||e===8658||e===8659||e===8660||e>=8661&&e<=8691||e>=8692&&e<=8959||e>=8960&&e<=8967||e===8968||e===8969||e===8970||e===8971||e>=8972&&e<=8991||e>=8992&&e<=8993||e>=8994&&e<=9e3||e===9001||e===9002||e>=9003&&e<=9083||e===9084||e>=9085&&e<=9114||e>=9115&&e<=9139||e>=9140&&e<=9179||e>=9180&&e<=9185||e>=9186&&e<=9254||e>=9255&&e<=9279||e>=9280&&e<=9290||e>=9291&&e<=9311||e>=9472&&e<=9654||e===9655||e>=9656&&e<=9664||e===9665||e>=9666&&e<=9719||e>=9720&&e<=9727||e>=9728&&e<=9838||e===9839||e>=9840&&e<=10087||e===10088||e===10089||e===10090||e===10091||e===10092||e===10093||e===10094||e===10095||e===10096||e===10097||e===10098||e===10099||e===10100||e===10101||e>=10132&&e<=10175||e>=10176&&e<=10180||e===10181||e===10182||e>=10183&&e<=10213||e===10214||e===10215||e===10216||e===10217||e===10218||e===10219||e===10220||e===10221||e===10222||e===10223||e>=10224&&e<=10239||e>=10240&&e<=10495||e>=10496&&e<=10626||e===10627||e===10628||e===10629||e===10630||e===10631||e===10632||e===10633||e===10634||e===10635||e===10636||e===10637||e===10638||e===10639||e===10640||e===10641||e===10642||e===10643||e===10644||e===10645||e===10646||e===10647||e===10648||e>=10649&&e<=10711||e===10712||e===10713||e===10714||e===10715||e>=10716&&e<=10747||e===10748||e===10749||e>=10750&&e<=11007||e>=11008&&e<=11055||e>=11056&&e<=11076||e>=11077&&e<=11078||e>=11079&&e<=11084||e>=11085&&e<=11123||e>=11124&&e<=11125||e>=11126&&e<=11157||e===11158||e>=11159&&e<=11263||e>=11776&&e<=11777||e===11778||e===11779||e===11780||e===11781||e>=11782&&e<=11784||e===11785||e===11786||e===11787||e===11788||e===11789||e>=11790&&e<=11798||e===11799||e>=11800&&e<=11801||e===11802||e===11803||e===11804||e===11805||e>=11806&&e<=11807||e===11808||e===11809||e===11810||e===11811||e===11812||e===11813||e===11814||e===11815||e===11816||e===11817||e>=11818&&e<=11822||e===11823||e>=11824&&e<=11833||e>=11834&&e<=11835||e>=11836&&e<=11839||e===11840||e===11841||e===11842||e>=11843&&e<=11855||e>=11856&&e<=11857||e===11858||e>=11859&&e<=11903||e>=12289&&e<=12291||e===12296||e===12297||e===12298||e===12299||e===12300||e===12301||e===12302||e===12303||e===12304||e===12305||e>=12306&&e<=12307||e===12308||e===12309||e===12310||e===12311||e===12312||e===12313||e===12314||e===12315||e===12316||e===12317||e>=12318&&e<=12319||e===12320||e===12336||e===64830||e===64831||e>=65093&&e<=65094}function Qa(e){e.forEach(function(t){if(delete t.location,Ad(t)||Sd(t))for(var r in t.options)delete t.options[r].location,Qa(t.options[r].value);else Ed(t)&&Id(t.style)||(_d(t)||xd(t))&&Va(t.style)?delete t.style.location:Td(t)&&Qa(t.children)})}function Vy(e,t){t===void 0&&(t={}),t=Re({shouldParseSkeletons:!0,requiresOtherClause:!0},t);var r=new jy(e,t).parse();if(r.err){var n=SyntaxError(ye[r.err.kind]);throw n.location=r.err.location,n.originalMessage=r.err.message,n}return t?.captureLocation||Qa(r.val),r.val}var oi;(function(e){e.MISSING_VALUE="MISSING_VALUE",e.INVALID_VALUE="INVALID_VALUE",e.MISSING_INTL_API="MISSING_INTL_API"})(oi||(oi={}));var vs=function(e){gs(t,e);function t(r,n,i){var o=e.call(this,r)||this;return o.code=n,o.originalMessage=i,o}return t.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},t}(Error),Gc=function(e){gs(t,e);function t(r,n,i,o){return e.call(this,'Invalid values for "'.concat(r,'": "').concat(n,'". Options are "').concat(Object.keys(i).join('", "'),'"'),oi.INVALID_VALUE,o)||this}return t}(vs),Ky=function(e){gs(t,e);function t(r,n,i){return e.call(this,'Value for "'.concat(r,'" must be of type ').concat(n),oi.INVALID_VALUE,i)||this}return t}(vs),Zy=function(e){gs(t,e);function t(r,n){return e.call(this,'The intl string context variable "'.concat(r,'" was not provided to the string "').concat(n,'"'),oi.MISSING_VALUE,n)||this}return t}(vs),wt;(function(e){e[e.literal=0]="literal",e[e.object=1]="object"})(wt||(wt={}));function Xy(e){return e.length<2?e:e.reduce(function(t,r){var n=t[t.length-1];return!n||n.type!==wt.literal||r.type!==wt.literal?t.push(r):n.value+=r.value,t},[])}function Yy(e){return typeof e=="function"}function _o(e,t,r,n,i,o,s){if(e.length===1&&Hc(e[0]))return[{type:wt.literal,value:e[0].value}];for(var a=[],l=0,f=e;l<f.length;l++){var u=f[l];if(Hc(u)){a.push({type:wt.literal,value:u.value});continue}if(yy(u)){typeof o=="number"&&a.push({type:wt.literal,value:r.getNumberFormat(t).format(o)});continue}var c=u.value;if(!(i&&c in i))throw new Zy(c,s);var h=i[c];if(by(u)){(!h||typeof h=="string"||typeof h=="number")&&(h=typeof h=="string"||typeof h=="number"?String(h):""),a.push({type:typeof h=="string"?wt.literal:wt.object,value:h});continue}if(_d(u)){var d=typeof u.style=="string"?n.date[u.style]:Va(u.style)?u.style.parsedOptions:void 0;a.push({type:wt.literal,value:r.getDateTimeFormat(t,d).format(h)});continue}if(xd(u)){var d=typeof u.style=="string"?n.time[u.style]:Va(u.style)?u.style.parsedOptions:n.time.medium;a.push({type:wt.literal,value:r.getDateTimeFormat(t,d).format(h)});continue}if(Ed(u)){var d=typeof u.style=="string"?n.number[u.style]:Id(u.style)?u.style.parsedOptions:void 0;d&&d.scale&&(h=h*(d.scale||1)),a.push({type:wt.literal,value:r.getNumberFormat(t,d).format(h)});continue}if(Td(u)){var p=u.children,g=u.value,m=i[g];if(!Yy(m))throw new Ky(g,"function",s);var v=_o(p,t,r,n,i,o),A=m(v.map(function(L){return L.value}));Array.isArray(A)||(A=[A]),a.push.apply(a,A.map(function(L){return{type:typeof L=="string"?wt.literal:wt.object,value:L}}))}if(Ad(u)){var S=u.options[h]||u.options.other;if(!S)throw new Gc(u.value,h,Object.keys(u.options),s);a.push.apply(a,_o(S.value,t,r,n,i));continue}if(Sd(u)){var S=u.options["=".concat(h)];if(!S){if(!Intl.PluralRules)throw new vs(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,oi.MISSING_INTL_API,s);var O=r.getPluralRules(t,{type:u.pluralType}).select(h-(u.offset||0));S=u.options[O]||u.options.other}if(!S)throw new Gc(u.value,h,Object.keys(u.options),s);a.push.apply(a,_o(S.value,t,r,n,i,h-(u.offset||0)));continue}}return Xy(a)}function Qy(e,t){return t?Re(Re(Re({},e||{}),t||{}),Object.keys(e).reduce(function(r,n){return r[n]=Re(Re({},e[n]),t[n]||{}),r},{})):e}function Jy(e,t){return t?Object.keys(e).reduce(function(r,n){return r[n]=Qy(e[n],t[n]),r},Re({},e)):e}function na(e){return{create:function(){return{get:function(t){return e[t]},set:function(t,r){e[t]=r}}}}}function ew(e){return e===void 0&&(e={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:ea(function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return new((t=Intl.NumberFormat).bind.apply(t,Js([void 0],r,!1)))},{cache:na(e.number),strategy:ta.variadic}),getDateTimeFormat:ea(function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return new((t=Intl.DateTimeFormat).bind.apply(t,Js([void 0],r,!1)))},{cache:na(e.dateTime),strategy:ta.variadic}),getPluralRules:ea(function(){for(var t,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return new((t=Intl.PluralRules).bind.apply(t,Js([void 0],r,!1)))},{cache:na(e.pluralRules),strategy:ta.variadic})}}var $d=function(){function e(t,r,n,i){r===void 0&&(r=e.defaultLocale);var o=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(l){var f=o.formatToParts(l);if(f.length===1)return f[0].value;var u=f.reduce(function(c,h){return!c.length||h.type!==wt.literal||typeof c[c.length-1]!="string"?c.push(h.value):c[c.length-1]+=h.value,c},[]);return u.length<=1?u[0]||"":u},this.formatToParts=function(l){return _o(o.ast,o.locales,o.formatters,o.formats,l,void 0,o.message)},this.resolvedOptions=function(){var l;return{locale:((l=o.resolvedLocale)===null||l===void 0?void 0:l.toString())||Intl.NumberFormat.supportedLocalesOf(o.locales)[0]}},this.getAst=function(){return o.ast},this.locales=r,this.resolvedLocale=e.resolveLocale(r),typeof t=="string"){if(this.message=t,!e.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var s=i||{};s.formatters;var a=cy(s,["formatters"]);this.ast=e.__parse(t,Re(Re({},a),{locale:this.resolvedLocale}))}else this.ast=t;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=Jy(e.formats,n),this.formatters=i&&i.formatters||ew(this.formatterCache)}return Object.defineProperty(e,"defaultLocale",{get:function(){return e.memoizedDefaultLocale||(e.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),e.memoizedDefaultLocale},enumerable:!1,configurable:!0}),e.memoizedDefaultLocale=null,e.resolveLocale=function(t){if(!(typeof Intl.Locale>"u")){var r=Intl.NumberFormat.supportedLocalesOf(t);return r.length>0?new Intl.Locale(r[0]):new Intl.Locale(typeof t=="string"?t:t[0])}},e.__parse=Vy,e.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},e}();function tw(e,t){if(t==null)return;if(t in e)return e[t];const r=t.split(".");let n=e;for(let i=0;i<r.length;i++)if(typeof n=="object"){if(i>0){const o=r.slice(i,r.length).join(".");if(o in n){n=n[o];break}}n=n[r[i]]}else n=void 0;return n}const nn={},rw=(e,t,r)=>r&&(t in nn||(nn[t]={}),e in nn[t]||(nn[t][e]=r),r),Ud=(e,t)=>{if(t==null)return;if(t in nn&&e in nn[t])return nn[t][e];const r=so(t);for(let n=0;n<r.length;n++){const i=r[n],o=iw(i,e);if(o)return rw(e,t,o)}};let Zl;const pi=Bt({});function nw(e){return Zl[e]||null}function Xl(e){return e in Zl}function iw(e,t){if(!Xl(e))return null;const r=nw(e);return tw(r,t)}function ow(e){if(e==null)return;const t=so(e);for(let r=0;r<t.length;r++){const n=t[r];if(Xl(n))return n}}function sw(e,...t){delete nn[e],pi.update(r=>(r[e]=uy.all([r[e]||{},...t]),r))}$r([pi],([e])=>Object.keys(e));pi.subscribe(e=>Zl=e);const $i={};function aw(e){$i[e]=new Set}function lw(e,t){$i[e].delete(t),$i[e].size===0&&delete $i[e]}function Ui(e){return $i[e]}function uw(e){return so(e).map(t=>{const r=Ui(t);return[t,r?[...r]:[]]}).filter(([,t])=>t.length>0)}function Wo(e){return e==null?!1:so(e).some(t=>{var r;return(r=Ui(t))==null?void 0:r.size})}function cw(e,t){return Promise.all(t.map(n=>(lw(e,n),n().then(i=>i.default||i)))).then(n=>sw(e,...n))}const _i={};function kd(e){if(!Wo(e))return e in _i?_i[e]:Promise.resolve();const t=uw(e);return _i[e]=Promise.all(t.map(([r,n])=>cw(r,n))).then(()=>{if(Wo(e))return kd(e);delete _i[e]}),_i[e]}function Md(e,t){Ui(e)||aw(e);const r=Ui(e);Ui(e).has(t)||(Xl(e)||pi.update(n=>(n[e]={},n)),r.add(t))}var Vc=Object.getOwnPropertySymbols,fw=Object.prototype.hasOwnProperty,hw=Object.prototype.propertyIsEnumerable,dw=(e,t)=>{var r={};for(var n in e)fw.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&Vc)for(var n of Vc(e))t.indexOf(n)<0&&hw.call(e,n)&&(r[n]=e[n]);return r};const pw={number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};function gw({locale:e,id:t}){console.warn(`[svelte-i18n] The message "${t}" was not found in "${so(e).join('", "')}".${Wo(pn())?`

Note: there are at least one loader still registered to this locale that wasn't executed.`:""}`)}const vw={fallbackLocale:null,loadingDelay:200,formats:pw,warnOnMissingMessages:!0,handleMissingMessage:void 0,ignoreTag:!0},Ni=vw;function si(){return Ni}function mw(e){const t=e,{formats:r}=t,n=dw(t,["formats"]);let i=e.fallbackLocale;if(e.initialLocale)try{$d.resolveLocale(e.initialLocale)&&(i=e.initialLocale)}catch{console.warn(`[svelte-i18n] The initial locale "${e.initialLocale}" is not a valid locale.`)}return n.warnOnMissingMessages&&(delete n.warnOnMissingMessages,n.handleMissingMessage==null?n.handleMissingMessage=gw:console.warn('[svelte-i18n] The "warnOnMissingMessages" option is deprecated. Please use the "handleMissingMessage" option instead.')),Object.assign(Ni,n,{initialLocale:i}),r&&("number"in r&&Object.assign(Ni.formats.number,r.number),"date"in r&&Object.assign(Ni.formats.date,r.date),"time"in r&&Object.assign(Ni.formats.time,r.time)),gr.set(i)}const ia=Bt(!1);var bw=Object.defineProperty,yw=Object.defineProperties,ww=Object.getOwnPropertyDescriptors,Kc=Object.getOwnPropertySymbols,Ew=Object.prototype.hasOwnProperty,_w=Object.prototype.propertyIsEnumerable,Zc=(e,t,r)=>t in e?bw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,xw=(e,t)=>{for(var r in t||(t={}))Ew.call(t,r)&&Zc(e,r,t[r]);if(Kc)for(var r of Kc(t))_w.call(t,r)&&Zc(e,r,t[r]);return e},Aw=(e,t)=>yw(e,ww(t));let Ja;const Go=Bt(null);function Xc(e){return e.split("-").map((t,r,n)=>n.slice(0,r+1).join("-")).reverse()}function so(e,t=si().fallbackLocale){const r=Xc(e);return t?[...new Set([...r,...Xc(t)])]:r}function pn(){return Ja??void 0}Go.subscribe(e=>{Ja=e??void 0,typeof window<"u"&&e!=null&&document.documentElement.setAttribute("lang",e)});const Sw=e=>{if(e&&ow(e)&&Wo(e)){const{loadingDelay:t}=si();let r;return typeof window<"u"&&pn()!=null&&t?r=window.setTimeout(()=>ia.set(!0),t):ia.set(!0),kd(e).then(()=>{Go.set(e)}).finally(()=>{clearTimeout(r),ia.set(!1)})}return Go.set(e)},gr=Aw(xw({},Go),{set:Sw}),Tw=()=>typeof window>"u"?null:window.navigator.language||window.navigator.languages[0],ms=e=>{const t=Object.create(null);return n=>{const i=JSON.stringify(n);return i in t?t[i]:t[i]=e(n)}};var Iw=Object.defineProperty,Vo=Object.getOwnPropertySymbols,Hd=Object.prototype.hasOwnProperty,Dd=Object.prototype.propertyIsEnumerable,Yc=(e,t,r)=>t in e?Iw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Yl=(e,t)=>{for(var r in t||(t={}))Hd.call(t,r)&&Yc(e,r,t[r]);if(Vo)for(var r of Vo(t))Dd.call(t,r)&&Yc(e,r,t[r]);return e},gi=(e,t)=>{var r={};for(var n in e)Hd.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&Vo)for(var n of Vo(e))t.indexOf(n)<0&&Dd.call(e,n)&&(r[n]=e[n]);return r};const zi=(e,t)=>{const{formats:r}=si();if(e in r&&t in r[e])return r[e][t];throw new Error(`[svelte-i18n] Unknown "${t}" ${e} format.`)},Ow=ms(e=>{var t=e,{locale:r,format:n}=t,i=gi(t,["locale","format"]);if(r==null)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return n&&(i=zi("number",n)),new Intl.NumberFormat(r,i)}),Rw=ms(e=>{var t=e,{locale:r,format:n}=t,i=gi(t,["locale","format"]);if(r==null)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return n?i=zi("date",n):Object.keys(i).length===0&&(i=zi("date","short")),new Intl.DateTimeFormat(r,i)}),Lw=ms(e=>{var t=e,{locale:r,format:n}=t,i=gi(t,["locale","format"]);if(r==null)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return n?i=zi("time",n):Object.keys(i).length===0&&(i=zi("time","short")),new Intl.DateTimeFormat(r,i)}),Pw=(e={})=>{var t=e,{locale:r=pn()}=t,n=gi(t,["locale"]);return Ow(Yl({locale:r},n))},Nw=(e={})=>{var t=e,{locale:r=pn()}=t,n=gi(t,["locale"]);return Rw(Yl({locale:r},n))},Cw=(e={})=>{var t=e,{locale:r=pn()}=t,n=gi(t,["locale"]);return Lw(Yl({locale:r},n))},Bw=ms((e,t=pn())=>new $d(e,t,si().formats,{ignoreTag:si().ignoreTag})),$w=(e,t={})=>{var r,n,i,o;let s=t;typeof e=="object"&&(s=e,e=s.id);const{values:a,locale:l=pn(),default:f}=s;if(l==null)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let u=Ud(e,l);if(!u)u=(o=(i=(n=(r=si()).handleMissingMessage)==null?void 0:n.call(r,{locale:l,id:e,defaultValue:f}))!=null?i:f)!=null?o:e;else if(typeof u!="string")return console.warn(`[svelte-i18n] Message with id "${e}" must be of type "string", found: "${typeof u}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),u;if(!a)return u;let c=u;try{c=Bw(u,l).format(a)}catch(h){h instanceof Error&&console.warn(`[svelte-i18n] Message "${e}" has syntax error:`,h.message)}return c},Uw=(e,t)=>Cw(t).format(e),kw=(e,t)=>Nw(t).format(e),Mw=(e,t)=>Pw(t).format(e),Hw=(e,t=pn())=>Ud(e,t),gn=$r([gr,pi],()=>$w);$r([gr],()=>Uw);$r([gr],()=>kw);$r([gr],()=>Mw);$r([gr,pi],()=>Hw);Md("ja",()=>ji(()=>import("./ja-B-yPquCW.js"),[]));Md("en",()=>ji(()=>import("./en-DWyeATfV.js"),[]));const po=localStorage.getItem("locale"),Qc=Tw(),Dw=po&&(po==="ja"||po==="en")?po:Qc&&Qc.startsWith("ja")?"ja":"en";mw({fallbackLocale:"ja",initialLocale:Dw});function Fw(e){return`npub1${e.slice(0,10)}...`}function oa(e,t){return{name:e?.name||"",picture:e?.picture||"",npub:e?.name?void 0:Fw(t)}}class qw{constructor(t){this.rxNostr=t}saveToLocalStorage(t,r){try{localStorage.setItem(`nostr-profile-${t}`,JSON.stringify(r)),console.log("ãã­ãã£ã¼ã«æå ±ãã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",t)}catch(n){console.error("ãã­ãã£ã¼ã«æå ±ã®ä¿å­ã«å¤±æ:",n)}}getFromLocalStorage(t){try{const r=localStorage.getItem(`nostr-profile-${t}`);if(!r)return null;const n=JSON.parse(r);return oa(n,t)}catch(r){return console.error("ãã­ãã£ã¼ã«æå ±ã®åå¾ã«å¤±æ:",r),null}}async fetchProfileData(t){const r=this.getFromLocalStorage(t);return r||new Promise(n=>{const i=Eo();let o=!1;const s=this.rxNostr.use(i).subscribe(a=>{if(a.event?.kind===0&&a.event.pubkey===t){o=!0;try{const l=JSON.parse(a.event.content),f=oa(l,t);console.log("Kind 0ãããã­ãã£ã¼ã«æå ±ãåå¾:",f),this.saveToLocalStorage(t,f),s.unsubscribe(),n(f)}catch(l){console.error("Kind 0ã®ãã¼ã¹ã¨ã©ã¼:",l)}}});i.emit({authors:[t],kinds:[0]}),setTimeout(()=>{s.unsubscribe(),o||n(oa({},t))},3e3)})}}var jw=xe("<button><!></button>");function it(e,t){let r=we(t,"className",8,""),n=we(t,"disabled",8,!1),i=we(t,"type",8,"button"),o=we(t,"ariaLabel",8,""),s=we(t,"style",8,"");var a=jw(),l=se(a);bh(l,t,"default",{}),Te(()=>{Tn(a,"type",i()),Nl(a,1,ev(r()),"svelte-hl68x0"),a.disabled=n(),Tn(a,"aria-label",o()),wh(a,s())}),ur("click",a,function(f){xh.call(this,t,f)}),re(e,a)}var zw=xe('<div class="profile-picture placeholder svelte-mite2q" aria-label="Loading"></div> <span class="profile-name placeholder-text svelte-mite2q"> </span>',1),Ww=xe('<img class="profile-picture svelte-mite2q"/>'),Gw=xe('<div class="profile-picture default svg-icon svelte-mite2q" aria-label="User"></div>'),Vw=xe('<!> <span class="profile-name svelte-mite2q"> </span>',1);function Kw(e,t){Yt(t,!1);const[r,n]=dn(),i=()=>It(gn,"$_",r);let o=we(t,"profileData",8,null);const s=!1;let a=we(t,"hasStoredKey",8,!1),l=we(t,"showLogoutDialog",8),f=we(t,"isLoadingProfile",8,!1);const u=()=>o()?.name?o().name:o()?.npub?o().npub:"User",c=()=>o()?.name&&o().name!==""?o().name:o()?.npub?o().npub:"User";Dr();var h=Zt(),d=rt(h);{var p=m=>{{let v=Ct(()=>`profile-display btn-round${f()?" loading":""}`);it(m,{get className(){return H(v)},get disabled(){return f()},$$events:{click:()=>{f()||l()()}},children:(A,S)=>{var O=Zt(),L=rt(O);{var E=y=>{var x=zw(),R=pe(rt(x),2),T=se(R);Te(P=>Le(T,P),[()=>(i(),X(()=>i()("loading")))]),re(y,x)},I=y=>{var x=Vw(),R=rt(x);{var T=_=>{var b=Ww();Te(w=>{Tn(b,"src",(Ve(o()),X(()=>o().picture))),Tn(b,"alt",w)},[()=>X(u)]),re(_,b)},P=_=>{var b=Gw();re(_,b)};Be(R,_=>{Ve(o()),X(()=>o()?.picture)?_(T):_(P,!1)})}var C=pe(R,2),N=se(C);Te(_=>Le(N,_),[()=>X(c)]),re(y,x)};Be(L,y=>{f()?y(E):y(I,!1)})}re(A,O)},$$slots:{default:!0}})}};Be(d,m=>{a()&&m(p)})}re(e,h),Bi(t,"profileLoaded",s);var g=Qt({profileLoaded:s});return n(),g}const Ql=Bt({info:null,visible:!1}),Fd={type:"none",isAuthenticated:!1,pubkey:"",npub:"",nprofile:"",isValid:!1},Wi=Bt(Fd);function qd(e){Wi.update(t=>({...t,...e,isAuthenticated:e.type!=="none"&&(e.isValid??t.isValid)}))}function Zw(){Wi.set(Fd)}function Xw(e,t,r){qd({type:"nsec",pubkey:e,npub:t,nprofile:r,isValid:!0})}function Yw(e,t,r){qd({type:"nostr-login",pubkey:e,npub:t,nprofile:r,isValid:!0})}function Jc(e,t=3e3){Ql.set({info:e,visible:!0})}function Qw(){Ql.set({info:null,visible:!1})}const ki=Bt({file:null,metadata:void 0,received:!1});function ef(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function jd(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Jw(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ef(e.outputLen),ef(e.blockLen)}function Ko(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function e1(e,t){jd(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const sa=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const zd=e=>e instanceof Uint8Array,aa=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ir=(e,t)=>e<<32-t|e>>>t,t1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!t1)throw new Error("Non little-endian hardware is not supported");function r1(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Jl(e){if(typeof e=="string"&&(e=r1(e)),!zd(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function n1(...e){const t=new Uint8Array(e.reduce((n,i)=>n+i.length,0));let r=0;return e.forEach(n=>{if(!zd(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}let Wd=class{clone(){return this._cloneInto()}};function i1(e){const t=n=>e().update(Jl(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Gd(e=32){if(sa&&typeof sa.getRandomValues=="function")return sa.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function o1(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const i=BigInt(32),o=BigInt(4294967295),s=Number(r>>i&o),a=Number(r&o),l=n?4:0,f=n?0:4;e.setUint32(t+l,s,n),e.setUint32(t+f,a,n)}let s1=class extends Wd{constructor(t,r,n,i){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=aa(this.buffer)}update(t){Ko(this);const{view:r,buffer:n,blockLen:i}=this;t=Jl(t);const o=t.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const l=aa(t);for(;i<=o-s;s+=i)this.process(l,s);continue}n.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ko(this),e1(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:o}=this;let{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let c=s;c<i;c++)r[c]=0;o1(n,i-8,BigInt(this.length*8),o),this.process(n,0);const a=aa(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=l/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<f;c++)a.setUint32(4*c,u[c],o)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return t.length=i,t.pos=a,t.finished=o,t.destroyed=s,i%r&&t.buffer.set(n),t}};const a1=(e,t,r)=>e&t^~e&r,l1=(e,t,r)=>e&t^e&r^t&r,u1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Yr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qr=new Uint32Array(64);let c1=class extends s1{constructor(){super(64,32,8,!1),this.A=Yr[0]|0,this.B=Yr[1]|0,this.C=Yr[2]|0,this.D=Yr[3]|0,this.E=Yr[4]|0,this.F=Yr[5]|0,this.G=Yr[6]|0,this.H=Yr[7]|0}get(){const{A:t,B:r,C:n,D:i,E:o,F:s,G:a,H:l}=this;return[t,r,n,i,o,s,a,l]}set(t,r,n,i,o,s,a,l){this.A=t|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=l|0}process(t,r){for(let c=0;c<16;c++,r+=4)Qr[c]=t.getUint32(r,!1);for(let c=16;c<64;c++){const h=Qr[c-15],d=Qr[c-2],p=ir(h,7)^ir(h,18)^h>>>3,g=ir(d,17)^ir(d,19)^d>>>10;Qr[c]=g+Qr[c-7]+p+Qr[c-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:l,G:f,H:u}=this;for(let c=0;c<64;c++){const h=ir(a,6)^ir(a,11)^ir(a,25),d=u+h+a1(a,l,f)+u1[c]+Qr[c]|0,g=(ir(n,2)^ir(n,13)^ir(n,22))+l1(n,i,o)|0;u=f,f=l,l=a,a=s+d|0,s=o,o=i,i=n,n=d+g|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,l=l+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,o,s,a,l,f,u)}roundClean(){Qr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const el=i1(()=>new c1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Vd=BigInt(0),bs=BigInt(1),f1=BigInt(2),ys=e=>e instanceof Uint8Array,h1=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ai(e){if(!ys(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=h1[e[r]];return t}function Kd(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function eu(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function li(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let n=0;n<r.length;n++){const i=n*2,o=e.slice(i,i+2),s=Number.parseInt(o,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");r[n]=s}return r}function Lt(e){return eu(ai(e))}function tu(e){if(!ys(e))throw new Error("Uint8Array expected");return eu(ai(Uint8Array.from(e).reverse()))}function fn(e,t){return li(e.toString(16).padStart(t*2,"0"))}function ru(e,t){return fn(e,t).reverse()}function d1(e){return li(Kd(e))}function gt(e,t,r){let n;if(typeof t=="string")try{n=li(t)}catch(o){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${o}`)}else if(ys(t))n=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(`${e} expected ${r} bytes, got ${i}`);return n}function Rn(...e){const t=new Uint8Array(e.reduce((n,i)=>n+i.length,0));let r=0;return e.forEach(n=>{if(!ys(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}function p1(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function g1(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function v1(e){let t;for(t=0;e>Vd;e>>=bs,t+=1);return t}function m1(e,t){return e>>BigInt(t)&bs}const b1=(e,t,r)=>e|(r?bs:Vd)<<BigInt(t),nu=e=>(f1<<BigInt(e-1))-bs,la=e=>new Uint8Array(e),tf=e=>Uint8Array.from(e);function Zd(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=la(e),i=la(e),o=0;const s=()=>{n.fill(1),i.fill(0),o=0},a=(...c)=>r(i,n,...c),l=(c=la())=>{i=a(tf([0]),c),n=a(),c.length!==0&&(i=a(tf([1]),c),n=a())},f=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let c=0;const h=[];for(;c<t;){n=a();const d=n.slice();h.push(d),c+=n.length}return Rn(...h)};return(c,h)=>{s(),l(c);let d;for(;!(d=h(f()));)l();return s(),d}}const y1={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function ao(e,t,r={}){const n=(i,o,s)=>{const a=y1[o];if(typeof a!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=e[i];if(!(s&&l===void 0)&&!a(l,e))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${o}`)};for(const[i,o]of Object.entries(t))n(i,o,!1);for(const[i,o]of Object.entries(r))n(i,o,!0);return e}const w1=Object.freeze(Object.defineProperty({__proto__:null,bitGet:m1,bitLen:v1,bitMask:nu,bitSet:b1,bytesToHex:ai,bytesToNumberBE:Lt,bytesToNumberLE:tu,concatBytes:Rn,createHmacDrbg:Zd,ensureBytes:gt,equalBytes:p1,hexToBytes:li,hexToNumber:eu,numberToBytesBE:fn,numberToBytesLE:ru,numberToHexUnpadded:Kd,numberToVarBytesBE:d1,utf8ToBytes:g1,validateObject:ao},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ot=BigInt(0),Ze=BigInt(1),bn=BigInt(2),E1=BigInt(3),tl=BigInt(4),rf=BigInt(5),nf=BigInt(8);BigInt(9);BigInt(16);function ut(e,t){const r=e%t;return r>=ot?r:t+r}function _1(e,t,r){if(r<=ot||t<ot)throw new Error("Expected power/modulo > 0");if(r===Ze)return ot;let n=Ze;for(;t>ot;)t&Ze&&(n=n*e%r),e=e*e%r,t>>=Ze;return n}function kt(e,t,r){let n=e;for(;t-- >ot;)n*=n,n%=r;return n}function rl(e,t){if(e===ot||t<=ot)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=ut(e,t),n=t,i=ot,o=Ze;for(;r!==ot;){const a=n/r,l=n%r,f=i-o*a;n=r,r=l,i=o,o=f}if(n!==Ze)throw new Error("invert: does not exist");return ut(i,t)}function x1(e){const t=(e-Ze)/bn;let r,n,i;for(r=e-Ze,n=0;r%bn===ot;r/=bn,n++);for(i=bn;i<e&&_1(i,t,e)!==e-Ze;i++);if(n===1){const s=(e+Ze)/tl;return function(l,f){const u=l.pow(f,s);if(!l.eql(l.sqr(u),f))throw new Error("Cannot find square root");return u}}const o=(r+Ze)/bn;return function(a,l){if(a.pow(l,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let f=n,u=a.pow(a.mul(a.ONE,i),r),c=a.pow(l,o),h=a.pow(l,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let d=1;for(let g=a.sqr(h);d<f&&!a.eql(g,a.ONE);d++)g=a.sqr(g);const p=a.pow(u,Ze<<BigInt(f-d-1));u=a.sqr(p),c=a.mul(c,p),h=a.mul(h,u),f=d}return c}}function A1(e){if(e%tl===E1){const t=(e+Ze)/tl;return function(n,i){const o=n.pow(i,t);if(!n.eql(n.sqr(o),i))throw new Error("Cannot find square root");return o}}if(e%nf===rf){const t=(e-rf)/nf;return function(n,i){const o=n.mul(i,bn),s=n.pow(o,t),a=n.mul(i,s),l=n.mul(n.mul(a,bn),s),f=n.mul(a,n.sub(l,n.ONE));if(!n.eql(n.sqr(f),i))throw new Error("Cannot find square root");return f}}return x1(e)}const S1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function T1(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=S1.reduce((n,i)=>(n[i]="function",n),t);return ao(e,r)}function I1(e,t,r){if(r<ot)throw new Error("Expected power > 0");if(r===ot)return e.ONE;if(r===Ze)return t;let n=e.ONE,i=t;for(;r>ot;)r&Ze&&(n=e.mul(n,i)),i=e.sqr(i),r>>=Ze;return n}function O1(e,t){const r=new Array(t.length),n=t.reduce((o,s,a)=>e.is0(s)?o:(r[a]=o,e.mul(o,s)),e.ONE),i=e.inv(n);return t.reduceRight((o,s,a)=>e.is0(s)?o:(r[a]=e.mul(o,r[a]),e.mul(o,s)),i),r}function Xd(e,t){const r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function R1(e,t,r=!1,n={}){if(e<=ot)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:o}=Xd(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=A1(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:nu(i),ZERO:ot,ONE:Ze,create:l=>ut(l,e),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return ot<=l&&l<e},is0:l=>l===ot,isOdd:l=>(l&Ze)===Ze,neg:l=>ut(-l,e),eql:(l,f)=>l===f,sqr:l=>ut(l*l,e),add:(l,f)=>ut(l+f,e),sub:(l,f)=>ut(l-f,e),mul:(l,f)=>ut(l*f,e),pow:(l,f)=>I1(a,l,f),div:(l,f)=>ut(l*rl(f,e),e),sqrN:l=>l*l,addN:(l,f)=>l+f,subN:(l,f)=>l-f,mulN:(l,f)=>l*f,inv:l=>rl(l,e),sqrt:n.sqrt||(l=>s(a,l)),invertBatch:l=>O1(a,l),cmov:(l,f,u)=>u?f:l,toBytes:l=>r?ru(l,o):fn(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return r?tu(l):Lt(l)}});return Object.freeze(a)}function Yd(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Qd(e){const t=Yd(e);return t+Math.ceil(t/2)}function L1(e,t,r=!1){const n=e.length,i=Yd(t),o=Qd(t);if(n<16||n<o||n>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${n}`);const s=r?Lt(e):tu(e),a=ut(s,t-Ze)+Ze;return r?ru(a,i):fn(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const P1=BigInt(0),ua=BigInt(1);function N1(e,t){const r=(i,o)=>{const s=o.negate();return i?s:o},n=i=>{const o=Math.ceil(t/i)+1,s=2**(i-1);return{windows:o,windowSize:s}};return{constTimeNegate:r,unsafeLadder(i,o){let s=e.ZERO,a=i;for(;o>P1;)o&ua&&(s=s.add(a)),a=a.double(),o>>=ua;return s},precomputeWindow(i,o){const{windows:s,windowSize:a}=n(o),l=[];let f=i,u=f;for(let c=0;c<s;c++){u=f,l.push(u);for(let h=1;h<a;h++)u=u.add(f),l.push(u);f=u.double()}return l},wNAF(i,o,s){const{windows:a,windowSize:l}=n(i);let f=e.ZERO,u=e.BASE;const c=BigInt(2**i-1),h=2**i,d=BigInt(i);for(let p=0;p<a;p++){const g=p*l;let m=Number(s&c);s>>=d,m>l&&(m-=h,s+=ua);const v=g,A=g+Math.abs(m)-1,S=p%2!==0,O=m<0;m===0?u=u.add(r(S,o[v])):f=f.add(r(O,o[A]))}return{p:f,f:u}},wNAFCached(i,o,s,a){const l=i._WINDOW_SIZE||1;let f=o.get(i);return f||(f=this.precomputeWindow(i,l),l!==1&&o.set(i,a(f))),this.wNAF(l,f,s)}}}function Jd(e){return T1(e.Fp),ao(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Xd(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function C1(e){const t=Jd(e);ao(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=t;if(r){if(!n.eql(i,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:B1,hexToBytes:$1}=w1,wn={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=wn;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const r=e[1],n=e.subarray(2,r+2);if(!r||n.length!==r)throw new t("Invalid signature integer: wrong length");if(n[0]&128)throw new t("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:B1(n),l:e.subarray(r+2)}},toSig(e){const{Err:t}=wn,r=typeof e=="string"?$1(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let n=r.length;if(n<2||r[0]!=48)throw new t("Invalid signature tag");if(r[1]!==n-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=wn._parseInt(r.subarray(2)),{d:s,l:a}=wn._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s}},hexFromSig(e){const t=f=>Number.parseInt(f[0],16)&8?"00"+f:f,r=f=>{const u=f.toString(16);return u.length&1?`0${u}`:u},n=t(r(e.s)),i=t(r(e.r)),o=n.length/2,s=i.length/2,a=r(o),l=r(s);return`30${r(s+o+4)}02${l}${i}02${a}${n}`}},Lr=BigInt(0),Dt=BigInt(1);BigInt(2);const of=BigInt(3);BigInt(4);function U1(e){const t=C1(e),{Fp:r}=t,n=t.toBytes||((p,g,m)=>{const v=g.toAffine();return Rn(Uint8Array.from([4]),r.toBytes(v.x),r.toBytes(v.y))}),i=t.fromBytes||(p=>{const g=p.subarray(1),m=r.fromBytes(g.subarray(0,r.BYTES)),v=r.fromBytes(g.subarray(r.BYTES,2*r.BYTES));return{x:m,y:v}});function o(p){const{a:g,b:m}=t,v=r.sqr(p),A=r.mul(v,p);return r.add(r.add(A,r.mul(p,g)),m)}if(!r.eql(r.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(p){return typeof p=="bigint"&&Lr<p&&p<t.n}function a(p){if(!s(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:v,n:A}=t;if(g&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=ai(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(m*2,"0")}let S;try{S=typeof p=="bigint"?p:Lt(gt("private key",p,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof p}`)}return v&&(S=ut(S,A)),a(S),S}const f=new Map;function u(p){if(!(p instanceof c))throw new Error("ProjectivePoint expected")}class c{constructor(g,m,v){if(this.px=g,this.py=m,this.pz=v,g==null||!r.isValid(g))throw new Error("x required");if(m==null||!r.isValid(m))throw new Error("y required");if(v==null||!r.isValid(v))throw new Error("z required")}static fromAffine(g){const{x:m,y:v}=g||{};if(!g||!r.isValid(m)||!r.isValid(v))throw new Error("invalid affine point");if(g instanceof c)throw new Error("projective point not allowed");const A=S=>r.eql(S,r.ZERO);return A(m)&&A(v)?c.ZERO:new c(m,v,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const m=r.invertBatch(g.map(v=>v.pz));return g.map((v,A)=>v.toAffine(m[A])).map(c.fromAffine)}static fromHex(g){const m=c.fromAffine(i(gt("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return c.BASE.multiply(l(g))}_setWindowSize(g){this._WINDOW_SIZE=g,f.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:m}=this.toAffine();if(!r.isValid(g)||!r.isValid(m))throw new Error("bad point: x or y not FE");const v=r.sqr(m),A=o(g);if(!r.eql(v,A))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(r.isOdd)return!r.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:m,py:v,pz:A}=this,{px:S,py:O,pz:L}=g,E=r.eql(r.mul(m,L),r.mul(S,A)),I=r.eql(r.mul(v,L),r.mul(O,A));return E&&I}negate(){return new c(this.px,r.neg(this.py),this.pz)}double(){const{a:g,b:m}=t,v=r.mul(m,of),{px:A,py:S,pz:O}=this;let L=r.ZERO,E=r.ZERO,I=r.ZERO,y=r.mul(A,A),x=r.mul(S,S),R=r.mul(O,O),T=r.mul(A,S);return T=r.add(T,T),I=r.mul(A,O),I=r.add(I,I),L=r.mul(g,I),E=r.mul(v,R),E=r.add(L,E),L=r.sub(x,E),E=r.add(x,E),E=r.mul(L,E),L=r.mul(T,L),I=r.mul(v,I),R=r.mul(g,R),T=r.sub(y,R),T=r.mul(g,T),T=r.add(T,I),I=r.add(y,y),y=r.add(I,y),y=r.add(y,R),y=r.mul(y,T),E=r.add(E,y),R=r.mul(S,O),R=r.add(R,R),y=r.mul(R,T),L=r.sub(L,y),I=r.mul(R,x),I=r.add(I,I),I=r.add(I,I),new c(L,E,I)}add(g){u(g);const{px:m,py:v,pz:A}=this,{px:S,py:O,pz:L}=g;let E=r.ZERO,I=r.ZERO,y=r.ZERO;const x=t.a,R=r.mul(t.b,of);let T=r.mul(m,S),P=r.mul(v,O),C=r.mul(A,L),N=r.add(m,v),_=r.add(S,O);N=r.mul(N,_),_=r.add(T,P),N=r.sub(N,_),_=r.add(m,A);let b=r.add(S,L);return _=r.mul(_,b),b=r.add(T,C),_=r.sub(_,b),b=r.add(v,A),E=r.add(O,L),b=r.mul(b,E),E=r.add(P,C),b=r.sub(b,E),y=r.mul(x,_),E=r.mul(R,C),y=r.add(E,y),E=r.sub(P,y),y=r.add(P,y),I=r.mul(E,y),P=r.add(T,T),P=r.add(P,T),C=r.mul(x,C),_=r.mul(R,_),P=r.add(P,C),C=r.sub(T,C),C=r.mul(x,C),_=r.add(_,C),T=r.mul(P,_),I=r.add(I,T),T=r.mul(b,_),E=r.mul(N,E),E=r.sub(E,T),T=r.mul(N,P),y=r.mul(b,y),y=r.add(y,T),new c(E,I,y)}subtract(g){return this.add(g.negate())}is0(){return this.equals(c.ZERO)}wNAF(g){return d.wNAFCached(this,f,g,m=>{const v=r.invertBatch(m.map(A=>A.pz));return m.map((A,S)=>A.toAffine(v[S])).map(c.fromAffine)})}multiplyUnsafe(g){const m=c.ZERO;if(g===Lr)return m;if(a(g),g===Dt)return this;const{endo:v}=t;if(!v)return d.unsafeLadder(this,g);let{k1neg:A,k1:S,k2neg:O,k2:L}=v.splitScalar(g),E=m,I=m,y=this;for(;S>Lr||L>Lr;)S&Dt&&(E=E.add(y)),L&Dt&&(I=I.add(y)),y=y.double(),S>>=Dt,L>>=Dt;return A&&(E=E.negate()),O&&(I=I.negate()),I=new c(r.mul(I.px,v.beta),I.py,I.pz),E.add(I)}multiply(g){a(g);let m=g,v,A;const{endo:S}=t;if(S){const{k1neg:O,k1:L,k2neg:E,k2:I}=S.splitScalar(m);let{p:y,f:x}=this.wNAF(L),{p:R,f:T}=this.wNAF(I);y=d.constTimeNegate(O,y),R=d.constTimeNegate(E,R),R=new c(r.mul(R.px,S.beta),R.py,R.pz),v=y.add(R),A=x.add(T)}else{const{p:O,f:L}=this.wNAF(m);v=O,A=L}return c.normalizeZ([v,A])[0]}multiplyAndAddUnsafe(g,m,v){const A=c.BASE,S=(L,E)=>E===Lr||E===Dt||!L.equals(A)?L.multiplyUnsafe(E):L.multiply(E),O=S(this,m).add(S(g,v));return O.is0()?void 0:O}toAffine(g){const{px:m,py:v,pz:A}=this,S=this.is0();g==null&&(g=S?r.ONE:r.inv(A));const O=r.mul(m,g),L=r.mul(v,g),E=r.mul(A,g);if(S)return{x:r.ZERO,y:r.ZERO};if(!r.eql(E,r.ONE))throw new Error("invZ was invalid");return{x:O,y:L}}isTorsionFree(){const{h:g,isTorsionFree:m}=t;if(g===Dt)return!0;if(m)return m(c,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:m}=t;return g===Dt?this:m?m(c,this):this.multiplyUnsafe(t.h)}toRawBytes(g=!0){return this.assertValidity(),n(c,this,g)}toHex(g=!0){return ai(this.toRawBytes(g))}}c.BASE=new c(t.Gx,t.Gy,r.ONE),c.ZERO=new c(r.ZERO,r.ONE,r.ZERO);const h=t.nBitLength,d=N1(c,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:s}}function k1(e){const t=Jd(e);return ao(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function M1(e){const t=k1(e),{Fp:r,n}=t,i=r.BYTES+1,o=2*r.BYTES+1;function s(_){return Lr<_&&_<r.ORDER}function a(_){return ut(_,n)}function l(_){return rl(_,n)}const{ProjectivePoint:f,normPrivateKeyToScalar:u,weierstrassEquation:c,isWithinCurveOrder:h}=U1({...t,toBytes(_,b,w){const k=b.toAffine(),B=r.toBytes(k.x),U=Rn;return w?U(Uint8Array.from([b.hasEvenY()?2:3]),B):U(Uint8Array.from([4]),B,r.toBytes(k.y))},fromBytes(_){const b=_.length,w=_[0],k=_.subarray(1);if(b===i&&(w===2||w===3)){const B=Lt(k);if(!s(B))throw new Error("Point is not on curve");const U=c(B);let F=r.sqrt(U);const D=(F&Dt)===Dt;return(w&1)===1!==D&&(F=r.neg(F)),{x:B,y:F}}else if(b===o&&w===4){const B=r.fromBytes(k.subarray(0,r.BYTES)),U=r.fromBytes(k.subarray(r.BYTES,2*r.BYTES));return{x:B,y:U}}else throw new Error(`Point of length ${b} was invalid. Expected ${i} compressed bytes or ${o} uncompressed bytes`)}}),d=_=>ai(fn(_,t.nByteLength));function p(_){const b=n>>Dt;return _>b}function g(_){return p(_)?a(-_):_}const m=(_,b,w)=>Lt(_.slice(b,w));class v{constructor(b,w,k){this.r=b,this.s=w,this.recovery=k,this.assertValidity()}static fromCompact(b){const w=t.nByteLength;return b=gt("compactSignature",b,w*2),new v(m(b,0,w),m(b,w,2*w))}static fromDER(b){const{r:w,s:k}=wn.toSig(gt("DER",b));return new v(w,k)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(b){return new v(this.r,this.s,b)}recoverPublicKey(b){const{r:w,s:k,recovery:B}=this,U=I(gt("msgHash",b));if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");const F=B===2||B===3?w+t.n:w;if(F>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const D=(B&1)===0?"02":"03",j=f.fromHex(D+d(F)),q=l(F),M=a(-U*q),Z=a(k*q),ae=f.BASE.multiplyAndAddUnsafe(j,M,Z);if(!ae)throw new Error("point at infinify");return ae.assertValidity(),ae}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return li(this.toDERHex())}toDERHex(){return wn.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return li(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const A={isValidPrivateKey(_){try{return u(_),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const _=Qd(t.n);return L1(t.randomBytes(_),t.n)},precompute(_=8,b=f.BASE){return b._setWindowSize(_),b.multiply(BigInt(3)),b}};function S(_,b=!0){return f.fromPrivateKey(_).toRawBytes(b)}function O(_){const b=_ instanceof Uint8Array,w=typeof _=="string",k=(b||w)&&_.length;return b?k===i||k===o:w?k===2*i||k===2*o:_ instanceof f}function L(_,b,w=!0){if(O(_))throw new Error("first arg must be private key");if(!O(b))throw new Error("second arg must be public key");return f.fromHex(b).multiply(u(_)).toRawBytes(w)}const E=t.bits2int||function(_){const b=Lt(_),w=_.length*8-t.nBitLength;return w>0?b>>BigInt(w):b},I=t.bits2int_modN||function(_){return a(E(_))},y=nu(t.nBitLength);function x(_){if(typeof _!="bigint")throw new Error("bigint expected");if(!(Lr<=_&&_<y))throw new Error(`bigint expected < 2^${t.nBitLength}`);return fn(_,t.nByteLength)}function R(_,b,w=T){if(["recovered","canonical"].some(V=>V in w))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:B}=t;let{lowS:U,prehash:F,extraEntropy:D}=w;U==null&&(U=!0),_=gt("msgHash",_),F&&(_=gt("prehashed msgHash",k(_)));const j=I(_),q=u(b),M=[x(q),x(j)];if(D!=null){const V=D===!0?B(r.BYTES):D;M.push(gt("extraEntropy",V))}const Z=Rn(...M),ae=j;function he(V){const J=E(V);if(!h(J))return;const ie=l(J),Y=f.BASE.multiply(J).toAffine(),K=a(Y.x);if(K===Lr)return;const ce=a(ie*a(ae+K*q));if(ce===Lr)return;let oe=(Y.x===K?0:2)|Number(Y.y&Dt),ve=ce;return U&&p(ce)&&(ve=g(ce),oe^=1),new v(K,ve,oe)}return{seed:Z,k2sig:he}}const T={lowS:t.lowS,prehash:!1},P={lowS:t.lowS,prehash:!1};function C(_,b,w=T){const{seed:k,k2sig:B}=R(_,b,w),U=t;return Zd(U.hash.outputLen,U.nByteLength,U.hmac)(k,B)}f.BASE._setWindowSize(8);function N(_,b,w,k=P){const B=_;if(b=gt("msgHash",b),w=gt("publicKey",w),"strict"in k)throw new Error("options.strict was renamed to lowS");const{lowS:U,prehash:F}=k;let D,j;try{if(typeof B=="string"||B instanceof Uint8Array)try{D=v.fromDER(B)}catch(Y){if(!(Y instanceof wn.Err))throw Y;D=v.fromCompact(B)}else if(typeof B=="object"&&typeof B.r=="bigint"&&typeof B.s=="bigint"){const{r:Y,s:K}=B;D=new v(Y,K)}else throw new Error("PARSE");j=f.fromHex(w)}catch(Y){if(Y.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(U&&D.hasHighS())return!1;F&&(b=t.hash(b));const{r:q,s:M}=D,Z=I(b),ae=l(M),he=a(Z*ae),V=a(q*ae),J=f.BASE.multiplyAndAddUnsafe(j,he,V)?.toAffine();return J?a(J.x)===q:!1}return{CURVE:t,getPublicKey:S,getSharedSecret:L,sign:C,verify:N,ProjectivePoint:f,Signature:v,utils:A}}let ep=class extends Wd{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,Jw(t);const n=Jl(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(n.length>i?t.create().update(n).digest():n);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(t){return Ko(this),this.iHash.update(t),this}digestInto(t){Ko(this),jd(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:o,blockLen:s,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=o,t.blockLen=s,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const tp=(e,t,r)=>new ep(e,t).update(r).digest();tp.create=(e,t)=>new ep(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function H1(e){return{hash:e,hmac:(t,...r)=>tp(e,t,n1(...r)),randomBytes:Gd}}function D1(e,t){const r=n=>M1({...e,...H1(n)});return Object.freeze({...r(t),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ws=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Zo=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),rp=BigInt(1),Xo=BigInt(2),sf=(e,t)=>(e+t/Xo)/t;function np(e){const t=ws,r=BigInt(3),n=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),l=BigInt(88),f=e*e*e%t,u=f*f*e%t,c=kt(u,r,t)*u%t,h=kt(c,r,t)*u%t,d=kt(h,Xo,t)*f%t,p=kt(d,i,t)*d%t,g=kt(p,o,t)*p%t,m=kt(g,a,t)*g%t,v=kt(m,l,t)*m%t,A=kt(v,a,t)*g%t,S=kt(A,r,t)*u%t,O=kt(S,s,t)*p%t,L=kt(O,n,t)*f%t,E=kt(L,Xo,t);if(!nl.eql(nl.sqr(E),e))throw new Error("Cannot find square root");return E}const nl=R1(ws,void 0,void 0,{sqrt:np}),vi=D1({a:BigInt(0),b:BigInt(7),Fp:nl,n:Zo,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Zo,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-rp*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=r,s=BigInt("0x100000000000000000000000000000000"),a=sf(o*e,t),l=sf(-n*e,t);let f=ut(e-a*r-l*i,t),u=ut(-a*n-l*o,t);const c=f>s,h=u>s;if(c&&(f=t-f),h&&(u=t-u),f>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:c,k1:f,k2neg:h,k2:u}}}},el),Es=BigInt(0),ip=e=>typeof e=="bigint"&&Es<e&&e<ws,F1=e=>typeof e=="bigint"&&Es<e&&e<Zo,af={};function Yo(e,...t){let r=af[e];if(r===void 0){const n=el(Uint8Array.from(e,i=>i.charCodeAt(0)));r=Rn(n,n),af[e]=r}return el(Rn(r,...t))}const iu=e=>e.toRawBytes(!0).slice(1),il=e=>fn(e,32),ca=e=>ut(e,ws),Gi=e=>ut(e,Zo),ou=vi.ProjectivePoint,q1=(e,t,r)=>ou.BASE.multiplyAndAddUnsafe(e,t,r);function ol(e){let t=vi.utils.normPrivateKeyToScalar(e),r=ou.fromPrivateKey(t);return{scalar:r.hasEvenY()?t:Gi(-t),bytes:iu(r)}}function op(e){if(!ip(e))throw new Error("bad x: need 0 < x < p");const t=ca(e*e),r=ca(t*e+BigInt(7));let n=np(r);n%Xo!==Es&&(n=ca(-n));const i=new ou(e,n,rp);return i.assertValidity(),i}function sp(...e){return Gi(Lt(Yo("BIP0340/challenge",...e)))}function j1(e){return ol(e).bytes}function z1(e,t,r=Gd(32)){const n=gt("message",e),{bytes:i,scalar:o}=ol(t),s=gt("auxRand",r,32),a=il(o^Lt(Yo("BIP0340/aux",s))),l=Yo("BIP0340/nonce",a,i,n),f=Gi(Lt(l));if(f===Es)throw new Error("sign failed: k is zero");const{bytes:u,scalar:c}=ol(f),h=sp(u,i,n),d=new Uint8Array(64);if(d.set(u,0),d.set(il(Gi(c+h*o)),32),!ap(d,n,i))throw new Error("sign: Invalid signature produced");return d}function ap(e,t,r){const n=gt("signature",e,64),i=gt("message",t),o=gt("publicKey",r,32);try{const s=op(Lt(o)),a=Lt(n.subarray(0,32));if(!ip(a))return!1;const l=Lt(n.subarray(32,64));if(!F1(l))return!1;const f=sp(il(a),iu(s),i),u=q1(s,l,Gi(-f));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const xi={getPublicKey:j1,sign:z1,verify:ap,utils:{randomPrivateKey:vi.utils.randomPrivateKey,lift_x:op,pointToBytes:iu,numberToBytesBE:fn,bytesToNumberBE:Lt,taggedHash:Yo,mod:ut}},fa=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const su=e=>e instanceof Uint8Array,ha=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),or=(e,t)=>e<<32-t|e>>>t,W1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!W1)throw new Error("Non little-endian hardware is not supported");const G1=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function vt(e){if(!su(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=G1[e[r]];return t}function Ln(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let n=0;n<r.length;n++){const i=n*2,o=e.slice(i,i+2),s=Number.parseInt(o,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");r[n]=s}return r}function V1(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Vi(e){if(typeof e=="string"&&(e=V1(e)),!su(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function _s(...e){const t=new Uint8Array(e.reduce((n,i)=>n+i.length,0));let r=0;return e.forEach(n=>{if(!su(n))throw new Error("Uint8Array expected");t.set(n,r),r+=n.length}),t}class lp{clone(){return this._cloneInto()}}function up(e){const t=n=>e().update(Vi(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function cp(e=32){if(fa&&typeof fa.getRandomValues=="function")return fa.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function sl(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function K1(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function fp(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Z1(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");sl(e.outputLen),sl(e.blockLen)}function X1(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Y1(e,t){fp(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const cr={number:sl,bool:K1,bytes:fp,hash:Z1,exists:X1,output:Y1};function Q1(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);const i=BigInt(32),o=BigInt(4294967295),s=Number(r>>i&o),a=Number(r&o),l=n?4:0,f=n?0:4;e.setUint32(t+l,s,n),e.setUint32(t+f,a,n)}class J1 extends lp{constructor(t,r,n,i){super(),this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=ha(this.buffer)}update(t){cr.exists(this);const{view:r,buffer:n,blockLen:i}=this;t=Vi(t);const o=t.length;for(let s=0;s<o;){const a=Math.min(i-this.pos,o-s);if(a===i){const l=ha(t);for(;i<=o-s;s+=i)this.process(l,s);continue}n.set(t.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){cr.exists(this),cr.output(t,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:o}=this;let{pos:s}=this;r[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let c=s;c<i;c++)r[c]=0;Q1(n,i-8,BigInt(this.length*8),o),this.process(n,0);const a=ha(t),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=l/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<f;c++)a.setUint32(4*c,u[c],o)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return t.length=i,t.pos=a,t.finished=o,t.destroyed=s,i%r&&t.buffer.set(n),t}}const e2=(e,t,r)=>e&t^~e&r,t2=(e,t,r)=>e&t^e&r^t&r,r2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Jr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),en=new Uint32Array(64);class hp extends J1{constructor(){super(64,32,8,!1),this.A=Jr[0]|0,this.B=Jr[1]|0,this.C=Jr[2]|0,this.D=Jr[3]|0,this.E=Jr[4]|0,this.F=Jr[5]|0,this.G=Jr[6]|0,this.H=Jr[7]|0}get(){const{A:t,B:r,C:n,D:i,E:o,F:s,G:a,H:l}=this;return[t,r,n,i,o,s,a,l]}set(t,r,n,i,o,s,a,l){this.A=t|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=l|0}process(t,r){for(let c=0;c<16;c++,r+=4)en[c]=t.getUint32(r,!1);for(let c=16;c<64;c++){const h=en[c-15],d=en[c-2],p=or(h,7)^or(h,18)^h>>>3,g=or(d,17)^or(d,19)^d>>>10;en[c]=g+en[c-7]+p+en[c-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:l,G:f,H:u}=this;for(let c=0;c<64;c++){const h=or(a,6)^or(a,11)^or(a,25),d=u+h+e2(a,l,f)+r2[c]+en[c]|0,g=(or(n,2)^or(n,13)^or(n,22))+t2(n,i,o)|0;u=f,f=l,l=a,a=s+d|0,s=o,o=i,i=n,n=d+g|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,l=l+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(n,i,o,s,a,l,f,u)}roundClean(){en.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class n2 extends hp{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const mi=up(()=>new hp);up(()=>new n2);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function bi(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function jr(...e){const t=(i,o)=>s=>i(o(s)),r=Array.from(e).reverse().reduce((i,o)=>i?t(i,o.encode):o.encode,void 0),n=e.reduce((i,o)=>i?t(i,o.decode):o.decode,void 0);return{encode:r,decode:n}}function zr(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(r=>{if(bi(r),r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const n=e.indexOf(r);if(n===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return n})}}}function Wr(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of t)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function xs(e,t="="){if(bi(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let n of r)if(typeof n!="string")throw new Error(`padding.encode: non-string input=${n}`);for(;r.length*e%8;)r.push(t);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of r)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let n=r.length;if(n*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&r[n-1]===t;n--)if(!((n-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,n)}}}function dp(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function lf(e,t,r){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let n=0;const i=[],o=Array.from(e);for(o.forEach(s=>{if(bi(s),s<0||s>=t)throw new Error(`Wrong integer: ${s}`)});;){let s=0,a=!0;for(let l=n;l<o.length;l++){const f=o[l],u=t*s+f;if(!Number.isSafeInteger(u)||t*s/t!==s||u-f!==t*s)throw new Error("convertRadix: carry overflow");if(s=u%r,o[l]=Math.floor(u/r),!Number.isSafeInteger(o[l])||o[l]*r+s!==u)throw new Error("convertRadix: carry overflow");if(a)o[l]?a=!1:n=l;else continue}if(i.push(s),a)break}for(let s=0;s<e.length-1&&e[s]===0;s++)i.push(0);return i.reverse()}const pp=(e,t)=>t?pp(t,e%t):e,Qo=(e,t)=>e+(t-pp(e,t));function al(e,t,r,n){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Qo(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${Qo(t,r)}`);let i=0,o=0;const s=2**r-1,a=[];for(const l of e){if(bi(l),l>=2**t)throw new Error(`convertRadix2: invalid data word=${l} from=${t}`);if(i=i<<t|l,o+t>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=r;o-=r)a.push((i>>o-r&s)>>>0);i&=2**o-1}if(i=i<<r-o&s,!n&&o>=t)throw new Error("Excess padding");if(!n&&i)throw new Error(`Non-zero padding: ${i}`);return n&&o>0&&a.push(i>>>0),a}function i2(e){return bi(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return lf(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(lf(t,e,2**8))}}}function vn(e,t=!1){if(bi(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Qo(8,e)>32||Qo(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return al(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(al(r,e,8,t))}}}function uf(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const o2=jr(vn(4),zr("0123456789ABCDEF"),Wr("")),s2=jr(vn(5),zr("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),xs(5),Wr(""));jr(vn(5),zr("0123456789ABCDEFGHIJKLMNOPQRSTUV"),xs(5),Wr(""));jr(vn(5),zr("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Wr(""),dp(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Mr=jr(vn(6),zr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),xs(6),Wr("")),a2=jr(vn(6),zr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),xs(6),Wr("")),au=e=>jr(i2(58),zr(e),Wr("")),ll=au("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");au("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");au("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const cf=[0,2,3,5,6,7,9,10,11],l2={encode(e){let t="";for(let r=0;r<e.length;r+=8){const n=e.subarray(r,r+8);t+=ll.encode(n).padStart(cf[n.length],"1")}return t},decode(e){let t=[];for(let r=0;r<e.length;r+=11){const n=e.slice(r,r+11),i=cf.indexOf(n.length),o=ll.decode(n);for(let s=0;s<o.length-i;s++)if(o[s]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(o.slice(o.length-i)))}return Uint8Array.from(t)}},ul=jr(zr("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Wr("")),ff=[996825010,642813549,513874426,1027748829,705979059];function Ai(e){const t=e>>25;let r=(e&33554431)<<5;for(let n=0;n<ff.length;n++)(t>>n&1)===1&&(r^=ff[n]);return r}function hf(e,t,r=1){const n=e.length;let i=1;for(let o=0;o<n;o++){const s=e.charCodeAt(o);if(s<33||s>126)throw new Error(`Invalid prefix (${e})`);i=Ai(i)^s>>5}i=Ai(i);for(let o=0;o<n;o++)i=Ai(i)^e.charCodeAt(o)&31;for(let o of t)i=Ai(i)^o;for(let o=0;o<6;o++)i=Ai(i);return i^=r,ul.encode(al([i%2**30],30,5,!1))}function gp(e){const t=e==="bech32"?1:734539939,r=vn(5),n=r.decode,i=r.encode,o=uf(n);function s(u,c,h=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(c)||c.length&&typeof c[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof c}`);const d=u.length+7+c.length;if(h!==!1&&d>h)throw new TypeError(`Length ${d} exceeds limit ${h}`);return u=u.toLowerCase(),`${u}1${ul.encode(c)}${hf(u,c,t)}`}function a(u,c=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||c!==!1&&u.length>c)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${c})`);const h=u.toLowerCase();if(u!==h&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=h;const d=u.lastIndexOf("1");if(d===0||d===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=u.slice(0,d),g=u.slice(d+1);if(g.length<6)throw new Error("Data must be at least 6 characters long");const m=ul.decode(g).slice(0,-6),v=hf(p,m,t);if(!g.endsWith(v))throw new Error(`Invalid checksum in ${u}: expected "${v}"`);return{prefix:p,words:m}}const l=uf(a);function f(u){const{prefix:c,words:h}=a(u,!1);return{prefix:c,words:h,bytes:n(h)}}return{encode:s,decode:a,decodeToBytes:f,decodeUnsafe:l,fromWords:n,fromWordsUnsafe:o,toWords:i}}const ui=gp("bech32");gp("bech32m");const u2={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},c2=jr(vn(4),zr("0123456789abcdef"),Wr(""),dp(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),f2={utf8:u2,hex:c2,base16:o2,base32:s2,base64:Mr,base64url:a2,base58:ll,base58xmr:l2};`${Object.keys(f2).join(", ")}`;function da(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function df(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function h2(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function Pr(e,...t){if(!h2(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const mt=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),d2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!d2)throw new Error("Non little-endian hardware is not supported");function p2(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function g2(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}const v2=(e,t)=>(Object.assign(t,e),t),un=16,m2=283;function lu(e){return e<<1^m2&-(e>>7)}function jn(e,t){let r=0;for(;t>0;t>>=1)r^=e&-(t&1),e=lu(e);return r}const cl=(()=>{let e=new Uint8Array(256);for(let r=0,n=1;r<256;r++,n^=lu(n))e[r]=n;const t=new Uint8Array(256);t[0]=99;for(let r=0;r<255;r++){let n=e[255-r];n|=n<<8,t[e[r]]=(n^n>>4^n>>5^n>>6^n>>7^99)&255}return t})(),b2=cl.map((e,t)=>cl.indexOf(t)),y2=e=>e<<24|e>>>8,pa=e=>e<<8|e>>>24;function vp(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((f,u)=>t(e[u])),n=r.map(pa),i=n.map(pa),o=i.map(pa),s=new Uint32Array(256*256),a=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let f=0;f<256;f++)for(let u=0;u<256;u++){const c=f*256+u;s[c]=r[f]^n[u],a[c]=i[f]^o[u],l[c]=e[f]<<8|e[u]}return{sbox:e,sbox2:l,T0:r,T1:n,T2:i,T3:o,T01:s,T23:a}}const uu=vp(cl,e=>jn(e,3)<<24|e<<16|e<<8|jn(e,2)),mp=vp(b2,e=>jn(e,11)<<24|jn(e,13)<<16|jn(e,9)<<8|jn(e,14)),w2=(()=>{const e=new Uint8Array(16);for(let t=0,r=1;t<16;t++,r=lu(r))e[t]=r;return e})();function bp(e){Pr(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:r}=uu,n=mt(e),i=n.length,o=a=>fr(r,a,a,a,a),s=new Uint32Array(t+28);s.set(n);for(let a=i;a<s.length;a++){let l=s[a-1];a%i===0?l=o(y2(l))^w2[a/i-1]:i>6&&a%i===4&&(l=o(l)),s[a]=s[a-i]^l}return s}function E2(e){const t=bp(e),r=t.slice(),n=t.length,{sbox2:i}=uu,{T0:o,T1:s,T2:a,T3:l}=mp;for(let f=0;f<n;f+=4)for(let u=0;u<4;u++)r[f+u]=t[n-f-4+u];t.fill(0);for(let f=4;f<n-4;f++){const u=r[f],c=fr(i,u,u,u,u);r[f]=o[c&255]^s[c>>>8&255]^a[c>>>16&255]^l[c>>>24]}return r}function on(e,t,r,n,i,o){return e[r<<8&65280|n>>>8&255]^t[i>>>8&65280|o>>>24&255]}function fr(e,t,r,n,i){return e[t&255|r&65280]|e[n>>>16&255|i>>>16&65280]<<16}function pf(e,t,r,n,i){const{sbox2:o,T01:s,T23:a}=uu;let l=0;t^=e[l++],r^=e[l++],n^=e[l++],i^=e[l++];const f=e.length/4-2;for(let p=0;p<f;p++){const g=e[l++]^on(s,a,t,r,n,i),m=e[l++]^on(s,a,r,n,i,t),v=e[l++]^on(s,a,n,i,t,r),A=e[l++]^on(s,a,i,t,r,n);t=g,r=m,n=v,i=A}const u=e[l++]^fr(o,t,r,n,i),c=e[l++]^fr(o,r,n,i,t),h=e[l++]^fr(o,n,i,t,r),d=e[l++]^fr(o,i,t,r,n);return{s0:u,s1:c,s2:h,s3:d}}function _2(e,t,r,n,i){const{sbox2:o,T01:s,T23:a}=mp;let l=0;t^=e[l++],r^=e[l++],n^=e[l++],i^=e[l++];const f=e.length/4-2;for(let p=0;p<f;p++){const g=e[l++]^on(s,a,t,i,n,r),m=e[l++]^on(s,a,r,t,i,n),v=e[l++]^on(s,a,n,r,t,i),A=e[l++]^on(s,a,i,n,r,t);t=g,r=m,n=v,i=A}const u=e[l++]^fr(o,t,i,n,r),c=e[l++]^fr(o,r,t,i,n),h=e[l++]^fr(o,n,r,t,i),d=e[l++]^fr(o,i,n,r,t);return{s0:u,s1:c,s2:h,s3:d}}function yp(e,t){if(!t)return new Uint8Array(e);if(Pr(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function x2(e){if(Pr(e),e.length%un!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${un}`)}function A2(e,t,r){let n=e.length;const i=n%un;if(!t&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const o=mt(e);if(t){let l=un-i;l||(l=un),n=n+l}const s=yp(n,r),a=mt(s);return{b:o,o:a,out:s}}function S2(e,t){if(!t)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const n=e[r-1];if(n<=0||n>16)throw new Error(`aes/pcks5: wrong padding byte: ${n}`);const i=e.subarray(0,-n);for(let o=0;o<n;o++)if(e[r-o-1]!==n)throw new Error("aes/pcks5: wrong padding");return i}function T2(e){const t=new Uint8Array(16),r=mt(t);t.set(e);const n=un-e.length;for(let i=un-n;i<un;i++)t[i]=n;return r}const wp=v2({blockSize:16,nonceLength:16},function(t,r,n={}){Pr(t),Pr(r,16);const i=!n.disablePadding;return{encrypt:(o,s)=>{const a=bp(t),{b:l,o:f,out:u}=A2(o,i,s),c=mt(r);let h=c[0],d=c[1],p=c[2],g=c[3],m=0;for(;m+4<=l.length;)h^=l[m+0],d^=l[m+1],p^=l[m+2],g^=l[m+3],{s0:h,s1:d,s2:p,s3:g}=pf(a,h,d,p,g),f[m++]=h,f[m++]=d,f[m++]=p,f[m++]=g;if(i){const v=T2(o.subarray(m*4));h^=v[0],d^=v[1],p^=v[2],g^=v[3],{s0:h,s1:d,s2:p,s3:g}=pf(a,h,d,p,g),f[m++]=h,f[m++]=d,f[m++]=p,f[m++]=g}return a.fill(0),u},decrypt:(o,s)=>{x2(o);const a=E2(t),l=mt(r),f=yp(o.length,s),u=mt(o),c=mt(f);let h=l[0],d=l[1],p=l[2],g=l[3];for(let m=0;m+4<=u.length;){const v=h,A=d,S=p,O=g;h=u[m+0],d=u[m+1],p=u[m+2],g=u[m+3];const{s0:L,s1:E,s2:I,s3:y}=_2(a,h,d,p,g);c[m++]=L^v,c[m++]=E^A,c[m++]=I^S,c[m++]=y^O}return a.fill(0),S2(f,i)}}}),Ep=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),I2=Ep("expand 16-byte k"),O2=Ep("expand 32-byte k"),R2=mt(I2),_p=mt(O2);_p.slice();function Oe(e,t){return e<<t|e>>>32-t}function fl(e){return e.byteOffset%4===0}const go=64,L2=16,xp=2**32-1,gf=new Uint32Array;function P2(e,t,r,n,i,o,s,a){const l=i.length,f=new Uint8Array(go),u=mt(f),c=fl(i)&&fl(o),h=c?mt(i):gf,d=c?mt(o):gf;for(let p=0;p<l;s++){if(e(t,r,n,u,s,a),s>=xp)throw new Error("arx: counter overflow");const g=Math.min(go,l-p);if(c&&g===go){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let v=0,A;v<L2;v++)A=m+v,d[A]=h[A]^u[v];p+=go;continue}for(let m=0,v;m<g;m++)v=p+m,o[v]=i[v]^f[m];p+=g}}function N2(e,t){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:o,rounds:s}=p2({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return da(i),da(s),df(o),df(r),(a,l,f,u,c=0)=>{Pr(a),Pr(l),Pr(f);const h=f.length;if(u||(u=new Uint8Array(h)),Pr(u),da(c),c<0||c>=xp)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const d=[];let p=a.length,g,m;if(p===32)g=a.slice(),d.push(g),m=_p;else if(p===16&&r)g=new Uint8Array(32),g.set(a),g.set(a,16),m=R2,d.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);fl(l)||(l=l.slice(),d.push(l));const v=mt(g);if(n){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,v,mt(l.subarray(0,16)),v),l=l.subarray(16)}const A=16-i;if(A!==l.length)throw new Error(`arx: nonce must be ${A} or 16 bytes`);if(A!==12){const O=new Uint8Array(12);O.set(l,o?0:12-l.length),l=O,d.push(l)}const S=mt(l);for(P2(e,m,v,S,f,u,c,s);d.length>0;)d.pop().fill(0);return u}}function C2(e,t,r,n,i,o=20){let s=e[0],a=e[1],l=e[2],f=e[3],u=t[0],c=t[1],h=t[2],d=t[3],p=t[4],g=t[5],m=t[6],v=t[7],A=i,S=r[0],O=r[1],L=r[2],E=s,I=a,y=l,x=f,R=u,T=c,P=h,C=d,N=p,_=g,b=m,w=v,k=A,B=S,U=O,F=L;for(let j=0;j<o;j+=2)E=E+R|0,k=Oe(k^E,16),N=N+k|0,R=Oe(R^N,12),E=E+R|0,k=Oe(k^E,8),N=N+k|0,R=Oe(R^N,7),I=I+T|0,B=Oe(B^I,16),_=_+B|0,T=Oe(T^_,12),I=I+T|0,B=Oe(B^I,8),_=_+B|0,T=Oe(T^_,7),y=y+P|0,U=Oe(U^y,16),b=b+U|0,P=Oe(P^b,12),y=y+P|0,U=Oe(U^y,8),b=b+U|0,P=Oe(P^b,7),x=x+C|0,F=Oe(F^x,16),w=w+F|0,C=Oe(C^w,12),x=x+C|0,F=Oe(F^x,8),w=w+F|0,C=Oe(C^w,7),E=E+T|0,F=Oe(F^E,16),b=b+F|0,T=Oe(T^b,12),E=E+T|0,F=Oe(F^E,8),b=b+F|0,T=Oe(T^b,7),I=I+P|0,k=Oe(k^I,16),w=w+k|0,P=Oe(P^w,12),I=I+P|0,k=Oe(k^I,8),w=w+k|0,P=Oe(P^w,7),y=y+C|0,B=Oe(B^y,16),N=N+B|0,C=Oe(C^N,12),y=y+C|0,B=Oe(B^y,8),N=N+B|0,C=Oe(C^N,7),x=x+R|0,U=Oe(U^x,16),_=_+U|0,R=Oe(R^_,12),x=x+R|0,U=Oe(U^x,8),_=_+U|0,R=Oe(R^_,7);let D=0;n[D++]=s+E|0,n[D++]=a+I|0,n[D++]=l+y|0,n[D++]=f+x|0,n[D++]=u+R|0,n[D++]=c+T|0,n[D++]=h+P|0,n[D++]=d+C|0,n[D++]=p+N|0,n[D++]=g+_|0,n[D++]=m+b|0,n[D++]=v+w|0,n[D++]=A+k|0,n[D++]=S+B|0,n[D++]=O+U|0,n[D++]=L+F|0}const Ap=N2(C2,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Sp extends lp{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,cr.hash(t);const n=Vi(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,o=new Uint8Array(i);o.set(n.length>i?t.create().update(n).digest():n);for(let s=0;s<o.length;s++)o[s]^=54;this.iHash.update(o),this.oHash=t.create();for(let s=0;s<o.length;s++)o[s]^=106;this.oHash.update(o),o.fill(0)}update(t){return cr.exists(this),this.iHash.update(t),this}digestInto(t){cr.exists(this),cr.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:o,blockLen:s,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=o,t.blockLen=s,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const As=(e,t,r)=>new Sp(e,t).update(r).digest();As.create=(e,t)=>new Sp(e,t);function B2(e,t,r){return cr.hash(e),As(e,Vi(r),Vi(t))}const ga=new Uint8Array([0]),vf=new Uint8Array;function $2(e,t,r,n=32){if(cr.hash(e),cr.number(n),n>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/e.outputLen);r===void 0&&(r=vf);const o=new Uint8Array(i*e.outputLen),s=As.create(e,t),a=s._cloneInto(),l=new Uint8Array(s.outputLen);for(let f=0;f<i;f++)ga[0]=f+1,a.update(f===0?vf:l).update(r).update(ga).digestInto(l),o.set(l,e.outputLen*f),s._cloneInto(a);return s.destroy(),a.destroy(),l.fill(0),ga.fill(0),o.slice(0,n)}var U2=Object.defineProperty,Fe=(e,t)=>{for(var r in t)U2(e,r,{get:t[r],enumerable:!0})},Mn=Symbol("verified"),k2=e=>e instanceof Object;function cu(e){if(!k2(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let n=0;n<r.length;n++)if(typeof r[n]!="string")return!1}return!0}var M2={};Fe(M2,{Queue:()=>q2,QueueNode:()=>Tp,binarySearch:()=>fu,bytesToHex:()=>vt,hexToBytes:()=>Ln,insertEventIntoAscendingList:()=>F2,insertEventIntoDescendingList:()=>D2,normalizeURL:()=>H2,utf8Decoder:()=>Nr,utf8Encoder:()=>Xt});var Nr=new TextDecoder("utf-8"),Xt=new TextEncoder;function H2(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function D2(e,t){const[r,n]=fu(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:i.created_at-t.created_at);return n||e.splice(r,0,t),e}function F2(e,t){const[r,n]=fu(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:t.created_at-i.created_at);return n||e.splice(r,0,t),e}function fu(e,t){let r=0,n=e.length-1;for(;r<=n;){const i=Math.floor((r+n)/2),o=t(e[i]);if(o===0)return[i,!0];o<0?n=i-1:r=i+1}return[r,!1]}var Tp=class{value;next=null;prev=null;constructor(e){this.value=e}},q2=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new Tp(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},j2=class{generateSecretKey(){return xi.utils.randomPrivateKey()}getPublicKey(e){return vt(xi.getPublicKey(e))}finalizeEvent(e,t){const r=e;return r.pubkey=vt(xi.getPublicKey(t)),r.id=xo(r),r.sig=vt(xi.sign(xo(r),t)),r[Mn]=!0,r}verifyEvent(e){if(typeof e[Mn]=="boolean")return e[Mn];const t=xo(e);if(t!==e.id)return e[Mn]=!1,!1;try{const r=xi.verify(e.sig,t,e.pubkey);return e[Mn]=r,r}catch{return e[Mn]=!1,!1}}};function z2(e){if(!cu(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function xo(e){let t=mi(Xt.encode(z2(e)));return vt(t)}var Ss=new j2,W2=Ss.generateSecretKey,Ts=Ss.getPublicKey,br=Ss.finalizeEvent,hu=Ss.verifyEvent,G2={};Fe(G2,{Application:()=>WE,BadgeAward:()=>eE,BadgeDefinition:()=>ME,BlockedRelaysList:()=>_E,BookmarkList:()=>yE,Bookmarksets:()=>$E,Calendar:()=>QE,CalendarEventRSVP:()=>JE,ChannelCreation:()=>Np,ChannelHideMessage:()=>$p,ChannelMessage:()=>Bp,ChannelMetadata:()=>Cp,ChannelMuteUser:()=>Up,ClassifiedListing:()=>KE,ClientAuth:()=>Mp,CommunitiesList:()=>wE,CommunityDefinition:()=>r_,CommunityPostApproval:()=>lE,Contacts:()=>Y2,CreateOrUpdateProduct:()=>FE,CreateOrUpdateStall:()=>DE,Curationsets:()=>UE,Date:()=>XE,DirectMessageRelaysList:()=>TE,DraftClassifiedListing:()=>ZE,DraftLong:()=>jE,Emojisets:()=>zE,EncryptedDirectMessage:()=>Q2,EventDeletion:()=>J2,FileMetadata:()=>rE,FileServerPreference:()=>IE,Followsets:()=>NE,GenericRepost:()=>mu,Genericlists:()=>CE,GiftWrap:()=>kp,HTTPAuth:()=>bu,Handlerinformation:()=>t_,Handlerrecommendation:()=>e_,Highlights:()=>gE,InterestsList:()=>AE,Interestsets:()=>HE,JobFeedback:()=>fE,JobRequest:()=>uE,JobResult:()=>cE,Label:()=>aE,LightningPubRPC:()=>RE,LiveChatMessage:()=>nE,LiveEvent:()=>GE,LongFormArticle:()=>qE,Metadata:()=>Z2,Mutelist:()=>vE,NWCWalletInfo:()=>OE,NWCWalletRequest:()=>Hp,NWCWalletResponse:()=>LE,NostrConnect:()=>PE,OpenTimestamps:()=>tE,Pinlist:()=>mE,PrivateDirectMessage:()=>Pp,ProblemTracker:()=>iE,ProfileBadges:()=>kE,PublicChatsList:()=>EE,Reaction:()=>vu,RecommendRelay:()=>X2,RelayList:()=>bE,Relaysets:()=>BE,Report:()=>oE,Reporting:()=>sE,Repost:()=>gu,Seal:()=>Lp,SearchRelaysList:()=>xE,ShortTextNote:()=>Rp,Time:()=>YE,UserEmojiList:()=>SE,UserStatuses:()=>VE,Zap:()=>pE,ZapGoal:()=>hE,ZapRequest:()=>dE,classifyKind:()=>V2,isAddressableKind:()=>pu,isEphemeralKind:()=>Op,isKind:()=>K2,isRegularKind:()=>Ip,isReplaceableKind:()=>du});function Ip(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function du(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function Op(e){return 2e4<=e&&e<3e4}function pu(e){return 3e4<=e&&e<4e4}function V2(e){return Ip(e)?"regular":du(e)?"replaceable":Op(e)?"ephemeral":pu(e)?"parameterized":"unknown"}function K2(e,t){const r=t instanceof Array?t:[t];return cu(e)&&r.includes(e.kind)||!1}var Z2=0,Rp=1,X2=2,Y2=3,Q2=4,J2=5,gu=6,vu=7,eE=8,Lp=13,Pp=14,mu=16,Np=40,Cp=41,Bp=42,$p=43,Up=44,tE=1040,kp=1059,rE=1063,nE=1311,iE=1971,oE=1984,sE=1984,aE=1985,lE=4550,uE=5999,cE=6999,fE=7e3,hE=9041,dE=9734,pE=9735,gE=9802,vE=1e4,mE=10001,bE=10002,yE=10003,wE=10004,EE=10005,_E=10006,xE=10007,AE=10015,SE=10030,TE=10050,IE=10096,OE=13194,RE=21e3,Mp=22242,Hp=23194,LE=23195,PE=24133,bu=27235,NE=3e4,CE=30001,BE=30002,$E=30003,UE=30004,kE=30008,ME=30009,HE=30015,DE=30017,FE=30018,qE=30023,jE=30024,zE=30030,WE=30078,GE=30311,VE=30315,KE=30402,ZE=30403,XE=31922,YE=31923,QE=31924,JE=31925,e_=31989,t_=31990,r_=34550,n_={};Fe(n_,{getHex64:()=>yu,getInt:()=>Dp,getSubscriptionId:()=>i_,matchEventId:()=>o_,matchEventKind:()=>a_,matchEventPubkey:()=>s_});function yu(e,t){let r=t.length+3,n=e.indexOf(`"${t}":`)+r,i=e.slice(n).indexOf('"')+n+1;return e.slice(i,i+64)}function Dp(e,t){let r=t.length,n=e.indexOf(`"${t}":`)+r+3,i=e.slice(n),o=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,o),10)}function i_(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let r=e.slice(t+7+1).indexOf('"');if(r===-1)return null;let n=t+7+1+r,i=e.slice(n+1,80).indexOf('"');if(i===-1)return null;let o=n+1+i;return e.slice(n+1,o)}function o_(e,t){return t===yu(e,"id")}function s_(e,t){return t===yu(e,"pubkey")}function a_(e,t){return t===Dp(e,"kind")}var l_={};Fe(l_,{makeAuthEvent:()=>u_});function u_(e,t){return{kind:Mp,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var c_;try{c_=WebSocket}catch{}var f_;try{f_=WebSocket}catch{}var Ur={};Fe(Ur,{BECH32_REGEX:()=>Fp,Bech32MaxSize:()=>wu,NostrTypeGuard:()=>h_,decode:()=>Is,decodeNostrURI:()=>p_,encodeBytes:()=>Rs,naddrEncode:()=>w_,neventEncode:()=>y_,noteEncode:()=>m_,nprofileEncode:()=>b_,npubEncode:()=>v_,nsecEncode:()=>g_});var h_={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},wu=5e3,Fp=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function d_(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function p_(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),Is(e)}catch{return{type:"invalid",data:null}}}function Is(e){let{prefix:t,words:r}=ui.decode(e,wu),n=new Uint8Array(ui.fromWords(r));switch(t){case"nprofile":{let i=va(n);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:vt(i[0][0]),relays:i[1]?i[1].map(o=>Nr.decode(o)):[]}}}case"nevent":{let i=va(n);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:vt(i[0][0]),relays:i[1]?i[1].map(o=>Nr.decode(o)):[],author:i[2]?.[0]?vt(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(vt(i[3][0]),16):void 0}}}case"naddr":{let i=va(n);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Nr.decode(i[0][0]),pubkey:vt(i[2][0]),kind:parseInt(vt(i[3][0]),16),relays:i[1]?i[1].map(o=>Nr.decode(o)):[]}}}case"nsec":return{type:t,data:n};case"npub":case"note":return{type:t,data:vt(n)};default:throw new Error(`unknown prefix ${t}`)}}function va(e){let t={},r=e;for(;r.length>0;){let n=r[0],i=r[1],o=r.slice(2,2+i);if(r=r.slice(2+i),o.length<i)throw new Error(`not enough data to read on TLV ${n}`);t[n]=t[n]||[],t[n].push(o)}return t}function g_(e){return Rs("nsec",e)}function v_(e){return Rs("npub",Ln(e))}function m_(e){return Rs("note",Ln(e))}function Os(e,t){let r=ui.toWords(t);return ui.encode(e,r,wu)}function Rs(e,t){return Os(e,t)}function b_(e){let t=Eu({0:[Ln(e.pubkey)],1:(e.relays||[]).map(r=>Xt.encode(r))});return Os("nprofile",t)}function y_(e){let t;e.kind!==void 0&&(t=d_(e.kind));let r=Eu({0:[Ln(e.id)],1:(e.relays||[]).map(n=>Xt.encode(n)),2:e.author?[Ln(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return Os("nevent",r)}function w_(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let r=Eu({0:[Xt.encode(e.identifier)],1:(e.relays||[]).map(n=>Xt.encode(n)),2:[Ln(e.pubkey)],3:[new Uint8Array(t)]});return Os("naddr",r)}function Eu(e){let t=[];return Object.entries(e).reverse().forEach(([r,n])=>{n.forEach(i=>{let o=new Uint8Array(i.length+2);o.set([parseInt(r)],0),o.set([i.length],1),o.set(i,2),t.push(o)})}),_s(...t)}var E_={};Fe(E_,{decrypt:()=>__,encrypt:()=>qp});function qp(e,t,r){const n=e instanceof Uint8Array?vt(e):e,i=vi.getSharedSecret(n,"02"+t),o=jp(i);let s=Uint8Array.from(cp(16)),a=Xt.encode(r),l=wp(o,s).encrypt(a),f=Mr.encode(new Uint8Array(l)),u=Mr.encode(new Uint8Array(s.buffer));return`${f}?iv=${u}`}function __(e,t,r){const n=e instanceof Uint8Array?vt(e):e;let[i,o]=r.split("?iv="),s=vi.getSharedSecret(n,"02"+t),a=jp(s),l=Mr.decode(o),f=Mr.decode(i),u=wp(a,l).decrypt(f);return Nr.decode(u)}function jp(e){return e.slice(1,33)}var x_={};Fe(x_,{NIP05_REGEX:()=>_u,isNip05:()=>A_,isValid:()=>I_,queryProfile:()=>zp,searchDomain:()=>T_,useFetchImplementation:()=>S_});var _u=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,A_=e=>_u.test(e||""),Ls;try{Ls=fetch}catch{}function S_(e){Ls=e}async function T_(e,t=""){try{const r=`https://${e}/.well-known/nostr.json?name=${t}`,n=await Ls(r,{redirect:"manual"});if(n.status!==200)throw Error("Wrong response code");return(await n.json()).names}catch{return{}}}async function zp(e){const t=e.match(_u);if(!t)return null;const[,r="_",n]=t;try{const i=`https://${n}/.well-known/nostr.json?name=${r}`,o=await Ls(i,{redirect:"manual"});if(o.status!==200)throw Error("Wrong response code");const s=await o.json(),a=s.names[r];return a?{pubkey:a,relays:s.relays?.[a]}:null}catch{return null}}async function I_(e,t){const r=await zp(t);return r?r.pubkey===e:!1}var O_={};Fe(O_,{parse:()=>R_});function R_(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let r,n;for(let i=e.tags.length-1;i>=0;i--){const o=e.tags[i];if(o[0]==="e"&&o[1]){const[s,a,l,f,u]=o,c={id:a,relays:l?[l]:[],author:u};if(f==="root"){t.root=c;continue}if(f==="reply"){t.reply=c;continue}if(f==="mention"){t.mentions.push(c);continue}r?n=c:r=c,t.mentions.push(c);continue}if(o[0]==="q"&&o[1]){const[s,a,l]=o;t.quotes.push({id:a,relays:l?[l]:[]})}if(o[0]==="p"&&o[1]){t.profiles.push({pubkey:o[1],relays:o[2]?[o[2]]:[]});continue}}return t.root||(t.root=n||r||t.reply),t.reply||(t.reply=r||t.root),[t.reply,t.root].forEach(i=>{if(!i)return;let o=t.mentions.indexOf(i);if(o!==-1&&t.mentions.splice(o,1),i.author){let s=t.profiles.find(a=>a.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),s.relays=i.relays)}}),t.mentions.forEach(i=>{if(i.author){let o=t.profiles.find(s=>s.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(s=>{i.relays.indexOf(s)===-1&&i.relays.push(s)}),o.relays=i.relays)}}),t}var L_={};Fe(L_,{fetchRelayInformation:()=>N_,useFetchImplementation:()=>P_});var Wp;try{Wp=fetch}catch{}function P_(e){Wp=e}async function N_(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var C_={};Fe(C_,{fastEventHash:()=>Vp,getPow:()=>Gp,minePow:()=>B_});function Gp(e){let t=0;for(let r=0;r<64;r+=8){const n=parseInt(e.substring(r,r+8),16);if(n===0)t+=32;else{t+=Math.clz32(n);break}}return t}function B_(e,t){let r=0;const n=e,i=["nonce",r.toString(),t.toString()];for(n.tags.push(i);;){const o=Math.floor(new Date().getTime()/1e3);if(o!==n.created_at&&(r=0,n.created_at=o),i[1]=(++r).toString(),n.id=Vp(n),Gp(n.id)>=t)break}return n}function Vp(e){return vt(mi(Xt.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var $_={};Fe($_,{unwrapEvent:()=>V_,unwrapManyEvents:()=>K_,wrapEvent:()=>s0,wrapManyEvents:()=>G_});var U_={};Fe(U_,{createRumor:()=>r0,createSeal:()=>n0,createWrap:()=>i0,unwrapEvent:()=>Iu,unwrapManyEvents:()=>o0,wrapEvent:()=>Jo,wrapManyEvents:()=>z_});var k_={};Fe(k_,{decrypt:()=>Tu,encrypt:()=>Su,getConversationKey:()=>xu,v2:()=>q_});var Kp=1,Zp=65535;function xu(e,t){const r=vi.getSharedSecret(e,"02"+t).subarray(1,33);return B2(mi,r,"nip44-v2")}function Xp(e,t){const r=$2(mi,e,t,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}}function Au(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,r=t<=256?32:t/8;return r*(Math.floor((e-1)/r)+1)}function M_(e){if(!Number.isSafeInteger(e)||e<Kp||e>Zp)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function H_(e){const t=Xt.encode(e),r=t.length,n=M_(r),i=new Uint8Array(Au(r)-r);return _s(n,t,i)}function D_(e){const t=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+t);if(t<Kp||t>Zp||r.length!==t||e.length!==2+Au(t))throw new Error("invalid padding");return Nr.decode(r)}function Yp(e,t,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const n=_s(r,t);return As(mi,e,n)}function F_(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=Mr.decode(e)}catch(o){throw new Error("invalid base64: "+o.message)}const n=r.length;if(n<99||n>65603)throw new Error("invalid data length: "+n);const i=r[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}function Su(e,t,r=cp(32)){const{chacha_key:n,chacha_nonce:i,hmac_key:o}=Xp(t,r),s=H_(e),a=Ap(n,i,s),l=Yp(o,a,r);return Mr.encode(_s(new Uint8Array([2]),r,a,l))}function Tu(e,t){const{nonce:r,ciphertext:n,mac:i}=F_(e),{chacha_key:o,chacha_nonce:s,hmac_key:a}=Xp(t,r),l=Yp(a,n,r);if(!g2(l,i))throw new Error("invalid MAC");const f=Ap(o,s,n);return D_(f)}var q_={utils:{getConversationKey:xu,calcPaddedLen:Au},encrypt:Su,decrypt:Tu},j_=2880*60,Qp=()=>Math.round(Date.now()/1e3),Jp=()=>Math.round(Qp()-Math.random()*j_),e0=(e,t)=>xu(e,t),t0=(e,t,r)=>Su(JSON.stringify(e),e0(t,r)),mf=(e,t)=>JSON.parse(Tu(e.content,e0(t,e.pubkey)));function r0(e,t){const r={created_at:Qp(),content:"",tags:[],...e,pubkey:Ts(t)};return r.id=xo(r),r}function n0(e,t,r){return br({kind:Lp,content:t0(e,t,r),created_at:Jp(),tags:[]},t)}function i0(e,t){const r=W2();return br({kind:kp,content:t0(e,r,t),created_at:Jp(),tags:[["p",t]]},r)}function Jo(e,t,r){const n=r0(e,t),i=n0(n,t,r);return i0(i,r)}function z_(e,t,r){if(!r||r.length===0)throw new Error("At least one recipient is required.");const n=Ts(t),i=[Jo(e,t,n)];return r.forEach(o=>{i.push(Jo(e,t,o))}),i}function Iu(e,t){const r=mf(e,t);return mf(r,t)}function o0(e,t){let r=[];return e.forEach(n=>{r.push(Iu(n,t))}),r.sort((n,i)=>n.created_at-i.created_at),r}function W_(e,t,r,n){const i={created_at:Math.ceil(Date.now()/1e3),kind:Pp,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:s,relayUrl:a})=>{i.tags.push(a?["p",s,a]:["p",s])}),n&&i.tags.push(["e",n.eventId,n.relayUrl||"","reply"]),r&&i.tags.push(["subject",r]),i}function s0(e,t,r,n,i){const o=W_(t,r,n,i);return Jo(o,e,t.publicKey)}function G_(e,t,r,n,i){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Ts(e)},...t].map(s=>s0(e,s,r,n,i))}var V_=Iu,K_=o0,Z_={};Fe(Z_,{finishRepostEvent:()=>X_,getRepostedEvent:()=>Y_,getRepostedEventPointer:()=>a0});function X_(e,t,r,n){let i;const o=[...e.tags??[],["e",t.id,r],["p",t.pubkey]];return t.kind===Rp?i=gu:(i=mu,o.push(["k",String(t.kind)])),br({kind:i,tags:o,content:e.content===""||t.tags?.find(s=>s[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},n)}function a0(e){if(![gu,mu].includes(e.kind))return;let t,r;for(let n=e.tags.length-1;n>=0&&(t===void 0||r===void 0);n--){const i=e.tags[n];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&r===void 0&&(r=i))}if(t!==void 0)return{id:t[1],relays:[t[2],r?.[2]].filter(n=>typeof n=="string"),author:r?.[1]}}function Y_(e,{skipVerification:t}={}){const r=a0(e);if(r===void 0||e.content==="")return;let n;try{n=JSON.parse(e.content)}catch{return}if(n.id===r.id&&!(!t&&!hu(n)))return n}var Q_={};Fe(Q_,{NOSTR_URI_REGEX:()=>Ou,parse:()=>ex,test:()=>J_});var Ou=new RegExp(`nostr:(${Fp.source})`);function J_(e){return typeof e=="string"&&new RegExp(`^${Ou.source}$`).test(e)}function ex(e){const t=e.match(new RegExp(`^${Ou.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:Is(t[1])}}var tx={};Fe(tx,{finishReactionEvent:()=>rx,getReactedEventPointer:()=>nx});function rx(e,t,r){const n=t.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return br({...e,kind:vu,tags:[...e.tags??[],...n,["e",t.id],["p",t.pubkey]],content:e.content??"+"},r)}function nx(e){if(e.kind!==vu)return;let t,r;for(let n=e.tags.length-1;n>=0&&(t===void 0||r===void 0);n--){const i=e.tags[n];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&r===void 0&&(r=i))}if(!(t===void 0||r===void 0))return{id:t[1],relays:[t[2],r[2]].filter(n=>n!==void 0),author:r[1]}}var ix={};Fe(ix,{parse:()=>sx});var ox=/\W/m,bf=/\W |\W$|$|,| /m;function*sx(e){const t=e.length;let r=0,n=0;for(;n<t;){let i=e.indexOf(":",n);if(i===-1)break;if(e.substring(i-5,i)==="nostr"){const o=e.substring(i+60).match(ox),s=o?i+60+o.index:t;try{let a,{data:l,type:f}=Is(e.substring(i+1,s));switch(f){case"npub":a={pubkey:l};break;case"nsec":case"note":n=s+1;continue;default:a=l}r!==i-5&&(yield{type:"text",text:e.substring(r,i-5)}),yield{type:"reference",pointer:a},n=s,r=n;continue}catch{n=i+1;continue}}else if(e.substring(i-5,i)==="https"||e.substring(i-4,i)==="http"){const o=e.substring(i+4).match(bf),s=o?i+4+o.index:t,a=e[i-1]==="s"?5:4;try{let l=new URL(e.substring(i-a,s));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(r!==i-a&&(yield{type:"text",text:e.substring(r,i-a)}),l.pathname.endsWith(".png")||l.pathname.endsWith(".jpg")||l.pathname.endsWith(".jpeg")||l.pathname.endsWith(".gif")||l.pathname.endsWith(".webp")){yield{type:"image",url:l.toString()},n=s,r=n;continue}if(l.pathname.endsWith(".mp4")||l.pathname.endsWith(".avi")||l.pathname.endsWith(".webm")||l.pathname.endsWith(".mkv")){yield{type:"video",url:l.toString()},n=s,r=n;continue}if(l.pathname.endsWith(".mp3")||l.pathname.endsWith(".aac")||l.pathname.endsWith(".ogg")||l.pathname.endsWith(".opus")){yield{type:"audio",url:l.toString()},n=s,r=n;continue}yield{type:"url",url:l.toString()},n=s,r=n;continue}catch{n=s+1;continue}}else if(e.substring(i-3,i)==="wss"||e.substring(i-2,i)==="ws"){const o=e.substring(i+4).match(bf),s=o?i+4+o.index:t,a=e[i-1]==="s"?3:2;try{let l=new URL(e.substring(i-a,s));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");r!==i-a&&(yield{type:"text",text:e.substring(r,i-a)}),yield{type:"relay",url:l.toString()},n=s,r=n;continue}catch{n=s+1;continue}}else{n=i+1;continue}}r!==t&&(yield{type:"text",text:e.substring(r)})}var ax={};Fe(ax,{channelCreateEvent:()=>lx,channelHideMessageEvent:()=>fx,channelMessageEvent:()=>cx,channelMetadataEvent:()=>ux,channelMuteUserEvent:()=>hx});var lx=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return br({kind:Np,tags:[...e.tags??[]],content:r,created_at:e.created_at},t)},ux=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return br({kind:Cp,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},cx=(e,t)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),br({kind:Bp,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},t)},fx=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return br({kind:$p,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},hx=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return br({kind:Up,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},t)},dx={};Fe(dx,{EMOJI_SHORTCODE_REGEX:()=>l0,matchAll:()=>px,regex:()=>Ru,replaceAll:()=>gx});var l0=/:(\w+):/,Ru=()=>new RegExp(`\\B${l0.source}\\B`,"g");function*px(e){const t=e.matchAll(Ru());for(const r of t)try{const[n,i]=r;yield{shortcode:n,name:i,start:r.index,end:r.index+n.length}}catch{}}function gx(e,t){return e.replaceAll(Ru(),(r,n)=>t({shortcode:r,name:n}))}var vx={};Fe(vx,{useFetchImplementation:()=>mx,validateGithub:()=>bx});var Lu;try{Lu=fetch}catch{}function mx(e){Lu=e}async function bx(e,t,r){try{return await(await Lu(`https://gist.github.com/${t}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var yx={};Fe(yx,{makeNwcRequestEvent:()=>Ex,parseConnectionString:()=>wx});function wx(e){const{host:t,pathname:r,searchParams:n}=new URL(e),i=r||t,o=n.get("relay"),s=n.get("secret");if(!i||!o||!s)throw new Error("invalid connection string");return{pubkey:i,relay:o,secret:s}}async function Ex(e,t,r){const i=qp(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),o={kind:Hp,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return br(o,t)}var _x={};Fe(_x,{normalizeIdentifier:()=>xx});function xx(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var Ax={};Fe(Ax,{getSatoshisAmountFromBolt11:()=>Lx,getZapEndpoint:()=>Tx,makeZapReceipt:()=>Rx,makeZapRequest:()=>Ix,useFetchImplementation:()=>Sx,validateZapRequest:()=>Ox});var Pu;try{Pu=fetch}catch{}function Sx(e){Pu=e}async function Tx(e){try{let t="",{lud06:r,lud16:n}=JSON.parse(e.content);if(r){let{words:s}=ui.decode(r,1e3),a=ui.fromWords(s);t=Nr.decode(a)}else if(n){let[s,a]=n.split("@");t=new URL(`/.well-known/lnurlp/${s}`,`https://${a}`).toString()}else return null;let o=await(await Pu(t)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function Ix({profile:e,event:t,amount:r,relays:n,comment:i=""}){if(!r)throw new Error("amount not given");if(!e)throw new Error("profile not given");let o={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e],["amount",r.toString()],["relays",...n]]};if(t&&typeof t=="string"&&o.tags.push(["e",t]),t&&typeof t=="object"){if(du(t.kind)){const s=["a",`${t.kind}:${t.pubkey}:`];o.tags.push(s)}else if(pu(t.kind)){let s=t.tags.find(([l,f])=>l==="d"&&f);if(!s)throw new Error("d tag not found or is empty");const a=["a",`${t.kind}:${t.pubkey}:${s[1]}`];o.tags.push(a)}}return o}function Ox(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!cu(t))return"Zap request is not a valid Nostr event.";if(!hu(t))return"Invalid signature on zap request.";let r=t.tags.find(([o,s])=>o==="p"&&s);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let n=t.tags.find(([o,s])=>o==="e"&&s);return n&&!n[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([o,s])=>o==="relays"&&s)?null:"Zap request doesn't have a 'relays' tag."}function Rx({zapRequest:e,preimage:t,bolt11:r,paidAt:n}){let i=JSON.parse(e),o=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),s={kind:9735,created_at:Math.round(n.getTime()/1e3),content:"",tags:[...o,["P",i.pubkey],["bolt11",r],["description",e]]};return t&&s.tags.push(["preimage",t]),s}function Lx(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const r=e.substring(0,t);if(!r.startsWith("lnbc"))return 0;const n=r.substring(4);if(n.length<1)return 0;const i=n[n.length-1],o=i.charCodeAt(0)-48,s=o>=0&&o<=9;let a=n.length-1;if(s&&a++,a<1)return 0;const l=parseInt(n.substring(0,a));switch(i){case"m":return l*1e5;case"u":return l*100;case"n":return l/10;case"p":return l/1e4;default:return l*1e8}}var Px={};Fe(Px,{getToken:()=>Nx,hashPayload:()=>Nu,unpackEventFromToken:()=>c0,validateEvent:()=>v0,validateEventKind:()=>h0,validateEventMethodTag:()=>p0,validateEventPayloadTag:()=>g0,validateEventTimestamp:()=>f0,validateEventUrlTag:()=>d0,validateToken:()=>Cx});var u0="Nostr ";async function Nx(e,t,r,n=!1,i){const o={kind:bu,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&o.tags.push(["payload",Nu(i)]);const s=await r(o);return(n?u0:"")+Mr.encode(Xt.encode(JSON.stringify(s)))}async function Cx(e,t,r){const n=await c0(e).catch(o=>{throw o});return await v0(n,t,r).catch(o=>{throw o})}async function c0(e){if(!e)throw new Error("Missing token");e=e.replace(u0,"");const t=Nr.decode(Mr.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function f0(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function h0(e){return e.kind===bu}function d0(e,t){const r=e.tags.find(n=>n[0]==="u");return r?r.length>0&&r[1]===t:!1}function p0(e,t){const r=e.tags.find(n=>n[0]==="method");return r?r.length>0&&r[1].toLowerCase()===t.toLowerCase():!1}function Nu(e){const t=mi(Xt.encode(JSON.stringify(e)));return vt(t)}function g0(e,t){const r=e.tags.find(i=>i[0]==="payload");if(!r)return!1;const n=Nu(t);return r.length>0&&r[1]===n}async function v0(e,t,r,n){if(!hu(e))throw new Error("Invalid nostr event, signature invalid");if(!h0(e))throw new Error("Invalid nostr event, kind invalid");if(!f0(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!d0(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!p0(e,r))throw new Error("Invalid nostr event, method tag invalid");if(n&&typeof n=="object"&&Object.keys(n).length>0&&!g0(e,n))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const yf=/(?:^|[\s\n])#([^\s\n\t]+)/g;function m0(e){const t=[];let r;for(yf.lastIndex=0;(r=yf.exec(e))!==null;){const n=r[1];n&&n.trim()&&t.push(n)}return t}function b0(e){return m0(e).map(t=>["t",t])}function y0(e){if(!e)return"";const t=new RegExp('(?<![\\w\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF])(https?:\\/\\/[^\\s<>"{}|\\\\^`[\\]]+)(?![\\w\\u3040-\\u309F\\u30A0-\\u30FF\\u4E00-\\u9FAF])',"gi");return e.replace(t,r=>`<a href="${r}" target="_blank" rel="noopener noreferrer" class="preview-link">${r}</a>`)}function hl(e){if(!e)return"";let t=y0(e);return t=t.replace(new RegExp("(?<!<a[^>]*>.*?)(?:^|[\\s\\n])#([^\\s\\n\\t]+)(?![^<]*<\\/a>)","g"),(r,n)=>`${r.charAt(0)==="#"?"":r.charAt(0)}<span class="hashtag">#${n}</span>`),t}function Ki(e){return e===0?"0KB":`${Math.round(e/1024)}KB`}function w0(e,t,r){const n=e>0?Math.round(t/e*100):100,i=`${Ki(e)} â ${Ki(t)}`;return{originalSize:e,compressedSize:t,wasCompressed:r,compressionRatio:n,sizeReduction:i}}function dl(e){return!e||!e.wasCompressed?null:{wasCompressed:!0,originalSize:Ki(e.originalSize),compressedSize:Ki(e.compressedSize),compressionRatio:e.compressionRatio}}function E0(e){return/nsec1[023456789acdefghjklmnpqrstuvwxyz]{10,}/.test(e)}function Cu(e){try{const{type:t,data:r}=Ur.decode(e);if(t!=="nsec")return console.warn("ç¡å¹ãªnsecå½¢å¼ã§ã"),{hex:"",npub:"",nprofile:""};const n=Ts(r),i=Ur.npubEncode(n),o=Ur.nprofileEncode({pubkey:n,relays:[]});return{hex:n,npub:i,nprofile:o}}catch(t){return console.error("å¬ééµã®å°åºã«å¤±æ:",t),{hex:"",npub:"",nprofile:""}}}function Bx(e){try{if(!e)return{hex:"",npub:"",nprofile:""};let t=e;if(/^npub1[023456789acdefghjklmnpqrstuvwxyz]+$/.test(e)){const i=Ur.decode(e);if(i.type==="npub")t=i.data;else return{hex:"",npub:"",nprofile:""}}const r=Ur.npubEncode(t),n=Ur.nprofileEncode({pubkey:t,relays:[]});return{hex:t,npub:r,nprofile:n}}catch(t){return console.error("å¬ééµãã©ã¼ãããã®çæã«å¤±æ:",t),{hex:"",npub:"",nprofile:""}}}function Bu(e){return/^nsec1[023456789acdefghjklmnpqrstuvwxyz]{58,}$/.test(e)}const $x=Object.freeze(Object.defineProperty({__proto__:null,containsSecretKey:E0,createFileSizeInfo:w0,derivePublicKeyFromNsec:Cu,extractHashtags:m0,formatFileSize:Ki,formatTextWithHashtagsAndLinks:hl,formatTextWithLinks:y0,generateHashtagTags:b0,generatePublicKeyFormats:Bx,generateSizeDisplayInfo:dl,isValidNsec:Bu},Symbol.toStringTag,{value:"Module"}));class _0{_nsecStore=Bt("");_dataStore=Bt({hex:"",npub:"",nprofile:""});_isValidStore=Bt(!1);_isNostrLoginStore=Bt(!1);nsec={subscribe:this._nsecStore.subscribe};data={subscribe:this._dataStore.subscribe};isValid={subscribe:this._isValidStore.subscribe};isNostrLogin={subscribe:this._isNostrLoginStore.subscribe};hex=$r(this._dataStore,t=>t.hex);npub=$r(this._dataStore,t=>t.npub);nprofile=$r(this._dataStore,t=>t.nprofile);constructor(){this._nsecStore.subscribe(t=>this.updateFromNsec(t))}setNsec(t){this._nsecStore.set(t||""),this._isNostrLoginStore.set(!1)}setNostrLoginAuth(t){if(t.type==="logout"){this.clear();return}if(t.pubkey){const r=t.npub||Ur.npubEncode(t.pubkey),n=Ur.nprofileEncode({pubkey:t.pubkey,relays:[]});this._dataStore.set({hex:t.pubkey,npub:r,nprofile:n}),this._isValidStore.set(!0),this._isNostrLoginStore.set(!0),this._nsecStore.set(""),Yw(t.pubkey,r,n)}}updateFromNsec(t){if(!t||!Bu(t)){this._dataStore.set({hex:"",npub:"",nprofile:""}),this._isValidStore.set(!1);return}const r=Cu(t);r.hex?(this._dataStore.set(r),this._isValidStore.set(!0),Xw(r.hex,r.npub,r.nprofile)):(this._dataStore.set({hex:"",npub:"",nprofile:""}),this._isValidStore.set(!1))}clear(){this._nsecStore.set(""),this._isNostrLoginStore.set(!1),Zw()}get currentIsValid(){let t=!1;return this.isValid.subscribe(n=>t=n)(),t}get currentHex(){let t="";return this.hex.subscribe(n=>t=n)(),t}get currentIsNostrLogin(){let t=!1;return this.isNostrLogin.subscribe(n=>t=n)(),t}}const Zn={isValidNsec:Bu,derivePublicKey:Cu,saveToStorage(e){try{return localStorage.setItem("nostr-secret-key",e),!0}catch(t){return console.error("éµã®ä¿å­ã«å¤±æ:",t),!1}},loadFromStorage(){return localStorage.getItem("nostr-secret-key")},hasStoredKey(){return!!localStorage.getItem("nostr-secret-key")},isWindowNostrAvailable(){return typeof window<"u"&&"nostr"in window&&typeof window.nostr=="object"},async getPublicKeyFromWindowNostr(){try{return this.isWindowNostrAvailable()?await window.nostr.getPublicKey():null}catch(e){return console.error("window.nostrããå¬ééµã®åå¾ã«å¤±æ:",e),null}}},ma=["wss://purplepag.es/","wss://directory.yabu.me/","wss://indexer.coracle.social/","wss://user.kindpag.es/"],ba=["wss://relay.nostr.band/","wss://nos.lol/","wss://relay.damus.io/","wss://relay-jp.nostr.wirednet.jp/","wss://yabu.me/","wss://r.kojira.io/","wss://nrelay-jp.c-stellar.net/"];function vo(e,t){try{localStorage.setItem(`nostr-relays-${e}`,JSON.stringify(t)),console.log("ãªã¬ã¼ãªã¹ããã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){console.error("ãªã¬ã¼ãªã¹ãã®ä¿å­ã«å¤±æ:",r)}}function Ux(e){try{const t=localStorage.getItem(`nostr-relays-${e}`);return t?JSON.parse(t):null}catch(t){return console.error("ãªã¬ã¼ãªã¹ãã®åå¾ã«å¤±æ:",t),null}}function kx(e){const t={};return e.filter(r=>r.length>=2&&r[0]==="r").forEach(r=>{const n=r[1];let i=!0,o=!0;r.length>2&&(r.length===3?r[2]==="read"?o=!1:r[2]==="write"&&(i=!1):(i=r.includes("read"),o=r.includes("write"))),t[n]={read:i,write:o}}),t}class Mx{rxNostr;constructor(t){this.rxNostr=t}saveToLocalStorage(t,r){vo(t,r)}getFromLocalStorage(t){return Ux(t)}setBootstrapRelays(){this.rxNostr.use(Eo(),{on:{relays:ma}}).subscribe()}async fetchUserRelays(t){return await this.tryFetchKind10002(t,ma)||await this.tryFetchKind3(t,ma)?!0:(this.rxNostr.setDefaultRelays(ba),console.log("ãã©ã¼ã«ããã¯ãªã¬ã¼ãè¨­å®:",ba),vo(t,ba),!1)}async tryFetchKind10002(t,r){return new Promise(n=>{const i=Eo(),o=this.rxNostr.use(i,{on:{relays:r}}).subscribe(s=>{if(s.event?.kind===10002&&s.event.pubkey===t)try{const a=kx(s.event.tags);Object.keys(a).length>0&&(this.rxNostr.setDefaultRelays(a),console.log("Kind 10002ãããªã¬ã¼ãè¨­å®:",a),vo(t,a),o.unsubscribe(),n(!0))}catch(a){console.error("Kind 10002ã®ãã¼ã¹ã¨ã©ã¼:",a)}});i.emit({authors:[t],kinds:[10002]}),setTimeout(()=>{o.unsubscribe(),n(!1)},3e3)})}async tryFetchKind3(t,r){return new Promise(n=>{const i=Eo(),o=this.rxNostr.use(i,{on:{relays:r}}).subscribe(s=>{if(s.event?.kind===3&&s.event.pubkey===t)try{const a=JSON.parse(s.event.content);a&&typeof a=="object"&&!Array.isArray(a)&&(this.rxNostr.setDefaultRelays(a),console.log("Kind 3ãããªã¬ã¼ãè¨­å®:",a),vo(t,a),o.unsubscribe(),n(!0))}catch(a){console.error("Kind 3ã®ãã¼ã¹ã¨ã©ã¼:",a)}});i.emit({authors:[t],kinds:[3]}),setTimeout(()=>{o.unsubscribe(),n(!1)},3e3)})}}class wf{rxNostr=null;constructor(t){t&&(this.rxNostr=t)}setRxNostr(t){this.rxNostr=t}validatePost(t){return t.trim()?this.rxNostr?Ca(Wi).isAuthenticated?{valid:!0}:{valid:!1,error:"login_required"}:{valid:!1,error:"nostr_not_ready"}:{valid:!1,error:"empty_content"}}extractHashtags(t){return b0(t)}async buildEvent(t,r){const n=this.extractHashtags(t),i={kind:1,content:t,tags:n,created_at:Math.floor(Date.now()/1e3)};return r&&(i.pubkey=r),i}sendEvent(t,r){return this.rxNostr?new Promise(n=>{let i=!1,o=!1;const a=this.rxNostr.send(t,r?{signer:r}:void 0).subscribe({next:l=>{console.log(`ãªã¬ã¼ ${l.from} ã¸ã®éä¿¡çµæ:`,l.ok?"æå":"å¤±æ"),l.ok&&!i&&(o=!0,i=!0,a.unsubscribe(),n({success:!0}))},error:l=>{console.error("éä¿¡ã¨ã©ã¼:",l),i||(i=!0,a.unsubscribe(),n({success:!1,error:"post_error"}))},complete:()=>{!i&&!o&&(i=!0,a.unsubscribe(),n({success:!1,error:"post_error"}))}});setTimeout(()=>{i||(i=!0,a.unsubscribe(),n(o?{success:!0}:{success:!1,error:"post_error"}))},3e3)}):Promise.resolve({success:!1,error:"nostr_not_ready"})}async submitPost(t){const r=this.validatePost(t);if(!r.valid)return{success:!1,error:r.error};try{if(Ca(Wi).type==="nostr-login"&&Zn.isWindowNostrAvailable())try{const l=await Zn.getPublicKeyFromWindowNostr();if(!l)return{success:!1,error:"pubkey_not_found"};const f=await this.buildEvent(t,l),u=await window.nostr.signEvent(f);return console.log("ç½²åæ¸ã¿ã¤ãã³ã:",u),await this.sendEvent(u)}catch(l){return console.error("window.nostrã§ã®æç¨¿ã¨ã©ã¼:",l),{success:!1,error:"post_error"}}const o=Zn.loadFromStorage();if(!o)return{success:!1,error:"key_not_found"};const s=await this.buildEvent(t),a=bd(o);return await this.sendEvent(s,a)}catch(n){return console.error("æç¨¿ã¨ã©ã¼:",n),{success:!1,error:"post_error"}}}}function Hx(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(n){if(n!=="default"&&!(n in e)){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}})}),Object.freeze(e)}function x0(e,t){return new Promise(function(r,n){let i;return Dx(e).then(function(o){try{return i=o,r(new Blob([t.slice(0,2),i,t.slice(2)],{type:"image/jpeg"}))}catch(s){return n(s)}},n)})}const Dx=e=>new Promise((t,r)=>{const n=new FileReader;n.addEventListener("load",({target:{result:i}})=>{const o=new DataView(i);let s=0;if(o.getUint16(s)!==65496)return r("not a valid JPEG");for(s+=2;;){const a=o.getUint16(s);if(a===65498)break;const l=o.getUint16(s+2);if(a===65505&&o.getUint32(s+4)===1165519206){const f=s+10;let u;switch(o.getUint16(f)){case 18761:u=!0;break;case 19789:u=!1;break;default:return r("TIFF header contains invalid endian")}if(o.getUint16(f+2,u)!==42)return r("TIFF header contains invalid version");const c=o.getUint32(f+4,u),h=f+c+2+12*o.getUint16(f+c,u);for(let d=f+c+2;d<h;d+=12)if(o.getUint16(d,u)==274){if(o.getUint16(d+2,u)!==3)return r("Orientation data type is invalid");if(o.getUint32(d+4,u)!==1)return r("Orientation data count is invalid");o.setUint16(d+8,1,u);break}return t(i.slice(s,s+2+l))}s+=2+l}return t(new Blob)}),n.readAsArrayBuffer(e)});var es={},Fx={get exports(){return es},set exports(e){es=e}};(function(e){var t,r,n={};Fx.exports=n,n.parse=function(i,o){for(var s=n.bin.readUshort,a=n.bin.readUint,l=0,f={},u=new Uint8Array(i),c=u.length-4;a(u,c)!=101010256;)c--;l=c,l+=4;var h=s(u,l+=4);s(u,l+=2);var d=a(u,l+=2),p=a(u,l+=4);l+=4,l=p;for(var g=0;g<h;g++){a(u,l),l+=4,l+=4,l+=4,a(u,l+=4),d=a(u,l+=4);var m=a(u,l+=4),v=s(u,l+=4),A=s(u,l+2),S=s(u,l+4);l+=6;var O=a(u,l+=8);l+=4,l+=v+A+S,n._readLocal(u,O,f,d,m,o)}return f},n._readLocal=function(i,o,s,a,l,f){var u=n.bin.readUshort,c=n.bin.readUint;c(i,o),u(i,o+=4),u(i,o+=2);var h=u(i,o+=2);c(i,o+=2),c(i,o+=4),o+=4;var d=u(i,o+=8),p=u(i,o+=2);o+=2;var g=n.bin.readUTF8(i,o,d);if(o+=d,o+=p,f)s[g]={size:l,csize:a};else{var m=new Uint8Array(i.buffer,o);if(h==0)s[g]=new Uint8Array(m.buffer.slice(o,o+a));else{if(h!=8)throw"unknown compression method: "+h;var v=new Uint8Array(l);n.inflateRaw(m,v),s[g]=v}}},n.inflateRaw=function(i,o){return n.F.inflate(i,o)},n.inflate=function(i,o){return i[0],i[1],n.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-6),o)},n.deflate=function(i,o){o==null&&(o={level:6});var s=0,a=new Uint8Array(50+Math.floor(1.1*i.length));a[s]=120,a[s+1]=156,s+=2,s=n.F.deflateRaw(i,a,s,o.level);var l=n.adler(i,0,i.length);return a[s+0]=l>>>24&255,a[s+1]=l>>>16&255,a[s+2]=l>>>8&255,a[s+3]=l>>>0&255,new Uint8Array(a.buffer,0,s+4)},n.deflateRaw=function(i,o){o==null&&(o={level:6});var s=new Uint8Array(50+Math.floor(1.1*i.length)),a=n.F.deflateRaw(i,s,a,o.level);return new Uint8Array(s.buffer,0,a)},n.encode=function(i,o){o==null&&(o=!1);var s=0,a=n.bin.writeUint,l=n.bin.writeUshort,f={};for(var u in i){var c=!n._noNeed(u)&&!o,h=i[u],d=n.crc.crc(h,0,h.length);f[u]={cpr:c,usize:h.length,crc:d,file:c?n.deflateRaw(h):h}}for(var u in f)s+=f[u].file.length+30+46+2*n.bin.sizeUTF8(u);s+=22;var p=new Uint8Array(s),g=0,m=[];for(var u in f){var v=f[u];m.push(g),g=n._writeHeader(p,g,u,v,0)}var A=0,S=g;for(var u in f)v=f[u],m.push(g),g=n._writeHeader(p,g,u,v,1,m[A++]);var O=g-S;return a(p,g,101010256),g+=4,l(p,g+=4,A),l(p,g+=2,A),a(p,g+=2,O),a(p,g+=4,S),g+=4,g+=2,p.buffer},n._noNeed=function(i){var o=i.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(o)!=-1},n._writeHeader=function(i,o,s,a,l,f){var u=n.bin.writeUint,c=n.bin.writeUshort,h=a.file;return u(i,o,l==0?67324752:33639248),o+=4,l==1&&(o+=2),c(i,o,20),c(i,o+=2,0),c(i,o+=2,a.cpr?8:0),u(i,o+=2,0),u(i,o+=4,a.crc),u(i,o+=4,h.length),u(i,o+=4,a.usize),c(i,o+=4,n.bin.sizeUTF8(s)),c(i,o+=2,0),o+=2,l==1&&(o+=2,o+=2,u(i,o+=6,f),o+=4),o+=n.bin.writeUTF8(i,o,s),l==0&&(i.set(h,o),o+=h.length),o},n.crc={table:function(){for(var i=new Uint32Array(256),o=0;o<256;o++){for(var s=o,a=0;a<8;a++)1&s?s=3988292384^s>>>1:s>>>=1;i[o]=s}return i}(),update:function(i,o,s,a){for(var l=0;l<a;l++)i=n.crc.table[255&(i^o[s+l])]^i>>>8;return i},crc:function(i,o,s){return 4294967295^n.crc.update(4294967295,i,o,s)}},n.adler=function(i,o,s){for(var a=1,l=0,f=o,u=o+s;f<u;){for(var c=Math.min(f+5552,u);f<c;)l+=a+=i[f++];a%=65521,l%=65521}return l<<16|a},n.bin={readUshort:function(i,o){return i[o]|i[o+1]<<8},writeUshort:function(i,o,s){i[o]=255&s,i[o+1]=s>>8&255},readUint:function(i,o){return 16777216*i[o+3]+(i[o+2]<<16|i[o+1]<<8|i[o])},writeUint:function(i,o,s){i[o]=255&s,i[o+1]=s>>8&255,i[o+2]=s>>16&255,i[o+3]=s>>24&255},readASCII:function(i,o,s){for(var a="",l=0;l<s;l++)a+=String.fromCharCode(i[o+l]);return a},writeASCII:function(i,o,s){for(var a=0;a<s.length;a++)i[o+a]=s.charCodeAt(a)},pad:function(i){return i.length<2?"0"+i:i},readUTF8:function(i,o,s){for(var a,l="",f=0;f<s;f++)l+="%"+n.bin.pad(i[o+f].toString(16));try{a=decodeURIComponent(l)}catch{return n.bin.readASCII(i,o,s)}return a},writeUTF8:function(i,o,s){for(var a=s.length,l=0,f=0;f<a;f++){var u=s.charCodeAt(f);if((4294967168&u)==0)i[o+l]=u,l++;else if((4294965248&u)==0)i[o+l]=192|u>>6,i[o+l+1]=128|u>>0&63,l+=2;else if((4294901760&u)==0)i[o+l]=224|u>>12,i[o+l+1]=128|u>>6&63,i[o+l+2]=128|u>>0&63,l+=3;else{if((4292870144&u)!=0)throw"e";i[o+l]=240|u>>18,i[o+l+1]=128|u>>12&63,i[o+l+2]=128|u>>6&63,i[o+l+3]=128|u>>0&63,l+=4}}return l},sizeUTF8:function(i){for(var o=i.length,s=0,a=0;a<o;a++){var l=i.charCodeAt(a);if((4294967168&l)==0)s++;else if((4294965248&l)==0)s+=2;else if((4294901760&l)==0)s+=3;else{if((4292870144&l)!=0)throw"e";s+=4}}return s}},n.F={},n.F.deflateRaw=function(i,o,s,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],f=n.F.U,u=n.F._goodIndex;n.F._hash;var c=n.F._putsE,h=0,d=s<<3,p=0,g=i.length;if(a==0){for(;h<g;)c(o,d,h+(T=Math.min(65535,g-h))==g?1:0),d=n.F._copyExact(i,h,T,o,d+8),h+=T;return d>>>3}var m=f.lits,v=f.strt,A=f.prev,S=0,O=0,L=0,E=0,I=0,y=0;for(g>2&&(v[y=n.F._hash(i,0)]=0),h=0;h<g;h++){if(I=y,h+1<g-2){y=n.F._hash(i,h+1);var x=h+1&32767;A[x]=v[y],v[y]=x}if(p<=h){(S>14e3||O>26697)&&g-h>100&&(p<h&&(m[S]=h-p,S+=2,p=h),d=n.F._writeBlock(h==g-1||p==g?1:0,m,S,E,i,L,h-L,o,d),S=O=E=0,L=h);var R=0;h<g-2&&(R=n.F._bestMatch(i,h,A,I,Math.min(l[2],g-h),l[3]));var T=R>>>16,P=65535&R;if(R!=0){P=65535&R;var C=u(T=R>>>16,f.of0);f.lhst[257+C]++;var N=u(P,f.df0);f.dhst[N]++,E+=f.exb[C]+f.dxb[N],m[S]=T<<23|h-p,m[S+1]=P<<16|C<<8|N,S+=2,p=h+T}else f.lhst[i[h]]++;O++}}for(L==h&&i.length!=0||(p<h&&(m[S]=h-p,S+=2,p=h),d=n.F._writeBlock(1,m,S,E,i,L,h-L,o,d),S=0,O=0,S=O=E=0,L=h);(7&d)!=0;)d++;return d>>>3},n.F._bestMatch=function(i,o,s,a,l,f){var u=32767&o,c=s[u],h=u-c+32768&32767;if(c==u||a!=n.F._hash(i,o-h))return 0;for(var d=0,p=0,g=Math.min(32767,o);h<=g&&--f!=0&&c!=u;){if(d==0||i[o+d]==i[o+d-h]){var m=n.F._howLong(i,o,h);if(m>d){if(p=h,(d=m)>=l)break;h+2<m&&(m=h+2);for(var v=0,A=0;A<m-2;A++){var S=o-h+A+32768&32767,O=S-s[S]+32768&32767;O>v&&(v=O,c=S)}}}h+=(u=c)-(c=s[u])+32768&32767}return d<<16|p},n.F._howLong=function(i,o,s){if(i[o]!=i[o-s]||i[o+1]!=i[o+1-s]||i[o+2]!=i[o+2-s])return 0;var a=o,l=Math.min(i.length,o+258);for(o+=3;o<l&&i[o]==i[o-s];)o++;return o-a},n.F._hash=function(i,o){return(i[o]<<8|i[o+1])+(i[o+2]<<4)&65535},n.saved=0,n.F._writeBlock=function(i,o,s,a,l,f,u,c,h){var d,p,g,m,v,A,S,O,L,E=n.F.U,I=n.F._putsF,y=n.F._putsE;E.lhst[256]++,p=(d=n.F.getTrees())[0],g=d[1],m=d[2],v=d[3],A=d[4],S=d[5],O=d[6],L=d[7];var x=32+((h+3&7)==0?0:8-(h+3&7))+(u<<3),R=a+n.F.contSize(E.fltree,E.lhst)+n.F.contSize(E.fdtree,E.dhst),T=a+n.F.contSize(E.ltree,E.lhst)+n.F.contSize(E.dtree,E.dhst);T+=14+3*S+n.F.contSize(E.itree,E.ihst)+(2*E.ihst[16]+3*E.ihst[17]+7*E.ihst[18]);for(var P=0;P<286;P++)E.lhst[P]=0;for(P=0;P<30;P++)E.dhst[P]=0;for(P=0;P<19;P++)E.ihst[P]=0;var C=x<R&&x<T?0:R<T?1:2;if(I(c,h,i),I(c,h+1,C),h+=3,C==0){for(;(7&h)!=0;)h++;h=n.F._copyExact(l,f,u,c,h)}else{var N,_;if(C==1&&(N=E.fltree,_=E.fdtree),C==2){n.F.makeCodes(E.ltree,p),n.F.revCodes(E.ltree,p),n.F.makeCodes(E.dtree,g),n.F.revCodes(E.dtree,g),n.F.makeCodes(E.itree,m),n.F.revCodes(E.itree,m),N=E.ltree,_=E.dtree,y(c,h,v-257),y(c,h+=5,A-1),y(c,h+=5,S-4),h+=4;for(var b=0;b<S;b++)y(c,h+3*b,E.itree[1+(E.ordr[b]<<1)]);h+=3*S,h=n.F._codeTiny(O,E.itree,c,h),h=n.F._codeTiny(L,E.itree,c,h)}for(var w=f,k=0;k<s;k+=2){for(var B=o[k],U=B>>>23,F=w+(8388607&B);w<F;)h=n.F._writeLit(l[w++],N,c,h);if(U!=0){var D=o[k+1],j=D>>16,q=D>>8&255,M=255&D;y(c,h=n.F._writeLit(257+q,N,c,h),U-E.of0[q]),h+=E.exb[q],I(c,h=n.F._writeLit(M,_,c,h),j-E.df0[M]),h+=E.dxb[M],w+=U}}h=n.F._writeLit(256,N,c,h)}return h},n.F._copyExact=function(i,o,s,a,l){var f=l>>>3;return a[f]=s,a[f+1]=s>>>8,a[f+2]=255-a[f],a[f+3]=255-a[f+1],f+=4,a.set(new Uint8Array(i.buffer,o,s),f),l+(s+4<<3)},n.F.getTrees=function(){for(var i=n.F.U,o=n.F._hufTree(i.lhst,i.ltree,15),s=n.F._hufTree(i.dhst,i.dtree,15),a=[],l=n.F._lenCodes(i.ltree,a),f=[],u=n.F._lenCodes(i.dtree,f),c=0;c<a.length;c+=2)i.ihst[a[c]]++;for(c=0;c<f.length;c+=2)i.ihst[f[c]]++;for(var h=n.F._hufTree(i.ihst,i.itree,7),d=19;d>4&&i.itree[1+(i.ordr[d-1]<<1)]==0;)d--;return[o,s,h,l,u,d,a,f]},n.F.getSecond=function(i){for(var o=[],s=0;s<i.length;s+=2)o.push(i[s+1]);return o},n.F.nonZero=function(i){for(var o="",s=0;s<i.length;s+=2)i[s+1]!=0&&(o+=(s>>1)+",");return o},n.F.contSize=function(i,o){for(var s=0,a=0;a<o.length;a++)s+=o[a]*i[1+(a<<1)];return s},n.F._codeTiny=function(i,o,s,a){for(var l=0;l<i.length;l+=2){var f=i[l],u=i[l+1];a=n.F._writeLit(f,o,s,a);var c=f==16?2:f==17?3:7;f>15&&(n.F._putsE(s,a,u,c),a+=c)}return a},n.F._lenCodes=function(i,o){for(var s=i.length;s!=2&&i[s-1]==0;)s-=2;for(var a=0;a<s;a+=2){var l=i[a+1],f=a+3<s?i[a+3]:-1,u=a+5<s?i[a+5]:-1,c=a==0?-1:i[a-1];if(l==0&&f==l&&u==l){for(var h=a+5;h+2<s&&i[h+2]==l;)h+=2;(d=Math.min(h+1-a>>>1,138))<11?o.push(17,d-3):o.push(18,d-11),a+=2*d-2}else if(l==c&&f==l&&u==l){for(h=a+5;h+2<s&&i[h+2]==l;)h+=2;var d=Math.min(h+1-a>>>1,6);o.push(16,d-3),a+=2*d-2}else o.push(l,0)}return s>>>1},n.F._hufTree=function(i,o,s){var a=[],l=i.length,f=o.length,u=0;for(u=0;u<f;u+=2)o[u]=0,o[u+1]=0;for(u=0;u<l;u++)i[u]!=0&&a.push({lit:u,f:i[u]});var c=a.length,h=a.slice(0);if(c==0)return 0;if(c==1){var d=a[0].lit;return h=d==0?1:0,o[1+(d<<1)]=1,o[1+(h<<1)]=1,1}a.sort(function(O,L){return O.f-L.f});var p=a[0],g=a[1],m=0,v=1,A=2;for(a[0]={lit:-1,f:p.f+g.f,l:p,r:g,d:0};v!=c-1;)p=m!=v&&(A==c||a[m].f<a[A].f)?a[m++]:a[A++],g=m!=v&&(A==c||a[m].f<a[A].f)?a[m++]:a[A++],a[v++]={lit:-1,f:p.f+g.f,l:p,r:g};var S=n.F.setDepth(a[v-1],0);for(S>s&&(n.F.restrictDepth(h,s,S),S=s),u=0;u<c;u++)o[1+(h[u].lit<<1)]=h[u].d;return S},n.F.setDepth=function(i,o){return i.lit!=-1?(i.d=o,o):Math.max(n.F.setDepth(i.l,o+1),n.F.setDepth(i.r,o+1))},n.F.restrictDepth=function(i,o,s){var a=0,l=1<<s-o,f=0;for(i.sort(function(c,h){return h.d==c.d?c.f-h.f:h.d-c.d}),a=0;a<i.length&&i[a].d>o;a++){var u=i[a].d;i[a].d=o,f+=l-(1<<s-u)}for(f>>>=s-o;f>0;)(u=i[a].d)<o?(i[a].d++,f-=1<<o-u-1):a++;for(;a>=0;a--)i[a].d==o&&f<0&&(i[a].d--,f++);f!=0&&console.log("debt left")},n.F._goodIndex=function(i,o){var s=0;return o[16|s]<=i&&(s|=16),o[8|s]<=i&&(s|=8),o[4|s]<=i&&(s|=4),o[2|s]<=i&&(s|=2),o[1|s]<=i&&(s|=1),s},n.F._writeLit=function(i,o,s,a){return n.F._putsF(s,a,o[i<<1]),a+o[1+(i<<1)]},n.F.inflate=function(i,o){var s=Uint8Array;if(i[0]==3&&i[1]==0)return o||new s(0);var a=n.F,l=a._bitsF,f=a._bitsE,u=a._decodeTiny,c=a.makeCodes,h=a.codes2map,d=a._get17,p=a.U,g=o==null;g&&(o=new s(i.length>>>2<<3));for(var m,v,A=0,S=0,O=0,L=0,E=0,I=0,y=0,x=0,R=0;A==0;)if(A=l(i,R,1),S=l(i,R+1,2),R+=3,S!=0){if(g&&(o=n.F._check(o,x+(1<<17))),S==1&&(m=p.flmap,v=p.fdmap,I=511,y=31),S==2){O=f(i,R,5)+257,L=f(i,R+5,5)+1,E=f(i,R+10,4)+4,R+=14;for(var T=0;T<38;T+=2)p.itree[T]=0,p.itree[T+1]=0;var P=1;for(T=0;T<E;T++){var C=f(i,R+3*T,3);p.itree[1+(p.ordr[T]<<1)]=C,C>P&&(P=C)}R+=3*E,c(p.itree,P),h(p.itree,P,p.imap),m=p.lmap,v=p.dmap,R=u(p.imap,(1<<P)-1,O+L,i,R,p.ttree);var N=a._copyOut(p.ttree,0,O,p.ltree);I=(1<<N)-1;var _=a._copyOut(p.ttree,O,L,p.dtree);y=(1<<_)-1,c(p.ltree,N),h(p.ltree,N,m),c(p.dtree,_),h(p.dtree,_,v)}for(;;){var b=m[d(i,R)&I];R+=15&b;var w=b>>>4;if(!(w>>>8))o[x++]=w;else{if(w==256)break;var k=x+w-254;if(w>264){var B=p.ldef[w-257];k=x+(B>>>3)+f(i,R,7&B),R+=7&B}var U=v[d(i,R)&y];R+=15&U;var F=U>>>4,D=p.ddef[F],j=(D>>>4)+l(i,R,15&D);for(R+=15&D,g&&(o=n.F._check(o,x+(1<<17)));x<k;)o[x]=o[x++-j],o[x]=o[x++-j],o[x]=o[x++-j],o[x]=o[x++-j];x=k}}}else{(7&R)!=0&&(R+=8-(7&R));var q=4+(R>>>3),M=i[q-4]|i[q-3]<<8;g&&(o=n.F._check(o,x+M)),o.set(new s(i.buffer,i.byteOffset+q,M),x),R=q+M<<3,x+=M}return o.length==x?o:o.slice(0,x)},n.F._check=function(i,o){var s=i.length;if(o<=s)return i;var a=new Uint8Array(Math.max(s<<1,o));return a.set(i,0),a},n.F._decodeTiny=function(i,o,s,a,l,f){for(var u=n.F._bitsE,c=n.F._get17,h=0;h<s;){var d=i[c(a,l)&o];l+=15&d;var p=d>>>4;if(p<=15)f[h]=p,h++;else{var g=0,m=0;p==16?(m=3+u(a,l,2),l+=2,g=f[h-1]):p==17?(m=3+u(a,l,3),l+=3):p==18&&(m=11+u(a,l,7),l+=7);for(var v=h+m;h<v;)f[h]=g,h++}}return l},n.F._copyOut=function(i,o,s,a){for(var l=0,f=0,u=a.length>>>1;f<s;){var c=i[f+o];a[f<<1]=0,a[1+(f<<1)]=c,c>l&&(l=c),f++}for(;f<u;)a[f<<1]=0,a[1+(f<<1)]=0,f++;return l},n.F.makeCodes=function(i,o){for(var s,a,l,f,u=n.F.U,c=i.length,h=u.bl_count,d=0;d<=o;d++)h[d]=0;for(d=1;d<c;d+=2)h[i[d]]++;var p=u.next_code;for(s=0,h[0]=0,a=1;a<=o;a++)s=s+h[a-1]<<1,p[a]=s;for(l=0;l<c;l+=2)(f=i[l+1])!=0&&(i[l]=p[f],p[f]++)},n.F.codes2map=function(i,o,s){for(var a=i.length,l=n.F.U.rev15,f=0;f<a;f+=2)if(i[f+1]!=0)for(var u=f>>1,c=i[f+1],h=u<<4|c,d=o-c,p=i[f]<<d,g=p+(1<<d);p!=g;)s[l[p]>>>15-o]=h,p++},n.F.revCodes=function(i,o){for(var s=n.F.U.rev15,a=15-o,l=0;l<i.length;l+=2){var f=i[l]<<o-i[l+1];i[l]=s[f]>>>a}},n.F._putsE=function(i,o,s){s<<=7&o;var a=o>>>3;i[a]|=s,i[a+1]|=s>>>8},n.F._putsF=function(i,o,s){s<<=7&o;var a=o>>>3;i[a]|=s,i[a+1]|=s>>>8,i[a+2]|=s>>>16},n.F._bitsE=function(i,o,s){return(i[o>>>3]|i[1+(o>>>3)]<<8)>>>(7&o)&(1<<s)-1},n.F._bitsF=function(i,o,s){return(i[o>>>3]|i[1+(o>>>3)]<<8|i[2+(o>>>3)]<<16)>>>(7&o)&(1<<s)-1},n.F._get17=function(i,o){return(i[o>>>3]|i[1+(o>>>3)]<<8|i[2+(o>>>3)]<<16)>>>(7&o)},n.F._get25=function(i,o){return(i[o>>>3]|i[1+(o>>>3)]<<8|i[2+(o>>>3)]<<16|i[3+(o>>>3)]<<24)>>>(7&o)},n.F.U=(t=Uint16Array,r=Uint32Array,{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new t(65536),prev:new t(32768)}),function(){for(var i=n.F.U,o=0;o<32768;o++){var s=o;s=(4278255360&(s=(4042322160&(s=(3435973836&(s=(2863311530&s)>>>1|(1431655765&s)<<1))>>>2|(858993459&s)<<2))>>>4|(252645135&s)<<4))>>>8|(16711935&s)<<8,i.rev15[o]=(s>>>16|s<<16)>>>17}function a(l,f,u){for(;f--!=0;)l.push(0,u)}for(o=0;o<32;o++)i.ldef[o]=i.of0[o]<<3|i.exb[o],i.ddef[o]=i.df0[o]<<4|i.dxb[o];a(i.fltree,144,8),a(i.fltree,112,9),a(i.fltree,24,7),a(i.fltree,8,8),n.F.makeCodes(i.fltree,9),n.F.codes2map(i.fltree,9,i.flmap),n.F.revCodes(i.fltree,9),a(i.fdtree,32,5),n.F.makeCodes(i.fdtree,5),n.F.codes2map(i.fdtree,5,i.fdmap),n.F.revCodes(i.fdtree,5),a(i.itree,19,0),a(i.ltree,286,0),a(i.dtree,30,0),a(i.ttree,320,0)}()})();var qx=Hx({__proto__:null,default:es},[es]);const Gt=function(){var e={nextZero(u,c){for(;u[c]!=0;)c++;return c},readUshort:(u,c)=>u[c]<<8|u[c+1],writeUshort(u,c,h){u[c]=h>>8&255,u[c+1]=255&h},readUint:(u,c)=>16777216*u[c]+(u[c+1]<<16|u[c+2]<<8|u[c+3]),writeUint(u,c,h){u[c]=h>>24&255,u[c+1]=h>>16&255,u[c+2]=h>>8&255,u[c+3]=255&h},readASCII(u,c,h){let d="";for(let p=0;p<h;p++)d+=String.fromCharCode(u[c+p]);return d},writeASCII(u,c,h){for(let d=0;d<h.length;d++)u[c+d]=h.charCodeAt(d)},readBytes(u,c,h){const d=[];for(let p=0;p<h;p++)d.push(u[c+p]);return d},pad:u=>u.length<2?`0${u}`:u,readUTF8(u,c,h){let d,p="";for(let g=0;g<h;g++)p+=`%${e.pad(u[c+g].toString(16))}`;try{d=decodeURIComponent(p)}catch{return e.readASCII(u,c,h)}return d}};function t(u,c,h,d){const p=c*h,g=o(d),m=Math.ceil(c*g/8),v=new Uint8Array(4*p),A=new Uint32Array(v.buffer),{ctype:S}=d,{depth:O}=d,L=e.readUshort;if(S==6){const B=p<<2;if(O==8)for(var E=0;E<B;E+=4)v[E]=u[E],v[E+1]=u[E+1],v[E+2]=u[E+2],v[E+3]=u[E+3];if(O==16)for(E=0;E<B;E++)v[E]=u[E<<1]}else if(S==2){const B=d.tabs.tRNS;if(B==null){if(O==8)for(E=0;E<p;E++){var I=3*E;A[E]=255<<24|u[I+2]<<16|u[I+1]<<8|u[I]}if(O==16)for(E=0;E<p;E++)I=6*E,A[E]=255<<24|u[I+4]<<16|u[I+2]<<8|u[I]}else{var y=B[0];const U=B[1],F=B[2];if(O==8)for(E=0;E<p;E++){var x=E<<2;I=3*E,A[E]=255<<24|u[I+2]<<16|u[I+1]<<8|u[I],u[I]==y&&u[I+1]==U&&u[I+2]==F&&(v[x+3]=0)}if(O==16)for(E=0;E<p;E++)x=E<<2,I=6*E,A[E]=255<<24|u[I+4]<<16|u[I+2]<<8|u[I],L(u,I)==y&&L(u,I+2)==U&&L(u,I+4)==F&&(v[x+3]=0)}}else if(S==3){const B=d.tabs.PLTE,U=d.tabs.tRNS,F=U?U.length:0;if(O==1)for(var R=0;R<h;R++){var T=R*m,P=R*c;for(E=0;E<c;E++){x=P+E<<2;var C=3*(N=u[T+(E>>3)]>>7-((7&E)<<0)&1);v[x]=B[C],v[x+1]=B[C+1],v[x+2]=B[C+2],v[x+3]=N<F?U[N]:255}}if(O==2)for(R=0;R<h;R++)for(T=R*m,P=R*c,E=0;E<c;E++)x=P+E<<2,C=3*(N=u[T+(E>>2)]>>6-((3&E)<<1)&3),v[x]=B[C],v[x+1]=B[C+1],v[x+2]=B[C+2],v[x+3]=N<F?U[N]:255;if(O==4)for(R=0;R<h;R++)for(T=R*m,P=R*c,E=0;E<c;E++)x=P+E<<2,C=3*(N=u[T+(E>>1)]>>4-((1&E)<<2)&15),v[x]=B[C],v[x+1]=B[C+1],v[x+2]=B[C+2],v[x+3]=N<F?U[N]:255;if(O==8)for(E=0;E<p;E++){var N;x=E<<2,C=3*(N=u[E]),v[x]=B[C],v[x+1]=B[C+1],v[x+2]=B[C+2],v[x+3]=N<F?U[N]:255}}else if(S==4){if(O==8)for(E=0;E<p;E++){x=E<<2;var _=u[b=E<<1];v[x]=_,v[x+1]=_,v[x+2]=_,v[x+3]=u[b+1]}if(O==16)for(E=0;E<p;E++){var b;x=E<<2,_=u[b=E<<2],v[x]=_,v[x+1]=_,v[x+2]=_,v[x+3]=u[b+2]}}else if(S==0)for(y=d.tabs.tRNS?d.tabs.tRNS:-1,R=0;R<h;R++){const B=R*m,U=R*c;if(O==1)for(var w=0;w<c;w++){var k=(_=255*(u[B+(w>>>3)]>>>7-(7&w)&1))==255*y?0:255;A[U+w]=k<<24|_<<16|_<<8|_}else if(O==2)for(w=0;w<c;w++)k=(_=85*(u[B+(w>>>2)]>>>6-((3&w)<<1)&3))==85*y?0:255,A[U+w]=k<<24|_<<16|_<<8|_;else if(O==4)for(w=0;w<c;w++)k=(_=17*(u[B+(w>>>1)]>>>4-((1&w)<<2)&15))==17*y?0:255,A[U+w]=k<<24|_<<16|_<<8|_;else if(O==8)for(w=0;w<c;w++)k=(_=u[B+w])==y?0:255,A[U+w]=k<<24|_<<16|_<<8|_;else if(O==16)for(w=0;w<c;w++)_=u[B+(w<<1)],k=L(u,B+(w<<1))==y?0:255,A[U+w]=k<<24|_<<16|_<<8|_}return v}function r(u,c,h,d){const p=o(u),g=Math.ceil(h*p/8),m=new Uint8Array((g+1+u.interlace)*d);return c=u.tabs.CgBI?i(c,m):n(c,m),u.interlace==0?c=s(c,u,0,h,d):u.interlace==1&&(c=function(A,S){const O=S.width,L=S.height,E=o(S),I=E>>3,y=Math.ceil(O*E/8),x=new Uint8Array(L*y);let R=0;const T=[0,0,4,0,2,0,1],P=[0,4,0,2,0,1,0],C=[8,8,8,4,4,2,2],N=[8,8,4,4,2,2,1];let _=0;for(;_<7;){const w=C[_],k=N[_];let B=0,U=0,F=T[_];for(;F<L;)F+=w,U++;let D=P[_];for(;D<O;)D+=k,B++;const j=Math.ceil(B*E/8);s(A,S,R,B,U);let q=0,M=T[_];for(;M<L;){let Z=P[_],ae=R+q*j<<3;for(;Z<O;){var b;if(E==1&&(b=(b=A[ae>>3])>>7-(7&ae)&1,x[M*y+(Z>>3)]|=b<<7-((7&Z)<<0)),E==2&&(b=(b=A[ae>>3])>>6-(7&ae)&3,x[M*y+(Z>>2)]|=b<<6-((3&Z)<<1)),E==4&&(b=(b=A[ae>>3])>>4-(7&ae)&15,x[M*y+(Z>>1)]|=b<<4-((1&Z)<<2)),E>=8){const he=M*y+Z*I;for(let V=0;V<I;V++)x[he+V]=A[(ae>>3)+V]}ae+=E,Z+=k}q++,M+=w}B*U!=0&&(R+=U*(1+j)),_+=1}return x}(c,u)),c}function n(u,c){return i(new Uint8Array(u.buffer,2,u.length-6),c)}var i=function(){const u={H:{}};return u.H.N=function(c,h){const d=Uint8Array;let p,g,m=0,v=0,A=0,S=0,O=0,L=0,E=0,I=0,y=0;if(c[0]==3&&c[1]==0)return h||new d(0);const x=u.H,R=x.b,T=x.e,P=x.R,C=x.n,N=x.A,_=x.Z,b=x.m,w=h==null;for(w&&(h=new d(c.length>>>2<<5));m==0;)if(m=R(c,y,1),v=R(c,y+1,2),y+=3,v!=0){if(w&&(h=u.H.W(h,I+(1<<17))),v==1&&(p=b.J,g=b.h,L=511,E=31),v==2){A=T(c,y,5)+257,S=T(c,y+5,5)+1,O=T(c,y+10,4)+4,y+=14;let B=1;for(var k=0;k<38;k+=2)b.Q[k]=0,b.Q[k+1]=0;for(k=0;k<O;k++){const D=T(c,y+3*k,3);b.Q[1+(b.X[k]<<1)]=D,D>B&&(B=D)}y+=3*O,C(b.Q,B),N(b.Q,B,b.u),p=b.w,g=b.d,y=P(b.u,(1<<B)-1,A+S,c,y,b.v);const U=x.V(b.v,0,A,b.C);L=(1<<U)-1;const F=x.V(b.v,A,S,b.D);E=(1<<F)-1,C(b.C,U),N(b.C,U,p),C(b.D,F),N(b.D,F,g)}for(;;){const B=p[_(c,y)&L];y+=15&B;const U=B>>>4;if(!(U>>>8))h[I++]=U;else{if(U==256)break;{let F=I+U-254;if(U>264){const Z=b.q[U-257];F=I+(Z>>>3)+T(c,y,7&Z),y+=7&Z}const D=g[_(c,y)&E];y+=15&D;const j=D>>>4,q=b.c[j],M=(q>>>4)+R(c,y,15&q);for(y+=15&q;I<F;)h[I]=h[I++-M],h[I]=h[I++-M],h[I]=h[I++-M],h[I]=h[I++-M];I=F}}}}else{(7&y)!=0&&(y+=8-(7&y));const B=4+(y>>>3),U=c[B-4]|c[B-3]<<8;w&&(h=u.H.W(h,I+U)),h.set(new d(c.buffer,c.byteOffset+B,U),I),y=B+U<<3,I+=U}return h.length==I?h:h.slice(0,I)},u.H.W=function(c,h){const d=c.length;if(h<=d)return c;const p=new Uint8Array(d<<1);return p.set(c,0),p},u.H.R=function(c,h,d,p,g,m){const v=u.H.e,A=u.H.Z;let S=0;for(;S<d;){const O=c[A(p,g)&h];g+=15&O;const L=O>>>4;if(L<=15)m[S]=L,S++;else{let E=0,I=0;L==16?(I=3+v(p,g,2),g+=2,E=m[S-1]):L==17?(I=3+v(p,g,3),g+=3):L==18&&(I=11+v(p,g,7),g+=7);const y=S+I;for(;S<y;)m[S]=E,S++}}return g},u.H.V=function(c,h,d,p){let g=0,m=0;const v=p.length>>>1;for(;m<d;){const A=c[m+h];p[m<<1]=0,p[1+(m<<1)]=A,A>g&&(g=A),m++}for(;m<v;)p[m<<1]=0,p[1+(m<<1)]=0,m++;return g},u.H.n=function(c,h){const d=u.H.m,p=c.length;let g,m,v,A;const S=d.j;for(var O=0;O<=h;O++)S[O]=0;for(O=1;O<p;O+=2)S[c[O]]++;const L=d.K;for(g=0,S[0]=0,m=1;m<=h;m++)g=g+S[m-1]<<1,L[m]=g;for(v=0;v<p;v+=2)A=c[v+1],A!=0&&(c[v]=L[A],L[A]++)},u.H.A=function(c,h,d){const p=c.length,g=u.H.m.r;for(let m=0;m<p;m+=2)if(c[m+1]!=0){const v=m>>1,A=c[m+1],S=v<<4|A,O=h-A;let L=c[m]<<O;const E=L+(1<<O);for(;L!=E;)d[g[L]>>>15-h]=S,L++}},u.H.l=function(c,h){const d=u.H.m.r,p=15-h;for(let g=0;g<c.length;g+=2){const m=c[g]<<h-c[g+1];c[g]=d[m]>>>p}},u.H.M=function(c,h,d){d<<=7&h;const p=h>>>3;c[p]|=d,c[p+1]|=d>>>8},u.H.I=function(c,h,d){d<<=7&h;const p=h>>>3;c[p]|=d,c[p+1]|=d>>>8,c[p+2]|=d>>>16},u.H.e=function(c,h,d){return(c[h>>>3]|c[1+(h>>>3)]<<8)>>>(7&h)&(1<<d)-1},u.H.b=function(c,h,d){return(c[h>>>3]|c[1+(h>>>3)]<<8|c[2+(h>>>3)]<<16)>>>(7&h)&(1<<d)-1},u.H.Z=function(c,h){return(c[h>>>3]|c[1+(h>>>3)]<<8|c[2+(h>>>3)]<<16)>>>(7&h)},u.H.i=function(c,h){return(c[h>>>3]|c[1+(h>>>3)]<<8|c[2+(h>>>3)]<<16|c[3+(h>>>3)]<<24)>>>(7&h)},u.H.m=function(){const c=Uint16Array,h=Uint32Array;return{K:new c(16),j:new c(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new c(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new c(512),_:[],h:new c(32),$:[],w:new c(32768),C:[],v:[],d:new c(32768),D:[],u:new c(512),Q:[],r:new c(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new c(65536),g:new c(32768)}}(),function(){const c=u.H.m;for(var h=0;h<32768;h++){let p=h;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,c.r[h]=(p>>>16|p<<16)>>>17}function d(p,g,m){for(;g--!=0;)p.push(0,m)}for(h=0;h<32;h++)c.q[h]=c.S[h]<<3|c.T[h],c.c[h]=c.p[h]<<4|c.z[h];d(c._,144,8),d(c._,112,9),d(c._,24,7),d(c._,8,8),u.H.n(c._,9),u.H.A(c._,9,c.J),u.H.l(c._,9),d(c.$,32,5),u.H.n(c.$,5),u.H.A(c.$,5,c.h),u.H.l(c.$,5),d(c.Q,19,0),d(c.C,286,0),d(c.D,30,0),d(c.v,320,0)}(),u.H.N}();function o(u){return[1,null,3,1,2,null,4][u.ctype]*u.depth}function s(u,c,h,d,p){let g=o(c);const m=Math.ceil(d*g/8);let v,A;g=Math.ceil(g/8);let S=u[h],O=0;if(S>1&&(u[h]=[0,0,1][S-2]),S==3)for(O=g;O<m;O++)u[O+1]=u[O+1]+(u[O+1-g]>>>1)&255;for(let L=0;L<p;L++)if(v=h+L*m,A=v+L+1,S=u[A-1],O=0,S==0)for(;O<m;O++)u[v+O]=u[A+O];else if(S==1){for(;O<g;O++)u[v+O]=u[A+O];for(;O<m;O++)u[v+O]=u[A+O]+u[v+O-g]}else if(S==2)for(;O<m;O++)u[v+O]=u[A+O]+u[v+O-m];else if(S==3){for(;O<g;O++)u[v+O]=u[A+O]+(u[v+O-m]>>>1);for(;O<m;O++)u[v+O]=u[A+O]+(u[v+O-m]+u[v+O-g]>>>1)}else{for(;O<g;O++)u[v+O]=u[A+O]+a(0,u[v+O-m],0);for(;O<m;O++)u[v+O]=u[A+O]+a(u[v+O-g],u[v+O-m],u[v+O-g-m])}return u}function a(u,c,h){const d=u+c-h,p=d-u,g=d-c,m=d-h;return p*p<=g*g&&p*p<=m*m?u:g*g<=m*m?c:h}function l(u,c,h){h.width=e.readUint(u,c),c+=4,h.height=e.readUint(u,c),c+=4,h.depth=u[c],c++,h.ctype=u[c],c++,h.compress=u[c],c++,h.filter=u[c],c++,h.interlace=u[c],c++}function f(u,c,h,d,p,g,m,v,A){const S=Math.min(c,p),O=Math.min(h,g);let L=0,E=0;for(let _=0;_<O;_++)for(let b=0;b<S;b++)if(m>=0&&v>=0?(L=_*c+b<<2,E=(v+_)*p+m+b<<2):(L=(-v+_)*c-m+b<<2,E=_*p+b<<2),A==0)d[E]=u[L],d[E+1]=u[L+1],d[E+2]=u[L+2],d[E+3]=u[L+3];else if(A==1){var I=u[L+3]*.00392156862745098,y=u[L]*I,x=u[L+1]*I,R=u[L+2]*I,T=d[E+3]*(1/255),P=d[E]*T,C=d[E+1]*T,N=d[E+2]*T;const w=1-I,k=I+T*w,B=k==0?0:1/k;d[E+3]=255*k,d[E+0]=(y+P*w)*B,d[E+1]=(x+C*w)*B,d[E+2]=(R+N*w)*B}else if(A==2)I=u[L+3],y=u[L],x=u[L+1],R=u[L+2],T=d[E+3],P=d[E],C=d[E+1],N=d[E+2],I==T&&y==P&&x==C&&R==N?(d[E]=0,d[E+1]=0,d[E+2]=0,d[E+3]=0):(d[E]=y,d[E+1]=x,d[E+2]=R,d[E+3]=I);else if(A==3){if(I=u[L+3],y=u[L],x=u[L+1],R=u[L+2],T=d[E+3],P=d[E],C=d[E+1],N=d[E+2],I==T&&y==P&&x==C&&R==N)continue;if(I<220&&T>20)return!1}return!0}return{decode:function(c){const h=new Uint8Array(c);let d=8;const p=e,g=p.readUshort,m=p.readUint,v={tabs:{},frames:[]},A=new Uint8Array(h.length);let S,O=0,L=0;const E=[137,80,78,71,13,10,26,10];for(var I=0;I<8;I++)if(h[I]!=E[I])throw"The input is not a PNG file!";for(;d<h.length;){const _=p.readUint(h,d);d+=4;const b=p.readASCII(h,d,4);if(d+=4,b=="IHDR")l(h,d,v);else if(b=="iCCP"){for(var y=d;h[y]!=0;)y++;p.readASCII(h,d,y-d),h[y+1];const w=h.slice(y+2,d+_);let k=null;try{k=n(w)}catch{k=i(w)}v.tabs[b]=k}else if(b=="CgBI")v.tabs[b]=h.slice(d,d+4);else if(b=="IDAT"){for(I=0;I<_;I++)A[O+I]=h[d+I];O+=_}else if(b=="acTL")v.tabs[b]={num_frames:m(h,d),num_plays:m(h,d+4)},S=new Uint8Array(h.length);else if(b=="fcTL"){L!=0&&((N=v.frames[v.frames.length-1]).data=r(v,S.slice(0,L),N.rect.width,N.rect.height),L=0);const w={x:m(h,d+12),y:m(h,d+16),width:m(h,d+4),height:m(h,d+8)};let k=g(h,d+22);k=g(h,d+20)/(k==0?100:k);const B={rect:w,delay:Math.round(1e3*k),dispose:h[d+24],blend:h[d+25]};v.frames.push(B)}else if(b=="fdAT"){for(I=0;I<_-4;I++)S[L+I]=h[d+I+4];L+=_-4}else if(b=="pHYs")v.tabs[b]=[p.readUint(h,d),p.readUint(h,d+4),h[d+8]];else if(b=="cHRM")for(v.tabs[b]=[],I=0;I<8;I++)v.tabs[b].push(p.readUint(h,d+4*I));else if(b=="tEXt"||b=="zTXt"){v.tabs[b]==null&&(v.tabs[b]={});var x=p.nextZero(h,d),R=p.readASCII(h,d,x-d),T=d+_-x-1;if(b=="tEXt")C=p.readASCII(h,x+1,T);else{var P=n(h.slice(x+2,x+2+T));C=p.readUTF8(P,0,P.length)}v.tabs[b][R]=C}else if(b=="iTXt"){v.tabs[b]==null&&(v.tabs[b]={}),x=0,y=d,x=p.nextZero(h,y),R=p.readASCII(h,y,x-y);const w=h[y=x+1];var C;h[y+1],y+=2,x=p.nextZero(h,y),p.readASCII(h,y,x-y),y=x+1,x=p.nextZero(h,y),p.readUTF8(h,y,x-y),T=_-((y=x+1)-d),w==0?C=p.readUTF8(h,y,T):(P=n(h.slice(y,y+T)),C=p.readUTF8(P,0,P.length)),v.tabs[b][R]=C}else if(b=="PLTE")v.tabs[b]=p.readBytes(h,d,_);else if(b=="hIST"){const w=v.tabs.PLTE.length/3;for(v.tabs[b]=[],I=0;I<w;I++)v.tabs[b].push(g(h,d+2*I))}else if(b=="tRNS")v.ctype==3?v.tabs[b]=p.readBytes(h,d,_):v.ctype==0?v.tabs[b]=g(h,d):v.ctype==2&&(v.tabs[b]=[g(h,d),g(h,d+2),g(h,d+4)]);else if(b=="gAMA")v.tabs[b]=p.readUint(h,d)/1e5;else if(b=="sRGB")v.tabs[b]=h[d];else if(b=="bKGD")v.ctype==0||v.ctype==4?v.tabs[b]=[g(h,d)]:v.ctype==2||v.ctype==6?v.tabs[b]=[g(h,d),g(h,d+2),g(h,d+4)]:v.ctype==3&&(v.tabs[b]=h[d]);else if(b=="IEND")break;d+=_,p.readUint(h,d),d+=4}var N;return L!=0&&((N=v.frames[v.frames.length-1]).data=r(v,S.slice(0,L),N.rect.width,N.rect.height)),v.data=r(v,A,v.width,v.height),delete v.compress,delete v.interlace,delete v.filter,v},toRGBA8:function(c){const h=c.width,d=c.height;if(c.tabs.acTL==null)return[t(c.data,h,d,c).buffer];const p=[];c.frames[0].data==null&&(c.frames[0].data=c.data);const g=h*d*4,m=new Uint8Array(g),v=new Uint8Array(g),A=new Uint8Array(g);for(let O=0;O<c.frames.length;O++){const L=c.frames[O],E=L.rect.x,I=L.rect.y,y=L.rect.width,x=L.rect.height,R=t(L.data,y,x,c);if(O!=0)for(var S=0;S<g;S++)A[S]=m[S];if(L.blend==0?f(R,y,x,m,h,d,E,I,0):L.blend==1&&f(R,y,x,m,h,d,E,I,1),p.push(m.buffer.slice(0)),L.dispose!=0){if(L.dispose==1)f(v,y,x,m,h,d,E,I,0);else if(L.dispose==2)for(S=0;S<g;S++)m[S]=A[S]}}return p},_paeth:a,_copyTile:f,_bin:e}}();(function(){const{_copyTile:e}=Gt,{_bin:t}=Gt,r=Gt._paeth;var n={table:function(){const y=new Uint32Array(256);for(let x=0;x<256;x++){let R=x;for(let T=0;T<8;T++)1&R?R=3988292384^R>>>1:R>>>=1;y[x]=R}return y}(),update(y,x,R,T){for(let P=0;P<T;P++)y=n.table[255&(y^x[R+P])]^y>>>8;return y},crc:(y,x,R)=>4294967295^n.update(4294967295,y,x,R)};function i(y,x,R,T){x[R]+=y[0]*T>>4,x[R+1]+=y[1]*T>>4,x[R+2]+=y[2]*T>>4,x[R+3]+=y[3]*T>>4}function o(y){return Math.max(0,Math.min(255,y))}function s(y,x){const R=y[0]-x[0],T=y[1]-x[1],P=y[2]-x[2],C=y[3]-x[3];return R*R+T*T+P*P+C*C}function a(y,x,R,T,P,C,N){N==null&&(N=1);const _=T.length,b=[];for(var w=0;w<_;w++){const M=T[w];b.push([M>>>0&255,M>>>8&255,M>>>16&255,M>>>24&255])}for(w=0;w<_;w++){let M=4294967295;for(var k=0,B=0;B<_;B++){var U=s(b[w],b[B]);B!=w&&U<M&&(M=U,k=B)}}const F=new Uint32Array(P.buffer),D=new Int16Array(x*R*4),j=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(w=0;w<j.length;w++)j[w]=255*((j[w]+.5)/16-.5);for(let M=0;M<R;M++)for(let Z=0;Z<x;Z++){var q;w=4*(M*x+Z),N!=2?q=[o(y[w]+D[w]),o(y[w+1]+D[w+1]),o(y[w+2]+D[w+2]),o(y[w+3]+D[w+3])]:(U=j[4*(3&M)+(3&Z)],q=[o(y[w]+U),o(y[w+1]+U),o(y[w+2]+U),o(y[w+3]+U)]),k=0;let ae=16777215;for(B=0;B<_;B++){const J=s(q,b[B]);J<ae&&(ae=J,k=B)}const he=b[k],V=[q[0]-he[0],q[1]-he[1],q[2]-he[2],q[3]-he[3]];N==1&&(Z!=x-1&&i(V,D,w+4,7),M!=R-1&&(Z!=0&&i(V,D,w+4*x-4,3),i(V,D,w+4*x,5),Z!=x-1&&i(V,D,w+4*x+4,1))),C[w>>2]=k,F[w>>2]=T[k]}}function l(y,x,R,T,P){P==null&&(P={});const{crc:C}=n,N=t.writeUint,_=t.writeUshort,b=t.writeASCII;let w=8;const k=y.frames.length>1;let B,U=!1,F=33+(k?20:0);if(P.sRGB!=null&&(F+=13),P.pHYs!=null&&(F+=21),P.iCCP!=null&&(B=pako.deflate(P.iCCP),F+=21+B.length+4),y.ctype==3){for(var D=y.plte.length,j=0;j<D;j++)y.plte[j]>>>24!=255&&(U=!0);F+=8+3*D+4+(U?8+1*D+4:0)}for(var q=0;q<y.frames.length;q++)k&&(F+=38),F+=(he=y.frames[q]).cimg.length+12,q!=0&&(F+=4);F+=12;const M=new Uint8Array(F),Z=[137,80,78,71,13,10,26,10];for(j=0;j<8;j++)M[j]=Z[j];if(N(M,w,13),w+=4,b(M,w,"IHDR"),w+=4,N(M,w,x),w+=4,N(M,w,R),w+=4,M[w]=y.depth,w++,M[w]=y.ctype,w++,M[w]=0,w++,M[w]=0,w++,M[w]=0,w++,N(M,w,C(M,w-17,17)),w+=4,P.sRGB!=null&&(N(M,w,1),w+=4,b(M,w,"sRGB"),w+=4,M[w]=P.sRGB,w++,N(M,w,C(M,w-5,5)),w+=4),P.iCCP!=null){const V=13+B.length;N(M,w,V),w+=4,b(M,w,"iCCP"),w+=4,b(M,w,"ICC profile"),w+=11,w+=2,M.set(B,w),w+=B.length,N(M,w,C(M,w-(V+4),V+4)),w+=4}if(P.pHYs!=null&&(N(M,w,9),w+=4,b(M,w,"pHYs"),w+=4,N(M,w,P.pHYs[0]),w+=4,N(M,w,P.pHYs[1]),w+=4,M[w]=P.pHYs[2],w++,N(M,w,C(M,w-13,13)),w+=4),k&&(N(M,w,8),w+=4,b(M,w,"acTL"),w+=4,N(M,w,y.frames.length),w+=4,N(M,w,P.loop!=null?P.loop:0),w+=4,N(M,w,C(M,w-12,12)),w+=4),y.ctype==3){for(N(M,w,3*(D=y.plte.length)),w+=4,b(M,w,"PLTE"),w+=4,j=0;j<D;j++){const V=3*j,J=y.plte[j],ie=255&J,Y=J>>>8&255,K=J>>>16&255;M[w+V+0]=ie,M[w+V+1]=Y,M[w+V+2]=K}if(w+=3*D,N(M,w,C(M,w-3*D-4,3*D+4)),w+=4,U){for(N(M,w,D),w+=4,b(M,w,"tRNS"),w+=4,j=0;j<D;j++)M[w+j]=y.plte[j]>>>24&255;w+=D,N(M,w,C(M,w-D-4,D+4)),w+=4}}let ae=0;for(q=0;q<y.frames.length;q++){var he=y.frames[q];k&&(N(M,w,26),w+=4,b(M,w,"fcTL"),w+=4,N(M,w,ae++),w+=4,N(M,w,he.rect.width),w+=4,N(M,w,he.rect.height),w+=4,N(M,w,he.rect.x),w+=4,N(M,w,he.rect.y),w+=4,_(M,w,T[q]),w+=2,_(M,w,1e3),w+=2,M[w]=he.dispose,w++,M[w]=he.blend,w++,N(M,w,C(M,w-30,30)),w+=4);const V=he.cimg;N(M,w,(D=V.length)+(q==0?0:4)),w+=4;const J=w;b(M,w,q==0?"IDAT":"fdAT"),w+=4,q!=0&&(N(M,w,ae++),w+=4),M.set(V,w),w+=D,N(M,w,C(M,J,w-J)),w+=4}return N(M,w,0),w+=4,b(M,w,"IEND"),w+=4,N(M,w,C(M,w-4,4)),w+=4,M.buffer}function f(y,x,R){for(let T=0;T<y.frames.length;T++){const P=y.frames[T];P.rect.width;const C=P.rect.height,N=new Uint8Array(C*P.bpl+C);P.cimg=d(P.img,C,P.bpp,P.bpl,N,x,R)}}function u(y,x,R,T,P){const C=P[0],N=P[1],_=P[2],b=P[3],w=P[4],k=P[5];let B=6,U=8,F=255;for(var D=0;D<y.length;D++){const ve=new Uint8Array(y[D]);for(var j=ve.length,q=0;q<j;q+=4)F&=ve[q+3]}const M=F!=255,Z=function(ge,Ee,Ce,We,G,te){const fe=[];for(var le=0;le<ge.length;le++){const ue=new Uint8Array(ge[le]),$e=new Uint32Array(ue.buffer);var de;let Ne=0,qe=0,Ue=Ee,je=Ce,Wt=We?1:0;if(le!=0){const Bn=te||We||le==1||fe[le-2].dispose!=0?1:2;let Gr=0,yr=1e9;for(let Jt=0;Jt<Bn;Jt++){var Pe=new Uint8Array(ge[le-1-Jt]);const Cs=new Uint32Array(ge[le-1-Jt]);let At=Ee,er=Ce,Vr=-1,ke=-1;for(let Er=0;Er<Ce;Er++)for(let tr=0;tr<Ee;tr++)$e[Ae=Er*Ee+tr]!=Cs[Ae]&&(tr<At&&(At=tr),tr>Vr&&(Vr=tr),Er<er&&(er=Er),Er>ke&&(ke=Er));Vr==-1&&(At=er=Vr=ke=0),G&&((1&At)==1&&At--,(1&er)==1&&er--);const wr=(Vr-At+1)*(ke-er+1);wr<yr&&(yr=wr,Gr=Jt,Ne=At,qe=er,Ue=Vr-At+1,je=ke-er+1)}Pe=new Uint8Array(ge[le-1-Gr]),Gr==1&&(fe[le-1].dispose=2),de=new Uint8Array(Ue*je*4),e(Pe,Ee,Ce,de,Ue,je,-Ne,-qe,0),Wt=e(ue,Ee,Ce,de,Ue,je,-Ne,-qe,3)?1:0,Wt==1?h(ue,Ee,Ce,de,{x:Ne,y:qe,width:Ue,height:je}):e(ue,Ee,Ce,de,Ue,je,-Ne,-qe,0)}else de=ue.slice(0);fe.push({rect:{x:Ne,y:qe,width:Ue,height:je},img:de,blend:Wt,dispose:0})}if(We)for(le=0;le<fe.length;le++){if((st=fe[le]).blend==1)continue;const ue=st.rect,$e=fe[le-1].rect,Ne=Math.min(ue.x,$e.x),qe=Math.min(ue.y,$e.y),Ue={x:Ne,y:qe,width:Math.max(ue.x+ue.width,$e.x+$e.width)-Ne,height:Math.max(ue.y+ue.height,$e.y+$e.height)-qe};fe[le-1].dispose=1,le-1!=0&&c(ge,Ee,Ce,fe,le-1,Ue,G),c(ge,Ee,Ce,fe,le,Ue,G)}let Ye=0;if(ge.length!=1)for(var Ae=0;Ae<fe.length;Ae++){var st;Ye+=(st=fe[Ae]).rect.width*st.rect.height}return fe}(y,x,R,C,N,_),ae={},he=[],V=[];if(T!=0){const ve=[];for(q=0;q<Z.length;q++)ve.push(Z[q].img.buffer);const ge=function(G){let te=0;for(var fe=0;fe<G.length;fe++)te+=G[fe].byteLength;const le=new Uint8Array(te);let de=0;for(fe=0;fe<G.length;fe++){const Pe=new Uint8Array(G[fe]),Ye=Pe.length;for(let Ae=0;Ae<Ye;Ae+=4){let st=Pe[Ae],ue=Pe[Ae+1],$e=Pe[Ae+2];const Ne=Pe[Ae+3];Ne==0&&(st=ue=$e=0),le[de+Ae]=st,le[de+Ae+1]=ue,le[de+Ae+2]=$e,le[de+Ae+3]=Ne}de+=Ye}return le.buffer}(ve),Ee=g(ge,T);for(q=0;q<Ee.plte.length;q++)he.push(Ee.plte[q].est.rgba);let Ce=0;for(q=0;q<Z.length;q++){const We=(ie=Z[q]).img.length;var J=new Uint8Array(Ee.inds.buffer,Ce>>2,We>>2);V.push(J);const G=new Uint8Array(Ee.abuf,Ce,We);k&&a(ie.img,ie.rect.width,ie.rect.height,he,G,J),ie.img.set(G),Ce+=We}}else for(D=0;D<Z.length;D++){var ie=Z[D];const ve=new Uint32Array(ie.img.buffer);var Y=ie.rect.width;for(j=ve.length,J=new Uint8Array(j),V.push(J),q=0;q<j;q++){const ge=ve[q];if(q!=0&&ge==ve[q-1])J[q]=J[q-1];else if(q>Y&&ge==ve[q-Y])J[q]=J[q-Y];else{let Ee=ae[ge];if(Ee==null&&(ae[ge]=Ee=he.length,he.push(ge),he.length>=300))break;J[q]=Ee}}}const K=he.length;for(K<=256&&w==0&&(U=K<=2?1:K<=4?2:K<=16?4:8,U=Math.max(U,b)),D=0;D<Z.length;D++){(ie=Z[D]).rect.x,ie.rect.y,Y=ie.rect.width;const ve=ie.rect.height;let ge=ie.img;new Uint32Array(ge.buffer);let Ee=4*Y,Ce=4;if(K<=256&&w==0){Ee=Math.ceil(U*Y/8);var ce=new Uint8Array(Ee*ve);const We=V[D];for(let G=0;G<ve;G++){q=G*Ee;const te=G*Y;if(U==8)for(var oe=0;oe<Y;oe++)ce[q+oe]=We[te+oe];else if(U==4)for(oe=0;oe<Y;oe++)ce[q+(oe>>1)]|=We[te+oe]<<4-4*(1&oe);else if(U==2)for(oe=0;oe<Y;oe++)ce[q+(oe>>2)]|=We[te+oe]<<6-2*(3&oe);else if(U==1)for(oe=0;oe<Y;oe++)ce[q+(oe>>3)]|=We[te+oe]<<7-1*(7&oe)}ge=ce,B=3,Ce=1}else if(M==0&&Z.length==1){ce=new Uint8Array(Y*ve*3);const We=Y*ve;for(q=0;q<We;q++){const G=3*q,te=4*q;ce[G]=ge[te],ce[G+1]=ge[te+1],ce[G+2]=ge[te+2]}ge=ce,B=2,Ce=3,Ee=3*Y}ie.img=ge,ie.bpl=Ee,ie.bpp=Ce}return{ctype:B,depth:U,plte:he,frames:Z}}function c(y,x,R,T,P,C,N){const _=Uint8Array,b=Uint32Array,w=new _(y[P-1]),k=new b(y[P-1]),B=P+1<y.length?new _(y[P+1]):null,U=new _(y[P]),F=new b(U.buffer);let D=x,j=R,q=-1,M=-1;for(let ae=0;ae<C.height;ae++)for(let he=0;he<C.width;he++){const V=C.x+he,J=C.y+ae,ie=J*x+V,Y=F[ie];Y==0||T[P-1].dispose==0&&k[ie]==Y&&(B==null||B[4*ie+3]!=0)||(V<D&&(D=V),V>q&&(q=V),J<j&&(j=J),J>M&&(M=J))}q==-1&&(D=j=q=M=0),N&&((1&D)==1&&D--,(1&j)==1&&j--),C={x:D,y:j,width:q-D+1,height:M-j+1};const Z=T[P];Z.rect=C,Z.blend=1,Z.img=new Uint8Array(C.width*C.height*4),T[P-1].dispose==0?(e(w,x,R,Z.img,C.width,C.height,-C.x,-C.y,0),h(U,x,R,Z.img,C)):e(U,x,R,Z.img,C.width,C.height,-C.x,-C.y,0)}function h(y,x,R,T,P){e(y,x,R,T,P.width,P.height,-P.x,-P.y,2)}function d(y,x,R,T,P,C,N){const _=[];let b,w=[0,1,2,3,4];C!=-1?w=[C]:(x*T>5e5||R==1)&&(w=[0]),N&&(b={level:0});const k=qx;for(var B=0;B<w.length;B++){for(let D=0;D<x;D++)p(P,y,D,T,R,w[B]);_.push(k.deflate(P,b))}let U,F=1e9;for(B=0;B<_.length;B++)_[B].length<F&&(U=B,F=_[B].length);return _[U]}function p(y,x,R,T,P,C){const N=R*T;let _=N+R;if(y[_]=C,_++,C==0)if(T<500)for(var b=0;b<T;b++)y[_+b]=x[N+b];else y.set(new Uint8Array(x.buffer,N,T),_);else if(C==1){for(b=0;b<P;b++)y[_+b]=x[N+b];for(b=P;b<T;b++)y[_+b]=x[N+b]-x[N+b-P]+256&255}else if(R==0){for(b=0;b<P;b++)y[_+b]=x[N+b];if(C==2)for(b=P;b<T;b++)y[_+b]=x[N+b];if(C==3)for(b=P;b<T;b++)y[_+b]=x[N+b]-(x[N+b-P]>>1)+256&255;if(C==4)for(b=P;b<T;b++)y[_+b]=x[N+b]-r(x[N+b-P],0,0)+256&255}else{if(C==2)for(b=0;b<T;b++)y[_+b]=x[N+b]+256-x[N+b-T]&255;if(C==3){for(b=0;b<P;b++)y[_+b]=x[N+b]+256-(x[N+b-T]>>1)&255;for(b=P;b<T;b++)y[_+b]=x[N+b]+256-(x[N+b-T]+x[N+b-P]>>1)&255}if(C==4){for(b=0;b<P;b++)y[_+b]=x[N+b]+256-r(0,x[N+b-T],0)&255;for(b=P;b<T;b++)y[_+b]=x[N+b]+256-r(x[N+b-P],x[N+b-T],x[N+b-P-T])&255}}}function g(y,x){const R=new Uint8Array(y),T=R.slice(0),P=new Uint32Array(T.buffer),C=m(T,x),N=C[0],_=C[1],b=R.length,w=new Uint8Array(b>>2);let k;if(R.length<2e7)for(var B=0;B<b;B+=4)k=v(N,U=R[B]*(1/255),F=R[B+1]*(1/255),D=R[B+2]*(1/255),j=R[B+3]*(1/255)),w[B>>2]=k.ind,P[B>>2]=k.est.rgba;else for(B=0;B<b;B+=4){var U=R[B]*.00392156862745098,F=R[B+1]*(1/255),D=R[B+2]*(1/255),j=R[B+3]*(1/255);for(k=N;k.left;)k=A(k.est,U,F,D,j)<=0?k.left:k.right;w[B>>2]=k.ind,P[B>>2]=k.est.rgba}return{abuf:T.buffer,inds:w,plte:_}}function m(y,x,R){R==null&&(R=1e-4);const T=new Uint32Array(y.buffer),P={i0:0,i1:y.length,bst:null,est:null,tdst:0,left:null,right:null};P.bst=L(y,P.i0,P.i1),P.est=E(P.bst);const C=[P];for(;C.length<x;){let _=0,b=0;for(var N=0;N<C.length;N++)C[N].est.L>_&&(_=C[N].est.L,b=N);if(_<R)break;const w=C[b],k=S(y,T,w.i0,w.i1,w.est.e,w.est.eMq255);if(w.i0>=k||w.i1<=k){w.est.L=0;continue}const B={i0:w.i0,i1:k,bst:null,est:null,tdst:0,left:null,right:null};B.bst=L(y,B.i0,B.i1),B.est=E(B.bst);const U={i0:k,i1:w.i1,bst:null,est:null,tdst:0,left:null,right:null};for(U.bst={R:[],m:[],N:w.bst.N-B.bst.N},N=0;N<16;N++)U.bst.R[N]=w.bst.R[N]-B.bst.R[N];for(N=0;N<4;N++)U.bst.m[N]=w.bst.m[N]-B.bst.m[N];U.est=E(U.bst),w.left=B,w.right=U,C[b]=B,C.push(U)}for(C.sort((_,b)=>b.bst.N-_.bst.N),N=0;N<C.length;N++)C[N].ind=N;return[P,C]}function v(y,x,R,T,P){if(y.left==null)return y.tdst=function(B,U,F,D,j){const q=U-B[0],M=F-B[1],Z=D-B[2],ae=j-B[3];return q*q+M*M+Z*Z+ae*ae}(y.est.q,x,R,T,P),y;const C=A(y.est,x,R,T,P);let N=y.left,_=y.right;C>0&&(N=y.right,_=y.left);const b=v(N,x,R,T,P);if(b.tdst<=C*C)return b;const w=v(_,x,R,T,P);return w.tdst<b.tdst?w:b}function A(y,x,R,T,P){const{e:C}=y;return C[0]*x+C[1]*R+C[2]*T+C[3]*P-y.eMq}function S(y,x,R,T,P,C){for(T-=4;R<T;){for(;O(y,R,P)<=C;)R+=4;for(;O(y,T,P)>C;)T-=4;if(R>=T)break;const N=x[R>>2];x[R>>2]=x[T>>2],x[T>>2]=N,R+=4,T-=4}for(;O(y,R,P)>C;)R-=4;return R+4}function O(y,x,R){return y[x]*R[0]+y[x+1]*R[1]+y[x+2]*R[2]+y[x+3]*R[3]}function L(y,x,R){const T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],P=[0,0,0,0],C=R-x>>2;for(let N=x;N<R;N+=4){const _=y[N]*.00392156862745098,b=y[N+1]*(1/255),w=y[N+2]*(1/255),k=y[N+3]*(1/255);P[0]+=_,P[1]+=b,P[2]+=w,P[3]+=k,T[0]+=_*_,T[1]+=_*b,T[2]+=_*w,T[3]+=_*k,T[5]+=b*b,T[6]+=b*w,T[7]+=b*k,T[10]+=w*w,T[11]+=w*k,T[15]+=k*k}return T[4]=T[1],T[8]=T[2],T[9]=T[6],T[12]=T[3],T[13]=T[7],T[14]=T[11],{R:T,m:P,N:C}}function E(y){const{R:x}=y,{m:R}=y,{N:T}=y,P=R[0],C=R[1],N=R[2],_=R[3],b=T==0?0:1/T,w=[x[0]-P*P*b,x[1]-P*C*b,x[2]-P*N*b,x[3]-P*_*b,x[4]-C*P*b,x[5]-C*C*b,x[6]-C*N*b,x[7]-C*_*b,x[8]-N*P*b,x[9]-N*C*b,x[10]-N*N*b,x[11]-N*_*b,x[12]-_*P*b,x[13]-_*C*b,x[14]-_*N*b,x[15]-_*_*b],k=w,B=I;let U=[Math.random(),Math.random(),Math.random(),Math.random()],F=0,D=0;if(T!=0)for(let q=0;q<16&&(U=B.multVec(k,U),D=Math.sqrt(B.dot(U,U)),U=B.sml(1/D,U),!(q!=0&&Math.abs(D-F)<1e-9));q++)F=D;const j=[P*b,C*b,N*b,_*b];return{Cov:w,q:j,e:U,L:F,eMq255:B.dot(B.sml(255,j),U),eMq:B.dot(U,j),rgba:(Math.round(255*j[3])<<24|Math.round(255*j[2])<<16|Math.round(255*j[1])<<8|Math.round(255*j[0])<<0)>>>0}}var I={multVec:(y,x)=>[y[0]*x[0]+y[1]*x[1]+y[2]*x[2]+y[3]*x[3],y[4]*x[0]+y[5]*x[1]+y[6]*x[2]+y[7]*x[3],y[8]*x[0]+y[9]*x[1]+y[10]*x[2]+y[11]*x[3],y[12]*x[0]+y[13]*x[1]+y[14]*x[2]+y[15]*x[3]],dot:(y,x)=>y[0]*x[0]+y[1]*x[1]+y[2]*x[2]+y[3]*x[3],sml:(y,x)=>[y*x[0],y*x[1],y*x[2],y*x[3]]};Gt.encode=function(x,R,T,P,C,N,_){P==null&&(P=0),_==null&&(_=!1);const b=u(x,R,T,P,[!1,!1,!1,0,_,!1]);return f(b,-1),l(b,R,T,C,N)},Gt.encodeLL=function(x,R,T,P,C,N,_,b){const w={ctype:0+(P==1?0:2)+(C==0?0:4),depth:N,frames:[]},k=(P+C)*N,B=k*R;for(let U=0;U<x.length;U++)w.frames.push({rect:{x:0,y:0,width:R,height:T},img:new Uint8Array(x[U]),blend:0,dispose:1,bpp:Math.ceil(k/8),bpl:Math.ceil(B/8)});return f(w,0,!0),l(w,R,T,_,b)},Gt.encode.compress=u,Gt.encode.dither=a,Gt.quantize=g,Gt.quantize.getKDtree=m,Gt.quantize.getNearest=v})();const A0={toArrayBuffer(e,t){const r=e.width,n=e.height,i=r<<2,o=e.getContext("2d").getImageData(0,0,r,n),s=new Uint32Array(o.data.buffer),a=(32*r+31)/32<<2,l=a*n,f=122+l,u=new ArrayBuffer(f),c=new DataView(u),h=1<<20;let d,p,g,m,v=h,A=0,S=0,O=0;function L(y){c.setUint16(S,y,!0),S+=2}function E(y){c.setUint32(S,y,!0),S+=4}function I(y){S+=y}L(19778),E(f),I(4),E(122),E(108),E(r),E(-n>>>0),L(1),L(32),E(3),E(l),E(2835),E(2835),I(8),E(16711680),E(65280),E(255),E(4278190080),E(1466527264),function y(){for(;A<n&&v>0;){for(m=122+A*a,d=0;d<i;)v--,p=s[O++],g=p>>>24,c.setUint32(m+d,p<<8|g),d+=4;A++}O<s.length?(v=h,setTimeout(y,A0._dly)):t(u)}()},toBlob(e,t){this.toArrayBuffer(e,r=>{t(new Blob([r],{type:"image/bmp"}))})},_dly:9};var Tt={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},jx={[Tt.CHROME]:16384,[Tt.FIREFOX]:11180,[Tt.DESKTOP_SAFARI]:16384,[Tt.IE]:8192,[Tt.IOS]:4096,[Tt.ETC]:8192};const $u=typeof window<"u",S0=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,ts=$u&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),zx=($u||S0)&&(ts&&ts.getOriginalSymbol(window,"File")||typeof File<"u"&&File),T0=($u||S0)&&(ts&&ts.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Uu(e,t,r=Date.now()){return new Promise(n=>{const i=e.split(","),o=i[0].match(/:(.*?);/)[1],s=globalThis.atob(i[1]);let a=s.length;const l=new Uint8Array(a);for(;a--;)l[a]=s.charCodeAt(a);const f=new Blob([l],{type:o});f.name=t,f.lastModified=r,n(f)})}function I0(e){return new Promise((t,r)=>{const n=new T0;n.onload=()=>t(n.result),n.onerror=i=>r(i),n.readAsDataURL(e)})}function O0(e){return new Promise((t,r)=>{const n=new Image;n.onload=()=>t(n),n.onerror=i=>r(i),n.src=e})}function En(){if(En.cachedResult!==void 0)return En.cachedResult;let e=Tt.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=Tt.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=Tt.IOS:/Safari/i.test(t)?e=Tt.DESKTOP_SAFARI:/Firefox/i.test(t)?e=Tt.FIREFOX:(/MSIE/i.test(t)||document.documentMode)&&(e=Tt.IE),En.cachedResult=e,En.cachedResult}function R0(e,t){const r=En(),n=jx[r];let i=e,o=t,s=i*o;const a=i>o?o/i:i/o;for(;s>n*n;){const l=(n+i)/2,f=(n+o)/2;l<f?(o=f,i=f*a):(o=l*a,i=l),s=i*o}return{width:i,height:o}}function Ps(e,t){let r,n;try{if(r=new OffscreenCanvas(e,t),n=r.getContext("2d"),n===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{r=document.createElement("canvas"),n=r.getContext("2d")}return r.width=e,r.height=t,[r,n]}function L0(e,t){const{width:r,height:n}=R0(e.width,e.height),[i,o]=Ps(r,n);return t&&/jpe?g/.test(t)&&(o.fillStyle="white",o.fillRect(0,0,i.width,i.height)),o.drawImage(e,0,0,i.width,i.height),i}function Ao(){return Ao.cachedResult!==void 0||(Ao.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Ao.cachedResult}function rs(e,t={}){return new Promise(function(r,n){let i,o;var s=function(){try{return o=L0(i,t.fileType||e.type),r([i,o])}catch(l){return n(l)}},a=function(l){try{var f=function(u){try{throw u}catch(c){return n(c)}};try{let u;return I0(e).then(function(c){try{return u=c,O0(u).then(function(h){try{return i=h,function(){try{return s()}catch(d){return n(d)}}()}catch(d){return f(d)}},f)}catch(h){return f(h)}},f)}catch(u){f(u)}}catch(u){return n(u)}};try{if(Ao()||[Tt.DESKTOP_SAFARI,Tt.MOBILE_SAFARI].includes(En()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(e).then(function(l){try{return i=l,s()}catch{return a()}},a)}catch{a()}})}function ns(e,t,r,n,i=1){return new Promise(function(o,s){let a;if(t==="image/png"){let c,h,d;return c=e.getContext("2d"),{data:h}=c.getImageData(0,0,e.width,e.height),d=Gt.encode([h.buffer],e.width,e.height,4096*i),a=new Blob([d],{type:t}),a.name=r,a.lastModified=n,l.call(this)}{let c=function(){return l.call(this)};var f=c;if(t==="image/bmp")return new Promise(h=>A0.toBlob(e,h)).then((function(h){try{return a=h,a.name=r,a.lastModified=n,c.call(this)}catch(d){return s(d)}}).bind(this),s);{let h=function(){return c.call(this)};var u=h;if(typeof OffscreenCanvas=="function"&&e instanceof OffscreenCanvas)return e.convertToBlob({type:t,quality:i}).then((function(d){try{return a=d,a.name=r,a.lastModified=n,h.call(this)}catch(p){return s(p)}}).bind(this),s);{let d;return d=e.toDataURL(t,i),Uu(d,r,n).then((function(p){try{return a=p,h.call(this)}catch(g){return s(g)}}).bind(this),s)}}}function l(){return o(a)}})}function ar(e){e.width=0,e.height=0}function zn(){return new Promise(function(e,t){let r,n,i,o;return zn.cachedResult!==void 0?e(zn.cachedResult):Uu("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(s){try{return r=s,rs(r).then(function(a){try{return n=a[1],ns(n,r.type,r.name,r.lastModified).then(function(l){try{return i=l,ar(n),rs(i).then(function(f){try{return o=f[0],zn.cachedResult=o.width===1&&o.height===2,e(zn.cachedResult)}catch(u){return t(u)}},t)}catch(f){return t(f)}},t)}catch(l){return t(l)}},t)}catch(a){return t(a)}},t)})}function P0(e){return new Promise((t,r)=>{const n=new T0;n.onload=i=>{const o=new DataView(i.target.result);if(o.getUint16(0,!1)!=65496)return t(-2);const s=o.byteLength;let a=2;for(;a<s;){if(o.getUint16(a+2,!1)<=8)return t(-1);const l=o.getUint16(a,!1);if(a+=2,l==65505){if(o.getUint32(a+=2,!1)!=1165519206)return t(-1);const f=o.getUint16(a+=6,!1)==18761;a+=o.getUint32(a+4,f);const u=o.getUint16(a,f);a+=2;for(let c=0;c<u;c++)if(o.getUint16(a+12*c,f)==274)return t(o.getUint16(a+12*c+8,f))}else{if((65280&l)!=65280)break;a+=o.getUint16(a,!1)}}return t(-1)},n.onerror=i=>r(i),n.readAsArrayBuffer(e)})}function N0(e,t){const{width:r}=e,{height:n}=e,{maxWidthOrHeight:i}=t;let o,s=e;return isFinite(i)&&(r>i||n>i)&&([s,o]=Ps(r,n),r>n?(s.width=i,s.height=n/r*i):(s.width=r/n*i,s.height=i),o.drawImage(e,0,0,s.width,s.height),ar(e)),s}function C0(e,t){const{width:r}=e,{height:n}=e,[i,o]=Ps(r,n);switch(t>4&&t<9?(i.width=n,i.height=r):(i.width=r,i.height=n),t){case 2:o.transform(-1,0,0,1,r,0);break;case 3:o.transform(-1,0,0,-1,r,n);break;case 4:o.transform(1,0,0,-1,0,n);break;case 5:o.transform(0,1,1,0,0,0);break;case 6:o.transform(0,1,-1,0,n,0);break;case 7:o.transform(0,-1,-1,0,n,r);break;case 8:o.transform(0,-1,1,0,0,r)}return o.drawImage(e,0,0,r,n),ar(e),i}function Ef(e,t,r=0){return new Promise(function(n,i){let o,s,a,l,f,u,c,h,d,p,g,m,v,A,S,O,L,E,I,y;function x(T=5){if(t.signal&&t.signal.aborted)throw t.signal.reason;o+=T,t.onProgress(Math.min(o,100))}function R(T){if(t.signal&&t.signal.aborted)throw t.signal.reason;o=Math.min(Math.max(T,o),100),t.onProgress(o)}return o=r,s=t.maxIteration||10,a=1024*t.maxSizeMB*1024,x(),rs(e,t).then((function(T){try{return[,l]=T,x(),f=N0(l,t),x(),new Promise(function(P,C){var N;if(!(N=t.exifOrientation))return P0(e).then((function(b){try{return N=b,_.call(this)}catch(w){return C(w)}}).bind(this),C);function _(){return P(N)}return _.call(this)}).then((function(P){try{return u=P,x(),zn().then((function(C){try{return c=C?f:C0(f,u),x(),h=t.initialQuality||1,d=t.fileType||e.type,ns(c,d,e.name,e.lastModified,h).then((function(N){try{{let k=function(){if(s--&&(S>a||S>v)){let U,F;return U=y?.95*I.width:I.width,F=y?.95*I.height:I.height,[L,E]=Ps(U,F),E.drawImage(I,0,0,U,F),h*=d==="image/png"?.85:.95,ns(L,d,e.name,e.lastModified,h).then(function(D){try{return O=D,ar(I),I=L,S=O.size,R(Math.min(99,Math.floor((A-S)/(A-a)*100))),k}catch(j){return i(j)}},i)}return[1]},B=function(){return ar(I),ar(L),ar(f),ar(c),ar(l),R(100),n(O)};var b=k,w=B;if(p=N,x(),g=p.size>a,m=p.size>e.size,!g&&!m)return R(100),n(p);var _;return v=e.size,A=p.size,S=A,I=c,y=!t.alwaysKeepResolution&&g,(_=(function(U){for(;U;){if(U.then)return void U.then(_,i);try{if(U.pop){if(U.length)return U.pop()?B.call(this):U;U=k}else U=U.call(this)}catch(F){return i(F)}}}).bind(this))(k)}}catch(k){return i(k)}}).bind(this),i)}catch(N){return i(N)}}).bind(this),i)}catch(C){return i(C)}}).bind(this),i)}catch(P){return i(P)}}).bind(this),i)})}const Wx=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let ya;function Gx(e,t){return new Promise((r,n)=>{ya||(ya=function(s){const a=[];return a.push(s),URL.createObjectURL(new Blob(a))}(Wx));const i=new Worker(ya);i.addEventListener("message",function(s){if(t.signal&&t.signal.aborted)i.terminate();else if(s.data.progress===void 0){if(s.data.error)return n(new Error(s.data.error)),void i.terminate();r(s.data.file),i.terminate()}else t.onProgress(s.data.progress)}),i.addEventListener("error",n),t.signal&&t.signal.addEventListener("abort",()=>{n(t.signal.reason),i.terminate()}),i.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:{...t,onProgress:void 0,signal:void 0}})})}function dt(e,t){return new Promise(function(r,n){let i,o,s,a,l,f;if(i={...t},s=0,{onProgress:a}=i,i.maxSizeMB=i.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof i.useWebWorker!="boolean"||i.useWebWorker,delete i.useWebWorker,i.onProgress=d=>{s=d,typeof a=="function"&&a(s)},!(e instanceof Blob||e instanceof zx))return n(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(e.type))return n(new Error("The file given is not an image"));if(f=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||f)return Ef(e,i).then((function(d){try{return o=d,h.call(this)}catch(p){return n(p)}}).bind(this),n);var u=(function(){try{return h.call(this)}catch(d){return n(d)}}).bind(this),c=function(d){try{return Ef(e,i).then(function(p){try{return o=p,u()}catch(g){return n(g)}},n)}catch(p){return n(p)}};try{return i.libURL=i.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Gx(e,i).then(function(d){try{return o=d,u()}catch{return c()}},c)}catch{c()}function h(){try{o.name=e.name,o.lastModified=e.lastModified}catch{}try{i.preserveExif&&e.type==="image/jpeg"&&(!i.fileType||i.fileType&&i.fileType===e.type)&&(o=x0(e,o))}catch{}return r(o)}})}dt.getDataUrlFromFile=I0,dt.getFilefromDataUrl=Uu,dt.loadImage=O0,dt.drawImageInCanvas=L0,dt.drawFileInCanvas=rs,dt.canvasToFile=ns,dt.getExifOrientation=P0,dt.handleMaxWidthOrHeight=N0,dt.followExifOrientation=C0,dt.cleanupCanvasMemory=ar,dt.isAutoOrientationInBrowser=zn,dt.approximateBelowMaximumCanvasSizeOfBrowser=R0,dt.copyExifWithoutOrientation=x0,dt.getBrowserName=En,dt.version="2.0.2";class wa{static DEFAULT_API_URL="https://nostrcheck.me/api/v2/media";static MAX_FILE_SIZE=50*1024*1024;static COMPRESSION_OPTIONS={maxWidthOrHeight:1024,fileType:"image/webp",initialQuality:.8,useWebWorker:!0};static async createAuthEvent(t,r){const n={kind:27235,created_at:Math.floor(Date.now()/1e3),content:"",tags:[["u",t],["method",r]]},i=Zn.loadFromStorage();if(i)return await bd(i).signEvent(n);const o=window?.nostr;if(o?.signEvent)try{return await o.signEvent(n)}catch{throw new Error("Failed to sign auth event via nostr-login")}throw new Error("Authentication required")}static async compressImage(t){if(!t.type.startsWith("image/"))return{file:t,wasCompressed:!1};try{const r=await dt(t,this.COMPRESSION_OPTIONS);return{file:new File([r],t.name.replace(/\.[^.]+$/,"")+".webp",{type:"image/webp"}),wasCompressed:!0}}catch{return{file:t,wasCompressed:!1}}}static validateImageFile(t){return t.type.startsWith("image/")?t.size>this.MAX_FILE_SIZE?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}:{isValid:!1,errorMessage:"only_images_allowed"}}static getUploadEndpoint(t){const r=localStorage.getItem("uploadEndpoint"),n=i=>i&&i.trim().length>0?i:void 0;return n(r)??n(t)??this.DEFAULT_API_URL}static async buildAuthHeader(t){const r=await this.createAuthEvent(t,"POST");return`Nostr ${btoa(JSON.stringify(r))}`}static async uploadFile(t,r=this.DEFAULT_API_URL){try{if(!t)return{success:!1,error:"No file selected"};const n=t.size,{file:i,wasCompressed:o}=await this.compressImage(t),s=i.size,a=w0(n,s,o),l=this.getUploadEndpoint(r),f=await this.buildAuthHeader(l),u=new FormData;u.append("file",i),u.append("uploadtype","media");const c=await fetch(l,{method:"POST",headers:{Authorization:f},body:u});if(!c.ok){const d=await c.text();return{success:!1,error:`Upload failed: ${c.status} ${d}`,sizeInfo:a}}const h=await c.json();if(h.status==="success"&&h.nip94_event?.tags){const d=h.nip94_event.tags.find(p=>p[0]==="url");if(d?.[1])return{success:!0,url:d[1],sizeInfo:a}}return{success:!1,error:h.message||"Could not extract URL from response",sizeInfo:a}}catch(n){return{success:!1,error:n instanceof Error?n.message:String(n)}}}static async uploadMultipleFiles(t,r=this.DEFAULT_API_URL,n){if(!t?.length)return[];const i=new Array(t.length);let o=0,s=0;const a=()=>n?.({completed:o,failed:s,total:t.length,inProgress:o+s<t.length});return a(),await Promise.all(t.map(async(l,f)=>{try{const u=await this.uploadFile(l,r);i[f]=u,u.success?o++:s++,a()}catch(u){i[f]={success:!1,error:u instanceof Error?u.message:String(u)},s++,a()}})),i}static async uploadFileWithCallbacks(t,r=this.DEFAULT_API_URL,n){n?.onProgress?.({completed:0,failed:0,total:1,inProgress:!0});try{const i=await this.uploadFile(t,r);if(n?.onProgress?.({completed:i.success?1:0,failed:i.success?0:1,total:1,inProgress:!1}),i.success&&i.sizeInfo){const o=dl(i.sizeInfo);o&&Jc(o)}return i}catch(i){return n?.onProgress?.({completed:0,failed:1,total:1,inProgress:!1}),{success:!1,error:i instanceof Error?i.message:String(i)}}}static async uploadMultipleFilesWithCallbacks(t,r=this.DEFAULT_API_URL,n){if(!t?.length)return[];const i=await this.uploadMultipleFiles(t,r,n?.onProgress),o=i.find(s=>s.success&&s.sizeInfo);if(o?.sizeInfo){const s=dl(o.sizeInfo);s&&Jc(s)}return i}static createSWMessagePromise(t){return new Promise(r=>{let n;const i=()=>clearTimeout(n);if(t){const o=new MessageChannel;o.port1.onmessage=s=>{i(),s.data?.type==="SHARED_IMAGE"&&s.data?.data?.image?r({image:s.data.data.image,metadata:s.data.data.metadata||{}}):r(null)},n=window.setTimeout(()=>r(null),3e3),navigator.serviceWorker.controller?.postMessage({action:"getSharedImage"},[o.port2])}else{const o=s=>{i(),navigator.serviceWorker.removeEventListener("message",o),s.data?.type==="SHARED_IMAGE"&&s.data?.data?.image?r({image:s.data.data.image,metadata:s.data.data.metadata||{}}):r(null)};navigator.serviceWorker.addEventListener("message",o),n=window.setTimeout(()=>{navigator.serviceWorker.removeEventListener("message",o),r(null)},3e3),navigator.serviceWorker.controller?.postMessage({action:"getSharedImage"})}})}static async getSharedImageFromServiceWorker(){if(!navigator.serviceWorker.controller)return null;try{const t=new Promise(n=>setTimeout(()=>n(null),5e3));return await Promise.race([this.createSWMessagePromise(!0),this.createSWMessagePromise(!1),t])}catch{return null}}static checkIfOpenedFromShare(){return new URLSearchParams(window.location.search).get("shared")==="true"}static async processSharedImage(){const t=await this.getSharedImageFromServiceWorker();return t?.image?await this.uploadFile(t.image):null}}const Ea=/(?:^|[\s\n])(https?:\/\/[^\s]+?\.(?:png|jpe?g|gif|webp|svg))(?=[\s\n]|$)/gi;class Vx{parseContentWithImages(t){const r=[];let n=0,i;for(Ea.lastIndex=0;(i=Ea.exec(t))!==null;){const o=i[0],s=i[1],a=o.substring(0,o.indexOf(s));i.index>n&&r.push({type:"text",value:t.slice(n,i.index)}),a&&r.push({type:"text",value:a}),r.push({type:"image",value:s}),n=Ea.lastIndex}return n<t.length&&r.push({type:"text",value:t.slice(n)}),r}cleanup(){}}/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:B0,setPrototypeOf:_f,isFrozen:Kx,getPrototypeOf:Zx,getOwnPropertyDescriptor:Xx}=Object;let{freeze:_t,seal:zt,create:$0}=Object,{apply:pl,construct:gl}=typeof Reflect<"u"&&Reflect;_t||(_t=function(t){return t});zt||(zt=function(t){return t});pl||(pl=function(t,r,n){return t.apply(r,n)});gl||(gl=function(t,r){return new t(...r)});const mo=xt(Array.prototype.forEach),Yx=xt(Array.prototype.lastIndexOf),xf=xt(Array.prototype.pop),Si=xt(Array.prototype.push),Qx=xt(Array.prototype.splice),So=xt(String.prototype.toLowerCase),_a=xt(String.prototype.toString),Af=xt(String.prototype.match),Ti=xt(String.prototype.replace),Jx=xt(String.prototype.indexOf),eA=xt(String.prototype.trim),Vt=xt(Object.prototype.hasOwnProperty),yt=xt(RegExp.prototype.test),Ii=tA(TypeError);function xt(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return pl(e,t,n)}}function tA(e){return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return gl(e,r)}}function me(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:So;_f&&_f(e,null);let n=t.length;for(;n--;){let i=t[n];if(typeof i=="string"){const o=r(i);o!==i&&(Kx(t)||(t[n]=o),i=o)}e[i]=!0}return e}function rA(e){for(let t=0;t<e.length;t++)Vt(e,t)||(e[t]=null);return e}function Sr(e){const t=$0(null);for(const[r,n]of B0(e))Vt(e,r)&&(Array.isArray(n)?t[r]=rA(n):n&&typeof n=="object"&&n.constructor===Object?t[r]=Sr(n):t[r]=n);return t}function Oi(e,t){for(;e!==null;){const n=Xx(e,t);if(n){if(n.get)return xt(n.get);if(typeof n.value=="function")return xt(n.value)}e=Zx(e)}function r(){return null}return r}const Sf=_t(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),xa=_t(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Aa=_t(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),nA=_t(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Sa=_t(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),iA=_t(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Tf=_t(["#text"]),If=_t(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Ta=_t(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Of=_t(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),bo=_t(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),oA=zt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),sA=zt(/<%[\w\W]*|[\w\W]*%>/gm),aA=zt(/\$\{[\w\W]*/gm),lA=zt(/^data-[\-\w.\u00B7-\uFFFF]+$/),uA=zt(/^aria-[\-\w]+$/),U0=zt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),cA=zt(/^(?:\w+script|data):/i),fA=zt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),k0=zt(/^html$/i),hA=zt(/^[a-z][.\w]*(-[.\w]+)+$/i);var Rf=Object.freeze({__proto__:null,ARIA_ATTR:uA,ATTR_WHITESPACE:fA,CUSTOM_ELEMENT:hA,DATA_ATTR:lA,DOCTYPE_NAME:k0,ERB_EXPR:sA,IS_ALLOWED_URI:U0,IS_SCRIPT_OR_DATA:cA,MUSTACHE_EXPR:oA,TMPLIT_EXPR:aA});const Ri={element:1,text:3,progressingInstruction:7,comment:8,document:9},dA=function(){return typeof window>"u"?null:window},pA=function(t,r){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let n=null;const i="data-tt-policy-suffix";r&&r.hasAttribute(i)&&(n=r.getAttribute(i));const o="dompurify"+(n?"#"+n:"");try{return t.createPolicy(o,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Lf=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function M0(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:dA();const t=ne=>M0(ne);if(t.version="3.2.6",t.removed=[],!e||!e.document||e.document.nodeType!==Ri.document||!e.Element)return t.isSupported=!1,t;let{document:r}=e;const n=r,i=n.currentScript,{DocumentFragment:o,HTMLTemplateElement:s,Node:a,Element:l,NodeFilter:f,NamedNodeMap:u=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:c,DOMParser:h,trustedTypes:d}=e,p=l.prototype,g=Oi(p,"cloneNode"),m=Oi(p,"remove"),v=Oi(p,"nextSibling"),A=Oi(p,"childNodes"),S=Oi(p,"parentNode");if(typeof s=="function"){const ne=r.createElement("template");ne.content&&ne.content.ownerDocument&&(r=ne.content.ownerDocument)}let O,L="";const{implementation:E,createNodeIterator:I,createDocumentFragment:y,getElementsByTagName:x}=r,{importNode:R}=n;let T=Lf();t.isSupported=typeof B0=="function"&&typeof S=="function"&&E&&E.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:P,ERB_EXPR:C,TMPLIT_EXPR:N,DATA_ATTR:_,ARIA_ATTR:b,IS_SCRIPT_OR_DATA:w,ATTR_WHITESPACE:k,CUSTOM_ELEMENT:B}=Rf;let{IS_ALLOWED_URI:U}=Rf,F=null;const D=me({},[...Sf,...xa,...Aa,...Sa,...Tf]);let j=null;const q=me({},[...If,...Ta,...Of,...bo]);let M=Object.seal($0(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Z=null,ae=null,he=!0,V=!0,J=!1,ie=!0,Y=!1,K=!0,ce=!1,oe=!1,ve=!1,ge=!1,Ee=!1,Ce=!1,We=!0,G=!1;const te="user-content-";let fe=!0,le=!1,de={},Pe=null;const Ye=me({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ae=null;const st=me({},["audio","video","img","source","image","track"]);let ue=null;const $e=me({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ne="http://www.w3.org/1998/Math/MathML",qe="http://www.w3.org/2000/svg",Ue="http://www.w3.org/1999/xhtml";let je=Ue,Wt=!1,Bn=null;const Gr=me({},[Ne,qe,Ue],_a);let yr=me({},["mi","mo","mn","ms","mtext"]),Jt=me({},["annotation-xml"]);const Cs=me({},["title","style","font","a","script"]);let At=null;const er=["application/xhtml+xml","text/html"],Vr="text/html";let ke=null,wr=null;const Er=r.createElement("form"),tr=function($){return $ instanceof RegExp||$ instanceof Function},Bs=function(){let $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(wr&&wr===$)){if((!$||typeof $!="object")&&($={}),$=Sr($),At=er.indexOf($.PARSER_MEDIA_TYPE)===-1?Vr:$.PARSER_MEDIA_TYPE,ke=At==="application/xhtml+xml"?_a:So,F=Vt($,"ALLOWED_TAGS")?me({},$.ALLOWED_TAGS,ke):D,j=Vt($,"ALLOWED_ATTR")?me({},$.ALLOWED_ATTR,ke):q,Bn=Vt($,"ALLOWED_NAMESPACES")?me({},$.ALLOWED_NAMESPACES,_a):Gr,ue=Vt($,"ADD_URI_SAFE_ATTR")?me(Sr($e),$.ADD_URI_SAFE_ATTR,ke):$e,Ae=Vt($,"ADD_DATA_URI_TAGS")?me(Sr(st),$.ADD_DATA_URI_TAGS,ke):st,Pe=Vt($,"FORBID_CONTENTS")?me({},$.FORBID_CONTENTS,ke):Ye,Z=Vt($,"FORBID_TAGS")?me({},$.FORBID_TAGS,ke):Sr({}),ae=Vt($,"FORBID_ATTR")?me({},$.FORBID_ATTR,ke):Sr({}),de=Vt($,"USE_PROFILES")?$.USE_PROFILES:!1,he=$.ALLOW_ARIA_ATTR!==!1,V=$.ALLOW_DATA_ATTR!==!1,J=$.ALLOW_UNKNOWN_PROTOCOLS||!1,ie=$.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Y=$.SAFE_FOR_TEMPLATES||!1,K=$.SAFE_FOR_XML!==!1,ce=$.WHOLE_DOCUMENT||!1,ge=$.RETURN_DOM||!1,Ee=$.RETURN_DOM_FRAGMENT||!1,Ce=$.RETURN_TRUSTED_TYPE||!1,ve=$.FORCE_BODY||!1,We=$.SANITIZE_DOM!==!1,G=$.SANITIZE_NAMED_PROPS||!1,fe=$.KEEP_CONTENT!==!1,le=$.IN_PLACE||!1,U=$.ALLOWED_URI_REGEXP||U0,je=$.NAMESPACE||Ue,yr=$.MATHML_TEXT_INTEGRATION_POINTS||yr,Jt=$.HTML_INTEGRATION_POINTS||Jt,M=$.CUSTOM_ELEMENT_HANDLING||{},$.CUSTOM_ELEMENT_HANDLING&&tr($.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(M.tagNameCheck=$.CUSTOM_ELEMENT_HANDLING.tagNameCheck),$.CUSTOM_ELEMENT_HANDLING&&tr($.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(M.attributeNameCheck=$.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),$.CUSTOM_ELEMENT_HANDLING&&typeof $.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(M.allowCustomizedBuiltInElements=$.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Y&&(V=!1),Ee&&(ge=!0),de&&(F=me({},Tf),j=[],de.html===!0&&(me(F,Sf),me(j,If)),de.svg===!0&&(me(F,xa),me(j,Ta),me(j,bo)),de.svgFilters===!0&&(me(F,Aa),me(j,Ta),me(j,bo)),de.mathMl===!0&&(me(F,Sa),me(j,Of),me(j,bo))),$.ADD_TAGS&&(F===D&&(F=Sr(F)),me(F,$.ADD_TAGS,ke)),$.ADD_ATTR&&(j===q&&(j=Sr(j)),me(j,$.ADD_ATTR,ke)),$.ADD_URI_SAFE_ATTR&&me(ue,$.ADD_URI_SAFE_ATTR,ke),$.FORBID_CONTENTS&&(Pe===Ye&&(Pe=Sr(Pe)),me(Pe,$.FORBID_CONTENTS,ke)),fe&&(F["#text"]=!0),ce&&me(F,["html","head","body"]),F.table&&(me(F,["tbody"]),delete Z.tbody),$.TRUSTED_TYPES_POLICY){if(typeof $.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ii('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof $.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ii('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');O=$.TRUSTED_TYPES_POLICY,L=O.createHTML("")}else O===void 0&&(O=pA(d,i)),O!==null&&typeof L=="string"&&(L=O.createHTML(""));_t&&_t($),wr=$}},ku=me({},[...xa,...Aa,...nA]),Mu=me({},[...Sa,...iA]),H0=function($){let z=S($);(!z||!z.tagName)&&(z={namespaceURI:je,tagName:"template"});const ee=So($.tagName),Me=So(z.tagName);return Bn[$.namespaceURI]?$.namespaceURI===qe?z.namespaceURI===Ue?ee==="svg":z.namespaceURI===Ne?ee==="svg"&&(Me==="annotation-xml"||yr[Me]):!!ku[ee]:$.namespaceURI===Ne?z.namespaceURI===Ue?ee==="math":z.namespaceURI===qe?ee==="math"&&Jt[Me]:!!Mu[ee]:$.namespaceURI===Ue?z.namespaceURI===qe&&!Jt[Me]||z.namespaceURI===Ne&&!yr[Me]?!1:!Mu[ee]&&(Cs[ee]||!ku[ee]):!!(At==="application/xhtml+xml"&&Bn[$.namespaceURI]):!1},rr=function($){Si(t.removed,{element:$});try{S($).removeChild($)}catch{m($)}},$n=function($,z){try{Si(t.removed,{attribute:z.getAttributeNode($),from:z})}catch{Si(t.removed,{attribute:null,from:z})}if(z.removeAttribute($),$==="is")if(ge||Ee)try{rr(z)}catch{}else try{z.setAttribute($,"")}catch{}},Hu=function($){let z=null,ee=null;if(ve)$="<remove></remove>"+$;else{const Qe=Af($,/^[\r\n\t ]+/);ee=Qe&&Qe[0]}At==="application/xhtml+xml"&&je===Ue&&($='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+$+"</body></html>");const Me=O?O.createHTML($):$;if(je===Ue)try{z=new h().parseFromString(Me,At)}catch{}if(!z||!z.documentElement){z=E.createDocument(je,"template",null);try{z.documentElement.innerHTML=Wt?L:Me}catch{}}const ft=z.body||z.documentElement;return $&&ee&&ft.insertBefore(r.createTextNode(ee),ft.childNodes[0]||null),je===Ue?x.call(z,ce?"html":"body")[0]:ce?z.documentElement:ft},Du=function($){return I.call($.ownerDocument||$,$,f.SHOW_ELEMENT|f.SHOW_COMMENT|f.SHOW_TEXT|f.SHOW_PROCESSING_INSTRUCTION|f.SHOW_CDATA_SECTION,null)},$s=function($){return $ instanceof c&&(typeof $.nodeName!="string"||typeof $.textContent!="string"||typeof $.removeChild!="function"||!($.attributes instanceof u)||typeof $.removeAttribute!="function"||typeof $.setAttribute!="function"||typeof $.namespaceURI!="string"||typeof $.insertBefore!="function"||typeof $.hasChildNodes!="function")},Fu=function($){return typeof a=="function"&&$ instanceof a};function _r(ne,$,z){mo(ne,ee=>{ee.call(t,$,z,wr)})}const qu=function($){let z=null;if(_r(T.beforeSanitizeElements,$,null),$s($))return rr($),!0;const ee=ke($.nodeName);if(_r(T.uponSanitizeElement,$,{tagName:ee,allowedTags:F}),K&&$.hasChildNodes()&&!Fu($.firstElementChild)&&yt(/<[/\w!]/g,$.innerHTML)&&yt(/<[/\w!]/g,$.textContent)||$.nodeType===Ri.progressingInstruction||K&&$.nodeType===Ri.comment&&yt(/<[/\w]/g,$.data))return rr($),!0;if(!F[ee]||Z[ee]){if(!Z[ee]&&zu(ee)&&(M.tagNameCheck instanceof RegExp&&yt(M.tagNameCheck,ee)||M.tagNameCheck instanceof Function&&M.tagNameCheck(ee)))return!1;if(fe&&!Pe[ee]){const Me=S($)||$.parentNode,ft=A($)||$.childNodes;if(ft&&Me){const Qe=ft.length;for(let St=Qe-1;St>=0;--St){const xr=g(ft[St],!0);xr.__removalCount=($.__removalCount||0)+1,Me.insertBefore(xr,v($))}}}return rr($),!0}return $ instanceof l&&!H0($)||(ee==="noscript"||ee==="noembed"||ee==="noframes")&&yt(/<\/no(script|embed|frames)/i,$.innerHTML)?(rr($),!0):(Y&&$.nodeType===Ri.text&&(z=$.textContent,mo([P,C,N],Me=>{z=Ti(z,Me," ")}),$.textContent!==z&&(Si(t.removed,{element:$.cloneNode()}),$.textContent=z)),_r(T.afterSanitizeElements,$,null),!1)},ju=function($,z,ee){if(We&&(z==="id"||z==="name")&&(ee in r||ee in Er))return!1;if(!(V&&!ae[z]&&yt(_,z))){if(!(he&&yt(b,z))){if(!j[z]||ae[z]){if(!(zu($)&&(M.tagNameCheck instanceof RegExp&&yt(M.tagNameCheck,$)||M.tagNameCheck instanceof Function&&M.tagNameCheck($))&&(M.attributeNameCheck instanceof RegExp&&yt(M.attributeNameCheck,z)||M.attributeNameCheck instanceof Function&&M.attributeNameCheck(z))||z==="is"&&M.allowCustomizedBuiltInElements&&(M.tagNameCheck instanceof RegExp&&yt(M.tagNameCheck,ee)||M.tagNameCheck instanceof Function&&M.tagNameCheck(ee))))return!1}else if(!ue[z]){if(!yt(U,Ti(ee,k,""))){if(!((z==="src"||z==="xlink:href"||z==="href")&&$!=="script"&&Jx(ee,"data:")===0&&Ae[$])){if(!(J&&!yt(w,Ti(ee,k,"")))){if(ee)return!1}}}}}}return!0},zu=function($){return $!=="annotation-xml"&&Af($,B)},Wu=function($){_r(T.beforeSanitizeAttributes,$,null);const{attributes:z}=$;if(!z||$s($))return;const ee={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:j,forceKeepAttr:void 0};let Me=z.length;for(;Me--;){const ft=z[Me],{name:Qe,namespaceURI:St,value:xr}=ft,yi=ke(Qe),Us=xr;let ht=Qe==="value"?Us:eA(Us);if(ee.attrName=yi,ee.attrValue=ht,ee.keepAttr=!0,ee.forceKeepAttr=void 0,_r(T.uponSanitizeAttribute,$,ee),ht=ee.attrValue,G&&(yi==="id"||yi==="name")&&($n(Qe,$),ht=te+ht),K&&yt(/((--!?|])>)|<\/(style|title)/i,ht)){$n(Qe,$);continue}if(ee.forceKeepAttr)continue;if(!ee.keepAttr){$n(Qe,$);continue}if(!ie&&yt(/\/>/i,ht)){$n(Qe,$);continue}Y&&mo([P,C,N],Vu=>{ht=Ti(ht,Vu," ")});const Gu=ke($.nodeName);if(!ju(Gu,yi,ht)){$n(Qe,$);continue}if(O&&typeof d=="object"&&typeof d.getAttributeType=="function"&&!St)switch(d.getAttributeType(Gu,yi)){case"TrustedHTML":{ht=O.createHTML(ht);break}case"TrustedScriptURL":{ht=O.createScriptURL(ht);break}}if(ht!==Us)try{St?$.setAttributeNS(St,Qe,ht):$.setAttribute(Qe,ht),$s($)?rr($):xf(t.removed)}catch{$n(Qe,$)}}_r(T.afterSanitizeAttributes,$,null)},D0=function ne($){let z=null;const ee=Du($);for(_r(T.beforeSanitizeShadowDOM,$,null);z=ee.nextNode();)_r(T.uponSanitizeShadowNode,z,null),qu(z),Wu(z),z.content instanceof o&&ne(z.content);_r(T.afterSanitizeShadowDOM,$,null)};return t.sanitize=function(ne){let $=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=null,ee=null,Me=null,ft=null;if(Wt=!ne,Wt&&(ne="<!-->"),typeof ne!="string"&&!Fu(ne))if(typeof ne.toString=="function"){if(ne=ne.toString(),typeof ne!="string")throw Ii("dirty is not a string, aborting")}else throw Ii("toString is not a function");if(!t.isSupported)return ne;if(oe||Bs($),t.removed=[],typeof ne=="string"&&(le=!1),le){if(ne.nodeName){const xr=ke(ne.nodeName);if(!F[xr]||Z[xr])throw Ii("root node is forbidden and cannot be sanitized in-place")}}else if(ne instanceof a)z=Hu("<!---->"),ee=z.ownerDocument.importNode(ne,!0),ee.nodeType===Ri.element&&ee.nodeName==="BODY"||ee.nodeName==="HTML"?z=ee:z.appendChild(ee);else{if(!ge&&!Y&&!ce&&ne.indexOf("<")===-1)return O&&Ce?O.createHTML(ne):ne;if(z=Hu(ne),!z)return ge?null:Ce?L:""}z&&ve&&rr(z.firstChild);const Qe=Du(le?ne:z);for(;Me=Qe.nextNode();)qu(Me),Wu(Me),Me.content instanceof o&&D0(Me.content);if(le)return ne;if(ge){if(Ee)for(ft=y.call(z.ownerDocument);z.firstChild;)ft.appendChild(z.firstChild);else ft=z;return(j.shadowroot||j.shadowrootmode)&&(ft=R.call(n,ft,!0)),ft}let St=ce?z.outerHTML:z.innerHTML;return ce&&F["!doctype"]&&z.ownerDocument&&z.ownerDocument.doctype&&z.ownerDocument.doctype.name&&yt(k0,z.ownerDocument.doctype.name)&&(St="<!DOCTYPE "+z.ownerDocument.doctype.name+`>
`+St),Y&&mo([P,C,N],xr=>{St=Ti(St,xr," ")}),O&&Ce?O.createHTML(St):St},t.setConfig=function(){let ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Bs(ne),oe=!0},t.clearConfig=function(){wr=null,oe=!1},t.isValidAttribute=function(ne,$,z){wr||Bs({});const ee=ke(ne),Me=ke($);return ju(ee,Me,z)},t.addHook=function(ne,$){typeof $=="function"&&Si(T[ne],$)},t.removeHook=function(ne,$){if($!==void 0){const z=Yx(T[ne],$);return z===-1?void 0:Qx(T[ne],z,1)[0]}return xf(T[ne])},t.removeHooks=function(ne){T[ne]=[]},t.removeAllHooks=function(){T=Lf()},t}var Pf=M0(),gA=xe('<img alt="" class="preview-image svelte-1q295mp"/>'),vA=xe('<span class="preview-placeholder svelte-1q295mp"> </span>'),mA=xe('<div class="post-preview svelte-1q295mp"><div class="preview-content svelte-1q295mp"><!></div></div>');function bA(e,t){Yt(t,!1);const[r,n]=dn(),i=()=>It(gn,"$_",r),o=Se();let s=we(t,"content",8,"");const a=new Vx;De(()=>Ve(s()),()=>{W(o,a.parseContentWithImages(s()))}),Nn(),Dr();var l=mA(),f=se(l),u=se(f);{var c=d=>{var p=Zt(),g=rt(p);gh(g,1,()=>H(o),ph,(m,v)=>{var A=Zt(),S=rt(A);{var O=E=>{var I=gA();Te(()=>Tn(I,"src",(H(v),X(()=>H(v).value)))),re(E,I)},L=E=>{var I=Zt(),y=rt(I);Qg(y,()=>(Ve(Pf),Ve(hl),H(v),X(()=>Pf.sanitize(hl(H(v).value).replace(/\n/g,"<br>"))))),re(E,I)};Be(S,E=>{H(v),X(()=>H(v).type==="image")?E(O):E(L,!1)})}re(m,A)}),re(d,p)},h=d=>{var p=vA(),g=se(p);Te(m=>Le(g,m),[()=>(i(),X(()=>i()("preview")))]),re(d,p)};Be(u,d=>{Ve(s()),X(()=>s().trim())?d(c):d(h,!1)})}re(e,l),Qt(),n()}var yA=xe('<div class="dialog-overlay svelte-1w7llls" role="presentation"><div role="dialog" aria-modal="true" tabindex="0"><!></div></div>');function Ns(e,t){const r=dv(t,["children","$$slots","$$events","$$legacy"]);Yt(t,!1);let n=we(t,"show",8,!1),i=we(t,"onClose",8),o=we(t,"ariaLabel",8,"Dialog"),s=we(t,"className",8,"");Dr();var a=Zt(),l=rt(a);{var f=u=>{var c=yA(),h=se(c),d=se(h);bh(d,t,"default",{}),Te(()=>{Tn(c,"aria-label",o()),Nl(h,1,`dialog ${s()??""} ${Ve(r),X(()=>r.class||"")??""}`,"svelte-1w7llls")}),ur("click",h,uv(function(p){xh.call(this,t,p)})),ur("keydown",h,p=>{p.key==="Escape"&&i()()}),ur("click",c,function(...p){i()?.apply(this,p)}),ur("keydown",c,p=>{(p.key==="Enter"||p.key===" ")&&i()()}),re(u,c)};Be(l,u=>{n()&&u(f)})}re(e,a),Qt()}var wA=xe('<div class="post-status error svelte-73585z"> </div>'),EA=xe('<div class="post-status success svelte-73585z"> </div>'),_A=xe('<div class="image-icon svg-icon svelte-73585z"></div>'),xA=xe('<div class="plane-icon svg-icon svelte-73585z"></div>'),AA=xe('<div class="upload-error svelte-73585z"> </div>'),SA=xe('<div class="secretkey-dialog-content svelte-73585z"><div class="secretkey-dialog-message svelte-73585z"> </div> <div class="secretkey-dialog-buttons svelte-73585z"><!> <!></div></div>'),TA=xe('<div class="post-container svelte-73585z"><div class="post-actions svelte-73585z"><!> <!> <div class="buttons-container svelte-73585z"><!> <!></div></div> <div class="input-preview-wrapper svelte-73585z"><!> <div><textarea id="post-input" name="postContent" class="post-input svelte-73585z" rows="5"></textarea></div></div> <input type="file" accept="image/*" multiple style="display: none;"/> <!></div> <!>',1);function IA(e,t){Yt(t,!1);const[r,n]=dn(),i=()=>It(gn,"$_",r);let o=we(t,"rxNostr",8),s=we(t,"hasStoredKey",8);const a=!1;let l=we(t,"onPostSuccess",8),f=we(t,"onUploadStatusChange",8),u=we(t,"onUploadProgress",8),c=Se(""),h=Se({sending:!1,success:!1,error:!1,message:""}),d=Se(!1),p=Se(""),g=Se(!1),m=Se(),v=Se(),A=Se(!1),S="";const O={onProgress:u()};async function L(G,te=1500){W(d,!0),f()?.(!0);try{const fe=await G;return await new Promise(le=>setTimeout(le,te)),fe}finally{W(d,!1),f()?.(!1)}}function E(G,te=3e3){W(p,G),setTimeout(()=>W(p,""),te)}async function I(G){const te=Array.from(G);if(!te.length)return;const fe=localStorage.getItem("uploadEndpoint")||"",le=await L((async()=>{W(p,"");try{if(te.length===1){const de=wa.validateImageFile(te[0]);return de.isValid?[await wa.uploadFileWithCallbacks(te[0],fe,O)]:(E(i()(de.errorMessage||"upload_failed")),null)}return await wa.uploadMultipleFilesWithCallbacks(te,fe,O)}catch(de){return E(de instanceof Error?de.message:String(de),5e3),null}})());if(le){const de=[],Pe=[];for(let Ye=0;Ye<le.length;Ye++){const Ae=le[Ye];Ae.success&&Ae.url?de.push({url:Ae.url}):Ae.success||Pe.push(Ae)}de.length&&y(de.map(Ye=>Ye.url).join(`
`)),Pe.length&&E(Pe.length===1?Pe[0].error||i()("upload_failed"):`${Pe.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`,5e3)}H(m)&&Ig(m,H(m).value="")}function y(G){const te=document.querySelector(".post-input");if(te){const fe=te.selectionStart||0,le=te.selectionEnd||0,de=H(c).substring(0,fe),Pe=H(c).substring(le),Ye=de&&!de.endsWith(`
`),Ae=Pe&&!Pe.startsWith(`
`);W(c,de+(Ye?`
`:"")+G+(Ae?`
`:"")+Pe),setTimeout(()=>{te.focus();const st=fe+G.length+(Ye?1:0);te.setSelectionRange(st,st)},0)}else{const fe=H(c)&&!H(c).endsWith(`
`);W(c,H(c)+((fe?`
`:"")+G+`
`))}}function x(){H(m)?.click()}async function R(G){const te=G.target.files;te?.length&&await I(te)}function T(G){G.preventDefault(),W(g,!0)}function P(){W(g,!1)}async function C(G){G.preventDefault(),W(g,!1);const te=G.dataTransfer?.files;te?.length&&await I(te)}async function N(){if(!H(v))return console.error("PostManager is not initialized");if(E0(H(c))){S=H(c),W(A,!0);return}await w()}async function _(){W(A,!1),W(c,S),await w(),S=""}function b(){W(A,!1),S=""}async function w(){if(!H(v))return console.error("PostManager is not initialized");W(h,{sending:!0,success:!1,error:!1,message:""});try{const G=await H(v).submitPost(H(c));G.success?(W(h,{sending:!1,success:!0,error:!1,message:"post_success"}),k(),l()?.(),B()):W(h,{sending:!1,success:!1,error:!0,message:G.error||"post_error"})}catch(G){W(h,{sending:!1,success:!1,error:!0,message:"post_error"}),console.error("æç¨¿å¦çã§ã¨ã©ã¼ãçºç:",G)}}function k(){W(c,"")}function B(){setTimeout(()=>W(h,{...H(h),success:!1,message:""}),3e3)}function U(G){(G.ctrlKey||G.metaKey)&&(G.key==="Enter"||G.key==="NumpadEnter")&&(G.preventDefault(),!H(h).sending&&H(c).trim()&&s()&&N())}De(()=>(Ve(o()),H(v),wf),()=>{o()&&(H(v)?H(v).setRxNostr(o()):W(v,new wf(o())))}),De(()=>(H(c),H(h)),()=>{H(c)&&H(h).error&&W(h,{...H(h),error:!1,message:""})}),Nn(),Dr();var F=TA(),D=rt(F),j=se(D),q=se(j);{var M=G=>{var te=wA(),fe=se(te);Te(le=>Le(fe,le),[()=>(i(),H(h),X(()=>i()(H(h).message)))]),re(G,te)};Be(q,G=>{H(h),X(()=>H(h).error)&&G(M)})}var Z=pe(q,2);{var ae=G=>{var te=EA(),fe=se(te);Te(le=>Le(fe,le),[()=>(i(),H(h),X(()=>i()(H(h).message)))]),re(G,te)};Be(Z,G=>{H(h),X(()=>H(h).success)&&G(ae)})}var he=pe(Z,2),V=se(he);{let G=Ct(()=>(Ve(s()),H(h),H(d),X(()=>!s()||H(h).sending||H(d)))),te=Ct(()=>(i(),X(()=>i()("upload_image"))));it(V,{className:"image-button btn-angular",get disabled(){return H(G)},get ariaLabel(){return H(te)},$$events:{click:x},children:(fe,le)=>{var de=_A();re(fe,de)},$$slots:{default:!0}})}var J=pe(V,2);{let G=Ct(()=>(H(c),H(h),Ve(s()),X(()=>!H(c).trim()||H(h).sending||!s()))),te=Ct(()=>(i(),X(()=>i()("post"))));it(J,{className:"post-button btn-angular",get disabled(){return H(G)},get ariaLabel(){return H(te)},$$events:{click:N},children:(fe,le)=>{var de=xA();re(fe,de)},$$slots:{default:!0}})}var ie=pe(j,2),Y=se(ie);bA(Y,{get content(){return H(c)}});var K=pe(Y,2);let ce;var oe=se(K),ve=pe(ie,2);Na(ve,G=>W(m,G),()=>H(m));var ge=pe(ve,2);{var Ee=G=>{var te=AA(),fe=se(te);Te(()=>Le(fe,H(p))),re(G,te)};Be(ge,G=>{H(p)&&G(Ee)})}var Ce=pe(D,2);{let G=Ct(()=>(i(),X(()=>i()("warning"))));Ns(Ce,{get ariaLabel(){return H(G)},onClose:b,get show(){return H(A)},set show(te){W(A,te)},children:(te,fe)=>{var le=SA(),de=se(le),Pe=se(de),Ye=pe(de,2),Ae=se(Ye);it(Ae,{className:"btn cancel",$$events:{click:b},children:(ue,$e)=>{var Ne=qt();Te(qe=>Le(Ne,qe),[()=>(i(),X(()=>i()("cancel")))]),re(ue,Ne)},$$slots:{default:!0}});var st=pe(Ae,2);it(st,{className:"btn danger",$$events:{click:_},children:(ue,$e)=>{var Ne=qt();Te(qe=>Le(Ne,qe),[()=>(i(),X(()=>i()("post")))]),re(ue,Ne)},$$slots:{default:!0}}),Te(ue=>Le(Pe,ue),[()=>(i(),X(()=>i()("secret_key_detected")))]),re(te,le)},$$slots:{default:!0},$$legacy:!0})}Te((G,te)=>{ce=Nl(K,1,"textarea-container svelte-73585z",null,ce,G),Tn(oe,"placeholder",te),oe.disabled=(H(h),X(()=>H(h).sending))},[()=>({"drag-over":H(g)}),()=>(i(),X(()=>i()("enter_your_text")))]),_h(oe,()=>H(c),G=>W(c,G)),ur("dragover",oe,T),ur("dragleave",oe,P),ur("drop",oe,C),ur("keydown",oe,U),ur("change",ve,R),re(e,F),Bi(t,"isNostrLoginAuth",a),Bi(t,"uploadFiles",I),Bi(t,"resetPostContent",k);var We=Qt({isNostrLoginAuth:a,uploadFiles:I,resetPostContent:k});return n(),We}var OA=xe('<div class="xmark-icon svg-icon svelte-1mxmpr1" aria-label="éãã"></div>'),RA=xe('<div class="lang-icon-btn svg-icon svelte-1mxmpr1" aria-label="Language"></div>'),LA=xe("<option> </option>"),PA=xe('<div class="modal-header svelte-1mxmpr1"><span> </span> <!></div> <div class="modal-body svelte-1mxmpr1"><div class="setting-section svelte-1mxmpr1"><span class="setting-label svelte-1mxmpr1">Language/è¨èª</span> <div class="setting-control svelte-1mxmpr1"><!></div></div> <div class="setting-section svelte-1mxmpr1"><span class="setting-label svelte-1mxmpr1"> </span> <div class="setting-control svelte-1mxmpr1"><select id="endpoint-select" class="svelte-1mxmpr1"></select></div></div></div> <div class="settings-footer svelte-1mxmpr1"><a href="https://github.com/Lokuyow/ehagaki" target="_blank" rel="noopener noreferrer" aria-label="GitHub Repository" class="github-link svelte-1mxmpr1"><div class="github-icon svg-icon svelte-1mxmpr1" aria-label="GitHub"></div></a></div>',1);function NA(e,t){Yt(t,!1);const[r,n]=dn(),i=()=>It(gr,"$locale",r),o=()=>It(gn,"$_",r);let s=we(t,"show",8,!1),a=we(t,"onClose",8);const l=[{label:"yabu.me",url:"https://yabu.me/api/v2/media"},{label:"nostpic.com",url:"https://nostpic.com/api/v2/media"},{label:"nostrcheck.me",url:"https://nostrcheck.me/api/v2/media"},{label:"nostr.build",url:"https://nostr.build/api/v2/nip96/upload"}];function f(h){return h==="ja"?"https://yabu.me/api/v2/media":"https://nostrcheck.me/api/v2/media"}let u=Se();Bl(()=>{const h=localStorage.getItem("locale"),d=navigator.language,p=h||(d&&d.startsWith("ja")?"ja":"en"),g=localStorage.getItem("uploadEndpoint");g&&l.some(m=>m.url===g)?W(u,g):W(u,f(p))});function c(){gr.set(i()==="ja"?"en":"ja")}De(()=>i(),()=>{i()&&(localStorage.getItem("uploadEndpoint")||W(u,f(i())))}),De(()=>H(u),()=>{H(u)&&localStorage.setItem("uploadEndpoint",H(u))}),Nn(),Dr();{let h=Ct(()=>(o(),X(()=>o()("settings")||"è¨­å®")));Ns(e,{get show(){return s()},get onClose(){return a()},get ariaLabel(){return H(h)},className:"settings-dialog",children:(d,p)=>{var g=PA(),m=rt(g),v=se(m),A=se(v),S=pe(v,2);it(S,{className:"modal-close btn-circle",ariaLabel:"éãã",$$events:{click(...C){a()?.apply(this,C)}},children:(C,N)=>{var _=OA();re(C,_)},$$slots:{default:!0}});var O=pe(m,2),L=se(O),E=pe(se(L),2),I=se(E);it(I,{className:"lang-btn btn",$$events:{click:c},children:(C,N)=>{var _=RA();re(C,_)},$$slots:{default:!0}});var y=pe(L,2),x=se(y),R=se(x),T=pe(x,2),P=se(T);Te(()=>{H(u),kg(()=>{})}),gh(P,5,()=>l,ph,(C,N)=>{var _=LA(),b=se(_),w={};Te(()=>{Le(b,(H(N),X(()=>H(N).label))),w!==(w=(H(N),X(()=>H(N).url)))&&(_.value=(_.__value=(H(N),X(()=>H(N).url)))??"")}),re(C,_)}),Te((C,N)=>{Le(A,C),Le(R,N)},[()=>(o(),X(()=>o()("settings")||"è¨­å®")),()=>(o(),X(()=>o()("upload_destination")||"ã¢ããã­ã¼ãå"))]),iv(P,()=>H(u),C=>W(u,C)),re(d,g)},$$slots:{default:!0}})}Qt(),n()}var CA=xe('<h2 class="svelte-62fs7m"> </h2> <p> </p> <div class="dialog-buttons svelte-62fs7m"><!> <!></div>',1);function BA(e,t){Yt(t,!1);const[r,n]=dn(),i=()=>It(gn,"$_",r);let o=we(t,"show",8,!1),s=we(t,"onClose",8),a=we(t,"onLogout",8);Dr();{let l=Ct(()=>(i(),X(()=>i()("logout_confirmation"))));Ns(e,{get show(){return o()},get onClose(){return s()},get ariaLabel(){return H(l)},className:"logout-dialog",children:(f,u)=>{var c=CA(),h=rt(c),d=se(h),p=pe(h,2),g=se(p),m=pe(p,2),v=se(m);it(v,{className:"cancel-btn btn-angular",$$events:{click(...S){s()?.apply(this,S)}},children:(S,O)=>{var L=qt();Te(E=>Le(L,E),[()=>(i(),X(()=>i()("cancel")))]),re(S,L)},$$slots:{default:!0}});var A=pe(v,2);it(A,{className:"logout-btn btn-angular",$$events:{click(...S){a()?.apply(this,S)}},children:(S,O)=>{var L=qt();Te(E=>Le(L,E),[()=>(i(),X(()=>i()("logout")))]),re(S,L)},$$slots:{default:!0}}),Te((S,O)=>{Le(d,S),Le(g,O)},[()=>(i(),X(()=>i()("logout_confirmation"))),()=>(i(),X(()=>i()("logout_warning")))]),re(f,c)},$$slots:{default:!0}})}Qt(),n()}var $A=xe('<div class="btn-placeholder svelte-12hj3c0" aria-label="Launching"></div>'),UA=xe('<span class="pubkey-value svelte-12hj3c0" style="word-break:break-all"> </span>'),kA=xe('<span class="profilekey-value svelte-12hj3c0" style="word-break:break-all"> </span>'),MA=xe('<p class="error-message svelte-12hj3c0"> </p>'),HA=xe('<!> <div class="divider svelte-12hj3c0"><span class="svelte-12hj3c0"> </span></div> <h3 class="svelte-12hj3c0"> </h3> <input type="password" placeholder="nsec1â¦" class="secret-input svelte-12hj3c0" id="secretKey" name="secretKey"/> <div class="dialog-info svelte-12hj3c0"><!> <!> <!></div> <div class="dialog-buttons svelte-12hj3c0"><!> <!> <!></div>',1);function DA(e,t){Yt(t,!1);const[r,n]=dn(),i=()=>It(gn,"$_",r),o=Se(),s=Se(),a=Se();let l=we(t,"secretKey",12),f=we(t,"errorMessage",12,""),u=we(t,"onClose",8),c=we(t,"onSave",8),h=we(t,"onNostrLogin",8);const d=new _0;let p=Se(!1),g=[],m;function v(){g.forEach(I=>I()),g=[]}function A(I,y=500){const x=Date.now()-I,R=Math.max(0,y-x);setTimeout(()=>{W(p,!1)},R)}function S(){W(p,!0);const I=Date.now(),y=()=>{m&&(clearTimeout(m),m=void 0),v(),A(I)},x=()=>y(),R=()=>y(),T=(P,C,N)=>{P.addEventListener(C,N,{once:!0}),g.push(()=>P.removeEventListener(C,N))};T(document,"nlLaunch",x),T(window,"nlLaunch",x),T(document,"nlAuth",R),T(window,"nlAuth",R);try{h()?.()}catch(P){console.error(P),y();return}m=window.setTimeout(y,3e3)}pv(()=>{m&&clearTimeout(m),v()});function O(){u()?.()}function L(){c()?.()}function E(){l("")}De(()=>Ve(l()),()=>{l()!==void 0&&d.setNsec(l())}),De(()=>{},()=>{W(o,!1)}),De(()=>{},()=>{W(s,"")}),De(()=>{},()=>{W(a,"")}),De(()=>{},()=>{d.isValid.subscribe(I=>W(o,I))}),De(()=>{},()=>{d.npub.subscribe(I=>W(s,I))}),De(()=>{},()=>{d.nprofile.subscribe(I=>W(a,I))}),De(()=>(Ve(l()),H(o)),()=>{l()?f(H(o)?"":"invalid_secret"):f("")}),Nn(),Dr();{let I=Ct(()=>(i(),X(()=>i()("input_secret"))));Ns(e,{show:!0,get onClose(){return u()},get ariaLabel(){return H(I)},className:"login-dialog",children:(y,x)=>{var R=HA(),T=rt(R);{let V=Ct(()=>`nostr-login-button btn ${H(p)?"loading":""}`);it(T,{get className(){return H(V)},get disabled(){return H(p)},$$events:{click:S},children:(J,ie)=>{var Y=Zt(),K=rt(Y);{var ce=ve=>{var ge=$A();re(ve,ge)},oe=ve=>{var ge=qt("Nostr Login");re(ve,ge)};Be(K,ve=>{H(p)?ve(ce):ve(oe,!1)})}re(J,Y)},$$slots:{default:!0}})}var P=pe(T,2),C=se(P),N=se(C),_=pe(P,2),b=se(_),w=pe(_,2),k=pe(w,2),B=se(k);{var U=V=>{var J=UA(),ie=se(J);Te(()=>Le(ie,H(s))),re(V,J)};Be(B,V=>{H(s)&&V(U)})}var F=pe(B,2);{var D=V=>{var J=kA(),ie=se(J);Te(()=>Le(ie,H(a))),re(V,J)};Be(F,V=>{H(a)&&V(D)})}var j=pe(F,2);{var q=V=>{var J=MA(),ie=se(J);Te(Y=>Le(ie,Y),[()=>(i(),Ve(f()),X(()=>i()(f())))]),re(V,J)};Be(j,V=>{f()&&V(q)})}var M=pe(k,2),Z=se(M);it(Z,{className:"cancel-btn btn-angular",$$events:{click:O},children:(V,J)=>{var ie=qt();Te(Y=>Le(ie,Y),[()=>(i(),X(()=>i()("cancel")))]),re(V,ie)},$$slots:{default:!0}});var ae=pe(Z,2);it(ae,{className:"clear-btn btn-angular",$$events:{click:E},children:(V,J)=>{var ie=qt();Te(Y=>Le(ie,Y),[()=>(i(),X(()=>i()("clear")))]),re(V,ie)},$$slots:{default:!0}});var he=pe(ae,2);it(he,{className:"save-btn btn-angular",$$events:{click:L},children:(V,J)=>{var ie=qt();Te(Y=>Le(ie,Y),[()=>(i(),X(()=>i()("save")))]),re(V,ie)},$$slots:{default:!0}}),Te((V,J)=>{Le(N,V),Le(b,J)},[()=>(i(),X(()=>i()("or"))),()=>(i(),X(()=>i()("input_secret")))]),_h(w,l),re(y,R)},$$slots:{default:!0}})}Qt(),n()}var FA=xe("<span>æ°ããã³ã³ãã³ããå©ç¨å¯è½ã§ããæ´æ°ãã¿ã³ãã¯ãªãã¯ãã¦æ´æ°ãã¦ãã ããã</span>"),qA=xe('<div class="pwa-toast svelte-vtbuxw" role="alert"><div class="message svelte-vtbuxw"><!></div> <div class="buttons svelte-vtbuxw"><!> <!></div></div>');function jA(e,t){Yt(t,!1);let r=we(t,"show",8),n=we(t,"needRefresh",8),i=we(t,"onReload",8),o=we(t,"onClose",8);De(()=>(Ve(r()),Ve(n())),()=>{console.log("SwUpdateModal props:",{show:r(),needRefresh:n()})}),Nn();var s=Zt(),a=rt(s);{var l=f=>{var u=qA(),c=se(u),h=se(c);{var d=A=>{var S=FA();re(A,S)};Be(h,A=>{n()&&A(d)})}var p=pe(c,2),g=se(p);it(g,{className:"close-btn",ariaLabel:"éãã",$$events:{click(...A){o()?.apply(this,A)}},children:(A,S)=>{var O=qt("éãã");re(A,O)},$$slots:{default:!0}});var m=pe(g,2);{var v=A=>{it(A,{className:"reload-btn",ariaLabel:"æ´æ°",$$events:{click(...S){i()?.apply(this,S)}},children:(S,O)=>{var L=qt("æ´æ°");re(S,L)},$$slots:{default:!0}})};Be(m,A=>{n()&&A(v)})}re(f,u)};Be(a,f=>{r()&&f(l)})}re(e,s),Qt()}var zA=xe('<div class="upload-progress svelte-qkuitq"><div class="progress-text svelte-qkuitq"> <!></div> <div class="progress-bar svelte-qkuitq"><div class="progress-fill svelte-qkuitq"></div></div></div>'),WA=xe('<div class="image-size-info svelte-qkuitq"><div class="size-label svelte-qkuitq"> </div> <div class="size-details svelte-qkuitq"> </div></div>'),GA=xe('<div class="footer-center svelte-qkuitq"><!></div>');function VA(e,t){Yt(t,!1);const[r,n]=dn(),i=()=>It(Ql,"$imageSizeInfoStore",r),o=()=>It(gn,"$_",r),s=Se(),a=Se();let l=we(t,"uploadProgress",28,()=>({total:0,completed:0,failed:0,inProgress:!1}));function f(g){l(g),!g.inProgress&&g.total>0&&setTimeout(()=>{l({total:0,completed:0,failed:0,inProgress:!1})},1e3)}De(()=>i(),()=>{W(s,i().info)}),De(()=>i(),()=>{W(a,i().visible)}),Nn(),Dr();var u=GA(),c=se(u);{var h=g=>{var m=zA(),v=se(m),A=se(v),S=pe(A);{var O=I=>{var y=qt();Te(x=>Le(y,`(${x??""}: ${Ve(l()),X(()=>l().failed)??""})`),[()=>(o(),X(()=>o()("failed")))]),re(I,y)};Be(S,I=>{Ve(l()),X(()=>l().failed>0)&&I(O)})}var L=pe(v,2),E=se(L);Te((I,y)=>{Le(A,`${I??""}: ${Ve(l()),X(()=>l().completed)??""}/${Ve(l()),X(()=>l().total)??""} `),wh(E,`width: ${y??""}%`)},[()=>(o(),X(()=>o()("uploading"))),()=>(Ve(l()),X(()=>l().total>0?Math.round(l().completed/l().total*100):0))]),re(g,m)},d=g=>{var m=Zt(),v=rt(m);{var A=S=>{var O=WA(),L=se(O),E=se(L),I=pe(L,2),y=se(I);Te(x=>{Le(E,`${x??""}:`),Le(y,`${H(s),X(()=>H(s).originalSize)??""} â ${H(s),X(()=>H(s).compressedSize)??""} (${H(s),X(()=>H(s).compressionRatio)??""}%)`)},[()=>(o(),X(()=>o()("data_size")))]),re(S,O)};Be(v,S=>{H(a),H(s),X(()=>H(a)&&H(s)&&H(s).wasCompressed)&&S(A)},!0)}re(g,m)};Be(c,g=>{Ve(l()),X(()=>l().inProgress||l().total>0)?g(h):g(d,!1)})}re(e,u),Bi(t,"updateProgress",f);var p=Qt({updateProgress:f});return n(),p}class Ir{static REQUEST_TIMEOUT=5e3;static RETRY_COUNT=3;static RETRY_DELAY=1e3;sharedImageFile=null;sharedImageMetadata=null;isProcessingSharedImage=!1;requestCallbacks=new Map;constructor(){this.setupServiceWorkerListeners()}setupServiceWorkerListeners(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}handleServiceWorkerMessage(t){const{data:r,type:n,requestId:i}=t.data||{};n==="SHARED_IMAGE"&&(r?.image&&(this.sharedImageFile=r.image,this.sharedImageMetadata=r.metadata||null,ki.set({file:this.sharedImageFile,metadata:this.sharedImageMetadata,received:!0})),i&&this.requestCallbacks.has(i)&&(this.requestCallbacks.get(i)(r),this.requestCallbacks.delete(i)))}dispatchSharedImageEvent(){}static checkIfOpenedFromShare(){return new URLSearchParams(window.location.search).get("shared")==="true"}async checkForSharedImageOnLaunch(){if(!Ir.checkIfOpenedFromShare())return null;this.isProcessingSharedImage=!0;try{this.checkSharedFlagInIndexedDB().catch(()=>{});for(let t=0;t<Ir.RETRY_COUNT;t++){const r=await this.getSharedImageFromServiceWorker();if(r)return this.sharedImageFile=r.image,this.sharedImageMetadata=r.metadata||null,ki.set({file:this.sharedImageFile,metadata:this.sharedImageMetadata,received:!0}),r;t<Ir.RETRY_COUNT-1&&await this.delay(Ir.RETRY_DELAY)}return null}catch(t){return console.error("ShareHandler: å±æç»ååå¾ã¨ã©ã¼",t),null}finally{this.isProcessingSharedImage=!1}}async getSharedImageFromServiceWorker(){if(!("serviceWorker"in navigator))return null;if(!navigator.serviceWorker.controller)try{await this.waitForServiceWorkerController()}catch{return null}if(!navigator.serviceWorker.controller)return null;try{return await this.requestWithMessageChannel()||await this.requestWithEventListener()}catch(t){return console.error("ShareHandler: ServiceWorkeréä¿¡ã¨ã©ã¼",t),null}}async requestWithMessageChannel(){if(!navigator.serviceWorker.controller)return null;const t=new MessageChannel,r=this.generateRequestId(),n=new Promise(i=>{const o=setTimeout(()=>i(null),Ir.REQUEST_TIMEOUT);t.port1.onmessage=s=>{clearTimeout(o);const{data:a}=s.data||{};i(a&&a.image?a:null)}});return navigator.serviceWorker.controller.postMessage({action:"getSharedImage",requestId:r},[t.port2]),n}async requestWithEventListener(){if(!navigator.serviceWorker.controller)return null;const t=this.generateRequestId(),r=new Promise(n=>{this.requestCallbacks.set(t,n),setTimeout(()=>{this.requestCallbacks.delete(t),n(null)},Ir.REQUEST_TIMEOUT)});return navigator.serviceWorker.controller.postMessage({action:"getSharedImage",requestId:t}),r}async waitForServiceWorkerController(){if(!navigator.serviceWorker.controller)return new Promise((t,r)=>{const n=setTimeout(()=>{navigator.serviceWorker.removeEventListener("controllerchange",i),r(new Error("ServiceWorkerã³ã³ãã­ã¼ã©ã¼å¾æ©ã¿ã¤ã ã¢ã¦ã"))},Ir.REQUEST_TIMEOUT),i=()=>{clearTimeout(n),navigator.serviceWorker.removeEventListener("controllerchange",i),setTimeout(t,500)};navigator.serviceWorker.addEventListener("controllerchange",i)})}async checkSharedFlagInIndexedDB(){return new Promise(t=>{try{const r=indexedDB.open("eHagakiSharedData",1);r.onupgradeneeded=n=>{const i=n.target.result;i.objectStoreNames.contains("flags")||i.createObjectStore("flags",{keyPath:"id"})},r.onerror=()=>t(!1),r.onsuccess=n=>{try{const i=n.target.result;if(!i.objectStoreNames.contains("flags")){i.close(),t(!1);return}const s=i.transaction(["flags"],"readwrite").objectStore("flags"),a=s.get("sharedImage");a.onsuccess=()=>{a.result?.value===!0?s.delete("sharedImage").onsuccess=()=>{i.close(),t(!0)}:(i.close(),t(!1))},a.onerror=()=>{i.close(),t(!1)}}catch{t(!1)}}}catch{t(!1)}})}delay(t){return new Promise(r=>setTimeout(r,t))}generateRequestId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}isProcessing(){return this.isProcessingSharedImage}getSharedImageFile(){return this.sharedImageFile}getSharedImageMetadata(){return this.sharedImageMetadata}clearSharedImage(){this.sharedImageFile=null,this.sharedImageMetadata=null}}let Ia=null;function KA(){return Ia||(Ia=new Ir),Ia}function ZA(e={}){const{immediate:t=!1,onNeedRefresh:r,onOfflineReady:n,onRegistered:i,onRegisteredSW:o,onRegisterError:s}=e;let a,l,f;const u=async(h=!0)=>{await l,f?.()};async function c(){if("serviceWorker"in navigator){if(a=await ji(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/ehagaki/sw.js",{scope:"/ehagaki/",type:"classic"})).catch(h=>{s?.(h)}),!a)return;f=()=>{a?.messageSkipWaiting()};{let h=!1;const d=()=>{h=!0,a?.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),r?.()};a.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"&&p.isExternal?d():!h&&n?.():p.isUpdate||n?.()}),a.addEventListener("waiting",d)}a.register({immediate:t}).then(h=>{o?o("/ehagaki/sw.js",h):i?.(h)}).catch(h=>{s?.(h)})}}return l=c(),u}function XA(e={}){const{immediate:t=!0,onNeedRefresh:r,onOfflineReady:n,onRegistered:i,onRegisteredSW:o,onRegisterError:s}=e,a=Bt(!1),l=Bt(!1),f=ZA({immediate:t,onOfflineReady(){l.set(!0),n?.()},onNeedRefresh(){a.set(!0),r?.()},onRegistered:i,onRegisteredSW:o,onRegisterError:s});return{needRefresh:a,offlineReady:l,updateServiceWorker:f}}class YA{initialized=!1;authHandler=null;isLoggingOut=!1;async init(t={}){if(!this.initialized)try{const{init:r}=await ji(async()=>{const{init:s}=await import("./index.esm-COECBPCL.js");return{init:s}},[]),i={...{theme:"default",darkMode:!1,noBanner:!0,methods:["connect","extension","readOnly","local"],perms:"sign_event:1,sign_event:0",startScreen:"welcome"},...t},o=Array.isArray(i.bunkers)?i.bunkers.join(","):i.bunkers;r({...i,bunkers:o,startScreen:i.startScreen,noBanner:!0}),this.setupAuthListener(),this.initialized=!0,console.log("nostr-loginåæåå®äº")}catch(r){throw console.error("nostr-loginåæåã¨ã©ã¼:",r),r}}setupAuthListener(){document.addEventListener("nlAuth",async t=>{if(!this.authHandler||this.isLoggingOut)return;const r=t.detail;if(r.type==="logout")this.authHandler({type:"logout"});else if(r.type==="login"||r.type==="signup"){const n=r.pubkey||(r.npub?await this.npubToPubkey(r.npub):"");this.authHandler({type:r.type,pubkey:n,npub:r.npub,otpData:r.otpData})}})}setAuthHandler(t){this.authHandler=t}showLogin(t){if(!this.initialized){console.warn("nostr-loginãåæåããã¦ãã¾ãã");return}document.dispatchEvent(new CustomEvent("nlLaunch",{detail:t||"welcome"}))}logout(){if(!this.initialized){console.warn("nostr-loginãåæåããã¦ãã¾ãã");return}this.isLoggingOut=!0,document.dispatchEvent(new Event("nlLogout")),setTimeout(()=>{this.isLoggingOut=!1},100)}setDarkMode(t){if(!this.initialized){console.warn("nostr-loginãåæåããã¦ãã¾ãã");return}document.dispatchEvent(new CustomEvent("nlDarkMode",{detail:t}))}async npubToPubkey(t){try{const{generatePublicKeyFormats:r}=await ji(async()=>{const{generatePublicKeyFormats:i}=await Promise.resolve().then(()=>$x);return{generatePublicKeyFormats:i}},void 0);return r(t).hex||""}catch(r){return console.error("npubã®ãã³ã¼ãã¨ã©ã¼:",r),""}}get isInitialized(){return this.initialized}}const Hn=new YA;var QA=xe('<div class="profile-picture placeholder svelte-1ag7yhq" aria-label="Loading"></div> <span class="profile-name placeholder-text svelte-1ag7yhq"> </span>',1),JA=xe('<div class="settings-icon svg-icon svelte-1ag7yhq" aria-label="Settings"></div>'),eS=xe('<main class="svelte-1ag7yhq"><div class="main-content svelte-1ag7yhq"><!></div> <!> <!> <!> <!> <div class="footer-bar svelte-1ag7yhq"><!> <!> <!></div></main>');function tS(e,t){Yt(t,!1);const[r,n]=dn(),i=()=>It(d,"$needRefresh",r),o=()=>It(Wi,"$authState",r),s=()=>It(gr,"$locale",r),a=()=>It(ki,"$sharedImageStore",r),l=()=>It(gn,"$_",r),f=Se(),u=Se(),c=Se(),h=Se(),{needRefresh:d,updateServiceWorker:p}=XA({onRegistered(K){console.log("SW registered:",K)},onRegisterError(K){console.log("SW registration error",K)},onNeedRefresh(){console.log("SW needs refresh - showing prompt")}});function g(){console.log("Closing SW update modal"),d.set(!1)}function m(){console.log("Handling SW update - reloading page"),p(!0)}let v=Se(!1),A=Se(""),S=Se(!1),O=Se("");const L=new _0;let E=Se({name:"",picture:""}),I=Se(!1),y=Se(!0),x=Se(),R,T,P=Se(),C=Se();async function N(K){if(W(x,Gm({verifier:ny})),R=new qw(H(x)),T=new Mx(H(x)),W(y,!0),K){const ce=T.getFromLocalStorage(K);ce?(H(x).setDefaultRelays(ce),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼ãªã¹ããä½¿ç¨:",ce)):T.setBootstrapRelays();const oe=await R.fetchProfileData(K);oe&&(W(E,oe),W(I,!0))}else T.setBootstrapRelays();W(y,!1)}async function _(K){if(K.type==="logout"){j();return}K.pubkey&&(console.log("nostr-loginèªè¨¼æå:",K),L.setNostrLoginAuth(K),await N(K.pubkey),T&&await T.fetchUserRelays(K.pubkey),setTimeout(async()=>{await b(K.pubkey)},500),W(v,!1))}async function b(K){if(!K)return;(!T||!R)&&(console.warn("relayManagerã¾ãã¯profileManagerãåæåããã¦ãã¾ãã"),await N(K)),W(y,!0);const ce=await R.fetchProfileData(K);ce&&W(E,ce),W(I,!0),W(y,!1)}async function w(){if(!o().isValid){W(A,"");return}Zn.saveToStorage(H(O))?(W(v,!1),W(A,""),H(c)&&(T&&await T.fetchUserRelays(H(c)),await b(H(c)))):(W(A,"error_saving"),L.clear())}function k(){W(v,!0)}function B(){W(v,!1),W(A,"")}function U(){W(S,!0)}function F(){W(S,!1)}function D(){j(),Hn.isInitialized&&Hn.logout()}function j(){const K=localStorage.getItem("locale"),ce=localStorage.getItem("uploadEndpoint");localStorage.clear(),K!==null&&localStorage.setItem("locale",K),ce!==null&&localStorage.setItem("uploadEndpoint",ce),W(O,""),L.clear(),W(E,{name:"",picture:""}),W(I,!1),H(C)&&typeof H(C).resetPostContent=="function"&&H(C).resetPostContent(),W(S,!1),H(P)&&typeof H(P).updateProgress=="function"&&H(P).updateProgress({total:0,completed:0,failed:0,inProgress:!1}),Qw()}async function q(){try{if(!Hn.isInitialized){console.error("nostr-loginãåæåããã¦ãã¾ãã");return}Hn.showLogin(),await new Promise(K=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(()=>K()):setTimeout(()=>K(),0)})}catch(K){console.error("nostr-loginèµ·åä¸­ã«ã¨ã©ã¼:",K)}}let M=Se(!1);function Z(){W(M,!0)}function ae(){W(M,!1)}Bl(async()=>{const K=localStorage.getItem("locale");K&&K!==s()&&gr.set(K);try{await Hn.init({theme:"default",darkMode:!1,perms:"sign_event:1,sign_event:0",noBanner:!0}),Hn.setAuthHandler(_)}catch(oe){console.error("nostr-loginåæåå¤±æ:",oe)}const ce=Zn.loadFromStorage();ce?(L.setNsec(ce),setTimeout(async()=>{H(c)?(await N(H(c)),await b(H(c))):await N(),W(y,!1)},10)):(await N(),W(y,!1));try{console.log("å±æç»åã®ç¢ºèªãéå§ãã¾ã"),await KA().checkForSharedImageOnLaunch()}catch(oe){console.error("å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼ãçºçãã¾ãã:",oe)}});function he(K){}function V(K){H(P)&&H(P).updateProgress(K)}De(()=>i(),()=>{console.log("SW states:",{needRefresh:i(),showModal:i()})}),De(()=>i(),()=>{W(f,i())}),De(()=>H(O),()=>{L.setNsec(H(O))}),De(()=>o(),()=>{W(u,o().isAuthenticated)}),De(()=>o(),()=>{W(c,o().pubkey)}),De(()=>o(),()=>{W(h,o().type==="nostr-login")}),De(()=>s(),()=>{s()&&localStorage.setItem("locale",s())}),De(()=>(a(),H(C),ki),()=>{a().received&&a().file&&H(C)&&(H(C).uploadFiles([a().file]),ki.set({file:null,metadata:void 0,received:!1}))}),Nn(),Dr();var J=Zt(),ie=rt(J);{var Y=K=>{var ce=eS(),oe=se(ce),ve=se(oe);Na(IA(ve,{get rxNostr(){return H(x)},get hasStoredKey(){return H(u)},get isNostrLoginAuth(){return H(h)},onPostSuccess:()=>{},onUploadStatusChange:he,onUploadProgress:V,$$legacy:!0}),ue=>W(C,ue),()=>H(C));var ge=pe(oe,2);{var Ee=ue=>{DA(ue,{get errorMessage(){return H(A)},onClose:B,onSave:w,onNostrLogin:q,get secretKey(){return H(O)},set secretKey($e){W(O,$e)},$$legacy:!0})};Be(ge,ue=>{H(v)&&ue(Ee)})}var Ce=pe(ge,2);{var We=ue=>{BA(ue,{get show(){return H(S)},onClose:F,onLogout:D})};Be(Ce,ue=>{H(S)&&ue(We)})}var G=pe(Ce,2);NA(G,{get show(){return H(M)},onClose:ae});var te=pe(G,2);{var fe=ue=>{jA(ue,{get show(){return H(f)},get needRefresh(){return i()},onReload:m,onClose:g})};Be(te,ue=>{H(f)&&ue(fe)})}var le=pe(te,2),de=se(le);{var Pe=ue=>{it(ue,{className:"profile-display btn-round loading",disabled:!0,children:($e,Ne)=>{var qe=QA(),Ue=pe(rt(qe),2),je=se(Ue);Te(Wt=>Le(je,Wt),[()=>(l(),X(()=>l()("loading")))]),re($e,qe)},$$slots:{default:!0}})},Ye=ue=>{var $e=Zt(),Ne=rt($e);{var qe=je=>{Kw(je,{get profileData(){return H(E)},get hasStoredKey(){return H(u)},get isLoadingProfile(){return H(y)},showLogoutDialog:U})},Ue=je=>{it(je,{className:"login-btn btn-round",$$events:{click:k},children:(Wt,Bn)=>{var Gr=qt();Te(yr=>Le(Gr,yr),[()=>(l(),X(()=>l()("login")))]),re(Wt,Gr)},$$slots:{default:!0}})};Be(Ne,je=>{H(u)&&(H(I)||H(y))?je(qe):je(Ue,!1)},!0)}re(ue,$e)};Be(de,ue=>{H(y)?ue(Pe):ue(Ye,!1)})}var Ae=pe(de,2);Na(VA(Ae,{$$legacy:!0}),ue=>W(P,ue),()=>H(P));var st=pe(Ae,2);it(st,{className:"settings-btn btn-circle",ariaLabel:"è¨­å®",$$events:{click:Z},children:(ue,$e)=>{var Ne=JA();re(ue,Ne)},$$slots:{default:!0}}),re(K,ce)};Be(ie,K=>{s()&&K(Y)})}re(e,J),Qt(),n()}Vg(tS,{target:document.getElementById("app")});
