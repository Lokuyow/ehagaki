const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ffmpegCompression-DNa948eV.js","assets/vendor-video-BBTp-AV6.js","assets/baseCompression-DThwcD4_.js","assets/vendor-ui-Dfbvke9w.js","assets/vendor-ui-BpcL6yKj.css","assets/vendor-nostr-CSSTtp-a.js","assets/vendor-zap-DuBBJg9r.js","assets/vendor-editor-DymEIdpa.js","assets/vendor-image-DhZoa7y2.js","assets/mediabunnyCompression-BhROnLrz.js"])))=>i.map(i=>d[i]);
import{z as mr,A as fr,B,p as We,C as v,D as a,E as tl,a as He,b as pe,f as H,i as se,F as y,s as L,G as N,t as K,j as w,k as Ue,H as et,I as je,J as z,g as Et,K as Ie,x as Sa,q as Rt,y as rl,L as qr,d as re,M as we,N as ft,e as st,O as Je,n as Se,P as Ct,u as On,m as Ea,c as jr,Q as Lt,l as hn,o as ir,R as be,T as nl,U as Ot,V as sl,W as ol,X as al,Y as De,Z as il,_ as yr,$ as pt,a0 as xr,a1 as Yr,a2 as Jt,a3 as xa,a4 as ll,a5 as cl,a6 as ul,a7 as dl,a8 as hl,a9 as Rn,aa as Fn,ab as fl,ac as gl,ad as fn,ae as er,af as tr,ag as rr,ah as pl}from"./vendor-ui-Dfbvke9w.js";import{n as Vt,g as vl,z as gn,G as ts,W as ml,U as yl}from"./vendor-nostr-CSSTtp-a.js";import{g as _l,a as wl}from"./vendor-zap-DuBBJg9r.js";import{E as qt,P as Wt,a as Gt,D as rs,b as Mr,N as Pa,c as bl,S as Ca,m as Sl,F as El,d as xl,i as Pl,e as pn,G as Cl,T as Ll,f as Tl,g as Al,h as Il,j as Ml,k as Dl,l as kl,n as Nl,o as Ol}from"./vendor-editor-DymEIdpa.js";import{i as Rl}from"./vendor-image-DhZoa7y2.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const Fl="modulepreload",Hl=function(t){return"/ehagaki/"+t},qs={},At=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){let c=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=i?.nonce||i?.getAttribute("nonce");s=c(r.map(u=>{if(u=Hl(u),u in qs)return;qs[u]=!0;const d=u.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Fl,d||(h.as="script"),h.crossOrigin="",h.href=u,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((g,p)=>{h.addEventListener("load",g),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return s.then(i=>{for(const l of i||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})};var Hn,Ks;function Ul(){if(Ks)return Hn;Ks=1;var t=function(b){return e(b)&&!r(b)};function e(_){return!!_&&typeof _=="object"}function r(_){var b=Object.prototype.toString.call(_);return b==="[object RegExp]"||b==="[object Date]"||o(_)}var n=typeof Symbol=="function"&&Symbol.for,s=n?Symbol.for("react.element"):60103;function o(_){return _.$$typeof===s}function i(_){return Array.isArray(_)?[]:{}}function l(_,b){return b.clone!==!1&&b.isMergeableObject(_)?m(i(_),_,b):_}function c(_,b,S){return _.concat(b).map(function(T){return l(T,S)})}function u(_,b){if(!b.customMerge)return m;var S=b.customMerge(_);return typeof S=="function"?S:m}function d(_){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(_).filter(function(b){return Object.propertyIsEnumerable.call(_,b)}):[]}function f(_){return Object.keys(_).concat(d(_))}function h(_,b){try{return b in _}catch{return!1}}function g(_,b){return h(_,b)&&!(Object.hasOwnProperty.call(_,b)&&Object.propertyIsEnumerable.call(_,b))}function p(_,b,S){var T={};return S.isMergeableObject(_)&&f(_).forEach(function(P){T[P]=l(_[P],S)}),f(b).forEach(function(P){g(_,P)||(h(_,P)&&S.isMergeableObject(b[P])?T[P]=u(P,S)(_[P],b[P],S):T[P]=l(b[P],S))}),T}function m(_,b,S){S=S||{},S.arrayMerge=S.arrayMerge||c,S.isMergeableObject=S.isMergeableObject||t,S.cloneUnlessOtherwiseSpecified=l;var T=Array.isArray(b),P=Array.isArray(_),E=T===P;return E?T?S.arrayMerge(_,b,S):p(_,b,S):l(b,S)}m.all=function(b,S){if(!Array.isArray(b))throw new Error("first argument should be an array");return b.reduce(function(T,P){return m(T,P,S)},{})};var x=m;return Hn=x,Hn}var Bl=Ul();const $l=_l(Bl);var ns=function(t,e){return ns=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(r[s]=n[s])},ns(t,e)};function An(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ns(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var ke=function(){return ke=Object.assign||function(e){for(var r,n=1,s=arguments.length;n<s;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},ke.apply(this,arguments)};function zl(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function Un(t,e,r){if(r||arguments.length===2)for(var n=0,s=e.length,o;n<s;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}function Bn(t,e){var r=e&&e.cache?e.cache:Xl,n=e&&e.serializer?e.serializer:ql,s=e&&e.strategy?e.strategy:Gl;return s(t,{cache:r,serializer:n})}function jl(t){return t==null||typeof t=="number"||typeof t=="boolean"}function Wl(t,e,r,n){var s=jl(n)?n:r(n),o=e.get(s);return typeof o>"u"&&(o=t.call(this,n),e.set(s,o)),o}function La(t,e,r){var n=Array.prototype.slice.call(arguments,3),s=r(n),o=e.get(s);return typeof o>"u"&&(o=t.apply(this,n),e.set(s,o)),o}function Ta(t,e,r,n,s){return r.bind(e,t,n,s)}function Gl(t,e){var r=t.length===1?Wl:La;return Ta(t,this,r,e.cache.create(),e.serializer)}function Vl(t,e){return Ta(t,this,La,e.cache.create(),e.serializer)}var ql=function(){return JSON.stringify(arguments)},Kl=(function(){function t(){this.cache=Object.create(null)}return t.prototype.get=function(e){return this.cache[e]},t.prototype.set=function(e,r){this.cache[e]=r},t})(),Xl={create:function(){return new Kl}},$n={variadic:Vl},Te;(function(t){t[t.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",t[t.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",t[t.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",t[t.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",t[t.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",t[t.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",t[t.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",t[t.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",t[t.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",t[t.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",t[t.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",t[t.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",t[t.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",t[t.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",t[t.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",t[t.INVALID_TAG=23]="INVALID_TAG",t[t.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",t[t.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",t[t.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(Te||(Te={}));var Xe;(function(t){t[t.literal=0]="literal",t[t.argument=1]="argument",t[t.number=2]="number",t[t.date=3]="date",t[t.time=4]="time",t[t.select=5]="select",t[t.plural=6]="plural",t[t.pound=7]="pound",t[t.tag=8]="tag"})(Xe||(Xe={}));var gr;(function(t){t[t.number=0]="number",t[t.dateTime=1]="dateTime"})(gr||(gr={}));function Xs(t){return t.type===Xe.literal}function Yl(t){return t.type===Xe.argument}function Aa(t){return t.type===Xe.number}function Ia(t){return t.type===Xe.date}function Ma(t){return t.type===Xe.time}function Da(t){return t.type===Xe.select}function ka(t){return t.type===Xe.plural}function Ql(t){return t.type===Xe.pound}function Na(t){return t.type===Xe.tag}function Oa(t){return!!(t&&typeof t=="object"&&t.type===gr.number)}function ss(t){return!!(t&&typeof t=="object"&&t.type===gr.dateTime)}var Ra=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,Zl=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function Jl(t){var e={};return t.replace(Zl,function(r){var n=r.length;switch(r[0]){case"G":e.era=n===4?"long":n===5?"narrow":"short";break;case"y":e.year=n===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":e.month=["numeric","2-digit","short","long","narrow"][n-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":e.day=["numeric","2-digit"][n-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":e.weekday=n===4?"long":n===5?"narrow":"short";break;case"e":if(n<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][n-4];break;case"c":if(n<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][n-4];break;case"a":e.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":e.hourCycle="h12",e.hour=["numeric","2-digit"][n-1];break;case"H":e.hourCycle="h23",e.hour=["numeric","2-digit"][n-1];break;case"K":e.hourCycle="h11",e.hour=["numeric","2-digit"][n-1];break;case"k":e.hourCycle="h24",e.hour=["numeric","2-digit"][n-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":e.minute=["numeric","2-digit"][n-1];break;case"s":e.second=["numeric","2-digit"][n-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":e.timeZoneName=n<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),e}var ec=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function tc(t){if(t.length===0)throw new Error("Number skeleton cannot be empty");for(var e=t.split(ec).filter(function(h){return h.length>0}),r=[],n=0,s=e;n<s.length;n++){var o=s[n],i=o.split("/");if(i.length===0)throw new Error("Invalid number skeleton");for(var l=i[0],c=i.slice(1),u=0,d=c;u<d.length;u++){var f=d[u];if(f.length===0)throw new Error("Invalid number skeleton")}r.push({stem:l,options:c})}return r}function rc(t){return t.replace(/^(.*?)-/,"")}var Ys=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,Fa=/^(@+)?(\+|#+)?[rs]?$/g,nc=/(\*)(0+)|(#+)(0+)|(0+)/g,Ha=/^(0+)$/;function Qs(t){var e={};return t[t.length-1]==="r"?e.roundingPriority="morePrecision":t[t.length-1]==="s"&&(e.roundingPriority="lessPrecision"),t.replace(Fa,function(r,n,s){return typeof s!="string"?(e.minimumSignificantDigits=n.length,e.maximumSignificantDigits=n.length):s==="+"?e.minimumSignificantDigits=n.length:n[0]==="#"?e.maximumSignificantDigits=n.length:(e.minimumSignificantDigits=n.length,e.maximumSignificantDigits=n.length+(typeof s=="string"?s.length:0)),""}),e}function Ua(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function sc(t){var e;if(t[0]==="E"&&t[1]==="E"?(e={notation:"engineering"},t=t.slice(2)):t[0]==="E"&&(e={notation:"scientific"},t=t.slice(1)),e){var r=t.slice(0,2);if(r==="+!"?(e.signDisplay="always",t=t.slice(2)):r==="+?"&&(e.signDisplay="exceptZero",t=t.slice(2)),!Ha.test(t))throw new Error("Malformed concise eng/scientific notation");e.minimumIntegerDigits=t.length}return e}function Zs(t){var e={},r=Ua(t);return r||e}function oc(t){for(var e={},r=0,n=t;r<n.length;r++){var s=n[r];switch(s.stem){case"percent":case"%":e.style="percent";continue;case"%x100":e.style="percent",e.scale=100;continue;case"currency":e.style="currency",e.currency=s.options[0];continue;case"group-off":case",_":e.useGrouping=!1;continue;case"precision-integer":case".":e.maximumFractionDigits=0;continue;case"measure-unit":case"unit":e.style="unit",e.unit=rc(s.options[0]);continue;case"compact-short":case"K":e.notation="compact",e.compactDisplay="short";continue;case"compact-long":case"KK":e.notation="compact",e.compactDisplay="long";continue;case"scientific":e=ke(ke(ke({},e),{notation:"scientific"}),s.options.reduce(function(c,u){return ke(ke({},c),Zs(u))},{}));continue;case"engineering":e=ke(ke(ke({},e),{notation:"engineering"}),s.options.reduce(function(c,u){return ke(ke({},c),Zs(u))},{}));continue;case"notation-simple":e.notation="standard";continue;case"unit-width-narrow":e.currencyDisplay="narrowSymbol",e.unitDisplay="narrow";continue;case"unit-width-short":e.currencyDisplay="code",e.unitDisplay="short";continue;case"unit-width-full-name":e.currencyDisplay="name",e.unitDisplay="long";continue;case"unit-width-iso-code":e.currencyDisplay="symbol";continue;case"scale":e.scale=parseFloat(s.options[0]);continue;case"rounding-mode-floor":e.roundingMode="floor";continue;case"rounding-mode-ceiling":e.roundingMode="ceil";continue;case"rounding-mode-down":e.roundingMode="trunc";continue;case"rounding-mode-up":e.roundingMode="expand";continue;case"rounding-mode-half-even":e.roundingMode="halfEven";continue;case"rounding-mode-half-down":e.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":e.roundingMode="halfExpand";continue;case"integer-width":if(s.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");s.options[0].replace(nc,function(c,u,d,f,h,g){if(u)e.minimumIntegerDigits=d.length;else{if(f&&h)throw new Error("We currently do not support maximum integer digits");if(g)throw new Error("We currently do not support exact integer digits")}return""});continue}if(Ha.test(s.stem)){e.minimumIntegerDigits=s.stem.length;continue}if(Ys.test(s.stem)){if(s.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");s.stem.replace(Ys,function(c,u,d,f,h,g){return d==="*"?e.minimumFractionDigits=u.length:f&&f[0]==="#"?e.maximumFractionDigits=f.length:h&&g?(e.minimumFractionDigits=h.length,e.maximumFractionDigits=h.length+g.length):(e.minimumFractionDigits=u.length,e.maximumFractionDigits=u.length),""});var o=s.options[0];o==="w"?e=ke(ke({},e),{trailingZeroDisplay:"stripIfInteger"}):o&&(e=ke(ke({},e),Qs(o)));continue}if(Fa.test(s.stem)){e=ke(ke({},e),Qs(s.stem));continue}var i=Ua(s.stem);i&&(e=ke(ke({},e),i));var l=sc(s.stem);l&&(e=ke(ke({},e),l))}return e}var Qr={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function ac(t,e){for(var r="",n=0;n<t.length;n++){var s=t.charAt(n);if(s==="j"){for(var o=0;n+1<t.length&&t.charAt(n+1)===s;)o++,n++;var i=1+(o&1),l=o<2?1:3+(o>>1),c="a",u=ic(e);for((u=="H"||u=="k")&&(l=0);l-- >0;)r+=c;for(;i-- >0;)r=u+r}else s==="J"?r+="H":r+=s}return r}function ic(t){var e=t.hourCycle;if(e===void 0&&t.hourCycles&&t.hourCycles.length&&(e=t.hourCycles[0]),e)switch(e){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var r=t.language,n;r!=="root"&&(n=t.maximize().region);var s=Qr[n||""]||Qr[r||""]||Qr["".concat(r,"-001")]||Qr["001"];return s[0]}var zn,lc=new RegExp("^".concat(Ra.source,"*")),cc=new RegExp("".concat(Ra.source,"*$"));function Ae(t,e){return{start:t,end:e}}var uc=!!String.prototype.startsWith&&"_a".startsWith("a",1),dc=!!String.fromCodePoint,hc=!!Object.fromEntries,fc=!!String.prototype.codePointAt,gc=!!String.prototype.trimStart,pc=!!String.prototype.trimEnd,vc=!!Number.isSafeInteger,mc=vc?Number.isSafeInteger:function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<=9007199254740991},os=!0;try{var yc=$a("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");os=((zn=yc.exec("a"))===null||zn===void 0?void 0:zn[0])==="a"}catch{os=!1}var Js=uc?function(e,r,n){return e.startsWith(r,n)}:function(e,r,n){return e.slice(n,n+r.length)===r},as=dc?String.fromCodePoint:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var n="",s=e.length,o=0,i;s>o;){if(i=e[o++],i>1114111)throw RangeError(i+" is not a valid code point");n+=i<65536?String.fromCharCode(i):String.fromCharCode(((i-=65536)>>10)+55296,i%1024+56320)}return n},eo=hc?Object.fromEntries:function(e){for(var r={},n=0,s=e;n<s.length;n++){var o=s[n],i=o[0],l=o[1];r[i]=l}return r},Ba=fc?function(e,r){return e.codePointAt(r)}:function(e,r){var n=e.length;if(!(r<0||r>=n)){var s=e.charCodeAt(r),o;return s<55296||s>56319||r+1===n||(o=e.charCodeAt(r+1))<56320||o>57343?s:(s-55296<<10)+(o-56320)+65536}},_c=gc?function(e){return e.trimStart()}:function(e){return e.replace(lc,"")},wc=pc?function(e){return e.trimEnd()}:function(e){return e.replace(cc,"")};function $a(t,e){return new RegExp(t,e)}var is;if(os){var to=$a("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");is=function(e,r){var n;to.lastIndex=r;var s=to.exec(e);return(n=s[1])!==null&&n!==void 0?n:""}}else is=function(e,r){for(var n=[];;){var s=Ba(e,r);if(s===void 0||za(s)||xc(s))break;n.push(s),r+=s>=65536?2:1}return as.apply(void 0,n)};var bc=(function(){function t(e,r){r===void 0&&(r={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!r.ignoreTag,this.locale=r.locale,this.requiresOtherClause=!!r.requiresOtherClause,this.shouldParseSkeletons=!!r.shouldParseSkeletons}return t.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},t.prototype.parseMessage=function(e,r,n){for(var s=[];!this.isEOF();){var o=this.char();if(o===123){var i=this.parseArgument(e,n);if(i.err)return i;s.push(i.val)}else{if(o===125&&e>0)break;if(o===35&&(r==="plural"||r==="selectordinal")){var l=this.clonePosition();this.bump(),s.push({type:Xe.pound,location:Ae(l,this.clonePosition())})}else if(o===60&&!this.ignoreTag&&this.peek()===47){if(n)break;return this.error(Te.UNMATCHED_CLOSING_TAG,Ae(this.clonePosition(),this.clonePosition()))}else if(o===60&&!this.ignoreTag&&ls(this.peek()||0)){var i=this.parseTag(e,r);if(i.err)return i;s.push(i.val)}else{var i=this.parseLiteral(e,r);if(i.err)return i;s.push(i.val)}}}return{val:s,err:null}},t.prototype.parseTag=function(e,r){var n=this.clonePosition();this.bump();var s=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:Xe.literal,value:"<".concat(s,"/>"),location:Ae(n,this.clonePosition())},err:null};if(this.bumpIf(">")){var o=this.parseMessage(e+1,r,!0);if(o.err)return o;var i=o.val,l=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!ls(this.char()))return this.error(Te.INVALID_TAG,Ae(l,this.clonePosition()));var c=this.clonePosition(),u=this.parseTagName();return s!==u?this.error(Te.UNMATCHED_CLOSING_TAG,Ae(c,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:Xe.tag,value:s,children:i,location:Ae(n,this.clonePosition())},err:null}:this.error(Te.INVALID_TAG,Ae(l,this.clonePosition())))}else return this.error(Te.UNCLOSED_TAG,Ae(n,this.clonePosition()))}else return this.error(Te.INVALID_TAG,Ae(n,this.clonePosition()))},t.prototype.parseTagName=function(){var e=this.offset();for(this.bump();!this.isEOF()&&Ec(this.char());)this.bump();return this.message.slice(e,this.offset())},t.prototype.parseLiteral=function(e,r){for(var n=this.clonePosition(),s="";;){var o=this.tryParseQuote(r);if(o){s+=o;continue}var i=this.tryParseUnquoted(e,r);if(i){s+=i;continue}var l=this.tryParseLeftAngleBracket();if(l){s+=l;continue}break}var c=Ae(n,this.clonePosition());return{val:{type:Xe.literal,value:s,location:c},err:null}},t.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!Sc(this.peek()||0))?(this.bump(),"<"):null},t.prototype.tryParseQuote=function(e){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(e==="plural"||e==="selectordinal")break;return null;default:return null}this.bump();var r=[this.char()];for(this.bump();!this.isEOF();){var n=this.char();if(n===39)if(this.peek()===39)r.push(39),this.bump();else{this.bump();break}else r.push(n);this.bump()}return as.apply(void 0,r)},t.prototype.tryParseUnquoted=function(e,r){if(this.isEOF())return null;var n=this.char();return n===60||n===123||n===35&&(r==="plural"||r==="selectordinal")||n===125&&e>0?null:(this.bump(),as(n))},t.prototype.parseArgument=function(e,r){var n=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(Te.EXPECT_ARGUMENT_CLOSING_BRACE,Ae(n,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(Te.EMPTY_ARGUMENT,Ae(n,this.clonePosition()));var s=this.parseIdentifierIfPossible().value;if(!s)return this.error(Te.MALFORMED_ARGUMENT,Ae(n,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(Te.EXPECT_ARGUMENT_CLOSING_BRACE,Ae(n,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:Xe.argument,value:s,location:Ae(n,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(Te.EXPECT_ARGUMENT_CLOSING_BRACE,Ae(n,this.clonePosition())):this.parseArgumentOptions(e,r,s,n);default:return this.error(Te.MALFORMED_ARGUMENT,Ae(n,this.clonePosition()))}},t.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),r=this.offset(),n=is(this.message,r),s=r+n.length;this.bumpTo(s);var o=this.clonePosition(),i=Ae(e,o);return{value:n,location:i}},t.prototype.parseArgumentOptions=function(e,r,n,s){var o,i=this.clonePosition(),l=this.parseIdentifierIfPossible().value,c=this.clonePosition();switch(l){case"":return this.error(Te.EXPECT_ARGUMENT_TYPE,Ae(i,c));case"number":case"date":case"time":{this.bumpSpace();var u=null;if(this.bumpIf(",")){this.bumpSpace();var d=this.clonePosition(),f=this.parseSimpleArgStyleIfPossible();if(f.err)return f;var h=wc(f.val);if(h.length===0)return this.error(Te.EXPECT_ARGUMENT_STYLE,Ae(this.clonePosition(),this.clonePosition()));var g=Ae(d,this.clonePosition());u={style:h,styleLocation:g}}var p=this.tryParseArgumentClose(s);if(p.err)return p;var m=Ae(s,this.clonePosition());if(u&&Js(u?.style,"::",0)){var x=_c(u.style.slice(2));if(l==="number"){var f=this.parseNumberSkeletonFromString(x,u.styleLocation);return f.err?f:{val:{type:Xe.number,value:n,location:m,style:f.val},err:null}}else{if(x.length===0)return this.error(Te.EXPECT_DATE_TIME_SKELETON,m);var _=x;this.locale&&(_=ac(x,this.locale));var h={type:gr.dateTime,pattern:_,location:u.styleLocation,parsedOptions:this.shouldParseSkeletons?Jl(_):{}},b=l==="date"?Xe.date:Xe.time;return{val:{type:b,value:n,location:m,style:h},err:null}}}return{val:{type:l==="number"?Xe.number:l==="date"?Xe.date:Xe.time,value:n,location:m,style:(o=u?.style)!==null&&o!==void 0?o:null},err:null}}case"plural":case"selectordinal":case"select":{var S=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(Te.EXPECT_SELECT_ARGUMENT_OPTIONS,Ae(S,ke({},S)));this.bumpSpace();var T=this.parseIdentifierIfPossible(),P=0;if(l!=="select"&&T.value==="offset"){if(!this.bumpIf(":"))return this.error(Te.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Ae(this.clonePosition(),this.clonePosition()));this.bumpSpace();var f=this.tryParseDecimalInteger(Te.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Te.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(f.err)return f;this.bumpSpace(),T=this.parseIdentifierIfPossible(),P=f.val}var E=this.tryParsePluralOrSelectOptions(e,l,r,T);if(E.err)return E;var p=this.tryParseArgumentClose(s);if(p.err)return p;var M=Ae(s,this.clonePosition());return l==="select"?{val:{type:Xe.select,value:n,options:eo(E.val),location:M},err:null}:{val:{type:Xe.plural,value:n,options:eo(E.val),offset:P,pluralType:l==="plural"?"cardinal":"ordinal",location:M},err:null}}default:return this.error(Te.INVALID_ARGUMENT_TYPE,Ae(i,c))}},t.prototype.tryParseArgumentClose=function(e){return this.isEOF()||this.char()!==125?this.error(Te.EXPECT_ARGUMENT_CLOSING_BRACE,Ae(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},t.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,r=this.clonePosition();!this.isEOF();){var n=this.char();switch(n){case 39:{this.bump();var s=this.clonePosition();if(!this.bumpUntil("'"))return this.error(Te.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,Ae(s,this.clonePosition()));this.bump();break}case 123:{e+=1,this.bump();break}case 125:{if(e>0)e-=1;else return{val:this.message.slice(r.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(r.offset,this.offset()),err:null}},t.prototype.parseNumberSkeletonFromString=function(e,r){var n=[];try{n=tc(e)}catch{return this.error(Te.INVALID_NUMBER_SKELETON,r)}return{val:{type:gr.number,tokens:n,location:r,parsedOptions:this.shouldParseSkeletons?oc(n):{}},err:null}},t.prototype.tryParsePluralOrSelectOptions=function(e,r,n,s){for(var o,i=!1,l=[],c=new Set,u=s.value,d=s.location;;){if(u.length===0){var f=this.clonePosition();if(r!=="select"&&this.bumpIf("=")){var h=this.tryParseDecimalInteger(Te.EXPECT_PLURAL_ARGUMENT_SELECTOR,Te.INVALID_PLURAL_ARGUMENT_SELECTOR);if(h.err)return h;d=Ae(f,this.clonePosition()),u=this.message.slice(f.offset,this.offset())}else break}if(c.has(u))return this.error(r==="select"?Te.DUPLICATE_SELECT_ARGUMENT_SELECTOR:Te.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,d);u==="other"&&(i=!0),this.bumpSpace();var g=this.clonePosition();if(!this.bumpIf("{"))return this.error(r==="select"?Te.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:Te.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,Ae(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,r,n);if(p.err)return p;var m=this.tryParseArgumentClose(g);if(m.err)return m;l.push([u,{value:p.val,location:Ae(g,this.clonePosition())}]),c.add(u),this.bumpSpace(),o=this.parseIdentifierIfPossible(),u=o.value,d=o.location}return l.length===0?this.error(r==="select"?Te.EXPECT_SELECT_ARGUMENT_SELECTOR:Te.EXPECT_PLURAL_ARGUMENT_SELECTOR,Ae(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!i?this.error(Te.MISSING_OTHER_CLAUSE,Ae(this.clonePosition(),this.clonePosition())):{val:l,err:null}},t.prototype.tryParseDecimalInteger=function(e,r){var n=1,s=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(n=-1);for(var o=!1,i=0;!this.isEOF();){var l=this.char();if(l>=48&&l<=57)o=!0,i=i*10+(l-48),this.bump();else break}var c=Ae(s,this.clonePosition());return o?(i*=n,mc(i)?{val:i,err:null}:this.error(r,c)):this.error(e,c)},t.prototype.offset=function(){return this.position.offset},t.prototype.isEOF=function(){return this.offset()===this.message.length},t.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},t.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var r=Ba(this.message,e);if(r===void 0)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return r},t.prototype.error=function(e,r){return{val:null,err:{kind:e,message:this.message,location:r}}},t.prototype.bump=function(){if(!this.isEOF()){var e=this.char();e===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},t.prototype.bumpIf=function(e){if(Js(this.message,e,this.offset())){for(var r=0;r<e.length;r++)this.bump();return!0}return!1},t.prototype.bumpUntil=function(e){var r=this.offset(),n=this.message.indexOf(e,r);return n>=0?(this.bumpTo(n),!0):(this.bumpTo(this.message.length),!1)},t.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var r=this.offset();if(r===e)break;if(r>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},t.prototype.bumpSpace=function(){for(;!this.isEOF()&&za(this.char());)this.bump()},t.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),r=this.offset(),n=this.message.charCodeAt(r+(e>=65536?2:1));return n??null},t})();function ls(t){return t>=97&&t<=122||t>=65&&t<=90}function Sc(t){return ls(t)||t===47}function Ec(t){return t===45||t===46||t>=48&&t<=57||t===95||t>=97&&t<=122||t>=65&&t<=90||t==183||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}function za(t){return t>=9&&t<=13||t===32||t===133||t>=8206&&t<=8207||t===8232||t===8233}function xc(t){return t>=33&&t<=35||t===36||t>=37&&t<=39||t===40||t===41||t===42||t===43||t===44||t===45||t>=46&&t<=47||t>=58&&t<=59||t>=60&&t<=62||t>=63&&t<=64||t===91||t===92||t===93||t===94||t===96||t===123||t===124||t===125||t===126||t===161||t>=162&&t<=165||t===166||t===167||t===169||t===171||t===172||t===174||t===176||t===177||t===182||t===187||t===191||t===215||t===247||t>=8208&&t<=8213||t>=8214&&t<=8215||t===8216||t===8217||t===8218||t>=8219&&t<=8220||t===8221||t===8222||t===8223||t>=8224&&t<=8231||t>=8240&&t<=8248||t===8249||t===8250||t>=8251&&t<=8254||t>=8257&&t<=8259||t===8260||t===8261||t===8262||t>=8263&&t<=8273||t===8274||t===8275||t>=8277&&t<=8286||t>=8592&&t<=8596||t>=8597&&t<=8601||t>=8602&&t<=8603||t>=8604&&t<=8607||t===8608||t>=8609&&t<=8610||t===8611||t>=8612&&t<=8613||t===8614||t>=8615&&t<=8621||t===8622||t>=8623&&t<=8653||t>=8654&&t<=8655||t>=8656&&t<=8657||t===8658||t===8659||t===8660||t>=8661&&t<=8691||t>=8692&&t<=8959||t>=8960&&t<=8967||t===8968||t===8969||t===8970||t===8971||t>=8972&&t<=8991||t>=8992&&t<=8993||t>=8994&&t<=9e3||t===9001||t===9002||t>=9003&&t<=9083||t===9084||t>=9085&&t<=9114||t>=9115&&t<=9139||t>=9140&&t<=9179||t>=9180&&t<=9185||t>=9186&&t<=9254||t>=9255&&t<=9279||t>=9280&&t<=9290||t>=9291&&t<=9311||t>=9472&&t<=9654||t===9655||t>=9656&&t<=9664||t===9665||t>=9666&&t<=9719||t>=9720&&t<=9727||t>=9728&&t<=9838||t===9839||t>=9840&&t<=10087||t===10088||t===10089||t===10090||t===10091||t===10092||t===10093||t===10094||t===10095||t===10096||t===10097||t===10098||t===10099||t===10100||t===10101||t>=10132&&t<=10175||t>=10176&&t<=10180||t===10181||t===10182||t>=10183&&t<=10213||t===10214||t===10215||t===10216||t===10217||t===10218||t===10219||t===10220||t===10221||t===10222||t===10223||t>=10224&&t<=10239||t>=10240&&t<=10495||t>=10496&&t<=10626||t===10627||t===10628||t===10629||t===10630||t===10631||t===10632||t===10633||t===10634||t===10635||t===10636||t===10637||t===10638||t===10639||t===10640||t===10641||t===10642||t===10643||t===10644||t===10645||t===10646||t===10647||t===10648||t>=10649&&t<=10711||t===10712||t===10713||t===10714||t===10715||t>=10716&&t<=10747||t===10748||t===10749||t>=10750&&t<=11007||t>=11008&&t<=11055||t>=11056&&t<=11076||t>=11077&&t<=11078||t>=11079&&t<=11084||t>=11085&&t<=11123||t>=11124&&t<=11125||t>=11126&&t<=11157||t===11158||t>=11159&&t<=11263||t>=11776&&t<=11777||t===11778||t===11779||t===11780||t===11781||t>=11782&&t<=11784||t===11785||t===11786||t===11787||t===11788||t===11789||t>=11790&&t<=11798||t===11799||t>=11800&&t<=11801||t===11802||t===11803||t===11804||t===11805||t>=11806&&t<=11807||t===11808||t===11809||t===11810||t===11811||t===11812||t===11813||t===11814||t===11815||t===11816||t===11817||t>=11818&&t<=11822||t===11823||t>=11824&&t<=11833||t>=11834&&t<=11835||t>=11836&&t<=11839||t===11840||t===11841||t===11842||t>=11843&&t<=11855||t>=11856&&t<=11857||t===11858||t>=11859&&t<=11903||t>=12289&&t<=12291||t===12296||t===12297||t===12298||t===12299||t===12300||t===12301||t===12302||t===12303||t===12304||t===12305||t>=12306&&t<=12307||t===12308||t===12309||t===12310||t===12311||t===12312||t===12313||t===12314||t===12315||t===12316||t===12317||t>=12318&&t<=12319||t===12320||t===12336||t===64830||t===64831||t>=65093&&t<=65094}function cs(t){t.forEach(function(e){if(delete e.location,Da(e)||ka(e))for(var r in e.options)delete e.options[r].location,cs(e.options[r].value);else Aa(e)&&Oa(e.style)||(Ia(e)||Ma(e))&&ss(e.style)?delete e.style.location:Na(e)&&cs(e.children)})}function Pc(t,e){e===void 0&&(e={}),e=ke({shouldParseSkeletons:!0,requiresOtherClause:!0},e);var r=new bc(t,e).parse();if(r.err){var n=SyntaxError(Te[r.err.kind]);throw n.location=r.err.location,n.originalMessage=r.err.message,n}return e?.captureLocation||cs(r.val),r.val}var pr;(function(t){t.MISSING_VALUE="MISSING_VALUE",t.INVALID_VALUE="INVALID_VALUE",t.MISSING_INTL_API="MISSING_INTL_API"})(pr||(pr={}));var In=(function(t){An(e,t);function e(r,n,s){var o=t.call(this,r)||this;return o.code=n,o.originalMessage=s,o}return e.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},e})(Error),ro=(function(t){An(e,t);function e(r,n,s,o){return t.call(this,'Invalid values for "'.concat(r,'": "').concat(n,'". Options are "').concat(Object.keys(s).join('", "'),'"'),pr.INVALID_VALUE,o)||this}return e})(In),Cc=(function(t){An(e,t);function e(r,n,s){return t.call(this,'Value for "'.concat(r,'" must be of type ').concat(n),pr.INVALID_VALUE,s)||this}return e})(In),Lc=(function(t){An(e,t);function e(r,n){return t.call(this,'The intl string context variable "'.concat(r,'" was not provided to the string "').concat(n,'"'),pr.MISSING_VALUE,n)||this}return e})(In),ht;(function(t){t[t.literal=0]="literal",t[t.object=1]="object"})(ht||(ht={}));function Tc(t){return t.length<2?t:t.reduce(function(e,r){var n=e[e.length-1];return!n||n.type!==ht.literal||r.type!==ht.literal?e.push(r):n.value+=r.value,e},[])}function Ac(t){return typeof t=="function"}function on(t,e,r,n,s,o,i){if(t.length===1&&Xs(t[0]))return[{type:ht.literal,value:t[0].value}];for(var l=[],c=0,u=t;c<u.length;c++){var d=u[c];if(Xs(d)){l.push({type:ht.literal,value:d.value});continue}if(Ql(d)){typeof o=="number"&&l.push({type:ht.literal,value:r.getNumberFormat(e).format(o)});continue}var f=d.value;if(!(s&&f in s))throw new Lc(f,i);var h=s[f];if(Yl(d)){(!h||typeof h=="string"||typeof h=="number")&&(h=typeof h=="string"||typeof h=="number"?String(h):""),l.push({type:typeof h=="string"?ht.literal:ht.object,value:h});continue}if(Ia(d)){var g=typeof d.style=="string"?n.date[d.style]:ss(d.style)?d.style.parsedOptions:void 0;l.push({type:ht.literal,value:r.getDateTimeFormat(e,g).format(h)});continue}if(Ma(d)){var g=typeof d.style=="string"?n.time[d.style]:ss(d.style)?d.style.parsedOptions:n.time.medium;l.push({type:ht.literal,value:r.getDateTimeFormat(e,g).format(h)});continue}if(Aa(d)){var g=typeof d.style=="string"?n.number[d.style]:Oa(d.style)?d.style.parsedOptions:void 0;g&&g.scale&&(h=h*(g.scale||1)),l.push({type:ht.literal,value:r.getNumberFormat(e,g).format(h)});continue}if(Na(d)){var p=d.children,m=d.value,x=s[m];if(!Ac(x))throw new Cc(m,"function",i);var _=on(p,e,r,n,s,o),b=x(_.map(function(P){return P.value}));Array.isArray(b)||(b=[b]),l.push.apply(l,b.map(function(P){return{type:typeof P=="string"?ht.literal:ht.object,value:P}}))}if(Da(d)){var S=d.options[h]||d.options.other;if(!S)throw new ro(d.value,h,Object.keys(d.options),i);l.push.apply(l,on(S.value,e,r,n,s));continue}if(ka(d)){var S=d.options["=".concat(h)];if(!S){if(!Intl.PluralRules)throw new In(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,pr.MISSING_INTL_API,i);var T=r.getPluralRules(e,{type:d.pluralType}).select(h-(d.offset||0));S=d.options[T]||d.options.other}if(!S)throw new ro(d.value,h,Object.keys(d.options),i);l.push.apply(l,on(S.value,e,r,n,s,h-(d.offset||0)));continue}}return Tc(l)}function Ic(t,e){return e?ke(ke(ke({},t||{}),e||{}),Object.keys(t).reduce(function(r,n){return r[n]=ke(ke({},t[n]),e[n]||{}),r},{})):t}function Mc(t,e){return e?Object.keys(t).reduce(function(r,n){return r[n]=Ic(t[n],e[n]),r},ke({},t)):t}function jn(t){return{create:function(){return{get:function(e){return t[e]},set:function(e,r){t[e]=r}}}}}function Dc(t){return t===void 0&&(t={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:Bn(function(){for(var e,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return new((e=Intl.NumberFormat).bind.apply(e,Un([void 0],r,!1)))},{cache:jn(t.number),strategy:$n.variadic}),getDateTimeFormat:Bn(function(){for(var e,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return new((e=Intl.DateTimeFormat).bind.apply(e,Un([void 0],r,!1)))},{cache:jn(t.dateTime),strategy:$n.variadic}),getPluralRules:Bn(function(){for(var e,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return new((e=Intl.PluralRules).bind.apply(e,Un([void 0],r,!1)))},{cache:jn(t.pluralRules),strategy:$n.variadic})}}var ja=(function(){function t(e,r,n,s){r===void 0&&(r=t.defaultLocale);var o=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(c){var u=o.formatToParts(c);if(u.length===1)return u[0].value;var d=u.reduce(function(f,h){return!f.length||h.type!==ht.literal||typeof f[f.length-1]!="string"?f.push(h.value):f[f.length-1]+=h.value,f},[]);return d.length<=1?d[0]||"":d},this.formatToParts=function(c){return on(o.ast,o.locales,o.formatters,o.formats,c,void 0,o.message)},this.resolvedOptions=function(){var c;return{locale:((c=o.resolvedLocale)===null||c===void 0?void 0:c.toString())||Intl.NumberFormat.supportedLocalesOf(o.locales)[0]}},this.getAst=function(){return o.ast},this.locales=r,this.resolvedLocale=t.resolveLocale(r),typeof e=="string"){if(this.message=e,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var i=s||{};i.formatters;var l=zl(i,["formatters"]);this.ast=t.__parse(e,ke(ke({},l),{locale:this.resolvedLocale}))}else this.ast=e;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=Mc(t.formats,n),this.formatters=s&&s.formatters||Dc(this.formatterCache)}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.resolveLocale=function(e){if(!(typeof Intl.Locale>"u")){var r=Intl.NumberFormat.supportedLocalesOf(e);return r.length>0?new Intl.Locale(r[0]):new Intl.Locale(typeof e=="string"?e:e[0])}},t.__parse=Pc,t.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t})();function kc(t,e){if(e==null)return;if(e in t)return t[e];const r=e.split(".");let n=t;for(let s=0;s<r.length;s++)if(typeof n=="object"){if(s>0){const o=r.slice(s,r.length).join(".");if(o in n){n=n[o];break}}n=n[r[s]]}else n=void 0;return n}const jt={},Nc=(t,e,r)=>r&&(e in jt||(jt[e]={}),t in jt[e]||(jt[e][t]=r),r),Wa=(t,e)=>{if(e==null)return;if(e in jt&&t in jt[e])return jt[e][t];const r=Kr(e);for(let n=0;n<r.length;n++){const s=r[n],o=Rc(s,t);if(o)return Nc(t,e,o)}};let xs;const _r=fr({});function Oc(t){return xs[t]||null}function Ps(t){return t in xs}function Rc(t,e){if(!Ps(t))return null;const r=Oc(t);return kc(r,e)}function Fc(t){if(t==null)return;const e=Kr(t);for(let r=0;r<e.length;r++){const n=e[r];if(Ps(n))return n}}function Hc(t,...e){delete jt[t],_r.update(r=>(r[t]=$l.all([r[t]||{},...e]),r))}mr([_r],([t])=>Object.keys(t));_r.subscribe(t=>xs=t);const Or={};function Uc(t){Or[t]=new Set}function Bc(t,e){Or[t].delete(e),Or[t].size===0&&delete Or[t]}function Rr(t){return Or[t]}function $c(t){return Kr(t).map(e=>{const r=Rr(e);return[e,r?[...r]:[]]}).filter(([,e])=>e.length>0)}function vn(t){return t==null?!1:Kr(t).some(e=>{var r;return(r=Rr(e))==null?void 0:r.size})}function zc(t,e){return Promise.all(e.map(n=>(Bc(t,n),n().then(s=>s.default||s)))).then(n=>Hc(t,...n))}const Pr={};function Cs(t){if(!vn(t))return t in Pr?Pr[t]:Promise.resolve();const e=$c(t);return Pr[t]=Promise.all(e.map(([r,n])=>zc(r,n))).then(()=>{if(vn(t))return Cs(t);delete Pr[t]}),Pr[t]}function Ga(t,e){Rr(t)||Uc(t);const r=Rr(t);Rr(t).has(e)||(Ps(t)||_r.update(n=>(n[t]={},n)),r.add(e))}var no=Object.getOwnPropertySymbols,jc=Object.prototype.hasOwnProperty,Wc=Object.prototype.propertyIsEnumerable,Gc=(t,e)=>{var r={};for(var n in t)jc.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&no)for(var n of no(t))e.indexOf(n)<0&&Wc.call(t,n)&&(r[n]=t[n]);return r};const Vc={number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};function qc({locale:t,id:e}){console.warn(`[svelte-i18n] The message "${e}" was not found in "${Kr(t).join('", "')}".${vn(Ft())?`

Note: there are at least one loader still registered to this locale that wasn't executed.`:""}`)}const Kc={fallbackLocale:null,loadingDelay:200,formats:Vc,warnOnMissingMessages:!0,handleMissingMessage:void 0,ignoreTag:!0},Dr=Kc;function ar(){return Dr}function Xc(t){const e=t,{formats:r}=e,n=Gc(e,["formats"]);let s=t.fallbackLocale;if(t.initialLocale)try{ja.resolveLocale(t.initialLocale)&&(s=t.initialLocale)}catch{console.warn(`[svelte-i18n] The initial locale "${t.initialLocale}" is not a valid locale.`)}return n.warnOnMissingMessages&&(delete n.warnOnMissingMessages,n.handleMissingMessage==null?n.handleMissingMessage=qc:console.warn('[svelte-i18n] The "warnOnMissingMessages" option is deprecated. Please use the "handleMissingMessage" option instead.')),Object.assign(Dr,n,{initialLocale:s}),r&&("number"in r&&Object.assign(Dr.formats.number,r.number),"date"in r&&Object.assign(Dr.formats.date,r.date),"time"in r&&Object.assign(Dr.formats.time,r.time)),vt.set(s)}const Wn=fr(!1);var Yc=Object.defineProperty,Qc=Object.defineProperties,Zc=Object.getOwnPropertyDescriptors,so=Object.getOwnPropertySymbols,Jc=Object.prototype.hasOwnProperty,eu=Object.prototype.propertyIsEnumerable,oo=(t,e,r)=>e in t?Yc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tu=(t,e)=>{for(var r in e||(e={}))Jc.call(e,r)&&oo(t,r,e[r]);if(so)for(var r of so(e))eu.call(e,r)&&oo(t,r,e[r]);return t},ru=(t,e)=>Qc(t,Zc(e));let us;const mn=fr(null);function ao(t){return t.split("-").map((e,r,n)=>n.slice(0,r+1).join("-")).reverse()}function Kr(t,e=ar().fallbackLocale){const r=ao(t);return e?[...new Set([...r,...ao(e)])]:r}function Ft(){return us??void 0}mn.subscribe(t=>{us=t??void 0,typeof window<"u"&&t!=null&&document.documentElement.setAttribute("lang",t)});const nu=t=>{if(t&&Fc(t)&&vn(t)){const{loadingDelay:e}=ar();let r;return typeof window<"u"&&Ft()!=null&&e?r=window.setTimeout(()=>Wn.set(!0),e):Wn.set(!0),Cs(t).then(()=>{mn.set(t)}).finally(()=>{clearTimeout(r),Wn.set(!1)})}return mn.set(t)},vt=ru(tu({},mn),{set:nu}),su=()=>typeof window>"u"?null:window.navigator.language||window.navigator.languages[0],Mn=t=>{const e=Object.create(null);return n=>{const s=JSON.stringify(n);return s in e?e[s]:e[s]=t(n)}};var ou=Object.defineProperty,yn=Object.getOwnPropertySymbols,Va=Object.prototype.hasOwnProperty,qa=Object.prototype.propertyIsEnumerable,io=(t,e,r)=>e in t?ou(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ls=(t,e)=>{for(var r in e||(e={}))Va.call(e,r)&&io(t,r,e[r]);if(yn)for(var r of yn(e))qa.call(e,r)&&io(t,r,e[r]);return t},wr=(t,e)=>{var r={};for(var n in t)Va.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&yn)for(var n of yn(t))e.indexOf(n)<0&&qa.call(t,n)&&(r[n]=t[n]);return r};const Wr=(t,e)=>{const{formats:r}=ar();if(t in r&&e in r[t])return r[t][e];throw new Error(`[svelte-i18n] Unknown "${e}" ${t} format.`)},au=Mn(t=>{var e=t,{locale:r,format:n}=e,s=wr(e,["locale","format"]);if(r==null)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return n&&(s=Wr("number",n)),new Intl.NumberFormat(r,s)}),iu=Mn(t=>{var e=t,{locale:r,format:n}=e,s=wr(e,["locale","format"]);if(r==null)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return n?s=Wr("date",n):Object.keys(s).length===0&&(s=Wr("date","short")),new Intl.DateTimeFormat(r,s)}),lu=Mn(t=>{var e=t,{locale:r,format:n}=e,s=wr(e,["locale","format"]);if(r==null)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return n?s=Wr("time",n):Object.keys(s).length===0&&(s=Wr("time","short")),new Intl.DateTimeFormat(r,s)}),cu=(t={})=>{var e=t,{locale:r=Ft()}=e,n=wr(e,["locale"]);return au(Ls({locale:r},n))},uu=(t={})=>{var e=t,{locale:r=Ft()}=e,n=wr(e,["locale"]);return iu(Ls({locale:r},n))},du=(t={})=>{var e=t,{locale:r=Ft()}=e,n=wr(e,["locale"]);return lu(Ls({locale:r},n))},hu=Mn((t,e=Ft())=>new ja(t,e,ar().formats,{ignoreTag:ar().ignoreTag})),fu=(t,e={})=>{var r,n,s,o;let i=e;typeof t=="object"&&(i=t,t=i.id);const{values:l,locale:c=Ft(),default:u}=i;if(c==null)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let d=Wa(t,c);if(!d)d=(o=(s=(n=(r=ar()).handleMissingMessage)==null?void 0:n.call(r,{locale:c,id:t,defaultValue:u}))!=null?s:u)!=null?o:t;else if(typeof d!="string")return console.warn(`[svelte-i18n] Message with id "${t}" must be of type "string", found: "${typeof d}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),d;if(!l)return d;let f=d;try{f=hu(d,c).format(l)}catch(h){h instanceof Error&&console.warn(`[svelte-i18n] Message "${t}" has syntax error:`,h.message)}return f},gu=(t,e)=>du(e).format(t),pu=(t,e)=>uu(e).format(t),vu=(t,e)=>cu(e).format(t),mu=(t,e=Ft())=>Wa(t,e),Qe=mr([vt,_r],()=>fu);mr([vt],()=>gu);mr([vt],()=>pu);mr([vt],()=>vu);mr([vt,_r],()=>mu);function yu(t){return Cs(Ft()||ar().initialLocale)}Ga("ja",()=>At(()=>import("./ja-Wg-rpho_.js"),[]));Ga("en",()=>At(()=>import("./en-Dk7iqH7D.js"),[]));function _u(){const t=localStorage.getItem("locale"),e=su();return t&&(t==="ja"||t==="en")?t:e&&e.startsWith("ja")?"ja":"en"}const Ka=_u();Xc({fallbackLocale:"ja",initialLocale:Ka,loadingDelay:0});vt.set(Ka);const Zr=["wss://purplepag.es/","wss://directory.yabu.me/","wss://indexer.coracle.social/","wss://user.kindpag.es/"],Jr=["wss://relay.nostr.band/","wss://nos.lol/","wss://relay.damus.io/","wss://relay-jp.nostr.wirednet.jp/","wss://yabu.me/","wss://r.kojira.io/","wss://nrelay-jp.c-stellar.net/"],Cr="https://nostr.build/api/v2/upload/files",lo=1024*1024*1024,Qt={none:{skip:!0},low:{maxWidthOrHeight:2048,fileType:"image/webp",initialQuality:.95,useWebWorker:!0},medium:{maxWidthOrHeight:1024,fileType:"image/webp",initialQuality:.8,useWebWorker:!0},high:{maxWidthOrHeight:800,fileType:"image/webp",initialQuality:.5,useWebWorker:!0}},an={none:{skip:!0},low:{crf:20,preset:"superfast",maxSize:1280,audioBitrate:"128k",mediabunnyVideoQualityFactor:2,mediabunnyAudioQualityFactor:2},medium:{crf:26,preset:"superfast",maxSize:640,audioBitrate:"64k",audioSampleRate:44100,mediabunnyVideoQualityFactor:1,mediabunnyAudioQualityFactor:1},high:{crf:28,preset:"medium",maxSize:320,audioBitrate:"32k",audioSampleRate:16e3,audioChannels:1,mediabunnyVideoQualityFactor:.3,mediabunnyAudioQualityFactor:.3}},ds=/(?:^|[\s\n\u3000])#([^\s\n\u3000#]+)/g,wu=["http:","https:"],Xa=[".png",".jpg",".jpeg",".gif",".webp",".svg"],Ya=[".mp4",".webm",".mov",".avi",".mkv"],Qa=400,Za=10,Zt=100,_n=1,Ja=10,Ke={LOCALE:"locale",UPLOAD_ENDPOINT:"uploadEndpoint",CLIENT_TAG_ENABLED:"clientTagEnabled",IMAGE_COMPRESSION_LEVEL:"imageCompressionLevel",VIDEO_COMPRESSION_LEVEL:"videoCompressionLevel",NOSTR_RELAYS:"nostr-relays-",DRAFTS:"nostr-drafts",HASHTAG_HISTORY:"hashtagHistory",MEDIA_FREE_PLACEMENT:"mediaFreePlacement",DARK_MODE:"darkMode"},ei=20,en=50,bu=1e3,ti=[{label:"share.yabu.me",url:"https://share.yabu.me/api/v2/media"},{label:"nostpic.com",url:"https://nostpic.com/api/v2/media"},{label:"nostrcheck.me",url:"https://nostrcheck.me/api/v2/media"},{label:"files.sovbit.host",url:"https://files.sovbit.host/api/v2/media"},{label:"nostr.build",url:"https://nostr.build/api/v2/nip96/upload"}];function Ts(t){return t==="ja"?"https://share.yabu.me/api/v2/media":"https://nostrcheck.me/api/v2/media"}function co(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}const Ye={MIN_SCALE:1,MAX_SCALE:100,DEFAULT_SCALE:1,DOUBLE_CLICK_SCALE:2.5,RESET_THRESHOLD:1.3,ZOOM_DELTA:{IN:1.1,OUT:.9},THRESHOLD:.1,PINCH_MIN_DISTANCE:10},uo={FRICTION:.92,MIN_VELOCITY:.1},Su={TRANSITION_DURATION:"0.3s"},Pt={URL_REGEX:/https?:\/\/[^\s\u3000]+/gi,DEBOUNCE_DELAY:300,ENABLE_HASHTAGS:!0,ENABLE_AUTO_LINK:!0,ENABLE_IMAGE_CONVERSION:!0,HASHTAG_CLASS:"hashtag",PLUGIN_KEYS:{HASHTAG_DECORATION:"hashtag-decoration",LINK_AND_IMAGE_CONVERSION:"link-and-image-conversion",CONTENT_UPDATE_TRACKER:"content-update-tracker"}},Eu=["balloonMessage.info.hello","balloonMessage.info.hello2","balloonMessage.info.welcome","balloonMessage.info.waited","balloonMessage.info.relax","balloonMessage.info.good_weather","balloonMessage.info.thwomp","balloonMessage.info.sleep_on_floor","balloonMessage.info.home_here","balloonMessage.info.donai","balloonMessage.info.kita_na","balloonMessage.info.no_licking","balloonMessage.info.not_thwomp","balloonMessage.info.kitte_origin","balloonMessage.info.normal_stamp","balloonMessage.info.backside_curious","balloonMessage.info.corner_weapon","balloonMessage.info.square_peace","balloonMessage.info.how_much_stamp","balloonMessage.info.cancellation_done","balloonMessage.info.want_to_roll","balloonMessage.info.want_candy","balloonMessage.info.tetris_gone","balloonMessage.info.comfy_here","balloonMessage.info.what_did_you_eat","balloonMessage.info.go_to_bed_early","balloonMessage.info.did_you_brush_teeth","balloonMessage.info.kit-ten_ketten","balloonMessage.info.such_is_life"],xu=["balloonMessage.success.post_success","balloonMessage.success.sent","balloonMessage.success.to_everyone"],Pu="balloonMessage.error.post_error",Cu="balloonMessage.error.post_rejected",Lu="balloonMessage.error.post_timeout",Tu="balloonMessage.error.post_network_error",Gn={MAX_WAIT_TIME:15e3,RETRY_INTERVAL:1e3,TIMEOUT_MESSAGE:"Upload processing timeout"},Au=/nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{10,}/,Iu=/^nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58}$/,Nt={INDEXEDDB_NAME:"share-handler-db",INDEXEDDB_VERSION:1,STORE_NAME:"flags",REQUEST_TIMEOUT:3e3,SW_CONTROLLER_WAIT_TIMEOUT:100};function Mu(t){return Au.test(t)}function Du(t){return Iu.test(t)}function ku(t){return vl(t)}function Nu(t){return{npub:Vt.npubEncode(t),nprofile:Vt.nprofileEncode({pubkey:t,relays:[]})}}function Ou(t){try{const{type:e,data:r}=Vt.decode(t);if(e!=="nsec")return console.warn("nsec"),{hex:"",npub:"",nprofile:""};const n=ku(r),{npub:s,nprofile:o}=Nu(n);return{hex:n,npub:s,nprofile:o}}catch{return{hex:"",npub:"",nprofile:""}}}function ri(t){try{return Vt.npubEncode(t)}catch{return`npub1${t.slice(0,10)}...`}}function Ru(t,e=[],r=[]){try{const n=[];e.length>0&&n.push(e[0]);const s=3-n.length;if(s>0){const o=r.filter(i=>!n.includes(i));n.push(...o.slice(0,Math.min(s,2)))}return Vt.nprofileEncode({pubkey:t,relays:n})}catch{return""}}class ho{static addCacheBuster(e){if(!e)return e;try{const r=new URL(e);return r.searchParams.set("cb",Date.now().toString()),r.toString()}catch{return e}}static addProfileMarker(e,r=!1,n=!0){if(!e)return e;try{const s=new URL(e);return s.searchParams.set("profile","true"),r&&n?s.searchParams.has("cb")&&s.searchParams.set("cb",Date.now().toString()):s.searchParams.delete("cb"),s.toString()}catch{return e}}}class Fu{constructor(e={}){this.deps=e}createProfileData(e,r,n){const s=n?.profileRelays||[],o=n?.writeRelays||[],i=n?.forceRemote||!1;let l=e?.picture||"";if(l){i&&(l=ho.addCacheBuster(l));const c=this.deps.navigator?.onLine??!0;l=ho.addProfileMarker(l,i,c)}return{name:e?.name||"",picture:l,npub:ri(r),nprofile:Ru(r,s,o),profileRelays:s.length>0?s:void 0}}}class Hu{constructor(e,r,n){this.localStorage=e,this.console=r,this.profileDataFactory=n}save(e,r){try{if(r===null){this.localStorage.removeItem(`nostr-profile-${e}`);return}this.localStorage.setItem(`nostr-profile-${e}`,JSON.stringify(r)),this.console.log(":",e)}catch(n){this.console.error(":",n)}}get(e){try{const r=this.localStorage.getItem(`nostr-profile-${e}`);if(!r)return null;const n=JSON.parse(r);return n.npub&&n.nprofile?{...n,profileRelays:n.profileRelays||void 0}:this.profileDataFactory.createProfileData(n,e,{forceRemote:!1})}catch(r){return this.console.error(":",r),null}}clear(e){this.save(e,null)}}class Uu{constructor(e,r,n,s,o){this.rxNostr=e,this.profileDataFactory=r,this.setTimeoutFn=n,this.clearTimeoutFn=s,this.console=o}async fetchFromNetwork(e,r){r?.timeoutMs;const n=r?.additionalRelays??[];return new Promise(s=>{const o=gn();let i=!1,l=!1,c;const u=()=>{c&&typeof c.unsubscribe=="function"&&(c.unsubscribe(),c=void 0)},d=g=>{l||(l=!0,u(),s(g))},f=n.length>0?{on:{relays:n}}:void 0;c=(f?this.rxNostr.use(o,f):this.rxNostr.use(o)).subscribe({next:g=>{if(!l&&g.event?.kind===0&&g.event.pubkey===e){i=!0;try{const p=JSON.parse(g.event.content),m=[];if(g.from&&typeof g.from=="string"){const _=g.from.endsWith("/")?g.from:g.from+"/";m.push(_)}const x=this.profileDataFactory.createProfileData(p,e,{profileRelays:m,writeRelays:r?.writeRelays,forceRemote:r?.forceRemote});this.console.log("Kind 0:",x,"from relay:",g.from),d(x)}catch(p){this.console.error("Kind 0:",p),d(null)}}},complete:()=>{if(!l&&!i){this.console.log("EOSE");const g=this.profileDataFactory.createProfileData({},e,{writeRelays:r?.writeRelays,forceRemote:r?.forceRemote});d(g)}},error:g=>{l||(this.console.error(":",g),d(null))}}),o.emit({authors:[e],kinds:[0],until:Math.floor(Date.now()/1e3)}),o.over()})}}class Bu{constructor(e,r={}){this.rxNostr=e;const n=r.localStorage||(typeof window<"u"?window.localStorage:{}),s=r.navigator||(typeof window<"u"?window.navigator:{onLine:!0}),o=r.setTimeoutFn||((c,u)=>setTimeout(c,u)),i=r.clearTimeoutFn||(c=>clearTimeout(c)),l=r.console||(typeof window<"u"?window.console:{});this.profileDataFactory=new Fu({navigator:s}),this.storage=new Hu(n,l,this.profileDataFactory),this.networkFetcher=new Uu(e,this.profileDataFactory,o,i,l)}storage;networkFetcher;profileDataFactory;saveToLocalStorage(e,r){this.storage.save(e,r)}getFromLocalStorage(e){return this.storage.get(e)}async fetchProfileData(e,r){const n=this.networkFetcher.console;if(n.log(`: ${e}`),!r?.forceRemote){const o=this.storage.get(e);if(o)return n.log(":",o),o}n.log("...");const s=await this.networkFetcher.fetchFromNetwork(e,r);return s&&this.storage.save(e,s),s}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}getProfileDataFactory(){return this.profileDataFactory}}const As={type:"none",isAuthenticated:!1,pubkey:"",npub:"",nprofile:"",isValid:!1,isInitialized:!1,isExtensionLogin:!1};let Gr=B(We({...As}));const lt={get value(){return a(Gr)||As}};function Is(t){const r={...a(Gr),...t};r.isAuthenticated=r.type!=="none"&&r.isValid,r.isExtensionLogin=r.isAuthenticated&&r.type==="nostr-login"&&typeof window<"u"&&typeof window.nostr=="object"&&typeof window.nostr.signEvent=="function",v(Gr,r,!0),console.log("[updateAuthState] :",{type:r.type,isAuthenticated:r.isAuthenticated,isValid:r.isValid,pubkey:r.pubkey?r.pubkey.substring(0,8)+"...":"empty"})}function fo(t=!0){v(Gr,{...As,isInitialized:t?a(Gr).isInitialized:!1},!0)}function $u(t,e,r){if(!t||!e||!r){console.warn("setNsecAuth: All parameters are required");return}Is({type:"nsec",pubkey:t,npub:e,nprofile:r,isValid:!0})}function go(t,e,r,n){if(!t||!e||!r){console.warn("setNostrLoginAuth: All parameters are required");return}console.log("[setNostrLoginAuth] NostrLogin:",{pubkey:t.substring(0,8)+"...",npub:e.substring(0,12)+"...",type:"nostr-login",nostrLoginAuthMethod:n}),Is({type:"nostr-login",pubkey:t,npub:e,nprofile:r,isValid:!0,nostrLoginAuthMethod:n})}function zu(){Is({isInitialized:!0})}let po=B(null);const ju={get value(){return a(po)},set:t=>{v(po,t,!0)}};let vo=B(We({info:null,visible:!1}));const dr={get value(){return a(vo)},set:t=>{v(vo,t,!0)}};function mo(t){if(t===null){ni();return}dr.set({info:t,visible:!0})}function ni(){dr.set({info:null,visible:!1})}let Vn=B(!1);const $e={get value(){return a(Vn)},set:t=>{v(Vn,t,!0)},reset:()=>{v(Vn,!1)}};let wn=null;function Wu(t){wn=t}function Gu(){return wn}function Vu(){$e.set(!0),wn&&wn.abort?.(),Fr.set(0)}let bn=null;function qu(t){bn=t}function Ku(){return bn}function Xu(){$e.set(!0),bn&&bn.abort?.(),Hr.set(0)}function Yu(){Vu(),Xu()}let yo=B(!1);const Qu={get value(){return a(yo)},set:t=>{v(yo,t,!0)}};let _o=B(0);const Fr={get value(){return a(_o)},set:t=>{v(_o,t,!0)}};let wo=B(0);const Hr={get value(){return a(wo)},set:t=>{v(wo,t,!0)}};let bo=B(!1);const xt={get value(){return a(bo)},set:t=>{v(bo,t,!0)}};let So=B(!1),Eo=B(!1),xo=B(!1),Po=B(!1);const Ur={get value(){return a(So)},set:t=>{v(So,t,!0)}},Sn={get value(){return a(Eo)},set:t=>{v(Eo,t,!0)}},Ms={get value(){return a(xo)},set:t=>{v(xo,t,!0)}},Lr={get value(){return a(Po)},set:t=>{v(Po,t,!0)}};let Co=B(!1),Lo=B(!1),To=B(null);const tn={get value(){return a(Co)},set:t=>{v(Co,t,!0)}},cr={get value(){return a(Lo)},set:t=>{v(Lo,t,!0)}},rn={get value(){return a(To)},set:t=>{v(To,t,!0)}};function Zu(){Ur.set(!0)}function qn(){Ur.set(!1)}function Ju(){Sn.set(!0)}function ed(){Sn.set(!1)}function td(){Ms.set(!0)}function rd(){Ms.set(!1)}function nd(t={}){const{immediate:e=!1,onNeedRefresh:r,onOfflineReady:n,onRegistered:s,onRegisteredSW:o,onRegisterError:i}=t;let l,c,u;const d=async(h=!0)=>{await c,u?.()};async function f(){if("serviceWorker"in navigator){if(l=await At(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/ehagaki/sw.js",{scope:"/ehagaki/",type:"classic"})).catch(h=>{i?.(h)}),!l)return;u=()=>{l?.messageSkipWaiting()};{let h=!1;const g=()=>{h=!0,l?.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),r?.()};l.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"&&p.isExternal?g():!h&&n?.():p.isUpdate||n?.()}),l.addEventListener("waiting",g)}l.register({immediate:e}).then(h=>{o?o("/ehagaki/sw.js",h):s?.(h)}).catch(h=>{i?.(h)})}}return c=f(),d}function Ao(t={}){const{immediate:e=!0,onNeedRefresh:r,onOfflineReady:n,onRegistered:s,onRegisteredSW:o,onRegisterError:i}=t,l=fr(!1),c=fr(!1),u=nd({immediate:e,onOfflineReady(){c.set(!0),n?.()},onNeedRefresh(){l.set(!0),r?.()},onRegistered:s,onRegisteredSW:o,onRegisterError:i});return{needRefresh:l,offlineReady:c,updateServiceWorker:u}}const si=(()=>{try{if(typeof Ao=="function")return Ao({onRegistered:t=>{console.log("SW registered successfully",t)},onRegisterError(t){console.warn("SW registration error",t)},onNeedRefresh(){console.log("SW needs refresh - showing prompt")},immediate:!0,onOfflineReady(){console.log("App ready to work offline")}})}catch(t){console.warn("Failed to initialize Service Worker:",t)}return{needRefresh:{subscribe:()=>{}},updateServiceWorker:()=>{}}})(),Ds=si.needRefresh,sd=si.updateServiceWorker;let Io=B(null);const oi={get value(){return a(Io)},set:t=>{v(Io,t,!0)}};function od(){sd(!0)}function ad(){return navigator.serviceWorker?.controller?new Promise(t=>{const e=new MessageChannel;if(e.port1.onmessage=r=>{r.data?.version?(oi.set(r.data.version),t(r.data.version)):t(null)},navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({type:"GET_VERSION"},[e.port2]);else{t(null);return}setTimeout(()=>t(null),2e3)}):Promise.resolve(null)}let Mo=B(We({name:"",picture:"",npub:"",nprofile:""})),Do=B(!1),ko=B(!1);const $t={get value(){return a(Mo)},set:t=>{v(Mo,t,!0)}},ur={get value(){return a(Do)},set:t=>{v(Do,t,!0)}},bt={get value(){return a(ko)},set:t=>{v(ko,t,!0)}};let hs=null,No=B(We([])),Oo=B(null),Ro=B(!1),Fo=B(!1),fs=B(0);const Br={get value(){return a(No)},set:t=>{v(No,t,!0)}},ln={get value(){return a(Oo)},set:t=>{v(Oo,t,!0)}},Kn={get value(){return a(Ro)},set:t=>{v(Ro,t,!0)}},Ho={get value(){return a(Fo)},set:t=>{v(Fo,t,!0)}},gs={get value(){return a(fs)},set:t=>{v(fs,t,!0)}};function id(t){hs=t}function Uo(t){if(!hs||!t){ln.set(null),Br.set([]);return}const e=hs.loadRelayConfigForUI(t);if(!e){ln.set(null),Br.set([]);return}ln.set(e.relayConfig),Br.set(e.writeRelays)}function Bo(t,e){if(!t)return;const r=`nostr-relays-${t}`;try{localStorage.setItem(r,JSON.stringify(e)),ln.set(e);const n=kr.extractWriteRelays(e);Br.set(n),gs.set(a(fs)+1)}catch(n){console.error(":",n)}}const it=We({files:[],metadata:void 0,received:!1});function $o(t,e){it.files=t,it.metadata=e,it.received=t.length>0}function ld(){it.files=[],it.metadata=void 0,it.received=!1}function cd(){return it.files}function ud(){return it.metadata}const nr=We({content:null,received:!1});function dd(t){nr.content=t,nr.received=!!t}function hd(){nr.content=null,nr.received=!1}let nt=We({showSecretKeyDialog:!1,pendingPost:"",showImageFullscreen:!1,fullscreenImageSrc:"",fullscreenImageAlt:"",showPopupModal:!1,popupX:0,popupY:0,popupMessage:""});const St={get value(){return nt},showSecretKeyDialog:t=>{nt.pendingPost=t,nt.showSecretKeyDialog=!0},hideSecretKeyDialog:()=>{nt.showSecretKeyDialog=!1,nt.pendingPost=""},getPendingPost:()=>nt.pendingPost,showImageFullscreen:(t,e="")=>{nt.fullscreenImageSrc=t,nt.fullscreenImageAlt=e,nt.showImageFullscreen=!0},hideImageFullscreen:()=>{nt.showImageFullscreen=!1,nt.fullscreenImageSrc="",nt.fullscreenImageAlt=""},showPopupMessage:(t,e,r,n=1800)=>{nt.popupX=t,nt.popupY=e,nt.popupMessage=r,nt.showPopupModal=!0,setTimeout(()=>{nt.showPopupModal=!1},n)},hidePopupMessage:()=>{nt.showPopupModal=!1}};function fd(){const t=localStorage.getItem(Ke.DARK_MODE);return t!==null?t==="true":window.matchMedia("(prefers-color-scheme: dark)").matches}function En(t){const e=document.documentElement;t?(e.classList.add("dark"),e.classList.remove("light"),e.style.colorScheme="dark"):(e.classList.add("light"),e.classList.remove("dark"),e.style.colorScheme="light")}const ai=fd();let cn=B(We(ai));En(ai);typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem(Ke.DARK_MODE)===null&&(v(cn,e.matches,!0),En(e.matches))});const zo={get value(){return a(cn)},set:t=>{v(cn,t,!0),En(t),localStorage.setItem(Ke.DARK_MODE,t?"true":"false")},reset:()=>{localStorage.removeItem(Ke.DARK_MODE);const t=window.matchMedia("(prefers-color-scheme: dark)").matches;v(cn,t,!0),En(t)}};class xn{static parseKind10002Tags(e){const r={};return e.filter(n=>Array.isArray(n)&&n.length>=2&&n[0]==="r").forEach(n=>{const s=n[1];if(!s||typeof s!="string")return;let o=!0,i=!0;n.length>2&&(n.length===3?n[2]==="read"?i=!1:n[2]==="write"&&(o=!1):(o=n.includes("read"),i=n.includes("write"))),r[s]={read:o,write:i}}),r}static parseKind3Content(e){try{const r=JSON.parse(e);return r&&typeof r=="object"&&!Array.isArray(r)?r:null}catch{return null}}static isValidRelayConfig(e){return e?Array.isArray(e)?e.every(r=>typeof r=="string"):typeof e=="object"?Object.entries(e).every(([r,n])=>typeof r=="string"&&n&&typeof n=="object"&&"read"in n&&"write"in n&&typeof n.read=="boolean"&&typeof n.write=="boolean"):!1:!1}}class kr{static normalizeRelayUrl(e){return e.endsWith("/")?e:e+"/"}static mergeRelayConfigs(...e){const r=new Set;return e.forEach(n=>{Array.isArray(n)?n.forEach(s=>r.add(this.normalizeRelayUrl(s))):typeof n=="object"&&Object.keys(n).forEach(s=>{r.add(this.normalizeRelayUrl(s))})}),Array.from(r)}static extractWriteRelays(e){return Array.isArray(e)?e.map(r=>this.normalizeRelayUrl(r)):typeof e=="object"?Object.keys(e).filter(r=>e[r]?.write!==!1).map(r=>this.normalizeRelayUrl(r)):[]}static extractAllRelays(e){return Array.isArray(e)?e.map(r=>this.normalizeRelayUrl(r)):typeof e=="object"?Object.keys(e).map(r=>this.normalizeRelayUrl(r)):[]}}class gd{constructor(e,r,n,s){this.localStorage=e,this.console=r,this.relayListUpdatedStore=n,this.pubkeyHex=s}setPubkey(e){this.pubkeyHex=e}save(e,r){try{const n=`nostr-relays-${e}`;if(r===null){if(this.localStorage.removeItem(n),this.console.log(`: ${e}`),typeof window<"u")try{Bo(e,{})}catch{}return}if(!xn.isValidRelayConfig(r)){this.console.warn(":",r);return}if(this.localStorage.setItem(n,JSON.stringify(r)),typeof window<"u")try{Bo(e,r)}catch(s){this.console.warn(":",s)}this.relayListUpdatedStore&&this.relayListUpdatedStore.set(this.relayListUpdatedStore.value+1),this.console.log(":",e)}catch(n){this.console.error(":",n)}}get(e){try{const r=`nostr-relays-${e}`,n=this.localStorage.getItem(r);if(!n)return null;const s=JSON.parse(n);return xn.isValidRelayConfig(s)?s:null}catch(r){return this.console.error(":",r),null}}clear(e){this.save(e,null)}}class pd{constructor(e,r,n,s){this.rxNostr=e,this.console=r,this.setTimeoutFn=n,this.clearTimeoutFn=s}async fetchKind10002(e,r,n=3e3){return this.console.log(`Kind 10002: ${e}`),new Promise(s=>{const o=gn();let i=!1,l=!1,c;const u=()=>{c&&typeof c.unsubscribe=="function"&&(c.unsubscribe(),c=void 0)},d=f=>{l||(l=!0,u(),s(f))};try{c=this.rxNostr.use(o,{on:{relays:r}}).subscribe({next:f=>{if(!l&&f.event?.kind===10002&&f.event.pubkey===e)try{const h=xn.parseKind10002Tags(f.event.tags);Object.keys(h).length>0&&(i=!0,this.console.log("Kind 10002:",h),d({success:!0,relayConfig:h,source:"kind10002"}))}catch(h){this.console.error("Kind 10002:",h)}},complete:()=>{l||(i||this.console.log("Kind 10002: EOSE"),d({success:i,error:i?void 0:"not_found"}))},error:f=>{l||(this.console.error("Kind 10002:",f),d({success:!1,error:"network_error"}))}}),o.emit({authors:[e],kinds:[10002],until:Math.floor(Date.now()/1e3)}),o.over()}catch(f){this.console.error("Kind 10002:",f),d({success:!1,error:"request_error"})}})}async fetchKind3(e,r,n=3e3){return this.console.log(`Kind 3: ${e}`),new Promise(s=>{const o=gn();let i=!1,l=!1,c;const u=()=>{c&&typeof c.unsubscribe=="function"&&(c.unsubscribe(),c=void 0)},d=f=>{l||(l=!0,u(),s(f))};try{c=this.rxNostr.use(o,{on:{relays:r}}).subscribe({next:f=>{if(!l&&f.event?.kind===3&&f.event.pubkey===e){const h=xn.parseKind3Content(f.event.content);h&&(i=!0,this.console.log("Kind 3:",h),d({success:!0,relayConfig:h,source:"kind3"}))}},complete:()=>{l||(i||this.console.log("Kind 3: EOSE"),d({success:i,error:i?void 0:"not_found"}))},error:f=>{l||(this.console.error("Kind 3:",f),d({success:!1,error:"network_error"}))}}),o.emit({authors:[e],kinds:[3],until:Math.floor(Date.now()/1e3)}),o.over()}catch(f){this.console.error("Kind 3:",f),d({success:!1,error:"request_error"})}})}}class vd{constructor(e,r={}){this.rxNostr=e;const n=r.localStorage||(typeof window<"u"?window.localStorage:{}),s=r.console||(typeof window<"u"?window.console:{}),o=r.setTimeoutFn||((c,u)=>setTimeout(c,u)),i=r.clearTimeoutFn||(c=>clearTimeout(c)),l=r.relayListUpdatedStore||(typeof window<"u"?{value:0,set:c=>{}}:void 0);this.console=s,this.storage=new gd(n,s,l),this.networkFetcher=new pd(e,s,o,i)}storage;networkFetcher;console;saveToLocalStorage(e,r){this.storage.save(e,r)}getFromLocalStorage(e){return this.storage.get(e)}setBootstrapRelays(){try{this.rxNostr.use(gn(),{on:{relays:Zr}}).subscribe()}catch(e){this.console.error("Bootstrap relays:",e)}}useRelaysFromLocalStorageIfExists(e){const r=this.storage.get(e);if(r)try{return this.rxNostr.setDefaultRelays(r),this.console.log(":",r),!0}catch(n){return this.console.error(":",n),this.storage.clear(e),!1}return!1}async fetchUserRelays(e,r={}){const n=r.timeoutMs||3e3;if(this.console.log(`: ${e}`),!r.forceRemote){const i=this.storage.get(e);if(i)return this.rxNostr.setDefaultRelays(i),this.console.log(""),{success:!0,relayConfig:i,source:"localStorage"}}this.console.log("...");const s=await this.networkFetcher.fetchKind10002(e,Zr,n);if(s.success&&s.relayConfig)return this.rxNostr.setDefaultRelays(s.relayConfig),this.storage.save(e,s.relayConfig),this.console.log("Kind 10002"),{success:!0,relayConfig:s.relayConfig,source:"kind10002"};const o=await this.networkFetcher.fetchKind3(e,Zr,n);return o.success&&o.relayConfig?(this.rxNostr.setDefaultRelays(o.relayConfig),this.storage.save(e,o.relayConfig),this.console.log("Kind 3"),{success:!0,relayConfig:o.relayConfig,source:"kind3"}):(this.console.log(""),this.rxNostr.setDefaultRelays(Jr),this.console.log(":",Jr),this.storage.save(e,Jr),{success:!1,relayConfig:Jr,source:"fallback"})}getRelayListsForProfile(e,r=Zr){const n=this.storage.get(e);let s=[],o=[];return n?(s=kr.extractWriteRelays(n),o=kr.mergeRelayConfigs(n,r)):o=r.map(i=>kr.normalizeRelayUrl(i)),{writeRelays:s,additionalRelays:o}}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}loadRelayConfigForUI(e){const r=this.storage.get(e);if(!r)return null;const n=kr.extractWriteRelays(r);return{relayConfig:r,writeRelays:n}}}class md{relayManager;profileManager;constructor(e,r,n){this.relayManager=r,this.profileManager=n}async initializeRelays(e){e?this.relayManager.useRelaysFromLocalStorageIfExists(e)||this.relayManager.setBootstrapRelays():this.relayManager.setBootstrapRelays()}async fetchRelays(e,r=!1){if(!r){const s=this.relayManager.getFromLocalStorage(e);if(s)return console.log(":",s),{success:!0,relayConfig:s,source:"localStorage"}}return await this.relayManager.fetchUserRelays(e,{forceRemote:r})}async fetchProfile(e,r=!1){if(!e)return null;r&&this.profileManager.saveToLocalStorage(e,null);const{writeRelays:n,additionalRelays:s}=this.relayManager.getRelayListsForProfile(e);return await this.profileManager.fetchProfileData(e,{forceRemote:r,writeRelays:n,additionalRelays:s})}async initializeForLogin(e){console.log(`: ${e}`),await this.fetchRelays(e,!1);const r=await this.fetchProfile(e,!1);return console.log(`: ${e}`),r}async refreshRelaysAndProfile(e){console.log(`: ${e}`),await this.fetchRelays(e,!0);const r=await this.fetchProfile(e,!0);return console.log(`: ${e}`),r}getRelayManager(){return this.relayManager}getProfileManager(){return this.profileManager}}class $r{static isValidNsec(e){return Du(e)}static derivePublicKey(e){return Ou(e)}static pubkeyToNpub(e){try{return e?ri(e):""}catch(r){return console.error("pubkeynpub:",r),""}}}class yd{constructor(e,r,n){this.localStorage=e,this.console=r,this.secretKeyStore=n}saveToStorage(e){if(!e?.trim())return{success:!1,error:{type:"validation",message:"Key cannot be empty"}};try{const r=e.trim();return this.localStorage.setItem("nostr-secret-key",r),this.secretKeyStore.set(r),{success:!0}}catch(r){const n={type:"storage",message:"",originalError:r};return this.console.error(":",r),{success:!1,error:n}}}loadFromStorage(){let e=this.secretKeyStore.value;if(e)return e;try{return e=this.localStorage.getItem("nostr-secret-key"),e&&this.secretKeyStore.set(e),e}catch(r){return this.console.error(":",r),null}}getFromStore(){return this.secretKeyStore.value}hasStoredKey(){try{return!!this.localStorage.getItem("nostr-secret-key")}catch(e){return this.console.error(":",e),!1}}}class ii{constructor(e){this.window=e}isWindowNostrAvailable(){return typeof this.window<"u"&&"nostr"in this.window&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}async getPublicKeyFromWindowNostr(){if(!this.isWindowNostrAvailable()||!this.window?.nostr)return{success:!1,error:{type:"validation",message:"window.nostr is not available"}};try{return{success:!0,pubkey:await this.window.nostr.getPublicKey()}}catch(e){const r={type:"network",message:"window.nostr",originalError:e};return console.error("window.nostr:",e),{success:!1,error:r}}}}class li{constructor(e={}){this.deps=e}#e=B("");get _nsec(){return a(this.#e)}set _nsec(e){v(this.#e,e,!0)}#t=B(We({hex:"",npub:"",nprofile:""}));get _data(){return a(this.#t)}set _data(e){v(this.#t,e,!0)}#r=B(!1);get _isValid(){return a(this.#r)}set _isValid(e){v(this.#r,e,!0)}#n=B(!1);get _isNostrLogin(){return a(this.#n)}set _isNostrLogin(e){v(this.#n,e,!0)}get nsec(){return this._nsec}get data(){return this._data}get isValid(){return this._isValid}get isNostrLogin(){return this._isNostrLogin}get hex(){return this._data.hex}get npub(){return this._data.npub}get nprofile(){return this._data.nprofile}get currentIsValid(){return this._isValid}get currentHex(){return this._data.hex}get currentIsNostrLogin(){return this._isNostrLogin}setNsec(e){const r=e?.trim()||"";this._nsec=r,this._isNostrLogin=!1,this.updateFromNsec(r)}setNostrLoginAuth(e){if(e.type==="logout"){this.clear();return}if(!e.pubkey){console.warn("NostrLoginAuth: pubkey is required for login/signup");return}try{const r=e.npub||Vt.npubEncode(e.pubkey),n=Vt.nprofileEncode({pubkey:e.pubkey,relays:[]});let s;if(this.deps.localStorage&&typeof this.deps.localStorage.getItem=="function")try{const o=this.deps.localStorage.getItem("__nostrlogin_accounts");if(o){const i=JSON.parse(o);if(Array.isArray(i)){const l=i.find(c=>c?.pubkey===e.pubkey);if(l?.authMethod){const c=l.authMethod;(c==="connect"||c==="extension"||c==="local")&&(s=c)}}}}catch(o){console.warn("Failed to get authMethod from localStorage:",o)}this._data={hex:e.pubkey,npub:r,nprofile:n},this._isValid=!0,this._isNostrLogin=!0,this._nsec="",this.deps.setNostrLoginAuthFn?this.deps.setNostrLoginAuthFn(e.pubkey,r,n,s):setTimeout(()=>{this.deps.setNostrLoginAuthFn&&this.deps.setNostrLoginAuthFn(e.pubkey,r,n,s)},10),console.log("[PublicKeyState] NostrLogin:",{pubkey:e.pubkey,npub:r,type:e.type,authMethod:s})}catch(r){console.error("Failed to set NostrLogin auth:",r),this.clear()}}updateFromNsec(e){if(!e||!$r.isValidNsec(e)){this._resetState();return}try{const r=$r.derivePublicKey(e);r.hex?(this._data=r,this._isValid=!0):this._resetState()}catch(r){console.error("Failed to derive public key from nsec:",r),this._resetState()}}_resetState(){this._data={hex:"",npub:"",nprofile:""},this._isValid=!1}clear(){this._nsec="",this._isNostrLogin=!1,this.deps.clearAuthStateFn&&this.deps.clearAuthStateFn()}}class ci{storage;externalAuth;constructor(e={}){const r=e.localStorage||(typeof window<"u"?window.localStorage:{}),n=e.console||(typeof window<"u"?window.console:{}),s=e.secretKeyStore||{value:null,set:()=>{}},o=e.window||(typeof window<"u"?window:void 0);this.storage=new yd(r,n,s),this.externalAuth=new ii(o)}isValidNsec(e){return $r.isValidNsec(e)}derivePublicKey(e){return $r.derivePublicKey(e)}pubkeyToNpub(e){return $r.pubkeyToNpub(e)}saveToStorage(e){return this.storage.saveToStorage(e)}loadFromStorage(){return this.storage.loadFromStorage()}getFromStore(){return this.storage.getFromStore()}hasStoredKey(){return this.storage.hasStoredKey()}isWindowNostrAvailable(){return this.externalAuth.isWindowNostrAvailable()}async getPublicKeyFromWindowNostr(){return await this.externalAuth.getPublicKeyFromWindowNostr()}getStorage(){return this.storage}getExternalAuth(){return this.externalAuth}}const ps=new ci;let ui=We({content:"",hashtags:[],tags:[]});const zt=ui;function jo(){return tl(ui)}We({});let nn=We({});const vs={get value(){return nn},set:t=>{Object.assign(nn,t)},update:t=>{const e=t(nn);Object.assign(nn,e)}};let Tr=B(!1);const ms={get value(){return a(Tr)},set:t=>{v(Tr,t,!0)},toggle:()=>{v(Tr,!a(Tr))},reset:()=>{v(Tr,!1)}};let Ar=B(!1),Xn=B("");const sr={get value(){return a(Ar)},set:t=>{v(Ar,t,!0)},toggle:()=>{v(Ar,!a(Ar))},reset:()=>{v(Ar,!1)}},hr={get value(){return a(Xn)},set:t=>{v(Xn,t,!0)},reset:()=>{v(Xn,"")}};async function di(t){if(!t.url)throw new Error("url is required for imeta tag");if(!t.m)throw new Error("m (MIME type) is required for imeta tag");let e=t.dim;if(!e&&t.url)try{e=await new Promise(o=>{const i=new window.Image;i.onload=()=>{o(`${i.naturalWidth}x${i.naturalHeight}`)},i.onerror=()=>o(void 0),i.src=t.url})}catch{e=void 0}const r={content:t.content||"",url:t.url,m:t.m,size:t.size,dim:e,blurhash:t.blurhash,thumb:t.thumb,image:t.image,summary:t.summary,alt:t.alt,fallback:t.fallback};t.x&&(r.x=t.x),t.ox&&(r.ox=t.ox);const n=(await At(async()=>{const{generateEventTemplate:o}=await import("./vendor-nostr-CSSTtp-a.js").then(i=>i.a);return{generateEventTemplate:o}},[])).generateEventTemplate(r),s=[`url ${t.url}`];for(const o of n.tags){const[i,...l]=o;if(i==="url")continue;const c=l.join(" ").trim();c&&s.push(`${i} ${c}`)}return["imeta",...s]}async function _d(t){try{if($e.value)return null;const e=await new Promise((l,c)=>{const u=URL.createObjectURL(t),d=new window.Image;d.onload=()=>{URL.revokeObjectURL(u),l(d)},d.onerror=f=>{URL.revokeObjectURL(u),c(f)},d.src=u});if($e.value)return null;const r=document.createElement("canvas");r.width=Math.min(e.width,64),r.height=Math.min(e.height,64);const n=r.getContext("2d");if(!n)return null;n.drawImage(e,0,0,r.width,r.height);const s=n.getImageData(0,0,r.width,r.height),{encode:o}=await At(async()=>{const{encode:l}=await import("./vendor-image-DhZoa7y2.js").then(c=>c.a);return{encode:l}},[]);return o(s.data,s.width,s.height,4,4)}catch{return null}}async function wd(t){try{return URL.createObjectURL(t)}catch{return null}}async function bd(t){return await _d(t)}function hi(t){const e={};return t&&t.state&&t.state.doc&&t.state.doc.descendants(r=>{r.type?.name==="image"&&r.attrs?.src&&r.attrs?.blurhash&&!r.attrs?.isPlaceholder&&!r.attrs?.src?.startsWith("placeholder-")&&(e[r.attrs.src]=r.attrs.blurhash)}),e}function fi(t){const e=t.split(".").pop()?.toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",svg:"image/svg+xml"}[e||""]||"image/jpeg"}async function Sd(t){try{const e=await fetch(t);if(!e.ok)return null;const r=await e.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}catch(e){return console.warn("Failed to calculate image hash:",e),null}}const Wo=["client","eHagaki","31990:ec42c765418b3db9c85abff3a88f4a3bbe57535eebbdc54522041fa5328c0600:1754918316480","wss://relay.nostr.band"];function Ed(){try{const t=localStorage.getItem(Ke.CLIENT_TAG_ENABLED);return(t===null?!0:t==="true")?[...Wo]:null}catch{return[...Wo]}}const xd={getItem:t=>localStorage.getItem(t),setItem:(t,e)=>localStorage.setItem(t,e)},Pd={language:navigator.language},Cd={location:{reload:()=>window.location.reload()}},Ld={setTimeout:(t,e)=>setTimeout(t,e)};function vr(){try{return crypto.randomUUID()}catch{return ks()}}function ks(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function Td(t,e){const r=t.getItem(Ke.LOCALE),n=e.language;return r||(n&&n.startsWith("ja")?"ja":"en")}function Ad(t,e,r){const n=e.getItem(Ke.UPLOAD_ENDPOINT);return n&&ti.some(s=>s.url===n)?n:r||Ts(t)}function Id(t){const e=t.getItem(Ke.CLIENT_TAG_ENABLED),r=e===null?!0:e==="true";return e===null&&t.setItem(Ke.CLIENT_TAG_ENABLED,"true"),r}function Md(t,e){return t.getItem(Ke.IMAGE_COMPRESSION_LEVEL)||e||"medium"}function Dd(t={}){const{selectedEndpoint:e,selectedCompression:r,storage:n=xd,navigator:s=Pd}=t,o=Td(n,s),i=Ad(o,n,e),l=Id(n),c=Md(n,r);return{endpoint:i,clientTagEnabled:l,compression:c}}function kd(t,e,r={}){const{timeout:n=1e3,windowAdapter:s=Cd,timeoutAdapter:o=Ld}=r;e(!0),t(),o.setTimeout(()=>{s.location.reload()},n)}function Yn(t){if(t.type.startsWith("touch")){const e=t,r=e.touches[0]||e.changedTouches[0];return{x:r.clientX,y:r.clientY}}else{const e=t;return{x:e.clientX,y:e.clientY}}}function Nd(t,e,r,n,s){const o=window.innerWidth||document.documentElement.clientWidth||0,i=window.innerHeight||document.documentElement.clientHeight||0,l=0,c=o-l,u=i-l;return{x:Math.max(l,Math.min(c,t)),y:Math.max(l,Math.min(u,e))}}function Go(t,e){const r=[];for(let n=0;n<t.length;n+=e)r.push(t.slice(n,n+e));return r}const Pn={setBodyStyle(t,e){document.body.style.setProperty(t,e)},querySelector(t){return document.querySelector(t)},querySelectorAll(t){return document.querySelectorAll(t)},focusElement(t){t.focus()}};function or(t,e){Pn.setBodyStyle(t,e)}function Od(){or("overflow",""),or("user-select",""),or("-webkit-user-select","")}function Rd(){return document.activeElement}function Fd(t){return t.classList?.contains?.("tiptap-editor")||!!t.closest?.(".tiptap-editor")}function Hd(t){return["INPUT","TEXTAREA"].includes(t.tagName)||t.isContentEditable}function Ud(){const t=Rd();t&&(Fd(t)||Hd(t))&&(t.blur?.(),document.body?.focus?.())}function Tt(){return typeof window<"u"&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0||navigator&&!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|Mobile/i))}function Ns(){try{if(Ud(),Tt()){const t=document.querySelector(".tiptap-editor");t&&t.blur?.()}}catch{}}function Bd(t){if(typeof navigator>"u"||!("vibrate"in navigator))return;const e=Math.round(3+t*27);try{navigator.vibrate(e)}catch{}}function $d(){if(!(typeof navigator>"u"||!("vibrate"in navigator)))try{navigator.vibrate(0)}catch{}}function zd(t=200){if(!(typeof window>"u"||typeof navigator>"u"))if("vibrate"in navigator)try{navigator.vibrate(t)}catch{}else try{const e=document.getElementById("vibrateSwitch");e&&e.click()}catch{}}const Vo={maxWidth:780,maxHeight:240};function gi(t,e,r=Vo.maxWidth,n=Vo.maxHeight){if(t<=r&&e<=n)return{width:t,height:e,displayWidth:t,displayHeight:e};const s=t/e;let o,i;return t/r>e/n?(o=r,i=Math.round(r/s)):(i=n,o=Math.round(n*s)),{width:t,height:e,displayWidth:o,displayHeight:i}}function jd(t){if(!t)return null;const e=t.match(/^(\d+)x(\d+)$/);return e?{width:parseInt(e[1],10),height:parseInt(e[2],10)}:null}function Wd(t,e,r){return{start:{nodePos:r?.()},move:e,end:{nodeData:e?.nodeData||{pos:r?.()},dropX:0,dropY:0,target:null,dropPosition:null,...e}}[t]}function Gd(t){return{start:"touch-image-drag-start",move:"touch-image-drag-move",end:"touch-image-drop"}[t]}function zr(t,e,r){const n=Gd(t),s=Wd(t,e,r),o=new CustomEvent(n,{detail:s,bubbles:!0,cancelable:!0});window.dispatchEvent(o)}function Vd(t,e){return document.elementFromPoint(t,e)?.closest(".drop-zone-indicator")||null}function qd(){Pn.querySelectorAll(".drop-zone-indicator").forEach(t=>{t.classList.remove("drop-zone-hover")})}function Kd(t){t?.classList.add("drop-zone-hover")}function Xd(t,e){qd(),Kd(Vd(t,e))}function Yd(t,e=140){const r=Math.min(e,t.width||e),n=t.width>0?Math.round(t.height/t.width*r):r;return{width:r,height:n}}function Qd(t){if(!t)return null;const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d")?.drawImage(t,0,0),e}function Zd(t){if(!t)return null;const e=document.createElement("img");return e.src=t.src,e.alt=t.alt||"",e}function Jd(t,e,r){Object.assign(t.style,{width:`${e.width}px`,height:`${e.height}px`,left:`${r.x-e.width/2}px`,top:`${r.y-e.height/2}px`,transformOrigin:"center center",transition:"transform 120ms ease, opacity 120ms ease"})}function eh(t,e,r,n=!1){const s=t.getBoundingClientRect(),o=Yd(s);let i=null;if(n){const l=t.querySelector("canvas");l&&(i=Qd(l))}else{const l=t.querySelector("img");l&&(i=Zd(l))}return i?(Jd(i,o,{x:e,y:r}),i.classList.add("drag-preview"),document.body.appendChild(i),requestAnimationFrame(()=>{i.style.transform="scale(0.8) rotate(0deg)",i.style.opacity="0.95"}),i):null}function th(t,e,r){if(!t)return;const n=t.getBoundingClientRect(),s=n.width||100,o=n.height||100;t.style.left=`${e-s/2}px`,t.style.top=`${r-o/2}px`}function un(t){t?.parentNode?.removeChild(t)}function pi(t,e,r,n,s){const o=t-r,i=e-n;return o*o+i*i>s*s}function rh(t,e,r,n){return!!(t||e||r&&!n)}function Os(t){return t.isPlaceholder===!0||t.src?.startsWith("placeholder-")===!0||t.src?.startsWith("blob:")===!0||!t.src}function Nr(t){const e=t();if(e===void 0)return;Tt()&&Ns();const r=new CustomEvent("select-image-node",{detail:{pos:e}});window.dispatchEvent(r)}function nh(t,e){Ns();const r=new CustomEvent("image-fullscreen-request",{detail:{src:t,alt:e}});window.dispatchEvent(r)}function sh(t,e,r,n,s,o,i,l,c){return rh(r,n,o,e)?(t.preventDefault(),!1):s?(t.preventDefault(),e||t.stopPropagation(),nh(i,l),!0):(Nr(c),t.preventDefault(),e||t.stopPropagation(),!0)}function oh(t){return encodeURI(t.trim())}function ah(t){return wu.includes(t)}function ih(t){const e=t.toLowerCase();return Xa.some(r=>e.endsWith(r))}function lh(t){const e=t.toLowerCase();return Ya.some(r=>e.endsWith(r))}function vi(t){try{const e=oh(t),r=new URL(e);return ah(r.protocol)?r.href:null}catch{return null}}function mi(t){const e=vi(t);if(!e)return null;try{const r=new URL(e);return ih(r.pathname)?e:null}catch{return null}}function ch(t){const e=vi(t);if(!e)return null;try{const r=new URL(e);return lh(r.pathname)?e:null}catch{return null}}function yi(t){return t.replace(/\r\n/g,`
`).replace(/\r/g,`
`)}function uh(t){return!t||/[\s\n\u3000]/.test(t)}function dh(t){const e=/([.,;:!?\]}>]){2,}$/,r=t.match(e);if(r){const n=r[0];return{cleanUrl:t.slice(0,-n.length),trailingChars:n}}return{cleanUrl:t,trailingChars:""}}function hh(t){const{cleanUrl:e}=dh(t);return{cleanUrl:e,actualLength:e.length}}function fh(t){if(t.childCount===1){const e=t.firstChild;return e?.type.name==="paragraph"&&e.content.size===0}return t.childCount===0}function gh(t){return fh(t.doc)}function ph(t,e){return t.type.name==="paragraph"&&t.content.size===e&&t.textContent.trim().length===e}function vh(t){const e=[];return t.descendants(r=>{if(r.type.name==="paragraph"){const n=r.textContent;e.push(n)}else if(r.type.name==="image"){const n=r.attrs?.src;n&&e.push(n)}else if(r.type.name==="video"){const n=r.attrs?.src;n&&e.push(n)}}),e}function mh(t){if(!t)return null;try{return t.state?.doc??t.view?.state?.doc??null}catch{return null}}function _i(t){const e=mh(t);return e?vh(e).join(`
`):""}function yh(t,e,r){if(t===e)return null;let n=t;if(r){const s=r.resolve(t);s.parent.type.name==="paragraph"&&(n=s.after())}return n<e?{insertPos:n,deleteStart:e+1,deleteEnd:e+2}:n>e+1?{insertPos:n-1,deleteStart:e,deleteEnd:e+1}:null}function _h(t,e,r){return r.insertPos<r.deleteStart?t.insert(r.insertPos,e).delete(r.deleteStart,r.deleteEnd):t.delete(r.deleteStart,r.deleteEnd).insert(r.insertPos,e)}function Qn(t,e,r){const{tr:n,doc:s,schema:o}=t.state,i=e.pos,l=yh(r,i,s);if(!l)return!0;const c=o.nodes.image.create(e.attrs);try{const u=_h(n,c,l);return t.dispatch(u),!0}catch(u){return console.error("Error moving image:",u),!1}}function qo(t){t.dispatch(t.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null}))}function wi(t,e,r){if(!t)return;t.state.doc.descendants((s,o)=>{if(e(s,o))return r(s,o),!1})}function wh(t,e,r,n){t.update(s=>{const o={...s};return e&&delete o[e],o})}function Zn(t,e,r,n,s=!1){r&&(wh(n,t),wi(r,(o,i)=>{const l=o.type?.name;return(e&&l==="video"||!e&&l==="image")&&(o.attrs?.src===t||o.attrs?.id===t)},(o,i)=>{const l=r.state.tr.delete(i,i+o.nodeSize);r.view.dispatch(l),s&&console.log("[uploadHelper] Deleted placeholder:",t)}))}function bi(t,e=!1){if(!t)return;const{state:r}=t,{doc:n}=r,s=r.tr;let o=0;const i=[];n.descendants((l,c)=>{const u=l.type?.name,d=Os(l.attrs);(u==="image"||u==="video")&&d&&i.push({pos:c,size:l.nodeSize})}),i.reverse().forEach(({pos:l,size:c})=>{s.delete(l,l+c),o++}),o>0&&(t.view.dispatch(s),e&&console.log(`[editorUtils] Deleted ${o} placeholder(s)`))}function Si(t){const e=[],r=ds.source;return t.descendants((n,s)=>{if(!n.isText||!n.text)return;const o=n.text,i=new RegExp(r,"g");let l;for(;(l=i.exec(o))!==null;){const c=l[0].indexOf("#");if(c===-1)continue;const u=s+l.index+c,d=u+1+l[1].length;e.push({from:u,to:d,hashtag:l[1]})}}),e}function bh(t){const e=[],r=new Set;ds.lastIndex=0;let n;for(;(n=ds.exec(t))!==null;){const s=n[1];s&&s.trim()&&(r.has(s)||(r.add(s),e.push(s)))}return e}function Sh(t){const e=Si(t),r=[],n=new Set;for(const s of e)n.has(s.hashtag)||(n.add(s.hashtag),r.push(s.hashtag));return r}function Eh(t){Array.isArray(zt.hashtags)&&[...zt.hashtags];let e,r;typeof t=="string"?(r=t,e=bh(r)):(e=Sh(t),r=t.textContent);const n=e.map(s=>["t",s.toLowerCase()]);zt.content=r,zt.hashtags=e,zt.tags=n}let dt=B(We([]));const ze={get items(){return a(dt)},addItem:t=>{v(dt,[...a(dt),t],!0)},removeItem:t=>{v(dt,a(dt).filter(e=>e.id!==t),!0)},updateItem:(t,e)=>{v(dt,a(dt).map(r=>r.id===t?{...r,...e}:r),!0)},reorderItems:(t,e)=>{const r=[...a(dt)],[n]=r.splice(t,1);r.splice(e,0,n),v(dt,r,!0)},clearAll:()=>{v(dt,[],!0)},getItems:()=>[...a(dt)],getContentUrls:()=>a(dt).filter(t=>!t.isPlaceholder&&t.src).map(t=>t.src),getImageBlurhashMap:()=>{const t={};for(const e of a(dt))!e.isPlaceholder&&e.src&&e.type==="image"&&(t[e.src]={m:e.mimeType||"image/jpeg",blurhash:e.blurhash,ox:e.ox,x:e.x,dim:e.dim,alt:e.alt});return t},hasItems:()=>a(dt).length>0,hasNonPlaceholderItems:()=>a(dt).some(t=>!t.isPlaceholder)};function Ko(t){const r=Si(t).map(({from:n,to:s})=>rs.inline(n,s,{class:Pt.HASHTAG_CLASS}));return Mr.create(t,r)}function xh(t,e,r,n,s,o){const i=e.doc.resolve(s),l=i.parent,c=l.type.name==="paragraph"&&l.textContent.trim().length===0,u=ph(l,o-s),d=gh(e),f=r.create({src:n,alt:"Image"});if(c||u){const h=i.depth,g=i.start(h),p=i.end(h);return d||e.doc.childCount===1&&u?t.delete(0,e.doc.content.size).insert(0,f):t.replaceWith(g,p,f)}return t.replaceWith(s,o,f)}function Ph(t,e,r){const n=t.schema.marks.link,s=t.schema.nodes.image;if(!n)return null;let o=t.tr,i=!1;const l=[];e&&t.doc.descendants((c,u)=>{if(!c.isText)return;c.marks.find(f=>f.type===n)&&l.push({type:"removeMark",from:u,to:u+c.nodeSize})}),t.doc.descendants((c,u)=>{if(!c.isTextblock||c.childCount===0)return;let d="";const f=[];if(c.forEach((g,p)=>{g.isText&&g.text&&(f.push({textOffset:d.length,docPos:u+1+p}),d+=g.text)}),!d)return;let h;for(;(h=Pt.URL_REGEX.exec(d))!==null;){if(typeof h.index!="number")continue;const g=h.index,p=h[0],m=g>0?d[g-1]:void 0;if(!uh(m))continue;const{cleanUrl:x,actualLength:_}=hh(p),b=g+_,S=u+1+g,T=u+1+b;if(r){const P=mi(x);if(P&&s){l.push({type:"replaceImage",from:S,to:T,imageUrl:P});break}}if(e){if(x.length<8||!/^https?:\/\/[a-zA-Z0-9]/.test(x))continue;try{const E=new URL(x).hostname;if(E.length>0&&E.includes(".")){const M=E.split("."),A=M[M.length-1];if(A&&A.length>=2){const k=n.create({href:x});l.push({type:"addMark",from:S,to:T,mark:k})}}}catch{continue}}}}),l.sort((c,u)=>u.from-c.from);for(const c of l)c.type==="removeMark"?(o=o.removeMark(c.from,c.to,n),i=!0):c.type==="addMark"&&c.mark?(o=o.addMark(c.from,c.to,c.mark),i=!0):c.type==="replaceImage"&&c.imageUrl&&(xt.value?o=xh(o,t,s,c.imageUrl,c.from,c.to):(ze.addItem({id:vr(),type:"image",src:c.imageUrl,isPlaceholder:!1}),o=o.delete(c.from,c.to)),i=!0);return i&&o.docChanged?o:null}const Ch=qt.create({name:"contentTracking",addOptions(){return{debounceDelay:Pt.DEBOUNCE_DELAY,enableHashtags:Pt.ENABLE_HASHTAGS,enableAutoLink:Pt.ENABLE_AUTO_LINK,enableImageConversion:Pt.ENABLE_IMAGE_CONVERSION}},addStorage(){return{updateTimeout:null}},addProseMirrorPlugins(){const t=this.storage,e=this.options;return[...e.enableHashtags?[new Wt({key:new Gt(Pt.PLUGIN_KEYS.HASHTAG_DECORATION),state:{init:(r,{doc:n})=>Ko(n),apply(r,n){return r.docChanged?Ko(r.doc):n.map(r.mapping,r.doc)}},props:{decorations(r){return this.getState(r)}}})]:[],...e.enableAutoLink||e.enableImageConversion?[new Wt({key:new Gt(Pt.PLUGIN_KEYS.LINK_AND_IMAGE_CONVERSION),appendTransaction:(r,n,s)=>{if(!r.some(c=>c.docChanged))return null;const i=!r.some(c=>c.getMeta("paste")),l=Ph(s,e.enableAutoLink??!0,i&&(e.enableImageConversion??!0));return l&&l.setMeta("addToHistory",!1),l}})]:[],new Wt({key:new Gt(Pt.PLUGIN_KEYS.CONTENT_UPDATE_TRACKER),state:{init:()=>null,apply(r){return r.docChanged&&(t.updateTimeout&&clearTimeout(t.updateTimeout),t.updateTimeout=setTimeout(()=>{Eh(r.doc),window.dispatchEvent(new CustomEvent("editor-content-changed",{detail:{plainText:r.doc.textContent}}))},e.debounceDelay??Pt.DEBOUNCE_DELAY)),null}}})]},onDestroy(){this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout)}});function Xo(t){return t.split(/[\n ]+/).map(e=>e.trim()).filter(Boolean).map(e=>{const r=mi(e);if(r)return{url:r,type:"image"};const n=ch(e);return n?{url:n,type:"video"}:null}).filter(e=>e!==null)}function Lh(t,e){const r=e.parent;return r.type.name==="paragraph"&&r.textContent.trim().length===0}function Th(t){const{selection:e}=t,r=t.doc.resolve(e.from);if(Lh(e,r)){const n=r.depth,s=r.start(n),o=r.end(n);return{start:s,end:o}}return null}function Yo(t,e){return t.map((r,n)=>{const s=Date.now();if(r.type==="image")return e.nodes.image.create({src:r.url,alt:"Pasted image"});{const o=`pasted-video-${s}-${n}`;return e.nodes.video.create({src:r.url,id:o})}})}function Qo(t){const e=t.doc;if(!e)return t;const r=[];return e.descendants((n,s)=>{if(n.type.name==="paragraph"&&n.textContent.trim().length===0){if(e.childCount===1&&e.firstChild===n)return;let o=!1;n.descendants(i=>i.type&&(i.type.name==="image"||i.type.name==="video")?(o=!0,!1):!0),o||r.push([s,s+n.nodeSize])}}),r.sort((n,s)=>s[0]-n[0]),r.forEach(([n,s])=>{t=t.delete(n,s)}),t}const Ah=qt.create({name:"mediaPaste",addProseMirrorPlugins(){return[new Wt({key:new Gt("image-paste"),props:{handlePaste:(t,e)=>{const r=e.clipboardData?.getData("text/plain")||"",n=Xo(r);if(n.length>0){if(e.preventDefault(),!xt.value)return n.forEach(h=>{ze.addItem({id:vr(),type:h.type,src:h.url,isPlaceholder:!1})}),!0;const{state:s,dispatch:o}=t,{tr:i,selection:l,schema:c}=s,u=Yo(n,c);let d=i;const f=Th(s);if(f&&u.length>0){d=d.replaceWith(f.start,f.end,u[0]);let h=f.start+u[0].nodeSize;for(let g=1;g<u.length;g++)d=d.insert(h,u[g]),h+=u[g].nodeSize}else{let h=l.from;u.forEach(g=>{d=d.insert(h,g),h+=g.nodeSize})}return d=Qo(d),o(d),!0}return!1},handleTextInput:(t,e,r,n)=>{if(n.includes(`
`)||n.length>20){const s=Xo(n);if(s.length>0){const{state:o,dispatch:i}=t,{tr:l,schema:c}=o;if(!xt.value)return s.forEach(h=>{ze.addItem({id:vr(),type:h.type,src:h.url,isPlaceholder:!1})}),i(l.delete(e,r)),!0;const u=Yo(s,c);let d=l;d=d.delete(e,r);let f=e;return u.forEach(h=>{d=d.insert(f,h),f+=h.nodeSize}),d=Qo(d),i(d),!0}}return!1}}})]}}),Ih=qt.create({name:"imageDragDrop",addProseMirrorPlugins(){const t=new Gt("image-drag-drop"),e=new Gt("drop-zone-indicator");return[new Wt({key:t,state:{init:()=>({isDragging:!1,draggedNodePos:null,autoScrollInterval:null}),apply:(r,n)=>{const s=r.getMeta("imageDrag");return s?s.isDragging===!1&&n.autoScrollInterval?(clearInterval(n.autoScrollInterval),{...n,...s,autoScrollInterval:null}):{...n,...s}:n}},props:{handleDrop:(r,n,s,o)=>{const i=n.dataTransfer?.getData("application/x-tiptap-node");if(!o&&i)try{const l=JSON.parse(i);if(l.type==="image"){n.preventDefault();const c=r.posAtCoords({left:n.clientX,top:n.clientY});if(c&&typeof l.pos=="number")return qo(r),Qn(r,l,c.pos),!0}}catch(l){console.warn("Failed to parse drag data:",l)}return!1},handleDOMEvents:{dragstart:(r,n)=>Tt()?(n.preventDefault(),!0):!1,dragover:(r,n)=>Tt()?(n.preventDefault(),!0):!1,drop:(r,n)=>Tt()?(n.preventDefault(),!0):!1}},view:r=>{let n=null;const s=(u,d)=>{n&&(cancelAnimationFrame(n),n=null);const f=r.dom;if(!f)return;const h=f.getBoundingClientRect(),g=Zt;let p=0;u==="up"?p=d-h.top:p=h.bottom-d;const m=Math.max(0,Math.min(1,p/g)),x=_n+(Ja-_n)*(1-m),_=()=>{const b=f.scrollTop,S=f.scrollHeight,T=f.clientHeight;if(u==="up"&&b>0){const P=Math.max(0,b-x);f.scrollTop=P,P>0&&(n=requestAnimationFrame(_))}else if(u==="down"&&b<S-T){const P=Math.min(S-T,b+x);f.scrollTop=P,P<S-T&&(n=requestAnimationFrame(_))}};n=requestAnimationFrame(_)},o=()=>{n&&(cancelAnimationFrame(n),n=null)},i=u=>{const{nodeData:d,dropPosition:f,dropX:h,dropY:g}=u.detail;if(o(),r.dispatch(r.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null})),d&&d.type==="image"){let p;typeof f=="number"?p=f:p=r.posAtCoords({left:h,top:g})?.pos||d.pos,typeof d.pos=="number"&&Qn(r,d,p)}},l=u=>{const{nodePos:d}=u.detail;r.dispatch(r.state.tr.setMeta("imageDrag",{isDragging:!0,draggedNodePos:d}))},c=u=>{const{touchY:d}=u.detail;if(typeof d!="number"||!t.getState(r.state)?.isDragging)return;const h=r.dom;if(!h)return;const g=h.getBoundingClientRect(),p=Zt;d<g.top+p?s("up",d):d>g.bottom-p?s("down",d):o()};return window.addEventListener("touch-image-drop",i),window.addEventListener("touch-image-drag-start",l),window.addEventListener("touch-image-drag-move",c),{destroy(){o(),window.removeEventListener("touch-image-drop",i),window.removeEventListener("touch-image-drag-start",l),window.removeEventListener("touch-image-drag-move",c)}}}}),new Wt({key:e,state:{init(){return Mr.empty},apply(r,n,s,o){if(!Tt())return Mr.empty;const i=t.getState(o);if(!i?.isDragging)return Mr.empty;const l=[],c=o.doc;let u=!1;if(typeof i.draggedNodePos=="number"){const d=c.firstChild;d&&d.type.name==="image"&&d.attrs&&i.draggedNodePos===0&&(u=!0)}return u||l.push(rs.widget(0,()=>{const d=document.createElement("div");d.className="drop-zone-indicator drop-zone-top",d.setAttribute("data-drop-pos","0");const f=document.createElement("div");return f.className="drop-zone-bar",d.appendChild(f),d},{side:-1})),c.descendants((d,f)=>{if(d.type.name==="paragraph"||d.type.name==="image"){const h=f+d.nodeSize;if(typeof i.draggedNodePos=="number"&&h===i.draggedNodePos)return;i.draggedNodePos!==f&&l.push(rs.widget(h,()=>{const g=document.createElement("div");g.className="drop-zone-indicator drop-zone-between",g.setAttribute("data-drop-pos",h.toString());const p=document.createElement("div");return p.className="drop-zone-bar",g.appendChild(p),g},{side:1}))}}),Mr.create(c,l)}},props:{decorations(r){return this.getState(r)}}})]},addStorage(){return{moveImageNode:(t,e,r)=>(qo(t),Qn(t,e,r))}}}),Mh=qt.create({name:"smartBackspace",addProseMirrorPlugins(){return[new Wt({key:new Gt("smart-backspace"),props:{handleKeyDown(t,e){if(e.key!=="Backspace"||Tt()&&document.activeElement!==t.dom)return!1;const{state:r}=t,{selection:n,doc:s}=r;if(n.empty&&n.from===1){const o=s.firstChild,i=s.childCount>1?s.child(1):null;if(o&&o.type.name==="paragraph"&&o.content.size===0&&i&&i.type.name==="image")return t.dispatch(r.tr.delete(0,o.nodeSize)),!0}return!1}}})]}});var Dh=H('<div class="loader-container svelte-11vtpur"><div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div></div>'),kh=H('<div class="placeholder-image svelte-11vtpur" aria-hidden="true"></div>'),Nh=H('<span class="placeholder-text loading-text svelte-11vtpur"> </span>'),Oh=H("<div><!> <!> <!></div>");function It(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=pe(e,"text",3,!1),i=pe(e,"showImage",3,!1),l=pe(e,"showLoader",3,!1),c=pe(e,"customClass",3,""),u=N(()=>typeof o()=="string"?o():o()===!0?r()("loadingPlaceholder.loading"):"");var d=Oh(),f=y(d);{var h=_=>{var b=Dh();w(_,b)};se(f,_=>{l()&&_(h)})}var g=L(f,2);{var p=_=>{var b=kh();w(_,b)};se(g,_=>{i()&&_(p)})}var m=L(g,2);{var x=_=>{var b=Nh(),S=y(b);K(()=>z(S,a(u))),w(_,b)};se(m,_=>{a(u)&&_(x)})}K(()=>{Et(d,1,`loading-placeholder ${c()??""}`,"svelte-11vtpur"),Ie(d,"aria-label",a(u))}),w(t,d),Ue(),s()}var Rh=H("<button><!></button>");function Le(t,e){He(e,!0);let r=pe(e,"className",3,""),n=pe(e,"disabled",3,!1),s=pe(e,"type",3,"button"),o=pe(e,"ariaLabel",3,""),i=pe(e,"style",3,""),l=pe(e,"variant",3,"default"),c=pe(e,"shape",3,"rounded"),u=pe(e,"onClick",3,void 0),d=pe(e,"selected",3,!1),f=rl(e,["$$slots","$$events","$$legacy","className","disabled","type","ariaLabel","style","variant","shape","children","onClick","selected"]);function h(m){u()&&u()(m)}var g=Rh();Sa(g,()=>({type:s(),class:`${r()} ${l()} ${c()} ${d()?"selected":""}`,disabled:n(),"aria-label":o(),style:i(),onclick:h,...f}),void 0,void 0,void 0,"svelte-1klcfz0");var p=y(g);Rt(p,()=>e.children??qr),w(t,g),Ue()}function Fh(t,e={}){const{collapseEmptyLines:r=!1,maxConsecutiveEmptyLines:n=2}=e;let s=yi(t);if(r){const i=new RegExp(`\\n{${n+2},}`,"g");s=s.replace(i,`
`.repeat(n+1))}let o=s.split(`
`);return o.length>0&&o[o.length-1]===""&&(o=o.slice(0,-1)),o.length===1&&o[0]===""&&(o=[]),{normalized:s,lines:o}}function Hh(t){return t.join(`
`)}async function Rs(t,e="",r,n){const s=r??navigator;try{if(s?.clipboard&&typeof s.clipboard.writeText=="function"){await s.clipboard.writeText(t),console.log(`${e} copied to clipboard`);return}}catch(o){console.error(`Failed to copy ${e}:`,o),await Zo(t,e,n);return}await Zo(t,e,n)}async function Zo(t,e="",r){const n=r??window;try{const s=n&&n.document||document,o=s.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-9999px",o.style.top="0",o.setAttribute("readonly","true"),s.body.appendChild(o),o.focus(),o.select();const i=s.execCommand&&s.execCommand("copy");if(s.body.removeChild(o),i)console.log(`${e} copied to clipboard (fallback)`);else throw new Error("fallback_copy_failed")}catch(s){console.warn(`Failed to copy ${e} (both clipboard API and fallback failed):`,s)}}var Uh=H('<div class="copy-icon svg-icon"></div>'),Bh=H('<div class="close-icon svg-icon"></div>'),$h=H("<!> <!>",1);function Fs(t,e){He(e,!0);let r=pe(e,"layout",3,"editor-image");function n(c){c.stopPropagation(),Rs(e.src,"URL"),St.showPopupMessage(c.clientX,c.clientY,e.copySuccessMessage)}function s(c){c.stopPropagation(),e.onDelete()}var o=$h(),i=re(o);Le(i,{variant:"copy",shape:"circle",get className(){return`media-copy-btn media-copy-btn--${r()??""}`},get ariaLabel(){return e.copyAriaLabel},onClick:n,children:(c,u)=>{var d=Uh();w(c,d)},$$slots:{default:!0}});var l=L(i,2);Le(l,{variant:"close",shape:"circle",get className(){return`media-delete-btn media-delete-btn--${r()??""}`},get ariaLabel(){return e.deleteAriaLabel},onClick:s,children:(c,u)=>{var d=Bh();w(c,d)},$$slots:{default:!0}}),w(t,o),Ue()}function Hs(){let t=B(!1);function e(){v(t,!0)}function r(){v(t,!1)}return{get isLoaded(){return a(t)},handleLoad:e,handleError:r}}function Ei(t,e){const r=e.delay??Qa,n=e.moveThreshold??Za;let s=null,o={x:0,y:0};function i(){s!==null&&(clearTimeout(s),s=null)}function l(d){if(d.touches.length!==1){i();return}const f=d.touches[0];o={x:f.clientX,y:f.clientY},i(),s=setTimeout(()=>{s=null,e.onLongPress?.(o.x,o.y,d)},r)}function c(d){if(d.touches.length!==1){i();return}if(s===null)return;const f=d.touches[0];pi(f.clientX,f.clientY,o.x,o.y,n)&&i()}function u(d){s!==null&&(i(),e.onTap?.(d))}we(()=>{const d=t();if(d)return d.addEventListener("touchstart",l,{passive:!0}),d.addEventListener("touchmove",c,{passive:!0}),d.addEventListener("touchend",u,{passive:!0}),()=>{i(),d.removeEventListener("touchstart",l),d.removeEventListener("touchmove",c),d.removeEventListener("touchend",u)}})}var zh=H('<video controls playsinline="" autoplay loop preload="metadata"><track kind="captions"/> </video>',2),jh=H('<div class="video-node-container svelte-gkj9ee"><div class="video-wrapper svelte-gkj9ee" data-video-node="" role="button" tabindex="0"><!></div> <!></div>');function Wh(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=B(void 0),i=B(void 0);const l=Hs();let c=N(()=>Os(e.node.attrs)),u=N(()=>e.node.attrs.id||(typeof e.getPos=="function"?(e.getPos()??"unknown").toString():"unknown"));function d(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}const f=48;Ei(()=>a(o),{onTap:m=>{if(a(c)||d())return;const x=m.changedTouches[0];if(a(o)){const _=a(o).getBoundingClientRect();if(x.clientY>_.bottom-f)return}m.stopPropagation(),Nr(e.getPos)},delay:200,moveThreshold:10});function h(m){a(c)||d()||m.target!==a(o)&&(m.stopPropagation(),m.preventDefault(),Nr(e.getPos))}function g(m){if(!a(c)&&!d()&&m.button!==2){if(a(o)){const x=a(o).getBoundingClientRect(),_=m.clientY,b=x.bottom;if(_>b-f)return}m.stopPropagation(),Nr(e.getPos)}}function p(m){(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),Nr(e.getPos))}Pa(t,{children:(m,x)=>{var _=jh(),b=y(_);b.__click=h,b.__keydown=p;var S=y(b);{var T=A=>{{let k=N(()=>r()("videoNode.uploading"));It(A,{get text(){return a(k)},showLoader:!0})}},P=A=>{var k=zh();k.muted=!0;let V;k.__click=g;var J=L(y(k));st(k,Y=>v(o,Y),()=>a(o)),K(Y=>{Ie(k,"src",e.node.attrs.src),V=Et(k,1,"editor-video svelte-gkj9ee",null,V,{loaded:l.isLoaded}),Ie(k,"data-node-id",a(u)),z(J,` ${Y??""}`)},[()=>r()("videoNode.not_supported")]),Je("loadeddata",k,function(...Y){l.handleLoad?.apply(this,Y)}),Je("error",k,function(...Y){l.handleError?.apply(this,Y)}),w(A,k)};se(S,A=>{a(c)?A(T):A(P,!1)})}st(b,A=>v(i,A),()=>a(i));var E=L(b,2);{var M=A=>{{let k=N(()=>r()("videoContextMenu.delete")),V=N(()=>r()("videoContextMenu.copyUrl")),J=N(()=>r()("videoContextMenu.copySuccess"));Fs(A,{get src(){return e.node.attrs.src},get onDelete(){return e.deleteNode},get deleteAriaLabel(){return a(k)},get copyAriaLabel(){return a(V)},get copySuccessMessage(){return a(J)},layout:"editor-video"})}};se(E,A=>{a(c)||A(M)})}w(m,_)},$$slots:{default:!0}}),Ue(),s()}ft(["click","keydown"]);const Gh=bl.create({name:"video",group:"block",draggable:!1,addAttributes(){return{src:{default:null},isPlaceholder:{default:!1}}},parseHTML(){return[{tag:"video[src]"}]},renderHTML({HTMLAttributes:t}){return["video",Sl(t,{controls:!0})]},addNodeView(){return Ca(Wh)}});function Vh(t){const e=[];return t.content.forEach(r=>{if(r.type.name==="paragraph"){let n="";r.content.forEach(s=>{s.isText&&(n+=s.text||"")}),e.push(n)}else if(r.type.name==="image"||r.type.name==="video"){const n=r.attrs?.src;n&&e.push(n)}else r.isTextblock&&e.push(r.textContent)}),e}const qh=qt.create({name:"clipboardExtension",addProseMirrorPlugins(){return[new Wt({key:new Gt("clipboardExtension"),props:{handlePaste(t,e,r){const{state:n,dispatch:s}=t,{clipboardData:o}=e;if(!o||o.files&&o.files.length>0)return!1;const l=o.getData("text/plain");if(!l)return!1;const c=o.types.includes("text/html");let u=!1;if(c){const x=o.getData("text/html");if(x.includes("<strong>")||x.includes("<b>")||x.includes("<em>")||x.includes("<i>")||x.includes("<a ")||x.includes("<a>"))return!1;u=x.includes('data-block="true"')&&x.includes("data-editor=")}const{lines:d}=Fh(l,{collapseEmptyLines:u,maxConsecutiveEmptyLines:1});if(d.length===0)return!1;const f=d.join(`
`),h=n.schema.text(f),g=El.from(h),p=new xl(g,0,0),m=n.tr.replaceSelection(p).setMeta("paste",!0).setMeta("uiEvent","paste").setMeta("addToHistory",!0);return s(m),!0},clipboardTextSerializer(t){const e=Vh(t);return Hh(e)}}})]}}),Jo=typeof navigator<"u"&&/android/i.test(navigator.userAgent),Kh=4e3,Xh=qt.create({name:"androidCompositionFix",addStorage(){return{keepAliveInterval:null,isComposing:!1}},onCreate(){if(!Jo)return;const t=this.editor,e=this.storage,r=()=>{e.isComposing=!0,e.keepAliveInterval&&clearInterval(e.keepAliveInterval),e.keepAliveInterval=setInterval(()=>{if(e.isComposing&&t.view.composing){const s=new CompositionEvent("compositionupdate",{bubbles:!0,cancelable:!0,data:""});t.view.dom.dispatchEvent(s)}},Kh)},n=()=>{e.isComposing=!1,e.keepAliveInterval&&(clearInterval(e.keepAliveInterval),e.keepAliveInterval=null)};t.view.dom.addEventListener("compositionstart",r),t.view.dom.addEventListener("compositionend",n),this.__compositionStartHandler=r,this.__compositionEndHandler=n},onDestroy(){if(!Jo)return;const t=this.storage;t.keepAliveInterval&&(clearInterval(t.keepAliveInterval),t.keepAliveInterval=null);const e=this.__compositionStartHandler,r=this.__compositionEndHandler;this.editor?.view?.dom&&(e&&this.editor.view.dom.removeEventListener("compositionstart",e),r&&this.editor.view.dom.removeEventListener("compositionend",r))}});var Yh=H('<li role="option"><span class="hashtag-prefix svelte-17vo95w">#</span> </li>'),Qh=H('<ul class="hashtag-suggestion-list svelte-17vo95w" role="listbox"></ul>');function Zh(t,e){He(e,!0);let r=B(0);function n(){e.items.length>0&&v(r,(a(r)+1)%e.items.length)}function s(){e.items.length>0&&v(r,(a(r)-1+e.items.length)%e.items.length)}function o(){const f=e.items[a(r)];return f!==void 0?(e.onSelect(f),!0):!1}function i(){v(r,0)}var l={moveDown:n,moveUp:s,confirmSelection:o,resetIndex:i},c=Se(),u=re(c);{var d=f=>{var h=Qh();Ct(h,22,()=>e.items,g=>g,(g,p,m)=>{var x=Yh();let _;x.__mousedown=S=>{S.preventDefault(),e.onSelect(p)};var b=L(y(x),1,!0);K(()=>{_=Et(x,1,"hashtag-suggestion-item svelte-17vo95w",null,_,{selected:a(m)===a(r)}),Ie(x,"aria-selected",a(m)===a(r)),z(b,p)}),Je("mouseenter",x,()=>{v(r,a(m),!0)}),w(g,x)}),w(f,h)};se(u,f=>{e.items.length>0&&f(d)})}return w(t,c),Ue(l)}ft(["mousedown"]);const Jh=50,ea=5,ef=100;function xi(){try{const t=localStorage.getItem(Ke.HASHTAG_HISTORY);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e.filter(r=>typeof r?.tag=="string"&&typeof r?.lastUsed=="number"):[]}catch{return[]}}function tf(t){try{localStorage.setItem(Ke.HASHTAG_HISTORY,JSON.stringify(t))}catch{}}function rf(t){if(!t.length)return;const e=Date.now(),r=xi();for(const n of t){if(!n||n.length>ef)continue;const s=n.toLowerCase(),o=r.findIndex(i=>i.tag.toLowerCase()===s);o>=0?r[o].lastUsed=e:r.push({tag:n,lastUsed:e})}r.sort((n,s)=>s.lastUsed-n.lastUsed),tf(r.slice(0,Jh))}function nf(t){const e=xi();if(!e.length)return[];if(!t)return e.sort((o,i)=>i.lastUsed-o.lastUsed).slice(0,ea).map(o=>o.tag);const r=t.toLowerCase(),n=[],s=[];for(const o of e){const i=o.tag.toLowerCase();i.startsWith(r)?n.push(o):i.includes(r)&&s.push(o)}return n.sort((o,i)=>i.lastUsed-o.lastUsed),s.sort((o,i)=>i.lastUsed-o.lastUsed),[...n,...s].slice(0,ea).map(o=>o.tag)}const sf=qt.create({name:"hashtagSuggestion",addProseMirrorPlugins(){return[Pl({editor:this.editor,char:"#",allowSpaces:!1,allowedPrefixes:[" ",`
`,"	",""],items:({query:t})=>nf(t),render:()=>{let t=null,e=null,r=[],n=null;function s(){return t??{}}function o(){!e||!n||(t&&(On(t),t=null),r.length&&(t=Ea(Zh,{target:e,props:{items:r,onSelect:n}})))}function i(u){if(!e||!u)return;const d=u();if(!d)return;const f=window.innerHeight,h=200,g=f-d.bottom;e.style.left=`${Math.max(0,d.left)}px`,g<h&&d.top>h?e.style.top=`${d.top-h-4}px`:e.style.top=`${d.bottom+4}px`}function l(){const u=document.createElement("div");return u.style.position="fixed",u.style.zIndex="9999",document.body.appendChild(u),u}function c(){t&&(On(t),t=null),e&&(e.remove(),e=null),r=[],n=null}return{onStart(u){r=u.items??[],n=u.command,r.length&&(e=l(),o(),requestAnimationFrame(()=>i(u.clientRect)))},onUpdate(u){if(r=u.items??[],n=u.command,!r.length){t&&(On(t),t=null);return}e||(e=l()),o(),s().resetIndex?.(),requestAnimationFrame(()=>i(u.clientRect))},onKeyDown(u){if(!r.length)return!1;const d=s();switch(u.event.key){case"ArrowDown":return d.moveDown?.(),!0;case"ArrowUp":return d.moveUp?.(),!0;case"Enter":case"Tab":return d.confirmSelection?.()??!1;default:return!1}},onExit(){c()}}},command:({editor:t,range:e,props:r})=>{t.chain().focus().deleteRange(e).insertContent("#"+r+" ").run()}})]}});function of({getButtonElement:t,getPos:e,dragState:r,getIsPlaceholder:n,getNodeAttrs:s,handleInteraction:o}){const i=Tt();function l(){r.isDragging=!0,zr("start",{},e),r.preview=eh(r.startTarget,r.startPos.x,r.startPos.y,n())}function c(){r.longPressTimeout&&(clearTimeout(r.longPressTimeout),r.longPressTimeout=null),r.startTarget=null}function u(p,m,x){c(),r.startPos={x:m,y:x},r.startTarget=p,r.longPressTimeout=setTimeout(()=>{l()},Qa)}function d(p){if(p.touches.length!==1)return;Ns();const m=Yn(p);u(p.currentTarget,m.x,m.y)}function f(p){if(p.touches.length!==1){c();return}const m=Yn(p);if(!r.isDragging&&r.longPressTimeout&&pi(m.x,m.y,r.startPos.x,r.startPos.y,Za)){c();return}r.isDragging&&(p.preventDefault(),th(r.preview,m.x,m.y),Xd(m.x,m.y),zr("move",{touchX:m.x,touchY:m.y,nodePos:e()}))}function h(p){if(r.longPressTimeout&&(c(),!r.isDragging)){o(p,!0);return}if(!r.isDragging)return;p.preventDefault();const m=Yn(p),x=document.elementFromPoint(m.x,m.y);if(x){const b=x.closest(".drop-zone-indicator")?.getAttribute("data-drop-pos"),S=s();zr("end",{nodeData:{type:"image",attrs:S,pos:e()},dropX:m.x,dropY:m.y,target:x,dropPosition:b?parseInt(b,10):null})}r.isDragging=!1,un(r.preview),r.preview=null}we(()=>{const p=t();if(!(!i||!p))return p.addEventListener("touchstart",d,{passive:!1}),p.addEventListener("touchmove",f,{passive:!1}),p.addEventListener("touchend",h,{passive:!1}),()=>{p.removeEventListener("touchstart",d),p.removeEventListener("touchmove",f),p.removeEventListener("touchend",h),c(),un(r.preview),r.preview=null}});function g(){c(),un(r.preview)}return{cleanup:g}}var af=H('<img draggable="false"/>'),lf=H('<div class="image-node-container svelte-4wwag0"><button type="button" tabindex="0"><!> <!></button> <!></div>');function cf(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=sa,i=oa,l=B(void 0);const c=Hs(),u=Tt(),d=400;let f=N(()=>Os(e.node.attrs)),h=N(()=>!a(f)&&!!e.node.attrs.src),g=N(()=>a(f)||a(h)&&!c.isLoaded),p=B(null),m=N(()=>a(p)?.displayWidth??240),x=N(()=>a(p)?.displayHeight??160);we(()=>{const E=e.node.attrs.src;if(!E)return;const M=vs.value[E];if(M){v(p,M,!0);return}const A=jd(e.node.attrs.dim);if(A){const k=gi(A.width,A.height);v(p,k,!0),vs.update(V=>({...V,[E]:k}))}});function _(E,M=!1){sh(E,M,o.isDragging,a(f),e.selected,i.justSelected,e.node.attrs.src,e.node.attrs.alt||"Image",e.getPos)&&!e.selected&&(i.justSelectedTimeout&&clearTimeout(i.justSelectedTimeout),i.justSelected=!0,i.justSelectedTimeout=setTimeout(()=>{i.justSelected=!1,i.justSelectedTimeout=null},d))}const{cleanup:b}=of({getButtonElement:()=>a(l),getPos:()=>e.getPos(),dragState:o,getIsPlaceholder:()=>a(f),getNodeAttrs:()=>e.node.attrs,handleInteraction:_});function S(E){_(E,!1)}function T(E,M){if(E==="start"){const A=M;if(!A?.dataTransfer&&!u)return;if(u){M?.preventDefault();return}A?.dataTransfer&&(A.dataTransfer.setData("application/x-tiptap-node",JSON.stringify({type:"image",attrs:e.node.attrs,pos:e.getPos()})),A.dataTransfer.effectAllowed="move"),o.isDragging=!0,zr("start")}else o.isDragging=!1,un(o.preview),zr("end")}function P(E){E.preventDefault()}jr(()=>{b(),i.justSelectedTimeout&&clearTimeout(i.justSelectedTimeout),Object.assign(sa,{isDragging:!1,longPressTimeout:null,startTarget:null,preview:null}),Object.assign(oa,{justSelected:!1,justSelectedTimeout:null})}),Pa(t,{children:(E,M)=>{var A=lf(),k=y(A);let V;k.__click=S;var J=y(k);{var Y=R=>{{let I=N(()=>r()("imageNode.uploading"));It(R,{get text(){return a(I)},showLoader:!0})}};se(J,R=>{a(g)&&R(Y)})}var q=L(J,2);{var O=R=>{var I=af();let ne;I.__contextmenu=P,K(()=>{Ie(I,"src",e.node?.attrs?.src),Ie(I,"alt",e.node?.attrs?.alt||""),ne=Et(I,1,"editor-image svelte-4wwag0",null,ne,{"image-loading":!c.isLoaded})}),Je("load",I,function(...U){c.handleLoad?.apply(this,U)}),Je("error",I,function(...U){c.handleError?.apply(this,U)}),w(R,I)};se(q,R=>{a(h)&&R(O)})}st(k,R=>v(l,R),()=>a(l));var Q=L(k,2);{var ge=R=>{{let I=N(()=>r()("imageContextMenu.delete")),ne=N(()=>r()("imageContextMenu.copyUrl")),U=N(()=>r()("imageContextMenu.copySuccess"));Fs(R,{get src(){return e.node.attrs.src},get onDelete(){return e.deleteNode},get deleteAriaLabel(){return a(I)},get copyAriaLabel(){return a(ne)},get copySuccessMessage(){return a(U)},layout:"editor-image"})}};se(Q,R=>{a(g)||R(ge)})}K(()=>{V=Et(k,1,"editor-image-button svelte-4wwag0",null,V,{"is-placeholder":a(g)}),Lt(k,a(g)?`width: ${a(m)}px; height: ${a(x)}px;`:void 0),Ie(k,"data-dragging",o.isDragging),Ie(k,"aria-label",e.node?.attrs?.alt||"Image"),Ie(k,"draggable",!u)}),Je("dragstart",k,R=>T("start",R)),Je("dragend",k,()=>T("end")),Je("dragover",k,function(...R){(u?I=>I.preventDefault():void 0)?.apply(this,R)}),Je("drop",k,function(...R){(u?I=>I.preventDefault():void 0)?.apply(this,R)}),w(E,A)},$$slots:{default:!0}}),Ue(),s()}ft(["click","contextmenu"]);const ta=new Set(["image","video"]),ra=".node-image.is-node-focused, .node-video.is-node-focused",uf=qt.create({name:"gapCursorFocusReset",onSelectionUpdate(){const{state:t,view:e}=this.editor,r=t.selection,n=s=>{e.dom.querySelectorAll(ra).forEach(o=>{s&&o===s||o.classList.remove("is-node-focused")})};if(r instanceof pn&&ta.has(r.node.type.name)){const s=e.nodeDOM(r.from),o=s?.matches(".node-image, .node-video")?s:s?.closest(".node-image, .node-video");if(o){n(o),o.classList.add("is-node-focused");return}}if(r instanceof Cl){n();return}n()},onCreate(){const t=e=>{const{view:r}=this.editor,n=e.target;if(r.dom.contains(n))return;r.dom.querySelectorAll(ra).forEach(i=>{i.classList.remove("is-node-focused")});const{state:s}=r,{selection:o}=s;if(o instanceof pn&&ta.has(o.node.type.name)){const i=s.doc.content.size,l=s.doc.resolve(i),c=s.tr.setSelection(Ll.near(l)).setMeta("addToHistory",!1);r.dispatch(c)}};document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),this.editor.__outsideClickHandler=t},onDestroy(){const t=this.editor.__outsideClickHandler;t&&(document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t),delete this.editor.__outsideClickHandler)}});function df(t){const{placeholderText:e,onSubmitPost:r,onUpdate:n,onCreate:s,onDestroy:o}=t;return Tl({extensions:[Al.configure({paragraph:{HTMLAttributes:{class:"editor-paragraph"}},undoRedo:{depth:100,newGroupDelay:500},dropcursor:{color:"dodgerblue",width:5,class:"tiptap-dropcursor"},link:!1}),Il.extend({renderHTML({mark:l,HTMLAttributes:c}){return["a",{...c,href:l.attrs.href},0]}}).configure({HTMLAttributes:{class:"preview-link",rel:null,target:"_blank"},autolink:!1,linkOnPaste:!1,defaultProtocol:"https",isAllowedUri:(l,c)=>{if(!c.defaultValidate(l)||l.startsWith("./")||l.startsWith("../"))return!1;try{const u=new URL(l,`${c.defaultProtocol}://`);return c.protocols.includes(u.protocol.replace(":",""))}catch{return!1}},shouldAutoLink:l=>{if(l.length<8)return!1;try{return new URL(l).hostname.length>0&&/^https?:\/\/[a-zA-Z0-9]/.test(l)}catch{return!1}},protocols:[{scheme:"http",optionalSlashes:!1},{scheme:"https",optionalSlashes:!1}]}),Ml.configure({HTMLAttributes:{class:"editor-image"},allowBase64:!1}).extend({addAttributes(){return{src:{default:null},blurhash:{default:null},isPlaceholder:{default:null},dim:{default:null},alt:{default:null}}},addNodeView(){return Ca(cf)}}),Dl.configure({types:["image","video"],attributeName:"id"}),kl.configure({className:"is-node-focused",mode:"all"}),uf,Ch,sf,Gh,qh,Ah,Ih,Mh,Xh,Nl.configure({placeholder:e,emptyEditorClass:"is-editor-empty",showOnlyWhenEditable:!0,showOnlyCurrent:!1,includeChildren:!1})],enablePasteRules:["clipboardExtension"],content:{type:"doc",content:[{type:"paragraph"}]},editorProps:{attributes:{class:"tiptap-editor"},handleClickOn(l,c,u,d,f,h){let g=f.target;for(;g&&g!==l.dom;){if(g.tagName==="A"&&g.hasAttribute("href"))return f.ctrlKey||f.metaKey?!1:(f.preventDefault(),!0);g=g.parentElement}return!1},handleKeyDown:(l,c)=>(c.ctrlKey||c.metaKey)&&(c.key==="Enter"||c.key==="NumpadEnter")?(c.preventDefault(),r(),!0):!1},onCreate({editor:l}){window.__currentEditor=l,s?.(l)},onUpdate(){n?.()},onDestroy(){delete window.__currentEditor,o?.()}})}function Pi(t,e){let r,n=-1;return e.sizeInfo?.originalFilename&&(n=t.findIndex(s=>s.file.name===e.sizeInfo.originalFilename),n!==-1&&(r=t[n])),!r&&t.length>0&&(r=t[0],n=0),{matched:r,matchedIndex:n}}function Ci(t){return t.length===0?"":t.length===1?t[0].error||"postComponent.upload_failed":`${t.length}`}function dn(t,e){ze.removeItem(t),e.update(r=>{const n={...r};return delete n[t],n})}function Li(t){return{serverBlurhash:t.blurhash??t.b??void 0,oxFromServer:t.ox??t.o??void 0,xFromServer:t.x??void 0,dimFromServer:t.dim??void 0}}async function Ti(t,e,r,n,s,o,i,l){if(r?s[t]=r:e.ox&&(s[t]=e.ox),n)return o[t]=n,n;try{const c=await i(t);return c&&(o[t]=c),c??void 0}catch(c){l&&console.warn("[placeholderManager] failed to calculate x hash",{url:t,error:c});return}}function Ai(t,e,r,n,s){const o=new n,i=[];return t.forEach((l,c)=>{const u=l.type.startsWith("video/"),d=o.validateMediaFile(l);if(!d.isValid){r(d.errorMessage||"postComponent.upload_failed");return}const f=`placeholder-${s}-${c}-${ks()}`,h=e[c];i.push({file:l,placeholderId:f,ox:h?.ox,dimensions:h?.dimensions,isVideo:u})}),i}async function hf(t,e,r=!1){if($e.value){r&&console.log("[generateBlurhashes] Aborted before blurhash generation");return}const n=new e,s=t.map(async o=>{if($e.value){r&&console.log("[generateBlurhashes] Aborted during blurhash generation");return}try{const i=await n.generateBlurhashForFile(o.file);if($e.value){r&&console.log("[generateBlurhashes] Aborted after blurhash generation");return}i&&(o.blurhash=i)}catch(i){r&&console.warn("[generateBlurhashes] blurhash generation failed",{file:o.file.name,error:i})}});await Promise.all(s)}function ff(t,e,r,n,s,o,i=!1){if(!r)return[];const l=r.state,c=l.selection,u=c instanceof pn&&c.node?.type?.name==="image",d=Date.now();i&&console.log("[dev] insertPlaceholdersIntoEditor:",{fileCount:t.length,isImageNodeSelected:u,selectionType:c.constructor.name,selectionFrom:c.from,selectionTo:c.to,docSize:l.doc.content.size});const f=l.doc.childCount===1&&l.doc.firstChild?.type.name==="paragraph"&&l.doc.firstChild.content.size===0;let h=l.tr,g=u?c.to:c.from;const p=Ai(t,e,n,o,d),m=[];return p.forEach((x,_)=>{const{file:b,placeholderId:S,ox:T,dimensions:P,isVideo:E}=x;try{let M;if(E)M=l.schema.nodes.video.create({src:S,isPlaceholder:!0});else{const A={src:S,isPlaceholder:!0};P&&(A.dim=`${P.width}x${P.height}`,s.update(k=>({...k,[S]:P}))),M=l.schema.nodes.image.create(A)}f&&_===0?(h=h.replaceWith(0,l.doc.content.size,M),g=M.nodeSize):(h=h.insert(g,M),g+=M.nodeSize),m.push({file:b,placeholderId:S,ox:T,dimensions:P})}catch(M){i&&console.error("[uploadHelper] failed to insert media node",{placeholderId:S,file:b.name,isVideo:E,error:M,insertPos:g,docSize:l.doc.content.size}),n(E?"":"")}}),m.length>0&&r.view.dispatch(h),m}async function gf(t,e,r,n,s,o,i,l=!1){const c=[],u={};let d="";const f=[...e];for(let h=0;h<t.length;h++){const g=t[h];if(l&&console.log("[uploadHelper] Processing result",h,":",{success:g.success,url:g.url,filename:g.filename,sizeInfo:g.sizeInfo,aborted:g.aborted}),g.aborted){const p=f.shift();p&&Zn(p.placeholderId,p.file.type.startsWith("video/"),r,o,l);continue}if(g.success&&g.url){const{matched:p,matchedIndex:m}=Pi(f,g);if(p&&m!==-1&&r){f.splice(m,1);const x=p.file.type.startsWith("video/");if(l&&console.log("[uploadHelper] Replacing placeholder",{placeholderId:p.placeholderId,url:g.url,isVideo:x}),wi(r,_=>{const b=_.type?.name;return(x&&b==="video"||!x&&b==="image")&&_.attrs?.src===p.placeholderId},(_,b)=>{if(x){const S=r.state.tr.setNodeMarkup(b,void 0,{..._.attrs,src:g.url,isPlaceholder:!1});r.view.dispatch(S)}else{const S={..._.attrs,src:g.url,isPlaceholder:!1,blurhash:p.blurhash??void 0};p.dimensions&&(S.dim=`${p.dimensions.width}x${p.dimensions.height}`);const T=r.state.tr.setNodeMarkup(b,void 0,S);r.view.dispatch(T),o.update(P=>{const E={...P};return delete E[p.placeholderId],p.dimensions&&(E[g.url]=p.dimensions),E})}}),!x){const _=g.nip94||{},{serverBlurhash:b,oxFromServer:S,xFromServer:T}=Li(_);b&&(u[g.url]=b),await Ti(g.url,p,S,T,n,s,i,l)}}}else if(!g.success){c.push(g);const p=f.shift();p&&Zn(p.placeholderId,p.file.type.startsWith("video/"),r,o,l)}}for(const h of f)Zn(h.placeholderId,h.file.type.startsWith("video/"),r,o,l);return c.length&&(d=Ci(c)),{failedResults:c,errorMessage:d,imageServerBlurhashMap:u}}function pf(t,e,r,n,s,o=!1){const i=Date.now(),l=Ai(t,e,r,s,i),c=[];for(const u of l){const{file:d,placeholderId:f,ox:h,dimensions:g,isVideo:p}=u,m={id:f,type:p?"video":"image",src:f,isPlaceholder:!0,dimensions:g,dim:g?`${g.width}x${g.height}`:void 0};ze.addItem(m),!p&&g&&n.update(x=>({...x,[f]:g})),c.push({file:d,placeholderId:f,ox:h,dimensions:g}),o&&console.log("[gallery] inserted placeholder:",f,p?"video":"image")}return c}async function vf(t,e,r,n,s,o,i,l=!1){const c=[];let u="";const d=[...e];for(let f=0;f<t.length;f++){const h=t[f];if(h.aborted){const g=d.shift();g&&dn(g.placeholderId,s);continue}if(h.success&&h.url){const{matched:g,matchedIndex:p}=Pi(d,h);if(g&&p!==-1){d.splice(p,1);const m=g.file.type.startsWith("video/"),x=h.nip94||{};if(m)ze.updateItem(g.placeholderId,{src:h.url,isPlaceholder:!1,mimeType:i(h.url)});else{const{serverBlurhash:_,oxFromServer:b,xFromServer:S,dimFromServer:T}=Li(x),P=i(h.url);ze.updateItem(g.placeholderId,{src:h.url,isPlaceholder:!1,blurhash:_??g.blurhash,mimeType:P,ox:b??g.ox,dim:T??(g.dimensions?`${g.dimensions.width}x${g.dimensions.height}`:void 0)});const E=await Ti(h.url,g,b,S,r,n,o,l);E&&ze.updateItem(g.placeholderId,{x:E}),g.dimensions&&s.update(M=>{const A={...M};return delete A[g.placeholderId],A[h.url]=g.dimensions,A})}l&&console.log("[gallery] replaced placeholder:",g.placeholderId,"->",h.url)}}else if(!h.success){c.push(h);const g=d.shift();g&&dn(g.placeholderId,s)}}for(const f of d)dn(f.placeholderId,s);return c.length&&(u=Ci(c)),{failedResults:c,errorMessage:u}}function mf(t,e){for(const r of t)dn(r.placeholderId,e)}let yf=We({value:""}),na=B(null);const Us={get value(){return a(na)},set:t=>{v(na,t,!0)}};let Re=We({content:"",canPost:!1,isUploading:!1,uploadErrorMessage:"",postStatus:{sending:!1,success:!1,error:!1,message:""},hasImage:!1});const sa=We({isDragging:!1,startPos:{x:0,y:0},longPressTimeout:null,startTarget:null,preview:null}),oa=We({justSelected:!1,justSelectedTimeout:null});function _f(t,e){const r=ze.getItems().some(n=>!n.isPlaceholder);return!!t.trim()||e||r}function wf(t,e=!1){Re.content=t,Re.hasImage=e,Re.canPost=_f(t,e)}function kt(t){Re.postStatus=t}function bf(){Re.content="",Re.canPost=!1,Re.uploadErrorMessage="",Re.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1},Re.hasImage=!1}function Sf(){Re.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1}}let ys;function Ef(t){ys=t}async function xf(){ys&&await ys()}class Pf{allowedOrigins;console;windowObj;constructor(e={}){this.allowedOrigins=e.allowedOrigins||[],this.console=e.console||(typeof console<"u"?console:{log:()=>{},warn:()=>{},error:()=>{}}),this.windowObj=e.window||(typeof window<"u"?window:void 0)}isInIframe(){if(!this.windowObj)return!1;try{return this.windowObj.self!==this.windowObj.top}catch{return!0}}getParentOrigin(){if(!this.windowObj||!this.isInIframe())return null;try{return this.windowObj.parent.location.origin}catch{if(this.windowObj.document&&this.windowObj.document.referrer)try{return new URL(this.windowObj.document.referrer).origin}catch(r){return this.console.warn(":",r),null}return null}}isOriginAllowed(e){return e?this.allowedOrigins.length===0?!0:this.allowedOrigins.includes(e):!1}sendMessageToParent(e){if(!this.windowObj||!this.isInIframe())return!1;const r=this.getParentOrigin();if(!r)return this.console.warn("postMessage"),!1;if(!this.isOriginAllowed(r))return this.console.warn(` ${r} `),!1;try{return this.windowObj.parent.postMessage(e,r),this.console.log(` (${r}) :`,e),!0}catch(n){return this.console.error("postMessage:",n),!1}}notifyPostSuccess(){return this.sendMessageToParent({type:"POST_SUCCESS",timestamp:Date.now()})}notifyPostError(e){return this.sendMessageToParent({type:"POST_ERROR",timestamp:Date.now(),error:e})}setAllowedOrigins(e){this.allowedOrigins=e}addAllowedOrigin(e){this.allowedOrigins.includes(e)||this.allowedOrigins.push(e)}}const Cf=new Pf;function Lf(t){if(!t.endsWith(`
`))return t;const n=[...Xa,...Ya].map(o=>o.replace(".","\\.")).join("|");return new RegExp(`(https?://[^\\s\\n]+(?:${n}))\\n$`,"i").test(t)?t.slice(0,-1):t}class Tf{static validatePost(e,r,n){return e.trim()?n?r?{valid:!0}:{valid:!1,error:"login_required"}:{valid:!1,error:"nostr_not_ready"}:{valid:!1,error:"empty_content"}}}class aa{static async buildEvent(e,r,n,s,o,i,l,c,u){const d=Array.isArray(n)&&n.length?[...n]:Array.isArray(r)?r.map(g=>["t",g.toLowerCase()]):[],f=d.some(g=>g[0]==="t"&&g[1]==="nsfw");if((c||f)&&(u&&u.trim()?d.push(["content-warning",u.trim()]):d.push(["content-warning"]),c&&!f&&d.push(["t","nsfw"])),l){const g=l();g&&d.push(g)}if(o&&i){for(const[g,p]of Object.entries(o))if(g&&p&&p.m){const m=await i({url:g,...p});d.push(m)}}const h={kind:1,content:e,tags:d,created_at:Math.floor(Date.now()/1e3)};return s&&(h.pubkey=s),h}}class Af{constructor(e,r){this.rxNostr=e,this.console=r}sendEvent(e,r){return new Promise(n=>{let s=!1,o=0,i=0,l=null;const c=()=>{try{l?.unsubscribe()}catch{}},u=h=>{s||(s=!0,c(),n(h))},d={next:h=>{this.console.log(` ${h.from} :`,h.ok?"":"",h.notice?`(${h.notice})`:""),i++,h.ok?u({success:!0}):o++},error:h=>{this.console.error(":",h),u({success:!1,error:"post_network_error"})},complete:()=>{s||(i>0&&o===i?u({success:!1,error:"post_rejected"}):u({success:!1,error:"post_timeout"}))}},f={completeOn:"all-ok"};r&&(f.signer=r),l=this.rxNostr.send(e,f).subscribe(d)})}}class If{constructor(e,r={}){this.deps=r,e&&this.setRxNostr(e),this.deps.console=r.console||(typeof window<"u"?window.console:{}),this.deps.createImetaTagFn=r.createImetaTagFn||di,this.deps.getClientTagFn=r.getClientTagFn||Ed,this.deps.seckeySignerFn=r.seckeySignerFn||ts,this.deps.extractContentWithImagesFn=r.extractContentWithImagesFn||_i,this.deps.extractImageBlurhashMapFn=r.extractImageBlurhashMapFn||hi,this.deps.resetEditorStateFn=r.resetEditorStateFn||bf,this.deps.resetPostStatusFn=r.resetPostStatusFn||Sf,this.deps.iframeMessageService=r.iframeMessageService||Cf,this.deps.hashtagPinStore=r.hashtagPinStore||ms,this.deps.saveHashtagsToHistoryFn=r.saveHashtagsToHistoryFn||rf}rxNostr=null;eventSender=null;setRxNostr(e){this.rxNostr=e,this.eventSender=new Af(e,this.deps.console||console)}validatePost(e){const r=this.deps.authStateStore||{value:lt.value};return Tf.validatePost(e,r.value.isAuthenticated,!!this.rxNostr)}async submitPost(e,r){const n=Lf(e),s=this.validatePost(n);if(!s.valid)return this.deps.iframeMessageService?.notifyPostError(s.error),{success:!1,error:s.error};if(!this.eventSender)return this.deps.iframeMessageService?.notifyPostError("nostr_not_ready"),{success:!1,error:"nostr_not_ready"};try{const o=this.deps.authStateStore||{value:lt.value},i=this.deps.hashtagStore||zt,{hashtags:l,tags:c}=this.getHashtagArrays(i),u=this.deps.keyManager||ps,d=this.deps.window||(typeof window<"u"?window:void 0),f=sr.value,h=hr.value,g=o.value;if(g.type==="nostr-login"&&u.isWindowNostrAvailable()&&d?.nostr)try{const S=g.pubkey;if(!S)return this.deps.iframeMessageService?.notifyPostError("pubkey_not_found"),{success:!1,error:"pubkey_not_found"};const T=await aa.buildEvent(n,l,c,S,r,this.deps.createImetaTagFn,this.deps.getClientTagFn,f,h);if(typeof d.nostr.signEvent=="function"){const P=await d.nostr.signEvent(T);this.deps.console?.log(":",P);const E=await this.eventSender.sendEvent(P);return E.success?(this.deps.saveHashtagsToHistoryFn?.(l),this.deps.iframeMessageService?.notifyPostSuccess()):this.deps.iframeMessageService?.notifyPostError(E.error),E}else return this.deps.iframeMessageService?.notifyPostError("nostr_sign_event_not_supported"),{success:!1,error:"nostr_sign_event_not_supported"}}catch(S){return this.deps.console?.error("window.nostr:",S),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}const m=u.getFromStore()||u.loadFromStorage();if(!m)return this.deps.iframeMessageService?.notifyPostError("key_not_found"),{success:!1,error:"key_not_found"};const x=await aa.buildEvent(n,l,c,void 0,r,this.deps.createImetaTagFn,this.deps.getClientTagFn,f,h),_=this.deps.seckeySignerFn?this.deps.seckeySignerFn(m):ts(m),b=await this.eventSender.sendEvent(x,_);return b.success?(this.deps.saveHashtagsToHistoryFn?.(l),this.deps.iframeMessageService?.notifyPostSuccess()):this.deps.iframeMessageService?.notifyPostError(b.error),b}catch(o){return this.deps.console?.error(":",o),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}}getEventSender(){return this.eventSender}getHashtagArrays(e){const r=e||zt,n=this.deps.hashtagSnapshotFn;if(n){const s=n(r);return{hashtags:Array.isArray(s?.hashtags)?[...s.hashtags]:[],tags:Array.isArray(s?.tags)?s.tags.map(o=>[...o]):[]}}if(r===zt)try{const s=jo();return{hashtags:Array.isArray(s?.hashtags)?[...s.hashtags]:[],tags:Array.isArray(s?.tags)?s.tags.map(o=>[...o]):[]}}catch(s){this.deps.console?.warn("hashtag_snapshot_failed",s)}return{hashtags:Array.isArray(r?.hashtags)?[...r.hashtags]:[],tags:Array.isArray(r?.tags)?r.tags.map(s=>[...s]):[]}}preparePostContent(e){const r=this.deps.extractContentWithImagesFn(e)||"";if(!xt.value){const n=ze.getContentUrls();if(n.length>0){const s=r.trim();return s?s+`
`+n.join(`
`):n.join(`
`)}return r}return r}prepareImageBlurhashMap(e,r,n){if(!xt.value)return ze.getImageBlurhashMap();const s=this.deps.extractImageBlurhashMapFn(e),o={};for(const[i,l]of Object.entries(s))o[i]={m:fi(i),blurhash:l,ox:r[i],x:n[i]};return o}async performPostSubmission(e,r,n,s,o,i){const l=this.preparePostContent(e),c=this.prepareImageBlurhashMap(e,r,n);s?.();try{const u=await this.submitPost(l,c);u.success?o?.():i?.(u.error||"post_error")}catch{i?.("post_error")}}applyEmptyStateToEditor(e){e.chain().clearContent().run()}resetPostContent(e){this.applyEmptyStateToEditor(e),this.deps.resetEditorStateFn?.(),this.deps.resetPostStatusFn?.(),sr.reset(),hr.reset(),ze.clearAll()}clearContentAfterSuccess(e){const r=this.deps.hashtagPinStore.value,n=r?jo():null;if(this.applyEmptyStateToEditor(e),sr.reset(),hr.reset(),ze.clearAll(),r&&n&&n.hashtags.length>0){const s=" "+n.hashtags.map(o=>"#"+o).join(" ");e.commands.insertContent(s),e.commands.focus("start")}}}function Cn(t,e){return e?`${(t/1048576).toFixed(2)}MB`:`${Math.round(t/1024)}KB`}function Mf(t,e){if(t<=0)return 100;const r=e/t*100;return Number(r.toPrecision(2))}function Df(t,e){const r=t/1024>=1e3;return`${Cn(t,r)}  ${Cn(e,r)}`}function kf(t,e,r,n,s,o){return{originalSize:t,compressedSize:e,wasCompressed:r,compressionRatio:Mf(t,e),sizeReduction:Df(t,e),originalFilename:n,compressedFilename:s,wasSkipped:o}}function Nf(t){return t.wasCompressed||t.originalFilename!==t.compressedFilename||t.originalSize!==t.compressedSize||!!t.wasSkipped}function ia(t){if(!t||!Nf(t))return null;const e=t.originalSize/1024>=1e3;return{wasCompressed:t.wasCompressed,originalSize:Cn(t.originalSize,e),compressedSize:Cn(t.compressedSize,e),compressionRatio:t.compressionRatio,originalFilename:t.originalFilename,compressedFilename:t.compressedFilename,wasSkipped:t.wasSkipped}}async function Ii(t,e=window.crypto.subtle){if($e.value)throw new Error("Upload aborted by user");const r=await t.arrayBuffer(),n=await e.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}async function Of(t,e){try{return await Ii(t,e)}catch{return}}async function Rf(t){return new Promise(e=>{if(!t.type.startsWith("image/")){e(null);return}const r=new Image,n=URL.createObjectURL(t);r.onload=()=>{try{const s=gi(r.naturalWidth,r.naturalHeight);URL.revokeObjectURL(n),e(s)}catch(s){console.error("Failed to calculate image display size:",s),URL.revokeObjectURL(n),e(null)}},r.onerror=()=>{URL.revokeObjectURL(n),e(null)},r.src=n})}function Ff(t,e){const n={"image/webp":".webp","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/avif":".avif","image/bmp":".bmp"}[e];return n?`${t.replace(/\.[^.]+$/,"")}${n}`:t}async function Hf(t,e){const r=[];if($e.value)throw new Error("Upload aborted by user");for(let n=0;n<t.length;n++){const s=t[n],[o,i]=await Promise.all([Of(s,e.crypto),e.getImageDimensions(s)]);r.push({file:s,index:n,ox:o,dimensions:i??void 0})}return r}function Uf(t){return t.map(e=>({caption:e.name,expiration:"",size:e.size,alt:e.name,media_type:void 0,content_type:e.type||"",no_transform:"true"}))}function Ht(t,...e){}function Pm(t,...e){}function Cm(t,e,r){if(t.size>=e.size)return{file:e,wasCompressed:!1};const n=e.name.replace(/\.[^.]+$/,"");return{file:new File([t],`${n}_compressed.mp4`,{type:"video/mp4"}),wasCompressed:!0}}function Lm(t,e,r){return $e.value?(r&&r(0),{file:t,wasCompressed:!1,wasSkipped:!0,aborted:!0}):null}function Bf(t,e){return!!(!t||typeof t=="object"&&t&&"skip"in t&&t.skip)}function $f(t,e=200*1024){return t.size<=e}function zf(t){return t.type.startsWith("video/")}class la{constructor(e){this.localStorage=e}context="VideoCompressionService";mediabunnyCompression=null;ffmpegCompression=null;useMediabunny=null;mediabunnyCheckPromise=null;initPromise=null;onProgress;async ensureInitialized(){if(!(this.ffmpegCompression&&this.mediabunnyCompression))return this.initPromise?this.initPromise:(this.initPromise=(async()=>{const[{FFmpegCompression:e},{MediaBunnyCompression:r}]=await Promise.all([At(()=>import("./ffmpegCompression-DNa948eV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])),At(()=>import("./mediabunnyCompression-BhROnLrz.js"),__vite__mapDeps([9,2,1,3,4,5,6,7,8]))]);this.ffmpegCompression=new e,this.mediabunnyCompression=new r(this.parseAudioBitrate.bind(this),this.ffmpegCompression.mergeVideoAndAudioWithFFmpeg.bind(this.ffmpegCompression),this.ffmpegCompression.compressWithFFmpeg.bind(this.ffmpegCompression)),this.onProgress&&(this.mediabunnyCompression.setProgressCallback(this.onProgress),this.ffmpegCompression.setProgressCallback(this.onProgress))})(),this.initPromise)}async checkMediaBunnySupport(){return this.useMediabunny!==null?this.useMediabunny:this.mediabunnyCheckPromise?this.mediabunnyCheckPromise:(this.mediabunnyCheckPromise=(async()=>{const{isMediaBunnySupported:e}=await At(async()=>{const{isMediaBunnySupported:n}=await import("./mediabunnyCompression-BhROnLrz.js");return{isMediaBunnySupported:n}},__vite__mapDeps([9,2,1,3,4,5,6,7,8])),r=await e();return this.useMediabunny=r,Ht(this.context,`Using ${r?"Mediabunny":"FFmpeg"} for compression`),r})(),this.mediabunnyCheckPromise)}abort(){Ht(this.context,"Abort requested"),this.onProgress&&this.onProgress(0),this.mediabunnyCompression?.abort(),this.ffmpegCompression?.abort()}setProgressCallback(e){this.onProgress=e,this.mediabunnyCompression?.setProgressCallback(e),this.ffmpegCompression?.setProgressCallback(e)}getCompressionOptions(){const e=this.localStorage.getItem("videoCompressionLevel")||"medium",r=an[e];return typeof r=="object"&&r&&"skip"in r&&r.skip?null:r||null}hasCompressionSettings(){return this.getCompressionOptions()!==null}parseAudioBitrate(e){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const r=Number.parseInt(e,10);if(Number.isFinite(r)&&r>0)return r*1e3}return null}async compress(e){if(!zf(e))return Ht(this.context,"Skipping non-video file"),{file:e,wasCompressed:!1};if($f(e))return Ht(this.context,"Skipping small video file"),{file:e,wasCompressed:!1,wasSkipped:!0};const r=this.getCompressionOptions();if(Bf(r,this.context))return{file:e,wasCompressed:!1,wasSkipped:!0};if($e.value)return Ht(this.context,"Compression aborted"),this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0};try{if(await this.ensureInitialized(),await this.checkMediaBunnySupport()){Ht(this.context,"Attempting compression with MediaBunny");const s=await this.mediabunnyCompression.compressWithMediabunny(e,r);return!s.wasCompressed&&!s.wasSkipped?(Ht(this.context,"MediaBunny failed, falling back to FFmpeg"),await this.ffmpegCompression.compressWithFFmpeg(e,r)):s}else return Ht(this.context,"Using FFmpeg for compression"),await this.ffmpegCompression.compressWithFFmpeg(e,r)}catch(n){return console.error("[VideoCompressionService] Compression failed:",n),{file:e,wasCompressed:!1,wasSkipped:!0}}}async cleanup(){await this.ffmpegCompression?.cleanup(),await this.mediabunnyCompression?.cleanup()}}class jf{constructor(e){this.document=e}mimeSupportCache={};webpQualitySupport;async canEncodeWebpWithQuality(){if(this.webpQualitySupport!==void 0)return this.webpQualitySupport;try{if(!this.document)return this.webpQualitySupport=!1;const e=this.document.createElement("canvas");e.width=2,e.height=2;const r=e.getContext("2d");if(!r)return this.webpQualitySupport=!1;r.fillStyle="#f00",r.fillRect(0,0,2,2);const n=e.toDataURL("image/webp",.2),s=e.toDataURL("image/webp",.9),o=n.startsWith("data:image/webp")&&s.startsWith("data:image/webp")&&n.length!==s.length;return this.webpQualitySupport=o,o}catch{return this.webpQualitySupport=!1,!1}}canEncodeMimeType(e){if(!e)return!1;if(e in this.mimeSupportCache)return this.mimeSupportCache[e];try{if(!this.document)return this.mimeSupportCache[e]=!1;const r=this.document.createElement("canvas");r.width=2,r.height=2;const n=r.getContext("2d");if(!n)return this.mimeSupportCache[e]=!1;n.fillStyle="#000",n.fillRect(0,0,2,2);const s=r.toDataURL(e),o=typeof s=="string"&&s.startsWith(`data:${e}`);return this.mimeSupportCache[e]=o,o}catch{return this.mimeSupportCache[e]=!1,!1}}}const Bs=fr([]);function Wf(){return window.location.port==="4173"||window.location.hostname==="localhost"}function $s(){return Wf()}function Gf(...t){const e=t.map(r=>typeof r=="object"?JSON.stringify(r):String(r)).join(" ");Bs.update(r=>[e,...r].slice(0,250))}const Vf=console.log;typeof window<"u"&&(window.__originalConsoleLog=Vf);async function qf(t){let e=[];t?e=t:Bs.subscribe(n=>e=n)();const r=e?.join(`
`)??"";r&&Rs(r,"dev log",navigator,window)}typeof window<"u"&&(window.showSwUpdateModalDebug=()=>{Ds.set(!0),console.log("SWSettingsDialog")});$s()&&(window.testDevLog=()=>{console.log(":",new Date().toISOString()),Gf("devLog:",Math.random())},window.showPostSuccessDebug=()=>{Re.postStatus={...Re.postStatus,success:!0,error:!1,message:"post_success",completed:!0}},window.showPostErrorDebug=()=>{Re.postStatus={...Re.postStatus,success:!1,error:!0,message:"post_error",completed:!1}});class ca{constructor(e,r){this.mimeSupport=e,this.localStorage=r}onProgress;abort(){this.onProgress&&this.onProgress(0)}setProgressCallback(e){this.onProgress=e}getCompressionOptions(){const e=this.localStorage.getItem("imageCompressionLevel")||"medium",r=Qt[e];return typeof r=="object"&&r&&"skip"in r&&r.skip?null:r?{...r,preserveExif:!1}:null}hasCompressionSettings(){return this.getCompressionOptions()!==null}async compress(e){if($e.value)return{file:e,wasCompressed:!1,aborted:!0};if(!e.type.startsWith("image/"))return{file:e,wasCompressed:!1};if(e.size<=20*1024)return{file:e,wasCompressed:!1,wasSkipped:!0};const r=this.getCompressionOptions();if(!r)return{file:e,wasCompressed:!1,wasSkipped:!0};let n={...r,onProgress:o=>{this.onProgress&&this.onProgress(Math.round(o*100))}};if(n.fileType==="image/webp"&&(await this.mimeSupport.canEncodeWebpWithQuality()||(n.fileType=e.type==="image/png"?"image/png":"image/jpeg")),$e.value)return{file:e,wasCompressed:!1,aborted:!0};let s=n.fileType||e.type;this.mimeSupport.canEncodeMimeType(s)||(s=e.type,delete n.fileType);try{const o=await Rl(e,n);if($e.value)return this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0};if(o.size>=e.size)return{file:e,wasCompressed:!1};const i=n.fileType||o.type||s||e.type,l=Ff(e.name,i),c=new File([o],l,{type:i});return{file:c,wasCompressed:!0}}catch(o){return $e.value?(this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0}):(console.warn("[ImageCompressionService] Compression failed:",o),{file:e,wasCompressed:!1,wasSkipped:!0})}}}class Kf{async waitForWindowNostr(e=3e3,r=100){const n=Date.now();for(;Date.now()-n<e;){const s=window?.nostr;if(s?.signEvent)return s;await new Promise(o=>setTimeout(o,r))}return null}async buildAuthHeader(e,r="POST"){const n=ps.getFromStore()||ps.loadFromStorage();let s;if(n)s=i=>ts(n).signEvent(i);else{let i=window?.nostr;if(i?.signEvent||(i=await this.waitForWindowNostr()),i?.signEvent)s=l=>i.signEvent(l);else throw new Error("Authentication required")}const{getToken:o}=await At(async()=>{const{getToken:i}=await import("./vendor-nostr-CSSTtp-a.js").then(l=>l.b);return{getToken:i}},[]);return await o(e,r,s,!0)}}class Mi{constructor(e={localStorage:window.localStorage,fetch:window.fetch.bind(window),crypto:window.crypto.subtle,document:window.document,window,navigator:window.navigator},r,n,s,o){this.dependencies=e,this.mimeSupport=o||new jf(e.document),this.imageCompressionService=n||new ca(this.mimeSupport,e.localStorage),this.videoCompressionService=s||new la(e.localStorage),this.authService=r||new Kf,this.videoCompressionService instanceof la&&!Gu()&&(Wu(this.videoCompressionService),console.log("[FileUploadManager] VideoCompressionService registered to store")),this.imageCompressionService instanceof ca&&!Ku()&&(qu(this.imageCompressionService),console.log("[FileUploadManager] ImageCompressionService registered to store"))}imageCompressionService;videoCompressionService;mimeSupport;authService;validateImageFile(e){return e.type.startsWith("image/")?e.size>lo?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}:{isValid:!1,errorMessage:"only_images_allowed"}}validateMediaFile(e){const r=e.type.startsWith("image/"),n=e.type.startsWith("video/");return!r&&!n?{isValid:!1,errorMessage:"only_images_or_videos_allowed"}:e.size>lo?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}}async generateBlurhashForFile(e){return await bd(e)}async createPlaceholderUrl(e){return await wd(e)}getUploadEndpoint(e){const r=this.dependencies.localStorage.getItem("uploadEndpoint"),n=s=>s&&s.trim().length>0?s:void 0;return n(r)??n(e)??Cr}async pollUploadStatus(e,r,n=Gn.MAX_WAIT_TIME){const s=Date.now();for(;;){if($e.value)throw new Error("Upload aborted by user");if(Date.now()-s>n)throw new Error(Gn.TIMEOUT_MESSAGE);const o=await this.dependencies.fetch(e,{method:"GET",headers:{Authorization:r}});if(!o.ok)throw new Error(`Unexpected status code ${o.status} while polling processing_url`);let i=null;try{i=await o.json()}catch{i=null}if(o.status===201&&i)return i;if(i?.status==="processing"){await new Promise(l=>setTimeout(l,Gn.RETRY_INTERVAL));continue}if(i?.status==="success")return i;if(i?.status==="error")throw new Error(i?.message||"File processing failed");if(o.status===200)return i;throw new Error("Unexpected processing status")}}async uploadFile(e,r=Cr,n=!1,s,o){let i;try{if(!e)return{success:!1,error:"No file selected"};let l;try{l=await Ii(e,this.dependencies.crypto)}catch{l=void 0}const c=e.size;if($e.value)return n&&console.log("[FileUploadManager] Upload aborted before compression"),{success:!1,error:"Upload aborted by user",aborted:!0};const u=e.type.startsWith("video/"),d=u?this.videoCompressionService:this.imageCompressionService;u&&o?.onVideoCompressionProgress&&this.videoCompressionService.setProgressCallback(o.onVideoCompressionProgress),!u&&o?.onImageCompressionProgress&&this.imageCompressionService.setProgressCallback(o.onImageCompressionProgress);const{file:f,wasCompressed:h,wasSkipped:g,aborted:p}=await d.compress(e);if(u?this.videoCompressionService.setProgressCallback(void 0):this.imageCompressionService.setProgressCallback(void 0),p)return n&&console.log("[FileUploadManager] Upload aborted by user"),{success:!1,error:"Upload aborted by user",aborted:!0};const m=f.size,x=u?this.videoCompressionService.hasCompressionSettings():this.imageCompressionService.hasCompressionSettings();i=kf(c,m,x||h,e.name,f.name,g);const _=this.getUploadEndpoint(r),b=await this.authService.buildAuthHeader(_,"POST"),S=new FormData;S.append("file",f),s?.caption&&S.append("caption",String(s.caption)),s?.expiration!==void 0&&S.append("expiration",String(s.expiration)),S.append("size",String(f.size)),s?.alt&&S.append("alt",String(s.alt)),s?.media_type&&S.append("media_type",String(s.media_type)),S.append("content_type",s?.content_type?String(s.content_type):f.type||""),S.append("no_transform",s?.no_transform?String(s.no_transform):"true");const T=await this.dependencies.fetch(_,{method:"POST",headers:{Authorization:b},body:S});if($e.value)return{success:!1,error:"Upload aborted by user",sizeInfo:i,aborted:!0};if(!T.ok){const M=await T.text().catch(()=>"Unknown error");return{success:!1,error:`Upload failed: ${T.status} ${T.statusText} - ${M}`,sizeInfo:i}}let P;try{P=await T.json()}catch(M){return n&&console.error("[dev] JSON parse error:",M),{success:!1,error:"Could not parse upload response",sizeInfo:i}}if((T.status===200||T.status===202)&&P.processing_url)try{const M=await this.authService.buildAuthHeader(P.processing_url,"GET");if(P=await this.pollUploadStatus(P.processing_url,M),$e.value)return{success:!1,error:"Upload aborted by user",sizeInfo:i,aborted:!0}}catch(M){return{success:!1,error:M instanceof Error?M.message:String(M),sizeInfo:i}}const E={};if(P?.nip94_event?.tags&&Array.isArray(P.nip94_event.tags))for(const M of P.nip94_event.tags){if(!Array.isArray(M)||M.length<2)continue;const A=String(M[0]),k=M.slice(1).join(" ");A in E||(E[A]=k)}if(P.status==="success"&&P.nip94_event?.tags){const M=P.nip94_event.tags.find(A=>A[0]==="url");if(M?.[1])return{success:!0,url:M[1],sizeInfo:i,nip94:E}}return{success:!1,error:P.message||"Could not extract URL from response",sizeInfo:i,nip94:Object.keys(E).length?E:void 0}}catch(l){if($e.value)return{success:!1,error:"Upload aborted by user",sizeInfo:i,aborted:!0};n&&console.error("[dev] Upload error:",l);const c=l instanceof Error?l.message:String(l);return c.includes("aborted by user")?{success:!1,error:c,sizeInfo:i,aborted:!0}:{success:!1,error:c.includes("Failed to fetch")?`${c} (Service Worker)`:c}}}async uploadMultipleFiles(e,r=Cr,n,s=!1,o,i){if(!e?.length)return[];const l=new Array(e.length);let c=0,u=0,d=0;const f=()=>n?.({completed:c,failed:u,aborted:d,total:e.length,inProgress:c+u+d<e.length});f();for(let h=0;h<e.length;h++){if($e.value){for(let p=h;p<e.length;p++)l[p]={success:!1,aborted:!0},d++;f();break}const g=e[h];try{const p=o?o[h]:void 0,m=await this.uploadFile(g,r,s,p,i);l[h]=m,m.success?c++:m.aborted?d++:u++,f()}catch(p){l[h]={success:!1,error:p instanceof Error?p.message:String(p)},u++,f()}}return l}async uploadFileWithCallbacks(e,r=Cr,n,s=!1,o){n?.onProgress?.({completed:0,failed:0,aborted:0,total:1,inProgress:!0});try{const i=await this.uploadFile(e,r,s,o,n);if(n?.onProgress?.({completed:i.success?1:0,failed:!i.success&&!i.aborted?1:0,aborted:i.aborted?1:0,total:1,inProgress:!1}),i.success&&i.sizeInfo&&!i.aborted){const l=ia(i.sizeInfo);l&&mo(l)}return i}catch(i){return n?.onProgress?.({completed:0,failed:1,aborted:0,total:1,inProgress:!1}),{success:!1,error:i instanceof Error?i.message:String(i)}}}async uploadMultipleFilesWithCallbacks(e,r=Cr,n,s){if(!e?.length)return[];n?.onProgress?.({completed:0,failed:0,aborted:0,total:e.length,inProgress:!0});const o=await this.uploadMultipleFiles(e,r,n?.onProgress,!1,s,n);if(!$e.value){const i=o.find(l=>l.success&&l.sizeInfo);if(i?.sizeInfo){const l=ia(i.sizeInfo);l&&mo(l)}}return o}async getSharedMediaFromServiceWorker(){if(!this.dependencies.navigator?.serviceWorker?.controller)return null;try{const e=new MessageChannel,r=new Promise(n=>{e.port1.onmessage=s=>{s.data?.type==="SHARED_MEDIA"?n(s.data.data):n(null)},setTimeout(()=>n(null),3e3)});return this.dependencies.navigator.serviceWorker.controller.postMessage({action:"getSharedMedia"},[e.port2]),await r}catch(e){return console.error("Service Worker:",e),null}}checkIfOpenedFromShare(){return this.dependencies.window?.location?new URLSearchParams(this.dependencies.window.location.search).get("shared")==="true":!1}async processSharedMediaOnLaunch(){try{const e=await this.getSharedMediaFromServiceWorker();return e?.images?.length?{success:!0,data:e,fromServiceWorker:!0}:{success:!1,error:""}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}}class Xf{dependencies;devMode;fileUploadManager;constructor(e,r){this.dependencies=e,this.devMode=r,this.fileUploadManager=new this.dependencies.FileUploadManager}async uploadFiles(e,r,n,s){try{if(e.length===1)return[await this.fileUploadManager.uploadFileWithCallbacks(e[0],r,n,this.devMode,s?.[0])];if(e.length>1)return await this.fileUploadManager.uploadMultipleFilesWithCallbacks(e,r,n,s)}catch(o){throw this.devMode&&console.error("[preview] [uploadHelper] Upload error:",o),o}return null}}function Jn(t,e,r,n,s,o=!1,i=!1,l){return n(!1),i&&(l?mf(e,l.imageSizeMapStore):r&&bi(r,o)),s?.onProgress&&s.onProgress({completed:0,failed:0,aborted:t.length,total:t.length,inProgress:!1}),{placeholderMap:i?[]:e,results:null,imageOxMap:{},imageXMap:{},failedResults:[],errorMessage:"Upload aborted by user"}}const Di=()=>({localStorage:window.localStorage,crypto:window.crypto.subtle,tick:hn,FileUploadManager:Mi,getImageDimensions:Rf,extractImageBlurhashMap:hi,calculateImageHash:Sd,getMimeTypeFromUrl:fi,createImetaTag:async t=>await di(t),imageSizeMapStore:vs});async function Yf({files:t,currentEditor:e,fileInput:r,uploadCallbacks:n,showUploadError:s,updateUploadState:o,devMode:i,dependencies:l=Di()}){const c=Array.from(t),u=l.localStorage.getItem("uploadEndpoint")||"",d={},f={},h="[preview]";n?.onProgress&&n.onProgress({completed:0,failed:0,aborted:0,total:c.length,inProgress:!0}),$e.reset();const g=new Xf(l,i);let p;try{p=await Hf(c,l)}catch(E){if(E instanceof Error&&E.message==="Upload aborted by user")return o(!1),n?.onProgress&&n.onProgress({completed:0,failed:0,aborted:c.length,total:c.length,inProgress:!1}),{placeholderMap:[],results:null,imageOxMap:d,imageXMap:f,failedResults:[],errorMessage:"Upload aborted by user"};throw E}if($e.value)return Jn(c,[],e,o,n,i,!1);const m=!xt.value;let x=m?pf(c,p,s,l.imageSizeMapStore,l.FileUploadManager,i):ff(c,p,e,s,l.imageSizeMapStore,l.FileUploadManager,i);if(x.length===0)return{placeholderMap:[],results:null,imageOxMap:d,imageXMap:f,failedResults:[],errorMessage:""};if($e.value)return Jn(c,x,e,o,n,i,!0,m?{imageSizeMapStore:l.imageSizeMapStore}:void 0);if(o(!0,""),await hf(x,l.FileUploadManager,i),$e.value)return Jn(c,x,e,o,n,i,!0,m?{imageSizeMapStore:l.imageSizeMapStore}:void 0);const _=x.map(E=>E.file);let b=null;try{const E=Uf(_);b=await g.uploadFiles(_,u,n,E)}catch(E){const M=E instanceof Error?E.message:String(E);s(M,5e3),b=null}finally{o(!1)}if($e.value)return r&&(r.value=""),{placeholderMap:[],results:null,imageOxMap:d,imageXMap:f,failedResults:[],errorMessage:"Upload aborted by user"};await l.tick();const S=[];let T="",P={};if(b&&x.length>0){if(m){const E=await vf(b,x,d,f,l.imageSizeMapStore,l.calculateImageHash,l.getMimeTypeFromUrl,i);S.push(...E.failedResults),T=E.errorMessage}else{const E=await gf(b,x,e,d,f,l.imageSizeMapStore,l.calculateImageHash,i);S.push(...E.failedResults),T=E.errorMessage,P=E.imageServerBlurhashMap}x=[]}if(i&&e)try{const E=l.extractImageBlurhashMap(e),M=new Set([...Object.keys(E),...Object.keys(P)]);await Promise.all(Array.from(M).map(async k=>{if(!f[k]){const V=await l.calculateImageHash(k);V&&(f[k]=V)}}));const A=await Promise.all(Array.from(M).map(async k=>{const V=P[k]??E[k],J=l.getMimeTypeFromUrl(k),Y=d[k],q=f[k];return(await l.createImetaTag({url:k,m:J,blurhash:V,ox:Y,x:q})).join(" ")}))}catch(E){console.warn(`${h} [dev] imeta`,E)}return r&&(r.value=""),{placeholderMap:x,results:b,imageOxMap:d,imageXMap:f,failedResults:S,errorMessage:T}}function Qf(t){const{onUploadProgress:e,videoCompressionProgressStore:r,imageCompressionProgressStore:n}=t;return e?{onProgress:e,onVideoCompressionProgress:s=>{r.set(s)},onImageCompressionProgress:s=>{n.set(s)}}:void 0}function ua(t,e=3e3,r){r.updateUploadState(!1,t),setTimeout(()=>r.updateUploadState(!1,""),e)}async function Zf(t){const{files:e,currentEditor:r,fileInput:n,uploadCallbacks:s,updateUploadState:o,devMode:i,imageOxMap:l,imageXMap:c,dependencies:u=Di(),getUploadFailedText:d}=t;if(!e||e.length===0)return;const f=await Yf({files:e,currentEditor:r,fileInput:n,uploadCallbacks:s,showUploadError:(h,g)=>ua(h,g,{updateUploadState:o}),updateUploadState:o,devMode:i,dependencies:u});Object.assign(l,f.imageOxMap),Object.assign(c,f.imageXMap),f.failedResults?.length&&ua(f.errorMessage||(f.failedResults.length===1?f.failedResults[0].error||d("postComponent.upload_failed"):`${f.failedResults.length}`),5e3,{updateUploadState:o}),n&&(n.value="")}async function Jf(t){const{files:e,currentEditor:r,fileInput:n,onUploadProgress:s,updateUploadState:o,imageOxMap:i,imageXMap:l,videoCompressionProgressStore:c,imageCompressionProgressStore:u,getUploadFailedText:d,dependencies:f}=t,h=Qf({onUploadProgress:s,videoCompressionProgressStore:c,imageCompressionProgressStore:u});await Zf({files:e,currentEditor:r,fileInput:n,uploadCallbacks:h,updateUploadState:o,devMode:!1,imageOxMap:i,imageXMap:l,dependencies:f,getUploadFailedText:d})}var eg=H('<div class="popup-modal svelte-1lheb99" role="dialog" aria-modal="true" tabindex="0"><div class="popup-body svelte-1lheb99" role="document"><span class="info-icon svg-icon svelte-1lheb99" aria-hidden="true"></span> <div class="popup-children svelte-1lheb99"><!></div></div></div>');function zs(t,e){He(e,!0);let r=pe(e,"show",3,!1),n=pe(e,"x",3,0),s=pe(e,"y",3,0),o=pe(e,"onClose",3,void 0),i=pe(e,"children",3,void 0);function l(){try{o()&&o()()}catch{}}function c(x){x.key==="Escape"&&l()}ir(()=>{window.addEventListener("keydown",c)}),jr(()=>{window.removeEventListener("keydown",c)});let u=B(void 0);we(()=>{r()&&a(u)&&(async()=>(await hn(),a(u).parentElement!==document.body&&document.body.appendChild(a(u))))()}),jr(()=>{if(a(u)&&a(u).parentElement===document.body)try{document.body.removeChild(a(u))}catch{}});let d=B(0),f=B(0);we(()=>{v(d,n()),v(f,s())});const h=10;we(()=>{r()&&a(u)&&(async()=>{if(await hn(),a(u).parentElement===document.body){const x=a(u).getBoundingClientRect(),_=x.width,b=x.height,S=window.innerWidth,T=window.innerHeight;let P=n(),E=s();P+_+h>S&&(P=S-_-h),P-h<0&&(P=h),E+b+h>T&&(E=T-b-h),E-h<0&&(E=h),v(d,P,!0),v(f,E,!0)}})()});var g=Se(),p=re(g);{var m=x=>{var _=eg();_.__click=P=>P.stopPropagation?.(),_.__keydown=P=>{(P.key==="Enter"||P.key===" ")&&(P.preventDefault(),l())};var b=y(_),S=L(y(b),2),T=y(S);Rt(T,()=>i()??qr),st(_,P=>v(u,P),()=>a(u)),K(()=>Lt(_,`left: ${a(d)??""}px; top: ${a(f)??""}px;`)),w(x,_)};se(p,x=>{r()&&x(m)})}w(t,g),Ue()}ft(["click","keydown"]);var tg=H("<div><!></div>"),rg=H('<!> <!> <div class="dialog-content svelte-omvxe3"><!></div> <!>',1),ng=H("<!> <!>",1);function br(t,e){He(e,!0);let r=pe(e,"open",15,!1),n=pe(e,"contentClass",3,""),s=pe(e,"footerVariant",3,"default");function o(u){u||e.onOpenChange?.(!1)}function i(u){u.preventDefault()}var l=Se(),c=re(l);be(c,()=>nl,(u,d)=>{d(u,{onOpenChange:o,get open(){return r()},set open(f){r(f)},children:(f,h)=>{var g=Se(),p=re(g);be(p,()=>Ot,(m,x)=>{x(m,{children:(_,b)=>{var S=ng(),T=re(S);be(T,()=>sl,(E,M)=>{M(E,{class:"dialog-overlay"})});var P=L(T,2);be(P,()=>ol,(E,M)=>{M(E,{get class(){return`dialog ${n()??""}`},preventScroll:!1,onCloseAutoFocus:i,children:(A,k)=>{var V=rg(),J=re(V);be(J,()=>al,(R,I)=>{I(R,{class:"visually-hidden",children:(ne,U)=>{var W=De();K(()=>z(W,e.title)),w(ne,W)},$$slots:{default:!0}})});var Y=L(J,2);be(Y,()=>il,(R,I)=>{I(R,{class:"visually-hidden",children:(ne,U)=>{var W=De();K(()=>z(W,e.description)),w(ne,W)},$$slots:{default:!0}})});var q=L(Y,2),O=y(q);Rt(O,()=>e.children??qr);var Q=L(q,2);{var ge=R=>{var I=tg();let ne;var U=y(I);Rt(U,()=>e.footer),K(()=>ne=Et(I,1,"dialog-footer svelte-omvxe3",null,ne,{"close-button-footer":s()==="close-button"})),w(R,I)};se(Q,R=>{e.footer&&R(ge)})}w(A,V)},$$slots:{default:!0}})}),w(_,S)},$$slots:{default:!0}})}),w(f,g)},$$slots:{default:!0}})}),w(t,l),Ue()}function Sr(t,e,r=!0){if(typeof window>"u"||!(typeof r=="function"?r():r))return;let s=null,o=!1;const i=l=>{t()&&l.state?.modalId!==s&&e()};we(()=>{const l=t();if(l&&!o){s=`modal-${ks()}`,history.pushState({modalId:s},"",window.location.href),o=!0;return}if(!l&&o){const c=history.state?.modalId===s;s=null,o=!1,c&&history.back()}}),ir(()=>{window.addEventListener("popstate",i)}),jr(()=>{window.removeEventListener("popstate",i),o&&history.state?.modalId===s&&history.back()})}var sg=H('<div class="confirm-dialog-message svelte-1efofyg"> </div>'),og=H('<div class="confirm-dialog-content svelte-1efofyg"><!> <div class="confirm-dialog-buttons svelte-1efofyg"><!> <!></div></div>');function ki(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=pe(e,"open",15,!1),i=pe(e,"confirmVariant",3,"danger"),l=pe(e,"confirmDisabled",3,!1),c=pe(e,"autofocusConfirm",3,!1),u=pe(e,"contentClass",3,"confirm-dialog"),d=pe(e,"addToHistory",3,!1);const f=N(()=>e.confirmLabel||r()("common.ok")),h=N(()=>e.cancelLabel||r()("common.cancel")),g=N(()=>e.title||r()("common.confirm"));function p(){o(!1),e.onCancel?.()}function m(){e.onConfirm(),o(!1)}Sr(()=>o(),p,()=>d()),br(t,{onOpenChange:x=>!x&&p(),get title(){return a(g)},get description(){return e.description},get contentClass(){return u()},get open(){return o()},set open(x){o(x)},children:(x,_)=>{var b=og(),S=y(b);{var T=q=>{var O=Se(),Q=re(O);Rt(Q,()=>e.children),w(q,O)},P=q=>{var O=sg(),Q=y(O);K(()=>z(Q,e.description)),w(q,O)};se(S,q=>{e.children?q(T):q(P,!1)})}var E=L(S,2),M=y(E);{var A=q=>{var O=Se(),Q=re(O);Rt(Q,()=>e.renderConfirm),w(q,O)},k=q=>{Le(q,{className:"btn-confirm",get variant(){return i()},shape:"square",onClick:m,get disabled(){return l()},get autofocus(){return c()},children:(O,Q)=>{var ge=De();K(()=>z(ge,a(f))),w(O,ge)},$$slots:{default:!0}})};se(M,q=>{e.renderConfirm?q(A):q(k,!1)})}var V=L(M,2);{var J=q=>{var O=Se(),Q=re(O);Rt(Q,()=>e.renderCancel),w(q,O)},Y=q=>{var O=Se(),Q=re(O);{const ge=(R,I)=>{Le(R,pt(()=>I?.().props,{className:"btn-cancel",variant:"secondary",shape:"square",onClick:p,children:(U,W)=>{var ie=De();K(()=>z(ie,a(h))),w(U,ie)},$$slots:{default:!0}}))};be(Q,()=>yr,(R,I)=>{I(R,{child:ge,$$slots:{child:!0}})})}w(q,O)};se(V,q=>{e.renderCancel?q(J):q(Y,!1)})}w(x,b)},$$slots:{default:!0}}),Ue(),s()}function ag(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=pe(e,"show",15,!1);{let i=N(()=>r()("postComponent.warning")),l=N(()=>r()("postComponent.secret_key_detected")),c=N(()=>r()("postComponent.post")),u=N(()=>r()("postComponent.cancel"));ki(t,{get title(){return a(i)},get description(){return a(l)},get confirmLabel(){return a(c)},get cancelLabel(){return a(u)},confirmVariant:"danger",get onConfirm(){return e.onConfirm},get onCancel(){return e.onCancel},contentClass:"secretkey-warning-dialog",addToHistory:!1,get open(){return o()},set open(d){o(d)}})}Ue(),s()}var ig=H('<img draggable="false"/>'),lg=H('<div class="video-wrapper svelte-1d3gb7z"><video controls playsinline="" autoplay loop preload="metadata" class="gallery-video svelte-1d3gb7z" draggable="false"><track kind="captions"/></video>  <div class="video-drag-overlay svelte-1d3gb7z" draggable="true" aria-hidden="true"></div></div>',2),cg=H('<div role="listitem"><div class="gallery-item-media svelte-1d3gb7z"><!> <!> <!></div> <!></div>');function ug(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=B(void 0),i=B(void 0);const l=Hs();Ei(()=>a(o),{onLongPress:(O,Q)=>{e.onTouchDragStart?.(e.index,O,Q)}});let c=N(()=>!e.item.isPlaceholder&&e.item.type==="image"&&!!e.item.src),u=N(()=>!e.item.isPlaceholder&&e.item.type==="video"&&!!e.item.src);const d=220,f=100,h=220;let g=N(()=>{if(!e.item.isPlaceholder)return;const O=e.item.dimensions;if(O&&O.width>0&&O.height>0){const Q=O.width/O.height,ge=Math.round(d*Q);return`width: ${Math.max(f,Math.min(h,ge))}px; height: ${d}px;`}return`width: ${h}px; height: ${d}px;`});function p(){e.item.isPlaceholder||e.item.type!=="image"||St.showImageFullscreen(e.item.src,e.item.alt||"")}function m(O){if(a(o)&&O.dataTransfer){const Q=a(o).getBoundingClientRect(),ge=O.clientX-Q.left,R=O.clientY-Q.top;O.dataTransfer.setDragImage(a(o),ge,R)}e.onDragStart(e.index,O)}function x(){a(i)&&(a(i).paused?a(i).play():a(i).pause())}function _(O){O.preventDefault(),e.onDragOver(e.index,O)}function b(O){O.preventDefault(),e.onDrop(e.index)}var S=cg();let T;var P=y(S);P.__click=function(...O){(e.item.type==="image"&&!e.item.isPlaceholder?p:void 0)?.apply(this,O)},P.__keydown=O=>{O.key==="Enter"&&e.item.type==="image"&&!e.item.isPlaceholder&&p()};var E=y(P);{var M=O=>{{let Q=N(()=>e.item.type==="video"?r()("videoNode.uploading"):r()("imageNode.uploading"));It(O,{get text(){return a(Q)},showLoader:!0})}};se(E,O=>{e.item.isPlaceholder&&O(M)})}var A=L(E,2);{var k=O=>{var Q=ig();let ge;Q.__contextmenu=R=>R.preventDefault(),K(()=>{Ie(Q,"src",e.item.src),Ie(Q,"alt",e.item.alt||""),ge=Et(Q,1,"gallery-image svelte-1d3gb7z",null,ge,{"image-loading":!l.isLoaded})}),Je("load",Q,function(...R){l.handleLoad?.apply(this,R)}),Je("error",Q,function(...R){l.handleError?.apply(this,R)}),w(O,Q)};se(A,O=>{a(c)&&O(k)})}var V=L(A,2);{var J=O=>{var Q=lg(),ge=y(Q);ge.muted=!0,ge.__contextmenu=I=>I.preventDefault(),st(ge,I=>v(i,I),()=>a(i));var R=L(ge,2);R.__click=x,K(()=>Ie(ge,"src",e.item.src)),Je("dragstart",R,m),w(O,Q)};se(V,O=>{a(u)&&O(J)})}var Y=L(P,2);{var q=O=>{{let Q=N(()=>r()("imageContextMenu.delete")),ge=N(()=>r()("imageContextMenu.copyUrl")),R=N(()=>r()("imageContextMenu.copySuccess"));Fs(O,{get src(){return e.item.src},onDelete:()=>e.onDelete(e.item.id),get deleteAriaLabel(){return a(Q)},get copyAriaLabel(){return a(ge)},get copySuccessMessage(){return a(R)},layout:"gallery"})}};se(Y,O=>{e.item.isPlaceholder||O(q)})}st(S,O=>v(o,O),()=>a(o)),K(()=>{T=Et(S,1,"gallery-item svelte-1d3gb7z",null,T,{"is-placeholder":e.item.isPlaceholder}),Ie(S,"draggable",e.item.type!=="video"||e.item.isPlaceholder),Lt(P,a(g)),Ie(P,"role",e.item.type==="image"&&!e.item.isPlaceholder?"button":void 0),Ie(P,"tabindex",e.item.type==="image"&&!e.item.isPlaceholder?0:void 0),Ie(P,"aria-label",e.item.alt||e.item.src)}),Je("dragstart",S,m),Je("dragover",S,_),Je("drop",S,b),Je("dragend",S,()=>e.onDragEnd()),w(t,S),Ue(),s()}ft(["click","keydown","contextmenu"]);var dg=H("<div><!></div>"),hg=H('<div class="media-gallery svelte-16r32f2" role="list"></div>');function fg(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=B(-1),i=B(-1),l=B(-1),c=B(-1),u=null,d=60,f=60,h=B(void 0),g=null,p=N(()=>ze.items),m=N(()=>{const R=a(o)!==-1?a(o):a(l),I=a(o)!==-1?a(i):a(c);return R===-1||I===-1||I===R||I===R+1?-1:I});function x(R,I){v(o,R,!0),I.dataTransfer?.setData("text/plain",String(R)),I.dataTransfer&&(I.dataTransfer.effectAllowed="move")}function _(R,I){I.preventDefault();const U=a(h)?.querySelectorAll(".gallery-item-wrapper")?.[R];if(U){const W=U.getBoundingClientRect();v(i,I.clientX<W.left+W.width/2?R:R+1,!0)}else v(i,R,!0)}function b(){A(),v(o,-1),v(i,-1)}function S(R){}function T(R){if(a(o)===-1)return;R.preventDefault();const I=a(h)?.querySelectorAll(".gallery-item-wrapper");if(I&&I.length>0){const ne=I[0].getBoundingClientRect(),U=I[I.length-1].getBoundingClientRect();R.clientX<ne.left?v(i,0):R.clientX>U.right&&v(i,a(p).length,!0)}if(a(h)){const ne=a(h).getBoundingClientRect();R.clientX-ne.left<Zt?M("left",R.clientX):ne.right-R.clientX<Zt?M("right",R.clientX):A()}}function P(R){R.preventDefault(),A();const I=a(i);if(a(o)!==-1&&I!==-1&&I!==a(o)&&I!==a(o)+1){const ne=a(o)<I?I-1:I;ze.reorderItems(a(o),ne)}v(o,-1),v(i,-1)}function E(R){ze.removeItem(R)}function M(R,I){if(!a(h))return;g!==null&&(cancelAnimationFrame(g),g=null);const ne=a(h).getBoundingClientRect(),U=R==="left"?I-ne.left:ne.right-I,W=Math.max(0,Math.min(1,U/Zt)),ie=_n+(Ja-_n)*(1-W),ee=()=>{if(!a(h))return;const he=a(h).scrollWidth-a(h).clientWidth;R==="left"&&a(h).scrollLeft>0?(a(h).scrollLeft=Math.max(0,a(h).scrollLeft-ie),g=requestAnimationFrame(ee)):R==="right"&&a(h).scrollLeft<he?(a(h).scrollLeft=Math.min(he,a(h).scrollLeft+ie),g=requestAnimationFrame(ee)):g=null};g=requestAnimationFrame(ee)}function A(){g!==null&&(cancelAnimationFrame(g),g=null)}function k(R,I,ne){v(l,R,!0),Y();const U=a(h)?.querySelectorAll(".gallery-item-wrapper")[R];if(U){const W=U.getBoundingClientRect(),ie=120,ee=Math.min(ie/W.width,ie/W.height);d=W.width*ee/2,f=W.height*ee/2,u=U.cloneNode(!0),u.style.cssText=`
                position: fixed;
                left: ${I-d}px;
                top: ${ne-f}px;
                width: ${W.width}px;
                height: ${W.height}px;
                transform-origin: top left;
                transform: scale(${ee});
                opacity: 0.75;
                pointer-events: none;
                z-index: 9999;
                border-radius: 6px;
            `,document.body.appendChild(u)}document.addEventListener("touchmove",V,{passive:!1}),document.addEventListener("touchend",J,{passive:!1})}function V(R){if(a(l)===-1||R.touches.length!==1)return;R.preventDefault();const I=R.touches[0];u&&(u.style.left=`${I.clientX-d}px`,u.style.top=`${I.clientY-f}px`),u&&(u.style.display="none");const ne=document.elementFromPoint(I.clientX,I.clientY);u&&(u.style.display="");const U=ne?.closest(".gallery-item-wrapper");if(U&&a(h)){const W=a(h).querySelectorAll(".gallery-item-wrapper"),ie=Array.from(W).indexOf(U);if(ie!==-1){const ee=U.getBoundingClientRect();v(c,I.clientX<ee.left+ee.width/2?ie:ie+1,!0)}}else if(a(h)){const W=a(h).querySelectorAll(".gallery-item-wrapper");if(W.length>0){const ie=W[0].getBoundingClientRect(),ee=W[W.length-1].getBoundingClientRect();I.clientX<=ie.left?v(c,0):I.clientX>=ee.right&&v(c,a(p).length,!0)}}if(a(h)){const W=a(h).getBoundingClientRect();I.clientX-W.left<Zt?M("left",I.clientX):W.right-I.clientX<Zt?M("right",I.clientX):A()}}function J(){document.removeEventListener("touchmove",V),document.removeEventListener("touchend",J),A();const R=a(c);if(a(l)!==-1&&R!==-1&&R!==a(l)&&R!==a(l)+1){const I=a(l)<R?R-1:R;ze.reorderItems(a(l),I)}Y(),v(l,-1),v(c,-1)}function Y(){u&&(u.remove(),u=null)}function q(R){a(h)&&(a(h).scrollLeft+=R.deltaY,R.preventDefault())}we(()=>{if(a(h))return a(h).addEventListener("wheel",q,{passive:!1}),()=>{a(h)?.removeEventListener("wheel",q)}});var O=Se(),Q=re(O);{var ge=R=>{var I=hg();Ct(I,23,()=>a(p),ne=>ne.id,(ne,U,W)=>{var ie=dg();let ee;var he=y(ie);ug(he,{get item(){return a(U)},get index(){return a(W)},onDelete:E,onDragStart:x,onDragOver:_,onDragEnd:b,onDrop:S,onTouchDragStart:k}),K(()=>ee=Et(ie,1,"gallery-item-wrapper svelte-16r32f2",null,ee,{"insert-bar-left":a(m)===a(W),"insert-bar-right":a(m)===a(p).length&&a(W)===a(p).length-1})),w(ne,ie)}),st(I,ne=>v(h,ne),()=>a(h)),K(ne=>Ie(I,"aria-label",ne),[()=>r()("mediaGallery.aria_label")||""]),Je("dragover",I,T),Je("drop",I,P),w(R,I)};se(Q,R=>{a(p).length>0&&R(ge)})}w(t,O),Ue(),s()}function _s(t){if(!t||!t.types)return!1;try{return Array.from(t.types).some(e=>e==="application/x-tiptap-node")}catch{return!1}}function Ni(t){if(!t)return!1;try{return Array.from(t.types).includes("Files")||t.files&&t.files.length>0}catch{return!!(t.files&&t.files.length>0)}}function gg(t){let e=B(!1);function r(o){const i=o.dataTransfer,l=_s(i);Ni(i)&&!l?(o.preventDefault(),a(e)||(v(e,!0),t.classList.add("drag-over"))):a(e)&&(v(e,!1),t.classList.remove("drag-over"))}function n(o){a(e)&&(v(e,!1),t.classList.remove("drag-over"))}async function s(o){v(e,!1),t.classList.remove("drag-over");const i=o.dataTransfer;_s(i)||i?.files&&i.files.length>0&&typeof t.__uploadFiles=="function"&&(o.preventDefault(),t.__uploadFiles(i.files))}return t.addEventListener("dragover",r),t.addEventListener("dragleave",n),t.addEventListener("drop",s),{destroy(){t.removeEventListener("dragover",r),t.removeEventListener("dragleave",n),t.removeEventListener("drop",s)}}}function pg(t,e){const r=gg(t);function n(i){const l=i.dataTransfer,c=_s(l);Ni(l)&&!c?e.dragOver(!0):e.dragOver(!1)}function s(i){e.dragOver(!1)}function o(i){e.dragOver(!1)}return t.addEventListener("dragover",n),t.addEventListener("dragleave",s),t.addEventListener("drop",o),{destroy(){r?.destroy?.(),t.removeEventListener("dragover",n),t.removeEventListener("dragleave",s),t.removeEventListener("drop",o)}}}function vg(t){function e(r){if(!r.clipboardData)return;const n=[];for(const s of r.clipboardData.items)if(s.kind==="file"&&s.type.startsWith("image/")){const o=s.getAsFile();o&&n.push(o)}n.length>0&&(r.preventDefault(),t.__uploadFiles?.(n))}return t.addEventListener("paste",e),{destroy(){t.removeEventListener("paste",e)}}}function mg(t){function e(n){const s=n.target;if(s&&s.closest('.editor-image-button[data-dragging="true"]')){const o=n.touches[0],i=120,l=Pn.querySelector(".tiptap-editor");if(l){const c=l.getBoundingClientRect(),u=o.clientY<c.top+i,d=o.clientY>c.bottom-i;if(!u&&!d)return n.preventDefault(),!1}}}function r(n){const s=Pn.querySelectorAll(".drop-zone-indicator");s.forEach(o=>{o.classList.remove("drop-zone-hover"),o.classList.add("drop-zone-fade-out")}),setTimeout(()=>{s.forEach(o=>{o.parentNode&&o.parentNode.removeChild(o)})},300)}return t.addEventListener("touchmove",e),t.addEventListener("touchend",r),{destroy(){t.removeEventListener("touchmove",e),t.removeEventListener("touchend",r)}}}function yg(t){function e(r){if((r.ctrlKey||r.metaKey)&&(r.key==="Enter"||r.key==="NumpadEnter")){r.preventDefault();const n=t.__currentEditor,s=typeof n=="function"?n():n,o=t.__hasStoredKey,i=typeof o=="function"?o():o,l=t.__postStatus,c=typeof l=="function"?l():l,u=s?_i(s):"";!c?.sending&&u.trim()&&i&&t.__submitPost?.()}}return t.addEventListener("keydown",e),{destroy(){t.removeEventListener("keydown",e)}}}function _g(t){let e=!1;return t?.descendants(r=>{if(e)return!1;const n=r.type?.name;(n==="image"||n==="video")&&(e=!0)}),e}function wg(t){const{currentEditor:e,editorContainerEl:r,callbacks:n}=t,s=l=>{const u=l.detail.plainText,d=e?_g(e.state?.doc):!1;n.onContentUpdate?.(u,d)},o=l=>{const c=l;n.onImageFullscreenRequest?.(c.detail.src,c.detail.alt||"")},i=l=>{const u=l?.detail?.pos;if(u!=null&&!(!e||!e.view)){try{"ontouchstart"in window||navigator.maxTouchPoints>0||e.view.focus();const d=pn.create(e.state.doc,u);e.view.dispatch(e.state.tr.setSelection(d).scrollIntoView())}catch(d){console.warn("select-image-node handler failed:",d)}n.onSelectImageNode?.(u)}};return window.addEventListener("editor-content-changed",s),window.addEventListener("image-fullscreen-request",o),window.addEventListener("select-image-node",i),r&&(r.addEventListener("image-fullscreen-request",o),r.addEventListener("select-image-node",i)),{handleContentUpdate:s,handleImageFullscreenRequest:o,handleSelectImageNode:i}}function bg(t,e){window.removeEventListener("editor-content-changed",t.handleContentUpdate),window.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),window.removeEventListener("select-image-node",t.handleSelectImageNode),e&&(e.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),e.removeEventListener("select-image-node",t.handleSelectImageNode))}function Sg(t){const{placeholderText:e,editorContainerEl:r,hasStoredKey:n,submitPost:s,uploadFiles:o,eventCallbacks:i}=t;yf.value=e;const l=df({placeholderText:e,onSubmitPost:s,onCreate:f=>{Us.set(f)}});let c=null;const u=l.subscribe(f=>{c=f}),d=wg({currentEditor:c,editorContainerEl:r,callbacks:i});return Ef(s),r&&Object.assign(r,{__uploadFiles:o,__currentEditor:()=>c,__hasStoredKey:()=>n,__postStatus:()=>Re.postStatus,__submitPost:s}),{editor:l,unsubscribe:u,handlers:d}}function Eg(t){const{unsubscribe:e,handlers:r,currentEditor:n,editorContainerEl:s}=t;bg(r,s),e(),n?.destroy?.(),s&&(delete s.__uploadFiles,delete s.__currentEditor,delete s.__hasStoredKey,delete s.__postStatus,delete s.__submitPost)}function xg(t,e,r){const n=t.getBoundingClientRect(),s={x:n.width/2,y:n.height/2};return{centerX:s.x,centerY:s.y,offsetX:e-n.left-s.x,offsetY:r-n.top-s.y}}function Pg(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Cg(t,e,r){const n=e.getBoundingClientRect(),s={x:n.width/2,y:n.height/2};return{scale:r,offsetX:t.clientX-n.left-s.x,offsetY:t.clientY-n.top-s.y}}function Lg({scale:t,translate:e,useTransition:r},n){const s=n??document.querySelector(".image-container");s&&(s.style.transition=r?`transform ${Su.TRANSITION_DURATION} ease`:"none",s.style.transform=`scale(${t}) translate(${e.x/t}px, ${e.y/t}px)`,s.style.transformOrigin="center")}function Tg(t,e,r,n){const s=n??document.querySelector(".image-container");s&&(s.style.transition="none",s.style.transform=`scale(${t}) translate(${e/t}px, ${r/t}px)`)}function Yt(t,e){const r=e??document.querySelector(".image-container");r&&(r.style.cursor=t>Ye.DEFAULT_SCALE?"grab":"default")}function Ir(t,e){const r=e??document.querySelector(".fullscreen-overlay");r&&(r.style.cursor=t>Ye.DEFAULT_SCALE?"grab":"default")}function Ut(t){gt.setTransition(t)}function da(t){const e=t?"":"none";or("user-select",e),or("-webkit-user-select",e)}function Vr(t){t!==null&&clearTimeout(t)}function ha(t,e){if(t&&e){const r=t.getBoundingClientRect(),n=e.getBoundingClientRect(),s={imageWidth:r.width,imageHeight:r.height,containerWidth:n.width,containerHeight:n.height};gt.setBoundaryConstraints(s)}}function sn(t,e,r,n,s){t!==null&&cancelAnimationFrame(t),e!==null&&cancelAnimationFrame(e),t=null,e=null,gt.reset(),gt.setBoundaryConstraints(null),r.isDragging=!1,n.isPinching=!1,Vr(s),Od()}function Ag(t,e,r,n,s,o,i){if(!o)return{isDoubleTap:!1,newLastTapTime:t,newLastTapPosition:e,newTapTimeoutId:r};const l=Date.now(),c=e?Math.sqrt(Math.pow(n-e.x,2)+Math.pow(s-e.y,2)):0;if(l-t<200&&c<50&&r!==null)return Vr(r),i(n,s),{isDoubleTap:!0,newLastTapTime:0,newLastTapPosition:null,newTapTimeoutId:null};const u=l,d={x:n,y:s};Vr(r);const f=window.setTimeout(()=>{},300);return{isDoubleTap:!1,newLastTapTime:u,newLastTapPosition:d,newTapTimeoutId:f}}function fa(t,e,r,n,s,o,i,l,c,u){let d={...r},f=n,h=s,g=o;const p=Ag(n,s,o,i,l,c,u);return f=p.newLastTapTime,h=p.newLastTapPosition,g=p.newTapTimeoutId,p.isDoubleTap&&c?{newDragState:d,newLastTapTime:f,newLastTapPosition:h,newTapTimeoutId:g}:(t>Ye.DEFAULT_SCALE&&(d.start={x:i,y:l},d.startTranslate={...e}),{newDragState:d,newLastTapTime:f,newLastTapPosition:h,newTapTimeoutId:g})}function ga(t,e,r,n,s,o,i,l){let c={...t},u=!1;return n&&(c.start?Math.sqrt(Math.pow(e-c.start.x,2)+Math.pow(r-c.start.y,2)):0)>s&&(u=!0,!c.isDragging&&o>Ye.DEFAULT_SCALE&&(i(c.start.x,c.start.y),c.isDragging=!0)),c.isDragging&&l(e,r),{newDragState:c,touchMoved:u}}function pa(t,e,r,n,s){e&&Date.now()-r<200&&!n||s()}function ws(t,e,r){return Math.max(e,Math.min(r,t))}function va(t,e,r){return Math.abs(t-e)<r}function Ig(t,e,r){const n=e.x-t.x,s=e.y-t.y;return{x:n/r*16,y:s/r*16}}function Mg(t,e,r,n,s,o,i){o!==null&&cancelAnimationFrame(o);let l={...t},c={...e};const u=uo.FRICTION,d=uo.MIN_VELOCITY;function f(){if(l.x*=u,l.y*=u,Math.abs(l.x)<d&&Math.abs(l.y)<d){i(null),s();return}c.x+=l.x,c.y+=l.y,c=gt.applyBoundaryConstraints(c,r),n(c),i(requestAnimationFrame(f))}i(requestAnimationFrame(f))}let qe=We({scale:Ye.DEFAULT_SCALE,translate:{x:0,y:0},useTransition:!0}),bs=null;function ma(t,e){if(!bs)return t;const{imageWidth:r,imageHeight:n,containerWidth:s}=bs,o=r*e,i=n*e;let l=t.x,c=t.y;if(o>s){const f=(o-s)/2,h=-f;l=ws(l,h,f)}else l=0;const u=i/2,d=-u;return c=ws(c,d,u),{x:l,y:c}}const gt={get state(){return qe},reset(){qe.scale=Ye.DEFAULT_SCALE,qe.translate={x:0,y:0},qe.useTransition=!0},setDirectState(t){if(va(t.scale,Ye.DEFAULT_SCALE,Ye.THRESHOLD)){this.reset();return}qe.scale=t.scale,qe.translate={...t.translate},qe.useTransition=t.useTransition??qe.useTransition},zoom(t){const e=ws(t.scale,Ye.MIN_SCALE,Ye.MAX_SCALE);if(va(e,Ye.DEFAULT_SCALE,Ye.THRESHOLD)){this.reset();return}const r=e/qe.scale;qe.translate.x=qe.translate.x*r-t.offsetX*(r-1),qe.translate.y=qe.translate.y*r-t.offsetY*(r-1),qe.scale=e},zoomToPoint(t,e=0,r=0){if(qe.scale>=Ye.RESET_THRESHOLD){this.reset();return}const n=t/qe.scale;qe.translate.x=qe.translate.x*n-e*(n-1),qe.translate.y=qe.translate.y*n-r*(n-1),qe.scale=t},drag(t,e,r){const n={x:r.x+t,y:r.y+e},s=ma(n,qe.scale);qe.translate.x=s.x,qe.translate.y=s.y},setTransition(t){qe.useTransition=t},setBoundaryConstraints(t){bs=t},applyBoundaryConstraints(t,e){return ma(t,e)}};function Dg(){return{isDragging:!1,start:{x:0,y:0},startTranslate:{x:0,y:0}}}function kg(){return{isPinching:!1,initialDistance:0,initialScale:1,centerX:0,centerY:0}}var Ng=H('<span class="svg-icon close-icon svelte-128lph0"></span>'),Og=H('<div class="fullscreen-overlay svelte-128lph0" tabindex="0" role="dialog" aria-label=""><div class="close-button-container svelte-128lph0"><!></div> <div class="image-container svelte-128lph0"><img class="fullscreen-image svelte-128lph0" draggable="false"/></div></div>');function Rg(t,e){He(e,!0);let r=pe(e,"src",3,""),n=pe(e,"alt",3,""),s=pe(e,"show",15,!1),o=pe(e,"onClose",3,()=>{}),i=B(void 0),l=B(void 0),c=B(void 0),u=gt.state,d=Dg(),f=kg(),h=null,g=null,p=null,m=!1,x=0,_=null,b=null,S=0,T=!1,P=10,E=0,M={x:0,y:0},A={x:0,y:0};we(()=>{u=gt.state,Lg({scale:u.scale,translate:u.translate,useTransition:u.useTransition??!1},a(c))});function k(C){if(C.preventDefault(),!a(c)||!a(l))return;const D=C.deltaY>0?Ye.ZOOM_DELTA.OUT:Ye.ZOOM_DELTA.IN,$=u.scale*D,X=Cg(C,a(l),$);gt.zoom(X),Yt(u.scale,a(c)),Ir(u.scale,a(l))}function V(C,D){Ut(!0),setTimeout(()=>{if(u.scale>=Ye.RESET_THRESHOLD)gt.reset();else{const $=C!==void 0&&D!==void 0&&a(l)?xg(a(l),C,D):{offsetX:0,offsetY:0};gt.zoomToPoint(Ye.DOUBLE_CLICK_SCALE,$.offsetX,$.offsetY)}Yt(u.scale,a(c))},100)}function J(C){Q(),V(C.clientX,C.clientY)}function Y(C,D){u.scale<=Ye.DEFAULT_SCALE||(d.isDragging=!0,d.start={x:C,y:D},d.startTranslate={...u.translate},E=Date.now(),M={x:C,y:D},A={x:0,y:0},a(c)&&(a(c).style.cursor="grabbing",Ut(!1)),a(l)&&(a(l).style.cursor="grabbing"),da(!1))}function q(C,D){d.isDragging&&(h!==null&&cancelAnimationFrame(h),h=requestAnimationFrame(()=>{const $=Pg({x:C,y:D},d.start);gt.drag($.x,$.y,d.startTranslate);const X=Date.now(),ae=X-E;ae>0&&(A=Ig(M,{x:C,y:D},ae)),E=X,M={x:C,y:D}}))}function O(){d.isDragging&&(d.isDragging=!1,h!==null&&(cancelAnimationFrame(h),h=null),Tt()?Mg(A,u.translate,u.scale,C=>{gt.setDirectState({...u,translate:C,useTransition:!1})},()=>{Ut(!0),Yt(u.scale,a(c)),Ir(u.scale,a(l))},p,C=>{p=C}):(Yt(u.scale,a(c)),Ir(u.scale,a(l)),setTimeout(()=>Ut(!0),50)),da(!0))}function Q(){d.isDragging&&O()}function ge(C){const[D,$]=[C.touches[0],C.touches[1]],X=D.clientX-$.clientX,ae=D.clientY-$.clientY,me=Math.sqrt(X*X+ae*ae);me>Ye.PINCH_MIN_DISTANCE&&(f.isPinching=!0,f.initialDistance=me,f.initialScale=u.scale,f.centerX=(D.clientX+$.clientX)/2,f.centerY=(D.clientY+$.clientY)/2,Ut(!1))}function R(C){!f.isPinching||!a(l)||(g!==null&&cancelAnimationFrame(g),g=requestAnimationFrame(()=>{const[D,$]=[C.touches[0],C.touches[1]],X=D.clientX-$.clientX,ae=D.clientY-$.clientY,me=Math.sqrt(X*X+ae*ae);if(me>Ye.PINCH_MIN_DISTANCE){const fe=me/f.initialDistance,Ee=Math.max(Ye.MIN_SCALE,Math.min(Ye.MAX_SCALE,f.initialScale*fe));if(!a(l))return;const _e=a(l).getBoundingClientRect(),G=_e.width/2,Z=_e.height/2,de=f.centerX-_e.left-G,le=f.centerY-_e.top-Z,ue=Ee/u.scale,xe=u.translate.x*ue-de*(ue-1),Ne=u.translate.y*ue-le*(ue-1);Tg(Ee,xe,Ne,a(c))}}))}function I(){if(f.isPinching){if(g!==null&&(cancelAnimationFrame(g),g=null),f.isPinching=!1,a(c)){const C=a(c).style.transform,D=C.match(/scale\(([^)]+)\)/),$=C.match(/translate\(([^,]+)px,\s*([^)]+)px\)/);if(D&&$){const X=parseFloat(D[1]);if(Math.abs(X-Ye.DEFAULT_SCALE)<Ye.THRESHOLD)gt.reset();else{const ae=parseFloat($[1])*X,me=parseFloat($[2])*X;gt.setDirectState({scale:X,translate:{x:ae,y:me},useTransition:!0})}}}Ut(!0),Yt(u.scale,a(c))}}function ne(C){if(!C.target?.closest(".close-button-container"))if(C.preventDefault(),p!==null&&(cancelAnimationFrame(p),p=null,Ut(!0),Yt(u.scale,a(c)),Ir(u.scale,a(l))),C.touches.length===1){const D=C.touches[0],$=fa(u.scale,u.translate,d,x,b,_,D.clientX,D.clientY,!0,(X,ae)=>V(X,ae));d=$.newDragState,x=$.newLastTapTime,b=$.newLastTapPosition,_=$.newTapTimeoutId}else C.touches.length===2&&(O(),Vr(_),ge(C))}function U(C){if(C.preventDefault(),C.touches.length===1){const D=C.touches[0],$=ga(d,D.clientX,D.clientY,!0,P,u.scale,Y,q);d=$.newDragState,T=$.touchMoved}else C.touches.length===2&&f.isPinching&&R(C)}function W(C){C.preventDefault(),C.touches.length===0?(pa(d,!0,S,T,O),I()):C.touches.length===1&&f.isPinching&&I()}function ie(C){if(C.target?.closest(".close-button-container"))return;p!==null&&(cancelAnimationFrame(p),p=null,Ut(!0),Yt(u.scale,a(c)),Ir(u.scale,a(l)));const D=fa(u.scale,u.translate,d,x,b,_,C.clientX,C.clientY,!1,($,X)=>V($,X));d=D.newDragState,x=D.newLastTapTime,b=D.newLastTapPosition,_=D.newTapTimeoutId,Y(C.clientX,C.clientY)}function ee(C){d.isDragging&&(C.preventDefault(),d=ga(d,C.clientX,C.clientY,!1,P,u.scale,Y,q).newDragState)}function he(){pa(d,!1,S,T,O)}function ve(C){C.key==="Escape"&&Ce()}function ye(C){s()&&m&&(C.preventDefault(),sn(h,g,d,f,x),h=null,g=null,x=0,_=null,s(!1),o()())}function Ce(){sn(h,g,d,f,x),h=null,g=null,x=0,_=null,s(!1),o()(),m&&(m=!1,history.back())}we(()=>{s()?(sn(h,g,d,f,x),h=null,g=null,x=0,_=null,or("overflow","hidden"),m||(history.pushState({imageFullscreen:!0},"",""),m=!0),a(i)&&a(i).complete&&ha(a(i),a(l))):(or("overflow",""),m=!1)});function ce(){const C=[{event:"mousemove",handler:ee,target:document},{event:"mouseup",handler:he,target:document},{event:"popstate",handler:ye,target:window}];return C.forEach(({event:D,handler:$,target:X})=>X.addEventListener(D,$)),C}function oe(C){C.forEach(({event:D,handler:$,target:X})=>X.removeEventListener(D,$))}ir(()=>{const C=ce();return()=>{oe(C),Vr(_)}}),jr(()=>{sn(h,g,d,f,x),m=!1,b=null});var te=Se(),F=re(te);{var j=C=>{var D=Og();D.__keydown=ve,D.__mousedown=ie,D.__touchstart=ne,D.__touchmove=U,D.__touchend=W;var $=y(D),X=y($);Le(X,{variant:"close",shape:"circle",onClick:Ce,ontouchstart:fe=>fe.stopPropagation(),ontouchend:fe=>{fe.stopPropagation(),fe.preventDefault(),setTimeout(()=>Ce(),50)},ariaLabel:"Close fullscreen image",children:(fe,Ee)=>{var _e=Ng();w(fe,_e)},$$slots:{default:!0}});var ae=L($,2),me=y(ae);me.__dblclick=J,st(me,fe=>v(i,fe),()=>a(i)),st(ae,fe=>v(c,fe),()=>a(c)),st(D,fe=>v(l,fe),()=>a(l)),K(()=>{Ie(me,"src",r()),Ie(me,"alt",n())}),Je("wheel",D,k),Je("load",me,fe=>ha(a(i),a(l))),w(C,D)};se(F,C=>{s()&&C(j)})}w(t,te),Ue()}ft(["keydown","mousedown","touchstart","touchmove","touchend","dblclick"]);var Fg=H('<div class="upload-error svelte-8mn1et"> </div>'),Hg=H('<div class="copy-success-message"> </div>'),Ug=H('<div class="post-container svelte-8mn1et"><div aria-label="" role="textbox" tabindex="-1"><!></div> <!> <input type="file" accept="image/*,video/*" multiple style="display: none;"/> <!></div> <!> <!> <!>',1);function Bg(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=B(null),i=B(null),l=B(!1),c=B(void 0),u=B(void 0),d=B(We({})),f=B(We({})),h=N(()=>xt.value),g=N(()=>Re.postStatus),p=N(()=>Re.uploadErrorMessage),m=null,x=null,_=N(()=>St.value),b=N(()=>a(_).showSecretKeyDialog),S=N(()=>a(_).showImageFullscreen),T=N(()=>a(_).fullscreenImageSrc),P=N(()=>a(_).fullscreenImageAlt),E=N(()=>a(_).showPopupModal),M=N(()=>a(_).popupX),A=N(()=>a(_).popupY),k=N(()=>a(_).popupMessage);we(()=>{e.rxNostr&&(a(u)?a(u).setRxNostr(e.rxNostr):v(u,new If(e.rxNostr),!0))});async function V(G){!G||G.length===0||await Jf({files:G,currentEditor:a(i),fileInput:a(c),onUploadProgress:e.onUploadProgress,updateUploadState:(Z,de)=>{Re.isUploading=Z,Re.uploadErrorMessage=de||""},imageOxMap:a(d),imageXMap:a(f),videoCompressionProgressStore:Fr,imageCompressionProgressStore:Hr,getUploadFailedText:Z=>r()(Z)})}ir(()=>{const G=r()("postComponent.enter_your_text")||"";x=Sg({placeholderText:G,editorContainerEl:m,currentEditor:a(i),hasStoredKey:e.hasStoredKey,submitPost:R,uploadFiles:de=>{V(de)},eventCallbacks:{onContentUpdate:wf,onImageFullscreenRequest:(de,le)=>{St.showImageFullscreen(de,le)},onSelectImageNode:de=>{}}}),v(o,x.editor,!0),a(o).subscribe(de=>{v(i,de,!0),Us.set(de)});const Z=de=>{const le=de,{src:ue,alt:xe}=le.detail;St.showImageFullscreen(ue,xe)};return window.addEventListener("image-fullscreen-request",Z),()=>{window.removeEventListener("image-fullscreen-request",Z),x&&Eg({unsubscribe:x.unsubscribe,handlers:x.handlers,currentEditor:a(i),editorContainerEl:m})}});function J(G){const Z=G.target;Z?.files?.length&&V(Z.files)}async function Y(G){await V(G)}function q(G){if(!a(i)||!G)return;const Z=a(i),le=G.split(`
`).map(ue=>({type:"paragraph",content:ue?[{type:"text",text:ue}]:void 0}));Z.commands.setContent({type:"doc",content:le}),Z.commands.focus("end")}function O(G){!a(i)||!G||(a(i).commands.setContent(G),a(i).commands.focus("end"))}function Q(){return a(i)?a(i).getHTML():""}function ge(G){if(!a(i)||G.length===0)return;const{schema:Z}=a(i).state;let de=a(i).state.tr,le=a(i).state.doc.content.size;G.forEach(ue=>{if(ue.isPlaceholder)return;const xe=ue.src;if(ue.type==="image"&&Z.nodes.image){const Ne=Z.nodes.image.create({src:xe,alt:ue.alt??"Image",blurhash:ue.blurhash??null,dim:ue.dim??null});de=de.insert(le,Ne),le+=Ne.nodeSize,ue.ox&&v(d,{...a(d),[xe]:ue.ox},!0),ue.x&&v(f,{...a(f),[xe]:ue.x},!0)}else if(ue.type==="video"&&Z.nodes.video){const Ne=Z.nodes.video.create({src:xe});de=de.insert(le,Ne),le+=Ne.nodeSize}}),a(i).view.dispatch(de),a(i).commands.focus("end")}async function R(){if(!a(u)||!a(i))return;const G=a(u).preparePostContent(a(i));if(Mu(G)){St.showSecretKeyDialog(G);return}await a(u).performPostSubmission(a(i),a(d),a(f),()=>kt({sending:!0,success:!1,error:!1,message:"",completed:!1}),()=>{kt({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),ne(),e.onPostSuccess?.()},Z=>kt({sending:!1,success:!1,error:!0,message:Z||"postComponent.post_error",completed:!1}))}function I(){a(u)&&a(i)&&a(u).resetPostContent(a(i))}function ne(){a(u)&&a(i)&&a(u).clearContentAfterSuccess(a(i))}async function U(){const G=St.getPendingPost();if(St.hideSecretKeyDialog(),a(u)&&a(i)){const Z=a(u).prepareImageBlurhashMap(a(i),a(d),a(f));kt({sending:!0,success:!1,error:!1,message:"",completed:!1});try{const de=await a(u).submitPost(G,Z);de.success?(kt({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),ne(),e.onPostSuccess?.()):kt({sending:!1,success:!1,error:!0,message:de.error||"postComponent.post_error",completed:!1})}catch{kt({sending:!1,success:!1,error:!0,message:"postComponent.post_error",completed:!1})}}}function W(){St.hideSecretKeyDialog()}function ie(){St.hideImageFullscreen()}we(()=>{a(i)&&a(u)&&a(u).preparePostContent(a(i))!==Re.content&&a(g).error&&kt({...a(g),error:!1,message:""})});function ee(){a(c)?.click()}we(()=>{const G=ze.items.some(le=>!le.isPlaceholder),Z=!!Re.content.trim(),de=Re.hasImage;Re.canPost=Z||de||G});let he=!0;we(()=>{const G=!xt.value;if(he){he=!1;return}if(a(i))if(G){const Z=a(i).state.doc,de=[];if(Z.descendants((le,ue)=>{(le.type.name==="image"||le.type.name==="video")&&!le.attrs.isPlaceholder&&de.push({node:le,pos:ue})}),de.length>0){xr(()=>{de.forEach(({node:ue})=>{const xe=ue.attrs.src;xe&&ze.addItem({id:vr(),type:ue.type.name,src:xe,isPlaceholder:!1,blurhash:ue.attrs.blurhash??void 0,ox:a(d)[xe]??void 0,x:a(f)[xe]??void 0,dim:ue.attrs.dim??void 0,alt:ue.attrs.alt??void 0})})});let le=a(i).state.tr;[...de].reverse().forEach(({node:ue,pos:xe})=>{le=le.delete(xe,xe+ue.nodeSize)}),a(i).view.dispatch(le),xr(()=>{v(d,{},!0),v(f,{},!0)})}}else{const Z=xr(()=>ze.getItems());if(Z.length>0){const{schema:de}=a(i).state;let le=a(i).state.tr,ue=a(i).state.doc.content.size;const xe={},Ne={};Z.forEach(Me=>{if(Me.isPlaceholder)return;const Ze=Me.src;if(Me.type==="image"&&de.nodes.image){const Fe=de.nodes.image.create({src:Ze,alt:Me.alt??"Image",blurhash:Me.blurhash??null,dim:Me.dim??null});le=le.insert(ue,Fe),ue+=Fe.nodeSize}else if(Me.type==="video"&&de.nodes.video){const Fe=de.nodes.video.create({src:Ze});le=le.insert(ue,Fe),ue+=Fe.nodeSize}Me.ox&&(xe[Ze]=Me.ox),Me.x&&(Ne[Ze]=Me.x)}),a(i).view.dispatch(le),xr(()=>{v(d,xe,!0),v(f,Ne,!0)})}xr(()=>ze.clearAll())}});var ve={uploadFiles:Y,insertTextContent:q,loadDraftContent:O,getEditorHtml:Q,appendMediaToEditor:ge,submitPost:R,resetPostContent:I,clearContentAfterSuccess:ne,openFileDialog:ee},ye=Ug(),Ce=re(ye),ce=y(Ce);let oe;var te=y(ce);{var F=G=>{Ol(G,{get editor(){return a(i)},class:"editor-content"})};se(te,G=>{a(o)&&a(i)&&G(F)})}Yr(ce,(G,Z)=>pg?.(G,Z),()=>({dragOver:G=>v(l,G,!0)})),Yr(ce,G=>vg?.(G)),Yr(ce,G=>mg?.(G)),Yr(ce,G=>yg?.(G)),st(ce,G=>m=G,()=>m);var j=L(ce,2);{var C=G=>{fg(G,{})};se(j,G=>{a(h)||G(C)})}var D=L(j,2);D.__change=J,st(D,G=>v(c,G),()=>a(c));var $=L(D,2);{var X=G=>{var Z=Fg(),de=y(Z);K(()=>z(de,a(p))),w(G,Z)};se($,G=>{a(p)&&G(X)})}var ae=L(Ce,2);ag(ae,{onConfirm:U,onCancel:W,get show(){return a(b)},set show(G){v(b,G)}});var me=L(ae,2);Rg(me,{get src(){return a(T)},get alt(){return a(P)},onClose:ie,get show(){return a(S)},set show(G){v(S,G)}});var fe=L(me,2);{var Ee=G=>{zs(G,{get show(){return a(E)},get x(){return a(M)},get y(){return a(A)},onClose:()=>St.hidePopupMessage(),children:(Z,de)=>{var le=Hg(),ue=y(le);K(()=>z(ue,a(k))),w(Z,le)},$$slots:{default:!0}})};se(fe,G=>{a(E)&&G(Ee)})}K(()=>oe=Et(ce,1,"editor-container svelte-8mn1et",null,oe,{"drag-over":a(l),"gallery-mode":!a(h)})),w(t,ye);var _e=Ue(ve);return s(),_e}ft(["change"]);var $g=H('<div class="rotate-right-icon svg-icon svelte-1da05mf"></div> <span class="btn-text"> </span>',1),zg=H('<li class="svelte-1da05mf"> </li>'),jg=H('<ul class="svelte-1da05mf"></ul>'),Wg=H('<span style="color: #888;"> </span>'),Gg=H('<div class="relay-list svelte-1da05mf"><!></div>'),Vg=H('<div class="setting-section"><div class="setting-row"><span class="setting-label"> </span> <div class="setting-control"><!></div></div> <div class="setting-info svelte-1da05mf"><button type="button" class="relay-toggle-label svelte-1da05mf" style="cursor:pointer; background:none; border:none; padding:0; font: inherit;"><span class="relay-toggle-icon svelte-1da05mf" aria-label="toggle"><!></span> </button> <!></div></div>');function qg(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();var o=Vg(),i=y(o),l=y(i),c=y(l),u=L(l,2),d=y(u);{let T=N(()=>r()("settingsDialog.refresh_relays_and_profile")||"");Le(d,{variant:"default",shape:"rounded",className:"refresh-relays-profile-btn",onClick:()=>e.onRefreshRelaysAndProfile?.(),get ariaLabel(){return a(T)},children:(P,E)=>{var M=$g(),A=re(M),k=L(A,2),V=y(k);K((J,Y)=>{Ie(A,"aria-label",J),z(V,Y)},[()=>r()("settingsDialog.refresh")||"",()=>r()("settingsDialog.refresh")||""]),w(P,M)},$$slots:{default:!0}})}var f=L(i,2),h=y(f);h.__click=function(...T){e.onToggleShowRelays?.apply(this,T)};var g=y(h),p=y(g);{var m=T=>{var P=De("");w(T,P)},x=T=>{var P=De("");w(T,P)};se(p,T=>{e.showRelays?T(m):T(x,!1)})}var _=L(g),b=L(h,2);{var S=T=>{var P=Gg(),E=y(P);{var M=k=>{var V=jg();Ct(V,21,()=>e.writeRelays,Jt,(J,Y)=>{var q=zg(),O=y(q);K(()=>z(O,a(Y))),w(J,q)}),w(k,V)},A=k=>{var V=Wg(),J=y(V);K(Y=>z(J,Y),[()=>r()("settingsDialog.no_relay_info")||""]),w(k,V)};se(E,k=>{e.writeRelays.length>0?k(M):k(A,!1)})}w(T,P)};se(b,T=>{e.showRelays&&T(S)})}K((T,P,E)=>{z(c,T),Ie(h,"aria-pressed",e.showRelays),Ie(h,"aria-label",P),z(_,` ${E??""}`)},[()=>r()("settingsDialog.refresh_relays_and_profile")||"",()=>r()("settingsDialog.toggle_write_relays_list")||"",()=>r()("settingsDialog.write_relays_list")||""]),w(t,o),Ue(),s()}ft(["click"]);var Kg=H('<input type="radio" style="display: none;"/> <!>',1);function ya(t,e){He(e,!0);let r=pe(e,"checked",3,!1),n=pe(e,"disabled",3,!1),s=pe(e,"variant",3,"default"),o=pe(e,"shape",3,"rounded"),i=pe(e,"className",3,""),l=pe(e,"ariaLabel",3,""),c=pe(e,"style",3,""),u;function d(){!n()&&u&&u.click()}function f(){e.onChange&&e.onChange(e.value)}var h=Kg(),g=re(h);g.__change=f,st(g,m=>u=m,()=>u);var p=L(g,2);Le(p,{get variant(){return s()},get shape(){return o()},get className(){return i()},get ariaLabel(){return l()},get style(){return c()},get disabled(){return n()},get selected(){return r()},onClick:d,children:(m,x)=>{var _=Se(),b=re(_);Rt(b,()=>e.children??qr),w(m,_)},$$slots:{default:!0}}),K(()=>{xa(g,e.value),Ie(g,"name",e.name),ll(g,r()),g.disabled=n()}),w(t,h),Ue()}ft(["change"]);var Xg=H('<div class="info-icon svg-icon svelte-24l4z1"></div>'),Yg=H('<div class="popover-body svelte-24l4z1"><div class="popover-children svelte-24l4z1"><!></div></div>'),Qg=H("<!> <!>",1);function Ss(t,e){let r=pe(e,"side",3,"top"),n=pe(e,"sideOffset",3,0),s=pe(e,"ariaLabel",3,"");var o=Se(),i=re(o);be(i,()=>cl,(l,c)=>{c(l,{children:(u,d)=>{var f=Qg(),h=re(f);be(h,()=>ul,(p,m)=>{m(p,{class:"info-trigger",get"aria-label"(){return s()},children:(x,_)=>{var b=Xg();w(x,b)},$$slots:{default:!0}})});var g=L(h,2);be(g,()=>Ot,(p,m)=>{m(p,{children:(x,_)=>{var b=Se(),S=re(b);be(S,()=>dl,(T,P)=>{P(T,{get side(){return r()},get sideOffset(){return n()},class:"popover-content",trapFocus:!1,onCloseAutoFocus:E=>E.preventDefault(),children:(E,M)=>{var A=Yg(),k=y(A),V=y(k);Rt(V,()=>e.children??qr),w(E,A)},$$slots:{default:!0}})}),w(x,b)},$$slots:{default:!0}})}),w(u,f)},$$slots:{default:!0}})}),w(t,o)}var Zg=H('<table class="popover-table svelte-1k5jhna"><thead class="svelte-1k5jhna"><tr class="svelte-1k5jhna"><th class="svelte-1k5jhna"> </th><th class="svelte-1k5jhna"> </th><th class="svelte-1k5jhna"> </th></tr></thead><tbody class="svelte-1k5jhna"><tr class="svelte-1k5jhna"><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td></tr><tr class="svelte-1k5jhna"><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td></tr><tr class="svelte-1k5jhna"><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td></tr></tbody></table>'),Jg=H('<div class="radio-pair svelte-1k5jhna"></div>'),ep=H('<table class="popover-table svelte-1k5jhna"><thead class="svelte-1k5jhna"><tr class="svelte-1k5jhna"><th class="svelte-1k5jhna"> </th><th class="svelte-1k5jhna"> </th></tr></thead><tbody class="svelte-1k5jhna"><tr class="svelte-1k5jhna"><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td></tr><tr class="svelte-1k5jhna"><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td></tr><tr class="svelte-1k5jhna"><td class="svelte-1k5jhna"> </td><td class="svelte-1k5jhna"> </td></tr></tbody></table>'),tp=H('<div class="radio-pair svelte-1k5jhna"></div>'),rp=H('<div class="setting-section svelte-1k5jhna"><div class="setting-row svelte-1k5jhna"><div class="setting-label-wrapper svelte-1k5jhna"><span class="setting-label"> </span> <!></div> <div class="setting-control radio-group svelte-1k5jhna"></div></div></div> <div class="setting-section svelte-1k5jhna"><div class="setting-row svelte-1k5jhna"><div class="setting-label-wrapper svelte-1k5jhna"><span class="setting-label"> </span> <!></div> <div class="setting-control radio-group svelte-1k5jhna"></div></div></div>',1);function np(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();var o=rp(),i=re(o),l=y(i),c=y(l),u=y(c),d=y(u),f=L(u,2);Ss(f,{side:"top",ariaLabel:"",children:(T,P)=>{var E=Zg(),M=y(E),A=y(M),k=y(A),V=y(k),J=L(k),Y=y(J),q=L(J),O=y(q),Q=L(M),ge=y(Q),R=y(ge),I=y(R),ne=L(R),U=y(ne),W=L(ne),ie=y(W),ee=L(ge),he=y(ee),ve=y(he),ye=L(he),Ce=y(ye),ce=L(ye),oe=y(ce),te=L(ee),F=y(te),j=y(F),C=L(F),D=y(C),$=L(C),X=y($);K((ae,me,fe,Ee,_e,G,Z,de,le)=>{z(V,ae),z(Y,me),z(O,fe),z(I,Ee),z(U,`${Qt.low.maxWidthOrHeight}px`),z(ie,`${_e??""}%`),z(ve,G),z(Ce,`${Qt.medium.maxWidthOrHeight}px`),z(oe,`${Z??""}%`),z(j,de),z(D,`${Qt.high.maxWidthOrHeight}px`),z(X,`${le??""}%`)},[()=>r()("settingsDialog.info_header_setting"),()=>r()("settingsDialog.info_header_pixels"),()=>r()("settingsDialog.info_header_quality"),()=>r()("settingsDialog.quality_high"),()=>Math.round(Qt.low.initialQuality*100),()=>r()("settingsDialog.quality_medium"),()=>Math.round(Qt.medium.initialQuality*100),()=>r()("settingsDialog.quality_low"),()=>Math.round(Qt.high.initialQuality*100)]),w(T,E)},$$slots:{default:!0}});var h=L(c,2);Ct(h,21,()=>e.compressionPairs,Jt,(T,P)=>{var E=Jg();Ct(E,21,()=>a(P),Jt,(M,A)=>{{let k=N(()=>e.selectedCompression===a(A).value);ya(M,{get value(){return a(A).value},name:"compression",get checked(){return a(k)},variant:"default",shape:"rounded",get onChange(){return e.onCompressionChange},get ariaLabel(){return a(A).label},children:(V,J)=>{var Y=De();K(()=>z(Y,a(A).label)),w(V,Y)},$$slots:{default:!0}})}}),w(T,E)});var g=L(i,2),p=y(g),m=y(p),x=y(m),_=y(x),b=L(x,2);Ss(b,{side:"top",ariaLabel:"",children:(T,P)=>{var E=ep(),M=y(E),A=y(M),k=y(A),V=y(k),J=L(k),Y=y(J),q=L(M),O=y(q),Q=y(O),ge=y(Q),R=L(Q),I=y(R),ne=L(O),U=y(ne),W=y(U),ie=L(U),ee=y(ie),he=L(ne),ve=y(he),ye=y(ve),Ce=L(ve),ce=y(Ce);K((oe,te,F,j,C)=>{z(V,oe),z(Y,te),z(ge,F),z(I,`${an.low.maxSize??""}px`),z(W,j),z(ee,`${an.medium.maxSize??""}px`),z(ye,C),z(ce,`${an.high.maxSize??""}px`)},[()=>r()("settingsDialog.info_header_setting"),()=>r()("settingsDialog.info_header_pixels"),()=>r()("settingsDialog.quality_high"),()=>r()("settingsDialog.quality_medium"),()=>r()("settingsDialog.quality_low")]),w(T,E)},$$slots:{default:!0}});var S=L(m,2);Ct(S,21,()=>e.videoCompressionPairs,Jt,(T,P)=>{var E=tp();Ct(E,21,()=>a(P),Jt,(M,A)=>{{let k=N(()=>e.selectedVideoCompression===a(A).value);ya(M,{get value(){return a(A).value},name:"videoCompression",get checked(){return a(k)},variant:"default",shape:"rounded",get onChange(){return e.onVideoCompressionChange},get ariaLabel(){return a(A).label},children:(V,J)=>{var Y=De();K(()=>z(Y,a(A).label)),w(V,Y)},$$slots:{default:!0}})}}),w(T,E)}),K((T,P)=>{z(d,T),z(_,P)},[()=>r()("settingsDialog.image_quality_setting"),()=>r()("settingsDialog.video_quality_setting")]),w(t,o),Ue(),s()}var sp=H('<div class="xmark-icon svg-icon svelte-1koizbb" aria-label=""></div>'),op=H('<div class="help-icon svg-icon svelte-1koizbb" aria-label="Help"></div>'),ap=H('<div class="github-icon svg-icon svelte-1koizbb" aria-label="GitHub"></div>'),ip=H('<div class="rotate-right-icon svg-icon svelte-1koizbb"></div> <span class="btn-text svelte-1koizbb"> </span>',1),lp=H('<div class="setting-section sw-update-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label sw-update-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><!></div></div></div>'),cp=H('<div class="lang-icon-btn svg-icon svelte-1koizbb"></div> <span class="btn-text svelte-1koizbb"> </span>',1),up=H('<option class="svelte-1koizbb"> </option>'),dp=H('<div class="settings-header svelte-1koizbb"><div class="first-row svelte-1koizbb"><div class="site-title svelte-1koizbb"><span class="site-name svelte-1koizbb">eHagaki</span> <span class="cache-version svelte-1koizbb"> </span></div> <div class="author-info svelte-1koizbb"><span class="svelte-1koizbb"> </span><a href="https://lokuyow.github.io/" target="_blank" class="svelte-1koizbb"> </a></div></div> <div class="second-row svelte-1koizbb"><!> <!> <div class="svelte-1koizbb"><div class="zap-view-btn-group svelte-1koizbb"><button class="zap-btn svelte-1koizbb" data-npub="npub1a3pvwe2p3v7mnjz6hle63r628wl9w567aw7u23fzqs062v5vqcqqu3sgh3" data-note-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-relays="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">Support</button> <span class="divider svelte-1koizbb"></span> <button class="view-btn svelte-1koizbb" data-title="Thanks for the Support!" data-nzv-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-zap-color-mode="true" data-relay-urls="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">View</button></div></div></div></div> <div class="modal-body svelte-1koizbb"><!> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb">Language/</span> <div class="setting-control svelte-1koizbb"><!></div></div></div> <!> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><select class="svelte-1koizbb"></select></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><!></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><!></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><!></div></div></div> <!></div>',1);function hp(t,e){const r=hl();He(e,!0);const n=()=>je(Qe,"$_",i),s=()=>je(vt,"$locale",i),o=()=>je(Ds,"$swNeedRefresh",i),[i,l]=et();let c=pe(e,"show",15,!1),u=pe(e,"onRefreshRelaysAndProfile",3,()=>{}),d=pe(e,"selectedCompression",3,"medium"),f=pe(e,"onSelectedCompressionChange",3,void 0),h=pe(e,"selectedEndpoint",3,""),g=pe(e,"onSelectedEndpointChange",3,void 0),p=pe(e,"onOpenWelcomeDialog",3,void 0);function m(){c(!1),e.onClose?.()}Sr(()=>c(),m,!0);let x=N(()=>co(n())),_=N(()=>co(n())),b=N(()=>Go(a(x),2)),S=N(()=>Go(a(_),2)),T=B(!0),P=B(!1),E=B(We(zo.value)),M=B(""),A=B("medium"),k=B(""),V=B(!1);we(()=>{a(V)||(v(M,d()),v(k,h()))});let J=N(()=>oi.value),Y=N(()=>Br.value),q=N(()=>Kn.value),O=N(()=>Ho.value);we(()=>{const I=d();I!==void 0&&I!==""&&v(M,I,!0)}),we(()=>{f()&&a(M)!==d()&&f()(a(M))}),we(()=>{const I=h();I!==void 0&&I!==""&&v(k,I,!0)}),we(()=>{g()&&a(k)!==h()&&g()(a(k))}),we(()=>{a(V)&&a(M)&&localStorage.setItem(Ke.IMAGE_COMPRESSION_LEVEL,a(M))}),we(()=>{a(V)&&a(A)&&localStorage.setItem(Ke.VIDEO_COMPRESSION_LEVEL,a(A))}),we(()=>{a(V)&&a(k)&&localStorage.setItem(Ke.UPLOAD_ENDPOINT,a(k))}),we(()=>{a(V)&&localStorage.setItem(Ke.CLIENT_TAG_ENABLED,a(T)?"true":"false")}),we(()=>{a(V)&&(localStorage.setItem(Ke.MEDIA_FREE_PLACEMENT,a(P)?"true":"false"),xt.set(a(P)))}),we(()=>{a(V)&&zo.set(a(E))});function Q(){kd(od,I=>Ho.set(I),{timeout:bu})}function ge(){const I=Dd({selectedEndpoint:h(),selectedCompression:d()});v(k,I.endpoint,!0),v(T,I.clientTagEnabled,!0),v(M,I.compression,!0);const ne=localStorage.getItem(Ke.MEDIA_FREE_PLACEMENT);ne!==null?v(P,ne!=="false"):(v(P,!1),localStorage.setItem(Ke.MEDIA_FREE_PLACEMENT,"false")),xt.set(a(P));const U=localStorage.getItem(Ke.VIDEO_COMPRESSION_LEVEL);U?U==="skip"?(v(A,"none"),localStorage.setItem(Ke.VIDEO_COMPRESSION_LEVEL,"none")):v(A,U,!0):(v(A,"medium"),localStorage.setItem(Ke.VIDEO_COMPRESSION_LEVEL,"medium")),v(V,!0)}ir(()=>{ge(),ad(),lt.value?.pubkey&&lt.value?.isAuthenticated&&Uo(lt.value.pubkey)}),we(()=>{if(!c()){Kn.set(!1);return}lt.value?.pubkey&&lt.value?.isAuthenticated&&Uo(lt.value.pubkey),(async()=>(await hn(),wl(),window.nostrZap?.initTargets()))()}),we(()=>{s()&&!localStorage.getItem(Ke.UPLOAD_ENDPOINT)&&v(k,Ts(s()),!0)});function R(){vt.set(s()==="ja"?"en":"ja")}{const I=W=>{var ie=Se(),ee=re(ie);{const he=(ve,ye)=>{Le(ve,pt(()=>ye?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"",children:(ce,oe)=>{var te=sp();w(ce,te)},$$slots:{default:!0}}))};be(ee,()=>yr,(ve,ye)=>{ye(ve,{child:he,$$slots:{child:!0}})})}w(W,ie)};let ne=N(()=>n()("settings")||""),U=N(()=>n()("settingsDialog.image_quality_setting"));br(t,{onOpenChange:W=>!W&&m(),get title(){return a(ne)},get description(){return a(U)},contentClass:"settings-dialog",footerVariant:"close-button",get open(){return c()},set open(W){c(W)},footer:I,children:(W,ie)=>{var ee=dp(),he=re(ee),ve=y(he),ye=y(ve),Ce=L(y(ye),2),ce=y(Ce),oe=L(ye,2),te=y(oe),F=y(te),j=L(te),C=y(j),D=L(ve,2),$=y(D);Le($,{shape:"circle",variant:"default",className:"help-btn",onClick:()=>{m(),p()?.()},ariaLabel:"Help",children:(Ve,ot)=>{var Be=op();w(Ve,Be)},$$slots:{default:!0}});var X=L($,2);Le(X,{shape:"circle",variant:"default",className:"github-link-btn",onClick:()=>window.open("https://github.com/Lokuyow/ehagaki","_blank"),ariaLabel:"GitHub Repository",children:(Ve,ot)=>{var Be=ap();w(Ve,Be)},$$slots:{default:!0}});var ae=L(he,2),me=y(ae);{var fe=Ve=>{var ot=lp(),Be=y(ot),yt=y(Be),at=y(yt),_t=L(yt,2),Dt=y(_t);{let wt=N(()=>a(O)?"loading":""),Vi=N(()=>n()("settingsDialog.update_app")||"");Le(Dt,{variant:"primary",shape:"rounded",get className(){return`sw-update-btn ${a(wt)??""}`},onClick:Q,get disabled(){return a(O)},get ariaLabel(){return a(Vi)},children:(qi,_m)=>{var Gs=Se(),Ki=re(Gs);{var Xi=lr=>{{let Xr=N(()=>n()("settingsDialog.updating")||"...");It(lr,{showLoader:!0,get text(){return a(Xr)}})}},Yi=lr=>{var Xr=ip(),Vs=re(Xr),Qi=L(Vs,2),Zi=y(Qi);K((Ji,el)=>{Ie(Vs,"aria-label",Ji),z(Zi,el)},[()=>n()("settingsDialog.refresh")||"",()=>n()("settingsDialog.update_app")||""]),w(lr,Xr)};se(Ki,lr=>{a(O)?lr(Xi):lr(Yi,!1)})}w(qi,Gs)},$$slots:{default:!0}})}K(wt=>z(at,wt),[()=>n()("settingsDialog.sw_update_available")||""]),w(Ve,ot)};se(me,Ve=>{o()&&Ve(fe)})}var Ee=L(me,2),_e=y(Ee),G=L(y(_e),2),Z=y(G);Le(Z,{variant:"default",shape:"rounded",className:"lang-btn",onClick:R,children:(Ve,ot)=>{var Be=cp(),yt=re(Be),at=L(yt,2),_t=y(at);K((Dt,wt)=>{Ie(yt,"aria-label",Dt),z(_t,wt)},[()=>n()("settingsDialog.change")||"",()=>n()("settingsDialog.change")||""]),w(Ve,Be)},$$slots:{default:!0}});var de=L(Ee,2);np(de,{get compressionPairs(){return a(b)},get selectedCompression(){return a(M)},onCompressionChange:Ve=>v(M,Ve,!0),get videoCompressionPairs(){return a(S)},get selectedVideoCompression(){return a(A)},onVideoCompressionChange:Ve=>v(A,Ve,!0)});var le=L(de,2),ue=y(le),xe=y(ue),Ne=y(xe),Me=L(xe,2),Ze=y(Me);Ct(Ze,21,()=>ti,Jt,(Ve,ot)=>{var Be=up(),yt=y(Be),at={};K(()=>{z(yt,a(ot).label),at!==(at=a(ot).url)&&(Be.value=(Be.__value=a(ot).url)??"")}),w(Ve,Be)});var Fe=L(le,2),ct=y(Fe),ut=y(ct),mt=y(ut),tt=L(ut,2),Pe=y(tt);be(Pe,()=>Rn,(Ve,ot)=>{ot(Ve,{class:"bui-switch",get checked(){return a(P)},set checked(Be){v(P,Be,!0)},children:(Be,yt)=>{var at=Se(),_t=re(at);be(_t,()=>Fn,(Dt,wt)=>{wt(Dt,{class:"bui-switch-thumb"})}),w(Be,at)},$$slots:{default:!0}})});var Oe=L(Fe,2),Ge=y(Oe),rt=y(Ge),Kt=y(rt),Er=L(rt,2),Nn=y(Er);be(Nn,()=>Rn,(Ve,ot)=>{ot(Ve,{class:"bui-switch",get checked(){return a(E)},set checked(Be){v(E,Be,!0)},children:(Be,yt)=>{var at=Se(),_t=re(at);be(_t,()=>Fn,(Dt,wt)=>{wt(Dt,{class:"bui-switch-thumb"})}),w(Be,at)},$$slots:{default:!0}})});var Mt=L(Oe,2),Xt=y(Mt),Ws=y(Xt),zi=y(Ws),ji=L(Ws,2),Wi=y(ji);be(Wi,()=>Rn,(Ve,ot)=>{ot(Ve,{class:"bui-switch",get checked(){return a(T)},set checked(Be){v(T,Be,!0)},children:(Be,yt)=>{var at=Se(),_t=re(at);be(_t,()=>Fn,(Dt,wt)=>{wt(Dt,{class:"bui-switch-thumb"})}),w(Be,at)},$$slots:{default:!0}})});var Gi=L(Mt,2);qg(Gi,{get writeRelays(){return a(Y)},get showRelays(){return a(q)},onToggleShowRelays:()=>Kn.set(!a(q)),get onRefreshRelaysAndProfile(){return u()}}),K((Ve,ot,Be,yt,at,_t)=>{z(ce,a(J)?`v${a(J)}`:""),z(F,Ve),z(C,ot),z(Ne,Be),Ie(Ze,"id",`${r}-endpoint`),z(mt,yt),z(Kt,at),z(zi,_t)},[()=>n()("settingsDialog.author_info")||"",()=>n()("settingsDialog.author_name")||" Lokuyow",()=>n()("settingsDialog.upload_destination")||"",()=>n()("settingsDialog.media_bottom_mode")||"",()=>n()("settingsDialog.dark_mode")||"",()=>n()("settingsDialog.client_tag_label")||"Client tag"]),fl(Ze,()=>a(k),Ve=>v(k,Ve)),w(W,ee)},$$slots:{footer:!0,default:!0}})}Ue(),l()}var fp=H('<div class="xmark-icon svg-icon svelte-1fu8q0k" aria-label=""></div>'),gp=H('<img class="profile-image svelte-1fu8q0k"/>'),pp=H('<div class="profile-image-placeholder svg-icon svelte-1fu8q0k" aria-label="Profile image placeholder"></div>'),vp=H('<div class="profile-info-row svelte-1fu8q0k"><div class="profile-info-content svelte-1fu8q0k"><span class="profile-info-text svelte-1fu8q0k"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-1fu8q0k" aria-label="Copy npub"></div></button></div></div>'),mp=H('<div class="profile-info-row svelte-1fu8q0k"><div class="profile-info-content svelte-1fu8q0k"><span class="profile-info-text svelte-1fu8q0k"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-1fu8q0k" aria-label="Copy nprofile"></div></button></div></div>'),yp=H('<div class="profile-info-label svelte-1fu8q0k"> </div> <span class="profile-info-text"><!></span>',1),_p=H('<div class="profile-container svelte-1fu8q0k"><div class="profile-summary svelte-1fu8q0k"><div class="profile-image-container svelte-1fu8q0k"><!></div> <div class="profile-name svelte-1fu8q0k"> </div></div> <div class="nostr-ids svelte-1fu8q0k"><div class="profile-info-label svelte-1fu8q0k"> </div> <div class="profile-info-container svelte-1fu8q0k"><!> <!></div></div> <div class="auth-controls svelte-1fu8q0k"><div class="auth-container svelte-1fu8q0k"><!></div> <!></div></div>'),wp=H('<div class="copy-success-message"> </div>'),bp=H("<!> <!>",1);function Sp(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=pe(e,"show",15,!1),i=pe(e,"isLoggingOut",3,!1);function l(){o(!1),e.onClose?.()}Sr(()=>o(),l,!0);let c=N(()=>$t.value),u=N(()=>lt.value),d=B(We($t.value)),f=B(!1),h=B(0),g=B(0);we(()=>{!i()&&a(c)&&v(d,a(c),!0)});function p(){e.onLogout?.()}async function m(S,T,P){try{await Rs(S,T,navigator,window);const E=Nd(P.clientX,P.clientY);v(h,E.x,!0),v(g,E.y,!0),v(f,!0),setTimeout(()=>{v(f,!1)},1800)}catch(E){console.warn("Copy failed:",E)}}var x=bp(),_=re(x);{const S=E=>{var M=Se(),A=re(M);{const k=(V,J)=>{Le(V,pt(()=>J?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"",children:(q,O)=>{var Q=fp();w(q,Q)},$$slots:{default:!0}}))};be(A,()=>yr,(V,J)=>{J(V,{child:k,$$slots:{child:!0}})})}w(E,M)};let T=N(()=>r()("profileDialog.title")),P=N(()=>r()("profileDialog.npub"));br(_,{onOpenChange:E=>!E&&l(),get title(){return a(T)},get description(){return a(P)},contentClass:"profile-dialog",footerVariant:"close-button",get open(){return o()},set open(E){o(E)},footer:S,children:(E,M)=>{var A=_p(),k=y(A),V=y(k),J=y(V);{var Y=oe=>{var te=gp();K(()=>{Ie(te,"src",a(d).picture),Ie(te,"alt",a(d).name||"Profile")}),w(oe,te)},q=oe=>{var te=pp();w(oe,te)};se(J,oe=>{a(d).picture?oe(Y):oe(q,!1)})}var O=L(V,2),Q=y(O),ge=L(k,2),R=y(ge),I=y(R),ne=L(R,2),U=y(ne);{var W=oe=>{var te=vp(),F=y(te),j=y(F),C=y(j),D=L(j,2);D.__click=$=>m(a(d).npub,"npub",$),K($=>{z(C,a(d).npub),Ie(D,"aria-label",$)},[()=>r()("profileDialog.copy_npub")]),w(oe,te)};se(U,oe=>{a(d).npub&&oe(W)})}var ie=L(U,2);{var ee=oe=>{var te=mp(),F=y(te),j=y(F),C=y(j),D=L(j,2);D.__click=$=>m(a(d).nprofile,"nprofile",$),K($=>{z(C,a(d).nprofile),Ie(D,"aria-label",$)},[()=>r()("profileDialog.copy_nprofile")]),w(oe,te)};se(ie,oe=>{a(d).nprofile&&oe(ee)})}var he=L(ge,2),ve=y(he),ye=y(ve);{var Ce=oe=>{var te=yp(),F=re(te),j=y(F),C=L(F,2),D=y(C);{var $=ae=>{var me=De();K(fe=>z(me,fe),[()=>r()("profileDialog.login_method_nsec")]),w(ae,me)},X=ae=>{var me=Se(),fe=re(me);{var Ee=_e=>{var G=Se(),Z=re(G);{var de=ue=>{var xe=De();K(Ne=>z(xe,Ne),[()=>r()("profileDialog.login_method_nostr_login_connect")]),w(ue,xe)},le=ue=>{var xe=Se(),Ne=re(xe);{var Me=Fe=>{var ct=De();K(ut=>z(ct,ut),[()=>r()("profileDialog.login_method_nostr_login_extension")]),w(Fe,ct)},Ze=Fe=>{var ct=Se(),ut=re(ct);{var mt=Pe=>{var Oe=De();K(Ge=>z(Oe,Ge),[()=>r()("profileDialog.login_method_nostr_login_local")]),w(Pe,Oe)},tt=Pe=>{var Oe=De();K(Ge=>z(Oe,Ge),[()=>r()("profileDialog.login_method_nostr_login_connect")]),w(Pe,Oe)};se(ut,Pe=>{a(u)?.nostrLoginAuthMethod==="local"?Pe(mt):Pe(tt,!1)},!0)}w(Fe,ct)};se(Ne,Fe=>{a(u)?.nostrLoginAuthMethod==="extension"?Fe(Me):Fe(Ze,!1)},!0)}w(ue,xe)};se(Z,ue=>{a(u)?.nostrLoginAuthMethod==="connect"?ue(de):ue(le,!1)})}w(_e,G)};se(fe,_e=>{a(u)?.type==="nostr-login"&&_e(Ee)},!0)}w(ae,me)};se(D,ae=>{a(u)?.type==="nsec"?ae($):ae(X,!1)})}K(ae=>z(j,ae),[()=>r()("profileDialog.login_method")]),w(oe,te)};se(ye,oe=>{(a(u)?.type==="nsec"||a(u)?.type==="nostr-login")&&oe(Ce)})}var ce=L(ve,2);{let oe=N(()=>i()?"loading":"");Le(ce,{onClick:p,get className(){return`logout-btn ${a(oe)??""}`},variant:"danger",shape:"square",get disabled(){return i()},children:(te,F)=>{var j=Se(),C=re(j);{var D=X=>{It(X,{text:!0,showLoader:!0})},$=X=>{var ae=De();K(me=>z(ae,me),[()=>r()("logoutDialog.logout")]),w(X,ae)};se(C,X=>{i()?X(D):X($,!1)})}w(te,j)},$$slots:{default:!0}})}K((oe,te)=>{z(Q,oe),z(I,te)},[()=>a(d).name||r()("profileDialog.anonymous"),()=>r()("profileDialog.npub")]),w(E,A)},$$slots:{footer:!0,default:!0}})}var b=L(_,2);zs(b,{get show(){return a(f)},get x(){return a(h)},get y(){return a(g)},onClose:()=>v(f,!1),children:(S,T)=>{var P=wp(),E=y(P);K(M=>z(E,M),[()=>r()("imageContextMenu.copySuccess")]),w(S,P)},$$slots:{default:!0}}),w(t,x),Ue(),s()}ft(["click"]);var Ep=H('<div><span style="word-break:break-all"> </span></div>'),xp=H('<div><span style="word-break:break-all"> </span></div>'),Pp=H('<div class="toast npub-toast svelte-1179qet"><!> <!></div>'),Cp=H('<div class="xmark-icon svg-icon svelte-1179qet" aria-label=""></div>'),Lp=H('<img src="./icons/nostr-login.svg" alt="nostr-login" class="nostr-login-icon svelte-1179qet"/> <span class="btn-text svelte-1179qet">Nostr Login</span>',1),Tp=H('<!> <div class="divider svelte-1179qet"><span class="svelte-1179qet"> </span></div> <h3 class="svelte-1179qet"> </h3> <form class="svelte-1179qet"><input type="text" name="username" autocomplete="username" style="display: none;" aria-hidden="true"/> <input type="password" placeholder="nsec1" class="secret-input svelte-1179qet" id="secretKey" name="secretKey" autocomplete="current-password" required minlength="63" maxlength="63"/> <div class="dialog-buttons svelte-1179qet"><!> <!></div></form>',1),Ap=H("<!> <!>",1);function Ip(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=pe(e,"show",15,!1),i=pe(e,"secretKey",15),l=pe(e,"isLoadingNostrLogin",3,!1);function c(){o(!1),e.onClose?.()}Sr(()=>o(),c,!0);const u=new li;let d=B(null);we(()=>{i()!==void 0&&(u.setNsec(i()),a(d)&&(i()||a(d).setCustomValidity("")))});let f=N(()=>u.isValid),h=N(()=>u.npub),g=N(()=>u.nprofile);function p(){if(a(d)){const E=a(d).validity,M=a(d).value??"";if(E.valueMissing){a(d).setCustomValidity(r()("loginDialog.secret_required")),a(d).reportValidity();return}if(!M.startsWith("nsec1")){a(d).setCustomValidity(r()("loginDialog.secret_must_start_nsec1")),a(d).reportValidity();return}if(M.length!==63){M.length<63?a(d).setCustomValidity(r()("loginDialog.secret_too_short")):a(d).setCustomValidity(r()("loginDialog.secret_too_long")),a(d).reportValidity();return}if(!a(f)){a(d).setCustomValidity(r()("loginDialog.invalid_secret")),a(d).reportValidity();return}a(d).setCustomValidity("")}e.onSave?.()}function m(){i(""),a(d)&&a(d).setCustomValidity("")}function x(){e.onNostrLogin?.()}function _(E){E.preventDefault(),p()}var b=Ap(),S=re(b);{var T=E=>{var M=Pp(),A=y(M);{var k=Y=>{var q=Ep(),O=y(q),Q=y(O);K(()=>z(Q,a(h))),w(Y,q)};se(A,Y=>{a(h)&&Y(k)})}var V=L(A,2);{var J=Y=>{var q=xp(),O=y(q),Q=y(O);K(()=>z(Q,a(g))),w(Y,q)};se(V,Y=>{a(g)&&Y(J)})}w(E,M)};se(S,E=>{(a(h)||a(g))&&E(T)})}var P=L(S,2);{const E=k=>{var V=Se(),J=re(V);{const Y=(q,O)=>{Le(q,pt(()=>O?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"",children:(ge,R)=>{var I=Cp();w(ge,I)},$$slots:{default:!0}}))};be(J,()=>yr,(q,O)=>{O(q,{child:Y,$$slots:{child:!0}})})}w(k,V)};let M=N(()=>r()("loginDialog.input_secret")),A=N(()=>r()("loginDialog.hint_input_secret"));br(P,{onOpenChange:k=>!k&&c(),get title(){return a(M)},get description(){return a(A)},contentClass:"login-dialog",footerVariant:"close-button",get open(){return o()},set open(k){o(k)},footer:E,children:(k,V)=>{var J=Tp(),Y=re(J);{let ee=N(()=>l()?"loading":"");Le(Y,{variant:"default",shape:"rounded",get className(){return`nostr-login-button ${a(ee)??""}`},onClick:x,get disabled(){return l()},children:(he,ve)=>{var ye=Se(),Ce=re(ye);{var ce=te=>{It(te,{text:!0,showLoader:!0,customClass:"nostr-login-placeholder"})},oe=te=>{var F=Lp();w(te,F)};se(Ce,te=>{l()?te(ce):te(oe,!1)})}w(he,ye)},$$slots:{default:!0}})}var q=L(Y,2),O=y(q),Q=y(O),ge=L(q,2),R=y(ge),I=L(ge,2),ne=L(y(I),2);ne.__keydown=ee=>{ee.key==="Enter"&&p()},ne.__input=()=>{a(d)&&a(d).setCustomValidity("")},st(ne,ee=>v(d,ee),()=>a(d));var U=L(ne,2),W=y(U);Le(W,{variant:"warning",shape:"square",type:"button",onClick:m,className:"clear-btn",children:(ee,he)=>{var ve=De();K(ye=>z(ve,ye),[()=>r()("loginDialog.clear")]),w(ee,ve)},$$slots:{default:!0}});var ie=L(W,2);Le(ie,{variant:"primary",shape:"square",type:"submit",className:"save-btn",children:(ee,he)=>{var ve=De();K(ye=>z(ve,ye),[()=>r()("loginDialog.save")]),w(ee,ve)},$$slots:{default:!0}}),K((ee,he,ve)=>{z(Q,ee),z(R,he),Ie(ne,"title",ve)},[()=>r()("loginDialog.or"),()=>r()("loginDialog.input_secret"),()=>r()("loginDialog.hint_input_secret")]),Je("submit",I,_),gl(ne,i),w(k,J)},$$slots:{footer:!0,default:!0}})}w(t,b),Ue(),s()}ft(["keydown","input"]);var Mp=H('<div class="welcome-content svelte-1ghzzk4"><div class="title-section svelte-1ghzzk4"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-1ghzzk4"/> <h2 class="svelte-1ghzzk4"> </h2></div> <p class="svelte-1ghzzk4"> </p> <pre class="features svelte-1ghzzk4"> </pre></div>');function Dp(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=pe(e,"show",15,!1);function i(){o(!1),e.onClose?.()}Sr(()=>o(),i,!0);{const l=d=>{var f=Se(),h=re(f);{const g=(p,m)=>{Le(p,pt(()=>m?.().props,{variant:"primary",shape:"square",className:"get-started-btn",children:(_,b)=>{var S=De();K(T=>z(S,T),[()=>r()("welcomeDialog.get_started")]),w(_,S)},$$slots:{default:!0}}))};be(h,()=>yr,(p,m)=>{m(p,{child:g,$$slots:{child:!0}})})}w(d,f)};let c=N(()=>r()("welcomeDialog.title")),u=N(()=>r()("welcomeDialog.description"));br(t,{onOpenChange:d=>!d&&i(),get title(){return a(c)},get description(){return a(u)},contentClass:"welcome-dialog",get open(){return o()},set open(d){o(d)},footer:l,children:(d,f)=>{var h=Mp(),g=y(h),p=L(y(g),2),m=y(p),x=L(g,2),_=y(x),b=L(x,2),S=y(b);K((T,P,E)=>{z(m,T),z(_,P),z(S,E)},[()=>r()("welcomeDialog.title"),()=>r()("welcomeDialog.description"),()=>r()("welcomeDialog.features")]),w(d,h)},$$slots:{footer:!0,default:!0}})}Ue(),s()}function Dn(){const t=localStorage.getItem(Ke.DRAFTS);if(!t)return[];try{return JSON.parse(t).sort((r,n)=>n.timestamp-r.timestamp)}catch{return[]}}function kn(t){localStorage.setItem(Ke.DRAFTS,JSON.stringify(t))}function Oi(t,e){const r=document.createElement("div");r.innerHTML=t;const n=r.querySelector("img")!==null,s=r.querySelector("video")!==null,o=e?.some(b=>!b.isPlaceholder&&b.type==="image")??!1,i=e?.some(b=>!b.isPlaceholder&&b.type==="video")??!1,l=n||o,c=s||i,f=(r.textContent||r.innerText||"").split(`
`).filter(b=>b.trim())[0]||"",h=fn(vt)||"en",g=fn(Qe);let p="[]",m="[]";try{p=g("draft.media.image")||(h.startsWith("ja")?"[]":"[Image]"),m=g("draft.media.video")||(h.startsWith("ja")?"[]":"[Video]")}catch{p=h.startsWith("ja")?"[]":"[Image]",m=h.startsWith("ja")?"[]":"[Video]"}const x=[];l&&x.push(p),c&&x.push(m);const _=x.join("");if(f){if(_){const b=`${f} ${_}`;if(b.length>en){const S=en-_.length-2;return S>0?`${f.substring(0,S)} ${_}`:_}return b}return f.length>en?f.substring(0,en)+"":f}if(_)return _;try{return g("draft.no_content")||(h.startsWith("ja")?"()":"(No content)")}catch{return h.startsWith("ja")?"()":"(No content)"}}function Ri(){return`draft_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function kp(t,e){const r=Dn();if(r.length>=ei)return{success:!1,needsConfirmation:!0,drafts:r};const s=[{id:Ri(),content:t,preview:Oi(t,e),timestamp:Date.now(),galleryItems:e&&e.length>0?e:void 0},...r];return kn(s),{success:!0,needsConfirmation:!1,drafts:s}}function Np(t,e){const n=Dn().slice(0,ei-1),o=[{id:Ri(),content:t,preview:Oi(t,e),timestamp:Date.now(),galleryItems:e&&e.length>0?e:void 0},...n];return kn(o),o}function Op(t){const r=Dn().filter(n=>n.id!==t);return kn(r),r}function Rp(){return kn([]),[]}function Fp(t){const e=Date.now(),r=e-t,n=60*1e3,s=60*n,o=24*s,i=fn(vt)||"en",l=fn(Qe),c=new Intl.RelativeTimeFormat(i,{numeric:"auto"});if(r<n)try{return l("draft.time.now")}catch{return i.startsWith("ja")?"":"Now"}else if(r<s){const u=Math.floor(r/n);return i.startsWith("en")?`${u}m ago`:c.format(-u,"minute")}else if(r<o){const u=Math.floor(r/s);return i.startsWith("en")?`${u}h ago`:c.format(-u,"hour")}else{const u=new Date(t),d=365*o;return e-t<d?new Intl.DateTimeFormat(i,{month:"numeric",day:"numeric"}).format(u):new Intl.DateTimeFormat(i,{year:"numeric",month:"numeric",day:"numeric"}).format(u)}}var Hp=H('<div class="xmark-icon svg-icon svelte-y19p5z"></div>'),Up=H('<div class="trash-icon svg-icon svelte-y19p5z"></div> <span class="delete-all-label"> </span>',1),Bp=H('<div class="empty-message svelte-y19p5z"> </div>'),$p=H('<div class="trash-icon svg-icon svelte-y19p5z"></div>'),zp=H('<li class="draft-item svelte-y19p5z"><button type="button" class="draft-content svelte-y19p5z"><span class="draft-preview svelte-y19p5z"> </span> <span class="draft-timestamp svelte-y19p5z"> </span></button> <!></li>'),jp=H('<ul class="draft-list svelte-y19p5z"></ul>'),Wp=H('<div class="dialog-heading-container svelte-y19p5z"><div class="dialog-heading-wrapper svelte-y19p5z"><h3 class="dialog-heading svelte-y19p5z"> </h3> <!></div> <!></div> <div class="draft-list-container svelte-y19p5z"><!></div>',1);function Gp(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=pe(e,"show",15,!1),i=B(We([]));function l(){o(!1),e.onClose?.()}Sr(()=>o(),l,!0),we(()=>{o()&&v(i,Dn(),!0)});function c(f){e.onApplyDraft(f),l()}function u(f){v(i,Op(f),!0)}function d(){v(i,Rp(),!0)}{const f=p=>{var m=Se(),x=re(m);{const _=(b,S)=>{let T=()=>S?.().props;{let P=N(()=>r()("global.close")||"");Le(b,pt(T,{className:"modal-close",variant:"default",shape:"square",get ariaLabel(){return a(P)},children:(E,M)=>{var A=Hp();K(k=>Ie(A,"aria-label",k),[()=>r()("global.close")||""]),w(E,A)},$$slots:{default:!0}}))}};be(x,()=>yr,(b,S)=>{S(b,{child:_,$$slots:{child:!0}})})}w(p,m)};let h=N(()=>r()("draft.list_title")||""),g=N(()=>r()("draft.list_description")||"");br(t,{onOpenChange:p=>!p&&l(),get title(){return a(h)},get description(){return a(g)},contentClass:"draft-list-dialog",footerVariant:"close-button",get open(){return o()},set open(p){o(p)},footer:f,children:(p,m)=>{var x=Wp(),_=re(x),b=y(_),S=y(b),T=y(S),P=L(S,2);{let J=N(()=>r()("draft.info")||"");Ss(P,{side:"bottom",sideOffset:8,get ariaLabel(){return a(J)},children:(Y,q)=>{var O=De();K(Q=>z(O,Q),[()=>r()("draft.info")||""]),w(Y,O)},$$slots:{default:!0}})}var E=L(b,2);{let J=N(()=>r()("draft.delete_all")||"");Le(E,{className:"delete-all-button",variant:"default",shape:"rounded",get ariaLabel(){return a(J)},onClick:d,children:(Y,q)=>{var O=Up(),Q=L(re(O),2),ge=y(Q);K(R=>z(ge,R),[()=>r()("draft.delete_all")||""]),w(Y,O)},$$slots:{default:!0}})}var M=L(_,2),A=y(M);{var k=J=>{var Y=Bp(),q=y(Y);K(O=>z(q,O),[()=>r()("draft.no_drafts")||""]),w(J,Y)},V=J=>{var Y=jp();Ct(Y,21,()=>a(i),q=>q.id,(q,O)=>{var Q=zp(),ge=y(Q);ge.__click=()=>c(a(O));var R=y(ge),I=y(R),ne=L(R,2),U=y(ne),W=L(ge,2);{let ie=N(()=>r()("draft.delete")||"");Le(W,{className:"delete-button",variant:"default",shape:"square",get ariaLabel(){return a(ie)},onClick:()=>u(a(O).id),children:(ee,he)=>{var ve=$p();w(ee,ve)},$$slots:{default:!0}})}K(ie=>{z(I,a(O).preview),z(U,ie)},[()=>Fp(a(O).timestamp)]),w(q,Q)}),w(J,Y)};se(A,J=>{a(i).length===0?J(k):J(V,!1)})}K(J=>z(T,J),[()=>r()("draft.title")||""]),w(p,x)},$$slots:{footer:!0,default:!0}})}Ue(),s()}ft(["click"]);class Ln{static createMergedOptions(e){return{theme:"default",noBanner:!0,methods:"connect, extension, local",perms:"get_public_key,sign_event:1,sign_event:27235",startScreen:"welcome",...e}}static processBunkers(e){return Array.isArray(e)?e.join(","):void 0}static async npubToPubkey(e){try{if(!e)return{success:!1,error:{type:"decode",message:"npub is empty or null"}};const r=Vt.decode(e);return r.type==="npub"?{success:!0,pubkey:r.data}:{success:!1,error:{type:"decode",message:"Invalid npub format"}}}catch(r){return{success:!1,error:{type:"decode",message:"Failed to decode npub",originalError:r}}}}static getCurrentUserFromWindow(e){try{const r=e.nostrLogin;if(r&&r.pubkey)return{pubkey:r.pubkey,npub:r.npub}}catch{return null}return null}static getNostrLoginAuthMethod(e,r){try{const n=r.getItem("__nostrlogin_accounts");if(!n)return;const s=JSON.parse(n);if(!Array.isArray(s))return;const o=s.find(l=>l?.pubkey===e);if(!o||!o.authMethod)return;const i=o.authMethod;return i==="connect"||i==="extension"||i==="local"?i:void 0}catch{return}}}class Vp{constructor(e,r,n){this.console=e,this.getAuthHandler=r,this.isLoggingOut=n}async handleAuthCallback(e,r){const n=this.getAuthHandler();if(!(!n||this.isLoggingOut()))try{if(!e){n({type:"logout"});return}const s=await Ln.npubToPubkey(e);if(!s.success||!s.pubkey){this.console.warn("NostrLogin: Failed to get pubkey from npub",s.error);return}const o=r?.type||"login";n({type:o,pubkey:s.pubkey,npub:e,otpData:r?.otpData})}catch(s){this.console.error("NostrLogin auth callback error:",s)}}}class qp{constructor(e,r,n){this.console=e,this.importNostrLogin=r,this.authHandler=n}async initialize(e){try{const n=(await this.importNostrLogin()).init;if(!n)throw new TypeError("nostr-login: init function is missing");const s=Ln.createMergedOptions(e),o=this.authHandler.handleAuthCallback.bind(this.authHandler),i=s.bunkers!==void 0?Ln.processBunkers(s.bunkers):void 0,l={...s,bunkers:i,startScreen:s.startScreen,onAuth:o};return await Promise.resolve(n(l)),this.console.log("nostr-login"),{success:!0}}catch(r){const n={type:"initialization",message:"Failed to initialize nostr-login",originalError:r};return this.console.error("nostr-login:",r),{success:!1,error:n}}}}class Kp{constructor(e){this.importNostrLogin=e}async launch(e){try{const{launch:r}=await this.importNostrLogin();return await r(e||"welcome"),{success:!0}}catch(r){return{success:!1,error:{type:"launch",message:"Failed to launch nostr-login",originalError:r}}}}}class Xp{constructor(e,r){this.document=e,this.setTimeout=r}logout(e){e(!0);try{const r=new Event("nlLogout");this.document.dispatchEvent(r)}catch(r){console.error("Failed to dispatch nlLogout event:",r)}try{this.setTimeout(()=>{e(!1)},100)}catch(r){console.error("Failed to set logout flag timeout:",r),e(!1)}}setDarkMode(e){try{const r=new CustomEvent("nlDarkMode",{detail:e});this.document.dispatchEvent(r)}catch(r){console.error("Failed to dispatch nlDarkMode event:",r)}}}class Yp{initialized=!1;authHandler=null;isLoggingOutFlag=!1;initPromise=null;resolvedPromise=null;initializer;launcher;eventEmitter;authCallbackHandler;windowObj;documentObj;consoleObj;setTimeoutFn;constructor(e={}){this.windowObj=e.window||(typeof window<"u"?window:{}),this.documentObj=e.document||(typeof window<"u"?window.document:{}),this.consoleObj=e.console||(typeof window<"u"?window.console:{}),this.setTimeoutFn=e.setTimeout||(typeof window<"u"&&window.setTimeout?window.setTimeout.bind(window):(()=>{}));const r=e.importNostrLogin||(()=>At(()=>import("./index.esm-ocKONXP9.js"),[]));this.authCallbackHandler=new Vp(this.consoleObj,()=>this.authHandler,()=>this.isLoggingOutFlag),this.initializer=new qp(this.consoleObj,r,this.authCallbackHandler),this.launcher=new Kp(r),this.eventEmitter=new Xp(this.documentObj,this.setTimeoutFn)}init(e={}){return this.initPromise!==null?this.initPromise:this.initialized?this.resolvedPromise:(this.initPromise=new Promise((r,n)=>{this.initializer.initialize(e).then(s=>{if(s.success)this.initialized=!0,this.resolvedPromise=this.initPromise,r();else{this._resetInitializationState();const o=s.error?.message||"Initialization failed",i=s.error?.originalError;i instanceof Error?n(i):n(new Error(o))}}).catch(s=>{this._resetInitializationState(),n(s)})}),this.initPromise)}_resetInitializationState(){this.initialized=!1,this.initPromise=null,this.resolvedPromise=null}setAuthHandler(e){this.authHandler=e}async showLogin(e){if(!this._ensureInitialized())throw new Error("nostr-login is not initialized");const r=await this.launcher.launch(e);if(!r.success)throw r.error?.originalError instanceof Error?r.error.originalError:new Error(r.error?.message||"Failed to launch login")}logout(){try{if(!this._ensureInitialized())return;this.eventEmitter.logout(e=>{this.isLoggingOutFlag=e})}catch(e){this.consoleObj.error("NostrLogin logout error:",e)}}setDarkMode(e){this._ensureInitialized()&&this.eventEmitter.setDarkMode(e)}getCurrentUser(){return this.initialized?Ln.getCurrentUserFromWindow(this.windowObj):null}_ensureInitialized(){return this.initialized?!0:(this.consoleObj.warn("nostr-login"),!1)}get isInitialized(){return this.initialized}getInitializer(){return this.initializer}getLauncher(){return this.launcher}getEventEmitter(){return this.eventEmitter}getAuthCallbackHandler(){return this.authCallbackHandler}}const _a=new Yp;class Tn{static isValidSecretKey(e,r){return r.isValidNsec(e)}static hasRequiredPubkey(e){return e.type!=="logout"&&!!e.pubkey}static isLogoutAuth(e){return e.type==="logout"}}class Qp{constructor(e,r,n){this.keyManager=e,this.setNsecAuth=r,this.console=n}async authenticate(e){if(!Tn.isValidSecretKey(e,this.keyManager))return{success:!1,error:"invalid_secret"};const{success:r}=this.keyManager.saveToStorage(e);if(!r)return{success:!1,error:"error_saving"};try{const n=this.keyManager.derivePublicKey(e);return n.hex?(this.setNsecAuth(n.hex,n.npub,n.nprofile),{success:!0,pubkeyHex:n.hex}):{success:!1,error:"derivation_failed"}}catch(n){return this.console.error("nsec:",n),{success:!1,error:"authentication_error"}}}}class Zp{constructor(e,r){this.publicKeyState=e,this.console=r}async authenticate(e){if(Tn.isLogoutAuth(e))return{success:!0};if(!Tn.hasRequiredPubkey(e))return this.console.warn("NostrLoginAuth: pubkey is required for login/signup"),{success:!1,error:"missing_pubkey"};try{return this.publicKeyState.setNostrLoginAuth(e),{success:!0,pubkeyHex:e.pubkey}}catch(r){return this.console.error("nostr-login:",r),{success:!1,error:"nostr_login_error"}}}}class Jp{constructor(e){this.window=e,this.checker=new ii(e)}checker;async waitForExternalAuth(e=5e3){const r=Date.now(),n=100;return new Promise(s=>{const o=()=>{if(this.checker.isWindowNostrAvailable()){s(!0);return}if(Date.now()-r>=e){s(!1);return}setTimeout(o,n)};o()})}}class ev{constructor(e,r){this.navigator=e,this.console=r}async clearProfileImageCache(){try{if(!this.hasServiceWorker())return;const e=new MessageChannel;return new Promise((r,n)=>{e.port1.onmessage=s=>{s.data.success?(this.console.log(""),r()):(this.console.error(":",s.data.error),n(new Error(s.data.error)))},this.navigator.serviceWorker.controller?this.navigator.serviceWorker.controller.postMessage({action:"clearProfileCache"},[e.port2]):n(new Error("Service worker controller is null."))})}catch(e){this.console.error(":",e)}}hasServiceWorker(){return"serviceWorker"in this.navigator&&!!this.navigator.serviceWorker.controller}}class tv{constructor(e){this.localStorage=e}getStoredNostrLoginData(){try{const e=this.localStorage.getItem("__nostrlogin_nip46");if(!e)return null;const r=JSON.parse(e);return r?.pubkey?{pubkey:r.pubkey,npub:r.npub}:null}catch{return null}}}class rv{constructor(e,r,n,s,o,i,l){this.keyManager=e,this.publicKeyState=r,this.nostrLoginManager=n,this.externalAuthWaiter=s,this.storageManager=o,this.setNsecAuth=i,this.console=l}async initialize(e){try{const r=await this.checkNsecAuth();if(r.hasAuth)return r;await this.externalAuthWaiter.waitForExternalAuth(100);const n=await this.checkNostrLoginAuth(e);if(n.hasAuth)return n}catch(r){this.console.error("nostr-login:",r)}return{hasAuth:!1}}async checkNsecAuth(){const e=this.keyManager.loadFromStorage();if(!e)return{hasAuth:!1};this.publicKeyState.setNsec(e);try{const r=this.keyManager.derivePublicKey(e);return r.hex?(this.setNsecAuth(r.hex,r.npub,r.nprofile),{hasAuth:!0,pubkeyHex:r.hex,isNostrLogin:!1}):(this.keyManager.saveToStorage(""),{hasAuth:!1})}catch{return this.keyManager.saveToStorage(""),{hasAuth:!1}}}async checkNostrLoginAuth(e){await this.nostrLoginManager.init(e),await new Promise(s=>setTimeout(s,100));const r=this.nostrLoginManager.getCurrentUser();if(r?.pubkey)return this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:r.pubkey,npub:r.npub}),{hasAuth:!0,pubkeyHex:r.pubkey,isNostrLogin:!0};const n=this.storageManager.getStoredNostrLoginData();return n?.pubkey?(this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:n.pubkey,npub:n.npub}),{hasAuth:!0,pubkeyHex:n.pubkey,isNostrLogin:!0}):{hasAuth:!1}}}class nv{publicKeyState;nsecAuthenticator;nostrLoginAuthenticator;profileCacheCleaner;authInitializer;nostrLoginMgr;keyManager;nostrLoginOptions={theme:"default",noBanner:!0,methods:"connect, extension, local"};constructor(e={}){const r=e.localStorage||(typeof window<"u"?window.localStorage:{}),n=e.keyManager||new ci({secretKeyStore:e.secretKeyStore||ju,setNostrLoginAuthFn:e.setNostrLoginAuth||go,clearAuthStateFn:e.clearAuthState||fo,localStorage:r}),s=e.window||(typeof window<"u"?window:{}),o=e.navigator||(typeof window<"u"?window.navigator:{}),i=e.console||(typeof window<"u"?window.console:{}),l=e.setNsecAuth||$u;this.nostrLoginMgr=e.nostrLoginManager||_a,this.publicKeyState=new li({setNostrLoginAuthFn:e.setNostrLoginAuth||go,clearAuthStateFn:e.clearAuthState||fo,localStorage:r}),this.nsecAuthenticator=new Qp(n,l,i),this.nostrLoginAuthenticator=new Zp(this.publicKeyState,i),this.profileCacheCleaner=new ev(o,i);const c=new Jp(s),u=new tv(r);this.authInitializer=new rv(n,this.publicKeyState,this.nostrLoginMgr,c,u,l,i),this.keyManager=n}async authenticateWithNsec(e){return await this.nsecAuthenticator.authenticate(e)}async authenticateWithNostrLogin(e){return Tn.isLogoutAuth(e)?(this.logout(),{success:!0}):await this.nostrLoginAuthenticator.authenticate(e)}async showNostrLoginDialog(){const e=_a;if(!e.isInitialized)throw new Error("nostr-login is not initialized");try{await e.showLogin()}catch(r){if(!(r instanceof Error&&r.message==="Cancelled"))throw console.error("nostr-login:",r),r}}logout(){try{if(this.publicKeyState.currentIsNostrLogin&&this.nostrLoginMgr.isInitialized)try{this.nostrLoginMgr.logout()}catch(e){console.error("nostr-login:",e)}try{const e=localStorage.getItem("firstVisit");localStorage.clear(),e&&localStorage.setItem("firstVisit",e)}catch(e){console.error(":",e)}this.profileCacheCleaner.clearProfileImageCache().catch(e=>{console.error(":",e)}),setTimeout(()=>{try{typeof window<"u"&&window.location&&typeof window.location.replace=="function"?window.location.replace(window.location.pathname):typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(e){console.error(":",e)}},500)}catch(e){console.error(":",e),setTimeout(()=>{try{typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(r){console.error(":",r)}},2e3)}}async initializeAuth(){return await this.authInitializer.initialize(this.nostrLoginOptions)}getPublicKeyState(){return this.publicKeyState}setNostrLoginHandler(e){this.nostrLoginMgr.setAuthHandler(e)}markAuthInitialized(){zu()}getNsecAuthenticator(){return this.nsecAuthenticator}getNostrLoginAuthenticator(){return this.nostrLoginAuthenticator}getProfileCacheCleaner(){return this.profileCacheCleaner}getAuthInitializer(){return this.authInitializer}}const Bt=new nv;var sv=H('<div><div class="balloon-message svelte-kfz10i"> </div></div>');function ov(t,e){let r=pe(e,"type",3,"success"),n=pe(e,"message",3,"");var s=sv(),o=y(s),i=y(o);K(()=>{Et(s,1,`balloon-message-wrapper ${r()??""}`,"svelte-kfz10i"),z(i,n())}),w(t,s)}class Fi{constructor(e){this.$_=e}showTimeout=null;lastMessageTime=0;debounceDelay=500;getRandomInfoMessage(){const e=Eu,r=Math.floor(Math.random()*e.length);return this.$_(e[r])??""}getRandomSuccessMessage(){const e=xu,r=Math.floor(Math.random()*e.length);return this.$_(e[r])??""}getErrorMessage(){return this.$_(Pu)??""}createMessage(e,r,n=!1){const s=Date.now();if(!n&&s-this.lastMessageTime<this.debounceDelay)return{type:e,message:""};this.lastMessageTime=s;let o=r;if(!o)switch(e){case"info":o=this.getRandomInfoMessage();break;case"success":o=this.getRandomSuccessMessage();break;case"error":o=this.getErrorMessage();break;default:o=""}return{type:e,message:o}}scheduleHide(e,r=3e3){this.showTimeout&&clearTimeout(this.showTimeout),this.showTimeout=setTimeout(e,r)}cancelScheduledHide(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}createErrorMessage(e){switch(e){case"post_timeout":return{type:"warning",message:this.$_(Lu)??""};case"post_rejected":return{type:"error",message:this.$_(Cu)??""};case"post_network_error":return{type:"error",message:this.$_(Tu)??""};default:return{type:"error",message:this.getErrorMessage()}}}createMessageImmediate(e,r){return this.createMessage(e,r,!0)}dispose(){this.cancelScheduledHide(),this.lastMessageTime=0}}var av=H('<div class="trash-icon svg-icon svelte-1dq5yfg"></div>'),iv=H("<!> <!>",1),lv=H('<div class="list-icon svg-icon svelte-1dq5yfg"></div>'),cv=H("<!> <!>",1),uv=H('<div class="floppy-disk-icon svg-icon svelte-1dq5yfg"></div>'),dv=H("<!> <!>",1),hv=H('<div class="copy-success-message"> </div>'),fv=H('<div class="header-container svelte-1dq5yfg"><div class="header-left svelte-1dq5yfg"><a href="https://lokuyow.github.io/ehagaki/" class="site-icon-link svelte-1dq5yfg" aria-label="ehagaki"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-1dq5yfg"/></a> <!></div> <div class="post-actions svelte-1dq5yfg"><div class="buttons-container svelte-1dq5yfg"><!> <!> <!></div></div></div>  <label id="vibrateSwitch" style="display: none;" aria-hidden="true"><input type="checkbox" checked/></label> <!>',1);function gv(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=pe(e,"balloonMessage",3,null),i=B(!1),l=B(0),c=B(0);function u(U){if(e.onSaveDraft()){const ee=U.currentTarget.getBoundingClientRect();v(l,ee.left+ee.width/2),v(c,ee.bottom+8),v(i,!0),setTimeout(()=>{v(i,!1)},2e3)}}let d=null;we(()=>{r()&&!d&&(d=new Fi(r()))});let f=N(()=>Re.postStatus),h=N(()=>Re.isUploading),g=N(()=>Re.canPost),p=B(null),m=B(!1);function x(){d&&!a(m)&&(v(p,d.createMessage("success"),!0),v(m,!0),d.scheduleHide(()=>{v(p,null),v(m,!1),kt({...Re.postStatus,success:!1,message:"",completed:!1})},3e3))}we(()=>{a(f).success&&a(f).completed&&!a(p)&&!a(m)&&x()}),we(()=>{(!a(f).success||!a(f).completed)&&(a(p)||a(m))&&(v(p,null),v(m,!1),d&&d.cancelScheduledHide())});let _=N(()=>a(f).error&&d!==null?d.createErrorMessage(a(f).message):null),b=B(null);const S=$s();let T=B(null);we(()=>{if(typeof window<"u"&&d){const U=new URLSearchParams(window.location.search),W=U.get("error");if(W&&U.get("shared")==="true"){if(["processing-error","no-image","upload-failed","network-error","client-error"].includes(W)){setTimeout(()=>{const he=new URL(window.location.href);he.searchParams.delete("error"),he.searchParams.delete("shared"),window.history.replaceState({},"",he.toString())},1e3);return}let ee="";switch(W){case"messaging-error":ee="Service Worker";break;case"window-error":ee="";break;default:setTimeout(()=>{const he=new URL(window.location.href);he.searchParams.delete("error"),he.searchParams.delete("shared"),window.history.replaceState({},"",he.toString())},1e3);return}v(T,{type:"error",message:ee},!0),setTimeout(()=>{const he=new URL(window.location.href);he.searchParams.delete("error"),he.searchParams.delete("shared"),window.history.replaceState({},"",he.toString()),setTimeout(()=>{v(T,null)},5e3)},1e3)}}}),S&&(window.showInfoBalloonDebug=U=>{v(b,{type:"info",message:U},!0)},window.hideInfoBalloonDebug=()=>{v(b,null)});let P=N(()=>a(T)||(S?a(b)||o()||a(_)||a(p):o()||a(_)||a(p)));we(()=>()=>{d&&d.dispose()});let E=B(void 0);we(()=>{a(E)&&a(E).setAttribute("switch","")});var M=fv(),A=re(M),k=y(A),V=L(y(k),2);{var J=U=>{ov(U,{get type(){return a(P).type},get message(){return a(P).message}})};se(V,U=>{a(P)&&U(J)})}var Y=L(k,2),q=y(Y),O=y(q);be(O,()=>er,(U,W)=>{W(U,{delayDuration:500,children:(ie,ee)=>{var he=iv(),ve=re(he);{const Ce=(ce,oe)=>{let te=()=>oe?.().props;const F=N(()=>{const{onclick:j,...C}=te();return{tooltipOnclick:j,restProps:C}});{let j=N(()=>!a(g)||a(f).sending||a(h)),C=N(()=>r()("postComponent.clear_editor"));Le(ce,pt({variant:"header",shape:"square",className:"clear-button",get disabled(){return a(j)},onClick:D=>{e.onResetPostContent(),typeof a(F).tooltipOnclick=="function"&&a(F).tooltipOnclick(D)},get ariaLabel(){return a(C)}},()=>a(F).restProps,{children:(D,$)=>{var X=av();w(D,X)},$$slots:{default:!0}}))}};be(ve,()=>tr,(ce,oe)=>{oe(ce,{child:Ce,$$slots:{child:!0}})})}var ye=L(ve,2);be(ye,()=>Ot,(Ce,ce)=>{ce(Ce,{children:(oe,te)=>{var F=Se(),j=re(F);be(j,()=>rr,(C,D)=>{D(C,{sideOffset:8,class:"tooltip-content",children:($,X)=>{var ae=De();K(me=>z(ae,me),[()=>r()("postComponent.clear_editor")]),w($,ae)},$$slots:{default:!0}})}),w(oe,F)},$$slots:{default:!0}})}),w(ie,he)},$$slots:{default:!0}})});var Q=L(O,2);be(Q,()=>er,(U,W)=>{W(U,{delayDuration:500,children:(ie,ee)=>{var he=cv(),ve=re(he);{const Ce=(ce,oe)=>{let te=()=>oe?.().props;const F=N(()=>{const{onclick:j,...C}=te();return{tooltipOnclick:j,restProps:C}});{let j=N(()=>r()("draft.list_title")||"");Le(ce,pt({variant:"header",shape:"square",className:"draft-list-button",onClick:C=>{e.onShowDraftList(),typeof a(F).tooltipOnclick=="function"&&a(F).tooltipOnclick(C)},get ariaLabel(){return a(j)}},()=>a(F).restProps,{children:(C,D)=>{var $=lv();w(C,$)},$$slots:{default:!0}}))}};be(ve,()=>tr,(ce,oe)=>{oe(ce,{child:Ce,$$slots:{child:!0}})})}var ye=L(ve,2);be(ye,()=>Ot,(Ce,ce)=>{ce(Ce,{children:(oe,te)=>{var F=Se(),j=re(F);be(j,()=>rr,(C,D)=>{D(C,{sideOffset:8,class:"tooltip-content",children:($,X)=>{var ae=De();K(me=>z(ae,me),[()=>r()("draft.list_title")||""]),w($,ae)},$$slots:{default:!0}})}),w(oe,F)},$$slots:{default:!0}})}),w(ie,he)},$$slots:{default:!0}})});var ge=L(Q,2);be(ge,()=>er,(U,W)=>{W(U,{delayDuration:500,children:(ie,ee)=>{var he=dv(),ve=re(he);{const Ce=(ce,oe)=>{let te=()=>oe?.().props;const F=N(()=>{const{onclick:j,...C}=te();return{tooltipOnclick:j,restProps:C}});{let j=N(()=>!a(g)||a(f).sending||a(h)),C=N(()=>r()("draft.save")||"");Le(ce,pt({variant:"header",shape:"square",className:"draft-save-button",get disabled(){return a(j)},onClick:D=>{u(D),typeof a(F).tooltipOnclick=="function"&&a(F).tooltipOnclick(D)},get ariaLabel(){return a(C)}},()=>a(F).restProps,{children:(D,$)=>{var X=uv();w(D,X)},$$slots:{default:!0}}))}};be(ve,()=>tr,(ce,oe)=>{oe(ce,{child:Ce,$$slots:{child:!0}})})}var ye=L(ve,2);be(ye,()=>Ot,(Ce,ce)=>{ce(Ce,{children:(oe,te)=>{var F=Se(),j=re(F);be(j,()=>rr,(C,D)=>{D(C,{sideOffset:8,class:"tooltip-content",children:($,X)=>{var ae=De();K(me=>z(ae,me),[()=>r()("draft.save")||""]),w($,ae)},$$slots:{default:!0}})}),w(oe,F)},$$slots:{default:!0}})}),w(ie,he)},$$slots:{default:!0}})});var R=L(A,2),I=y(R);st(I,U=>v(E,U),()=>a(E));var ne=L(R,2);zs(ne,{get show(){return a(i)},get x(){return a(l)},get y(){return a(c)},onClose:()=>v(i,!1),children:(U,W)=>{var ie=hv(),ee=y(ie);K(he=>z(ee,he),[()=>r()("draft.saved")]),w(U,ie)},$$slots:{default:!0}}),w(t,M),Ue(),s()}var pv=H('<li class="svelte-1ldno5o"> </li>'),vv=H('<button type="button" class="floating-dev-console-log svelte-1ldno5o" title="" aria-label=""><ul class="svelte-1ldno5o"></ul></button>'),mv=H('<div class="shared-media-error svelte-1ldno5o"><div class="error-text svelte-1ldno5o"> </div></div>'),yv=H('<div class="stop-icon svg-icon"></div>'),_v=H('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> </div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),wv=H('<div class="stop-icon svg-icon"></div>'),bv=H('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> </div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),Sv=H('<div class="stop-icon svg-icon"></div>'),Ev=H('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> <!> <!></div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),xv=H('<div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> <!> <!></div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div>'),Pv=H(" <br/> <!>",1),Cv=H('<div class="image-size-info svelte-1ldno5o"><div class="size-label svelte-1ldno5o"> </div> <div class="size-details svelte-1ldno5o"><!></div></div>'),Lv=H('<!> <div class="footer-center svelte-1ldno5o"><!></div>',1);function Tv(t,e){He(e,!0);const r=()=>je(Bs,"$devLog",s),n=()=>je(Qe,"$_",s),[s,o]=et();let i=B(!1),l=B(null);we(()=>{if(typeof window<"u"){const U=new URLSearchParams(window.location.search),W=U.get("error");if(W&&U.get("shared")==="true"){const ie=()=>{const ee=localStorage.getItem("sharedMediaProcessed")==="1",ye=!new URLSearchParams(window.location.search).get("error");return ee||ye};if(ie()){console.log("Shared image was processed successfully, ignoring error parameter");return}setTimeout(()=>{if(ie()){console.log("Shared image processing detected after delay, not showing error");return}let ee="";switch(W){case"processing-error":ee="";break;case"no-image":ee="";break;case"upload-failed":ee="";break;case"network-error":ee="";break;case"client-error":ee="";break;default:return}v(l,ee,!0),setTimeout(()=>{const he=new URL(window.location.href);he.searchParams.delete("error"),he.searchParams.delete("shared"),window.history.replaceState({},"",he.toString()),setTimeout(()=>{v(l,null)},5e3)},1e3)},100)}}});async function c(U){try{U?.preventDefault()}catch{}try{const W=[...r()].reverse();await qf(W),(W?.length??0)>0&&(v(i,!0),setTimeout(()=>v(i,!1),1500))}catch(W){console.warn("dev log copy failed:",W)}}let u=pe(e,"uploadProgress",31,()=>We({total:0,completed:0,failed:0,aborted:0,inProgress:!1})),d=N(()=>Fr.value),f=N(()=>Hr.value),h=B(null),g=B(0),p=null;we(()=>{a(d)>0&&a(d)<100||a(f)>0&&a(f)<100?a(h)||(v(h,Date.now(),!0),V({imageSizeInfoOnly:!0}),p=window.setInterval(()=>{a(h)&&v(g,Math.floor((Date.now()-a(h))/1e3),!0)},1e3)):(p!==null&&(clearInterval(p),p=null),v(h,null),v(g,0))});let m=N(()=>dr.value.info),x=N(()=>dr.value.visible),_=B(!1);we(()=>{u().inProgress&&!a(_)&&V({imageSizeInfoOnly:!0}),v(_,u().inProgress,!0)});function b(U){if(U<60)return`${U}s`;const W=Math.floor(U/60),ie=U%60;return`${W}m ${ie}s`}function S(){Fr.set(0),Hr.set(0),p!==null&&(clearInterval(p),p=null),v(h,null),v(g,0),u({total:0,completed:0,failed:0,aborted:0,inProgress:!1});const W=Us.value;W&&bi(W,!1),Yu()}function T(){S()}function P(){S()}function E(U){if(!U)return"";const W=U.match(/\.([a-zA-Z0-9]+)$/);if(!W)return"";const ie=W[1].toUpperCase();return ie==="JPEG"?"JPG":ie}function M(){return typeof window>"u"?"medium":localStorage.getItem("videoCompressionLevel")||"medium"}function A(U){switch(U){case"none":return n()("settingsDialog.quality_lossless");case"low":return n()("footerInfoDisplay.videoQualityLevel.high");case"medium":return n()("footerInfoDisplay.videoQualityLevel.medium");case"high":return n()("footerInfoDisplay.videoQualityLevel.low");default:return n()("footerInfoDisplay.videoQualityLevel.medium")}}function k(U){u(U),!U.inProgress&&U.total>0&&setTimeout(()=>{u({total:0,completed:0,failed:0,aborted:0,inProgress:!1})},1e3)}function V(U){if(U?.imageSizeInfoOnly){dr.set({info:null,visible:!1});return}u({total:0,completed:0,failed:0,aborted:0,inProgress:!1}),Fr.set(0),Hr.set(0),p!==null&&(clearInterval(p),p=null),v(h,null),v(g,0),dr.set({info:null,visible:!1}),v(l,null)}let J=N(()=>a(l)!==null||a(f)>0&&a(f)<100||a(d)>0&&a(d)<100||u().inProgress||u().total>0||a(x)&&a(m)!==null);var Y={updateProgress:k,reset:V},q=Lv(),O=re(q);{var Q=U=>{var W=vv();W.__click=c,W.__touchend=c;var ie=y(W);Ct(ie,5,()=>[...r()].reverse(),Jt,(ee,he)=>{var ve=pv(),ye=y(ve);K(()=>z(ye,a(he))),w(ee,ve)}),w(U,W)};se(O,U=>{$s()&&r().length&&U(Q)})}var ge=L(O,2),R=y(ge);{var I=U=>{var W=Se(),ie=re(W);{var ee=ve=>{var ye=mv(),Ce=y(ye),ce=y(Ce);K(()=>z(ce,a(l))),w(ve,ye)},he=ve=>{var ye=Se(),Ce=re(ye);{var ce=te=>{var F=_v(),j=y(F);Le(j,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"",onClick:P,children:(me,fe)=>{var Ee=yv();w(me,Ee)},$$slots:{default:!0}});var C=L(j,2),D=y(C),$=y(D),X=L(D,2),ae=y(X);K((me,fe)=>{z($,`${me??""}: ${a(f)??""}%
                        (${fe??""})`),Lt(ae,`width: ${a(f)??""}%`)},[()=>n()("imageCompression.compressing"),()=>b(a(g))]),w(te,F)},oe=te=>{var F=Se(),j=re(F);{var C=$=>{var X=bv(),ae=y(X);Le(ae,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"",onClick:T,children:(Z,de)=>{var le=wv();w(Z,le)},$$slots:{default:!0}});var me=L(ae,2),fe=y(me),Ee=y(fe),_e=L(fe,2),G=y(_e);K((Z,de,le)=>{z(Ee,`${Z??""}${de??""}: ${a(d)??""}%
                        (${le??""})`),Lt(G,`width: ${a(d)??""}%`)},[()=>A(M()),()=>n()("videoQualityLabelSuffix"),()=>b(a(g))]),w($,X)},D=$=>{var X=Se(),ae=re(X);{var me=Ee=>{var _e=Se(),G=re(_e);{var Z=le=>{var ue=Ev(),xe=y(ue);Le(xe,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"",onClick:P,children:(Oe,Ge)=>{var rt=Sv();w(Oe,rt)},$$slots:{default:!0}});var Ne=L(xe,2),Me=y(Ne),Ze=y(Me),Fe=L(Ze);{var ct=Oe=>{var Ge=De();K(rt=>z(Ge,`(${rt??""}: ${u().failed??""})`),[()=>n()("footerInfoDisplay.failed")]),w(Oe,Ge)};se(Fe,Oe=>{u().failed>0&&Oe(ct)})}var ut=L(Fe,2);{var mt=Oe=>{var Ge=De();K(rt=>z(Ge,`(${rt??""}: ${u().aborted??""})`),[()=>n()("footerInfoDisplay.aborted")]),w(Oe,Ge)};se(ut,Oe=>{u().aborted>0&&Oe(mt)})}var tt=L(Me,2),Pe=y(tt);K((Oe,Ge)=>{z(Ze,`${Oe??""}: ${u().completed??""}/${u().total??""} `),Lt(Pe,`width: ${Ge??""}%`)},[()=>n()("footerInfoDisplay.uploading"),()=>u().total>0?Math.round(u().completed/u().total*100):0]),w(le,ue)},de=le=>{var ue=xv(),xe=y(ue),Ne=y(xe),Me=L(Ne);{var Ze=tt=>{var Pe=De();K(Oe=>z(Pe,`(${Oe??""}: ${u().failed??""})`),[()=>n()("footerInfoDisplay.failed")]),w(tt,Pe)};se(Me,tt=>{u().failed>0&&tt(Ze)})}var Fe=L(Me,2);{var ct=tt=>{var Pe=De();K(Oe=>z(Pe,`(${Oe??""}: ${u().aborted??""})`),[()=>n()("footerInfoDisplay.aborted")]),w(tt,Pe)};se(Fe,tt=>{u().aborted>0&&tt(ct)})}var ut=L(xe,2),mt=y(ut);K((tt,Pe)=>{z(Ne,`${tt??""}: ${u().completed??""}/${u().total??""} `),Lt(mt,`width: ${Pe??""}%`)},[()=>n()("footerInfoDisplay.uploading"),()=>u().total>0?Math.round(u().completed/u().total*100):0]),w(le,ue)};se(G,le=>{u().inProgress?le(Z):le(de,!1)})}w(Ee,_e)},fe=Ee=>{var _e=Se(),G=re(_e);{var Z=de=>{var le=Cv(),ue=y(le),xe=y(ue),Ne=L(ue,2),Me=y(Ne);{var Ze=Fe=>{var ct=Pv(),ut=re(ct),mt=L(ut,2),tt=L(mt);{var Pe=Ge=>{var rt=De();K(Kt=>z(rt,Kt),[()=>n()("footerInfoDisplay.no_compression")||""]),w(Ge,rt)},Oe=Ge=>{var rt=Se(),Kt=re(rt);{var Er=Mt=>{var Xt=De();K(()=>z(Xt,`${a(m).compressedSize??""}
                            (${a(m).compressionRatio??""}%)`)),w(Mt,Xt)},Nn=Mt=>{var Xt=De();K(()=>z(Xt,`${a(m).compressedSize??""}
                            (${a(m).compressionRatio??""}%)`)),w(Mt,Xt)};se(Kt,Mt=>{a(m).wasCompressed?Mt(Er):Mt(Nn,!1)},!0)}w(Ge,rt)};se(tt,Ge=>{a(m).wasSkipped?Ge(Pe):Ge(Oe,!1)})}K((Ge,rt)=>{z(ut,`${Ge??""}
                        ${a(m).originalSize??""}`),z(mt,`  ${rt??""} `)},[()=>E(a(m).originalFilename),()=>E(a(m).compressedFilename)]),w(Fe,ct)};se(Me,Fe=>{a(m).originalFilename&&a(m).compressedFilename&&Fe(Ze)})}K(Fe=>z(xe,`${Fe??""}:`),[()=>n()("footerInfoDisplay.data_size")]),w(de,le)};se(G,de=>{a(x)&&a(m)&&de(Z)},!0)}w(Ee,_e)};se(ae,Ee=>{u().inProgress||u().total>0?Ee(me):Ee(fe,!1)},!0)}w($,X)};se(j,$=>{a(d)>0&&a(d)<100?$(C):$(D,!1)},!0)}w(te,F)};se(Ce,te=>{a(f)>0&&a(f)<100?te(ce):te(oe,!1)},!0)}w(ve,ye)};se(ie,ve=>{a(l)?ve(ee):ve(he,!1)})}w(U,W)};se(R,U=>{a(J)&&U(I)})}w(t,q);var ne=Ue(Y);return o(),ne}ft(["click","touchend"]);var Av=H("<img/>"),Iv=H('<div class="profile-picture default svg-icon svelte-whjdpq" aria-label="User"></div>'),Mv=H('<div class="update-indicator svelte-whjdpq"></div>'),Dv=H('<div class="settings-icon svg-icon svelte-whjdpq" aria-label="Settings"></div> <!>',1),kv=H('<div class="footer-bar svelte-whjdpq"><!> <!> <!></div>');function Nv(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=N(()=>$t.value),i=N(()=>bt.value),l=N(()=>ur.value),c=B(void 0),u=B(!1);const d=()=>a(o)?.name?a(o).name:a(o)?.npub?a(o).npub:"User";function f(A){console.log(":",A),v(u,!0),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&console.log("Service Worker")}function h(A){if(!A)return!1;try{return new URL(A,location.href).origin===location.origin}catch{return!1}}let g=B(!1);we(()=>{a(o)?.picture?(v(u,!1),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&a(o).picture.includes("profile=true")&&console.log("Service Worker:",a(o).picture),v(g,h(a(o).picture),!0)):v(g,!1)});function p(A){a(c)?.updateProgress(A)}function m(){a(c)?.reset()}var x={isSameOriginPictureUrl:h,updateProgress:p,reset:m},_=kv(),b=y(_);{var S=A=>{Le(A,{shape:"circle",className:"profile-display loading",disabled:!0,children:(k,V)=>{It(k,{showLoader:!0})},$$slots:{default:!0}})},T=A=>{var k=Se(),V=re(k);{var J=q=>{Le(q,{shape:"circle",className:"profile-display loading",disabled:!0,children:(O,Q)=>{It(O,{showLoader:!0})},$$slots:{default:!0}})},Y=q=>{var O=Se(),Q=re(O);{var ge=I=>{{let ne=N(()=>`profile-display${a(i)?" loading":""}`);Le(I,{variant:"default",shape:"circle",get className(){return a(ne)},get disabled(){return a(i)},onClick:()=>{a(i)||e.onOpenLogoutDialog()},children:(U,W)=>{var ie=Se(),ee=re(ie);{var he=ye=>{It(ye,{showLoader:!0})},ve=ye=>{var Ce=Se(),ce=re(Ce);{var oe=F=>{var j=Av();Sa(j,C=>({src:a(o).picture,alt:C,class:"profile-picture",loading:"lazy",...a(g)?{crossorigin:"anonymous",referrerpolicy:"no-referrer"}:{},onerror:f}),[d],void 0,void 0,"svelte-whjdpq"),w(F,j)},te=F=>{var j=Iv();w(F,j)};se(ce,F=>{a(o)?.picture&&!a(u)?F(oe):F(te,!1)},!0)}w(ye,Ce)};se(ee,ye=>{a(i)?ye(he):ye(ve,!1)})}w(U,ie)},$$slots:{default:!0}})}},R=I=>{var ne=Se(),U=re(ne);{var W=ie=>{Le(ie,{className:"login-btn",variant:"primary",shape:"pill",get onClick(){return e.onShowLoginDialog},children:(ee,he)=>{var ve=De();K(ye=>z(ve,ye),[()=>r()("app.login")]),w(ee,ve)},$$slots:{default:!0}})};se(U,ie=>{!a(i)&&!e.isAuthenticated&&ie(W)},!0)}w(I,ne)};se(Q,I=>{e.isAuthenticated&&(a(l)||a(i))?I(ge):I(R,!1)},!0)}w(q,O)};se(V,q=>{e.isAuthenticated&&a(i)?q(J):q(Y,!1)},!0)}w(A,k)};se(b,A=>{e.isAuthInitialized?A(T,!1):A(S)})}var P=L(b,2);st(Tv(P,{}),A=>v(c,A,!0),()=>a(c));var E=L(P,2);{let A=N(()=>e.swNeedRefresh?"has-update":"");Le(E,{variant:"default",shape:"circle",get className(){return`settings-btn ${a(A)??""}`},get onClick(){return e.onOpenSettingsDialog},ariaLabel:"",children:(k,V)=>{var J=Dv(),Y=L(re(J),2);{var q=O=>{var Q=Mv();w(O,Q)};se(Y,O=>{e.swNeedRefresh&&O(q)})}w(k,J)},$$slots:{default:!0}})}w(t,_);var M=Ue(x);return s(),M}const Hi=66,Ov=50,Rv=50,Fv=100;let wa=B(!1);const Hv={get value(){return a(wa)},set:t=>{v(wa,t,!0),typeof document<"u"&&document.documentElement.style.setProperty("--reason-input-height",t?`${Rv}px`:"0px")}};let Ui=B(Hi),Es=B(0);const Uv={get value(){return a(Es)}},Bi={get value(){return a(Ui)}};function Bv(){if(typeof window>"u"||!window.visualViewport)return;let t=null;function e(){t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{const r=window.visualViewport;if(!r)return;const n=r.height+(r.offsetTop||0),s=Math.max(0,window.innerHeight-n),o=s>Fv;v(Ui,o?s:Hi,!0),v(Es,o?s:0,!0);const i=document.documentElement;i.style.setProperty("--keyboard-height",`${a(Es)}px`),i.style.setProperty("--visible-viewport-height",`${r.height}px`)})}return e(),window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e),()=>{window.visualViewport?.removeEventListener("resize",e),window.visualViewport?.removeEventListener("scroll",e),t&&cancelAnimationFrame(t),t=null}}var $v=H('<div class="image-icon svg-icon svelte-hsi6z2"></div>'),zv=H("<!> <!>",1),jv=H('<div class="progress-ring-container svelte-hsi6z2"><svg class="progress-ring svelte-hsi6z2" width="52" height="52" viewBox="-6 -6 52 52" aria-hidden="true"><circle class="progress-ring-bg svelte-hsi6z2" cx="20" cy="20" r="16"></circle><circle class="progress-ring-bar svelte-hsi6z2" cx="20" cy="20" r="16"></circle></svg></div>'),Wv=H('<div class="plane-icon svg-icon svelte-hsi6z2"></div>'),Gv=H("<!> <!>",1),Vv=H('<div class="content-warning-icon svg-icon svelte-hsi6z2"></div>'),qv=H("<!> <!>",1),Kv=H('<div class="thumbtack-icon svg-icon svelte-hsi6z2"></div>'),Xv=H('<div class="thumbtack-slash-icon svg-icon svelte-hsi6z2"></div>'),Yv=H('<div class="hashtag-pin-group svelte-hsi6z2"><div class="hashtag-icon svg-icon svelte-hsi6z2"></div> <!></div>'),Qv=H("<!> <!>",1),Zv=H('<div class="footer-button-bar svelte-hsi6z2"><div class="button-container svelte-hsi6z2"><div class="button-group-left svelte-hsi6z2"><!></div> <div class="button-group-center svelte-hsi6z2"><!> <!></div> <div class="button-group-right svelte-hsi6z2"><!> <!></div></div></div>');function Jv(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=N(()=>lt.value?.isAuthenticated??!1),i=N(()=>Re.postStatus),l=N(()=>Re.isUploading),c=N(()=>Re.canPost),u=B(!1);we(()=>{a(i).sending?v(u,!0):a(u)&&setTimeout(()=>{v(u,!1)},400)});let d=N(()=>sr.value);function f(){sr.toggle(),sr.value||hr.reset()}let h=N(()=>ms.value);function g(){ms.toggle()}let p=N(()=>Bi.value);function m(ce){ce.preventDefault(),Uv.value===0&&document.activeElement?.blur()}we(()=>Bv());const x=350,_=150,b=100.53;let S=B(0),T=B(!1),P=B(!1),E=!1,M=null,A=null,k=0,V=!1,J=0;function Y(){return!a(c)||a(i).sending||a(l)||!a(o)||!!a(i).completed}function q(ce){if(Y())return;A!==null&&(clearTimeout(A),A=null),V=!1,k=performance.now(),v(S,0),J=0,v(T,!0),v(P,!1),E=!0;function oe(te){const F=te-k,j=Math.min(F/x,1);v(S,j,!0);const C=80-j*50;if(te-J>=C&&(Bd(j),J=te),j>=1){V=!0,zd(150),xf(),setTimeout(()=>{v(T,!1),v(S,0),E=!1},200);return}M=requestAnimationFrame(oe)}M=requestAnimationFrame(oe)}function O(){if(V||!a(T))return;$d(),M!==null&&(cancelAnimationFrame(M),M=null);const ce=a(S);A=setTimeout(()=>{A=null;const oe=performance.now(),te=ce*x;function F(j){const C=j-oe,D=te>0?Math.min(C/te,1):1;v(S,ce*(1-D)),D<1?M=requestAnimationFrame(F):(v(S,0),M=null,v(T,!1),E=!1)}te>0?M=requestAnimationFrame(F):(v(S,0),v(T,!1),E=!1)},_)}var Q=Zv(),ge=y(Q);ge.__mousedown=m,ge.__touchstart=m;var R=y(ge),I=y(R);be(I,()=>er,(ce,oe)=>{oe(ce,{delayDuration:500,children:(te,F)=>{var j=zv(),C=re(j);{const $=(X,ae)=>{let me=()=>ae?.().props;const fe=N(()=>{const{onclick:Ee,..._e}=me();return{tooltipOnclick:Ee,restProps:_e}});{let Ee=N(()=>!a(o)||a(i).sending||a(l)),_e=N(()=>r()("postComponent.upload_image"));Le(X,pt({variant:"footer",shape:"square",className:"image-button",get disabled(){return a(Ee)},onClick:G=>{e.onUploadImage?.(),typeof a(fe).tooltipOnclick=="function"&&a(fe).tooltipOnclick(G)},get ariaLabel(){return a(_e)}},()=>a(fe).restProps,{children:(G,Z)=>{var de=$v();w(G,de)},$$slots:{default:!0}}))}};be(C,()=>tr,(X,ae)=>{ae(X,{child:$,$$slots:{child:!0}})})}var D=L(C,2);be(D,()=>Ot,($,X)=>{X($,{children:(ae,me)=>{var fe=Se(),Ee=re(fe);be(Ee,()=>rr,(_e,G)=>{G(_e,{sideOffset:8,class:"tooltip-content",children:(Z,de)=>{var le=De();K(ue=>z(le,ue),[()=>r()("keyboardButtonBar.upload_image_tooltip")]),w(Z,le)},$$slots:{default:!0}})}),w(ae,fe)},$$slots:{default:!0}})}),w(te,j)},$$slots:{default:!0}})});var ne=L(R,2),U=y(ne);{var W=ce=>{var oe=jv(),te=y(oe),F=L(y(te));K(()=>Lt(F,`stroke-dashoffset: ${b*(1-a(S))}px`)),w(ce,oe)};se(U,ce=>{a(T)&&ce(W)})}var ie=L(U,2),ee=()=>a(P),he=ce=>{(!E||!ce)&&v(P,ce,!0)};be(ie,()=>er,(ce,oe)=>{oe(ce,{delayDuration:500,get open(){return ee()},set open(te){he(te)},children:(te,F)=>{var j=Gv(),C=re(j);{const $=(X,ae)=>{let me=()=>ae?.().props;const fe=N(()=>{const{onclick:Ee,onpointerdown:_e,onpointerup:G,onpointerleave:Z,...de}=me();return{_tooltipOnclick:Ee,tooltipPointerDown:_e,tooltipPointerUp:G,tooltipPointerLeave:Z,restProps:de}});{let Ee=N(()=>a(u)?"loading":""),_e=N(()=>!a(c)||a(i).sending||a(l)||!a(o)||a(i).completed),G=N(()=>r()("postComponent.post"));Le(X,pt({variant:"primary",shape:"square",get className(){return`post-button ${a(Ee)??""}`},get disabled(){return a(_e)},get ariaLabel(){return a(G)}},()=>a(fe).restProps,{onpointerdown:Z=>{typeof a(fe).tooltipPointerDown=="function"&&a(fe).tooltipPointerDown(Z),q()},onpointerup:Z=>{typeof a(fe).tooltipPointerUp=="function"&&a(fe).tooltipPointerUp(Z),O()},onpointerleave:Z=>{typeof a(fe).tooltipPointerLeave=="function"&&a(fe).tooltipPointerLeave(Z),O()},onpointercancel:O,oncontextmenu:Z=>Z.preventDefault(),children:(Z,de)=>{var le=Se(),ue=re(le);{var xe=Me=>{It(Me,{showLoader:!0,text:!1,customClass:"post-button-loading"})},Ne=Me=>{var Ze=Wv();w(Me,Ze)};se(ue,Me=>{a(u)?Me(xe):Me(Ne,!1)})}w(Z,le)},$$slots:{default:!0}}))}};be(C,()=>tr,(X,ae)=>{ae(X,{child:$,$$slots:{child:!0}})})}var D=L(C,2);be(D,()=>Ot,($,X)=>{X($,{children:(ae,me)=>{var fe=Se(),Ee=re(fe);be(Ee,()=>rr,(_e,G)=>{G(_e,{sideOffset:8,class:"tooltip-content",children:(Z,de)=>{var le=De();K(ue=>z(le,ue),[()=>r()("keyboardButtonBar.post_tooltip")]),w(Z,le)},$$slots:{default:!0}})}),w(ae,fe)},$$slots:{default:!0}})}),w(te,j)},$$slots:{default:!0}})});var ve=L(ne,2),ye=y(ve);be(ye,()=>er,(ce,oe)=>{oe(ce,{delayDuration:500,children:(te,F)=>{var j=qv(),C=re(j);{const $=(X,ae)=>{let me=()=>ae?.().props;const fe=N(()=>{const{onclick:Ee,..._e}=me();return{tooltipOnclick:Ee,restProps:_e}});{let Ee=N(()=>r()("keyboardButtonBar.content_warning_toggle"));Le(X,pt({variant:"footer",shape:"square",get selected(){return a(d)},onClick:_e=>{f(),typeof a(fe).tooltipOnclick=="function"&&a(fe).tooltipOnclick(_e)},get ariaLabel(){return a(Ee)}},()=>a(fe).restProps,{children:(_e,G)=>{var Z=Vv();w(_e,Z)},$$slots:{default:!0}}))}};be(C,()=>tr,(X,ae)=>{ae(X,{child:$,$$slots:{child:!0}})})}var D=L(C,2);be(D,()=>Ot,($,X)=>{X($,{children:(ae,me)=>{var fe=Se(),Ee=re(fe);be(Ee,()=>rr,(_e,G)=>{G(_e,{sideOffset:8,class:"tooltip-content",children:(Z,de)=>{var le=De();K(ue=>z(le,ue),[()=>r()("keyboardButtonBar.content_warning_tooltip")]),w(Z,le)},$$slots:{default:!0}})}),w(ae,fe)},$$slots:{default:!0}})}),w(te,j)},$$slots:{default:!0}})});var Ce=L(ye,2);be(Ce,()=>er,(ce,oe)=>{oe(ce,{delayDuration:500,children:(te,F)=>{var j=Qv(),C=re(j);{const $=(X,ae)=>{let me=()=>ae?.().props;const fe=N(()=>{const{onclick:Ee,..._e}=me();return{tooltipOnclick:Ee,restProps:_e}});{let Ee=N(()=>r()("keyboardButtonBar.hashtag_pin_toggle"));Le(X,pt({variant:"footer",shape:"square",get selected(){return a(h)},onClick:_e=>{g(),typeof a(fe).tooltipOnclick=="function"&&a(fe).tooltipOnclick(_e)},get ariaLabel(){return a(Ee)}},()=>a(fe).restProps,{children:(_e,G)=>{var Z=Yv(),de=L(y(Z),2);{var le=xe=>{var Ne=Kv();w(xe,Ne)},ue=xe=>{var Ne=Xv();w(xe,Ne)};se(de,xe=>{a(h)?xe(le):xe(ue,!1)})}w(_e,Z)},$$slots:{default:!0}}))}};be(C,()=>tr,(X,ae)=>{ae(X,{child:$,$$slots:{child:!0}})})}var D=L(C,2);be(D,()=>Ot,($,X)=>{X($,{children:(ae,me)=>{var fe=Se(),Ee=re(fe);be(Ee,()=>rr,(_e,G)=>{G(_e,{sideOffset:8,class:"tooltip-content",children:(Z,de)=>{var le=De();K(ue=>z(le,ue),[()=>r()("keyboardButtonBar.hashtag_pin_tooltip")]),w(Z,le)},$$slots:{default:!0}})}),w(ae,fe)},$$slots:{default:!0}})}),w(te,j)},$$slots:{default:!0}})}),K(()=>Lt(Q,`bottom: ${a(p)??""}px;`)),w(t,Q),Ue(),s()}ft(["mousedown","touchstart"]);var em=H('<div class="reason-input-container svelte-7w6hzc"><input id="content-warning-reason-input" type="text" class="reason-input svelte-7w6hzc"/></div>');function tm(t,e){He(e,!0);const r=()=>je(Qe,"$_",n),[n,s]=et();let o=N(()=>sr.value),i=N(()=>hr.value),l=N(()=>a(o));we(()=>{Hv.set(a(l))});let c=N(()=>Bi.value+Ov);function u(g){const p=g.target;hr.set(p.value)}var d=Se(),f=re(d);{var h=g=>{var p=em(),m=y(p);m.__change=u,m.__input=u,K((x,_)=>{Lt(p,`bottom: ${a(c)??""}px;`),Ie(m,"placeholder",x),xa(m,a(i)),Ie(m,"aria-label",_)},[()=>r()("postComponent.content_warning_reason_placeholder"),()=>r()("postComponent.content_warning_reason_label")]),w(g,p)};se(f,g=>{a(l)&&g(h)})}w(t,d),Ue(),s()}ft(["change","input"]);function rm(t,e,r={}){const{hideDelay:n=3e3,debounceMs:s=1e3}=r;let o=null,i=B(!1),l=B(null),c=!1,u=!1,d=0;function f(){!o||a(i)||(v(l,o.createMessage("info"),!0),v(i,!0),o.scheduleHide(()=>{v(i,!1),v(l,null)},n))}function h(){const g=Date.now();if(g-d<s){u=document.visibilityState==="hidden";return}document.visibilityState==="visible"&&u&&e()&&o&&!a(i)&&(f(),d=g),u=document.visibilityState==="hidden"}return we(()=>{const g=t();g&&!o&&(o=new Fi(g))}),we(()=>{e()&&o&&!a(i)&&!c&&(f(),c=!0)}),ir(()=>(u=document.visibilityState==="hidden",document.addEventListener("visibilitychange",h),()=>{document.removeEventListener("visibilitychange",h)})),we(()=>()=>{o?.dispose()}),{get show(){return a(i)},get message(){return a(l)}}}async function $i(t,e,r,n="readonly"){return new Promise(s=>{try{const o=indexedDB.open(t,e);o.onupgradeneeded=i=>{const l=i.target.result;l.objectStoreNames.contains(r)||l.createObjectStore(r,{keyPath:"id"})},o.onerror=()=>s(null),o.onsuccess=i=>{try{const l=i.target.result;if(!l.objectStoreNames.contains(r)){l.close(),s(null);return}const c=l.transaction([r],n),u=c.objectStore(r);s({db:l,transaction:c,store:u})}catch{s(null)}}}catch{s(null)}})}async function nm(t,e,r,n){const s=await $i(t,e,r,"readonly");if(!s)return null;const{db:o,store:i}=s;return new Promise(l=>{const c=i.get(n);c.onsuccess=()=>{o.close(),l(c.result)},c.onerror=()=>{o.close(),l(null)}})}async function sm(t,e,r,n){const s=await $i(t,e,r,"readwrite");if(!s)return!1;const{db:o,store:i}=s;return new Promise(l=>{const c=i.delete(n);c.onsuccess=()=>{o.close(),l(!0)},c.onerror=()=>{o.close(),l(!1)}})}function om(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function js(t,e=Nt.REQUEST_TIMEOUT){if(!navigator.serviceWorker.controller)throw new Error("No ServiceWorker controller available");const r=new MessageChannel,n=om();return new Promise((s,o)=>{const i=setTimeout(()=>{r.port1.close(),o(new Error("ServiceWorker communication timeout"))},e);r.port1.onmessage=l=>{clearTimeout(i),r.port1.close();const{data:c}=l.data||{};s(c)},r.port1.addEventListener("error",l=>{clearTimeout(i),r.port1.close(),o(l)});try{if(navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({...t,requestId:n},[r.port2]);else throw new Error("ServiceWorker controller became unavailable")}catch(l){clearTimeout(i),r.port1.close(),o(l)}})}async function am(){if(!navigator.serviceWorker.controller)return new Promise((t,e)=>{const r=setTimeout(()=>{navigator.serviceWorker.removeEventListener("controllerchange",n),e(new Error("ServiceWorker"))},Nt.REQUEST_TIMEOUT),n=()=>{clearTimeout(r),navigator.serviceWorker.removeEventListener("controllerchange",n),setTimeout(t,Nt.SW_CONTROLLER_WAIT_TIMEOUT)};navigator.serviceWorker.addEventListener("controllerchange",n)})}async function im(){const t=await nm(Nt.INDEXEDDB_NAME,Nt.INDEXEDDB_VERSION,Nt.STORE_NAME,"sharedMediaData");if(t?.data){await sm(Nt.INDEXEDDB_NAME,Nt.INDEXEDDB_VERSION,Nt.STORE_NAME,"sharedMediaData");const e=t.data.images??(t.data.image?[t.data.image]:[]);if(e.length>0){const r=e.map(s=>s.arrayBuffer&&s._isFile?new File([s.arrayBuffer],s.name||"shared-media",{type:s.type||"application/octet-stream"}):s),n=t.data.metadata??t.data.images?.map(s=>({name:s.name,type:s.type,size:s.size}))??[];return{images:r,metadata:n}}}return null}async function lm(){try{const t=await js({action:"getSharedMedia"});return t&&Array.isArray(t.images)&&t.images.length>0?t:null}catch(t){return console.error("Failed to send message to ServiceWorker:",t),null}}async function cm(){try{try{await Promise.race([am(),new Promise((t,e)=>setTimeout(()=>e(new Error("SW controller timeout")),2e3))])}catch(t){console.warn("Service Worker controller not ready, trying alternatives:",t)}try{const t=await lm();if(t)return console.log("Shared media retrieved via ServiceWorker MessageChannel"),t}catch(t){console.warn("Service Worker MessageChannel failed:",t)}try{const t=await im();if(t)return console.log("Shared media retrieved via IndexedDB fallback"),t}catch(t){console.warn("IndexedDB fallback failed:",t)}try{const t=await js({action:"getSharedMediaForce"},1e3),e=t&&Array.isArray(t.images)&&t.images.length>0?t:null;if(e)return console.log("Shared media retrieved via forced Service Worker request"),e}catch(t){console.warn("Forced Service Worker request failed:",t)}return console.log("No shared media found through any method"),null}catch(t){return console.error("Error in getSharedMediaWithFallback:",t),null}}async function um(){if(!("serviceWorker"in navigator))return{isReady:!1,hasController:!1,error:"Service Worker not supported"};const t=await navigator.serviceWorker.getRegistration(),e=!!navigator.serviceWorker.controller;return t?{isReady:t.active!==null,hasController:e}:{isReady:!1,hasController:e,error:"Service Worker not registered"}}async function dm(){try{const t=await js({type:"PING_TEST"},3e3);return console.log("ServiceWorker communication test successful:",t),!0}catch(t){return console.warn("ServiceWorker communication test timeout"),console.error("ServiceWorker communication test error:",t),!1}}class hm{fileUploadManager;isProcessingSharedMedia=!1;constructor(e){this.fileUploadManager=new Mi(e),this.setupServiceWorkerListeners()}setupServiceWorkerListeners(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}handleServiceWorkerMessage(e){const{data:r,type:n}=e.data||{};n==="SHARED_MEDIA"&&r?.images?.length&&$o(r.images,r.metadata)}async checkForSharedMediaOnLaunch(){if(this.isProcessingSharedMedia)return{success:!1,error:""};if(!this.fileUploadManager.checkIfOpenedFromShare())return{success:!1,error:""};this.isProcessingSharedMedia=!0;try{const e=await this.fileUploadManager.processSharedMediaOnLaunch();return e.success&&e.data&&$o(e.data.images,e.data.metadata),e}finally{this.isProcessingSharedMedia=!1}}async getSharedMediaFromServiceWorker(){return await this.fileUploadManager.getSharedMediaFromServiceWorker()}checkIfOpenedFromShare(){return this.fileUploadManager.checkIfOpenedFromShare()}isProcessing(){return this.isProcessingSharedMedia}getSharedMediaFiles(){return cd()}getSharedMediaMetadata(){return ud()}clearSharedMedia(){ld()}}let es=null;function fm(){return es||(es=new hm),es}function ba(){return fm().checkIfOpenedFromShare()}function gm(){if(typeof window>"u"||!window.location)return null;const e=new URLSearchParams(window.location.search).get("content");if(!e)return null;try{const r=decodeURIComponent(e);return yi(r)}catch(r){return console.error("URL:",r),null}}function pm(){if(typeof window>"u"||!window.location)return;const t=new URLSearchParams(window.location.search),e=[];let r=!1;if(t.has("content")){const s=t.get("content");(!s||s.trim()==="")&&(r=!0),t.delete("content"),r=!0}const n=[];if(t.forEach((s,o)=>{e.includes(o)||(n.push(o),r=!0)}),n.forEach(s=>t.delete(s)),r){const s=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",s)}}function vm(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).has("content")}var mm=H('<main class="svelte-1n46o8q"><div class="main-content svelte-1n46o8q"><!> <!></div> <!> <!> <!> <!> <!> <!> <!> <!> <!></main>');function ym(t,e){He(e,!0);const r=()=>je(vt,"$locale",o),n=()=>je(Qe,"$_",o),s=()=>je(Ds,"$swNeedRefresh",o),[o,i]=et();let l=B(""),c=B("");const u=Bt.getPublicKeyState();we(()=>{u.setNsec(a(c))}),we(()=>{Ur.value&&(v(c,""),v(l,""))});let d=N(()=>lt.value?.isAuthenticated??!1),f=N(()=>lt.value?.isInitialized??!1),h=!1,g="";if(!h){const F=localStorage.getItem("nsec"),j=localStorage.getItem("__nostrlogin_nip46");if(!F){if(j)try{const C=JSON.parse(j);C?.pubkey&&(g=C.pubkey)}catch{}}h=!0}let p=B(void 0),m,x=B(!1),_=B(void 0),b=B(void 0),S=B(!1);async function T(F){v(p,ml({verifier:yl}),!0);const j=new Bu(a(p)),C=new vd(a(p),{relayListUpdatedStore:{value:gs.value,set:D=>gs.set(D)}});m=new md(a(p),C,j),id(C),await m.initializeRelays(F)}async function P(F){const j=await Bt.authenticateWithNostrLogin(F);if(!j.success){console.error("nostr-login:",j.error);return}if(j.pubkeyHex){v(x,!0),bt.set(!0),qn();try{await T();const C=await m.initializeForLogin(j.pubkeyHex);C&&($t.set(C),ur.set(!0)),bt.set(!1)}catch(C){console.error("nostr-login:",C),bt.set(!1)}finally{v(x,!1)}}}async function E(){const F=await Bt.authenticateWithNsec(a(c));if(!F.success){v(l,F.error||"authentication_error",!0);return}bt.set(!0),qn(),v(l,"");try{if(F.pubkeyHex){const j=await m.initializeForLogin(F.pubkeyHex);j&&($t.set(j),ur.set(!0)),bt.set(!1)}else bt.set(!1)}catch{bt.set(!1)}}function M(){v(S,!0),Bt.logout(),$t.set({name:"",picture:"",npub:"",nprofile:""}),ur.set(!1),a(_)?.resetPostContent&&a(_).resetPostContent(),ni(),v(c,""),v(l,"")}async function A(){v(x,!0);try{await Bt.showNostrLoginDialog()}catch(F){F instanceof Error&&F.message==="Cancelled"||console.error("nostr-login:",F)}finally{v(x,!1)}}we(()=>{r()&&localStorage.setItem("locale",r())}),we(()=>{const F=lt.value?.pubkey;F&&lt.value?.isAuthenticated&&m&&m.getRelayManager().loadRelayConfigForUI(F)});let k=B(!1);const V=localStorage.getItem("sharedMediaProcessed")==="1";ir(()=>{(async()=>{const j=localStorage.getItem("locale");if(j&&j!==r()&&vt.set(j),await yu(),v(k,!0),Bt.setNostrLoginHandler(P),ba()){const D=await um(),$=await dm();(!D.isReady||!D.hasController||!$)&&console.warn("Service Worker not ready for shared image processing:",D)}if((async()=>{try{const D=await Bt.initializeAuth();if(D.hasAuth&&D.pubkeyHex){await T(D.pubkeyHex);const $=await m.initializeForLogin(D.pubkeyHex);$&&($t.set($),ur.set(!0)),bt.set(!1)}else await T(),bt.set(!1)}catch(D){console.error(":",D),await T(),bt.set(!1)}finally{Bt.markAuthInitialized()}})(),ba()&&!V)try{const D=await cm();if(D?.images?.length)it.files=D.images,it.metadata=D.metadata,it.received=!0,localStorage.setItem("sharedMediaProcessed","1");else{console.warn("No shared media data received");const X=new URLSearchParams(window.location.search).get("error");X&&console.error("Shared image processing failed with error parameter:",{error:X,location:window.location.href})}}catch(D){console.error(":",D)}if(localStorage.getItem("firstVisit")!=="1"&&(Lr.set(!0),localStorage.setItem("firstVisit","1")),vm()){const D=gm();D&&dd(D)}pm()})()}),we(()=>{it.received&&it.files.length>0&&a(_)&&(a(_).uploadFiles(it.files),it.files=[],it.metadata=void 0,it.received=!1,localStorage.setItem("sharedMediaProcessed","1"),setTimeout(()=>localStorage.removeItem("sharedMediaProcessed"),500))}),we(()=>{nr.received&&nr.content&&a(_)&&(a(_).insertTextContent(nr.content),hd())});function J(F){Qu.set(F)}function Y(F){a(b)&&a(b).updateProgress(F)}function q(){a(b)?.reset&&a(b).reset(),localStorage.removeItem("sharedMediaProcessed")}function O(){a(_)?.resetPostContent()}function Q(){if(!a(_)?.getEditorHtml)return!1;const F=a(_).getEditorHtml(),j=ze.getItems().filter(D=>!D.isPlaceholder);if((!F||F==="<p></p>")&&j.length===0)return!1;const C=kp(F,j);return C.needsConfirmation?(rn.set({content:F,galleryItems:j}),cr.set(!0),!1):C.success}function ge(){const F=rn.value;F&&Np(F.content,F.galleryItems),rn.set(null),cr.set(!1)}function R(){rn.set(null),cr.set(!1)}let I=B(!1);we(()=>{v(I,cr.value,!0)}),we(()=>{!a(I)&&cr.value&&cr.set(!1)});function ne(){tn.set(!0)}function U(F){if(!F)return F;const j=document.createElement("div");return j.innerHTML=F,j.querySelectorAll("img").forEach(C=>{const D=C.getAttribute("src");if(!D||C.getAttribute("isPlaceholder")==="true")return;ze.addItem({id:vr(),type:"image",src:D,isPlaceholder:!1,blurhash:C.getAttribute("blurhash")??void 0,alt:C.getAttribute("alt")??void 0,dim:C.getAttribute("dim")??void 0});const $=C.parentElement;$&&$!==j&&$.children.length===1?$.remove():C.remove()}),j.querySelectorAll("video").forEach(C=>{const D=C.getAttribute("src");if(!D||C.getAttribute("isPlaceholder")==="true")return;ze.addItem({id:vr(),type:"video",src:D,isPlaceholder:!1});const $=C.parentElement;$&&$!==j&&$.children.length===1?$.remove():C.remove()}),j.innerHTML}function W(F){if(!xt.value){ze.clearAll(),F.galleryItems&&F.galleryItems.length>0&&F.galleryItems.forEach(D=>ze.addItem(D));const C=U(F.content);a(_)?.loadDraftContent(C)}else a(_)?.loadDraftContent(F.content),F.galleryItems&&F.galleryItems.length>0&&a(_)?.appendMediaToEditor(F.galleryItems)}const ie=rm(()=>n(),()=>a(k));async function ee(){if(!a(d)||!lt.value.pubkey)return;m||await T(lt.value.pubkey);const F=await m.refreshRelaysAndProfile(lt.value.pubkey);F&&($t.set(F),ur.set(!0))}let he=B(We(localStorage.getItem("imageCompressionLevel")||"medium"));function ve(F){v(he,F,!0)}let ye=B(We(localStorage.getItem("uploadEndpoint")||Ts(r())));function Ce(F){v(ye,F,!0)}var ce=Se(),oe=re(ce);{var te=F=>{var j=Se(),C=re(j);be(C,()=>pl,(D,$)=>{$(D,{children:(X,ae)=>{var me=mm(),fe=y(me),Ee=y(fe);{let Pe=N(()=>ie.show&&ie.message?ie.message:null);gv(Ee,{onResetPostContent:O,onSaveDraft:Q,onShowDraftList:ne,get balloonMessage(){return a(Pe)}})}var _e=L(Ee,2);st(Bg(_e,{get rxNostr(){return a(p)},get hasStoredKey(){return a(d)},onPostSuccess:q,onUploadStatusChange:J,onUploadProgress:Y}),Pe=>v(_,Pe,!0),()=>a(_));var G=L(fe,2);tm(G,{});var Z=L(G,2);Jv(Z,{onUploadImage:()=>a(_)?.openFileDialog()});var de=L(Z,2);st(Nv(de,{get isAuthenticated(){return a(d)},get isAuthInitialized(){return a(f)},get swNeedRefresh(){return s()},get onShowLoginDialog(){return Zu},get onOpenSettingsDialog(){return td},get onOpenLogoutDialog(){return Ju}}),Pe=>v(b,Pe,!0),()=>a(b));var le=L(de,2);{var ue=Pe=>{Ip(Pe,{get show(){return Ur.value},get onClose(){return qn},onSave:E,onNostrLogin:A,get isLoadingNostrLogin(){return a(x)},get secretKey(){return a(c)},set secretKey(Oe){v(c,Oe,!0)}})};se(le,Pe=>{Ur.value&&Pe(ue)})}var xe=L(le,2);{var Ne=Pe=>{Sp(Pe,{get show(){return Sn.value},get onClose(){return ed},onLogout:M,get isLoggingOut(){return a(S)}})};se(xe,Pe=>{Sn.value&&Pe(Ne)})}var Me=L(xe,2);{var Ze=Pe=>{Dp(Pe,{get show(){return Lr.value},onClose:()=>Lr.set(!1)})};se(Me,Pe=>{Lr.value&&Pe(Ze)})}var Fe=L(Me,2);{var ct=Pe=>{Gp(Pe,{get show(){return tn.value},onClose:()=>tn.set(!1),onApplyDraft:W})};se(Fe,Pe=>{tn.value&&Pe(ct)})}var ut=L(Fe,2);{var mt=Pe=>{{let Oe=N(()=>n()("common.confirm")),Ge=N(()=>n()("draft.limit_reached")),rt=N(()=>n()("common.ok")),Kt=N(()=>n()("common.cancel"));ki(Pe,{get title(){return a(Oe)},get description(){return a(Ge)},get confirmLabel(){return a(rt)},get cancelLabel(){return a(Kt)},confirmVariant:"danger",onConfirm:ge,onCancel:R,get open(){return a(I)},set open(Er){v(I,Er,!0)}})}};se(ut,Pe=>{a(I)&&Pe(mt)})}var tt=L(ut,2);hp(tt,{get show(){return Ms.value},get onClose(){return rd},onRefreshRelaysAndProfile:ee,get selectedCompression(){return a(he)},onSelectedCompressionChange:ve,get selectedEndpoint(){return a(ye)},onSelectedEndpointChange:Ce,onOpenWelcomeDialog:()=>Lr.set(!0)}),w(X,me)},$$slots:{default:!0}})}),w(F,j)};se(oe,F=>{r()&&a(k)&&F(te)})}w(t,ce),Ue(),i()}Ea(ym,{target:document.getElementById("app")});export{Ht as a,Lm as b,Cm as c,Pm as d,$e as u};
