(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const Nx=!1;var Ed=Array.isArray,GI=Array.prototype.indexOf,Ey=Array.from,qf=Object.defineProperty,wl=Object.getOwnPropertyDescriptor,ZI=Object.getOwnPropertyDescriptors,YI=Object.prototype,JI=Array.prototype,Lx=Object.getPrototypeOf,Qw=Object.isExtensible;const yi=()=>{};function xy(t){for(var e=0;e<t.length;e++)t[e]()}function XI(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}const zr=2,Sy=4,Ay=8,Yl=16,Hs=32,Fa=64,Rx=128,ri=256,Vf=512,rr=1024,si=2048,Go=4096,bi=8192,ja=16384,ky=32768,Au=65536,ev=1<<17,QI=1<<18,ku=1<<19,eO=1<<20,qm=1<<21,_y=1<<22,Sa=1<<23,Aa=Symbol("$state"),tO=Symbol("legacy props"),nO=Symbol(""),Cy=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function rO(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Ty(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function iO(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function sO(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function oO(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function aO(t){throw new Error("https://svelte.dev/e/effect_orphan")}function lO(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function cO(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function uO(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function fO(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function hO(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const xd=1,Sd=2,Px=4,dO=8,pO=16,gO=1,mO=4,yO=8,bO=16,wO=1,vO=2,bn=Symbol(),EO="http://www.w3.org/1999/xhtml",xO="http://www.w3.org/2000/svg",SO="@attach";function AO(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let kO=!1;function Dx(t){return t===this.v}function Bx(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function Hx(t){return!Bx(t,this.v)}let _O=!1,ar=null;function Wf(t){ar=t}function CO(t){return TO().get(t)}function jn(t,e=!1,n){ar={p:ar,c:null,e:null,s:t,x:null,l:null}}function qn(t){var e=ar,n=e.e;if(n!==null){e.e=null;for(var r of n)nS(r)}return t!==void 0&&(e.x=t),ar=e.p,t??{}}function Ux(){return!0}function TO(t){return ar===null&&Ty(),ar.c??=new Map(IO(ar)||void 0)}function IO(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}const OO=new WeakMap;function $O(t){var e=Et;if(e===null)return St.f|=Sa,t;if((e.f&ky)===0){if((e.f&Rx)===0)throw!e.parent&&t instanceof Error&&zx(t),t;e.b.error(t)}else Iy(t,e)}function Iy(t,e){for(;e!==null;){if((e.f&Rx)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t instanceof Error&&zx(t),t}function zx(t){const e=OO.get(t);e&&(qf(t,"message",{value:e.message}),qf(t,"stack",{value:e.stack}))}let Xc=[],Vm=[];function Fx(){var t=Xc;Xc=[],xy(t)}function MO(){var t=Vm;Vm=[],xy(t)}function Ad(t){Xc.length===0&&queueMicrotask(Fx),Xc.push(t)}function NO(){Xc.length>0&&Fx(),Vm.length>0&&MO()}function LO(){for(var t=Et.b;t!==null&&!t.has_pending_snippet();)t=t.parent;return t===null&&rO(),t}function kd(t){var e=zr|si,n=St!==null&&(St.f&zr)!==0?St:null;return Et===null||n!==null&&(n.f&ri)!==0?e|=ri:Et.f|=ku,{ctx:ar,deps:null,effects:null,equals:Dx,f:e,fn:t,reactions:null,rv:0,v:bn,wv:0,parent:n??Et,ac:null}}function RO(t,e){let n=Et;n===null&&iO();var r=n.b,i=void 0,s=Tl(bn),o=null,a=!St;return GO(()=>{try{var l=t();o&&Promise.resolve(l).catch(()=>{})}catch(d){l=Promise.reject(d)}var c=()=>l;i=o?.then(c,c)??Promise.resolve(l),o=i;var u=Ht,f=r.pending;a&&(r.update_pending_count(1),f||u.increment());const h=(d,p=void 0)=>{o=null,f||u.activate(),p?p!==Cy&&(s.f|=Sa,Qc(s,p)):((s.f&Sa)!==0&&(s.f^=Sa),Qc(s,d)),a&&(r.update_pending_count(-1),f||u.decrement()),Kx()};if(i.then(h,d=>h(null,d||"unknown")),u)return()=>{queueMicrotask(()=>u.neuter())}}),new Promise(l=>{function c(u){function f(){u===i?l(s):c(i)}u.then(f,f)}c(i)})}function It(t){const e=kd(t);return lS(e),e}function jx(t){const e=kd(t);return e.equals=Hx,e}function qx(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Mr(e[n])}}function PO(t){for(var e=t.parent;e!==null;){if((e.f&zr)===0)return e;e=e.parent}return null}function Oy(t){var e,n=Et;zo(PO(t));try{qx(t),e=hS(t)}finally{zo(n)}return e}function Vx(t){var e=Oy(t);if(t.equals(e)||(t.v=e,t.wv=uS()),!Va){var n=(Ao||(t.f&ri)!==0)&&t.deps!==null?Go:rr;Cr(t,n)}}function Wx(t,e,n){const r=kd;if(e.length===0){n(t.map(r));return}var i=Ht,s=Et,o=DO(),a=LO();Promise.all(e.map(l=>RO(l))).then(l=>{i?.activate(),o();try{n([...t.map(r),...l])}catch(c){(s.f&ja)===0&&Iy(c,s)}i?.deactivate(),Kx()}).catch(l=>{a.error(l)})}function DO(){var t=Et,e=St,n=ar,r=Ht;return function(){zo(t),Zi(e),Wf(n),r?.activate()}}function Kx(){zo(null),Zi(null),Wf(null)}const og=new Set;let Ht=null,Af=null,tv=new Set,Kf=[];function Gx(){const t=Kf.shift();Kf.length>0&&queueMicrotask(Gx),t()}let Oa=[],_d=null,Wm=!1,kf=!1;class _l{current=new Map;#e=new Map;#t=new Set;#n=0;#s=null;#r=!1;#o=[];#l=[];#i=[];#a=[];#u=[];#c=[];#f=[];skipped_effects=new Set;process(e){Oa=[],Af=null;for(const i of e)this.#m(i);if(this.#o.length===0&&this.#n===0){this.#d();var n=this.#i,r=this.#a;this.#i=[],this.#a=[],this.#u=[],Af=Ht,Ht=null,nv(n),nv(r),Ht===null?Ht=this:og.delete(this),this.#s?.resolve()}else this.#h(this.#i),this.#h(this.#a),this.#h(this.#u);for(const i of this.#o)El(i);for(const i of this.#l)El(i);this.#o=[],this.#l=[]}#m(e){e.f^=rr;for(var n=e.first;n!==null;){var r=n.f,i=(r&(Hs|Fa))!==0,s=i&&(r&rr)!==0,o=s||(r&bi)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){if(i)n.f^=rr;else if((r&Sy)!==0)this.#a.push(n);else if((r&rr)===0)if((r&_y)!==0){var a=n.b?.pending?this.#l:this.#o;a.push(n)}else Md(n)&&((n.f&Yl)!==0&&this.#u.push(n),El(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)n=c.next,c=c.parent}}#h(e){for(const n of e)((n.f&si)!==0?this.#c:this.#f).push(n),Cr(n,rr);e.length=0}capture(e,n){this.#e.has(e)||this.#e.set(e,n),this.current.set(e,e.v)}activate(){Ht=this}deactivate(){Ht=null,Af=null;for(const e of tv)if(tv.delete(e),e(),Ht!==null)break}neuter(){this.#r=!0}flush(){Oa.length>0?Zx():this.#d(),Ht===this&&(this.#n===0&&og.delete(this),this.deactivate())}#d(){if(!this.#r)for(const e of this.#t)e();this.#t.clear()}increment(){this.#n+=1}decrement(){if(this.#n-=1,this.#n===0){for(const e of this.#c)Cr(e,si),Cl(e);for(const e of this.#f)Cr(e,Go),Cl(e);this.#i=[],this.#a=[],this.flush()}else this.deactivate()}add_callback(e){this.#t.add(e)}settled(){return(this.#s??=XI()).promise}static ensure(){if(Ht===null){const e=Ht=new _l;og.add(Ht),kf||_l.enqueue(()=>{Ht===e&&e.flush()})}return Ht}static enqueue(e){Kf.length===0&&queueMicrotask(Gx),Kf.unshift(e)}}function BO(t){var e=kf;kf=!0;try{for(var n;;){if(NO(),Oa.length===0&&(Ht?.flush(),Oa.length===0))return _d=null,n;Zx()}}finally{kf=e}}function Zx(){var t=vl;Wm=!0;try{var e=0;for(ov(!0);Oa.length>0;){var n=_l.ensure();if(e++>1e3){var r,i;HO()}n.process(Oa),$o.clear()}}finally{Wm=!1,ov(t),_d=null}}function HO(){try{lO()}catch(t){Iy(t,_d)}}let ca=null;function nv(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(ja|bi))===0&&Md(r)&&(ca=[],El(r),r.deps===null&&r.first===null&&r.nodes_start===null&&(r.teardown===null&&r.ac===null?sS(r):r.fn=null),ca?.length>0)){$o.clear();for(const i of ca)El(i);ca=[]}}ca=null}}function Cl(t){for(var e=_d=t;e.parent!==null;){e=e.parent;var n=e.f;if(Wm&&e===Et&&(n&Yl)!==0)return;if((n&(Fa|Hs))!==0){if((n&rr)===0)return;e.f^=rr}}Oa.push(e)}const $o=new Map;function Tl(t,e){var n={f:0,v:t,reactions:null,equals:Dx,rv:0,wv:0};return n}function He(t,e){const n=Tl(t);return lS(n),n}function Yx(t,e=!1,n=!0){const r=Tl(t);return e||(r.equals=Hx),r}function ye(t,e,n=!1){St!==null&&(!Di||(St.f&ev)!==0)&&Ux()&&(St.f&(zr|Yl|_y|ev))!==0&&!_s?.includes(t)&&hO();let r=n?rn(e):e;return Qc(t,r)}function Qc(t,e){if(!t.equals(e)){var n=t.v;Va?$o.set(t,e):$o.set(t,n),t.v=e;var r=_l.ensure();r.capture(t,n),(t.f&zr)!==0&&((t.f&si)!==0&&Oy(t),Cr(t,(t.f&ri)===0?rr:Go)),t.wv=uS(),Jx(t,si),Et!==null&&(Et.f&rr)!==0&&(Et.f&(Hs|Fa))===0&&(Zr===null?JO([t]):Zr.push(t))}return e}function Eo(t){ye(t,t.v+1)}function Jx(t,e){var n=t.reactions;if(n!==null)for(var r=n.length,i=0;i<r;i++){var s=n[i],o=s.f,a=(o&si)===0;a&&Cr(s,e),(o&zr)!==0?Jx(s,Go):a&&((o&Yl)!==0&&ca!==null&&ca.push(s),Cl(s))}}function rn(t){if(typeof t!="object"||t===null||Aa in t)return t;const e=Lx(t);if(e!==YI&&e!==JI)return t;var n=new Map,r=Ed(t),i=He(0),s=Cs,o=a=>{if(Cs===s)return a();var l=St,c=Cs;Zi(null),lv(s);var u=a();return Zi(l),lv(c),u};return r&&n.set("length",He(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&uO();var u=n.get(l);return u===void 0?u=o(()=>{var f=He(c.value);return n.set(l,f),f}):ye(u,c.value,!0),!0},deleteProperty(a,l){var c=n.get(l);if(c===void 0){if(l in a){const u=o(()=>He(bn));n.set(l,u),Eo(i)}}else ye(c,bn),Eo(i);return!0},get(a,l,c){if(l===Aa)return t;var u=n.get(l),f=l in a;if(u===void 0&&(!f||wl(a,l)?.writable)&&(u=o(()=>{var d=rn(f?a[l]:bn),p=He(d);return p}),n.set(l,u)),u!==void 0){var h=F(u);return h===bn?void 0:h}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=F(u))}else if(c===void 0){var f=n.get(l),h=f?.v;if(f!==void 0&&h!==bn)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(a,l){if(l===Aa)return!0;var c=n.get(l),u=c!==void 0&&c.v!==bn||Reflect.has(a,l);if(c!==void 0||Et!==null&&(!u||wl(a,l)?.writable)){c===void 0&&(c=o(()=>{var h=u?rn(a[l]):bn,d=He(h);return d}),n.set(l,c));var f=F(c);if(f===bn)return!1}return u},set(a,l,c,u){var f=n.get(l),h=l in a;if(r&&l==="length")for(var d=c;d<f.v;d+=1){var p=n.get(d+"");p!==void 0?ye(p,bn):d in a&&(p=o(()=>He(bn)),n.set(d+"",p))}if(f===void 0)(!h||wl(a,l)?.writable)&&(f=o(()=>He(void 0)),ye(f,rn(c)),n.set(l,f));else{h=f.v!==bn;var g=o(()=>rn(c));ye(f,g)}var b=Reflect.getOwnPropertyDescriptor(a,l);if(b?.set&&b.set.call(u,c),!h){if(r&&typeof l=="string"){var w=n.get("length"),x=Number(l);Number.isInteger(x)&&x>=w.v&&ye(w,x+1)}Eo(i)}return!0},ownKeys(a){F(i);var l=Reflect.ownKeys(a).filter(f=>{var h=n.get(f);return h===void 0||h.v!==bn});for(var[c,u]of n)u.v!==bn&&!(c in a)&&l.push(c);return l},setPrototypeOf(){fO()}})}function rv(t){try{if(t!==null&&typeof t=="object"&&Aa in t)return t[Aa]}catch{}return t}function UO(t,e){return Object.is(rv(t),rv(e))}var iv,Xx,Qx,eS;function zO(){if(iv===void 0){iv=window,Xx=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;Qx=wl(e,"firstChild").get,eS=wl(e,"nextSibling").get,Qw(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Qw(n)&&(n.__t=void 0)}}function qa(t=""){return document.createTextNode(t)}function Gf(t){return Qx.call(t)}function Cd(t){return eS.call(t)}function Ie(t,e){return Gf(t)}function Ct(t,e){{var n=Gf(t);return n instanceof Comment&&n.data===""?Cd(n):n}}function We(t,e=1,n=!1){let r=t;for(;e--;)r=Cd(r);return r}function FO(t){t.textContent=""}function tS(){return!1}function jO(t,e){if(e){const n=document.body;t.autofocus=!0,Ad(()=>{document.activeElement===n&&t.focus()})}}let sv=!1;function qO(){sv||(sv=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Td(t){var e=St,n=Et;Zi(null),zo(null);try{return t()}finally{Zi(e),zo(n)}}function $y(t,e,n,r=n){t.addEventListener(e,()=>Td(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),qO()}function VO(t){Et===null&&St===null&&aO(),St!==null&&(St.f&ri)!==0&&Et===null&&oO(),Va&&sO()}function WO(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Us(t,e,n,r=!0){var i=Et;i!==null&&(i.f&bi)!==0&&(t|=bi);var s={ctx:ar,deps:null,nodes_start:null,nodes_end:null,f:t|si,first:null,fn:e,last:null,next:null,parent:i,b:i&&i.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{El(s),s.f|=ky}catch(l){throw Mr(s),l}else e!==null&&Cl(s);if(r){var o=s;if(n&&o.deps===null&&o.teardown===null&&o.nodes_start===null&&o.first===o.last&&(o.f&ku)===0&&(o=o.first),o!==null&&(o.parent=i,i!==null&&WO(o,i),St!==null&&(St.f&zr)!==0&&(t&Fa)===0)){var a=St;(a.effects??=[]).push(o)}}return s}function My(t){const e=Us(Ay,null,!1);return Cr(e,rr),e.teardown=t,e}function at(t){VO();var e=Et.f,n=!St&&(e&Hs)!==0&&(e&ky)===0;if(n){var r=ar;(r.e??=[]).push(t)}else return nS(t)}function nS(t){return Us(Sy|eO,t,!1)}function KO(t){_l.ensure();const e=Us(Fa|ku,t,!0);return(n={})=>new Promise(r=>{n.outro?Od(e,()=>{Mr(e),r(void 0)}):(Mr(e),r(void 0))})}function Id(t){return Us(Sy,t,!1)}function GO(t){return Us(_y|ku,t,!0)}function Ny(t,e=0){return Us(Ay|e,t,!0)}function ut(t,e=[],n=[]){Wx(e,n,r=>{Us(Ay,()=>t(...r.map(F)),!0)})}function Jl(t,e=0){var n=Us(Yl|e,t,!0);return n}function Ps(t,e=!0){return Us(Hs|ku,t,!0,e)}function rS(t){var e=t.teardown;if(e!==null){const n=Va,r=St;av(!0),Zi(null);try{e.call(null)}finally{av(n),Zi(r)}}}function iS(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&Td(()=>{i.abort(Cy)});var r=n.next;(n.f&Fa)!==0?n.parent=null:Mr(n,e),n=r}}function ZO(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&Hs)===0&&Mr(e),e=n}}function Mr(t,e=!0){var n=!1;(e||(t.f&QI)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(YO(t.nodes_start,t.nodes_end),n=!0),iS(t,e&&!n),Zf(t,0),Cr(t,ja);var r=t.transitions;if(r!==null)for(const s of r)s.stop();rS(t);var i=t.parent;i!==null&&i.first!==null&&sS(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function YO(t,e){for(;t!==null;){var n=t===e?null:Cd(t);t.remove(),t=n}}function sS(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Od(t,e){var n=[];Ly(t,n,!0),oS(n,()=>{Mr(t),e&&e()})}function oS(t,e){var n=t.length;if(n>0){var r=()=>--n||e();for(var i of t)i.out(r)}else e()}function Ly(t,e,n){if((t.f&bi)===0){if(t.f^=bi,t.transitions!==null)for(const o of t.transitions)(o.is_global||n)&&e.push(o);for(var r=t.first;r!==null;){var i=r.next,s=(r.f&Au)!==0||(r.f&Hs)!==0;Ly(r,e,s?n:!1),r=i}}}function $d(t){aS(t,!0)}function aS(t,e){if((t.f&bi)!==0){t.f^=bi,(t.f&rr)===0&&(Cr(t,si),Cl(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&Au)!==0||(n.f&Hs)!==0;aS(n,i?e:!1),n=r}if(t.transitions!==null)for(const s of t.transitions)(s.is_global||e)&&s.in()}}let vl=!1;function ov(t){vl=t}let Va=!1;function av(t){Va=t}let St=null,Di=!1;function Zi(t){St=t}let Et=null;function zo(t){Et=t}let _s=null;function lS(t){St!==null&&(_s===null?_s=[t]:_s.push(t))}let dr=null,Pr=0,Zr=null;function JO(t){Zr=t}let cS=1,eu=0,Cs=eu;function lv(t){Cs=t}let Ao=!1;function uS(){return++cS}function Md(t){var e=t.f;if((e&si)!==0)return!0;if((e&Go)!==0){var n=t.deps,r=(e&ri)!==0;if(n!==null){var i,s,o=(e&Vf)!==0,a=r&&Et!==null&&!Ao,l=n.length;if((o||a)&&(Et===null||(Et.f&ja)===0)){var c=t,u=c.parent;for(i=0;i<l;i++)s=n[i],(o||!s?.reactions?.includes(c))&&(s.reactions??=[]).push(c);o&&(c.f^=Vf),a&&u!==null&&(u.f&ri)===0&&(c.f^=ri)}for(i=0;i<l;i++)if(s=n[i],Md(s)&&Vx(s),s.wv>t.wv)return!0}(!r||Et!==null&&!Ao)&&Cr(t,rr)}return!1}function fS(t,e,n=!0){var r=t.reactions;if(r!==null&&!_s?.includes(t))for(var i=0;i<r.length;i++){var s=r[i];(s.f&zr)!==0?fS(s,e,!1):e===s&&(n?Cr(s,si):(s.f&rr)!==0&&Cr(s,Go),Cl(s))}}function hS(t){var e=dr,n=Pr,r=Zr,i=St,s=Ao,o=_s,a=ar,l=Di,c=Cs,u=t.f;dr=null,Pr=0,Zr=null,Ao=(u&ri)!==0&&(Di||!vl||St===null),St=(u&(Hs|Fa))===0?t:null,_s=null,Wf(t.ctx),Di=!1,Cs=++eu,t.ac!==null&&(Td(()=>{t.ac.abort(Cy)}),t.ac=null);try{t.f|=qm;var f=t.fn,h=f(),d=t.deps;if(dr!==null){var p;if(Zf(t,Pr),d!==null&&Pr>0)for(d.length=Pr+dr.length,p=0;p<dr.length;p++)d[Pr+p]=dr[p];else t.deps=d=dr;if(!Ao||(u&zr)!==0&&t.reactions!==null)for(p=Pr;p<d.length;p++)(d[p].reactions??=[]).push(t)}else d!==null&&Pr<d.length&&(Zf(t,Pr),d.length=Pr);if(Ux()&&Zr!==null&&!Di&&d!==null&&(t.f&(zr|Go|si))===0)for(p=0;p<Zr.length;p++)fS(Zr[p],t);return i!==null&&i!==t&&(eu++,Zr!==null&&(r===null?r=Zr:r.push(...Zr))),(t.f&Sa)!==0&&(t.f^=Sa),h}catch(g){return $O(g)}finally{t.f^=qm,dr=e,Pr=n,Zr=r,St=i,Ao=s,_s=o,Wf(a),Di=l,Cs=c}}function XO(t,e){let n=e.reactions;if(n!==null){var r=GI.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}n===null&&(e.f&zr)!==0&&(dr===null||!dr.includes(e))&&(Cr(e,Go),(e.f&(ri|Vf))===0&&(e.f^=Vf),qx(e),Zf(e,0))}function Zf(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)XO(t,n[r])}function El(t){var e=t.f;if((e&ja)===0){Cr(t,rr);var n=Et,r=vl;Et=t,vl=!0;try{(e&Yl)!==0?ZO(t):iS(t),rS(t);var i=hS(t);t.teardown=typeof i=="function"?i:null,t.wv=cS;var s;Nx&&_O&&(t.f&si)!==0&&t.deps}finally{vl=r,Et=n}}}async function Nd(){await Promise.resolve(),BO()}function F(t){var e=t.f,n=(e&zr)!==0;if(St!==null&&!Di){var r=Et!==null&&(Et.f&ja)!==0;if(!r&&!_s?.includes(t)){var i=St.deps;if((St.f&qm)!==0)t.rv<eu&&(t.rv=eu,dr===null&&i!==null&&i[Pr]===t?Pr++:dr===null?dr=[t]:(!Ao||!dr.includes(t))&&dr.push(t));else{(St.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[St]:s.includes(St)||s.push(St)}}}else if(n&&t.deps===null&&t.effects===null){var o=t,a=o.parent;a!==null&&(a.f&ri)===0&&(o.f^=ri)}if(Va){if($o.has(t))return $o.get(t);if(n){o=t;var l=o.v;return((o.f&rr)===0&&o.reactions!==null||dS(o))&&(l=Oy(o)),$o.set(o,l),l}}else n&&(o=t,Md(o)&&Vx(o));if((t.f&Sa)!==0)throw t.v;return t.v}function dS(t){if(t.v===bn)return!0;if(t.deps===null)return!1;for(const e of t.deps)if($o.has(e)||(e.f&zr)!==0&&dS(e))return!0;return!1}function Wa(t){var e=Di;try{return Di=!0,t()}finally{Di=e}}const QO=-7169;function Cr(t,e){t.f=t.f&QO|e}function e$(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const t$=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function n$(t){return t$.includes(t)}const r$={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function i$(t){return t=t.toLowerCase(),r$[t]??t}const s$=["touchstart","touchmove"];function o$(t){return s$.includes(t)}const pS=new Set,Km=new Set;function gS(t,e,n,r={}){function i(s){if(r.capture||kc.call(e,s),!s.cancelBubble)return Td(()=>n?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Ad(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function Ts(t,e,n,r,i){var s={capture:r,passive:i},o=gS(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&My(()=>{e.removeEventListener(t,o,s)})}function zs(t){for(var e=0;e<t.length;e++)pS.add(t[e]);for(var n of Km)n(t)}let cv=null;function kc(t){var e=this,n=e.ownerDocument,r=t.type,i=t.composedPath?.()||[],s=i[0]||t.target;cv=t;var o=0,a=cv===t&&t.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=i.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=i[o]||t.target,s!==e){qf(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=St,f=Et;Zi(null),zo(null);try{for(var h,d=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var g=s["__"+r];if(g!=null&&(!s.disabled||t.target===s))if(Ed(g)){var[b,...w]=g;b.apply(s,[t,...w])}else g.call(s,t)}catch(x){h?d.push(x):h=x}if(t.cancelBubble||p===e||p===null)break;s=p}if(h){for(let x of d)queueMicrotask(()=>{throw x});throw h}}finally{t.__root=e,delete t.currentTarget,Zi(u),zo(f)}}}function a$(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function tu(t,e){var n=Et;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=e)}function Qe(t,e){var n=(e&wO)!==0,r=(e&vO)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=a$(s?t:"<!>"+t),n||(i=Gf(i)));var o=r||Xx?document.importNode(i,!0):i.cloneNode(!0);if(n){var a=Gf(o),l=o.lastChild;tu(a,l)}else tu(o,o);return o}}function Br(t=""){{var e=qa(t+"");return tu(e,e),e}}function pn(){var t=document.createDocumentFragment(),e=document.createComment(""),n=qa();return t.append(e,n),tu(e,n),t}function $e(t,e){t!==null&&t.before(e)}function ot(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function mS(t,e){return l$(t,e)}const tl=new Map;function l$(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:o=!0}){zO();var a=new Set,l=f=>{for(var h=0;h<f.length;h++){var d=f[h];if(!a.has(d)){a.add(d);var p=o$(d);e.addEventListener(d,kc,{passive:p});var g=tl.get(d);g===void 0?(document.addEventListener(d,kc,{passive:p}),tl.set(d,1)):tl.set(d,g+1)}}};l(Ey(pS)),Km.add(l);var c=void 0,u=KO(()=>{var f=n??e.appendChild(qa());return Ps(()=>{if(s){jn({});var h=ar;h.c=s}i&&(r.$$events=i),c=t(f,r)||{},s&&qn()}),()=>{for(var h of a){e.removeEventListener(h,kc);var d=tl.get(h);--d===0?(document.removeEventListener(h,kc),tl.delete(h)):tl.set(h,d)}Km.delete(l),f!==n&&f.parentNode?.removeChild(f)}});return Gm.set(c,u),c}let Gm=new WeakMap;function c$(t,e){const n=Gm.get(t);return n?(Gm.delete(t),n(e)):Promise.resolve()}function ft(t,e,n=!1){var r=t,i=null,s=null,o=bn,a=n?Au:0,l=!1;const c=(d,p=!0)=>{l=!0,h(p,d)};var u=null;function f(){u!==null&&(u.lastChild.remove(),r.before(u),u=null);var d=o?i:s,p=o?s:i;d&&$d(d),p&&Od(p,()=>{o?s=null:i=null})}const h=(d,p)=>{if(o!==(o=d)){var g=tS(),b=r;if(g&&(u=document.createDocumentFragment(),u.append(b=qa())),o?i??=p&&Ps(()=>p(b)):s??=p&&Ps(()=>p(b)),g){var w=Ht,x=o?i:s,T=o?s:i;x&&w.skipped_effects.delete(x),T&&w.skipped_effects.add(T),w.add_callback(f)}else f()}};Jl(()=>{l=!1,e(c),l||h(null,null)},a)}function _f(t,e){return e}function u$(t,e,n){for(var r=t.items,i=[],s=e.length,o=0;o<s;o++)Ly(e[o].e,i,!0);var a=s>0&&i.length===0&&n!==null;if(a){var l=n.parentNode;FO(l),l.append(n),r.clear(),Mi(t,e[0].prev,e[s-1].next)}oS(i,()=>{for(var c=0;c<s;c++){var u=e[c];a||(r.delete(u.k),Mi(t,u.prev,u.next)),Mr(u.e,!a)}})}function Cf(t,e,n,r,i,s=null){var o=t,a={flags:e,items:new Map,first:null},l=(e&Px)!==0;if(l){var c=t;o=c.appendChild(qa())}var u=null,f=!1,h=new Map,d=jx(()=>{var w=n();return Ed(w)?w:w==null?[]:Ey(w)}),p,g;function b(){f$(g,p,a,h,o,i,e,r,n),s!==null&&(p.length===0?u?$d(u):u=Ps(()=>s(o)):u!==null&&Od(u,()=>{u=null}))}Jl(()=>{g??=Et,p=F(d);var w=p.length;if(!(f&&w===0)){f=w===0;var x,T,M,O;if(tS()){var _=new Set,L=Ht;for(T=0;T<w;T+=1){M=p[T],O=r(M,T);var A=a.items.get(O)??h.get(O);A?(e&(xd|Sd))!==0&&yS(A,M,T,e):(x=bS(null,a,null,null,M,O,T,i,e,n,!0),h.set(O,x)),_.add(O)}for(const[E,S]of a.items)_.has(E)||L.skipped_effects.add(S.e);L.add_callback(b)}else b();F(d)}})}function f$(t,e,n,r,i,s,o,a,l){var c=(o&dO)!==0,u=(o&(xd|Sd))!==0,f=e.length,h=n.items,d=n.first,p=d,g,b=null,w,x=[],T=[],M,O,_,L;if(c)for(L=0;L<f;L+=1)M=e[L],O=a(M,L),_=h.get(O),_!==void 0&&(_.a?.measure(),(w??=new Set).add(_));for(L=0;L<f;L+=1){if(M=e[L],O=a(M,L),_=h.get(O),_===void 0){var A=r.get(O);if(A!==void 0){r.delete(O),h.set(O,A);var E=b?b.next:p;Mi(n,b,A),Mi(n,A,E),ag(A,E,i),b=A}else{var S=p?p.e.nodes_start:i;b=bS(S,n,b,b===null?n.first:b.next,M,O,L,s,o,l)}h.set(O,b),x=[],T=[],p=b.next;continue}if(u&&yS(_,M,L,o),(_.e.f&bi)!==0&&($d(_.e),c&&(_.a?.unfix(),(w??=new Set).delete(_))),_!==p){if(g!==void 0&&g.has(_)){if(x.length<T.length){var k=T[0],P;b=k.prev;var D=x[0],H=x[x.length-1];for(P=0;P<x.length;P+=1)ag(x[P],k,i);for(P=0;P<T.length;P+=1)g.delete(T[P]);Mi(n,D.prev,H.next),Mi(n,b,D),Mi(n,H,k),p=k,b=H,L-=1,x=[],T=[]}else g.delete(_),ag(_,p,i),Mi(n,_.prev,_.next),Mi(n,_,b===null?n.first:b.next),Mi(n,b,_),b=_;continue}for(x=[],T=[];p!==null&&p.k!==O;)(p.e.f&bi)===0&&(g??=new Set).add(p),T.push(p),p=p.next;if(p===null)continue;_=p}x.push(_),b=_,p=_.next}if(p!==null||g!==void 0){for(var N=g===void 0?[]:Ey(g);p!==null;)(p.e.f&bi)===0&&N.push(p),p=p.next;var I=N.length;if(I>0){var $=(o&Px)!==0&&f===0?i:null;if(c){for(L=0;L<I;L+=1)N[L].a?.measure();for(L=0;L<I;L+=1)N[L].a?.fix()}u$(n,N,$)}}c&&Ad(()=>{if(w!==void 0)for(_ of w)_.a?.apply()}),t.first=n.first&&n.first.e,t.last=b&&b.e;for(var V of r.values())Mr(V.e);r.clear()}function yS(t,e,n,r){(r&xd)!==0&&Qc(t.v,e),(r&Sd)!==0?Qc(t.i,n):t.i=n}function bS(t,e,n,r,i,s,o,a,l,c,u){var f=(l&xd)!==0,h=(l&pO)===0,d=f?h?Yx(i,!1,!1):Tl(i):i,p=(l&Sd)===0?o:Tl(o),g={i:p,v:d,k:s,a:null,e:null,prev:n,next:r};try{if(t===null){var b=document.createDocumentFragment();b.append(t=qa())}return g.e=Ps(()=>a(t,d,p,c),kO),g.e.prev=n&&n.e,g.e.next=r&&r.e,n===null?u||(e.first=g):(n.next=g,n.e.next=g.e),r!==null&&(r.prev=g,r.e.prev=g.e),g}finally{}}function ag(t,e,n){for(var r=t.next?t.next.e.nodes_start:n,i=e?e.e.nodes_start:n,s=t.e.nodes_start;s!==null&&s!==r;){var o=Cd(s);i.before(s),s=o}}function Mi(t,e,n){e===null?t.first=n:(e.next=n,e.e.next=n&&n.e),n!==null&&(n.prev=e,n.e.prev=e&&e.e)}function nu(t,e,...n){var r=t,i=yi,s;Jl(()=>{i!==(i=e())&&(s&&(Mr(s),s=null),s=Ps(()=>i(r,...n)))},Au)}function h$(t,e,n,r,i,s){var o,a,l=null,c=t,u;Jl(()=>{const f=e()||null;var h=f==="svg"?xO:null;f!==o&&(u&&(f===null?Od(u,()=>{u=null,a=null}):f===a?$d(u):Mr(u)),f&&f!==a&&(u=Ps(()=>{if(l=h?document.createElementNS(h,f):document.createElement(f),tu(l,l),r){var d=l.appendChild(qa());r(l,d)}Et.nodes_end=l,c.before(l)})),o=f,o&&(a=o))},Au)}function d$(t,e){var n=void 0,r;Jl(()=>{n!==(n=e())&&(r&&(Mr(r),r=null),n&&(r=Ps(()=>{Id(()=>n(t))})))})}function wS(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=wS(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function p$(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=wS(t))&&(r&&(r+=" "),r+=e);return r}function vS(t){return typeof t=="object"?p$(t):t??""}const uv=[...` 	
\r\f \v\uFEFF`];function g$(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,o=0;(o=r.indexOf(i,o))>=0;){var a=o+s;(o===0||uv.includes(r[o-1]))&&(a===r.length||uv.includes(r[a]))?r=(o===0?"":r.substring(0,o))+r.substring(a+1):o=a}}return r===""?null:r}function fv(t,e=!1){var n=e?" !important;":";",r="";for(var i in t){var s=t[i];s!=null&&s!==""&&(r+=" "+i+": "+s+n)}return r}function lg(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function m$(t,e){if(e){var n="",r,i;if(Array.isArray(e)?(r=e[0],i=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,o=0,a=!1,l=[];r&&l.push(...Object.keys(r).map(lg)),i&&l.push(...Object.keys(i).map(lg));var c=0,u=-1;const g=t.length;for(var f=0;f<g;f++){var h=t[f];if(a?h==="/"&&t[f-1]==="*"&&(a=!1):s?s===h&&(s=!1):h==="/"&&t[f+1]==="*"?a=!0:h==='"'||h==="'"?s=h:h==="("?o++:h===")"&&o--,!a&&s===!1&&o===0){if(h===":"&&u===-1)u=f;else if(h===";"||f===g-1){if(u!==-1){var d=lg(t.substring(c,u).trim());if(!l.includes(d)){h!==";"&&f++;var p=t.substring(c,f).trim();n+=" "+p+";"}}c=f+1,u=-1}}}}return r&&(n+=fv(r)),i&&(n+=fv(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function Ka(t,e,n,r,i,s){var o=t.__className;if(o!==n||o===void 0){var a=g$(n,r,s);a==null?t.removeAttribute("class"):e?t.className=a:t.setAttribute("class",a),t.__className=n}else if(s&&i!==s)for(var l in s){var c=!!s[l];(i==null||c!==!!i[l])&&t.classList.toggle(l,c)}return s}function cg(t,e={},n,r){for(var i in n){var s=n[i];e[i]!==s&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,s,r))}}function Ry(t,e,n,r){var i=t.__style;if(i!==e){var s=m$(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(cg(t,n?.[0],r[0]),cg(t,n?.[1],r[1],"important")):cg(t,n,r));return r}function Yf(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Ed(e))return AO();for(var r of t.options)r.selected=e.includes(Nc(r));return}for(r of t.options){var i=Nc(r);if(UO(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function ES(t){var e=new MutationObserver(()=>{Yf(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),My(()=>{e.disconnect()})}function hv(t,e,n=e){var r=!0;$y(t,"change",i=>{var s=i?"[selected]":":checked",o;if(t.multiple)o=[].map.call(t.querySelectorAll(s),Nc);else{var a=t.querySelector(s)??t.querySelector("option:not([disabled])");o=a&&Nc(a)}n(o)}),Id(()=>{var i=e();if(Yf(t,i,r),r&&i===void 0){var s=t.querySelector(":checked");s!==null&&(i=Nc(s),n(i))}t.__value=i,r=!1}),ES(t)}function Nc(t){return"__value"in t?t.__value:t.value}const pc=Symbol("class"),gc=Symbol("style"),xS=Symbol("is custom element"),SS=Symbol("is html");function y$(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function nn(t,e,n,r){var i=AS(t);i[e]!==(i[e]=n)&&(e==="loading"&&(t[nO]=n),n==null?t.removeAttribute(e):typeof n!="string"&&kS(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function b$(t,e,n,r,i=!1){var s=AS(t),o=s[xS],a=!s[SS],l=e||{},c=t.tagName==="OPTION";for(var u in e)u in n||(n[u]=null);n.class?n.class=vS(n.class):n[pc]&&(n.class=null),n[gc]&&(n.style??=null);var f=kS(t);for(const T in n){let M=n[T];if(c&&T==="value"&&M==null){t.value=t.__value="",l[T]=M;continue}if(T==="class"){var h=t.namespaceURI==="http://www.w3.org/1999/xhtml";Ka(t,h,M,r,e?.[pc],n[pc]),l[T]=M,l[pc]=n[pc];continue}if(T==="style"){Ry(t,M,e?.[gc],n[gc]),l[T]=M,l[gc]=n[gc];continue}var d=l[T];if(!(M===d&&!(M===void 0&&t.hasAttribute(T)))){l[T]=M;var p=T[0]+T[1];if(p!=="$$")if(p==="on"){const O={},_="$$"+T;let L=T.slice(2);var g=n$(L);if(e$(L)&&(L=L.slice(0,-7),O.capture=!0),!g&&d){if(M!=null)continue;t.removeEventListener(L,l[_],O),l[_]=null}if(M!=null)if(g)t[`__${L}`]=M,zs([L]);else{let A=function(E){l[T].call(this,E)};var x=A;l[_]=gS(L,t,A,O)}else g&&(t[`__${L}`]=void 0)}else if(T==="style")nn(t,T,M);else if(T==="autofocus")jO(t,!!M);else if(!o&&(T==="__value"||T==="value"&&M!=null))t.value=t.__value=M;else if(T==="selected"&&c)y$(t,M);else{var b=T;a||(b=i$(b));var w=b==="defaultValue"||b==="defaultChecked";if(M==null&&!o&&!w)if(s[T]=null,b==="value"||b==="checked"){let O=t;const _=e===void 0;if(b==="value"){let L=O.defaultValue;O.removeAttribute(b),O.defaultValue=L,O.value=O.__value=_?L:null}else{let L=O.defaultChecked;O.removeAttribute(b),O.defaultChecked=L,O.checked=_?L:!1}}else t.removeAttribute(T);else w||f.includes(b)&&(o||typeof M!="string")?(t[b]=M,b in s&&(s[b]=bn)):typeof M!="function"&&nn(t,b,M)}}}return l}function w$(t,e,n=[],r=[],i,s=!1){Wx(n,r,o=>{var a=void 0,l={},c=t.nodeName==="SELECT",u=!1;if(Jl(()=>{var h=e(...o.map(F)),d=b$(t,a,h,i,s);u&&c&&"value"in h&&Yf(t,h.value);for(let g of Object.getOwnPropertySymbols(l))h[g]||Mr(l[g]);for(let g of Object.getOwnPropertySymbols(h)){var p=h[g];g.description===SO&&(!a||p!==a[g])&&(l[g]&&Mr(l[g]),l[g]=Ps(()=>d$(t,()=>p))),d[g]=p}a=d}),c){var f=t;Id(()=>{Yf(f,a.value,!0),ES(f)})}u=!0})}function AS(t){return t.__attributes??={[xS]:t.nodeName.includes("-"),[SS]:t.namespaceURI===EO}}var dv=new Map;function kS(t){var e=t.getAttribute("is")||t.nodeName,n=dv.get(e);if(n)return n;dv.set(e,n=[]);for(var r,i=t,s=Element.prototype;s!==i;){r=ZI(i);for(var o in r)r[o].set&&n.push(o);i=Lx(i)}return n}function v$(t,e,n=e){var r=new WeakSet;$y(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=ug(t)?fg(s):s,n(s),Ht!==null&&r.add(Ht),await Nd(),s!==(s=e())){var o=t.selectionStart,a=t.selectionEnd;t.value=s??"",a!==null&&(t.selectionStart=o,t.selectionEnd=Math.min(a,t.value.length))}}),Wa(e)==null&&t.value&&(n(ug(t)?fg(t.value):t.value),Ht!==null&&r.add(Ht)),Ny(()=>{var i=e();if(t===document.activeElement){var s=Af??Ht;if(r.has(s))return}ug(t)&&i===fg(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function E$(t,e,n=e){$y(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),Wa(e)==null&&n(t.checked),Ny(()=>{var r=e();t.checked=!!r})}function ug(t){var e=t.type;return e==="number"||e==="range"}function fg(t){return t===""?null:+t}function pv(t,e){return t===e||t?.[Aa]===e}function Ki(t={},e,n,r){return Id(()=>{var i,s;return Ny(()=>{i=s,s=[],Wa(()=>{t!==n(...s)&&(e(t,...s),i&&pv(n(...i),t)&&e(null,...i))})}),()=>{Ad(()=>{s&&pv(n(...s),t)&&e(null,...s)})}}),t}function Py(t,e,n){if(t==null)return e(void 0),n&&n(void 0),yi;const r=Wa(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const nl=[];function _S(t,e){return{subscribe:Hr(t,e).subscribe}}function Hr(t,e=yi){let n=null;const r=new Set;function i(a){if(Bx(t,a)&&(t=a,n)){const l=!nl.length;for(const c of r)c[1](),nl.push(c,t);if(l){for(let c=0;c<nl.length;c+=2)nl[c][0](nl[c+1]);nl.length=0}}}function s(a){i(a(t))}function o(a,l=yi){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,s)||yi),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function Is(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return _S(n,(o,a)=>{let l=!1;const c=[];let u=0,f=yi;const h=()=>{if(u)return;f();const p=e(r?c[0]:c,o,a);s?o(p):f=typeof p=="function"?p:yi},d=i.map((p,g)=>Py(p,b=>{c[g]=b,u&=~(1<<g),l&&h()},()=>{u|=1<<g}));return l=!0,h(),function(){xy(d),f(),l=!1}})}function Tf(t){let e;return Py(t,n=>e=n)(),e}let tf=!1,Zm=Symbol();function zn(t,e,n){const r=n[e]??={store:null,source:Yx(void 0),unsubscribe:yi};if(r.store!==t&&!(Zm in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=yi;else{var i=!0;r.unsubscribe=Py(t,s=>{i?r.source.v=s:ye(r.source,s)}),i=!1}return t&&Zm in n?Tf(t):F(r.source)}function Qi(){const t={};function e(){My(()=>{for(var n in t)t[n].unsubscribe();qf(t,Zm,{enumerable:!1,value:!0})})}return[t,e]}function x$(t){var e=tf;try{return tf=!1,[t(),tf]}finally{tf=e}}const S$={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function A$(t,e,n){return new Proxy({props:t,exclude:e},S$)}function dt(t,e,n,r){var i=(n&yO)!==0,s=(n&bO)!==0,o=r,a=!0,l=()=>(a&&(a=!1,o=s?Wa(r):r),o),c;if(i){var u=Aa in t||tO in t;c=wl(t,e)?.set??(u&&e in t?x=>t[e]=x:void 0)}var f,h=!1;i?[f,h]=x$(()=>t[e]):f=t[e],f===void 0&&r!==void 0&&(f=l(),c&&(cO(),c(f)));var d;if(d=()=>{var x=t[e];return x===void 0?l():(a=!0,x)},(n&mO)===0)return d;if(c){var p=t.$$legacy;return(function(x,T){return arguments.length>0?((!T||p||h)&&c(T?d():x),x):d()})}var g=!1,b=((n&gO)!==0?kd:jx)(()=>(g=!1,d()));i&&F(b);var w=Et;return(function(x,T){if(arguments.length>0){const M=T?F(b):i?rn(x):x;return ye(b,M),g=!0,o!==void 0&&(o=M),x}return Va&&g||(w.f&ja)!==0?b.v:F(b)})}function Zo(t){ar===null&&Ty(),at(()=>{const e=Wa(t);if(typeof e=="function")return e})}function _u(t){ar===null&&Ty(),Zo(()=>()=>Wa(t))}const k$="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(k$);var _$=Object.defineProperty,C$=(t,e,n)=>e in t?_$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Fe=(t,e,n)=>(C$(t,typeof e!="symbol"?e+"":e,n),n);let Cu=class extends Error{},gv=class extends Cu{constructor(e){super(`RxNostrWebSocketError: WebSocket was closed with code ${e} by relay.`),this.code=e,this.name="RxNostrWebSocketError"}},If=class extends Cu{constructor(e){super(`RxNostrInvalidUsageError: ${e}`),this.name="RxNostrInvalidUsageError"}},hg=class extends Cu{constructor(e){super(`RxNostrEnvironmentError: ${e}`),this.name="RxNostrEnvironmentError"}},CS=class extends Cu{constructor(){super("RxNostrLogicError: This is rx-nostr's internal bug. Please report to the author of the library."),this.name="RxNostrLogicError"}},ps=class extends Cu{constructor(){super("RxNostrAlreadyDisposedError: Attempted to access a disposed resource."),this.name="RxNostrAlreadyDisposedError"}};const Tu=(t,e)=>({...e,...t});function T$(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function dg(t){throw t}function I$(t){return{async signEvent(e){var n,r;const i={...e,pubkey:e.pubkey??await((n=window?.nostr)==null?void 0:n.getPublicKey())??dg(new hg("window.nostr.getPublicKey() is not found")),tags:[...e.tags??[]],created_at:e.created_at??Math.floor(Date.now()/1e3)};return T$(i)?i:await((r=window?.nostr)==null?void 0:r.signEvent(i))??dg(new hg("window.nostr.signEvent() is not found"))},getPublicKey(){var e;return((e=window?.nostr)==null?void 0:e.getPublicKey())??dg(new hg("window.nostr.getPublicKey() is not found"))}}}const O$=t=>Tu(t,{signer:I$(),connectionStrategy:"lazy",retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},disconnectTimeout:1e4,eoseTimeout:30*1e3,okTimeout:30*1e3,authTimeout:30*1e3,skipVerify:!1,skipValidateFilterMatching:!1,skipExpirationCheck:!1,skipFetchNip11:!1});function $$(t){return"length"in t?t.map(mv):[mv(t)]}function mv(t){return{...t,since:t.since?yv(t.since):void 0,until:t.until?yv(t.until):void 0}}function yv(t){return typeof t=="number"?t:t()}async function M$(t){try{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws(s?):/,"http$1:"),await(await fetch(e.toString(),{headers:{Accept:"application/nostr+json"}})).json()}catch{return{}}}function bv(t,e){try{return t()}catch(n){return e instanceof Function?e(n):e}}function ms(t){let e="";try{e=t.trim();const n=new URL(e);n.hash="",n.pathname=bv(()=>decodeURI(n.pathname),n.pathname),n.pathname=n.pathname.replace(/\/$/,""),n.hostname=n.hostname.replace(/\.$/,""),n.searchParams.sort(),n.search=bv(()=>decodeURIComponent(n.search),n.search);let r=n.toString();return n.search||(r=r.replace(/\/$/,"")),r}catch{return e}}let Of=class TS extends Map{constructor(e){if(super(),!!e)for(const[n,r]of Object.entries(e))this.set(ms(n),r)}get(e){return super.get(ms(e))}getMany(e){const n=[];for(const r of new Set(e.map(ms))){const i=this.get(r);i!==void 0&&n.push(i)}return n}set(e,n){return super.set(ms(e),n)}has(e){return super.has(ms(e))}delete(e){return super.delete(ms(e))}toObject(){const e={};for(const[n,r]of this.entries())e[n]=r;return e}toKeys(){return[...super.keys()]}toValues(){return[...super.values()]}copy(){return new TS(this.toObject())}},Jf=class{static async getValue(e,n,r){if(!(r!=null&&r.skipCache)){const i=await this.cache.get(e);if(i)return n(i)}if(!(r!=null&&r.skipFetch)){const i=await this.fetch(e);if(i)return n(i)}return n(this.default)}static get(e){const n=this.cache.get(e);if(n&&!(n instanceof Promise))return n}static async fetch(e){const n=M$(e);return this.cache.set(e,n),n.then(r=>{this.cache.set(e,r)}),n}static async getOrFetch(e){return this.cache.get(e)??this.fetch(e)}static set(e,n){this.cache.set(e,n)}static getDefault(){return this.default}static setDefault(e){this.default=e}static forget(e){this.cache.delete(e)}static forgetAll(){this.cache.clear()}};Fe(Jf,"cache",new Of),Fe(Jf,"default",{});/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */new Uint8Array(new Uint32Array([287454020]).buffer)[0];function N$(t,e,n){return Array.isArray(e)?e.some(r=>wv(t,r)):wv(t,e)}function wv(t,e,n){const{sinceInclusive:r,untilInclusive:i}=Tu({},{sinceInclusive:!0,untilInclusive:!0});if(e.ids&&e.ids.every(s=>!t.id.startsWith(s))||e.kinds&&!e.kinds.includes(t.kind)||e.authors&&e.authors.every(s=>!t.pubkey.startsWith(s))||e.since&&(r&&!(e.since<=t.created_at)||!r&&!(e.since<t.created_at))||e.until&&(i&&!(t.created_at<=e.until)||!i&&!(t.created_at<e.until)))return!1;for(const[s,o]of Object.entries(e)){if(!s.startsWith("#")||!Array.isArray(o))continue;const a=s.slice(1);if(!t.tags.find(([l,c])=>a===l&&o.includes(c)))return!1}return!0}function L$(t,e){const n=t.tags.find(r=>r[0]==="expiration");if(!n)return!1;try{const r=Number(n[1]);return Number.isInteger(r)?r<=(e??Math.floor(Date.now()/1e3)):!1}catch{return!1}}var Ym=function(t,e){return Ym=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Ym(t,e)};function Fs(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ym(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function R$(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(f){o(f)}}function l(u){try{c(r.throw(u))}catch(f){o(f)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}function IS(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Il(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ol(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function $l(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function xl(t){return this instanceof xl?(this.v=t,this):new xl(t)}function P$(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(d){return new Promise(function(p,g){s.push([h,d,p,g])>1||a(h,d)})})}function a(h,d){try{l(r[h](d))}catch(p){f(s[0][3],p)}}function l(h){h.value instanceof xl?Promise.resolve(h.value.v).then(c,u):f(s[0][2],h)}function c(h){a("next",h)}function u(h){a("throw",h)}function f(h,d){h(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function D$(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Il=="function"?Il(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function sn(t){return typeof t=="function"}function Ld(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var pg=Ld(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Xf(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Iu=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Il(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(sn(u))try{u()}catch(g){s=g instanceof pg?g.errors:[g]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var h=Il(f),d=h.next();!d.done;d=h.next()){var p=d.value;try{vv(p)}catch(g){s=s??[],g instanceof pg?s=$l($l([],Ol(s)),Ol(g.errors)):s.push(g)}}}catch(g){r={error:g}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}if(s)throw new pg(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)vv(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Xf(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Xf(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),OS=Iu.EMPTY;function $S(t){return t instanceof Iu||t&&"closed"in t&&sn(t.remove)&&sn(t.add)&&sn(t.unsubscribe)}function vv(t){sn(t)?t():t.unsubscribe()}var B$={Promise:void 0},H$={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,$l([t,e],Ol(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function MS(t){H$.setTimeout(function(){throw t})}function Jm(){}function $f(t){t()}var Dy=(function(t){Fs(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,$S(n)&&n.add(r)):r.destination=F$,r}return e.create=function(n,r,i){return new Qf(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Iu),U$=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){nf(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){nf(r)}else nf(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){nf(n)}},t})(),Qf=(function(t){Fs(e,t);function e(n,r,i){var s=t.call(this)||this,o;return sn(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new U$(o),s}return e})(Dy);function nf(t){MS(t)}function z$(t){throw t}var F$={closed:!0,next:Jm,error:z$,complete:Jm},By=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function js(t){return t}function j$(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return NS(t)}function NS(t){return t.length===0?js:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var Nr=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=V$(e)?e:new Qf(e,n,r);return $f(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Ev(n),new n(function(i,s){var o=new Qf({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[By]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return NS(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Ev(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function Ev(t){var e;return(e=t??B$.Promise)!==null&&e!==void 0?e:Promise}function q$(t){return t&&sn(t.next)&&sn(t.error)&&sn(t.complete)}function V$(t){return t&&t instanceof Dy||q$(t)&&$S(t)}function W$(t){return sn(t?.lift)}function lr(t){return function(e){if(W$(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Fn(t,e,n,r,i){return new K$(t,e,n,r,i)}var K$=(function(t){Fs(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(Dy),G$=Ld(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Wt=(function(t){Fs(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new xv(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new G$},e.prototype.next=function(n){var r=this;$f(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Il(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;$f(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;$f(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?OS:(this.currentObservers=null,a.push(n),new Iu(function(){r.currentObservers=null,Xf(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Nr;return n.source=this,n},e.create=function(n,r){return new xv(n,r)},e})(Nr),xv=(function(t){Fs(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:OS},e})(Wt),Z$=(function(t){Fs(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(Wt),Y$={now:function(){return Date.now()}},J$=(function(t){Fs(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(Iu),Xm={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Xm.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,$l([t,e],Ol(n))):setInterval.apply(void 0,$l([t,e],Ol(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},X$=(function(t){Fs(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),Xm.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Xm.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Xf(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(J$),Sv=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=Y$.now,t})(),Q$=(function(t){Fs(e,t);function e(n,r){r===void 0&&(r=Sv.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(Sv),LS=new Q$(X$),e6=LS,Ou=new Nr(function(t){return t.complete()});function t6(t){return t&&sn(t.schedule)}function Hy(t){return t[t.length-1]}function n6(t){return sn(Hy(t))?t.pop():void 0}function Uy(t){return t6(Hy(t))?t.pop():void 0}function r6(t,e){return typeof Hy(t)=="number"?t.pop():e}var RS=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function PS(t){return sn(t?.then)}function DS(t){return sn(t[By])}function BS(t){return Symbol.asyncIterator&&sn(t?.[Symbol.asyncIterator])}function HS(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function i6(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var US=i6();function zS(t){return sn(t?.[US])}function FS(t){return P$(this,arguments,function(){var e,n,r,i;return IS(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,xl(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,xl(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,xl(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function jS(t){return sn(t?.getReader)}function es(t){if(t instanceof Nr)return t;if(t!=null){if(DS(t))return s6(t);if(RS(t))return o6(t);if(PS(t))return a6(t);if(BS(t))return qS(t);if(zS(t))return l6(t);if(jS(t))return c6(t)}throw HS(t)}function s6(t){return new Nr(function(e){var n=t[By]();if(sn(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function o6(t){return new Nr(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function a6(t){return new Nr(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,MS)})}function l6(t){return new Nr(function(e){var n,r;try{for(var i=Il(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function qS(t){return new Nr(function(e){u6(t,e).catch(function(n){return e.error(n)})})}function c6(t){return qS(FS(t))}function u6(t,e){var n,r,i,s;return R$(this,void 0,void 0,function(){var o,a;return IS(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=D$(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Gi(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function VS(t,e){return e===void 0&&(e=0),lr(function(n,r){n.subscribe(Fn(r,function(i){return Gi(r,t,function(){return r.next(i)},e)},function(){return Gi(r,t,function(){return r.complete()},e)},function(i){return Gi(r,t,function(){return r.error(i)},e)}))})}function WS(t,e){return e===void 0&&(e=0),lr(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function f6(t,e){return es(t).pipe(WS(e),VS(e))}function h6(t,e){return es(t).pipe(WS(e),VS(e))}function d6(t,e){return new Nr(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function p6(t,e){return new Nr(function(n){var r;return Gi(n,e,function(){r=t[US](),Gi(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return sn(r?.return)&&r.return()}})}function KS(t,e){if(!t)throw new Error("Iterable cannot be null");return new Nr(function(n){Gi(n,e,function(){var r=t[Symbol.asyncIterator]();Gi(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function g6(t,e){return KS(FS(t),e)}function m6(t,e){if(t!=null){if(DS(t))return f6(t,e);if(RS(t))return d6(t,e);if(PS(t))return h6(t,e);if(BS(t))return KS(t,e);if(zS(t))return p6(t,e);if(jS(t))return g6(t,e)}throw HS(t)}function $u(t,e){return e?m6(t,e):es(t)}function GS(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Uy(t);return $u(t,n)}var zy=Ld(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function ZS(t,e){return new Promise(function(n,r){var i=new Qf({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new zy)}});t.subscribe(i)})}function YS(t){return t instanceof Date&&!isNaN(t)}var JS=Ld(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function XS(t,e){var n=YS(t)?{first:t}:typeof t=="number"?{each:t}:t,r=n.first,i=n.each,s=n.with,o=s===void 0?y6:s,a=n.scheduler,l=a===void 0?LS:a,c=n.meta,u=c===void 0?null:c;if(r==null&&i==null)throw new TypeError("No timeout provided.");return lr(function(f,h){var d,p,g=null,b=0,w=function(x){p=Gi(h,l,function(){try{d.unsubscribe(),es(o({meta:u,lastValue:g,seen:b})).subscribe(h)}catch(T){h.error(T)}},x)};d=f.subscribe(Fn(h,function(x){p?.unsubscribe(),b++,h.next(g=x),i>0&&w(i)},void 0,void 0,function(){p!=null&&p.closed||p==null||p.unsubscribe(),g=null})),!b&&w(r!=null?typeof r=="number"?r:+r-l.now():i)})}function y6(t){throw new JS(t)}function Mo(t,e){return lr(function(n,r){var i=0;n.subscribe(Fn(r,function(s){r.next(t.call(e,s,i++))}))})}var b6=Array.isArray;function w6(t,e){return b6(e)?t.apply(void 0,$l([],Ol(e))):t(e)}function v6(t){return Mo(function(e){return w6(t,e)})}var E6=Array.isArray,x6=Object.getPrototypeOf,S6=Object.prototype,A6=Object.keys;function k6(t){if(t.length===1){var e=t[0];if(E6(e))return{args:e,keys:null};if(_6(e)){var n=A6(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function _6(t){return t&&typeof t=="object"&&x6(t)===S6}function C6(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function T6(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Uy(t),r=n6(t),i=k6(t),s=i.args,o=i.keys;if(s.length===0)return $u([],n);var a=new Nr(I6(s,n,o?function(l){return C6(o,l)}:js));return r?a.pipe(v6(r)):a}function I6(t,e,n){return n===void 0&&(n=js),function(r){Av(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(u){Av(e,function(){var f=$u(t[u],e),h=!1;f.subscribe(Fn(r,function(d){s[u]=d,h||(h=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function Av(t,e,n){t?Gi(n,t,e):e()}function O6(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,f=!1,h=function(){f&&!l.length&&!c&&e.complete()},d=function(g){return c<r?p(g):l.push(g)},p=function(g){c++;var b=!1;es(n(g,u++)).subscribe(Fn(e,function(w){e.next(w)},function(){b=!0},void 0,function(){if(b)try{c--;for(var w=function(){var x=l.shift();o?Gi(e,o,function(){return p(x)}):p(x)};l.length&&c<r;)w();h()}catch(x){e.error(x)}}))};return t.subscribe(Fn(e,d,function(){f=!0,h()})),function(){}}function eh(t,e,n){return n===void 0&&(n=1/0),sn(e)?eh(function(r,i){return Mo(function(s,o){return e(r,s,i,o)})(es(t(r,i)))},n):(typeof e=="number"&&(n=e),lr(function(r,i){return O6(r,i,t,n)}))}function QS(t){return t===void 0&&(t=1/0),eh(js,t)}function kv(t,e,n){return t===void 0&&(t=0),n===void 0&&(n=e6),new Nr(function(r){var i=YS(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){r.closed||(r.next(s++),r.complete())},i)})}function $6(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Uy(t),r=r6(t,1/0),i=t;return i.length?i.length===1?es(i[0]):QS(r)($u(i,n)):Ou}function ti(t,e){return lr(function(n,r){var i=0;n.subscribe(Fn(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function eA(t){return lr(function(e,n){var r=null,i=!1,s;r=e.subscribe(Fn(n,void 0,void 0,function(o){s=es(t(o,eA(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function M6(t){return lr(function(e,n){var r=!1;e.subscribe(Fn(n,function(i){r=!0,n.next(i)},function(){r||n.next(t),n.complete()}))})}function N6(t){return t<=0?function(){return Ou}:lr(function(e,n){var r=0;e.subscribe(Fn(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function L6(t,e){return e===void 0&&(e=js),t=t??R6,lr(function(n,r){var i,s=!0;n.subscribe(Fn(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function R6(t,e){return t===e}function P6(t){return t===void 0&&(t=D6),lr(function(e,n){var r=!1;e.subscribe(Fn(n,function(i){r=!0,n.next(i)},function(){return r?n.complete():n.error(t())}))})}function D6(){return new zy}function gg(t){return lr(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function Qm(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?ti(function(i,s){return t(i,s,r)}):js,N6(1),n?M6(e):P6(function(){return new zy}))}}function B6(t,e){return lr(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Fn(r,function(l){i?.unsubscribe();var c=0,u=s++;es(t(l,u)).subscribe(i=Fn(r,function(f){return r.next(e?e(l,f,u,c++):f)},function(){i=null,a()}))},function(){o=!0,a()}))})}function H6(){return B6(js)}function mc(t){return lr(function(e,n){es(t).subscribe(Fn(n,function(){return n.complete()},Jm)),!n.closed&&e.subscribe(n)})}function U6(t,e){return lr(function(n,r){var i=0;n.subscribe(Fn(r,function(s){var o=t(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function rf(t,e,n){var r=sn(t)||e||n?{next:t,error:e,complete:n}:t;return r?lr(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Fn(s,function(l){var c;(c=r.next)===null||c===void 0||c.call(r,l),s.next(l)},function(){var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),s.complete()},function(l){var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),s.error(l)},function(){var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):js}function z6(t){return eh((e,n)=>$u(t(e,n)).pipe(eh(r=>r?GS(e):Ou)))}function _v(t){return j$(XS(t),eA(e=>{if(e instanceof JS)return Ou;throw e}))}function mg(t,e){const{not:n}=Tu(e,{not:!1});return ti(r=>F6(r.subId===t,n))}function F6(t,e){return!t&&e||t&&!e}let j6=class{constructor(e){Fe(this,"relay"),Fe(this,"config"),Fe(this,"authenticator"),Fe(this,"ongoings",new Set),Fe(this,"authResult$",new Wt),Fe(this,"disposed",!1),this.relay=e.relay,this.config=e.config,this.authenticator=e.authenticator;const n=this.relay.getOKObservable().subscribe(i=>{const{eventId:s,ok:o}=i;this.ongoings.has(s)&&(this.ongoings.delete(s),this.authResult$.next(o),o||(n.unsubscribe(),r.unsubscribe()))}),r=this.relay.getAUTHObservable().subscribe(({challenge:i})=>{this.challenge(i)})}getAuthResultObservable(){return this.authResult$.asObservable()}async challenge(e){try{const n=await this.signer.signEvent({kind:22242,content:"",tags:[["relay",this.relay.url],["challenge",e]]});this.ongoings.add(n.id),this.relay.send(["AUTH",n])}catch{}}get signer(){return this.authenticator.signer??this.config.signer}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.authResult$];for(const n of e)n.complete()}},tA=class extends Z${constructor(e){super(e??0)}increment(){this.next(this.getValue()+1)}decrement(){this.next(this.getValue()-1)}next(e){typeof e=="number"?super.next(e):super.next(e(this.getValue()))}},q6=class extends Wt{waitNext(){return ZS(this.pipe(Qm(null,void 0)))}},V6=class{constructor(e){Fe(this,"relay"),Fe(this,"authProxy"),Fe(this,"pubs",new Map),Fe(this,"authRequiredPubs",new Set),Fe(this,"count$",new tA(0)),Fe(this,"ok$",new Wt),Fe(this,"disposed",!1);var n;this.relay=e.relay,this.authProxy=e.authProxy,this.relay.getReconnectedObservable().subscribe(r=>{for(const[i,s]of r)i==="EVENT"&&this.pubs.has(s.id)&&this.sendEVENT(s)}),this.relay.getOKObservable().subscribe(async r=>{const{eventId:i,notice:s}=r;this.pubs.get(i)&&(this.authProxy&&s!=null&&s.startsWith("auth-required:")?(this.authRequiredPubs.add(i),this.ok$.next({...r,done:!1})):(this.ok$.next({...r,done:!0}),this.confirmOK(i)))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{if(r)for(const i of this.authRequiredPubs){const s=this.pubs.get(i);s&&this.sendEVENT(s)}else for(const i of this.authRequiredPubs)this.confirmOK(i);this.authRequiredPubs.clear()})}async publish(e){if(!this.disposed)return this.pubs.has(e.id)||(this.pubs.set(e.id,e),this.count$.increment()),this.sendEVENT(e)}confirmOK(e){this.disposed||this.pubs.has(e)||(this.pubs.delete(e),this.count$.decrement())}getOkAgainstEventObservable(){return this.ok$.asObservable()}getLogicalConnectionSizeObservable(){return this.count$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.count$,this.ok$];for(const n of e)n.complete()}sendEVENT(e){return this.relay.send(["EVENT",e])}};const Cv={OPEN:1};let W6=class{constructor(e,n){Fe(this,"socket",null),Fe(this,"buffer",[]),Fe(this,"unsent",[]),Fe(this,"reconnected$",new Wt),Fe(this,"outgoing$",new Wt),Fe(this,"message$",new Wt),Fe(this,"error$",new Wt),Fe(this,"retryTimer",null),Fe(this,"sendAttempted$",new q6),Fe(this,"isFirstTry",!0),Fe(this,"maybeDown",!1),Fe(this,"disposed",!1),Fe(this,"state$",new Wt),Fe(this,"_state","initialized"),this.url=e,this.config=n,n.skipFetchNip11||Jf.getOrFetch(e),this.setState("initialized")}get state(){return this._state}setState(e){this._state=e,this.state$.next(e)}connectManually(){this.connect()}connect(e){if(this.state==="terminated")return;const n=typeof e=="number";(this.state==="initialized"||this.state==="dormant"||this.state==="error"||this.state==="rejected"||n)&&(this.socket=this.createSocket(e??0))}createSocket(e){const n=this.isFirstTry;this.isFirstTry=!1;let r=!1;const i=e>0,s=this.state==="error"||this.state==="rejected";i?this.setState("retrying"):this.setState("connecting");const o=async()=>{if(this.state==="terminated"){u?.close(al.RX_NOSTR_DISPOSED);return}this.setState("connected"),r=!0,(i||s)&&(this.reconnected$.next(this.unsent),this.unsent=[]);try{for(const f of this.buffer)this.send(f)}catch(f){this.error$.next(f)}finally{this.buffer=[]}},a=({data:f})=>{if(this.state!=="terminated")try{this.message$.next(this.pack(JSON.parse(f)))}catch(h){this.error$.next(h)}},l=({code:f})=>{var h;if(u?.removeEventListener("open",o),u?.removeEventListener("message",a),u?.removeEventListener("close",l),this.socket===u&&(this.socket=null),this.state==="terminated"||f===al.RX_NOSTR_DISPOSED){this.unsent=[],this.buffer=[];return}if(f===al.RX_NOSTR_IDLE)this.setState("dormant"),this.buffer.length>0&&this.connect();else if(f===al.DONT_RETRY)this.unsent=[],this.buffer=[],this.error$.next(new gv(f)),this.setState("rejected");else{n&&!r&&(this.maybeDown=!0),this.unsent.push(...this.buffer),this.buffer=[],this.error$.next(new gv(f));const d=e+1;this.config.retry.strategy!=="off"&&!(this.config.retry.polite&&this.maybeDown)&&d<=this.config.retry.maxCount?(this.setState("waiting-for-retrying"),(h=this.retryTimer)==null||h.unsubscribe(),this.retryTimer=K6(this.config.retry,d).subscribe(()=>{this.disposed||this.connect(d)})):this.setState("error")}},c=this.config.websocketCtor??globalThis.WebSocket;if(!c)throw new If("WebSocket constructor is missing");const u=(()=>{try{return new c(this.url)}catch{return l({code:0}),null}})();return u?.addEventListener("open",o),u?.addEventListener("message",a),u?.addEventListener("close",l),u}pack(e){const n=e[0],r=this.url;switch(n){case"EVENT":return{from:r,type:n,message:e,subId:e[1],event:e[2]};case"EOSE":return{from:r,type:n,message:e,subId:e[1]};case"OK":return{from:r,type:n,message:e,eventId:e[1],ok:e[2],notice:e[3]};case"CLOSED":return{from:r,type:n,message:e,subId:e[1],notice:e[2]};case"NOTICE":return{from:r,type:n,message:e,notice:e[1]};case"AUTH":return{from:r,type:n,message:e,challenge:e[1]};case"COUNT":return{from:r,type:n,message:e,subId:e[1],count:e[2]};default:return{from:r,type:"unknown",message:e}}}disconnect(e){var n;((n=this.socket)==null?void 0:n.readyState)===Cv.OPEN&&this.socket.close(e)}send(e){const n=this.sendAttempted$.waitNext();switch(this.state){case"terminated":case"rejected":return this.sendAttempted$.next(),n;case"initialized":case"connecting":case"dormant":return this.buffer.push(e),this.connect(),n;case"connected":{if(!this.socket)throw new CS;return this.socket.readyState===Cv.OPEN?(this.outgoing$.next({to:this.url,message:e}),this.socket.send(JSON.stringify(e)),this.sendAttempted$.next(),n):(this.buffer.push(e),n)}case"waiting-for-retrying":case"retrying":case"error":return this.sendAttempted$.next(),this.unsent.push(e),n}}getEVENTObservable(){return this.message$.pipe(ti(e=>e.type==="EVENT"))}getEOSEObservable(){return this.message$.pipe(ti(e=>e.type==="EOSE"))}getCLOSEDObservable(){return this.message$.pipe(ti(e=>e.type==="CLOSED"))}getOKObservable(){return this.message$.pipe(ti(e=>e.type==="OK"))}getAUTHObservable(){return this.message$.pipe(ti(e=>e.type==="AUTH"))}getAllMessageObservable(){return this.message$.asObservable()}getOutgoingMessageObservable(){return this.outgoing$.asObservable()}getReconnectedObservable(){return this.reconnected$.asObservable()}getConnectionStateObservable(){return this.state$.pipe(L6(),Mo(e=>({from:this.url,state:e})))}getErrorObservable(){return this.error$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){var e,n;if(this.disposed)return;this.disposed=!0,this.setState("terminated"),(e=this.retryTimer)==null||e.unsubscribe(),(n=this.socket)==null||n.close(al.RX_NOSTR_DISPOSED),this.socket=null;const r=[this.state$,this.outgoing$,this.message$,this.error$,this.reconnected$,this.sendAttempted$];for(const i of r)i.complete()}};function K6(t,e){switch(t.strategy){case"exponential":{const n=Math.max(t.initialDelay*2**(e-1)+(Math.random()-.5)*1e3,1e3);return kv(n)}case"immediately":return GS(0);case"linear":return kv(t.interval);case"off":return Ou}}const al={DONT_RETRY:4e3,RX_NOSTR_IDLE:4537,RX_NOSTR_DISPOSED:4538};let G6=class{constructor(e){Fe(this,"relay"),Fe(this,"authProxy"),Fe(this,"config"),Fe(this,"subs",new Map),Fe(this,"authRequiredSubs",new Set),Fe(this,"fin$",new Wt),Fe(this,"disposed",!1),Fe(this,"queue");var n;this.relay=e.relay,this.authProxy=e.authProxy,this.config=e.config,this.queue=new Z6(this.relay.url,this.config),this.queue.getActivationObservable().subscribe(r=>{for(const{req:i}of r)this.sendREQ(i)}),this.relay.getReconnectedObservable().subscribe(()=>{for(const{req:r}of this.queue.ongoings)this.sendREQ(r)}),this.relay.getEOSEObservable().subscribe(({subId:r})=>{var i;(i=this.subs.get(r))!=null&&i.autoclose&&this.unsubscribe(r)}),this.relay.getCLOSEDObservable().subscribe(async({subId:r,notice:i})=>{this.subs.get(r)&&(this.authProxy&&i!=null&&i.startsWith("auth-required:")?this.authRequiredSubs.add(r):this.fin(r))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{var i;if(r)for(const s of this.authRequiredSubs){const o=(i=this.subs.get(s))==null?void 0:i.req;o&&this.sendREQ(o)}else for(const s of this.authRequiredSubs)this.fin(s);this.authRequiredSubs.clear()})}subscribe(e,n){if(this.disposed)return;const r=e[1],i={subId:r,req:e,autoclose:n};this.subs.set(r,i),this.queue.enqueue(i)}unsubscribe(e){this.disposed||(this.subs.has(e)&&this.sendCLOSE(e),this.fin(e))}isOngoingOrQueued(e){return this.subs.has(e)}getEventObservable(){return this.relay.getEVENTObservable().pipe(ti(({subId:e,event:n})=>{var r;const i=(r=this.subs.get(e))==null?void 0:r.filters;return i?this.config.skipValidateFilterMatching||N$(n,i):!1}))}getFinObservable(){return this.fin$.asObservable()}getLogicalConnectionSizeObservable(){return this.queue.getSizeObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.fin$];for(const n of e)n.complete();this.queue.dispose()}sendREQ([,e,...n]){const r=$$(n),i=this.subs.get(e);i&&(i.filters=r,this.relay.send(["REQ",e,...r]))}sendCLOSE(e){this.relay.send(["CLOSE",e])}fin(e){this.subs.delete(e),this.queue.drop(e),this.fin$.next({from:this.relay.url,subId:e})}},Z6=class{constructor(e,n){Fe(this,"_queuings",[]),Fe(this,"_ongoings",[]),Fe(this,"activated$",new Wt),Fe(this,"count$",new tA),this.url=e,this.config=n}get queuings(){return this._queuings}set queuings(e){this._queuings=e}get ongoings(){return this._ongoings}set ongoings(e){this._ongoings=e}enqueue(e){this.queuings=[...this.queuings,e],this.count$.increment(),this.shift()}drop(e){const n=(a,l)=>{const c=a.length,u=a.filter(h=>h.subId!==l),f=c-u.length;return[u,f]},[r,i]=n(this.queuings,e),[s,o]=n(this.ongoings,e);this.queuings=r,this.ongoings=s,this.count$.next(a=>a-(i+o)),this.shift()}getActivationObservable(){return this.activated$.asObservable()}getSizeObservable(){return this.count$.asObservable()}dispose(){const e=[this.activated$,this.count$];for(const n of e)n.complete()}async shift(){const e=await this.capacity(),n=[...this.ongoings,...this.queuings],r=n.slice(0,e),i=n.slice(e),s=this.queuings.slice(0,e-this.ongoings.length);this.ongoings=r,this.queuings=i,s.length>0&&this.activated$.next(s)}async capacity(){return await Jf.getValue(this.url,e=>{var n;return(n=e.limitation)==null?void 0:n.max_subscriptions},{skipFetch:this.config.skipFetchNip11})??1/0}},Y6=class{constructor(e,n){Fe(this,"relay"),Fe(this,"pubProxy"),Fe(this,"subProxy"),Fe(this,"defaultSubscriptionIds",new Set),Fe(this,"communicating",!1),Fe(this,"strategy","lazy"),Fe(this,"disconnectTimeout"),Fe(this,"disconnectTimer"),Fe(this,"isDefaultRelay",!1),Fe(this,"disposed",!1),Fe(this,"_url"),this._url=ms(e);const r=J6(e,n),i=new W6(this.url,n),s=r?new j6({relay:i,config:n,authenticator:r}):null,o=new V6({relay:i,authProxy:s}),a=new G6({relay:i,authProxy:s,config:n});this.relay=i,this.pubProxy=o,this.subProxy=a,this.disconnectTimeout=n.disconnectTimeout,T6([this.pubProxy.getLogicalConnectionSizeObservable(),this.subProxy.getLogicalConnectionSizeObservable()]).pipe(Mo(([l,c])=>l+c)).subscribe(l=>{this.communicating=l>0,this.resetConnection()})}get url(){return this._url}setConnectionStrategy(e){this.disposed||(this.strategy=e,this.resetConnection())}resetConnection(){let e=this.strategy;switch(this.isDefaultRelay||(e="lazy"),e){case"lazy":{const n=()=>{this.communicating||this.relay.disconnect(al.RX_NOSTR_IDLE)};this.disconnectTimeout>0?(this.disconnectTimeout&&(clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0),this.disconnectTimer=setTimeout(n,this.disconnectTimeout)):n();break}case"lazy-keep":break;case"aggressive":{(this.connectionState==="initialized"||this.connectionState==="dormant")&&this.relay.connectManually();break}}}markAsDefault(e){if(!this.disposed){if(this.isDefaultRelay=e,!this.isDefaultRelay){for(const n of this.defaultSubscriptionIds)this.subProxy.unsubscribe(n);this.defaultSubscriptionIds.clear()}this.resetConnection()}}async publish(e){if(!this.disposed)return this.pubProxy.publish(e)}confirmOK(e){this.disposed||this.pubProxy.confirmOK(e)}subscribe(e,n){if(this.disposed)return;const{mode:r,overwrite:i,autoclose:s}=Tu(n??{},{overwrite:!1,autoclose:!1,mode:"default"}),[,o]=e;r==="default"&&!this.isDefaultRelay||!i&&this.subProxy.isOngoingOrQueued(o)||(r==="default"&&this.defaultSubscriptionIds.add(o),this.subProxy.subscribe(e,s))}unsubscribe(e){this.disposed||(this.defaultSubscriptionIds.delete(e),this.subProxy.unsubscribe(e))}getEventObservable(){if(this.disposed)throw new ps;return this.subProxy.getEventObservable()}getFinObservable(){if(this.disposed)throw new ps;return this.subProxy.getFinObservable()}getOkAgainstEventObservable(){if(this.disposed)throw new ps;return this.pubProxy.getOkAgainstEventObservable()}getAllMessageObservable(){if(this.disposed)throw new ps;return this.relay.getAllMessageObservable()}getOutgoingMessageObservable(){if(this.disposed)throw new ps;return this.relay.getOutgoingMessageObservable()}getConnectionStateObservable(){if(this.disposed)throw new ps;return this.relay.getConnectionStateObservable()}get connectionState(){return this.relay.state}getErrorObservable(){if(this.disposed)throw new ps;return this.relay.getErrorObservable().pipe(Mo(e=>({from:this.url,reason:e})))}connectManually(){this.relay.connectManually()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){this.disposed||(this.disposed=!0,this.disconnectTimer&&clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0,this.relay.dispose(),this.pubProxy.dispose(),this.subProxy.dispose())}};function J6(t,e){const n=e.authenticator;if(!n)return;const r=n instanceof Function?n(t):n;return r==="auto"?{}:r}function X6(t,e){return t.filter(n=>!e.includes(n))}function Q6(t){const{rxReq:e,index:n}=t,{rxReqId:r,strategy:i}=e;return`${r}:${i==="backward"?n:0}`}function eM(t){const{rxReq:e,filters:n,index:r}=t;return["REQ",Q6({rxReq:e,index:r}),...n]}function Tv(t){if(Array.isArray(t)){const e=t.map(n=>{let r="",i=!1,s=!1;if(typeof n=="string")r=n,i=!0,s=!0;else if(Array.isArray(n)){const o=n[2];r=n[1],i=!o||o==="read",s=!o||o==="write"}else r=n.url,i=n.read,s=n.write;return{url:r,read:i,write:s}});return Object.fromEntries(e.map(n=>[n.url,n]))}else{const e=Object.entries(t).map(([n,r])=>({url:n,...r}));return Object.fromEntries(e.map(n=>[n.url,n]))}}function Iv(t,e){const n=new Set;if(e!=null&&e.on){const r=e.on;if(!r.defaultReadRelays&&!r.defaultWriteRelays&&!r.relays)return;const i=t.getDefaultRelays();if(r.defaultReadRelays)for(const{url:s}of Object.values(i).filter(o=>o.read))n.add(s);if(r.defaultWriteRelays)for(const{url:s}of Object.values(i).filter(o=>o.write))n.add(s);if(r.relays)for(const s of r.relays)n.add(ms(s));return[...n]}else if(e!=null&&e.relays){for(const r of e.relays)n.add(ms(r));return[...n]}else return}function tM(t){return new nM(O$(t??{}))}let nM=class{constructor(e){Fe(this,"connections",new Of),Fe(this,"defaultRelays",new Of),Fe(this,"defaultSubscriptions",new Map),Fe(this,"event$",new Wt),Fe(this,"fin$",new Wt),Fe(this,"ok$",new Wt),Fe(this,"all$",new Wt),Fe(this,"error$",new Wt),Fe(this,"connectionState$",new Wt),Fe(this,"outgoing$",new Wt),Fe(this,"dispose$",new Wt),Fe(this,"disposed",!1),this.config=e}get defaultReadables(){const e=[];for(const{url:n,read:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}get defaultWritables(){const e=[];for(const{url:n,write:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}getDefaultRelays(){if(this.disposed)throw new ps;return this.defaultRelays.toObject()}getDefaultRelay(e){return this.defaultRelays.get(e)}setDefaultRelays(e){if(this.disposed)throw new ps;const n=new Of(Tv(e)),r=[];for(const{read:i,url:s}of n.values()){const o=this.ensureNostrConnection(s);o.setConnectionStrategy(this.config.connectionStrategy),i&&r.push(o)}this.updateDefaultSubscriptions(r),this.defaultRelays=n}ensureNostrConnection(e){let n=this.connections.get(e);return n||(n=new Y6(e,this.config),this.attachNostrConnection(n),this.connections.set(e,n),n)}attachNostrConnection(e){e.getEventObservable().subscribe(this.event$),e.getFinObservable().subscribe(this.fin$),e.getOkAgainstEventObservable().subscribe(this.ok$),e.getAllMessageObservable().subscribe(this.all$),e.getConnectionStateObservable().subscribe(this.connectionState$),e.getErrorObservable().subscribe(this.error$),e.getOutgoingMessageObservable().subscribe(this.outgoing$)}updateDefaultSubscriptions(e){const n=X6(this.defaultReadables,e);for(const r of n)r.markAsDefault(!1);for(const r of e){r.markAsDefault(!0);for(const{req:i,autoclose:s}of this.defaultSubscriptions.values())r?.subscribe(i,{mode:"default",overwrite:!1,autoclose:s})}}addDefaultRelays(e){const n=Tv(e);this.setDefaultRelays({...this.defaultRelays.toObject(),...n})}removeDefaultRelays(e){const n=this.defaultRelays.copy(),r=Array.isArray(e)?e:[e];for(const i of r)n.delete(i);this.setDefaultRelays(n.toObject())}getAllRelayStatus(){return Object.fromEntries(Array.from(this.connections.values()).map(e=>[e.url,{connection:e.connectionState}]))}getRelayStatus(e){const n=this.connections.get(e);if(n)return{connection:n.connectionState}}reconnect(e){const n=this.getDefaultRelay(e);if(!n)throw new If(`The relay (${e}) is not a default relay. \`reconnect()\` can be used only for a readable default relay.`);if(!n.read)throw new If(`The relay (${e}) is not readable. \`reconnect()\` can be used only for a readable default relay.`);const r=this.connections.get(e);if(!r)throw new CS;(r.connectionState==="error"||r.connectionState==="rejected")&&r.connectManually()}use(e,n){const r=Iv(this,n),i=({filters:u,relays:f},h)=>{var d;const p=e.strategy==="backward"?f:void 0,g=eM({rxReq:e,filters:u,index:h});return{subId:g[1],req:g,targetConnections:((d=p??r)==null?void 0:d.map(b=>this.ensureNostrConnection(b)))??this.defaultReadables,mode:p===void 0&&r===void 0?"default":"temporary"}},s=({req:u,targetConnections:f,mode:h})=>{this.startSubscription({req:u,targetConnections:f,mode:h,overwrite:e.strategy==="forward",autoclose:e.strategy==="backward"})},o=({subId:u,targetConnections:f,mode:h})=>{this.teardownSubscription({subId:u,targetConnections:f,mode:h})},a=({req:u,targetConnections:f})=>e.strategy==="forward"?this.createForwardEventObservable({req:u}).pipe(mc(this.dispose$)):this.createBackwardEventObservable({req:u,targetConnections:f}).pipe(mc(this.dispose$)),l=e.getReqPacketObservable().pipe(ti(({filters:u})=>u.length>0),Mo(i),mc(this.dispose$)),c=()=>z6(async({event:u})=>(this.config.skipVerify||await this.config.verifier(u))&&(this.config.skipExpirationCheck||!L$(u)));if(e.strategy==="forward"){let u;return l.pipe(rf(f=>{u=f}),rf(s),Mo(a),gg(()=>{u&&o(u)}),H6(),c())}else return l.pipe(rf(s),Mo(u=>a(u).pipe(gg(()=>{o(u)}))),QS(),c())}createForwardEventObservable(e){const{req:n}=e,r=n[1];return this.event$.pipe(mg(r))}createBackwardEventObservable(e){const{req:n,targetConnections:r}=e,i=n[1],s=new Set,o=u=>u==="error"||u==="rejected"||u==="terminated",a=()=>r.every(({connectionState:u,url:f})=>o(u)||s.has(f)),l=this.fin$.pipe(mg(i),rf(({from:u})=>{s.add(u)})),c=$6(l,this.connectionState$.asObservable()).pipe(ti(()=>a()),Qm(null,void 0));return this.event$.pipe(mc(c),_v(this.config.eoseTimeout),mg(i),ti(u=>!s.has(u.from)))}startSubscription(e){const{req:n,targetConnections:r,mode:i,overwrite:s,autoclose:o}=e,a=n[1];i==="default"&&this.defaultSubscriptions.set(a,{req:n,autoclose:o});for(const l of r)l.subscribe(n,{mode:i,overwrite:s,autoclose:o})}teardownSubscription(e){const{subId:n,targetConnections:r,mode:i}=e;i==="default"&&this.defaultSubscriptions.delete(n);for(const s of r)s.unsubscribe(n)}createAllEventObservable(){return this.event$.asObservable()}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.all$.asObservable()}createConnectionStateObservable(){return this.connectionState$.asObservable()}createOutgoingMessageObservable(){return this.outgoing$.asObservable()}send(e,n){const{signer:r,errorOnTimeout:i,completeOn:s}=Tu(n??{},{signer:this.config.signer,errorOnTimeout:!1,completeOn:"all-ok"}),o=Iv(this,n),a=o===void 0?this.defaultWritables:o.map(d=>this.ensureNostrConnection(d)),l=new Wt,c=new Set;let u="";const f=()=>{l.closed||l.complete();for(const d of a)d.confirmOK(u)};r.signEvent(e).then(async d=>{l.closed||(u=d.id,this.ok$.pipe(ti(({eventId:p})=>p===d.id)).subscribe(l),await Promise.all(a.map(p=>p.publish(d))),s==="sent"&&l.complete())}).catch(d=>{throw f(),new If(d instanceof Error?d.message:"Failed to sign the given event")});const h=(()=>{switch(s){case"sent":return js;case"all-ok":return U6(({from:d,done:p})=>(p&&c.add(d),c.size<a.length),!0);case"any-ok":return Qm(d=>d.ok)}})();return l.pipe(h,mc(this.dispose$),i?XS(this.config.okTimeout):_v(this.config.okTimeout),gg(f))}async cast(e,n){await ZS(this.send(e,{...n,completeOn:"sent"}))}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;for(const n of this.connections.values())n.dispose();this.connections.clear();const e=[this.event$,this.ok$,this.fin$,this.all$,this.connectionState$,this.error$,this.outgoing$];for(const n of e)n.complete();this.dispose$.next(),this.dispose$.complete()}};const nA=t=>{const{strategy:e}=t,n=t.operators??[],r=t.rxReqId??rM(),i=t.subject??new Wt;return{strategy:e,rxReqId:r,getReqPacketObservable(){return i.pipe(...n)},pipe(...s){return nA({strategy:e,rxReqId:r,operators:[...n,...s],subject:i})},emit(s,o){i.next({filters:sM(s),...o??{}})},over(){i.complete()}}};function Mf(t){return nA({strategy:"forward",rxReqId:t})}function rM(){return`${Math.floor(Math.random()*1e6)}`}function iM(t){var e,n;const r={},i=s=>/^#[a-zA-Z]$/.test(s);for(const s of Object.keys(t)){if(s==="limit"&&(t[s]??-1)>=0){r[s]=t[s];continue}if(s==="since"||s==="until"){const o=t[s];if(typeof o!="number"||(o??-1)>=0){r[s]=o;continue}}if((i(s)||s==="ids"||s==="authors")&&t[s]!==void 0&&(((e=t[s])==null?void 0:e.length)??-1)>0){r[s]=t[s];continue}if(s==="kinds"&&t[s]!==void 0&&(((n=t[s])==null?void 0:n.length)??-1)>0){r[s]=t[s];continue}if(s==="search"&&t[s]!==void 0){r[s]=t[s];continue}}return typeof r.since!="number"||typeof r.until!="number"||r.since<=r.until?r:null}function sM(t){return(Array.isArray(t)?t:[t]).map(e=>iM(e)).filter(e=>e!==null)}function Ov(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function oM(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Mu(t,...e){if(!oM(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function aM(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ov(t.outputLen),Ov(t.blockLen)}function th(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function lM(t,e){Mu(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const yg=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const bg=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ci=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const cM=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function nh(t){Mu(t);let e="";for(let n=0;n<t.length;n++)e+=cM[t[n]];return e}function uM(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Fy(t){return typeof t=="string"&&(t=uM(t)),Mu(t),t}function fM(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Mu(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}let rA=class{clone(){return this._cloneInto()}};function hM(t){const e=r=>t().update(Fy(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function iA(t=32){if(yg&&typeof yg.getRandomValues=="function")return yg.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function dM(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const pM=(t,e,n)=>t&e^~t&n,gM=(t,e,n)=>t&e^t&n^e&n;let mM=class extends rA{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=bg(this.buffer)}update(e){th(this);const{view:n,buffer:r,blockLen:i}=this;e=Fy(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=bg(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){th(this),lM(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;dM(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=bg(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const yM=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),no=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ro=new Uint32Array(64);let bM=class extends mM{constructor(){super(64,32,8,!1),this.A=no[0]|0,this.B=no[1]|0,this.C=no[2]|0,this.D=no[3]|0,this.E=no[4]|0,this.F=no[5]|0,this.G=no[6]|0,this.H=no[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let f=0;f<16;f++,n+=4)ro[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=ro[f-15],d=ro[f-2],p=Ci(h,7)^Ci(h,18)^h>>>3,g=Ci(d,17)^Ci(d,19)^d>>>10;ro[f]=g+ro[f-7]+p+ro[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=Ci(a,6)^Ci(a,11)^Ci(a,25),d=u+h+pM(a,l,c)+yM[f]+ro[f]|0,p=(Ci(r,2)^Ci(r,13)^Ci(r,22))+gM(r,i,s)|0;u=c,c=l,l=a,a=o+d|0,o=s,s=i,i=r,r=d+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){ro.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const rh=hM(()=>new bM);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sA=BigInt(0),Rd=BigInt(1),wM=BigInt(2);function $a(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Nu(t){if(!$a(t))throw new Error("Uint8Array expected")}const vM=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ml(t){Nu(t);let e="";for(let n=0;n<t.length;n++)e+=vM[t[n]];return e}function oA(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function jy(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}const ls={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function $v(t){if(t>=ls._0&&t<=ls._9)return t-ls._0;if(t>=ls._A&&t<=ls._F)return t-(ls._A-10);if(t>=ls._a&&t<=ls._f)return t-(ls._a-10)}function Nl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=$v(t.charCodeAt(s)),a=$v(t.charCodeAt(s+1));if(o===void 0||a===void 0){const l=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function Tr(t){return jy(Ml(t))}function qy(t){return Nu(t),jy(Ml(Uint8Array.from(t).reverse()))}function Fo(t,e){return Nl(t.toString(16).padStart(e*2,"0"))}function Vy(t,e){return Fo(t,e).reverse()}function EM(t){return Nl(oA(t))}function Qn(t,e,n){let r;if(typeof e=="string")try{r=Nl(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if($a(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Ma(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Nu(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}function xM(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function SM(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function AM(t){let e;for(e=0;t>sA;t>>=Rd,e+=1);return e}function kM(t,e){return t>>BigInt(e)&Rd}function _M(t,e,n){return t|(n?Rd:sA)<<BigInt(e)}const Wy=t=>(wM<<BigInt(t-1))-Rd,wg=t=>new Uint8Array(t),Mv=t=>Uint8Array.from(t);function aA(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=wg(t),i=wg(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=wg())=>{i=a(Mv([0]),u),r=a(),u.length!==0&&(i=a(Mv([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const f=[];for(;u<e;){r=a();const h=r.slice();f.push(h),u+=r.length}return Ma(...f)};return(u,f)=>{o(),l(u);let h;for(;!(h=f(c()));)l();return o(),h}}const CM={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||$a(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Lu(t,e,n={}){const r=(i,s,o)=>{const a=CM[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const TM=Object.freeze(Object.defineProperty({__proto__:null,abytes:Nu,bitGet:kM,bitLen:AM,bitMask:Wy,bitSet:_M,bytesToHex:Ml,bytesToNumberBE:Tr,bytesToNumberLE:qy,concatBytes:Ma,createHmacDrbg:aA,ensureBytes:Qn,equalBytes:xM,hexToBytes:Nl,hexToNumber:jy,isBytes:$a,numberToBytesBE:Fo,numberToBytesLE:Vy,numberToHexUnpadded:oA,numberToVarBytesBE:EM,utf8ToBytes:SM,validateObject:Lu},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const En=BigInt(0),en=BigInt(1),ua=BigInt(2),IM=BigInt(3),e0=BigInt(4),Nv=BigInt(5),Lv=BigInt(8);BigInt(9);BigInt(16);function Pn(t,e){const n=t%e;return n>=En?n:e+n}function OM(t,e,n){if(n<=En||e<En)throw new Error("Expected power/modulo > 0");if(n===en)return En;let r=en;for(;e>En;)e&en&&(r=r*t%n),t=t*t%n,e>>=en;return r}function jr(t,e,n){let r=t;for(;e-- >En;)r*=r,r%=n;return r}function t0(t,e){if(t===En||e<=En)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Pn(t,e),r=e,i=En,s=en;for(;n!==En;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==en)throw new Error("invert: does not exist");return Pn(i,e)}function $M(t){const e=(t-en)/ua;let n,r,i;for(n=t-en,r=0;n%ua===En;n/=ua,r++);for(i=ua;i<t&&OM(i,e,t)!==t-en;i++);if(r===1){const o=(t+en)/e0;return function(a,l){const c=a.pow(l,o);if(!a.eql(a.sqr(c),l))throw new Error("Cannot find square root");return c}}const s=(n+en)/ua;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let l=r,c=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),f=o.pow(a,n);for(;!o.eql(f,o.ONE);){if(o.eql(f,o.ZERO))return o.ZERO;let h=1;for(let p=o.sqr(f);h<l&&!o.eql(p,o.ONE);h++)p=o.sqr(p);const d=o.pow(c,en<<BigInt(l-h-1));c=o.sqr(d),u=o.mul(u,d),f=o.mul(f,c),l=h}return u}}function MM(t){if(t%e0===IM){const e=(t+en)/e0;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%Lv===Nv){const e=(t-Nv)/Lv;return function(n,r){const i=n.mul(r,ua),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,ua),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return $M(t)}const NM=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function LM(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=NM.reduce((r,i)=>(r[i]="function",r),e);return Lu(t,n)}function RM(t,e,n){if(n<En)throw new Error("Expected power > 0");if(n===En)return t.ONE;if(n===en)return e;let r=t.ONE,i=e;for(;n>En;)n&en&&(r=t.mul(r,i)),i=t.sqr(i),n>>=en;return r}function PM(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function lA(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function DM(t,e,n=!1,r={}){if(t<=En)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=lA(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=MM(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:Wy(i),ZERO:En,ONE:en,create:l=>Pn(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return En<=l&&l<t},is0:l=>l===En,isOdd:l=>(l&en)===en,neg:l=>Pn(-l,t),eql:(l,c)=>l===c,sqr:l=>Pn(l*l,t),add:(l,c)=>Pn(l+c,t),sub:(l,c)=>Pn(l-c,t),mul:(l,c)=>Pn(l*c,t),pow:(l,c)=>RM(a,l,c),div:(l,c)=>Pn(l*t0(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>t0(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>PM(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?Vy(l,s):Fo(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?qy(l):Tr(l)}});return Object.freeze(a)}function cA(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function uA(t){const e=cA(t);return e+Math.ceil(e/2)}function BM(t,e,n=!1){const r=t.length,i=cA(e),s=uA(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Tr(t):qy(t),a=Pn(o,e-en)+en;return n?Vy(a,i):Fo(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const HM=BigInt(0),vg=BigInt(1);function UM(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>HM;)s&vg&&(o=o.add(a)),a=a.double(),s>>=vg;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let f=0;f<o;f++){u=c,l.push(u);for(let h=1;h<a;h++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const f=BigInt(2**i-1),h=2**i,d=BigInt(i);for(let p=0;p<a;p++){const g=p*l;let b=Number(o&f);o>>=d,b>l&&(b-=h,o+=vg);const w=g,x=g+Math.abs(b)-1,T=p%2!==0,M=b<0;b===0?u=u.add(n(T,s[w])):c=c.add(n(M,s[x]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function fA(t){return LM(t.Fp),Lu(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...lA(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function zM(t){const e=fA(t);Lu(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:FM,hexToBytes:jM}=TM,pa={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=pa;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:FM(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=pa,n=typeof t=="string"?jM(t):t;Nu(n);let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=pa._parseInt(n.subarray(2)),{d:o,l:a}=pa._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},bs=BigInt(0),Yr=BigInt(1);BigInt(2);const Rv=BigInt(3);BigInt(4);function qM(t){const e=zM(t),{Fp:n}=e,r=e.toBytes||((p,g,b)=>{const w=g.toAffine();return Ma(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),i=e.fromBytes||(p=>{const g=p.subarray(1),b=n.fromBytes(g.subarray(0,n.BYTES)),w=n.fromBytes(g.subarray(n.BYTES,2*n.BYTES));return{x:b,y:w}});function s(p){const{a:g,b}=e,w=n.sqr(p),x=n.mul(w,p);return n.add(n.add(x,n.mul(p,g)),b)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&bs<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:g,nByteLength:b,wrapPrivateKey:w,n:x}=e;if(g&&typeof p!="bigint"){if($a(p)&&(p=Ml(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(b*2,"0")}let T;try{T=typeof p=="bigint"?p:Tr(Qn("private key",p,b))}catch{throw new Error(`private key must be ${b} bytes, hex or bigint, not ${typeof p}`)}return w&&(T=Pn(T,x)),a(T),T}const c=new Map;function u(p){if(!(p instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(g,b,w){if(this.px=g,this.py=b,this.pz=w,g==null||!n.isValid(g))throw new Error("x required");if(b==null||!n.isValid(b))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(g){const{x:b,y:w}=g||{};if(!g||!n.isValid(b)||!n.isValid(w))throw new Error("invalid affine point");if(g instanceof f)throw new Error("projective point not allowed");const x=T=>n.eql(T,n.ZERO);return x(b)&&x(w)?f.ZERO:new f(b,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const b=n.invertBatch(g.map(w=>w.pz));return g.map((w,x)=>w.toAffine(b[x])).map(f.fromAffine)}static fromHex(g){const b=f.fromAffine(i(Qn("pointHex",g)));return b.assertValidity(),b}static fromPrivateKey(g){return f.BASE.multiply(l(g))}_setWindowSize(g){this._WINDOW_SIZE=g,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:b}=this.toAffine();if(!n.isValid(g)||!n.isValid(b))throw new Error("bad point: x or y not FE");const w=n.sqr(b),x=s(g);if(!n.eql(w,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(n.isOdd)return!n.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:b,py:w,pz:x}=this,{px:T,py:M,pz:O}=g,_=n.eql(n.mul(b,O),n.mul(T,x)),L=n.eql(n.mul(w,O),n.mul(M,x));return _&&L}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:g,b}=e,w=n.mul(b,Rv),{px:x,py:T,pz:M}=this;let O=n.ZERO,_=n.ZERO,L=n.ZERO,A=n.mul(x,x),E=n.mul(T,T),S=n.mul(M,M),k=n.mul(x,T);return k=n.add(k,k),L=n.mul(x,M),L=n.add(L,L),O=n.mul(g,L),_=n.mul(w,S),_=n.add(O,_),O=n.sub(E,_),_=n.add(E,_),_=n.mul(O,_),O=n.mul(k,O),L=n.mul(w,L),S=n.mul(g,S),k=n.sub(A,S),k=n.mul(g,k),k=n.add(k,L),L=n.add(A,A),A=n.add(L,A),A=n.add(A,S),A=n.mul(A,k),_=n.add(_,A),S=n.mul(T,M),S=n.add(S,S),A=n.mul(S,k),O=n.sub(O,A),L=n.mul(S,E),L=n.add(L,L),L=n.add(L,L),new f(O,_,L)}add(g){u(g);const{px:b,py:w,pz:x}=this,{px:T,py:M,pz:O}=g;let _=n.ZERO,L=n.ZERO,A=n.ZERO;const E=e.a,S=n.mul(e.b,Rv);let k=n.mul(b,T),P=n.mul(w,M),D=n.mul(x,O),H=n.add(b,w),N=n.add(T,M);H=n.mul(H,N),N=n.add(k,P),H=n.sub(H,N),N=n.add(b,x);let I=n.add(T,O);return N=n.mul(N,I),I=n.add(k,D),N=n.sub(N,I),I=n.add(w,x),_=n.add(M,O),I=n.mul(I,_),_=n.add(P,D),I=n.sub(I,_),A=n.mul(E,N),_=n.mul(S,D),A=n.add(_,A),_=n.sub(P,A),A=n.add(P,A),L=n.mul(_,A),P=n.add(k,k),P=n.add(P,k),D=n.mul(E,D),N=n.mul(S,N),P=n.add(P,D),D=n.sub(k,D),D=n.mul(E,D),N=n.add(N,D),k=n.mul(P,N),L=n.add(L,k),k=n.mul(I,N),_=n.mul(H,_),_=n.sub(_,k),k=n.mul(H,P),A=n.mul(I,A),A=n.add(A,k),new f(_,L,A)}subtract(g){return this.add(g.negate())}is0(){return this.equals(f.ZERO)}wNAF(g){return d.wNAFCached(this,c,g,b=>{const w=n.invertBatch(b.map(x=>x.pz));return b.map((x,T)=>x.toAffine(w[T])).map(f.fromAffine)})}multiplyUnsafe(g){const b=f.ZERO;if(g===bs)return b;if(a(g),g===Yr)return this;const{endo:w}=e;if(!w)return d.unsafeLadder(this,g);let{k1neg:x,k1:T,k2neg:M,k2:O}=w.splitScalar(g),_=b,L=b,A=this;for(;T>bs||O>bs;)T&Yr&&(_=_.add(A)),O&Yr&&(L=L.add(A)),A=A.double(),T>>=Yr,O>>=Yr;return x&&(_=_.negate()),M&&(L=L.negate()),L=new f(n.mul(L.px,w.beta),L.py,L.pz),_.add(L)}multiply(g){a(g);let b=g,w,x;const{endo:T}=e;if(T){const{k1neg:M,k1:O,k2neg:_,k2:L}=T.splitScalar(b);let{p:A,f:E}=this.wNAF(O),{p:S,f:k}=this.wNAF(L);A=d.constTimeNegate(M,A),S=d.constTimeNegate(_,S),S=new f(n.mul(S.px,T.beta),S.py,S.pz),w=A.add(S),x=E.add(k)}else{const{p:M,f:O}=this.wNAF(b);w=M,x=O}return f.normalizeZ([w,x])[0]}multiplyAndAddUnsafe(g,b,w){const x=f.BASE,T=(O,_)=>_===bs||_===Yr||!O.equals(x)?O.multiplyUnsafe(_):O.multiply(_),M=T(this,b).add(T(g,w));return M.is0()?void 0:M}toAffine(g){const{px:b,py:w,pz:x}=this,T=this.is0();g==null&&(g=T?n.ONE:n.inv(x));const M=n.mul(b,g),O=n.mul(w,g),_=n.mul(x,g);if(T)return{x:n.ZERO,y:n.ZERO};if(!n.eql(_,n.ONE))throw new Error("invZ was invalid");return{x:M,y:O}}isTorsionFree(){const{h:g,isTorsionFree:b}=e;if(g===Yr)return!0;if(b)return b(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:b}=e;return g===Yr?this:b?b(f,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),r(f,this,g)}toHex(g=!0){return Ml(this.toRawBytes(g))}}f.BASE=new f(e.Gx,e.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const h=e.nBitLength,d=UM(f,e.endo?Math.ceil(h/2):h);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function VM(t){const e=fA(t);return Lu(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function WM(t){const e=VM(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(N){return bs<N&&N<n.ORDER}function a(N){return Pn(N,r)}function l(N){return t0(N,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:h}=qM({...e,toBytes(N,I,$){const V=I.toAffine(),U=n.toBytes(V.x),W=Ma;return $?W(Uint8Array.from([I.hasEvenY()?2:3]),U):W(Uint8Array.from([4]),U,n.toBytes(V.y))},fromBytes(N){const I=N.length,$=N[0],V=N.subarray(1);if(I===i&&($===2||$===3)){const U=Tr(V);if(!o(U))throw new Error("Point is not on curve");const W=f(U);let ee;try{ee=n.sqrt(W)}catch(he){const oe=he instanceof Error?": "+he.message:"";throw new Error("Point is not on curve"+oe)}const X=(ee&Yr)===Yr;return($&1)===1!==X&&(ee=n.neg(ee)),{x:U,y:ee}}else if(I===s&&$===4){const U=n.fromBytes(V.subarray(0,n.BYTES)),W=n.fromBytes(V.subarray(n.BYTES,2*n.BYTES));return{x:U,y:W}}else throw new Error(`Point of length ${I} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),d=N=>Ml(Fo(N,e.nByteLength));function p(N){const I=r>>Yr;return N>I}function g(N){return p(N)?a(-N):N}const b=(N,I,$)=>Tr(N.slice(I,$));class w{constructor(I,$,V){this.r=I,this.s=$,this.recovery=V,this.assertValidity()}static fromCompact(I){const $=e.nByteLength;return I=Qn("compactSignature",I,$*2),new w(b(I,0,$),b(I,$,2*$))}static fromDER(I){const{r:$,s:V}=pa.toSig(Qn("DER",I));return new w($,V)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(I){return new w(this.r,this.s,I)}recoverPublicKey(I){const{r:$,s:V,recovery:U}=this,W=L(Qn("msgHash",I));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const ee=U===2||U===3?$+e.n:$;if(ee>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const X=U&1?"03":"02",he=c.fromHex(X+d(ee)),oe=l(ee),Y=a(-W*oe),be=a(V*oe),Re=c.BASE.multiplyAndAddUnsafe(he,Y,be);if(!Re)throw new Error("point at infinify");return Re.assertValidity(),Re}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Nl(this.toDERHex())}toDERHex(){return pa.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Nl(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const x={isValidPrivateKey(N){try{return u(N),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const N=uA(e.n);return BM(e.randomBytes(N),e.n)},precompute(N=8,I=c.BASE){return I._setWindowSize(N),I.multiply(BigInt(3)),I}};function T(N,I=!0){return c.fromPrivateKey(N).toRawBytes(I)}function M(N){const I=$a(N),$=typeof N=="string",V=(I||$)&&N.length;return I?V===i||V===s:$?V===2*i||V===2*s:N instanceof c}function O(N,I,$=!0){if(M(N))throw new Error("first arg must be private key");if(!M(I))throw new Error("second arg must be public key");return c.fromHex(I).multiply(u(N)).toRawBytes($)}const _=e.bits2int||function(N){const I=Tr(N),$=N.length*8-e.nBitLength;return $>0?I>>BigInt($):I},L=e.bits2int_modN||function(N){return a(_(N))},A=Wy(e.nBitLength);function E(N){if(typeof N!="bigint")throw new Error("bigint expected");if(!(bs<=N&&N<A))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Fo(N,e.nByteLength)}function S(N,I,$=k){if(["recovered","canonical"].some(Me=>Me in $))throw new Error("sign() legacy options not supported");const{hash:V,randomBytes:U}=e;let{lowS:W,prehash:ee,extraEntropy:X}=$;W==null&&(W=!0),N=Qn("msgHash",N),ee&&(N=Qn("prehashed msgHash",V(N)));const he=L(N),oe=u(I),Y=[E(oe),E(he)];if(X!=null&&X!==!1){const Me=X===!0?U(n.BYTES):X;Y.push(Qn("extraEntropy",Me))}const be=Ma(...Y),Re=he;function de(Me){const ce=_(Me);if(!h(ce))return;const xe=l(ce),Te=c.BASE.multiply(ce).toAffine(),qe=a(Te.x);if(qe===bs)return;const et=a(xe*a(Re+qe*oe));if(et===bs)return;let Ze=(Te.x===qe?0:2)|Number(Te.y&Yr),pe=et;return W&&p(et)&&(pe=g(et),Ze^=1),new w(qe,pe,Ze)}return{seed:be,k2sig:de}}const k={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function D(N,I,$=k){const{seed:V,k2sig:U}=S(N,I,$),W=e;return aA(W.hash.outputLen,W.nByteLength,W.hmac)(V,U)}c.BASE._setWindowSize(8);function H(N,I,$,V=P){var U;const W=N;if(I=Qn("msgHash",I),$=Qn("publicKey",$),"strict"in V)throw new Error("options.strict was renamed to lowS");const{lowS:ee,prehash:X}=V;let he,oe;try{if(typeof W=="string"||$a(W))try{he=w.fromDER(W)}catch(Te){if(!(Te instanceof pa.Err))throw Te;he=w.fromCompact(W)}else if(typeof W=="object"&&typeof W.r=="bigint"&&typeof W.s=="bigint"){const{r:Te,s:qe}=W;he=new w(Te,qe)}else throw new Error("PARSE");oe=c.fromHex($)}catch(Te){if(Te.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(ee&&he.hasHighS())return!1;X&&(I=e.hash(I));const{r:Y,s:be}=he,Re=L(I),de=l(be),Me=a(Re*de),ce=a(Y*de),xe=(U=c.BASE.multiplyAndAddUnsafe(oe,Me,ce))==null?void 0:U.toAffine();return xe?a(xe.x)===Y:!1}return{CURVE:e,getPublicKey:T,getSharedSecret:O,sign:D,verify:H,ProjectivePoint:c,Signature:w,utils:x}}let hA=class extends rA{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,aM(e);const r=Fy(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return th(this),this.iHash.update(e),this}digestInto(e){th(this),Mu(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const dA=(t,e,n)=>new hA(t,e).update(n).digest();dA.create=(t,e)=>new hA(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function KM(t){return{hash:t,hmac:(e,...n)=>dA(t,e,fM(...n)),randomBytes:iA}}function GM(t,e){const n=r=>WM({...t,...KM(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Pd=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ih=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),pA=BigInt(1),sh=BigInt(2),Pv=(t,e)=>(t+e/sh)/e;function gA(t){const e=Pd,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,f=jr(u,n,e)*u%e,h=jr(f,n,e)*u%e,d=jr(h,sh,e)*c%e,p=jr(d,i,e)*d%e,g=jr(p,s,e)*p%e,b=jr(g,a,e)*g%e,w=jr(b,l,e)*b%e,x=jr(w,a,e)*g%e,T=jr(x,n,e)*u%e,M=jr(T,o,e)*p%e,O=jr(M,r,e)*c%e,_=jr(O,sh,e);if(!n0.eql(n0.sqr(_),t))throw new Error("Cannot find square root");return _}const n0=DM(Pd,void 0,void 0,{sqrt:gA}),Ky=GM({a:BigInt(0),b:BigInt(7),Fp:n0,n:ih,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=ih,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-pA*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Pv(s*t,e),l=Pv(-r*t,e);let c=Pn(t-a*n-l*i,e),u=Pn(-a*r-l*s,e);const f=c>o,h=u>o;if(f&&(c=e-c),h&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:c,k2neg:h,k2:u}}}},rh),Dd=BigInt(0),mA=t=>typeof t=="bigint"&&Dd<t&&t<Pd,ZM=t=>typeof t=="bigint"&&Dd<t&&t<ih,Dv={};function oh(t,...e){let n=Dv[t];if(n===void 0){const r=rh(Uint8Array.from(t,i=>i.charCodeAt(0)));n=Ma(r,r),Dv[t]=n}return rh(Ma(n,...e))}const Gy=t=>t.toRawBytes(!0).slice(1),r0=t=>Fo(t,32),Eg=t=>Pn(t,Pd),ru=t=>Pn(t,ih),Zy=Ky.ProjectivePoint,YM=(t,e,n)=>Zy.BASE.multiplyAndAddUnsafe(t,e,n);function i0(t){let e=Ky.utils.normPrivateKeyToScalar(t),n=Zy.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:ru(-e),bytes:Gy(n)}}function yA(t){if(!mA(t))throw new Error("bad x: need 0 < x < p");const e=Eg(t*t),n=Eg(e*t+BigInt(7));let r=gA(n);r%sh!==Dd&&(r=Eg(-r));const i=new Zy(t,r,pA);return i.assertValidity(),i}function bA(...t){return ru(Tr(oh("BIP0340/challenge",...t)))}function JM(t){return i0(t).bytes}function XM(t,e,n=iA(32)){const r=Qn("message",t),{bytes:i,scalar:s}=i0(e),o=Qn("auxRand",n,32),a=r0(s^Tr(oh("BIP0340/aux",o))),l=oh("BIP0340/nonce",a,i,r),c=ru(Tr(l));if(c===Dd)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=i0(c),h=bA(u,i,r),d=new Uint8Array(64);if(d.set(u,0),d.set(r0(ru(f+h*s)),32),!wA(d,r,i))throw new Error("sign: Invalid signature produced");return d}function wA(t,e,n){const r=Qn("signature",t,64),i=Qn("message",e),s=Qn("publicKey",n,32);try{const o=yA(Tr(s)),a=Tr(r.subarray(0,32));if(!mA(a))return!1;const l=Tr(r.subarray(32,64));if(!ZM(l))return!1;const c=bA(r0(a),Gy(o),i),u=YM(o,l,ru(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const xg={getPublicKey:JM,sign:XM,verify:wA,utils:{randomPrivateKey:Ky.utils.randomPrivateKey,lift_x:yA,pointToBytes:Gy,numberToBytesBE:Fo,bytesToNumberBE:Tr,taggedHash:oh,mod:Pn}};/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function QM(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function eN(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function tN(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function nN(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}const vA=(t,e)=>e?vA(e,t%e):t,ah=(t,e)=>t+(e-vA(t,e));function s0(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(ah(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${ah(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function rN(t,e=!1){if(ah(8,t)>32||ah(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!QM(n))throw new Error("radix2.encode input should be Uint8Array");return s0(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(s0(n,t,8,e))}}}function Bv(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const o0=eN(tN("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),nN("")),Hv=[996825010,642813549,513874426,1027748829,705979059];function yc(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<Hv.length;r++)(e>>r&1)===1&&(n^=Hv[r]);return n}function Uv(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=yc(i)^o>>5}i=yc(i);for(let s=0;s<r;s++)i=yc(i)^t.charCodeAt(s)&31;for(let s of e)i=yc(i)^s;for(let s=0;s<6;s++)i=yc(i);return i^=n,o0.encode(s0([i%2**30],30,5,!1))}function iN(t){const n=rN(5),r=n.decode,i=n.encode,s=Bv(r);function o(u,f,h=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);if(u.length===0)throw new TypeError(`Invalid prefix length ${u.length}`);const d=u.length+7+f.length;if(h!==!1&&d>h)throw new TypeError(`Length ${d} exceeds limit ${h}`);const p=u.toLowerCase(),g=Uv(p,f,1);return`${p}1${o0.encode(f)}${g}`}function a(u,f=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||f!==!1&&u.length>f)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${f})`);const h=u.toLowerCase();if(u!==h&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");const d=h.lastIndexOf("1");if(d===0||d===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=h.slice(0,d),g=h.slice(d+1);if(g.length<6)throw new Error("Data must be at least 6 characters long");const b=o0.decode(g).slice(0,-6),w=Uv(p,b,1);if(!g.endsWith(w))throw new Error(`Invalid checksum in ${u}: expected "${w}"`);return{prefix:p,words:b}}const l=Bv(a);function c(u){const{prefix:f,words:h}=a(u,!1);return{prefix:f,words:h,bytes:r(h)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const zv=iN(),sN=new TextEncoder;function oN(t){return nh(rh(sN.encode(t)))}const Yy={sign:(t,e)=>nh(xg.sign(t,e)),verify:xg.verify,getPublicKey:t=>nh(xg.getPublicKey(t))};function aN(t){return Yy.getPublicKey(t)}function EA(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return oN(e)}function lN(t,e){return Yy.sign(t,e)}function cN(t){try{return Yy.verify(t.sig,EA(t),t.pubkey)}catch(e){return console.warn("The following error occurred during verify():",e),!1}}function uN(t){const{words:e}=zv.decode(t),n=new Uint8Array(zv.fromWords(e));return nh(n)}function xA(t,e){const n=t.startsWith("nsec1")?uN(t):t,r=aN(n);return{async signEvent(i){const s={...i,pubkey:i.pubkey??r,tags:[...i.tags??[]],created_at:i.created_at??Math.floor(Date.now()/1e3)};if(fN(s))return s;const o=s.id??EA(s),a=s.sig??lN(o,n);return{...s,id:o,sig:a}},async getPublicKey(){return r}}}function fN(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}const hN=async t=>cN(t),dN="modulepreload",pN=function(t){return"/ehagaki/"+t},Fv={},iu=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let c=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};var o=c;document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");i=c(n.map(u=>{if(u=pN(u),u in Fv)return;Fv[u]=!0;const f=u.endsWith(".css"),h=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const d=document.createElement("link");if(d.rel=f?"stylesheet":dN,f||(d.as="script"),d.crossOrigin="",d.href=u,l&&d.setAttribute("nonce",l),document.head.appendChild(d),f)return new Promise((p,g)=>{d.addEventListener("load",p),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})};var jv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gN(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Sg,qv;function mN(){if(qv)return Sg;qv=1;var t=function(x){return e(x)&&!n(x)};function e(w){return!!w&&typeof w=="object"}function n(w){var x=Object.prototype.toString.call(w);return x==="[object RegExp]"||x==="[object Date]"||s(w)}var r=typeof Symbol=="function"&&Symbol.for,i=r?Symbol.for("react.element"):60103;function s(w){return w.$$typeof===i}function o(w){return Array.isArray(w)?[]:{}}function a(w,x){return x.clone!==!1&&x.isMergeableObject(w)?g(o(w),w,x):w}function l(w,x,T){return w.concat(x).map(function(M){return a(M,T)})}function c(w,x){if(!x.customMerge)return g;var T=x.customMerge(w);return typeof T=="function"?T:g}function u(w){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(w).filter(function(x){return Object.propertyIsEnumerable.call(w,x)}):[]}function f(w){return Object.keys(w).concat(u(w))}function h(w,x){try{return x in w}catch{return!1}}function d(w,x){return h(w,x)&&!(Object.hasOwnProperty.call(w,x)&&Object.propertyIsEnumerable.call(w,x))}function p(w,x,T){var M={};return T.isMergeableObject(w)&&f(w).forEach(function(O){M[O]=a(w[O],T)}),f(x).forEach(function(O){d(w,O)||(h(w,O)&&T.isMergeableObject(x[O])?M[O]=c(O,T)(w[O],x[O],T):M[O]=a(x[O],T))}),M}function g(w,x,T){T=T||{},T.arrayMerge=T.arrayMerge||l,T.isMergeableObject=T.isMergeableObject||t,T.cloneUnlessOtherwiseSpecified=a;var M=Array.isArray(x),O=Array.isArray(w),_=M===O;return _?M?T.arrayMerge(w,x,T):p(w,x,T):a(x,T)}g.all=function(x,T){if(!Array.isArray(x))throw new Error("first argument should be an array");return x.reduce(function(M,O){return g(M,O,T)},{})};var b=g;return Sg=b,Sg}var yN=mN();const bN=gN(yN);var a0=function(t,e){return a0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},a0(t,e)};function Bd(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");a0(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var _t=function(){return _t=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_t.apply(this,arguments)};function wN(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Ag(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function kg(t,e){var n=e&&e.cache?e.cache:_N,r=e&&e.serializer?e.serializer:AN,i=e&&e.strategy?e.strategy:xN;return i(t,{cache:n,serializer:r})}function vN(t){return t==null||typeof t=="number"||typeof t=="boolean"}function EN(t,e,n,r){var i=vN(r)?r:n(r),s=e.get(i);return typeof s>"u"&&(s=t.call(this,r),e.set(i,s)),s}function SA(t,e,n){var r=Array.prototype.slice.call(arguments,3),i=n(r),s=e.get(i);return typeof s>"u"&&(s=t.apply(this,r),e.set(i,s)),s}function AA(t,e,n,r,i){return n.bind(e,t,r,i)}function xN(t,e){var n=t.length===1?EN:SA;return AA(t,this,n,e.cache.create(),e.serializer)}function SN(t,e){return AA(t,this,SA,e.cache.create(),e.serializer)}var AN=function(){return JSON.stringify(arguments)},kN=(function(){function t(){this.cache=Object.create(null)}return t.prototype.get=function(e){return this.cache[e]},t.prototype.set=function(e,n){this.cache[e]=n},t})(),_N={create:function(){return new kN}},_g={variadic:SN},yt;(function(t){t[t.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",t[t.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",t[t.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",t[t.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",t[t.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",t[t.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",t[t.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",t[t.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",t[t.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",t[t.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",t[t.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",t[t.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",t[t.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",t[t.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",t[t.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",t[t.INVALID_TAG=23]="INVALID_TAG",t[t.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",t[t.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",t[t.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(yt||(yt={}));var Ut;(function(t){t[t.literal=0]="literal",t[t.argument=1]="argument",t[t.number=2]="number",t[t.date=3]="date",t[t.time=4]="time",t[t.select=5]="select",t[t.plural=6]="plural",t[t.pound=7]="pound",t[t.tag=8]="tag"})(Ut||(Ut={}));var Ll;(function(t){t[t.number=0]="number",t[t.dateTime=1]="dateTime"})(Ll||(Ll={}));function Vv(t){return t.type===Ut.literal}function CN(t){return t.type===Ut.argument}function kA(t){return t.type===Ut.number}function _A(t){return t.type===Ut.date}function CA(t){return t.type===Ut.time}function TA(t){return t.type===Ut.select}function IA(t){return t.type===Ut.plural}function TN(t){return t.type===Ut.pound}function OA(t){return t.type===Ut.tag}function $A(t){return!!(t&&typeof t=="object"&&t.type===Ll.number)}function l0(t){return!!(t&&typeof t=="object"&&t.type===Ll.dateTime)}var MA=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,IN=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function ON(t){var e={};return t.replace(IN,function(n){var r=n.length;switch(n[0]){case"G":e.era=r===4?"long":r===5?"narrow":"short";break;case"y":e.year=r===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":e.month=["numeric","2-digit","short","long","narrow"][r-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":e.day=["numeric","2-digit"][r-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":e.weekday=r===4?"long":r===5?"narrow":"short";break;case"e":if(r<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"c":if(r<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"a":e.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":e.hourCycle="h12",e.hour=["numeric","2-digit"][r-1];break;case"H":e.hourCycle="h23",e.hour=["numeric","2-digit"][r-1];break;case"K":e.hourCycle="h11",e.hour=["numeric","2-digit"][r-1];break;case"k":e.hourCycle="h24",e.hour=["numeric","2-digit"][r-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":e.minute=["numeric","2-digit"][r-1];break;case"s":e.second=["numeric","2-digit"][r-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":e.timeZoneName=r<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),e}var $N=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function MN(t){if(t.length===0)throw new Error("Number skeleton cannot be empty");for(var e=t.split($N).filter(function(h){return h.length>0}),n=[],r=0,i=e;r<i.length;r++){var s=i[r],o=s.split("/");if(o.length===0)throw new Error("Invalid number skeleton");for(var a=o[0],l=o.slice(1),c=0,u=l;c<u.length;c++){var f=u[c];if(f.length===0)throw new Error("Invalid number skeleton")}n.push({stem:a,options:l})}return n}function NN(t){return t.replace(/^(.*?)-/,"")}var Wv=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,NA=/^(@+)?(\+|#+)?[rs]?$/g,LN=/(\*)(0+)|(#+)(0+)|(0+)/g,LA=/^(0+)$/;function Kv(t){var e={};return t[t.length-1]==="r"?e.roundingPriority="morePrecision":t[t.length-1]==="s"&&(e.roundingPriority="lessPrecision"),t.replace(NA,function(n,r,i){return typeof i!="string"?(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length):i==="+"?e.minimumSignificantDigits=r.length:r[0]==="#"?e.maximumSignificantDigits=r.length:(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length+(typeof i=="string"?i.length:0)),""}),e}function RA(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function RN(t){var e;if(t[0]==="E"&&t[1]==="E"?(e={notation:"engineering"},t=t.slice(2)):t[0]==="E"&&(e={notation:"scientific"},t=t.slice(1)),e){var n=t.slice(0,2);if(n==="+!"?(e.signDisplay="always",t=t.slice(2)):n==="+?"&&(e.signDisplay="exceptZero",t=t.slice(2)),!LA.test(t))throw new Error("Malformed concise eng/scientific notation");e.minimumIntegerDigits=t.length}return e}function Gv(t){var e={},n=RA(t);return n||e}function PN(t){for(var e={},n=0,r=t;n<r.length;n++){var i=r[n];switch(i.stem){case"percent":case"%":e.style="percent";continue;case"%x100":e.style="percent",e.scale=100;continue;case"currency":e.style="currency",e.currency=i.options[0];continue;case"group-off":case",_":e.useGrouping=!1;continue;case"precision-integer":case".":e.maximumFractionDigits=0;continue;case"measure-unit":case"unit":e.style="unit",e.unit=NN(i.options[0]);continue;case"compact-short":case"K":e.notation="compact",e.compactDisplay="short";continue;case"compact-long":case"KK":e.notation="compact",e.compactDisplay="long";continue;case"scientific":e=_t(_t(_t({},e),{notation:"scientific"}),i.options.reduce(function(l,c){return _t(_t({},l),Gv(c))},{}));continue;case"engineering":e=_t(_t(_t({},e),{notation:"engineering"}),i.options.reduce(function(l,c){return _t(_t({},l),Gv(c))},{}));continue;case"notation-simple":e.notation="standard";continue;case"unit-width-narrow":e.currencyDisplay="narrowSymbol",e.unitDisplay="narrow";continue;case"unit-width-short":e.currencyDisplay="code",e.unitDisplay="short";continue;case"unit-width-full-name":e.currencyDisplay="name",e.unitDisplay="long";continue;case"unit-width-iso-code":e.currencyDisplay="symbol";continue;case"scale":e.scale=parseFloat(i.options[0]);continue;case"rounding-mode-floor":e.roundingMode="floor";continue;case"rounding-mode-ceiling":e.roundingMode="ceil";continue;case"rounding-mode-down":e.roundingMode="trunc";continue;case"rounding-mode-up":e.roundingMode="expand";continue;case"rounding-mode-half-even":e.roundingMode="halfEven";continue;case"rounding-mode-half-down":e.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":e.roundingMode="halfExpand";continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(LN,function(l,c,u,f,h,d){if(c)e.minimumIntegerDigits=u.length;else{if(f&&h)throw new Error("We currently do not support maximum integer digits");if(d)throw new Error("We currently do not support exact integer digits")}return""});continue}if(LA.test(i.stem)){e.minimumIntegerDigits=i.stem.length;continue}if(Wv.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(Wv,function(l,c,u,f,h,d){return u==="*"?e.minimumFractionDigits=c.length:f&&f[0]==="#"?e.maximumFractionDigits=f.length:h&&d?(e.minimumFractionDigits=h.length,e.maximumFractionDigits=h.length+d.length):(e.minimumFractionDigits=c.length,e.maximumFractionDigits=c.length),""});var s=i.options[0];s==="w"?e=_t(_t({},e),{trailingZeroDisplay:"stripIfInteger"}):s&&(e=_t(_t({},e),Kv(s)));continue}if(NA.test(i.stem)){e=_t(_t({},e),Kv(i.stem));continue}var o=RA(i.stem);o&&(e=_t(_t({},e),o));var a=RN(i.stem);a&&(e=_t(_t({},e),a))}return e}var sf={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function DN(t,e){for(var n="",r=0;r<t.length;r++){var i=t.charAt(r);if(i==="j"){for(var s=0;r+1<t.length&&t.charAt(r+1)===i;)s++,r++;var o=1+(s&1),a=s<2?1:3+(s>>1),l="a",c=BN(e);for((c=="H"||c=="k")&&(a=0);a-- >0;)n+=l;for(;o-- >0;)n=c+n}else i==="J"?n+="H":n+=i}return n}function BN(t){var e=t.hourCycle;if(e===void 0&&t.hourCycles&&t.hourCycles.length&&(e=t.hourCycles[0]),e)switch(e){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var n=t.language,r;n!=="root"&&(r=t.maximize().region);var i=sf[r||""]||sf[n||""]||sf["".concat(n,"-001")]||sf["001"];return i[0]}var Cg,HN=new RegExp("^".concat(MA.source,"*")),UN=new RegExp("".concat(MA.source,"*$"));function vt(t,e){return{start:t,end:e}}var zN=!!String.prototype.startsWith&&"_a".startsWith("a",1),FN=!!String.fromCodePoint,jN=!!Object.fromEntries,qN=!!String.prototype.codePointAt,VN=!!String.prototype.trimStart,WN=!!String.prototype.trimEnd,KN=!!Number.isSafeInteger,GN=KN?Number.isSafeInteger:function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<=9007199254740991},c0=!0;try{var ZN=DA("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");c0=((Cg=ZN.exec("a"))===null||Cg===void 0?void 0:Cg[0])==="a"}catch{c0=!1}var Zv=zN?function(e,n,r){return e.startsWith(n,r)}:function(e,n,r){return e.slice(r,r+n.length)===n},u0=FN?String.fromCodePoint:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r="",i=e.length,s=0,o;i>s;){if(o=e[s++],o>1114111)throw RangeError(o+" is not a valid code point");r+=o<65536?String.fromCharCode(o):String.fromCharCode(((o-=65536)>>10)+55296,o%1024+56320)}return r},Yv=jN?Object.fromEntries:function(e){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r],o=s[0],a=s[1];n[o]=a}return n},PA=qN?function(e,n){return e.codePointAt(n)}:function(e,n){var r=e.length;if(!(n<0||n>=r)){var i=e.charCodeAt(n),s;return i<55296||i>56319||n+1===r||(s=e.charCodeAt(n+1))<56320||s>57343?i:(i-55296<<10)+(s-56320)+65536}},YN=VN?function(e){return e.trimStart()}:function(e){return e.replace(HN,"")},JN=WN?function(e){return e.trimEnd()}:function(e){return e.replace(UN,"")};function DA(t,e){return new RegExp(t,e)}var f0;if(c0){var Jv=DA("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");f0=function(e,n){var r;Jv.lastIndex=n;var i=Jv.exec(e);return(r=i[1])!==null&&r!==void 0?r:""}}else f0=function(e,n){for(var r=[];;){var i=PA(e,n);if(i===void 0||BA(i)||tL(i))break;r.push(i),n+=i>=65536?2:1}return u0.apply(void 0,r)};var XN=(function(){function t(e,n){n===void 0&&(n={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!n.ignoreTag,this.locale=n.locale,this.requiresOtherClause=!!n.requiresOtherClause,this.shouldParseSkeletons=!!n.shouldParseSkeletons}return t.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},t.prototype.parseMessage=function(e,n,r){for(var i=[];!this.isEOF();){var s=this.char();if(s===123){var o=this.parseArgument(e,r);if(o.err)return o;i.push(o.val)}else{if(s===125&&e>0)break;if(s===35&&(n==="plural"||n==="selectordinal")){var a=this.clonePosition();this.bump(),i.push({type:Ut.pound,location:vt(a,this.clonePosition())})}else if(s===60&&!this.ignoreTag&&this.peek()===47){if(r)break;return this.error(yt.UNMATCHED_CLOSING_TAG,vt(this.clonePosition(),this.clonePosition()))}else if(s===60&&!this.ignoreTag&&h0(this.peek()||0)){var o=this.parseTag(e,n);if(o.err)return o;i.push(o.val)}else{var o=this.parseLiteral(e,n);if(o.err)return o;i.push(o.val)}}}return{val:i,err:null}},t.prototype.parseTag=function(e,n){var r=this.clonePosition();this.bump();var i=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:Ut.literal,value:"<".concat(i,"/>"),location:vt(r,this.clonePosition())},err:null};if(this.bumpIf(">")){var s=this.parseMessage(e+1,n,!0);if(s.err)return s;var o=s.val,a=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!h0(this.char()))return this.error(yt.INVALID_TAG,vt(a,this.clonePosition()));var l=this.clonePosition(),c=this.parseTagName();return i!==c?this.error(yt.UNMATCHED_CLOSING_TAG,vt(l,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:Ut.tag,value:i,children:o,location:vt(r,this.clonePosition())},err:null}:this.error(yt.INVALID_TAG,vt(a,this.clonePosition())))}else return this.error(yt.UNCLOSED_TAG,vt(r,this.clonePosition()))}else return this.error(yt.INVALID_TAG,vt(r,this.clonePosition()))},t.prototype.parseTagName=function(){var e=this.offset();for(this.bump();!this.isEOF()&&eL(this.char());)this.bump();return this.message.slice(e,this.offset())},t.prototype.parseLiteral=function(e,n){for(var r=this.clonePosition(),i="";;){var s=this.tryParseQuote(n);if(s){i+=s;continue}var o=this.tryParseUnquoted(e,n);if(o){i+=o;continue}var a=this.tryParseLeftAngleBracket();if(a){i+=a;continue}break}var l=vt(r,this.clonePosition());return{val:{type:Ut.literal,value:i,location:l},err:null}},t.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!QN(this.peek()||0))?(this.bump(),"<"):null},t.prototype.tryParseQuote=function(e){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(e==="plural"||e==="selectordinal")break;return null;default:return null}this.bump();var n=[this.char()];for(this.bump();!this.isEOF();){var r=this.char();if(r===39)if(this.peek()===39)n.push(39),this.bump();else{this.bump();break}else n.push(r);this.bump()}return u0.apply(void 0,n)},t.prototype.tryParseUnquoted=function(e,n){if(this.isEOF())return null;var r=this.char();return r===60||r===123||r===35&&(n==="plural"||n==="selectordinal")||r===125&&e>0?null:(this.bump(),u0(r))},t.prototype.parseArgument=function(e,n){var r=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(yt.EXPECT_ARGUMENT_CLOSING_BRACE,vt(r,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(yt.EMPTY_ARGUMENT,vt(r,this.clonePosition()));var i=this.parseIdentifierIfPossible().value;if(!i)return this.error(yt.MALFORMED_ARGUMENT,vt(r,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(yt.EXPECT_ARGUMENT_CLOSING_BRACE,vt(r,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:Ut.argument,value:i,location:vt(r,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(yt.EXPECT_ARGUMENT_CLOSING_BRACE,vt(r,this.clonePosition())):this.parseArgumentOptions(e,n,i,r);default:return this.error(yt.MALFORMED_ARGUMENT,vt(r,this.clonePosition()))}},t.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),n=this.offset(),r=f0(this.message,n),i=n+r.length;this.bumpTo(i);var s=this.clonePosition(),o=vt(e,s);return{value:r,location:o}},t.prototype.parseArgumentOptions=function(e,n,r,i){var s,o=this.clonePosition(),a=this.parseIdentifierIfPossible().value,l=this.clonePosition();switch(a){case"":return this.error(yt.EXPECT_ARGUMENT_TYPE,vt(o,l));case"number":case"date":case"time":{this.bumpSpace();var c=null;if(this.bumpIf(",")){this.bumpSpace();var u=this.clonePosition(),f=this.parseSimpleArgStyleIfPossible();if(f.err)return f;var h=JN(f.val);if(h.length===0)return this.error(yt.EXPECT_ARGUMENT_STYLE,vt(this.clonePosition(),this.clonePosition()));var d=vt(u,this.clonePosition());c={style:h,styleLocation:d}}var p=this.tryParseArgumentClose(i);if(p.err)return p;var g=vt(i,this.clonePosition());if(c&&Zv(c?.style,"::",0)){var b=YN(c.style.slice(2));if(a==="number"){var f=this.parseNumberSkeletonFromString(b,c.styleLocation);return f.err?f:{val:{type:Ut.number,value:r,location:g,style:f.val},err:null}}else{if(b.length===0)return this.error(yt.EXPECT_DATE_TIME_SKELETON,g);var w=b;this.locale&&(w=DN(b,this.locale));var h={type:Ll.dateTime,pattern:w,location:c.styleLocation,parsedOptions:this.shouldParseSkeletons?ON(w):{}},x=a==="date"?Ut.date:Ut.time;return{val:{type:x,value:r,location:g,style:h},err:null}}}return{val:{type:a==="number"?Ut.number:a==="date"?Ut.date:Ut.time,value:r,location:g,style:(s=c?.style)!==null&&s!==void 0?s:null},err:null}}case"plural":case"selectordinal":case"select":{var T=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(yt.EXPECT_SELECT_ARGUMENT_OPTIONS,vt(T,_t({},T)));this.bumpSpace();var M=this.parseIdentifierIfPossible(),O=0;if(a!=="select"&&M.value==="offset"){if(!this.bumpIf(":"))return this.error(yt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,vt(this.clonePosition(),this.clonePosition()));this.bumpSpace();var f=this.tryParseDecimalInteger(yt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,yt.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(f.err)return f;this.bumpSpace(),M=this.parseIdentifierIfPossible(),O=f.val}var _=this.tryParsePluralOrSelectOptions(e,a,n,M);if(_.err)return _;var p=this.tryParseArgumentClose(i);if(p.err)return p;var L=vt(i,this.clonePosition());return a==="select"?{val:{type:Ut.select,value:r,options:Yv(_.val),location:L},err:null}:{val:{type:Ut.plural,value:r,options:Yv(_.val),offset:O,pluralType:a==="plural"?"cardinal":"ordinal",location:L},err:null}}default:return this.error(yt.INVALID_ARGUMENT_TYPE,vt(o,l))}},t.prototype.tryParseArgumentClose=function(e){return this.isEOF()||this.char()!==125?this.error(yt.EXPECT_ARGUMENT_CLOSING_BRACE,vt(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},t.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,n=this.clonePosition();!this.isEOF();){var r=this.char();switch(r){case 39:{this.bump();var i=this.clonePosition();if(!this.bumpUntil("'"))return this.error(yt.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,vt(i,this.clonePosition()));this.bump();break}case 123:{e+=1,this.bump();break}case 125:{if(e>0)e-=1;else return{val:this.message.slice(n.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(n.offset,this.offset()),err:null}},t.prototype.parseNumberSkeletonFromString=function(e,n){var r=[];try{r=MN(e)}catch{return this.error(yt.INVALID_NUMBER_SKELETON,n)}return{val:{type:Ll.number,tokens:r,location:n,parsedOptions:this.shouldParseSkeletons?PN(r):{}},err:null}},t.prototype.tryParsePluralOrSelectOptions=function(e,n,r,i){for(var s,o=!1,a=[],l=new Set,c=i.value,u=i.location;;){if(c.length===0){var f=this.clonePosition();if(n!=="select"&&this.bumpIf("=")){var h=this.tryParseDecimalInteger(yt.EXPECT_PLURAL_ARGUMENT_SELECTOR,yt.INVALID_PLURAL_ARGUMENT_SELECTOR);if(h.err)return h;u=vt(f,this.clonePosition()),c=this.message.slice(f.offset,this.offset())}else break}if(l.has(c))return this.error(n==="select"?yt.DUPLICATE_SELECT_ARGUMENT_SELECTOR:yt.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,u);c==="other"&&(o=!0),this.bumpSpace();var d=this.clonePosition();if(!this.bumpIf("{"))return this.error(n==="select"?yt.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:yt.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,vt(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,n,r);if(p.err)return p;var g=this.tryParseArgumentClose(d);if(g.err)return g;a.push([c,{value:p.val,location:vt(d,this.clonePosition())}]),l.add(c),this.bumpSpace(),s=this.parseIdentifierIfPossible(),c=s.value,u=s.location}return a.length===0?this.error(n==="select"?yt.EXPECT_SELECT_ARGUMENT_SELECTOR:yt.EXPECT_PLURAL_ARGUMENT_SELECTOR,vt(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!o?this.error(yt.MISSING_OTHER_CLAUSE,vt(this.clonePosition(),this.clonePosition())):{val:a,err:null}},t.prototype.tryParseDecimalInteger=function(e,n){var r=1,i=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(r=-1);for(var s=!1,o=0;!this.isEOF();){var a=this.char();if(a>=48&&a<=57)s=!0,o=o*10+(a-48),this.bump();else break}var l=vt(i,this.clonePosition());return s?(o*=r,GN(o)?{val:o,err:null}:this.error(n,l)):this.error(e,l)},t.prototype.offset=function(){return this.position.offset},t.prototype.isEOF=function(){return this.offset()===this.message.length},t.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},t.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var n=PA(this.message,e);if(n===void 0)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return n},t.prototype.error=function(e,n){return{val:null,err:{kind:e,message:this.message,location:n}}},t.prototype.bump=function(){if(!this.isEOF()){var e=this.char();e===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},t.prototype.bumpIf=function(e){if(Zv(this.message,e,this.offset())){for(var n=0;n<e.length;n++)this.bump();return!0}return!1},t.prototype.bumpUntil=function(e){var n=this.offset(),r=this.message.indexOf(e,n);return r>=0?(this.bumpTo(r),!0):(this.bumpTo(this.message.length),!1)},t.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var n=this.offset();if(n===e)break;if(n>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},t.prototype.bumpSpace=function(){for(;!this.isEOF()&&BA(this.char());)this.bump()},t.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),n=this.offset(),r=this.message.charCodeAt(n+(e>=65536?2:1));return r??null},t})();function h0(t){return t>=97&&t<=122||t>=65&&t<=90}function QN(t){return h0(t)||t===47}function eL(t){return t===45||t===46||t>=48&&t<=57||t===95||t>=97&&t<=122||t>=65&&t<=90||t==183||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}function BA(t){return t>=9&&t<=13||t===32||t===133||t>=8206&&t<=8207||t===8232||t===8233}function tL(t){return t>=33&&t<=35||t===36||t>=37&&t<=39||t===40||t===41||t===42||t===43||t===44||t===45||t>=46&&t<=47||t>=58&&t<=59||t>=60&&t<=62||t>=63&&t<=64||t===91||t===92||t===93||t===94||t===96||t===123||t===124||t===125||t===126||t===161||t>=162&&t<=165||t===166||t===167||t===169||t===171||t===172||t===174||t===176||t===177||t===182||t===187||t===191||t===215||t===247||t>=8208&&t<=8213||t>=8214&&t<=8215||t===8216||t===8217||t===8218||t>=8219&&t<=8220||t===8221||t===8222||t===8223||t>=8224&&t<=8231||t>=8240&&t<=8248||t===8249||t===8250||t>=8251&&t<=8254||t>=8257&&t<=8259||t===8260||t===8261||t===8262||t>=8263&&t<=8273||t===8274||t===8275||t>=8277&&t<=8286||t>=8592&&t<=8596||t>=8597&&t<=8601||t>=8602&&t<=8603||t>=8604&&t<=8607||t===8608||t>=8609&&t<=8610||t===8611||t>=8612&&t<=8613||t===8614||t>=8615&&t<=8621||t===8622||t>=8623&&t<=8653||t>=8654&&t<=8655||t>=8656&&t<=8657||t===8658||t===8659||t===8660||t>=8661&&t<=8691||t>=8692&&t<=8959||t>=8960&&t<=8967||t===8968||t===8969||t===8970||t===8971||t>=8972&&t<=8991||t>=8992&&t<=8993||t>=8994&&t<=9e3||t===9001||t===9002||t>=9003&&t<=9083||t===9084||t>=9085&&t<=9114||t>=9115&&t<=9139||t>=9140&&t<=9179||t>=9180&&t<=9185||t>=9186&&t<=9254||t>=9255&&t<=9279||t>=9280&&t<=9290||t>=9291&&t<=9311||t>=9472&&t<=9654||t===9655||t>=9656&&t<=9664||t===9665||t>=9666&&t<=9719||t>=9720&&t<=9727||t>=9728&&t<=9838||t===9839||t>=9840&&t<=10087||t===10088||t===10089||t===10090||t===10091||t===10092||t===10093||t===10094||t===10095||t===10096||t===10097||t===10098||t===10099||t===10100||t===10101||t>=10132&&t<=10175||t>=10176&&t<=10180||t===10181||t===10182||t>=10183&&t<=10213||t===10214||t===10215||t===10216||t===10217||t===10218||t===10219||t===10220||t===10221||t===10222||t===10223||t>=10224&&t<=10239||t>=10240&&t<=10495||t>=10496&&t<=10626||t===10627||t===10628||t===10629||t===10630||t===10631||t===10632||t===10633||t===10634||t===10635||t===10636||t===10637||t===10638||t===10639||t===10640||t===10641||t===10642||t===10643||t===10644||t===10645||t===10646||t===10647||t===10648||t>=10649&&t<=10711||t===10712||t===10713||t===10714||t===10715||t>=10716&&t<=10747||t===10748||t===10749||t>=10750&&t<=11007||t>=11008&&t<=11055||t>=11056&&t<=11076||t>=11077&&t<=11078||t>=11079&&t<=11084||t>=11085&&t<=11123||t>=11124&&t<=11125||t>=11126&&t<=11157||t===11158||t>=11159&&t<=11263||t>=11776&&t<=11777||t===11778||t===11779||t===11780||t===11781||t>=11782&&t<=11784||t===11785||t===11786||t===11787||t===11788||t===11789||t>=11790&&t<=11798||t===11799||t>=11800&&t<=11801||t===11802||t===11803||t===11804||t===11805||t>=11806&&t<=11807||t===11808||t===11809||t===11810||t===11811||t===11812||t===11813||t===11814||t===11815||t===11816||t===11817||t>=11818&&t<=11822||t===11823||t>=11824&&t<=11833||t>=11834&&t<=11835||t>=11836&&t<=11839||t===11840||t===11841||t===11842||t>=11843&&t<=11855||t>=11856&&t<=11857||t===11858||t>=11859&&t<=11903||t>=12289&&t<=12291||t===12296||t===12297||t===12298||t===12299||t===12300||t===12301||t===12302||t===12303||t===12304||t===12305||t>=12306&&t<=12307||t===12308||t===12309||t===12310||t===12311||t===12312||t===12313||t===12314||t===12315||t===12316||t===12317||t>=12318&&t<=12319||t===12320||t===12336||t===64830||t===64831||t>=65093&&t<=65094}function d0(t){t.forEach(function(e){if(delete e.location,TA(e)||IA(e))for(var n in e.options)delete e.options[n].location,d0(e.options[n].value);else kA(e)&&$A(e.style)||(_A(e)||CA(e))&&l0(e.style)?delete e.style.location:OA(e)&&d0(e.children)})}function nL(t,e){e===void 0&&(e={}),e=_t({shouldParseSkeletons:!0,requiresOtherClause:!0},e);var n=new XN(t,e).parse();if(n.err){var r=SyntaxError(yt[n.err.kind]);throw r.location=n.err.location,r.originalMessage=n.err.message,r}return e?.captureLocation||d0(n.val),n.val}var Rl;(function(t){t.MISSING_VALUE="MISSING_VALUE",t.INVALID_VALUE="INVALID_VALUE",t.MISSING_INTL_API="MISSING_INTL_API"})(Rl||(Rl={}));var Hd=(function(t){Bd(e,t);function e(n,r,i){var s=t.call(this,n)||this;return s.code=r,s.originalMessage=i,s}return e.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},e})(Error),Xv=(function(t){Bd(e,t);function e(n,r,i,s){return t.call(this,'Invalid values for "'.concat(n,'": "').concat(r,'". Options are "').concat(Object.keys(i).join('", "'),'"'),Rl.INVALID_VALUE,s)||this}return e})(Hd),rL=(function(t){Bd(e,t);function e(n,r,i){return t.call(this,'Value for "'.concat(n,'" must be of type ').concat(r),Rl.INVALID_VALUE,i)||this}return e})(Hd),iL=(function(t){Bd(e,t);function e(n,r){return t.call(this,'The intl string context variable "'.concat(n,'" was not provided to the string "').concat(r,'"'),Rl.MISSING_VALUE,r)||this}return e})(Hd),hr;(function(t){t[t.literal=0]="literal",t[t.object=1]="object"})(hr||(hr={}));function sL(t){return t.length<2?t:t.reduce(function(e,n){var r=e[e.length-1];return!r||r.type!==hr.literal||n.type!==hr.literal?e.push(n):r.value+=n.value,e},[])}function oL(t){return typeof t=="function"}function Nf(t,e,n,r,i,s,o){if(t.length===1&&Vv(t[0]))return[{type:hr.literal,value:t[0].value}];for(var a=[],l=0,c=t;l<c.length;l++){var u=c[l];if(Vv(u)){a.push({type:hr.literal,value:u.value});continue}if(TN(u)){typeof s=="number"&&a.push({type:hr.literal,value:n.getNumberFormat(e).format(s)});continue}var f=u.value;if(!(i&&f in i))throw new iL(f,o);var h=i[f];if(CN(u)){(!h||typeof h=="string"||typeof h=="number")&&(h=typeof h=="string"||typeof h=="number"?String(h):""),a.push({type:typeof h=="string"?hr.literal:hr.object,value:h});continue}if(_A(u)){var d=typeof u.style=="string"?r.date[u.style]:l0(u.style)?u.style.parsedOptions:void 0;a.push({type:hr.literal,value:n.getDateTimeFormat(e,d).format(h)});continue}if(CA(u)){var d=typeof u.style=="string"?r.time[u.style]:l0(u.style)?u.style.parsedOptions:r.time.medium;a.push({type:hr.literal,value:n.getDateTimeFormat(e,d).format(h)});continue}if(kA(u)){var d=typeof u.style=="string"?r.number[u.style]:$A(u.style)?u.style.parsedOptions:void 0;d&&d.scale&&(h=h*(d.scale||1)),a.push({type:hr.literal,value:n.getNumberFormat(e,d).format(h)});continue}if(OA(u)){var p=u.children,g=u.value,b=i[g];if(!oL(b))throw new rL(g,"function",o);var w=Nf(p,e,n,r,i,s),x=b(w.map(function(O){return O.value}));Array.isArray(x)||(x=[x]),a.push.apply(a,x.map(function(O){return{type:typeof O=="string"?hr.literal:hr.object,value:O}}))}if(TA(u)){var T=u.options[h]||u.options.other;if(!T)throw new Xv(u.value,h,Object.keys(u.options),o);a.push.apply(a,Nf(T.value,e,n,r,i));continue}if(IA(u)){var T=u.options["=".concat(h)];if(!T){if(!Intl.PluralRules)throw new Hd(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,Rl.MISSING_INTL_API,o);var M=n.getPluralRules(e,{type:u.pluralType}).select(h-(u.offset||0));T=u.options[M]||u.options.other}if(!T)throw new Xv(u.value,h,Object.keys(u.options),o);a.push.apply(a,Nf(T.value,e,n,r,i,h-(u.offset||0)));continue}}return sL(a)}function aL(t,e){return e?_t(_t(_t({},t||{}),e||{}),Object.keys(t).reduce(function(n,r){return n[r]=_t(_t({},t[r]),e[r]||{}),n},{})):t}function lL(t,e){return e?Object.keys(t).reduce(function(n,r){return n[r]=aL(t[r],e[r]),n},_t({},t)):t}function Tg(t){return{create:function(){return{get:function(e){return t[e]},set:function(e,n){t[e]=n}}}}}function cL(t){return t===void 0&&(t={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:kg(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.NumberFormat).bind.apply(e,Ag([void 0],n,!1)))},{cache:Tg(t.number),strategy:_g.variadic}),getDateTimeFormat:kg(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.DateTimeFormat).bind.apply(e,Ag([void 0],n,!1)))},{cache:Tg(t.dateTime),strategy:_g.variadic}),getPluralRules:kg(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.PluralRules).bind.apply(e,Ag([void 0],n,!1)))},{cache:Tg(t.pluralRules),strategy:_g.variadic})}}var HA=(function(){function t(e,n,r,i){n===void 0&&(n=t.defaultLocale);var s=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(l){var c=s.formatToParts(l);if(c.length===1)return c[0].value;var u=c.reduce(function(f,h){return!f.length||h.type!==hr.literal||typeof f[f.length-1]!="string"?f.push(h.value):f[f.length-1]+=h.value,f},[]);return u.length<=1?u[0]||"":u},this.formatToParts=function(l){return Nf(s.ast,s.locales,s.formatters,s.formats,l,void 0,s.message)},this.resolvedOptions=function(){var l;return{locale:((l=s.resolvedLocale)===null||l===void 0?void 0:l.toString())||Intl.NumberFormat.supportedLocalesOf(s.locales)[0]}},this.getAst=function(){return s.ast},this.locales=n,this.resolvedLocale=t.resolveLocale(n),typeof e=="string"){if(this.message=e,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var o=i||{};o.formatters;var a=wN(o,["formatters"]);this.ast=t.__parse(e,_t(_t({},a),{locale:this.resolvedLocale}))}else this.ast=e;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=lL(t.formats,r),this.formatters=i&&i.formatters||cL(this.formatterCache)}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.resolveLocale=function(e){if(!(typeof Intl.Locale>"u")){var n=Intl.NumberFormat.supportedLocalesOf(e);return n.length>0?new Intl.Locale(n[0]):new Intl.Locale(typeof e=="string"?e:e[0])}},t.__parse=nL,t.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t})();function uL(t,e){if(e==null)return;if(e in t)return t[e];const n=e.split(".");let r=t;for(let i=0;i<n.length;i++)if(typeof r=="object"){if(i>0){const s=n.slice(i,n.length).join(".");if(s in r){r=r[s];break}}r=r[n[i]]}else r=void 0;return r}const ko={},fL=(t,e,n)=>n&&(e in ko||(ko[e]={}),t in ko[e]||(ko[e][t]=n),n),UA=(t,e)=>{if(e==null)return;if(e in ko&&t in ko[e])return ko[e][t];const n=Ru(e);for(let r=0;r<n.length;r++){const i=n[r],s=dL(i,t);if(s)return fL(t,e,s)}};let Jy;const Xl=Hr({});function hL(t){return Jy[t]||null}function Xy(t){return t in Jy}function dL(t,e){if(!Xy(t))return null;const n=hL(t);return uL(n,e)}function pL(t){if(t==null)return;const e=Ru(t);for(let n=0;n<e.length;n++){const r=e[n];if(Xy(r))return r}}function gL(t,...e){delete ko[t],Xl.update(n=>(n[t]=bN.all([n[t]||{},...e]),n))}Is([Xl],([t])=>Object.keys(t));Xl.subscribe(t=>Jy=t);const Lc={};function mL(t){Lc[t]=new Set}function yL(t,e){Lc[t].delete(e),Lc[t].size===0&&delete Lc[t]}function Rc(t){return Lc[t]}function bL(t){return Ru(t).map(e=>{const n=Rc(e);return[e,n?[...n]:[]]}).filter(([,e])=>e.length>0)}function lh(t){return t==null?!1:Ru(t).some(e=>{var n;return(n=Rc(e))==null?void 0:n.size})}function wL(t,e){return Promise.all(e.map(r=>(yL(t,r),r().then(i=>i.default||i)))).then(r=>gL(t,...r))}const bc={};function Qy(t){if(!lh(t))return t in bc?bc[t]:Promise.resolve();const e=bL(t);return bc[t]=Promise.all(e.map(([n,r])=>wL(n,r))).then(()=>{if(lh(t))return Qy(t);delete bc[t]}),bc[t]}function zA(t,e){Rc(t)||mL(t);const n=Rc(t);Rc(t).has(e)||(Xy(t)||Xl.update(r=>(r[t]={},r)),n.add(e))}var Qv=Object.getOwnPropertySymbols,vL=Object.prototype.hasOwnProperty,EL=Object.prototype.propertyIsEnumerable,xL=(t,e)=>{var n={};for(var r in t)vL.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Qv)for(var r of Qv(t))e.indexOf(r)<0&&EL.call(t,r)&&(n[r]=t[r]);return n};const SL={number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};function AL({locale:t,id:e}){console.warn(`[svelte-i18n] The message "${e}" was not found in "${Ru(t).join('", "')}".${lh(qs())?`

Note: there are at least one loader still registered to this locale that wasn't executed.`:""}`)}const kL={fallbackLocale:null,loadingDelay:200,formats:SL,warnOnMissingMessages:!0,handleMissingMessage:void 0,ignoreTag:!0},_c=kL;function Na(){return _c}function _L(t){const e=t,{formats:n}=e,r=xL(e,["formats"]);let i=t.fallbackLocale;if(t.initialLocale)try{HA.resolveLocale(t.initialLocale)&&(i=t.initialLocale)}catch{console.warn(`[svelte-i18n] The initial locale "${t.initialLocale}" is not a valid locale.`)}return r.warnOnMissingMessages&&(delete r.warnOnMissingMessages,r.handleMissingMessage==null?r.handleMissingMessage=AL:console.warn('[svelte-i18n] The "warnOnMissingMessages" option is deprecated. Please use the "handleMissingMessage" option instead.')),Object.assign(_c,r,{initialLocale:i}),n&&("number"in n&&Object.assign(_c.formats.number,n.number),"date"in n&&Object.assign(_c.formats.date,n.date),"time"in n&&Object.assign(_c.formats.time,n.time)),wi.set(i)}const Ig=Hr(!1);var CL=Object.defineProperty,TL=Object.defineProperties,IL=Object.getOwnPropertyDescriptors,e2=Object.getOwnPropertySymbols,OL=Object.prototype.hasOwnProperty,$L=Object.prototype.propertyIsEnumerable,t2=(t,e,n)=>e in t?CL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ML=(t,e)=>{for(var n in e||(e={}))OL.call(e,n)&&t2(t,n,e[n]);if(e2)for(var n of e2(e))$L.call(e,n)&&t2(t,n,e[n]);return t},NL=(t,e)=>TL(t,IL(e));let p0;const ch=Hr(null);function n2(t){return t.split("-").map((e,n,r)=>r.slice(0,n+1).join("-")).reverse()}function Ru(t,e=Na().fallbackLocale){const n=n2(t);return e?[...new Set([...n,...n2(e)])]:n}function qs(){return p0??void 0}ch.subscribe(t=>{p0=t??void 0,typeof window<"u"&&t!=null&&document.documentElement.setAttribute("lang",t)});const LL=t=>{if(t&&pL(t)&&lh(t)){const{loadingDelay:e}=Na();let n;return typeof window<"u"&&qs()!=null&&e?n=window.setTimeout(()=>Ig.set(!0),e):Ig.set(!0),Qy(t).then(()=>{ch.set(t)}).finally(()=>{clearTimeout(n),Ig.set(!1)})}return ch.set(t)},wi=NL(ML({},ch),{set:LL}),RL=()=>typeof window>"u"?null:window.navigator.language||window.navigator.languages[0],Ud=t=>{const e=Object.create(null);return r=>{const i=JSON.stringify(r);return i in e?e[i]:e[i]=t(r)}};var PL=Object.defineProperty,uh=Object.getOwnPropertySymbols,FA=Object.prototype.hasOwnProperty,jA=Object.prototype.propertyIsEnumerable,r2=(t,e,n)=>e in t?PL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,eb=(t,e)=>{for(var n in e||(e={}))FA.call(e,n)&&r2(t,n,e[n]);if(uh)for(var n of uh(e))jA.call(e,n)&&r2(t,n,e[n]);return t},Ql=(t,e)=>{var n={};for(var r in t)FA.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&uh)for(var r of uh(t))e.indexOf(r)<0&&jA.call(t,r)&&(n[r]=t[r]);return n};const su=(t,e)=>{const{formats:n}=Na();if(t in n&&e in n[t])return n[t][e];throw new Error(`[svelte-i18n] Unknown "${e}" ${t} format.`)},DL=Ud(t=>{var e=t,{locale:n,format:r}=e,i=Ql(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return r&&(i=su("number",r)),new Intl.NumberFormat(n,i)}),BL=Ud(t=>{var e=t,{locale:n,format:r}=e,i=Ql(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return r?i=su("date",r):Object.keys(i).length===0&&(i=su("date","short")),new Intl.DateTimeFormat(n,i)}),HL=Ud(t=>{var e=t,{locale:n,format:r}=e,i=Ql(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return r?i=su("time",r):Object.keys(i).length===0&&(i=su("time","short")),new Intl.DateTimeFormat(n,i)}),UL=(t={})=>{var e=t,{locale:n=qs()}=e,r=Ql(e,["locale"]);return DL(eb({locale:n},r))},zL=(t={})=>{var e=t,{locale:n=qs()}=e,r=Ql(e,["locale"]);return BL(eb({locale:n},r))},FL=(t={})=>{var e=t,{locale:n=qs()}=e,r=Ql(e,["locale"]);return HL(eb({locale:n},r))},jL=Ud((t,e=qs())=>new HA(t,e,Na().formats,{ignoreTag:Na().ignoreTag})),qL=(t,e={})=>{var n,r,i,s;let o=e;typeof t=="object"&&(o=t,t=o.id);const{values:a,locale:l=qs(),default:c}=o;if(l==null)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let u=UA(t,l);if(!u)u=(s=(i=(r=(n=Na()).handleMissingMessage)==null?void 0:r.call(n,{locale:l,id:t,defaultValue:c}))!=null?i:c)!=null?s:t;else if(typeof u!="string")return console.warn(`[svelte-i18n] Message with id "${t}" must be of type "string", found: "${typeof u}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),u;if(!a)return u;let f=u;try{f=jL(u,l).format(a)}catch(h){h instanceof Error&&console.warn(`[svelte-i18n] Message "${t}" has syntax error:`,h.message)}return f},VL=(t,e)=>FL(e).format(t),WL=(t,e)=>zL(e).format(t),KL=(t,e)=>UL(e).format(t),GL=(t,e=qs())=>UA(t,e),ts=Is([wi,Xl],()=>qL);Is([wi],()=>VL);Is([wi],()=>WL);Is([wi],()=>KL);Is([wi,Xl],()=>GL);function ZL(t){return Qy(qs()||Na().initialLocale)}zA("ja",()=>iu(()=>import("./ja-EevES13I.js"),[]));zA("en",()=>iu(()=>import("./en-BNbtwkKW.js"),[]));function YL(){const t=localStorage.getItem("locale"),e=RL();return t&&(t==="ja"||t==="en")?t:e&&e.startsWith("ja")?"ja":"en"}const qA=YL();_L({fallbackLocale:"ja",initialLocale:qA,loadingDelay:0});wi.set(qA);function i2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function VA(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function JL(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");i2(t.outputLen),i2(t.blockLen)}function fh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function XL(t,e){VA(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Og=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const WA=t=>t instanceof Uint8Array,$g=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ti=(t,e)=>t<<32-e|t>>>e,QL=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!QL)throw new Error("Non little-endian hardware is not supported");function eR(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function tb(t){if(typeof t=="string"&&(t=eR(t)),!WA(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function tR(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!WA(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let KA=class{clone(){return this._cloneInto()}};function nR(t){const e=r=>t().update(tb(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function GA(t=32){if(Og&&typeof Og.getRandomValues=="function")return Og.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function rR(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}let iR=class extends KA{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=$g(this.buffer)}update(e){fh(this);const{view:n,buffer:r,blockLen:i}=this;e=tb(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=$g(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){fh(this),XL(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;rR(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=$g(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const sR=(t,e,n)=>t&e^~t&n,oR=(t,e,n)=>t&e^t&n^e&n,aR=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),io=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),so=new Uint32Array(64);let lR=class extends iR{constructor(){super(64,32,8,!1),this.A=io[0]|0,this.B=io[1]|0,this.C=io[2]|0,this.D=io[3]|0,this.E=io[4]|0,this.F=io[5]|0,this.G=io[6]|0,this.H=io[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let f=0;f<16;f++,n+=4)so[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=so[f-15],d=so[f-2],p=Ti(h,7)^Ti(h,18)^h>>>3,g=Ti(d,17)^Ti(d,19)^d>>>10;so[f]=g+so[f-7]+p+so[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=Ti(a,6)^Ti(a,11)^Ti(a,25),d=u+h+sR(a,l,c)+aR[f]+so[f]|0,g=(Ti(r,2)^Ti(r,13)^Ti(r,22))+oR(r,i,s)|0;u=c,c=l,l=a,a=o+d|0,o=s,s=i,i=r,r=d+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){so.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const g0=nR(()=>new lR);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ZA=BigInt(0),zd=BigInt(1),cR=BigInt(2),Fd=t=>t instanceof Uint8Array,uR=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Pl(t){if(!Fd(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=uR[t[n]];return e}function YA(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function nb(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Dl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Ir(t){return nb(Pl(t))}function rb(t){if(!Fd(t))throw new Error("Uint8Array expected");return nb(Pl(Uint8Array.from(t).reverse()))}function jo(t,e){return Dl(t.toString(16).padStart(e*2,"0"))}function ib(t,e){return jo(t,e).reverse()}function fR(t){return Dl(YA(t))}function er(t,e,n){let r;if(typeof e=="string")try{r=Dl(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Fd(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function La(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!Fd(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function hR(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function dR(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function pR(t){let e;for(e=0;t>ZA;t>>=zd,e+=1);return e}function gR(t,e){return t>>BigInt(e)&zd}const mR=(t,e,n)=>t|(n?zd:ZA)<<BigInt(e),sb=t=>(cR<<BigInt(t-1))-zd,Mg=t=>new Uint8Array(t),s2=t=>Uint8Array.from(t);function JA(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Mg(t),i=Mg(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...f)=>n(i,r,...f),l=(f=Mg())=>{i=a(s2([0]),f),r=a(),f.length!==0&&(i=a(s2([1]),f),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const h=[];for(;f<e;){r=a();const d=r.slice();h.push(d),f+=r.length}return La(...h)};return(f,h)=>{o(),l(f);let d;for(;!(d=h(c()));)l();return o(),d}}const yR={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Pu(t,e,n={}){const r=(i,s,o)=>{const a=yR[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const bR=Object.freeze(Object.defineProperty({__proto__:null,bitGet:gR,bitLen:pR,bitMask:sb,bitSet:mR,bytesToHex:Pl,bytesToNumberBE:Ir,bytesToNumberLE:rb,concatBytes:La,createHmacDrbg:JA,ensureBytes:er,equalBytes:hR,hexToBytes:Dl,hexToNumber:nb,numberToBytesBE:jo,numberToBytesLE:ib,numberToHexUnpadded:YA,numberToVarBytesBE:fR,utf8ToBytes:dR,validateObject:Pu},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xn=BigInt(0),tn=BigInt(1),fa=BigInt(2),wR=BigInt(3),m0=BigInt(4),o2=BigInt(5),a2=BigInt(8);BigInt(9);BigInt(16);function Dn(t,e){const n=t%e;return n>=xn?n:e+n}function vR(t,e,n){if(n<=xn||e<xn)throw new Error("Expected power/modulo > 0");if(n===tn)return xn;let r=tn;for(;e>xn;)e&tn&&(r=r*t%n),t=t*t%n,e>>=tn;return r}function qr(t,e,n){let r=t;for(;e-- >xn;)r*=r,r%=n;return r}function y0(t,e){if(t===xn||e<=xn)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Dn(t,e),r=e,i=xn,s=tn;for(;n!==xn;){const a=r/n,l=r%n,c=i-s*a;r=n,n=l,i=s,s=c}if(r!==tn)throw new Error("invert: does not exist");return Dn(i,e)}function ER(t){const e=(t-tn)/fa;let n,r,i;for(n=t-tn,r=0;n%fa===xn;n/=fa,r++);for(i=fa;i<t&&vR(i,e,t)!==t-tn;i++);if(r===1){const o=(t+tn)/m0;return function(l,c){const u=l.pow(c,o);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+tn)/fa;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=r,u=a.pow(a.mul(a.ONE,i),n),f=a.pow(l,s),h=a.pow(l,n);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let d=1;for(let g=a.sqr(h);d<c&&!a.eql(g,a.ONE);d++)g=a.sqr(g);const p=a.pow(u,tn<<BigInt(c-d-1));u=a.sqr(p),f=a.mul(f,p),h=a.mul(h,u),c=d}return f}}function xR(t){if(t%m0===wR){const e=(t+tn)/m0;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%a2===o2){const e=(t-o2)/a2;return function(r,i){const s=r.mul(i,fa),o=r.pow(s,e),a=r.mul(i,o),l=r.mul(r.mul(a,fa),o),c=r.mul(a,r.sub(l,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return ER(t)}const SR=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function AR(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=SR.reduce((r,i)=>(r[i]="function",r),e);return Pu(t,n)}function kR(t,e,n){if(n<xn)throw new Error("Expected power > 0");if(n===xn)return t.ONE;if(n===tn)return e;let r=t.ONE,i=e;for(;n>xn;)n&tn&&(r=t.mul(r,i)),i=t.sqr(i),n>>=tn;return r}function _R(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function XA(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function CR(t,e,n=!1,r={}){if(t<=xn)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=XA(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=xR(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:sb(i),ZERO:xn,ONE:tn,create:l=>Dn(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return xn<=l&&l<t},is0:l=>l===xn,isOdd:l=>(l&tn)===tn,neg:l=>Dn(-l,t),eql:(l,c)=>l===c,sqr:l=>Dn(l*l,t),add:(l,c)=>Dn(l+c,t),sub:(l,c)=>Dn(l-c,t),mul:(l,c)=>Dn(l*c,t),pow:(l,c)=>kR(a,l,c),div:(l,c)=>Dn(l*y0(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>y0(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>_R(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?ib(l,s):jo(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?rb(l):Ir(l)}});return Object.freeze(a)}function QA(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function e3(t){const e=QA(t);return e+Math.ceil(e/2)}function TR(t,e,n=!1){const r=t.length,i=QA(e),s=e3(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Ir(t):rb(t),a=Dn(o,e-tn)+tn;return n?ib(a,i):jo(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const IR=BigInt(0),Ng=BigInt(1);function OR(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>IR;)s&Ng&&(o=o.add(a)),a=a.double(),s>>=Ng;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let f=0;f<o;f++){u=c,l.push(u);for(let h=1;h<a;h++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const f=BigInt(2**i-1),h=2**i,d=BigInt(i);for(let p=0;p<a;p++){const g=p*l;let b=Number(o&f);o>>=d,b>l&&(b-=h,o+=Ng);const w=g,x=g+Math.abs(b)-1,T=p%2!==0,M=b<0;b===0?u=u.add(n(T,s[w])):c=c.add(n(M,s[x]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function t3(t){return AR(t.Fp),Pu(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...XA(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $R(t){const e=t3(t);Pu(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:MR,hexToBytes:NR}=bR,ga={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=ga;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:MR(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=ga,n=typeof t=="string"?NR(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=ga._parseInt(n.subarray(2)),{d:o,l:a}=ga._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},ws=BigInt(0),Jr=BigInt(1);BigInt(2);const l2=BigInt(3);BigInt(4);function LR(t){const e=$R(t),{Fp:n}=e,r=e.toBytes||((p,g,b)=>{const w=g.toAffine();return La(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),i=e.fromBytes||(p=>{const g=p.subarray(1),b=n.fromBytes(g.subarray(0,n.BYTES)),w=n.fromBytes(g.subarray(n.BYTES,2*n.BYTES));return{x:b,y:w}});function s(p){const{a:g,b}=e,w=n.sqr(p),x=n.mul(w,p);return n.add(n.add(x,n.mul(p,g)),b)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&ws<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:g,nByteLength:b,wrapPrivateKey:w,n:x}=e;if(g&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Pl(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(b*2,"0")}let T;try{T=typeof p=="bigint"?p:Ir(er("private key",p,b))}catch{throw new Error(`private key must be ${b} bytes, hex or bigint, not ${typeof p}`)}return w&&(T=Dn(T,x)),a(T),T}const c=new Map;function u(p){if(!(p instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(g,b,w){if(this.px=g,this.py=b,this.pz=w,g==null||!n.isValid(g))throw new Error("x required");if(b==null||!n.isValid(b))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(g){const{x:b,y:w}=g||{};if(!g||!n.isValid(b)||!n.isValid(w))throw new Error("invalid affine point");if(g instanceof f)throw new Error("projective point not allowed");const x=T=>n.eql(T,n.ZERO);return x(b)&&x(w)?f.ZERO:new f(b,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const b=n.invertBatch(g.map(w=>w.pz));return g.map((w,x)=>w.toAffine(b[x])).map(f.fromAffine)}static fromHex(g){const b=f.fromAffine(i(er("pointHex",g)));return b.assertValidity(),b}static fromPrivateKey(g){return f.BASE.multiply(l(g))}_setWindowSize(g){this._WINDOW_SIZE=g,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:b}=this.toAffine();if(!n.isValid(g)||!n.isValid(b))throw new Error("bad point: x or y not FE");const w=n.sqr(b),x=s(g);if(!n.eql(w,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(n.isOdd)return!n.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:b,py:w,pz:x}=this,{px:T,py:M,pz:O}=g,_=n.eql(n.mul(b,O),n.mul(T,x)),L=n.eql(n.mul(w,O),n.mul(M,x));return _&&L}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:g,b}=e,w=n.mul(b,l2),{px:x,py:T,pz:M}=this;let O=n.ZERO,_=n.ZERO,L=n.ZERO,A=n.mul(x,x),E=n.mul(T,T),S=n.mul(M,M),k=n.mul(x,T);return k=n.add(k,k),L=n.mul(x,M),L=n.add(L,L),O=n.mul(g,L),_=n.mul(w,S),_=n.add(O,_),O=n.sub(E,_),_=n.add(E,_),_=n.mul(O,_),O=n.mul(k,O),L=n.mul(w,L),S=n.mul(g,S),k=n.sub(A,S),k=n.mul(g,k),k=n.add(k,L),L=n.add(A,A),A=n.add(L,A),A=n.add(A,S),A=n.mul(A,k),_=n.add(_,A),S=n.mul(T,M),S=n.add(S,S),A=n.mul(S,k),O=n.sub(O,A),L=n.mul(S,E),L=n.add(L,L),L=n.add(L,L),new f(O,_,L)}add(g){u(g);const{px:b,py:w,pz:x}=this,{px:T,py:M,pz:O}=g;let _=n.ZERO,L=n.ZERO,A=n.ZERO;const E=e.a,S=n.mul(e.b,l2);let k=n.mul(b,T),P=n.mul(w,M),D=n.mul(x,O),H=n.add(b,w),N=n.add(T,M);H=n.mul(H,N),N=n.add(k,P),H=n.sub(H,N),N=n.add(b,x);let I=n.add(T,O);return N=n.mul(N,I),I=n.add(k,D),N=n.sub(N,I),I=n.add(w,x),_=n.add(M,O),I=n.mul(I,_),_=n.add(P,D),I=n.sub(I,_),A=n.mul(E,N),_=n.mul(S,D),A=n.add(_,A),_=n.sub(P,A),A=n.add(P,A),L=n.mul(_,A),P=n.add(k,k),P=n.add(P,k),D=n.mul(E,D),N=n.mul(S,N),P=n.add(P,D),D=n.sub(k,D),D=n.mul(E,D),N=n.add(N,D),k=n.mul(P,N),L=n.add(L,k),k=n.mul(I,N),_=n.mul(H,_),_=n.sub(_,k),k=n.mul(H,P),A=n.mul(I,A),A=n.add(A,k),new f(_,L,A)}subtract(g){return this.add(g.negate())}is0(){return this.equals(f.ZERO)}wNAF(g){return d.wNAFCached(this,c,g,b=>{const w=n.invertBatch(b.map(x=>x.pz));return b.map((x,T)=>x.toAffine(w[T])).map(f.fromAffine)})}multiplyUnsafe(g){const b=f.ZERO;if(g===ws)return b;if(a(g),g===Jr)return this;const{endo:w}=e;if(!w)return d.unsafeLadder(this,g);let{k1neg:x,k1:T,k2neg:M,k2:O}=w.splitScalar(g),_=b,L=b,A=this;for(;T>ws||O>ws;)T&Jr&&(_=_.add(A)),O&Jr&&(L=L.add(A)),A=A.double(),T>>=Jr,O>>=Jr;return x&&(_=_.negate()),M&&(L=L.negate()),L=new f(n.mul(L.px,w.beta),L.py,L.pz),_.add(L)}multiply(g){a(g);let b=g,w,x;const{endo:T}=e;if(T){const{k1neg:M,k1:O,k2neg:_,k2:L}=T.splitScalar(b);let{p:A,f:E}=this.wNAF(O),{p:S,f:k}=this.wNAF(L);A=d.constTimeNegate(M,A),S=d.constTimeNegate(_,S),S=new f(n.mul(S.px,T.beta),S.py,S.pz),w=A.add(S),x=E.add(k)}else{const{p:M,f:O}=this.wNAF(b);w=M,x=O}return f.normalizeZ([w,x])[0]}multiplyAndAddUnsafe(g,b,w){const x=f.BASE,T=(O,_)=>_===ws||_===Jr||!O.equals(x)?O.multiplyUnsafe(_):O.multiply(_),M=T(this,b).add(T(g,w));return M.is0()?void 0:M}toAffine(g){const{px:b,py:w,pz:x}=this,T=this.is0();g==null&&(g=T?n.ONE:n.inv(x));const M=n.mul(b,g),O=n.mul(w,g),_=n.mul(x,g);if(T)return{x:n.ZERO,y:n.ZERO};if(!n.eql(_,n.ONE))throw new Error("invZ was invalid");return{x:M,y:O}}isTorsionFree(){const{h:g,isTorsionFree:b}=e;if(g===Jr)return!0;if(b)return b(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:b}=e;return g===Jr?this:b?b(f,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),r(f,this,g)}toHex(g=!0){return Pl(this.toRawBytes(g))}}f.BASE=new f(e.Gx,e.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const h=e.nBitLength,d=OR(f,e.endo?Math.ceil(h/2):h);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function RR(t){const e=t3(t);return Pu(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function PR(t){const e=RR(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(N){return ws<N&&N<n.ORDER}function a(N){return Dn(N,r)}function l(N){return y0(N,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:h}=LR({...e,toBytes(N,I,$){const V=I.toAffine(),U=n.toBytes(V.x),W=La;return $?W(Uint8Array.from([I.hasEvenY()?2:3]),U):W(Uint8Array.from([4]),U,n.toBytes(V.y))},fromBytes(N){const I=N.length,$=N[0],V=N.subarray(1);if(I===i&&($===2||$===3)){const U=Ir(V);if(!o(U))throw new Error("Point is not on curve");const W=f(U);let ee=n.sqrt(W);const X=(ee&Jr)===Jr;return($&1)===1!==X&&(ee=n.neg(ee)),{x:U,y:ee}}else if(I===s&&$===4){const U=n.fromBytes(V.subarray(0,n.BYTES)),W=n.fromBytes(V.subarray(n.BYTES,2*n.BYTES));return{x:U,y:W}}else throw new Error(`Point of length ${I} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),d=N=>Pl(jo(N,e.nByteLength));function p(N){const I=r>>Jr;return N>I}function g(N){return p(N)?a(-N):N}const b=(N,I,$)=>Ir(N.slice(I,$));class w{constructor(I,$,V){this.r=I,this.s=$,this.recovery=V,this.assertValidity()}static fromCompact(I){const $=e.nByteLength;return I=er("compactSignature",I,$*2),new w(b(I,0,$),b(I,$,2*$))}static fromDER(I){const{r:$,s:V}=ga.toSig(er("DER",I));return new w($,V)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(I){return new w(this.r,this.s,I)}recoverPublicKey(I){const{r:$,s:V,recovery:U}=this,W=L(er("msgHash",I));if(U==null||![0,1,2,3].includes(U))throw new Error("recovery id invalid");const ee=U===2||U===3?$+e.n:$;if(ee>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const X=(U&1)===0?"02":"03",he=c.fromHex(X+d(ee)),oe=l(ee),Y=a(-W*oe),be=a(V*oe),Re=c.BASE.multiplyAndAddUnsafe(he,Y,be);if(!Re)throw new Error("point at infinify");return Re.assertValidity(),Re}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Dl(this.toDERHex())}toDERHex(){return ga.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Dl(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const x={isValidPrivateKey(N){try{return u(N),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const N=e3(e.n);return TR(e.randomBytes(N),e.n)},precompute(N=8,I=c.BASE){return I._setWindowSize(N),I.multiply(BigInt(3)),I}};function T(N,I=!0){return c.fromPrivateKey(N).toRawBytes(I)}function M(N){const I=N instanceof Uint8Array,$=typeof N=="string",V=(I||$)&&N.length;return I?V===i||V===s:$?V===2*i||V===2*s:N instanceof c}function O(N,I,$=!0){if(M(N))throw new Error("first arg must be private key");if(!M(I))throw new Error("second arg must be public key");return c.fromHex(I).multiply(u(N)).toRawBytes($)}const _=e.bits2int||function(N){const I=Ir(N),$=N.length*8-e.nBitLength;return $>0?I>>BigInt($):I},L=e.bits2int_modN||function(N){return a(_(N))},A=sb(e.nBitLength);function E(N){if(typeof N!="bigint")throw new Error("bigint expected");if(!(ws<=N&&N<A))throw new Error(`bigint expected < 2^${e.nBitLength}`);return jo(N,e.nByteLength)}function S(N,I,$=k){if(["recovered","canonical"].some(Me=>Me in $))throw new Error("sign() legacy options not supported");const{hash:V,randomBytes:U}=e;let{lowS:W,prehash:ee,extraEntropy:X}=$;W==null&&(W=!0),N=er("msgHash",N),ee&&(N=er("prehashed msgHash",V(N)));const he=L(N),oe=u(I),Y=[E(oe),E(he)];if(X!=null){const Me=X===!0?U(n.BYTES):X;Y.push(er("extraEntropy",Me))}const be=La(...Y),Re=he;function de(Me){const ce=_(Me);if(!h(ce))return;const xe=l(ce),Te=c.BASE.multiply(ce).toAffine(),qe=a(Te.x);if(qe===ws)return;const et=a(xe*a(Re+qe*oe));if(et===ws)return;let Ze=(Te.x===qe?0:2)|Number(Te.y&Jr),pe=et;return W&&p(et)&&(pe=g(et),Ze^=1),new w(qe,pe,Ze)}return{seed:be,k2sig:de}}const k={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function D(N,I,$=k){const{seed:V,k2sig:U}=S(N,I,$),W=e;return JA(W.hash.outputLen,W.nByteLength,W.hmac)(V,U)}c.BASE._setWindowSize(8);function H(N,I,$,V=P){const U=N;if(I=er("msgHash",I),$=er("publicKey",$),"strict"in V)throw new Error("options.strict was renamed to lowS");const{lowS:W,prehash:ee}=V;let X,he;try{if(typeof U=="string"||U instanceof Uint8Array)try{X=w.fromDER(U)}catch(Te){if(!(Te instanceof ga.Err))throw Te;X=w.fromCompact(U)}else if(typeof U=="object"&&typeof U.r=="bigint"&&typeof U.s=="bigint"){const{r:Te,s:qe}=U;X=new w(Te,qe)}else throw new Error("PARSE");he=c.fromHex($)}catch(Te){if(Te.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(W&&X.hasHighS())return!1;ee&&(I=e.hash(I));const{r:oe,s:Y}=X,be=L(I),Re=l(Y),de=a(be*Re),Me=a(oe*Re),ce=c.BASE.multiplyAndAddUnsafe(he,de,Me)?.toAffine();return ce?a(ce.x)===oe:!1}return{CURVE:e,getPublicKey:T,getSharedSecret:O,sign:D,verify:H,ProjectivePoint:c,Signature:w,utils:x}}let n3=class extends KA{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,JL(e);const r=tb(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return fh(this),this.iHash.update(e),this}digestInto(e){fh(this),VA(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const r3=(t,e,n)=>new n3(t,e).update(n).digest();r3.create=(t,e)=>new n3(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function DR(t){return{hash:t,hmac:(e,...n)=>r3(t,e,tR(...n)),randomBytes:GA}}function BR(t,e){const n=r=>PR({...t,...DR(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const jd=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),hh=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),i3=BigInt(1),dh=BigInt(2),c2=(t,e)=>(t+e/dh)/e;function s3(t){const e=jd,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,f=qr(u,n,e)*u%e,h=qr(f,n,e)*u%e,d=qr(h,dh,e)*c%e,p=qr(d,i,e)*d%e,g=qr(p,s,e)*p%e,b=qr(g,a,e)*g%e,w=qr(b,l,e)*b%e,x=qr(w,a,e)*g%e,T=qr(x,n,e)*u%e,M=qr(T,o,e)*p%e,O=qr(M,r,e)*c%e,_=qr(O,dh,e);if(!b0.eql(b0.sqr(_),t))throw new Error("Cannot find square root");return _}const b0=CR(jd,void 0,void 0,{sqrt:s3}),ec=BR({a:BigInt(0),b:BigInt(7),Fp:b0,n:hh,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=hh,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-i3*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=c2(s*t,e),l=c2(-r*t,e);let c=Dn(t-a*n-l*i,e),u=Dn(-a*r-l*s,e);const f=c>o,h=u>o;if(f&&(c=e-c),h&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:c,k2neg:h,k2:u}}}},g0),qd=BigInt(0),o3=t=>typeof t=="bigint"&&qd<t&&t<jd,HR=t=>typeof t=="bigint"&&qd<t&&t<hh,u2={};function ph(t,...e){let n=u2[t];if(n===void 0){const r=g0(Uint8Array.from(t,i=>i.charCodeAt(0)));n=La(r,r),u2[t]=n}return g0(La(n,...e))}const ob=t=>t.toRawBytes(!0).slice(1),w0=t=>jo(t,32),Lg=t=>Dn(t,jd),ou=t=>Dn(t,hh),ab=ec.ProjectivePoint,UR=(t,e,n)=>ab.BASE.multiplyAndAddUnsafe(t,e,n);function v0(t){let e=ec.utils.normPrivateKeyToScalar(t),n=ab.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:ou(-e),bytes:ob(n)}}function a3(t){if(!o3(t))throw new Error("bad x: need 0 < x < p");const e=Lg(t*t),n=Lg(e*t+BigInt(7));let r=s3(n);r%dh!==qd&&(r=Lg(-r));const i=new ab(t,r,i3);return i.assertValidity(),i}function l3(...t){return ou(Ir(ph("BIP0340/challenge",...t)))}function zR(t){return v0(t).bytes}function FR(t,e,n=GA(32)){const r=er("message",t),{bytes:i,scalar:s}=v0(e),o=er("auxRand",n,32),a=w0(s^Ir(ph("BIP0340/aux",o))),l=ph("BIP0340/nonce",a,i,r),c=ou(Ir(l));if(c===qd)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=v0(c),h=l3(u,i,r),d=new Uint8Array(64);if(d.set(u,0),d.set(w0(ou(f+h*s)),32),!c3(d,r,i))throw new Error("sign: Invalid signature produced");return d}function c3(t,e,n){const r=er("signature",t,64),i=er("message",e),s=er("publicKey",n,32);try{const o=a3(Ir(s)),a=Ir(r.subarray(0,32));if(!o3(a))return!1;const l=Ir(r.subarray(32,64));if(!HR(l))return!1;const c=l3(w0(a),ob(o),i),u=UR(o,l,ou(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const Bi={getPublicKey:zR,sign:FR,verify:c3,utils:{randomPrivateKey:ec.utils.randomPrivateKey,lift_x:a3,pointToBytes:ob,numberToBytesBE:jo,bytesToNumberBE:Ir,taggedHash:ph,mod:Dn}},Rg=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const lb=t=>t instanceof Uint8Array,Pg=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Ii=(t,e)=>t<<32-e|t>>>e,jR=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!jR)throw new Error("Non little-endian hardware is not supported");const qR=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function un(t){if(!lb(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=qR[t[n]];return e}function Ra(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function VR(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function au(t){if(typeof t=="string"&&(t=VR(t)),!lb(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Vd(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!lb(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class u3{clone(){return this._cloneInto()}}function f3(t){const e=r=>t().update(au(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function h3(t=32){if(Rg&&typeof Rg.getRandomValues=="function")return Rg.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function E0(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function WR(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function d3(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function KR(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");E0(t.outputLen),E0(t.blockLen)}function GR(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ZR(t,e){d3(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Fi={number:E0,bool:WR,bytes:d3,hash:KR,exists:GR,output:ZR};function YR(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}class JR extends u3{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Pg(this.buffer)}update(e){Fi.exists(this);const{view:n,buffer:r,blockLen:i}=this;e=au(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=Pg(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Fi.exists(this),Fi.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;YR(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Pg(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const XR=(t,e,n)=>t&e^~t&n,QR=(t,e,n)=>t&e^t&n^e&n,eP=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),oo=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ao=new Uint32Array(64);class p3 extends JR{constructor(){super(64,32,8,!1),this.A=oo[0]|0,this.B=oo[1]|0,this.C=oo[2]|0,this.D=oo[3]|0,this.E=oo[4]|0,this.F=oo[5]|0,this.G=oo[6]|0,this.H=oo[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let f=0;f<16;f++,n+=4)ao[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=ao[f-15],d=ao[f-2],p=Ii(h,7)^Ii(h,18)^h>>>3,g=Ii(d,17)^Ii(d,19)^d>>>10;ao[f]=g+ao[f-7]+p+ao[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=Ii(a,6)^Ii(a,11)^Ii(a,25),d=u+h+XR(a,l,c)+eP[f]+ao[f]|0,g=(Ii(r,2)^Ii(r,13)^Ii(r,22))+QR(r,i,s)|0;u=c,c=l,l=a,a=o+d|0,o=s,s=i,i=r,r=d+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){ao.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class tP extends p3{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Ga=f3(()=>new p3);f3(()=>new tP);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function tc(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Vs(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce((i,s)=>i?e(i,s.encode):s.encode,void 0),r=t.reduce((i,s)=>i?e(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Ws(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(tc(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function Ks(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function Wd(t,e="="){if(tc(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function g3(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function f2(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach(o=>{if(tc(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!==e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[l]?a=!1:r=l;else continue}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const m3=(t,e)=>e?m3(e,t%e):t,gh=(t,e)=>t+(e-m3(t,e));function x0(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(gh(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${gh(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(tc(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function nP(t){return tc(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return f2(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(f2(e,t,2**8))}}}function Yo(t,e=!1){if(tc(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(gh(8,t)>32||gh(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return x0(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(x0(n,t,8,e))}}}function h2(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const rP=Vs(Yo(4),Ws("0123456789ABCDEF"),Ks("")),iP=Vs(Yo(5),Ws("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Wd(5),Ks(""));Vs(Yo(5),Ws("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Wd(5),Ks(""));Vs(Yo(5),Ws("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Ks(""),g3(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Yi=Vs(Yo(6),Ws("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Wd(6),Ks("")),sP=Vs(Yo(6),Ws("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Wd(6),Ks("")),cb=t=>Vs(nP(58),Ws(t),Ks("")),S0=cb("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");cb("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");cb("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const d2=[0,2,3,5,6,7,9,10,11],oP={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=S0.encode(r).padStart(d2[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),i=d2.indexOf(r.length),s=S0.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(e)}},A0=Vs(Ws("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ks("")),p2=[996825010,642813549,513874426,1027748829,705979059];function wc(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<p2.length;r++)(e>>r&1)===1&&(n^=p2[r]);return n}function g2(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=wc(i)^o>>5}i=wc(i);for(let s=0;s<r;s++)i=wc(i)^t.charCodeAt(s)&31;for(let s of e)i=wc(i)^s;for(let s=0;s<6;s++)i=wc(i);return i^=n,A0.encode(x0([i%2**30],30,5,!1))}function y3(t){const e=t==="bech32"?1:734539939,n=Yo(5),r=n.decode,i=n.encode,s=h2(r);function o(u,f,h=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const d=u.length+7+f.length;if(h!==!1&&d>h)throw new TypeError(`Length ${d} exceeds limit ${h}`);return u=u.toLowerCase(),`${u}1${A0.encode(f)}${g2(u,f,e)}`}function a(u,f=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||f!==!1&&u.length>f)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${f})`);const h=u.toLowerCase();if(u!==h&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=h;const d=u.lastIndexOf("1");if(d===0||d===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=u.slice(0,d),g=u.slice(d+1);if(g.length<6)throw new Error("Data must be at least 6 characters long");const b=A0.decode(g).slice(0,-6),w=g2(p,b,e);if(!g.endsWith(w))throw new Error(`Invalid checksum in ${u}: expected "${w}"`);return{prefix:p,words:b}}const l=h2(a);function c(u){const{prefix:f,words:h}=a(u,!1);return{prefix:f,words:h,bytes:r(h)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const Bl=y3("bech32");y3("bech32m");const aP={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},lP=Vs(Yo(4),Ws("0123456789abcdef"),Ks(""),g3(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),cP={utf8:aP,hex:lP,base16:rP,base32:iP,base64:Yi,base64url:sP,base58:S0,base58xmr:oP};`${Object.keys(cP).join(", ")}`;function Dg(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function m2(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function uP(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function xs(t,...e){if(!uP(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const ir=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),fP=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!fP)throw new Error("Non little-endian hardware is not supported");function hP(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function dP(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const pP=(t,e)=>(Object.assign(e,t),e),No=16,gP=283;function ub(t){return t<<1^gP&-(t>>7)}function hl(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=ub(t);return n}const k0=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=ub(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),mP=k0.map((t,e)=>k0.indexOf(e)),yP=t=>t<<24|t>>>8,Bg=t=>t<<8|t>>>24;function b3(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((c,u)=>e(t[u])),r=n.map(Bg),i=r.map(Bg),s=i.map(Bg),o=new Uint32Array(256*256),a=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const f=c*256+u;o[f]=n[c]^r[u],a[f]=i[c]^s[u],l[f]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const fb=b3(k0,t=>hl(t,3)<<24|t<<16|t<<8|hl(t,2)),w3=b3(mP,t=>hl(t,11)<<24|hl(t,13)<<16|hl(t,9)<<8|hl(t,14)),bP=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=ub(n))t[e]=n;return t})();function v3(t){xs(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=fb,r=ir(t),i=r.length,s=a=>ji(n,a,a,a,a),o=new Uint32Array(e+28);o.set(r);for(let a=i;a<o.length;a++){let l=o[a-1];a%i===0?l=s(yP(l))^bP[a/i-1]:i>6&&a%i===4&&(l=s(l)),o[a]=o[a-i]^l}return o}function wP(t){const e=v3(t),n=e.slice(),r=e.length,{sbox2:i}=fb,{T0:s,T1:o,T2:a,T3:l}=w3;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],f=ji(i,u,u,u,u);n[c]=s[f&255]^o[f>>>8&255]^a[f>>>16&255]^l[f>>>24]}return n}function _o(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function ji(t,e,n,r,i){return t[e&255|n&65280]|t[r>>>16&255|i>>>16&65280]<<16}function y2(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=fb;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const g=t[l++]^_o(o,a,e,n,r,i),b=t[l++]^_o(o,a,n,r,i,e),w=t[l++]^_o(o,a,r,i,e,n),x=t[l++]^_o(o,a,i,e,n,r);e=g,n=b,r=w,i=x}const u=t[l++]^ji(s,e,n,r,i),f=t[l++]^ji(s,n,r,i,e),h=t[l++]^ji(s,r,i,e,n),d=t[l++]^ji(s,i,e,n,r);return{s0:u,s1:f,s2:h,s3:d}}function vP(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=w3;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const g=t[l++]^_o(o,a,e,i,r,n),b=t[l++]^_o(o,a,n,e,i,r),w=t[l++]^_o(o,a,r,n,e,i),x=t[l++]^_o(o,a,i,r,n,e);e=g,n=b,r=w,i=x}const u=t[l++]^ji(s,e,i,r,n),f=t[l++]^ji(s,n,e,i,r),h=t[l++]^ji(s,r,n,e,i),d=t[l++]^ji(s,i,r,n,e);return{s0:u,s1:f,s2:h,s3:d}}function E3(t,e){if(!e)return new Uint8Array(t);if(xs(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function EP(t){if(xs(t),t.length%No!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${No}`)}function xP(t,e,n){let r=t.length;const i=r%No;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=ir(t);if(e){let l=No-i;l||(l=No),r=r+l}const o=E3(r,n),a=ir(o);return{b:s,o:a,out:o}}function SP(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function AP(t){const e=new Uint8Array(16),n=ir(e);e.set(t);const r=No-t.length;for(let i=No-r;i<No;i++)e[i]=r;return n}const x3=pP({blockSize:16,nonceLength:16},function(e,n,r={}){xs(e),xs(n,16);const i=!r.disablePadding;return{encrypt:(s,o)=>{const a=v3(e),{b:l,o:c,out:u}=xP(s,i,o),f=ir(n);let h=f[0],d=f[1],p=f[2],g=f[3],b=0;for(;b+4<=l.length;)h^=l[b+0],d^=l[b+1],p^=l[b+2],g^=l[b+3],{s0:h,s1:d,s2:p,s3:g}=y2(a,h,d,p,g),c[b++]=h,c[b++]=d,c[b++]=p,c[b++]=g;if(i){const w=AP(s.subarray(b*4));h^=w[0],d^=w[1],p^=w[2],g^=w[3],{s0:h,s1:d,s2:p,s3:g}=y2(a,h,d,p,g),c[b++]=h,c[b++]=d,c[b++]=p,c[b++]=g}return a.fill(0),u},decrypt:(s,o)=>{EP(s);const a=wP(e),l=ir(n),c=E3(s.length,o),u=ir(s),f=ir(c);let h=l[0],d=l[1],p=l[2],g=l[3];for(let b=0;b+4<=u.length;){const w=h,x=d,T=p,M=g;h=u[b+0],d=u[b+1],p=u[b+2],g=u[b+3];const{s0:O,s1:_,s2:L,s3:A}=vP(a,h,d,p,g);f[b++]=O^w,f[b++]=_^x,f[b++]=L^T,f[b++]=A^M}return a.fill(0),SP(c,i)}}}),S3=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),kP=S3("expand 16-byte k"),_P=S3("expand 32-byte k"),CP=ir(kP),A3=ir(_P);A3.slice();function kt(t,e){return t<<e|t>>>32-e}function _0(t){return t.byteOffset%4===0}const of=64,TP=16,k3=2**32-1,b2=new Uint32Array;function IP(t,e,n,r,i,s,o,a){const l=i.length,c=new Uint8Array(of),u=ir(c),f=_0(i)&&_0(s),h=f?ir(i):b2,d=f?ir(s):b2;for(let p=0;p<l;o++){if(t(e,n,r,u,o,a),o>=k3)throw new Error("arx: counter overflow");const g=Math.min(of,l-p);if(f&&g===of){const b=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let w=0,x;w<TP;w++)x=b+w,d[x]=h[x]^u[w];p+=of;continue}for(let b=0,w;b<g;b++)w=p+b,s[w]=i[w]^c[b];p+=g}}function OP(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=hP({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Dg(i),Dg(o),m2(s),m2(n),(a,l,c,u,f=0)=>{xs(a),xs(l),xs(c);const h=c.length;if(u||(u=new Uint8Array(h)),xs(u),Dg(f),f<0||f>=k3)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const d=[];let p=a.length,g,b;if(p===32)g=a.slice(),d.push(g),b=A3;else if(p===16&&n)g=new Uint8Array(32),g.set(a),g.set(a,16),b=CP,d.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);_0(l)||(l=l.slice(),d.push(l));const w=ir(g);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(b,w,ir(l.subarray(0,16)),w),l=l.subarray(16)}const x=16-i;if(x!==l.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const M=new Uint8Array(12);M.set(l,s?0:12-l.length),l=M,d.push(l)}const T=ir(l);for(IP(t,b,w,T,c,u,f,o);d.length>0;)d.pop().fill(0);return u}}function $P(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],f=e[1],h=e[2],d=e[3],p=e[4],g=e[5],b=e[6],w=e[7],x=i,T=n[0],M=n[1],O=n[2],_=o,L=a,A=l,E=c,S=u,k=f,P=h,D=d,H=p,N=g,I=b,$=w,V=x,U=T,W=M,ee=O;for(let he=0;he<s;he+=2)_=_+S|0,V=kt(V^_,16),H=H+V|0,S=kt(S^H,12),_=_+S|0,V=kt(V^_,8),H=H+V|0,S=kt(S^H,7),L=L+k|0,U=kt(U^L,16),N=N+U|0,k=kt(k^N,12),L=L+k|0,U=kt(U^L,8),N=N+U|0,k=kt(k^N,7),A=A+P|0,W=kt(W^A,16),I=I+W|0,P=kt(P^I,12),A=A+P|0,W=kt(W^A,8),I=I+W|0,P=kt(P^I,7),E=E+D|0,ee=kt(ee^E,16),$=$+ee|0,D=kt(D^$,12),E=E+D|0,ee=kt(ee^E,8),$=$+ee|0,D=kt(D^$,7),_=_+k|0,ee=kt(ee^_,16),I=I+ee|0,k=kt(k^I,12),_=_+k|0,ee=kt(ee^_,8),I=I+ee|0,k=kt(k^I,7),L=L+P|0,V=kt(V^L,16),$=$+V|0,P=kt(P^$,12),L=L+P|0,V=kt(V^L,8),$=$+V|0,P=kt(P^$,7),A=A+D|0,U=kt(U^A,16),H=H+U|0,D=kt(D^H,12),A=A+D|0,U=kt(U^A,8),H=H+U|0,D=kt(D^H,7),E=E+S|0,W=kt(W^E,16),N=N+W|0,S=kt(S^N,12),E=E+S|0,W=kt(W^E,8),N=N+W|0,S=kt(S^N,7);let X=0;r[X++]=o+_|0,r[X++]=a+L|0,r[X++]=l+A|0,r[X++]=c+E|0,r[X++]=u+S|0,r[X++]=f+k|0,r[X++]=h+P|0,r[X++]=d+D|0,r[X++]=p+H|0,r[X++]=g+N|0,r[X++]=b+I|0,r[X++]=w+$|0,r[X++]=x+V|0,r[X++]=T+U|0,r[X++]=M+W|0,r[X++]=O+ee|0}const _3=OP($P,{counterRight:!1,counterLength:4,allowShortKeys:!1});class C3 extends u3{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Fi.hash(e);const r=au(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Fi.exists(this),this.iHash.update(e),this}digestInto(e){Fi.exists(this),Fi.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Kd=(t,e,n)=>new C3(t,e).update(n).digest();Kd.create=(t,e)=>new C3(t,e);function MP(t,e,n){return Fi.hash(t),Kd(t,au(n),au(e))}const Hg=new Uint8Array([0]),w2=new Uint8Array;function NP(t,e,n,r=32){if(Fi.hash(t),Fi.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=w2);const s=new Uint8Array(i*t.outputLen),o=Kd.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)Hg[0]=c+1,a.update(c===0?w2:l).update(n).update(Hg).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),Hg.fill(0),s.slice(0,r)}var LP=Object.defineProperty,Ft=(t,e)=>{for(var n in e)LP(t,n,{get:e[n],enumerable:!0})},rl=Symbol("verified"),RP=t=>t instanceof Object;function hb(t){if(!RP(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var PP={};Ft(PP,{Queue:()=>UP,QueueNode:()=>T3,binarySearch:()=>db,bytesToHex:()=>un,hexToBytes:()=>Ra,insertEventIntoAscendingList:()=>HP,insertEventIntoDescendingList:()=>BP,normalizeURL:()=>DP,utf8Decoder:()=>Ss,utf8Encoder:()=>vi});var Ss=new TextDecoder("utf-8"),vi=new TextEncoder;function DP(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function BP(t,e){const[n,r]=db(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at);return r||t.splice(n,0,e),t}function HP(t,e){const[n,r]=db(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at);return r||t.splice(n,0,e),t}function db(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var T3=class{value;next=null;prev=null;constructor(t){this.value=t}},UP=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new T3(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},zP=class{generateSecretKey(){return Bi.utils.randomPrivateKey()}getPublicKey(e){return un(Bi.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=un(Bi.getPublicKey(n)),r.id=Lf(r),r.sig=un(Bi.sign(Lf(r),n)),r[rl]=!0,r}verifyEvent(e){if(typeof e[rl]=="boolean")return e[rl];const n=Lf(e);if(n!==e.id)return e[rl]=!1,!1;try{const r=Bi.verify(e.sig,n,e.pubkey);return e[rl]=r,r}catch{return e[rl]=!1,!1}}};function FP(t){if(!hb(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Lf(t){let e=Ga(vi.encode(FP(t)));return un(e)}var Gd=new zP,jP=Gd.generateSecretKey,Zd=Gd.getPublicKey,ns=Gd.finalizeEvent,pb=Gd.verifyEvent,qP={};Ft(qP,{Application:()=>jD,BadgeAward:()=>XP,BadgeDefinition:()=>PD,BlockedRelaysList:()=>vD,BookmarkList:()=>yD,Bookmarksets:()=>ND,Calendar:()=>YD,CalendarEventRSVP:()=>JD,ChannelCreation:()=>L3,ChannelHideMessage:()=>D3,ChannelMessage:()=>P3,ChannelMetadata:()=>R3,ChannelMuteUser:()=>B3,ClassifiedListing:()=>WD,ClientAuth:()=>U3,CommunitiesList:()=>bD,CommunityDefinition:()=>e7,CommunityPostApproval:()=>oD,Contacts:()=>ZP,CreateOrUpdateProduct:()=>HD,CreateOrUpdateStall:()=>BD,Curationsets:()=>LD,Date:()=>GD,DirectMessageRelaysList:()=>AD,DraftClassifiedListing:()=>KD,DraftLong:()=>zD,Emojisets:()=>FD,EncryptedDirectMessage:()=>YP,EventDeletion:()=>JP,FileMetadata:()=>eD,FileServerPreference:()=>kD,Followsets:()=>OD,GenericRepost:()=>wb,Genericlists:()=>$D,GiftWrap:()=>H3,HTTPAuth:()=>vb,Handlerinformation:()=>QD,Handlerrecommendation:()=>XD,Highlights:()=>dD,InterestsList:()=>xD,Interestsets:()=>DD,JobFeedback:()=>cD,JobRequest:()=>aD,JobResult:()=>lD,Label:()=>sD,LightningPubRPC:()=>CD,LiveChatMessage:()=>tD,LiveEvent:()=>qD,LongFormArticle:()=>UD,Metadata:()=>KP,Mutelist:()=>pD,NWCWalletInfo:()=>_D,NWCWalletRequest:()=>z3,NWCWalletResponse:()=>TD,NostrConnect:()=>ID,OpenTimestamps:()=>QP,Pinlist:()=>gD,PrivateDirectMessage:()=>N3,ProblemTracker:()=>nD,ProfileBadges:()=>RD,PublicChatsList:()=>wD,Reaction:()=>bb,RecommendRelay:()=>GP,RelayList:()=>mD,Relaysets:()=>MD,Report:()=>rD,Reporting:()=>iD,Repost:()=>yb,Seal:()=>M3,SearchRelaysList:()=>ED,ShortTextNote:()=>$3,Time:()=>ZD,UserEmojiList:()=>SD,UserStatuses:()=>VD,Zap:()=>hD,ZapGoal:()=>uD,ZapRequest:()=>fD,classifyKind:()=>VP,isAddressableKind:()=>mb,isEphemeralKind:()=>O3,isKind:()=>WP,isRegularKind:()=>I3,isReplaceableKind:()=>gb});function I3(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function gb(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function O3(t){return 2e4<=t&&t<3e4}function mb(t){return 3e4<=t&&t<4e4}function VP(t){return I3(t)?"regular":gb(t)?"replaceable":O3(t)?"ephemeral":mb(t)?"parameterized":"unknown"}function WP(t,e){const n=e instanceof Array?e:[e];return hb(t)&&n.includes(t.kind)||!1}var KP=0,$3=1,GP=2,ZP=3,YP=4,JP=5,yb=6,bb=7,XP=8,M3=13,N3=14,wb=16,L3=40,R3=41,P3=42,D3=43,B3=44,QP=1040,H3=1059,eD=1063,tD=1311,nD=1971,rD=1984,iD=1984,sD=1985,oD=4550,aD=5999,lD=6999,cD=7e3,uD=9041,fD=9734,hD=9735,dD=9802,pD=1e4,gD=10001,mD=10002,yD=10003,bD=10004,wD=10005,vD=10006,ED=10007,xD=10015,SD=10030,AD=10050,kD=10096,_D=13194,CD=21e3,U3=22242,z3=23194,TD=23195,ID=24133,vb=27235,OD=3e4,$D=30001,MD=30002,ND=30003,LD=30004,RD=30008,PD=30009,DD=30015,BD=30017,HD=30018,UD=30023,zD=30024,FD=30030,jD=30078,qD=30311,VD=30315,WD=30402,KD=30403,GD=31922,ZD=31923,YD=31924,JD=31925,XD=31989,QD=31990,e7=34550,t7={};Ft(t7,{getHex64:()=>Eb,getInt:()=>F3,getSubscriptionId:()=>n7,matchEventId:()=>r7,matchEventKind:()=>s7,matchEventPubkey:()=>i7});function Eb(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function F3(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function n7(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function r7(t,e){return e===Eb(t,"id")}function i7(t,e){return e===Eb(t,"pubkey")}function s7(t,e){return e===F3(t,"kind")}var o7={};Ft(o7,{makeAuthEvent:()=>a7});function a7(t,e){return{kind:U3,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var l7;try{l7=WebSocket}catch{}var c7;try{c7=WebSocket}catch{}var Os={};Ft(Os,{BECH32_REGEX:()=>j3,Bech32MaxSize:()=>xb,NostrTypeGuard:()=>u7,decode:()=>Yd,decodeNostrURI:()=>h7,encodeBytes:()=>Xd,naddrEncode:()=>b7,neventEncode:()=>y7,noteEncode:()=>g7,nprofileEncode:()=>m7,npubEncode:()=>p7,nsecEncode:()=>d7});var u7={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},xb=5e3,j3=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function f7(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function h7(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),Yd(t)}catch{return{type:"invalid",data:null}}}function Yd(t){let{prefix:e,words:n}=Bl.decode(t,xb),r=new Uint8Array(Bl.fromWords(n));switch(e){case"nprofile":{let i=Ug(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:un(i[0][0]),relays:i[1]?i[1].map(s=>Ss.decode(s)):[]}}}case"nevent":{let i=Ug(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:un(i[0][0]),relays:i[1]?i[1].map(s=>Ss.decode(s)):[],author:i[2]?.[0]?un(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(un(i[3][0]),16):void 0}}}case"naddr":{let i=Ug(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ss.decode(i[0][0]),pubkey:un(i[2][0]),kind:parseInt(un(i[3][0]),16),relays:i[1]?i[1].map(s=>Ss.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:un(r)};default:throw new Error(`unknown prefix ${e}`)}}function Ug(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function d7(t){return Xd("nsec",t)}function p7(t){return Xd("npub",Ra(t))}function g7(t){return Xd("note",Ra(t))}function Jd(t,e){let n=Bl.toWords(e);return Bl.encode(t,n,xb)}function Xd(t,e){return Jd(t,e)}function m7(t){let e=Sb({0:[Ra(t.pubkey)],1:(t.relays||[]).map(n=>vi.encode(n))});return Jd("nprofile",e)}function y7(t){let e;t.kind!==void 0&&(e=f7(t.kind));let n=Sb({0:[Ra(t.id)],1:(t.relays||[]).map(r=>vi.encode(r)),2:t.author?[Ra(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return Jd("nevent",n)}function b7(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=Sb({0:[vi.encode(t.identifier)],1:(t.relays||[]).map(r=>vi.encode(r)),2:[Ra(t.pubkey)],3:[new Uint8Array(e)]});return Jd("naddr",n)}function Sb(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)})}),Vd(...e)}var w7={};Ft(w7,{decrypt:()=>v7,encrypt:()=>q3});function q3(t,e,n){const r=t instanceof Uint8Array?un(t):t,i=ec.getSharedSecret(r,"02"+e),s=V3(i);let o=Uint8Array.from(h3(16)),a=vi.encode(n),l=x3(s,o).encrypt(a),c=Yi.encode(new Uint8Array(l)),u=Yi.encode(new Uint8Array(o.buffer));return`${c}?iv=${u}`}function v7(t,e,n){const r=t instanceof Uint8Array?un(t):t;let[i,s]=n.split("?iv="),o=ec.getSharedSecret(r,"02"+e),a=V3(o),l=Yi.decode(s),c=Yi.decode(i),u=x3(a,l).decrypt(c);return Ss.decode(u)}function V3(t){return t.slice(1,33)}var E7={};Ft(E7,{NIP05_REGEX:()=>Ab,isNip05:()=>x7,isValid:()=>k7,queryProfile:()=>W3,searchDomain:()=>A7,useFetchImplementation:()=>S7});var Ab=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,x7=t=>Ab.test(t||""),Qd;try{Qd=fetch}catch{}function S7(t){Qd=t}async function A7(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Qd(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function W3(t){const e=t.match(Ab);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Qd(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function k7(t,e){const n=await W3(e);return n?n.pubkey===t:!1}var _7={};Ft(_7,{parse:()=>C7});function C7(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,f={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=f;continue}if(c==="reply"){e.reply=f;continue}if(c==="mention"){e.mentions.push(f);continue}n?r=f:n=f,e.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),e.mentions.forEach(i=>{if(i.author){let s=e.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),e}var T7={};Ft(T7,{fetchRelayInformation:()=>O7,useFetchImplementation:()=>I7});var K3;try{K3=fetch}catch{}function I7(t){K3=t}async function O7(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var $7={};Ft($7,{fastEventHash:()=>Z3,getPow:()=>G3,minePow:()=>M7});function G3(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function M7(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=Z3(r),G3(r.id)>=e)break}return r}function Z3(t){return un(Ga(vi.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var N7={};Ft(N7,{unwrapEvent:()=>V7,unwrapManyEvents:()=>W7,wrapEvent:()=>lk,wrapManyEvents:()=>q7});var L7={};Ft(L7,{createRumor:()=>ik,createSeal:()=>sk,createWrap:()=>ok,unwrapEvent:()=>Ib,unwrapManyEvents:()=>ak,wrapEvent:()=>mh,wrapManyEvents:()=>F7});var R7={};Ft(R7,{decrypt:()=>Tb,encrypt:()=>Cb,getConversationKey:()=>kb,v2:()=>U7});var Y3=1,J3=65535;function kb(t,e){const n=ec.getSharedSecret(t,"02"+e).subarray(1,33);return MP(Ga,n,"nip44-v2")}function X3(t,e){const n=NP(Ga,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function _b(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function P7(t){if(!Number.isSafeInteger(t)||t<Y3||t>J3)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function D7(t){const e=vi.encode(t),n=e.length,r=P7(n),i=new Uint8Array(_b(n)-n);return Vd(r,e,i)}function B7(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<Y3||e>J3||n.length!==e||t.length!==2+_b(e))throw new Error("invalid padding");return Ss.decode(n)}function Q3(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=Vd(n,e);return Kd(Ga,t,r)}function H7(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=Yi.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Cb(t,e,n=h3(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=X3(e,n),o=D7(t),a=_3(r,i,o),l=Q3(s,a,n);return Yi.encode(Vd(new Uint8Array([2]),n,a,l))}function Tb(t,e){const{nonce:n,ciphertext:r,mac:i}=H7(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=X3(e,n),l=Q3(a,r,n);if(!dP(l,i))throw new Error("invalid MAC");const c=_3(s,o,r);return B7(c)}var U7={utils:{getConversationKey:kb,calcPaddedLen:_b},encrypt:Cb,decrypt:Tb},z7=2880*60,ek=()=>Math.round(Date.now()/1e3),tk=()=>Math.round(ek()-Math.random()*z7),nk=(t,e)=>kb(t,e),rk=(t,e,n)=>Cb(JSON.stringify(t),nk(e,n)),v2=(t,e)=>JSON.parse(Tb(t.content,nk(e,t.pubkey)));function ik(t,e){const n={created_at:ek(),content:"",tags:[],...t,pubkey:Zd(e)};return n.id=Lf(n),n}function sk(t,e,n){return ns({kind:M3,content:rk(t,e,n),created_at:tk(),tags:[]},e)}function ok(t,e){const n=jP();return ns({kind:H3,content:rk(t,n,e),created_at:tk(),tags:[["p",e]]},n)}function mh(t,e,n){const r=ik(t,e),i=sk(r,e,n);return ok(i,n)}function F7(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Zd(e),i=[mh(t,e,r)];return n.forEach(s=>{i.push(mh(t,e,s))}),i}function Ib(t,e){const n=v2(t,e);return v2(n,e)}function ak(t,e){let n=[];return t.forEach(r=>{n.push(Ib(r,e))}),n.sort((r,i)=>r.created_at-i.created_at),n}function j7(t,e,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:N3,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function lk(t,e,n,r,i){const s=j7(e,n,r,i);return mh(s,t,e.publicKey)}function q7(t,e,n,r,i){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Zd(t)},...e].map(o=>lk(t,o,n,r,i))}var V7=Ib,W7=ak,K7={};Ft(K7,{finishRepostEvent:()=>G7,getRepostedEvent:()=>Z7,getRepostedEventPointer:()=>ck});function G7(t,e,n,r){let i;const s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===$3?i=yb:(i=wb,s.push(["k",String(e.kind)])),ns({kind:i,tags:s,content:t.content===""||e.tags?.find(o=>o[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function ck(t){if(![yb,wb].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function Z7(t,{skipVerification:e}={}){const n=ck(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!pb(r)))return r}var Y7={};Ft(Y7,{NOSTR_URI_REGEX:()=>Ob,parse:()=>X7,test:()=>J7});var Ob=new RegExp(`nostr:(${j3.source})`);function J7(t){return typeof t=="string"&&new RegExp(`^${Ob.source}$`).test(t)}function X7(t){const e=t.match(new RegExp(`^${Ob.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Yd(e[1])}}var Q7={};Ft(Q7,{finishReactionEvent:()=>eB,getReactedEventPointer:()=>tB});function eB(t,e,n){const r=e.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return ns({...t,kind:bb,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function tB(t){if(t.kind!==bb)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var nB={};Ft(nB,{parse:()=>iB});var rB=/\W/m,E2=/\W |\W$|$|,| /m;function*iB(t){const e=t.length;let n=0,r=0;for(;r<e;){let i=t.indexOf(":",r);if(i===-1)break;if(t.substring(i-5,i)==="nostr"){const s=t.substring(i+60).match(rB),o=s?i+60+s.index:e;try{let a,{data:l,type:c}=Yd(t.substring(i+1,o));switch(c){case"npub":a={pubkey:l};break;case"nsec":case"note":r=o+1;continue;default:a=l}n!==i-5&&(yield{type:"text",text:t.substring(n,i-5)}),yield{type:"reference",pointer:a},r=o,n=r;continue}catch{r=i+1;continue}}else if(t.substring(i-5,i)==="https"||t.substring(i-4,i)==="http"){const s=t.substring(i+4).match(E2),o=s?i+4+s.index:e,a=t[i-1]==="s"?5:4;try{let l=new URL(t.substring(i-a,o));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==i-a&&(yield{type:"text",text:t.substring(n,i-a)}),l.pathname.endsWith(".png")||l.pathname.endsWith(".jpg")||l.pathname.endsWith(".jpeg")||l.pathname.endsWith(".gif")||l.pathname.endsWith(".webp")){yield{type:"image",url:l.toString()},r=o,n=r;continue}if(l.pathname.endsWith(".mp4")||l.pathname.endsWith(".avi")||l.pathname.endsWith(".webm")||l.pathname.endsWith(".mkv")){yield{type:"video",url:l.toString()},r=o,n=r;continue}if(l.pathname.endsWith(".mp3")||l.pathname.endsWith(".aac")||l.pathname.endsWith(".ogg")||l.pathname.endsWith(".opus")){yield{type:"audio",url:l.toString()},r=o,n=r;continue}yield{type:"url",url:l.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else if(t.substring(i-3,i)==="wss"||t.substring(i-2,i)==="ws"){const s=t.substring(i+4).match(E2),o=s?i+4+s.index:e,a=t[i-1]==="s"?3:2;try{let l=new URL(t.substring(i-a,o));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==i-a&&(yield{type:"text",text:t.substring(n,i-a)}),yield{type:"relay",url:l.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else{r=i+1;continue}}n!==e&&(yield{type:"text",text:t.substring(n)})}var sB={};Ft(sB,{channelCreateEvent:()=>oB,channelHideMessageEvent:()=>cB,channelMessageEvent:()=>lB,channelMetadataEvent:()=>aB,channelMuteUserEvent:()=>uB});var oB=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return ns({kind:L3,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},aB=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return ns({kind:R3,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},lB=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),ns({kind:P3,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},cB=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return ns({kind:D3,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},uB=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return ns({kind:B3,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},fB={};Ft(fB,{EMOJI_SHORTCODE_REGEX:()=>uk,matchAll:()=>hB,regex:()=>$b,replaceAll:()=>dB});var uk=/:(\w+):/,$b=()=>new RegExp(`\\B${uk.source}\\B`,"g");function*hB(t){const e=t.matchAll($b());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function dB(t,e){return t.replaceAll($b(),(n,r)=>e({shortcode:n,name:r}))}var pB={};Ft(pB,{useFetchImplementation:()=>gB,validateGithub:()=>mB});var Mb;try{Mb=fetch}catch{}function gB(t){Mb=t}async function mB(t,e,n){try{return await(await Mb(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var yB={};Ft(yB,{makeNwcRequestEvent:()=>wB,parseConnectionString:()=>bB});function bB(t){const{host:e,pathname:n,searchParams:r}=new URL(t),i=n||e,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function wB(t,e,n){const i=q3(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:z3,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return ns(s,e)}var vB={};Ft(vB,{normalizeIdentifier:()=>EB});function EB(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var xB={};Ft(xB,{getSatoshisAmountFromBolt11:()=>TB,getZapEndpoint:()=>AB,makeZapReceipt:()=>CB,makeZapRequest:()=>kB,useFetchImplementation:()=>SB,validateZapRequest:()=>_B});var Nb;try{Nb=fetch}catch{}function SB(t){Nb=t}async function AB(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=Bl.decode(n,1e3),a=Bl.fromWords(o);e=Ss.decode(a)}else if(r){let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let s=await(await Nb(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function kB(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),gb(t.event.kind)){const n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(mb(t.event.kind)){let n=t.event.tags.find(([i,s])=>i==="d"&&s);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function _B(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!hb(e))return"Zap request is not a valid Nostr event.";if(!pb(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function CB({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}function TB(t){if(t.length<50)return 0;t=t.substring(0,50);const e=t.lastIndexOf("1");if(e===-1)return 0;const n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const l=parseInt(r.substring(0,a));switch(i){case"m":return l*1e5;case"u":return l*100;case"n":return l/10;case"p":return l/1e4;default:return l*1e8}}var IB={};Ft(IB,{getToken:()=>OB,hashPayload:()=>Lb,unpackEventFromToken:()=>hk,validateEvent:()=>bk,validateEventKind:()=>pk,validateEventMethodTag:()=>mk,validateEventPayloadTag:()=>yk,validateEventTimestamp:()=>dk,validateEventUrlTag:()=>gk,validateToken:()=>$B});var fk="Nostr ";async function OB(t,e,n,r=!1,i){const s={kind:vb,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",Lb(i)]);const o=await n(s);return(r?fk:"")+Yi.encode(vi.encode(JSON.stringify(o)))}async function $B(t,e,n){const r=await hk(t).catch(s=>{throw s});return await bk(r,e,n).catch(s=>{throw s})}async function hk(t){if(!t)throw new Error("Missing token");t=t.replace(fk,"");const e=Ss.decode(Yi.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function dk(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function pk(t){return t.kind===vb}function gk(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function mk(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function Lb(t){const e=Ga(vi.encode(JSON.stringify(t)));return un(e)}function yk(t,e){const n=t.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=Lb(e);return n.length>0&&n[1]===r}async function bk(t,e,n,r){if(!pb(t))throw new Error("Invalid nostr event, signature invalid");if(!pk(t))throw new Error("Invalid nostr event, kind invalid");if(!dk(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!gk(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!mk(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!yk(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function MB(t){try{return Os.npubEncode(t)}catch{return`npub1${t.slice(0,10)}...`}}class NB{constructor(e){this.rxNostr=e}addCacheBuster(e){if(!e)return e;try{const n=new URL(e);return n.searchParams.set("cb",Date.now().toString()),n.toString()}catch{return e}}addProfileMarker(e,n=!1){if(!e)return e;try{const r=new URL(e);return r.searchParams.set("profile","true"),n&&navigator.onLine?r.searchParams.has("cb")&&r.searchParams.set("cb",Date.now().toString()):r.searchParams.delete("cb"),r.toString()}catch{return e}}createProfileDataWithCacheBuster(e,n,r=!1){let i=e?.picture||"";return i&&(r&&(i=this.addCacheBuster(i)),i=this.addProfileMarker(i,r)),{name:e?.name||"",picture:i,npub:MB(n)}}saveToLocalStorage(e,n){try{if(n===null){localStorage.removeItem(`nostr-profile-${e}`);return}localStorage.setItem(`nostr-profile-${e}`,JSON.stringify(n)),console.log("プロフィール情報をローカルストレージに保存:",e)}catch(r){console.error("プロフィール情報の保存に失敗:",r)}}getFromLocalStorage(e){try{const n=localStorage.getItem(`nostr-profile-${e}`);if(!n)return null;const r=JSON.parse(n);return this.createProfileDataWithCacheBuster(r,e,!1)}catch(n){return console.error("プロフィール情報の取得に失敗:",n),null}}async fetchProfileData(e,n){if(console.log(`プロフィール取得開始: ${e}`),!n?.forceRemote){const r=this.getFromLocalStorage(e);if(r)return console.log("キャッシュからプロフィールを復元:",r),r}return console.log("リモートからプロフィール情報を取得中..."),new Promise(r=>{const i=Mf();let s=!1;const o=this.rxNostr.use(i).subscribe(a=>{if(a.event?.kind===0&&a.event.pubkey===e){s=!0;try{const l=JSON.parse(a.event.content),c=this.createProfileDataWithCacheBuster(l,e,n?.forceRemote);console.log("Kind 0からプロフィール情報を取得:",c),this.saveToLocalStorage(e,c),o.unsubscribe(),r(c)}catch(l){console.error("Kind 0のパースエラー:",l)}}});i.emit({authors:[e],kinds:[0]}),setTimeout(()=>{if(o.unsubscribe(),!s){console.log("プロフィール取得タイムアウト、デフォルトプロフィールを使用");const a=this.createProfileDataWithCacheBuster({},e,n?.forceRemote);this.saveToLocalStorage(e,a),r(a)}},3e3)})}}const zg=["wss://purplepag.es/","wss://directory.yabu.me/","wss://indexer.coracle.social/","wss://user.kindpag.es/"],Fg=["wss://relay.nostr.band/","wss://nos.lol/","wss://relay.damus.io/","wss://relay-jp.nostr.wirednet.jp/","wss://yabu.me/","wss://r.kojira.io/","wss://nrelay-jp.c-stellar.net/"],vc="https://nostrcheck.me/api/v2/media",LB=50*1024*1024,RB={none:{skip:!0},low:{maxWidthOrHeight:2048,fileType:"image/webp",initialQuality:.95,useWebWorker:!0},medium:{maxWidthOrHeight:1024,fileType:"image/webp",initialQuality:.8,useWebWorker:!0},high:{maxWidthOrHeight:800,fileType:"image/webp",initialQuality:.4,useWebWorker:!0}},C0=/(?:^|[\s\n\u3000])#([^\s\n\u3000#]+)/g,wk=["http:","https:"],PB=[".png",".jpg",".jpeg",".gif",".webp",".svg"],DB=400,x2=10,S2=100,A2=1,BB=10,k2=[{label:"yabu.me",url:"https://yabu.me/api/v2/media"},{label:"nostpic.com",url:"https://nostpic.com/api/v2/media"},{label:"nostrcheck.me",url:"https://nostrcheck.me/api/v2/media"},{label:"nostr.build",url:"https://nostr.build/api/v2/nip96/upload"}];function T0(t){return t==="ja"?"https://yabu.me/api/v2/media":"https://nostrcheck.me/api/v2/media"}function HB(t){return[{label:t("settingsDialog.compression_none")||"無圧縮",value:"none"},{label:t("settingsDialog.compression_low")||"低圧縮",value:"low"},{label:t("settingsDialog.compression_medium")||"中圧縮",value:"medium"},{label:t("settingsDialog.compression_high")||"高圧縮",value:"high"}]}const Rn={MIN_SCALE:1,MAX_SCALE:100,DEFAULT_SCALE:1,DOUBLE_CLICK_SCALE:2.5,RESET_THRESHOLD:1.3,ZOOM_DELTA:{IN:1.1,OUT:.9},THRESHOLD:.1,PINCH_MIN_DISTANCE:10},_2={EDITOR_FOCUS_DELAY:100,TRANSITION_DURATION:"0.3s"},UB={EDITOR:".tiptap-editor"};function zB(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t;let a,l,c;const u=async(h=!0)=>{await l,c?.()};async function f(){if("serviceWorker"in navigator){if(a=await iu(async()=>{const{Workbox:h}=await import("./workbox-window.prod.es5-CwtvwXb3.js");return{Workbox:h}},[]).then(({Workbox:h})=>new h("/ehagaki/sw.js",{scope:"/ehagaki/",type:"classic"})).catch(h=>{o?.(h)}),!a)return;c=()=>{a?.messageSkipWaiting()};{let h=!1;const d=()=>{h=!0,a?.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),n?.()};a.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"&&p.isExternal?d():!h&&r?.():p.isUpdate||r?.()}),a.addEventListener("waiting",d)}a.register({immediate:e}).then(h=>{s?s("/ehagaki/sw.js",h):i?.(h)}).catch(h=>{o?.(h)})}}return l=f(),u}function FB(t={}){const{immediate:e=!0,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t,a=Hr(!1),l=Hr(!1),c=zB({immediate:e,onOfflineReady(){l.set(!0),r?.()},onNeedRefresh(){a.set(!0),n?.()},onRegistered:i,onRegisteredSW:s,onRegisterError:o});return{needRefresh:a,offlineReady:l,updateServiceWorker:c}}let C2=He(rn({info:null,visible:!1}));const Pc={get value(){return F(C2)},set:t=>{ye(C2,t,!0)}},vk={type:"none",isAuthenticated:!1,pubkey:"",npub:"",nprofile:"",isValid:!1,isInitialized:!1,isExtensionLogin:!1};let Hl=He(rn(vk));const gi={get value(){return F(Hl)},subscribe:t=>{at(()=>{t(F(Hl))})}};function Rb(t){const n={...F(Hl),...t};n.isAuthenticated=n.type!=="none"&&n.isValid,n.isExtensionLogin=n.isAuthenticated&&n.type==="nostr-login"&&typeof window<"u"&&typeof window.nostr=="object"&&typeof window.nostr.signEvent=="function",ye(Hl,n,!0)}function jB(t=!0){ye(Hl,{...vk,isInitialized:t?F(Hl).isInitialized:!1},!0)}function T2(t,e,n){if(!t||!e||!n){console.warn("setNsecAuth: All parameters are required");return}Rb({type:"nsec",pubkey:t,npub:e,nprofile:n,isValid:!0})}function qB(t,e,n){if(!t||!e||!n){console.warn("setNostrLoginAuth: All parameters are required");return}Rb({type:"nostr-login",pubkey:t,npub:e,nprofile:n,isValid:!0})}function VB(){Rb({isInitialized:!0})}const cs=rn({file:null,metadata:void 0,received:!1});let I2=He(!1),O2=He(!1),$2=He(!1);const Dc={get value(){return F(I2)},set:t=>{ye(I2,t,!0)}},yh={get value(){return F(O2)},set:t=>{ye(O2,t,!0)}},Pb={get value(){return F($2)},set:t=>{ye($2,t,!0)}},Ek=FB({onRegistered(t){console.log("SW registered:",t)},onRegisterError(t){console.log("SW registration error",t)},onNeedRefresh(){console.log("SW needs refresh - showing prompt")}}),Db=Ek.needRefresh,WB=Ek.updateServiceWorker;let jg=He(rn({name:"",picture:""})),qg=He(!1),Vg=He(!1),Wg=He(!1);const Kg={get value(){return F(jg)},set:t=>{ye(jg,t,!0)},subscribe:t=>{at(()=>{t(F(jg))})}},Gg={get value(){return F(qg)},set:t=>{ye(qg,t,!0)},subscribe:t=>{at(()=>{t(F(qg))})}},Vr={get value(){return F(Vg)},set:t=>{ye(Vg,t,!0)},subscribe:t=>{at(()=>{t(F(Vg))})}},KB={get value(){return F(Wg)},set:t=>{ye(Wg,t,!0)},subscribe:t=>{at(()=>{t(F(Wg))})}};rn({content:"",hashtags:[],tags:[]});let Zg=He(null);const xk={get value(){return F(Zg)},set:t=>{ye(Zg,t,!0)},subscribe:t=>{at(()=>{t(F(Zg))})}};let Yg=He(null);const af={get value(){return F(Yg)},set:t=>{ye(Yg,t,!0)},subscribe:t=>{at(()=>{t(F(Yg))})}};function M2(t,e=3e3){if(t===null){Sk();return}Pc.set({info:t,visible:!0})}function Sk(){Pc.set({info:null,visible:!1})}function GB(){Dc.set(!0)}function Jg(){Dc.set(!1)}function ZB(){yh.set(!0)}function N2(){yh.set(!1)}function YB(){Pb.set(!0)}function JB(){Pb.set(!1)}function XB(){WB(!0)}let Xg=He(0);const I0={get value(){return F(Xg)},set:t=>{ye(Xg,t,!0)},subscribe:t=>{at(()=>{t(F(Xg))})}};async function QB(){return navigator.serviceWorker?.controller?new Promise(t=>{const e=new MessageChannel;if(e.port1.onmessage=n=>{n.data?.version?(xk.set(n.data.version),t(n.data.version)):t(null)},navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({type:"GET_VERSION"},[e.port2]);else{t(null);return}setTimeout(()=>t(null),2e3)}):null}function lf(t,e){try{if(e===null){localStorage.removeItem(`nostr-relays-${t}`);return}localStorage.setItem(`nostr-relays-${t}`,JSON.stringify(e)),I0.set(I0.value+1),console.log("リレーリストをローカルストレージに保存:",t)}catch(n){console.error("リレーリストの保存に失敗:",n)}}function Ak(t){try{const e=localStorage.getItem(`nostr-relays-${t}`);return e?JSON.parse(e):null}catch(e){return console.error("リレーリストの取得に失敗:",e),null}}function e9(t,e){const n=Ak(e);return n?(t.setDefaultRelays(n),console.log("ローカルストレージのリレーリストを使用:",n),!0):!1}function t9(t){const e={};return t.filter(n=>n.length>=2&&n[0]==="r").forEach(n=>{const r=n[1];let i=!0,s=!0;n.length>2&&(n.length===3?n[2]==="read"?s=!1:n[2]==="write"&&(i=!1):(i=n.includes("read"),s=n.includes("write"))),e[r]={read:i,write:s}}),e}class n9{rxNostr;constructor(e){this.rxNostr=e}saveToLocalStorage(e,n){lf(e,n)}getFromLocalStorage(e){return Ak(e)}setBootstrapRelays(){this.rxNostr.use(Mf(),{on:{relays:zg}}).subscribe()}useRelaysFromLocalStorageIfExists(e){return e9(this.rxNostr,e)}async fetchUserRelays(e,n){return console.log(`リレー取得開始: ${e}`),!n?.forceRemote&&this.useRelaysFromLocalStorageIfExists(e)?(console.log("ローカルストレージからリレーを復元しました"),!0):(console.log("リモートからリレー情報を取得中..."),await this.tryFetchKind10002(e,zg)?(console.log("Kind 10002からリレー取得成功"),!0):await this.tryFetchKind3(e,zg)?(console.log("Kind 3からリレー取得成功"),!0):(console.log("リモート取得失敗、フォールバックリレーを使用"),this.rxNostr.setDefaultRelays(Fg),console.log("フォールバックリレーを設定:",Fg),lf(e,Fg),!1))}async tryFetchKind10002(e,n){return console.log(`Kind 10002取得試行: ${e}`),new Promise(r=>{const i=Mf();let s=!1;const o=this.rxNostr.use(i,{on:{relays:n}}).subscribe(a=>{if(a.event?.kind===10002&&a.event.pubkey===e)try{const l=t9(a.event.tags);Object.keys(l).length>0&&(s=!0,this.rxNostr.setDefaultRelays(l),console.log("Kind 10002からリレーを設定:",l),lf(e,l),o.unsubscribe(),r(!0))}catch(l){console.error("Kind 10002のパースエラー:",l)}});i.emit({authors:[e],kinds:[10002]}),setTimeout(()=>{o.unsubscribe(),s||console.log("Kind 10002: タイムアウト"),r(s)},3e3)})}async tryFetchKind3(e,n){return console.log(`Kind 3取得試行: ${e}`),new Promise(r=>{const i=Mf();let s=!1;const o=this.rxNostr.use(i,{on:{relays:n}}).subscribe(a=>{if(a.event?.kind===3&&a.event.pubkey===e)try{const l=JSON.parse(a.event.content);l&&typeof l=="object"&&!Array.isArray(l)&&(s=!0,this.rxNostr.setDefaultRelays(l),console.log("Kind 3からリレーを設定:",l),lf(e,l),o.unsubscribe(),r(!0))}catch(l){console.error("Kind 3のパースエラー:",l)}});i.emit({authors:[e],kinds:[3]}),setTimeout(()=>{o.unsubscribe(),s||console.log("Kind 3: タイムアウト"),r(s)},3e3)})}}function Ln(t){this.content=t}Ln.prototype={constructor:Ln,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new Ln(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Ln(n)},addToStart:function(t,e){return new Ln([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Ln(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new Ln(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Ln.from(t),t.size?new Ln(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Ln.from(t),t.size?new Ln(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Ln.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Ln.from=function(t){if(t instanceof Ln)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Ln(e)};function kk(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=kk(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function _k(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=_k(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class Ee{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:s+=r),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new Ee(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new Ee(r,i)}cutByIndex(e,n){return e==n?Ee.empty:e==0&&n==this.content.length?this:new Ee(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new Ee(i,s)}addToStart(e){return new Ee([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Ee(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return kk(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return _k(this,e,n,r)}findIndex(e){if(e==0)return cf(0,e);if(e==this.size)return cf(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),s=r+i.nodeSize;if(s>=e)return s==e?cf(n+1,s):cf(n,r);r=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Ee.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Ee(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Ee.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new Ee(n||e,r)}static from(e){if(!e)return Ee.empty;if(e instanceof Ee)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Ee([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Ee.empty=new Ee([],0);const Qg={index:0,offset:0};function cf(t,e){return Qg.index=t,Qg.offset=e,Qg}function bh(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!bh(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!bh(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let Nt=class O0{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&bh(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let i=r.create(n.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return O0.none;if(e instanceof O0)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}};Nt.none=[];class wh extends Error{}class De{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=Tk(this.content,e+this.openStart,n);return r&&new De(r,this.openStart,this.openEnd)}removeBetween(e,n){return new De(Ck(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return De.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new De(Ee.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new De(e,r,i)}}De.empty=new De(Ee.empty,0,0);function Ck(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(Ck(s.content,e-i-1,n-i-1)))}function Tk(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=Tk(o.content,e-s-1,n,o);return a&&t.replaceChild(i,o.copy(a))}function r9(t,e,n){if(n.openStart>t.depth)throw new wh("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new wh("Inconsistent open depths");return Ik(t,e,n,0)}function Ik(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=Ik(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return _a(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=i9(n,t);return _a(s,$k(t,o,a,e,r))}else return _a(s,vh(t,e,r))}function Ok(t,e){if(!e.type.compatibleContent(t.type))throw new wh("Cannot join "+e.type.name+" onto "+t.type.name)}function $0(t,e,n){let r=t.node(n);return Ok(r,e.node(n)),r}function ka(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Bc(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(ka(t.nodeAfter,r),s++));for(let a=s;a<o;a++)ka(i.child(a),r);e&&e.depth==n&&e.textOffset&&ka(e.nodeBefore,r)}function _a(t,e){return t.type.checkContent(e),t.copy(e)}function $k(t,e,n,r,i){let s=t.depth>i&&$0(t,e,i+1),o=r.depth>i&&$0(n,r,i+1),a=[];return Bc(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(Ok(s,o),ka(_a(s,$k(t,e,n,r,i+1)),a)):(s&&ka(_a(s,vh(t,e,i+1)),a),Bc(e,n,i,a),o&&ka(_a(o,vh(n,r,i+1)),a)),Bc(r,null,i,a),new Ee(a)}function vh(t,e,n){let r=[];if(Bc(null,t,n,r),t.depth>n){let i=$0(t,e,n+1);ka(_a(i,vh(t,e,n+1)),r)}return Bc(e,null,n,r),new Ee(r)}function i9(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(Ee.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class lu{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Nt.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new Eh(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new lu(n,r,s)}static resolveCached(e,n){let r=L2.get(e);if(r)for(let s=0;s<r.elts.length;s++){let o=r.elts[s];if(o.pos==n)return o}else L2.set(e,r=new s9);let i=r.elts[r.i]=lu.resolve(e,n);return r.i=(r.i+1)%o9,i}}class s9{constructor(){this.elts=[],this.i=0}}const o9=12,L2=new WeakMap;class Eh{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const a9=Object.create(null);let Lo=class M0{constructor(e,n,r,i=Nt.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||Ee.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&bh(this.attrs,n||e.defaultAttrs||a9)&&Nt.sameSet(this.marks,r||Nt.none)}copy(e=null){return e==this.content?this:new M0(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new M0(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return De.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new De(c,i.depth-o,s.depth-o)}replace(e,n,r){return r9(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return lu.resolveCached(this,e)}resolveNoCache(e){return lu.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Mk(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=Ee.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Nt.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Nt.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=Ee.fromJSON(e,n.content),s=e.nodeType(n.type).create(n.attrs,i,r);return s.type.checkAttrs(s.attrs),s}};Lo.prototype.text=void 0;class xh extends Lo{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Mk(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new xh(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new xh(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function Mk(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Pa{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new l9(e,n);if(r.next==null)return Pa.empty;let i=Nk(r);r.next&&r.err("Unexpected trailing text");let s=g9(p9(i));return m9(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return Ee.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:f}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(f)==-1){i.push(f);let h=s(f,a.concat(u));if(h)return h}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}Pa.empty=new Pa(!0);class l9{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function Nk(t){let e=[];do e.push(c9(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function c9(t){let e=[];do e.push(u9(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function u9(t){let e=d9(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=f9(t,e);else break;return e}function R2(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function f9(t,e){let n=R2(t),r=n;return t.eat(",")&&(t.next!="}"?r=R2(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function h9(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function d9(t){if(t.eat("(")){let e=Nk(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=h9(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function p9(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function Lk(t,e){return e-t}function P2(t,e){let n=[];return r(e),n.sort(Lk);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function g9(t){let e=Object.create(null);return n(P2(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);P2(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new Pa(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(Lk);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function m9(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Rk(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function Pk(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function Dk(t,e,n,r){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${n} of type ${i}`);for(let i in t){let s=t[i];s.validate&&s.validate(e[i])}}function Bk(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new b9(t,r,e[r]);return n}let D2=class Hk{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=Bk(e,r.attrs),this.defaultAttrs=Rk(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Pa.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:Pk(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Lo(this,this.computeAttrs(e),Ee.from(n),Nt.setFrom(r))}createChecked(e=null,n,r){return n=Ee.from(n),this.checkContent(n),new Lo(this,this.computeAttrs(e),n,Nt.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=Ee.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(Ee.empty,!0);return s?new Lo(this,e,n.append(s),Nt.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Dk(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Nt.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new Hk(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function y9(t,e,n){let r=n.split("|");return i=>{let s=i===null?"null":typeof i;if(r.indexOf(s)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${s}`)}}class b9{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?y9(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class ep{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=Bk(e,i.attrs),this.excluded=null;let s=Rk(this.attrs);this.instance=s?new Nt(this,s):null}create(e=null){return!e&&this.instance?this.instance:new Nt(this,Pk(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new ep(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){Dk(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class Uk{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let i in e)n[i]=e[i];n.nodes=Ln.from(e.nodes),n.marks=Ln.from(e.marks||{}),this.nodes=D2.compile(this.spec.nodes,this),this.marks=ep.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=r[o]||(r[o]=Pa.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?B2(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:B2(this,o.split(" "))}this.nodeFromJSON=i=>Lo.fromJSON(this,i),this.markFromJSON=i=>Nt.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof D2){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new xh(r,r.defaultAttrs,e,Nt.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function B2(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function w9(t){return t.tag!=null}function v9(t){return t.style!=null}class Ro{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(i=>{if(w9(i))this.tags.push(i);else if(v9(i)){let s=/[^=]*/.exec(i.style)[0];r.indexOf(s)<0&&r.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,n={}){let r=new U2(this,n,!1);return r.addAll(e,Nt.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new U2(this,n,!0);return r.addAll(e,Nt.none,n.from,n.to),De.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(S9(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=z2(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=z2(o)),o.node||o.ignore||o.mark||(o.node=i)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ro(e,Ro.schemaRules(e)))}}const zk={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},E9={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Fk={ol:!0,ul:!0},cu=1,N0=2,Hc=4;function H2(t,e,n){return e!=null?(e?cu:0)|(e==="full"?N0:0):t&&t.whitespace=="pre"?cu|N0:n&~Hc}class uf{constructor(e,n,r,i,s,o){this.type=e,this.attrs=n,this.marks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=Nt.none,this.match=s||(o&Hc?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Ee.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&cu)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=Ee.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Ee.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!zk.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class U2{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let i=n.topNode,s,o=H2(null,n.preserveWhitespace,0)|(r?Hc:0);i?s=new uf(i.type,i.attrs,Nt.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new uf(null,null,Nt.none,!0,null,o):s=new uf(e.schema.topNodeType,null,Nt.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,i=this.top,s=i.options&N0?"full":this.localPreserveWS||(i.options&cu)>0;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(s)s!=="full"?r=r.replace(/\r?\n|\r/g," "):r=r.replace(/\r\n?/g,`
`);else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let o=i.content[i.content.length-1],a=e.previousSibling;(!o||a&&a.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Fk.hasOwnProperty(o)&&this.parser.normalizeLists&&x9(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:E9.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(zk.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let f=l&&l.skip?n:this.readStyles(e,n);f&&this.addAll(e,f),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=r.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,i){let s,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(s=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,n,r,i){let s=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,n);this.findAtPoint(e,s)}findPlace(e,n,r){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)n=this.enterInner(i[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(n=this.enterInner(s,null,n))}let i=this.findPlace(e,n,r);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=Nt.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):F2(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,n,r,i){let s=this.findPlace(e.create(n),r,!1);return s&&(s=this.enterInner(e,n,r,!0,i)),s}enterInner(e,n,r,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=H2(e,s,o.options);o.options&Hc&&o.content.length==0&&(a|=Hc);let l=Nt.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):F2(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new uf(e,n,l,i,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=cu)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function x9(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Fk.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function S9(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function z2(t){let e={};for(let n in t)e[n]=t[n];return e}function F2(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class Za{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=em(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=Rf(em(n),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&Rf(em(r),i(e,n),null,e.attrs)}static renderSpec(e,n,r=null,i){return Rf(e,n,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Za(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=j2(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return j2(e.marks)}}function j2(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function em(t){return t.document||window.document}const q2=new WeakMap;function A9(t){let e=q2.get(t);return e===void 0&&q2.set(t,e=k9(t)),e}function k9(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)n(r[i]);else for(let i in r)n(r[i])}return n(t),e}function Rf(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(s=A9(r))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));let a,l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let f in c)if(c[f]!=null){let h=f.indexOf(" ");h>0?l.setAttributeNS(f.slice(0,h),f.slice(h+1),c[f]):f=="style"&&l.style?l.style.cssText=c[f]:l.setAttribute(f,c[f])}}for(let f=u;f<e.length;f++){let h=e[f];if(h===0){if(f<e.length-1||f>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:d,contentDOM:p}=Rf(t,h,n,r);if(l.appendChild(d),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const jk=65535,qk=Math.pow(2,16);function _9(t,e){return t+e*qk}function V2(t){return t&jk}function C9(t){return(t-(t&jk))/qk}const Vk=1,Wk=2,Pf=4,Kk=8;class L0{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&Kk)>0}get deletedBefore(){return(this.delInfo&(Vk|Pf))>0}get deletedAfter(){return(this.delInfo&(Wk|Pf))>0}get deletedAcross(){return(this.delInfo&Pf)>0}}class Dr{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Dr.empty)return Dr.empty}recover(e){let n=0,r=V2(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+C9(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],f=l+c;if(e<=f){let h=c?e==l?-1:e==f?1:n:n,d=l+i+(h<0?0:u);if(r)return d;let p=e==(n<0?l:f)?null:_9(a/3,e-l),g=e==l?Wk:e==f?Vk:Pf;return(n<0?e!=l:e!=f)&&(g|=Kk),new L0(d,g,p)}i+=u-c}return r?e+i:new L0(e+i,0,null)}touches(e,n){let r=0,i=V2(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new Dr(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Dr.empty:new Dr(e<0?[0,-e,0]:[0,0,e])}}Dr.empty=new Dr([]);class uu{constructor(e,n,r=0,i=e?e.length:0){this.mirror=n,this.from=r,this.to=i,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new uu(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let i=e.getMirror(n);this.appendMap(e._maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e._maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new uu;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new L0(e,i,null)}}const tm=Object.create(null);class cr{getMap(){return Dr.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=tm[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in tm)throw new RangeError("Duplicate use of step JSON ID "+e);return tm[e]=n,n.prototype.jsonID=e,n}}class fn{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new fn(e,null)}static fail(e){return new fn(null,e)}static fromReplace(e,n,r,i){try{return fn.ok(e.replace(n,r,i))}catch(s){if(s instanceof wh)return fn.fail(s.message);throw s}}}function Bb(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(Bb(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return Ee.fromArray(r)}class Co extends cr{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new De(Bb(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return fn.fromReplace(e,this.from,this.to,s)}invert(){return new qi(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Co(n.pos,r.pos,this.mark)}merge(e){return e instanceof Co&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Co(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Co(n.from,n.to,e.markFromJSON(n.mark))}}cr.jsonID("addMark",Co);class qi extends cr{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new De(Bb(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return fn.fromReplace(e,this.from,this.to,r)}invert(){return new Co(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new qi(n.pos,r.pos,this.mark)}merge(e){return e instanceof qi&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new qi(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new qi(n.from,n.to,e.markFromJSON(n.mark))}}cr.jsonID("removeMark",qi);class To extends cr{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return fn.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return fn.fromReplace(e,this.pos,this.pos+1,new De(Ee.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new To(this.pos,n.marks[i]);return new To(this.pos,this.mark)}}return new Da(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new To(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new To(n.pos,e.markFromJSON(n.mark))}}cr.jsonID("addNodeMark",To);class Da extends cr{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return fn.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return fn.fromReplace(e,this.pos,this.pos+1,new De(Ee.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new To(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Da(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Da(n.pos,e.markFromJSON(n.mark))}}cr.jsonID("removeNodeMark",Da);class vn extends cr{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&R0(e,this.from,this.to)?fn.fail("Structure replace would overwrite content"):fn.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Dr([this.from,this.to-this.from,this.slice.size])}invert(e){return new vn(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new vn(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof vn)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?De.empty:new De(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new vn(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?De.empty:new De(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new vn(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new vn(n.from,n.to,De.fromJSON(e,n.slice),!!n.structure)}}cr.jsonID("replace",vn);class Sn extends cr{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(R0(e,this.from,this.gapFrom)||R0(e,this.gapTo,this.to)))return fn.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return fn.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?fn.fromReplace(e,this.from,this.to,r):fn.fail("Content does not fit in gap")}getMap(){return new Dr([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Sn(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new Sn(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Sn(n.from,n.to,n.gapFrom,n.gapTo,De.fromJSON(e,n.slice),n.insert,!!n.structure)}}cr.jsonID("replaceAround",Sn);function R0(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function T9(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let f=l.marks;if(!r.isInSet(f)&&u.type.allowsMarkType(r.type)){let h=Math.max(c,e),d=Math.min(c+l.nodeSize,n),p=r.addToSet(f);for(let g=0;g<f.length;g++)f[g].isInSet(p)||(o&&o.to==h&&o.mark.eq(f[g])?o.to=d:i.push(o=new qi(h,d,f[g])));a&&a.to==h?a.to=d:s.push(a=new Co(h,d,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function I9(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof ep){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let f=l[u],h;for(let d=0;d<i.length;d++){let p=i[d];p.step==s-1&&f.eq(i[d].style)&&(h=p)}h?(h.to=c,h.step=s):i.push({style:f,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new qi(o.from,o.to,o.style)))}function Hb(t,e,n,r=n.contentMatch,i=!0){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,f=r.matchType(c.type);if(!f)o.push(new vn(a,u,De.empty));else{r=f;for(let h=0;h<c.marks.length;h++)n.allowsMarkType(c.marks[h].type)||t.step(new qi(a,u,c.marks[h]));if(i&&c.isText&&n.whitespace!="pre"){let h,d=/\r?\n|\r/g,p;for(;h=d.exec(c.text);)p||(p=new De(Ee.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new vn(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!r.validEnd){let l=r.fillBefore(Ee.empty,!0);t.replace(a,a,new De(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function O9(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function nc(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let i=t.$from.node(r),s=t.$from.index(r),o=t.$to.indexAfter(r);if(r<t.depth&&i.canReplace(s,o,n))return r;if(r==0||i.type.spec.isolating||!O9(i,s,o))break}return null}function $9(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=Ee.empty,f=0;for(let p=s,g=!1;p>n;p--)g||r.index(p)>0?(g=!0,u=Ee.from(r.node(p).copy(u)),f++):l--;let h=Ee.empty,d=0;for(let p=s,g=!1;p>n;p--)g||i.after(p+1)<i.end(p)?(g=!0,h=Ee.from(i.node(p).copy(h)),d++):c++;t.step(new Sn(l,c,o,a,new De(u.append(h),f,d),u.size-f,!0))}function Ub(t,e,n=null,r=t){let i=M9(t,e),s=i&&N9(r,e);return s?i.map(W2).concat({type:e,attrs:n}).concat(s.map(W2)):null}function W2(t){return{type:t,attrs:null}}function M9(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function N9(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function L9(t,e,n){let r=Ee.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Ee.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new Sn(i,s,i,s,new De(r,0,0),n.length,!0))}function R9(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(r,l)&&P9(t.doc,t.mapping.slice(s).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let d=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);d&&!p?c=!1:!d&&p&&(c=!0)}c===!1&&Zk(t,o,a,s),Hb(t,t.mapping.slice(s).map(a,1),r,void 0,c===null);let u=t.mapping.slice(s),f=u.map(a,1),h=u.map(a+o.nodeSize,1);return t.step(new Sn(f,h,f+1,h-1,new De(Ee.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&Gk(t,o,a,s),!1}})}function Gk(t,e,n,r){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=t.mapping.slice(r).map(n+1+s+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Zk(t,e,n,r){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+s);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function P9(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function D9(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Sn(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new De(Ee.from(o),0,0),1,!0))}function $s(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let f=i.node(c),h=i.index(c);if(f.type.spec.isolating)return!1;let d=f.content.cutByIndex(h,f.childCount),p=r&&r[u+1];p&&(d=d.replaceChild(0,p.type.create(p.attrs)));let g=r&&r[u]||f;if(!f.canReplace(h+1,f.childCount)||!g.type.validContent(d))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function B9(t,e,n=1,r){let i=t.doc.resolve(e),s=Ee.empty,o=Ee.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=Ee.from(i.node(a).copy(s));let u=r&&r[c];o=Ee.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new vn(e,e,new De(s.append(o),n,n),!0))}function Jo(t,e){let n=t.resolve(e),r=n.index();return Yk(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function H9(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==r?t.type.schema.nodes.text:s.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(s.marks))return!1}return n.validEnd}function Yk(t,e){return!!(t&&e&&!t.isLeaf&&H9(t,e))}function tp(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let s,o,a=r.index(i);if(i==r.depth?(s=r.nodeBefore,o=r.nodeAfter):n>0?(s=r.node(i+1),a++,o=r.node(i).maybeChild(a)):(s=r.node(i).maybeChild(a-1),o=r.node(i+1)),s&&!s.isTextblock&&Yk(s,o)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=n<0?r.before(i):r.after(i)}}function U9(t,e,n){let r=null,{linebreakReplacement:i}=t.doc.type.schema,s=t.doc.resolve(e-n),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",f=!!o.contentMatch.matchType(i);u&&!f?r=!1:!u&&f&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);Zk(t,u.node(),u.before(),a)}o.inlineContent&&Hb(t,e+n-1,o,s.node().contentMatchAt(s.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new vn(c,l.map(e+n,-1),De.empty,!0)),r===!0){let u=t.doc.resolve(c);Gk(t,u.node(),u.before(),t.steps.length)}return t}function z9(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function Jk(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let f=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=f&&c.canReplaceWith(l,l,f[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function np(t,e,n=e,r=De.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return Xk(i,s,r)?new vn(e,n,r):new F9(i,s,r).fit()}function Xk(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class F9{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=Ee.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Ee.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new De(s,o,a);return e>-1?new Sn(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new vn(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let s=n.firstChild;if(n.childCount>1&&(i=0),s.type.spec.isolating&&i<=r){e=r;break}n=s.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let i,s=null;r?(s=nm(this.unplaced.content,r-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,f=null;if(n==1&&(o?c.matchType(o.type)||(f=c.fillBefore(Ee.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:r,frontierDepth:a,parent:s,inject:f};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=nm(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new De(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=nm(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new De(Cc(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new De(Cc(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let g=0;g<s.length;g++)this.openFrontierNode(s[g]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:f,type:h}=this.frontier[n];if(i){for(let g=0;g<i.childCount;g++)u.push(i.child(g));f=f.matchFragment(i)}let d=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let g=a.child(c),b=f.matchType(g.type);if(!b)break;c++,(c>1||l==0||g.content.size)&&(f=b,u.push(Qk(g.mark(h.allowedMarks(g.marks)),c==1?l:0,c==a.childCount?d:-1)))}let p=c==a.childCount;p||(d=-1),this.placed=Tc(this.placed,n,Ee.from(u)),this.frontier[n].match=f,p&&d<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let g=0,b=a;g<d;g++){let w=b.lastChild;this.frontier.push({type:w.type,match:w.contentMatchAt(w.childCount)}),b=w.content}this.unplaced=p?e==0?De.empty:new De(Cc(o.content,e-1,1),e-1,d<0?o.openEnd:e-1):new De(Cc(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!rm(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=rm(e,n,i,r,s);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=rm(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Tc(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=Tc(this.placed,this.depth,Ee.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Ee.empty,!0);n.childCount&&(this.placed=Tc(this.placed,this.frontier.length,n))}}function Cc(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Cc(t.firstChild.content,e-1,n)))}function Tc(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Tc(t.lastChild.content,e-1,n)))}function nm(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function Qk(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,Qk(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Ee.empty,!0)))),t.copy(r)}function rm(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!j9(n,s.content,o)?a:null}function j9(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function q9(t){return t.spec.defining||t.spec.definingForContent}function V9(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(Xk(i,s,r))return t.step(new vn(e,n,r));let o=t_(i,t.doc.resolve(n));o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let h=i.depth,d=i.pos-1;h>0;h--,d--){let p=i.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:i.before(h)==d&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=r.openStart;for(let h=r.content,d=0;;d++){let p=h.firstChild;if(c.push(p),d==r.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let d=c[h],p=q9(d.type);if(p&&!d.sameMarkup(i.node(Math.abs(a)-1)))u=h;else if(p||!d.type.isTextblock)break}for(let h=r.openStart;h>=0;h--){let d=(h+u+1)%(r.openStart+1),p=c[d];if(p)for(let g=0;g<o.length;g++){let b=o[(g+l)%o.length],w=!0;b<0&&(w=!1,b=-b);let x=i.node(b-1),T=i.index(b-1);if(x.canReplaceWith(T,T,p.type,p.marks))return t.replace(i.before(b),w?s.after(b):n,new De(e_(r.content,0,r.openStart,d),d,r.openEnd))}}let f=t.steps.length;for(let h=o.length-1;h>=0&&(t.replace(e,n,r),!(t.steps.length>f));h--){let d=o[h];d<0||(e=i.before(d),n=s.after(d))}}function e_(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(e_(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(Ee.empty,!0))}return t}function W9(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=z9(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new De(Ee.from(r),0,0))}function K9(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=t_(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function t_(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class Sl extends cr{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return fn.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return fn.fromReplace(e,this.pos,this.pos+1,new De(Ee.from(i),0,n.isLeaf?0:1))}getMap(){return Dr.empty}invert(e){return new Sl(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Sl(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Sl(n.pos,n.attr,n.value)}}cr.jsonID("attr",Sl);class fu extends cr{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return fn.ok(r)}getMap(){return Dr.empty}invert(e){return new fu(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new fu(n.attr,n.value)}}cr.jsonID("docAttr",fu);let Ul=class extends Error{};Ul=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Ul.prototype=Object.create(Error.prototype);Ul.prototype.constructor=Ul;Ul.prototype.name="TransformError";class n_{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new uu}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Ul(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=De.empty){let i=np(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new De(Ee.from(r),0,0))}delete(e,n){return this.replace(e,n,De.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return V9(this,e,n,r),this}replaceRangeWith(e,n,r){return W9(this,e,n,r),this}deleteRange(e,n){return K9(this,e,n),this}lift(e,n){return $9(this,e,n),this}join(e,n=1){return U9(this,e,n),this}wrap(e,n){return L9(this,e,n),this}setBlockType(e,n=e,r,i=null){return R9(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i){return D9(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new Sl(e,n,r)),this}setDocAttribute(e,n){return this.step(new fu(e,n)),this}addNodeMark(e,n){return this.step(new To(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof Nt)n.isInSet(r.marks)&&this.step(new Da(e,n));else{let i=r.marks,s,o=[];for(;s=n.isInSet(i);)o.push(new Da(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return B9(this,e,n,r),this}addMark(e,n,r){return T9(this,e,n,r),this}removeMark(e,n,r){return I9(this,e,n,r),this}clearIncompatible(e,n,r){return Hb(this,e,n,r),this}}const im=Object.create(null);class lt{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new G9(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=De.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?De.empty:n),a==0&&Z2(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),Z2(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new nt(e):ll(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?ll(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):ll(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Ur(e.node(0))}static atStart(e){return ll(e,e,0,0,1)||new Ur(e)}static atEnd(e){return ll(e,e,e.content.size,e.childCount,-1)||new Ur(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=im[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in im)throw new RangeError("Duplicate use of selection JSON ID "+e);return im[e]=n,n.prototype.jsonID=e,n}getBookmark(){return nt.between(this.$anchor,this.$head).getBookmark()}}lt.prototype.visible=!0;class G9{constructor(e,n){this.$from=e,this.$to=n}}let K2=!1;function G2(t){!K2&&!t.parent.inlineContent&&(K2=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class nt extends lt{constructor(e,n=e){G2(e),G2(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return lt.near(r);let i=e.resolve(n.map(this.anchor));return new nt(i.parent.inlineContent?i:r,r)}replace(e,n=De.empty){if(super.replace(e,n),n==De.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof nt&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new rp(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new nt(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=lt.findFrom(n,r,!0)||lt.findFrom(n,-r,!0);if(s)n=s.$head;else return lt.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(lt.findFrom(e,-r,!0)||lt.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new nt(e,n)}}lt.jsonID("text",nt);class rp{constructor(e,n){this.anchor=e,this.head=n}map(e){return new rp(e.map(this.anchor),e.map(this.head))}resolve(e){return nt.between(e.resolve(this.anchor),e.resolve(this.head))}}class Ge extends lt{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?lt.near(s):new Ge(s)}content(){return new De(Ee.from(this.node),0,0)}eq(e){return e instanceof Ge&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new zb(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Ge(e.resolve(n.anchor))}static create(e,n){return new Ge(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Ge.prototype.visible=!1;lt.jsonID("node",Ge);class zb{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new rp(r,r):new zb(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&Ge.isSelectable(r)?new Ge(n):lt.near(n)}}class Ur extends lt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=De.empty){if(n==De.empty){e.delete(0,e.doc.content.size);let r=lt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Ur(e)}map(e){return new Ur(e)}eq(e){return e instanceof Ur}getBookmark(){return Z9}}lt.jsonID("all",Ur);const Z9={map(){return this},resolve(t){return new Ur(t)}};function ll(t,e,n,r,i,s=!1){if(e.inlineContent)return nt.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&Ge.isSelectable(a))return Ge.create(t,n-(i<0?a.nodeSize:0))}else{let l=ll(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function Z2(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof vn||i instanceof Sn))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(lt.near(t.doc.resolve(o),n))}const Y2=1,ff=2,J2=4;class Y9 extends n_{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Y2)&~ff,this.storedMarks=null,this}get selectionSet(){return(this.updated&Y2)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=ff,this}ensureMarks(e){return Nt.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&ff)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~ff,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Nt.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),r=r??n,!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),this.selection.empty||this.setSelection(lt.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=J2,this}get scrolledIntoView(){return(this.updated&J2)>0}}function X2(t,e){return!e||!t?t:t.bind(e)}class Ic{constructor(e,n,r){this.name=e,this.init=X2(n.init,r),this.apply=X2(n.apply,r)}}const J9=[new Ic("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Ic("selection",{init(t,e){return t.selection||lt.atStart(e.doc)},apply(t){return t.selection}}),new Ic("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Ic("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class sm{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=J9.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Ic(r.key,r.spec.state,r))})}}class dl{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let f=0;f<this.config.plugins.length;f++)i.push(f<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new dl(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new Y9(this)}static create(e){let n=new sm(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new dl(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new sm(this.schema,e.plugins),r=n.fields,i=new dl(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new sm(e.schema,e.plugins),s=new dl(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=Lo.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=lt.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function r_(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=r_(i,e,{})),n[r]=i}return n}class Dt{constructor(e){this.spec=e,this.props={},e.props&&r_(e.props,this,this.props),this.key=e.key?e.key.key:i_("plugin")}getState(e){return e[this.key]}}const om=Object.create(null);function i_(t){return t in om?t+"$"+ ++om[t]:(om[t]=0,t+"$")}class on{constructor(e="key"){this.key=i_(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Hn=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},zl=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let P0=null;const gs=function(t,e,n){let r=P0||(P0=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},X9=function(){P0=null},Ba=function(t,e,n,r){return n&&(Q2(t,e,n,r,-1)||Q2(t,e,n,r,1))},Q9=/^(img|br|input|textarea|hr)$/i;function Q2(t,e,n,r,i){for(var s;;){if(t==n&&e==r)return!0;if(e==(i<0?0:ni(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Du(t)||Q9.test(t.nodeName)||t.contentEditable=="false")return!1;e=Hn(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else t=o,e=i<0?ni(t):0}else return!1}}function ni(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function eH(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=ni(t)}else if(t.parentNode&&!Du(t))e=Hn(t),t=t.parentNode;else return null}}function tH(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Du(t))e=Hn(t)+1,t=t.parentNode;else return null}}function nH(t,e,n){for(let r=e==0,i=e==ni(t);r||i;){if(t==n)return!0;let s=Hn(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==ni(t)}}function Du(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const ip=function(t){return t.focusNode&&Ba(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function ha(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function rH(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function iH(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(ni(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(ni(r.startContainer),r.startOffset)}}}const Ji=typeof navigator<"u"?navigator:null,eE=typeof document<"u"?document:null,Xo=Ji&&Ji.userAgent||"",D0=/Edge\/(\d+)/.exec(Xo),s_=/MSIE \d/.exec(Xo),B0=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Xo),Or=!!(s_||B0||D0),Po=s_?document.documentMode:B0?+B0[1]:D0?+D0[1]:0,Ei=!Or&&/gecko\/(\d+)/i.test(Xo);Ei&&+(/Firefox\/(\d+)/.exec(Xo)||[0,0])[1];const H0=!Or&&/Chrome\/(\d+)/.exec(Xo),sr=!!H0,o_=H0?+H0[1]:0,pr=!Or&&!!Ji&&/Apple Computer/.test(Ji.vendor),Fl=pr&&(/Mobile\/\w+/.test(Xo)||!!Ji&&Ji.maxTouchPoints>2),ei=Fl||(Ji?/Mac/.test(Ji.platform):!1),sH=Ji?/Win/.test(Ji.platform):!1,As=/Android \d/.test(Xo),Bu=!!eE&&"webkitFontSmoothing"in eE.documentElement.style,oH=Bu?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function aH(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function us(t,e){return typeof t=="number"?t:t[e]}function lH(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function tE(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=zl(o);continue}let a=o,l=a==s.body,c=l?aH(s):lH(a),u=0,f=0;if(e.top<c.top+us(r,"top")?f=-(c.top-e.top+us(i,"top")):e.bottom>c.bottom-us(r,"bottom")&&(f=e.bottom-e.top>c.bottom-c.top?e.top+us(i,"top")-c.top:e.bottom-c.bottom+us(i,"bottom")),e.left<c.left+us(r,"left")?u=-(c.left-e.left+us(i,"left")):e.right>c.right-us(r,"right")&&(u=e.right-c.right+us(i,"right")),u||f)if(l)s.defaultView.scrollBy(u,f);else{let d=a.scrollLeft,p=a.scrollTop;f&&(a.scrollTop+=f),u&&(a.scrollLeft+=u);let g=a.scrollLeft-d,b=a.scrollTop-p;e={left:e.left-g,top:e.top-b,right:e.right-g,bottom:e.bottom-b}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:zl(o)}}function cH(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:a_(t.dom)}}function a_(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=zl(r));return e}function uH({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;l_(n,r==0?0:r-e)}function l_(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let il=null;function fH(t){if(t.setActive)return t.setActive();if(il)return t.focus(il);let e=a_(t);t.focus(il==null?{get preventScroll(){return il={preventScroll:!0},!0}}:void 0),il||(il=!1,l_(e,0))}function c_(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,f=0;u;u=u.nextSibling,f++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=gs(u).getClientRects();else continue;for(let d=0;d<h.length;d++){let p=h[d];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let g=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(g<r){n=u,r=g,i=g&&n.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&g&&(s=f+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(s=f+1)}}return!n&&l&&(n=l,i=c,r=0),n&&n.nodeType==3?hH(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:c_(n,i)}function hH(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let s=go(r,1);if(s.top!=s.bottom&&Fb(e,s))return{node:t,offset:i+(e.left>=(s.left+s.right)/2?1:0)}}return{node:t,offset:0}}function Fb(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function dH(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function pH(t,e,n){let{node:r,offset:i}=c_(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function gH(t,e,n,r){let i=-1;for(let s=e,o=!1;s!=t.dom;){let a=t.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?i=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function u_(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(Fb(e,c))return u_(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function mH(t,e){let n=t.dom.ownerDocument,r,i=0,s=iH(n,e.left,e.top);s&&({node:r,offset:i}=s);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!Fb(e,c)||(o=u_(t.dom,e,c),!o))return null}if(pr)for(let c=o;r&&c;c=zl(c))c.draggable&&(r=void 0);if(o=dH(o,e),r){if(Ei&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let u=r.childNodes[i],f;u.nodeName=="IMG"&&(f=u.getBoundingClientRect()).right<=e.left&&f.bottom>e.top&&i++}let c;Bu&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=gH(t,r,i,e))}a==null&&(a=pH(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function nE(t){return t.top<t.bottom||t.left<t.right}function go(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(nE(r))return r}return Array.prototype.find.call(n,nE)||t.getBoundingClientRect()}const yH=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function f_(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=Bu||Ei;if(r.nodeType==3)if(o&&(yH.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=go(gs(r,i,i),n);if(Ei&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=go(gs(r,i-1,i-1),-1);if(c.top==l.top){let u=go(gs(r,i,i+1),-1);if(u.top!=l.top)return Ec(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,Ec(go(gs(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==ni(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return am(l.getBoundingClientRect(),!1)}if(s==null&&i<ni(r)){let l=r.childNodes[i];if(l.nodeType==1)return am(l.getBoundingClientRect(),!0)}return am(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==ni(r))){let l=r.childNodes[i-1],c=l.nodeType==3?gs(l,ni(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Ec(go(c,1),!1)}if(s==null&&i<ni(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?gs(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Ec(go(c,-1),!0)}return Ec(go(r.nodeType==3?gs(r):r,-n),n>=0)}function Ec(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function am(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function h_(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function bH(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return h_(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=f_(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=gs(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const wH=/[\u0590-\u08ac]/;function vH(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return a?!wH.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:h_(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:f}=t.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",n,"character");let d=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:p,focusOffset:g}=t.domSelectionRange(),b=p&&!d.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==g;try{a.collapse(u,f),l&&(l!=u||c!=f)&&a.extend&&a.extend(l,c)}catch{}return h!=null&&(a.caretBidiLevel=h),b}):r.pos==r.start()||r.pos==r.end()}let rE=null,iE=null,sE=!1;function EH(t,e,n){return rE==e&&iE==n?sE:(rE=e,iE=n,sE=n=="up"||n=="down"?bH(t,e,n):vH(t,e,n))}const ii=0,oE=1,ma=2,Xi=3;class Hu{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=ii,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>Hn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof p_){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof d_&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?Hn(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?Hn(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let f=a;f>0;f--){let h=this.children[f-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){i=Hn(h.dom)+1;break}e-=h.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let f=this.children[u];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(-1)){s=Hn(f.dom);break}n+=f.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let d=0,p=0;d<this.children.length;d++){let g=this.children[d],b=p+g.size;if(s>p&&o<b)return g.setSelection(e-p-g.border,n-p-g.border,r,i);p=b}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),f=!1;if((Ei||pr)&&e==n){let{node:d,offset:p}=a;if(d.nodeType==3){if(f=!!(p&&d.nodeValue[p-1]==`
`),f&&p==d.nodeValue.length)for(let g=d,b;g;g=g.parentNode){if(b=g.nextSibling){b.nodeName=="BR"&&(a=l={node:b.parentNode,offset:Hn(b)+1});break}let w=g.pmViewDesc;if(w&&w.node&&w.node.isBlock)break}}else{let g=d.childNodes[p-1];f=g&&(g.nodeName=="BR"||g.contentEditable=="false")}}if(Ei&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let d=u.focusNode.childNodes[u.focusOffset];d&&d.contentEditable=="false"&&(i=!0)}if(!(i||f&&pr)&&Ba(a.node,a.offset,u.anchorNode,u.anchorOffset)&&Ba(l.node,l.offset,u.focusNode,u.focusOffset))return;let h=!1;if((c.extend||e==n)&&!f){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let p=a;a=l,l=p}let d=document.createRange();d.setEnd(l.node,l.offset),d.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(d)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?ma:oE,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=Xi:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?ma:Xi}r=o}this.dirty=ma}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?ma:oE;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class d_ extends Hu{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==ii&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class xH extends Hu{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Ha extends Hu{constructor(e,n,r,i,s){super(e,[],r,i),this.mark=n,this.spec=s}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=Za.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new Ha(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&Xi||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Xi&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=ii){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=ii}}slice(e,n,r){let i=Ha.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=z0(s,n,o,r)),e>0&&(s=z0(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Do extends Hu{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,f=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:f}=Za.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!f&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let h=u;return u=y_(u,r,n),c?l=new SH(e,n,r,i,u,f||null,h,c,s,o+1):n.isText?new sp(e,n,r,i,u,h,s):new Do(e,n,r,i,u,f||null,h,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Ee.empty)}return e}matchesNode(e,n,r){return this.dirty==ii&&e.eq(this.node)&&Sh(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new kH(this,o&&o.node,e);TH(this.node,this.innerDeco,(c,u,f)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!f&&l.syncToMarks(u==this.node.childCount?Nt.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,i)},(c,u,f,h)=>{l.syncToMarks(c.marks,r,e);let d;l.findNodeMatch(c,u,f,h)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(d=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,f,d,e)||l.updateNextNode(c,u,f,e,h,i)||l.addNode(c,u,f,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==ma)&&(o&&this.protectLocalComposition(e,o),g_(this.contentDOM,this.children,e),Fl&&IH(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof nt)||r<n||i>n+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=OH(this.node.content,o,r-n,i-n);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new xH(this,s,n,i);e.input.compositionNodes.push(o),this.children=z0(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==Xi||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=ii}updateOuterDeco(e){if(Sh(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=m_(this.dom,this.nodeDOM,U0(this.outerDeco,this.node,n),U0(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function aE(t,e,n,r,i){y_(r,e,t);let s=new Do(void 0,t,e,n,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class sp extends Do{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==Xi||this.dirty!=ii&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=ii||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=ii,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new sp(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=Xi)}get domAtom(){return!1}isText(e){return this.node.text==e}}class p_ extends Hu{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==ii&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class SH extends Do{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==Xi)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function g_(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=lE(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof Ha){let l=r?r.previousSibling:t.lastChild;g_(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=lE(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const Uc=function(t){t&&(this.nodeName=t)};Uc.prototype=Object.create(null);const ya=[new Uc];function U0(t,e,n){if(t.length==0)return ya;let r=n?ya[0]:new Uc,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new Uc(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new Uc(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function m_(t,e,n,r){if(n==ya&&r==ya)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=ya[0]),i=l}AH(i,a||ya[0],o)}return i}function AH(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function y_(t,e,n){return m_(t,t,ya,U0(e,n,t.nodeType!=1))}function Sh(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function lE(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class kH{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=_H(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let i=0,s=this.stack.length>>1,o=Math.min(s,e.length);for(;i<o&&(i==s-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<s;)this.destroyRest(),this.top.dirty=ii,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;for(;s<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[s])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Ha.create(this.top,e[s],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,s++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==Xi&&o.dom==o.contentDOM&&(o.dirty=ma),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Do){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,f,h=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Xi&&Sh(n,l.outerDeco));if(!h&&l.update(e,n,r,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(f=this.recreateWrapper(l,e,n,r,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=f,f.contentDOM&&(f.dirty=ma,f.updateChildren(i,o+1),f.dirty=ii),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,i,s,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Sh(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=Do.create(this.top,n,r,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,i,s){let o=Do.create(this.top,e,n,r,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new d_(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Ha;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof sp)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((pr||sr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new p_(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function _H(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof Ha)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function CH(t,e){return t.type.side-e.type.side}function TH(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,f;for(;o<i.length&&i[o].to==s;){let b=i[o++];b.widget&&(u?(f||(f=[u])).push(b):u=b)}if(u)if(f){f.sort(CH);for(let b=0;b<f.length;b++)n(f[b],c,!!l)}else n(u,c,!!l);let h,d;if(l)d=-1,h=l,l=null;else if(c<t.childCount)d=c,h=t.child(c++);else break;for(let b=0;b<a.length;b++)a[b].to<=s&&a.splice(b--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+h.nodeSize;if(h.isText){let b=p;o<i.length&&i[o].from<b&&(b=i[o].from);for(let w=0;w<a.length;w++)a[w].to<b&&(b=a[w].to);b<p&&(l=h.cut(b-s),h=h.cut(0,b-s),p=b,d=-1)}else for(;o<i.length&&i[o].to<p;)o++;let g=h.isInline&&!h.isLeaf?a.filter(b=>!b.inline):a.slice();r(h,g,e.forChild(s,h),d),s=p}}function IH(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function OH(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function z0(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function jb(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(ip(n)){for(l=o;i&&!i.node;)i=i.parent;let f=i.node;if(i&&f.isAtom&&Ge.isSelectable(f)&&i.parent&&!(f.isInline&&nH(n.focusNode,n.focusOffset,i.dom))){let h=i.posBefore;c=new Ge(o==h?a:r.resolve(h))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let f=o,h=o;for(let d=0;d<n.rangeCount;d++){let p=n.getRangeAt(d);f=Math.min(f,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(f<0)return null;[l,o]=h==t.state.selection.anchor?[h,f]:[f,h],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let f=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=qb(t,u,a,f)}return c}function b_(t){return t.editable?t.hasFocus():v_(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Ms(t,e=!1){let n=t.state.selection;if(w_(t,n),!!b_(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&sr){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&Ba(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)MH(t);else{let{anchor:r,head:i}=n,s,o;cE&&!(n instanceof nt)&&(n.$from.parent.inlineContent||(s=uE(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=uE(t,n.to))),t.docView.setSelection(r,i,t,e),cE&&(s&&fE(s),o&&fE(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&$H(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const cE=pr||sr&&o_<63;function uE(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(pr&&i&&i.contentEditable=="false")return lm(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return lm(i);if(s)return lm(s)}}function lm(t){return t.contentEditable="true",pr&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function fE(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function $H(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!b_(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function MH(t){let e=t.domSelection(),n=document.createRange();if(!e)return;let r=t.cursorWrapper.dom,i=r.nodeName=="IMG";i?n.setStart(r.parentNode,Hn(r)+1):n.setStart(r,0),n.collapse(!0),e.removeAllRanges(),e.addRange(n),!i&&!t.state.selection.visible&&Or&&Po<=11&&(r.disabled=!0,r.disabled=!1)}function w_(t,e){if(e instanceof Ge){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(hE(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else hE(t)}function hE(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function qb(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||nt.between(e,n,r)}function dE(t){return t.editable&&!t.hasFocus()?!1:v_(t)}function v_(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function NH(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return Ba(e.node,e.offset,n.anchorNode,n.anchorOffset)}function F0(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&lt.findFrom(s,e)}function yo(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function pE(t,e,n){let r=t.state.selection;if(r instanceof nt)if(n.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return yo(t,new nt(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=F0(t.state,e);return i&&i instanceof Ge?yo(t,i):!1}else if(!(ei&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?Ge.isSelectable(s)?yo(t,new Ge(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):Bu?yo(t,new nt(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof Ge&&r.node.isInline)return yo(t,new nt(e>0?r.$to:r.$from));{let i=F0(t.state,e);return i?yo(t,i):!1}}}function Ah(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function zc(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function sl(t,e){return e<0?LH(t):RH(t)}function LH(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for(Ei&&n.nodeType==1&&r<Ah(n)&&zc(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(zc(a,-1))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(E_(n))break;{let a=n.previousSibling;for(;a&&zc(a,-1);)i=n.parentNode,s=Hn(a),a=a.previousSibling;if(a)n=a,r=Ah(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?j0(t,n,r):i&&j0(t,i,s)}function RH(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=Ah(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(zc(a,1))s=n,o=++r;else break}else{if(E_(n))break;{let a=n.nextSibling;for(;a&&zc(a,1);)s=a.parentNode,o=Hn(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=Ah(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&j0(t,s,o)}function E_(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function PH(t,e){for(;t&&e==t.childNodes.length&&!Du(t);)e=Hn(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function DH(t,e){for(;t&&!e&&!Du(t);)e=Hn(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function j0(t,e,n){if(e.nodeType!=3){let s,o;(o=PH(e,n))?(e=o,n=0):(s=DH(e,n))&&(e=s,n=s.nodeValue.length)}let r=t.domSelection();if(!r)return;if(ip(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&Ms(t)},50)}function gE(t,e){let n=t.state.doc.resolve(e);if(!(sr||sH)&&n.parent.inlineContent){let i=t.coordsAtPos(e);if(e>n.start()){let s=t.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<n.end()){let s=t.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function mE(t,e,n){let r=t.state.selection;if(r instanceof nt&&!r.empty||n.indexOf("s")>-1||ei&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=F0(t.state,e);if(o&&o instanceof Ge)return yo(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof Ur?lt.near(o,e):lt.findFrom(o,e);return a?yo(t,a):!1}return!1}function yE(t,e){if(!(t.state.selection instanceof nt))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function bE(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function BH(t){if(!pr||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;bE(t,r,"true"),setTimeout(()=>bE(t,r,"false"),20)}return!1}function HH(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function UH(t,e){let n=e.keyCode,r=HH(e);if(n==8||ei&&n==72&&r=="c")return yE(t,-1)||sl(t,-1);if(n==46&&!e.shiftKey||ei&&n==68&&r=="c")return yE(t,1)||sl(t,1);if(n==13||n==27)return!0;if(n==37||ei&&n==66&&r=="c"){let i=n==37?gE(t,t.state.selection.from)=="ltr"?-1:1:-1;return pE(t,i,r)||sl(t,i)}else if(n==39||ei&&n==70&&r=="c"){let i=n==39?gE(t,t.state.selection.from)=="ltr"?1:-1:1;return pE(t,i,r)||sl(t,i)}else{if(n==38||ei&&n==80&&r=="c")return mE(t,-1,r)||sl(t,-1);if(n==40||ei&&n==78&&r=="c")return BH(t)||mE(t,1,r)||sl(t,1);if(r==(ei?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function Vb(t,e){t.someProp("transformCopied",d=>{e=d(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let d=r.firstChild;n.push(d.type.name,d.attrs!=d.type.defaultAttrs?d.attrs:null),r=d.content}let o=t.someProp("clipboardSerializer")||Za.fromSchema(t.state.schema),a=C_(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,f=0;for(;c&&c.nodeType==1&&(u=__[c.nodeName.toLowerCase()]);){for(let d=u.length-1;d>=0;d--){let p=a.createElement(u[d]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),f++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${f?` -${f}`:""} ${JSON.stringify(n)}`);let h=t.someProp("clipboardTextSerializer",d=>d(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function x_(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",h=>{e=h(e,s||r,t)}),s)return e?new De(Ee.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):De.empty;let f=t.someProp("clipboardTextParser",h=>h(e,i,r,t));if(f)a=f;else{let h=i.marks(),{schema:d}=t.state,p=Za.fromSchema(d);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(g=>{let b=o.appendChild(document.createElement("p"));g&&b.appendChild(p.serializeNode(d.text(g,h)))})}}else t.someProp("transformPastedHTML",f=>{n=f(n,t)}),o=qH(n),Bu&&VH(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let f=+u[3];f>0;f--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||Ro.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!zH.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=WH(wE(a,+u[1],+u[2]),u[4]);else if(a=De.maxOpen(FH(a.content,i),!0),a.openStart||a.openEnd){let f=0,h=0;for(let d=a.content.firstChild;f<a.openStart&&!d.type.spec.isolating;f++,d=d.firstChild);for(let d=a.content.lastChild;h<a.openEnd&&!d.type.spec.isolating;h++,d=d.lastChild);a=wE(a,f,h)}return t.someProp("transformPasted",f=>{a=f(a,t)}),a}const zH=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function FH(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&A_(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=k_(o[o.length-1],s.length));let u=S_(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return Ee.from(o)}return t}function S_(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Ee.from(t));return t}function A_(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=A_(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(Ee.from(S_(n,t,i+1))))}}function k_(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,k_(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Ee.empty,!0);return t.copy(n.append(r))}function q0(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),i<r-1&&(a=q0(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(Ee.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function wE(t,e,n){return e<t.openStart&&(t=new De(q0(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new De(q0(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const __={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let vE=null;function C_(){return vE||(vE=document.implementation.createHTMLDocument("title"))}let cm=null;function jH(t){let e=window.trustedTypes;return e?(cm||(cm=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),cm.createHTML(t)):t}function qH(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=C_().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&__[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=jH(t),i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function VH(t){let e=t.querySelectorAll(sr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function WH(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=Ee.from(l.create(r[a+1],i)),s++,o++}return new De(i,s,o)}const gr={},mr={},KH={touchstart:!0,touchmove:!0};class GH{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function ZH(t){for(let e in gr){let n=gr[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{JH(t,r)&&!Wb(t,r)&&(t.editable||!(r.type in mr))&&n(t,r)},KH[e]?{passive:!0}:void 0)}pr&&t.dom.addEventListener("input",()=>null),V0(t)}function Io(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function YH(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function V0(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>Wb(t,r))})}function Wb(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function JH(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function XH(t,e){!Wb(t,e)&&gr[e.type]&&(t.editable||!(e.type in mr))&&gr[e.type](t,e)}mr.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!I_(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(As&&sr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Fl&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,ha(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||UH(t,n)?n.preventDefault():Io(t,"key")};mr.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};mr.keypress=(t,e)=>{let n=e;if(I_(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||ei&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof nt)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode),s=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,i,s))&&t.dispatch(s()),n.preventDefault()}};function op(t){return{left:t.clientX,top:t.clientY}}function QH(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function Kb(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function Al(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function eU(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&Ge.isSelectable(r)?(Al(t,new Ge(n)),!0):!1}function tU(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof Ge&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(Ge.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(Al(t,Ge.create(t.state.doc,i)),!0):!1}function nU(t,e,n,r,i){return Kb(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?tU(t,n):eU(t,n))}function rU(t,e,n,r){return Kb(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function iU(t,e,n,r){return Kb(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||sU(t,n,r)}function sU(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(Al(t,nt.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)Al(t,nt.create(r,a+1,a+1+o.content.size));else if(Ge.isSelectable(o))Al(t,Ge.create(r,a));else continue;return!0}}function Gb(t){return kh(t)}const T_=ei?"metaKey":"ctrlKey";gr.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=Gb(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&QH(n,t.input.lastClick)&&!n[T_]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s,button:n.button};let o=t.posAtCoords(op(n));o&&(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new oU(t,o,n,!!r)):(s=="doubleClick"?rU:iU)(t,o.pos,o.inside,n)?n.preventDefault():Io(t,"pointer"))};class oU{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[T_],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.dom.nodeType==1?l.dom:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof Ge&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Ei&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Io(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Ms(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(op(e))),this.updateAllowDefault(e),this.allowDefault||!n?Io(this.view,"pointer"):nU(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||pr&&this.mightDrag&&!this.mightDrag.node.isAtom||sr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Al(this.view,lt.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Io(this.view,"pointer")}move(e){this.updateAllowDefault(e),Io(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}gr.touchstart=t=>{t.input.lastTouch=Date.now(),Gb(t),Io(t,"pointer")};gr.touchmove=t=>{t.input.lastTouch=Date.now(),Io(t,"pointer")};gr.contextmenu=t=>Gb(t);function I_(t,e){return t.composing?!0:pr&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const aU=As?5e3:-1;mr.compositionstart=mr.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof nt&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),kh(t,!0),t.markCursor=null;else if(kh(t,!e.selection.empty),Ei&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}O_(t,aU)};mr.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,O_(t,20))};function O_(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>kh(t),e))}function $_(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=cU());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function lU(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=eH(e.focusNode,e.focusOffset),r=tH(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let i=r.pmViewDesc,s=t.domObserver.lastChangedTextNode;if(n==s||r==s)return s;if(!i||!i.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function cU(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function kh(t,e=!1){if(!(As&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),$_(t),e||t.docView&&t.docView.dirty){let n=jb(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function uU(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const hu=Or&&Po<15||Fl&&oH<604;gr.copy=mr.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=hu?null:n.clipboardData,o=r.content(),{dom:a,text:l}=Vb(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):uU(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function fU(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function hU(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?du(t,r.value,null,i,e):du(t,r.textContent,r.innerHTML,i,e)},50)}function du(t,e,n,r,i){let s=x_(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,s||De.empty)))return!0;if(!s)return!1;let o=fU(s),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function M_(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}mr.paste=(t,e)=>{let n=e;if(t.composing&&!As)return;let r=hu?null:n.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&du(t,M_(r),r.getData("text/html"),i,n)?n.preventDefault():hU(t,n)};class N_{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const dU=ei?"altKey":"ctrlKey";function L_(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[dU]}gr.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(op(n)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof Ge?i.to-1:i.to))){if(r&&r.mightDrag)o=Ge.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let f=t.docView.nearestDesc(n.target,!0);f&&f.node.type.spec.draggable&&f!=t.docView&&(o=Ge.create(t.state.doc,f.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=Vb(t,a);(!n.dataTransfer.files.length||!sr||o_>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(hu?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",hu||n.dataTransfer.setData("text/plain",c),t.dragging=new N_(u,L_(t,n),o)};gr.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};mr.dragover=mr.dragenter=(t,e)=>e.preventDefault();mr.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(op(n));if(!i)return;let s=t.state.doc.resolve(i.pos),o=r&&r.slice;o?t.someProp("transformPasted",p=>{o=p(o,t)}):o=x_(t,M_(n.dataTransfer),hu?null:n.dataTransfer.getData("text/html"),!1,s);let a=!!(r&&L_(t,n));if(t.someProp("handleDrop",p=>p(t,n,o||De.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?Jk(t.state.doc,s.pos,o):s.pos;l==null&&(l=s.pos);let c=t.state.tr;if(a){let{node:p}=r;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),f=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,h=c.doc;if(f?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(h))return;let d=c.doc.resolve(u);if(f&&Ge.isSelectable(o.content.firstChild)&&d.nodeAfter&&d.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new Ge(d));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((g,b,w,x)=>p=x),c.setSelection(qb(t,d,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};gr.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Ms(t)},20))};gr.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};gr.beforeinput=(t,e)=>{if(sr&&As&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,ha(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in mr)gr[t]=mr[t];function pu(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class _h{constructor(e,n){this.toDOM=e,this.spec=n||Ca,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new or(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof _h&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&pu(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Bo{constructor(e,n){this.attrs=e,this.spec=n||Ca}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new or(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Bo&&pu(this.attrs,e.attrs)&&pu(this.spec,e.spec)}static is(e){return e.type instanceof Bo}destroy(){}}class Zb{constructor(e,n){this.attrs=e,this.spec=n||Ca}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new or(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof Zb&&pu(this.attrs,e.attrs)&&pu(this.spec,e.spec)}destroy(){}}class or{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new or(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new or(e,e,new _h(n,r))}static inline(e,n,r,i){return new or(e,n,new Bo(r,i))}static node(e,n,r,i){return new or(e,n,new Zb(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Bo}get widget(){return this.type instanceof _h}}const cl=[],Ca={};class zt{constructor(e,n){this.local=e.length?e:cl,this.children=n.length?n:cl}static create(e,n){return n.length?Ch(n,e,0,Ca):Xn}find(e,n,r){let i=[];return this.findInner(e??0,n??1e9,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==Xn||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Ca)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?pU(this.children,o||[],e,n,r,i,s):o?new zt(o.sort(Ta),cl):Xn}add(e,n){return n.length?this==Xn?zt.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(u=P_(n,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,Ch(u,a,c+1,Ca)),s+=3}});let o=R_(s?D_(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new zt(o.length?this.local.concat(o).sort(Ta):this.local,i||this.children)}remove(e){return e.length==0||this==Xn?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,f;u<e.length;u++)(f=e[u])&&f.from>a&&f.to<l&&(e[u]=null,(o||(o=[])).push(f));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=Xn?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new zt(i,r):Xn}forChild(e,n){if(this==Xn)return this;if(n.isLeaf)return zt.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof Bo){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new zt(i.sort(Ta),cl);return r?new xo([a,r]):a}return r||Xn}eq(e){if(this==e)return!0;if(!(e instanceof zt)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Yb(this.localsInner(e))}localsInner(e){if(this==Xn)return cl;if(e.inlineContent||!this.local.some(Bo.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Bo||n.push(this.local[r]);return n}forEachSet(e){e(this)}}zt.empty=new zt([],[]);zt.removeOverlap=Yb;const Xn=zt.empty;class xo{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,Ca));return xo.from(r)}forChild(e,n){if(n.isLeaf)return zt.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=Xn&&(s instanceof xo?r=r.concat(s.members):r.push(s))}return xo.from(r)}eq(e){if(!(e instanceof xo)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?Yb(r?n:n.sort(Ta)):cl}static from(e){switch(e.length){case 0:return Xn;case 1:return e[0];default:return new xo(e.every(n=>n instanceof zt)?e:e.reduce((n,r)=>n.concat(r instanceof zt?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function pU(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let f=0;n.maps[c].forEach((h,d,p,g)=>{let b=g-p-(d-h);for(let w=0;w<a.length;w+=3){let x=a[w+1];if(x<0||h>x+u-f)continue;let T=a[w]+u-f;d>=T?a[w+1]=h<=T?-2:-1:h>=u&&b&&(a[w]+=b,a[w+1]+=b)}f+=b}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),f=u-i;if(f<0||f>=r.content.size){l=!0;continue}let h=n.map(t[c+1]+s,-1),d=h-i,{index:p,offset:g}=r.content.findIndex(f),b=r.maybeChild(p);if(b&&g==f&&g+b.nodeSize==d){let w=a[c+2].mapInner(n,b,u+1,t[c]+s+1,o);w!=Xn?(a[c]=f,a[c+1]=d,a[c+2]=w):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=gU(a,t,e,n,i,s,o),u=Ch(c,r,0,o);e=u.local;for(let f=0;f<a.length;f+=3)a[f+1]<0&&(a.splice(f,3),f-=3);for(let f=0,h=0;f<u.children.length;f+=3){let d=u.children[f];for(;h<a.length&&a[h]<d;)h+=3;a.splice(h,0,u.children[f],u.children[f+1],u.children[f+2])}}return new zt(e.sort(Ta),a)}function R_(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new or(i.from+e,i.to+e,i.type))}return n}function gU(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let f=l.local[u].map(r,i,c);f?n.push(f):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function P_(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function D_(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Ch(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=P_(t,a,l+n);if(c){s=!0;let u=Ch(c,a,n+l+1,r);u!=Xn&&i.push(l,l+a.nodeSize,u)}});let o=R_(s?D_(t):t,-n).sort(Ta);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new zt(o,i):Xn}function Ta(t,e){return t.from-e.from||t.to-e.to}function Yb(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),EE(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),EE(e,i,r.copy(s.from,r.to)));break}}}return e}function EE(t,e,n){for(;e<t.length&&Ta(n,t[e])>0;)e++;t.splice(e,0,n)}function um(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=Xn&&e.push(r)}),t.cursorWrapper&&e.push(zt.create(t.state.doc,[t.cursorWrapper.deco])),xo.from(e)}const mU={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},yU=Or&&Po<=11;class bU{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class wU{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new bU,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);Or&&Po<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),yU&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,mU)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(dE(this.view)){if(this.suppressingSelectionUpdates)return Ms(this.view);if(Or&&Po<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Ba(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=zl(s))n.add(s);for(let s=e.anchorNode;s;s=zl(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&dE(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let f=this.registerMutation(n[u],l);f&&(s=s<0?f.from:Math.min(f.from,s),o=o<0?f.to:Math.max(f.to,o),f.typeOver&&(a=!0))}if(Ei&&l.length){let u=l.filter(f=>f.nodeName=="BR");if(u.length==2){let[f,h]=u;f.parentNode&&f.parentNode.parentNode==h.parentNode?h.remove():f.remove()}else{let{focusNode:f}=this.currentSelection;for(let h of u){let d=h.parentNode;d&&d.nodeName=="LI"&&(!f||xU(e,f)!=d)&&h.remove()}}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&ip(r)&&(c=jb(e))&&c.eq(lt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Ms(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),vU(e)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||Ms(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let f=e.addedNodes[u];n.push(f),f.nodeType==3&&(this.lastChangedTextNode=f)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(Or&&Po<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:f,nextSibling:h}=e.addedNodes[u];(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h)}let o=i&&i.parentNode==e.target?Hn(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?Hn(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let xE=new WeakMap,SE=!1;function vU(t){if(!xE.has(t)&&(xE.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Ei,SE)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),SE=!0}}function AE(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return Ba(o.node,o.offset,i,s)&&([n,r,i,s]=[i,s,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}}function EU(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return AE(t,i)}let n;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?AE(t,n):null}function xU(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function SU(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],ip(l)||c.push({node:l.focusNode,offset:l.focusOffset})),sr&&t.input.lastKeyCode===8)for(let b=s;b>i;b--){let w=r.childNodes[b-1],x=w.pmViewDesc;if(w.nodeName=="BR"&&!x){s=b;break}if(!x||x.size)break}let f=t.state.doc,h=t.someProp("domParser")||Ro.fromSchema(t.state.schema),d=f.resolve(o),p=null,g=h.parse(r,{topNode:d.parent,topMatch:d.parent.contentMatchAt(d.index()),topOpen:!0,from:i,to:s,preserveWhitespace:d.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:AU,context:d});if(c&&c[0].pos!=null){let b=c[0].pos,w=c[1]&&c[1].pos;w==null&&(w=b),p={anchor:b+o,head:w+o}}return{doc:g,sel:p,from:o,to:a}}function AU(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(pr&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||pr&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const kU=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function _U(t,e,n,r,i){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let A=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,E=jb(t,A);if(E&&!t.state.selection.eq(E)){if(sr&&As&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",k=>k(t,ha(13,"Enter"))))return;let S=t.state.tr.setSelection(E);A=="pointer"?S.setMeta("pointer",!0):A=="key"&&S.scrollIntoView(),s&&S.setMeta("composition",s),t.dispatch(S)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=SU(t,e,n),u=t.state.doc,f=u.slice(c.from,c.to),h,d;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,d="end"):(h=t.state.selection.from,d="start"),t.input.lastKeyCode=null;let p=IU(f.content,c.doc.content,c.from,h,d);if(p&&t.input.domChangeCount++,(Fl&&t.input.lastIOSEnter>Date.now()-225||As)&&i.some(A=>A.nodeType==1&&!kU.test(A.nodeName))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",A=>A(t,ha(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!p)if(r&&l instanceof nt&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let A=kE(t,t.state.doc,c.sel);if(A&&!A.eq(t.state.selection)){let E=t.state.tr.setSelection(A);s&&E.setMeta("composition",s),t.dispatch(E)}}return}t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof nt&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),Or&&Po<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)=="  "&&(p.start--,p.endA--,p.endB--);let g=c.doc.resolveNoCache(p.start-c.from),b=c.doc.resolveNoCache(p.endB-c.from),w=u.resolve(p.start),x=g.sameParent(b)&&g.parent.inlineContent&&w.end()>=p.endA,T;if((Fl&&t.input.lastIOSEnter>Date.now()-225&&(!x||i.some(A=>A.nodeName=="DIV"||A.nodeName=="P"))||!x&&g.pos<c.doc.content.size&&(!g.sameParent(b)||!g.parent.inlineContent)&&!/\S/.test(c.doc.textBetween(g.pos,b.pos,"",""))&&(T=lt.findFrom(c.doc.resolve(g.pos+1),1,!0))&&T.head>g.pos)&&t.someProp("handleKeyDown",A=>A(t,ha(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>p.start&&TU(u,p.start,p.endA,g,b)&&t.someProp("handleKeyDown",A=>A(t,ha(8,"Backspace")))){As&&sr&&t.domObserver.suppressSelectionUpdates();return}sr&&p.endB==p.start&&(t.input.lastChromeDelete=Date.now()),As&&!x&&g.start()!=b.start()&&b.parentOffset==0&&g.depth==b.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,b=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(A){return A(t,ha(13,"Enter"))})},20));let M=p.start,O=p.endA,_=A=>{let E=A||t.state.tr.replace(M,O,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let S=kE(t,E.doc,c.sel);S&&!(sr&&t.composing&&S.empty&&(p.start!=p.endB||t.input.lastChromeDelete<Date.now()-100)&&(S.head==M||S.head==E.mapping.map(O)-1)||Or&&S.empty&&S.head==M)&&E.setSelection(S)}return s&&E.setMeta("composition",s),E.scrollIntoView()},L;if(x){if(g.pos==b.pos){Or&&Po<=11&&g.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Ms(t),20));let A=_(t.state.tr.delete(M,O)),E=u.resolve(p.start).marksAcross(u.resolve(p.endA));E&&A.ensureMarks(E),t.dispatch(A)}else if(p.endA==p.endB&&(L=CU(g.parent.content.cut(g.parentOffset,b.parentOffset),w.parent.content.cut(w.parentOffset,p.endA-w.start())))){let A=_(t.state.tr);L.type=="add"?A.addMark(M,O,L.mark):A.removeMark(M,O,L.mark),t.dispatch(A)}else if(g.parent.child(g.index()).isText&&g.index()==b.index()-(b.textOffset?0:1)){let A=g.parent.textBetween(g.parentOffset,b.parentOffset),E=()=>_(t.state.tr.insertText(A,M,O));t.someProp("handleTextInput",S=>S(t,M,O,A,E))||t.dispatch(E())}}else t.dispatch(_())}function kE(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:qb(t,e.resolve(n.anchor),e.resolve(n.head))}function CU(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(Ee.from(c).eq(t))return{mark:a,type:o}}function TU(t,e,n,r,i){if(n-e<=i.pos-r.pos||fm(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(!r.parent.isTextblock){let a=s.nodeAfter;return a!=null&&n==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(fm(s,!0,!0));return!o.parent.isTextblock||o.pos>n||fm(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function fm(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function IU(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}if(o<s&&t.size<e.size){let l=r<=s&&r>=o?s-r:0;s-=l,s&&s<e.size&&_E(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=r<=s&&r>=a?s-r:0;s-=l,s&&s<t.size&&_E(t.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function _E(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class B_{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new GH,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach($E),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=IE(this),TE(this),this.nodeViews=OE(this),this.docView=aE(this.state.doc,CE(this),um(this),this.dom,this),this.domObserver=new wU(this,(r,i,s,o)=>_U(this,r,i,s,o)),this.domObserver.start(),ZH(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&V0(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach($E),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&($_(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let d=OE(this);$U(d,this.nodeViews)&&(this.nodeViews=d,s=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&V0(this),this.editable=IE(this),TE(this);let l=um(this),c=CE(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",f=s||!this.docView.matchesNode(e.doc,c,l);(f||!e.selection.eq(i.selection))&&(o=!0);let h=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&cH(this);if(o){this.domObserver.stop();let d=f&&(Or||sr)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&OU(i.selection,e.selection);if(f){let p=sr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=lU(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=aE(e.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(d=!0)}d||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&NH(this))?Ms(this,d):(w_(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&uH(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof Ge){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&tE(this,n.getBoundingClientRect(),e)}else tE(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let s=r.from+(this.state.doc.content.size-n.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==r.node&&(i=s)}this.dragging=new N_(e.slice,e.move,i<0?void 0:Ge.create(this.state.doc,i))}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(Or){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&fH(this.dom),Ms(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return mH(this,e)}coordsAtPos(e,n=1){return f_(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return EH(this,n||this.state,e)}pasteHTML(e,n){return du(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return du(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return Vb(this,e)}destroy(){this.docView&&(YH(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],um(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,X9())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return XH(this,e)}domSelectionRange(){let e=this.domSelection();return e?pr&&this.root.nodeType===11&&rH(this.dom.ownerDocument)==this.dom&&EU(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}B_.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function CE(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[or.node(0,t.state.doc.content.size,e)]}function TE(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:or.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function IE(t){return!t.someProp("editable",e=>e(t.state)===!1)}function OU(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function OE(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function $U(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function $E(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var qo={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Th={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},MU=typeof navigator<"u"&&/Mac/.test(navigator.platform),NU=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Un=0;Un<10;Un++)qo[48+Un]=qo[96+Un]=String(Un);for(var Un=1;Un<=24;Un++)qo[Un+111]="F"+Un;for(var Un=65;Un<=90;Un++)qo[Un]=String.fromCharCode(Un+32),Th[Un]=String.fromCharCode(Un);for(var hm in qo)Th.hasOwnProperty(hm)||(Th[hm]=qo[hm]);function LU(t){var e=MU&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||NU&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Th:qo)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const RU=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),PU=typeof navigator<"u"&&/Win/.test(navigator.platform);function DU(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))RU?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function BU(t){let e=Object.create(null);for(let n in t)e[DU(n)]=t[n];return e}function dm(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function HU(t){return new Dt({props:{handleKeyDown:H_(t)}})}function H_(t){let e=BU(t);return function(n,r){let i=LU(r),s,o=e[dm(i,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[dm(i,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(PU&&r.ctrlKey&&r.altKey)&&(s=qo[r.keyCode])&&s!=i){let a=e[dm(s,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const Jb=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function U_(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const z_=(t,e,n)=>{let r=U_(t,n);if(!r)return!1;let i=Xb(r);if(!i){let o=r.blockRange(),a=o&&nc(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(Y_(t,i,e,-1))return!0;if(r.parent.content.size==0&&(jl(s,"end")||Ge.isSelectable(s)))for(let o=r.depth;;o--){let a=np(t.doc,r.before(o),r.after(o),De.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(jl(s,"end")?lt.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):Ge.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1},UU=(t,e,n)=>{let r=U_(t,n);if(!r)return!1;let i=Xb(r);return i?F_(t,i,e):!1},zU=(t,e,n)=>{let r=q_(t,n);if(!r)return!1;let i=Qb(r);return i?F_(t,i,e):!1};function F_(t,e,n){let r=e.nodeBefore,i=r,s=e.pos-1;for(;!i.isTextblock;s--){if(i.type.spec.isolating)return!1;let u=i.lastChild;if(!u)return!1;i=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=np(t.doc,s,l,De.empty);if(!c||c.from!=s||c instanceof vn&&c.slice.size>=l-s)return!1;if(n){let u=t.tr.step(c);u.setSelection(nt.create(u.doc,s)),n(u.scrollIntoView())}return!0}function jl(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const j_=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=Xb(r)}let o=s&&s.nodeBefore;return!o||!Ge.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Ge.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function Xb(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function q_(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const V_=(t,e,n)=>{let r=q_(t,n);if(!r)return!1;let i=Qb(r);if(!i)return!1;let s=i.nodeAfter;if(Y_(t,i,e,1))return!0;if(r.parent.content.size==0&&(jl(s,"start")||Ge.isSelectable(s))){let o=np(t.doc,r.before(),r.after(),De.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(jl(s,"start")?lt.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):Ge.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},W_=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=Qb(r)}let o=s&&s.nodeAfter;return!o||!Ge.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Ge.create(t.doc,s.pos)).scrollIntoView()),!0)};function Qb(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const FU=(t,e)=>{let n=t.selection,r=n instanceof Ge,i;if(r){if(n.node.isTextblock||!Jo(t.doc,n.from))return!1;i=n.from}else if(i=tp(t.doc,n.from,-1),i==null)return!1;if(e){let s=t.tr.join(i);r&&s.setSelection(Ge.create(s.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},jU=(t,e)=>{let n=t.selection,r;if(n instanceof Ge){if(n.node.isTextblock||!Jo(t.doc,n.to))return!1;r=n.to}else if(r=tp(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},qU=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&nc(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},K_=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function e1(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const VU=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=e1(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(lt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},G_=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof Ur||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=e1(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(nt.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},Z_=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if($s(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&nc(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function WU(t){return(e,n)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof Ge&&e.selection.node.isBlock)return!r.parentOffset||!$s(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let s=[],o,a,l=!1,c=!1;for(let d=r.depth;;d--)if(r.node(d).isBlock){l=r.end(d)==r.pos+(r.depth-d),c=r.start(d)==r.pos-(r.depth-d),a=e1(r.node(d-1).contentMatchAt(r.indexAfter(d-1))),s.unshift(l&&a?{type:a}:null),o=d;break}else{if(d==1)return!1;s.unshift(null)}let u=e.tr;(e.selection instanceof nt||e.selection instanceof Ur)&&u.deleteSelection();let f=u.mapping.map(r.pos),h=$s(u.doc,f,s.length,s);if(h||(s[0]=a?{type:a}:null,h=$s(u.doc,f,s.length,s)),!h)return!1;if(u.split(f,s.length,s),!l&&c&&r.node(o).type!=a){let d=u.mapping.map(r.before(o)),p=u.doc.resolve(d);a&&r.node(o-1).canReplaceWith(p.index(),p.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const KU=WU(),GU=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(Ge.create(t.doc,i))),!0)};function ZU(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||Jo(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function Y_(t,e,n,r){let i=e.nodeBefore,s=e.nodeAfter,o,a,l=i.type.spec.isolating||s.type.spec.isolating;if(!l&&ZU(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(n){let d=e.pos+s.nodeSize,p=Ee.empty;for(let w=o.length-1;w>=0;w--)p=Ee.from(o[w].create(null,p));p=Ee.from(i.copy(p));let g=t.tr.step(new Sn(e.pos-1,d,e.pos,d,new De(p,1,0),o.length,!0)),b=g.doc.resolve(d+2*o.length);b.nodeAfter&&b.nodeAfter.type==i.type&&Jo(g.doc,b.pos)&&g.join(b.pos),n(g.scrollIntoView())}return!0}let u=s.type.spec.isolating||r>0&&l?null:lt.findFrom(e,1),f=u&&u.$from.blockRange(u.$to),h=f&&nc(f);if(h!=null&&h>=e.depth)return n&&n(t.tr.lift(f,h).scrollIntoView()),!0;if(c&&jl(s,"start",!0)&&jl(i,"end")){let d=i,p=[];for(;p.push(d),!d.isTextblock;)d=d.lastChild;let g=s,b=1;for(;!g.isTextblock;g=g.firstChild)b++;if(d.canReplace(d.childCount,d.childCount,g.content)){if(n){let w=Ee.empty;for(let T=p.length-1;T>=0;T--)w=Ee.from(p[T].copy(w));let x=t.tr.step(new Sn(e.pos-p.length,e.pos+s.nodeSize,e.pos+b,e.pos+s.nodeSize-b,new De(w,p.length,0),0,!0));n(x.scrollIntoView())}return!0}}return!1}function J_(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(nt.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const YU=J_(-1),JU=J_(1);function XU(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&Ub(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function ME(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[s];n.doc.nodesBetween(o,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let u=n.doc.resolve(c),f=u.index();i=u.parent.canReplaceWith(f,f+1,t)}})}if(!i)return!1;if(r){let s=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];s.setBlockType(a,l,t,e)}r(s.scrollIntoView())}return!0}}function t1(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}t1(Jb,z_,j_);t1(Jb,V_,W_);t1(K_,G_,Z_,KU);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function QU(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s);if(!o)return!1;let a=r?n.tr:null;return ez(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function ez(t,e,n,r=null){let i=!1,s=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);s=new Eh(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Eh(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=Ub(s,n,r,e);return a?(t&&tz(t,e,a,i,n),!0):!1}function tz(t,e,n,r,i){let s=Ee.empty;for(let u=n.length-1;u>=0;u--)s=Ee.from(n[u].type.create(n[u].attrs,s));t.step(new Sn(e.start-(r?2:0),e.end,e.start,e.end,new De(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,f=e.endIndex,h=!0;u<f;u++,h=!1)!h&&$s(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function nz(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?rz(e,n,t,s):iz(e,n,s):!0:!1}}function rz(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new Sn(s-1,o,s,o,new De(Ee.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Eh(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=nc(r);if(a==null)return!1;i.lift(r,a);let l=i.doc.resolve(i.mapping.map(s,-1)-1);return Jo(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function iz(t,e,n){let r=t.tr,i=n.parent;for(let d=n.end,p=n.endIndex-1,g=n.startIndex;p>g;p--)d-=i.child(p).nodeSize,r.delete(d-1,d+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?Ee.empty:Ee.from(i))))return!1;let f=s.pos,h=f+o.nodeSize;return r.step(new Sn(f-(a?1:0),h+(l?1:0),f+1,h-1,new De((a?Ee.empty:Ee.from(i.copy(Ee.empty))).append(l?Ee.empty:Ee.from(i.copy(Ee.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function sz(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=Ee.from(c?t.create():null),f=new De(Ee.from(t.create(null,Ee.from(a.type.create(null,u)))),c?3:1,0),h=s.start,d=s.end;n(e.tr.step(new Sn(h-(c?3:1),d,h,d,f,1,!0)).scrollIntoView())}return!0}}function ap(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}class lp{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:i}=n,{tr:s}=r,o=this.buildProps(s);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...u)=>{const f=l(...u)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a=[],l=!!e,c=e||s.tr,u=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(c),a.every(h=>h===!0)),f={...Object.fromEntries(Object.entries(r).map(([h,d])=>[h,(...g)=>{const b=this.buildProps(c,n),w=d(...g)(b);return a.push(w),f}])),run:u};return f}createCan(e){const{rawCommands:n,state:r}=this,i=!1,s=e||r.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...u)=>c(...u)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(e,n=!0){const{rawCommands:r,editor:i,state:s}=this,{view:o}=i,a={tr:e,editor:i,view:o,state:ap({state:s,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...u)=>c(...u)(a)]))}};return a}}class oz{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(i=>i.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(i=>i!==n):delete this.callbacks[e]),this}once(e,n){const r=(...i)=>{this.off(e,r),n.apply(this,i)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function je(t,e,n){return t.config[e]===void 0&&t.parent?je(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?je(t.parent,e,n):null}):t.config[e]}function cp(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function X_(t){const e=[],{nodeExtensions:n,markExtensions:r}=cp(t),i=[...n,...r],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=je(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(f=>{Object.entries(u.attributes).forEach(([h,d])=>{e.push({type:f,name:h,attribute:{...s,...d}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=je(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,f])=>{const h={...s,...f};typeof h?.default=="function"&&(h.default=h.default()),h?.isRequired&&h?.default===void 0&&delete h.default,e.push({type:o.name,name:u,attribute:h})})}),e}function kn(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function _n(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(u=>!l.includes(u));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[f,h]=u.split(":").map(d=>d.trim());c.set(f,h)}),a.forEach(u=>{const[f,h]=u.split(":").map(d=>d.trim());c.set(f,h)}),r[i]=Array.from(c.entries()).map(([u,f])=>`${u}: ${f}`).join("; ")}else r[i]=s}),r},{})}function Ih(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>_n(n,r),{})}function Q_(t){return typeof t=="function"}function ht(t,e=void 0,...n){return Q_(t)?e?t.bind(e)(...n):t(...n):t}function az(t={}){return Object.keys(t).length===0&&t.constructor===Object}function lz(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function NE(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):lz(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function LE(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&az(n)?!1:n!=null))}function cz(t,e){var n;const r=X_(t),{nodeExtensions:i,markExtensions:s}=cp(t),o=(n=i.find(c=>je(c,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(i.map(c=>{const u=r.filter(w=>w.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:e},h=t.reduce((w,x)=>{const T=je(x,"extendNodeSchema",f);return{...w,...T?T(c):{}}},{}),d=LE({...h,content:ht(je(c,"content",f)),marks:ht(je(c,"marks",f)),group:ht(je(c,"group",f)),inline:ht(je(c,"inline",f)),atom:ht(je(c,"atom",f)),selectable:ht(je(c,"selectable",f)),draggable:ht(je(c,"draggable",f)),code:ht(je(c,"code",f)),whitespace:ht(je(c,"whitespace",f)),linebreakReplacement:ht(je(c,"linebreakReplacement",f)),defining:ht(je(c,"defining",f)),isolating:ht(je(c,"isolating",f)),attrs:Object.fromEntries(u.map(w=>{var x;return[w.name,{default:(x=w?.attribute)===null||x===void 0?void 0:x.default}]}))}),p=ht(je(c,"parseHTML",f));p&&(d.parseDOM=p.map(w=>NE(w,u)));const g=je(c,"renderHTML",f);g&&(d.toDOM=w=>g({node:w,HTMLAttributes:Ih(w,u)}));const b=je(c,"renderText",f);return b&&(d.toText=b),[c.name,d]})),l=Object.fromEntries(s.map(c=>{const u=r.filter(b=>b.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:e},h=t.reduce((b,w)=>{const x=je(w,"extendMarkSchema",f);return{...b,...x?x(c):{}}},{}),d=LE({...h,inclusive:ht(je(c,"inclusive",f)),excludes:ht(je(c,"excludes",f)),group:ht(je(c,"group",f)),spanning:ht(je(c,"spanning",f)),code:ht(je(c,"code",f)),attrs:Object.fromEntries(u.map(b=>{var w;return[b.name,{default:(w=b?.attribute)===null||w===void 0?void 0:w.default}]}))}),p=ht(je(c,"parseHTML",f));p&&(d.parseDOM=p.map(b=>NE(b,u)));const g=je(c,"renderHTML",f);return g&&(d.toDOM=b=>g({mark:b,HTMLAttributes:Ih(b,u)})),[c.name,d]}));return new Uk({topNode:o,nodes:a,marks:l})}function pm(t,e){return e.nodes[t]||e.marks[t]||null}function RE(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function n1(t,e){const n=Za.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}const uz=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";n+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,r-s))}),n};function r1(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class up{constructor(e){this.find=e.find,this.handler=e.handler}}const fz=(t,e)=>{if(r1(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function hf(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(h=>h.type.spec.code))return!1;let u=!1;const f=uz(c)+s;return o.forEach(h=>{if(u)return;const d=fz(f,h.find);if(!d)return;const p=l.state.tr,g=ap({state:l.state,transaction:p}),b={from:r-(d[0].length-s.length),to:i},{commands:w,chain:x,can:T}=new lp({editor:n,state:g});h.handler({state:g,range:b,match:d,commands:w,chain:x,can:T})===null||!p.steps.length||(p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function hz(t){const{editor:e,rules:n}=t,r=new Dt({state:{init(){return null},apply(i,s,o){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=n1(Ee.from(u),o.schema);const{from:f}=l,h=f+u.length;hf({editor:e,from:f,to:h,text:u,rules:n,plugin:r})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return hf({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&hf({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?hf({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function dz(t){return Object.prototype.toString.call(t).slice(8,-1)}function df(t){return dz(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function fp(t,e){const n={...t};return df(t)&&df(e)&&Object.keys(e).forEach(r=>{df(e[r])&&df(t[r])?n[r]=fp(t[r],e[r]):n[r]=e[r]}),n}class Ds{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ht(je(this,"addOptions",{name:this.name}))),this.storage=ht(je(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ds(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>fp(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Ds(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=ht(je(n,"addOptions",{name:n.name})),n.storage=ht(je(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===n.name))return!1;const l=o.find(c=>c?.type.name===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}}function pz(t){return typeof t=="number"}class gz{constructor(e){this.find=e.find,this.handler=e.handler}}const mz=(t,e,n)=>{if(r1(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(i=>{const s=[i.text];return s.index=i.index,s.input=t,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function yz(t){const{editor:e,state:n,from:r,to:i,rule:s,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new lp({editor:e,state:n}),f=[];return n.doc.nodesBetween(r,i,(d,p)=>{if(!d.isTextblock||d.type.spec.code)return;const g=Math.max(r,p),b=Math.min(i,p+d.content.size),w=d.textBetween(g-p,b-p,void 0,"￼");mz(w,s.find,o).forEach(T=>{if(T.index===void 0)return;const M=g+T.index+1,O=M+T[0].length,_={from:n.tr.mapping.map(M),to:n.tr.mapping.map(O)},L=s.handler({state:n,range:_,match:T,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});f.push(L)})}),f.every(d=>d!==null)}let pf=null;const bz=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function wz(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:f,to:h,rule:d,pasteEvt:p})=>{const g=u.tr,b=ap({state:u,transaction:g});if(!(!yz({editor:e,state:b,from:Math.max(f-1,0),to:h.b-1,rule:d,pasteEvent:p,dropEvent:a})||!g.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g}};return n.map(u=>new Dt({view(f){const h=p=>{var g;r=!((g=f.dom.parentElement)===null||g===void 0)&&g.contains(p.target)?f.dom.parentElement:null,r&&(pf=e)},d=()=>{pf&&(pf=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",d),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",d)}}},props:{handleDOMEvents:{drop:(f,h)=>{if(s=r===f.dom.parentElement,a=h,!s){const d=pf;d?.isEditable&&setTimeout(()=>{const p=d.state.selection;p&&d.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(f,h)=>{var d;const p=(d=h.clipboardData)===null||d===void 0?void 0:d.getData("text/html");return o=h,i=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(f,h,d)=>{const p=f[0],g=p.getMeta("uiEvent")==="paste"&&!i,b=p.getMeta("uiEvent")==="drop"&&!s,w=p.getMeta("applyPasteRules"),x=!!w;if(!g&&!b&&!x)return;if(x){let{text:O}=w;typeof O=="string"?O=O:O=n1(Ee.from(O),d.schema);const{from:_}=w,L=_+O.length,A=bz(O);return l({rule:u,state:d,from:_,to:{b:L},pasteEvt:A})}const T=h.doc.content.findDiffStart(d.doc.content),M=h.doc.content.findDiffEnd(d.doc.content);if(!(!pz(T)||!M||T===M.b))return l({rule:u,state:d,from:T,to:M,pasteEvt:o})}}))}function vz(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class pl{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=pl.resolve(e),this.schema=cz(this.extensions,n),this.setupExtensions()}static resolve(e){const n=pl.sort(pl.flatten(e)),r=vz(n.map(i=>i.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},i=je(n,"addExtensions",r);return i?[n,...this.flatten(i())]:n}).flat(10)}static sort(e){return e.sort((r,i)=>{const s=je(r,"priority")||100,o=je(i,"priority")||100;return s>o?-1:s<o?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:pm(n.name,this.schema)},i=je(n,"addCommands",r);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,n=pl.sort([...this.extensions].reverse()),r=[],i=[],s=n.map(o=>{const a={name:o.name,options:o.options,storage:o.storage,editor:e,type:pm(o.name,this.schema)},l=[],c=je(o,"addKeyboardShortcuts",a);let u={};if(o.type==="mark"&&je(o,"exitable",a)&&(u.ArrowRight=()=>Ds.handleExit({editor:e,mark:o})),c){const g=Object.fromEntries(Object.entries(c()).map(([b,w])=>[b,()=>w({editor:e})]));u={...u,...g}}const f=HU(u);l.push(f);const h=je(o,"addInputRules",a);RE(o,e.options.enableInputRules)&&h&&r.push(...h());const d=je(o,"addPasteRules",a);RE(o,e.options.enablePasteRules)&&d&&i.push(...d());const p=je(o,"addProseMirrorPlugins",a);if(p){const g=p();l.push(...g)}return l}).flat();return[hz({editor:e,rules:r}),...wz({editor:e,rules:i}),...s]}get attributes(){return X_(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=cp(this.extensions);return Object.fromEntries(n.filter(r=>!!je(r,"addNodeView")).map(r=>{const i=this.attributes.filter(l=>l.type===r.name),s={name:r.name,options:r.options,storage:r.storage,editor:e,type:kn(r.name,this.schema)},o=je(r,"addNodeView",s);if(!o)return[];const a=(l,c,u,f,h)=>{const d=Ih(l,i);return o()({node:l,view:c,getPos:u,decorations:f,innerDecorations:h,editor:e,extension:r,HTMLAttributes:d})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:pm(e.name,this.schema)};e.type==="mark"&&(!((n=ht(je(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const i=je(e,"onBeforeCreate",r),s=je(e,"onCreate",r),o=je(e,"onUpdate",r),a=je(e,"onSelectionUpdate",r),l=je(e,"onTransaction",r),c=je(e,"onFocus",r),u=je(e,"onBlur",r),f=je(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),f&&this.editor.on("destroy",f)})}}class an{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ht(je(this,"addOptions",{name:this.name}))),this.storage=ht(je(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new an(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>fp(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new an({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=ht(je(n,"addOptions",{name:n.name})),n.storage=ht(je(n,"addStorage",{name:n.name,options:n.options})),n}}function e4(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,i,(l,c,u,f)=>{var h;l.isBlock&&c>r&&(a+=s);const d=o?.[l.type.name];if(d)return u&&(a+=d({node:l,pos:c,parent:u,index:f,range:e})),!1;l.isText&&(a+=(h=l?.text)===null||h===void 0?void 0:h.slice(Math.max(r,c)-c,i-c))}),a}function t4(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const Ez=an.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Dt({key:new on("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=t4(n);return e4(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),xz=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),Sz=(t=!1)=>({commands:e})=>e.setContent("",t),Az=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,f=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),d=f.blockRange(h);if(!d)return;const p=nc(d);if(a.type.isTextblock){const{defaultType:g}=f.parent.contentMatchAt(f.index());e.setNodeMarkup(d.start,g)}(p||p===0)&&e.lift(d,p)})}),!0},kz=t=>e=>t(e),_z=()=>({state:t,dispatch:e})=>G_(t,e),Cz=(t,e)=>({editor:n,tr:r})=>{const{state:i}=n,s=i.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,s.content),r.setSelection(new nt(r.doc.resolve(Math.max(o-1,0)))),!0},Tz=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===r.type){if(e){const a=i.before(s),l=i.after(s);t.delete(a,l).scrollIntoView()}return!0}return!1},Iz=t=>({tr:e,state:n,dispatch:r})=>{const i=kn(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},Oz=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},$z=()=>({state:t,dispatch:e})=>Jb(t,e),Mz=()=>({commands:t})=>t.keyboardShortcut("Enter"),Nz=()=>({state:t,dispatch:e})=>VU(t,e);function Oh(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:r1(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function n4(t,e,n={}){return t.find(r=>r.type===e&&Oh(Object.fromEntries(Object.keys(n).map(i=>[i,r.attrs[i]])),n))}function PE(t,e,n={}){return!!n4(t,e,n)}function i1(t,e,n){var r;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(n=n||((r=i.node.marks[0])===null||r===void 0?void 0:r.attrs),!n4([...i.node.marks],e,n)))return;let o=i.index,a=t.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&PE([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&PE([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Qo(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const Lz=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=Qo(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const f=i1(l,s,e);if(f&&f.from<=c&&f.to>=u){const h=nt.create(o,f.from,f.to);n.setSelection(h)}}return!0},Rz=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function r4(t){return t instanceof nt}function ba(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function i4(t,e=null){if(!e)return null;const n=lt.atStart(t),r=lt.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?nt.create(t,ba(0,i,s),ba(t.content.size,i,s)):nt.create(t,ba(e,i,s),ba(e,i,s))}function s4(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function hp(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const Pz=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(hp()||s4())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!r4(n.state.selection))return o(),!0;const a=i4(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},Dz=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),Bz=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),o4=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&o4(r)}return t};function gf(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return o4(n)}function gu(t,e,n){if(t instanceof Lo||t instanceof Ee)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,i=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return Ee.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(s){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),gu("",e,n)}if(i){if(n.errorOnInvalidContent){let o=!1,a="";const l=new Uk({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?Ro.fromSchema(l).parseSlice(gf(t),n.parseOptions):Ro.fromSchema(l).parse(gf(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=Ro.fromSchema(e);return n.slice?s.parseSlice(gf(t),n.parseOptions).content:s.parse(gf(t),n.parseOptions)}return gu("",e,n)}function Hz(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof vn||i instanceof Sn))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(lt.near(t.doc.resolve(o),n))}const Uz=t=>!("type"in t),zz=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{var o;if(i){n={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=b=>{s.emit("contentError",{editor:s,error:b,disableCollaboration:()=>{s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{gu(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(b){l(b)}try{a=gu(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!==null&&o!==void 0?o:s.options.enableContentCheck})}catch(b){return l(b),!1}let{from:u,to:f}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},h=!0,d=!0;if((Uz(a)?a:[a]).forEach(b=>{b.check(),h=h?b.isText&&b.marks.length===0:!1,d=d?b.isBlock:!1}),u===f&&d){const{parent:b}=r.doc.resolve(u);b.isTextblock&&!b.type.spec.code&&!b.childCount&&(u-=1,f+=1)}let g;if(h){if(Array.isArray(e))g=e.map(b=>b.text||"").join("");else if(e instanceof Ee){let b="";e.forEach(w=>{w.text&&(b+=w.text)}),g=b}else typeof e=="object"&&e&&e.text?g=e.text:g=e;r.insertText(g,u,f)}else g=a,r.replaceWith(u,f,g);n.updateSelection&&Hz(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:g}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:g})}return!0},Fz=()=>({state:t,dispatch:e})=>FU(t,e),jz=()=>({state:t,dispatch:e})=>jU(t,e),qz=()=>({state:t,dispatch:e})=>z_(t,e),Vz=()=>({state:t,dispatch:e})=>V_(t,e),Wz=()=>({state:t,dispatch:e,tr:n})=>{try{const r=tp(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Kz=()=>({state:t,dispatch:e,tr:n})=>{try{const r=tp(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Gz=()=>({state:t,dispatch:e})=>UU(t,e),Zz=()=>({state:t,dispatch:e})=>zU(t,e);function a4(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Yz(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))hp()||a4()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}const Jz=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=Yz(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l?.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function mu(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?kn(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(f,h)=>{if(f.isText)return;const d=Math.max(r,h),p=Math.min(i,h+f.nodeSize);a.push({node:f,from:d,to:p})});const l=i-r,c=a.filter(f=>o?o.name===f.node.type.name:!0).filter(f=>Oh(f.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((f,h)=>f+h.to-h.from,0)>=l}const Xz=(t,e={})=>({state:n,dispatch:r})=>{const i=kn(t,n.schema);return mu(n,i,e)?qU(n,r):!1},Qz=()=>({state:t,dispatch:e})=>Z_(t,e),eF=t=>({state:e,dispatch:n})=>{const r=kn(t,e.schema);return nz(r)(e,n)},tF=()=>({state:t,dispatch:e})=>K_(t,e);function dp(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function DE(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}const nF=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=dp(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=kn(t,r.schema)),a==="mark"&&(o=Qo(t,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,u)=>{s&&s===c.type&&n.setNodeMarkup(u,void 0,DE(c.attrs,e)),o&&c.marks.length&&c.marks.forEach(f=>{o===f.type&&n.addMark(u,u+c.nodeSize,o.create(DE(f.attrs,e)))})})}),!0):!1},rF=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),iF=()=>({tr:t,dispatch:e})=>{if(e){const n=new Ur(t.doc);t.setSelection(n)}return!0},sF=()=>({state:t,dispatch:e})=>j_(t,e),oF=()=>({state:t,dispatch:e})=>W_(t,e),aF=()=>({state:t,dispatch:e})=>GU(t,e),lF=()=>({state:t,dispatch:e})=>JU(t,e),cF=()=>({state:t,dispatch:e})=>YU(t,e);function W0(t,e,n={},r={}){return gu(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const uF=(t,e=!1,n={},r={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{var l,c;const{doc:u}=s;if(n.preserveWhitespace!=="full"){const f=W0(t,i.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:i.options.enableContentCheck});return o&&s.replaceWith(0,u.content.size,f).setMeta("preventUpdate",!e),!0}return o&&s.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:u.content.size},t,{parseOptions:n,errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:i.options.enableContentCheck})};function l4(t,e){const n=Qo(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function fF(t,e){const n=new n_(t);return e.forEach(r=>{r.steps.forEach(i=>{n.step(i)})}),n}function hF(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function dF(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(i,s)=>{n(i)&&r.push({node:i,pos:s})}),r}function pF(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function s1(t){return e=>pF(e.$from,t)}function gF(t,e){const n={from:0,to:t.content.size};return e4(t,n,e)}function mF(t,e){const n=kn(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function c4(t,e){const n=dp(typeof e=="string"?e:e.name,t.schema);return n==="node"?mF(t,e):n==="mark"?l4(t,e):{}}function yF(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function bF(t){const e=yF(t);return e.length===1?e:e.filter((n,r)=>!e.filter((s,o)=>o!==r).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function wF(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),f=e.invert().map(c,-1),h=e.invert().map(u);r.push({oldRange:{from:f,to:h},newRange:{from:c,to:u}})})}),bF(r)}function o1(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t),o=i1(s,i.type);o&&r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{!i||i?.nodeSize===void 0||r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}function Df(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}function K0(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?Qo(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(f=>s?s.name===f.type.name:!0).find(f=>Oh(f.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:f,$to:h})=>{const d=f.pos,p=h.pos;t.doc.nodesBetween(d,p,(g,b)=>{if(!g.isText&&!g.marks.length)return;const w=Math.max(d,b),x=Math.min(p,b+g.nodeSize),T=x-w;o+=T,a.push(...g.marks.map(M=>({mark:M,from:w,to:x})))})}),o===0)return!1;const l=a.filter(f=>s?s.name===f.mark.type.name:!0).filter(f=>Oh(f.mark.attrs,n,{strict:!1})).reduce((f,h)=>f+h.to-h.from,0),c=a.filter(f=>s?f.mark.type!==s&&f.mark.type.excludes(s):!0).reduce((f,h)=>f+h.to-h.from,0);return(l>0?l+c:l)>=o}function vF(t,e,n={}){if(!e)return mu(t,null,n)||K0(t,null,n);const r=dp(e,t.schema);return r==="node"?mu(t,e,n):r==="mark"?K0(t,e,n):!1}function BE(t,e){const{nodeExtensions:n}=cp(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=ht(je(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function pp(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(s=>{i!==!1&&(pp(s,{ignoreWhitespace:n,checkChildren:e})||(i=!1))}),i}return!1}function EF(t){return t instanceof Ge}function xF(t,e,n){var r;const{selection:i}=e;let s=null;if(r4(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!==null&&r!==void 0?r:s.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,f,h)=>{if(c)return!1;if(u.isInline){const d=!h||h.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(g=>g.type.excludes(n));c=d&&p}return!c}),c})}const SF=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=Qo(t,r.schema);if(i)if(o){const c=l4(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,f=c.$to.pos;r.doc.nodesBetween(u,f,(h,d)=>{const p=Math.max(d,u),g=Math.min(d+h.nodeSize,f);h.marks.find(w=>w.type===l)?h.marks.forEach(w=>{l===w.type&&n.addMark(p,g,l.create({...w.attrs,...e}))}):n.addMark(p,g,l.create(e))})});return xF(r,n,l)},AF=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),kF=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=kn(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>ME(s,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>ME(s,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},_F=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=ba(t,0,r.content.size),s=Ge.create(r,i);e.setSelection(s)}return!0},CF=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=nt.atStart(r).from,a=nt.atEnd(r).to,l=ba(i,o,a),c=ba(s,o,a),u=nt.create(r,l,c);e.setSelection(u)}return!0},TF=t=>({state:e,dispatch:n})=>{const r=kn(t,e.schema);return sz(r)(e,n)};function HE(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(r)}}const IF=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=Df(c,a.node().type.name,a.node().attrs);if(s instanceof Ge&&s.node.isBlock)return!a.parentOffset||!$s(o,a.pos)?!1:(r&&(t&&HE(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const f=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:hF(a.node(-1).contentMatchAt(a.indexAfter(-1)));let d=f&&h?[{type:h,attrs:u}]:void 0,p=$s(e.doc,e.mapping.map(a.pos),1,d);if(!d&&!p&&$s(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,d=h?[{type:h,attrs:u}]:void 0),r){if(p&&(s instanceof nt&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,d),h&&!f&&!a.parentOffset&&a.parent.type!==h)){const g=e.mapping.map(a.before()),b=e.doc.resolve(g);a.node(-1).canReplaceWith(b.index(),b.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}t&&HE(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},OF=(t,e={})=>({tr:n,state:r,dispatch:i,editor:s})=>{var o;const a=kn(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const f=l.node(-1);if(f.type!==a)return!1;const h=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let w=Ee.empty;const x=l.index(-1)?1:l.index(-2)?2:3;for(let A=l.depth-x;A>=l.depth-3;A-=1)w=Ee.from(l.node(A).copy(w));const T=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,M={...Df(h,l.node().type.name,l.node().attrs),...e},O=((o=a.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(M))||void 0;w=w.append(Ee.from(a.createAndFill(null,O)||void 0));const _=l.before(l.depth-(x-1));n.replace(_,l.after(-T),new De(w,4-x,0));let L=-1;n.doc.nodesBetween(_,n.doc.content.size,(A,E)=>{if(L>-1)return!1;A.isTextblock&&A.content.size===0&&(L=E+1)}),L>-1&&n.setSelection(nt.near(n.doc.resolve(L))),n.scrollIntoView()}return!0}const d=c.pos===l.end()?f.contentMatchAt(0).defaultType:null,p={...Df(h,f.type.name,f.attrs),...e},g={...Df(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const b=d?[{type:a,attrs:p},{type:d,attrs:g}]:[{type:a,attrs:p}];if(!$s(n.doc,l.pos,2))return!1;if(i){const{selection:w,storedMarks:x}=r,{splittableMarks:T}=s.extensionManager,M=x||w.$to.parentOffset&&w.$from.marks();if(n.split(l.pos,2,b).scrollIntoView(),!M||!i)return!0;const O=M.filter(_=>T.includes(_.type.name));n.ensureMarks(O)}return!0},gm=(t,e)=>{const n=s1(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&Jo(t.doc,n.pos)&&t.join(n.pos),!0},mm=(t,e)=>{const n=s1(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&Jo(t.doc,r)&&t.join(r),!0},$F=(t,e,n,r={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:f,splittableMarks:h}=i.extensionManager,d=kn(t,o.schema),p=kn(e,o.schema),{selection:g,storedMarks:b}=o,{$from:w,$to:x}=g,T=w.blockRange(x),M=b||g.$to.parentOffset&&g.$from.marks();if(!T)return!1;const O=s1(_=>BE(_.type.name,f))(g);if(T.depth>=1&&O&&T.depth-O.depth<=1){if(O.node.type===d)return c.liftListItem(p);if(BE(O.node.type.name,f)&&d.validContent(O.node.content)&&a)return l().command(()=>(s.setNodeMarkup(O.pos,d),!0)).command(()=>gm(s,d)).command(()=>mm(s,d)).run()}return!n||!M||!a?l().command(()=>u().wrapInList(d,r)?!0:c.clearNodes()).wrapInList(d,r).command(()=>gm(s,d)).command(()=>mm(s,d)).run():l().command(()=>{const _=u().wrapInList(d,r),L=M.filter(A=>h.includes(A.type.name));return s.ensureMarks(L),_?!0:c.clearNodes()}).wrapInList(d,r).command(()=>gm(s,d)).command(()=>mm(s,d)).run()},MF=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=Qo(t,r.schema);return K0(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},NF=(t,e,n={})=>({state:r,commands:i})=>{const s=kn(t,r.schema),o=kn(e,r.schema),a=mu(r,s,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...n})},LF=(t,e={})=>({state:n,commands:r})=>{const i=kn(t,n.schema);return mu(n,i,e)?r.lift(i):r.wrapIn(i,e)},RF=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},PF=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},DF=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=Qo(t,r.schema),{$from:c,empty:u,ranges:f}=a;if(!i)return!0;if(u&&o){let{from:h,to:d}=a;const p=(s=c.marks().find(b=>b.type===l))===null||s===void 0?void 0:s.attrs,g=i1(c,l,p);g&&(h=g.from,d=g.to),n.removeMark(h,d,l)}else f.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,l)});return n.removeStoredMark(l),!0},BF=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=dp(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(s=kn(t,r.schema)),a==="mark"&&(o=Qo(t,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,u=l.$to.pos;let f,h,d,p;n.selection.empty?r.doc.nodesBetween(c,u,(g,b)=>{s&&s===g.type&&(d=Math.max(b,c),p=Math.min(b+g.nodeSize,u),f=b,h=g)}):r.doc.nodesBetween(c,u,(g,b)=>{b<c&&s&&s===g.type&&(d=Math.max(b,c),p=Math.min(b+g.nodeSize,u),f=b,h=g),b>=c&&b<=u&&(s&&s===g.type&&n.setNodeMarkup(b,void 0,{...g.attrs,...e}),o&&g.marks.length&&g.marks.forEach(w=>{if(o===w.type){const x=Math.max(b,c),T=Math.min(b+g.nodeSize,u);n.addMark(x,T,o.create({...w.attrs,...e}))}}))}),h&&(f!==void 0&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(g=>{o===g.type&&n.addMark(d,p,o.create({...g.attrs,...e}))}))}),!0):!1},HF=(t,e={})=>({state:n,dispatch:r})=>{const i=kn(t,n.schema);return XU(i,e)(n,r)},UF=(t,e={})=>({state:n,dispatch:r})=>{const i=kn(t,n.schema);return QU(i,e)(n,r)};var zF=Object.freeze({__proto__:null,blur:xz,clearContent:Sz,clearNodes:Az,command:kz,createParagraphNear:_z,cut:Cz,deleteCurrentNode:Tz,deleteNode:Iz,deleteRange:Oz,deleteSelection:$z,enter:Mz,exitCode:Nz,extendMarkRange:Lz,first:Rz,focus:Pz,forEach:Dz,insertContent:Bz,insertContentAt:zz,joinBackward:qz,joinDown:jz,joinForward:Vz,joinItemBackward:Wz,joinItemForward:Kz,joinTextblockBackward:Gz,joinTextblockForward:Zz,joinUp:Fz,keyboardShortcut:Jz,lift:Xz,liftEmptyBlock:Qz,liftListItem:eF,newlineInCode:tF,resetAttributes:nF,scrollIntoView:rF,selectAll:iF,selectNodeBackward:sF,selectNodeForward:oF,selectParentNode:aF,selectTextblockEnd:lF,selectTextblockStart:cF,setContent:uF,setMark:SF,setMeta:AF,setNode:kF,setNodeSelection:_F,setTextSelection:CF,sinkListItem:TF,splitBlock:IF,splitListItem:OF,toggleList:$F,toggleMark:MF,toggleNode:NF,toggleWrap:LF,undoInputRule:RF,unsetAllMarks:PF,unsetMark:DF,updateAttributes:BF,wrapIn:HF,wrapInList:UF});const FF=an.create({name:"commands",addCommands(){return{...zF}}}),jF=an.create({name:"drop",addProseMirrorPlugins(){return[new Dt({key:new on("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),qF=an.create({name:"editable",addProseMirrorPlugins(){return[new Dt({key:new on("editable"),props:{editable:()=>this.editor.options.editable}})]}}),VF=new on("focusEvents"),WF=an.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Dt({key:VF,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),KF=an.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:f}=l,{pos:h,parent:d}=f,p=f.parent.isTextblock&&h>0?a.doc.resolve(h-1):f,g=p.parent.type.spec.isolating,b=f.pos-f.parentOffset,w=g&&p.parent.childCount===1?b===f.pos:lt.atStart(c).from===h;return!u||!d.type.isTextblock||d.textContent.length||!w||w&&f.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return hp()||a4()?s:i},addProseMirrorPlugins(){return[new Dt({key:new on("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(g=>g.getMeta("composition")))return;const r=t.some(g=>g.docChanged)&&!e.doc.eq(n.doc),i=t.some(g=>g.getMeta("preventClearDocument"));if(!r||i)return;const{empty:s,from:o,to:a}=e.selection,l=lt.atStart(e.doc).from,c=lt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!pp(n.doc))return;const h=n.tr,d=ap({state:n,transaction:h}),{commands:p}=new lp({editor:this.editor,state:d});if(p.clearNodes(),!!h.steps.length)return h}})]}}),GF=an.create({name:"paste",addProseMirrorPlugins(){return[new Dt({key:new on("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),ZF=an.create({name:"tabindex",addProseMirrorPlugins(){return[new Dt({key:new on("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class da{get name(){return this.node.type.name}constructor(e,n,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=i}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new da(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new da(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new da(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const i=n.isBlock&&!n.isTextblock,s=n.isAtom&&!n.isText,o=this.pos+r+(s?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new da(a,this.editor,i,i?n:null);i&&(l.actualDepth=this.depth+1),e.push(new da(a,this.editor,i,i?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(n).length>0){const s=i.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==n[l])break}}else r=i;i=i.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(n);return this.children.forEach(o=>{r&&i.length>0||(o.node.type.name===e&&s.every(l=>n[l]===o.node.attrs[l])&&i.push(o),!(r&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,n,r))))}),i}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const YF=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function JF(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}let XF=class extends oz{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:i})=>this.options.onDrop(n,r,i)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=JF(YF,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=Q_(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,n;const i=[...this.options.enableCoreExtensions?[qF,Ez.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),FF,WF,KF,ZF,jF,GF].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s?.type));this.extensionManager=new pl(i,this)}createCommandManager(){this.commandManager=new lp({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=W0(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(o){if(!(o instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(o.message))throw o;this.emit("contentError",{editor:this,error:o,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=W0(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=i4(n,this.options.autofocus);this.view=new B_(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:dl.create({doc:n,selection:r||void 0})});const i=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(i),this.createNodeViews(),this.prependClass();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(o=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(o)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),s=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return c4(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return vF(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return n1(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return gF(this.state.doc,{blockSeparator:n,textSerializers:{...t4(this.schema),...r}})}get isEmpty(){return pp(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new da(n,this)}get $doc(){return this.$pos(0)}};function ql(t){return new up({find:t.find,handler:({state:e,range:n,match:r})=>{const i=ht(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(o1(n.from,n.to,e.doc).filter(d=>d.mark.type.excluded.find(g=>g===t.type&&g!==d.mark.type)).filter(d=>d.to>c).length)return null;u<n.to&&s.delete(u,n.to),c>n.from&&s.delete(n.from+l,c);const h=n.from+l+o.length;s.addMark(n.from+l,h,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}function u4(t){return new up({find:t.find,handler:({state:e,range:n,match:r})=>{const i=ht(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;const l=t.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const f=r[0][r[0].length-1];s.insertText(f,o+r[0].length-1),s.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;s.insert(c,t.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()}})}function G0(t){return new up({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=ht(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)}})}function yu(t){return new up({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const s=ht(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&Ub(l,t.type,s);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:f,storedMarks:h}=e,{splittableMarks:d}=t.editor.extensionManager,p=h||f.$to.parentOffset&&f.$from.marks();if(p){const g=p.filter(b=>d.includes(b.type.name));o.ensureMarks(g)}}if(t.keepAttributes){const f=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(f,s).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&Jo(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)}})}let ai=class Z0{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ht(je(this,"addOptions",{name:this.name}))),this.storage=ht(je(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Z0(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>fp(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new Z0(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=ht(je(n,"addOptions",{name:n.name})),n.storage=ht(je(n,"addStorage",{name:n.name,options:n.options})),n}};class QF{constructor(e,n,r){this.isDragging=!1,this.component=e,this.editor=n.editor,this.options={stopEvent:null,ignoreMutation:null,...r},this.extension=n.extension,this.node=n.node,this.decorations=n.decorations,this.innerDecorations=n.innerDecorations,this.view=n.view,this.HTMLAttributes=n.HTMLAttributes,this.getPos=n.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(e){var n,r,i,s,o,a,l;const{view:c}=this.editor,u=e.target,f=u.nodeType===3?(n=u.parentElement)===null||n===void 0?void 0:n.closest("[data-drag-handle]"):u.closest("[data-drag-handle]");if(!this.dom||!((r=this.contentDOM)===null||r===void 0)&&r.contains(u)||!f)return;let h=0,d=0;if(this.dom!==f){const x=this.dom.getBoundingClientRect(),T=f.getBoundingClientRect(),M=(i=e.offsetX)!==null&&i!==void 0?i:(s=e.nativeEvent)===null||s===void 0?void 0:s.offsetX,O=(o=e.offsetY)!==null&&o!==void 0?o:(a=e.nativeEvent)===null||a===void 0?void 0:a.offsetY;h=T.x-x.x+M,d=T.y-x.y+O}const p=this.dom.cloneNode(!0);(l=e.dataTransfer)===null||l===void 0||l.setDragImage(p,h,d);const g=this.getPos();if(typeof g!="number")return;const b=Ge.create(c.state.doc,g),w=c.state.tr.setSelection(b);c.dispatch(w)}stopEvent(e){var n;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:e});const r=e.target;if(!(this.dom.contains(r)&&!(!((n=this.contentDOM)===null||n===void 0)&&n.contains(r))))return!1;const s=e.type.startsWith("drag"),o=e.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(r.tagName)||r.isContentEditable)&&!o&&!s)return!0;const{isEditable:l}=this.editor,{isDragging:c}=this,u=!!this.node.type.spec.draggable,f=Ge.isSelectable(this.node),h=e.type==="copy",d=e.type==="paste",p=e.type==="cut",g=e.type==="mousedown";if(!u&&f&&s&&e.target===this.dom&&e.preventDefault(),u&&s&&!c&&e.target===this.dom)return e.preventDefault(),!1;if(u&&l&&!c&&g){const b=r.closest("[data-drag-handle]");b&&(this.dom===b||this.dom.contains(b))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(c||o||h||d||p||g&&f)}ignoreMutation(e){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:e}):this.node.isLeaf||this.node.isAtom?!0:e.type==="selection"||this.dom.contains(e.target)&&e.type==="childList"&&(hp()||s4())&&this.editor.isFocused&&[...Array.from(e.addedNodes),...Array.from(e.removedNodes)].every(r=>r.isContentEditable)?!1:this.contentDOM===e.target&&e.type==="attributes"?!0:!this.contentDOM.contains(e.target)}updateAttributes(e){this.editor.commands.command(({tr:n})=>{const r=this.getPos();return typeof r!="number"?!1:(n.setNodeMarkup(r,void 0,{...this.node.attrs,...e}),!0)})}deleteNode(){const e=this.getPos();if(typeof e!="number")return;const n=e+this.node.nodeSize;this.editor.commands.deleteRange({from:e,to:n})}}function Ua(t){return new gz({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:i})=>{const s=ht(t.getAttributes,void 0,r,i);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),f=n.from+l.indexOf(a),h=f+a.length;if(o1(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(b=>b===t.type&&b!==p.mark.type)).filter(p=>p.to>f).length)return null;h<n.to&&o.delete(h,n.to),f>n.from&&o.delete(n.from+u,f),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}function ej(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof Ge){const s=r.index();return r.parent.canReplaceWith(s,s+1,e)}let i=r.depth;for(;i>=0;){const s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}class tj extends XF{contentElement=null}const nj=t=>{const e=new tj(t);return _S(e,n=>(e.on("transaction",()=>{n(e)}),()=>{e.destroy()}))};class rj{component;props;dom;constructor(e,{element:n,props:r}){this.component=e,this.props=r,this.dom=n,this.dom.classList.add("svelte-renderer")}updateProps(e){Object.assign(this.props,e)}updateAttributes(e){Object.keys(e).forEach(n=>{this.dom.setAttribute(n,e[n])})}destroy(){c$(this.component)}}const f4="TipTapNodeView",ij=(t,e)=>{if(!t)throw new Error(e)};class sj extends Map{#e=new Map;#t=He(0);#n=He(0);#s=Cs||-1;constructor(e){if(super(),e){for(var[n,r]of e)super.set(n,r);this.#n.v=super.size}}#r(e){return Cs===this.#s?He(e):Tl(e)}has(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#r(0),n.set(e,r);else return F(this.#t),!1}return F(r),!0}forEach(e,n){this.#o(),super.forEach(e,n)}get(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#r(0),n.set(e,r);else{F(this.#t);return}}return F(r),super.get(e)}set(e,n){var r=this.#e,i=r.get(e),s=super.get(e),o=super.set(e,n),a=this.#t;if(i===void 0)i=this.#r(0),r.set(e,i),ye(this.#n,super.size),Eo(a);else if(s!==n){Eo(i);var l=a.reactions===null?null:new Set(a.reactions),c=l===null||!i.reactions?.every(u=>l.has(u));c&&Eo(a)}return o}delete(e){var n=this.#e,r=n.get(e),i=super.delete(e);return r!==void 0&&(n.delete(e),ye(this.#n,super.size),ye(r,-1),Eo(this.#t)),i}clear(){if(super.size!==0){super.clear();var e=this.#e;ye(this.#n,0);for(var n of e.values())ye(n,-1);Eo(this.#t),e.clear()}}#o(){F(this.#t);var e=this.#e;if(this.#n.v!==e.size){for(var n of super.keys())if(!e.has(n)){var r=this.#r(0);e.set(n,r)}}for([,r]of this.#e)F(r)}keys(){return F(this.#t),super.keys()}values(){return this.#o(),super.values()}entries(){return this.#o(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return F(this.#n),super.size}}class oj extends QF{mount(){const e=this.component,n=rn({editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(a={})=>this.updateAttributes(a),deleteNode:()=>this.deleteNode()});this.contentDOMElement=this.node.isLeaf?null:document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");const r=this.options.context||new sj;r.set(f4,{onDragStart:this.onDragStart.bind(this)});const i=this.options.as??(this.node.isInline?"span":"div"),s=document.createElement(i);s.classList.add(`node-${this.node.type.name}`),this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate);const o=mS(e,{target:s,props:n,context:r});this.renderer=new rj(o,{element:s,props:n}),this.appendContendDom(),this.updateElementAttributes()}appendContendDom(){const e=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&e&&!e.contains(this.contentDOMElement)&&e.appendChild(this.contentDOMElement)}get dom(){return ij(this.renderer.dom.firstElementChild?.hasAttribute("data-node-view-wrapper"),"Please use the NodeViewWrapper component for your node view."),this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection,r=this.getPos();if(typeof r=="number")if(e<=r&&n>=r+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n,r){const i=s=>{this.renderer.updateProps(s),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(typeof this.options.update=="function"){const s=this.node,o=this.decorations,a=this.innerDecorations;return this.node=e,this.decorations=n,this.innerDecorations=r,this.options.update({oldNode:s,oldDecorations:o,oldInnerDecorations:a,newNode:e,newDecorations:n,newInnerDecorations:r,updateProps:()=>i({node:e,decorations:n,innerDecorations:r})})}return e.type!==this.node.type?!1:(e===this.node&&this.decorations===n&&this.innerDecorations===r||(this.node=e,this.decorations=n,this.innerDecorations=r,i({node:e,decorations:n,innerDecorations:r})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.dom.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.dom.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const n=this.editor.extensionManager.attributes,r=Ih(this.node,n);e=this.options.attrs({node:this.node,HTMLAttributes:r})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}const aj=(t,e)=>n=>new oj(t,n,e);var lj=Qe("<div></div> <!>",1);function cj(t,e){jn(e,!0);const n=dt(e,"editor",7);let r;Zo(async()=>{await Nd(),r&&n()?.options.element&&(n().contentElement||(r.append(...Array.from(n().options.element.childNodes)),n().setOptions({element:r}),n().contentElement=r))}),_u(()=>{if(!n()||(n().contentElement=null,!n().options.element.firstChild))return;const c=document.createElement("div");c.append(...Array.from(n().options.element.childNodes)),n().setOptions({element:c})});var s=lj(),o=Ct(s);Ki(o,c=>r=c,()=>r);var a=We(o,2);{var l=c=>{var u=pn(),f=Ct(u);nu(f,()=>e.children),$e(c,u)};ft(a,c=>{e.children&&c(l)})}ut(()=>Ka(o,1,vS(e.class))),$e(t,s),qn()}function uj(t,e){jn(e,!0);const n=dt(e,"as",3,"div"),r=A$(e,["$$slots","$$events","$$legacy","as","children"]),{onDragStart:i}=CO(f4);let s;Zo(async()=>{await Nd(),s.style.whiteSpace="normal"});var o=pn(),a=Ct(o);h$(a,n,!1,(l,c)=>{Ki(l,d=>s=d,()=>s),w$(l,()=>({"data-node-view-wrapper":"",role:"none",...r,ondragstart:i}));var u=pn(),f=Ct(u);{var h=d=>{var p=pn(),g=Ct(p);nu(g,()=>e.children),$e(d,p)};ft(f,d=>{e.children&&d(h)})}$e(c,u)}),$e(t,o),qn()}function $h(t){return t===0?"0KB":`${Math.round(t/1024)}KB`}function fj(t,e,n,r,i,s){const o=t>0?Math.round(e/t*100):100,a=`${$h(t)} → ${$h(e)}`;return{originalSize:t,compressedSize:e,wasCompressed:n,compressionRatio:o,sizeReduction:a,originalFilename:r,compressedFilename:i,wasSkipped:s}}function UE(t){return!t||!(t.wasCompressed||t.originalFilename!==t.compressedFilename||t.originalSize!==t.compressedSize||t.wasSkipped)?null:{wasCompressed:t.wasCompressed,originalSize:$h(t.originalSize),compressedSize:$h(t.compressedSize),compressionRatio:t.compressionRatio,originalFilename:t.originalFilename,compressedFilename:t.compressedFilename,wasSkipped:t.wasSkipped}}function hj(t){return/nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{10,}/.test(t)}function h4(t){try{const{type:e,data:n}=Os.decode(t);if(e!=="nsec")return console.warn("無効なnsec形式です"),{hex:"",npub:"",nprofile:""};const r=Zd(n),i=Os.npubEncode(r),s=Os.nprofileEncode({pubkey:r,relays:[]});return{hex:r,npub:i,nprofile:s}}catch(e){return console.error("公開鍵の導出に失敗:",e),{hex:"",npub:"",nprofile:""}}}function d4(t){return/^nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58,}$/.test(t)}function Y0(t,e,n){return Math.max(e,Math.min(n,t))}function dj(t,e,n){return Math.abs(t-e)<n}function wa(t,e){document.body.style.setProperty(t,e)}function pj(){wa("overflow",""),wa("user-select",""),wa("-webkit-user-select","")}function gj(t,e){setTimeout(()=>{const n=document.querySelector(t);n&&n.focus()},e)}function mj(t,e,n,r,i){const s=e.getBoundingClientRect(),o=s.width/2,a=s.height/2,l=t.clientX-s.left-o,c=t.clientY-s.top-a;return{scale:i,offsetX:l,offsetY:c}}function yj(t,e,n){const r=t.getBoundingClientRect(),i=r.width/2,s=r.height/2;return{centerX:i,centerY:s,offsetX:e-r.left-i,offsetY:n-r.top-s}}function bj(t,e){return{x:t.x-e.x,y:t.y-e.y}}class p4{_nsecStore=Hr("");_dataStore=Hr({hex:"",npub:"",nprofile:""});_isValidStore=Hr(!1);_isNostrLoginStore=Hr(!1);nsec={subscribe:this._nsecStore.subscribe};data={subscribe:this._dataStore.subscribe};isValid={subscribe:this._isValidStore.subscribe};isNostrLogin={subscribe:this._isNostrLoginStore.subscribe};hex=Is(this._dataStore,e=>e.hex);npub=Is(this._dataStore,e=>e.npub);nprofile=Is(this._dataStore,e=>e.nprofile);constructor(){this._nsecStore.subscribe(e=>this.updateFromNsec(e))}setNsec(e){const n=e?.trim()||"";this._nsecStore.set(n),this._isNostrLoginStore.set(!1)}setNostrLoginAuth(e){if(e.type==="logout"){this.clear();return}if(!e.pubkey){console.warn("NostrLoginAuth: pubkey is required for login/signup");return}try{const n=e.npub||Os.npubEncode(e.pubkey),r=Os.nprofileEncode({pubkey:e.pubkey,relays:[]});this._dataStore.set({hex:e.pubkey,npub:n,nprofile:r}),this._isValidStore.set(!0),this._isNostrLoginStore.set(!0),this._nsecStore.set(""),qB(e.pubkey,n,r)}catch(n){console.error("Failed to set NostrLogin auth:",n),this.clear()}}updateFromNsec(e){if(!e||!d4(e)){this._resetState();return}try{const n=h4(e);n.hex?(this._dataStore.set(n),this._isValidStore.set(!0)):this._resetState()}catch(n){console.error("Failed to derive public key from nsec:",n),this._resetState()}}_resetState(){this._dataStore.set({hex:"",npub:"",nprofile:""}),this._isValidStore.set(!1)}clear(){this._nsecStore.set(""),this._isNostrLoginStore.set(!1),jB()}get currentIsValid(){return Tf(this._isValidStore)}get currentHex(){return Tf(this.hex)}get currentIsNostrLogin(){return Tf(this._isNostrLoginStore)}}const Hi={isValidNsec:d4,derivePublicKey:h4,pubkeyToNpub(t){try{return t?Os.npubEncode(t):""}catch(e){return console.error("pubkeyからnpubへの変換エラー:",e),""}},saveToStorage(t){if(!t?.trim())return{success:!1,error:{type:"validation",message:"Key cannot be empty"}};try{const e=t.trim();return localStorage.setItem("nostr-secret-key",e),af.set(e),{success:!0}}catch(e){const n={type:"storage",message:"鍵の保存に失敗しました",originalError:e};return console.error("鍵の保存に失敗:",e),{success:!1,error:n}}},loadFromStorage(){let t=af.value;if(t)return t;try{return t=localStorage.getItem("nostr-secret-key"),t&&af.set(t),t}catch(e){return console.error("鍵の読み込みに失敗:",e),null}},getFromStore(){return af.value},hasStoredKey(){try{return!!localStorage.getItem("nostr-secret-key")}catch(t){return console.error("ストレージアクセスエラー:",t),!1}},isWindowNostrAvailable(){return typeof window<"u"&&"nostr"in window&&typeof window.nostr=="object"&&window.nostr!==null&&typeof window.nostr.getPublicKey=="function"},async getPublicKeyFromWindowNostr(){if(!this.isWindowNostrAvailable())return{success:!1,error:{type:"validation",message:"window.nostr is not available"}};try{return{success:!0,pubkey:await window.nostr.getPublicKey()}}catch(t){const e={type:"network",message:"window.nostrから公開鍵の取得に失敗しました",originalError:t};return console.error("window.nostrから公開鍵の取得に失敗:",t),{success:!1,error:e}}}},wj=/^\s*>\s$/,vj=ai.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",_n(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[yu({find:wj,type:this.type})]}}),Ej=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,xj=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Sj=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Aj=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,kj=Ds.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",_n(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[ql({find:Ej,type:this.type}),ql({find:Sj,type:this.type})]},addPasteRules(){return[Ua({find:xj,type:this.type}),Ua({find:Aj,type:this.type})]}}),_j="listItem",zE="textStyle",FE=/^\s*([-+*])\s$/,Cj=ai.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",_n(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(_j,this.editor.getAttributes(zE)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=yu({find:FE,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=yu({find:FE,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(zE),editor:this.editor})),[t]}}),Tj=/(^|[^`])`([^`]+)`(?!`)/,Ij=/(^|[^`])`([^`]+)`(?!`)/g,Oj=Ds.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",_n(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[ql({find:Tj,type:this.type})]},addPasteRules(){return[Ua({find:Ij,type:this.type})]}}),$j=/^```([a-z]+)?[\s\n]$/,Mj=/^~~~([a-z]+)?[\s\n]$/,Nj=ai.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,s=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",_n(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(lt.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[G0({find:$j,type:this.type,getAttributes:t=>({language:t[1]})}),G0({find:Mj,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Dt({key:new on("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i?.mode;if(!n||!s)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(nt.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),Lj=ai.create({name:"doc",topNode:!0,content:"block+"});function Rj(t={}){return new Dt({view(e){return new Pj(e,t)}})}class Pj{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,i=this.editorView.dom,s=i.getBoundingClientRect(),o=s.width/i.offsetWidth,a=s.height/i.offsetHeight;if(n){let f=e.nodeBefore,h=e.nodeAfter;if(f||h){let d=this.editorView.nodeDOM(this.cursorPos-(f?f.nodeSize:0));if(d){let p=d.getBoundingClientRect(),g=f?p.bottom:p.top;f&&h&&(g=(g+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let b=this.width/2*a;r={left:p.left,right:p.right,top:g-b,bottom:g+b}}}}if(!r){let f=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;r={left:f.left-h,right:f.left+h,top:f.top,bottom:f.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let f=l.getBoundingClientRect(),h=f.width/l.offsetWidth,d=f.height/l.offsetHeight;c=f.left-l.scrollLeft*h,u=f.top-l.scrollTop*d}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n,e):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=Jk(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const Dj=an.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Rj(this.options)]}});class Kt extends lt{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Kt.valid(r)?new Kt(r):lt.near(r)}content(){return De.empty}eq(e){return e instanceof Kt&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Kt(e.resolve(n.pos))}getBookmark(){return new a1(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!Bj(e)||!Hj(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Kt.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(Kt.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!Ge.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(Kt.valid(a))return a}return null}}}Kt.prototype.visible=!1;Kt.findFrom=Kt.findGapCursorFrom;lt.jsonID("gapcursor",Kt);class a1{constructor(e){this.pos=e}map(e){return new a1(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Kt.valid(n)?new Kt(n):lt.near(n)}}function Bj(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function Hj(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||i.isAtom||i.type.spec.isolating)return!0;if(i.inlineContent)return!1}}return!0}function Uj(){return new Dt({props:{decorations:qj,createSelectionBetween(t,e,n){return e.pos==n.pos&&Kt.valid(n)?new Kt(n):null},handleClick:Fj,handleKeyDown:zj,handleDOMEvents:{beforeinput:jj}}})}const zj=H_({ArrowLeft:mf("horiz",-1),ArrowRight:mf("horiz",1),ArrowUp:mf("vert",-1),ArrowDown:mf("vert",1)});function mf(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof nt){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=Kt.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new Kt(c))),!0):!1}}function Fj(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Kt.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&Ge.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Kt(r))),!0)}function jj(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Kt))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=Ee.empty;for(let o=r.length-1;o>=0;o--)i=Ee.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new De(i,0,0));return s.setSelection(nt.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function qj(t){if(!(t.selection instanceof Kt))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",zt.create(t.doc,[or.widget(t.selection.head,e,{key:"gapcursor"})])}const Vj=an.create({name:"gapCursor",addProseMirrorPlugins(){return[Uj()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=ht(je(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),Wj=ai.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",_n(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const f=l.filter(h=>a.includes(h.type.name));c.ensureMarks(f)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Kj=ai.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,_n(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>G0({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Mh=200,An=function(){};An.prototype.append=function(e){return e.length?(e=An.from(e),!this.length&&e||e.length<Mh&&this.leafAppend(e)||this.length<Mh&&e.leafPrepend(this)||this.appendInner(e)):this};An.prototype.prepend=function(e){return e.length?An.from(e).append(this):this};An.prototype.appendInner=function(e){return new Gj(this,e)};An.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?An.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};An.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};An.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};An.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};An.from=function(e){return e instanceof An?e:e&&e.length?new g4(e):An.empty};var g4=(function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=Mh)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=Mh)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(An);An.empty=new g4([]);var Gj=(function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(An);const Zj=500;class mi{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((f,h)=>{if(!f.step){i||(i=this.remapping(r,h+1),s=i.maps.length),s--,u.push(f);return}if(i){u.push(new Ni(f.map));let d=f.step.map(i.slice(s)),p;d&&o.maybeStep(d).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new Ni(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(f.step);if(f.selection)return a=i?f.selection.map(i.slice(s)):f.selection,l=new mi(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let f=e.steps[u].invert(e.docs[u]),h=new Ni(e.mapping.maps[u],f,n),d;(d=l&&l.merge(h))&&(h=d,u?s.pop():a=a.slice(0,a.length-1)),s.push(h),n&&(o++,n=void 0),i||(l=h)}let c=o-r.depth;return c>Jj&&(a=Yj(a,c),o-=c),new mi(a.append(s),o)}remapping(e,n){let r=new uu;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new mi(this.items.append(e.map(n=>new Ni(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},i);let l=n;this.items.forEach(h=>{let d=s.getMirror(--l);if(d==null)return;o=Math.min(o,d);let p=s.maps[d];if(h.step){let g=e.steps[d].invert(e.docs[d]),b=h.selection&&h.selection.map(s.slice(l+1,d));b&&a++,r.push(new Ni(p,g,b))}else r.push(new Ni(p))},i);let c=[];for(let h=n;h<o;h++)c.push(new Ni(s.maps[h]));let u=this.items.slice(0,i).append(c).append(r),f=new mi(u,a);return f.emptyItemCount()>Zj&&(f=f.compress(this.items.length-r.length)),f}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let f=new Ni(c.invert(),l,u),h,d=i.length-1;(h=i.length&&i[d].merge(f))?i[d]=h:i.push(f)}}else o.map&&r--},this.items.length,0),new mi(An.from(i.reverse()),s)}}mi.empty=new mi(An.empty,0);function Yj(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class Ni{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Ni(n.getMap().invert(),n,this.selection)}}}class bo{constructor(e,n,r,i,s){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const Jj=20;function Xj(t,e,n,r){let i=n.getMeta(Ia),s;if(i)return i.historyState;n.getMeta(tq)&&(t=new bo(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Ia))return o.getMeta(Ia).redo?new bo(t.done.addTransform(n,void 0,r,Bf(e)),t.undone,jE(n.mapping.maps),t.prevTime,t.prevComposition):new bo(t.done,t.undone.addTransform(n,void 0,r,Bf(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!Qj(n,t.prevRanges)),c=o?ym(t.prevRanges,n.mapping):jE(n.mapping.maps);return new bo(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,Bf(e)),mi.empty,c,n.time,a??t.prevComposition)}else return(s=n.getMeta("rebased"))?new bo(t.done.rebased(n,s),t.undone.rebased(n,s),ym(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new bo(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),ym(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function Qj(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function jE(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,i,s,o)=>e.push(s,o));return e}function ym(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function eq(t,e,n){let r=Bf(e),i=Ia.get(e).spec.config,s=(n?t.undone:t.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(n?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),l=new bo(n?a:s.remaining,n?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(Ia,{redo:n,historyState:l})}let bm=!1,qE=null;function Bf(t){let e=t.plugins;if(qE!=e){bm=!1,qE=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){bm=!0;break}}return bm}const Ia=new on("history"),tq=new on("closeHistory");function nq(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Dt({key:Ia,state:{init(){return new bo(mi.empty,mi.empty,null,0,-1)},apply(e,n,r){return Xj(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?y4:r=="historyRedo"?b4:null;return i?(n.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function m4(t,e){return(n,r)=>{let i=Ia.getState(n);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(r){let s=eq(i,n,t);s&&r(e?s.scrollIntoView():s)}return!0}}const y4=m4(!1,!0),b4=m4(!0,!0),rq=an.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>y4(t,e),redo:()=>({state:t,dispatch:e})=>b4(t,e)}},addProseMirrorPlugins(){return[nq(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),iq=ai.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",_n(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!ej(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:i}=n,s=t();return r.parentOffset===0?s.insertContentAt({from:Math.max(r.pos-1,0),to:i.pos},{type:this.name}):EF(n)?s.insertContentAt(i.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:o,dispatch:a})=>{var l;if(a){const{$to:c}=o.selection,u=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?o.setSelection(nt.create(o.doc,c.pos+1)):c.nodeAfter.isBlock?o.setSelection(Ge.create(o.doc,c.pos)):o.setSelection(nt.create(o.doc,c.pos));else{const f=(l=c.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();f&&(o.insert(u,f),o.setSelection(nt.create(o.doc,u+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[u4({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),sq=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,oq=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,aq=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,lq=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,cq=Ds.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",_n(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[ql({find:sq,type:this.type}),ql({find:aq,type:this.type})]},addPasteRules(){return[Ua({find:oq,type:this.type}),Ua({find:lq,type:this.type})]}}),uq=ai.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",_n(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),fq="listItem",VE="textStyle",WE=/^(\d+)\.\s$/,hq=ai.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",_n(this.options.HTMLAttributes,n),0]:["ol",_n(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(fq,this.editor.getAttributes(VE)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=yu({find:WE,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=yu({find:WE,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(VE)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),dq=ai.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",_n(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),pq=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,gq=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,mq=Ds.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",_n(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[ql({find:pq,type:this.type})]},addPasteRules(){return[Ua({find:gq,type:this.type})]}}),yq=ai.create({name:"text",group:"inline"}),bq=an.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(kj.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(vj.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(Cj.configure(this.options.bulletList)),this.options.code!==!1&&t.push(Oj.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(Nj.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(Lj.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(Dj.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(Vj.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(Wj.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push(Kj.configure(this.options.heading)),this.options.history!==!1&&t.push(rq.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(iq.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(cq.configure(this.options.italic)),this.options.listItem!==!1&&t.push(uq.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(hq.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(dq.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(mq.configure(this.options.strike)),this.options.text!==!1&&t.push(yq.configure(this.options.text)),t}}),wq="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",vq="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",J0="numeric",X0="ascii",Q0="alpha",Fc="asciinumeric",Oc="alphanumeric",ey="domain",w4="emoji",Eq="scheme",xq="slashscheme",wm="whitespace";function Sq(t,e){return t in e||(e[t]=[]),e[t]}function va(t,e,n){e[J0]&&(e[Fc]=!0,e[Oc]=!0),e[X0]&&(e[Fc]=!0,e[Q0]=!0),e[Fc]&&(e[Oc]=!0),e[Q0]&&(e[Oc]=!0),e[Oc]&&(e[ey]=!0),e[w4]&&(e[ey]=!0);for(const r in e){const i=Sq(r,n);i.indexOf(t)<0&&i.push(t)}}function Aq(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Sr(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Sr.groups={};Sr.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(t))return s}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let i=0;i<t.length;i++)this.tt(t[i],e,n,r)},tr(t,e,n,r){r=r||Sr.groups;let i;return e&&e.j?i=e:(i=new Sr(e),n&&r&&va(e,n,r)),this.jr.push([t,i]),i},ts(t,e,n,r){let i=this;const s=t.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(t[o]);return i.tt(t[s-1],e,n,r)},tt(t,e,n,r){r=r||Sr.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const s=e;let o,a=i.go(t);if(a?(o=new Sr,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Sr,s){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(Aq(o.t,r),n);va(s,l,r)}else n&&va(s,n,r);o.t=s}return i.j[t]=o,o}};const ct=(t,e,n,r,i)=>t.ta(e,n,r,i),Vt=(t,e,n,r,i)=>t.tr(e,n,r,i),KE=(t,e,n,r,i)=>t.ts(e,n,r,i),Ae=(t,e,n,r,i)=>t.tt(e,n,r,i),ds="WORD",ty="UWORD",v4="ASCIINUMERICAL",E4="ALPHANUMERICAL",bu="LOCALHOST",ny="TLD",ry="UTLD",Hf="SCHEME",ul="SLASH_SCHEME",l1="NUM",iy="WS",c1="NL",jc="OPENBRACE",qc="CLOSEBRACE",Nh="OPENBRACKET",Lh="CLOSEBRACKET",Rh="OPENPAREN",Ph="CLOSEPAREN",Dh="OPENANGLEBRACKET",Bh="CLOSEANGLEBRACKET",Hh="FULLWIDTHLEFTPAREN",Uh="FULLWIDTHRIGHTPAREN",zh="LEFTCORNERBRACKET",Fh="RIGHTCORNERBRACKET",jh="LEFTWHITECORNERBRACKET",qh="RIGHTWHITECORNERBRACKET",Vh="FULLWIDTHLESSTHAN",Wh="FULLWIDTHGREATERTHAN",Kh="AMPERSAND",Gh="APOSTROPHE",Zh="ASTERISK",wo="AT",Yh="BACKSLASH",Jh="BACKTICK",Xh="CARET",So="COLON",u1="COMMA",Qh="DOLLAR",Li="DOT",ed="EQUALS",f1="EXCLAMATION",Gr="HYPHEN",Vc="PERCENT",td="PIPE",nd="PLUS",rd="POUND",Wc="QUERY",h1="QUOTE",x4="FULLWIDTHMIDDLEDOT",d1="SEMI",Ri="SLASH",Kc="TILDE",id="UNDERSCORE",S4="EMOJI",sd="SYM";var A4=Object.freeze({__proto__:null,ALPHANUMERICAL:E4,AMPERSAND:Kh,APOSTROPHE:Gh,ASCIINUMERICAL:v4,ASTERISK:Zh,AT:wo,BACKSLASH:Yh,BACKTICK:Jh,CARET:Xh,CLOSEANGLEBRACKET:Bh,CLOSEBRACE:qc,CLOSEBRACKET:Lh,CLOSEPAREN:Ph,COLON:So,COMMA:u1,DOLLAR:Qh,DOT:Li,EMOJI:S4,EQUALS:ed,EXCLAMATION:f1,FULLWIDTHGREATERTHAN:Wh,FULLWIDTHLEFTPAREN:Hh,FULLWIDTHLESSTHAN:Vh,FULLWIDTHMIDDLEDOT:x4,FULLWIDTHRIGHTPAREN:Uh,HYPHEN:Gr,LEFTCORNERBRACKET:zh,LEFTWHITECORNERBRACKET:jh,LOCALHOST:bu,NL:c1,NUM:l1,OPENANGLEBRACKET:Dh,OPENBRACE:jc,OPENBRACKET:Nh,OPENPAREN:Rh,PERCENT:Vc,PIPE:td,PLUS:nd,POUND:rd,QUERY:Wc,QUOTE:h1,RIGHTCORNERBRACKET:Fh,RIGHTWHITECORNERBRACKET:qh,SCHEME:Hf,SEMI:d1,SLASH:Ri,SLASH_SCHEME:ul,SYM:sd,TILDE:Kc,TLD:ny,UNDERSCORE:id,UTLD:ry,UWORD:ty,WORD:ds,WS:iy});const fs=/[a-z]/,xc=new RegExp("\\p{L}","u"),vm=new RegExp("\\p{Emoji}","u"),hs=/\d/,Em=/\s/,GE="\r",xm=`
`,kq="️",_q="‍",Sm="￼";let yf=null,bf=null;function Cq(t=[]){const e={};Sr.groups=e;const n=new Sr;yf==null&&(yf=ZE(wq)),bf==null&&(bf=ZE(vq)),Ae(n,"'",Gh),Ae(n,"{",jc),Ae(n,"}",qc),Ae(n,"[",Nh),Ae(n,"]",Lh),Ae(n,"(",Rh),Ae(n,")",Ph),Ae(n,"<",Dh),Ae(n,">",Bh),Ae(n,"（",Hh),Ae(n,"）",Uh),Ae(n,"「",zh),Ae(n,"」",Fh),Ae(n,"『",jh),Ae(n,"』",qh),Ae(n,"＜",Vh),Ae(n,"＞",Wh),Ae(n,"&",Kh),Ae(n,"*",Zh),Ae(n,"@",wo),Ae(n,"`",Jh),Ae(n,"^",Xh),Ae(n,":",So),Ae(n,",",u1),Ae(n,"$",Qh),Ae(n,".",Li),Ae(n,"=",ed),Ae(n,"!",f1),Ae(n,"-",Gr),Ae(n,"%",Vc),Ae(n,"|",td),Ae(n,"+",nd),Ae(n,"#",rd),Ae(n,"?",Wc),Ae(n,'"',h1),Ae(n,"/",Ri),Ae(n,";",d1),Ae(n,"~",Kc),Ae(n,"_",id),Ae(n,"\\",Yh),Ae(n,"・",x4);const r=Vt(n,hs,l1,{[J0]:!0});Vt(r,hs,r);const i=Vt(r,fs,v4,{[Fc]:!0}),s=Vt(r,xc,E4,{[Oc]:!0}),o=Vt(n,fs,ds,{[X0]:!0});Vt(o,hs,i),Vt(o,fs,o),Vt(i,hs,i),Vt(i,fs,i);const a=Vt(n,xc,ty,{[Q0]:!0});Vt(a,fs),Vt(a,hs,s),Vt(a,xc,a),Vt(s,hs,s),Vt(s,fs),Vt(s,xc,s);const l=Ae(n,xm,c1,{[wm]:!0}),c=Ae(n,GE,iy,{[wm]:!0}),u=Vt(n,Em,iy,{[wm]:!0});Ae(n,Sm,u),Ae(c,xm,l),Ae(c,Sm,u),Vt(c,Em,u),Ae(u,GE),Ae(u,xm),Vt(u,Em,u),Ae(u,Sm,u);const f=Vt(n,vm,S4,{[w4]:!0});Ae(f,"#"),Vt(f,vm,f),Ae(f,kq,f);const h=Ae(f,_q);Ae(h,"#"),Vt(h,vm,f);const d=[[fs,o],[hs,i]],p=[[fs,null],[xc,a],[hs,s]];for(let g=0;g<yf.length;g++)lo(n,yf[g],ny,ds,d);for(let g=0;g<bf.length;g++)lo(n,bf[g],ry,ty,p);va(ny,{tld:!0,ascii:!0},e),va(ry,{utld:!0,alpha:!0},e),lo(n,"file",Hf,ds,d),lo(n,"mailto",Hf,ds,d),lo(n,"http",ul,ds,d),lo(n,"https",ul,ds,d),lo(n,"ftp",ul,ds,d),lo(n,"ftps",ul,ds,d),va(Hf,{scheme:!0,ascii:!0},e),va(ul,{slashscheme:!0,ascii:!0},e),t=t.sort((g,b)=>g[0]>b[0]?1:-1);for(let g=0;g<t.length;g++){const b=t[g][0],x=t[g][1]?{[Eq]:!0}:{[xq]:!0};b.indexOf("-")>=0?x[ey]=!0:fs.test(b)?hs.test(b)?x[Fc]=!0:x[X0]=!0:x[J0]=!0,KE(n,b,b,x)}return KE(n,"localhost",bu,{ascii:!0}),n.jd=new Sr(sd),{start:n,tokens:Object.assign({groups:e},A4)}}function k4(t,e){const n=Tq(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,i=[];let s=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,f=-1,h=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(f=0,h=0,u=a):f>=0&&(f+=n[o].length,h++),c+=n[o].length,s+=n[o].length,o++;s-=f,o-=h,c-=f,i.push({t:u.t,v:e.slice(s-c,s),s:s-c,e:s})}return i}function Tq(t){const e=[],n=t.length;let r=0;for(;r<n;){let i=t.charCodeAt(r),s,o=i<55296||i>56319||r+1===n||(s=t.charCodeAt(r+1))<56320||s>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function lo(t,e,n,r,i){let s;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?s=t.j[l]:(s=new Sr(r),s.jr=i.slice(),t.j[l]=s),t=s}return s=new Sr(n),s.jr=i.slice(),t.j[e[o-1]]=s,s}function ZE(t){const e=[],n=[];let r=0,i="0123456789";for(;r<t.length;){let s=0;for(;i.indexOf(t[r+s])>=0;)s++;if(s>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+s),10);o>0;o--)n.pop();r+=s}else n.push(t[r]),r++}return e}const wu={defaultProtocol:"http",events:null,format:YE,formatHref:YE,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function p1(t,e=null){let n=Object.assign({},wu);t&&(n=Object.assign(n,t instanceof p1?t.o:t));const r=n.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=i}p1.prototype={o:wu,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:wu[t],typeof i=="function"&&r&&(i=i(e,n))):typeof i=="function"&&r&&(i=i(e,n.t,n)),i)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function YE(t){return t}function _4(t,e){this.t="token",this.v=t,this.tk=e}_4.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"…":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=wu.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),i=t.get("tagName",n,e),s=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),f=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:i,attributes:o,content:s,eventListeners:f}}};function gp(t,e){class n extends _4{constructor(i,s){super(i,s),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const JE=gp("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),XE=gp("text"),Iq=gp("nl"),wf=gp("url",{isLink:!0,toHref(t=wu.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==bu&&t[1].t===So}}),Wr=t=>new Sr(t);function Oq({groups:t}){const e=t.domain.concat([Kh,Zh,wo,Yh,Jh,Xh,Qh,ed,Gr,l1,Vc,td,nd,rd,Ri,sd,Kc,id]),n=[Gh,So,u1,Li,f1,Vc,Wc,h1,d1,Dh,Bh,jc,qc,Lh,Nh,Rh,Ph,Hh,Uh,zh,Fh,jh,qh,Vh,Wh],r=[Kh,Gh,Zh,Yh,Jh,Xh,Qh,ed,Gr,jc,qc,Vc,td,nd,rd,Wc,Ri,sd,Kc,id],i=Wr(),s=Ae(i,Kc);ct(s,r,s),ct(s,t.domain,s);const o=Wr(),a=Wr(),l=Wr();ct(i,t.domain,o),ct(i,t.scheme,a),ct(i,t.slashscheme,l),ct(o,r,s),ct(o,t.domain,o);const c=Ae(o,wo);Ae(s,wo,c),Ae(a,wo,c),Ae(l,wo,c);const u=Ae(s,Li);ct(u,r,s),ct(u,t.domain,s);const f=Wr();ct(c,t.domain,f),ct(f,t.domain,f);const h=Ae(f,Li);ct(h,t.domain,f);const d=Wr(JE);ct(h,t.tld,d),ct(h,t.utld,d),Ae(c,bu,d);const p=Ae(f,Gr);Ae(p,Gr,p),ct(p,t.domain,f),ct(d,t.domain,f),Ae(d,Li,h),Ae(d,Gr,p);const g=Ae(d,So);ct(g,t.numeric,JE);const b=Ae(o,Gr),w=Ae(o,Li);Ae(b,Gr,b),ct(b,t.domain,o),ct(w,r,s),ct(w,t.domain,o);const x=Wr(wf);ct(w,t.tld,x),ct(w,t.utld,x),ct(x,t.domain,o),ct(x,r,s),Ae(x,Li,w),Ae(x,Gr,b),Ae(x,wo,c);const T=Ae(x,So),M=Wr(wf);ct(T,t.numeric,M);const O=Wr(wf),_=Wr();ct(O,e,O),ct(O,n,_),ct(_,e,O),ct(_,n,_),Ae(x,Ri,O),Ae(M,Ri,O);const L=Ae(a,So),A=Ae(l,So),E=Ae(A,Ri),S=Ae(E,Ri);ct(a,t.domain,o),Ae(a,Li,w),Ae(a,Gr,b),ct(l,t.domain,o),Ae(l,Li,w),Ae(l,Gr,b),ct(L,t.domain,O),Ae(L,Ri,O),Ae(L,Wc,O),ct(S,t.domain,O),ct(S,e,O),Ae(S,Ri,O);const k=[[jc,qc],[Nh,Lh],[Rh,Ph],[Dh,Bh],[Hh,Uh],[zh,Fh],[jh,qh],[Vh,Wh]];for(let P=0;P<k.length;P++){const[D,H]=k[P],N=Ae(O,D);Ae(_,D,N),Ae(N,H,O);const I=Wr(wf);ct(N,e,I);const $=Wr();ct(N,n),ct(I,e,I),ct(I,n,$),ct($,e,I),ct($,n,$),Ae(I,H,O),Ae($,H,O)}return Ae(i,bu,x),Ae(i,c1,Iq),{start:i,tokens:A4}}function $q(t,e,n){let r=n.length,i=0,s=[],o=[];for(;i<r;){let a=t,l=null,c=null,u=0,f=null,h=-1;for(;i<r&&!(l=a.go(n[i].t));)o.push(n[i++]);for(;i<r&&(c=l||a.go(n[i].t));)l=null,a=c,a.accepts()?(h=0,f=a):h>=0&&h++,i++,u++;if(h<0)i-=u,i<r&&(o.push(n[i]),i++);else{o.length>0&&(s.push(Am(XE,e,o)),o=[]),i-=h,u-=h;const d=f.t,p=n.slice(i-u,i);s.push(Am(d,e,p))}}return o.length>0&&s.push(Am(XE,e,o)),s}function Am(t,e,n){const r=n[0].s,i=n[n.length-1].e,s=e.slice(r,i);return new t(s,n)}const Mq=typeof console<"u"&&console&&console.warn||(()=>{}),Nq="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Pt={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Lq(){return Sr.groups={},Pt.scanner=null,Pt.parser=null,Pt.tokenQueue=[],Pt.pluginQueue=[],Pt.customSchemes=[],Pt.initialized=!1,Pt}function QE(t,e=!1){if(Pt.initialized&&Mq(`linkifyjs: already initialized - will not register custom scheme "${t}" ${Nq}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Pt.customSchemes.push([t,e])}function Rq(){Pt.scanner=Cq(Pt.customSchemes);for(let t=0;t<Pt.tokenQueue.length;t++)Pt.tokenQueue[t][1]({scanner:Pt.scanner});Pt.parser=Oq(Pt.scanner.tokens);for(let t=0;t<Pt.pluginQueue.length;t++)Pt.pluginQueue[t][1]({scanner:Pt.scanner,parser:Pt.parser});return Pt.initialized=!0,Pt}function g1(t){return Pt.initialized||Rq(),$q(Pt.parser.start,t,k4(Pt.scanner.start,t))}g1.scan=k4;function C4(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new p1(n),i=g1(t),s=[];for(let o=0;o<i.length;o++){const a=i[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&s.push(a.toFormattedObject(r))}return s}const m1="[\0-   ᠎ -\u2029 　]",Pq=new RegExp(m1),Dq=new RegExp(`${m1}$`),Bq=new RegExp(m1,"g");function Hq(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function Uq(t){return new Dt({key:new on("autolink"),appendTransaction:(e,n,r)=>{const i=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=r,a=fF(n.doc,[...e]);if(wF(a).forEach(({newRange:c})=>{const u=dF(r.doc,c,d=>d.isTextblock);let f,h;if(u.length>1)f=u[0],h=r.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ");else if(u.length){const d=r.doc.textBetween(c.from,c.to," "," ");if(!Dq.test(d))return;f=u[0],h=r.doc.textBetween(f.pos,c.to,void 0," ")}if(f&&h){const d=h.split(Pq).filter(Boolean);if(d.length<=0)return!1;const p=d[d.length-1],g=f.pos+h.lastIndexOf(p);if(!p)return!1;const b=g1(p).map(w=>w.toObject(t.defaultProtocol));if(!Hq(b))return!1;b.filter(w=>w.isLink).map(w=>({...w,from:g+w.start+1,to:g+w.end+1})).filter(w=>r.schema.marks.code?!r.doc.rangeHasMark(w.from,w.to,r.schema.marks.code):!0).filter(w=>t.validate(w.value)).filter(w=>t.shouldAutoLink(w.value)).forEach(w=>{o1(w.from,w.to,r.doc).some(x=>x.mark.type===t.type)||o.addMark(w.from,w.to,t.type.create({href:w.href}))})}}),!!o.steps.length)return o}})}function zq(t){return new Dt({key:new on("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,s;if(r.button!==0||!e.editable)return!1;let o=r.target;const a=[];for(;o.nodeName!=="DIV";)a.push(o),o=o.parentNode;if(!a.find(h=>h.nodeName==="A"))return!1;const l=c4(e.state,t.type.name),c=r.target,u=(i=c?.href)!==null&&i!==void 0?i:l.href,f=(s=c?.target)!==null&&s!==void 0?s:l.target;return c&&u?(window.open(u,f),!0):!1}}})}function Fq(t){return new Dt({key:new on("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:i}=e,{selection:s}=i,{empty:o}=s;if(o)return!1;let a="";r.content.forEach(c=>{a+=c.textContent});const l=C4(a,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:t.editor.commands.setMark(t.type,{href:l.href})}}})}function sa(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const i=typeof r=="string"?r:r.scheme;i&&n.push(i)}),!t||t.replace(Bq,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const jq=Ds.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){QE(t);return}QE(t.scheme,t.optionalSlashes)})},onDestroy(){Lq()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!sa(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!sa(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!sa(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",_n(this.options.HTMLAttributes,t),0]:["a",_n(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!sa(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!sa(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ua({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,i=C4(t).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:o=>!!sa(o,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(s=>e.push({text:s.value,data:{href:s.href},index:s.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(Uq({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:i=>!!sa(i,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(zq({type:this.type})),this.options.linkOnPaste&&t.push(Fq({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),qq=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Vq=ai.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",_n(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[u4({find:qq,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),Wq=an.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Dt({key:new on("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,i=[];if(!n)return null;const s=this.editor.isEmpty;return t.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&pp(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];s&&u.push(this.options.emptyEditorClass);const f=or.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});i.push(f)}return this.options.includeChildren}),zt.create(t,i)}}})]}});function Kq(t,e,n){if(F(e)){t.preventDefault();return}const r=document.querySelector(".tiptap-editor");r&&r.blur(),document.body.focus();const i=new CustomEvent("image-fullscreen-request",{detail:{src:n.node.attrs.src,alt:n.node.attrs.alt||"Image"},bubbles:!0,cancelable:!0});window.dispatchEvent(i),t.preventDefault(),t.stopPropagation()}function ex(t){t.preventDefault()}var Gq=Qe('<button type="button" class="editor-image-button svelte-s5cweq" tabindex="0" draggable="true"><img class="editor-image svelte-s5cweq" draggable="false"/></button>');function Zq(t,e){jn(e,!0);let n=He(!1),r={x:0,y:0},i=null,s=null,o=null;function a(){const x=new CustomEvent("touch-image-drag-start",{detail:{nodePos:e.getPos()},bubbles:!0,cancelable:!0});window.dispatchEvent(x),document.dispatchEvent(new CustomEvent("touch-image-drag-start",{detail:x.detail}))}function l(){const x=new CustomEvent("touch-image-drop",{detail:{nodeData:{type:"image",attrs:e.node.attrs,pos:e.getPos()},dropX:0,dropY:0,target:null,dropPosition:null},bubbles:!0,cancelable:!0});window.dispatchEvent(x),document.dispatchEvent(new CustomEvent("touch-image-drop",{detail:x.detail}))}function c(x){x.dataTransfer&&(x.dataTransfer.setData("application/x-tiptap-node",JSON.stringify({type:"image",attrs:e.node.attrs,pos:e.getPos()})),x.dataTransfer.effectAllowed="move",ye(n,!0),a())}function u(){ye(n,!1),w(),l()}function f(x){if(x.touches.length!==1)return;const T=x.touches[0];r={x:T.clientX,y:T.clientY},o=x.currentTarget,s=setTimeout(()=>{ye(n,!0),a(),o&&g(o,T.clientX,T.clientY)},DB)}function h(x){if(x.touches.length!==1){s&&(clearTimeout(s),s=null);return}const T=x.touches[0];if(!F(n)&&s){const O=T.clientX-r.x,_=T.clientY-r.y;if(O*O+_*_>x2*x2){clearTimeout(s),s=null,o=null;return}}if(!F(n))return;x.preventDefault(),b(T.clientX,T.clientY),d(T.clientX,T.clientY);const M=new CustomEvent("touch-image-drag-move",{detail:{touchX:T.clientX,touchY:T.clientY,nodePos:e.getPos()},bubbles:!0,cancelable:!0});window.dispatchEvent(M),document.dispatchEvent(new CustomEvent("touch-image-drag-move",{detail:M.detail}))}function d(x,T){document.querySelectorAll(".drop-zone-indicator").forEach(O=>{O.classList.remove("drop-zone-hover")});const M=document.elementFromPoint(x,T);if(M){const O=M.closest(".drop-zone-indicator");O&&O.classList.add("drop-zone-hover")}}function p(x){if(s&&(clearTimeout(s),s=null,o=null,!F(n))){const O=document.querySelector(".tiptap-editor");O&&O.blur(),document.body.focus()}if(!F(n))return;x.preventDefault();const T=x.changedTouches[0],M=document.elementFromPoint(T.clientX,T.clientY);if(M){const O=M.closest(".drop-zone-indicator");let _=null;if(O){const A=O.getAttribute("data-drop-pos");_=A?parseInt(A,10):null}const L=new CustomEvent("touch-image-drop",{detail:{nodeData:{type:"image",attrs:e.node.attrs,pos:e.getPos()},dropX:T.clientX,dropY:T.clientY,target:M,dropPosition:_},bubbles:!0,cancelable:!0});window.dispatchEvent(L),document.dispatchEvent(new CustomEvent("touch-image-drop",{detail:L.detail}))}ye(n,!1),w()}function g(x,T,M){const O=x.querySelector("img");O&&(i=O.cloneNode(!0),i.classList.add("image-drag-preview"),b(T,M),document.body.appendChild(i),requestAnimationFrame(()=>{i&&(i.style.transform="scale(0.9) rotate(0deg)")}))}function b(x,T){i&&(i.style.left=`${x-70}px`,i.style.top=`${T-70}px`)}function w(){i&&i.parentNode&&(i.parentNode.removeChild(i),i=null)}_u(()=>{s&&(clearTimeout(s),s=null),w()}),uj(t,{children:(x,T)=>{var M=Gq();M.__click=[Kq,n,e],M.__touchstart=f,M.__touchmove=h,M.__touchend=p,M.__contextmenu=[ex];var O=Ie(M);O.__contextmenu=[ex],ut(()=>{nn(M,"data-selected",e.selected),nn(M,"data-dragging",F(n)),nn(M,"aria-label",e.node.attrs.alt||"Image"),nn(O,"src",e.node.attrs.src),nn(O,"alt",e.node.attrs.alt||"")}),Ts("dragstart",M,c),Ts("dragend",M,u),$e(x,M)},$$slots:{default:!0}}),qn()}zs(["click","touchstart","touchmove","touchend","contextmenu"]);function T4(t){if(t.doc.childCount===1){const e=t.doc.firstChild;return e?.type.name==="paragraph"&&e.content.size===0}return t.doc.childCount===0}function Yq(t,e){return t.type.name==="paragraph"&&t.content.size===e&&t.textContent.trim().length===e}function Jq(t,e){if(!t)return;const n=Array.isArray(e)?e:e.split(`
`).map(u=>u.trim()).filter(Boolean);if(n.length===0)return;t.chain().focus().run();const{state:r,dispatch:i}=t.view,{tr:s,schema:o}=r;let a=s,l=r.selection.from;const c=T4(r);n.forEach((u,f)=>{const h=typeof u=="string"?u.trim():"",d=y1(h);if(d){const p=o.nodes.image.create({src:d,alt:"Uploaded image"});f===0&&c?(a=a.replaceWith(0,r.doc.content.size,p),l=p.nodeSize):(a=a.insert(l,p),l+=p.nodeSize)}}),i(a)}function Uf(t){if(!t)return"";const e=t.state.doc,n=[];return e.descendants(r=>{if(r.type.name==="paragraph"){const i=r.textContent;i.trim()&&n.push(i)}else if(r.type.name==="image"){const i=r.attrs.src;i&&n.push(i)}}),n.join(`
`)}function km(t,e,n){const{tr:r,schema:i}=t.state;let s=r;const o=e.pos;if(n===o)return!0;const a=i.nodes.image.create(e.attrs);try{if(n<o)s=s.insert(n,a),s=s.delete(o+1,o+2);else if(n>o+1)s=s.delete(o,o+1),s=s.insert(n-1,a);else return!0;return t.dispatch(s),!0}catch(l){return console.error("Error moving image:",l),!1}}function tx(t){t.dispatch(t.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null}))}function I4(t){try{const e=encodeURI(t.trim()),n=new URL(e);return wk.includes(n.protocol)?n.href:null}catch{return null}}function y1(t){try{const e=encodeURI(t.trim()),n=new URL(e);if(!wk.includes(n.protocol))return null;const r=n.pathname.toLowerCase();return PB.some(i=>r.endsWith(i))?n.href:null}catch{return null}}function Xq(t){return!t||/[\s\n\u3000]/.test(t)}function Qq(t){let e=t;const n=/([.,;:!?）】」』〉》】\]}>）]){2,}$/,r=e.match(n);return r&&(e=e.slice(0,-r[0].length)),{cleanUrl:e,actualLength:e.length}}function _m(t){const e=[];return t.descendants((n,r)=>{if(!n.isText||!n.text)return;const i=n.text,s=new RegExp(C0.source,"g");let o;for(;(o=s.exec(i))!==null;){const a=o[0].indexOf("#");if(a===-1)continue;const l=r+o.index+a,c=l+1+o[1].length;e.push(or.inline(l,c,{class:"hashtag"}))}}),zt.create(t,e)}function eV(t){const e=t.schema.marks.link,n=t.schema.nodes.image;if(!e)return null;let r=null;return t.doc.descendants((i,s)=>{if(!i.isText||!i.text)return;const o=i.text;(i.marks?.some(u=>u.type===e)??!1)&&(r=r||t.tr,r.removeMark(s,s+o.length,e));const l=/https?:\/\/[^\s\u3000]+/gi;let c;for(;(c=l.exec(o))!==null;){if(typeof c.index!="number")continue;const u=c.index,f=c[0],h=u>0?o[u-1]:void 0;if(!Xq(h))continue;const{cleanUrl:d,actualLength:p}=Qq(f),g=u+p,b=y1(d);if(b&&n){r=r||t.tr;const x=s+u,T=s+g,M=t.doc.resolve(x),O=M.parent,_=O.type.name==="paragraph"&&O.textContent.trim().length===0,L=Yq(O,T-x),A=T4(t),E=n.create({src:b,alt:"Image"});if(_||L){const S=M.depth,k=M.start(S),P=M.end(S);A||t.doc.childCount===1&&L?r=r.delete(0,t.doc.content.size).insert(0,E):r=r.replaceWith(k,P,E)}else r=r.replaceWith(x,T,E);break}if(/^https?:\/\/[a-zA-Z0-9]/.test(d)&&d.length>8){const T=I4(d)||d;r=r||t.tr;const M=s+u,O=s+g,_=e.create({href:T});r.addMark(M,O,_)}}}),r!==null&&r.docChanged?r:null}const tV=an.create({name:"contentTracking",addProseMirrorPlugins(){return[new Dt({key:new on("content-decoration-validation"),state:{init:(t,{doc:e})=>_m(e),apply(t,e){return _m(t.doc)}},props:{decorations(t){return _m(t.doc)}},appendTransaction:(t,e,n)=>{if(t.some(r=>r.docChanged))return eV(n)}}),new Dt({key:new on("content-update-tracker"),state:{init:()=>null,apply:t=>(t.docChanged&&(this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout),this.storage.updateTimeout=setTimeout(()=>{const e=t.doc.textContent;O4(e),window.dispatchEvent(new CustomEvent("editor-content-changed",{detail:{plainText:e}}))},300)),null)}})]},addStorage(){return{updateTimeout:null}},onDestroy(){this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout)}});function nx(t){return t.split(/[\n ]+/).map(e=>e.trim()).filter(Boolean).map(e=>y1(e)).filter(e=>typeof e=="string"&&!!e)}function nV(t,e){const n=e.parent;return n.type.name==="paragraph"&&n.textContent.trim().length===0}function rV(t){const{selection:e}=t,n=t.doc.resolve(e.from);if(nV(e,n)){const r=n.depth,i=n.start(r),s=n.end(r);return{start:i,end:s}}return null}function rx(t,e){return t.map(n=>e.nodes.image.create({src:n,alt:"Pasted image"}))}function ix(t){const e=t.doc;if(!e)return t;const n=[];return e.descendants((r,i)=>{if(r.type.name==="paragraph"&&r.textContent.trim().length===0){if(e.childCount===1&&e.firstChild===r)return;let s=!1;r.descendants(o=>o.type&&o.type.name==="image"?(s=!0,!1):!0),s||n.push([i,i+r.nodeSize])}}),n.sort((r,i)=>i[0]-r[0]),n.forEach(([r,i])=>{t=t.delete(r,i)}),t}const iV=an.create({name:"imagePaste",addProseMirrorPlugins(){return[new Dt({key:new on("image-paste"),props:{handlePaste:(t,e)=>{const n=e.clipboardData?.getData("text/plain")||"",r=nx(n);if(r.length>0){e.preventDefault();const{state:i,dispatch:s}=t,{tr:o,selection:a,schema:l}=i,c=rx(r,l);let u=o;const f=rV(i);if(f&&c.length>0){u=u.replaceWith(f.start,f.end,c[0]);let h=f.start+c[0].nodeSize;for(let d=1;d<c.length;d++)u=u.insert(h,c[d]),h+=c[d].nodeSize}else{let h=a.from;c.forEach((d,p)=>{u=u.insert(h,d),h+=d.nodeSize})}return u=ix(u),s(u),!0}return!1},handleTextInput:(t,e,n,r)=>{if(r.includes(`
`)||r.length>20){const i=nx(r);if(i.length>0){const{state:s,dispatch:o}=t,{tr:a,schema:l}=s,c=rx(i,l);let u=a;u=u.delete(e,n);let f=e;return c.forEach(h=>{u=u.insert(f,h),f+=h.nodeSize}),u=ix(u),o(u),!0}}return!1}}})]}}),sV=an.create({name:"imageDragDrop",addProseMirrorPlugins(){const t=new on("image-drag-drop"),e=new on("drop-zone-indicator");return[new Dt({key:t,state:{init:()=>({isDragging:!1,draggedNodePos:null,autoScrollInterval:null}),apply:(n,r)=>{const i=n.getMeta("imageDrag");return i?i.isDragging===!1&&r.autoScrollInterval?(clearInterval(r.autoScrollInterval),{...r,...i,autoScrollInterval:null}):{...r,...i}:r}},props:{handleDrop:(n,r,i,s)=>{const o=r.dataTransfer?.getData("application/x-tiptap-node");if(!s&&o)try{const a=JSON.parse(o);if(a.type==="image"){r.preventDefault();const l=n.posAtCoords({left:r.clientX,top:r.clientY});if(l&&typeof a.pos=="number")return tx(n),km(n,a,l.pos),!0}}catch(a){console.warn("Failed to parse drag data:",a)}return!1}},view:n=>{let r=null;const i=(c,u)=>{r&&(cancelAnimationFrame(r),r=null);const f=n.dom;if(!f)return;const h=f.getBoundingClientRect(),d=S2;let p=0;c==="up"?p=u-h.top:p=h.bottom-u;const g=Math.max(0,Math.min(1,p/d)),b=A2+(BB-A2)*(1-g),w=()=>{const x=f.scrollTop,T=f.scrollHeight,M=f.clientHeight;if(c==="up"&&x>0){const O=Math.max(0,x-b);f.scrollTop=O,O>0&&(r=requestAnimationFrame(w))}else if(c==="down"&&x<T-M){const O=Math.min(T-M,x+b);f.scrollTop=O,O<T-M&&(r=requestAnimationFrame(w))}};r=requestAnimationFrame(w)},s=()=>{r&&(cancelAnimationFrame(r),r=null)},o=c=>{const{nodeData:u,dropPosition:f,dropX:h,dropY:d}=c.detail;if(s(),n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null})),u&&u.type==="image"){let p;typeof f=="number"?p=f:p=n.posAtCoords({left:h,top:d})?.pos||u.pos,typeof u.pos=="number"&&km(n,u,p)}},a=c=>{const{nodePos:u}=c.detail;n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!0,draggedNodePos:u}))},l=c=>{const{touchY:u}=c.detail;if(typeof u!="number"||!t.getState(n.state)?.isDragging)return;const h=n.dom;if(!h)return;const d=h.getBoundingClientRect(),p=S2;u<d.top+p?i("up",u):u>d.bottom-p?i("down",u):s()};return window.addEventListener("touch-image-drop",o),window.addEventListener("touch-image-drag-start",a),window.addEventListener("touch-image-drag-move",l),{destroy(){s(),window.removeEventListener("touch-image-drop",o),window.removeEventListener("touch-image-drag-start",a),window.removeEventListener("touch-image-drag-move",l)}}}}),new Dt({key:e,state:{init(){return zt.empty},apply(n,r,i,s){const o=t.getState(s);if(!o?.isDragging)return zt.empty;const a=[],l=s.doc;let c=!1;if(typeof o.draggedNodePos=="number"){const u=l.firstChild;u&&u.type.name==="image"&&u.attrs&&o.draggedNodePos===0&&(c=!0)}return c||a.push(or.widget(0,()=>{const u=document.createElement("div");return u.className="drop-zone-indicator drop-zone-top",u.setAttribute("data-drop-pos","0"),u.innerHTML='<div class="drop-zone-bar"></div>',u},{side:-1})),l.descendants((u,f)=>{if(u.type.name==="paragraph"||u.type.name==="image"){const h=f+u.nodeSize;if(typeof o.draggedNodePos=="number"&&h===o.draggedNodePos)return;o.draggedNodePos!==f&&a.push(or.widget(h,()=>{const d=document.createElement("div");return d.className="drop-zone-indicator drop-zone-between",d.setAttribute("data-drop-pos",h.toString()),d.innerHTML='<div class="drop-zone-bar"></div>',d},{side:1}))}}),zt.create(l,a)}},props:{decorations(n){return this.getState(n)}}})]},addStorage(){return{moveImageNode:(t,e,n)=>(tx(t),km(t,e,n))}}}),oV=an.create({name:"smartBackspace",addProseMirrorPlugins(){return[new Dt({key:new on("smart-backspace"),props:{handleKeyDown(t,e){if(e.key!=="Backspace")return!1;const{state:n}=t,{selection:r,doc:i}=n;if(r.empty&&r.from===1){const s=i.firstChild,o=i.childCount>1?i.child(1):null;if(s&&s.type.name==="paragraph"&&s.content.size===0&&o&&o.type.name==="image")return t.dispatch(n.tr.delete(0,s.nodeSize)),!0}return!1}}})]}}),aV=an.create({name:"gapCursorNewline",addProseMirrorPlugins(){return[new Dt({key:new on("gap-cursor-newline"),props:{handleKeyDown(t,e){if(e.key!=="Enter")return!1;const{state:n}=t,{selection:r,schema:i}=n;if(r.constructor.name==="GapCursor"){const l=i.nodes.paragraph.create(),c=n.tr.insert(r.from,l),u=r.from+1,f=c.doc.resolve(u),h=nt.near(f,1);return h&&c.setSelection(h),t.dispatch(c),!0}const s=n.doc.resolve(r.from),o=s.nodeBefore,a=s.nodeAfter;if(o&&o.type.name==="image"||a&&a.type.name==="image"){const l=i.nodes.paragraph.create(),c=n.tr.insert(r.from,l),u=r.from+1,f=c.doc.resolve(u),h=nt.near(f,1);if(h)return c.setSelection(h),t.dispatch(c),!0}return!1}}})]}}),zf=rn({content:"",hashtags:[],tags:[]});function lV(t){let e=Wq.configure({placeholder:t,emptyEditorClass:"is-editor-empty",showOnlyWhenEditable:!0,showOnlyCurrent:!1,includeChildren:!0});const n=nj({extensions:[bq.configure({paragraph:{HTMLAttributes:{class:"editor-paragraph"}}}),jq.configure({HTMLAttributes:{class:"preview-link",target:"_blank",rel:"noopener noreferrer"},autolink:!0,linkOnPaste:!0,validate:i=>!!I4(i)}),Vq.configure({HTMLAttributes:{class:"editor-image"},allowBase64:!1}).extend({addNodeView(){return aj(Zq)}}),tV.configure({onContentChanged:i=>{O4(i);const s=new CustomEvent("editor-content-changed",{detail:{plainText:i}});window.dispatchEvent(s)}}),iV,sV,oV,aV,e],content:{type:"doc",content:[{type:"paragraph"}]},editorProps:{attributes:{class:"tiptap-editor"},handleClickOn(i,s,o,a,l,c){let u=l.target;for(;u&&u!==i.dom;){if(u.tagName==="A"&&u.hasAttribute("href"))return l.ctrlKey||l.metaKey?!1:(l.preventDefault(),!0);u=u.parentElement}return!1}},onCreate({editor:i}){window.__currentEditor=i},onDestroy(){delete window.__currentEditor}}),r=i=>{const s=window.__currentEditor;if(s){const o=s.view.dom;o&&o.setAttribute("data-placeholder",i);const a=s.extensionManager.extensions.find(l=>l.name==="placeholder");a&&(a.options.placeholder=i,s.view.dispatch(s.state.tr.setMeta("forceUpdate",!0)))}};return n.updatePlaceholder=r,n}let sy=rn({value:""}),Gt=rn({content:"",canPost:!1,isUploading:!1,uploadErrorMessage:"",postStatus:{sending:!1,success:!1,error:!1,message:""},hasImage:!1});function cV(t,e){return!!t.trim()||e}function uV(t,e=!1){Gt.content=t,Gt.hasImage=e,Gt.canPost=cV(t,e)}function fl(t){Gt.postStatus=t}function Sc(t,e=""){Gt.isUploading=t,Gt.uploadErrorMessage=e}function fV(){Gt.content="",Gt.canPost=!1,Gt.uploadErrorMessage="",Gt.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1},Gt.hasImage=!1}function hV(){Gt.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1}}function sx(t){sy.value=t}function O4(t){const e=dV(t),n=e.map(r=>["t",r]);zf.content=t,zf.hashtags=e,zf.tags=n}function dV(t){const e=[];C0.lastIndex=0;let n;for(;(n=C0.exec(t))!==null;){const r=n[1];r&&r.trim()&&e.push(r.toLowerCase())}return e}let oy;function pV(t){oy=t}async function gV(){oy&&await oy()}class mV{rxNostr=null;constructor(e){e&&(this.rxNostr=e)}setRxNostr(e){this.rxNostr=e}validatePost(e){return e.trim()?this.rxNostr?gi.value.isAuthenticated?{valid:!0}:{valid:!1,error:"login_required"}:{valid:!1,error:"nostr_not_ready"}:{valid:!1,error:"empty_content"}}async buildEvent(e,n){const{hashtags:r}=zf,i=r.map(a=>["t",a]);let s=!0;try{const a=localStorage.getItem("clientTagEnabled");a!==null&&(s=a==="true")}catch{}s&&i.push(["client","eHagaki","31990:ec42c765418b3db9c85abff3a88f4a3bbe57535eebbdc54522041fa5328c0600:1754918316480","wss://relay.nostr.band"]);const o={kind:1,content:e,tags:i,created_at:Math.floor(Date.now()/1e3)};return n&&(o.pubkey=n),o}sendEvent(e,n){return this.rxNostr?new Promise(r=>{let i=!1,s=!1;const a=this.rxNostr.send(e,n?{signer:n}:void 0).subscribe({next:l=>{console.log(`リレー ${l.from} への送信結果:`,l.ok?"成功":"失敗"),l.ok&&!i&&(s=!0,i=!0,a.unsubscribe(),r({success:!0}))},error:l=>{console.error("送信エラー:",l),i||(i=!0,a.unsubscribe(),r({success:!1,error:"post_error"}))},complete:()=>{!i&&!s&&(i=!0,a.unsubscribe(),r({success:!1,error:"post_error"}))}});setTimeout(()=>{i||(i=!0,a.unsubscribe(),r(s?{success:!0}:{success:!1,error:"post_error"}))},3e3)}):Promise.resolve({success:!1,error:"nostr_not_ready"})}async submitPost(e){const n=this.validatePost(e);if(!n.valid)return{success:!1,error:n.error};try{const r=gi.value;if(r.type==="nostr-login"&&Hi.isWindowNostrAvailable())try{const l=r.pubkey;if(!l)return{success:!1,error:"pubkey_not_found"};const c=await this.buildEvent(e,l),u=await window.nostr.signEvent(c);return console.log("署名済みイベント:",u),await this.sendEvent(u)}catch(l){return console.error("window.nostrでの投稿エラー:",l),{success:!1,error:"post_error"}}const s=Hi.getFromStore()||Hi.loadFromStorage();if(!s)return{success:!1,error:"key_not_found"};const o=await this.buildEvent(e),a=xA(s);return await this.sendEvent(o,a)}catch(r){return console.error("投稿エラー:",r),{success:!1,error:"post_error"}}}}function yV(t,e){return e.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}}))})),Object.freeze(t)}function $4(t,e){return new Promise((function(n,r){let i;return bV(t).then((function(s){try{return i=s,n(new Blob([e.slice(0,2),i,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}}),r)}))}const bV=t=>new Promise(((e,n)=>{const r=new FileReader;r.addEventListener("load",(({target:{result:i}})=>{const s=new DataView(i);let o=0;if(s.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=s.getUint16(o);if(a===65498)break;const l=s.getUint16(o+2);if(a===65505&&s.getUint32(o+4)===1165519206){const c=o+10;let u;switch(s.getUint16(c)){case 18761:u=!0;break;case 19789:u=!1;break;default:return n("TIFF header contains invalid endian")}if(s.getUint16(c+2,u)!==42)return n("TIFF header contains invalid version");const f=s.getUint32(c+4,u),h=c+f+2+12*s.getUint16(c+f,u);for(let d=c+f+2;d<h;d+=12)if(s.getUint16(d,u)==274){if(s.getUint16(d+2,u)!==3)return n("Orientation data type is invalid");if(s.getUint32(d+4,u)!==1)return n("Orientation data count is invalid");s.setUint16(d+8,1,u);break}return e(i.slice(o,o+2+l))}o+=2+l}return e(new Blob)})),r.readAsArrayBuffer(t)}));var od={},wV={get exports(){return od},set exports(t){od=t}};(function(t){var e,n,r={};wV.exports=r,r.parse=function(i,s){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,c={},u=new Uint8Array(i),f=u.length-4;a(u,f)!=101010256;)f--;l=f,l+=4;var h=o(u,l+=4);o(u,l+=2);var d=a(u,l+=2),p=a(u,l+=4);l+=4,l=p;for(var g=0;g<h;g++){a(u,l),l+=4,l+=4,l+=4,a(u,l+=4),d=a(u,l+=4);var b=a(u,l+=4),w=o(u,l+=4),x=o(u,l+2),T=o(u,l+4);l+=6;var M=a(u,l+=8);l+=4,l+=w+x+T,r._readLocal(u,M,c,d,b,s)}return c},r._readLocal=function(i,s,o,a,l,c){var u=r.bin.readUshort,f=r.bin.readUint;f(i,s),u(i,s+=4),u(i,s+=2);var h=u(i,s+=2);f(i,s+=2),f(i,s+=4),s+=4;var d=u(i,s+=8),p=u(i,s+=2);s+=2;var g=r.bin.readUTF8(i,s,d);if(s+=d,s+=p,c)o[g]={size:l,csize:a};else{var b=new Uint8Array(i.buffer,s);if(h==0)o[g]=new Uint8Array(b.buffer.slice(s,s+a));else{if(h!=8)throw"unknown compression method: "+h;var w=new Uint8Array(l);r.inflateRaw(b,w),o[g]=w}}},r.inflateRaw=function(i,s){return r.F.inflate(i,s)},r.inflate=function(i,s){return i[0],i[1],r.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-6),s)},r.deflate=function(i,s){s==null&&(s={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*i.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(i,a,o,s.level);var l=r.adler(i,0,i.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(i,s){s==null&&(s={level:6});var o=new Uint8Array(50+Math.floor(1.1*i.length)),a=r.F.deflateRaw(i,o,a,s.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(i,s){s==null&&(s=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,c={};for(var u in i){var f=!r._noNeed(u)&&!s,h=i[u],d=r.crc.crc(h,0,h.length);c[u]={cpr:f,usize:h.length,crc:d,file:f?r.deflateRaw(h):h}}for(var u in c)o+=c[u].file.length+30+46+2*r.bin.sizeUTF8(u);o+=22;var p=new Uint8Array(o),g=0,b=[];for(var u in c){var w=c[u];b.push(g),g=r._writeHeader(p,g,u,w,0)}var x=0,T=g;for(var u in c)w=c[u],b.push(g),g=r._writeHeader(p,g,u,w,1,b[x++]);var M=g-T;return a(p,g,101010256),g+=4,l(p,g+=4,x),l(p,g+=2,x),a(p,g+=2,M),a(p,g+=4,T),g+=4,g+=2,p.buffer},r._noNeed=function(i){var s=i.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(s)!=-1},r._writeHeader=function(i,s,o,a,l,c){var u=r.bin.writeUint,f=r.bin.writeUshort,h=a.file;return u(i,s,l==0?67324752:33639248),s+=4,l==1&&(s+=2),f(i,s,20),f(i,s+=2,0),f(i,s+=2,a.cpr?8:0),u(i,s+=2,0),u(i,s+=4,a.crc),u(i,s+=4,h.length),u(i,s+=4,a.usize),f(i,s+=4,r.bin.sizeUTF8(o)),f(i,s+=2,0),s+=2,l==1&&(s+=2,s+=2,u(i,s+=6,c),s+=4),s+=r.bin.writeUTF8(i,s,o),l==0&&(i.set(h,s),s+=h.length),s},r.crc={table:(function(){for(var i=new Uint32Array(256),s=0;s<256;s++){for(var o=s,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;i[s]=o}return i})(),update:function(i,s,o,a){for(var l=0;l<a;l++)i=r.crc.table[255&(i^s[o+l])]^i>>>8;return i},crc:function(i,s,o){return 4294967295^r.crc.update(4294967295,i,s,o)}},r.adler=function(i,s,o){for(var a=1,l=0,c=s,u=s+o;c<u;){for(var f=Math.min(c+5552,u);c<f;)l+=a+=i[c++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(i,s){return i[s]|i[s+1]<<8},writeUshort:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255},readUint:function(i,s){return 16777216*i[s+3]+(i[s+2]<<16|i[s+1]<<8|i[s])},writeUint:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255,i[s+2]=o>>16&255,i[s+3]=o>>24&255},readASCII:function(i,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(i[s+l]);return a},writeASCII:function(i,s,o){for(var a=0;a<o.length;a++)i[s+a]=o.charCodeAt(a)},pad:function(i){return i.length<2?"0"+i:i},readUTF8:function(i,s,o){for(var a,l="",c=0;c<o;c++)l+="%"+r.bin.pad(i[s+c].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(i,s,o)}return a},writeUTF8:function(i,s,o){for(var a=o.length,l=0,c=0;c<a;c++){var u=o.charCodeAt(c);if((4294967168&u)==0)i[s+l]=u,l++;else if((4294965248&u)==0)i[s+l]=192|u>>6,i[s+l+1]=128|u>>0&63,l+=2;else if((4294901760&u)==0)i[s+l]=224|u>>12,i[s+l+1]=128|u>>6&63,i[s+l+2]=128|u>>0&63,l+=3;else{if((4292870144&u)!=0)throw"e";i[s+l]=240|u>>18,i[s+l+1]=128|u>>12&63,i[s+l+2]=128|u>>6&63,i[s+l+3]=128|u>>0&63,l+=4}}return l},sizeUTF8:function(i){for(var s=i.length,o=0,a=0;a<s;a++){var l=i.charCodeAt(a);if((4294967168&l)==0)o++;else if((4294965248&l)==0)o+=2;else if((4294901760&l)==0)o+=3;else{if((4292870144&l)!=0)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(i,s,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],c=r.F.U,u=r.F._goodIndex;r.F._hash;var f=r.F._putsE,h=0,d=o<<3,p=0,g=i.length;if(a==0){for(;h<g;)f(s,d,h+(k=Math.min(65535,g-h))==g?1:0),d=r.F._copyExact(i,h,k,s,d+8),h+=k;return d>>>3}var b=c.lits,w=c.strt,x=c.prev,T=0,M=0,O=0,_=0,L=0,A=0;for(g>2&&(w[A=r.F._hash(i,0)]=0),h=0;h<g;h++){if(L=A,h+1<g-2){A=r.F._hash(i,h+1);var E=h+1&32767;x[E]=w[A],w[A]=E}if(p<=h){(T>14e3||M>26697)&&g-h>100&&(p<h&&(b[T]=h-p,T+=2,p=h),d=r.F._writeBlock(h==g-1||p==g?1:0,b,T,_,i,O,h-O,s,d),T=M=_=0,O=h);var S=0;h<g-2&&(S=r.F._bestMatch(i,h,x,L,Math.min(l[2],g-h),l[3]));var k=S>>>16,P=65535&S;if(S!=0){P=65535&S;var D=u(k=S>>>16,c.of0);c.lhst[257+D]++;var H=u(P,c.df0);c.dhst[H]++,_+=c.exb[D]+c.dxb[H],b[T]=k<<23|h-p,b[T+1]=P<<16|D<<8|H,T+=2,p=h+k}else c.lhst[i[h]]++;M++}}for(O==h&&i.length!=0||(p<h&&(b[T]=h-p,T+=2,p=h),d=r.F._writeBlock(1,b,T,_,i,O,h-O,s,d),T=0,M=0,T=M=_=0,O=h);(7&d)!=0;)d++;return d>>>3},r.F._bestMatch=function(i,s,o,a,l,c){var u=32767&s,f=o[u],h=u-f+32768&32767;if(f==u||a!=r.F._hash(i,s-h))return 0;for(var d=0,p=0,g=Math.min(32767,s);h<=g&&--c!=0&&f!=u;){if(d==0||i[s+d]==i[s+d-h]){var b=r.F._howLong(i,s,h);if(b>d){if(p=h,(d=b)>=l)break;h+2<b&&(b=h+2);for(var w=0,x=0;x<b-2;x++){var T=s-h+x+32768&32767,M=T-o[T]+32768&32767;M>w&&(w=M,f=T)}}}h+=(u=f)-(f=o[u])+32768&32767}return d<<16|p},r.F._howLong=function(i,s,o){if(i[s]!=i[s-o]||i[s+1]!=i[s+1-o]||i[s+2]!=i[s+2-o])return 0;var a=s,l=Math.min(i.length,s+258);for(s+=3;s<l&&i[s]==i[s-o];)s++;return s-a},r.F._hash=function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(i,s,o,a,l,c,u,f,h){var d,p,g,b,w,x,T,M,O,_=r.F.U,L=r.F._putsF,A=r.F._putsE;_.lhst[256]++,p=(d=r.F.getTrees())[0],g=d[1],b=d[2],w=d[3],x=d[4],T=d[5],M=d[6],O=d[7];var E=32+((h+3&7)==0?0:8-(h+3&7))+(u<<3),S=a+r.F.contSize(_.fltree,_.lhst)+r.F.contSize(_.fdtree,_.dhst),k=a+r.F.contSize(_.ltree,_.lhst)+r.F.contSize(_.dtree,_.dhst);k+=14+3*T+r.F.contSize(_.itree,_.ihst)+(2*_.ihst[16]+3*_.ihst[17]+7*_.ihst[18]);for(var P=0;P<286;P++)_.lhst[P]=0;for(P=0;P<30;P++)_.dhst[P]=0;for(P=0;P<19;P++)_.ihst[P]=0;var D=E<S&&E<k?0:S<k?1:2;if(L(f,h,i),L(f,h+1,D),h+=3,D==0){for(;(7&h)!=0;)h++;h=r.F._copyExact(l,c,u,f,h)}else{var H,N;if(D==1&&(H=_.fltree,N=_.fdtree),D==2){r.F.makeCodes(_.ltree,p),r.F.revCodes(_.ltree,p),r.F.makeCodes(_.dtree,g),r.F.revCodes(_.dtree,g),r.F.makeCodes(_.itree,b),r.F.revCodes(_.itree,b),H=_.ltree,N=_.dtree,A(f,h,w-257),A(f,h+=5,x-1),A(f,h+=5,T-4),h+=4;for(var I=0;I<T;I++)A(f,h+3*I,_.itree[1+(_.ordr[I]<<1)]);h+=3*T,h=r.F._codeTiny(M,_.itree,f,h),h=r.F._codeTiny(O,_.itree,f,h)}for(var $=c,V=0;V<o;V+=2){for(var U=s[V],W=U>>>23,ee=$+(8388607&U);$<ee;)h=r.F._writeLit(l[$++],H,f,h);if(W!=0){var X=s[V+1],he=X>>16,oe=X>>8&255,Y=255&X;A(f,h=r.F._writeLit(257+oe,H,f,h),W-_.of0[oe]),h+=_.exb[oe],L(f,h=r.F._writeLit(Y,N,f,h),he-_.df0[Y]),h+=_.dxb[Y],$+=W}}h=r.F._writeLit(256,H,f,h)}return h},r.F._copyExact=function(i,s,o,a,l){var c=l>>>3;return a[c]=o,a[c+1]=o>>>8,a[c+2]=255-a[c],a[c+3]=255-a[c+1],c+=4,a.set(new Uint8Array(i.buffer,s,o),c),l+(o+4<<3)},r.F.getTrees=function(){for(var i=r.F.U,s=r.F._hufTree(i.lhst,i.ltree,15),o=r.F._hufTree(i.dhst,i.dtree,15),a=[],l=r.F._lenCodes(i.ltree,a),c=[],u=r.F._lenCodes(i.dtree,c),f=0;f<a.length;f+=2)i.ihst[a[f]]++;for(f=0;f<c.length;f+=2)i.ihst[c[f]]++;for(var h=r.F._hufTree(i.ihst,i.itree,7),d=19;d>4&&i.itree[1+(i.ordr[d-1]<<1)]==0;)d--;return[s,o,h,l,u,d,a,c]},r.F.getSecond=function(i){for(var s=[],o=0;o<i.length;o+=2)s.push(i[o+1]);return s},r.F.nonZero=function(i){for(var s="",o=0;o<i.length;o+=2)i[o+1]!=0&&(s+=(o>>1)+",");return s},r.F.contSize=function(i,s){for(var o=0,a=0;a<s.length;a++)o+=s[a]*i[1+(a<<1)];return o},r.F._codeTiny=function(i,s,o,a){for(var l=0;l<i.length;l+=2){var c=i[l],u=i[l+1];a=r.F._writeLit(c,s,o,a);var f=c==16?2:c==17?3:7;c>15&&(r.F._putsE(o,a,u,f),a+=f)}return a},r.F._lenCodes=function(i,s){for(var o=i.length;o!=2&&i[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=i[a+1],c=a+3<o?i[a+3]:-1,u=a+5<o?i[a+5]:-1,f=a==0?-1:i[a-1];if(l==0&&c==l&&u==l){for(var h=a+5;h+2<o&&i[h+2]==l;)h+=2;(d=Math.min(h+1-a>>>1,138))<11?s.push(17,d-3):s.push(18,d-11),a+=2*d-2}else if(l==f&&c==l&&u==l){for(h=a+5;h+2<o&&i[h+2]==l;)h+=2;var d=Math.min(h+1-a>>>1,6);s.push(16,d-3),a+=2*d-2}else s.push(l,0)}return o>>>1},r.F._hufTree=function(i,s,o){var a=[],l=i.length,c=s.length,u=0;for(u=0;u<c;u+=2)s[u]=0,s[u+1]=0;for(u=0;u<l;u++)i[u]!=0&&a.push({lit:u,f:i[u]});var f=a.length,h=a.slice(0);if(f==0)return 0;if(f==1){var d=a[0].lit;return h=d==0?1:0,s[1+(d<<1)]=1,s[1+(h<<1)]=1,1}a.sort((function(M,O){return M.f-O.f}));var p=a[0],g=a[1],b=0,w=1,x=2;for(a[0]={lit:-1,f:p.f+g.f,l:p,r:g,d:0};w!=f-1;)p=b!=w&&(x==f||a[b].f<a[x].f)?a[b++]:a[x++],g=b!=w&&(x==f||a[b].f<a[x].f)?a[b++]:a[x++],a[w++]={lit:-1,f:p.f+g.f,l:p,r:g};var T=r.F.setDepth(a[w-1],0);for(T>o&&(r.F.restrictDepth(h,o,T),T=o),u=0;u<f;u++)s[1+(h[u].lit<<1)]=h[u].d;return T},r.F.setDepth=function(i,s){return i.lit!=-1?(i.d=s,s):Math.max(r.F.setDepth(i.l,s+1),r.F.setDepth(i.r,s+1))},r.F.restrictDepth=function(i,s,o){var a=0,l=1<<o-s,c=0;for(i.sort((function(f,h){return h.d==f.d?f.f-h.f:h.d-f.d})),a=0;a<i.length&&i[a].d>s;a++){var u=i[a].d;i[a].d=s,c+=l-(1<<o-u)}for(c>>>=o-s;c>0;)(u=i[a].d)<s?(i[a].d++,c-=1<<s-u-1):a++;for(;a>=0;a--)i[a].d==s&&c<0&&(i[a].d--,c++);c!=0&&console.log("debt left")},r.F._goodIndex=function(i,s){var o=0;return s[16|o]<=i&&(o|=16),s[8|o]<=i&&(o|=8),s[4|o]<=i&&(o|=4),s[2|o]<=i&&(o|=2),s[1|o]<=i&&(o|=1),o},r.F._writeLit=function(i,s,o,a){return r.F._putsF(o,a,s[i<<1]),a+s[1+(i<<1)]},r.F.inflate=function(i,s){var o=Uint8Array;if(i[0]==3&&i[1]==0)return s||new o(0);var a=r.F,l=a._bitsF,c=a._bitsE,u=a._decodeTiny,f=a.makeCodes,h=a.codes2map,d=a._get17,p=a.U,g=s==null;g&&(s=new o(i.length>>>2<<3));for(var b,w,x=0,T=0,M=0,O=0,_=0,L=0,A=0,E=0,S=0;x==0;)if(x=l(i,S,1),T=l(i,S+1,2),S+=3,T!=0){if(g&&(s=r.F._check(s,E+(1<<17))),T==1&&(b=p.flmap,w=p.fdmap,L=511,A=31),T==2){M=c(i,S,5)+257,O=c(i,S+5,5)+1,_=c(i,S+10,4)+4,S+=14;for(var k=0;k<38;k+=2)p.itree[k]=0,p.itree[k+1]=0;var P=1;for(k=0;k<_;k++){var D=c(i,S+3*k,3);p.itree[1+(p.ordr[k]<<1)]=D,D>P&&(P=D)}S+=3*_,f(p.itree,P),h(p.itree,P,p.imap),b=p.lmap,w=p.dmap,S=u(p.imap,(1<<P)-1,M+O,i,S,p.ttree);var H=a._copyOut(p.ttree,0,M,p.ltree);L=(1<<H)-1;var N=a._copyOut(p.ttree,M,O,p.dtree);A=(1<<N)-1,f(p.ltree,H),h(p.ltree,H,b),f(p.dtree,N),h(p.dtree,N,w)}for(;;){var I=b[d(i,S)&L];S+=15&I;var $=I>>>4;if(!($>>>8))s[E++]=$;else{if($==256)break;var V=E+$-254;if($>264){var U=p.ldef[$-257];V=E+(U>>>3)+c(i,S,7&U),S+=7&U}var W=w[d(i,S)&A];S+=15&W;var ee=W>>>4,X=p.ddef[ee],he=(X>>>4)+l(i,S,15&X);for(S+=15&X,g&&(s=r.F._check(s,E+(1<<17)));E<V;)s[E]=s[E++-he],s[E]=s[E++-he],s[E]=s[E++-he],s[E]=s[E++-he];E=V}}}else{(7&S)!=0&&(S+=8-(7&S));var oe=4+(S>>>3),Y=i[oe-4]|i[oe-3]<<8;g&&(s=r.F._check(s,E+Y)),s.set(new o(i.buffer,i.byteOffset+oe,Y),E),S=oe+Y<<3,E+=Y}return s.length==E?s:s.slice(0,E)},r.F._check=function(i,s){var o=i.length;if(s<=o)return i;var a=new Uint8Array(Math.max(o<<1,s));return a.set(i,0),a},r.F._decodeTiny=function(i,s,o,a,l,c){for(var u=r.F._bitsE,f=r.F._get17,h=0;h<o;){var d=i[f(a,l)&s];l+=15&d;var p=d>>>4;if(p<=15)c[h]=p,h++;else{var g=0,b=0;p==16?(b=3+u(a,l,2),l+=2,g=c[h-1]):p==17?(b=3+u(a,l,3),l+=3):p==18&&(b=11+u(a,l,7),l+=7);for(var w=h+b;h<w;)c[h]=g,h++}}return l},r.F._copyOut=function(i,s,o,a){for(var l=0,c=0,u=a.length>>>1;c<o;){var f=i[c+s];a[c<<1]=0,a[1+(c<<1)]=f,f>l&&(l=f),c++}for(;c<u;)a[c<<1]=0,a[1+(c<<1)]=0,c++;return l},r.F.makeCodes=function(i,s){for(var o,a,l,c,u=r.F.U,f=i.length,h=u.bl_count,d=0;d<=s;d++)h[d]=0;for(d=1;d<f;d+=2)h[i[d]]++;var p=u.next_code;for(o=0,h[0]=0,a=1;a<=s;a++)o=o+h[a-1]<<1,p[a]=o;for(l=0;l<f;l+=2)(c=i[l+1])!=0&&(i[l]=p[c],p[c]++)},r.F.codes2map=function(i,s,o){for(var a=i.length,l=r.F.U.rev15,c=0;c<a;c+=2)if(i[c+1]!=0)for(var u=c>>1,f=i[c+1],h=u<<4|f,d=s-f,p=i[c]<<d,g=p+(1<<d);p!=g;)o[l[p]>>>15-s]=h,p++},r.F.revCodes=function(i,s){for(var o=r.F.U.rev15,a=15-s,l=0;l<i.length;l+=2){var c=i[l]<<s-i[l+1];i[l]=o[c]>>>a}},r.F._putsE=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8},r.F._putsF=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8,i[a+2]|=o>>>16},r.F._bitsE=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8)>>>(7&s)&(1<<o)-1},r.F._bitsF=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)&(1<<o)-1},r.F._get17=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)},r.F._get25=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16|i[3+(s>>>3)]<<24)>>>(7&s)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),(function(){for(var i=r.F.U,s=0;s<32768;s++){var o=s;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,i.rev15[s]=(o>>>16|o<<16)>>>17}function a(l,c,u){for(;c--!=0;)l.push(0,u)}for(s=0;s<32;s++)i.ldef[s]=i.of0[s]<<3|i.exb[s],i.ddef[s]=i.df0[s]<<4|i.dxb[s];a(i.fltree,144,8),a(i.fltree,112,9),a(i.fltree,24,7),a(i.fltree,8,8),r.F.makeCodes(i.fltree,9),r.F.codes2map(i.fltree,9,i.flmap),r.F.revCodes(i.fltree,9),a(i.fdtree,32,5),r.F.makeCodes(i.fdtree,5),r.F.codes2map(i.fdtree,5,i.fdmap),r.F.revCodes(i.fdtree,5),a(i.itree,19,0),a(i.ltree,286,0),a(i.dtree,30,0),a(i.ttree,320,0)})()})();var vV=yV({__proto__:null,default:od},[od]);const pi=(function(){var t={nextZero(u,f){for(;u[f]!=0;)f++;return f},readUshort:(u,f)=>u[f]<<8|u[f+1],writeUshort(u,f,h){u[f]=h>>8&255,u[f+1]=255&h},readUint:(u,f)=>16777216*u[f]+(u[f+1]<<16|u[f+2]<<8|u[f+3]),writeUint(u,f,h){u[f]=h>>24&255,u[f+1]=h>>16&255,u[f+2]=h>>8&255,u[f+3]=255&h},readASCII(u,f,h){let d="";for(let p=0;p<h;p++)d+=String.fromCharCode(u[f+p]);return d},writeASCII(u,f,h){for(let d=0;d<h.length;d++)u[f+d]=h.charCodeAt(d)},readBytes(u,f,h){const d=[];for(let p=0;p<h;p++)d.push(u[f+p]);return d},pad:u=>u.length<2?`0${u}`:u,readUTF8(u,f,h){let d,p="";for(let g=0;g<h;g++)p+=`%${t.pad(u[f+g].toString(16))}`;try{d=decodeURIComponent(p)}catch{return t.readASCII(u,f,h)}return d}};function e(u,f,h,d){const p=f*h,g=s(d),b=Math.ceil(f*g/8),w=new Uint8Array(4*p),x=new Uint32Array(w.buffer),{ctype:T}=d,{depth:M}=d,O=t.readUshort;if(T==6){const U=p<<2;if(M==8)for(var _=0;_<U;_+=4)w[_]=u[_],w[_+1]=u[_+1],w[_+2]=u[_+2],w[_+3]=u[_+3];if(M==16)for(_=0;_<U;_++)w[_]=u[_<<1]}else if(T==2){const U=d.tabs.tRNS;if(U==null){if(M==8)for(_=0;_<p;_++){var L=3*_;x[_]=255<<24|u[L+2]<<16|u[L+1]<<8|u[L]}if(M==16)for(_=0;_<p;_++)L=6*_,x[_]=255<<24|u[L+4]<<16|u[L+2]<<8|u[L]}else{var A=U[0];const W=U[1],ee=U[2];if(M==8)for(_=0;_<p;_++){var E=_<<2;L=3*_,x[_]=255<<24|u[L+2]<<16|u[L+1]<<8|u[L],u[L]==A&&u[L+1]==W&&u[L+2]==ee&&(w[E+3]=0)}if(M==16)for(_=0;_<p;_++)E=_<<2,L=6*_,x[_]=255<<24|u[L+4]<<16|u[L+2]<<8|u[L],O(u,L)==A&&O(u,L+2)==W&&O(u,L+4)==ee&&(w[E+3]=0)}}else if(T==3){const U=d.tabs.PLTE,W=d.tabs.tRNS,ee=W?W.length:0;if(M==1)for(var S=0;S<h;S++){var k=S*b,P=S*f;for(_=0;_<f;_++){E=P+_<<2;var D=3*(H=u[k+(_>>3)]>>7-((7&_)<<0)&1);w[E]=U[D],w[E+1]=U[D+1],w[E+2]=U[D+2],w[E+3]=H<ee?W[H]:255}}if(M==2)for(S=0;S<h;S++)for(k=S*b,P=S*f,_=0;_<f;_++)E=P+_<<2,D=3*(H=u[k+(_>>2)]>>6-((3&_)<<1)&3),w[E]=U[D],w[E+1]=U[D+1],w[E+2]=U[D+2],w[E+3]=H<ee?W[H]:255;if(M==4)for(S=0;S<h;S++)for(k=S*b,P=S*f,_=0;_<f;_++)E=P+_<<2,D=3*(H=u[k+(_>>1)]>>4-((1&_)<<2)&15),w[E]=U[D],w[E+1]=U[D+1],w[E+2]=U[D+2],w[E+3]=H<ee?W[H]:255;if(M==8)for(_=0;_<p;_++){var H;E=_<<2,D=3*(H=u[_]),w[E]=U[D],w[E+1]=U[D+1],w[E+2]=U[D+2],w[E+3]=H<ee?W[H]:255}}else if(T==4){if(M==8)for(_=0;_<p;_++){E=_<<2;var N=u[I=_<<1];w[E]=N,w[E+1]=N,w[E+2]=N,w[E+3]=u[I+1]}if(M==16)for(_=0;_<p;_++){var I;E=_<<2,N=u[I=_<<2],w[E]=N,w[E+1]=N,w[E+2]=N,w[E+3]=u[I+2]}}else if(T==0)for(A=d.tabs.tRNS?d.tabs.tRNS:-1,S=0;S<h;S++){const U=S*b,W=S*f;if(M==1)for(var $=0;$<f;$++){var V=(N=255*(u[U+($>>>3)]>>>7-(7&$)&1))==255*A?0:255;x[W+$]=V<<24|N<<16|N<<8|N}else if(M==2)for($=0;$<f;$++)V=(N=85*(u[U+($>>>2)]>>>6-((3&$)<<1)&3))==85*A?0:255,x[W+$]=V<<24|N<<16|N<<8|N;else if(M==4)for($=0;$<f;$++)V=(N=17*(u[U+($>>>1)]>>>4-((1&$)<<2)&15))==17*A?0:255,x[W+$]=V<<24|N<<16|N<<8|N;else if(M==8)for($=0;$<f;$++)V=(N=u[U+$])==A?0:255,x[W+$]=V<<24|N<<16|N<<8|N;else if(M==16)for($=0;$<f;$++)N=u[U+($<<1)],V=O(u,U+($<<1))==A?0:255,x[W+$]=V<<24|N<<16|N<<8|N}return w}function n(u,f,h,d){const p=s(u),g=Math.ceil(h*p/8),b=new Uint8Array((g+1+u.interlace)*d);return f=u.tabs.CgBI?i(f,b):r(f,b),u.interlace==0?f=o(f,u,0,h,d):u.interlace==1&&(f=(function(x,T){const M=T.width,O=T.height,_=s(T),L=_>>3,A=Math.ceil(M*_/8),E=new Uint8Array(O*A);let S=0;const k=[0,0,4,0,2,0,1],P=[0,4,0,2,0,1,0],D=[8,8,8,4,4,2,2],H=[8,8,4,4,2,2,1];let N=0;for(;N<7;){const $=D[N],V=H[N];let U=0,W=0,ee=k[N];for(;ee<O;)ee+=$,W++;let X=P[N];for(;X<M;)X+=V,U++;const he=Math.ceil(U*_/8);o(x,T,S,U,W);let oe=0,Y=k[N];for(;Y<O;){let be=P[N],Re=S+oe*he<<3;for(;be<M;){var I;if(_==1&&(I=(I=x[Re>>3])>>7-(7&Re)&1,E[Y*A+(be>>3)]|=I<<7-((7&be)<<0)),_==2&&(I=(I=x[Re>>3])>>6-(7&Re)&3,E[Y*A+(be>>2)]|=I<<6-((3&be)<<1)),_==4&&(I=(I=x[Re>>3])>>4-(7&Re)&15,E[Y*A+(be>>1)]|=I<<4-((1&be)<<2)),_>=8){const de=Y*A+be*L;for(let Me=0;Me<L;Me++)E[de+Me]=x[(Re>>3)+Me]}Re+=_,be+=V}oe++,Y+=$}U*W!=0&&(S+=W*(1+he)),N+=1}return E})(f,u)),f}function r(u,f){return i(new Uint8Array(u.buffer,2,u.length-6),f)}var i=(function(){const u={H:{}};return u.H.N=function(f,h){const d=Uint8Array;let p,g,b=0,w=0,x=0,T=0,M=0,O=0,_=0,L=0,A=0;if(f[0]==3&&f[1]==0)return h||new d(0);const E=u.H,S=E.b,k=E.e,P=E.R,D=E.n,H=E.A,N=E.Z,I=E.m,$=h==null;for($&&(h=new d(f.length>>>2<<5));b==0;)if(b=S(f,A,1),w=S(f,A+1,2),A+=3,w!=0){if($&&(h=u.H.W(h,L+(1<<17))),w==1&&(p=I.J,g=I.h,O=511,_=31),w==2){x=k(f,A,5)+257,T=k(f,A+5,5)+1,M=k(f,A+10,4)+4,A+=14;let U=1;for(var V=0;V<38;V+=2)I.Q[V]=0,I.Q[V+1]=0;for(V=0;V<M;V++){const X=k(f,A+3*V,3);I.Q[1+(I.X[V]<<1)]=X,X>U&&(U=X)}A+=3*M,D(I.Q,U),H(I.Q,U,I.u),p=I.w,g=I.d,A=P(I.u,(1<<U)-1,x+T,f,A,I.v);const W=E.V(I.v,0,x,I.C);O=(1<<W)-1;const ee=E.V(I.v,x,T,I.D);_=(1<<ee)-1,D(I.C,W),H(I.C,W,p),D(I.D,ee),H(I.D,ee,g)}for(;;){const U=p[N(f,A)&O];A+=15&U;const W=U>>>4;if(!(W>>>8))h[L++]=W;else{if(W==256)break;{let ee=L+W-254;if(W>264){const be=I.q[W-257];ee=L+(be>>>3)+k(f,A,7&be),A+=7&be}const X=g[N(f,A)&_];A+=15&X;const he=X>>>4,oe=I.c[he],Y=(oe>>>4)+S(f,A,15&oe);for(A+=15&oe;L<ee;)h[L]=h[L++-Y],h[L]=h[L++-Y],h[L]=h[L++-Y],h[L]=h[L++-Y];L=ee}}}}else{(7&A)!=0&&(A+=8-(7&A));const U=4+(A>>>3),W=f[U-4]|f[U-3]<<8;$&&(h=u.H.W(h,L+W)),h.set(new d(f.buffer,f.byteOffset+U,W),L),A=U+W<<3,L+=W}return h.length==L?h:h.slice(0,L)},u.H.W=function(f,h){const d=f.length;if(h<=d)return f;const p=new Uint8Array(d<<1);return p.set(f,0),p},u.H.R=function(f,h,d,p,g,b){const w=u.H.e,x=u.H.Z;let T=0;for(;T<d;){const M=f[x(p,g)&h];g+=15&M;const O=M>>>4;if(O<=15)b[T]=O,T++;else{let _=0,L=0;O==16?(L=3+w(p,g,2),g+=2,_=b[T-1]):O==17?(L=3+w(p,g,3),g+=3):O==18&&(L=11+w(p,g,7),g+=7);const A=T+L;for(;T<A;)b[T]=_,T++}}return g},u.H.V=function(f,h,d,p){let g=0,b=0;const w=p.length>>>1;for(;b<d;){const x=f[b+h];p[b<<1]=0,p[1+(b<<1)]=x,x>g&&(g=x),b++}for(;b<w;)p[b<<1]=0,p[1+(b<<1)]=0,b++;return g},u.H.n=function(f,h){const d=u.H.m,p=f.length;let g,b,w,x;const T=d.j;for(var M=0;M<=h;M++)T[M]=0;for(M=1;M<p;M+=2)T[f[M]]++;const O=d.K;for(g=0,T[0]=0,b=1;b<=h;b++)g=g+T[b-1]<<1,O[b]=g;for(w=0;w<p;w+=2)x=f[w+1],x!=0&&(f[w]=O[x],O[x]++)},u.H.A=function(f,h,d){const p=f.length,g=u.H.m.r;for(let b=0;b<p;b+=2)if(f[b+1]!=0){const w=b>>1,x=f[b+1],T=w<<4|x,M=h-x;let O=f[b]<<M;const _=O+(1<<M);for(;O!=_;)d[g[O]>>>15-h]=T,O++}},u.H.l=function(f,h){const d=u.H.m.r,p=15-h;for(let g=0;g<f.length;g+=2){const b=f[g]<<h-f[g+1];f[g]=d[b]>>>p}},u.H.M=function(f,h,d){d<<=7&h;const p=h>>>3;f[p]|=d,f[p+1]|=d>>>8},u.H.I=function(f,h,d){d<<=7&h;const p=h>>>3;f[p]|=d,f[p+1]|=d>>>8,f[p+2]|=d>>>16},u.H.e=function(f,h,d){return(f[h>>>3]|f[1+(h>>>3)]<<8)>>>(7&h)&(1<<d)-1},u.H.b=function(f,h,d){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)&(1<<d)-1},u.H.Z=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16)>>>(7&h)},u.H.i=function(f,h){return(f[h>>>3]|f[1+(h>>>3)]<<8|f[2+(h>>>3)]<<16|f[3+(h>>>3)]<<24)>>>(7&h)},u.H.m=(function(){const f=Uint16Array,h=Uint32Array;return{K:new f(16),j:new f(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new f(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new h(32),J:new f(512),_:[],h:new f(32),$:[],w:new f(32768),C:[],v:[],d:new f(32768),D:[],u:new f(512),Q:[],r:new f(32768),s:new h(286),Y:new h(30),a:new h(19),t:new h(15e3),k:new f(65536),g:new f(32768)}})(),(function(){const f=u.H.m;for(var h=0;h<32768;h++){let p=h;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,f.r[h]=(p>>>16|p<<16)>>>17}function d(p,g,b){for(;g--!=0;)p.push(0,b)}for(h=0;h<32;h++)f.q[h]=f.S[h]<<3|f.T[h],f.c[h]=f.p[h]<<4|f.z[h];d(f._,144,8),d(f._,112,9),d(f._,24,7),d(f._,8,8),u.H.n(f._,9),u.H.A(f._,9,f.J),u.H.l(f._,9),d(f.$,32,5),u.H.n(f.$,5),u.H.A(f.$,5,f.h),u.H.l(f.$,5),d(f.Q,19,0),d(f.C,286,0),d(f.D,30,0),d(f.v,320,0)})(),u.H.N})();function s(u){return[1,null,3,1,2,null,4][u.ctype]*u.depth}function o(u,f,h,d,p){let g=s(f);const b=Math.ceil(d*g/8);let w,x;g=Math.ceil(g/8);let T=u[h],M=0;if(T>1&&(u[h]=[0,0,1][T-2]),T==3)for(M=g;M<b;M++)u[M+1]=u[M+1]+(u[M+1-g]>>>1)&255;for(let O=0;O<p;O++)if(w=h+O*b,x=w+O+1,T=u[x-1],M=0,T==0)for(;M<b;M++)u[w+M]=u[x+M];else if(T==1){for(;M<g;M++)u[w+M]=u[x+M];for(;M<b;M++)u[w+M]=u[x+M]+u[w+M-g]}else if(T==2)for(;M<b;M++)u[w+M]=u[x+M]+u[w+M-b];else if(T==3){for(;M<g;M++)u[w+M]=u[x+M]+(u[w+M-b]>>>1);for(;M<b;M++)u[w+M]=u[x+M]+(u[w+M-b]+u[w+M-g]>>>1)}else{for(;M<g;M++)u[w+M]=u[x+M]+a(0,u[w+M-b],0);for(;M<b;M++)u[w+M]=u[x+M]+a(u[w+M-g],u[w+M-b],u[w+M-g-b])}return u}function a(u,f,h){const d=u+f-h,p=d-u,g=d-f,b=d-h;return p*p<=g*g&&p*p<=b*b?u:g*g<=b*b?f:h}function l(u,f,h){h.width=t.readUint(u,f),f+=4,h.height=t.readUint(u,f),f+=4,h.depth=u[f],f++,h.ctype=u[f],f++,h.compress=u[f],f++,h.filter=u[f],f++,h.interlace=u[f],f++}function c(u,f,h,d,p,g,b,w,x){const T=Math.min(f,p),M=Math.min(h,g);let O=0,_=0;for(let N=0;N<M;N++)for(let I=0;I<T;I++)if(b>=0&&w>=0?(O=N*f+I<<2,_=(w+N)*p+b+I<<2):(O=(-w+N)*f-b+I<<2,_=N*p+I<<2),x==0)d[_]=u[O],d[_+1]=u[O+1],d[_+2]=u[O+2],d[_+3]=u[O+3];else if(x==1){var L=u[O+3]*.00392156862745098,A=u[O]*L,E=u[O+1]*L,S=u[O+2]*L,k=d[_+3]*(1/255),P=d[_]*k,D=d[_+1]*k,H=d[_+2]*k;const $=1-L,V=L+k*$,U=V==0?0:1/V;d[_+3]=255*V,d[_+0]=(A+P*$)*U,d[_+1]=(E+D*$)*U,d[_+2]=(S+H*$)*U}else if(x==2)L=u[O+3],A=u[O],E=u[O+1],S=u[O+2],k=d[_+3],P=d[_],D=d[_+1],H=d[_+2],L==k&&A==P&&E==D&&S==H?(d[_]=0,d[_+1]=0,d[_+2]=0,d[_+3]=0):(d[_]=A,d[_+1]=E,d[_+2]=S,d[_+3]=L);else if(x==3){if(L=u[O+3],A=u[O],E=u[O+1],S=u[O+2],k=d[_+3],P=d[_],D=d[_+1],H=d[_+2],L==k&&A==P&&E==D&&S==H)continue;if(L<220&&k>20)return!1}return!0}return{decode:function(f){const h=new Uint8Array(f);let d=8;const p=t,g=p.readUshort,b=p.readUint,w={tabs:{},frames:[]},x=new Uint8Array(h.length);let T,M=0,O=0;const _=[137,80,78,71,13,10,26,10];for(var L=0;L<8;L++)if(h[L]!=_[L])throw"The input is not a PNG file!";for(;d<h.length;){const N=p.readUint(h,d);d+=4;const I=p.readASCII(h,d,4);if(d+=4,I=="IHDR")l(h,d,w);else if(I=="iCCP"){for(var A=d;h[A]!=0;)A++;p.readASCII(h,d,A-d),h[A+1];const $=h.slice(A+2,d+N);let V=null;try{V=r($)}catch{V=i($)}w.tabs[I]=V}else if(I=="CgBI")w.tabs[I]=h.slice(d,d+4);else if(I=="IDAT"){for(L=0;L<N;L++)x[M+L]=h[d+L];M+=N}else if(I=="acTL")w.tabs[I]={num_frames:b(h,d),num_plays:b(h,d+4)},T=new Uint8Array(h.length);else if(I=="fcTL"){O!=0&&((H=w.frames[w.frames.length-1]).data=n(w,T.slice(0,O),H.rect.width,H.rect.height),O=0);const $={x:b(h,d+12),y:b(h,d+16),width:b(h,d+4),height:b(h,d+8)};let V=g(h,d+22);V=g(h,d+20)/(V==0?100:V);const U={rect:$,delay:Math.round(1e3*V),dispose:h[d+24],blend:h[d+25]};w.frames.push(U)}else if(I=="fdAT"){for(L=0;L<N-4;L++)T[O+L]=h[d+L+4];O+=N-4}else if(I=="pHYs")w.tabs[I]=[p.readUint(h,d),p.readUint(h,d+4),h[d+8]];else if(I=="cHRM")for(w.tabs[I]=[],L=0;L<8;L++)w.tabs[I].push(p.readUint(h,d+4*L));else if(I=="tEXt"||I=="zTXt"){w.tabs[I]==null&&(w.tabs[I]={});var E=p.nextZero(h,d),S=p.readASCII(h,d,E-d),k=d+N-E-1;if(I=="tEXt")D=p.readASCII(h,E+1,k);else{var P=r(h.slice(E+2,E+2+k));D=p.readUTF8(P,0,P.length)}w.tabs[I][S]=D}else if(I=="iTXt"){w.tabs[I]==null&&(w.tabs[I]={}),E=0,A=d,E=p.nextZero(h,A),S=p.readASCII(h,A,E-A);const $=h[A=E+1];var D;h[A+1],A+=2,E=p.nextZero(h,A),p.readASCII(h,A,E-A),A=E+1,E=p.nextZero(h,A),p.readUTF8(h,A,E-A),k=N-((A=E+1)-d),$==0?D=p.readUTF8(h,A,k):(P=r(h.slice(A,A+k)),D=p.readUTF8(P,0,P.length)),w.tabs[I][S]=D}else if(I=="PLTE")w.tabs[I]=p.readBytes(h,d,N);else if(I=="hIST"){const $=w.tabs.PLTE.length/3;for(w.tabs[I]=[],L=0;L<$;L++)w.tabs[I].push(g(h,d+2*L))}else if(I=="tRNS")w.ctype==3?w.tabs[I]=p.readBytes(h,d,N):w.ctype==0?w.tabs[I]=g(h,d):w.ctype==2&&(w.tabs[I]=[g(h,d),g(h,d+2),g(h,d+4)]);else if(I=="gAMA")w.tabs[I]=p.readUint(h,d)/1e5;else if(I=="sRGB")w.tabs[I]=h[d];else if(I=="bKGD")w.ctype==0||w.ctype==4?w.tabs[I]=[g(h,d)]:w.ctype==2||w.ctype==6?w.tabs[I]=[g(h,d),g(h,d+2),g(h,d+4)]:w.ctype==3&&(w.tabs[I]=h[d]);else if(I=="IEND")break;d+=N,p.readUint(h,d),d+=4}var H;return O!=0&&((H=w.frames[w.frames.length-1]).data=n(w,T.slice(0,O),H.rect.width,H.rect.height)),w.data=n(w,x,w.width,w.height),delete w.compress,delete w.interlace,delete w.filter,w},toRGBA8:function(f){const h=f.width,d=f.height;if(f.tabs.acTL==null)return[e(f.data,h,d,f).buffer];const p=[];f.frames[0].data==null&&(f.frames[0].data=f.data);const g=h*d*4,b=new Uint8Array(g),w=new Uint8Array(g),x=new Uint8Array(g);for(let M=0;M<f.frames.length;M++){const O=f.frames[M],_=O.rect.x,L=O.rect.y,A=O.rect.width,E=O.rect.height,S=e(O.data,A,E,f);if(M!=0)for(var T=0;T<g;T++)x[T]=b[T];if(O.blend==0?c(S,A,E,b,h,d,_,L,0):O.blend==1&&c(S,A,E,b,h,d,_,L,1),p.push(b.buffer.slice(0)),O.dispose!=0){if(O.dispose==1)c(w,A,E,b,h,d,_,L,0);else if(O.dispose==2)for(T=0;T<g;T++)b[T]=x[T]}}return p},_paeth:a,_copyTile:c,_bin:t}})();(function(){const{_copyTile:t}=pi,{_bin:e}=pi,n=pi._paeth;var r={table:(function(){const A=new Uint32Array(256);for(let E=0;E<256;E++){let S=E;for(let k=0;k<8;k++)1&S?S=3988292384^S>>>1:S>>>=1;A[E]=S}return A})(),update(A,E,S,k){for(let P=0;P<k;P++)A=r.table[255&(A^E[S+P])]^A>>>8;return A},crc:(A,E,S)=>4294967295^r.update(4294967295,A,E,S)};function i(A,E,S,k){E[S]+=A[0]*k>>4,E[S+1]+=A[1]*k>>4,E[S+2]+=A[2]*k>>4,E[S+3]+=A[3]*k>>4}function s(A){return Math.max(0,Math.min(255,A))}function o(A,E){const S=A[0]-E[0],k=A[1]-E[1],P=A[2]-E[2],D=A[3]-E[3];return S*S+k*k+P*P+D*D}function a(A,E,S,k,P,D,H){H==null&&(H=1);const N=k.length,I=[];for(var $=0;$<N;$++){const Y=k[$];I.push([Y>>>0&255,Y>>>8&255,Y>>>16&255,Y>>>24&255])}for($=0;$<N;$++){let Y=4294967295;for(var V=0,U=0;U<N;U++){var W=o(I[$],I[U]);U!=$&&W<Y&&(Y=W,V=U)}}const ee=new Uint32Array(P.buffer),X=new Int16Array(E*S*4),he=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for($=0;$<he.length;$++)he[$]=255*((he[$]+.5)/16-.5);for(let Y=0;Y<S;Y++)for(let be=0;be<E;be++){var oe;$=4*(Y*E+be),H!=2?oe=[s(A[$]+X[$]),s(A[$+1]+X[$+1]),s(A[$+2]+X[$+2]),s(A[$+3]+X[$+3])]:(W=he[4*(3&Y)+(3&be)],oe=[s(A[$]+W),s(A[$+1]+W),s(A[$+2]+W),s(A[$+3]+W)]),V=0;let Re=16777215;for(U=0;U<N;U++){const ce=o(oe,I[U]);ce<Re&&(Re=ce,V=U)}const de=I[V],Me=[oe[0]-de[0],oe[1]-de[1],oe[2]-de[2],oe[3]-de[3]];H==1&&(be!=E-1&&i(Me,X,$+4,7),Y!=S-1&&(be!=0&&i(Me,X,$+4*E-4,3),i(Me,X,$+4*E,5),be!=E-1&&i(Me,X,$+4*E+4,1))),D[$>>2]=V,ee[$>>2]=k[V]}}function l(A,E,S,k,P){P==null&&(P={});const{crc:D}=r,H=e.writeUint,N=e.writeUshort,I=e.writeASCII;let $=8;const V=A.frames.length>1;let U,W=!1,ee=33+(V?20:0);if(P.sRGB!=null&&(ee+=13),P.pHYs!=null&&(ee+=21),P.iCCP!=null&&(U=pako.deflate(P.iCCP),ee+=21+U.length+4),A.ctype==3){for(var X=A.plte.length,he=0;he<X;he++)A.plte[he]>>>24!=255&&(W=!0);ee+=8+3*X+4+(W?8+1*X+4:0)}for(var oe=0;oe<A.frames.length;oe++)V&&(ee+=38),ee+=(de=A.frames[oe]).cimg.length+12,oe!=0&&(ee+=4);ee+=12;const Y=new Uint8Array(ee),be=[137,80,78,71,13,10,26,10];for(he=0;he<8;he++)Y[he]=be[he];if(H(Y,$,13),$+=4,I(Y,$,"IHDR"),$+=4,H(Y,$,E),$+=4,H(Y,$,S),$+=4,Y[$]=A.depth,$++,Y[$]=A.ctype,$++,Y[$]=0,$++,Y[$]=0,$++,Y[$]=0,$++,H(Y,$,D(Y,$-17,17)),$+=4,P.sRGB!=null&&(H(Y,$,1),$+=4,I(Y,$,"sRGB"),$+=4,Y[$]=P.sRGB,$++,H(Y,$,D(Y,$-5,5)),$+=4),P.iCCP!=null){const Me=13+U.length;H(Y,$,Me),$+=4,I(Y,$,"iCCP"),$+=4,I(Y,$,"ICC profile"),$+=11,$+=2,Y.set(U,$),$+=U.length,H(Y,$,D(Y,$-(Me+4),Me+4)),$+=4}if(P.pHYs!=null&&(H(Y,$,9),$+=4,I(Y,$,"pHYs"),$+=4,H(Y,$,P.pHYs[0]),$+=4,H(Y,$,P.pHYs[1]),$+=4,Y[$]=P.pHYs[2],$++,H(Y,$,D(Y,$-13,13)),$+=4),V&&(H(Y,$,8),$+=4,I(Y,$,"acTL"),$+=4,H(Y,$,A.frames.length),$+=4,H(Y,$,P.loop!=null?P.loop:0),$+=4,H(Y,$,D(Y,$-12,12)),$+=4),A.ctype==3){for(H(Y,$,3*(X=A.plte.length)),$+=4,I(Y,$,"PLTE"),$+=4,he=0;he<X;he++){const Me=3*he,ce=A.plte[he],xe=255&ce,Te=ce>>>8&255,qe=ce>>>16&255;Y[$+Me+0]=xe,Y[$+Me+1]=Te,Y[$+Me+2]=qe}if($+=3*X,H(Y,$,D(Y,$-3*X-4,3*X+4)),$+=4,W){for(H(Y,$,X),$+=4,I(Y,$,"tRNS"),$+=4,he=0;he<X;he++)Y[$+he]=A.plte[he]>>>24&255;$+=X,H(Y,$,D(Y,$-X-4,X+4)),$+=4}}let Re=0;for(oe=0;oe<A.frames.length;oe++){var de=A.frames[oe];V&&(H(Y,$,26),$+=4,I(Y,$,"fcTL"),$+=4,H(Y,$,Re++),$+=4,H(Y,$,de.rect.width),$+=4,H(Y,$,de.rect.height),$+=4,H(Y,$,de.rect.x),$+=4,H(Y,$,de.rect.y),$+=4,N(Y,$,k[oe]),$+=2,N(Y,$,1e3),$+=2,Y[$]=de.dispose,$++,Y[$]=de.blend,$++,H(Y,$,D(Y,$-30,30)),$+=4);const Me=de.cimg;H(Y,$,(X=Me.length)+(oe==0?0:4)),$+=4;const ce=$;I(Y,$,oe==0?"IDAT":"fdAT"),$+=4,oe!=0&&(H(Y,$,Re++),$+=4),Y.set(Me,$),$+=X,H(Y,$,D(Y,ce,$-ce)),$+=4}return H(Y,$,0),$+=4,I(Y,$,"IEND"),$+=4,H(Y,$,D(Y,$-4,4)),$+=4,Y.buffer}function c(A,E,S){for(let k=0;k<A.frames.length;k++){const P=A.frames[k];P.rect.width;const D=P.rect.height,H=new Uint8Array(D*P.bpl+D);P.cimg=d(P.img,D,P.bpp,P.bpl,H,E,S)}}function u(A,E,S,k,P){const D=P[0],H=P[1],N=P[2],I=P[3],$=P[4],V=P[5];let U=6,W=8,ee=255;for(var X=0;X<A.length;X++){const pe=new Uint8Array(A[X]);for(var he=pe.length,oe=0;oe<he;oe+=4)ee&=pe[oe+3]}const Y=ee!=255,be=(function(Se,_e,Ye,gt,Ue,bt){const Mt=[];for(var wt=0;wt<Se.length;wt++){const Yt=new Uint8Array(Se[wt]),Tn=new Uint32Array(Yt.buffer);var Bt;let Wn=0,it=0,mt=_e,xt=Ye,Lt=gt?1:0;if(wt!=0){const ln=bt||gt||wt==1||Mt[wt-2].dispose!=0?1:2;let Jt=0,gn=1e9;for(let In=0;In<ln;In++){var Vn=new Uint8Array(Se[wt-1-In]);const ci=new Uint32Array(Se[wt-1-In]);let On=_e,Kn=Ye,ui=-1,Lr=-1;for(let yn=0;yn<Ye;yn++)for(let Fr=0;Fr<_e;Fr++)Tn[jt=yn*_e+Fr]!=ci[jt]&&(Fr<On&&(On=Fr),Fr>ui&&(ui=Fr),yn<Kn&&(Kn=yn),yn>Lr&&(Lr=yn));ui==-1&&(On=Kn=ui=Lr=0),Ue&&((1&On)==1&&On--,(1&Kn)==1&&Kn--);const mn=(ui-On+1)*(Lr-Kn+1);mn<gn&&(gn=mn,Jt=In,Wn=On,it=Kn,mt=ui-On+1,xt=Lr-Kn+1)}Vn=new Uint8Array(Se[wt-1-Jt]),Jt==1&&(Mt[wt-1].dispose=2),Bt=new Uint8Array(mt*xt*4),t(Vn,_e,Ye,Bt,mt,xt,-Wn,-it,0),Lt=t(Yt,_e,Ye,Bt,mt,xt,-Wn,-it,3)?1:0,Lt==1?h(Yt,_e,Ye,Bt,{x:Wn,y:it,width:mt,height:xt}):t(Yt,_e,Ye,Bt,mt,xt,-Wn,-it,0)}else Bt=Yt.slice(0);Mt.push({rect:{x:Wn,y:it,width:mt,height:xt},img:Bt,blend:Lt,dispose:0})}if(gt)for(wt=0;wt<Mt.length;wt++){if((Cn=Mt[wt]).blend==1)continue;const Yt=Cn.rect,Tn=Mt[wt-1].rect,Wn=Math.min(Yt.x,Tn.x),it=Math.min(Yt.y,Tn.y),mt={x:Wn,y:it,width:Math.max(Yt.x+Yt.width,Tn.x+Tn.width)-Wn,height:Math.max(Yt.y+Yt.height,Tn.y+Tn.height)-it};Mt[wt-1].dispose=1,wt-1!=0&&f(Se,_e,Ye,Mt,wt-1,mt,Ue),f(Se,_e,Ye,Mt,wt,mt,Ue)}let li=0;if(Se.length!=1)for(var jt=0;jt<Mt.length;jt++){var Cn;li+=(Cn=Mt[jt]).rect.width*Cn.rect.height}return Mt})(A,E,S,D,H,N),Re={},de=[],Me=[];if(k!=0){const pe=[];for(oe=0;oe<be.length;oe++)pe.push(be[oe].img.buffer);const Se=(function(Ue){let bt=0;for(var Mt=0;Mt<Ue.length;Mt++)bt+=Ue[Mt].byteLength;const wt=new Uint8Array(bt);let Bt=0;for(Mt=0;Mt<Ue.length;Mt++){const Vn=new Uint8Array(Ue[Mt]),li=Vn.length;for(let jt=0;jt<li;jt+=4){let Cn=Vn[jt],Yt=Vn[jt+1],Tn=Vn[jt+2];const Wn=Vn[jt+3];Wn==0&&(Cn=Yt=Tn=0),wt[Bt+jt]=Cn,wt[Bt+jt+1]=Yt,wt[Bt+jt+2]=Tn,wt[Bt+jt+3]=Wn}Bt+=li}return wt.buffer})(pe),_e=g(Se,k);for(oe=0;oe<_e.plte.length;oe++)de.push(_e.plte[oe].est.rgba);let Ye=0;for(oe=0;oe<be.length;oe++){const gt=(xe=be[oe]).img.length;var ce=new Uint8Array(_e.inds.buffer,Ye>>2,gt>>2);Me.push(ce);const Ue=new Uint8Array(_e.abuf,Ye,gt);V&&a(xe.img,xe.rect.width,xe.rect.height,de,Ue,ce),xe.img.set(Ue),Ye+=gt}}else for(X=0;X<be.length;X++){var xe=be[X];const pe=new Uint32Array(xe.img.buffer);var Te=xe.rect.width;for(he=pe.length,ce=new Uint8Array(he),Me.push(ce),oe=0;oe<he;oe++){const Se=pe[oe];if(oe!=0&&Se==pe[oe-1])ce[oe]=ce[oe-1];else if(oe>Te&&Se==pe[oe-Te])ce[oe]=ce[oe-Te];else{let _e=Re[Se];if(_e==null&&(Re[Se]=_e=de.length,de.push(Se),de.length>=300))break;ce[oe]=_e}}}const qe=de.length;for(qe<=256&&$==0&&(W=qe<=2?1:qe<=4?2:qe<=16?4:8,W=Math.max(W,I)),X=0;X<be.length;X++){(xe=be[X]).rect.x,xe.rect.y,Te=xe.rect.width;const pe=xe.rect.height;let Se=xe.img;new Uint32Array(Se.buffer);let _e=4*Te,Ye=4;if(qe<=256&&$==0){_e=Math.ceil(W*Te/8);var et=new Uint8Array(_e*pe);const gt=Me[X];for(let Ue=0;Ue<pe;Ue++){oe=Ue*_e;const bt=Ue*Te;if(W==8)for(var Ze=0;Ze<Te;Ze++)et[oe+Ze]=gt[bt+Ze];else if(W==4)for(Ze=0;Ze<Te;Ze++)et[oe+(Ze>>1)]|=gt[bt+Ze]<<4-4*(1&Ze);else if(W==2)for(Ze=0;Ze<Te;Ze++)et[oe+(Ze>>2)]|=gt[bt+Ze]<<6-2*(3&Ze);else if(W==1)for(Ze=0;Ze<Te;Ze++)et[oe+(Ze>>3)]|=gt[bt+Ze]<<7-1*(7&Ze)}Se=et,U=3,Ye=1}else if(Y==0&&be.length==1){et=new Uint8Array(Te*pe*3);const gt=Te*pe;for(oe=0;oe<gt;oe++){const Ue=3*oe,bt=4*oe;et[Ue]=Se[bt],et[Ue+1]=Se[bt+1],et[Ue+2]=Se[bt+2]}Se=et,U=2,Ye=3,_e=3*Te}xe.img=Se,xe.bpl=_e,xe.bpp=Ye}return{ctype:U,depth:W,plte:de,frames:be}}function f(A,E,S,k,P,D,H){const N=Uint8Array,I=Uint32Array,$=new N(A[P-1]),V=new I(A[P-1]),U=P+1<A.length?new N(A[P+1]):null,W=new N(A[P]),ee=new I(W.buffer);let X=E,he=S,oe=-1,Y=-1;for(let Re=0;Re<D.height;Re++)for(let de=0;de<D.width;de++){const Me=D.x+de,ce=D.y+Re,xe=ce*E+Me,Te=ee[xe];Te==0||k[P-1].dispose==0&&V[xe]==Te&&(U==null||U[4*xe+3]!=0)||(Me<X&&(X=Me),Me>oe&&(oe=Me),ce<he&&(he=ce),ce>Y&&(Y=ce))}oe==-1&&(X=he=oe=Y=0),H&&((1&X)==1&&X--,(1&he)==1&&he--),D={x:X,y:he,width:oe-X+1,height:Y-he+1};const be=k[P];be.rect=D,be.blend=1,be.img=new Uint8Array(D.width*D.height*4),k[P-1].dispose==0?(t($,E,S,be.img,D.width,D.height,-D.x,-D.y,0),h(W,E,S,be.img,D)):t(W,E,S,be.img,D.width,D.height,-D.x,-D.y,0)}function h(A,E,S,k,P){t(A,E,S,k,P.width,P.height,-P.x,-P.y,2)}function d(A,E,S,k,P,D,H){const N=[];let I,$=[0,1,2,3,4];D!=-1?$=[D]:(E*k>5e5||S==1)&&($=[0]),H&&(I={level:0});const V=vV;for(var U=0;U<$.length;U++){for(let X=0;X<E;X++)p(P,A,X,k,S,$[U]);N.push(V.deflate(P,I))}let W,ee=1e9;for(U=0;U<N.length;U++)N[U].length<ee&&(W=U,ee=N[U].length);return N[W]}function p(A,E,S,k,P,D){const H=S*k;let N=H+S;if(A[N]=D,N++,D==0)if(k<500)for(var I=0;I<k;I++)A[N+I]=E[H+I];else A.set(new Uint8Array(E.buffer,H,k),N);else if(D==1){for(I=0;I<P;I++)A[N+I]=E[H+I];for(I=P;I<k;I++)A[N+I]=E[H+I]-E[H+I-P]+256&255}else if(S==0){for(I=0;I<P;I++)A[N+I]=E[H+I];if(D==2)for(I=P;I<k;I++)A[N+I]=E[H+I];if(D==3)for(I=P;I<k;I++)A[N+I]=E[H+I]-(E[H+I-P]>>1)+256&255;if(D==4)for(I=P;I<k;I++)A[N+I]=E[H+I]-n(E[H+I-P],0,0)+256&255}else{if(D==2)for(I=0;I<k;I++)A[N+I]=E[H+I]+256-E[H+I-k]&255;if(D==3){for(I=0;I<P;I++)A[N+I]=E[H+I]+256-(E[H+I-k]>>1)&255;for(I=P;I<k;I++)A[N+I]=E[H+I]+256-(E[H+I-k]+E[H+I-P]>>1)&255}if(D==4){for(I=0;I<P;I++)A[N+I]=E[H+I]+256-n(0,E[H+I-k],0)&255;for(I=P;I<k;I++)A[N+I]=E[H+I]+256-n(E[H+I-P],E[H+I-k],E[H+I-P-k])&255}}}function g(A,E){const S=new Uint8Array(A),k=S.slice(0),P=new Uint32Array(k.buffer),D=b(k,E),H=D[0],N=D[1],I=S.length,$=new Uint8Array(I>>2);let V;if(S.length<2e7)for(var U=0;U<I;U+=4)V=w(H,W=S[U]*(1/255),ee=S[U+1]*(1/255),X=S[U+2]*(1/255),he=S[U+3]*(1/255)),$[U>>2]=V.ind,P[U>>2]=V.est.rgba;else for(U=0;U<I;U+=4){var W=S[U]*.00392156862745098,ee=S[U+1]*(1/255),X=S[U+2]*(1/255),he=S[U+3]*(1/255);for(V=H;V.left;)V=x(V.est,W,ee,X,he)<=0?V.left:V.right;$[U>>2]=V.ind,P[U>>2]=V.est.rgba}return{abuf:k.buffer,inds:$,plte:N}}function b(A,E,S){S==null&&(S=1e-4);const k=new Uint32Array(A.buffer),P={i0:0,i1:A.length,bst:null,est:null,tdst:0,left:null,right:null};P.bst=O(A,P.i0,P.i1),P.est=_(P.bst);const D=[P];for(;D.length<E;){let N=0,I=0;for(var H=0;H<D.length;H++)D[H].est.L>N&&(N=D[H].est.L,I=H);if(N<S)break;const $=D[I],V=T(A,k,$.i0,$.i1,$.est.e,$.est.eMq255);if($.i0>=V||$.i1<=V){$.est.L=0;continue}const U={i0:$.i0,i1:V,bst:null,est:null,tdst:0,left:null,right:null};U.bst=O(A,U.i0,U.i1),U.est=_(U.bst);const W={i0:V,i1:$.i1,bst:null,est:null,tdst:0,left:null,right:null};for(W.bst={R:[],m:[],N:$.bst.N-U.bst.N},H=0;H<16;H++)W.bst.R[H]=$.bst.R[H]-U.bst.R[H];for(H=0;H<4;H++)W.bst.m[H]=$.bst.m[H]-U.bst.m[H];W.est=_(W.bst),$.left=U,$.right=W,D[I]=U,D.push(W)}for(D.sort(((N,I)=>I.bst.N-N.bst.N)),H=0;H<D.length;H++)D[H].ind=H;return[P,D]}function w(A,E,S,k,P){if(A.left==null)return A.tdst=(function(U,W,ee,X,he){const oe=W-U[0],Y=ee-U[1],be=X-U[2],Re=he-U[3];return oe*oe+Y*Y+be*be+Re*Re})(A.est.q,E,S,k,P),A;const D=x(A.est,E,S,k,P);let H=A.left,N=A.right;D>0&&(H=A.right,N=A.left);const I=w(H,E,S,k,P);if(I.tdst<=D*D)return I;const $=w(N,E,S,k,P);return $.tdst<I.tdst?$:I}function x(A,E,S,k,P){const{e:D}=A;return D[0]*E+D[1]*S+D[2]*k+D[3]*P-A.eMq}function T(A,E,S,k,P,D){for(k-=4;S<k;){for(;M(A,S,P)<=D;)S+=4;for(;M(A,k,P)>D;)k-=4;if(S>=k)break;const H=E[S>>2];E[S>>2]=E[k>>2],E[k>>2]=H,S+=4,k-=4}for(;M(A,S,P)>D;)S-=4;return S+4}function M(A,E,S){return A[E]*S[0]+A[E+1]*S[1]+A[E+2]*S[2]+A[E+3]*S[3]}function O(A,E,S){const k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],P=[0,0,0,0],D=S-E>>2;for(let H=E;H<S;H+=4){const N=A[H]*.00392156862745098,I=A[H+1]*(1/255),$=A[H+2]*(1/255),V=A[H+3]*(1/255);P[0]+=N,P[1]+=I,P[2]+=$,P[3]+=V,k[0]+=N*N,k[1]+=N*I,k[2]+=N*$,k[3]+=N*V,k[5]+=I*I,k[6]+=I*$,k[7]+=I*V,k[10]+=$*$,k[11]+=$*V,k[15]+=V*V}return k[4]=k[1],k[8]=k[2],k[9]=k[6],k[12]=k[3],k[13]=k[7],k[14]=k[11],{R:k,m:P,N:D}}function _(A){const{R:E}=A,{m:S}=A,{N:k}=A,P=S[0],D=S[1],H=S[2],N=S[3],I=k==0?0:1/k,$=[E[0]-P*P*I,E[1]-P*D*I,E[2]-P*H*I,E[3]-P*N*I,E[4]-D*P*I,E[5]-D*D*I,E[6]-D*H*I,E[7]-D*N*I,E[8]-H*P*I,E[9]-H*D*I,E[10]-H*H*I,E[11]-H*N*I,E[12]-N*P*I,E[13]-N*D*I,E[14]-N*H*I,E[15]-N*N*I],V=$,U=L;let W=[Math.random(),Math.random(),Math.random(),Math.random()],ee=0,X=0;if(k!=0)for(let oe=0;oe<16&&(W=U.multVec(V,W),X=Math.sqrt(U.dot(W,W)),W=U.sml(1/X,W),!(oe!=0&&Math.abs(X-ee)<1e-9));oe++)ee=X;const he=[P*I,D*I,H*I,N*I];return{Cov:$,q:he,e:W,L:ee,eMq255:U.dot(U.sml(255,he),W),eMq:U.dot(W,he),rgba:(Math.round(255*he[3])<<24|Math.round(255*he[2])<<16|Math.round(255*he[1])<<8|Math.round(255*he[0])<<0)>>>0}}var L={multVec:(A,E)=>[A[0]*E[0]+A[1]*E[1]+A[2]*E[2]+A[3]*E[3],A[4]*E[0]+A[5]*E[1]+A[6]*E[2]+A[7]*E[3],A[8]*E[0]+A[9]*E[1]+A[10]*E[2]+A[11]*E[3],A[12]*E[0]+A[13]*E[1]+A[14]*E[2]+A[15]*E[3]],dot:(A,E)=>A[0]*E[0]+A[1]*E[1]+A[2]*E[2]+A[3]*E[3],sml:(A,E)=>[A*E[0],A*E[1],A*E[2],A*E[3]]};pi.encode=function(E,S,k,P,D,H,N){P==null&&(P=0),N==null&&(N=!1);const I=u(E,S,k,P,[!1,!1,!1,0,N,!1]);return c(I,-1),l(I,S,k,D,H)},pi.encodeLL=function(E,S,k,P,D,H,N,I){const $={ctype:0+(P==1?0:2)+(D==0?0:4),depth:H,frames:[]},V=(P+D)*H,U=V*S;for(let W=0;W<E.length;W++)$.frames.push({rect:{x:0,y:0,width:S,height:k},img:new Uint8Array(E[W]),blend:0,dispose:1,bpp:Math.ceil(V/8),bpl:Math.ceil(U/8)});return c($,0,!0),l($,S,k,N,I)},pi.encode.compress=u,pi.encode.dither=a,pi.quantize=g,pi.quantize.getKDtree=b,pi.quantize.getNearest=w})();const M4={toArrayBuffer(t,e){const n=t.width,r=t.height,i=n<<2,s=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(s.data.buffer),a=(32*n+31)/32<<2,l=a*r,c=122+l,u=new ArrayBuffer(c),f=new DataView(u),h=1<<20;let d,p,g,b,w=h,x=0,T=0,M=0;function O(A){f.setUint16(T,A,!0),T+=2}function _(A){f.setUint32(T,A,!0),T+=4}function L(A){T+=A}O(19778),_(c),L(4),_(122),_(108),_(n),_(-r>>>0),O(1),O(32),_(3),_(l),_(2835),_(2835),L(8),_(16711680),_(65280),_(255),_(4278190080),_(1466527264),(function A(){for(;x<r&&w>0;){for(b=122+x*a,d=0;d<i;)w--,p=o[M++],g=p>>>24,f.setUint32(b+d,p<<8|g),d+=4;x++}M<o.length?(w=h,setTimeout(A,M4._dly)):e(u)})()},toBlob(t,e){this.toArrayBuffer(t,(n=>{e(new Blob([n],{type:"image/bmp"}))}))},_dly:9};var Ar={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},EV={[Ar.CHROME]:16384,[Ar.FIREFOX]:11180,[Ar.DESKTOP_SAFARI]:16384,[Ar.IE]:8192,[Ar.IOS]:4096,[Ar.ETC]:8192};const b1=typeof window<"u",N4=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,ad=b1&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),xV=(b1||N4)&&(ad&&ad.getOriginalSymbol(window,"File")||typeof File<"u"&&File),L4=(b1||N4)&&(ad&&ad.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function w1(t,e,n=Date.now()){return new Promise((r=>{const i=t.split(","),s=i[0].match(/:(.*?);/)[1],o=globalThis.atob(i[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const c=new Blob([l],{type:s});c.name=e,c.lastModified=n,r(c)}))}function R4(t){return new Promise(((e,n)=>{const r=new L4;r.onload=()=>e(r.result),r.onerror=i=>n(i),r.readAsDataURL(t)}))}function P4(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=i=>n(i),r.src=t}))}function Ea(){if(Ea.cachedResult!==void 0)return Ea.cachedResult;let t=Ar.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Ar.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Ar.IOS:/Safari/i.test(e)?t=Ar.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Ar.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Ar.IE),Ea.cachedResult=t,Ea.cachedResult}function D4(t,e){const n=Ea(),r=EV[n];let i=t,s=e,o=i*s;const a=i>s?s/i:i/s;for(;o>r*r;){const l=(r+i)/2,c=(r+s)/2;l<c?(s=c,i=c*a):(s=l*a,i=l),o=i*s}return{width:i,height:s}}function mp(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function B4(t,e){const{width:n,height:r}=D4(t.width,t.height),[i,s]=mp(n,r);return e&&/jpe?g/.test(e)&&(s.fillStyle="white",s.fillRect(0,0,i.width,i.height)),s.drawImage(t,0,0,i.width,i.height),i}function Ff(){return Ff.cachedResult!==void 0||(Ff.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Ff.cachedResult}function ld(t,e={}){return new Promise((function(n,r){let i,s;var o=function(){try{return s=B4(i,e.fileType||t.type),n([i,s])}catch(l){return r(l)}},a=function(l){try{var c=function(u){try{throw u}catch(f){return r(f)}};try{let u;return R4(t).then((function(f){try{return u=f,P4(u).then((function(h){try{return i=h,(function(){try{return o()}catch(d){return r(d)}})()}catch(d){return c(d)}}),c)}catch(h){return c(h)}}),c)}catch(u){c(u)}}catch(u){return r(u)}};try{if(Ff()||[Ar.DESKTOP_SAFARI,Ar.MOBILE_SAFARI].includes(Ea()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then((function(l){try{return i=l,o()}catch{return a()}}),a)}catch{a()}}))}function cd(t,e,n,r,i=1){return new Promise((function(s,o){let a;if(e==="image/png"){let f,h,d;return f=t.getContext("2d"),{data:h}=f.getImageData(0,0,t.width,t.height),d=pi.encode([h.buffer],t.width,t.height,4096*i),a=new Blob([d],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let f=function(){return l.call(this)};var c=f;if(e==="image/bmp")return new Promise((h=>M4.toBlob(t,h))).then((function(h){try{return a=h,a.name=n,a.lastModified=r,f.call(this)}catch(d){return o(d)}}).bind(this),o);{let h=function(){return f.call(this)};var u=h;if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:i}).then((function(d){try{return a=d,a.name=n,a.lastModified=r,h.call(this)}catch(p){return o(p)}}).bind(this),o);{let d;return d=t.toDataURL(e,i),w1(d,n,r).then((function(p){try{return a=p,h.call(this)}catch(g){return o(g)}}).bind(this),o)}}}function l(){return s(a)}}))}function Pi(t){t.width=0,t.height=0}function gl(){return new Promise((function(t,e){let n,r,i,s;return gl.cachedResult!==void 0?t(gl.cachedResult):w1("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(o){try{return n=o,ld(n).then((function(a){try{return r=a[1],cd(r,n.type,n.name,n.lastModified).then((function(l){try{return i=l,Pi(r),ld(i).then((function(c){try{return s=c[0],gl.cachedResult=s.width===1&&s.height===2,t(gl.cachedResult)}catch(u){return e(u)}}),e)}catch(c){return e(c)}}),e)}catch(l){return e(l)}}),e)}catch(a){return e(a)}}),e)}))}function H4(t){return new Promise(((e,n)=>{const r=new L4;r.onload=i=>{const s=new DataView(i.target.result);if(s.getUint16(0,!1)!=65496)return e(-2);const o=s.byteLength;let a=2;for(;a<o;){if(s.getUint16(a+2,!1)<=8)return e(-1);const l=s.getUint16(a,!1);if(a+=2,l==65505){if(s.getUint32(a+=2,!1)!=1165519206)return e(-1);const c=s.getUint16(a+=6,!1)==18761;a+=s.getUint32(a+4,c);const u=s.getUint16(a,c);a+=2;for(let f=0;f<u;f++)if(s.getUint16(a+12*f,c)==274)return e(s.getUint16(a+12*f+8,c))}else{if((65280&l)!=65280)break;a+=s.getUint16(a,!1)}}return e(-1)},r.onerror=i=>n(i),r.readAsArrayBuffer(t)}))}function U4(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:i}=e;let s,o=t;return isFinite(i)&&(n>i||r>i)&&([o,s]=mp(n,r),n>r?(o.width=i,o.height=r/n*i):(o.width=n/r*i,o.height=i),s.drawImage(t,0,0,o.width,o.height),Pi(t)),o}function z4(t,e){const{width:n}=t,{height:r}=t,[i,s]=mp(n,r);switch(e>4&&e<9?(i.width=r,i.height=n):(i.width=n,i.height=r),e){case 2:s.transform(-1,0,0,1,n,0);break;case 3:s.transform(-1,0,0,-1,n,r);break;case 4:s.transform(1,0,0,-1,0,r);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,r,0);break;case 7:s.transform(0,-1,-1,0,r,n);break;case 8:s.transform(0,-1,1,0,0,n)}return s.drawImage(t,0,0,n,r),Pi(t),i}function ox(t,e,n=0){return new Promise((function(r,i){let s,o,a,l,c,u,f,h,d,p,g,b,w,x,T,M,O,_,L,A;function E(k=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;s+=k,e.onProgress(Math.min(s,100))}function S(k){if(e.signal&&e.signal.aborted)throw e.signal.reason;s=Math.min(Math.max(k,s),100),e.onProgress(s)}return s=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,E(),ld(t,e).then((function(k){try{return[,l]=k,E(),c=U4(l,e),E(),new Promise((function(P,D){var H;if(!(H=e.exifOrientation))return H4(t).then((function(I){try{return H=I,N.call(this)}catch($){return D($)}}).bind(this),D);function N(){return P(H)}return N.call(this)})).then((function(P){try{return u=P,E(),gl().then((function(D){try{return f=D?c:z4(c,u),E(),h=e.initialQuality||1,d=e.fileType||t.type,cd(f,d,t.name,t.lastModified,h).then((function(H){try{{let V=function(){if(o--&&(T>a||T>w)){let W,ee;return W=A?.95*L.width:L.width,ee=A?.95*L.height:L.height,[O,_]=mp(W,ee),_.drawImage(L,0,0,W,ee),h*=d==="image/png"?.85:.95,cd(O,d,t.name,t.lastModified,h).then((function(X){try{return M=X,Pi(L),L=O,T=M.size,S(Math.min(99,Math.floor((x-T)/(x-a)*100))),V}catch(he){return i(he)}}),i)}return[1]},U=function(){return Pi(L),Pi(O),Pi(c),Pi(f),Pi(l),S(100),r(M)};var I=V,$=U;if(p=H,E(),g=p.size>a,b=p.size>t.size,!g&&!b)return S(100),r(p);var N;return w=t.size,x=p.size,T=x,L=f,A=!e.alwaysKeepResolution&&g,(N=(function(W){for(;W;){if(W.then)return void W.then(N,i);try{if(W.pop){if(W.length)return W.pop()?U.call(this):W;W=V}else W=W.call(this)}catch(ee){return i(ee)}}}).bind(this))(V)}}catch(V){return i(V)}}).bind(this),i)}catch(H){return i(H)}}).bind(this),i)}catch(D){return i(D)}}).bind(this),i)}catch(P){return i(P)}}).bind(this),i)}))}const SV=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let Cm;function AV(t,e){return new Promise(((n,r)=>{Cm||(Cm=(function(o){const a=[];return a.push(o),URL.createObjectURL(new Blob(a))})(SV));const i=new Worker(Cm);i.addEventListener("message",(function(o){if(e.signal&&e.signal.aborted)i.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void i.terminate();n(o.data.file),i.terminate()}else e.onProgress(o.data.progress)})),i.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",(()=>{r(e.signal.reason),i.terminate()})),i.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})}))}function Jn(t,e){return new Promise((function(n,r){let i,s,o,a,l,c;if(i={...e},o=0,{onProgress:a}=i,i.maxSizeMB=i.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof i.useWebWorker!="boolean"||i.useWebWorker,delete i.useWebWorker,i.onProgress=d=>{o=d,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof xV))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(c=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||c)return ox(t,i).then((function(d){try{return s=d,h.call(this)}catch(p){return r(p)}}).bind(this),r);var u=(function(){try{return h.call(this)}catch(d){return r(d)}}).bind(this),f=function(d){try{return ox(t,i).then((function(p){try{return s=p,u()}catch(g){return r(g)}}),r)}catch(p){return r(p)}};try{return i.libURL=i.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",AV(t,i).then((function(d){try{return s=d,u()}catch{return f()}}),f)}catch{f()}function h(){try{s.name=t.name,s.lastModified=t.lastModified}catch{}try{i.preserveExif&&t.type==="image/jpeg"&&(!i.fileType||i.fileType&&i.fileType===t.type)&&(s=$4(t,s))}catch{}return n(s)}}))}Jn.getDataUrlFromFile=R4,Jn.getFilefromDataUrl=w1,Jn.loadImage=P4,Jn.drawImageInCanvas=B4,Jn.drawFileInCanvas=ld,Jn.canvasToFile=cd,Jn.getExifOrientation=H4,Jn.handleMaxWidthOrHeight=U4,Jn.followExifOrientation=z4,Jn.cleanupCanvasMemory=Pi,Jn.isAutoOrientationInBrowser=gl,Jn.approximateBelowMaximumCanvasSizeOfBrowser=D4,Jn.copyExifWithoutOrientation=$4,Jn.getBrowserName=Ea,Jn.version="2.0.2";var ol=Symbol("verified"),kV=t=>t instanceof Object;function _V(t){if(!kV(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}new TextDecoder("utf-8");var F4=new TextEncoder,CV=class{generateSecretKey(){return Bi.utils.randomPrivateKey()}getPublicKey(t){return un(Bi.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=un(Bi.getPublicKey(e)),n.id=Tm(n),n.sig=un(Bi.sign(Tm(n),e)),n[ol]=!0,n}verifyEvent(t){if(typeof t[ol]=="boolean")return t[ol];const e=Tm(t);if(e!==t.id)return t[ol]=!1,!1;try{const n=Bi.verify(t.sig,e,t.pubkey);return t[ol]=n,n}catch{return t[ol]=!1,!1}}};function TV(t){if(!_V(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Tm(t){let e=Ga(F4.encode(TV(t)));return un(e)}var yp=new CV;yp.generateSecretKey;yp.getPublicKey;yp.finalizeEvent;yp.verifyEvent;var IV=27235,OV="Nostr ";async function $V(t,e,n,r=!1,i){const s={kind:IV,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""},o=await n(s);return(r?OV:"")+Yi.encode(F4.encode(JSON.stringify(o)))}const MV=Hr(!1),j4=Hr([]);async function NV(t){let e=[];t?e=t:j4.subscribe(r=>e=r)();const n=e?.join(`
`)??"";if(n){if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function")try{await navigator.clipboard.writeText(n);return}catch{}try{const r=document.createElement("textarea");r.value=n,r.setAttribute("readonly",""),r.style.position="absolute",r.style.left="-9999px",r.style.fontSize="12px",document.body.appendChild(r),r.focus(),r.select();try{r.setSelectionRange(0,r.value.length)}catch{}const i=document.execCommand&&document.execCommand("copy");if(document.body.removeChild(r),i)return;throw new Error("execCommand copy failed")}catch(r){throw r}}}function mo(...t){}async function LV(t){}typeof window<"u"&&(window.showSwUpdateModalDebug=()=>{Db.set(!0),console.log("SW更新ボタンを強制表示しました（設定ボタンランプ＋SettingsDialog内）")});class Gc{static getCompressionOptions(){const e=localStorage.getItem("imageCompressionLevel")||"medium",n=RB[e];return typeof n=="object"&&"skip"in n&&n.skip?null:{...n,preserveExif:!1}}static _webpQualitySupport;static async canEncodeWebpWithQuality(){if(this._webpQualitySupport!==void 0)return this._webpQualitySupport;try{if(typeof document>"u")return this._webpQualitySupport=!1;const e=document.createElement("canvas");e.width=2,e.height=2;const n=e.getContext("2d");if(!n)return this._webpQualitySupport=!1;n.fillStyle="#f00",n.fillRect(0,0,2,2);const r=e.toDataURL("image/webp",.2),i=e.toDataURL("image/webp",.9),s=r.startsWith("data:image/webp")&&i.startsWith("data:image/webp")&&r.length!==i.length;return this._webpQualitySupport=s,s}catch{return this._webpQualitySupport=!1,!1}}static _mimeSupportCache={};static canEncodeMimeType(e){if(!e)return!1;if(e in this._mimeSupportCache)return this._mimeSupportCache[e];try{if(typeof document>"u")return this._mimeSupportCache[e]=!1;const n=document.createElement("canvas");n.width=2,n.height=2;const r=n.getContext("2d");if(!r)return this._mimeSupportCache[e]=!1;r.fillStyle="#000",r.fillRect(0,0,2,2);const i=n.toDataURL(e),s=typeof i=="string"&&i.startsWith(`data:${e}`);return this._mimeSupportCache[e]=s,s}catch{return this._mimeSupportCache[e]=!1,!1}}static renameByMime(e,n){const i={"image/webp":".webp","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/avif":".avif","image/bmp":".bmp"}[n];return i?`${e.replace(/\.[^.]+$/,"")}${i}`:e}static async compressImage(e){if(!e.type.startsWith("image/"))return{file:e,wasCompressed:!1};if(e.size<=20*1024)return{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(!n)return{file:e,wasCompressed:!1,wasSkipped:!0};let r={...n};r.fileType==="image/webp"&&!await this.canEncodeWebpWithQuality()&&delete r.fileType;let i=r.fileType||e.type;if(r.fileType&&!this.canEncodeMimeType(r.fileType)&&(delete r.fileType,i=e.type),!this.canEncodeMimeType(i))return{file:e,wasCompressed:!1,wasSkipped:!0};try{const s=await Jn(e,r);if(s.size>=e.size)return{file:e,wasCompressed:!1};const o=s.type||i||e.type,a=this.renameByMime(e.name,o);return{file:new File([s],a,{type:o}),wasCompressed:!0}}catch{return{file:e,wasCompressed:!1,wasSkipped:!0}}}static validateImageFile(e){return e.type.startsWith("image/")?e.size>LB?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}:{isValid:!1,errorMessage:"only_images_allowed"}}static getUploadEndpoint(e){const n=localStorage.getItem("uploadEndpoint"),r=i=>i&&i.trim().length>0?i:void 0;return r(n)??r(e)??vc}static async buildAuthHeader(e,n="POST"){const r=Hi.getFromStore()||Hi.loadFromStorage();let i;if(r)i=s=>xA(r).signEvent(s);else{const s=window?.nostr;if(s?.signEvent)i=o=>s.signEvent(o);else throw new Error("Authentication required")}return await $V(e,n,i,!0)}static async pollUploadStatus(e,n,r=8e3){const i=Date.now();for(;;){if(Date.now()-i>r)throw new Error("Timeout while polling processing_url");const s=await fetch(e,{method:"GET",headers:{Authorization:n}});if(!s.ok)throw new Error(`Unexpected status code ${s.status} while polling processing_url`);if(s.status===201)return await s.json();const o=await s.json();if(o.status==="processing"){await new Promise(a=>setTimeout(a,1e3));continue}throw o.status==="error"?new Error("File processing failed"):new Error("Unexpected processing status")}}static async uploadFile(e,n=vc){try{if(!e)return{success:!1,error:"No file selected"};const r=e.size,{file:i,wasCompressed:s,wasSkipped:o}=await this.compressImage(e),a=i.size,c=this.getCompressionOptions()!==null,u=fj(r,a,c||s,e.name,i.name,o),f=this.getUploadEndpoint(n),h=await this.buildAuthHeader(f,"POST"),d=new FormData;d.append("file",i),d.append("uploadtype","media");const p=await fetch(f,{method:"POST",headers:{Authorization:h},body:d});await LV(p);let g;try{g=await p.json()}catch{return{success:!1,error:"Could not parse upload response",sizeInfo:u}}if((p.status===200||p.status===202)&&g.processing_url)try{const b=await this.buildAuthHeader(g.processing_url,"GET");g=await this.pollUploadStatus(g.processing_url,b,8e3)}catch(b){return{success:!1,error:b instanceof Error?b.message:String(b),sizeInfo:u}}if(g.status==="success"&&g.nip94_event?.tags){const b=g.nip94_event.tags.find(w=>w[0]==="url");if(b?.[1])return{success:!0,url:b[1],sizeInfo:u}}return{success:!1,error:g.message||"Could not extract URL from response",sizeInfo:u}}catch(r){return{success:!1,error:r instanceof Error?r.message:String(r)}}}static async uploadMultipleFiles(e,n=vc,r){if(!e?.length)return[];const i=new Array(e.length);let s=0,o=0;const a=()=>r?.({completed:s,failed:o,total:e.length,inProgress:s+o<e.length});return a(),await Promise.all(e.map(async(l,c)=>{try{const u=await this.uploadFile(l,n);i[c]=u,u.success?s++:o++,a()}catch(u){i[c]={success:!1,error:u instanceof Error?u.message:String(u)},o++,a()}})),i}static async uploadFileWithCallbacks(e,n=vc,r){r?.onProgress?.({completed:0,failed:0,total:1,inProgress:!0});try{const i=await this.uploadFile(e,n);if(r?.onProgress?.({completed:i.success?1:0,failed:i.success?0:1,total:1,inProgress:!1}),i.success&&i.sizeInfo){const s=UE(i.sizeInfo);s&&M2(s)}return i}catch(i){return r?.onProgress?.({completed:0,failed:1,total:1,inProgress:!1}),{success:!1,error:i instanceof Error?i.message:String(i)}}}static async uploadMultipleFilesWithCallbacks(e,n=vc,r){if(!e?.length)return[];const i=await this.uploadMultipleFiles(e,n,r?.onProgress),s=i.find(o=>o.success&&o.sizeInfo);if(s?.sizeInfo){const o=UE(s.sizeInfo);o&&M2(o)}return i}static createSWMessagePromise(e){return new Promise(n=>{let r;const i=()=>clearTimeout(r);if(e){const s=new MessageChannel;s.port1.onmessage=o=>{i(),o.data?.type==="SHARED_IMAGE"&&o.data?.data?.image?n({image:o.data.data.image,metadata:o.data.data.metadata||{}}):n(null)},r=window.setTimeout(()=>n(null),3e3),navigator.serviceWorker.controller?.postMessage({action:"getSharedImage"},[s.port2])}else{const s=o=>{i(),navigator.serviceWorker.removeEventListener("message",s),o.data?.type==="SHARED_IMAGE"&&o.data?.data?.image?n({image:o.data.data.image,metadata:o.data.data.metadata||{}}):n(null)};navigator.serviceWorker.addEventListener("message",s),r=window.setTimeout(()=>{navigator.serviceWorker.removeEventListener("message",s),n(null)},3e3),navigator.serviceWorker.controller?.postMessage({action:"getSharedImage"})}})}static async getSharedImageFromServiceWorker(){if(localStorage.getItem("sharedImageProcessed")==="1"||!navigator.serviceWorker.controller)return null;try{const e=new Promise(n=>setTimeout(()=>n(null),5e3));return await Promise.race([this.createSWMessagePromise(!0),this.createSWMessagePromise(!1),e])}catch{return null}}static checkIfOpenedFromShare(){return new URLSearchParams(window.location.search).get("shared")==="true"}static async processSharedImage(){const e=await this.getSharedImageFromServiceWorker();return e?.image?await this.uploadFile(e.image):null}}function RV(t,e){e()&&e()(t)}var PV=Qe("<button><!></button>");function dn(t,e){jn(e,!0);let n=dt(e,"className",3,""),r=dt(e,"disabled",3,!1),i=dt(e,"type",3,"button"),s=dt(e,"ariaLabel",3,""),o=dt(e,"style",3,""),a=dt(e,"variant",3,"default"),l=dt(e,"shape",3,"rounded"),c=dt(e,"onClick",3,void 0);var u=PV();u.__click=[RV,c];var f=Ie(u);nu(f,()=>e.children??yi),ut(()=>{nn(u,"type",i()),Ka(u,1,`${n()} ${a()} ${l()}`,"svelte-1obgyf0"),u.disabled=r(),nn(u,"aria-label",s()),Ry(u,o())}),$e(t,u),qn()}zs(["click"]);var DV=t=>t.stopPropagation(),BV=(t,e)=>{t.key==="Escape"&&e()},HV=Qe('<div class="xmark-icon svg-icon svelte-1mgwkp5" aria-label="閉じる"></div>'),UV=Qe('<div class="dialog-footer svelte-1mgwkp5"><!></div>'),zV=Qe('<div class="dialog-overlay svelte-1mgwkp5" role="presentation"><div role="dialog" aria-modal="true" tabindex="0"><div class="dialog-content svelte-1mgwkp5"><!></div> <!></div></div>');function bp(t,e){jn(e,!0);let n=dt(e,"show",15,!1),r=dt(e,"ariaLabel",3,"Dialog"),i=dt(e,"className",3,""),s=dt(e,"showFooter",3,!1),o=dt(e,"useHistory",3,!0),a=He(!1),l=He(null);const c=()=>{n(!1)},u=p=>{F(a)&&p.state?.modalId!==F(l)&&c()};at(()=>{if(typeof window>"u"){ye(a,n(),!0),n()||e.onClose?.();return}if(!o()){ye(a,n(),!0),n()||e.onClose?.();return}if(n()&&!F(a)){ye(a,!0),F(l)||(ye(l,`modal-${Date.now()}-${Math.random().toString(36).slice(2,11)}`),history.pushState({modalId:F(l)},"",window.location.href));return}if(!n()&&F(a)){const p=history.state?.modalId===F(l);ye(a,!1),ye(l,null),p&&history.back(),e.onClose?.()}}),Zo(()=>{o()&&window.addEventListener("popstate",u)}),_u(()=>{o()&&(window.removeEventListener("popstate",u),F(a)&&history.state?.modalId===F(l)&&history.back())});var f=pn(),h=Ct(f);{var d=p=>{var g=zV();g.__click=c;var b=Ie(g);let w;b.__click=[DV],b.__keydown=[BV,c];var x=Ie(b),T=Ie(x);nu(T,()=>e.children??yi,()=>({close:c}));var M=We(x,2);{var O=_=>{var L=UV(),A=Ie(L);{var E=k=>{var P=pn(),D=Ct(P);nu(D,()=>e.footer,()=>({close:c})),$e(k,P)},S=k=>{dn(k,{className:"modal-close",onClick:c,ariaLabel:"閉じる",children:(P,D)=>{var H=HV();$e(P,H)},$$slots:{default:!0}})};ft(A,k=>{e.footer?k(E):k(S,!1)})}$e(_,L)};ft(M,_=>{s()&&_(O)})}ut(()=>{nn(g,"aria-label",r()),w=Ka(b,1,`dialog ${i()??""}`,"svelte-1mgwkp5",w,{dialog:!0})}),$e(p,g)};ft(h,p=>{F(a)&&p(d)})}$e(t,f),qn()}zs(["click","keydown"]);let Rt=rn({scale:Rn.DEFAULT_SCALE,translate:{x:0,y:0},useTransition:!0}),ay=null;function FV(t,e){if(!ay)return t;const{imageWidth:n,imageHeight:r,containerWidth:i,containerHeight:s}=ay,o=n*e,a=r*e;let l=t.x,c=t.y;if(o>i){const h=(o-i)/2,d=-h;l=Y0(l,d,h)}else l=0;const u=a/2,f=-u;return c=Y0(c,f,u),{x:l,y:c}}const di={get state(){return Rt},reset(){Rt.scale=Rn.DEFAULT_SCALE,Rt.translate={x:0,y:0},Rt.useTransition=!0},setDirectState(t){Rt.scale=t.scale,Rt.translate={...t.translate},Rt.useTransition=t.useTransition??Rt.useTransition},zoom(t){const e=Y0(t.scale,Rn.MIN_SCALE,Rn.MAX_SCALE);if(dj(e,Rn.DEFAULT_SCALE,Rn.THRESHOLD)){this.reset();return}const n=e/Rt.scale;Rt.translate.x=Rt.translate.x*n-t.offsetX*(n-1),Rt.translate.y=Rt.translate.y*n-t.offsetY*(n-1),Rt.scale=e},zoomToPoint(t,e=0,n=0){if(Rt.scale>=Rn.RESET_THRESHOLD){this.reset();return}const r=t/Rt.scale;Rt.translate.x=Rt.translate.x*r-e*(r-1),Rt.translate.y=Rt.translate.y*r-n*(r-1),Rt.scale=t},drag(t,e,n){const r={x:n.x+t,y:n.y+e},i=FV(r,Rt.scale);Rt.translate.x=i.x,Rt.translate.y=i.y},setTransition(t){Rt.useTransition=t},setBoundaryConstraints(t){ay=t}};function jV(){return{isDragging:!1,start:{x:0,y:0},startTranslate:{x:0,y:0}}}function qV(){return{isPinching:!1,initialDistance:0,initialScale:1,centerX:0,centerY:0}}function VV(t,e,n){e(),n(t.clientX,t.clientY)}function WV(t,e,n,r,i){if(!t.target?.closest(".close-button-container"))if(t.preventDefault(),t.touches.length===1){const s=t.touches[0];e(s.clientX,s.clientY,!0)}else t.touches.length===2&&(n(),r(),i(t))}function KV(t,e){t.target?.closest(".close-button-container")||e(t.clientX,t.clientY)}function GV(t,e){t.key==="Escape"&&e()}var ZV=t=>t.stopPropagation(),YV=(t,e)=>{t.stopPropagation(),e()},JV=Qe('<div class="fullscreen-overlay svelte-bptb0i" tabindex="0" role="dialog" aria-label="画像全画面表示"><div class="close-button-container svelte-bptb0i"><button type="button" class="close-button svelte-bptb0i" aria-label="Close fullscreen image"><span class="svg-icon close-icon svelte-bptb0i"></span></button></div> <div class="image-container svelte-bptb0i"><img class="fullscreen-image svelte-bptb0i" draggable="false"/></div></div>');function XV(t,e){jn(e,!0);let n=dt(e,"src",3,""),r=dt(e,"alt",3,""),i=dt(e,"show",15,!1),s=dt(e,"onClose",3,()=>{}),o=He(void 0),a=He(void 0),l=He(void 0),c=di.state,u=jV(),f=qV(),h=null,d=null,p=!1,g=0,b=null;function w({scale:pe,translate:Se,useTransition:_e}){F(l)&&(F(l).style.transition=_e?`transform ${_2.TRANSITION_DURATION} ease`:"none",F(l).style.transform=`scale(${pe}) translate(${Se.x/pe}px, ${Se.y/pe}px)`,F(l).style.transformOrigin="center")}function x(pe,Se,_e){F(l)&&(F(l).style.transition="none",F(l).style.transform=`scale(${pe}) translate(${Se/pe}px, ${_e/pe}px)`)}function T(pe){F(l)&&(F(l).style.cursor=pe>Rn.DEFAULT_SCALE?"grab":"default")}function M(pe){F(a)&&(F(a).style.cursor=pe>Rn.DEFAULT_SCALE?"grab":"default")}function O(pe){di.setTransition(pe)}function _(pe){const Se=pe?"":"none";wa("user-select",Se),wa("-webkit-user-select",Se)}function L(){b!==null&&(clearTimeout(b),b=null)}function A(){p||(history.pushState({imageFullscreen:!0},"",""),p=!0)}function E(){p=!1}function S(){if(F(o)&&F(a)){const pe=F(o).getBoundingClientRect(),Se=F(a).getBoundingClientRect(),_e={imageWidth:pe.width,imageHeight:pe.height,containerWidth:Se.width,containerHeight:Se.height};di.setBoundaryConstraints(_e)}}function k(){h!==null&&cancelAnimationFrame(h),d!==null&&cancelAnimationFrame(d),h=null,d=null,di.reset(),di.setBoundaryConstraints(null),u.isDragging=!1,f.isPinching=!1,g=0,L(),pj()}at(()=>{c=di.state,w(c)});function P(pe){if(pe.preventDefault(),!F(l)||!F(a))return;const Se=pe.deltaY>0?Rn.ZOOM_DELTA.OUT:Rn.ZOOM_DELTA.IN,_e=c.scale*Se,Ye=mj(pe,F(a),c.scale,c.translate,_e);di.zoom(Ye),T(c.scale),M(c.scale)}function D(pe,Se){O(!0),setTimeout(()=>{if(c.scale>=Rn.RESET_THRESHOLD)di.reset();else{const _e=pe!==void 0&&Se!==void 0&&F(a)?yj(F(a),pe,Se):{offsetX:0,offsetY:0};di.zoomToPoint(Rn.DOUBLE_CLICK_SCALE,_e.offsetX,_e.offsetY)}T(c.scale)},100)}function H(pe,Se){u.isDragging=!0,u.start={x:pe,y:Se},u.startTranslate={...c.translate},F(l)&&(F(l).style.cursor="grabbing",O(!1)),F(a)&&(F(a).style.cursor="grabbing"),_(!1)}function N(pe,Se){u.isDragging&&(h!==null&&cancelAnimationFrame(h),h=requestAnimationFrame(()=>{const _e=bj({x:pe,y:Se},u.start);di.drag(_e.x,_e.y,u.startTranslate)}))}function I(){u.isDragging&&(u.isDragging=!1,h!==null&&(cancelAnimationFrame(h),h=null),T(c.scale),M(c.scale),setTimeout(()=>O(!0),50),_(!0))}function $(){u.isDragging&&I()}function V(pe){const[Se,_e]=[pe.touches[0],pe.touches[1]],Ye=Se.clientX-_e.clientX,gt=Se.clientY-_e.clientY,Ue=Math.sqrt(Ye*Ye+gt*gt);Ue>Rn.PINCH_MIN_DISTANCE&&(f.isPinching=!0,f.initialDistance=Ue,f.initialScale=c.scale,f.centerX=(Se.clientX+_e.clientX)/2,f.centerY=(Se.clientY+_e.clientY)/2,O(!1))}function U(pe){!f.isPinching||!F(a)||(d!==null&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{const[Se,_e]=[pe.touches[0],pe.touches[1]],Ye=Se.clientX-_e.clientX,gt=Se.clientY-_e.clientY,Ue=Math.sqrt(Ye*Ye+gt*gt);if(Ue>Rn.PINCH_MIN_DISTANCE){const bt=Ue/f.initialDistance,Mt=Math.max(Rn.MIN_SCALE,Math.min(Rn.MAX_SCALE,f.initialScale*bt));if(!F(a))return;const wt=F(a).getBoundingClientRect(),Bt=wt.width/2,Vn=wt.height/2,li=f.centerX-wt.left-Bt,jt=f.centerY-wt.top-Vn,Cn=Mt/c.scale,Yt=c.translate.x*Cn-li*(Cn-1),Tn=c.translate.y*Cn-jt*(Cn-1);x(Mt,Yt,Tn)}}))}function W(){if(f.isPinching){if(d!==null&&(cancelAnimationFrame(d),d=null),f.isPinching=!1,F(l)){const pe=F(l).style.transform,Se=pe.match(/scale\(([^)]+)\)/),_e=pe.match(/translate\(([^,]+)px,\s*([^)]+)px\)/);if(Se&&_e){const Ye=parseFloat(Se[1]),gt=parseFloat(_e[1])*Ye,Ue=parseFloat(_e[2])*Ye;di.setDirectState({scale:Ye,translate:{x:gt,y:Ue},useTransition:!0})}}O(!0),T(c.scale)}}function ee(pe,Se){const _e=Date.now();if(_e-g<300&&b!==null){L(),$(),D(pe,Se),g=0;return}g=_e,L(),b=Number(setTimeout(()=>{b=null},300))}function X(pe,Se,_e=!1){_e&&ee(pe,Se),H(pe,Se)}function he(pe,Se){u.isDragging&&N(pe,Se)}function oe(){I()}function Y(pe){pe.preventDefault(),pe.touches.length===1&&u.isDragging?he(pe.touches[0].clientX,pe.touches[0].clientY):pe.touches.length===2&&f.isPinching&&U(pe)}function be(pe){pe.preventDefault(),pe.touches.length===0?(oe(),W()):pe.touches.length===1&&f.isPinching&&W()}function Re(pe){u.isDragging&&(pe.preventDefault(),he(pe.clientX,pe.clientY))}function de(){oe()}function Me(pe){i()&&p&&(pe.preventDefault(),k(),E(),i(!1),s()())}function ce(){k(),i(!1),s()(),p&&(E(),history.back()),gj(UB.EDITOR,_2.EDITOR_FOCUS_DELAY)}at(()=>{i()?(k(),wa("overflow","hidden"),A(),F(o)&&F(o).complete&&S()):(wa("overflow",""),E())});function xe(){const pe=[{event:"mousemove",handler:Re,target:document},{event:"mouseup",handler:de,target:document},{event:"popstate",handler:Me,target:window}];return pe.forEach(({event:Se,handler:_e,target:Ye})=>Ye.addEventListener(Se,_e)),pe}function Te(pe){pe.forEach(({event:Se,handler:_e,target:Ye})=>Ye.removeEventListener(Se,_e))}Zo(()=>{const pe=xe();return()=>{Te(pe),L()}}),_u(()=>{k(),E()});var qe=pn(),et=Ct(qe);{var Ze=pe=>{var Se=JV();Se.__keydown=[GV,ce],Se.__mousedown=[KV,X],Se.__touchstart=[WV,X,I,L,V],Se.__touchmove=Y,Se.__touchend=be;var _e=Ie(Se),Ye=Ie(_e);Ye.__click=ce,Ye.__touchstart=[ZV],Ye.__touchend=[YV,ce];var gt=We(_e,2),Ue=Ie(gt);Ue.__dblclick=[VV,$,D],Ki(Ue,bt=>ye(o,bt),()=>F(o)),Ki(gt,bt=>ye(l,bt),()=>F(l)),Ki(Se,bt=>ye(a,bt),()=>F(a)),ut(()=>{nn(Ue,"src",n()),nn(Ue,"alt",r())}),Ts("wheel",Se,P),Ts("load",Ue,S),$e(pe,Se)};ft(et,pe=>{i()&&pe(Ze)})}$e(t,qe),qn()}zs(["keydown","mousedown","touchstart","touchmove","touchend","click","dblclick"]);function QV(t,e){const n=t.target;n?.files&&n.files.length>0&&e(n.files)}function eW(t){const e=t.target;if(e&&e.closest('.editor-image-button[data-dragging="true"]')){const n=t.touches[0],r=120,i=document.querySelector(".tiptap-editor");if(i){const s=i.getBoundingClientRect(),o=n.clientY<s.top+r,a=n.clientY>s.bottom-r;if(!o&&!a)return t.preventDefault(),!1}}}function tW(t,e){ye(e,!1);const n=document.querySelectorAll(".drop-zone-indicator");n.forEach(r=>{r.classList.remove("drop-zone-hover"),r.classList.add("drop-zone-fade-out")}),setTimeout(()=>{n.forEach(r=>{r.parentNode&&r.parentNode.removeChild(r)})},300)}function nW(t,e,n,r,i){if((t.ctrlKey||t.metaKey)&&(t.key==="Enter"||t.key==="NumpadEnter")){t.preventDefault();const s=Uf(F(e))||"";!F(n).sending&&s.trim()&&r.hasStoredKey&&i()}}var rW=Qe('<div class="upload-error svelte-1wz4afl"> </div>'),iW=Qe('<div class="secretkey-dialog-content svelte-1wz4afl"><div class="secretkey-dialog-message svelte-1wz4afl"> </div> <div class="secretkey-dialog-buttons svelte-1wz4afl"><!> <!></div></div>'),sW=Qe('<div class="post-container svelte-1wz4afl"><div aria-label="テキスト入力エリア" role="textbox" tabindex="0"><!></div> <input type="file" accept="image/*" multiple style="display: none;"/> <!></div> <!> <!>',1);function oW(t,e){jn(e,!0);const n=()=>zn(ts,"$_",r),[r,i]=Qi();let s=He(void 0),o=He(null),a=He(!1),l=He(void 0),c=He(void 0),u=He(!1),f="",h=He(!1),d=He(""),p=He(""),g=It(()=>Gt.postStatus),b=It(()=>Gt.uploadErrorMessage);at(()=>{e.rxNostr&&(F(c)?F(c).setRxNostr(e.rxNostr):ye(c,new mV(e.rxNostr),!0))});function w(ce){let xe=!1;return ce&&ce.descendants(Te=>{Te.type?.name==="image"&&(xe=!0)}),xe}Zo(()=>{const ce=n()("postComponent.enter_your_text")||"テキストを入力してください";ye(s,lV(ce),!0);const xe=F(s).subscribe(pe=>{ye(o,pe,!0)}),Te=pe=>{const Se=pe.detail.plainText;let _e=!1;F(o)&&(_e=w(F(o).state?.doc)),uV(Se,_e)},qe=pe=>{ye(d,pe.detail.src,!0),ye(p,pe.detail.alt,!0),ye(h,!0)};window.addEventListener("editor-content-changed",Te),window.addEventListener("image-fullscreen-request",qe),pV(_);const et=pe=>{if(!pe.clipboardData)return;const Se=[];for(const _e of pe.clipboardData.items)if(_e.kind==="file"&&_e.type.startsWith("image/")){const Ye=_e.getAsFile();Ye&&Se.push(Ye)}Se.length>0&&(pe.preventDefault(),O(Se))},Ze=document.querySelector(".editor-container");return Ze&&Ze.addEventListener("paste",et),()=>{window.removeEventListener("editor-content-changed",Te),window.removeEventListener("image-fullscreen-request",qe),Ze&&Ze.removeEventListener("paste",et);try{xe(),F(o)&&typeof F(o).destroy=="function"&&F(o).destroy()}catch(pe){console.warn("Editor cleanup failed:",pe)}}});const x={onProgress:e.onUploadProgress};async function T(ce){Sc(!0),e.onUploadStatusChange?.(!0);try{return await ce}finally{Sc(!1),e.onUploadStatusChange?.(!1)}}function M(ce,xe=3e3){Sc(Gt.isUploading,ce),setTimeout(()=>Sc(Gt.isUploading,""),xe)}async function O(ce){const xe=Array.from(ce);if(!xe.length)return;const Te=localStorage.getItem("uploadEndpoint")||"",qe=await T((async()=>{Sc(!0,"");try{if(xe.length===1){const et=Gc.validateImageFile(xe[0]);return et.isValid?[await Gc.uploadFileWithCallbacks(xe[0],Te,x)]:(M(n()(et.errorMessage||"postComponent.upload_failed")),null)}return await Gc.uploadMultipleFilesWithCallbacks(xe,Te,x)}catch(et){return M(et instanceof Error?et.message:String(et),5e3),null}})());if(qe){const et=[],Ze=[];for(let pe=0;pe<qe.length;pe++){const Se=qe[pe];Se.success&&Se.url?et.push(Se.url):Se.success||Ze.push(Se)}et.length&&Jq(F(o),et),Ze.length&&M(Ze.length===1?Ze[0].error||n()("postComponent.upload_failed"):`${Ze.length}個のファイルのアップロードに失敗しました`,5e3)}F(l)&&(F(l).value="")}async function _(){if(!F(c))return console.error("PostManager is not initialized");const ce=Uf(F(o))||"";if(hj(ce)){f=ce,ye(u,!0);return}await L(ce)}async function L(ce){if(!F(c))return console.error("PostManager is not initialized");const xe=ce||Uf(F(o))||"";fl({sending:!0,success:!1,error:!1,message:"",completed:!1});try{const Te=await F(c).submitPost(xe);Te.success?(fl({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),F(o)&&F(o).chain().clearContent().run(),e.onPostSuccess?.()):fl({sending:!1,success:!1,error:!0,message:Te.error||"postComponent.post_error",completed:!1})}catch(Te){fl({sending:!1,success:!1,error:!0,message:"postComponent.post_error",completed:!1}),console.error("投稿処理でエラーが発生:",Te)}}function A(){fV(),F(o)&&F(o).chain().clearContent().run()}function E(){F(o)&&F(o).chain().clearContent().run(),hV()}async function S(){ye(u,!1),await L(f),f=""}function k(){ye(u,!1),f=""}function P(ce){ce.preventDefault();const xe=ce.dataTransfer;!!xe&&Array.from(xe.types||[]).some(qe=>qe==="application/x-tiptap-node")?ye(a,!1):ye(a,!0)}function D(ce){ce.preventDefault();const xe=ce.dataTransfer;!!xe&&Array.from(xe.types||[]).some(qe=>qe==="application/x-tiptap-node")||ye(a,!1)}async function H(ce){ce.preventDefault(),ye(a,!1),!ce.dataTransfer?.getData("application/x-tiptap-node")&&ce.dataTransfer?.files&&ce.dataTransfer.files.length>0&&await O(ce.dataTransfer.files)}at(()=>{F(o)&&Uf(F(o))!==Gt.content&&F(g).error&&fl({...F(g),error:!1,message:""})}),at(()=>{sy.value&&F(s)&&setTimeout(()=>{F(s).updatePlaceholder&&F(s).updatePlaceholder(sy.value)},0)});function N(){F(l)?.click()}function I(){ye(h,!1),ye(d,""),ye(p,""),setTimeout(()=>{const ce=document.querySelector(".tiptap-editor");ce&&ce.focus()},150)}var $={uploadFiles:O,submitPost:_,resetPostContent:A,clearContentAfterSuccess:E,openFileDialog:N},V=sW(),U=Ct(V),W=Ie(U);let ee;W.__keydown=[nW,o,g,e,_],W.__touchmove=[eW],W.__touchend=[tW,a];var X=Ie(W);{var he=ce=>{cj(ce,{get editor(){return F(o)},class:"editor-content"})};ft(X,ce=>{F(s)&&F(o)&&ce(he)})}var oe=We(W,2);oe.__change=[QV,O],Ki(oe,ce=>ye(l,ce),()=>F(l));var Y=We(oe,2);{var be=ce=>{var xe=rW(),Te=Ie(xe);ut(()=>ot(Te,F(b))),$e(ce,xe)};ft(Y,ce=>{F(b)&&ce(be)})}var Re=We(U,2);{let ce=It(()=>n()("postComponent.warning"));bp(Re,{get ariaLabel(){return F(ce)},onClose:k,get show(){return F(u)},set show(xe){ye(u,xe,!0)},children:(xe,Te)=>{var qe=iW(),et=Ie(qe),Ze=Ie(et),pe=We(et,2),Se=Ie(pe);dn(Se,{className:"btn-confirm",variant:"danger",shape:"square",onClick:S,children:(Ye,gt)=>{var Ue=Br();ut(bt=>ot(Ue,bt),[()=>n()("postComponent.post")]),$e(Ye,Ue)},$$slots:{default:!0}});var _e=We(Se,2);dn(_e,{className:"btn-cancel",variant:"secondary",shape:"square",onClick:k,children:(Ye,gt)=>{var Ue=Br();ut(bt=>ot(Ue,bt),[()=>n()("postComponent.cancel")]),$e(Ye,Ue)},$$slots:{default:!0}}),ut(Ye=>ot(Ze,Ye),[()=>n()("postComponent.secret_key_detected")]),$e(xe,qe)},$$slots:{default:!0}})}var de=We(Re,2);XV(de,{get src(){return F(d)},get alt(){return F(p)},onClose:I,get show(){return F(h)},set show(ce){ye(h,ce,!0)}}),ut(ce=>ee=Ka(W,1,"editor-container svelte-1wz4afl",null,ee,ce),[()=>({"drag-over":F(a)})]),Ts("dragover",W,P),Ts("dragleave",W,D),Ts("drop",W,H),$e(t,V);var Me=qn($);return i(),Me}zs(["keydown","touchmove","touchend","change"]);/*! MIT License

Copyright (c) 2024 Lokuyow

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
 */var aW={203:(t,e)=>{function n(E){if(!Number.isSafeInteger(E))throw new Error(`Wrong integer: ${E}`)}function r(...E){const S=(D,H)=>N=>D(H(N)),k=Array.from(E).reverse().reduce(((D,H)=>D?S(D,H.encode):H.encode),void 0),P=E.reduce(((D,H)=>D?S(D,H.decode):H.decode),void 0);return{encode:k,decode:P}}function i(E){return{encode:S=>{if(!Array.isArray(S)||S.length&&typeof S[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return S.map((k=>{if(n(k),k<0||k>=E.length)throw new Error(`Digit index outside alphabet: ${k} (alphabet: ${E.length})`);return E[k]}))},decode:S=>{if(!Array.isArray(S)||S.length&&typeof S[0]!="string")throw new Error("alphabet.decode input should be array of strings");return S.map((k=>{if(typeof k!="string")throw new Error(`alphabet.decode: not string element=${k}`);const P=E.indexOf(k);if(P===-1)throw new Error(`Unknown letter: "${k}". Allowed: ${E}`);return P}))}}}function s(E=""){if(typeof E!="string")throw new Error("join separator should be string");return{encode:S=>{if(!Array.isArray(S)||S.length&&typeof S[0]!="string")throw new Error("join.encode input should be array of strings");for(let k of S)if(typeof k!="string")throw new Error(`join.encode: non-string input=${k}`);return S.join(E)},decode:S=>{if(typeof S!="string")throw new Error("join.decode input should be string");return S.split(E)}}}function o(E,S="="){if(n(E),typeof S!="string")throw new Error("padding chr should be string");return{encode(k){if(!Array.isArray(k)||k.length&&typeof k[0]!="string")throw new Error("padding.encode input should be array of strings");for(let P of k)if(typeof P!="string")throw new Error(`padding.encode: non-string input=${P}`);for(;k.length*E%8;)k.push(S);return k},decode(k){if(!Array.isArray(k)||k.length&&typeof k[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of k)if(typeof D!="string")throw new Error(`padding.decode: non-string input=${D}`);let P=k.length;if(P*E%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;P>0&&k[P-1]===S;P--)if(!((P-1)*E%8))throw new Error("Invalid padding: string has too much padding");return k.slice(0,P)}}}function a(E){if(typeof E!="function")throw new Error("normalize fn should be function");return{encode:S=>S,decode:S=>E(S)}}function l(E,S,k){if(S<2)throw new Error(`convertRadix: wrong from=${S}, base cannot be less than 2`);if(k<2)throw new Error(`convertRadix: wrong to=${k}, base cannot be less than 2`);if(!Array.isArray(E))throw new Error("convertRadix: data should be array");if(!E.length)return[];let P=0;const D=[],H=Array.from(E);for(H.forEach((N=>{if(n(N),N<0||N>=S)throw new Error(`Wrong integer: ${N}`)}));;){let N=0,I=!0;for(let $=P;$<H.length;$++){const V=H[$],U=S*N+V;if(!Number.isSafeInteger(U)||S*N/S!==N||U-V!=S*N)throw new Error("convertRadix: carry overflow");if(N=U%k,H[$]=Math.floor(U/k),!Number.isSafeInteger(H[$])||H[$]*k+N!==U)throw new Error("convertRadix: carry overflow");I&&(H[$]?I=!1:P=$)}if(D.push(N),I)break}for(let N=0;N<E.length-1&&E[N]===0;N++)D.push(0);return D.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const c=(E,S)=>S?c(S,E%S):E,u=(E,S)=>E+(S-c(E,S));function f(E,S,k,P){if(!Array.isArray(E))throw new Error("convertRadix2: data should be array");if(S<=0||S>32)throw new Error(`convertRadix2: wrong from=${S}`);if(k<=0||k>32)throw new Error(`convertRadix2: wrong to=${k}`);if(u(S,k)>32)throw new Error(`convertRadix2: carry overflow from=${S} to=${k} carryBits=${u(S,k)}`);let D=0,H=0;const N=2**k-1,I=[];for(const $ of E){if(n($),$>=2**S)throw new Error(`convertRadix2: invalid data word=${$} from=${S}`);if(D=D<<S|$,H+S>32)throw new Error(`convertRadix2: carry overflow pos=${H} from=${S}`);for(H+=S;H>=k;H-=k)I.push((D>>H-k&N)>>>0);D&=2**H-1}if(D=D<<k-H&N,!P&&H>=S)throw new Error("Excess padding");if(!P&&D)throw new Error(`Non-zero padding: ${D}`);return P&&H>0&&I.push(D>>>0),I}function h(E){return n(E),{encode:S=>{if(!(S instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return l(Array.from(S),256,E)},decode:S=>{if(!Array.isArray(S)||S.length&&typeof S[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(l(S,E,256))}}}function d(E,S=!1){if(n(E),E<=0||E>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,E)>32||u(E,8)>32)throw new Error("radix2: carry overflow");return{encode:k=>{if(!(k instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return f(Array.from(k),8,E,!S)},decode:k=>{if(!Array.isArray(k)||k.length&&typeof k[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(f(k,E,8,S))}}}function p(E){if(typeof E!="function")throw new Error("unsafeWrapper fn should be function");return function(...S){try{return E.apply(null,S)}catch{}}}function g(E,S){if(n(E),typeof S!="function")throw new Error("checksum fn should be function");return{encode(k){if(!(k instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const P=S(k).slice(0,E),D=new Uint8Array(k.length+E);return D.set(k),D.set(P,k.length),D},decode(k){if(!(k instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const P=k.slice(0,-E),D=S(P).slice(0,E),H=k.slice(-E);for(let N=0;N<E;N++)if(D[N]!==H[N])throw new Error("Invalid checksum");return P}}}e.utils={alphabet:i,chain:r,checksum:g,radix:h,radix2:d,join:s,padding:o},e.base16=r(d(4),i("0123456789ABCDEF"),s("")),e.base32=r(d(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),e.base32hex=r(d(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),e.base32crockford=r(d(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((E=>E.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(d(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),e.base64url=r(d(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const b=E=>r(h(58),i(E),s(""));e.base58=b("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=b("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=b("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const w=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(E){let S="";for(let k=0;k<E.length;k+=8){const P=E.subarray(k,k+8);S+=e.base58.encode(P).padStart(w[P.length],"1")}return S},decode(E){let S=[];for(let k=0;k<E.length;k+=11){const P=E.slice(k,k+11),D=w.indexOf(P.length),H=e.base58.decode(P);for(let N=0;N<H.length-D;N++)if(H[N]!==0)throw new Error("base58xmr: wrong padding");S=S.concat(Array.from(H.slice(H.length-D)))}return Uint8Array.from(S)}},e.base58check=E=>r(g(4,(S=>E(E(S)))),e.base58);const x=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),T=[996825010,642813549,513874426,1027748829,705979059];function M(E){const S=E>>25;let k=(33554431&E)<<5;for(let P=0;P<T.length;P++)(S>>P&1)==1&&(k^=T[P]);return k}function O(E,S,k=1){const P=E.length;let D=1;for(let H=0;H<P;H++){const N=E.charCodeAt(H);if(N<33||N>126)throw new Error(`Invalid prefix (${E})`);D=M(D)^N>>5}D=M(D);for(let H=0;H<P;H++)D=M(D)^31&E.charCodeAt(H);for(let H of S)D=M(D)^H;for(let H=0;H<6;H++)D=M(D);return D^=k,x.encode(f([D%2**30],30,5,!1))}function _(E){const S=E==="bech32"?1:734539939,k=d(5),P=k.decode,D=k.encode,H=p(P);function N(I,$=90){if(typeof I!="string")throw new Error("bech32.decode input should be string, not "+typeof I);if(I.length<8||$!==!1&&I.length>$)throw new TypeError(`Wrong string length: ${I.length} (${I}). Expected (8..${$})`);const V=I.toLowerCase();if(I!==V&&I!==I.toUpperCase())throw new Error("String must be lowercase or uppercase");const U=(I=V).lastIndexOf("1");if(U===0||U===-1)throw new Error('Letter "1" must be present between prefix and data only');const W=I.slice(0,U),ee=I.slice(U+1);if(ee.length<6)throw new Error("Data must be at least 6 characters long");const X=x.decode(ee).slice(0,-6),he=O(W,X,S);if(!ee.endsWith(he))throw new Error(`Invalid checksum in ${I}: expected "${he}"`);return{prefix:W,words:X}}return{encode:function(I,$,V=90){if(typeof I!="string")throw new Error("bech32.encode prefix should be string, not "+typeof I);if(!Array.isArray($)||$.length&&typeof $[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof $);const U=I.length+7+$.length;if(V!==!1&&U>V)throw new TypeError(`Length ${U} exceeds limit ${V}`);return`${I=I.toLowerCase()}1${x.encode($)}${O(I,$,S)}`},decode:N,decodeToBytes:function(I){const{prefix:$,words:V}=N(I,!1);return{prefix:$,words:V,bytes:P(V)}},decodeUnsafe:p(N),fromWords:P,fromWordsUnsafe:H,toWords:D}}e.bech32=_("bech32"),e.bech32m=_("bech32m"),e.utf8={encode:E=>new TextDecoder().decode(E),decode:E=>new TextEncoder().encode(E)},e.hex=r(d(4),i("0123456789abcdef"),s(""),a((E=>{if(typeof E!="string"||E.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof E} with length ${E.length}`);return E.toLowerCase()})));const L={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},A=`Invalid encoding type. Available types: ${Object.keys(L).join(", ")}`;e.bytesToString=(E,S)=>{if(typeof E!="string"||!L.hasOwnProperty(E))throw new TypeError(A);if(!(S instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return L[E].encode(S)},e.str=e.bytesToString,e.stringToBytes=(E,S)=>{if(!L.hasOwnProperty(E))throw new TypeError(A);if(typeof S!="string")throw new TypeError("stringToBytes() expects string");return L[E].decode(S)},e.bytes=e.stringToBytes},806:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([t.id,`.zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

/* Color Classes Generator */
[class*="zap-amount-"] .zap-sender {
  border-radius: 6px;
}

[class*="zap-amount-"] .zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

[class*="zap-amount-"] .zap-details {
  padding-top: 8px;
  padding-bottom: 8px;
}

/* Amount-based Styles */
.zap-amount-100 .zap-sender {
  background-color: var(--zap-100);
}

.zap-amount-200 .zap-sender {
  background-color: var(--zap-200);
}

.zap-amount-500 .zap-sender {
  background-color: var(--zap-500);
}

.zap-amount-1k .zap-sender {
  background-color: var(--zap-1k);
}

.zap-amount-2k .zap-sender {
  background-color: var(--zap-2k);
}

.zap-amount-5k .zap-sender {
  background-color: var(--zap-5k);
}

.zap-amount-10k .zap-sender {
  background-color: var(--zap-10k);
}

/* Details Background Colors */
.zap-amount-100 .zap-details {
  background-color: var(--zap-100-light);
}

.zap-amount-200 .zap-details {
  background-color: var(--zap-200-light);
}

.zap-amount-500 .zap-details {
  background-color: var(--zap-500-light);
}

.zap-amount-1k .zap-details {
  background-color: var(--zap-1k-light);
}

.zap-amount-2k .zap-details {
  background-color: var(--zap-2k-light);
}

.zap-amount-5k .zap-details {
  background-color: var(--zap-5k-light);
}

.zap-amount-10k .zap-details {
  background-color: var(--zap-10k-light);
}

/* Dark Text Colors */
.zap-amount-100,
.zap-amount-2k,
.zap-amount-5k,
.zap-amount-10k {
  .zap-amount {
    color: var(--text-light);
  }

  .sender-name {
    color: var(--text-light-secondary);
  }

  .sender-pubkey {
    color: var(--text-light-tertiary);
  }

  .zap-comment {
    color: var(--text-light);
  }
}

/* Light Text Colors */
.zap-amount-200,
.zap-amount-500,
.zap-amount-1k {
  .zap-amount {
    color: var(--text-dark);
  }

  .sender-name {
    color: var(--text-dark-secondary);
  }

  .sender-pubkey {
    color: var(--text-dark-tertiary);
  }

  .zap-comment {
    color: var(--text-dark);
  }
}`,""]);const a=o},540:(t,e,n)=>{n.r(e),n.d(e,{default:()=>c});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(806),l=o()(i());l.i(a.A),l.push([t.id,`/* styles.css */

:host {
  --main-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  --main-text: Black;
  --pubkey-text: #888;
  --custom-title-text: #555;
  --stats-item-text: #333;
  --name-text: #444;
  --dialog-bg: #ffffff;
  --zap-stats-bg: #edf2f7;
  --hover-bg: #edf2f7;
  --border: #ddd;
  --skeleton: #fdfdfd;
  --skeleton2: #e2e5ec;
  --zap-stats-skeleton-bg: #bbc5cf;
  --new-mark: #22c55e;

  /* Zap Amount Colors */
  --zap-100: #1565c0;
  --zap-200: #00b8d4;
  --zap-500: #00bfa5;
  --zap-1k: #ffb300;
  --zap-2k: #e65100;
  --zap-5k: #c2185b;
  --zap-10k: #d00000;

  /* Light Variants */
  --zap-100-light: #1e88e5;
  --zap-200-light: #00e5ff;
  --zap-500-light: #1de9b6;
  --zap-1k-light: #ffca28;
  --zap-2k-light: #f57c00;
  --zap-5k-light: #e91e63;
  --zap-10k-light: #e62117;

  /* Text Colors */
  --text-light: #ffffff;
  --text-light-secondary: rgba(255, 255, 255, 0.9);
  --text-light-tertiary: rgba(255, 255, 255, 0.5);
  --text-dark: #000000;
  --text-dark-secondary: rgba(0, 0, 0, 0.7);
  --text-dark-tertiary: rgba(0, 0, 0, 0.5);
}

* {
  box-sizing: border-box;
}

button {
  color: var(--main-text);
  background: none;
  border: none;
  cursor: pointer;
}

.dialog {
  font-family: var(--main-font);
  color: var(--main-text);
  font-size: medium;
  font-weight: normal;
  max-height: 700px;
  height: 100dvh;
  width: 360px;
  margin: auto;
  padding: 0;
  border: none;
  border-radius: 10px;
  background: var(--dialog-bg);
  display: flex;
  flex-direction: column;
}

.close-dialog-button {
  color: var(--custom-title-text);
  font-size: 16px;
  font-weight: 500;
  position: absolute;
  right: 0;
  width: 2.625rem;
  height: 2.625rem;
  border: none;
  border-radius: 50%;
  background: none;
  cursor: pointer;
  padding: 10px;
  text-align: center;
}

.close-dialog-button:hover {
  background-color: var(--hover-bg);
}

.dialog-title {
  height: 42px;
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;

  & a {
    font-size: 0.9rem;
    font-weight: normal;
    color: var(--pubkey-text);
    text-decoration: none;
    cursor: pointer;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
  }

  & a:hover {
    text-decoration: underline;
  }
}

.dialog-title.custom-title a {
  color: var(--custom-title-text);
  font-weight: 600;
  font-size: 1rem;
}

.zap-stats {
  min-height: 80px;
  padding: 6px 14px;
  background: var(--zap-stats-bg);
  border-radius: 6px;
  display: grid;
  grid-template-columns: 90px 1fr 40px;
  grid-template-rows: repeat(3, 1fr);
  gap: 4px;
  margin: 0 8px;

  .stats-item {
    height: 23px;
    color: var(--stats-item-text);
    font-size: 0.9rem;

    .number {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .number.skeleton {
      width: 100%;
      background: linear-gradient(90deg,
          var(--skeleton) 0%,
          var(--zap-stats-skeleton-bg) 50%,
          var(--skeleton) 100%);
      background-size: 200% 100%;
    }
  }
}

.stats-item:nth-child(3n + 1) {
  justify-content: flex-start;
}

.stats-item:nth-child(3n + 2),
.stats-item:nth-child(3n + 3) {
  justify-content: flex-end;
}

.text-muted {
  margin-right: 16px;
  opacity: 0.4;
}

.dialog-zap-list {
  list-style-type: none;
  margin: 10px 0;
  padding: 0 6px;
  flex: 1;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: smooth;

  /* スクロールバーのスタイリング */
  &::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 3px;
  }

  &::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    transition: background 0.2s;
  }

  &::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.2);
  }

  /* Firefox用のスクロールバースタイル */
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
}

.zap-list-item {
  display: flex;
  flex-direction: column;
  border-top: 1px solid var(--border);
  padding: 4px 0;
}

.zap-content {
  display: flex;
  flex-direction: column;
}

.reference-container {
  display: flex;
  flex-direction: column;
}

.zap-sender {
  gap: 12px;
  height: 46px;
  justify-content: space-between;
  padding: 6px;
}

.sender-icon {
  flex-shrink: 0;

  & img {
    width: 100%;
    height: 100%;
    border-radius: 4px;
    object-fit: cover;
    object-position: center;
  }
}

.sender-icon.is-new::before {
  content: "";
  position: absolute;
  top: -4px;
  left: -4px;
  width: 8px;
  height: 8px;
  background-color: var(--new-mark);
  border: 1px solid #fff;
  border-radius: 50%;
  z-index: 1;
  animation: pulse 2500ms cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  50% {
    opacity: 0.3;
  }
}

.sender-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  overflow: hidden;
  min-width: 0;
}

.sender-name {
  font-size: 0.9375rem;
  font-weight: bold;
  color: var(--name-text);
}

.sender-pubkey {
  font-size: 0.625rem;
  color: var(--pubkey-text);
  margin-top: -1px;
}

.zap-amount {
  font-size: 0.8rem;
  white-space: nowrap;
  flex-shrink: 0;

  .number {
    font-size: 1.4rem;
    font-weight: 500;
    text-align: right;
  }
}

.zap-details {
  padding: 2px 8px;
  border-radius: 0 0 6px 6px;
  margin: 0;
}

.zap-comment {
  font-size: 0.9375rem;
  margin: 0;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  max-width: 100%;
}

.no-zaps-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

.no-zaps-message {
  text-align: center;
  color: var(--pubkey-text);
  font-size: 1.8rem;
  font-weight: 700;
}

.zap-reference {
  padding: 2px 0 2px 12px;
  margin: 0;
  font-size: 0.875rem;
  color: var(--pubkey-text);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.reference-arrow {
  flex-shrink: 0;

  img {
    height: 16px;
    width: auto;
  }
}

.reference-text {
  font-size: 0.75rem;
  margin: 0 2px;
  flex-grow: 1;
}

.reference-link {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 1.5rem;
  width: 2.6rem;
  text-decoration: none;
  border-left: 1px solid var(--border);
  flex-shrink: 0;

  & img {
    height: 20px;
    width: auto;
  }
}

.zap-placeholder-name {
  height: 30px;
  width: 140px;
}

.zap-placeholder-name.skeleton {
  width: 120px;
  height: 19px;
  margin: 2px 0;
}

.skeleton {
  color: transparent;
  border-radius: 2px;
  background: linear-gradient(90deg,
      var(--skeleton) 0%,
      var(--skeleton2) 50%,
      var(--skeleton) 100%);
  background-size: 200% 100%;
  animation: loading-animation 3.5s infinite;
  opacity: 0.7;
}

@keyframes loading-animation {
  0% {
    background-position: 200% 0;
  }

  100% {
    background-position: -200% 0;
  }
}

/* 共通のテキストオーバーフロー処理 */
.dialog-title,
.sender-name,
.sender-pubkey,
.reference-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* 共通のフレックスボックス設定 */
.zap-sender,
.stats-item,
.zap-details,
.reference-link,
.zap-reference {
  display: flex;
  align-items: center;
}

/* 共通のアイコンサイズ */
.zap-placeholder-icon,
.sender-icon {
  width: 32px;
  height: 32px;
  border-radius: 4px;
  position: relative;
}

.load-more-trigger {
  height: 40px;
  margin: 10px 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--zap-stats-bg);
  border-top: 3px solid var(--pubkey-text);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}`,""]);const c=l},314:t=>{t.exports=function(e){var n=[];return n.toString=function(){return this.map((function(r){var i="",s=r[5]!==void 0;return r[4]&&(i+="@supports (".concat(r[4],") {")),r[2]&&(i+="@media ".concat(r[2]," {")),s&&(i+="@layer".concat(r[5].length>0?" ".concat(r[5]):""," {")),i+=e(r),s&&(i+="}"),r[2]&&(i+="}"),r[4]&&(i+="}"),i})).join("")},n.i=function(r,i,s,o,a){typeof r=="string"&&(r=[[null,r,void 0]]);var l={};if(s)for(var c=0;c<this.length;c++){var u=this[c][0];u!=null&&(l[u]=!0)}for(var f=0;f<r.length;f++){var h=[].concat(r[f]);s&&l[h[0]]||(a!==void 0&&(h[5]===void 0||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=a),i&&(h[2]&&(h[1]="@media ".concat(h[2]," {").concat(h[1],"}")),h[2]=i),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),n.push(h))}},n}},601:t=>{t.exports=function(e){return e[1]}},705:(t,e,n)=>{const{bech32:r,hex:i,utf8:s}=n(203),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},f=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],h={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},d=BigInt("2100000000000000000"),p=BigInt(1e11),g={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},b={};for(let O=0,_=Object.keys(g);O<_.length;O++){const L=_[O],A=g[_[O]].toString();b[A]=L}const w={1:O=>i.encode(r.fromWordsUnsafe(O)),16:O=>i.encode(r.fromWordsUnsafe(O)),13:O=>s.encode(r.fromWordsUnsafe(O)),19:O=>i.encode(r.fromWordsUnsafe(O)),23:O=>i.encode(r.fromWordsUnsafe(O)),27:O=>i.encode(r.fromWordsUnsafe(O)),6:T,24:T,3:function(O){const _=[];let L,A,E,S,k,P=r.fromWordsUnsafe(O);for(;P.length>0;)L=i.encode(P.slice(0,33)),A=i.encode(P.slice(33,41)),E=parseInt(i.encode(P.slice(41,45)),16),S=parseInt(i.encode(P.slice(45,49)),16),k=parseInt(i.encode(P.slice(49,51)),16),P=P.slice(51),_.push({pubkey:L,short_channel_id:A,fee_base_msat:E,fee_proportional_millionths:S,cltv_expiry_delta:k});return _},5:function(O){const _=O.slice().reverse().map((E=>[!!(1&E),!!(2&E),!!(4&E),!!(8&E),!!(16&E)])).reduce(((E,S)=>E.concat(S)),[]);for(;_.length<2*f.length;)_.push(!1);const L={};f.forEach(((E,S)=>{let k;k=_[2*S]?"required":_[2*S+1]?"supported":"unsupported",L[E]=k}));const A=_.slice(2*f.length);return L.extra_bits={start_bit:2*f.length,bits:A,has_required:A.reduce(((E,S,k)=>k%2!=0?E||!1:E||S),!1)},L}};function x(O){return _=>({tagCode:parseInt(O),words:r.encode("unknown",_,Number.MAX_SAFE_INTEGER)})}function T(O){return O.reverse().reduce(((_,L,A)=>_+L*Math.pow(32,A)),0)}function M(O,_){let L,A;if(O.slice(-1).match(/^[munp]$/))L=O.slice(-1),A=O.slice(0,-1);else{if(O.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");A=O}if(!A.match(/^\d+$/))throw new Error("Not a valid human readable amount");const E=BigInt(A),S=L?E*p/h[L]:E*p;if(L==="p"&&E%BigInt(10)!==BigInt(0)||S>d)throw new Error("Amount is outside of valid range");return _?S.toString():S}t.exports={decode:function(O,_){if(typeof O!="string")throw new Error("Lightning Payment Request must be string");if(O.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const L=[],A=r.decode(O,Number.MAX_SAFE_INTEGER);O=O.toLowerCase();const E=A.prefix;let S=A.words,k=O.slice(E.length+1),P=S.slice(-104);S=S.slice(0,-104);let D=E.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(D&&!D[2]&&(D=E.match(/^ln(\S+)$/)),!D)throw new Error("Not a proper lightning payment request");L.push({name:"lightning_network",letters:"ln"});const H=D[1];let N;if(_){if(_.bech32===void 0||_.pubKeyHash===void 0||_.scriptHash===void 0||!Array.isArray(_.validWitnessVersions))throw new Error("Invalid network");N=_}else switch(H){case o.bech32:N=o;break;case a.bech32:N=a;break;case l.bech32:N=l;break;case c.bech32:N=c;break;case u.bech32:N=u}if(!N||N.bech32!==H)throw new Error("Unknown coin bech32 prefix");L.push({name:"coin_network",letters:H,value:N});const I=D[2];let $;I?($=M(I+D[3],!0),L.push({name:"amount",letters:D[2]+D[3],value:$})):$=null,L.push({name:"separator",letters:"1"});const V=T(S.slice(0,7));let U,W,ee,X;for(S=S.slice(7),L.push({name:"timestamp",letters:k.slice(0,7),value:V}),k=k.slice(7);S.length>0;){const Y=S[0].toString();U=b[Y]||"unknown_tag",W=w[Y]||x(Y),S=S.slice(1),ee=T(S.slice(0,2)),S=S.slice(2),X=S.slice(0,ee),S=S.slice(ee),L.push({name:U,tag:k[0],letters:k.slice(0,3+ee),value:W(X)}),k=k.slice(3+ee)}L.push({name:"signature",letters:k.slice(0,104),value:i.encode(r.fromWordsUnsafe(P))}),k=k.slice(104),L.push({name:"checksum",letters:k});let he={paymentRequest:O,sections:L,get expiry(){let Y=L.find((be=>be.name==="expiry"));if(Y)return oe("timestamp")+Y.value},get route_hints(){return L.filter((Y=>Y.name==="route_hint")).map((Y=>Y.value))}};for(let Y in g)Y!=="route_hint"&&Object.defineProperty(he,Y,{get:()=>oe(Y)});return he;function oe(Y){let be=L.find((Re=>Re.name===Y));return be?be.value:void 0}},hrpToMillisat:M}},0:(t,e,n)=>{var r=n(540);r&&r.__esModule&&(r=r.default),t.exports=typeof r=="string"?r:r.toString()}},ax={};function nr(t){var e=ax[t];if(e!==void 0)return e.exports;var n=ax[t]={id:t,exports:{}};return aW[t](n,n.exports,nr),n.exports}nr.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return nr.d(e,{a:e}),e},nr.d=(t,e)=>{for(var n in e)nr.o(e,n)&&!nr.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},nr.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),nr.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var q4={};nr.d(q4,{X:()=>tY});var ly={};nr.r(ly),nr.d(ly,{OG:()=>S1,My:()=>Vl,Ph:()=>_r,lX:()=>E1,Id:()=>za,fg:()=>Y4,qj:()=>tr,aT:()=>vu,lq:()=>Ho,z:()=>x1,Q5:()=>Eu});var cy={};nr.r(cy),nr.d(cy,{Relay:()=>oT,SimplePool:()=>SG,finalizeEvent:()=>Si,fj:()=>QC,generateSecretKey:()=>BC,getEventHash:()=>Zc,getFilterLimit:()=>gG,getPublicKey:()=>L1,kinds:()=>HC,matchFilter:()=>JC,matchFilters:()=>XC,mergeFilters:()=>pG,nip04:()=>cT,nip05:()=>hT,nip10:()=>pT,nip11:()=>gT,nip13:()=>mT,nip18:()=>wT,nip19:()=>aT,nip21:()=>ET,nip25:()=>xT,nip27:()=>ST,nip28:()=>AT,nip30:()=>kT,nip39:()=>CT,nip42:()=>nT,nip44:()=>TT,nip47:()=>NT,nip57:()=>LT,nip59:()=>RT,nip98:()=>qT,parseReferences:()=>MG,serializeEvent:()=>DC,sortEvents:()=>XW,utils:()=>LC,validateEvent:()=>kp,verifiedSymbol:()=>vo,verifyEvent:()=>ac});var lW=nr(705);function lx(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function V4(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function cW(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");lx(t.outputLen),lx(t.blockLen)}function ud(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function uW(t,e){V4(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Im=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,W4=t=>t instanceof Uint8Array,Om=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Oi=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function v1(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!W4(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class K4{clone(){return this._cloneInto()}}function fW(t){const e=r=>t().update(v1(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function G4(t=32){if(Im&&typeof Im.getRandomValues=="function")return Im.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class hW extends K4{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Om(this.buffer)}update(e){ud(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=v1(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=Om(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){ud(this),uW(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;(function(f,h,d,p){if(typeof f.setBigUint64=="function")return f.setBigUint64(h,d,p);const g=BigInt(32),b=BigInt(4294967295),w=Number(d>>g&b),x=Number(d&b),T=p?4:0,M=p?0:4;f.setUint32(h+T,w,p),f.setUint32(h+M,x,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=Om(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const dW=(t,e,n)=>t&e^t&n^e&n,pW=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),co=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),uo=new Uint32Array(64);class gW extends hW{constructor(){super(64,32,8,!1),this.A=0|co[0],this.B=0|co[1],this.C=0|co[2],this.D=0|co[3],this.E=0|co[4],this.F=0|co[5],this.G=0|co[6],this.H=0|co[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let h=0;h<16;h++,n+=4)uo[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=uo[h-15],p=uo[h-2],g=Oi(d,7)^Oi(d,18)^d>>>3,b=Oi(p,17)^Oi(p,19)^p>>>10;uo[h]=b+uo[h-7]+g+uo[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let h=0;h<64;h++){const d=u+(Oi(a,6)^Oi(a,11)^Oi(a,25))+((f=a)&l^~f&c)+pW[h]+uo[h]|0,p=(Oi(r,2)^Oi(r,13)^Oi(r,22))+dW(r,i,s)|0;u=c,c=l,l=a,a=o+d|0,o=s,s=i,i=r,r=d+p|0}var f;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){uo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const uy=fW((()=>new gW)),mW=(BigInt(0),BigInt(1)),yW=BigInt(2),wp=t=>t instanceof Uint8Array,bW=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Vl(t){if(!wp(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=bW[t[n]];return e}function Z4(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function vu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function _r(t){return Z4(Vl(t))}function E1(t){if(!wp(t))throw new Error("Uint8Array expected");return Z4(Vl(Uint8Array.from(t).reverse()))}function Ho(t,e){return vu(t.toString(16).padStart(2*e,"0"))}function x1(t,e){return Ho(t,e).reverse()}function tr(t,e,n){let r;if(typeof e=="string")try{r=vu(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else{if(!wp(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function za(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!wp(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}const S1=t=>(yW<<BigInt(t-1))-mW,$m=t=>new Uint8Array(t),cx=t=>Uint8Array.from(t);function Y4(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=$m(t),i=$m(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=$m())=>{i=a(cx([0]),u),r=a(),u.length!==0&&(i=a(cx([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const f=[];for(;u<e;){r=a();const h=r.slice();f.push(h),u+=r.length}return za(...f)};return(u,f)=>{let h;for(o(),l(u);!(h=f(c()));)l();return o(),h}}const wW={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Eu(t,e,n={}){const r=(i,s,o)=>{const a=wW[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0||a(l,t)))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const wn=BigInt(0),Qt=BigInt(1),oa=BigInt(2),vW=BigInt(3),Mm=BigInt(4),ux=BigInt(5),fx=BigInt(8);BigInt(9),BigInt(16);function Bn(t,e){const n=t%e;return n>=wn?n:e+n}function EW(t,e,n){if(n<=wn||e<wn)throw new Error("Expected power/modulo > 0");if(n===Qt)return wn;let r=Qt;for(;e>wn;)e&Qt&&(r=r*t%n),t=t*t%n,e>>=Qt;return r}function Kr(t,e,n){let r=t;for(;e-- >wn;)r*=r,r%=n;return r}function fy(t,e){if(t===wn||e<=wn)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Bn(t,e),r=e,i=wn,s=Qt;for(;n!==wn;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==Qt)throw new Error("invert: does not exist");return Bn(i,e)}function xW(t){if(t%Mm===vW){const e=(t+Qt)/Mm;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%fx===ux){const e=(t-ux)/fx;return function(n,r){const i=n.mul(r,oa),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,oa),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return(function(e){const n=(e-Qt)/oa;let r,i,s;for(r=e-Qt,i=0;r%oa===wn;r/=oa,i++);for(s=oa;s<e&&EW(s,n,e)!==e-Qt;s++);if(i===1){const a=(e+Qt)/Mm;return function(l,c){const u=l.pow(c,a);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const o=(r+Qt)/oa;return function(a,l){if(a.pow(l,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,u=a.pow(a.mul(a.ONE,s),r),f=a.pow(l,o),h=a.pow(l,r);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let d=1;for(let g=a.sqr(h);d<c&&!a.eql(g,a.ONE);d++)g=a.sqr(g);const p=a.pow(u,Qt<<BigInt(c-d-1));u=a.sqr(p),f=a.mul(f,p),h=a.mul(h,u),c=d}return f}})(t)}const SW=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function J4(t,e){const n=e!==void 0?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function X4(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function hx(t){const e=X4(t);return e+Math.ceil(e/2)}class Q4 extends K4{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,cW(e);const r=v1(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return ud(this),this.iHash.update(e),this}digestInto(e){ud(this),V4(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const eC=(t,e,n)=>new Q4(t,e).update(n).digest();eC.create=(t,e)=>new Q4(t,e);const AW=BigInt(0),Nm=BigInt(1);function tC(t){return Eu(t.Fp,SW.reduce(((e,n)=>(e[n]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Eu(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...J4(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:kW,aT:_W}=ly,xa={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=xa;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(r[0]===0&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:kW(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=xa,n=typeof t=="string"?_W(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=xa._parseInt(n.subarray(2)),{d:o,l:a}=xa._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>8&Number.parseInt(c[0],16)?"00"+c:c,n=c=>{const u=c.toString(16);return 1&u.length?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},vs=BigInt(0),Xr=BigInt(1),dx=(BigInt(2),BigInt(3));BigInt(4);function CW(t){const e=(function(p){const g=tC(p);Eu(g,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:b,Fp:w,a:x}=g;if(b){if(!w.eql(x,w.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof b!="object"||typeof b.beta!="bigint"||typeof b.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...g})})(t),{Fp:n}=e,r=e.toBytes||((p,g,b)=>{const w=g.toAffine();return za(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),i=e.fromBytes||(p=>{const g=p.subarray(1);return{x:n.fromBytes(g.subarray(0,n.BYTES)),y:n.fromBytes(g.subarray(n.BYTES,2*n.BYTES))}});function s(p){const{a:g,b}=e,w=n.sqr(p),x=n.mul(w,p);return n.add(n.add(x,n.mul(p,g)),b)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&vs<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:g,nByteLength:b,wrapPrivateKey:w,n:x}=e;if(g&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Vl(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(2*b,"0")}let T;try{T=typeof p=="bigint"?p:_r(tr("private key",p,b))}catch{throw new Error(`private key must be ${b} bytes, hex or bigint, not ${typeof p}`)}return w&&(T=Bn(T,x)),a(T),T}const c=new Map;function u(p){if(!(p instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(g,b,w){if(this.px=g,this.py=b,this.pz=w,g==null||!n.isValid(g))throw new Error("x required");if(b==null||!n.isValid(b))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(g){const{x:b,y:w}=g||{};if(!g||!n.isValid(b)||!n.isValid(w))throw new Error("invalid affine point");if(g instanceof f)throw new Error("projective point not allowed");const x=T=>n.eql(T,n.ZERO);return x(b)&&x(w)?f.ZERO:new f(b,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const b=n.invertBatch(g.map((w=>w.pz)));return g.map(((w,x)=>w.toAffine(b[x]))).map(f.fromAffine)}static fromHex(g){const b=f.fromAffine(i(tr("pointHex",g)));return b.assertValidity(),b}static fromPrivateKey(g){return f.BASE.multiply(l(g))}_setWindowSize(g){this._WINDOW_SIZE=g,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:b}=this.toAffine();if(!n.isValid(g)||!n.isValid(b))throw new Error("bad point: x or y not FE");const w=n.sqr(b),x=s(g);if(!n.eql(w,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(n.isOdd)return!n.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:b,py:w,pz:x}=this,{px:T,py:M,pz:O}=g,_=n.eql(n.mul(b,O),n.mul(T,x)),L=n.eql(n.mul(w,O),n.mul(M,x));return _&&L}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:g,b}=e,w=n.mul(b,dx),{px:x,py:T,pz:M}=this;let O=n.ZERO,_=n.ZERO,L=n.ZERO,A=n.mul(x,x),E=n.mul(T,T),S=n.mul(M,M),k=n.mul(x,T);return k=n.add(k,k),L=n.mul(x,M),L=n.add(L,L),O=n.mul(g,L),_=n.mul(w,S),_=n.add(O,_),O=n.sub(E,_),_=n.add(E,_),_=n.mul(O,_),O=n.mul(k,O),L=n.mul(w,L),S=n.mul(g,S),k=n.sub(A,S),k=n.mul(g,k),k=n.add(k,L),L=n.add(A,A),A=n.add(L,A),A=n.add(A,S),A=n.mul(A,k),_=n.add(_,A),S=n.mul(T,M),S=n.add(S,S),A=n.mul(S,k),O=n.sub(O,A),L=n.mul(S,E),L=n.add(L,L),L=n.add(L,L),new f(O,_,L)}add(g){u(g);const{px:b,py:w,pz:x}=this,{px:T,py:M,pz:O}=g;let _=n.ZERO,L=n.ZERO,A=n.ZERO;const E=e.a,S=n.mul(e.b,dx);let k=n.mul(b,T),P=n.mul(w,M),D=n.mul(x,O),H=n.add(b,w),N=n.add(T,M);H=n.mul(H,N),N=n.add(k,P),H=n.sub(H,N),N=n.add(b,x);let I=n.add(T,O);return N=n.mul(N,I),I=n.add(k,D),N=n.sub(N,I),I=n.add(w,x),_=n.add(M,O),I=n.mul(I,_),_=n.add(P,D),I=n.sub(I,_),A=n.mul(E,N),_=n.mul(S,D),A=n.add(_,A),_=n.sub(P,A),A=n.add(P,A),L=n.mul(_,A),P=n.add(k,k),P=n.add(P,k),D=n.mul(E,D),N=n.mul(S,N),P=n.add(P,D),D=n.sub(k,D),D=n.mul(E,D),N=n.add(N,D),k=n.mul(P,N),L=n.add(L,k),k=n.mul(I,N),_=n.mul(H,_),_=n.sub(_,k),k=n.mul(H,P),A=n.mul(I,A),A=n.add(A,k),new f(_,L,A)}subtract(g){return this.add(g.negate())}is0(){return this.equals(f.ZERO)}wNAF(g){return d.wNAFCached(this,c,g,(b=>{const w=n.invertBatch(b.map((x=>x.pz)));return b.map(((x,T)=>x.toAffine(w[T]))).map(f.fromAffine)}))}multiplyUnsafe(g){const b=f.ZERO;if(g===vs)return b;if(a(g),g===Xr)return this;const{endo:w}=e;if(!w)return d.unsafeLadder(this,g);let{k1neg:x,k1:T,k2neg:M,k2:O}=w.splitScalar(g),_=b,L=b,A=this;for(;T>vs||O>vs;)T&Xr&&(_=_.add(A)),O&Xr&&(L=L.add(A)),A=A.double(),T>>=Xr,O>>=Xr;return x&&(_=_.negate()),M&&(L=L.negate()),L=new f(n.mul(L.px,w.beta),L.py,L.pz),_.add(L)}multiply(g){a(g);let b,w,x=g;const{endo:T}=e;if(T){const{k1neg:M,k1:O,k2neg:_,k2:L}=T.splitScalar(x);let{p:A,f:E}=this.wNAF(O),{p:S,f:k}=this.wNAF(L);A=d.constTimeNegate(M,A),S=d.constTimeNegate(_,S),S=new f(n.mul(S.px,T.beta),S.py,S.pz),b=A.add(S),w=E.add(k)}else{const{p:M,f:O}=this.wNAF(x);b=M,w=O}return f.normalizeZ([b,w])[0]}multiplyAndAddUnsafe(g,b,w){const x=f.BASE,T=(O,_)=>_!==vs&&_!==Xr&&O.equals(x)?O.multiply(_):O.multiplyUnsafe(_),M=T(this,b).add(T(g,w));return M.is0()?void 0:M}toAffine(g){const{px:b,py:w,pz:x}=this,T=this.is0();g==null&&(g=T?n.ONE:n.inv(x));const M=n.mul(b,g),O=n.mul(w,g),_=n.mul(x,g);if(T)return{x:n.ZERO,y:n.ZERO};if(!n.eql(_,n.ONE))throw new Error("invZ was invalid");return{x:M,y:O}}isTorsionFree(){const{h:g,isTorsionFree:b}=e;if(g===Xr)return!0;if(b)return b(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:b}=e;return g===Xr?this:b?b(f,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),r(f,this,g)}toHex(g=!0){return Vl(this.toRawBytes(g))}}f.BASE=new f(e.Gx,e.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const h=e.nBitLength,d=(function(p,g){const b=(x,T)=>{const M=T.negate();return x?M:T},w=x=>({windows:Math.ceil(g/x)+1,windowSize:2**(x-1)});return{constTimeNegate:b,unsafeLadder(x,T){let M=p.ZERO,O=x;for(;T>AW;)T&Nm&&(M=M.add(O)),O=O.double(),T>>=Nm;return M},precomputeWindow(x,T){const{windows:M,windowSize:O}=w(T),_=[];let L=x,A=L;for(let E=0;E<M;E++){A=L,_.push(A);for(let S=1;S<O;S++)A=A.add(L),_.push(A);L=A.double()}return _},wNAF(x,T,M){const{windows:O,windowSize:_}=w(x);let L=p.ZERO,A=p.BASE;const E=BigInt(2**x-1),S=2**x,k=BigInt(x);for(let P=0;P<O;P++){const D=P*_;let H=Number(M&E);M>>=k,H>_&&(H-=S,M+=Nm);const N=D,I=D+Math.abs(H)-1,$=P%2!=0,V=H<0;H===0?A=A.add(b($,T[N])):L=L.add(b(V,T[I]))}return{p:L,f:A}},wNAFCached(x,T,M,O){const _=x._WINDOW_SIZE||1;let L=T.get(x);return L||(L=this.precomputeWindow(x,_),_!==1&&T.set(x,O(L))),this.wNAF(_,L,M)}}})(f,e.endo?Math.ceil(h/2):h);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function TW(t){const e=(function(E){const S=tC(E);return Eu(S,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...S})})(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(E){return Bn(E,r)}function a(E){return fy(E,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:f}=CW({...e,toBytes(E,S,k){const P=S.toAffine(),D=n.toBytes(P.x),H=za;return k?H(Uint8Array.from([S.hasEvenY()?2:3]),D):H(Uint8Array.from([4]),D,n.toBytes(P.y))},fromBytes(E){const S=E.length,k=E[0],P=E.subarray(1);if(S!==i||k!==2&&k!==3){if(S===s&&k===4)return{x:n.fromBytes(P.subarray(0,n.BYTES)),y:n.fromBytes(P.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${S} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const H=_r(P);if(!(vs<(D=H)&&D<n.ORDER))throw new Error("Point is not on curve");const N=u(H);let I=n.sqrt(N);return!(1&~k)!=((I&Xr)===Xr)&&(I=n.neg(I)),{x:H,y:I}}var D}}),h=E=>Vl(Ho(E,e.nByteLength));function d(E){return E>r>>Xr}const p=(E,S,k)=>_r(E.slice(S,k));class g{constructor(S,k,P){this.r=S,this.s=k,this.recovery=P,this.assertValidity()}static fromCompact(S){const k=e.nByteLength;return S=tr("compactSignature",S,2*k),new g(p(S,0,k),p(S,k,2*k))}static fromDER(S){const{r:k,s:P}=xa.toSig(tr("DER",S));return new g(k,P)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(S){return new g(this.r,this.s,S)}recoverPublicKey(S){const{r:k,s:P,recovery:D}=this,H=T(tr("msgHash",S));if(D==null||![0,1,2,3].includes(D))throw new Error("recovery id invalid");const N=D===2||D===3?k+e.n:k;if(N>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const I=1&D?"03":"02",$=l.fromHex(I+h(N)),V=a(N),U=o(-H*V),W=o(P*V),ee=l.BASE.multiplyAndAddUnsafe($,U,W);if(!ee)throw new Error("point at infinify");return ee.assertValidity(),ee}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return vu(this.toDERHex())}toDERHex(){return xa.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return vu(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const b={isValidPrivateKey(E){try{return c(E),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const E=hx(e.n);return(function(S,k,P=!1){const D=S.length,H=X4(k),N=hx(k);if(D<16||D<N||D>1024)throw new Error(`expected ${N}-1024 bytes of input, got ${D}`);const I=Bn(P?_r(S):E1(S),k-Qt)+Qt;return P?x1(I,H):Ho(I,H)})(e.randomBytes(E),e.n)},precompute:(E=8,S=l.BASE)=>(S._setWindowSize(E),S.multiply(BigInt(3)),S)};function w(E){const S=E instanceof Uint8Array,k=typeof E=="string",P=(S||k)&&E.length;return S?P===i||P===s:k?P===2*i||P===2*s:E instanceof l}const x=e.bits2int||function(E){const S=_r(E),k=8*E.length-e.nBitLength;return k>0?S>>BigInt(k):S},T=e.bits2int_modN||function(E){return o(x(E))},M=S1(e.nBitLength);function O(E){if(typeof E!="bigint")throw new Error("bigint expected");if(!(vs<=E&&E<M))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Ho(E,e.nByteLength)}function _(E,S,k=L){if(["recovered","canonical"].some((X=>X in k)))throw new Error("sign() legacy options not supported");const{hash:P,randomBytes:D}=e;let{lowS:H,prehash:N,extraEntropy:I}=k;H==null&&(H=!0),E=tr("msgHash",E),N&&(E=tr("prehashed msgHash",P(E)));const $=T(E),V=c(S),U=[O(V),O($)];if(I!=null){const X=I===!0?D(n.BYTES):I;U.push(tr("extraEntropy",X))}const W=za(...U),ee=$;return{seed:W,k2sig:function(X){const he=x(X);if(!f(he))return;const oe=a(he),Y=l.BASE.multiply(he).toAffine(),be=o(Y.x);if(be===vs)return;const Re=o(oe*o(ee+be*V));if(Re===vs)return;let de=(Y.x===be?0:2)|Number(Y.y&Xr),Me=Re;return H&&d(Re)&&(Me=(function(ce){return d(ce)?o(-ce):ce})(Re),de^=1),new g(be,Me,de)}}}const L={lowS:e.lowS,prehash:!1},A={lowS:e.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(E,S=!0){return l.fromPrivateKey(E).toRawBytes(S)},getSharedSecret:function(E,S,k=!0){if(w(E))throw new Error("first arg must be private key");if(!w(S))throw new Error("second arg must be public key");return l.fromHex(S).multiply(c(E)).toRawBytes(k)},sign:function(E,S,k=L){const{seed:P,k2sig:D}=_(E,S,k),H=e;return Y4(H.hash.outputLen,H.nByteLength,H.hmac)(P,D)},verify:function(E,S,k,P=A){const D=E;if(S=tr("msgHash",S),k=tr("publicKey",k),"strict"in P)throw new Error("options.strict was renamed to lowS");const{lowS:H,prehash:N}=P;let I,$;try{if(typeof D=="string"||D instanceof Uint8Array)try{I=g.fromDER(D)}catch(Y){if(!(Y instanceof xa.Err))throw Y;I=g.fromCompact(D)}else{if(typeof D!="object"||typeof D.r!="bigint"||typeof D.s!="bigint")throw new Error("PARSE");{const{r:Y,s:be}=D;I=new g(Y,be)}}$=l.fromHex(k)}catch(Y){if(Y.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(H&&I.hasHighS())return!1;N&&(S=e.hash(S));const{r:V,s:U}=I,W=T(S),ee=a(U),X=o(W*ee),he=o(V*ee),oe=l.BASE.multiplyAndAddUnsafe($,X,he)?.toAffine();return!!oe&&o(oe.x)===V},ProjectivePoint:l,Signature:g,utils:b}}function IW(t){return{hash:t,hmac:(e,...n)=>eC(t,e,(function(...r){const i=new Uint8Array(r.reduce(((o,a)=>o+a.length),0));let s=0;return r.forEach((o=>{if(!W4(o))throw new Error("Uint8Array expected");i.set(o,s),s+=o.length})),i})(...n)),randomBytes:G4}}const vp=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),fd=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),nC=BigInt(1),hd=BigInt(2),px=(t,e)=>(t+e/hd)/e;function rC(t){const e=vp,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,f=Kr(u,n,e)*u%e,h=Kr(f,n,e)*u%e,d=Kr(h,hd,e)*c%e,p=Kr(d,i,e)*d%e,g=Kr(p,s,e)*p%e,b=Kr(g,a,e)*g%e,w=Kr(b,l,e)*b%e,x=Kr(w,a,e)*g%e,T=Kr(x,n,e)*u%e,M=Kr(T,o,e)*p%e,O=Kr(M,r,e)*c%e,_=Kr(O,hd,e);if(!hy.eql(hy.sqr(_),t))throw new Error("Cannot find square root");return _}const hy=(function(t,e,n=!1,r={}){if(t<=wn)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=J4(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=xW(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:S1(i),ZERO:wn,ONE:Qt,create:l=>Bn(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("Invalid field element: expected bigint, got "+typeof l);return wn<=l&&l<t},is0:l=>l===wn,isOdd:l=>(l&Qt)===Qt,neg:l=>Bn(-l,t),eql:(l,c)=>l===c,sqr:l=>Bn(l*l,t),add:(l,c)=>Bn(l+c,t),sub:(l,c)=>Bn(l-c,t),mul:(l,c)=>Bn(l*c,t),pow:(l,c)=>(function(u,f,h){if(h<wn)throw new Error("Expected power > 0");if(h===wn)return u.ONE;if(h===Qt)return f;let d=u.ONE,p=f;for(;h>wn;)h&Qt&&(d=u.mul(d,p)),p=u.sqr(p),h>>=Qt;return d})(a,l,c),div:(l,c)=>Bn(l*fy(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>fy(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>(function(c,u){const f=new Array(u.length),h=u.reduce(((p,g,b)=>c.is0(g)?p:(f[b]=p,c.mul(p,g))),c.ONE),d=c.inv(h);return u.reduceRight(((p,g,b)=>c.is0(g)?p:(f[b]=c.mul(p,f[b]),c.mul(p,g))),d),f})(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?x1(l,s):Ho(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?E1(l):_r(l)}});return Object.freeze(a)})(vp,void 0,void 0,{sqrt:rC}),rc=(function(t,e){const n=r=>TW({...t,...IW(r)});return Object.freeze({...n(e),create:n})})({a:BigInt(0),b:BigInt(7),Fp:hy,n:fd,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=fd,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-nC*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=px(s*t,e),l=px(-r*t,e);let c=Bn(t-a*n-l*i,e),u=Bn(-a*r-l*s,e);const f=c>o,h=u>o;if(f&&(c=e-c),h&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:f,k1:c,k2neg:h,k2:u}}}},uy),Ep=BigInt(0),iC=t=>typeof t=="bigint"&&Ep<t&&t<vp,gx={};function dd(t,...e){let n=gx[t];if(n===void 0){const r=uy(Uint8Array.from(t,(i=>i.charCodeAt(0))));n=za(r,r),gx[t]=n}return uy(za(n,...e))}const A1=t=>t.toRawBytes(!0).slice(1),dy=t=>Ho(t,32),Lm=t=>Bn(t,vp),xu=t=>Bn(t,fd),k1=rc.ProjectivePoint;function py(t){let e=rc.utils.normPrivateKeyToScalar(t),n=k1.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:xu(-e),bytes:A1(n)}}function sC(t){if(!iC(t))throw new Error("bad x: need 0 < x < p");const e=Lm(t*t);let n=rC(Lm(e*t+BigInt(7)));n%hd!==Ep&&(n=Lm(-n));const r=new k1(t,n,nC);return r.assertValidity(),r}function oC(...t){return xu(_r(dd("BIP0340/challenge",...t)))}function OW(t){return py(t).bytes}function $W(t,e,n=G4(32)){const r=tr("message",t),{bytes:i,scalar:s}=py(e),o=tr("auxRand",n,32),a=dy(s^_r(dd("BIP0340/aux",o))),l=dd("BIP0340/nonce",a,i,r),c=xu(_r(l));if(c===Ep)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=py(c),h=oC(u,i,r),d=new Uint8Array(64);if(d.set(u,0),d.set(dy(xu(f+h*s)),32),!aC(d,r,i))throw new Error("sign: Invalid signature produced");return d}function aC(t,e,n){const r=tr("signature",t,64),i=tr("message",e),s=tr("publicKey",n,32);try{const u=sC(_r(s)),f=_r(r.subarray(0,32));if(!iC(f))return!1;const h=_r(r.subarray(32,64));if(!(typeof(c=h)=="bigint"&&Ep<c&&c<fd))return!1;const d=oC(dy(f),A1(u),i),p=(o=u,a=h,l=xu(-d),k1.BASE.multiplyAndAddUnsafe(o,a,l));return!(!p||!p.hasEvenY()||p.toAffine().x!==f)}catch{return!1}var o,a,l,c}const Ui={getPublicKey:OW,sign:$W,verify:aC,utils:{randomPrivateKey:rc.utils.randomPrivateKey,lift_x:sC,pointToBytes:A1,numberToBytesBE:Ho,bytesToNumberBE:_r,taggedHash:dd,mod:Bn}},Rm=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,_1=t=>t instanceof Uint8Array,Pm=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),$i=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");const MW=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function hn(t){if(!_1(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=MW[t[n]];return e}function Wl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Su(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!_1(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function xp(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!_1(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}class lC{clone(){return this._cloneInto()}}function cC(t){const e=r=>t().update(Su(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function uC(t=32){if(Rm&&typeof Rm.getRandomValues=="function")return Rm.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Dm(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function mx(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const NW={number:Dm,bool:function(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)},bytes:mx,hash:function(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Dm(t.outputLen),Dm(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){mx(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},Vi=NW;class LW extends lC{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Pm(this.buffer)}update(e){Vi.exists(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=Su(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=Pm(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Vi.exists(this),Vi.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;(function(f,h,d,p){if(typeof f.setBigUint64=="function")return f.setBigUint64(h,d,p);const g=BigInt(32),b=BigInt(4294967295),w=Number(d>>g&b),x=Number(d&b),T=p?4:0,M=p?0:4;f.setUint32(h+T,w,p),f.setUint32(h+M,x,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=Pm(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<c;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const RW=(t,e,n)=>t&e^t&n^e&n,PW=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),fo=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ho=new Uint32Array(64);class fC extends LW{constructor(){super(64,32,8,!1),this.A=0|fo[0],this.B=0|fo[1],this.C=0|fo[2],this.D=0|fo[3],this.E=0|fo[4],this.F=0|fo[5],this.G=0|fo[6],this.H=0|fo[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let h=0;h<16;h++,n+=4)ho[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=ho[h-15],p=ho[h-2],g=$i(d,7)^$i(d,18)^d>>>3,b=$i(p,17)^$i(p,19)^p>>>10;ho[h]=b+ho[h-7]+g+ho[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let h=0;h<64;h++){const d=u+($i(a,6)^$i(a,11)^$i(a,25))+((f=a)&l^~f&c)+PW[h]+ho[h]|0,p=($i(r,2)^$i(r,13)^$i(r,22))+RW(r,i,s)|0;u=c,c=l,l=a,a=o+d|0,o=s,s=i,i=r,r=d+p|0}var f;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){ho.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class DW extends fC{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Ya=cC((()=>new fC));cC((()=>new DW));function ic(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Ns(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce(((i,s)=>i?e(i,s.encode):s.encode),void 0),r=t.reduce(((i,s)=>i?e(i,s.decode):s.decode),void 0);return{encode:n,decode:r}}function Ls(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map((n=>{if(ic(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]}))},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map((n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r}))}}}function Rs(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function pd(t,e="="){if(ic(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function hC(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function yx(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((o=>{if(ic(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)}));;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!=e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");a&&(s[l]?a=!1:r=l)}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const dC=(t,e)=>e?dC(e,t%e):t,gd=(t,e)=>t+(e-dC(t,e));function gy(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(gd(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${gd(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(ic(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function BW(t){return ic(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return yx(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(yx(e,t,256))}}}function Uo(t,e=!1){if(ic(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(gd(8,t)>32||gd(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return gy(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(gy(n,t,8,e))}}}function bx(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}Ns(Uo(4),Ls("0123456789ABCDEF"),Rs(""));Ns(Uo(5),Ls("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),pd(5),Rs(""));const Vo=(Ns(Uo(5),Ls("0123456789ABCDEFGHIJKLMNOPQRSTUV"),pd(5),Rs("")),Ns(Uo(5),Ls("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Rs(""),hC((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),Ns(Uo(6),Ls("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),pd(6),Rs("")));Ns(Uo(6),Ls("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),pd(6),Rs(""));const my=t=>Ns(BW(58),Ls(t),Rs(""));my("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");my("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),my("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const yy=Ns(Ls("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Rs("")),wx=[996825010,642813549,513874426,1027748829,705979059];function Ac(t){const e=t>>25;let n=(33554431&t)<<5;for(let r=0;r<wx.length;r++)(e>>r&1)==1&&(n^=wx[r]);return n}function vx(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Ac(i)^o>>5}i=Ac(i);for(let s=0;s<r;s++)i=Ac(i)^31&t.charCodeAt(s);for(let s of e)i=Ac(i)^s;for(let s=0;s<6;s++)i=Ac(i);return i^=n,yy.encode(gy([i%2**30],30,5,!1))}function pC(t){const e=t==="bech32"?1:734539939,n=Uo(5),r=n.decode,i=n.encode,s=bx(r);function o(a,l=90){if(typeof a!="string")throw new Error("bech32.decode input should be string, not "+typeof a);if(a.length<8||l!==!1&&a.length>l)throw new TypeError(`Wrong string length: ${a.length} (${a}). Expected (8..${l})`);const c=a.toLowerCase();if(a!==c&&a!==a.toUpperCase())throw new Error("String must be lowercase or uppercase");const u=(a=c).lastIndexOf("1");if(u===0||u===-1)throw new Error('Letter "1" must be present between prefix and data only');const f=a.slice(0,u),h=a.slice(u+1);if(h.length<6)throw new Error("Data must be at least 6 characters long");const d=yy.decode(h).slice(0,-6),p=vx(f,d,e);if(!h.endsWith(p))throw new Error(`Invalid checksum in ${a}: expected "${p}"`);return{prefix:f,words:d}}return{encode:function(a,l,c=90){if(typeof a!="string")throw new Error("bech32.encode prefix should be string, not "+typeof a);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof l);const u=a.length+7+l.length;if(c!==!1&&u>c)throw new TypeError(`Length ${u} exceeds limit ${c}`);return`${a=a.toLowerCase()}1${yy.encode(l)}${vx(a,l,e)}`},decode:o,decodeToBytes:function(a){const{prefix:l,words:c}=o(a,!1);return{prefix:l,words:c,bytes:r(c)}},decodeUnsafe:bx(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const Kl=pC("bech32");pC("bech32m");Ns(Uo(4),Ls("0123456789abcdef"),Rs(""),hC((t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));function Bm(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Ex(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function gC(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function $t(t,...e){if(!gC(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Gl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function C1(t,e){$t(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const T1=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),pt=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Sp=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function Wo(t){if(typeof t=="string")t=(function(e){if(typeof e!="string")throw new Error("string expected, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t);else{if(!gC(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function I1(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const sc=(t,e)=>(Object.assign(e,t),e);function by(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const ys=16,O1=new Uint8Array(16),zi=pt(O1),Qr=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class mC{constructor(e,n){this.blockLen=ys,this.outputLen=ys,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,$t(e=Wo(e),16);const r=Sp(e);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const l=[];for(let w=0;w<128;w++)l.push({s0:Qr(i),s1:Qr(s),s2:Qr(o),s3:Qr(a)}),{s0:i,s1:s,s2:o,s3:a}={s3:(f=o)<<31|(h=a)>>>1,s2:(u=s)<<31|f>>>1,s1:(c=i)<<31|u>>>1,s0:c>>>1^225<<24&-(1&h)};var c,u,f,h;const d=(w=>w>65536?8:w>1024?4:2)(n||1024);if(![1,2,4,8].includes(d))throw new Error(`ghash: wrong window size=${d}, should be 2, 4 or 8`);this.W=d;const p=128/d,g=this.windowSize=2**d,b=[];for(let w=0;w<p;w++)for(let x=0;x<g;x++){let T=0,M=0,O=0,_=0;for(let L=0;L<d;L++){if(!(x>>>d-L-1&1))continue;const{s0:A,s1:E,s2:S,s3:k}=l[d*w+L];T^=A,M^=E,O^=S,_^=k}b.push({s0:T,s1:M,s2:O,s3:_})}this.t=b}_updateBlock(e,n,r,i){e^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let l=0,c=0,u=0,f=0;const h=(1<<s)-1;let d=0;for(const p of[e,n,r,i])for(let g=0;g<4;g++){const b=p>>>8*g&255;for(let w=8/s-1;w>=0;w--){const x=b>>>s*w&h,{s0:T,s1:M,s2:O,s3:_}=o[d*a+x];l^=T,c^=M,u^=O,f^=_,d+=1}}this.s0=l,this.s1=c,this.s2=u,this.s3=f}update(e){e=Wo(e),Gl(this);const n=pt(e),r=Math.floor(e.length/ys),i=e.length%ys;for(let s=0;s<r;s++)this._updateBlock(n[4*s+0],n[4*s+1],n[4*s+2],n[4*s+3]);return i&&(O1.set(e.subarray(r*ys)),this._updateBlock(zi[0],zi[1],zi[2],zi[3]),zi.fill(0)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){Gl(this),C1(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=pt(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e}digest(){const e=new Uint8Array(ys);return this.digestInto(e),this.destroy(),e}}class HW extends mC{constructor(e,n){const r=(function(i){i.reverse();const s=1&i[15];let o=0;for(let a=0;a<i.length;a++){const l=i[a];i[a]=l>>>1|o,o=(1&l)<<7}return i[0]^=225&-s,i})((e=Wo(e)).slice());super(r,n),r.fill(0)}update(e){e=Wo(e),Gl(this);const n=pt(e),r=e.length%ys,i=Math.floor(e.length/ys);for(let s=0;s<i;s++)this._updateBlock(Qr(n[4*s+3]),Qr(n[4*s+2]),Qr(n[4*s+1]),Qr(n[4*s+0]));return r&&(O1.set(e.subarray(i*ys)),this._updateBlock(Qr(zi[3]),Qr(zi[2]),Qr(zi[1]),Qr(zi[0])),zi.fill(0)),this}digestInto(e){Gl(this),C1(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=pt(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e.reverse()}}function yC(t){const e=(r,i)=>t(i,r.length).update(Wo(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,i)=>t(r,i),e}const xx=yC(((t,e)=>new mC(t,e))),UW=yC(((t,e)=>new HW(t,e))),$r=16,vf=new Uint8Array($r);function $1(t){return t<<1^283&-(t>>7)}function ml(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=$1(t);return n}const wy=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=$1(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),zW=wy.map(((t,e)=>wy.indexOf(e))),Hm=t=>t<<8|t>>>24;function bC(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((c,u)=>e(t[u]))),r=n.map(Hm),i=r.map(Hm),s=i.map(Hm),o=new Uint32Array(65536),a=new Uint32Array(65536),l=new Uint16Array(65536);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const f=256*c+u;o[f]=n[c]^r[u],a[f]=i[c]^s[u],l[f]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const M1=bC(wy,(t=>ml(t,3)<<24|t<<16|t<<8|ml(t,2))),wC=bC(zW,(t=>ml(t,11)<<24|ml(t,13)<<16|ml(t,9)<<8|ml(t,14))),FW=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=$1(n))t[e]=n;return t})();function Ko(t){$t(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=M1,r=pt(t),i=r.length,s=l=>Wi(n,l,l,l,l),o=new Uint32Array(e+28);o.set(r);for(let l=i;l<o.length;l++){let c=o[l-1];l%i==0?c=s((a=c)<<24|a>>>8)^FW[l/i-1]:i>6&&l%i==4&&(c=s(c)),o[l]=o[l-i]^c}var a;return o}function vC(t){const e=Ko(t),n=e.slice(),r=e.length,{sbox2:i}=M1,{T0:s,T1:o,T2:a,T3:l}=wC;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],f=Wi(i,u,u,u,u);n[c]=s[255&f]^o[f>>>8&255]^a[f>>>16&255]^l[f>>>24]}return n}function Oo(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function Wi(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function oi(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=M1;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const f=t[l++]^Oo(o,a,e,n,r,i),h=t[l++]^Oo(o,a,n,r,i,e),d=t[l++]^Oo(o,a,r,i,e,n),p=t[l++]^Oo(o,a,i,e,n,r);e=f,n=h,r=d,i=p}return{s0:t[l++]^Wi(s,e,n,r,i),s1:t[l++]^Wi(s,n,r,i,e),s2:t[l++]^Wi(s,r,i,e,n),s3:t[l++]^Wi(s,i,e,n,r)}}function EC(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=wC;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const f=t[l++]^Oo(o,a,e,i,r,n),h=t[l++]^Oo(o,a,n,e,i,r),d=t[l++]^Oo(o,a,r,n,e,i),p=t[l++]^Oo(o,a,i,r,n,e);e=f,n=h,r=d,i=p}return{s0:t[l++]^Wi(s,e,i,r,n),s1:t[l++]^Wi(s,n,e,i,r),s2:t[l++]^Wi(s,r,n,e,i),s3:t[l++]^Wi(s,i,r,n,e)}}function oc(t,e){if(!e)return new Uint8Array(t);if($t(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function jW(t,e,n,r){$t(e,$r),$t(n);const i=n.length;r=oc(i,r);const s=e,o=pt(s);let{s0:a,s1:l,s2:c,s3:u}=oi(t,o[0],o[1],o[2],o[3]);const f=pt(n),h=pt(r);for(let p=0;p+4<=f.length;p+=4){h[p+0]=f[p+0]^a,h[p+1]=f[p+1]^l,h[p+2]=f[p+2]^c,h[p+3]=f[p+3]^u;let g=1;for(let b=s.length-1;b>=0;b--)g=g+(255&s[b])|0,s[b]=255&g,g>>>=8;({s0:a,s1:l,s2:c,s3:u}=oi(t,o[0],o[1],o[2],o[3]))}const d=$r*Math.floor(f.length/4);if(d<i){const p=new Uint32Array([a,l,c,u]),g=T1(p);for(let b=d,w=0;b<i;b++,w++)r[b]=n[b]^g[w]}return r}function $c(t,e,n,r,i){$t(n,$r),$t(r),i=oc(r.length,i);const s=n,o=pt(s),a=Sp(s),l=pt(r),c=pt(i),u=e?0:12,f=r.length;let h=a.getUint32(u,e),{s0:d,s1:p,s2:g,s3:b}=oi(t,o[0],o[1],o[2],o[3]);for(let x=0;x+4<=l.length;x+=4)c[x+0]=l[x+0]^d,c[x+1]=l[x+1]^p,c[x+2]=l[x+2]^g,c[x+3]=l[x+3]^b,h=h+1>>>0,a.setUint32(u,h,e),{s0:d,s1:p,s2:g,s3:b}=oi(t,o[0],o[1],o[2],o[3]);const w=$r*Math.floor(l.length/4);if(w<f){const x=new Uint32Array([d,p,g,b]),T=T1(x);for(let M=w,O=0;M<f;M++,O++)i[M]=r[M]^T[O]}return i}sc({blockSize:16,nonceLength:16},(function(t,e){function n(r,i){const s=Ko(t),o=e.slice(),a=jW(s,o,r,i);return s.fill(0),o.fill(0),a}return $t(t),$t(e,$r),{encrypt:(r,i)=>n(r,i),decrypt:(r,i)=>n(r,i)}}));function xC(t){if($t(t),t.length%$r!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function SC(t,e,n){let r=t.length;const i=r%$r;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=pt(t);if(e){let a=$r-i;a||(a=$r),r+=a}const o=oc(r,n);return{b:s,o:pt(o),out:o}}function AC(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function kC(t){const e=new Uint8Array(16),n=pt(e);e.set(t);const r=$r-t.length;for(let i=$r-r;i<$r;i++)e[i]=r;return n}sc({blockSize:16},(function(t,e={}){$t(t);const n=!e.disablePadding;return{encrypt:(r,i)=>{$t(r);const{b:s,o,out:a}=SC(r,n,i),l=Ko(t);let c=0;for(;c+4<=s.length;){const{s0:u,s1:f,s2:h,s3:d}=oi(l,s[c+0],s[c+1],s[c+2],s[c+3]);o[c++]=u,o[c++]=f,o[c++]=h,o[c++]=d}if(n){const u=kC(r.subarray(4*c)),{s0:f,s1:h,s2:d,s3:p}=oi(l,u[0],u[1],u[2],u[3]);o[c++]=f,o[c++]=h,o[c++]=d,o[c++]=p}return l.fill(0),a},decrypt:(r,i)=>{xC(r);const s=vC(t),o=oc(r.length,i),a=pt(r),l=pt(o);for(let c=0;c+4<=a.length;){const{s0:u,s1:f,s2:h,s3:d}=EC(s,a[c+0],a[c+1],a[c+2],a[c+3]);l[c++]=u,l[c++]=f,l[c++]=h,l[c++]=d}return s.fill(0),AC(o,n)}}}));const _C=sc({blockSize:16,nonceLength:16},(function(t,e,n={}){$t(t),$t(e,16);const r=!n.disablePadding;return{encrypt:(i,s)=>{const o=Ko(t),{b:a,o:l,out:c}=SC(i,r,s),u=pt(e);let f=u[0],h=u[1],d=u[2],p=u[3],g=0;for(;g+4<=a.length;)f^=a[g+0],h^=a[g+1],d^=a[g+2],p^=a[g+3],{s0:f,s1:h,s2:d,s3:p}=oi(o,f,h,d,p),l[g++]=f,l[g++]=h,l[g++]=d,l[g++]=p;if(r){const b=kC(i.subarray(4*g));f^=b[0],h^=b[1],d^=b[2],p^=b[3],{s0:f,s1:h,s2:d,s3:p}=oi(o,f,h,d,p),l[g++]=f,l[g++]=h,l[g++]=d,l[g++]=p}return o.fill(0),c},decrypt:(i,s)=>{xC(i);const o=vC(t),a=pt(e),l=oc(i.length,s),c=pt(i),u=pt(l);let f=a[0],h=a[1],d=a[2],p=a[3];for(let g=0;g+4<=c.length;){const b=f,w=h,x=d,T=p;f=c[g+0],h=c[g+1],d=c[g+2],p=c[g+3];const{s0:M,s1:O,s2:_,s3:L}=EC(o,f,h,d,p);u[g++]=M^b,u[g++]=O^w,u[g++]=_^x,u[g++]=L^T}return o.fill(0),AC(l,r)}}}));sc({blockSize:16,nonceLength:16},(function(t,e){function n(r,i,s){const o=Ko(t),a=r.length;s=oc(a,s);const l=pt(r),c=pt(s),u=i?c:l,f=pt(e);let h=f[0],d=f[1],p=f[2],g=f[3];for(let w=0;w+4<=l.length;){const{s0:x,s1:T,s2:M,s3:O}=oi(o,h,d,p,g);c[w+0]=l[w+0]^x,c[w+1]=l[w+1]^T,c[w+2]=l[w+2]^M,c[w+3]=l[w+3]^O,h=u[w++],d=u[w++],p=u[w++],g=u[w++]}const b=$r*Math.floor(l.length/4);if(b<a){({s0:h,s1:d,s2:p,s3:g}=oi(o,h,d,p,g));const w=T1(new Uint32Array([h,d,p,g]));for(let x=b,T=0;x<a;x++,T++)s[x]=r[x]^w[T];w.fill(0)}return o.fill(0),s}return $t(t),$t(e,16),{encrypt:(r,i)=>n(r,!0,i),decrypt:(r,i)=>n(r,!1,i)}}));function CC(t,e,n,r,i){const s=t.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=Sp(o);return i&&by(a,0,BigInt(8*i.length),e),by(a,8,BigInt(8*r.length),e),s.update(o),s.digest()}sc({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if($t(e),e.length===0)throw new Error("aes/gcm: empty nonce");const r=16;function i(o,a,l){const c=CC(xx,!1,o,l,n);for(let u=0;u<a.length;u++)c[u]^=a[u];return c}function s(){const o=Ko(t),a=vf.slice(),l=vf.slice();if($c(o,!1,l,l,a),e.length===12)l.set(e);else{const c=vf.slice();by(Sp(c),8,BigInt(8*e.length),!1),xx.create(a).update(e).update(c).digestInto(l)}return{xk:o,authKey:a,counter:l,tagMask:$c(o,!1,l,vf)}}return{encrypt:o=>{$t(o);const{xk:a,authKey:l,counter:c,tagMask:u}=s(),f=new Uint8Array(o.length+r);$c(a,!1,c,o,f);const h=i(l,u,f.subarray(0,f.length-r));return f.set(h,o.length),a.fill(0),f},decrypt:o=>{if($t(o),o.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:a,authKey:l,counter:c,tagMask:u}=s(),f=o.subarray(0,-16),h=o.subarray(-16);if(!I1(i(l,u,f),h))throw new Error("aes/gcm: invalid ghash tag");const d=$c(a,!1,c,f);return l.fill(0),u.fill(0),a.fill(0),d}}}));const Ef=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};sc({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=Ef("AAD",0,68719476736),i=Ef("plaintext",0,2**36),s=Ef("nonce",12,12),o=Ef("ciphertext",16,2**36+16);function a(){const u=t.length;if(u!==16&&u!==24&&u!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${u} bytes`);const f=Ko(t),h=new Uint8Array(u),d=new Uint8Array(16),p=pt(e);let g=0,b=p[0],w=p[1],x=p[2],T=0;for(const M of[d,h].map(pt)){const O=pt(M);for(let _=0;_<O.length;_+=2){const{s0:L,s1:A}=oi(f,g,b,w,x);O[_+0]=L,O[_+1]=A,g=++T}}return f.fill(0),{authKey:d,encKey:Ko(h)}}function l(u,f,h){const d=CC(UW,!0,f,h,n);for(let T=0;T<12;T++)d[T]^=e[T];d[15]&=127;const p=pt(d);let g=p[0],b=p[1],w=p[2],x=p[3];return{s0:g,s1:b,s2:w,s3:x}=oi(u,g,b,w,x),p[0]=g,p[1]=b,p[2]=w,p[3]=x,d}function c(u,f,h){let d=f.slice();return d[15]|=128,$c(u,!0,d,h)}return $t(e),s(e.length),n&&($t(n),r(n.length)),{encrypt:u=>{$t(u),i(u.length);const{encKey:f,authKey:h}=a(),d=l(f,h,u),p=new Uint8Array(u.length+16);return p.set(d,u.length),p.set(c(f,d,u)),f.fill(0),h.fill(0),p},decrypt:u=>{$t(u),o(u.length);const f=u.subarray(-16),{encKey:h,authKey:d}=a(),p=c(h,f,u.subarray(0,-16)),g=l(h,d,p);if(h.fill(0),d.fill(0),!I1(f,g))throw new Error("invalid polyval tag");return p}}}));const Nn=(t,e)=>255&t[e++]|(255&t[e++])<<8;class qW{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,$t(e=Wo(e),32);const n=Nn(e,0),r=Nn(e,2),i=Nn(e,4),s=Nn(e,6),o=Nn(e,8),a=Nn(e,10),l=Nn(e,12),c=Nn(e,14);this.r[0]=8191&n,this.r[1]=8191&(n>>>13|r<<3),this.r[2]=7939&(r>>>10|i<<6),this.r[3]=8191&(i>>>7|s<<9),this.r[4]=255&(s>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|a<<2),this.r[7]=8065&(a>>>11|l<<5),this.r[8]=8191&(l>>>8|c<<8),this.r[9]=c>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Nn(e,16+2*u)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],l=o[1],c=o[2],u=o[3],f=o[4],h=o[5],d=o[6],p=o[7],g=o[8],b=o[9],w=Nn(e,n+0),x=Nn(e,n+2),T=Nn(e,n+4),M=Nn(e,n+6),O=Nn(e,n+8),_=Nn(e,n+10),L=Nn(e,n+12),A=Nn(e,n+14);let E=s[0]+(8191&w),S=s[1]+(8191&(w>>>13|x<<3)),k=s[2]+(8191&(x>>>10|T<<6)),P=s[3]+(8191&(T>>>7|M<<9)),D=s[4]+(8191&(M>>>4|O<<12)),H=s[5]+(O>>>1&8191),N=s[6]+(8191&(O>>>14|_<<2)),I=s[7]+(8191&(_>>>11|L<<5)),$=s[8]+(8191&(L>>>8|A<<8)),V=s[9]+(A>>>5|i),U=0,W=U+E*a+S*(5*b)+k*(5*g)+P*(5*p)+D*(5*d);U=W>>>13,W&=8191,W+=H*(5*h)+N*(5*f)+I*(5*u)+$*(5*c)+V*(5*l),U+=W>>>13,W&=8191;let ee=U+E*l+S*a+k*(5*b)+P*(5*g)+D*(5*p);U=ee>>>13,ee&=8191,ee+=H*(5*d)+N*(5*h)+I*(5*f)+$*(5*u)+V*(5*c),U+=ee>>>13,ee&=8191;let X=U+E*c+S*l+k*a+P*(5*b)+D*(5*g);U=X>>>13,X&=8191,X+=H*(5*p)+N*(5*d)+I*(5*h)+$*(5*f)+V*(5*u),U+=X>>>13,X&=8191;let he=U+E*u+S*c+k*l+P*a+D*(5*b);U=he>>>13,he&=8191,he+=H*(5*g)+N*(5*p)+I*(5*d)+$*(5*h)+V*(5*f),U+=he>>>13,he&=8191;let oe=U+E*f+S*u+k*c+P*l+D*a;U=oe>>>13,oe&=8191,oe+=H*(5*b)+N*(5*g)+I*(5*p)+$*(5*d)+V*(5*h),U+=oe>>>13,oe&=8191;let Y=U+E*h+S*f+k*u+P*c+D*l;U=Y>>>13,Y&=8191,Y+=H*a+N*(5*b)+I*(5*g)+$*(5*p)+V*(5*d),U+=Y>>>13,Y&=8191;let be=U+E*d+S*h+k*f+P*u+D*c;U=be>>>13,be&=8191,be+=H*l+N*a+I*(5*b)+$*(5*g)+V*(5*p),U+=be>>>13,be&=8191;let Re=U+E*p+S*d+k*h+P*f+D*u;U=Re>>>13,Re&=8191,Re+=H*c+N*l+I*a+$*(5*b)+V*(5*g),U+=Re>>>13,Re&=8191;let de=U+E*g+S*p+k*d+P*h+D*f;U=de>>>13,de&=8191,de+=H*u+N*c+I*l+$*a+V*(5*b),U+=de>>>13,de&=8191;let Me=U+E*b+S*g+k*p+P*d+D*h;U=Me>>>13,Me&=8191,Me+=H*f+N*u+I*c+$*l+V*a,U+=Me>>>13,Me&=8191,U=(U<<2)+U|0,U=U+W|0,W=8191&U,U>>>=13,ee+=U,s[0]=W,s[1]=ee,s[2]=X,s[3]=he,s[4]=oe,s[5]=Y,s[6]=be,s[7]=Re,s[8]=de,s[9]=Me}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(1^i)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+n[0];e[0]=65535&o;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=65535&o}update(e){Gl(this);const{buffer:n,blockLen:r}=this,i=(e=Wo(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0);else for(;r<=i-s;s+=r)this.process(e,s)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){Gl(this),C1(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}(function(t){const e=(r,i)=>t(i).update(Wo(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e})((t=>new qW(t)));const TC=t=>Uint8Array.from(t.split("").map((e=>e.charCodeAt(0)))),VW=TC("expand 16-byte k"),WW=TC("expand 32-byte k"),KW=pt(VW),IC=pt(WW);IC.slice();function ze(t,e){return t<<e|t>>>32-e}function Um(t){return t.byteOffset%4==0}const Sx=2**32-1,Ax=new Uint32Array;function OC(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=(function(a,l){if(l==null||typeof l!="object")throw new Error("options must be defined");return Object.assign(a,l)})({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Bm(i),Bm(o),Ex(s),Ex(n),(a,l,c,u,f=0)=>{$t(a),$t(l),$t(c);const h=c.length;if(u||(u=new Uint8Array(h)),$t(u),Bm(f),f<0||f>=Sx)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const d=[];let p,g,b=a.length;if(b===32)p=a.slice(),d.push(p),g=IC;else{if(b!==16||!n)throw new Error(`arx: invalid 32-byte key, got length=${b}`);p=new Uint8Array(32),p.set(a),p.set(a,16),g=KW,d.push(p)}Um(l)||(l=l.slice(),d.push(l));const w=pt(p);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,w,pt(l.subarray(0,16)),w),l=l.subarray(16)}const x=16-i;if(x!==l.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const M=new Uint8Array(12);M.set(l,s?0:12-l.length),l=M,d.push(l)}const T=pt(l);for(!(function(M,O,_,L,A,E,S,k){const P=A.length,D=new Uint8Array(64),H=pt(D),N=Um(A)&&Um(E),I=N?pt(A):Ax,$=N?pt(E):Ax;for(let V=0;V<P;S++){if(M(O,_,L,H,S,k),S>=Sx)throw new Error("arx: counter overflow");const U=Math.min(64,P-V);if(N&&U===64){const W=V/4;if(V%4!=0)throw new Error("arx: invalid block position");for(let ee,X=0;X<16;X++)ee=W+X,$[ee]=I[ee]^H[X];V+=64}else{for(let W,ee=0;ee<U;ee++)W=V+ee,E[W]=A[W]^D[ee];V+=U}}})(t,g,w,T,c,u,f,o);d.length>0;)d.pop().fill(0);return u}}function $C(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],f=e[1],h=e[2],d=e[3],p=e[4],g=e[5],b=e[6],w=e[7],x=i,T=n[0],M=n[1],O=n[2],_=o,L=a,A=l,E=c,S=u,k=f,P=h,D=d,H=p,N=g,I=b,$=w,V=x,U=T,W=M,ee=O;for(let he=0;he<s;he+=2)_=_+S|0,V=ze(V^_,16),H=H+V|0,S=ze(S^H,12),_=_+S|0,V=ze(V^_,8),H=H+V|0,S=ze(S^H,7),L=L+k|0,U=ze(U^L,16),N=N+U|0,k=ze(k^N,12),L=L+k|0,U=ze(U^L,8),N=N+U|0,k=ze(k^N,7),A=A+P|0,W=ze(W^A,16),I=I+W|0,P=ze(P^I,12),A=A+P|0,W=ze(W^A,8),I=I+W|0,P=ze(P^I,7),E=E+D|0,ee=ze(ee^E,16),$=$+ee|0,D=ze(D^$,12),E=E+D|0,ee=ze(ee^E,8),$=$+ee|0,D=ze(D^$,7),_=_+k|0,ee=ze(ee^_,16),I=I+ee|0,k=ze(k^I,12),_=_+k|0,ee=ze(ee^_,8),I=I+ee|0,k=ze(k^I,7),L=L+P|0,V=ze(V^L,16),$=$+V|0,P=ze(P^$,12),L=L+P|0,V=ze(V^L,8),$=$+V|0,P=ze(P^$,7),A=A+D|0,U=ze(U^A,16),H=H+U|0,D=ze(D^H,12),A=A+D|0,U=ze(U^A,8),H=H+U|0,D=ze(D^H,7),E=E+S|0,W=ze(W^E,16),N=N+W|0,S=ze(S^N,12),E=E+S|0,W=ze(W^E,8),N=N+W|0,S=ze(S^N,7);let X=0;r[X++]=o+_|0,r[X++]=a+L|0,r[X++]=l+A|0,r[X++]=c+E|0,r[X++]=u+S|0,r[X++]=f+k|0,r[X++]=h+P|0,r[X++]=d+D|0,r[X++]=p+H|0,r[X++]=g+N|0,r[X++]=b+I|0,r[X++]=w+$|0,r[X++]=x+V|0,r[X++]=T+U|0,r[X++]=M+W|0,r[X++]=O+ee|0}const MC=OC($C,{counterRight:!1,counterLength:4,allowShortKeys:!1});OC($C,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let i=t[0],s=t[1],o=t[2],a=t[3],l=e[0],c=e[1],u=e[2],f=e[3],h=e[4],d=e[5],p=e[6],g=e[7],b=n[0],w=n[1],x=n[2],T=n[3];for(let O=0;O<20;O+=2)i=i+l|0,b=ze(b^i,16),h=h+b|0,l=ze(l^h,12),i=i+l|0,b=ze(b^i,8),h=h+b|0,l=ze(l^h,7),s=s+c|0,w=ze(w^s,16),d=d+w|0,c=ze(c^d,12),s=s+c|0,w=ze(w^s,8),d=d+w|0,c=ze(c^d,7),o=o+u|0,x=ze(x^o,16),p=p+x|0,u=ze(u^p,12),o=o+u|0,x=ze(x^o,8),p=p+x|0,u=ze(u^p,7),a=a+f|0,T=ze(T^a,16),g=g+T|0,f=ze(f^g,12),a=a+f|0,T=ze(T^a,8),g=g+T|0,f=ze(f^g,7),i=i+c|0,T=ze(T^i,16),p=p+T|0,c=ze(c^p,12),i=i+c|0,T=ze(T^i,8),p=p+T|0,c=ze(c^p,7),s=s+u|0,b=ze(b^s,16),g=g+b|0,u=ze(u^g,12),s=s+u|0,b=ze(b^s,8),g=g+b|0,u=ze(u^g,7),o=o+f|0,w=ze(w^o,16),h=h+w|0,f=ze(f^h,12),o=o+f|0,w=ze(w^o,8),h=h+w|0,f=ze(f^h,7),a=a+l|0,x=ze(x^a,16),d=d+x|0,l=ze(l^d,12),a=a+l|0,x=ze(x^a,8),d=d+x|0,l=ze(l^d,7);let M=0;r[M++]=i,r[M++]=s,r[M++]=o,r[M++]=a,r[M++]=b,r[M++]=w,r[M++]=x,r[M++]=T},allowShortKeys:!1});class NC extends lC{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Vi.hash(e);const r=Su(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Vi.exists(this),this.iHash.update(e),this}digestInto(e){Vi.exists(this),Vi.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ap=(t,e,n)=>new NC(t,e).update(n).digest();function GW(t,e,n){return Vi.hash(t),Ap(t,Su(n),Su(e))}Ap.create=(t,e)=>new NC(t,e);const zm=new Uint8Array([0]),kx=new Uint8Array;function ZW(t,e,n,r=32){if(Vi.hash(t),Vi.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=kx);const s=new Uint8Array(i*t.outputLen),o=Ap.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)zm[0]=c+1,a.update(c===0?kx:l).update(n).update(zm).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),zm.fill(0),s.slice(0,r)}var YW=Object.defineProperty,Zt=(t,e)=>{for(var n in e)YW(t,n,{get:e[n],enumerable:!0})},vo=Symbol("verified"),JW=t=>t instanceof Object;function kp(t){if(!JW(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function XW(t){return t.sort(((e,n)=>e.created_at!==n.created_at?n.created_at-e.created_at:e.id.localeCompare(n.id)))}var LC={};Zt(LC,{Queue:()=>PC,QueueNode:()=>RC,binarySearch:()=>N1,insertEventIntoAscendingList:()=>eK,insertEventIntoDescendingList:()=>QW,normalizeURL:()=>yl,utf8Decoder:()=>ks,utf8Encoder:()=>xi});var ks=new TextDecoder("utf-8"),xi=new TextEncoder;function yl(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function QW(t,e){const[n,r]=N1(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at));return r||t.splice(n,0,e),t}function eK(t,e){const[n,r]=N1(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at));return r||t.splice(n,0,e),t}function N1(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var RC=class{value;next=null;prev=null;constructor(t){this.value=t}},PC=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new RC(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function DC(t){if(!kp(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Zc(t){return hn(Ya(xi.encode(DC(t))))}var _p=new class{generateSecretKey(){return Ui.utils.randomPrivateKey()}getPublicKey(t){return hn(Ui.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=hn(Ui.getPublicKey(e)),n.id=Zc(n),n.sig=hn(Ui.sign(Zc(n),e)),n[vo]=!0,n}verifyEvent(t){if(typeof t[vo]=="boolean")return t[vo];const e=Zc(t);if(e!==t.id)return t[vo]=!1,!1;try{const n=Ui.verify(t.sig,e,t.pubkey);return t[vo]=n,n}catch{return t[vo]=!1,!1}}},BC=_p.generateSecretKey,L1=_p.getPublicKey,Si=_p.finalizeEvent,ac=_p.verifyEvent,HC={};function UC(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function R1(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function zC(t){return 2e4<=t&&t<3e4}function P1(t){return 3e4<=t&&t<4e4}function tK(t){return UC(t)?"regular":R1(t)?"replaceable":zC(t)?"ephemeral":P1(t)?"parameterized":"unknown"}function nK(t,e){const n=e instanceof Array?e:[e];return kp(t)&&n.includes(t.kind)||!1}Zt(HC,{Application:()=>nG,BadgeAward:()=>cK,BadgeDefinition:()=>ZK,BlockedRelaysList:()=>NK,BookmarkList:()=>OK,Bookmarksets:()=>WK,Calendar:()=>cG,CalendarEventRSVP:()=>uG,ChannelCreation:()=>jC,ChannelHideMessage:()=>WC,ChannelMessage:()=>VC,ChannelMetadata:()=>qC,ChannelMuteUser:()=>KC,ClassifiedListing:()=>sG,ClientAuth:()=>ZC,CommunitiesList:()=>$K,CommunityDefinition:()=>dG,CommunityPostApproval:()=>wK,Contacts:()=>oK,CreateOrUpdateProduct:()=>XK,CreateOrUpdateStall:()=>JK,Curationsets:()=>KK,Date:()=>aG,DirectMessageRelaysList:()=>DK,DraftClassifiedListing:()=>oG,DraftLong:()=>eG,Emojisets:()=>tG,EncryptedDirectMessage:()=>aK,EventDeletion:()=>lK,FileMetadata:()=>dK,FileServerPreference:()=>BK,Followsets:()=>jK,GenericRepost:()=>fK,Genericlists:()=>qK,GiftWrap:()=>GC,HTTPAuth:()=>H1,Handlerinformation:()=>hG,Handlerrecommendation:()=>fG,Highlights:()=>_K,InterestsList:()=>RK,Interestsets:()=>YK,JobFeedback:()=>xK,JobRequest:()=>vK,JobResult:()=>EK,Label:()=>bK,LightningPubRPC:()=>UK,LiveChatMessage:()=>pK,LiveEvent:()=>rG,LongFormArticle:()=>QK,Metadata:()=>rK,Mutelist:()=>CK,NWCWalletInfo:()=>HK,NWCWalletRequest:()=>YC,NWCWalletResponse:()=>zK,NostrConnect:()=>FK,OpenTimestamps:()=>hK,Pinlist:()=>TK,PrivateDirectMessage:()=>uK,ProblemTracker:()=>gK,ProfileBadges:()=>GK,PublicChatsList:()=>MK,Reaction:()=>B1,RecommendRelay:()=>sK,RelayList:()=>IK,Relaysets:()=>VK,Report:()=>mK,Reporting:()=>yK,Repost:()=>D1,Seal:()=>FC,SearchRelaysList:()=>LK,ShortTextNote:()=>iK,Time:()=>lG,UserEmojiList:()=>PK,UserStatuses:()=>iG,Zap:()=>kK,ZapGoal:()=>SK,ZapRequest:()=>AK,classifyKind:()=>tK,isEphemeralKind:()=>zC,isKind:()=>nK,isParameterizedReplaceableKind:()=>P1,isRegularKind:()=>UC,isReplaceableKind:()=>R1});var rK=0,iK=1,sK=2,oK=3,aK=4,lK=5,D1=6,B1=7,cK=8,FC=13,uK=14,fK=16,jC=40,qC=41,VC=42,WC=43,KC=44,hK=1040,GC=1059,dK=1063,pK=1311,gK=1971,mK=1984,yK=1984,bK=1985,wK=4550,vK=5999,EK=6999,xK=7e3,SK=9041,AK=9734,kK=9735,_K=9802,CK=1e4,TK=10001,IK=10002,OK=10003,$K=10004,MK=10005,NK=10006,LK=10007,RK=10015,PK=10030,DK=10050,BK=10096,HK=13194,UK=21e3,ZC=22242,YC=23194,zK=23195,FK=24133,H1=27235,jK=3e4,qK=30001,VK=30002,WK=30003,KK=30004,GK=30008,ZK=30009,YK=30015,JK=30017,XK=30018,QK=30023,eG=30024,tG=30030,nG=30078,rG=30311,iG=30315,sG=30402,oG=30403,aG=31922,lG=31923,cG=31924,uG=31925,fG=31989,hG=31990,dG=34550;function JC(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}function XC(t,e){for(let n=0;n<t.length;n++)if(JC(t[n],e))return!0;return!1}function pG(...t){let e={};for(let n=0;n<t.length;n++){let r=t[n];Object.entries(r).forEach((([i,s])=>{if(i==="kinds"||i==="ids"||i==="authors"||i[0]==="#"){e[i]=e[i]||[];for(let o=0;o<s.length;o++){let a=s[o];e[i].includes(a)||e[i].push(a)}}})),r.limit&&(!e.limit||r.limit>e.limit)&&(e.limit=r.limit),r.until&&(!e.until||r.until>e.until)&&(e.until=r.until),r.since&&(!e.since||r.since<e.since)&&(e.since=r.since)}return e}function gG(t){if(t.ids&&!t.ids.length||t.kinds&&!t.kinds.length||t.authors&&!t.authors.length)return 0;for(const[e,n]of Object.entries(t))if(e[0]==="#"&&Array.isArray(n)&&!n.length)return 0;return Math.min(Math.max(0,t.limit??1/0),t.ids?.length??1/0,t.authors?.length&&t.kinds?.every((e=>R1(e)))?t.authors.length*t.kinds.length:1/0,t.authors?.length&&t.kinds?.every((e=>P1(e)))&&t["#d"]?.length?t.authors.length*t.kinds.length*t["#d"].length:1/0)}var QC={};function Cp(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function eT(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function tT(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function mG(t,e){return e===Cp(t,"id")}function yG(t,e){return e===Cp(t,"pubkey")}function bG(t,e){return e===eT(t,"kind")}Zt(QC,{getHex64:()=>Cp,getInt:()=>eT,getSubscriptionId:()=>tT,matchEventId:()=>mG,matchEventKind:()=>bG,matchEventPubkey:()=>yG});var nT={};function rT(t,e){return{kind:ZC,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function wG(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}Zt(nT,{makeAuthEvent:()=>rT});var iT,vG=t=>(t[vo]=!0,!0),U1=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new PC;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=yl(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new U1(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await wG();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=tT(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=Cp(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&XC(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t(rT(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new EG(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},EG=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{iT=WebSocket}catch{}var sT,oT=class extends U1{constructor(t){super(t,{verifyEvent:ac,websocketImplementation:iT})}static async connect(t){const e=new oT(t);return await e.connect(),e}},xG=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=yl(t);let n=this.relays.get(t);return n||(n=new U1(t,{verifyEvent:this.trustedRelayURLs.has(t)?vG:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(yl).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(f,h)=>{let d=this.seenOn.get(h);d||(d=new Set,this.seenOn.set(h,d)),d.add(f)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=f=>{s[f]=!0,s.filter((h=>h)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(f,h)=>{o(f),a[f]=h,a.filter((d=>d)).length===i&&(e.onclose?.(a),l=()=>{})};const c=f=>{if(e.alreadyHaveEvent?.(f))return!0;const h=n.has(f);return n.add(f),h},u=Promise.all(Object.entries(t).map((async(f,h,d)=>{if(d.indexOf(f)!==h)return void l(h,"duplicate url");let p,[g,b]=f;g=yl(g);try{p=await this.ensureRelay(g,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(x){return void l(h,x?.message||String(x))}let w=p.subscribe(b,{...e,oneose:()=>o(h),onclose:x=>l(h,x),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(w)})));return{async close(){await u,r.forEach((f=>{f.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(yl).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{sT=WebSocket}catch{}var SG=class extends xG{constructor(){super({verifyEvent:ac,websocketImplementation:sT})}},aT={};Zt(aT,{BECH32_REGEX:()=>lT,Bech32MaxSize:()=>z1,NostrTypeGuard:()=>AG,decode:()=>Uu,encodeBytes:()=>Ip,naddrEncode:()=>OG,neventEncode:()=>IG,noteEncode:()=>CG,nprofileEncode:()=>TG,npubEncode:()=>_G,nsecEncode:()=>kG});var AG={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},z1=5e3,lT=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Uu(t){let{prefix:e,words:n}=Kl.decode(t,z1),r=new Uint8Array(Kl.fromWords(n));switch(e){case"nprofile":{let i=Fm(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:hn(i[0][0]),relays:i[1]?i[1].map((s=>ks.decode(s))):[]}}}case"nevent":{let i=Fm(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:hn(i[0][0]),relays:i[1]?i[1].map((s=>ks.decode(s))):[],author:i[2]?.[0]?hn(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(hn(i[3][0]),16):void 0}}}case"naddr":{let i=Fm(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:ks.decode(i[0][0]),pubkey:hn(i[2][0]),kind:parseInt(hn(i[3][0]),16),relays:i[1]?i[1].map((s=>ks.decode(s))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:hn(r)};default:throw new Error(`unknown prefix ${e}`)}}function Fm(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function kG(t){return Ip("nsec",t)}function _G(t){return Ip("npub",Wl(t))}function CG(t){return Ip("note",Wl(t))}function Tp(t,e){let n=Kl.toWords(e);return Kl.encode(t,n,z1)}function Ip(t,e){return Tp(t,e)}function TG(t){return Tp("nprofile",F1({0:[Wl(t.pubkey)],1:(t.relays||[]).map((e=>xi.encode(e)))}))}function IG(t){let e;return t.kind!==void 0&&(e=(function(n){const r=new Uint8Array(4);return r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=255&n,r})(t.kind)),Tp("nevent",F1({0:[Wl(t.id)],1:(t.relays||[]).map((n=>xi.encode(n))),2:t.author?[Wl(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function OG(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),Tp("naddr",F1({0:[xi.encode(t.identifier)],1:(t.relays||[]).map((n=>xi.encode(n))),2:[Wl(t.pubkey)],3:[new Uint8Array(e)]}))}function F1(t){let e=[];return Object.entries(t).reverse().forEach((([n,r])=>{r.forEach((i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)}))})),xp(...e)}var $G=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function MG(t){let e=[];for(let n of t.content.matchAll($G))if(n[2])try{let{type:r,data:i}=Uu(n[1]);switch(r){case"npub":e.push({text:n[0],profile:{pubkey:i,relays:[]}});break;case"nprofile":e.push({text:n[0],profile:i});break;case"note":e.push({text:n[0],event:{id:i,relays:[]}});break;case"nevent":e.push({text:n[0],event:i});break;case"naddr":e.push({text:n[0],address:i})}}catch{}else if(n[3]){let r=parseInt(n[3],10),i=t.tags[r];if(!i)continue;switch(i[0]){case"p":e.push({text:n[0],profile:{pubkey:i[1],relays:i[2]?[i[2]]:[]}});break;case"e":e.push({text:n[0],event:{id:i[1],relays:i[2]?[i[2]]:[]}});break;case"a":try{let[s,o,a]=i[1].split(":");e.push({text:n[0],address:{identifier:a,pubkey:o,kind:parseInt(s,10),relays:i[2]?[i[2]]:[]}})}catch{}}}return e}var cT={};async function uT(t,e,n){const r=t instanceof Uint8Array?hn(t):t,i=fT(rc.getSharedSecret(r,"02"+e));let s=Uint8Array.from(uC(16)),o=xi.encode(n),a=_C(i,s).encrypt(o);return`${Vo.encode(new Uint8Array(a))}?iv=${Vo.encode(new Uint8Array(s.buffer))}`}async function NG(t,e,n){const r=t instanceof Uint8Array?hn(t):t;let[i,s]=n.split("?iv="),o=fT(rc.getSharedSecret(r,"02"+e)),a=Vo.decode(s),l=Vo.decode(i),c=_C(o,a).decrypt(l);return ks.decode(c)}function fT(t){return t.slice(1,33)}Zt(cT,{decrypt:()=>NG,encrypt:()=>uT});var hT={};Zt(hT,{NIP05_REGEX:()=>j1,isNip05:()=>LG,isValid:()=>DG,queryProfile:()=>dT,searchDomain:()=>PG,useFetchImplementation:()=>RG});var Op,j1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,LG=t=>j1.test(t||"");try{Op=fetch}catch{}function RG(t){Op=t}async function PG(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Op(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function dT(t){const e=t.match(j1);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Op(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function DG(t,e){const n=await dT(e);return!!n&&n.pubkey===t}var pT={};function BG(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,f={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=f;continue}if(c==="reply"){e.reply=f;continue}if(c==="mention"){e.mentions.push(f);continue}n?r=f:n=f,e.mentions.push(f)}else{if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}s[0]==="p"&&s[1]&&e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find((a=>a.pubkey===i.author));o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach((a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)})),o.relays=i.relays)}})),e.mentions.forEach((i=>{if(i.author){let s=e.profiles.find((o=>o.pubkey===i.author));s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach((o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)})),s.relays=i.relays)}})),e}Zt(pT,{parse:()=>BG});var gT={};Zt(gT,{fetchRelayInformation:()=>UG,useFetchImplementation:()=>HG});function HG(t){}async function UG(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var mT={};function yT(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r!==0){e+=Math.clz32(r);break}e+=32}return e}function zG(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=bT(r),yT(r.id)>=e)break}return r}function bT(t){return hn(Ya(xi.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}Zt(mT,{fastEventHash:()=>bT,getPow:()=>yT,minePow:()=>zG});var wT={};function FG(t,e,n,r){return Si({kind:D1,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function vT(t){if(t.kind!==D1)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0?{id:e[1],relays:[e[2],n?.[2]].filter((r=>typeof r=="string")),author:n?.[1]}:void 0}function jG(t,{skipVerification:e}={}){const n=vT(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}return r.id===n.id&&(e||ac(r))?r:void 0}Zt(wT,{finishRepostEvent:()=>FG,getRepostedEvent:()=>jG,getRepostedEventPointer:()=>vT});var ET={};Zt(ET,{NOSTR_URI_REGEX:()=>$p,parse:()=>VG,test:()=>qG});var $p=new RegExp(`nostr:(${lT.source})`);function qG(t){return typeof t=="string"&&new RegExp(`^${$p.source}$`).test(t)}function VG(t){const e=t.match(new RegExp(`^${$p.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Uu(e[1])}}var xT={};function WG(t,e,n){const r=e.tags.filter((i=>i.length>=2&&(i[0]==="e"||i[0]==="p")));return Si({...t,kind:B1,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function KG(t){if(t.kind!==B1)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0&&n!==void 0?{id:e[1],relays:[e[2],n[2]].filter((r=>r!==void 0)),author:n[1]}:void 0}Zt(xT,{finishReactionEvent:()=>WG,getReactedEventPointer:()=>KG});var ST={};Zt(ST,{matchAll:()=>GG,regex:()=>q1,replaceAll:()=>ZG});var q1=()=>new RegExp(`\\b${$p.source}\\b`,"g");function*GG(t){const e=t.matchAll(q1());for(const n of e)try{const[r,i]=n;yield{uri:r,value:i,decoded:Uu(i),start:n.index,end:n.index+r.length}}catch{}}function ZG(t,e){return t.replaceAll(q1(),((n,r)=>e({uri:n,value:r,decoded:Uu(r)})))}var AT={};Zt(AT,{channelCreateEvent:()=>YG,channelHideMessageEvent:()=>QG,channelMessageEvent:()=>XG,channelMetadataEvent:()=>JG,channelMuteUserEvent:()=>eZ});var YG=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return Si({kind:jC,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},JG=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return Si({kind:qC,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},XG=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),Si({kind:VC,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},QG=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return Si({kind:WC,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},eZ=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return Si({kind:KC,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},kT={};Zt(kT,{EMOJI_SHORTCODE_REGEX:()=>_T,matchAll:()=>tZ,regex:()=>V1,replaceAll:()=>nZ});var _T=/:(\w+):/,V1=()=>new RegExp(`\\B${_T.source}\\B`,"g");function*tZ(t){const e=t.matchAll(V1());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function nZ(t,e){return t.replaceAll(V1(),((n,r)=>e({shortcode:n,name:r})))}var W1,CT={};Zt(CT,{useFetchImplementation:()=>rZ,validateGithub:()=>iZ});try{W1=fetch}catch{}function rZ(t){W1=t}async function iZ(t,e,n){try{return await(await W1(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var TT={};Zt(TT,{decrypt:()=>Y1,encrypt:()=>Z1,getConversationKey:()=>K1,v2:()=>oZ});var IT=1,OT=65535;function K1(t,e){const n=rc.getSharedSecret(t,"02"+e).subarray(1,33);return GW(Ya,n,"nip44-v2")}function $T(t,e){const n=ZW(Ya,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function G1(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function sZ(t){const e=xi.encode(t),n=e.length;return xp((function(r){if(!Number.isSafeInteger(r)||r<IT||r>OT)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const i=new Uint8Array(2);return new DataView(i.buffer).setUint16(0,r,!1),i})(n),e,new Uint8Array(G1(n)-n))}function MT(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=xp(n,e);return Ap(Ya,t,r)}function Z1(t,e,n=uC(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=$T(e,n),o=sZ(t),a=MC(r,i,o),l=MT(s,a,n);return Vo.encode(xp(new Uint8Array([2]),n,a,l))}function Y1(t,e){const{nonce:n,ciphertext:r,mac:i}=(function(l){if(typeof l!="string")throw new Error("payload must be a valid string");const c=l.length;if(c<132||c>87472)throw new Error("invalid payload length: "+c);if(l[0]==="#")throw new Error("unknown encryption version");let u;try{u=Vo.decode(l)}catch(d){throw new Error("invalid base64: "+d.message)}const f=u.length;if(f<99||f>65603)throw new Error("invalid data length: "+f);const h=u[0];if(h!==2)throw new Error("unknown encryption version "+h);return{nonce:u.subarray(1,33),ciphertext:u.subarray(33,-32),mac:u.subarray(-32)}})(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=$T(e,n);if(!I1(MT(a,r,n),i))throw new Error("invalid MAC");return(function(l){const c=new DataView(l.buffer).getUint16(0),u=l.subarray(2,2+c);if(c<IT||c>OT||u.length!==c||l.length!==2+G1(c))throw new Error("invalid padding");return ks.decode(u)})(MC(s,o,r))}var oZ={utils:{getConversationKey:K1,calcPaddedLen:G1},encrypt:Z1,decrypt:Y1},NT={};function aZ(t){const{pathname:e,searchParams:n}=new URL(t),r=e,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function lZ(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},i=await uT(e,t,JSON.stringify(r)),s={kind:YC,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return Si(s,e)}Zt(NT,{makeNwcRequestEvent:()=>lZ,parseConnectionString:()=>aZ});var J1,LT={};Zt(LT,{getZapEndpoint:()=>uZ,makeZapReceipt:()=>dZ,makeZapRequest:()=>fZ,useFetchImplementation:()=>cZ,validateZapRequest:()=>hZ});try{J1=fetch}catch{}function cZ(t){J1=t}async function uZ(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=Kl.decode(n,1e3),a=Kl.fromWords(o);e=ks.decode(a)}else{if(!r)return null;{let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}}let i=await J1(e),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function fZ({profile:t,event:e,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function hZ(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!kp(e))return"Zap request is not a valid Nostr event.";if(!ac(e))return"Invalid signature on zap request.";let n=e.tags.find((([i,s])=>i==="p"&&s));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([i,s])=>i==="e"&&s));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([i,s])=>i==="relays"&&s))?null:"Zap request doesn't have a 'relays' tag."}function dZ({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter((([a])=>a==="e"||a==="p"||a==="a")),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}var RT={};Zt(RT,{createRumor:()=>UT,createSeal:()=>zT,createWrap:()=>FT,unwrapEvent:()=>jT,unwrapManyEvents:()=>gZ,wrapEvent:()=>vy,wrapManyEvents:()=>pZ});var PT=()=>Math.round(Date.now()/1e3),DT=()=>Math.round(PT()-172800*Math.random()),BT=(t,e)=>K1(t,e),HT=(t,e,n)=>Z1(JSON.stringify(t),BT(e,n)),_x=(t,e)=>JSON.parse(Y1(t.content,BT(e,t.pubkey)));function UT(t,e){const n={created_at:PT(),content:"",tags:[],...t,pubkey:L1(e)};return n.id=Zc(n),n}function zT(t,e,n){return Si({kind:FC,content:HT(t,e,n),created_at:DT(),tags:[]},e)}function FT(t,e){const n=BC();return Si({kind:GC,content:HT(t,n,e),created_at:DT(),tags:[["p",e]]},n)}function vy(t,e,n){return FT(zT(UT(t,e),e,n),n)}function pZ(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=L1(e),i=[vy(t,e,r)];return n.forEach((s=>{i.push(vy(t,e,s))})),i}function jT(t,e){const n=_x(t,e);return _x(n,e)}function gZ(t,e){let n=[];return t.forEach((r=>{n.push(jT(r,e))})),n.sort(((r,i)=>r.created_at-i.created_at)),n}var qT={};Zt(qT,{getToken:()=>mZ,hashPayload:()=>X1,unpackEventFromToken:()=>WT,validateEvent:()=>XT,validateEventKind:()=>GT,validateEventMethodTag:()=>YT,validateEventPayloadTag:()=>JT,validateEventTimestamp:()=>KT,validateEventUrlTag:()=>ZT,validateToken:()=>yZ});var VT="Nostr ";async function mZ(t,e,n,r=!1,i){const s={kind:H1,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",X1(i)]);const o=await n(s);return(r?VT:"")+Vo.encode(xi.encode(JSON.stringify(o)))}async function yZ(t,e,n){const r=await WT(t).catch((i=>{throw i}));return await XT(r,e,n).catch((i=>{throw i}))}async function WT(t){if(!t)throw new Error("Missing token");t=t.replace(VT,"");const e=ks.decode(Vo.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function KT(t){return!!t.created_at&&Math.round(new Date().getTime()/1e3)-t.created_at<60}function GT(t){return t.kind===H1}function ZT(t,e){const n=t.tags.find((r=>r[0]==="u"));return!!n&&n.length>0&&n[1]===e}function YT(t,e){const n=t.tags.find((r=>r[0]==="method"));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function X1(t){return hn(Ya(xi.encode(JSON.stringify(t))))}function JT(t,e){const n=t.tags.find((i=>i[0]==="payload"));if(!n)return!1;const r=X1(e);return n.length>0&&n[1]===r}async function XT(t,e,n,r){if(!ac(t))throw new Error("Invalid nostr event, signature invalid");if(!GT(t))throw new Error("Invalid nostr event, kind invalid");if(!KT(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!ZT(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!YT(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!JT(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const tt={LIBRARIES:{decodeBolt11:lW.decode,NostrTools:cy},DEFAULT_OPTIONS:{theme:"light",colorMode:!0},BATCH_SIZE:5,REQ_CONFIG:{INITIAL_LOAD_COUNT:15,ADDITIONAL_LOAD_COUNT:20},LOAD_TIMEOUT:1e4,BUFFER_INTERVAL:500,BUFFER_MIN_INTERVAL:100,INFINITE_SCROLL:{ROOT_MARGIN:"400px",THRESHOLD:.1,DEBOUNCE_TIME:500,RETRY_DELAY:500},ZAP_CONFIG:{DEFAULT_LIMIT:1,DEFAULT_COLOR_MODE:!0,ERRORS:{DIALOG_NOT_FOUND:"Zap dialog not found",BUTTON_NOT_FOUND:"Fetch button not found",DECODE_FAILED:"Failed to decode identifier"}},ZAP_AMOUNT_CONFIG:{DEFAULT_COLOR_MODE:!0,THRESHOLDS:[{value:1e4,className:"zap-amount-10k"},{value:5e3,className:"zap-amount-5k"},{value:2e3,className:"zap-amount-2k"},{value:1e3,className:"zap-amount-1k"},{value:500,className:"zap-amount-500"},{value:200,className:"zap-amount-200"},{value:100,className:"zap-amount-100"}],DEFAULT_CLASS:"default-color",DISABLED_CLASS:""},DIALOG_CONFIG:{DEFAULT_TITLE:"To ",NO_ZAPS_MESSAGE:"No Zaps yet!<br>Send the first Zap!",DEFAULT_NO_ZAPS_DELAY:1500,ZAP_LIST:{INITIAL_BATCH:30,REMAINING_BATCH:30,PROFILE_BATCH:30,MIN_HEIGHT:"100px"}},REQUEST_CONFIG:{METADATA_TIMEOUT:2e4,REQUEST_TIMEOUT:2e3,CACHE_DURATION:3e5},PROFILE_CONFIG:{BATCH_SIZE:20,BATCH_DELAY:100,RELAYS:["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine","wss://directory.yabu.me"]},BATCH_CONFIG:{REFERENCE_PROCESSOR:{BATCH_SIZE:20,BATCH_DELAY:100},SUPPORTED_EVENT_KINDS:[1,30023,30030,30009,40,42,31990]},BATCH_PROCESSOR_CONFIG:{DEFAULT_BATCH_SIZE:20,DEFAULT_BATCH_DELAY:100,DEFAULT_MAX_CACHE_AGE:18e5,DEFAULT_RELAY_URLS:[],TIMEOUT_DURATION:500}};class md{constructor(e,n,r=null){this.identifier=e,this.relayUrls=n,this.isColorModeEnabled=r===null?tt.ZAP_CONFIG.DEFAULT_COLOR_MODE:String(r).toLowerCase()==="true"}static determineColorMode(e){if(!e||!e.hasAttribute("data-zap-color-mode"))return tt.ZAP_CONFIG.DEFAULT_COLOR_MODE;const n=e.getAttribute("data-zap-color-mode");return n.toLowerCase()!=="true"&&n.toLowerCase()!=="false"||n.toLowerCase()==="true"}static fromButton(e){if(!e)throw new Error(tt.ZAP_CONFIG.ERRORS.BUTTON_NOT_FOUND);const n=md.determineColorMode(e);return new md(e.getAttribute("data-nzv-id"),e.getAttribute("data-relay-urls").split(","),n)}}class Bs{constructor(e=1e3){this.cache=new Map,this.maxSize=e,this.accessOrder=new Map}set(e,n){if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const r=this.accessOrder.keys().next().value;this.cache.delete(r),this.accessOrder.delete(r)}return this.cache.set(e,n),this.accessOrder.delete(e),this.accessOrder.set(e,Date.now()),n}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.accessOrder.set(e,Date.now()),n}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}}class Q1 extends Bs{#e=new Map;setProfile(e,n){if(!e||!n)return;const r=this.get(e);r&&r._eventCreatedAt&&n._eventCreatedAt&&!(n._eventCreatedAt>r._eventCreatedAt)||(this.set(e,n),this.#t(e,n))}#t(e,n){this.#e.forEach((r=>{try{r(e,n)}catch{}}))}subscribe(e){if(typeof e!="function")return null;const n=Math.random().toString(36).substr(2,9);return this.#e.set(n,e),()=>this.#e.delete(n)}clearSubscriptions(){this.#e.clear()}}class bZ extends Bs{#e=new Map;initializeView(e){this.#e.set(e,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,batchProcessing:!1})}getViewState(e){return this.#e.get(e)||this.initializeView(e)}updateViewState(e,n){const r=this.getViewState(e);return this.#e.set(e,{...r,...n}),this.#e.get(e)}getEvents(e){return this.get(e)||[]}setEvents(e,n,r=!1){const i=r?this.getEvents(e):[],s=new Map(n.map((a=>[a.id,a]))),o=[...i.filter((a=>!s.has(a.id))),...n];this.set(e,o)}addEvent(e,n){if(!n?.id)return!1;const r=this.getEvents(e);return!this.#t(r,n)&&(r.push(n),r.sort(((i,s)=>s.created_at-i.created_at)),this.setEvents(e,r,!0),!0)}#t(e,n){return e.some((r=>r.id===n.id||r.kind===n.kind&&r.pubkey===n.pubkey&&r.content===n.content&&r.created_at===n.created_at))}}class wZ extends Bs{#e=new Map;#t=new Map;async getOrFetch(e,n){const r=this.get(e);if(r)return r;const i=this.#e.get(e);if(i)return i;const s=n().then((o=>(o&&this.set(e,o),this.#e.delete(e),o))).catch((o=>(this.#e.delete(e),null)));return this.#e.set(e,s),s}clearPendingFetches(){this.#e.clear()}setComponent(e,n){this.#t.set(e,n)}getComponent(e){return this.#t.get(e)}clearComponents(){this.#t.clear()}clear(){super.clear(),this.clearPendingFetches(),this.clearComponents()}}class vZ extends Bs{#e=new Map;#t=new Map;setCached(e,n,r){const i=`${e}:${n}`;this.set(i,{stats:r,timestamp:Date.now()}),this.updateViewStats(e,r)}getCached(e,n){const r=`${e}:${n}`;return this.get(r)}updateViewStats(e,n){n&&this.#e.set(e,{...n,lastUpdate:Date.now()})}getViewStats(e){return this.#e.get(e)}clearViewStats(e){this.#e.delete(e)}setNoZapsState(e,n){this.#t.set(e,n)}hasNoZaps(e){return this.#t.get(e)||!1}clearNoZapsState(e){this.#t.delete(e)}clear(){super.clear(),this.#e.clear(),this.#t.clear()}}class EZ extends Bs{hasDecoded(e){return this.has(e)}setDecoded(e,n){this.set(e,n)}getDecoded(e){return this.get(e)}}class xZ extends Bs{initializeLoadState(e){const n={isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,currentCount:0};return this.set(e,n),n}getLoadState(e){return this.has(e)?this.get(e):this.initializeLoadState(e)}updateLoadState(e,n){const r={...this.getLoadState(e),...n};return this.set(e,r),r}canLoadMore(e){const n=this.getLoadState(e);return n&&!n.isLoading&&n.lastEventTime}updateLoadProgress(e,n){const r=this.getLoadState(e);return r.currentCount+=n,this.updateLoadState(e,{currentCount:r.currentCount}),r.currentCount}}class SZ extends Bs{setZapInfo(e,n){this.set(e,n)}getZapInfo(e){return this.get(e)}clearZapInfo(e){this.delete(e)}}class AZ extends Q1{setImage(e,n){e&&n&&this.set(e,{image:n,timestamp:Date.now()})}getImage(e){return this.get(e)?.image}hasImage(e){return this.has(e)}clearExpired(e=36e5){const n=Date.now();for(const[r,i]of this.cache.entries())n-i.timestamp>e&&this.delete(r)}}class kZ extends Q1{#e=new Map;setNip05(e,n){e&&this.set(e,{value:n,timestamp:Date.now(),verified:!0})}getNip05(e){return this.get(e)?.value}setPendingVerification(e,n){this.#e.set(e,n)}getPendingVerification(e){return this.#e.get(e)}deletePendingVerification(e){this.#e.delete(e)}clearPendingVerifications(){this.#e.clear()}clear(){super.clear(),this.clearPendingVerifications()}}class Yc{static#e=null;#t=null;#n={};constructor(){if(Yc.#e)return Yc.#e;this.profileCache=new Q1,this.zapEventCache=new bZ,this.referenceCache=new wZ,this.statsCache=new vZ,this.decodedCache=new EZ,this.loadStateCache=new xZ,this.zapInfoCache=new SZ,this.imageCache=new AZ,this.nip05Cache=new kZ,this.nip05PendingCache=new Bs,this.#n=["zapInfo","uiComponent","decoded","nip05","nip05PendingFetches","zapLoadStates","imageCache","isEventIdentifier"].reduce(((e,n)=>(e[n]=new Bs,e)),{}),this.viewStats=new Map,this.viewStates=new Map,Yc.#e=this}setProfile(e,n){return this.profileCache.setProfile(e,n)}getProfile(e){return this.profileCache.get(e)}subscribeToProfileUpdates(e){return this.profileCache.subscribe(e)}initializeZapView(e){return this.zapEventCache.initializeView(e)}getZapEvents(e){return this.zapEventCache.getEvents(e)}setZapEvents(e,n,r){return this.zapEventCache.setEvents(e,n,r)}addZapEvent(e,n){return this.zapEventCache.addEvent(e,n)}getZapViewState(e){return this.zapEventCache.getViewState(e)}updateZapViewState(e,n){return this.zapEventCache.updateViewState(e,n)}setReference(e,n){return this.referenceCache.set(e,n)}getReference(e){return this.referenceCache.get(e)}getOrFetchReference(e,n){return this.referenceCache.getOrFetch(e,n)}getReferenceComponent(e){return this.referenceCache.getComponent(e)}setReferenceComponent(e,n){return this.referenceCache.setComponent(e,n)}getCachedStats(e,n){return this.statsCache.getCached(e,n)}updateStatsCache(e,n,r){this.statsCache.setCached(e,n,r),this.statsCache.updateViewStats(e,r)}getViewStats(e){return this.statsCache.getViewStats(e)}setNoZapsState(e,n){return this.statsCache.setNoZapsState(e,n)}hasNoZaps(e){return this.statsCache.hasNoZaps(e)}async processCachedData(e,n){this.setRelayUrls(n.relayUrls);const r=this.getZapEvents(e),i=r.some((s=>this.getReference(s.id)));return{stats:(await Promise.all([this.getCachedStats(e,n.identifier)]))[0],hasEnoughCachedEvents:r.length>=tt.REQ_CONFIG.INITIAL_LOAD_COUNT,hasReferences:i}}hasDecoded(e){return this.decodedCache.hasDecoded(e)}setDecoded(e,n){return this.decodedCache.setDecoded(e,n)}getDecoded(e){return this.decodedCache.getDecoded(e)}initializeLoadState(e){return this.loadStateCache.initializeLoadState(e)}getLoadState(e){return this.loadStateCache.getLoadState(e)}updateLoadState(e,n){return this.loadStateCache.updateLoadState(e,n)}canLoadMore(e){return this.loadStateCache.canLoadMore(e)}updateLoadProgress(e,n){return this.loadStateCache.updateLoadProgress(e,n)}setZapInfo(e,n){return this.zapInfoCache.setZapInfo(e,n)}getZapInfo(e){return this.zapInfoCache.getZapInfo(e)}clearZapInfo(e){return this.zapInfoCache.clearZapInfo(e)}setImageCache(e,n){return this.imageCache.setImage(e,n)}getImageCache(e){return this.imageCache.getImage(e)}hasImageCache(e){return this.imageCache.hasImage(e)}setNip05(e,n){return this.nip05Cache.setNip05(e,n)}getNip05(e){return this.nip05Cache.getNip05(e)}setNip05PendingFetch(e,n){this.nip05Cache.setPendingVerification(e,n)}getNip05PendingFetch(e){return this.nip05Cache.getPendingVerification(e)}deleteNip05PendingFetch(e){this.nip05Cache.deletePendingVerification(e)}getOrCreateViewState(e,n={}){return this.viewStates.has(e)||this.viewStates.set(e,{currentStats:null,...n}),this.viewStates.get(e)}getViewState(e){return this.getOrCreateViewState(e)}updateViewState(e,n){const r=this.getOrCreateViewState(e);return this.viewStates.set(e,{...r,...n}),this.viewStates.get(e)}setCacheItem(e,n,r){const i=this.#n[e];return i&&n!==void 0?i.set(n,r):null}getCacheItem(e,n){const r=this.#n[e];return r&&n!==void 0?r.get(n):null}setRelayUrls(e){this.#t=e}getRelayUrls(){return this.#t}clearAll(){this.profileCache.clear(),this.profileCache.clearSubscriptions(),this.zapEventCache.clear(),this.referenceCache.clear(),this.referenceCache.clearPendingFetches(),this.referenceCache.clearComponents(),this.statsCache.clear(),this.decodedCache.clear(),this.loadStateCache.clear(),this.zapInfoCache.clear(),this.imageCache.clear(),this.nip05Cache.clear(),this.nip05Cache.clearPendingVerifications(),Object.values(this.#n).forEach((e=>e.clear())),this.viewStats.clear(),this.viewStates.clear()}}const Ke=new Yc,Cx="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDYuMzMgMjA2LjMzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICA8ZGVmcz4KICAgICAgPHN0eWxlPgogICAgICAgICAuY2xzLTEgewogICAgICAgICAgICBmaWxsOiBub25lOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTIgewogICAgICAgICAgICBmaWxsOiAjZmZmOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTMgewogICAgICAgICAgICBmaWxsOiAjNjY2OwogICAgICAgICB9CiAgICAgIDwvc3R5bGU+CiAgIDwvZGVmcz4KICAgPHBhdGggY2xhc3M9ImNscy0yIgogICAgICBkPSJtMjA2LjMzIDEzNC4zOWMwIDIwLjcxIDAgMzEuMDctMy41MyA0Mi4yMi00LjQzIDEyLjE3LTE0LjAyIDIxLjc2LTI2LjE5IDI2LjE5LTExLjE1IDMuNTMtMjEuNSAzLjUzLTQyLjIyIDMuNTNoLTYyLjQ2Yy0yMC43MSAwLTMxLjA2IDAtNDIuMjEtMy41My0xMi4xNy00LjQzLTIxLjc2LTE0LjAyLTI2LjE5LTI2LjE5LTMuNTMtMTEuMTUtMy41My0yMS41LTMuNTMtNDIuMjJ2LTYyLjQ2YzAtMjAuNzEgMC0zMS4wNyAzLjUzLTQyLjIyIDQuNDMtMTIuMTcgMTQuMDItMjEuNzYgMjYuMTktMjYuMTkgMTEuMTUtMy41MiAyMS41LTMuNTIgNDIuMjEtMy41Mmg2Mi40NmMyMC43MSAwIDMxLjA3IDAgNDIuMjIgMy41MiAxMi4xNyA0LjQzIDIxLjc2IDE0LjAyIDI2LjE5IDI2LjE5IDMuNTMgMTEuMTUgMy41MyAyMS41IDMuNTMgNDIuMjJ6IiAvPgogICA8cGF0aCBjbGFzcz0iY2xzLTMiCiAgICAgIGQ9Im0xODUuOTggOTEuMXY4My4yM2MwIDMuMTMtMi41NCA1LjY3LTUuNjcgNS42N2gtNjguMDRjLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNS41YzAuMzEtMTkgMi4zMi0zNy4yIDYuNTQtNDUuNDggMi41My00Ljk4IDYuNy03LjY5IDExLjQ5LTkuMTQgOS4wNS0yLjcyIDI0LjkzLTAuODYgMzEuNjctMS4xOCAwIDAgMjAuMzYgMC44MSAyMC4zNi0xMC43MiAwLTkuMjgtOS4xLTguNTUtOS4xLTguNTUtMTAuMDMgMC4yNi0xNy42Ny0wLjQyLTIyLjYyLTIuMzctOC4yOS0zLjI2LTguNTctOS4yNC04LjYtMTEuMjQtMC40MS0yMy4xLTM0LjQ3LTI1Ljg3LTY0LjQ4LTIwLjE0LTMyLjgxIDYuMjQgMC4zNiA1My4yNyAwLjM2IDExNi4wNXY4LjM4Yy0wLjA2IDMuMDgtMi41NSA1LjU3LTUuNjUgNS41N2gtMzMuNjljLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNDMuOTVjMC0zLjEzIDIuNTQtNS42NyA1LjY3LTUuNjdoMzEuNjdjMy4xMyAwIDUuNjcgMi41NCA1LjY3IDUuNjcgMCA0LjY1IDUuMjMgNy4yNCA5LjAxIDQuNTMgMTEuMzktOC4xNiAyNi4wMS0xMi41MSA0Mi4zNy0xMi41MSAzNi42NSAwIDY0LjM2IDIxLjM2IDY0LjM2IDY4LjY5em0tNjAuODQtMTYuODljMC02LjctNS40My0xMi4xMy0xMi4xMy0xMi4xM3MtMTIuMTMgNS40My0xMi4xMyAxMi4xMyA1LjQzIDEyLjEzIDEyLjEzIDEyLjEzIDEyLjEzLTUuNDMgMTIuMTMtMTIuMTN6IiAvPgo8L3N2Zz4=",_Z=t=>typeof t=="string"&&t.length>0,CZ=t=>{try{return window.NostrTools.nip19.decode(t)}catch{return null}},TZ=(t,e,n)=>{const r={npub:()=>({kinds:[9735],"#p":[e]}),note:()=>({kinds:[9735],"#e":[e]}),nprofile:()=>({kinds:[9735],"#p":[e.pubkey]}),nevent:()=>({kinds:[9735],"#e":[e.id]}),naddr:()=>({kinds:[9735],"#a":[`${e.kind}:${e.pubkey}:${e.identifier}`]})}[t];if(!r)return null;const i=r();return i.limit=n?tt.REQ_CONFIG.ADDITIONAL_LOAD_COUNT:tt.REQ_CONFIG.INITIAL_LOAD_COUNT,n&&(i.until=n),{req:i}};function Tx(t,e=null){const n=`${t}:${e}`;if(Ke.hasDecoded(n))return Ke.getDecoded(n);if(!_Z(t))throw new Error(tt.ZAP_CONFIG.ERRORS.DECODE_FAILED);const r=CZ(t);if(!r)return null;const i=TZ(r.type,r.data,e);return i&&Ke.setDecoded(n,i),i}function QT(t){return t?.display_name||t?.name||"nameless"}async function IZ(t,e){if(!t||!e)return null;try{return(await window.NostrTools.nip05.queryProfile(t))?.pubkey===e?t:null}catch{return null}}function jf(t){return new Intl.NumberFormat().format(t)}function e5(t){if(!t||typeof t!="string")return"unknown";try{return`${window.NostrTools.nip19.decode(t).type.toLowerCase()}1${t.slice(5,11)}...${t.slice(-4)}`}catch{return"unknown"}}function kl(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function OZ(t){try{return window.NostrTools.nip19.npubEncode(t)}catch{return null}}function Zl(t){if(!t||typeof t!="string")return!1;const e=`isEventIdentifier:${t}`,n=Ke.getCacheItem("isEventIdentifier",e);if(n!==void 0)return n;const r=t.startsWith("note1")||t.startsWith("nevent1")||t.startsWith("naddr1");return Ke.setCacheItem("isEventIdentifier",e,r),r}async function $Z(t){const{pubkey:e,content:n}=(function(i){const s=i.tags.find((o=>o[0]==="description"))?.[1];if(!s)return{pubkey:null,content:""};try{const o=MZ(s);let a;try{a=JSON.parse(o)}catch{const c=o.match(/"pubkey"\s*:\s*"([^"]+)"|"content"\s*:\s*"([^"]+)"/g);if(!c)throw new Error("Invalid JSON structure");a={},c.forEach((u=>{const[f,h]=u.split(":").map((d=>d.trim().replace(/"/g,"")));a[f]=h}))}let l=null;return a.pubkey&&(l=typeof a.pubkey=="string"?a.pubkey:String(a.pubkey)),{pubkey:l,content:typeof a.content=="string"?a.content.trim():""}}catch{return{pubkey:null,content:""}}})(t),r=await(async function(i){const s=i.tags.find((o=>o[0].toLowerCase()==="bolt11"))?.[1];if(!s)return"Amount: Unknown";try{const o=window.decodeBolt11(s),a=o.sections.find((l=>l.name==="amount"))?.value;return a?`${jf(Math.floor(a/1e3))} sats`:"Amount: Unknown"}catch{return"Amount: Unknown"}})(t);return{pubkey:e,content:n,satsText:r}}function Ix(t){try{return window.NostrTools.nip19.decode(t)}catch{return null}}function MZ(t){return t.replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/\\\\/g,"\\").replace(/\\(?!(["\\\/bfnrt]|u[0-9a-fA-F]{4}))/g,"").replace(/\\+(["\\/bfnrt])/g,"\\$1").replace(/\\u(?![0-9a-fA-F]{4})/g,"")}class NZ{constructor(e){this.root=e}displayStats(e){requestAnimationFrame((()=>{const n=this.root?.querySelector(".zap-stats");if(n)try{let r;r=e?e.skeleton?this.#e():e.error?this.createTimeoutStats():this.createNormalStats(e):this.createTimeoutStats(),n.innerHTML=r}catch{n.innerHTML=this.createTimeoutStats()}}))}#e(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
    `}createTimeoutStats(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number text-muted">nostr.band</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number text-muted">Stats</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number text-muted">Unavailable</span></div>
      <div class="stats-item">sats</div>
    `}createNormalStats(e){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number">${jf(e.count)}</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number">${jf(Math.floor(e.msats/1e3))}</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number">${jf(Math.floor(e.maxMsats/1e3))}</span></div>
      <div class="stats-item">sats</div>
    `}}class ew{constructor(e={}){this._validateOptions(e),this._initializeProperties(e)}_validateOptions(e){if(!e.pool?.ensureRelay)throw new Error("Invalid pool object: ensureRelay method is required")}_initializeProperties(e){this.pool=e.pool,this.batchSize=e.batchSize||tt.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_SIZE,this.batchDelay=e.batchDelay||tt.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_DELAY,this.relayUrls=e.relayUrls||tt.BATCH_PROCESSOR_CONFIG.DEFAULT_RELAY_URLS,this.batchQueue=new Set,this.pendingFetches=new Map,this.resolvers=new Map,this.processingItems=new Set,this.batchTimer=null,this.eventCache=new Map,this.maxCacheAge=e.maxCacheAge||tt.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}getOrCreateFetchPromise(e){if(this.pendingFetches.has(e))return this.pendingFetches.get(e);const n=new Promise((r=>{this.resolvers.set(e,r)}));return this.pendingFetches.set(e,n),this.batchQueue.add(e),this._scheduleBatchProcess(),n}_scheduleBatchProcess(){this.batchTimer||(this.batchTimer=setTimeout((()=>{this.batchTimer=null,this._processBatchQueue()}),this.batchDelay))}async _processBatchQueue(){if(this.batchQueue.size===0)return;const e=this._getBatchItems();await this._processBatch(e),this.batchQueue.size>0&&this._scheduleBatchProcess()}_getBatchItems(){const e=Array.from(this.batchQueue).slice(0,this.batchSize);return e.forEach((n=>{this.batchQueue.delete(n),this.processingItems.add(n)})),e}async _processBatch(e){try{await this.onBatchProcess(e)}catch(n){this._handleBatchError(e,n)}finally{this._cleanupBatchItems(e)}}_handleBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanupBatchItems(e){e.forEach((n=>{this.processingItems.delete(n),this.pendingFetches.delete(n),this.resolvers.delete(n)}))}resolveItem(e,n){const r=this.resolvers.get(e);r&&(r(n),this.resolvers.delete(e))}async onBatchProcess(e){throw new Error("onBatchProcess must be implemented by derived class")}onBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanup(e,n,r,i){clearTimeout(e),n&&n.close(),r.forEach((s=>{!i.has(s)&&this.resolvers.has(s)&&this.resolveItem(s,null)}))}_getSubscriptionPool(){return this.pool}async _createSubscriptionPromise(e,n,r,i){if(n?.length)return new Promise((s=>{const o=new Set,a=tt.BATCH_PROCESSOR_CONFIG.TIMEOUT_DURATION;let l,c,u=!1;const f=()=>{u||(u=!0,l&&clearTimeout(l),c&&c.close(),e.forEach((h=>{o.has(h)||this.resolveItem(h,null)})),s())};c=this.pool.subscribeMany(n,r,{onevent:h=>{try{u||(i(h,o),o.size===e.length&&f())}catch{}},oneose:()=>{setTimeout(f,100)},onerror:h=>{}}),l=setTimeout((()=>{u||f()}),a)}));e.forEach((s=>this.resolveItem(s,null)))}setRelayUrls(e){this.relayUrls=Array.isArray(e)?e:[]}getCachedItem(e){const n=this.eventCache.get(e);return this._isValidCache(n)?n.event:(this.eventCache.delete(e),null)}_isValidCache(e){return!!e&&Date.now()-e.timestamp<=this.maxCacheAge}setCachedItem(e,n){this.eventCache.set(e,{event:n,timestamp:Date.now()})}}class LZ extends ew{constructor(e={}){super(e)}async onBatchProcess(e){if(!e?.length)return;const n=[{ids:e.slice(0,this.batchSize)}];await this._createSubscriptionPromise(e,this.relayUrls,n,((r,i)=>{if(e.includes(r.id)){const s=this.getCachedItem(r.id);(!s||r.created_at>s.created_at)&&(this.setCachedItem(r.id,r),this.resolveItem(r.id,r),i.add(r.id))}}))}}class RZ extends ew{constructor(e={}){super(e)}_parseAtagValue(e){const n=e.split(":");return n.length!==3?null:{kind:parseInt(n[0]),pubkey:n[1],identifier:n[2]}}async onBatchProcess(e){if(!e?.length)return;const n=[],r={kinds:[],authors:[],"#d":[]};if(e.slice(0,this.batchSize).forEach((s=>{const o=this._parseAtagValue(s);o?(r.kinds.push(o.kind),r.authors.push(o.pubkey),r["#d"].push(o.identifier),n.push(s)):this.resolveItem(s,null)})),n.length===0)return;const i=[r];await this._createSubscriptionPromise(n,this.relayUrls,i,((s,o)=>{const a=n.find((l=>{const c=this._parseAtagValue(l);return c&&s.kind===c.kind&&s.pubkey===c.pubkey&&s.tags.some((u=>u[0]==="d"&&u[1]===c.identifier))}));if(a){const l=this.getCachedItem(a);(!l||s.created_at>l.created_at)&&(this.setCachedItem(a,s),this.resolveItem(a,s),o.add(a))}}))}}class PZ extends ew{constructor(e={}){const{simplePool:n,config:r}=e;super({pool:n,batchSize:r.BATCH_SIZE||tt.PROFILE_CONFIG.BATCH_SIZE,batchDelay:r.BATCH_DELAY||tt.PROFILE_CONFIG.BATCH_DELAY,relayUrls:r.RELAYS||tt.PROFILE_CONFIG.RELAYS,maxCacheAge:tt.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}),this.config=r}async onBatchProcess(e){if(!this.config.RELAYS?.length)throw new Error("No relays configured for profile fetch");const n=e.filter((o=>{const a=this.getCachedItem(o);return!a||(this.resolveItem(o,a),!1)}));if(n.length===0)return;const r=[{kinds:[0],authors:n}],i=new Map,s=(o,a)=>{const l=i.get(o.pubkey);(!l||o.created_at>l.created_at)&&(i.set(o.pubkey,o),this.setCachedItem(o.pubkey,o)),a.add(o.pubkey)};try{await this._createSubscriptionPromise(n,this.config.RELAYS,r,s),n.forEach((o=>{const a=i.get(o);this.resolveItem(o,a||null)}))}catch(o){this.onBatchError(e,o)}}}var la=Symbol("verified");function DZ(t){if(!(t instanceof Object)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var BZ=new TextEncoder;function Mc(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}var HZ=class{value;next=null;prev=null;constructor(t){this.value=t}},UZ=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new HZ(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function jm(t){return hn(Ya(BZ.encode((function(e){if(!DZ(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])})(t))))}var xf=new class{generateSecretKey(){return Ui.utils.randomPrivateKey()}getPublicKey(t){return hn(Ui.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=hn(Ui.getPublicKey(e)),n.id=jm(n),n.sig=hn(Ui.sign(jm(n),e)),n[la]=!0,n}verifyEvent(t){if(typeof t[la]=="boolean")return t[la];const e=jm(t);if(e!==t.id)return t[la]=!1,!1;try{const n=Ui.verify(t.sig,e,t.pubkey);return t[la]=n,n}catch{return t[la]=!1,!1}}},zZ=(xf.generateSecretKey,xf.getPublicKey,xf.finalizeEvent,xf.verifyEvent);function FZ(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}async function jZ(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}var t5,qZ=t=>(t[la]=!0,!0),n5=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new UZ;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=Mc(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new n5(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await jZ();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=(function(n){let r=n.slice(0,22).indexOf('"EVENT"');if(r===-1)return null;let i=n.slice(r+7+1).indexOf('"');if(i===-1)return null;let s=r+7+1+i,o=n.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return n.slice(s+1,a)})(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=(function(s,o){let a=o.length+3,l=s.indexOf(`"${o}":`)+a,c=s.slice(l).indexOf('"')+l+1;return s.slice(c,c+64)})(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&(function(s,o){for(let a=0;a<s.length;a++)if(FZ(s[a],o))return!0;return!1})(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t((function(r,i){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",i]],content:""}})(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new VZ(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},VZ=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}},WZ=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=Mc(t);let n=this.relays.get(t);return n||(n=new n5(t,{verifyEvent:this.trustedRelayURLs.has(t)?qZ:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(Mc).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(f,h)=>{let d=this.seenOn.get(h);d||(d=new Set,this.seenOn.set(h,d)),d.add(f)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=f=>{s[f]=!0,s.filter((h=>h)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(f,h)=>{o(f),a[f]=h,a.filter((d=>d)).length===i&&(e.onclose?.(a),l=()=>{})};const c=f=>{if(e.alreadyHaveEvent?.(f))return!0;const h=n.has(f);return n.add(f),h},u=Promise.all(Object.entries(t).map((async(f,h,d)=>{if(d.indexOf(f)!==h)return void l(h,"duplicate url");let p,[g,b]=f;g=Mc(g);try{p=await this.ensureRelay(g,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(x){return void l(h,x?.message||String(x))}let w=p.subscribe(b,{...e,oneose:()=>o(h),onclose:x=>l(h,x),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(w)})));return{async close(){await u,r.forEach((f=>{f.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(Mc).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{t5=WebSocket}catch{}var r5=class extends WZ{constructor(){super({verifyEvent:zZ,websocketImplementation:t5})}};class Jc{static instance=null;#e;#t;#n=!0;#s;constructor(){return Jc.instance?Jc.instance:(this.#r(),Jc.instance=this,this)}#r(){if(this.#e=tt.PROFILE_CONFIG,this.#t=new r5,!this.#t?.ensureRelay)throw new Error("Failed to initialize SimplePool");this.#s=new PZ({simplePool:this.#t,config:{...this.#e,RELAYS:this.#e.RELAYS||[]}})}get isInitialized(){return this.#n}async fetchProfiles(e){if(!Array.isArray(e)||e.length===0)return[];const n=Date.now(),r=new Array(e.length),i=e.reduce(((s,o,a)=>{const l=Ke.getProfile(o);return this.#o(l,n)?r[a]=l:s.push({index:a,pubkey:o}),s}),[]);return i.length>0&&await this.#i(i,r,e),r}async processBatchProfiles(e){const n=this.#l(e);if(n.length!==0)try{await Promise.all([this.fetchProfiles(n),...n.map((r=>this.verifyNip05Async(r)))])}catch{}}async verifyNip05Async(e){const n=Ke.getNip05(e);if(n!==void 0)return n;const r=Ke.getNip05PendingFetch(e);if(r)return r;const i=this.#u(e);return Ke.setNip05PendingFetch(e,i),i}getNip05(e){return Ke.getNip05(e)}clearCache(){Ke.clearAll(),this.#s.clearPendingFetches()}#o(e,n){return e&&e._lastUpdated&&n-e._lastUpdated<18e5}#l(e){return[...new Set(e?.map((n=>n?.pubkey))?.filter((n=>n&&typeof n=="string"&&n.length===64)))]}async#i(e,n,r){if(!e.length)return;const i=Date.now(),s=e.filter((({pubkey:a})=>a&&typeof a=="string"&&a.length===64));if(s.length===0)return;const o=await Promise.all(s.map((({pubkey:a})=>this.#a(a,i))));s.forEach((({index:a},l)=>{a>=0&&a<n.length&&(n[a]=o[l],r[a]&&Ke.setProfile(r[a],o[l]))}))}async#a(e,n){if(!e||typeof e!="string"||e.length!==64)return this.#c();try{const r={kinds:[0],authors:[e],limit:1},i=await this.#s.getOrCreateFetchPromise(e,r);if(!i?.content)return this.#c();let s;try{s=JSON.parse(i.content)}catch{return this.#c()}return{...s,name:QT(s)||"nameless",_lastUpdated:n,_eventCreatedAt:i.created_at}}catch{return this.#c()}}async#u(e){try{const[n]=await this.fetchProfiles([e]);if(!n?.nip05)return Ke.setNip05(e,null),null;const r=await Promise.race([IZ(n.nip05,e),new Promise(((s,o)=>setTimeout((()=>o(new Error("NIP-05 timeout"))),5e3)))]);if(!r)return Ke.setNip05(e,null),null;const i=kl(r.startsWith("_@")?r.slice(1):r);return Ke.setNip05(e,i),i}catch{return Ke.setNip05(e,null),null}finally{Ke.deleteNip05PendingFetch(e)}}#c(){return{name:"anonymous",display_name:"anonymous"}}}const yd=new Jc;class KZ{async loadAndUpdate(e,n){if(e)try{const r=n.querySelector(".sender-name"),i=n.querySelector(".zap-placeholder-name"),s=n.querySelector(".sender-icon"),o=s?.querySelector(".zap-placeholder-icon"),a=n.querySelector(".sender-pubkey");let l=Ke.getProfile(e);const c=l?QT(l)||"nameless":"anonymous",u=l?.picture?(function(f){if(!f||typeof f!="string")return null;try{const h=new URL(f);return["http:","https:"].includes(h.protocol)?h.href:null}catch{return null}})(l.picture):null;this.#e(i,r,c),this.#n(o,s,u,c),this.#s(a,e)}catch{this.#r(n)}}#e(e,n,r){e?e.replaceWith(Object.assign(document.createElement("span"),{className:"sender-name",textContent:r})):n&&(n.textContent=r)}#t(e,n="anonymous user's icon"){const r=`https://robohash.org/${e}.png?set=set5&bgset=bg2&size=128x128`,i=Ke.getImageCache(r),s=Object.assign(document.createElement("img"),{alt:n,loading:"lazy",className:"profile-icon"});if(i)return s.src=r,s;const o=new Image;return o.onerror=()=>{s.src=Cx,Ke.setImageCache(r,Cx)},o.onload=()=>{Ke.setImageCache(r,o)},o.src=r,s.src=r,s}#n(e,n,r,i){if(e&&n){const s=o=>{e.remove();const a=n.querySelector("img"),l=n.querySelector("a");a&&a.remove(),l&&l.remove();const c=o==="robohash"?this.#t(n.closest("[data-pubkey]")?.dataset.pubkey,`${kl(i)}'s icon`):Object.assign(document.createElement("img"),{src:o,alt:`${kl(i)}'s icon`,loading:"lazy",className:"profile-icon"}),u=n.closest("[data-pubkey]")?.dataset.pubkey;if(u){const f=(function(d,p=[]){try{return window.NostrTools.nip19.nprofileEncode({pubkey:d,relays:p})}catch{return null}})(u),h=Object.assign(document.createElement("a"),{href:`https://njump.me/${f}`,target:"_blank",rel:"noopener noreferrer"});h.appendChild(c),n.appendChild(h)}else n.appendChild(c)};if(r){const o=new Image;o.onload=()=>{Ke.setImageCache(r,o),s(r)},o.onerror=()=>{s("robohash")},o.src=r}else s("robohash")}}#s(e,n){if(e&&!e.getAttribute("data-nip05-updated")){const r=yd.getNip05(n);r?(e.textContent=r,e.setAttribute("data-nip05-updated","true")):yd.verifyNip05Async(n).then((i=>{i&&(e.textContent=i,e.setAttribute("data-nip05-updated","true"))}))}}#r(e){const n=e.querySelector(".zap-placeholder-icon");if(n){const r=n.parentElement,i=e.closest("[data-pubkey]")?.dataset.pubkey;n.remove(),r.appendChild(this.#t(i))}}async updateProfileElement(e,n){if(!e||!n)return;const r=e.querySelector(".sender-icon img, .zap-placeholder-icon");if(r)if(n.picture){const s=document.createElement("img");s.alt=n.name||"Profile Picture",s.width=32,s.height=32,s.className="profile-icon",s.onerror=()=>{const o=e.getAttribute("data-pubkey");if(o){const a=this.#t(o,n.name||"anonymous user");s.parentElement&&s.parentElement.replaceChild(a,s)}},s.src=n.picture,r.parentElement&&r.parentElement.replaceChild(s,r)}else{const s=e.getAttribute("data-pubkey");if(s){const o=this.#t(s,n.name||"anonymous user");r.parentElement&&r.parentElement.replaceChild(o,r)}}const i=e.querySelector(".sender-name, .zap-placeholder-name");if(i&&(i.textContent=n.display_name||n.name||"anonymous",i.className="sender-name"),n.nip05){const s=e.getAttribute("data-pubkey");if(s){const o=e.querySelector('[data-nip05-target="true"]');o&&await this.updateNip05Display(s,o)}}}}class kr{static#e={1:"content",30023:"title",30030:"title",30009:"name",40:"content",42:"name",31990:"alt"};static#t={UI_COMPONENTS:"Failed to create UI components:",ZAP_ITEM:"Failed to create zap item HTML:",REFERENCE:"Reference component creation failed:"};static createUIComponents(e,n,r){try{const i=this.viewConfigs?.get(n),s=r||i?.identifier,o=Zl(s)?null:this.#i(e);return{iconComponent:this.#n(),nameComponent:this.#u(e),pubkeyComponent:this.#c(e,s),referenceComponent:this.#f(o)}}catch{return this.#s()}}static#n(){return'<div class="zap-placeholder-icon skeleton"></div>'}static#s(){return{iconComponent:'<div class="zap-placeholder-icon skeleton"></div>',nameComponent:'<div class="zap-placeholder-name skeleton"></div>',pubkeyComponent:"",referenceComponent:""}}static createReferenceComponent(e){return this.#f(this.#i({reference:e}))}static addReferenceToElement(e,n){if(!this.#r(e,n))return;const r=e.querySelector(".zap-content");this.#o(r,n)}static#r(e,n){return e&&n&&e.querySelector(".zap-content")}static#o(e,n){e.querySelectorAll(".zap-reference").forEach((i=>i.remove()));const r=this.createReferenceComponent({reference:n});e.insertAdjacentHTML("beforeend",r)}static getDialogTemplate(){return`
      <dialog class="dialog">
        <h2 class="dialog-title"><a href="#" target="_blank"></a></h2>
        <button class="close-dialog-button">X</button>
        <div class="zap-stats"></div>
        <ul class="dialog-zap-list"></ul>
      </dialog>
    `}static createZapItemHTML(e,n,r,i){try{const s=this.createUIComponents(e,r,i);return this.#l(e,n,s)}catch{return""}}static createNoZapsMessageHTML(e){return`
      <div class="no-zaps-container">
        <div class="no-zaps-message">${e}</div>
      </div>
    `}static#l(e,n,r){const[i,s]=e.satsText.split(" "),o=(a=e.created_at,Math.floor(Date.now()/1e3)-a<86400);var a;return`
      <div class="zap-content">
        <div class="zap-sender${e.comment?" with-comment":""}" data-pubkey="${e.pubkey}">
          <div class="sender-icon${o?" is-new":""}">
            ${r.iconComponent}
          </div>
          <div class="sender-info">
            ${r.nameComponent}
            ${r.pubkeyComponent}
          </div>
          <div class="zap-amount ${n}"><span class="number">${i}</span> ${s}</div>
        </div>
        ${e.comment?`<div class="zap-details"><span class="zap-comment">${kl(e.comment)}</span></div>`:""}
        ${r.referenceComponent}
      </div>
    `}static#i(e){if(!e)return null;if(this.#a(e))return e;if(e.reference&&typeof e.reference=="object"){if(e.reference.reference&&this.#a(e.reference.reference))return e.reference.reference;if(this.#a(e.reference))return e.reference}return null}static#a(e){return e&&typeof e=="object"&&"id"in e&&"tags"in e&&Array.isArray(e.tags)&&"content"in e&&"kind"in e}static#u({senderName:e}){return e?`<span class="sender-name">${kl(e)}</span>`:'<div class="zap-placeholder-name skeleton"></div>'}static#c({pubkey:e,displayIdentifier:n,reference:r},i){const s=!Zl(i),o=`class="sender-pubkey" data-pubkey="${e}"`;return r&&s?`<span ${o}>${n}</span>`:`<span ${o} data-nip05-target="true">${n}</span>`}static#f(e){if(!this.#a(e))return"";const n=e.id,r=Ke.getReferenceComponent(n);if(r)return r;try{const i=this.#m(e),s=this.#d(e),o=this.#p(i,s);return Ke.setReferenceComponent(n,o),o}catch{return""}}static#m(e){if(!e?.tags)return"";if(e.kind===31990)return this.#h(e)||"";const n=Array.isArray(e.tags)?e.tags.find((r=>Array.isArray(r)&&r[0]==="d")):null;return n?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.naddrEncode({kind:r,pubkey:i,identifier:s,relays:o})}catch{return null}})(e.kind,e.pubkey,n[1])}`:e.id?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.neventEncode({id:r,kind:i,pubkey:s,relays:o})}catch{return null}})(e.id,e.kind,e.pubkey)}`:""}static#h(e){const n=e.tags.filter((i=>i[0]==="r"));return(n.find((i=>!i.includes("source")))||n[0])?.[1]}static#d(e){if(!e)return"";const n=kr.#e[e.kind];if(n){const r=e.tags.find((i=>Array.isArray(i)&&i[0]===n));if(r&&r[1])return r[1]}if(e.kind===40)try{return JSON.parse(e.content).name||e.content}catch{}return e.content||""}static#p(e,n){return`
      <div class="zap-reference">
        <div class="reference-arrow">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aCBkPSJtNTYwLTEyMC01Ny01NyAxNDQtMTQzSDIwMHYtNDgwaDgwdjQwMGgzNjdMNTAzLTU0NGw1Ni01NyAyNDEgMjQxLTI0MCAyNDBaIiAvPg0KPC9zdmc+" alt="Reference" width="18" height="18" />
        </div>
        <div class="reference-text">${kl(n)}</div>
        <a href="${e}" target="_blank" class="reference-link">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aA0KICAgICAgICBkPSJNNDQwLTI4MEgyODBxLTgzIDAtMTQxLjUtNTguNVQ4MC00ODBxMC04MyA1OC41LTE0MS41VDI4MC02ODBoMTYwdjgwSDI4MHEtNTAgMC04NSAzNXQtMzUgODVxMCA1MCAzNSA4NXQ4NSAzNWgxNjB2ODBaTTMyMC00NDB2LTgwaDMyMHY4MEgzMjBabTIwMCAxNjB2LTgwaDE2MHE1MCAwIDg1LTM1dDM1LTg1cTAtNTAtMzUtODV0LTg1LTM1SDUyMHYtODBoMTYwcTgzIDAgMTQxLjUgNTguNVQ4ODAtNDgwcTAgODMtNTguNSAxNDEuNVQ2ODAtMjgwSDUyMFoiIC8+DQo8L3N2Zz4=" alt="Quick Reference" width="16" height="16" />
        </a>
      </div>
    `}static ZapInfo=class{#g;constructor(e){this.#g=e}static async createFromEvent(e,n={}){return await new kr.ZapInfo(e).extractInfo(n)}static getAmountColorClass(e,n){return(n===void 0?tt.ZAP_AMOUNT_CONFIG.DEFAULT_COLOR_MODE:n)?this.#y(e):tt.ZAP_AMOUNT_CONFIG.DISABLED_CLASS}static#y(e){const{THRESHOLDS:n,DEFAULT_CLASS:r}=tt.ZAP_AMOUNT_CONFIG;return n.find((i=>e>=i.value))?.className||r}async extractInfo(e={}){const n=this.#g.id,r=Ke.getZapInfo(n);if(r)return r.colorClass=kr.ZapInfo.getAmountColorClass(r.satsAmount,e.isColorModeEnabled),r;try{const{pubkey:s,content:o,satsText:a}=await $Z(this.#g),l=parseInt(a.replace(/,/g,"").split(" ")[0],10),c=typeof s=="string"?s:null,u=this.#g.reference||null,f={satsText:a,satsAmount:l,comment:o||"",pubkey:c||"",created_at:this.#g.created_at,displayIdentifier:c?e5(OZ(c)):"anonymous",senderName:null,senderIcon:null,reference:u,colorClass:kr.ZapInfo.getAmountColorClass(l,e?.isColorModeEnabled)};return Ke.setZapInfo(n,f),f}catch{const o={satsText:"Amount: Unknown",satsAmount:0,comment:"",pubkey:"",created_at:this.#g.created_at,displayIdentifier:"anonymous",senderName:"anonymous",senderIcon:i,reference:null};return Ke.setZapInfo(n,o),o}var i}static async batchExtractInfo(e,n=!0){const r=new Map;return await Promise.all(e.map((async i=>{const s=new kr.ZapInfo(i),o=await s.extractInfo({isColorModeEnabled:n});r.set(i.id,o)}))),r}};static viewConfigs=new Map}class GZ{constructor(e,n){this.viewId=e,this.config=n}async createListItem(e){const n=await kr.ZapInfo.createFromEvent(e,{isColorModeEnabled:this.config?.isColorModeEnabled}),r=document.createElement("li");return r.className=`zap-list-item ${n.colorClass}${n.comment?" with-comment":""}`,r.setAttribute("data-pubkey",n.pubkey),e?.id&&r.setAttribute("data-event-id",e.id),r.innerHTML=kr.createZapItemHTML(n,n.colorClass,this.viewId),r.setAttribute("data-timestamp",e.created_at.toString()),{li:r,zapInfo:n}}}class ZZ{constructor(e,n,r,i){if(!e)throw new Error("shadowRoot is required");if(!i)throw new Error("config is required");this.shadowRoot=e,this.profileUI=n,this.viewId=r,this.config=i,this.itemBuilder=new GZ(r,this.config),this.profileUpdateUnsubscribe=null,this.#m()}destroy(){this.profileUpdateUnsubscribe&&(this.profileUpdateUnsubscribe(),this.profileUpdateUnsubscribe=null);const e=this.#e(".dialog-zap-list");e&&(e.innerHTML="")}#e(e){return this.shadowRoot.querySelector(e)}getElementByEventId(e){return this.#e(`.zap-list-item[data-event-id="${e}"]`)}async#t(e){const n=this.#e(".dialog-zap-list");if(n)try{return this.#s(n),await e(n)}catch{n.children.length===0&&this.showNoZapsMessage()}}#n(e,n){const r=e.querySelector(".load-more-trigger");r&&r.remove(),Array.from(n.children).forEach((i=>{const s=i.getAttribute("data-event-id"),o=parseInt(i.getAttribute("data-timestamp"));let a=null;const l=Array.from(e.children);for(let c=0;c<l.length;c++)if(o>parseInt(l[c].getAttribute("data-timestamp"))){a=l[c];break}e.querySelector(`.zap-list-item[data-event-id="${s}"]`)||(a?e.insertBefore(i,a):e.appendChild(i))})),r&&e.appendChild(r)}#s(e){const n=e.querySelector(".no-zaps-message");n&&n.remove()}async#r(e,n){return this.#t((async r=>{const{li:i,zapInfo:s}=await this.itemBuilder.createListItem(e);return n(r,i),await this.#p(s.pubkey,i),{li:i,zapInfo:s}}))}async renderZapListFromCache(e){if(!e?.length)return Ke.setNoZapsState(this.viewId,!1),this.showNoZapsMessage();await this.#t((async n=>{const{initialBatch:r,remainingBatch:i}=this.#o(e),{fragment:s,profileUpdates:o}=await this.#l(r);this.#n(n,s),i.length>0?this.#i(i,n,o):await this.#d(o)}))}#o(e){const n=this.#y(e),r=tt.DIALOG_CONFIG.ZAP_LIST.INITIAL_BATCH;return{initialBatch:n.slice(0,r),remainingBatch:n.slice(r)}}async#l(e){const n=document.createDocumentFragment(),r=[];for(const i of e){const{li:s,zapInfo:o}=await this.itemBuilder.createListItem(i);this.#b(i.id,s),n.appendChild(s),o.pubkey&&r.push({pubkey:o.pubkey,element:s})}return{fragment:n,profileUpdates:r}}#i(e,n,r){if(!e.length)return;const i=tt.DIALOG_CONFIG.ZAP_LIST.REMAINING_BATCH;let s=0;const o=async()=>{if(s>=e.length)return void await this.#d(r);const a=e.slice(s,s+i);await this.#a(a,n,r),s+=i,setTimeout((()=>o()),0)};requestIdleCallback((()=>o()))}async#a(e,n,r){const i=document.createDocumentFragment();await Promise.all(e.map((async o=>{const{li:a,zapInfo:l}=await this.itemBuilder.createListItem(o);this.#b(o.id,a),i.appendChild(a),l.pubkey&&r.push({pubkey:l.pubkey,element:a})})));const s=n.querySelector(".load-more-trigger");s&&s.remove(),n.appendChild(i),s&&n.appendChild(s),await new Promise((o=>requestAnimationFrame(o)))}async prependZap(e){return this.#r(e,((n,r)=>n.prepend(r)))}async appendZap(e){return this.#r(e,((n,r)=>{const i=this.#f(n,e.created_at);i?n.insertBefore(r,i):n.appendChild(r)}))}async replacePlaceholderWithZap(e,n){const r=this.#e(`[data-index="${n}"]`);if(this.#w(r))try{const{zapInfo:i}=await this.itemBuilder.createListItem(e);this.#v(r,i,e.id),await this.#p(i.pubkey,r)}catch{r.remove()}}async showNoZapsMessage(){const e=this.#e(".dialog-zap-list");if(e){if(Ke.hasNoZaps(this.viewId))return void this.#c(e);await this.#u()||(this.#c(e),Ke.setNoZapsState(this.viewId,!0))}}async#u(){const e=this.config.noZapsDelay||tt.DIALOG_CONFIG.DEFAULT_NO_ZAPS_DELAY;await new Promise((r=>setTimeout(r,e)));const n=Ke.getZapEvents(this.viewId);return!!n?.length&&(await this.renderZapListFromCache(n),!0)}#c(e){const n=this.config.noZapsMessage||tt.DIALOG_CONFIG.NO_ZAPS_MESSAGE;e.innerHTML=kr.createNoZapsMessageHTML(n),e.style.minHeight=tt.DIALOG_CONFIG.ZAP_LIST.MIN_HEIGHT}async batchUpdate(e,n={}){const r=this.#e(".dialog-zap-list");if(r)try{const i=new Map(Array.from(r.querySelectorAll(".zap-list-item")).map((c=>[c.getAttribute("data-event-id"),c]))),s=this.#y(e),o=Zl(this.config.identifier),a=s.filter((c=>{const u=i.get(c.id);return o?!u:!u||c.reference&&!u.querySelector(".zap-reference")}));if(a.length===0&&!n.isFullUpdate)return;const l=document.createDocumentFragment();for(const c of a){const{li:u,zapInfo:f}=await this.itemBuilder.createListItem(c);!o&&c.reference&&this.updateZapReference(c),l.appendChild(u),f.pubkey&&await this.#p(f.pubkey,u)}this.#n(r,l)}catch{}}#f(e,n){return Array.from(e.children).find((r=>{const i=parseInt(r.getAttribute("data-timestamp")||"0");return n>i}))}updateZapReference(e){if(e?.id&&e?.reference)try{const n=this.getElementByEventId(e.id);if(!n)return;kr.addReferenceToElement(n,e.reference),Ke.setReference(e.id,e.reference)}catch{}}#m(){this.profileUpdateUnsubscribe=Ke.subscribeToProfileUpdates(this.#h.bind(this))}async#h(e,n){const r=this.shadowRoot.querySelectorAll(`[data-pubkey="${e}"]`);await Promise.allSettled(Array.from(r).map((i=>this.profileUI.updateProfileElement(i,n))))}async#d(e){const n=tt.DIALOG_CONFIG.ZAP_LIST.PROFILE_BATCH;for(let r=0;r<e.length;r+=n){const i=e.slice(r,r+n);await Promise.all(i.map((({pubkey:s,element:o})=>this.#p(s,o)))),await new Promise((s=>requestAnimationFrame(s)))}}async#p(e,n){e&&await this.#g(e,n)}async#g(e,n){if(e&&n)try{await this.profileUI.loadAndUpdate(e,n)}catch{}}#y(e){return[...new Map(e.map((n=>[n.id,n]))).values()].sort(((n,r)=>r.created_at-n.created_at))}#b(e,n){if(Zl(this.config.identifier))return;const r=Ke.getReference(e);r&&kr.addReferenceToElement(n,r)}#w(e){return e&&e.classList.contains("placeholder")}#v(e,n,r){const i=this.itemBuilder.getAmountColorClass(n.satsAmount);e.className=`zap-list-item ${i}${n.comment?" with-comment":""}`,e.setAttribute("data-pubkey",n.pubkey),e.setAttribute("data-event-id",r),e.innerHTML=kr.createZapItemHTML(n,i,this.viewId),e.removeAttribute("data-index")}}var YZ=nr(0),JZ=nr.n(YZ);const bd=new class{#e=new Map;#t=new Map;constructor(){}async getZapStats(t,e){const n=await this.#n(e,t);if(n)return n;const r=await this.fetchStats(t);return r&&Ke.updateStatsCache(e,t,r),r}async fetchStats(t){try{const e=await this._fetchFromApi(t);return this._formatStats(e)||this.createTimeoutError()}catch(e){return this.handleFetchError(e)}}createTimeoutError(){return{error:!0,timeout:!0}}handleFetchError(t){return{error:!0,timeout:t.message==="STATS_TIMEOUT"}}async _fetchFromApi(t){const e=Ix(t);if(!e)return null;const n=`https://api.nostr.band/v0/stats/${e.type==="npub"||e.type==="nprofile"?"profile":"event"}/${t}`,r=new AbortController,i=setTimeout((()=>r.abort()),tt.REQUEST_CONFIG.REQUEST_TIMEOUT);try{return await(await fetch(n,{signal:r.signal})).json()}catch(s){throw s.name==="AbortError"?new Error("STATS_TIMEOUT"):s}finally{clearTimeout(i)}}_formatStats(t){if(!t?.stats)return null;const e=Object.values(t.stats)[0];return e?{count:parseInt(e.zaps_received?.count||e.zaps?.count||0,10),msats:parseInt(e.zaps_received?.msats||e.zaps?.msats||0,10),maxMsats:parseInt(e.zaps_received?.max_msats||e.zaps?.max_msats||0,10)}:null}async initializeStats(t,e,n=!1){if(n&&this.displayStats({skeleton:!0},e),this.#t.has(e))return this.#t.get(e);if(Ix(t)?.type==="naddr"){const s=this.createTimeoutError();return this.displayStats(s,e),this.#e.set(e,s),s}const i=(async()=>{try{const s=await this.getZapStats(t,e);return s&&(this.displayStats(s,e),this.#e.set(e,s)),s}catch{return null}finally{this.#t.delete(e)}})();return this.#t.set(e,i),i}async#n(t,e){const n=Ke.getCachedStats(t,e),r=Date.now();return n&&r-n.timestamp<tt.REQUEST_CONFIG.CACHE_DURATION?n.stats:null}getCurrentStats(t){return this.#e.get(t)}async handleZapEvent(t,e,n){if(t?.isRealTimeEvent)try{const r=t.tags.find((l=>l[0].toLowerCase()==="bolt11"))?.[1],i=this.extractAmountFromBolt11(r);if(i<=0)return;const s=Ke.getViewStats(e),o={count:s?.count||0,msats:s?.msats||0,maxMsats:s?.maxMsats||0},a={count:o.count+1,msats:o.msats+i,maxMsats:Math.max(o.maxMsats,i)};Ke.updateStatsCache(e,n,a),this.#e.set(e,a),await this.displayStats(a,e),t.isStatsCalculated=!0,t.amountMsats=i}catch{}}extractAmountFromBolt11(t){try{const e=window.decodeBolt11(t);return parseInt(e.sections.find((n=>n.name==="amount"))?.value??"0",10)}catch{return 0}}async displayStats(t,e){try{await QZ(t,e)}catch{}}},bl=new class{#e;#t;#n;#s;#r;#o;#l;constructor(){this.#e=new r5,this.#i(),this.#a()}#i(){this.#n=new Map,this.#s=new Map,this.#r=new Map,this.#t=!1}#a(){const t={pool:this.#e,batchSize:tt.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_SIZE,batchDelay:tt.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_DELAY};this.#o=new LZ(t),this.#l=new RZ(t)}#u(t){this.#n.has(t)||this.#n.set(t,{zap:null}),this.#s.has(t)||this.#s.set(t,{isZapClosed:!1})}#c(t,e,n,r){this.#n.get(t).zap=this.#e.subscribeMany(e.relayUrls,[n.req],r)}#f(t){return t&&t.id&&Array.isArray(t.tags)}#m(t,e){return t&&this.#r.delete(t),null}async connectToRelays(t){this.#t||([this.#o,this.#l].forEach((e=>e.setRelayUrls(t))),this.#t=!0)}subscribeToZaps(t,e,n,r){try{this.#h(n),this.#u(t),this.#s.get(t).isZapClosed=!1,this.#c(t,e,n,this.#d(r))}catch(i){this.#p("Subscription error",i)}}#h(t){if(!t?.req?.kinds||!Array.isArray(t.req.kinds))throw new Error("Invalid subscription settings")}async fetchReference(t,e,n){try{if(!this.#f(e))return null;const r=e.tags.find((l=>Array.isArray(l)&&l[0]===n));if(!r)return null;const i=n==="e"?r[1]:`${r[1]}`,s=Ke.getReference(i);if(s)return s;const o=this.#r.get(i);if(o)return o;const a=n==="e"?this.#o:this.#l;try{const l=await a.getOrCreateFetchPromise(i);return l&&Ke.setReference(i,l),this.#r.delete(i),l}finally{this.#r.delete(i)}}catch(r){return this.#m(e?.id,r)}}#d(t){const e=Math.floor(Date.now()/1e3);return{...t,onevent:n=>{n.isRealTimeEvent=n.created_at>=e,t.onevent(n)},oneose:t.oneose}}#p(t,e){throw e}get zapPool(){return this.#e}},{zapPool:MJ}=bl,Es=new class{constructor(){this.viewConfigs=new Map,this.configStore=new Map,this.observers=new Map,this.#e=new Map,this.#t=new Map}#e;#t;setZapListUI(t){this.zapListUI=t}setViewConfig(t,e){this.viewConfigs.set(t,e),kr.viewConfigs.set(t,e),Ke.initializeZapView(t)}getViewConfig(t){return this.viewConfigs.get(t)}async updateEventReference(t,e){try{const n=this.getViewConfig(e);if(!n?.relayUrls?.length||Zl(n?.identifier||""))return!1;const r=await this._fetchEventReference(t,n);return!!r&&(t.reference=r,!0)}catch{return!1}}async _fetchEventReference(t,e){const n=async()=>{if(!t?.tags||!Array.isArray(t.tags))return null;try{if(t.tags.find((s=>Array.isArray(s)&&s[0]==="a"))?.[1])return await bl.fetchReference(e.relayUrls,t,"a");const i=t.tags.find((s=>Array.isArray(s)&&s[0]==="e"));return i?.[1]&&/^[0-9a-f]{64}$/.test(i[1].toLowerCase())?await bl.fetchReference(e.relayUrls,t,"e"):null}catch{return null}};try{return await Ke.getOrFetchReference(t.id,n)}catch{return null}}async updateEventReferenceBatch(t,e){const n=this.getViewConfig(e);if(!n?.relayUrls?.length||Zl(n?.identifier||""))return;const r=t.map((i=>this.updateEventReference(i,e)));await Promise.allSettled(r)}updateUIReferences(t){this.zapListUI&&t.forEach((e=>{e.reference&&this.zapListUI.updateZapReference(e)}))}async initializeSubscriptions(t,e){try{if(!this._isValidFilter(t))throw new Error("Invalid filter settings");const n=Tx(t.identifier);if(!n)throw new Error(tt.ZAP_CONFIG.ERRORS.DECODE_FAILED);this._initializeLoadState(e),this._showInitialLoadingSpinner(e);const{batchEvents:r,lastEventTime:i}=await this._collectInitialEvents(e,t,n);r?.length>0&&this._processBatchEvents(r,e).catch(console.error),await this.finalizeInitialization(e,i)}catch(n){throw n}}_showInitialLoadingSpinner(t){const e=this._getListElement(t);if(e){const n=this._createLoadTrigger();e.appendChild(n)}}async finalizeInitialization(t,e){const n=Ke.getZapEvents(t),r=this._getListElement(t),i=Ke.updateLoadState(t,{isInitialFetchComplete:!0,lastEventTime:e});await Promise.all([i,n.length===0?this.zapListUI?.showNoZapsMessage():null,n.length>=tt.REQ_CONFIG.INITIAL_LOAD_COUNT?this.setupInfiniteScroll(t):null]),r?.querySelector(".load-more-trigger")?.remove()}_initializeLoadState(t){Ke.updateLoadState(t,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1})}_isValidFilter(t){return t&&t.relayUrls&&Array.isArray(t.relayUrls)&&t.relayUrls.length>0&&t.identifier}setupInfiniteScroll(t){try{this._cleanupInfiniteScroll(t);const e=this._getListElement(t);if(!e)return;const n=this._createLoadTrigger();e.appendChild(n),this._observeLoadTrigger(n,t,e)}catch{}}_createLoadTrigger(){const t=document.createElement("div");t.className="load-more-trigger";const e=document.createElement("div");return e.className="loading-spinner",t.appendChild(e),t}_observeLoadTrigger(t,e,n){const r=new IntersectionObserver((i=>this._handleIntersection(i[0],e)),{root:n,rootMargin:tt.INFINITE_SCROLL.ROOT_MARGIN,threshold:tt.INFINITE_SCROLL.THRESHOLD});r.observe(t),this.observers.set(e,r)}async _handleIntersection(t,e){t.isIntersecting&&(Ke.getLoadState(e).isLoading?setTimeout((()=>{t.isIntersecting&&this._handleIntersection(t,e)}),tt.INFINITE_SCROLL.RETRY_DELAY):this.loadMoreZaps(e).then((n=>{n===0&&this._cleanupInfiniteScroll(e)})).catch((n=>{this._cleanupInfiniteScroll(e)})))}_cleanupInfiniteScroll(t){const e=this.observers.get(t);if(!e)return;e.disconnect(),this._getListElement(t)?.querySelector(".load-more-trigger")?.remove(),this.observers.delete(t)}_getListElement(t){return document.querySelector(`nzv-dialog[data-view-id="${t}"]`)?.shadowRoot?.querySelector(".dialog-zap-list")}async loadMoreZaps(t){const e=Ke.getLoadState(t),n=this.getViewConfig(t);if(!this._canLoadMore(e,n))return 0;e.isLoading=!0;try{const r=await this._executeLoadMore(t,e,n);if(r>0){const i=Ke.getZapEvents(t).slice(-r);await this.updateEventReferenceBatch(i,t),this.updateUIReferences(i)}return r}finally{e.isLoading=!1}}async _executeLoadMore(t,e,n){const r=Tx(n.identifier,e.lastEventTime);if(!r)return 0;const i=[],s=setTimeout((()=>{i.length===0&&this._cleanupInfiniteScroll(t)}),tt.LOAD_TIMEOUT);try{return await this._collectEvents(t,n,r,i,tt.REQ_CONFIG.ADDITIONAL_LOAD_COUNT,e),i.length>0&&await this._processBatchEvents(i,t),i.length}catch{return 0}finally{clearTimeout(s)}}async _collectEvents(t,e,n,r,i,s){return new Promise(((o,a)=>{const l=setTimeout((()=>a(new Error("Load timeout"))),tt.LOAD_TIMEOUT);bl.subscribeToZaps(t,e,n,{onevent:c=>{c.created_at<s.lastEventTime&&(r.push(c),s.lastEventTime=Math.min(s.lastEventTime,c.created_at),r.length>=i&&(clearTimeout(l),o()))},oneose:()=>{clearTimeout(l),o()}})}))}async _collectInitialEvents(t,e,n){const r=[];let i=null;return new Promise((s=>{const o=this._setupBufferInterval(r,t),a=bl.subscribeToZaps(t,e,n,{onevent:l=>{const c=this._handleInitialEvent(l,r,i,t);c!==null&&(i=c)},oneose:()=>{clearInterval(o),s({batchEvents:[...r],lastEventTime:i})}});this.#e.set(t,{zap:a})}))}_handleInitialEvent(t,e,n,r){const i=Math.min(n||t.created_at,t.created_at);if(Ke.addZapEvent(r,t)){if(e.push(t),this.updateEventReference(t,r).then((s=>{s&&this.zapListUI&&t.reference&&this.zapListUI.updateZapReference(t)})),t.isRealTimeEvent){const s=this.getViewConfig(r);bd.handleZapEvent(t,r,s?.identifier),this.zapListUI&&this.zapListUI.prependZap(t).catch(console.error)}e.length>=tt.BATCH_SIZE&&this.zapListUI&&this.zapListUI.batchUpdate(Ke.getZapEvents(r)).catch(console.error)}return i}async _processBatchEvents(t,e){if(t?.length){t.sort(((n,r)=>r.created_at-n.created_at)),t.forEach((n=>Ke.addZapEvent(e,n)));try{await Promise.all([yd.processBatchProfiles(t)])}catch{}await this._updateUI(t,e)}}async _updateUI(t,e){this.zapListUI&&await this.zapListUI.batchUpdate(t,{isFullUpdate:!0})}_setupBufferInterval(t,e){let n=0;const r=tt.BUFFER_MIN_INTERVAL;return setInterval((()=>{const i=Date.now();t.length>0&&i-n>=r&&this.zapListUI&&(this.zapListUI.batchUpdate(Ke.getZapEvents(e),{isBufferUpdate:!0}).catch(console.error),n=i)}),tt.BUFFER_INTERVAL)}_canLoadMore(t,e){return e&&!t.isLoading&&t.lastEventTime}unsubscribe(t){try{const e=this.#e.get(t);e?.zap&&(e.zap(),e.zap=null),this.#t.set(t,{isZapClosed:!0}),this._cleanupInfiniteScroll(t)}catch{}}};class XZ extends HTMLElement{#e;#t;constructor(){super(),this.attachShadow({mode:"open"}),this.#e={isInitialized:!1,theme:tt.DEFAULT_OPTIONS.theme},this.popStateHandler=e=>{e.preventDefault(),this.#i(".dialog")?.open&&this.closeDialog()}}async connectedCallback(){if(this.viewId=this.getAttribute("data-view-id"),this.viewId){this.#t=this.#n();try{await this.#t,this.#e.isInitialized=!0;const e=Es.getViewConfig(this.viewId);if(!e)throw new Error("Config is required for initialization");if(await this.#s(e),this.getAttribute("data-nzv-id")){const n=await bd.getCurrentStats(this.viewId);n&&this.statsUI.displayStats(n)}this.#e.isInitialized=!0,this.dispatchEvent(new CustomEvent("dialog-initialized",{detail:{viewId:this.viewId}}))}catch{}}}async#n(){return new Promise((e=>{const n=document.createElement("template");n.innerHTML=kr.getDialogTemplate(),this.shadowRoot.appendChild(n.content.cloneNode(!0)),this.#r(),queueMicrotask((()=>e()))}))}async#s(e){const n=document.createElement("style");n.textContent=JZ(),this.shadowRoot.appendChild(n),this.statsUI=new NZ(this.shadowRoot),this.profileUI=new KZ,this.zapListUI=new ZZ(this.shadowRoot,this.profileUI,this.viewId,e),Es.setZapListUI(this.zapListUI);const r=Ke.getZapEvents(this.viewId);r?.length?await this.zapListUI.renderZapListFromCache(r):this.zapListUI.showNoZapsMessage();const i=this.getAttribute("data-nzv-id");if(i){const s=await Ke.getCachedStats(this.viewId,i);if(s?.stats)this.statsUI.displayStats(s.stats);else{const o=await bd.getCurrentStats(this.viewId);o&&this.statsUI.displayStats(o)}}}static get observedAttributes(){return["data-theme"]}#r(){const e=this.#i(".dialog");this.#i(".close-dialog-button").addEventListener("click",(()=>this.closeDialog())),e.addEventListener("click",(n=>{n.target===e&&this.closeDialog()})),e.addEventListener("cancel",(n=>{n.preventDefault(),this.closeDialog()})),document.addEventListener("keydown",(n=>{if(e?.open){if(n.key==="Escape")this.closeDialog();else if(n.key===" "){n.preventDefault();const r=this.#i(".dialog-zap-list");r&&(r.scrollTop+=.8*r.clientHeight)}}}))}attributeChangedCallback(e,n,r){n!==r&&e==="data-theme"&&this.#o(r)}#o(e){Ke.updateThemeState(this.viewId,{theme:e}).isInitialized&&this.#l()}#l(){const e=Ke.getThemeState(this.viewId).theme==="dark"?"dark-theme":"light-theme";this.shadowRoot.host.classList.add(e)}async showDialog(){await this.#t;const e=this.#i(".dialog");e&&!e.open&&this.#e.isInitialized&&(window.addEventListener("popstate",this.popStateHandler),e.showModal(),queueMicrotask((()=>{document.activeElement&&document.activeElement.blur()})),this.#a())}closeDialog(){const e=this.#i(".dialog");e?.open&&(this.zapListUI?.destroy(),Es.unsubscribe(this.viewId),e.close(),this.remove(),window.removeEventListener("popstate",this.popStateHandler))}displayZapStats(e){this.statsUI.displayStats(e)}#i(e){return this.shadowRoot.querySelector(e)}#a(){const e=this.getAttribute("data-view-id"),n=document.querySelector(`button[data-zap-view-id="${e}"]`);if(!n)return;const r=this.#i(".dialog-title"),i=this.#i(".dialog-title a");if(!i||!r)return;const s=n.getAttribute("data-title"),o=n.getAttribute("data-nzv-id");i.href=o?`https://njump.me/${o}`:"#",s?.trim()?(i.textContent=s,r.classList.add("custom-title")):(i.textContent=tt.DIALOG_CONFIG.DEFAULT_TITLE+e5(o),r.classList.remove("custom-title"))}getOperations(){if(!this.#e.isInitialized)return null;const e={closeDialog:()=>this.closeDialog(),showDialog:()=>this.showDialog()};return this.#e.isInitialized&&Object.assign(e,{prependZap:n=>this.zapListUI?.prependZap(n),displayZapStats:n=>this.statsUI?.displayStats(n),showNoZapsMessage:()=>this.zapListUI?.showNoZapsMessage()}),e}async waitForInitialization(){return this.#t}}customElements.define("nzv-dialog",XZ);const wd={create:async(t,e)=>{if(!t||!e)return Promise.reject(new Error("Invalid viewId or config"));Es.setViewConfig(t,e);const n=document.querySelector(`nzv-dialog[data-view-id="${t}"]`);if(n)return n;const r=document.createElement("nzv-dialog");r.setAttribute("data-view-id",t),r.setAttribute("data-config",JSON.stringify(e));const i=document.querySelector(`button[data-zap-view-id="${t}"]`);return i?.getAttribute("data-nzv-id")&&r.setAttribute("data-nzv-id",i.getAttribute("data-nzv-id")),document.body.appendChild(r),await r.waitForInitialization(),r},get:t=>document.querySelector(`nzv-dialog[data-view-id="${t}"]`),execute:(t,e,...n)=>{const r=wd.get(t),i=r?.getOperations();return i?i[e]?.(...n)??null:null}},QZ=(t,e)=>wd.execute(e,"displayZapStats",t);async function eY(t,e){try{const n=md.fromButton(t);if(!n)throw new Error("Failed to create config from button");if(Es.setViewConfig(e,n),!await(async function(i){try{const s=Es.getViewConfig(i);if(!s)throw new Error(`View configuration not found for viewId: ${i}`);return Es.setViewConfig(i,s),await wd.create(i,s)}catch{return null}})(e))throw new Error(tt.ZAP_CONFIG.ERRORS.DIALOG_NOT_FOUND);await(async function(i){try{const s=wd.get(i);if(!s)throw new Error("Dialog not found");await s.waitForInitialization();const o=s.getOperations();if(!o?.showDialog)throw new Error("Basic dialog operations not available");o.showDialog()}catch{}})(e),setTimeout((async()=>{if(await(async function(i,s){const o=Ke.getZapEvents(i);if(o.length>0){const l=[...new Set(o.map((c=>c.pubkey)))];yd.fetchProfiles(l)}const{hasEnoughCachedEvents:a}=await Ke.processCachedData(i,s);return a&&Es.setupInfiniteScroll(i),a})(e,n),!t.hasAttribute("data-initialized")){const i=t.getAttribute("data-nzv-id");await Promise.all([bl.connectToRelays(n.relayUrls),Es.initializeSubscriptions(n,e),i?bd.initializeStats(i,e,!0):Promise.resolve()]),t.setAttribute("data-initialized","true")}}),0)}catch{}}function i5(){Object.entries(tt.LIBRARIES).forEach((([t,e])=>{window[t]=e})),document.querySelectorAll("button[data-nzv-id]").forEach(((t,e)=>{if(t.hasAttribute("data-zap-view-id"))return;const n=`nostr-zap-view-${e}`;t.setAttribute("data-zap-view-id",n),t.hasAttribute("data-zap-color-mode")||t.setAttribute("data-zap-color-mode",tt.ZAP_CONFIG.DEFAULT_COLOR_MODE),t.addEventListener("click",(()=>eY(t,n)))}))}function tY(t={}){Object.assign(tt,t),typeof window<"u"&&i5()}typeof window<"u"&&document.addEventListener("DOMContentLoaded",i5);var nY=q4.X,Ox={},$x;function rY(){if($x)return Ox;$x=1;var t=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof jv<"u"?jv:{};function e(y){return y&&y.__esModule?y.default:y}var n={},r={},i=t.parcelRequire1faa;i==null&&(i=function(y){if(y in n)return n[y].exports;if(y in r){var m=r[y];delete r[y];var v={id:y,exports:{}};return n[y]=v,m.call(v.exports,v,v.exports),v.exports}var C=new Error("Cannot find module '"+y+"'");throw C.code="MODULE_NOT_FOUND",C},i.register=function(m,v){r[m]=v},t.parcelRequire1faa=i),i.register("58QMB",function(y,m){(function(){function v(j,K){var Q,se=Object.keys(K);for(Q=0;Q<se.length;Q++)j=j.replace(new RegExp("\\{"+se[Q]+"\\}","gi"),K[se[Q]]);return j}function C(j){var K,Q,se;if(!j)throw new Error("cannot create a random attribute name for an undefined object");K="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",Q="";do for(Q="",se=0;se<12;se++)Q+=K[Math.floor(Math.random()*K.length)];while(j[Q]);return Q}function R(j){var K={left:"start",right:"end",center:"middle",start:"start",end:"end"};return K[j]||K.start}function B(j){var K={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return K[j]||K.alphabetic}var q,z,ne,le,re;re=(function(j,K){var Q,se,fe,ge={};for(j=j.split(","),K=K||10,Q=0;Q<j.length;Q+=2)se="&"+j[Q+1]+";",fe=parseInt(j[Q],K),ge[se]="&#"+fe+";";return ge["\\xa0"]="&#160;",ge})("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),q={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},ne=function(j,K){this.__root=j,this.__ctx=K},ne.prototype.addColorStop=function(j,K){var Q,se,fe=this.__ctx.__createElement("stop");fe.setAttribute("offset",j),K.indexOf("rgba")!==-1?(Q=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,se=Q.exec(K),fe.setAttribute("stop-color",v("rgb({r},{g},{b})",{r:se[1],g:se[2],b:se[3]})),fe.setAttribute("stop-opacity",se[4])):fe.setAttribute("stop-color",K),this.__root.appendChild(fe)},le=function(j,K){this.__root=j,this.__ctx=K},z=function(j){var K,Q={width:500,height:500,enableMirroring:!1};if(arguments.length>1?(K=Q,K.width=arguments[0],K.height=arguments[1]):K=j||Q,!(this instanceof z))return new z(K);this.width=K.width||Q.width,this.height=K.height||Q.height,this.enableMirroring=K.enableMirroring!==void 0?K.enableMirroring:Q.enableMirroring,this.canvas=this,this.__document=K.document||document,K.ctx?this.__ctx=K.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)},z.prototype.__createElement=function(j,K,Q){K===void 0&&(K={});var se,fe,ge=this.__document.createElementNS("http://www.w3.org/2000/svg",j),ke=Object.keys(K);for(Q&&(ge.setAttribute("fill","none"),ge.setAttribute("stroke","none")),se=0;se<ke.length;se++)fe=ke[se],ge.setAttribute(fe,K[fe]);return ge},z.prototype.__setDefaultStyles=function(){var j,K,Q=Object.keys(q);for(j=0;j<Q.length;j++)K=Q[j],this[K]=q[K].canvas},z.prototype.__applyStyleState=function(j){var K,Q,se=Object.keys(j);for(K=0;K<se.length;K++)Q=se[K],this[Q]=j[Q]},z.prototype.__getStyleState=function(){var j,K,Q={},se=Object.keys(q);for(j=0;j<se.length;j++)K=se[j],Q[K]=this[K];return Q},z.prototype.__applyStyleToCurrentElement=function(j){var K=this.__currentElement,Q=this.__currentElementsToStyle;Q&&(K.setAttribute(j,""),K=Q.element,Q.children.forEach(function(Tt){Tt.setAttribute(j,"")}));var se,fe,ge,ke,ve,Pe,Ne=Object.keys(q);for(se=0;se<Ne.length;se++)if(fe=q[Ne[se]],ge=this[Ne[se]],fe.apply){if(ge instanceof le){if(ge.__ctx)for(;ge.__ctx.__defs.childNodes.length;)ke=ge.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[ke]=ke,this.__defs.appendChild(ge.__ctx.__defs.childNodes[0]);K.setAttribute(fe.apply,v("url(#{id})",{id:ge.__root.getAttribute("id")}))}else if(ge instanceof ne)K.setAttribute(fe.apply,v("url(#{id})",{id:ge.__root.getAttribute("id")}));else if(fe.apply.indexOf(j)!==-1&&fe.svg!==ge)if(fe.svgAttr!=="stroke"&&fe.svgAttr!=="fill"||ge.indexOf("rgba")===-1){var Oe=fe.svgAttr;if(Ne[se]==="globalAlpha"&&(Oe=j+"-"+fe.svgAttr,K.getAttribute(Oe)))continue;K.setAttribute(Oe,ge)}else{ve=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,Pe=ve.exec(ge),K.setAttribute(fe.svgAttr,v("rgb({r},{g},{b})",{r:Pe[1],g:Pe[2],b:Pe[3]}));var Be=Pe[4],Ve=this.globalAlpha;Ve!=null&&(Be*=Ve),K.setAttribute(fe.svgAttr+"-opacity",Be)}}},z.prototype.__closestGroupOrSvg=function(j){return j=j||this.__currentElement,j.nodeName==="g"||j.nodeName==="svg"?j:this.__closestGroupOrSvg(j.parentNode)},z.prototype.getSerializedSvg=function(j){var K,Q,se,fe,ge,ke,ve=new XMLSerializer().serializeToString(this.__root);if(ke=/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi,ke.test(ve)&&(ve=ve.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),j)for(K=Object.keys(re),Q=0;Q<K.length;Q++)se=K[Q],fe=re[se],ge=new RegExp(se,"gi"),ge.test(ve)&&(ve=ve.replace(ge,fe));return ve},z.prototype.getSvg=function(){return this.__root},z.prototype.save=function(){var j=this.__createElement("g"),K=this.__closestGroupOrSvg();this.__groupStack.push(K),K.appendChild(j),this.__currentElement=j,this.__stack.push(this.__getStyleState())},z.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var j=this.__stack.pop();this.__applyStyleState(j)},z.prototype.__addTransform=function(j){var K=this.__closestGroupOrSvg();if(K.childNodes.length>0){this.__currentElement.nodeName==="path"&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:K,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var Q=this.__createElement("g");K.appendChild(Q),this.__currentElement=Q}var se=this.__currentElement.getAttribute("transform");se?se+=" ":se="",se+=j,this.__currentElement.setAttribute("transform",se)},z.prototype.scale=function(j,K){K===void 0&&(K=j),this.__addTransform(v("scale({x},{y})",{x:j,y:K}))},z.prototype.rotate=function(j){var K=180*j/Math.PI;this.__addTransform(v("rotate({angle},{cx},{cy})",{angle:K,cx:0,cy:0}))},z.prototype.translate=function(j,K){this.__addTransform(v("translate({x},{y})",{x:j,y:K}))},z.prototype.transform=function(j,K,Q,se,fe,ge){this.__addTransform(v("matrix({a},{b},{c},{d},{e},{f})",{a:j,b:K,c:Q,d:se,e:fe,f:ge}))},z.prototype.beginPath=function(){var j,K;this.__currentDefaultPath="",this.__currentPosition={},j=this.__createElement("path",{},!0),K=this.__closestGroupOrSvg(),K.appendChild(j),this.__currentElement=j},z.prototype.__applyCurrentDefaultPath=function(){var j=this.__currentElement;j.nodeName==="path"?j.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",j.nodeName)},z.prototype.__addPathCommand=function(j){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=j},z.prototype.moveTo=function(j,K){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.__currentPosition={x:j,y:K},this.__addPathCommand(v("M {x} {y}",{x:j,y:K}))},z.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},z.prototype.lineTo=function(j,K){this.__currentPosition={x:j,y:K},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(v("L {x} {y}",{x:j,y:K})):this.__addPathCommand(v("M {x} {y}",{x:j,y:K}))},z.prototype.bezierCurveTo=function(j,K,Q,se,fe,ge){this.__currentPosition={x:fe,y:ge},this.__addPathCommand(v("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:j,cp1y:K,cp2x:Q,cp2y:se,x:fe,y:ge}))},z.prototype.quadraticCurveTo=function(j,K,Q,se){this.__currentPosition={x:Q,y:se},this.__addPathCommand(v("Q {cpx} {cpy} {x} {y}",{cpx:j,cpy:K,x:Q,y:se}))};var ae=function(j){var K=Math.sqrt(j[0]*j[0]+j[1]*j[1]);return[j[0]/K,j[1]/K]};z.prototype.arcTo=function(j,K,Q,se,fe){var ge=this.__currentPosition&&this.__currentPosition.x,ke=this.__currentPosition&&this.__currentPosition.y;if(ge!==void 0&&ke!==void 0){if(fe<0)throw new Error("IndexSizeError: The radius provided ("+fe+") is negative.");if(ge===j&&ke===K||j===Q&&K===se||fe===0)return void this.lineTo(j,K);var ve=ae([ge-j,ke-K]),Pe=ae([Q-j,se-K]);if(ve[0]*Pe[1]==ve[1]*Pe[0])return void this.lineTo(j,K);var Ne=ve[0]*Pe[0]+ve[1]*Pe[1],Oe=Math.acos(Math.abs(Ne)),Be=ae([ve[0]+Pe[0],ve[1]+Pe[1]]),Ve=fe/Math.sin(Oe/2),Tt=j+Ve*Be[0],Z=K+Ve*Be[1],J=[-ve[1],ve[0]],G=[Pe[1],-Pe[0]],ie=function(Ce){var me=Ce[0];return Ce[1]>=0?Math.acos(me):-Math.acos(me)},ue=ie(J),we=ie(G);this.lineTo(Tt+J[0]*fe,Z+J[1]*fe),this.arc(Tt,Z,fe,ue,we)}},z.prototype.stroke=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},z.prototype.fill=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},z.prototype.rect=function(j,K,Q,se){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.moveTo(j,K),this.lineTo(j+Q,K),this.lineTo(j+Q,K+se),this.lineTo(j,K+se),this.lineTo(j,K),this.closePath()},z.prototype.fillRect=function(j,K,Q,se){var fe,ge;fe=this.__createElement("rect",{x:j,y:K,width:Q,height:se,"shape-rendering":"crispEdges"},!0),ge=this.__closestGroupOrSvg(),ge.appendChild(fe),this.__currentElement=fe,this.__applyStyleToCurrentElement("fill")},z.prototype.strokeRect=function(j,K,Q,se){var fe,ge;fe=this.__createElement("rect",{x:j,y:K,width:Q,height:se},!0),ge=this.__closestGroupOrSvg(),ge.appendChild(fe),this.__currentElement=fe,this.__applyStyleToCurrentElement("stroke")},z.prototype.__clearCanvas=function(){for(var j=this.__closestGroupOrSvg(),K=j.getAttribute("transform"),Q=this.__root.childNodes[1],se=Q.childNodes,fe=se.length-1;fe>=0;fe--)se[fe]&&Q.removeChild(se[fe]);this.__currentElement=Q,this.__groupStack=[],K&&this.__addTransform(K)},z.prototype.clearRect=function(j,K,Q,se){if(j===0&&K===0&&Q===this.width&&se===this.height)return void this.__clearCanvas();var fe,ge=this.__closestGroupOrSvg();fe=this.__createElement("rect",{x:j,y:K,width:Q,height:se,fill:"#FFFFFF"},!0),ge.appendChild(fe)},z.prototype.createLinearGradient=function(j,K,Q,se){var fe=this.__createElement("linearGradient",{id:C(this.__ids),x1:j+"px",x2:Q+"px",y1:K+"px",y2:se+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(fe),new ne(fe,this)},z.prototype.createRadialGradient=function(j,K,Q,se,fe,ge){var ke=this.__createElement("radialGradient",{id:C(this.__ids),cx:se+"px",cy:fe+"px",r:ge+"px",fx:j+"px",fy:K+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(ke),new ne(ke,this)},z.prototype.__parseFont=function(){var j=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i,K=j.exec(this.font),Q={style:K[1]||"normal",size:K[4]||"10px",family:K[6]||"sans-serif",weight:K[3]||"normal",decoration:K[2]||"normal",href:null};return this.__fontUnderline==="underline"&&(Q.decoration="underline"),this.__fontHref&&(Q.href=this.__fontHref),Q},z.prototype.__wrapTextLink=function(j,K){if(j.href){var Q=this.__createElement("a");return Q.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",j.href),Q.appendChild(K),Q}return K},z.prototype.__applyText=function(j,K,Q,se){var fe=this.__parseFont(),ge=this.__closestGroupOrSvg(),ke=this.__createElement("text",{"font-family":fe.family,"font-size":fe.size,"font-style":fe.style,"font-weight":fe.weight,"text-decoration":fe.decoration,x:K,y:Q,"text-anchor":R(this.textAlign),"dominant-baseline":B(this.textBaseline)},!0);ke.appendChild(this.__document.createTextNode(j)),this.__currentElement=ke,this.__applyStyleToCurrentElement(se),ge.appendChild(this.__wrapTextLink(fe,ke))},z.prototype.fillText=function(j,K,Q){this.__applyText(j,K,Q,"fill")},z.prototype.strokeText=function(j,K,Q){this.__applyText(j,K,Q,"stroke")},z.prototype.measureText=function(j){return this.__ctx.font=this.font,this.__ctx.measureText(j)},z.prototype.arc=function(j,K,Q,se,fe,ge){if(se!==fe){se%=2*Math.PI,fe%=2*Math.PI,se===fe&&(fe=(fe+2*Math.PI-.001*(ge?-1:1))%(2*Math.PI));var ke=j+Q*Math.cos(fe),ve=K+Q*Math.sin(fe),Pe=j+Q*Math.cos(se),Ne=K+Q*Math.sin(se),Oe=ge?0:1,Be=0,Ve=fe-se;Ve<0&&(Ve+=2*Math.PI),Be=ge?Ve>Math.PI?0:1:Ve>Math.PI?1:0,this.lineTo(Pe,Ne),this.__addPathCommand(v("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:Q,ry:Q,xAxisRotation:0,largeArcFlag:Be,sweepFlag:Oe,endX:ke,endY:ve})),this.__currentPosition={x:ke,y:ve}}},z.prototype.clip=function(){var j=this.__closestGroupOrSvg(),K=this.__createElement("clipPath"),Q=C(this.__ids),se=this.__createElement("g");this.__applyCurrentDefaultPath(),j.removeChild(this.__currentElement),K.setAttribute("id",Q),K.appendChild(this.__currentElement),this.__defs.appendChild(K),j.setAttribute("clip-path",v("url(#{id})",{id:Q})),j.appendChild(se),this.__currentElement=se},z.prototype.drawImage=function(){var j,K,Q,se,fe,ge,ke,ve,Pe,Ne,Oe,Be,Ve,Tt,Z=Array.prototype.slice.call(arguments),J=Z[0],G=0,ie=0;if(Z.length===3)j=Z[1],K=Z[2],fe=J.width,ge=J.height,Q=fe,se=ge;else if(Z.length===5)j=Z[1],K=Z[2],Q=Z[3],se=Z[4],fe=J.width,ge=J.height;else{if(Z.length!==9)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);G=Z[1],ie=Z[2],fe=Z[3],ge=Z[4],j=Z[5],K=Z[6],Q=Z[7],se=Z[8]}ke=this.__closestGroupOrSvg(),this.__currentElement;var ue="translate("+j+", "+K+")";if(J instanceof z){if(ve=J.getSvg().cloneNode(!0),ve.childNodes&&ve.childNodes.length>1){for(Pe=ve.childNodes[0];Pe.childNodes.length;)Tt=Pe.childNodes[0].getAttribute("id"),this.__ids[Tt]=Tt,this.__defs.appendChild(Pe.childNodes[0]);if(Ne=ve.childNodes[1]){var we,Ce=Ne.getAttribute("transform");we=Ce?Ce+" "+ue:ue,Ne.setAttribute("transform",we),ke.appendChild(Ne)}}}else J.nodeName!=="CANVAS"&&J.nodeName!=="IMG"||(Oe=this.__createElement("image"),Oe.setAttribute("width",Q),Oe.setAttribute("height",se),Oe.setAttribute("preserveAspectRatio","none"),Oe.setAttribute("opacity",this.globalAlpha),(G||ie||fe!==J.width||ge!==J.height)&&(Be=this.__document.createElement("canvas"),Be.width=Q,Be.height=se,Ve=Be.getContext("2d"),Ve.drawImage(J,G,ie,fe,ge,0,0,Q,se),J=Be),Oe.setAttribute("transform",ue),Oe.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",J.nodeName==="CANVAS"?J.toDataURL():J.originalSrc),ke.appendChild(Oe))},z.prototype.createPattern=function(j,K){var Q,se=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),fe=C(this.__ids);return se.setAttribute("id",fe),se.setAttribute("width",j.width),se.setAttribute("height",j.height),j.nodeName==="CANVAS"||j.nodeName==="IMG"?(Q=this.__document.createElementNS("http://www.w3.org/2000/svg","image"),Q.setAttribute("width",j.width),Q.setAttribute("height",j.height),Q.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",j.nodeName==="CANVAS"?j.toDataURL():j.getAttribute("src")),se.appendChild(Q),this.__defs.appendChild(se)):j instanceof z&&(se.appendChild(j.__root.childNodes[1]),this.__defs.appendChild(se)),new le(se,this)},z.prototype.setLineDash=function(j){j&&j.length>0?this.lineDash=j.join(","):this.lineDash=null},z.prototype.drawFocusRing=function(){},z.prototype.createImageData=function(){},z.prototype.getImageData=function(){},z.prototype.putImageData=function(){},z.prototype.globalCompositeOperation=function(){},z.prototype.setTransform=function(){},typeof window=="object"&&(window.C2S=z),typeof y.exports=="object"&&(y.exports=z)})(),(function(){function v(Z,J,G){this.mode=ke.MODE_8BIT_BYTE,this.data=Z,this.parsedData=[];for(var ie=0,ue=this.data.length;ie<ue;ie++){var we=[],Ce=this.data.charCodeAt(ie);J?we[0]=Ce:Ce>65536?(we[0]=240|(1835008&Ce)>>>18,we[1]=128|(258048&Ce)>>>12,we[2]=128|(4032&Ce)>>>6,we[3]=128|63&Ce):Ce>2048?(we[0]=224|(61440&Ce)>>>12,we[1]=128|(4032&Ce)>>>6,we[2]=128|63&Ce):Ce>128?(we[0]=192|(1984&Ce)>>>6,we[1]=128|63&Ce):we[0]=Ce,this.parsedData.push(we)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),G||this.parsedData.length==this.data.length||(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function C(Z,J){this.typeNumber=Z,this.errorCorrectLevel=J,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function R(Z,J){if(Z.length==re)throw new Error(Z.length+"/"+J);for(var G=0;G<Z.length&&Z[G]==0;)G++;this.num=new Array(Z.length-G+J);for(var ie=0;ie<Z.length-G;ie++)this.num[ie]=Z[ie+G]}function B(Z,J){this.totalCount=Z,this.dataCount=J}function q(){this.buffer=[],this.length=0}function z(){var Z=!1,J=navigator.userAgent;if(/android/i.test(J)){Z=!0;var G=J.toString().match(/android ([0-9]\.[0-9])/i);G&&G[1]&&(Z=parseFloat(G[1]))}return Z}function ne(Z,J){for(var G=J.correctLevel,ie=1,ue=le(Z),we=0,Ce=Ve.length;we<Ce;we++){var me=0;switch(G){case ve.L:me=Ve[we][0];break;case ve.M:me=Ve[we][1];break;case ve.Q:me=Ve[we][2];break;case ve.H:me=Ve[we][3]}if(ue<=me)break;ie++}if(ie>Ve.length)throw new Error("Too long data. the CorrectLevel."+["M","L","H","Q"][G]+" limit length is "+me);return J.version!=0&&(ie<=J.version?(ie=J.version,J.runVersion=ie):(console.warn("QR Code version "+J.version+" too small, run version use "+ie),J.runVersion=ie)),ie}function le(Z){var J=encodeURI(Z).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return J.length+(J.length!=Z.length?3:0)}var re,ae,j=typeof t=="object"&&t&&t.Object===Object&&t,K=typeof self=="object"&&self&&self.Object===Object&&self,Q=j||K||Function("return this")(),se=m&&!m.nodeType&&m,fe=se&&!0&&y&&!y.nodeType&&y,ge=Q.QRCode;v.prototype={getLength:function(Z){return this.parsedData.length},write:function(Z){for(var J=0,G=this.parsedData.length;J<G;J++)Z.put(this.parsedData[J],8)}},C.prototype={addData:function(Z,J,G){var ie=new v(Z,J,G);this.dataList.push(ie),this.dataCache=null},isDark:function(Z,J){if(Z<0||this.moduleCount<=Z||J<0||this.moduleCount<=J)throw new Error(Z+","+J);return this.modules[Z][J][0]},getEye:function(Z,J){if(Z<0||this.moduleCount<=Z||J<0||this.moduleCount<=J)throw new Error(Z+","+J);var G=this.modules[Z][J];if(G[1]){var ie="P"+G[1]+"_"+G[2];return G[2]=="A"&&(ie="A"+G[1]),{isDark:G[0],type:ie}}return null},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(Z,J){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var G=0;G<this.moduleCount;G++){this.modules[G]=new Array(this.moduleCount);for(var ie=0;ie<this.moduleCount;ie++)this.modules[G][ie]=[]}this.setupPositionProbePattern(0,0,"TL"),this.setupPositionProbePattern(this.moduleCount-7,0,"BL"),this.setupPositionProbePattern(0,this.moduleCount-7,"TR"),this.setupPositionAdjustPattern("A"),this.setupTimingPattern(),this.setupTypeInfo(Z,J),this.typeNumber>=7&&this.setupTypeNumber(Z),this.dataCache==null&&(this.dataCache=C.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,J)},setupPositionProbePattern:function(Z,J,G){for(var ie=-1;ie<=7;ie++)if(!(Z+ie<=-1||this.moduleCount<=Z+ie))for(var ue=-1;ue<=7;ue++)J+ue<=-1||this.moduleCount<=J+ue||(0<=ie&&ie<=6&&(ue==0||ue==6)||0<=ue&&ue<=6&&(ie==0||ie==6)||2<=ie&&ie<=4&&2<=ue&&ue<=4?(this.modules[Z+ie][J+ue][0]=!0,this.modules[Z+ie][J+ue][2]=G,this.modules[Z+ie][J+ue][1]=ie==-0||ue==-0||ie==6||ue==6?"O":"I"):this.modules[Z+ie][J+ue][0]=!1)},getBestMaskPattern:function(){for(var Z=0,J=0,G=0;G<8;G++){this.makeImpl(!0,G);var ie=Ne.getLostPoint(this);(G==0||Z>ie)&&(Z=ie,J=G)}return J},createMovieClip:function(Z,J,G){var ie=Z.createEmptyMovieClip(J,G);this.make();for(var ue=0;ue<this.modules.length;ue++)for(var we=1*ue,Ce=0;Ce<this.modules[ue].length;Ce++){var me=1*Ce,te=this.modules[ue][Ce][0];te&&(ie.beginFill(0,100),ie.moveTo(me,we),ie.lineTo(me+1,we),ie.lineTo(me+1,we+1),ie.lineTo(me,we+1),ie.endFill())}return ie},setupTimingPattern:function(){for(var Z=8;Z<this.moduleCount-8;Z++)this.modules[Z][6][0]==null&&(this.modules[Z][6][0]=Z%2==0);for(var J=8;J<this.moduleCount-8;J++)this.modules[6][J][0]==null&&(this.modules[6][J][0]=J%2==0)},setupPositionAdjustPattern:function(Z){for(var J=Ne.getPatternPosition(this.typeNumber),G=0;G<J.length;G++)for(var ie=0;ie<J.length;ie++){var ue=J[G],we=J[ie];if(this.modules[ue][we][0]==null)for(var Ce=-2;Ce<=2;Ce++)for(var me=-2;me<=2;me++)Ce==-2||Ce==2||me==-2||me==2||Ce==0&&me==0?(this.modules[ue+Ce][we+me][0]=!0,this.modules[ue+Ce][we+me][2]=Z,this.modules[ue+Ce][we+me][1]=Ce==-2||me==-2||Ce==2||me==2?"O":"I"):this.modules[ue+Ce][we+me][0]=!1}},setupTypeNumber:function(Z){for(var J=Ne.getBCHTypeNumber(this.typeNumber),G=0;G<18;G++){var ie=!Z&&(J>>G&1)==1;this.modules[Math.floor(G/3)][G%3+this.moduleCount-8-3][0]=ie}for(var G=0;G<18;G++){var ie=!Z&&(J>>G&1)==1;this.modules[G%3+this.moduleCount-8-3][Math.floor(G/3)][0]=ie}},setupTypeInfo:function(Z,J){for(var G=this.errorCorrectLevel<<3|J,ie=Ne.getBCHTypeInfo(G),ue=0;ue<15;ue++){var we=!Z&&(ie>>ue&1)==1;ue<6?this.modules[ue][8][0]=we:ue<8?this.modules[ue+1][8][0]=we:this.modules[this.moduleCount-15+ue][8][0]=we}for(var ue=0;ue<15;ue++){var we=!Z&&(ie>>ue&1)==1;ue<8?this.modules[8][this.moduleCount-ue-1][0]=we:ue<9?this.modules[8][15-ue-1+1][0]=we:this.modules[8][15-ue-1][0]=we}this.modules[this.moduleCount-8][8][0]=!Z},mapData:function(Z,J){for(var G=-1,ie=this.moduleCount-1,ue=7,we=0,Ce=this.moduleCount-1;Ce>0;Ce-=2)for(Ce==6&&Ce--;;){for(var me=0;me<2;me++)if(this.modules[ie][Ce-me][0]==null){var te=!1;we<Z.length&&(te=(Z[we]>>>ue&1)==1);var Ot=Ne.getMask(J,ie,Ce-me);Ot&&(te=!te),this.modules[ie][Ce-me][0]=te,ue--,ue==-1&&(we++,ue=7)}if((ie+=G)<0||this.moduleCount<=ie){ie-=G,G=-G;break}}}},C.PAD0=236,C.PAD1=17,C.createData=function(Z,J,G){for(var ie=B.getRSBlocks(Z,J),ue=new q,we=0;we<G.length;we++){var Ce=G[we];ue.put(Ce.mode,4),ue.put(Ce.getLength(),Ne.getLengthInBits(Ce.mode,Z)),Ce.write(ue)}for(var me=0,we=0;we<ie.length;we++)me+=ie[we].dataCount;if(ue.getLengthInBits()>8*me)throw new Error("code length overflow. ("+ue.getLengthInBits()+">"+8*me+")");for(ue.getLengthInBits()+4<=8*me&&ue.put(0,4);ue.getLengthInBits()%8!=0;)ue.putBit(!1);for(;!(ue.getLengthInBits()>=8*me||(ue.put(C.PAD0,8),ue.getLengthInBits()>=8*me));)ue.put(C.PAD1,8);return C.createBytes(ue,ie)},C.createBytes=function(Z,J){for(var G=0,ie=0,ue=0,we=new Array(J.length),Ce=new Array(J.length),me=0;me<J.length;me++){var te=J[me].dataCount,Ot=J[me].totalCount-te;ie=Math.max(ie,te),ue=Math.max(ue,Ot),we[me]=new Array(te);for(var rt=0;rt<we[me].length;rt++)we[me][rt]=255&Z.buffer[rt+G];G+=te;var Xt=Ne.getErrorCorrectPolynomial(Ot),Je=new R(we[me],Xt.getLength()-1),vr=Je.mod(Xt);Ce[me]=new Array(Xt.getLength()-1);for(var rt=0;rt<Ce[me].length;rt++){var fr=rt+vr.getLength()-Ce[me].length;Ce[me][rt]=fr>=0?vr.get(fr):0}}for(var ss=0,rt=0;rt<J.length;rt++)ss+=J[rt].totalCount;for(var Rr=new Array(ss),$n=0,rt=0;rt<ie;rt++)for(var me=0;me<J.length;me++)rt<we[me].length&&(Rr[$n++]=we[me][rt]);for(var rt=0;rt<ue;rt++)for(var me=0;me<J.length;me++)rt<Ce[me].length&&(Rr[$n++]=Ce[me][rt]);return Rr};for(var ke={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},ve={L:1,M:0,Q:3,H:2},Pe={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},Ne={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(Z){for(var J=Z<<10;Ne.getBCHDigit(J)-Ne.getBCHDigit(Ne.G15)>=0;)J^=Ne.G15<<Ne.getBCHDigit(J)-Ne.getBCHDigit(Ne.G15);return(Z<<10|J)^Ne.G15_MASK},getBCHTypeNumber:function(Z){for(var J=Z<<12;Ne.getBCHDigit(J)-Ne.getBCHDigit(Ne.G18)>=0;)J^=Ne.G18<<Ne.getBCHDigit(J)-Ne.getBCHDigit(Ne.G18);return Z<<12|J},getBCHDigit:function(Z){for(var J=0;Z!=0;)J++,Z>>>=1;return J},getPatternPosition:function(Z){return Ne.PATTERN_POSITION_TABLE[Z-1]},getMask:function(Z,J,G){switch(Z){case Pe.PATTERN000:return(J+G)%2==0;case Pe.PATTERN001:return J%2==0;case Pe.PATTERN010:return G%3==0;case Pe.PATTERN011:return(J+G)%3==0;case Pe.PATTERN100:return(Math.floor(J/2)+Math.floor(G/3))%2==0;case Pe.PATTERN101:return J*G%2+J*G%3==0;case Pe.PATTERN110:return(J*G%2+J*G%3)%2==0;case Pe.PATTERN111:return(J*G%3+(J+G)%2)%2==0;default:throw new Error("bad maskPattern:"+Z)}},getErrorCorrectPolynomial:function(Z){for(var J=new R([1],0),G=0;G<Z;G++)J=J.multiply(new R([1,Oe.gexp(G)],0));return J},getLengthInBits:function(Z,J){if(1<=J&&J<10)switch(Z){case ke.MODE_NUMBER:return 10;case ke.MODE_ALPHA_NUM:return 9;case ke.MODE_8BIT_BYTE:case ke.MODE_KANJI:return 8;default:throw new Error("mode:"+Z)}else if(J<27)switch(Z){case ke.MODE_NUMBER:return 12;case ke.MODE_ALPHA_NUM:return 11;case ke.MODE_8BIT_BYTE:return 16;case ke.MODE_KANJI:return 10;default:throw new Error("mode:"+Z)}else{if(!(J<41))throw new Error("type:"+J);switch(Z){case ke.MODE_NUMBER:return 14;case ke.MODE_ALPHA_NUM:return 13;case ke.MODE_8BIT_BYTE:return 16;case ke.MODE_KANJI:return 12;default:throw new Error("mode:"+Z)}}},getLostPoint:function(Z){for(var J=Z.getModuleCount(),G=0,ie=0;ie<J;ie++)for(var ue=0;ue<J;ue++){for(var we=0,Ce=Z.isDark(ie,ue),me=-1;me<=1;me++)if(!(ie+me<0||J<=ie+me))for(var te=-1;te<=1;te++)ue+te<0||J<=ue+te||me==0&&te==0||Ce==Z.isDark(ie+me,ue+te)&&we++;we>5&&(G+=3+we-5)}for(var ie=0;ie<J-1;ie++)for(var ue=0;ue<J-1;ue++){var Ot=0;Z.isDark(ie,ue)&&Ot++,Z.isDark(ie+1,ue)&&Ot++,Z.isDark(ie,ue+1)&&Ot++,Z.isDark(ie+1,ue+1)&&Ot++,Ot!=0&&Ot!=4||(G+=3)}for(var ie=0;ie<J;ie++)for(var ue=0;ue<J-6;ue++)Z.isDark(ie,ue)&&!Z.isDark(ie,ue+1)&&Z.isDark(ie,ue+2)&&Z.isDark(ie,ue+3)&&Z.isDark(ie,ue+4)&&!Z.isDark(ie,ue+5)&&Z.isDark(ie,ue+6)&&(G+=40);for(var ue=0;ue<J;ue++)for(var ie=0;ie<J-6;ie++)Z.isDark(ie,ue)&&!Z.isDark(ie+1,ue)&&Z.isDark(ie+2,ue)&&Z.isDark(ie+3,ue)&&Z.isDark(ie+4,ue)&&!Z.isDark(ie+5,ue)&&Z.isDark(ie+6,ue)&&(G+=40);for(var rt=0,ue=0;ue<J;ue++)for(var ie=0;ie<J;ie++)Z.isDark(ie,ue)&&rt++;return G+=Math.abs(100*rt/J/J-50)/5*10}},Oe={glog:function(Z){if(Z<1)throw new Error("glog("+Z+")");return Oe.LOG_TABLE[Z]},gexp:function(Z){for(;Z<0;)Z+=255;for(;Z>=256;)Z-=255;return Oe.EXP_TABLE[Z]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},Be=0;Be<8;Be++)Oe.EXP_TABLE[Be]=1<<Be;for(var Be=8;Be<256;Be++)Oe.EXP_TABLE[Be]=Oe.EXP_TABLE[Be-4]^Oe.EXP_TABLE[Be-5]^Oe.EXP_TABLE[Be-6]^Oe.EXP_TABLE[Be-8];for(var Be=0;Be<255;Be++)Oe.LOG_TABLE[Oe.EXP_TABLE[Be]]=Be;R.prototype={get:function(Z){return this.num[Z]},getLength:function(){return this.num.length},multiply:function(Z){for(var J=new Array(this.getLength()+Z.getLength()-1),G=0;G<this.getLength();G++)for(var ie=0;ie<Z.getLength();ie++)J[G+ie]^=Oe.gexp(Oe.glog(this.get(G))+Oe.glog(Z.get(ie)));return new R(J,0)},mod:function(Z){if(this.getLength()-Z.getLength()<0)return this;for(var J=Oe.glog(this.get(0))-Oe.glog(Z.get(0)),G=new Array(this.getLength()),ie=0;ie<this.getLength();ie++)G[ie]=this.get(ie);for(var ie=0;ie<Z.getLength();ie++)G[ie]^=Oe.gexp(Oe.glog(Z.get(ie))+J);return new R(G,0).mod(Z)}},B.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],B.getRSBlocks=function(Z,J){var G=B.getRsBlockTable(Z,J);if(G==re)throw new Error("bad rs block @ typeNumber:"+Z+"/errorCorrectLevel:"+J);for(var ie=G.length/3,ue=[],we=0;we<ie;we++)for(var Ce=G[3*we+0],me=G[3*we+1],te=G[3*we+2],Ot=0;Ot<Ce;Ot++)ue.push(new B(me,te));return ue},B.getRsBlockTable=function(Z,J){switch(J){case ve.L:return B.RS_BLOCK_TABLE[4*(Z-1)+0];case ve.M:return B.RS_BLOCK_TABLE[4*(Z-1)+1];case ve.Q:return B.RS_BLOCK_TABLE[4*(Z-1)+2];case ve.H:return B.RS_BLOCK_TABLE[4*(Z-1)+3];default:return re}},q.prototype={get:function(Z){var J=Math.floor(Z/8);return(this.buffer[J]>>>7-Z%8&1)==1},put:function(Z,J){for(var G=0;G<J;G++)this.putBit((Z>>>J-G-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(Z){var J=Math.floor(this.length/8);this.buffer.length<=J&&this.buffer.push(0),Z&&(this.buffer[J]|=128>>>this.length%8),this.length++}};var Ve=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],Tt=(function(){return typeof CanvasRenderingContext2D<"u"})()?(function(){function Z(){if(this._htOption.drawer=="svg"){var we=this._oContext.getSerializedSvg(!0);this.dataURL=we,this._el.innerHTML=we}else try{var Ce=this._elCanvas.toDataURL("image/png");this.dataURL=Ce}catch(me){console.error(me)}this._htOption.onRenderingEnd&&(this.dataURL||console.error("Can not get base64 data, please check: 1. Published the page and image to the server 2. The image request support CORS 3. Configured `crossOrigin:'anonymous'` option"),this._htOption.onRenderingEnd(this._htOption,this.dataURL))}function J(we,Ce){var me=this;if(me._fFail=Ce,me._fSuccess=we,me._bSupportDataURI===null){var te=document.createElement("img"),Ot=function(){me._bSupportDataURI=!1,me._fFail&&me._fFail.call(me)},rt=function(){me._bSupportDataURI=!0,me._fSuccess&&me._fSuccess.call(me)};return te.onabort=Ot,te.onerror=Ot,te.onload=rt,void(te.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}me._bSupportDataURI===!0&&me._fSuccess?me._fSuccess.call(me):me._bSupportDataURI===!1&&me._fFail&&me._fFail.call(me)}if(Q._android&&Q._android<=2.1){var G=1/window.devicePixelRatio,ie=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(we,Ce,me,te,Ot,rt,Xt,Je,vr){if("nodeName"in we&&/img/i.test(we.nodeName))for(var fr=arguments.length-1;fr>=1;fr--)arguments[fr]=arguments[fr]*G;else Je===void 0&&(arguments[1]*=G,arguments[2]*=G,arguments[3]*=G,arguments[4]*=G);ie.apply(this,arguments)}}var ue=function(we,Ce){this._bIsPainted=!1,this._android=z(),this._el=we,this._htOption=Ce,this._htOption.drawer=="svg"?(this._oContext={},this._elCanvas={}):(this._elCanvas=document.createElement("canvas"),this._el.appendChild(this._elCanvas),this._oContext=this._elCanvas.getContext("2d")),this._bSupportDataURI=null,this.dataURL=null};return ue.prototype.draw=function(we){function Ce(){te.quietZone>0&&te.quietZoneColor&&(Je.lineWidth=0,Je.fillStyle=te.quietZoneColor,Je.fillRect(0,0,vr._elCanvas.width,te.quietZone),Je.fillRect(0,te.quietZone,te.quietZone,vr._elCanvas.height-2*te.quietZone),Je.fillRect(vr._elCanvas.width-te.quietZone,te.quietZone,te.quietZone,vr._elCanvas.height-2*te.quietZone),Je.fillRect(0,vr._elCanvas.height-te.quietZone,vr._elCanvas.width,te.quietZone))}function me(ss){function Rr(hi){var Mn=Math.round(te.width/3.5),xr=Math.round(te.height/3.5);Mn!==xr&&(Mn=xr),te.logoMaxWidth?Mn=Math.round(te.logoMaxWidth):te.logoWidth&&(Mn=Math.round(te.logoWidth)),te.logoMaxHeight?xr=Math.round(te.logoMaxHeight):te.logoHeight&&(xr=Math.round(te.logoHeight));var eo,to;hi.naturalWidth===void 0?(eo=hi.width,to=hi.height):(eo=hi.naturalWidth,to=hi.naturalHeight),(te.logoMaxWidth||te.logoMaxHeight)&&(te.logoMaxWidth&&eo<=Mn&&(Mn=eo),te.logoMaxHeight&&to<=xr&&(xr=to),eo<=Mn&&to<=xr&&(Mn=eo,xr=to));var ng=(te.width+2*te.quietZone-Mn)/2,rg=(te.height+te.titleHeight+2*te.quietZone-xr)/2,Xw=Math.min(Mn/eo,xr/to),ig=eo*Xw,sg=to*Xw;(te.logoMaxWidth||te.logoMaxHeight)&&(Mn=ig,xr=sg,ng=(te.width+2*te.quietZone-Mn)/2,rg=(te.height+te.titleHeight+2*te.quietZone-xr)/2),te.logoBackgroundTransparent||(Je.fillStyle=te.logoBackgroundColor,Je.fillRect(ng,rg,Mn,xr));var WI=Je.imageSmoothingQuality,KI=Je.imageSmoothingEnabled;Je.imageSmoothingEnabled=!0,Je.imageSmoothingQuality="high",Je.drawImage(hi,ng+(Mn-ig)/2,rg+(xr-sg)/2,ig,sg),Je.imageSmoothingEnabled=KI,Je.imageSmoothingQuality=WI,Ce(),el._bIsPainted=!0,el.makeImage()}te.onRenderingStart&&te.onRenderingStart(te);for(var $n=0;$n<Ot;$n++)for(var Er=0;Er<Ot;Er++){var Qs=Er*rt+te.quietZone,ia=$n*Xt+te.quietZone,dc=ss.isDark($n,Er),Zn=ss.getEye($n,Er),qt=te.dotScale;Je.lineWidth=0;var cn,Yn;Zn?(cn=te[Zn.type]||te[Zn.type.substring(0,2)]||te.colorDark,Yn=te.colorLight):te.backgroundImage?(Yn="rgba(0,0,0,0)",$n==6?te.autoColor?(cn=te.timing_H||te.timing||te.autoColorDark,Yn=te.autoColorLight):cn=te.timing_H||te.timing||te.colorDark:Er==6?te.autoColor?(cn=te.timing_V||te.timing||te.autoColorDark,Yn=te.autoColorLight):cn=te.timing_V||te.timing||te.colorDark:te.autoColor?(cn=te.autoColorDark,Yn=te.autoColorLight):cn=te.colorDark):(cn=$n==6?te.timing_H||te.timing||te.colorDark:Er==6&&(te.timing_V||te.timing)||te.colorDark,Yn=te.colorLight),Je.strokeStyle=dc?cn:Yn,Je.fillStyle=dc?cn:Yn,Zn?(qt=Zn.type=="AO"?te.dotScaleAO:Zn.type=="AI"?te.dotScaleAI:1,te.backgroundImage&&te.autoColor?(cn=(Zn.type=="AO"?te.AI:te.AO)||te.autoColorDark,Yn=te.autoColorLight):cn=(Zn.type=="AO"?te.AI:te.AO)||cn,dc=Zn.isDark,Je.fillRect(Qs+rt*(1-qt)/2,te.titleHeight+ia+Xt*(1-qt)/2,rt*qt,Xt*qt)):$n==6?(qt=te.dotScaleTiming_H,Je.fillRect(Qs+rt*(1-qt)/2,te.titleHeight+ia+Xt*(1-qt)/2,rt*qt,Xt*qt)):Er==6?(qt=te.dotScaleTiming_V,Je.fillRect(Qs+rt*(1-qt)/2,te.titleHeight+ia+Xt*(1-qt)/2,rt*qt,Xt*qt)):(te.backgroundImage,Je.fillRect(Qs+rt*(1-qt)/2,te.titleHeight+ia+Xt*(1-qt)/2,rt*qt,Xt*qt)),te.dotScale==1||Zn||(Je.strokeStyle=te.colorLight)}if(te.title&&(Je.fillStyle=te.titleBackgroundColor,Je.fillRect(te.quietZone,te.quietZone,te.width,te.titleHeight),Je.font=te.titleFont,Je.fillStyle=te.titleColor,Je.textAlign="center",Je.fillText(te.title,this._elCanvas.width/2,+te.quietZone+te.titleTop)),te.subTitle&&(Je.font=te.subTitleFont,Je.fillStyle=te.subTitleColor,Je.fillText(te.subTitle,this._elCanvas.width/2,+te.quietZone+te.subTitleTop)),te.logo){var as=new Image,el=this;as.onload=function(){Rr(as)},as.onerror=function(hi){console.error(hi)},te.crossOrigin!=null&&(as.crossOrigin=te.crossOrigin),as.originalSrc=te.logo,as.src=te.logo}else Ce(),this._bIsPainted=!0,this.makeImage()}var te=this._htOption,Ot=we.getModuleCount(),rt=Math.round(te.width/Ot),Xt=Math.round((te.height-te.titleHeight)/Ot);rt<=1&&(rt=1),Xt<=1&&(Xt=1),te.width=rt*Ot,te.height=Xt*Ot+te.titleHeight,te.quietZone=Math.round(te.quietZone),this._elCanvas.width=te.width+2*te.quietZone,this._elCanvas.height=te.height+2*te.quietZone,this._htOption.drawer!="canvas"&&(this._oContext=new C2S(this._elCanvas.width,this._elCanvas.height)),this.clear();var Je=this._oContext;Je.lineWidth=0,Je.fillStyle=te.colorLight,Je.fillRect(0,0,this._elCanvas.width,this._elCanvas.height),Je.clearRect(te.quietZone,te.quietZone,te.width,te.titleHeight);var vr=this;if(te.backgroundImage){var fr=new Image;fr.onload=function(){Je.globalAlpha=1,Je.globalAlpha=te.backgroundImageAlpha;var ss=Je.imageSmoothingQuality,Rr=Je.imageSmoothingEnabled;Je.imageSmoothingEnabled=!0,Je.imageSmoothingQuality="high",Je.drawImage(fr,0,te.titleHeight,te.width+2*te.quietZone,te.height+2*te.quietZone-te.titleHeight),Je.imageSmoothingEnabled=Rr,Je.imageSmoothingQuality=ss,Je.globalAlpha=1,me.call(vr,we)},te.crossOrigin!=null&&(fr.crossOrigin=te.crossOrigin),fr.originalSrc=te.backgroundImage,fr.src=te.backgroundImage}else me.call(vr,we)},ue.prototype.makeImage=function(){this._bIsPainted&&J.call(this,Z)},ue.prototype.isPainted=function(){return this._bIsPainted},ue.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},ue.prototype.remove=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1,this._el.innerHTML=""},ue.prototype.round=function(we){return we&&Math.floor(1e3*we)/1e3},ue})():(function(){var Z=function(J,G){this._el=J,this._htOption=G};return Z.prototype.draw=function(J){var G=this._htOption,ie=this._el,ue=J.getModuleCount(),we=Math.round(G.width/ue),Ce=Math.round((G.height-G.titleHeight)/ue);we<=1&&(we=1),Ce<=1&&(Ce=1),this._htOption.width=we*ue,this._htOption.height=Ce*ue+G.titleHeight,this._htOption.quietZone=Math.round(this._htOption.quietZone);var me=[],te="",Ot=Math.round(we*G.dotScale),rt=Math.round(Ce*G.dotScale);Ot<4&&(Ot=4,rt=4);var Xt=G.colorDark,Je=G.colorLight;if(G.backgroundImage){G.autoColor?(G.colorDark="rgba(0, 0, 0, .6);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#99000000', EndColorStr='#99000000');",G.colorLight="rgba(255, 255, 255, .7);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#B2FFFFFF', EndColorStr='#B2FFFFFF');"):G.colorLight="rgba(0,0,0,0)";var vr='<div style="display:inline-block; z-index:-10;position:absolute;"><img src="'+G.backgroundImage+'" widht="'+(G.width+2*G.quietZone)+'" height="'+(G.height+2*G.quietZone)+'" style="opacity:'+G.backgroundImageAlpha+";filter:alpha(opacity="+100*G.backgroundImageAlpha+'); "/></div>';me.push(vr)}if(G.quietZone&&(te="display:inline-block; width:"+(G.width+2*G.quietZone)+"px; height:"+(G.width+2*G.quietZone)+"px;background:"+G.quietZoneColor+"; text-align:center;"),me.push('<div style="font-size:0;'+te+'">'),me.push('<table  style="font-size:0;border:0;border-collapse:collapse; margin-top:'+G.quietZone+'px;" border="0" cellspacing="0" cellspadding="0" align="center" valign="middle">'),me.push('<tr height="'+G.titleHeight+'" align="center"><td style="border:0;border-collapse:collapse;margin:0;padding:0" colspan="'+ue+'">'),G.title){var fr=G.titleColor,ss=G.titleFont;me.push('<div style="width:100%;margin-top:'+G.titleTop+"px;color:"+fr+";font:"+ss+";background:"+G.titleBackgroundColor+'">'+G.title+"</div>")}G.subTitle&&me.push('<div style="width:100%;margin-top:'+(G.subTitleTop-G.titleTop)+"px;color:"+G.subTitleColor+"; font:"+G.subTitleFont+'">'+G.subTitle+"</div>"),me.push("</td></tr>");for(var Rr=0;Rr<ue;Rr++){me.push('<tr style="border:0; padding:0; margin:0;" height="7">');for(var $n=0;$n<ue;$n++){var Er=J.isDark(Rr,$n),Qs=J.getEye(Rr,$n);if(Qs){Er=Qs.isDark;var ia=Qs.type,dc=G[ia]||G[ia.substring(0,2)]||Xt;me.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+we+"px;height:"+Ce+'px;"><span style="width:'+we+"px;height:"+Ce+"px;background-color:"+(Er?dc:Je)+';display:inline-block"></span></td>')}else{var Zn=G.colorDark;Rr==6?(Zn=G.timing_H||G.timing||Xt,me.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+we+"px;height:"+Ce+"px;background-color:"+(Er?Zn:Je)+';"></td>')):$n==6?(Zn=G.timing_V||G.timing||Xt,me.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+we+"px;height:"+Ce+"px;background-color:"+(Er?Zn:Je)+';"></td>')):me.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+we+"px;height:"+Ce+'px;"><div style="display:inline-block;width:'+Ot+"px;height:"+rt+"px;background-color:"+(Er?Zn:G.colorLight)+';"></div></td>')}}me.push("</tr>")}if(me.push("</table>"),me.push("</div>"),G.logo){var qt=new Image;G.crossOrigin!=null&&(qt.crossOrigin=G.crossOrigin),qt.src=G.logo;var cn=G.width/3.5,Yn=G.height/3.5;cn!=Yn&&(cn=Yn),G.logoWidth&&(cn=G.logoWidth),G.logoHeight&&(Yn=G.logoHeight);var as="position:relative; z-index:1;display:table-cell;top:-"+((G.height-G.titleHeight)/2+Yn/2+G.quietZone)+"px;text-align:center; width:"+cn+"px; height:"+Yn+"px;line-height:"+cn+"px; vertical-align: middle;";G.logoBackgroundTransparent||(as+="background:"+G.logoBackgroundColor),me.push('<div style="'+as+'"><img  src="'+G.logo+'"  style="max-width: '+cn+"px; max-height: "+Yn+'px;" /> <div style=" display: none; width:1px;margin-left: -1px;"></div></div>')}G.onRenderingStart&&G.onRenderingStart(G),ie.innerHTML=me.join("");var el=ie.childNodes[0],hi=(G.width-el.offsetWidth)/2,Mn=(G.height-el.offsetHeight)/2;hi>0&&Mn>0&&(el.style.margin=Mn+"px "+hi+"px"),this._htOption.onRenderingEnd&&this._htOption.onRenderingEnd(this._htOption,null)},Z.prototype.clear=function(){this._el.innerHTML=""},Z})();ae=function(Z,J){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:ve.H,dotScale:1,dotScaleTiming:1,dotScaleTiming_H:re,dotScaleTiming_V:re,dotScaleA:1,dotScaleAO:re,dotScaleAI:re,quietZone:0,quietZoneColor:"rgba(0,0,0,0)",title:"",titleFont:"normal normal bold 16px Arial",titleColor:"#000000",titleBackgroundColor:"#ffffff",titleHeight:0,titleTop:30,subTitle:"",subTitleFont:"normal normal normal 14px Arial",subTitleColor:"#4F4F4F",subTitleTop:60,logo:re,logoWidth:re,logoHeight:re,logoMaxWidth:re,logoMaxHeight:re,logoBackgroundColor:"#ffffff",logoBackgroundTransparent:!1,PO:re,PI:re,PO_TL:re,PI_TL:re,PO_TR:re,PI_TR:re,PO_BL:re,PI_BL:re,AO:re,AI:re,timing:re,timing_H:re,timing_V:re,backgroundImage:re,backgroundImageAlpha:1,autoColor:!1,autoColorDark:"rgba(0, 0, 0, .6)",autoColorLight:"rgba(255, 255, 255, .7)",onRenderingStart:re,onRenderingEnd:re,version:0,tooltip:!1,binary:!1,drawer:"canvas",crossOrigin:null,utf8WithoutBOM:!0},typeof J=="string"&&(J={text:J}),J)for(var G in J)this._htOption[G]=J[G];this._htOption.title||this._htOption.subTitle||(this._htOption.titleHeight=0),(this._htOption.version<0||this._htOption.version>40)&&(console.warn("QR Code version '"+this._htOption.version+"' is invalidate, reset to 0"),this._htOption.version=0),(this._htOption.dotScale<0||this._htOption.dotScale>1)&&(console.warn(this._htOption.dotScale+" , is invalidate, dotScale must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScale=1),(this._htOption.dotScaleTiming<0||this._htOption.dotScaleTiming>1)&&(console.warn(this._htOption.dotScaleTiming+" , is invalidate, dotScaleTiming must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming=1),this._htOption.dotScaleTiming_H?(this._htOption.dotScaleTiming_H<0||this._htOption.dotScaleTiming_H>1)&&(console.warn(this._htOption.dotScaleTiming_H+" , is invalidate, dotScaleTiming_H must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_H=1):this._htOption.dotScaleTiming_H=this._htOption.dotScaleTiming,this._htOption.dotScaleTiming_V?(this._htOption.dotScaleTiming_V<0||this._htOption.dotScaleTiming_V>1)&&(console.warn(this._htOption.dotScaleTiming_V+" , is invalidate, dotScaleTiming_V must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_V=1):this._htOption.dotScaleTiming_V=this._htOption.dotScaleTiming,(this._htOption.dotScaleA<0||this._htOption.dotScaleA>1)&&(console.warn(this._htOption.dotScaleA+" , is invalidate, dotScaleA must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleA=1),this._htOption.dotScaleAO?(this._htOption.dotScaleAO<0||this._htOption.dotScaleAO>1)&&(console.warn(this._htOption.dotScaleAO+" , is invalidate, dotScaleAO must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAO=1):this._htOption.dotScaleAO=this._htOption.dotScaleA,this._htOption.dotScaleAI?(this._htOption.dotScaleAI<0||this._htOption.dotScaleAI>1)&&(console.warn(this._htOption.dotScaleAI+" , is invalidate, dotScaleAI must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAI=1):this._htOption.dotScaleAI=this._htOption.dotScaleA,(this._htOption.backgroundImageAlpha<0||this._htOption.backgroundImageAlpha>1)&&(console.warn(this._htOption.backgroundImageAlpha+" , is invalidate, backgroundImageAlpha must between 0 and 1, now reset to 1. "),this._htOption.backgroundImageAlpha=1),this._htOption.height=this._htOption.height+this._htOption.titleHeight,typeof Z=="string"&&(Z=document.getElementById(Z)),(!this._htOption.drawer||this._htOption.drawer!="svg"&&this._htOption.drawer!="canvas")&&(this._htOption.drawer="canvas"),this._android=z(),this._el=Z,this._oQRCode=null,this._htOption._element=Z;var ie={};for(var G in this._htOption)ie[G]=this._htOption[G];this._oDrawing=new Tt(this._el,ie),this._htOption.text&&this.makeCode(this._htOption.text)},ae.prototype.makeCode=function(Z){this._oQRCode=new C(ne(Z,this._htOption),this._htOption.correctLevel),this._oQRCode.addData(Z,this._htOption.binary,this._htOption.utf8WithoutBOM),this._oQRCode.make(),this._htOption.tooltip&&(this._el.title=Z),this._oDrawing.draw(this._oQRCode)},ae.prototype.makeImage=function(){typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},ae.prototype.clear=function(){this._oDrawing.remove()},ae.prototype.resize=function(Z,J){this._oDrawing._htOption.width=Z,this._oDrawing._htOption.height=J,this._oDrawing.draw(this._oQRCode)},ae.prototype.noConflict=function(){return Q.QRCode===this&&(Q.QRCode=ge),ae},ae.CorrectLevel=ve,fe?((fe.exports=ae).QRCode=ae,se.QRCode=ae):Q.QRCode=ae}).call(this)});var s=i("58QMB");/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */var o={};const a=BigInt(0),l=BigInt(1),c=BigInt(2),u=BigInt(3),f=BigInt(8),h=Object.freeze({a,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),d=(y,m)=>(y+m/c)/m,p={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(y){const{n:m}=h,v=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),C=-l*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),R=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),B=v,q=BigInt("0x100000000000000000000000000000000"),z=d(B*y,m),ne=d(-C*y,m);let le=de(y-z*v-ne*R,m),re=de(-z*C-ne*B,m);const ae=le>q,j=re>q;if(ae&&(le=m-le),j&&(re=m-re),le>q||re>q)throw new Error("splitScalarEndo: Endomorphism failed, k="+y);return{k1neg:ae,k1:le,k2neg:j,k2:re}}},g=32,b=32,w=32,x=g+1,T=2*g+1;function M(y){const{a:m,b:v}=h,C=de(y*y),R=de(C*y);return de(R+m*y+v)}const O=h.a===a;class _ extends Error{constructor(m){super(m)}}function L(y){if(!(y instanceof A))throw new TypeError("JacobianPoint expected")}class A{constructor(m,v,C){this.x=m,this.y=v,this.z=C}static fromAffine(m){if(!(m instanceof k))throw new TypeError("JacobianPoint#fromAffine: expected Point");return m.equals(k.ZERO)?A.ZERO:new A(m.x,m.y,l)}static toAffineBatch(m){const v=Te(m.map(C=>C.z));return m.map((C,R)=>C.toAffine(v[R]))}static normalizeZ(m){return A.toAffineBatch(m).map(A.fromAffine)}equals(m){L(m);const{x:v,y:C,z:R}=this,{x:B,y:q,z}=m,ne=de(R*R),le=de(z*z),re=de(v*le),ae=de(B*ne),j=de(de(C*z)*le),K=de(de(q*R)*ne);return re===ae&&j===K}negate(){return new A(this.x,de(-this.y),this.z)}double(){const{x:m,y:v,z:C}=this,R=de(m*m),B=de(v*v),q=de(B*B),z=m+B,ne=de(c*(de(z*z)-R-q)),le=de(u*R),re=de(le*le),ae=de(re-c*ne),j=de(le*(ne-ae)-f*q),K=de(c*v*C);return new A(ae,j,K)}add(m){L(m);const{x:v,y:C,z:R}=this,{x:B,y:q,z}=m;if(B===a||q===a)return this;if(v===a||C===a)return m;const ne=de(R*R),le=de(z*z),re=de(v*le),ae=de(B*ne),j=de(de(C*z)*le),K=de(de(q*R)*ne),Q=de(ae-re),se=de(K-j);if(Q===a)return se===a?this.double():A.ZERO;const fe=de(Q*Q),ge=de(Q*fe),ke=de(re*fe),ve=de(se*se-ge-c*ke),Pe=de(se*(ke-ve)-j*ge),Ne=de(R*z*Q);return new A(ve,Pe,Ne)}subtract(m){return this.add(m.negate())}multiplyUnsafe(m){const v=A.ZERO;if(typeof m=="bigint"&&m===a)return v;let C=Re(m);if(C===l)return this;if(!O){let ae=v,j=this;for(;C>a;)C&l&&(ae=ae.add(j)),j=j.double(),C>>=l;return ae}let{k1neg:R,k1:B,k2neg:q,k2:z}=p.splitScalar(C),ne=v,le=v,re=this;for(;B>a||z>a;)B&l&&(ne=ne.add(re)),z&l&&(le=le.add(re)),re=re.double(),B>>=l,z>>=l;return R&&(ne=ne.negate()),q&&(le=le.negate()),le=new A(de(le.x*p.beta),le.y,le.z),ne.add(le)}precomputeWindow(m){const v=O?128/m+1:256/m+1,C=[];let R=this,B=R;for(let q=0;q<v;q++){B=R,C.push(B);for(let z=1;z<2**(m-1);z++)B=B.add(R),C.push(B);R=B.double()}return C}wNAF(m,v){!v&&this.equals(A.BASE)&&(v=k.BASE);const C=v&&v._WINDOW_SIZE||1;if(256%C)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let R=v&&S.get(v);R||(R=this.precomputeWindow(C),v&&C!==1&&(R=A.normalizeZ(R),S.set(v,R)));let B=A.ZERO,q=A.BASE;const z=1+(O?128/C:256/C),ne=2**(C-1),le=BigInt(2**C-1),re=2**C,ae=BigInt(C);for(let j=0;j<z;j++){const K=j*ne;let Q=Number(m&le);m>>=ae,Q>ne&&(Q-=re,m+=l);const se=K,fe=K+Math.abs(Q)-1,ge=j%2!==0,ke=Q<0;Q===0?q=q.add(E(ge,R[se])):B=B.add(E(ke,R[fe]))}return{p:B,f:q}}multiply(m,v){let C=Re(m),R,B;if(O){const{k1neg:q,k1:z,k2neg:ne,k2:le}=p.splitScalar(C);let{p:re,f:ae}=this.wNAF(z,v),{p:j,f:K}=this.wNAF(le,v);re=E(q,re),j=E(ne,j),j=new A(de(j.x*p.beta),j.y,j.z),R=re.add(j),B=ae.add(K)}else{const{p:q,f:z}=this.wNAF(C,v);R=q,B=z}return A.normalizeZ([R,B])[0]}toAffine(m){const{x:v,y:C,z:R}=this,B=this.equals(A.ZERO);m==null&&(m=B?f:xe(R));const q=m,z=de(q*q),ne=de(z*q),le=de(v*z),re=de(C*ne),ae=de(R*q);if(B)return k.ZERO;if(ae!==l)throw new Error("invZ was invalid");return new k(le,re)}}A.BASE=new A(h.Gx,h.Gy,l),A.ZERO=new A(a,l,a);function E(y,m){const v=m.negate();return y?v:m}const S=new WeakMap;class k{constructor(m,v){this.x=m,this.y=v}_setWindowSize(m){this._WINDOW_SIZE=m,S.delete(this)}hasEvenY(){return this.y%c===a}static fromCompressedHex(m){const v=m.length===32,C=Y(v?m:m.subarray(1));if(!Ye(C))throw new Error("Point is not on curve");const R=M(C);let B=ce(R);const q=(B&l)===l;v?q&&(B=de(-B)):(m[0]&1)===1!==q&&(B=de(-B));const z=new k(C,B);return z.assertValidity(),z}static fromUncompressedHex(m){const v=Y(m.subarray(1,g+1)),C=Y(m.subarray(g+1,g*2+1)),R=new k(v,C);return R.assertValidity(),R}static fromHex(m){const v=be(m),C=v.length,R=v[0];if(C===g)return this.fromCompressedHex(v);if(C===x&&(R===2||R===3))return this.fromCompressedHex(v);if(C===T&&R===4)return this.fromUncompressedHex(v);throw new Error(`Point.fromHex: received invalid point. Expected 32-${x} compressed bytes or ${T} uncompressed bytes, not ${C}`)}static fromPrivateKey(m){return k.BASE.multiply(Ue(m))}static fromSignature(m,v,C){const{r:R,s:B}=Mt(v);if(![0,1,2,3].includes(C))throw new Error("Cannot recover: invalid recovery bit");const q=et(be(m)),{n:z}=h,ne=C===2||C===3?R+z:R,le=xe(ne,z),re=de(-q*le,z),ae=de(B*le,z),j=C&1?"03":"02",K=k.fromHex(j+W(ne)),Q=k.BASE.multiplyAndAddUnsafe(K,re,ae);if(!Q)throw new Error("Cannot recover signature: point at infinify");return Q.assertValidity(),Q}toRawBytes(m=!1){return oe(this.toHex(m))}toHex(m=!1){const v=W(this.x);return m?`${this.hasEvenY()?"02":"03"}${v}`:`04${v}${W(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const m="Point is not on elliptic curve",{x:v,y:C}=this;if(!Ye(v)||!Ye(C))throw new Error(m);const R=de(C*C),B=M(v);if(de(R-B)!==a)throw new Error(m)}equals(m){return this.x===m.x&&this.y===m.y}negate(){return new k(this.x,de(-this.y))}double(){return A.fromAffine(this).double().toAffine()}add(m){return A.fromAffine(this).add(A.fromAffine(m)).toAffine()}subtract(m){return this.add(m.negate())}multiply(m){return A.fromAffine(this).multiply(m,this).toAffine()}multiplyAndAddUnsafe(m,v,C){const R=A.fromAffine(this),B=v===a||v===l||this!==k.BASE?R.multiplyUnsafe(v):R.multiply(v),q=A.fromAffine(m).multiplyUnsafe(C),z=B.add(q);return z.equals(A.ZERO)?void 0:z.toAffine()}}k.BASE=new k(h.Gx,h.Gy),k.ZERO=new k(a,a);function P(y){return Number.parseInt(y[0],16)>=8?"00"+y:y}function D(y){if(y.length<2||y[0]!==2)throw new Error(`Invalid signature integer tag: ${V(y)}`);const m=y[1],v=y.subarray(2,m+2);if(!m||v.length!==m)throw new Error("Invalid signature integer: wrong length");if(v[0]===0&&v[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:Y(v),left:y.subarray(m+2)}}function H(y){if(y.length<2||y[0]!=48)throw new Error(`Invalid signature tag: ${V(y)}`);if(y[1]!==y.length-2)throw new Error("Invalid signature: incorrect length");const{data:m,left:v}=D(y.subarray(2)),{data:C,left:R}=D(v);if(R.length)throw new Error(`Invalid signature: left bytes after parsing: ${V(R)}`);return{r:m,s:C}}class N{constructor(m,v){this.r=m,this.s=v,this.assertValidity()}static fromCompact(m){const v=m instanceof Uint8Array,C="Signature.fromCompact";if(typeof m!="string"&&!v)throw new TypeError(`${C}: Expected string or Uint8Array`);const R=v?V(m):m;if(R.length!==128)throw new Error(`${C}: Expected 64-byte hex`);return new N(he(R.slice(0,64)),he(R.slice(64,128)))}static fromDER(m){const v=m instanceof Uint8Array;if(typeof m!="string"&&!v)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:C,s:R}=H(v?m:oe(m));return new N(C,R)}static fromHex(m){return this.fromDER(m)}assertValidity(){const{r:m,s:v}=this;if(!_e(m))throw new Error("Invalid Signature: r must be 0 < r < n");if(!_e(v))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const m=h.n>>l;return this.s>m}normalizeS(){return this.hasHighS()?new N(this.r,de(-this.s,h.n)):this}toDERRawBytes(){return oe(this.toDERHex())}toDERHex(){const m=P(X(this.s)),v=P(X(this.r)),C=m.length/2,R=v.length/2,B=X(C),q=X(R);return`30${X(R+C+4)}02${q}${v}02${B}${m}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return oe(this.toCompactHex())}toCompactHex(){return W(this.r)+W(this.s)}}function I(...y){if(!y.every(C=>C instanceof Uint8Array))throw new Error("Uint8Array list expected");if(y.length===1)return y[0];const m=y.reduce((C,R)=>C+R.length,0),v=new Uint8Array(m);for(let C=0,R=0;C<y.length;C++){const B=y[C];v.set(B,R),R+=B.length}return v}const $=Array.from({length:256},(y,m)=>m.toString(16).padStart(2,"0"));function V(y){if(!(y instanceof Uint8Array))throw new Error("Expected Uint8Array");let m="";for(let v=0;v<y.length;v++)m+=$[y[v]];return m}const U=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function W(y){if(typeof y!="bigint")throw new Error("Expected bigint");if(!(a<=y&&y<U))throw new Error("Expected number 0 <= n < 2^256");return y.toString(16).padStart(64,"0")}function ee(y){const m=oe(W(y));if(m.length!==32)throw new Error("Error: expected 32 bytes");return m}function X(y){const m=y.toString(16);return m.length&1?`0${m}`:m}function he(y){if(typeof y!="string")throw new TypeError("hexToNumber: expected string, got "+typeof y);return BigInt(`0x${y}`)}function oe(y){if(typeof y!="string")throw new TypeError("hexToBytes: expected string, got "+typeof y);if(y.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+y.length);const m=new Uint8Array(y.length/2);for(let v=0;v<m.length;v++){const C=v*2,R=y.slice(C,C+2),B=Number.parseInt(R,16);if(Number.isNaN(B)||B<0)throw new Error("Invalid byte sequence");m[v]=B}return m}function Y(y){return he(V(y))}function be(y){return y instanceof Uint8Array?Uint8Array.from(y):oe(y)}function Re(y){if(typeof y=="number"&&Number.isSafeInteger(y)&&y>0)return BigInt(y);if(typeof y=="bigint"&&_e(y))return y;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function de(y,m=h.P){const v=y%m;return v>=a?v:m+v}function Me(y,m){const{P:v}=h;let C=y;for(;m-- >a;)C*=C,C%=v;return C}function ce(y){const{P:m}=h,v=BigInt(6),C=BigInt(11),R=BigInt(22),B=BigInt(23),q=BigInt(44),z=BigInt(88),ne=y*y*y%m,le=ne*ne*y%m,re=Me(le,u)*le%m,ae=Me(re,u)*le%m,j=Me(ae,c)*ne%m,K=Me(j,C)*j%m,Q=Me(K,R)*K%m,se=Me(Q,q)*Q%m,fe=Me(se,z)*se%m,ge=Me(fe,q)*Q%m,ke=Me(ge,u)*le%m,ve=Me(ke,B)*K%m,Pe=Me(ve,v)*ne%m,Ne=Me(Pe,c);if(Ne*Ne%m!==y)throw new Error("Cannot find square root");return Ne}function xe(y,m=h.P){if(y===a||m<=a)throw new Error(`invert: expected positive integers, got n=${y} mod=${m}`);let v=de(y,m),C=m,R=a,B=l;for(;v!==a;){const z=C/v,ne=C%v,le=R-B*z;C=v,v=ne,R=B,B=le}if(C!==l)throw new Error("invert: does not exist");return de(R,m)}function Te(y,m=h.P){const v=new Array(y.length),C=y.reduce((B,q,z)=>q===a?B:(v[z]=B,de(B*q,m)),l),R=xe(C,m);return y.reduceRight((B,q,z)=>q===a?B:(v[z]=de(B*v[z],m),de(B*q,m)),R),v}function qe(y){const m=y.length*8-b*8,v=Y(y);return m>0?v>>BigInt(m):v}function et(y,m=!1){const v=qe(y);if(m)return v;const{n:C}=h;return v>=C?v-C:v}let Ze,pe;class Se{constructor(m,v){if(this.hashLen=m,this.qByteLen=v,typeof m!="number"||m<2)throw new Error("hashLen must be a number");if(typeof v!="number"||v<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(m).fill(1),this.k=new Uint8Array(m).fill(0),this.counter=0}hmac(...m){return st.hmacSha256(this.k,...m)}hmacSync(...m){return pe(this.k,...m)}checkSync(){if(typeof pe!="function")throw new _("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(m=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),m),this.v=await this.hmac(this.v),m.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),m),this.v=await this.hmac(this.v))}reseedSync(m=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),m),this.v=this.hmacSync(this.v),m.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),m),this.v=this.hmacSync(this.v))}async generate(){this.incr();let m=0;const v=[];for(;m<this.qByteLen;){this.v=await this.hmac(this.v);const C=this.v.slice();v.push(C),m+=this.v.length}return I(...v)}generateSync(){this.checkSync(),this.incr();let m=0;const v=[];for(;m<this.qByteLen;){this.v=this.hmacSync(this.v);const C=this.v.slice();v.push(C),m+=this.v.length}return I(...v)}}function _e(y){return a<y&&y<h.n}function Ye(y){return a<y&&y<h.P}function gt(y,m,v,C=!0){const{n:R}=h,B=et(y,!0);if(!_e(B))return;const q=xe(B,R),z=k.BASE.multiply(B),ne=de(z.x,R);if(ne===a)return;const le=de(q*de(m+v*ne,R),R);if(le===a)return;let re=new N(ne,le),ae=(z.x===re.r?0:2)|Number(z.y&l);return C&&re.hasHighS()&&(re=re.normalizeS(),ae^=1),{sig:re,recovery:ae}}function Ue(y){let m;if(typeof y=="bigint")m=y;else if(typeof y=="number"&&Number.isSafeInteger(y)&&y>0)m=BigInt(y);else if(typeof y=="string"){if(y.length!==2*b)throw new Error("Expected 32 bytes of private key");m=he(y)}else if(y instanceof Uint8Array){if(y.length!==b)throw new Error("Expected 32 bytes of private key");m=Y(y)}else throw new TypeError("Expected valid private key");if(!_e(m))throw new Error("Expected private key: 0 < key < n");return m}function bt(y){return y instanceof k?(y.assertValidity(),y):k.fromHex(y)}function Mt(y){if(y instanceof N)return y.assertValidity(),y;try{return N.fromDER(y)}catch{return N.fromCompact(y)}}function wt(y,m=!1){return k.fromPrivateKey(y).toRawBytes(m)}function Bt(y){const m=y instanceof Uint8Array,v=typeof y=="string",C=(m||v)&&y.length;return m?C===x||C===T:v?C===x*2||C===T*2:y instanceof k}function Vn(y,m,v=!1){if(Bt(y))throw new TypeError("getSharedSecret: first arg must be private key");if(!Bt(m))throw new TypeError("getSharedSecret: second arg must be public key");const C=bt(m);return C.assertValidity(),C.multiply(Ue(y)).toRawBytes(v)}function li(y){const m=y.length>g?y.slice(0,g):y;return Y(m)}function jt(y){const m=li(y),v=de(m,h.n);return Cn(v<a?m:v)}function Cn(y){return ee(y)}function Yt(y,m,v){if(y==null)throw new Error(`sign: expected valid message hash, not "${y}"`);const C=be(y),R=Ue(m),B=[Cn(R),jt(C)];if(v!=null){v===!0&&(v=st.randomBytes(g));const ne=be(v);if(ne.length!==g)throw new Error(`sign: Expected ${g} bytes of extra data`);B.push(ne)}const q=I(...B),z=li(C);return{seed:q,m:z,d:R}}function Tn(y,m){const{sig:v,recovery:C}=y,{der:R,recovered:B}=Object.assign({canonical:!0,der:!0},m),q=R?v.toDERRawBytes():v.toCompactRawBytes();return B?[q,C]:q}function Wn(y,m,v={}){const{seed:C,m:R,d:B}=Yt(y,m,v.extraEntropy),q=new Se(w,b);q.reseedSync(C);let z;for(;!(z=gt(q.generateSync(),R,B,v.canonical));)q.reseedSync();return Tn(z,v)}const it={strict:!0};function mt(y,m,v,C=it){let R;try{R=Mt(y),m=be(m)}catch{return!1}const{r:B,s:q}=R;if(C.strict&&R.hasHighS())return!1;const z=et(m);let ne;try{ne=bt(v)}catch{return!1}const{n:le}=h,re=xe(q,le),ae=de(z*re,le),j=de(B*re,le),K=k.BASE.multiplyAndAddUnsafe(ne,ae,j);return K?de(K.x,le)===B:!1}function xt(y){return de(Y(y),h.n)}class Lt{constructor(m,v){this.r=m,this.s=v,this.assertValidity()}static fromHex(m){const v=be(m);if(v.length!==64)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${v.length}`);const C=Y(v.subarray(0,32)),R=Y(v.subarray(32,64));return new Lt(C,R)}assertValidity(){const{r:m,s:v}=this;if(!Ye(m)||!_e(v))throw new Error("Invalid signature")}toHex(){return W(this.r)+W(this.s)}toRawBytes(){return oe(this.toHex())}}function ln(y){return k.fromPrivateKey(y).toRawX()}class Jt{constructor(m,v,C=st.randomBytes()){if(m==null)throw new TypeError(`sign: Expected valid message, not "${m}"`);this.m=be(m);const{x:R,scalar:B}=this.getScalar(Ue(v));if(this.px=R,this.d=B,this.rand=be(C),this.rand.length!==32)throw new TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(m){const v=k.fromPrivateKey(m),C=v.hasEvenY()?m:h.n-m;return{point:v,scalar:C,x:v.toRawX()}}initNonce(m,v){return ee(m^Y(v))}finalizeNonce(m){const v=de(Y(m),h.n);if(v===a)throw new Error("sign: Creation of signature failed. k is zero");const{point:C,x:R,scalar:B}=this.getScalar(v);return{R:C,rx:R,k:B}}finalizeSig(m,v,C,R){return new Lt(m.x,de(v+C*R,h.n)).toRawBytes()}error(){throw new Error("sign: Invalid signature produced")}async calc(){const{m,d:v,px:C,rand:R}=this,B=st.taggedHash,q=this.initNonce(v,await B(yn.aux,R)),{R:z,rx:ne,k:le}=this.finalizeNonce(await B(yn.nonce,q,C,m)),re=xt(await B(yn.challenge,ne,C,m)),ae=this.finalizeSig(z,le,re,v);return await Kn(ae,m,C)||this.error(),ae}calcSync(){const{m,d:v,px:C,rand:R}=this,B=st.taggedHashSync,q=this.initNonce(v,B(yn.aux,R)),{R:z,rx:ne,k:le}=this.finalizeNonce(B(yn.nonce,q,C,m)),re=xt(B(yn.challenge,ne,C,m)),ae=this.finalizeSig(z,le,re,v);return ui(ae,m,C)||this.error(),ae}}async function gn(y,m,v){return new Jt(y,m,v).calc()}function In(y,m,v){return new Jt(y,m,v).calcSync()}function ci(y,m,v){const C=y instanceof Lt,R=C?y:Lt.fromHex(y);return C&&R.assertValidity(),{...R,m:be(m),P:bt(v)}}function On(y,m,v,C){const R=k.BASE.multiplyAndAddUnsafe(m,Ue(v),de(-C,h.n));return!(!R||!R.hasEvenY()||R.x!==y)}async function Kn(y,m,v){try{const{r:C,s:R,m:B,P:q}=ci(y,m,v),z=xt(await st.taggedHash(yn.challenge,ee(C),q.toRawX(),B));return On(C,q,R,z)}catch{return!1}}function ui(y,m,v){try{const{r:C,s:R,m:B,P:q}=ci(y,m,v),z=xt(st.taggedHashSync(yn.challenge,ee(C),q.toRawX(),B));return On(C,q,R,z)}catch(C){if(C instanceof _)throw C;return!1}}const Lr={Signature:Lt,getPublicKey:ln,sign:gn,verify:Kn,signSync:In,verifySync:ui};k.BASE._setWindowSize(8);const mn={node:o,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},yn={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},Fr={},st={bytesToHex:V,hexToBytes:oe,concatBytes:I,mod:de,invert:xe,isValidPrivateKey(y){try{return Ue(y),!0}catch{return!1}},_bigintTo32Bytes:ee,_normalizePrivateKey:Ue,hashToPrivateKey:y=>{y=be(y);const m=b+8;if(y.length<m||y.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const v=de(Y(y),h.n-l)+l;return ee(v)},randomBytes:(y=32)=>{if(mn.web)return mn.web.getRandomValues(new Uint8Array(y));if(mn.node){const{randomBytes:m}=mn.node;return Uint8Array.from(m(y))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>st.hashToPrivateKey(st.randomBytes(b+8)),precompute(y=8,m=k.BASE){const v=m===k.BASE?m:new k(m.x,m.y);return v._setWindowSize(y),v.multiply(u),v},sha256:async(...y)=>{if(mn.web){const m=await mn.web.subtle.digest("SHA-256",I(...y));return new Uint8Array(m)}else if(mn.node){const{createHash:m}=mn.node,v=m("sha256");return y.forEach(C=>v.update(C)),Uint8Array.from(v.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(y,...m)=>{if(mn.web){const v=await mn.web.subtle.importKey("raw",y,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),C=I(...m),R=await mn.web.subtle.sign("HMAC",v,C);return new Uint8Array(R)}else if(mn.node){const{createHmac:v}=mn.node,C=v("sha256",y);return m.forEach(R=>C.update(R)),Uint8Array.from(C.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(y,...m)=>{let v=Fr[y];if(v===void 0){const C=await st.sha256(Uint8Array.from(y,R=>R.charCodeAt(0)));v=I(C,C),Fr[y]=v}return st.sha256(v,...m)},taggedHashSync:(y,...m)=>{if(typeof Ze!="function")throw new _("sha256Sync is undefined, you need to set it");let v=Fr[y];if(v===void 0){const C=Ze(Uint8Array.from(y,R=>R.charCodeAt(0)));v=I(C,C),Fr[y]=v}return Ze(v,...m)},_JacobianPoint:A};Object.defineProperties(st,{sha256Sync:{configurable:!1,get(){return Ze},set(y){Ze||(Ze=y)}},hmacSha256Sync:{configurable:!1,get(){return pe},set(y){pe||(pe=y)}}});var yr={};Object.defineProperty(yr,"__esModule",{value:!0}),yr.sha224=yr.sha256=void 0;var Ja={};Object.defineProperty(Ja,"__esModule",{value:!0}),Ja.SHA2=void 0;var At={};Object.defineProperty(At,"__esModule",{value:!0}),At.output=At.exists=At.hash=At.bytes=At.bool=At.number=void 0;function zu(y){if(!Number.isSafeInteger(y)||y<0)throw new Error(`Wrong positive integer: ${y}`)}At.number=zu;function tw(y){if(typeof y!="boolean")throw new Error(`Expected boolean, not ${y}`)}At.bool=tw;function Mp(y,...m){if(!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length>0&&!m.includes(y.length))throw new TypeError(`Expected Uint8Array of length ${m}, not of length=${y.length}`)}At.bytes=Mp;function nw(y){if(typeof y!="function"||typeof y.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");zu(y.outputLen),zu(y.blockLen)}At.hash=nw;function rw(y,m=!0){if(y.destroyed)throw new Error("Hash instance has been destroyed");if(m&&y.finished)throw new Error("Hash#digest() has already been called")}At.exists=rw;function iw(y,m){Mp(y);const v=m.outputLen;if(y.length<v)throw new Error(`digestInto() expects output buffer of length at least ${v}`)}At.output=iw;const s5={number:zu,bool:tw,bytes:Mp,hash:nw,exists:rw,output:iw};At.default=s5;var Le={};/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(Le,"__esModule",{value:!0}),Le.randomBytes=Le.wrapConstructorWithOpts=Le.wrapConstructor=Le.checkOpts=Le.Hash=Le.concatBytes=Le.toBytes=Le.utf8ToBytes=Le.asyncLoop=Le.nextTick=Le.hexToBytes=Le.bytesToHex=Le.isLE=Le.rotr=Le.createView=Le.u32=Le.u8=void 0;var ea={};Object.defineProperty(ea,"__esModule",{value:!0}),ea.crypto=void 0,ea.crypto={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};const o5=y=>new Uint8Array(y.buffer,y.byteOffset,y.byteLength);Le.u8=o5;const a5=y=>new Uint32Array(y.buffer,y.byteOffset,Math.floor(y.byteLength/4));Le.u32=a5;const l5=y=>new DataView(y.buffer,y.byteOffset,y.byteLength);Le.createView=l5;const c5=(y,m)=>y<<32-m|y>>>m;if(Le.rotr=c5,Le.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!Le.isLE)throw new Error("Non little-endian hardware is not supported");const u5=Array.from({length:256},(y,m)=>m.toString(16).padStart(2,"0"));function f5(y){if(!(y instanceof Uint8Array))throw new Error("Uint8Array expected");let m="";for(let v=0;v<y.length;v++)m+=u5[y[v]];return m}Le.bytesToHex=f5;function h5(y){if(typeof y!="string")throw new TypeError("hexToBytes: expected string, got "+typeof y);if(y.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const m=new Uint8Array(y.length/2);for(let v=0;v<m.length;v++){const C=v*2,R=y.slice(C,C+2),B=Number.parseInt(R,16);if(Number.isNaN(B)||B<0)throw new Error("Invalid byte sequence");m[v]=B}return m}Le.hexToBytes=h5;const d5=async()=>{};Le.nextTick=d5;async function p5(y,m,v){let C=Date.now();for(let R=0;R<y;R++){v(R);const B=Date.now()-C;B>=0&&B<m||(await(0,Le.nextTick)(),C+=B)}}Le.asyncLoop=p5;function sw(y){if(typeof y!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof y}`);return new TextEncoder().encode(y)}Le.utf8ToBytes=sw;function Np(y){if(typeof y=="string"&&(y=sw(y)),!(y instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof y})`);return y}Le.toBytes=Np;function g5(...y){if(!y.every(C=>C instanceof Uint8Array))throw new Error("Uint8Array list expected");if(y.length===1)return y[0];const m=y.reduce((C,R)=>C+R.length,0),v=new Uint8Array(m);for(let C=0,R=0;C<y.length;C++){const B=y[C];v.set(B,R),R+=B.length}return v}Le.concatBytes=g5;class m5{clone(){return this._cloneInto()}}Le.Hash=m5;const y5=y=>Object.prototype.toString.call(y)==="[object Object]"&&y.constructor===Object;function b5(y,m){if(m!==void 0&&(typeof m!="object"||!y5(m)))throw new TypeError("Options should be object or undefined");return Object.assign(y,m)}Le.checkOpts=b5;function w5(y){const m=C=>y().update(Np(C)).digest(),v=y();return m.outputLen=v.outputLen,m.blockLen=v.blockLen,m.create=()=>y(),m}Le.wrapConstructor=w5;function v5(y){const m=(C,R)=>y(R).update(Np(C)).digest(),v=y({});return m.outputLen=v.outputLen,m.blockLen=v.blockLen,m.create=C=>y(C),m}Le.wrapConstructorWithOpts=v5;function E5(y=32){if(ea.crypto.web)return ea.crypto.web.getRandomValues(new Uint8Array(y));if(ea.crypto.node)return new Uint8Array(ea.crypto.node.randomBytes(y).buffer);throw new Error("The environment doesn't have randomBytes function")}Le.randomBytes=E5;function x5(y,m,v,C){if(typeof y.setBigUint64=="function")return y.setBigUint64(m,v,C);const R=BigInt(32),B=BigInt(4294967295),q=Number(v>>R&B),z=Number(v&B),ne=C?4:0,le=C?0:4;y.setUint32(m+ne,q,C),y.setUint32(m+le,z,C)}class S5 extends Le.Hash{constructor(m,v,C,R){super(),this.blockLen=m,this.outputLen=v,this.padOffset=C,this.isLE=R,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(m),this.view=(0,Le.createView)(this.buffer)}update(m){At.default.exists(this);const{view:v,buffer:C,blockLen:R}=this;m=(0,Le.toBytes)(m);const B=m.length;for(let q=0;q<B;){const z=Math.min(R-this.pos,B-q);if(z===R){const ne=(0,Le.createView)(m);for(;R<=B-q;q+=R)this.process(ne,q);continue}C.set(m.subarray(q,q+z),this.pos),this.pos+=z,q+=z,this.pos===R&&(this.process(v,0),this.pos=0)}return this.length+=m.length,this.roundClean(),this}digestInto(m){At.default.exists(this),At.default.output(m,this),this.finished=!0;const{buffer:v,view:C,blockLen:R,isLE:B}=this;let{pos:q}=this;v[q++]=128,this.buffer.subarray(q).fill(0),this.padOffset>R-q&&(this.process(C,0),q=0);for(let ae=q;ae<R;ae++)v[ae]=0;x5(C,R-8,BigInt(this.length*8),B),this.process(C,0);const z=(0,Le.createView)(m),ne=this.outputLen;if(ne%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const le=ne/4,re=this.get();if(le>re.length)throw new Error("_sha2: outputLen bigger than state");for(let ae=0;ae<le;ae++)z.setUint32(4*ae,re[ae],B)}digest(){const{buffer:m,outputLen:v}=this;this.digestInto(m);const C=m.slice(0,v);return this.destroy(),C}_cloneInto(m){m||(m=new this.constructor),m.set(...this.get());const{blockLen:v,buffer:C,length:R,finished:B,destroyed:q,pos:z}=this;return m.length=R,m.pos=z,m.finished=B,m.destroyed=q,R%v&&m.buffer.set(C),m}}Ja.SHA2=S5;const A5=(y,m,v)=>y&m^~y&v,k5=(y,m,v)=>y&m^y&v^m&v,_5=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Gs=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Zs=new Uint32Array(64);class ow extends Ja.SHA2{constructor(){super(64,32,8,!1),this.A=Gs[0]|0,this.B=Gs[1]|0,this.C=Gs[2]|0,this.D=Gs[3]|0,this.E=Gs[4]|0,this.F=Gs[5]|0,this.G=Gs[6]|0,this.H=Gs[7]|0}get(){const{A:m,B:v,C,D:R,E:B,F:q,G:z,H:ne}=this;return[m,v,C,R,B,q,z,ne]}set(m,v,C,R,B,q,z,ne){this.A=m|0,this.B=v|0,this.C=C|0,this.D=R|0,this.E=B|0,this.F=q|0,this.G=z|0,this.H=ne|0}process(m,v){for(let ae=0;ae<16;ae++,v+=4)Zs[ae]=m.getUint32(v,!1);for(let ae=16;ae<64;ae++){const j=Zs[ae-15],K=Zs[ae-2],Q=(0,Le.rotr)(j,7)^(0,Le.rotr)(j,18)^j>>>3,se=(0,Le.rotr)(K,17)^(0,Le.rotr)(K,19)^K>>>10;Zs[ae]=se+Zs[ae-7]+Q+Zs[ae-16]|0}let{A:C,B:R,C:B,D:q,E:z,F:ne,G:le,H:re}=this;for(let ae=0;ae<64;ae++){const j=(0,Le.rotr)(z,6)^(0,Le.rotr)(z,11)^(0,Le.rotr)(z,25),K=re+j+A5(z,ne,le)+_5[ae]+Zs[ae]|0,se=((0,Le.rotr)(C,2)^(0,Le.rotr)(C,13)^(0,Le.rotr)(C,22))+k5(C,R,B)|0;re=le,le=ne,ne=z,z=q+K|0,q=B,B=R,R=C,C=K+se|0}C=C+this.A|0,R=R+this.B|0,B=B+this.C|0,q=q+this.D|0,z=z+this.E|0,ne=ne+this.F|0,le=le+this.G|0,re=re+this.H|0,this.set(C,R,B,q,z,ne,le,re)}roundClean(){Zs.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class C5 extends ow{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}yr.sha256=(0,Le.wrapConstructor)(()=>new ow),yr.sha224=(0,Le.wrapConstructor)(()=>new C5);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ta(y){if(!Number.isSafeInteger(y))throw new Error(`Wrong integer: ${y}`)}function fi(...y){const m=(R,B)=>q=>R(B(q)),v=Array.from(y).reverse().reduce((R,B)=>R?m(R,B.encode):B.encode,void 0),C=y.reduce((R,B)=>R?m(R,B.decode):B.decode,void 0);return{encode:v,decode:C}}function Ai(y){return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return m.map(v=>{if(ta(v),v<0||v>=y.length)throw new Error(`Digit index outside alphabet: ${v} (alphabet: ${y.length})`);return y[v]})},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("alphabet.decode input should be array of strings");return m.map(v=>{if(typeof v!="string")throw new Error(`alphabet.decode: not string element=${v}`);const C=y.indexOf(v);if(C===-1)throw new Error(`Unknown letter: "${v}". Allowed: ${y}`);return C})}}}function ki(y=""){if(typeof y!="string")throw new Error("join separator should be string");return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("join.encode input should be array of strings");for(let v of m)if(typeof v!="string")throw new Error(`join.encode: non-string input=${v}`);return m.join(y)},decode:m=>{if(typeof m!="string")throw new Error("join.decode input should be string");return m.split(y)}}}function lc(y,m="="){if(ta(y),typeof m!="string")throw new Error("padding chr should be string");return{encode(v){if(!Array.isArray(v)||v.length&&typeof v[0]!="string")throw new Error("padding.encode input should be array of strings");for(let C of v)if(typeof C!="string")throw new Error(`padding.encode: non-string input=${C}`);for(;v.length*y%8;)v.push(m);return v},decode(v){if(!Array.isArray(v)||v.length&&typeof v[0]!="string")throw new Error("padding.encode input should be array of strings");for(let R of v)if(typeof R!="string")throw new Error(`padding.decode: non-string input=${R}`);let C=v.length;if(C*y%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;C>0&&v[C-1]===m;C--)if(!((C-1)*y%8))throw new Error("Invalid padding: string has too much padding");return v.slice(0,C)}}}function aw(y){if(typeof y!="function")throw new Error("normalize fn should be function");return{encode:m=>m,decode:m=>y(m)}}function lw(y,m,v){if(m<2)throw new Error(`convertRadix: wrong from=${m}, base cannot be less than 2`);if(v<2)throw new Error(`convertRadix: wrong to=${v}, base cannot be less than 2`);if(!Array.isArray(y))throw new Error("convertRadix: data should be array");if(!y.length)return[];let C=0;const R=[],B=Array.from(y);for(B.forEach(q=>{if(ta(q),q<0||q>=m)throw new Error(`Wrong integer: ${q}`)});;){let q=0,z=!0;for(let ne=C;ne<B.length;ne++){const le=B[ne],re=m*q+le;if(!Number.isSafeInteger(re)||m*q/m!==q||re-le!==m*q)throw new Error("convertRadix: carry overflow");if(q=re%v,B[ne]=Math.floor(re/v),!Number.isSafeInteger(B[ne])||B[ne]*v+q!==re)throw new Error("convertRadix: carry overflow");if(z)B[ne]?z=!1:C=ne;else continue}if(R.push(q),z)break}for(let q=0;q<y.length-1&&y[q]===0;q++)R.push(0);return R.reverse()}const cw=(y,m)=>m?cw(m,y%m):y,Fu=(y,m)=>y+(m-cw(y,m));function Lp(y,m,v,C){if(!Array.isArray(y))throw new Error("convertRadix2: data should be array");if(m<=0||m>32)throw new Error(`convertRadix2: wrong from=${m}`);if(v<=0||v>32)throw new Error(`convertRadix2: wrong to=${v}`);if(Fu(m,v)>32)throw new Error(`convertRadix2: carry overflow from=${m} to=${v} carryBits=${Fu(m,v)}`);let R=0,B=0;const q=2**v-1,z=[];for(const ne of y){if(ta(ne),ne>=2**m)throw new Error(`convertRadix2: invalid data word=${ne} from=${m}`);if(R=R<<m|ne,B+m>32)throw new Error(`convertRadix2: carry overflow pos=${B} from=${m}`);for(B+=m;B>=v;B-=v)z.push((R>>B-v&q)>>>0);R&=2**B-1}if(R=R<<v-B&q,!C&&B>=m)throw new Error("Excess padding");if(!C&&R)throw new Error(`Non-zero padding: ${R}`);return C&&B>0&&z.push(R>>>0),z}function uw(y){return ta(y),{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return lw(Array.from(m),256,y)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(lw(m,y,256))}}}function rs(y,m=!1){if(ta(y),y<=0||y>32)throw new Error("radix2: bits should be in (0..32]");if(Fu(8,y)>32||Fu(y,8)>32)throw new Error("radix2: carry overflow");return{encode:v=>{if(!(v instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Lp(Array.from(v),8,y,!m)},decode:v=>{if(!Array.isArray(v)||v.length&&typeof v[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Lp(v,y,8,m))}}}function fw(y){if(typeof y!="function")throw new Error("unsafeWrapper fn should be function");return function(...m){try{return y.apply(null,m)}catch{}}}function hw(y,m){if(ta(y),typeof m!="function")throw new Error("checksum fn should be function");return{encode(v){if(!(v instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const C=m(v).slice(0,y),R=new Uint8Array(v.length+y);return R.set(v),R.set(C,v.length),R},decode(v){if(!(v instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const C=v.slice(0,-y),R=m(C).slice(0,y),B=v.slice(-y);for(let q=0;q<y;q++)if(R[q]!==B[q])throw new Error("Invalid checksum");return C}}}const ju={alphabet:Ai,chain:fi,checksum:hw,radix:uw,radix2:rs,join:ki,padding:lc},T5=fi(rs(4),Ai("0123456789ABCDEF"),ki("")),I5=fi(rs(5),Ai("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),lc(5),ki(""));fi(rs(5),Ai("0123456789ABCDEFGHIJKLMNOPQRSTUV"),lc(5),ki("")),fi(rs(5),Ai("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),ki(""),aw(y=>y.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const cc=fi(rs(6),Ai("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),lc(6),ki("")),O5=fi(rs(6),Ai("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),lc(6),ki("")),Rp=y=>fi(uw(58),Ai(y),ki("")),qu=Rp("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Rp("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Rp("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const dw=[0,2,3,5,6,7,9,10,11],$5={encode(y){let m="";for(let v=0;v<y.length;v+=8){const C=y.subarray(v,v+8);m+=qu.encode(C).padStart(dw[C.length],"1")}return m},decode(y){let m=[];for(let v=0;v<y.length;v+=11){const C=y.slice(v,v+11),R=dw.indexOf(C.length),B=qu.decode(C);for(let q=0;q<B.length-R;q++)if(B[q]!==0)throw new Error("base58xmr: wrong padding");m=m.concat(Array.from(B.slice(B.length-R)))}return Uint8Array.from(m)}},M5=y=>fi(hw(4,m=>y(y(m))),qu),Pp=fi(Ai("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),ki("")),pw=[996825010,642813549,513874426,1027748829,705979059];function uc(y){const m=y>>25;let v=(y&33554431)<<5;for(let C=0;C<pw.length;C++)(m>>C&1)===1&&(v^=pw[C]);return v}function gw(y,m,v=1){const C=y.length;let R=1;for(let B=0;B<C;B++){const q=y.charCodeAt(B);if(q<33||q>126)throw new Error(`Invalid prefix (${y})`);R=uc(R)^q>>5}R=uc(R);for(let B=0;B<C;B++)R=uc(R)^y.charCodeAt(B)&31;for(let B of m)R=uc(R)^B;for(let B=0;B<6;B++)R=uc(R);return R^=v,Pp.encode(Lp([R%2**30],30,5,!1))}function mw(y){const m=y==="bech32"?1:734539939,v=rs(5),C=v.decode,R=v.encode,B=fw(C);function q(re,ae,j=90){if(typeof re!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof re}`);if(!Array.isArray(ae)||ae.length&&typeof ae[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof ae}`);const K=re.length+7+ae.length;if(j!==!1&&K>j)throw new TypeError(`Length ${K} exceeds limit ${j}`);return re=re.toLowerCase(),`${re}1${Pp.encode(ae)}${gw(re,ae,m)}`}function z(re,ae=90){if(typeof re!="string")throw new Error(`bech32.decode input should be string, not ${typeof re}`);if(re.length<8||ae!==!1&&re.length>ae)throw new TypeError(`Wrong string length: ${re.length} (${re}). Expected (8..${ae})`);const j=re.toLowerCase();if(re!==j&&re!==re.toUpperCase())throw new Error("String must be lowercase or uppercase");re=j;const K=re.lastIndexOf("1");if(K===0||K===-1)throw new Error('Letter "1" must be present between prefix and data only');const Q=re.slice(0,K),se=re.slice(K+1);if(se.length<6)throw new Error("Data must be at least 6 characters long");const fe=Pp.decode(se).slice(0,-6),ge=gw(Q,fe,m);if(!se.endsWith(ge))throw new Error(`Invalid checksum in ${re}: expected "${ge}"`);return{prefix:Q,words:fe}}const ne=fw(z);function le(re){const{prefix:ae,words:j}=z(re,!1);return{prefix:ae,words:j,bytes:C(j)}}return{encode:q,decode:z,decodeToBytes:le,decodeUnsafe:ne,fromWords:C,fromWordsUnsafe:B,toWords:R}}const br=mw("bech32");mw("bech32m");const N5={encode:y=>new TextDecoder().decode(y),decode:y=>new TextEncoder().encode(y)},L5=fi(rs(4),Ai("0123456789abcdef"),ki(""),aw(y=>{if(typeof y!="string"||y.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof y} with length ${y.length}`);return y.toLowerCase()}));`${Object.keys({utf8:N5,hex:L5,base16:T5,base32:I5,base64:cc,base64url:O5,base58:qu,base58xmr:$5}).join(", ")}`;var fc={};Object.defineProperty(fc,"__esModule",{value:!0}),fc.wordlist=void 0,fc.wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);var Gn={};Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.mnemonicToSeedSync=Gn.mnemonicToSeed=Gn.validateMnemonic=Gn.entropyToMnemonic=Gn.mnemonicToEntropy=Gn.generateMnemonic=void 0;var na={};Object.defineProperty(na,"__esModule",{value:!0}),na.pbkdf2Async=na.pbkdf2=void 0;var is={};Object.defineProperty(is,"__esModule",{value:!0}),is.hmac=void 0;class yw extends Le.Hash{constructor(m,v){super(),this.finished=!1,this.destroyed=!1,At.default.hash(m);const C=(0,Le.toBytes)(v);if(this.iHash=m.create(),typeof this.iHash.update!="function")throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const R=this.blockLen,B=new Uint8Array(R);B.set(C.length>R?m.create().update(C).digest():C);for(let q=0;q<B.length;q++)B[q]^=54;this.iHash.update(B),this.oHash=m.create();for(let q=0;q<B.length;q++)B[q]^=106;this.oHash.update(B),B.fill(0)}update(m){return At.default.exists(this),this.iHash.update(m),this}digestInto(m){At.default.exists(this),At.default.bytes(m,this.outputLen),this.finished=!0,this.iHash.digestInto(m),this.oHash.update(m),this.oHash.digestInto(m),this.destroy()}digest(){const m=new Uint8Array(this.oHash.outputLen);return this.digestInto(m),m}_cloneInto(m){m||(m=Object.create(Object.getPrototypeOf(this),{}));const{oHash:v,iHash:C,finished:R,destroyed:B,blockLen:q,outputLen:z}=this;return m.finished=R,m.destroyed=B,m.blockLen=q,m.outputLen=z,m.oHash=v._cloneInto(m.oHash),m.iHash=C._cloneInto(m.iHash),m}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const R5=(y,m,v)=>new yw(y,m).update(v).digest();is.hmac=R5,is.hmac.create=(y,m)=>new yw(y,m);function bw(y,m,v,C){At.default.hash(y);const R=(0,Le.checkOpts)({dkLen:32,asyncTick:10},C),{c:B,dkLen:q,asyncTick:z}=R;if(At.default.number(B),At.default.number(q),At.default.number(z),B<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const ne=(0,Le.toBytes)(m),le=(0,Le.toBytes)(v),re=new Uint8Array(q),ae=is.hmac.create(y,ne),j=ae._cloneInto().update(le);return{c:B,dkLen:q,asyncTick:z,DK:re,PRF:ae,PRFSalt:j}}function ww(y,m,v,C,R){return y.destroy(),m.destroy(),C&&C.destroy(),R.fill(0),v}function P5(y,m,v,C){const{c:R,dkLen:B,DK:q,PRF:z,PRFSalt:ne}=bw(y,m,v,C);let le;const re=new Uint8Array(4),ae=(0,Le.createView)(re),j=new Uint8Array(z.outputLen);for(let K=1,Q=0;Q<B;K++,Q+=z.outputLen){const se=q.subarray(Q,Q+z.outputLen);ae.setInt32(0,K,!1),(le=ne._cloneInto(le)).update(re).digestInto(j),se.set(j.subarray(0,se.length));for(let fe=1;fe<R;fe++){z._cloneInto(le).update(j).digestInto(j);for(let ge=0;ge<se.length;ge++)se[ge]^=j[ge]}}return ww(z,ne,q,le,j)}na.pbkdf2=P5;async function D5(y,m,v,C){const{c:R,dkLen:B,asyncTick:q,DK:z,PRF:ne,PRFSalt:le}=bw(y,m,v,C);let re;const ae=new Uint8Array(4),j=(0,Le.createView)(ae),K=new Uint8Array(ne.outputLen);for(let Q=1,se=0;se<B;Q++,se+=ne.outputLen){const fe=z.subarray(se,se+ne.outputLen);j.setInt32(0,Q,!1),(re=le._cloneInto(re)).update(ae).digestInto(K),fe.set(K.subarray(0,fe.length)),await(0,Le.asyncLoop)(R-1,q,ge=>{ne._cloneInto(re).update(K).digestInto(K);for(let ke=0;ke<fe.length;ke++)fe[ke]^=K[ke]})}return ww(ne,le,z,re,K)}na.pbkdf2Async=D5;var ur={};Object.defineProperty(ur,"__esModule",{value:!0}),ur.sha384=ur.sha512_256=ur.sha512_224=ur.sha512=ur.SHA512=void 0;var Xe={};Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.add=Xe.toBig=Xe.split=Xe.fromBig=void 0;const Vu=BigInt(2**32-1),Dp=BigInt(32);function Bp(y,m=!1){return m?{h:Number(y&Vu),l:Number(y>>Dp&Vu)}:{h:Number(y>>Dp&Vu)|0,l:Number(y&Vu)|0}}Xe.fromBig=Bp;function vw(y,m=!1){let v=new Uint32Array(y.length),C=new Uint32Array(y.length);for(let R=0;R<y.length;R++){const{h:B,l:q}=Bp(y[R],m);[v[R],C[R]]=[B,q]}return[v,C]}Xe.split=vw;const B5=(y,m)=>BigInt(y>>>0)<<Dp|BigInt(m>>>0);Xe.toBig=B5;const H5=(y,m,v)=>y>>>v,U5=(y,m,v)=>y<<32-v|m>>>v,z5=(y,m,v)=>y>>>v|m<<32-v,F5=(y,m,v)=>y<<32-v|m>>>v,j5=(y,m,v)=>y<<64-v|m>>>v-32,q5=(y,m,v)=>y>>>v-32|m<<64-v,V5=(y,m)=>m,W5=(y,m)=>y,K5=(y,m,v)=>y<<v|m>>>32-v,G5=(y,m,v)=>m<<v|y>>>32-v,Z5=(y,m,v)=>m<<v-32|y>>>64-v,Y5=(y,m,v)=>y<<v-32|m>>>64-v;function Ew(y,m,v,C){const R=(m>>>0)+(C>>>0);return{h:y+v+(R/2**32|0)|0,l:R|0}}Xe.add=Ew;const J5=(y,m,v)=>(y>>>0)+(m>>>0)+(v>>>0),X5=(y,m,v,C)=>m+v+C+(y/2**32|0)|0,Q5=(y,m,v,C)=>(y>>>0)+(m>>>0)+(v>>>0)+(C>>>0),e8=(y,m,v,C,R)=>m+v+C+R+(y/2**32|0)|0,t8=(y,m,v,C,R)=>(y>>>0)+(m>>>0)+(v>>>0)+(C>>>0)+(R>>>0),n8=(y,m,v,C,R,B)=>m+v+C+R+B+(y/2**32|0)|0,r8={fromBig:Bp,split:vw,toBig:Xe.toBig,shrSH:H5,shrSL:U5,rotrSH:z5,rotrSL:F5,rotrBH:j5,rotrBL:q5,rotr32H:V5,rotr32L:W5,rotlSH:K5,rotlSL:G5,rotlBH:Z5,rotlBL:Y5,add:Ew,add3L:J5,add3H:X5,add4L:Q5,add4H:e8,add5H:n8,add5L:t8};Xe.default=r8;const[i8,s8]=Xe.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(y=>BigInt(y))),Ys=new Uint32Array(80),Js=new Uint32Array(80);class hc extends Ja.SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:m,Al:v,Bh:C,Bl:R,Ch:B,Cl:q,Dh:z,Dl:ne,Eh:le,El:re,Fh:ae,Fl:j,Gh:K,Gl:Q,Hh:se,Hl:fe}=this;return[m,v,C,R,B,q,z,ne,le,re,ae,j,K,Q,se,fe]}set(m,v,C,R,B,q,z,ne,le,re,ae,j,K,Q,se,fe){this.Ah=m|0,this.Al=v|0,this.Bh=C|0,this.Bl=R|0,this.Ch=B|0,this.Cl=q|0,this.Dh=z|0,this.Dl=ne|0,this.Eh=le|0,this.El=re|0,this.Fh=ae|0,this.Fl=j|0,this.Gh=K|0,this.Gl=Q|0,this.Hh=se|0,this.Hl=fe|0}process(m,v){for(let ve=0;ve<16;ve++,v+=4)Ys[ve]=m.getUint32(v),Js[ve]=m.getUint32(v+=4);for(let ve=16;ve<80;ve++){const Pe=Ys[ve-15]|0,Ne=Js[ve-15]|0,Oe=Xe.default.rotrSH(Pe,Ne,1)^Xe.default.rotrSH(Pe,Ne,8)^Xe.default.shrSH(Pe,Ne,7),Be=Xe.default.rotrSL(Pe,Ne,1)^Xe.default.rotrSL(Pe,Ne,8)^Xe.default.shrSL(Pe,Ne,7),Ve=Ys[ve-2]|0,Tt=Js[ve-2]|0,Z=Xe.default.rotrSH(Ve,Tt,19)^Xe.default.rotrBH(Ve,Tt,61)^Xe.default.shrSH(Ve,Tt,6),J=Xe.default.rotrSL(Ve,Tt,19)^Xe.default.rotrBL(Ve,Tt,61)^Xe.default.shrSL(Ve,Tt,6),G=Xe.default.add4L(Be,J,Js[ve-7],Js[ve-16]),ie=Xe.default.add4H(G,Oe,Z,Ys[ve-7],Ys[ve-16]);Ys[ve]=ie|0,Js[ve]=G|0}let{Ah:C,Al:R,Bh:B,Bl:q,Ch:z,Cl:ne,Dh:le,Dl:re,Eh:ae,El:j,Fh:K,Fl:Q,Gh:se,Gl:fe,Hh:ge,Hl:ke}=this;for(let ve=0;ve<80;ve++){const Pe=Xe.default.rotrSH(ae,j,14)^Xe.default.rotrSH(ae,j,18)^Xe.default.rotrBH(ae,j,41),Ne=Xe.default.rotrSL(ae,j,14)^Xe.default.rotrSL(ae,j,18)^Xe.default.rotrBL(ae,j,41),Oe=ae&K^~ae&se,Be=j&Q^~j&fe,Ve=Xe.default.add5L(ke,Ne,Be,s8[ve],Js[ve]),Tt=Xe.default.add5H(Ve,ge,Pe,Oe,i8[ve],Ys[ve]),Z=Ve|0,J=Xe.default.rotrSH(C,R,28)^Xe.default.rotrBH(C,R,34)^Xe.default.rotrBH(C,R,39),G=Xe.default.rotrSL(C,R,28)^Xe.default.rotrBL(C,R,34)^Xe.default.rotrBL(C,R,39),ie=C&B^C&z^B&z,ue=R&q^R&ne^q&ne;ge=se|0,ke=fe|0,se=K|0,fe=Q|0,K=ae|0,Q=j|0,{h:ae,l:j}=Xe.default.add(le|0,re|0,Tt|0,Z|0),le=z|0,re=ne|0,z=B|0,ne=q|0,B=C|0,q=R|0;const we=Xe.default.add3L(Z,G,ue);C=Xe.default.add3H(we,Tt,J,ie),R=we|0}({h:C,l:R}=Xe.default.add(this.Ah|0,this.Al|0,C|0,R|0)),{h:B,l:q}=Xe.default.add(this.Bh|0,this.Bl|0,B|0,q|0),{h:z,l:ne}=Xe.default.add(this.Ch|0,this.Cl|0,z|0,ne|0),{h:le,l:re}=Xe.default.add(this.Dh|0,this.Dl|0,le|0,re|0),{h:ae,l:j}=Xe.default.add(this.Eh|0,this.El|0,ae|0,j|0),{h:K,l:Q}=Xe.default.add(this.Fh|0,this.Fl|0,K|0,Q|0),{h:se,l:fe}=Xe.default.add(this.Gh|0,this.Gl|0,se|0,fe|0),{h:ge,l:ke}=Xe.default.add(this.Hh|0,this.Hl|0,ge|0,ke|0),this.set(C,R,B,q,z,ne,le,re,ae,j,K,Q,se,fe,ge,ke)}roundClean(){Ys.fill(0),Js.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}ur.SHA512=hc;class o8 extends hc{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class a8 extends hc{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class l8 extends hc{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}ur.sha512=(0,Le.wrapConstructor)(()=>new hc),ur.sha512_224=(0,Le.wrapConstructor)(()=>new o8),ur.sha512_256=(0,Le.wrapConstructor)(()=>new a8),ur.sha384=(0,Le.wrapConstructor)(()=>new l8);const c8=y=>y[0]==="あいこくしん";function xw(y){if(typeof y!="string")throw new TypeError(`Invalid mnemonic type: ${typeof y}`);return y.normalize("NFKD")}function Hp(y){const m=xw(y),v=m.split(" ");if(![12,15,18,21,24].includes(v.length))throw new Error("Invalid mnemonic");return{nfkd:m,words:v}}function Sw(y){At.default.bytes(y,16,20,24,28,32)}function u8(y,m=128){if(At.default.number(m),m%32!==0||m>256)throw new TypeError("Invalid entropy");return _w((0,Le.randomBytes)(m/8),y)}Gn.generateMnemonic=u8;const f8=y=>{const m=8-y.length/4;return new Uint8Array([(0,yr.sha256)(y)[0]>>m<<m])};function Aw(y){if(!Array.isArray(y)||y.length!==2048||typeof y[0]!="string")throw new Error("Worlist: expected array of 2048 strings");return y.forEach(m=>{if(typeof m!="string")throw new Error(`Wordlist: non-string element: ${m}`)}),ju.chain(ju.checksum(1,f8),ju.radix2(11,!0),ju.alphabet(y))}function kw(y,m){const{words:v}=Hp(y),C=Aw(m).decode(v);return Sw(C),C}Gn.mnemonicToEntropy=kw;function _w(y,m){return Sw(y),Aw(m).encode(y).join(c8(m)?"　":" ")}Gn.entropyToMnemonic=_w;function h8(y,m){try{kw(y,m)}catch{return!1}return!0}Gn.validateMnemonic=h8;const Cw=y=>xw(`mnemonic${y}`);function d8(y,m=""){return(0,na.pbkdf2Async)(ur.sha512,Hp(y).nfkd,Cw(m),{c:2048,dkLen:64})}Gn.mnemonicToSeed=d8;function p8(y,m=""){return(0,na.pbkdf2)(ur.sha512,Hp(y).nfkd,Cw(m),{c:2048,dkLen:64})}Gn.mnemonicToSeedSync=p8;var Xa={};Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.ripemd160=Xa.RIPEMD160=void 0;const g8=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Tw=Uint8Array.from({length:16},(y,m)=>m),m8=Tw.map(y=>(9*y+5)%16);let Up=[Tw],zp=[m8];for(let y=0;y<4;y++)for(let m of[Up,zp])m.push(m[y].map(v=>g8[v]));const Iw=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(y=>new Uint8Array(y)),y8=Up.map((y,m)=>y.map(v=>Iw[m][v])),b8=zp.map((y,m)=>y.map(v=>Iw[m][v])),w8=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),v8=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),Wu=(y,m)=>y<<m|y>>>32-m;function Ow(y,m,v,C){return y===0?m^v^C:y===1?m&v|~m&C:y===2?(m|~v)^C:y===3?m&C|v&~C:m^(v|~C)}const Ku=new Uint32Array(16);class $w extends Ja.SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:m,h1:v,h2:C,h3:R,h4:B}=this;return[m,v,C,R,B]}set(m,v,C,R,B){this.h0=m|0,this.h1=v|0,this.h2=C|0,this.h3=R|0,this.h4=B|0}process(m,v){for(let K=0;K<16;K++,v+=4)Ku[K]=m.getUint32(v,!0);let C=this.h0|0,R=C,B=this.h1|0,q=B,z=this.h2|0,ne=z,le=this.h3|0,re=le,ae=this.h4|0,j=ae;for(let K=0;K<5;K++){const Q=4-K,se=w8[K],fe=v8[K],ge=Up[K],ke=zp[K],ve=y8[K],Pe=b8[K];for(let Ne=0;Ne<16;Ne++){const Oe=Wu(C+Ow(K,B,z,le)+Ku[ge[Ne]]+se,ve[Ne])+ae|0;C=ae,ae=le,le=Wu(z,10)|0,z=B,B=Oe}for(let Ne=0;Ne<16;Ne++){const Oe=Wu(R+Ow(Q,q,ne,re)+Ku[ke[Ne]]+fe,Pe[Ne])+j|0;R=j,j=re,re=Wu(ne,10)|0,ne=q,q=Oe}}this.set(this.h1+z+re|0,this.h2+le+j|0,this.h3+ae+R|0,this.h4+C+q|0,this.h0+B+ne|0)}roundClean(){Ku.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}Xa.RIPEMD160=$w,Xa.ripemd160=(0,Le.wrapConstructor)(()=>new $w),st.hmacSha256Sync=(y,...m)=>(0,is.hmac)(yr.sha256,y,st.concatBytes(...m));const Fp=M5(yr.sha256);function Mw(y){return BigInt(`0x${(0,Le.bytesToHex)(y)}`)}function E8(y){return(0,Le.hexToBytes)(y.toString(16).padStart(64,"0"))}const x8=(0,Le.utf8ToBytes)("Bitcoin seed"),jp={private:76066276,public:76067358},qp=2147483648,S8=y=>(0,Xa.ripemd160)((0,yr.sha256)(y)),A8=y=>(0,Le.createView)(y).getUint32(0,!1),Gu=y=>{if(!Number.isSafeInteger(y)||y<0||y>2**32-1)throw new Error(`Invalid number=${y}. Should be from 0 to 2 ** 32 - 1`);const m=new Uint8Array(4);return(0,Le.createView)(m).setUint32(0,y,!1),m};class ra{constructor(m){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!m||typeof m!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=m.versions||jp,this.depth=m.depth||0,this.chainCode=m.chainCode,this.index=m.index||0,this.parentFingerprint=m.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(m.publicKey&&m.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(m.privateKey){if(!st.isValidPrivateKey(m.privateKey))throw new Error("Invalid private key");this.privKey=typeof m.privateKey=="bigint"?m.privateKey:Mw(m.privateKey),this.privKeyBytes=E8(this.privKey),this.pubKey=wt(m.privateKey,!0)}else if(m.publicKey)this.pubKey=k.fromHex(m.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=S8(this.pubKey)}get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return A8(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const m=this.privateKey;if(!m)throw new Error("No private key");return Fp.encode(this.serialize(this.versions.private,(0,Le.concatBytes)(new Uint8Array([0]),m)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return Fp.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(m,v=jp){if((0,At.bytes)(m),8*m.length<128||8*m.length>512)throw new Error(`HDKey: wrong seed length=${m.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const C=(0,is.hmac)(ur.sha512,x8,m);return new ra({versions:v,chainCode:C.slice(32),privateKey:C.slice(0,32)})}static fromExtendedKey(m,v=jp){const C=Fp.decode(m),R=(0,Le.createView)(C),B=R.getUint32(0,!1),q={versions:v,depth:C[4],parentFingerprint:R.getUint32(5,!1),index:R.getUint32(9,!1),chainCode:C.slice(13,45)},z=C.slice(45),ne=z[0]===0;if(B!==v[ne?"private":"public"])throw new Error("Version mismatch");return ne?new ra({...q,privateKey:z.slice(1)}):new ra({...q,publicKey:z})}static fromJSON(m){return ra.fromExtendedKey(m.xpriv)}derive(m){if(!/^[mM]'?/.test(m))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(m))return this;const v=m.replace(/^[mM]'?\//,"").split("/");let C=this;for(const R of v){const B=/^(\d+)('?)$/.exec(R);if(!B||B.length!==3)throw new Error(`Invalid child index: ${R}`);let q=+B[1];if(!Number.isSafeInteger(q)||q>=qp)throw new Error("Invalid index");B[2]==="'"&&(q+=qp),C=C.deriveChild(q)}return C}deriveChild(m){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let v=Gu(m);if(m>=qp){const z=this.privateKey;if(!z)throw new Error("Could not derive hardened child key");v=(0,Le.concatBytes)(new Uint8Array([0]),z,v)}else v=(0,Le.concatBytes)(this.pubKey,v);const C=(0,is.hmac)(ur.sha512,this.chainCode,v),R=Mw(C.slice(0,32)),B=C.slice(32);if(!st.isValidPrivateKey(R))throw new Error("Tweak bigger than curve order");const q={versions:this.versions,chainCode:B,depth:this.depth+1,parentFingerprint:this.fingerprint,index:m};try{if(this.privateKey){const z=st.mod(this.privKey+R,h.n);if(!st.isValidPrivateKey(z))throw new Error("The tweak was out of range or the resulted private key is invalid");q.privateKey=z}else{const z=k.fromHex(this.pubKey).add(k.fromPrivateKey(R));if(z.equals(k.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");q.publicKey=z.toRawBytes(!0)}return new ra(q)}catch{return this.deriveChild(m+1)}}sign(m){if(!this.privateKey)throw new Error("No privateKey set!");return(0,At.bytes)(m,32),Wn(m,this.privKey,{canonical:!0,der:!1})}verify(m,v){if((0,At.bytes)(m,32),(0,At.bytes)(v,64),!this.publicKey)throw new Error("No publicKey set!");let C;try{C=N.fromCompact(v)}catch{return!1}return mt(C,m,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(m,v){if(!this.chainCode)throw new Error("No chainCode set");return(0,At.bytes)(v,33),(0,Le.concatBytes)(Gu(m),new Uint8Array([this.depth]),Gu(this.parentFingerprint),Gu(this.index),this.chainCode,v)}}var k8=Object.defineProperty,wr=(y,m)=>{for(var v in m)k8(y,v,{get:m[v],enumerable:!0})};function _8(){return st.bytesToHex(st.randomPrivateKey())}function Nw(y){return st.bytesToHex(Lr.getPublicKey(y))}var C8={};wr(C8,{insertEventIntoAscendingList:()=>I8,insertEventIntoDescendingList:()=>T8,normalizeURL:()=>Vp,utf8Decoder:()=>Xs,utf8Encoder:()=>_i});var Xs=new TextDecoder("utf-8"),_i=new TextEncoder;function Vp(y){let m=new URL(y);return m.pathname=m.pathname.replace(/\/+/g,"/"),m.pathname.endsWith("/")&&(m.pathname=m.pathname.slice(0,-1)),(m.port==="80"&&m.protocol==="ws:"||m.port==="443"&&m.protocol==="wss:")&&(m.port=""),m.searchParams.sort(),m.hash="",m.toString()}function T8(y,m){let v=0,C=y.length-1,R,B=v;if(C<0)B=0;else if(m.created_at<y[C].created_at)B=C+1;else if(m.created_at>=y[v].created_at)B=v;else for(;;){if(C<=v+1){B=C;break}if(R=Math.floor(v+(C-v)/2),y[R].created_at>m.created_at)v=R;else if(y[R].created_at<m.created_at)C=R;else{B=R;break}}return y[B]?.id!==m.id?[...y.slice(0,B),m,...y.slice(B)]:y}function I8(y,m){let v=0,C=y.length-1,R,B=v;if(C<0)B=0;else if(m.created_at>y[C].created_at)B=C+1;else if(m.created_at<=y[v].created_at)B=v;else for(;;){if(C<=v+1){B=C;break}if(R=Math.floor(v+(C-v)/2),y[R].created_at<m.created_at)v=R;else if(y[R].created_at>m.created_at)C=R;else{B=R;break}}return y[B]?.id!==m.id?[...y.slice(0,B),m,...y.slice(B)]:y}function O8(y,m){let v=y;return v.pubkey=Nw(m),v.id=Wp(v),v.sig=N8(v,m),v}function $8(y){if(!Kp(y))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,y.pubkey,y.created_at,y.kind,y.tags,y.content])}function Wp(y){let m=(0,yr.sha256)(_i.encode($8(y)));return st.bytesToHex(m)}var M8=y=>y instanceof Object;function Kp(y){if(!M8(y)||typeof y.kind!="number"||typeof y.content!="string"||typeof y.created_at!="number"||typeof y.pubkey!="string"||!y.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(y.tags))return!1;for(let m=0;m<y.tags.length;m++){let v=y.tags[m];if(!Array.isArray(v))return!1;for(let C=0;C<v.length;C++)if(typeof v[C]=="object")return!1}return!0}function Lw(y){return Lr.verifySync(y.sig,Wp(y),y.pubkey)}function N8(y,m){return st.bytesToHex(Lr.signSync(Wp(y),m))}function L8(y,m){if(y.ids&&y.ids.indexOf(m.id)===-1&&!y.ids.some(v=>m.id.startsWith(v))||y.kinds&&y.kinds.indexOf(m.kind)===-1||y.authors&&y.authors.indexOf(m.pubkey)===-1&&!y.authors.some(v=>m.pubkey.startsWith(v)))return!1;for(let v in y)if(v[0]==="#"){let C=v.slice(1),R=y[`#${C}`];if(R&&!m.tags.find(([B,q])=>B===v.slice(1)&&R.indexOf(q)!==-1))return!1}return!(y.since&&m.created_at<y.since||y.until&&m.created_at>=y.until)}function R8(y,m){for(let v=0;v<y.length;v++)if(L8(y[v],m))return!0;return!1}var P8={};wr(P8,{getHex64:()=>Zu,getInt:()=>Rw,getSubscriptionId:()=>Pw,matchEventId:()=>D8,matchEventKind:()=>H8,matchEventPubkey:()=>B8});function Zu(y,m){let v=m.length+3,C=y.indexOf(`"${m}":`)+v,R=y.slice(C).indexOf('"')+C+1;return y.slice(R,R+64)}function Rw(y,m){let v=m.length,C=y.indexOf(`"${m}":`)+v+3,R=y.slice(C),B=Math.min(R.indexOf(","),R.indexOf("}"));return parseInt(R.slice(0,B),10)}function Pw(y){let m=y.slice(0,22).indexOf('"EVENT"');if(m===-1)return null;let v=y.slice(m+7+1).indexOf('"');if(v===-1)return null;let C=m+7+1+v,R=y.slice(C+1,80).indexOf('"');if(R===-1)return null;let B=C+1+R;return y.slice(C+1,B)}function D8(y,m){return m===Zu(y,"id")}function B8(y,m){return m===Zu(y,"pubkey")}function H8(y,m){return m===Rw(y,"kind")}var Dw=()=>({connect:[],disconnect:[],error:[],notice:[],auth:[]});function U8(y,m={}){let{listTimeout:v=3e3,getTimeout:C=3e3,countTimeout:R=3e3}=m;var B,q={},z=Dw(),ne={},le={},re;async function ae(){return re||(re=new Promise((ge,ke)=>{try{B=new WebSocket(y)}catch(Oe){ke(Oe)}B.onopen=()=>{z.connect.forEach(Oe=>Oe()),ge()},B.onerror=()=>{re=void 0,z.error.forEach(Oe=>Oe()),ke()},B.onclose=async()=>{re=void 0,z.disconnect.forEach(Oe=>Oe())};let ve=[],Pe;B.onmessage=Oe=>{ve.push(Oe.data),Pe||(Pe=setInterval(Ne,0))};function Ne(){if(ve.length===0){clearInterval(Pe),Pe=null;return}var Oe=ve.shift();if(!Oe)return;let Be=Pw(Oe);if(Be){let Ve=q[Be];if(Ve&&Ve.alreadyHaveEvent&&Ve.alreadyHaveEvent(Zu(Oe,"id"),y))return}try{let Ve=JSON.parse(Oe);switch(Ve[0]){case"EVENT":{let G=Ve[1],ie=Ve[2];Kp(ie)&&q[G]&&(q[G].skipVerification||Lw(ie))&&R8(q[G].filters,ie)&&(q[G],(ne[G]?.event||[]).forEach(ue=>ue(ie)));return}case"COUNT":let Tt=Ve[1],Z=Ve[2];q[Tt]&&(ne[Tt]?.count||[]).forEach(G=>G(Z));return;case"EOSE":{let G=Ve[1];G in ne&&(ne[G].eose.forEach(ie=>ie()),ne[G].eose=[]);return}case"OK":{let G=Ve[1],ie=Ve[2],ue=Ve[3]||"";G in le&&(ie?le[G].ok.forEach(we=>we()):le[G].failed.forEach(we=>we(ue)),le[G].ok=[],le[G].failed=[]);return}case"NOTICE":let J=Ve[1];z.notice.forEach(G=>G(J));return;case"AUTH":{let G=Ve[1];z.auth?.forEach(ie=>ie(G));return}}}catch{return}}}),re)}function j(){return B?.readyState===1}async function K(){j()||await ae()}async function Q(ge){let ke=JSON.stringify(ge);if(!(!j()&&(await new Promise(ve=>setTimeout(ve,1e3)),!j())))try{B.send(ke)}catch(ve){console.log(ve)}}const se=(ge,{verb:ke="REQ",skipVerification:ve=!1,alreadyHaveEvent:Pe=null,id:Ne=Math.random().toString().slice(2)}={})=>{let Oe=Ne;return q[Oe]={id:Oe,filters:ge,skipVerification:ve,alreadyHaveEvent:Pe},Q([ke,Oe,...ge]),{sub:(Be,Ve={})=>se(Be||ge,{skipVerification:Ve.skipVerification||ve,alreadyHaveEvent:Ve.alreadyHaveEvent||Pe,id:Oe}),unsub:()=>{delete q[Oe],delete ne[Oe],Q(["CLOSE",Oe])},on:(Be,Ve)=>{ne[Oe]=ne[Oe]||{event:[],count:[],eose:[]},ne[Oe][Be].push(Ve)},off:(Be,Ve)=>{let Tt=ne[Oe],Z=Tt[Be].indexOf(Ve);Z>=0&&Tt[Be].splice(Z,1)}}};function fe(ge,ke){if(!ge.id)throw new Error(`event ${ge} has no id`);let ve=ge.id;return Q([ke,ge]),{on:(Pe,Ne)=>{le[ve]=le[ve]||{ok:[],failed:[]},le[ve][Pe].push(Ne)},off:(Pe,Ne)=>{let Oe=le[ve];if(!Oe)return;let Be=Oe[Pe].indexOf(Ne);Be>=0&&Oe[Pe].splice(Be,1)}}}return{url:y,sub:se,on:(ge,ke)=>{z[ge].push(ke),ge==="connect"&&B?.readyState===1&&ke()},off:(ge,ke)=>{let ve=z[ge].indexOf(ke);ve!==-1&&z[ge].splice(ve,1)},list:(ge,ke)=>new Promise(ve=>{let Pe=se(ge,ke),Ne=[],Oe=setTimeout(()=>{Pe.unsub(),ve(Ne)},v);Pe.on("eose",()=>{Pe.unsub(),clearTimeout(Oe),ve(Ne)}),Pe.on("event",Be=>{Ne.push(Be)})}),get:(ge,ke)=>new Promise(ve=>{let Pe=se([ge],ke),Ne=setTimeout(()=>{Pe.unsub(),ve(null)},C);Pe.on("event",Oe=>{Pe.unsub(),clearTimeout(Ne),ve(Oe)})}),count:ge=>new Promise(ke=>{let ve=se(ge,{...se,verb:"COUNT"}),Pe=setTimeout(()=>{ve.unsub(),ke(null)},R);ve.on("count",Ne=>{ve.unsub(),clearTimeout(Pe),ke(Ne)})}),publish(ge){return fe(ge,"EVENT")},auth(ge){return fe(ge,"AUTH")},connect:K,close(){z=Dw(),ne={},le={},B.readyState===WebSocket.OPEN&&B?.close()},get status(){return B?.readyState??3}}}var Bw=class{_conn;_seenOn={};eoseSubTimeout;getTimeout;constructor(y={}){this._conn={},this.eoseSubTimeout=y.eoseSubTimeout||3400,this.getTimeout=y.getTimeout||3400}close(y){y.forEach(m=>{let v=this._conn[Vp(m)];v&&v.close()})}async ensureRelay(y){const m=Vp(y);this._conn[m]||(this._conn[m]=U8(m,{getTimeout:this.getTimeout*.9,listTimeout:this.getTimeout*.9}));const v=this._conn[m];return await v.connect(),v}sub(y,m,v){let C=new Set,R={...v||{}};R.alreadyHaveEvent=(j,K)=>{if(v?.alreadyHaveEvent?.(j,K))return!0;let Q=this._seenOn[j]||new Set;return Q.add(K),this._seenOn[j]=Q,C.has(j)};let B=[],q=new Set,z=new Set,ne=y.length,le=!1,re=setTimeout(()=>{le=!0;for(let j of z.values())j()},this.eoseSubTimeout);y.forEach(async j=>{let K;try{K=await this.ensureRelay(j)}catch{se();return}if(!K)return;let Q=K.sub(m,R);Q.on("event",fe=>{C.add(fe.id);for(let ge of q.values())ge(fe)}),Q.on("eose",()=>{le||se()}),B.push(Q);function se(){if(ne--,ne===0){clearTimeout(re);for(let fe of z.values())fe()}}});let ae={sub(j,K){return B.forEach(Q=>Q.sub(j,K)),ae},unsub(){B.forEach(j=>j.unsub())},on(j,K){j==="event"?q.add(K):j==="eose"&&z.add(K)},off(j,K){j==="event"?q.delete(K):j==="eose"&&z.delete(K)}};return ae}get(y,m,v){return new Promise(C=>{let R=this.sub(y,[m],v),B=setTimeout(()=>{R.unsub(),C(null)},this.getTimeout);R.on("event",q=>{C(q),clearTimeout(B),R.unsub()})})}list(y,m,v){return new Promise(C=>{let R=[],B=this.sub(y,m,v);B.on("event",q=>{R.push(q)}),B.on("eose",()=>{B.unsub(),C(R)})})}publish(y,m){const v=y.map(async R=>{let B;try{return B=await this.ensureRelay(R),B.publish(m)}catch{return{on(){},off(){}}}}),C=new Map;return{on(R,B){y.forEach(async(q,z)=>{let ne=await v[z],le=()=>B(q);C.set(B,le),ne.on(R,le)})},off(R,B){y.forEach(async(q,z)=>{let ne=C.get(B);ne&&(await v[z]).off(R,ne)})}}}seenOn(y){return Array.from(this._seenOn[y]?.values?.()||[])}},Gp={};wr(Gp,{decode:()=>Yu,naddrEncode:()=>W8,neventEncode:()=>V8,noteEncode:()=>j8,nprofileEncode:()=>q8,npubEncode:()=>F8,nrelayEncode:()=>K8,nsecEncode:()=>z8});var Qa=5e3;function Yu(y){let{prefix:m,words:v}=br.decode(y,Qa),C=new Uint8Array(br.fromWords(v));switch(m){case"nprofile":{let R=Ju(C);if(!R[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(R[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:st.bytesToHex(R[0][0]),relays:R[1]?R[1].map(B=>Xs.decode(B)):[]}}}case"nevent":{let R=Ju(C);if(!R[0]?.[0])throw new Error("missing TLV 0 for nevent");if(R[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(R[2]&&R[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");return{type:"nevent",data:{id:st.bytesToHex(R[0][0]),relays:R[1]?R[1].map(B=>Xs.decode(B)):[],author:R[2]?.[0]?st.bytesToHex(R[2][0]):void 0}}}case"naddr":{let R=Ju(C);if(!R[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!R[2]?.[0])throw new Error("missing TLV 2 for naddr");if(R[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!R[3]?.[0])throw new Error("missing TLV 3 for naddr");if(R[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Xs.decode(R[0][0]),pubkey:st.bytesToHex(R[2][0]),kind:parseInt(st.bytesToHex(R[3][0]),16),relays:R[1]?R[1].map(B=>Xs.decode(B)):[]}}}case"nrelay":{let R=Ju(C);if(!R[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Xs.decode(R[0][0])}}case"nsec":case"npub":case"note":return{type:m,data:st.bytesToHex(C)};default:throw new Error(`unknown prefix ${m}`)}}function Ju(y){let m={},v=y;for(;v.length>0;){let C=v[0],R=v[1],B=v.slice(2,2+R);v=v.slice(2+R),!(B.length<R)&&(m[C]=m[C]||[],m[C].push(B))}return m}function z8(y){return Zp("nsec",y)}function F8(y){return Zp("npub",y)}function j8(y){return Zp("note",y)}function Zp(y,m){let v=st.hexToBytes(m),C=br.toWords(v);return br.encode(y,C,Qa)}function q8(y){let m=Xu({0:[st.hexToBytes(y.pubkey)],1:(y.relays||[]).map(C=>_i.encode(C))}),v=br.toWords(m);return br.encode("nprofile",v,Qa)}function V8(y){let m=Xu({0:[st.hexToBytes(y.id)],1:(y.relays||[]).map(C=>_i.encode(C)),2:y.author?[st.hexToBytes(y.author)]:[]}),v=br.toWords(m);return br.encode("nevent",v,Qa)}function W8(y){let m=new ArrayBuffer(4);new DataView(m).setUint32(0,y.kind,!1);let v=Xu({0:[_i.encode(y.identifier)],1:(y.relays||[]).map(R=>_i.encode(R)),2:[st.hexToBytes(y.pubkey)],3:[new Uint8Array(m)]}),C=br.toWords(v);return br.encode("naddr",C,Qa)}function K8(y){let m=Xu({0:[_i.encode(y)]}),v=br.toWords(m);return br.encode("nrelay",v,Qa)}function Xu(y){let m=[];return Object.entries(y).forEach(([v,C])=>{C.forEach(R=>{let B=new Uint8Array(R.length+2);B.set([parseInt(v)],0),B.set([R.length],1),B.set(R,2),m.push(B)})}),st.concatBytes(...m)}var G8={};wr(G8,{decrypt:()=>Y8,encrypt:()=>Z8});async function Z8(y,m,v){const C=Vn(y,"02"+m),R=Hw(C);let B=Uint8Array.from((0,Le.randomBytes)(16)),q=_i.encode(v),z=await crypto.subtle.importKey("raw",R,{name:"AES-CBC"},!1,["encrypt"]),ne=await crypto.subtle.encrypt({name:"AES-CBC",iv:B},z,q),le=cc.encode(new Uint8Array(ne)),re=cc.encode(new Uint8Array(B.buffer));return`${le}?iv=${re}`}async function Y8(y,m,v){let[C,R]=v.split("?iv="),B=Vn(y,"02"+m),q=Hw(B),z=await crypto.subtle.importKey("raw",q,{name:"AES-CBC"},!1,["decrypt"]),ne=cc.decode(C),le=cc.decode(R),re=await crypto.subtle.decrypt({name:"AES-CBC",iv:le},z,ne);return Xs.decode(re)}function Hw(y){return y.slice(1,33)}var J8={};wr(J8,{queryProfile:()=>eI,searchDomain:()=>Q8,useFetchImplementation:()=>X8});var Qu;try{Qu=fetch}catch{}function X8(y){Qu=y}async function Q8(y,m=""){try{return(await(await Qu(`https://${y}/.well-known/nostr.json?name=${m}`)).json()).names}catch{return{}}}async function eI(y){let[m,v]=y.split("@");if(v||(v=m,m="_"),!m.match(/^[A-Za-z0-9-_.]+$/)||!v.includes("."))return null;let C;try{C=await(await Qu(`https://${v}/.well-known/nostr.json?name=${m}`)).json()}catch{return null}if(!C?.names?.[m])return null;let R=C.names[m],B=C.relays?.[R]||[];return{pubkey:R,relays:B}}var tI={};wr(tI,{generateSeedWords:()=>rI,privateKeyFromSeedWords:()=>nI,validateWords:()=>iI});function nI(y,m){let C=ra.fromMasterSeed((0,Gn.mnemonicToSeedSync)(y,m)).derive("m/44'/1237'/0'/0/0").privateKey;if(!C)throw new Error("could not derive private key");return st.bytesToHex(C)}function rI(){return(0,Gn.generateMnemonic)(fc.wordlist)}function iI(y){return(0,Gn.validateMnemonic)(y,fc.wordlist)}var sI={};wr(sI,{parse:()=>oI});function oI(y){const m={reply:void 0,root:void 0,mentions:[],profiles:[]},v=[];for(const C of y.tags)C[0]==="e"&&C[1]&&v.push(C),C[0]==="p"&&C[1]&&m.profiles.push({pubkey:C[1],relays:C[2]?[C[2]]:[]});for(let C=0;C<v.length;C++){const R=v[C],[B,q,z,ne]=R,le={id:q,relays:z?[z]:[]},re=C===0,ae=C===v.length-1;if(ne==="root"){m.root=le;continue}if(ne==="reply"){m.reply=le;continue}if(ne==="mention"){m.mentions.push(le);continue}if(re){m.root=le;continue}if(ae){m.reply=le;continue}m.mentions.push(le)}return m}var aI={};wr(aI,{getPow:()=>lI});function lI(y){return cI(st.hexToBytes(y))}function cI(y){let m,v,C;for(v=0,m=0;v<y.length&&(C=uI(y[v]),m+=C,C===8);v++);return m}function uI(y){let m=0;if(y===0)return 8;for(;y>>=1;)m++;return 7-m}var fI={};wr(fI,{BECH32_REGEX:()=>Uw,NOSTR_URI_REGEX:()=>ef,parse:()=>dI,test:()=>hI});var Uw=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/,ef=new RegExp(`nostr:(${Uw.source})`);function hI(y){return typeof y=="string"&&new RegExp(`^${ef.source}$`).test(y)}function dI(y){const m=y.match(new RegExp(`^${ef.source}$`));if(!m)throw new Error(`Invalid Nostr URI: ${y}`);return{uri:m[0],value:m[1],decoded:Yu(m[1])}}var pI={};wr(pI,{createDelegation:()=>gI,getDelegator:()=>mI});function gI(y,m){let v=[];(m.kind||-1)>=0&&v.push(`kind=${m.kind}`),m.until&&v.push(`created_at<${m.until}`),m.since&&v.push(`created_at>${m.since}`);let C=v.join("&");if(C==="")throw new Error("refusing to create a delegation without any conditions");let R=(0,yr.sha256)(_i.encode(`nostr:delegation:${m.pubkey}:${C}`)),B=st.bytesToHex(Lr.signSync(R,y));return{from:Nw(y),to:m.pubkey,cond:C,sig:B}}function mI(y){let m=y.tags.find(z=>z[0]==="delegation"&&z.length>=4);if(!m)return null;let v=m[1],C=m[2],R=m[3],B=C.split("&");for(let z=0;z<B.length;z++){let[ne,le,re]=B[z].split(/\b/);if(!(ne==="kind"&&le==="="&&y.kind===parseInt(re))){if(ne==="created_at"&&le==="<"&&y.created_at<parseInt(re))continue;if(ne==="created_at"&&le===">"&&y.created_at>parseInt(re))continue;return null}}let q=(0,yr.sha256)(_i.encode(`nostr:delegation:${y.pubkey}:${C}`));return Lr.verifySync(R,q,v)?v:null}var yI={};wr(yI,{matchAll:()=>bI,regex:()=>Yp,replaceAll:()=>wI});var Yp=()=>new RegExp(`\\b${ef.source}\\b`,"g");function*bI(y){const m=y.matchAll(Yp());for(const v of m){const[C,R]=v;yield{uri:C,value:R,decoded:Yu(R),start:v.index,end:v.index+C.length}}}function wI(y,m){return y.replaceAll(Yp(),(v,C)=>m({uri:v,value:C,decoded:Yu(C)}))}var vI={};wr(vI,{useFetchImplementation:()=>EI,validateGithub:()=>xI});var Jp;try{Jp=fetch}catch{}function EI(y){Jp=y}async function xI(y,m,v){try{return await(await Jp(`https://gist.github.com/${m}/${v}/raw`)).text()===`Verifying that I control the following Nostr public key: ${y}`}catch{return!1}}var SI={};wr(SI,{authenticate:()=>AI});var AI=async({challenge:y,relay:m,sign:v})=>{const C={kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",m.url],["challenge",y]],content:""},R=m.auth(await v(C));return new Promise((B,q)=>{R.on("ok",function z(){R.off("ok",z),B()}),R.on("failed",function z(ne){R.off("failed",z),q(ne)})})},Xp={};wr(Xp,{getZapEndpoint:()=>_I,makeZapReceipt:()=>II,makeZapRequest:()=>CI,useFetchImplementation:()=>kI,validateZapRequest:()=>TI});var Qp;try{Qp=fetch}catch{}function kI(y){Qp=y}async function _I(y){try{let m="",{lud06:v,lud16:C}=JSON.parse(y.content);if(v){let{words:q}=br.decode(v,1e3),z=br.fromWords(q);m=Xs.decode(z)}else if(C){let[q,z]=C.split("@");m=`https://${z}/.well-known/lnurlp/${q}`}else return null;let B=await(await Qp(m)).json();if(B.allowsNostr&&B.nostrPubkey)return B.callback}catch{}return null}function CI({profile:y,event:m,amount:v,relays:C,comment:R=""}){if(!v)throw new Error("amount not given");if(!y)throw new Error("profile not given");let B={kind:9734,created_at:Math.round(Date.now()/1e3),content:R,tags:[["p",y],["amount",v.toString()],["relays",...C]]};return m&&B.tags.push(["e",m]),B}function TI(y){let m;try{m=JSON.parse(y)}catch{return"Invalid zap request JSON."}if(!Kp(m))return"Zap request is not a valid Nostr event.";if(!Lw(m))return"Invalid signature on zap request.";let v=m.tags.find(([B,q])=>B==="p"&&q);if(!v)return"Zap request doesn't have a 'p' tag.";if(!v[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let C=m.tags.find(([B,q])=>B==="e"&&q);return C&&!C[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":m.tags.find(([B,q])=>B==="relays"&&q)?null:"Zap request doesn't have a 'relays' tag."}function II({zapRequest:y,preimage:m,bolt11:v,paidAt:C}){let B=JSON.parse(y).tags.filter(([z])=>z==="e"||z==="p"||z==="a"),q={kind:9735,created_at:Math.round(C.getTime()/1e3),content:"",tags:[...B,["bolt11",v],["description",y]]};return m&&q.tags.push(["preimage",m]),q}st.hmacSha256Sync=(y,...m)=>(0,is.hmac)(yr.sha256,y,st.concatBytes(...m)),st.sha256Sync=(...y)=>(0,yr.sha256)(st.concatBytes(...y));const OI=y=>Gp.decode(y).data,zw=y=>Gp.decode(y).data;let Fw={};const $I=async y=>{if(Fw[y])return Fw[y];const m=new Bw,v=["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine"];try{return await m.get(v,{authors:[y],kinds:[0]})}catch{throw new Error("failed to fetch user profile :(")}finally{m.close(v)}},MI=y=>JSON.parse(y.content),NI=async y=>{const m=await Xp.getZapEndpoint(y);if(!m)throw new Error("failed to retrieve zap endpoint :(");return m},LI=async(y,m)=>{if(jw()&&!m)try{return await window.nostr.signEvent(y)}catch{}return O8(y,_8())},RI=async({profile:y,nip19Target:m,amount:v,relays:C,comment:R,anon:B})=>{const q=Xp.makeZapRequest({profile:y,event:m&&m.startsWith("note")?zw(m):void 0,amount:v,relays:C,comment:R}),z=m&&m.startsWith("naddr")?zw(m):void 0;if(z){const ne=z.relays?z.relays.reduce((le,re)=>`${re},${le}`,""):"";q.tags.push(["a",`${z.kind}:${z.pubkey}:${z.identifier}`,ne])}return(!jw()||B)&&q.tags.push(["anon"]),LI(q,B)},PI=async({zapEndpoint:y,amount:m,comment:v,authorId:C,nip19Target:R,normalizedRelays:B,anon:q})=>{const z=await RI({profile:C,nip19Target:R,amount:m,relays:B,comment:v,anon:q});let ne=`${y}?amount=${m}&nostr=${encodeURIComponent(JSON.stringify(z))}`;v&&(ne=`${ne}&comment=${encodeURIComponent(v)}`);const le=await fetch(ne),{pr:re,reason:ae,status:j}=await le.json();if(re)return re;throw j==="ERROR"?new Error(ae??"Unable to fetch invoice"):new Error("Unable to fetch invoice")},jw=()=>window!==void 0&&window.nostr!==void 0,DI=({relays:y,invoice:m,onSuccess:v})=>{const C=new Bw,R=Array.from(new Set([...y,"wss://relay.nostr.band"])),B=()=>{C&&C.close(R)},q=Math.round(Date.now()/1e3),z=setInterval(()=>{C.sub(R,[{kinds:[9735],since:q}]).on("event",le=>{le.tags.find(re=>re[0]==="bolt11"&&re[1]===m)&&(v(),B(),clearInterval(z))})},5e3);return()=>{B(),clearInterval(z)}},qw="nostrZap.",Vw="lightningUri",Ww=()=>typeof localStorage<"u",BI=y=>{if(Ww())return localStorage.getItem(`${qw}${y}`)},HI=(y,m)=>{Ww()&&localStorage.setItem(`${qw}${y}`,m)},UI=()=>BI(Vw),zI=y=>HI(Vw,y);let eg=null;const FI=y=>{y=y.replace(/^#/,""),y.length===3&&(y=y.split("").map(B=>B+B).join(""));const m=parseInt(y,16),v=m>>16&255,C=m>>8&255,R=m&255;return{r:v,g:C,b:R}},jI=({r:y,g:m,b:v})=>(y*299+m*587+v*114)/1e3,Kw=y=>{const m=FI(y);return jI(m)<128?"#fff":"#000"},tg=y=>{const m=document.createElement("dialog");return m.classList.add("nostr-zap-dialog"),m.innerHTML=y,m.addEventListener("click",function({clientX:v,clientY:C}){const{left:R,right:B,top:q,bottom:z}=m.getBoundingClientRect();v===0&&C===0||(v<R||v>B||C<q||C>z)&&m.close()}),eg.appendChild(m),m},qI=({dialogHeader:y,invoice:m,relays:v,buttonColor:C})=>{const R=UI(),q=tg(`
        <button class="close-button">X</button>
        ${y}
        <div class="qrcode">
          <div class="overlay">copied invoice to clipboard</div>
        </div>
        <p>click QR code to copy invoice</p>
        <select name="lightning-wallet">
          ${[{label:"Default Wallet",value:"lightning:"},{label:"Strike",value:"strike:lightning:"},{label:"Cash App",value:"https://cash.app/launch/lightning/"},{label:"Muun",value:"muun:"},{label:"Blue Wallet",value:"bluewallet:lightning:"},{label:"Wallet of Satoshi",value:"walletofsatoshi:lightning:"},{label:"Zebedee",value:"zebedee:lightning:"},{label:"Zeus LN",value:"zeusln:lightning:"},{label:"Phoenix",value:"phoenix://"},{label:"Breez",value:"breez:"},{label:"Bitcoin Beach",value:"bitcoinbeach://"},{label:"Blixt",value:"blixtwallet:lightning:"},{label:"River",value:"river://"}].map(({label:j,value:K})=>`<option value="${K}" ${R===K?"selected":""}>${j}</option>`).join("")}
        </select>
        <button class="cta-button"
          ${C?`style="background-color: ${C}; color: ${Kw(C)}"`:""} 
        >Open Wallet</button>
      `),z=q.querySelector(".qrcode"),ne=q.querySelector('select[name="lightning-wallet"]'),le=q.querySelector(".cta-button"),re=z.querySelector(".overlay"),ae=DI({relays:v,invoice:m,onSuccess:()=>{q.close()}});return new(e(s))(z,{text:m,quietZone:10}),z.addEventListener("click",function(){navigator.clipboard.writeText(m),re.classList.add("show"),setTimeout(()=>re.classList.remove("show"),2e3)}),le.addEventListener("click",function(){zI(ne.value),window.location.href=`${ne.value}${m}`}),q.addEventListener("close",function(){ae(),q.remove()}),q.querySelector(".close-button").addEventListener("click",function(){q.close()}),q},VI=async({npub:y,nip19Target:m,relays:v,buttonColor:C,anon:R})=>{const B=Be=>`${Be.substring(0,12)}...${Be.substring(Be.length-12)}`,q=v?v.split(","):["wss://relay.nostr.band","wss://relay.damus.io","wss://nos.lol"],z=OI(y),ne=$I(z),le="https://pbs.twimg.com/profile_images/1604195803748306944/LxHDoJ7P_400x400.jpg",re=async()=>{const{picture:Be,display_name:Ve,name:Tt}=MI(await ne);return`
      <h2>${Ve||Tt}</h2>
        <img
          src="${Be||le}"
          width="80"
          height="80"
          alt="nostr user avatar"
        />
      <p>${B(m||y)}</p>
    `},ae=tg(`
      <button class="close-button">X</button>
      <div class="dialog-header-container">
        <h2 class="skeleton-placeholder"></h2>
          <img
            src="${le}"
            width="80"
            height="80"
            alt="placeholder avatar"
          />
        <p class="skeleton-placeholder"></p>
      </div>
      <div class="preset-zap-options-container">
        <button data-value="21">21 ⚡️</button>
        <button data-value="69">69 ⚡️</button>
        <button data-value="420">420 ⚡️</button>
        <button data-value="1337">1337 ⚡️</button>
        <button data-value="5000">5k ⚡️</button>
        <button data-value="10000">10k ⚡️</button>
        <button data-value="21000">21k ⚡️</button>
        <button data-value="1000000">1M ⚡️</button>
      </div>
      <form>
        <input name="amount" type="number" placeholder="amount in sats" required />
        <input name="comment" placeholder="optional comment" />
        <button class="cta-button" 
          ${C?`style="background-color: ${C}; color: ${Kw(C)}"`:""} 
          type="submit" disabled>Zap</button>
      </form>
    `),j=ae.querySelector(".preset-zap-options-container"),K=ae.querySelector("form"),Q=ae.querySelector('input[name="amount"]'),se=ae.querySelector('input[name="comment"]'),fe=ae.querySelector('button[type="submit"]'),ge=ae.querySelector(".dialog-header-container"),ke=Be=>{ae.close(),Gw(Be,y).showModal()};re().then(Be=>{ge.innerHTML=Be,fe.disabled=!1}).catch(ke);const ve=()=>{fe.disabled=!0,fe.innerHTML='<div class="spinner">Loading</div>'},Pe=()=>{fe.disabled=!1,fe.innerHTML="Zap"},Ne=Be=>{Q.value=Be};ae.addEventListener("close",function(){Pe(),K.reset()}),ae.querySelector(".close-button").addEventListener("click",function(){ae.close()}),j.addEventListener("click",function(Be){Be.target.matches("button")&&(Ne(Be.target.getAttribute("data-value")),Q.focus())});const Oe=ne.then(NI);return K.addEventListener("submit",async function(Be){Be.preventDefault(),ve();const Ve=Number(Q.value)*1e3,Tt=se.value;try{const Z=await PI({zapEndpoint:await Oe,amount:Ve,comment:Tt,authorId:z,nip19Target:m,normalizedRelays:q,anon:R}),J=async()=>{const G=qI({dialogHeader:await re(),invoice:Z,relays:q,buttonColor:C}),ie=G.querySelector(".cta-button");ae.close(),G.showModal(),ie.focus()};if(window.webln)try{await window.webln.enable(),await window.webln.sendPayment(Z),ae.close()}catch{J()}else J()}catch(Z){ke(Z)}}),ae},Gw=(y,m)=>{const v=tg(`
    <button class="close-button">X</button>
    <p class="error-message">${y}</p>
    <a href="https://nosta.me/${m}" target="_blank">
      <button class="cta-button">View Nostr Profile</button>
    </a>
  `);return v.addEventListener("close",function(){v.remove()}),v.querySelector(".close-button").addEventListener("click",function(){v.close()}),v},Zw=async({npub:y,noteId:m,naddr:v,relays:C,cachedAmountDialog:R,buttonColor:B,anon:q})=>{let z=R;try{return z||(z=await VI({npub:y,nip19Target:v||m,relays:C,buttonColor:B,anon:q})),z.showModal(),window.matchMedia("(max-height: 932px)").matches||z.querySelector('input[name="amount"]').focus(),z}catch(ne){z&&z.close(),Gw(ne,y).showModal()}},Yw=y=>{let m=null,v=null;y.addEventListener("click",async function(){const C=y.getAttribute("data-npub"),R=y.getAttribute("data-note-id"),B=y.getAttribute("data-naddr"),q=y.getAttribute("data-relays"),z=y.getAttribute("data-button-color"),ne=y.getAttribute("data-anon")==="true";v&&(v.npub!==C||v.noteId!==R||v.naddr!==B||v.relays!==q||v.buttonColor!==z||v.anon!==ne)&&(m=null),v={npub:C,noteId:R,naddr:B,relays:q,buttonColor:z,anon:ne},m=await Zw({npub:C,noteId:R,naddr:B,relays:q,cachedAmountDialog:m,buttonColor:z,anon:ne})})},Jw=y=>{document.querySelectorAll(y||"[data-npub]").forEach(Yw)};return(()=>{const y=document.createElement("style");y.innerHTML=`
      .nostr-zap-dialog {
        width: 424px;
        min-width: 376px;
        margin: auto;
        box-sizing: content-box;
        border: none;
        border-radius: 10px;
        padding: 36px;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        background-color: white;
      }
      .nostr-zap-dialog[open],
      .nostr-zap-dialog form {
        display: block;
        max-width: fit-content;
      }
      .nostr-zap-dialog form {
        padding: 0;
        width: 100%;
      }
      .nostr-zap-dialog img {
        display: inline;
        border-radius: 50%;
      }
      .nostr-zap-dialog h2 {
        font-size: 1.5em;
        font-weight: bold;
        color: black;
      }
      .nostr-zap-dialog p {
        font-size: 1em;
        font-weight: normal;
        color: black;
      }
      .nostr-zap-dialog h2,
      .nostr-zap-dialog p,
      .nostr-zap-dialog .skeleton-placeholder {
        margin: 4px;
        word-wrap: break-word;
      }
      .nostr-zap-dialog button {
        background-color: inherit;
        padding: 12px 0;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid rgb(226, 232, 240);
        width: 100px;
        max-width: 100px;
        max-height: 52px;
        white-space: nowrap;
        color: black;
        box-sizing: border-box;
      }
      .nostr-zap-dialog button:hover {
        background-color: #edf2f7;
      }
      .nostr-zap-dialog button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .nostr-zap-dialog .cta-button {
        background-color: #7f00ff;
        color: #fff;
        width: 100%;
        max-width: 100%;
        margin-top: 16px;
      }
      .nostr-zap-dialog .cta-button:hover {
        background-color: indigo;
      }
      .nostr-zap-dialog .close-button {
        background-color: inherit;
        color: black;
        border-radius: 50%;
        width: 42px;
        height: 42px;
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 12px;
        border: none;
      }
      .nostr-zap-dialog .preset-zap-options-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin: 24px 0 8px 0;
        height: 120px;
      }
      .nostr-zap-dialog input {
        padding: 12px;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        width: 100%;
        max-width: 100%;
        background-color: #f7fafc;
        color: #1a202c;
        box-shadow: none;
        box-sizing: border-box;
        margin-bottom: 16px;
        border: 1px solid lightgray;
      }
      .nostr-zap-dialog .spinner {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .nostr-zap-dialog .spinner:after {
        content: " ";
        display: block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 4px solid #fff;
        border-color: #fff transparent #fff transparent;
        animation: nostr-zap-dialog-spinner 1.2s linear infinite;
        margin-left: 8px;
      }
      .nostr-zap-dialog .error-message {
        text-align: left;
        color: red;
        margin-top: 8px;
      }
      .nostr-zap-dialog .qrcode {
        position: relative;
        display: inline-block;
        margin-top: 24px;
      }
      .nostr-zap-dialog .qrcode .overlay {
        position: absolute;
        color: white;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(127, 17, 224, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }
      .nostr-zap-dialog .qrcode .overlay.show {
        opacity: 1;
      }
      @keyframes nostr-zap-dialog-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes nostr-zap-dialog-skeleton-pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.8;
        }
        100% {
          opacity: 0.6;
        }
      }
      .nostr-zap-dialog .skeleton-placeholder {
        animation-name: nostr-zap-dialog-skeleton-pulse;
        animation-duration: 1.5s;
        animation-iteration-count: infinite;
        animation-timing-function: ease-in-out;
        background-color: #e8e8e8;
        border-radius: 4px;
        margin: 4px auto;
      }
      .nostr-zap-dialog p.skeleton-placeholder {
        height: 20px;
        width: 200px;
      }
      .nostr-zap-dialog h2.skeleton-placeholder {
        height: 28px;
        width: 300px;
      }
      .nostr-zap-dialog select[name="lightning-wallet"] {
        appearance: none;
        background-color: white;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%232D3748" width="24" height="24" viewBox="0 0 24 24"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" /></svg>');
        background-repeat: no-repeat;
        background-position: right 0.7rem center;
        background-size: 16px;
        border: 1px solid #CBD5E0;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: 0.25rem;
        width: 100%;
        margin-top: 24px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        cursor: pointer;
      }
      .nostr-zap-dialog select[name="lightning-wallet"]:focus {
        outline: none;
        border-color: #4FD1C5;
        box-shadow: 0 0 0 2px #4FD1C5;
      }
      @media only screen and (max-width: 480px) {
        .nostr-zap-dialog {
          padding: 18px;
        }

        .nostr-zap-dialog button {
          width: 92px;
          max-width: 92px;
        }
      }
      @media only screen and (max-width: 413px) {
        .nostr-zap-dialog {
          min-width: 324px;
        }
        .nostr-zap-dialog button {
          width: 78px;
          max-width: 78px;
        }
      }
  `;const m=document.createElement("div");document.body.appendChild(m),eg=m.attachShadow({mode:"open"}),eg.appendChild(y)})(),Jw(),window.nostrZap={init:Zw,initTarget:Yw,initTargets:Jw},Ox}rY();var iY=Qe('<div class="rotate-right-icon svg-icon svelte-1x9bm1"></div> <span class="btn-text"> </span>',1),sY=Qe('<div class="setting-section sw-update-section svelte-1x9bm1"><span class="setting-label sw-update-label svelte-1x9bm1"> </span> <div class="setting-control svelte-1x9bm1"><!></div></div>'),oY=Qe('<div class="lang-icon-btn svg-icon svelte-1x9bm1"></div> <span class="btn-text"> </span>',1),aY=Qe("<option> </option>"),lY=Qe("<option> </option>"),cY=Qe('<div class="rotate-right-icon svg-icon svelte-1x9bm1"></div> <span class="btn-text"> </span>',1),uY=(t,e)=>ye(e,!F(e)),fY=Qe('<li class="svelte-1x9bm1"> </li>'),hY=Qe('<ul class="svelte-1x9bm1"></ul>'),dY=Qe('<span style="color: #888;"> </span>'),pY=Qe('<div class="setting-control relay-list svelte-1x9bm1"><!></div>'),gY=Qe('<div class="settings-header svelte-1x9bm1"><div class="site-title svelte-1x9bm1"><a href="https://github.com/Lokuyow/ehagaki" target="_blank" rel="noopener noreferrer" aria-label="GitHub Repository" class="github-link svelte-1x9bm1"><div class="github-icon svg-icon svelte-1x9bm1" aria-label="GitHub"></div></a> <span class="site-name svelte-1x9bm1">eHagaki</span> <span class="cache-version svelte-1x9bm1"> </span></div> <div><div class="zap-view-btn-group svelte-1x9bm1"><button class="zap-btn svelte-1x9bm1" data-npub="npub1a3pvwe2p3v7mnjz6hle63r628wl9w567aw7u23fzqs062v5vqcqqu3sgh3" data-note-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-relays="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">Support</button> <button class="view-btn svelte-1x9bm1" data-title="Thanks for the Support!" data-nzv-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-zap-color-mode="true" data-relay-urls="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">View</button></div></div></div> <div class="modal-body svelte-1x9bm1"><!> <div class="setting-section svelte-1x9bm1"><span class="setting-label svelte-1x9bm1">Language/言語</span> <div class="setting-control svelte-1x9bm1"><!></div></div> <div class="setting-section svelte-1x9bm1"><span class="setting-label svelte-1x9bm1"> </span> <div class="setting-control svelte-1x9bm1"><select id="compression-select" class="svelte-1x9bm1"></select></div></div> <div class="setting-section svelte-1x9bm1"><span class="setting-label svelte-1x9bm1"> </span> <div class="setting-control svelte-1x9bm1"><select id="endpoint-select" class="svelte-1x9bm1"></select></div></div> <div class="setting-section svelte-1x9bm1"><span class="setting-label svelte-1x9bm1"> </span> <div class="setting-control svelte-1x9bm1"><label class="toggle-switch svelte-1x9bm1" for="client-tag-toggle"><input id="client-tag-toggle" type="checkbox" class="svelte-1x9bm1"/> <span class="slider svelte-1x9bm1"></span></label></div></div> <div class="setting-section svelte-1x9bm1"><span class="setting-label svelte-1x9bm1"> </span> <div class="setting-control svelte-1x9bm1"><!></div> <div class="setting-info svelte-1x9bm1"><button type="button" class="relay-toggle-label svelte-1x9bm1" style="cursor:pointer; background:none; border:none; padding:0; font: inherit;"><span class="relay-toggle-icon svelte-1x9bm1" aria-label="toggle"><!></span> </button> <!></div></div></div>',1);function mY(t,e){jn(e,!0);const n=()=>zn(ts,"$_",s),r=()=>zn(wi,"$locale",s),i=()=>zn(Db,"$swNeedRefresh",s),[s,o]=Qi();let a=dt(e,"show",3,!1),l=dt(e,"onRefreshRelaysAndProfile",3,()=>{}),c=dt(e,"selectedCompression",3,"medium"),u=dt(e,"onSelectedCompressionChange",3,void 0),f=dt(e,"selectedEndpoint",3,""),h=dt(e,"onSelectedEndpointChange",3,void 0),d=It(()=>HB(n())),p=He(!0);at(()=>{c()!==void 0&&c()!==""&&ye(g,c())});let g=He(rn(c()));at(()=>{u()&&F(g)!==c()&&u()(F(g))}),at(()=>{f()!==void 0&&f()!==""&&ye(b,f())});let b=He(rn(f()));at(()=>{h()&&F(b)!==f()&&h()(F(b))});let w=He(null);xk.subscribe(E=>ye(w,E,!0));let x=He(!1);function T(){ye(x,!0),XB(),setTimeout(()=>{window.location.reload()},1e3)}let M=He(rn([])),O=He(!1);function _(){const E=gi.value.pubkey;if(!E){ye(M,[],!0);return}const S=`nostr-relays-${E}`;try{const k=JSON.parse(localStorage.getItem(S)??"null");Array.isArray(k)?ye(M,k,!0):k&&typeof k=="object"?ye(M,Object.entries(k).filter(([,P])=>P&&typeof P=="object"&&"write"in P&&P.write).map(([P])=>P),!0):ye(M,[],!0)}catch{ye(M,[],!0)}}Zo(()=>{const E=localStorage.getItem("locale"),S=navigator.language,k=E||(S&&S.startsWith("ja")?"ja":"en"),P=localStorage.getItem("uploadEndpoint");ye(b,f()||(P&&k2.some(H=>H.url===P)?P:T0(k)),!0);const D=localStorage.getItem("clientTagEnabled");ye(p,D===null?!0:D==="true",!0),D===null&&localStorage.setItem("clientTagEnabled","true"),ye(g,c()||localStorage.getItem("imageCompressionLevel")||"medium",!0),_(),QB()}),at(()=>{a()&&_()}),at(()=>{a()&&(async()=>(await Nd(),nY(),window.nostrZap&&window.nostrZap.initTargets()))()}),at(()=>{a()||ye(O,!1)}),at(()=>{r()&&!localStorage.getItem("uploadEndpoint")&&ye(b,T0(r()),!0)}),at(()=>{F(b)&&localStorage.setItem("uploadEndpoint",F(b))}),at(()=>{localStorage.setItem("clientTagEnabled",F(p)?"true":"false")}),at(()=>{F(g)&&localStorage.setItem("imageCompressionLevel",F(g))});function L(){wi.set(r()==="ja"?"en":"ja")}function A(){_()}I0.subscribe(()=>{setTimeout(_,0)});{let E=It(()=>n()("settings")||"設定");bp(t,{get show(){return a()},useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return F(E)},className:"settings-dialog",showFooter:!0,$$events:{"relays-updated":A},children:(S,k)=>{var P=gY(),D=Ct(P),H=Ie(D),N=We(Ie(H),4),I=Ie(N),$=We(D,2),V=Ie($);{var U=it=>{var mt=sY(),xt=Ie(mt),Lt=Ie(xt),ln=We(xt,2),Jt=Ie(ln);{let gn=It(()=>n()("settingsDialog.update_app")||"アプリを更新");dn(Jt,{variant:"primary",shape:"rounded",className:"sw-update-btn",onClick:T,get disabled(){return F(x)},get ariaLabel(){return F(gn)},children:(In,ci)=>{var On=iY(),Kn=Ct(On),ui=We(Kn,2),Lr=Ie(ui);ut((mn,yn)=>{nn(Kn,"aria-label",mn),ot(Lr,yn)},[()=>n()("settingsDialog.refresh")||"更新",()=>F(x)?n()("settingsDialog.updating")||"更新中...":n()("settingsDialog.update_app")||"更新"]),$e(In,On)},$$slots:{default:!0}})}ut(gn=>ot(Lt,gn),[()=>n()("settingsDialog.sw_update_available")||"アプリの更新があります"]),$e(it,mt)};ft(V,it=>{i()&&it(U)})}var W=We(V,2),ee=We(Ie(W),2),X=Ie(ee);dn(X,{variant:"default",shape:"rounded",className:"lang-btn",onClick:L,children:(it,mt)=>{var xt=oY(),Lt=Ct(xt),ln=We(Lt,2),Jt=Ie(ln);ut((gn,In)=>{nn(Lt,"aria-label",gn),ot(Jt,In)},[()=>n()("settingsDialog.change")||"変更",()=>n()("settingsDialog.change")||"変更"]),$e(it,xt)},$$slots:{default:!0}});var he=We(W,2),oe=Ie(he),Y=Ie(oe),be=We(oe,2),Re=Ie(be);Cf(Re,21,()=>F(d),_f,(it,mt)=>{var xt=aY(),Lt=Ie(xt),ln={};ut(()=>{ot(Lt,F(mt).label),ln!==(ln=F(mt).value)&&(xt.value=(xt.__value=F(mt).value)??"")}),$e(it,xt)});var de=We(he,2),Me=Ie(de),ce=Ie(Me),xe=We(Me,2),Te=Ie(xe);Cf(Te,21,()=>k2,_f,(it,mt)=>{var xt=lY(),Lt=Ie(xt),ln={};ut(()=>{ot(Lt,F(mt).label),ln!==(ln=F(mt).url)&&(xt.value=(xt.__value=F(mt).url)??"")}),$e(it,xt)});var qe=We(de,2),et=Ie(qe),Ze=Ie(et),pe=We(et,2),Se=Ie(pe),_e=Ie(Se),Ye=We(qe,2),gt=Ie(Ye),Ue=Ie(gt),bt=We(gt,2),Mt=Ie(bt);{let it=It(()=>n()("settingsDialog.refresh_relays_and_profile")||"再取得");dn(Mt,{variant:"default",shape:"rounded",className:"refresh-relays-profile-btn",onClick:()=>l()&&l()(),get ariaLabel(){return F(it)},children:(mt,xt)=>{var Lt=cY(),ln=Ct(Lt),Jt=We(ln,2),gn=Ie(Jt);ut((In,ci)=>{nn(ln,"aria-label",In),ot(gn,ci)},[()=>n()("settingsDialog.refresh")||"更新",()=>n()("settingsDialog.refresh")||"更新"]),$e(mt,Lt)},$$slots:{default:!0}})}var wt=We(bt,2),Bt=Ie(wt);Bt.__click=[uY,O];var Vn=Ie(Bt),li=Ie(Vn);{var jt=it=>{var mt=Br("▼");$e(it,mt)},Cn=it=>{var mt=Br("▶");$e(it,mt)};ft(li,it=>{F(O)?it(jt):it(Cn,!1)})}var Yt=We(Vn),Tn=We(Bt,2);{var Wn=it=>{var mt=pY(),xt=Ie(mt);{var Lt=Jt=>{var gn=hY();Cf(gn,21,()=>F(M),_f,(In,ci)=>{var On=fY(),Kn=Ie(On);ut(()=>ot(Kn,F(ci))),$e(In,On)}),$e(Jt,gn)},ln=Jt=>{var gn=dY(),In=Ie(gn);ut(ci=>ot(In,ci),[()=>n()("settingsDialog.no_relay_info")||"リレー情報なし"]),$e(Jt,gn)};ft(xt,Jt=>{F(M).length>0?Jt(Lt):Jt(ln,!1)})}$e(it,mt)};ft(Tn,it=>{F(O)&&it(Wn)})}ut((it,mt,xt,Lt,ln,Jt)=>{ot(I,F(w)?`v${F(w)}`:""),ot(Y,it),ot(ce,mt),ot(Ze,xt),ot(Ue,Lt),nn(Bt,"aria-pressed",F(O)),nn(Bt,"aria-label",ln),ot(Yt,` ${Jt??""}`)},[()=>n()("settingsDialog.compression_setting")||"画像圧縮設定",()=>n()("settingsDialog.upload_destination")||"アップロード先",()=>n()("settingsDialog.client_tag_label")||"投稿詳細にクライアント名をつける（Client tag）",()=>n()("settingsDialog.refresh_relays_and_profile")||"リレーリスト・プロフィール再取得",()=>n()("settingsDialog.toggle_write_relays_list")||"投稿先リレーの表示切替",()=>n()("settingsDialog.write_relays_list")||"書き込み先リレーリスト"]),hv(Re,()=>F(g),it=>ye(g,it)),hv(Te,()=>F(b),it=>ye(b,it)),E$(_e,()=>F(p),it=>ye(p,it)),$e(S,P)},$$slots:{default:!0}})}qn(),o()}zs(["click"]);var yY=Qe('<h2 class="svelte-niuyx"> </h2> <p> </p> <div class="dialog-buttons svelte-niuyx"><!> <!></div>',1);function bY(t,e){jn(e,!0);const n=()=>zn(ts,"$_",r),[r,i]=Qi();function s(){e.onLogout?.()}{const o=(l,c)=>{let u=()=>c?.().close;var f=yY(),h=Ct(f),d=Ie(h),p=We(h,2),g=Ie(p),b=We(p,2),w=Ie(b);dn(w,{onClick:s,className:"logout-btn",variant:"danger",shape:"square",children:(T,M)=>{var O=Br();ut(_=>ot(O,_),[()=>n()("logoutDialog.logout")]),$e(T,O)},$$slots:{default:!0}});var x=We(w,2);dn(x,{get onClick(){return u()},className:"cancel-btn",variant:"secondary",shape:"square",children:(T,M)=>{var O=Br();ut(_=>ot(O,_),[()=>n()("logoutDialog.cancel")]),$e(T,O)},$$slots:{default:!0}}),ut((T,M)=>{ot(d,T),ot(g,M)},[()=>n()("logoutDialog.logout_confirmation"),()=>n()("logoutDialog.logout_warning")]),$e(l,f)};let a=It(()=>n()("logoutDialog.logout_confirmation"));bp(t,{get show(){return e.show},useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return F(a)},className:"logout-dialog",children:o,$$slots:{default:!0}})}qn(),i()}var wY=Qe('<span class="loading-spinner svelte-1d084r1" aria-hidden="true"></span>'),vY=Qe('<div class="placeholder-image svelte-1d084r1" aria-hidden="true"></div>'),EY=Qe('<div><!> <!> <span class="placeholder-text loading-text svelte-1d084r1"> </span></div>');function vd(t,e){jn(e,!0);const n=()=>zn(ts,"$_",r),[r,i]=Qi();let s=dt(e,"text",3,""),o=dt(e,"showImage",3,!0),a=dt(e,"showSpinner",3,!1),l=dt(e,"customClass",3,""),c=It(()=>s()||n()("loadingPlaceholder.loading"));var u=EY(),f=Ie(u);{var h=w=>{var x=wY();$e(w,x)};ft(f,w=>{a()&&w(h)})}var d=We(f,2);{var p=w=>{var x=vY();$e(w,x)};ft(d,w=>{o()&&w(p)})}var g=We(d,2),b=Ie(g);ut(()=>{Ka(u,1,`loading-placeholder ${l()??""}`,"svelte-1d084r1"),nn(u,"aria-label",F(c)),ot(b,F(c))}),$e(t,u),qn(),i()}var xY=Qe('<div><span style="word-break:break-all"> </span></div>'),SY=Qe('<div><span style="word-break:break-all"> </span></div>'),AY=Qe('<div class="toast npub-toast svelte-1urfr2e"><!> <!></div>'),kY=Qe('<img src="/ehagaki/icons/nostr-login.svg" alt="nostr-login" class="nostr-login-icon svelte-1urfr2e"/> <span class="btn-text svelte-1urfr2e">Nostr Login</span>',1),_Y=(t,e)=>{t.key==="Enter"&&e()},CY=(t,e)=>{F(e)&&F(e).setCustomValidity("")},TY=Qe('<!> <div class="divider svelte-1urfr2e"><span class="svelte-1urfr2e"> </span></div> <h3 class="svelte-1urfr2e"> </h3> <form class="svelte-1urfr2e"><input type="password" placeholder="nsec1…" class="secret-input svelte-1urfr2e" id="secretKey" name="secretKey" autocomplete="current-password" required minlength="63" maxlength="63"/> <div class="dialog-buttons svelte-1urfr2e"><!> <!></div></form>',1),IY=Qe("<!> <!>",1);function OY(t,e){jn(e,!0);const n=()=>zn(ts,"$_",r),[r,i]=Qi();let s=dt(e,"secretKey",15),o=dt(e,"isLoadingNostrLogin",3,!1);const a=new p4;let l=He(null);at(()=>{s()!==void 0&&(a.setNsec(s()),F(l)&&(s()||F(l).setCustomValidity("")))});let c=He(!1),u=He(""),f=He("");at(()=>{a.isValid.subscribe(M=>ye(c,M,!0))}),at(()=>{a.npub.subscribe(M=>ye(u,M,!0))}),at(()=>{a.nprofile.subscribe(M=>ye(f,M,!0))});function h(){if(F(l)){const M=F(l).validity,O=F(l).value??"";if(M.valueMissing){F(l).setCustomValidity(n()("loginDialog.secret_required")),F(l).reportValidity();return}if(!O.startsWith("nsec1")){F(l).setCustomValidity(n()("loginDialog.secret_must_start_nsec1")),F(l).reportValidity();return}if(O.length!==63){O.length<63?F(l).setCustomValidity(n()("loginDialog.secret_too_short")):F(l).setCustomValidity(n()("loginDialog.secret_too_long")),F(l).reportValidity();return}if(!F(c)){F(l).setCustomValidity(n()("loginDialog.invalid_secret")),F(l).reportValidity();return}F(l).setCustomValidity("")}e.onSave?.()}function d(){s(""),F(l)&&F(l).setCustomValidity("")}function p(){e.onNostrLogin?.()}function g(M){M.preventDefault(),h()}var b=IY(),w=Ct(b);{var x=M=>{var O=AY(),_=Ie(O);{var L=S=>{var k=xY(),P=Ie(k),D=Ie(P);ut(()=>ot(D,F(u))),$e(S,k)};ft(_,S=>{F(u)&&S(L)})}var A=We(_,2);{var E=S=>{var k=SY(),P=Ie(k),D=Ie(P);ut(()=>ot(D,F(f))),$e(S,k)};ft(A,S=>{F(f)&&S(E)})}$e(M,O)};ft(w,M=>{(F(u)||F(f))&&M(x)})}var T=We(w,2);{const M=_=>{var L=TY(),A=Ct(L);{let U=It(()=>o()?"loading":"");dn(A,{variant:"default",shape:"rounded",get className(){return`nostr-login-button ${F(U)??""}`},onClick:p,get disabled(){return o()},children:(W,ee)=>{var X=pn(),he=Ct(X);{var oe=be=>{vd(be,{text:"",showImage:!1,showSpinner:!0,customClass:"nostr-login-placeholder"})},Y=be=>{var Re=kY();$e(be,Re)};ft(he,be=>{o()?be(oe):be(Y,!1)})}$e(W,X)},$$slots:{default:!0}})}var E=We(A,2),S=Ie(E),k=Ie(S),P=We(E,2),D=Ie(P),H=We(P,2),N=Ie(H);N.__keydown=[_Y,h],N.__input=[CY,l],Ki(N,U=>ye(l,U),()=>F(l));var I=We(N,2),$=Ie(I);dn($,{variant:"warning",shape:"square",type:"button",onClick:d,className:"clear-btn",children:(U,W)=>{var ee=Br();ut(X=>ot(ee,X),[()=>n()("loginDialog.clear")]),$e(U,ee)},$$slots:{default:!0}});var V=We($,2);dn(V,{variant:"primary",shape:"square",type:"submit",className:"save-btn",children:(U,W)=>{var ee=Br();ut(X=>ot(ee,X),[()=>n()("loginDialog.save")]),$e(U,ee)},$$slots:{default:!0}}),ut((U,W,ee)=>{ot(k,U),ot(D,W),nn(N,"title",ee)},[()=>n()("loginDialog.or"),()=>n()("loginDialog.input_secret"),()=>n()("loginDialog.hint_input_secret")]),Ts("submit",H,g),v$(N,s),$e(_,L)};let O=It(()=>n()("loginDialog.input_secret"));bp(T,{get show(){return e.show},useHistory:!0,get onClose(){return e.onClose},get ariaLabel(){return F(O)},className:"login-dialog",showFooter:!0,children:M,$$slots:{default:!0}})}$e(t,b),qn(),i()}zs(["keydown","input"]);class $Y{initialized=!1;authHandler=null;isLoggingOut=!1;initPromise=null;async init(e={}){if(!this.initialized)return this.initPromise?this.initPromise:(this.initPromise=this._performInit(e),this.initPromise)}async _performInit(e){try{const{init:n}=await iu(async()=>{const{init:i}=await import("./index.esm-B6zogCv1.js");return{init:i}},[]),r=this._createMergedOptions(e);n({...r,bunkers:this._processBunkers(r.bunkers),startScreen:r.startScreen,onAuth:this._handleAuthCallback.bind(this)}),this.initialized=!0,console.log("nostr-login初期化完了")}catch(n){throw console.error("nostr-login初期化エラー:",n),this.initPromise=null,n}}_createMergedOptions(e){return{theme:"default",noBanner:!0,perms:"get_public_key,sign_event:1,sign_event:27235",startScreen:"welcome",...e}}_processBunkers(e){return Array.isArray(e)?e.join(","):void 0}async _handleAuthCallback(e,n){if(!(!this.authHandler||this.isLoggingOut))try{if(!e){this.authHandler({type:"logout"});return}const r=await this.npubToPubkey(e);if(!r){console.warn("NostrLogin: Failed to get pubkey from npub");return}const i=n?.type||"login";this.authHandler({type:i,pubkey:r,npub:e,otpData:n?.otpData})}catch(r){console.error("NostrLogin auth callback error:",r)}}setAuthHandler(e){this.authHandler=e}async showLogin(e){if(!this._ensureInitialized())throw new Error("nostr-login is not initialized");try{const{launch:n}=await iu(async()=>{const{launch:r}=await import("./index.esm-B6zogCv1.js");return{launch:r}},[]);await n(e||"welcome")}catch(n){throw n}}logout(){this._ensureInitialized()&&(this.isLoggingOut=!0,document.dispatchEvent(new Event("nlLogout")),setTimeout(()=>{this.isLoggingOut=!1},100))}setDarkMode(e){this._ensureInitialized()&&document.dispatchEvent(new CustomEvent("nlDarkMode",{detail:e}))}_ensureInitialized(){return this.initialized?!0:(console.warn("nostr-loginが初期化されていません"),!1)}async npubToPubkey(e){try{const n=Os.decode(e);return n.type==="npub"?n.data:""}catch(n){return console.error("npubのデコードエラー:",n),""}}getCurrentUser(){try{const e=window.nostrLogin;if(e&&e.pubkey)return{pubkey:e.pubkey,npub:e.npub}}catch(e){console.error("getCurrentUser error:",e)}return null}get isInitialized(){return this.initialized}}const aa=new $Y;class MY{publicKeyState;nostrLoginOptions={theme:"default",noBanner:!0};constructor(){this.publicKeyState=new p4}async authenticateWithNsec(e){if(!Hi.isValidNsec(e))return{success:!1,error:"invalid_secret"};const{success:n}=Hi.saveToStorage(e);if(!n)return this.publicKeyState.clear(),{success:!1,error:"error_saving"};try{const r=Hi.derivePublicKey(e);return r.hex?(T2(r.hex,r.npub,r.nprofile),{success:!0,pubkeyHex:r.hex}):{success:!1,error:"derivation_failed"}}catch(r){return console.error("nsec認証処理中にエラー:",r),{success:!1,error:"authentication_error"}}}async authenticateWithNostrLogin(e){if(e.type==="logout")return this.logout(),{success:!0};if(!e.pubkey)return console.warn("NostrLoginAuth: pubkey is required for login/signup"),{success:!1,error:"missing_pubkey"};try{return this.publicKeyState.setNostrLoginAuth(e),{success:!0,pubkeyHex:e.pubkey}}catch(n){return console.error("nostr-login認証処理中にエラー:",n),{success:!1,error:"nostr_login_error"}}}async showNostrLoginDialog(){if(!aa.isInitialized)throw new Error("nostr-login is not initialized");try{await aa.showLogin()}catch(e){if(!(e instanceof Error&&e.message==="Cancelled"))throw console.error("nostr-loginでエラー:",e),e}}async clearProfileImageCache(){try{if("serviceWorker"in navigator&&navigator.serviceWorker.controller){const e=new MessageChannel;return new Promise((n,r)=>{e.port1.onmessage=i=>{i.data.success?(console.log("プロフィール画像キャッシュをクリアしました"),n()):(console.error("プロフィール画像キャッシュクリア失敗:",i.data.error),r(new Error(i.data.error)))},navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({action:"clearProfileCache"},[e.port2]):r(new Error("Service worker controller is null."))})}}catch(e){console.error("プロフィール画像キャッシュクリア中にエラー:",e)}}logout(){localStorage.clear(),aa.isInitialized&&aa.logout(),this.clearProfileImageCache().catch(e=>{console.error("プロフィール画像キャッシュクリア中にエラー:",e)}),setTimeout(()=>{window.location.replace(window.location.pathname)},500)}async waitForExternalAuth(e=5e3){const n=Date.now(),r=100;return new Promise(i=>{const s=()=>{if(typeof window<"u"&&typeof window.nostr=="object"&&window.nostr!==null&&typeof window.nostr.getPublicKey=="function"){i(!0);return}if(Date.now()-n>=e){i(!1);return}setTimeout(s,r)};s()})}async initializeAuth(){try{const e=Hi.loadFromStorage();if(e){mo("[initializeAuth] nsecストレージキーを検出",{storedKey:e}),this.publicKeyState.setNsec(e);try{const s=Hi.derivePublicKey(e);if(s.hex)return mo("[initializeAuth] nsecからpubkey導出成功",{hex:s.hex}),T2(s.hex,s.npub,s.nprofile),{hasAuth:!0,pubkeyHex:s.hex,isNostrLogin:!1}}catch(s){mo("[initializeAuth] ストレージキーの処理中にエラー",s),console.error("ストレージキーの処理中にエラー:",s)}}await this.waitForExternalAuth(100)&&mo("[initializeAuth] 外部認証オブジェクト検出済み"),await aa.init(this.nostrLoginOptions);const r=aa.getCurrentUser();if(r?.pubkey)return mo("[initializeAuth] nostr-login認証成功",{pubkey:r.pubkey}),this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:r.pubkey,npub:r.npub}),{hasAuth:!0,pubkeyHex:r.pubkey,isNostrLogin:!0};const i=localStorage.getItem("__nostrlogin_nip46");if(i)try{const s=JSON.parse(i);if(mo("[initializeAuth] localStorageからnip46取得",{nip46:s}),s?.pubkey)return this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:s.pubkey,npub:s.npub}),{hasAuth:!0,pubkeyHex:s.pubkey,isNostrLogin:!0}}catch(s){mo("[initializeAuth] localStorage復元中に例外",s)}}catch(e){console.error("nostr-login初期化失敗:",e)}return{hasAuth:!1}}getPublicKeyState(){return this.publicKeyState}setNostrLoginHandler(e){aa.setAuthHandler(e)}markAuthInitialized(){VB()}}const po=new MY;var NY=Qe('<div><div class="balloon-message svelte-17vibbg"> </div></div>');function Sf(t,e){let n=dt(e,"type",3,"success"),r=dt(e,"message",3,"");var i=NY(),s=Ie(i),o=Ie(s);ut(()=>{Ka(i,1,`balloon-message-wrapper ${n()??""}`,"svelte-17vibbg"),ot(o,r())}),$e(t,i)}var LY=Qe('<div class="trash-icon svg-icon svelte-aklxen"></div>'),RY=Qe('<div class="image-icon svg-icon svelte-aklxen"></div>'),PY=Qe('<div class="plane-icon svg-icon svelte-aklxen"></div>'),DY=Qe('<div class="header-container svelte-aklxen"><div class="header-left svelte-aklxen"><a href="https://lokuyow.github.io/ehagaki/" rel="noopener noreferrer" class="site-icon-link svelte-aklxen" aria-label="ehagaki"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-aklxen"/></a> <!></div> <div class="post-actions svelte-aklxen"><div class="buttons-container svelte-aklxen"><!> <!> <!></div></div></div>');function BY(t,e){jn(e,!0);const n=()=>zn(a,"$infoBalloonStore",i),r=()=>zn(ts,"$_",i),[i,s]=Qi();let o=dt(e,"balloonMessage",3,null);const a=Hr(null);let l=He(!1);at(()=>gi.subscribe(k=>{ye(l,k&&k.isAuthenticated,!0)}));let c=It(()=>Gt.postStatus),u=It(()=>Gt.isUploading),f=It(()=>Gt.canPost||Gt.hasImage);function h(){setTimeout(()=>{fl({...Gt.postStatus,success:!1,message:"",completed:!1})},3e3)}const d=["balloonMessage.post_success","balloonMessage.sent","balloonMessage.to_everyone"];let p=He(""),g=He(!1);at(()=>{if(F(c).success&&F(c).completed&&!F(g)){const S=Math.floor(Math.random()*d.length);ye(p,d[S],!0),ye(g,!0),h()}}),at(()=>{(!F(c).success||!F(c).completed)&&(ye(g,!1),ye(p,""))}),_u(()=>{});var b=DY(),w=Ie(b),x=We(Ie(w),2);{var T=S=>{Sf(S,{type:"info",get message(){return n().message}})},M=S=>{var k=pn(),P=Ct(k);{var D=N=>{Sf(N,{get type(){return o().type},get message(){return o().message}})},H=N=>{var I=pn(),$=Ct(I);{var V=W=>{{let ee=It(()=>r()("balloonMessage.post_error"));Sf(W,{type:"error",get message(){return F(ee)}})}},U=W=>{var ee=pn(),X=Ct(ee);{var he=oe=>{{let Y=It(()=>r()(F(p)));Sf(oe,{type:"success",get message(){return F(Y)}})}};ft(X,oe=>{F(c).success&&F(c).completed&&F(p)&&oe(he)},!0)}$e(W,ee)};ft($,W=>{F(c).error?W(V):W(U,!1)},!0)}$e(N,I)};ft(P,N=>{o()?N(D):N(H,!1)},!0)}$e(S,k)};ft(x,S=>{n()?S(T):S(M,!1)})}var O=We(w,2),_=Ie(O),L=Ie(_);{let S=It(()=>!F(f)||F(c).sending||F(u)),k=It(()=>r()("postComponent.clear_editor"));dn(L,{variant:"default",shape:"square",className:"clear-button",get disabled(){return F(S)},get onClick(){return e.onResetPostContent},get ariaLabel(){return F(k)},children:(P,D)=>{var H=LY();$e(P,H)},$$slots:{default:!0}})}var A=We(L,2);{let S=It(()=>!F(l)||F(c).sending||F(u)),k=It(()=>r()("postComponent.upload_image"));dn(A,{variant:"default",shape:"square",className:"image-button",get disabled(){return F(S)},get onClick(){return e.onUploadImage},get ariaLabel(){return F(k)},children:(P,D)=>{var H=RY();$e(P,H)},$$slots:{default:!0}})}var E=We(A,2);{let S=It(()=>!F(f)||F(c).sending||!F(l)),k=It(()=>r()("postComponent.post"));dn(E,{variant:"default",shape:"square",className:"post-button",get disabled(){return F(S)},get onClick(){return gV},get ariaLabel(){return F(k)},children:(P,D)=>{var H=PY();$e(P,H)},$$slots:{default:!0}})}$e(t,b),qn(),s()}var HY=Qe('<img class="profile-picture svelte-19xyje2" loading="lazy" crossorigin="anonymous" referrerpolicy="no-referrer"/>'),UY=Qe('<div class="profile-picture default svg-icon svelte-19xyje2" aria-label="User"></div>'),zY=Qe('<!> <span class="profile-name svelte-19xyje2"> </span>',1);function FY(t,e){jn(e,!0);const n=()=>zn(ts,"$_",r),[r,i]=Qi(),s=!1;let o=dt(e,"profileData",3,null),a=dt(e,"hasStoredKey",3,!1),l=dt(e,"isLoadingProfile",3,!1),c=He(!1);const u=()=>o()?.name?o().name:o()?.npub?o().npub:"User",f=()=>o()?.name&&o().name!==""?o().name:o()?.npub?o().npub:"User";function h(x){console.log("プロフィール画像の読み込みに失敗しました:",x),ye(c,!0)}at(()=>{o()?.picture&&ye(c,!1)});var d={profileLoaded:s},p=pn(),g=Ct(p);{var b=x=>{{let T=It(()=>`profile-display${l()?" loading":""}`);dn(x,{variant:"default",shape:"pill",get className(){return F(T)},get disabled(){return l()},onClick:()=>{l()||e.showLogoutDialog()},children:(M,O)=>{var _=pn(),L=Ct(_);{var A=S=>{{let k=It(()=>n()("loading"));vd(S,{get text(){return F(k)},showImage:!0})}},E=S=>{var k=zY(),P=Ct(k);{var D=$=>{var V=HY();ut(U=>{nn(V,"src",o().picture),nn(V,"alt",U)},[u]),Ts("error",V,h),$e($,V)},H=$=>{var V=UY();$e($,V)};ft(P,$=>{o()?.picture&&!F(c)?$(D):$(H,!1)})}var N=We(P,2),I=Ie(N);ut($=>ot(I,$),[f]),$e(S,k)};ft(L,S=>{l()?S(A):S(E,!1)})}$e(M,_)},$$slots:{default:!0}})}};ft(g,x=>{a()&&x(b)})}$e(t,p);var w=qn(d);return i(),w}async function Mx(t,e,n){try{t?.preventDefault()}catch{}try{const r=[...e()].reverse();await NV(r),(r?.length??0)>0&&(ye(n,!0),setTimeout(()=>ye(n,!1),1500))}catch(r){console.warn("dev log copy failed:",r)}}var jY=Qe('<li class="svelte-7rfqf9"> </li>'),qY=Qe('<button type="button" class="floating-dev-console-log svelte-7rfqf9" title="タップで全コピー" aria-label="開発者ログをコピー"><ul class="svelte-7rfqf9"></ul></button>'),VY=Qe('<div class="upload-progress svelte-7rfqf9"><div class="progress-text svelte-7rfqf9"> <!></div> <div class="progress-bar svelte-7rfqf9"><div class="progress-fill svelte-7rfqf9"></div></div></div>'),WY=Qe(" <br/> <!>",1),KY=Qe('<div class="image-size-info svelte-7rfqf9"><div class="size-label svelte-7rfqf9"> </div> <div class="size-details svelte-7rfqf9"><!></div></div>'),GY=Qe('<!> <div class="footer-center svelte-7rfqf9"><!></div>',1);function ZY(t,e){jn(e,!0);const n=()=>zn(j4,"$devLog",s),r=()=>zn(MV,"$isDev",s),i=()=>zn(ts,"$_",s),[s,o]=Qi();let a=He(!1),l=dt(e,"uploadProgress",31,()=>rn({total:0,completed:0,failed:0,inProgress:!1})),c=It(()=>Pc.value.info),u=It(()=>Pc.value.visible);function f(L){if(!L)return"";const A=L.match(/\.([a-zA-Z0-9]+)$/);if(!A)return"";const E=A[1].toUpperCase();return E==="JPEG"?"JPG":E}function h(L){l(L),!L.inProgress&&L.total>0&&setTimeout(()=>{l({total:0,completed:0,failed:0,inProgress:!1})},1e3)}function d(){l({total:0,completed:0,failed:0,inProgress:!1}),Pc.set({info:null,visible:!1})}var p={updateProgress:h,reset:d},g=GY(),b=Ct(g);{var w=L=>{var A=qY();A.__click=[Mx,n,a],A.__touchend=[Mx,n,a];var E=Ie(A);Cf(E,5,()=>[...n()].reverse(),_f,(S,k)=>{var P=jY(),D=Ie(P);ut(()=>ot(D,F(k))),$e(S,P)}),$e(L,A)};ft(b,L=>{r()&&n().length&&L(w)})}var x=We(b,2),T=Ie(x);{var M=L=>{var A=VY(),E=Ie(A),S=Ie(E),k=We(S);{var P=N=>{var I=Br();ut($=>ot(I,`(${$??""}: ${l().failed??""})`),[()=>i()("footerInfoDisplay.failed")]),$e(N,I)};ft(k,N=>{l().failed>0&&N(P)})}var D=We(E,2),H=Ie(D);ut((N,I)=>{ot(S,`${N??""}: ${l().completed??""}/${l().total??""} `),Ry(H,`width: ${I??""}%`)},[()=>i()("footerInfoDisplay.uploading"),()=>l().total>0?Math.round(l().completed/l().total*100):0]),$e(L,A)},O=L=>{var A=pn(),E=Ct(A);{var S=k=>{var P=KY(),D=Ie(P),H=Ie(D),N=We(D,2),I=Ie(N);{var $=V=>{var U=WY(),W=Ct(U),ee=We(W,2),X=We(ee);{var he=Y=>{var be=Br();ut(Re=>ot(be,Re),[()=>i()("footerInfoDisplay.no_compression")||"圧縮なし"]),$e(Y,be)},oe=Y=>{var be=pn(),Re=Ct(be);{var de=ce=>{var xe=Br();ut(()=>ot(xe,`${F(c).compressedSize??""}
                        (${F(c).compressionRatio??""}%)`)),$e(ce,xe)},Me=ce=>{var xe=Br();ut(()=>ot(xe,`${F(c).compressedSize??""}
                        (${F(c).compressionRatio??""}%)`)),$e(ce,xe)};ft(Re,ce=>{F(c).wasCompressed?ce(de):ce(Me,!1)},!0)}$e(Y,be)};ft(X,Y=>{F(c).wasSkipped?Y(he):Y(oe,!1)})}ut((Y,be)=>{ot(W,`${Y??""}
                    ${F(c).originalSize??""}`),ot(ee,` → ${be??""} `)},[()=>f(F(c).originalFilename),()=>f(F(c).compressedFilename)]),$e(V,U)};ft(I,V=>{F(c).originalFilename&&F(c).compressedFilename&&V($)})}ut(V=>ot(H,`${V??""}:`),[()=>i()("footerInfoDisplay.data_size")]),$e(k,P)};ft(E,k=>{F(u)&&F(c)&&k(S)},!0)}$e(L,A)};ft(T,L=>{l().inProgress||l().total>0?L(M):L(O,!1)})}$e(t,g);var _=qn(p);return o(),_}zs(["click","touchend"]);var YY=Qe('<div class="update-indicator svelte-1di6u2b"></div>'),JY=Qe('<div class="settings-icon svg-icon svelte-1di6u2b" aria-label="Settings"></div> <!>',1),XY=Qe('<div class="footer-bar svelte-1di6u2b"><!> <!> <!></div>');function QY(t,e){jn(e,!0);const n=()=>zn(ts,"$_",r),[r,i]=Qi();let s=He(void 0);function o(b){F(s)?.updateProgress(b)}function a(){F(s)?.reset()}var l={updateProgress:o,reset:a},c=XY(),u=Ie(c);{var f=b=>{dn(b,{shape:"pill",className:"profile-display loading",disabled:!0,children:(w,x)=>{vd(w,{text:"",showImage:!0})},$$slots:{default:!0}})},h=b=>{var w=pn(),x=Ct(w);{var T=O=>{dn(O,{shape:"pill",className:"profile-display loading",disabled:!0,children:(_,L)=>{vd(_,{text:"",showImage:!0})},$$slots:{default:!0}})},M=O=>{var _=pn(),L=Ct(_);{var A=S=>{FY(S,{get profileData(){return e.profileData},get hasStoredKey(){return e.isAuthenticated},get isLoadingProfile(){return e.isLoadingProfile},get showLogoutDialog(){return e.onOpenLogoutDialog}})},E=S=>{var k=pn(),P=Ct(k);{var D=H=>{dn(H,{className:"login-btn",variant:"primary",shape:"pill",get onClick(){return e.onShowLoginDialog},children:(N,I)=>{var $=Br();ut(V=>ot($,V),[()=>n()("app.login")]),$e(N,$)},$$slots:{default:!0}})};ft(P,H=>{!e.isLoadingProfile&&!e.isAuthenticated&&H(D)},!0)}$e(S,k)};ft(L,S=>{e.isAuthenticated&&(e.profileLoaded||e.isLoadingProfile)?S(A):S(E,!1)},!0)}$e(O,_)};ft(x,O=>{e.isAuthenticated&&e.isLoadingProfile?O(T):O(M,!1)},!0)}$e(b,w)};ft(u,b=>{e.isAuthInitialized?b(h,!1):b(f)})}var d=We(u,2);Ki(ZY(d,{}),b=>ye(s,b,!0),()=>F(s));var p=We(d,2);{let b=It(()=>e.swNeedRefresh?"has-update":"");dn(p,{variant:"default",shape:"circle",get className(){return`settings-btn ${F(b)??""}`},get onClick(){return e.onOpenSettingsDialog},ariaLabel:"設定",children:(w,x)=>{var T=JY(),M=We(Ct(T),2);{var O=_=>{var L=YY();$e(_,L)};ft(M,_=>{e.swNeedRefresh&&_(O)})}$e(w,T)},$$slots:{default:!0}})}$e(t,c);var g=qn(l);return i(),g}var eJ=Qe('<main class="svelte-830cve"><div class="main-content svelte-830cve"><!> <!></div> <!> <!> <!> <!></main>');function tJ(t,e){jn(e,!0);const n=()=>zn(wi,"$locale",s),r=()=>zn(ts,"$_",s),i=()=>zn(Db,"$swNeedRefresh",s),[s,o]=Qi();let a=He(""),l=He("");const c=po.getPublicKeyState();at(()=>{c.setNsec(F(l))}),at(()=>{Dc.value&&(ye(l,""),ye(a,""))});let u=It(()=>gi.value.isAuthenticated),f=It(()=>gi.value.isInitialized),h=!1,d=!1,p="";if(!h){const ce=localStorage.getItem("nsec"),xe=localStorage.getItem("__nostrlogin_nip46");if(ce)d=!0;else if(xe)try{const Te=JSON.parse(xe);Te?.pubkey&&(d=!0,p=Te.pubkey)}catch{}h=!0}at(()=>{});let g=He(void 0),b,w,x=He(!1),T=He(void 0),M=He(void 0);async function O(ce){ye(g,tM({verifier:hN}),!0),b=new NB(F(g)),w=new n9(F(g)),Vr.set(!0),ce&&w.useRelaysFromLocalStorageIfExists(ce)||w.setBootstrapRelays(),Vr.set(!1)}async function _(ce){const xe=await po.authenticateWithNostrLogin(ce);if(!xe.success){console.error("nostr-login認証失敗:",xe.error);return}if(xe.pubkeyHex){ye(x,!0),Vr.set(!0),Jg();try{await O(),await w.fetchUserRelays(xe.pubkeyHex),await L(xe.pubkeyHex)}catch(Te){console.error("nostr-login認証処理中にエラー:",Te),Vr.set(!1)}finally{ye(x,!1),Vr.set(!1)}}}async function L(ce,xe){if(ce){(!w||!b)&&await O(),Vr.set(!0);try{const Te=await b.fetchProfileData(ce,xe);Te&&(Kg.set(Te),Gg.set(!0))}catch(Te){console.error("プロフィール読み込み中にエラー:",Te)}finally{Vr.set(!1)}}}async function A(){const ce=await po.authenticateWithNsec(F(l));if(!ce.success){ye(a,ce.error||"authentication_error",!0);return}Vr.set(!0),Jg(),ye(a,"");try{ce.pubkeyHex?(w&&!w.useRelaysFromLocalStorageIfExists(ce.pubkeyHex)&&await w.fetchUserRelays(ce.pubkeyHex),await L(ce.pubkeyHex)):Vr.set(!1)}catch{Vr.set(!1)}}function E(){po.logout(),Kg.set({name:"",picture:""}),Gg.set(!1),F(T)?.resetPostContent&&F(T).resetPostContent(),Sk(),N2(),ye(l,""),ye(a,"")}async function S(){ye(x,!0);try{await po.showNostrLoginDialog()}catch(ce){ce instanceof Error&&ce.message==="Cancelled"||console.error("nostr-loginでエラー:",ce)}finally{ye(x,!1)}}at(()=>{n()&&localStorage.setItem("locale",n())}),at(()=>{if(n()){const ce=r()("postComponent.enter_your_text")||"テキストを入力してください";sx(ce)}});let k=He(!1);const P=localStorage.getItem("sharedImageProcessed")==="1";Zo(()=>((async()=>{const xe=localStorage.getItem("locale");xe&&xe!==n()&&wi.set(xe),await ZL(),ye(k,!0);const Te=r()("postComponent.enter_your_text")||"テキストを入力してください";if(sx(Te),po.setNostrLoginHandler(_),(async()=>{try{const qe=await po.initializeAuth();qe.hasAuth&&qe.pubkeyHex?(await O(qe.pubkeyHex),await L(qe.pubkeyHex)):await O()}catch(qe){console.error("認証初期化中にエラー:",qe),await O()}finally{Vr.set(!1),po.markAuthInitialized()}})(),Gc.checkIfOpenedFromShare()&&!P)try{const qe=await Gc.getSharedImageFromServiceWorker();qe?.image&&(cs.file=qe.image,cs.metadata=qe.metadata,cs.received=!0,localStorage.setItem("sharedImageProcessed","1"))}catch(qe){console.error("共有画像の処理中にエラー:",qe)}mo("初期化完了",{isAuthenticated:F(u),isAuthInitialized:F(f)})})(),ee=document.visibilityState==="hidden",document.addEventListener("visibilitychange",X),()=>{document.removeEventListener("visibilitychange",X)})),at(()=>{cs.received&&cs.file&&F(T)&&(F(T).uploadFiles([cs.file]),cs.file=null,cs.metadata=void 0,cs.received=!1,localStorage.setItem("sharedImageProcessed","1"),setTimeout(()=>localStorage.removeItem("sharedImageProcessed"),500))});function D(ce){KB.set(ce)}function H(ce){F(M)&&F(M).updateProgress(ce)}function N(){F(M)?.reset&&F(M).reset(),localStorage.removeItem("sharedImageProcessed")}function I(){F(T)?.resetPostContent()}async function $(){!F(u)||!gi.value.pubkey||((!w||!b)&&await O(gi.value.pubkey),w&&await w.fetchUserRelays(gi.value.pubkey,{forceRemote:!0}),b&&(b.saveToLocalStorage(gi.value.pubkey,null),await L(gi.value.pubkey,{forceRemote:!0})))}function V(){const ce=["balloonMessage.hello","balloonMessage.hello2","balloonMessage.welcome","balloonMessage.waited","balloonMessage.relax","balloonMessage.good_weather","balloonMessage.thwomp","balloonMessage.sleep_on_floor","balloonMessage.home_here","balloonMessage.donai","balloonMessage.kita_na","balloonMessage.no_licking","balloonMessage.not_thwomp","balloonMessage.kitte_origin","balloonMessage.normal_stamp","balloonMessage.backside_curious","balloonMessage.corner_weapon","balloonMessage.square_peace","balloonMessage.how_much_stamp","balloonMessage.cancellation_done","balloonMessage.want_to_roll","balloonMessage.want_candy","balloonMessage.tetris_gone"],xe=Math.floor(Math.random()*ce.length);return r()(ce[xe])}let U=He(!0),W=He("");at(()=>{F(k)&&(ye(W,V(),!0),ye(U,!0),setTimeout(()=>{ye(U,!1)},3e3))});let ee=!1;function X(){document.visibilityState==="visible"&&ee&&F(k)&&(F(U)||(ye(W,V(),!0),ye(U,!0),setTimeout(()=>{ye(U,!1)},3e3))),ee=document.visibilityState==="hidden"}let he=He("medium");function oe(ce){ye(he,ce,!0)}let Y=He(rn(T0(n())));function be(ce){ye(Y,ce,!0)}var Re=pn(),de=Ct(Re);{var Me=ce=>{var xe=eJ(),Te=Ie(xe),qe=Ie(Te);{let Ue=It(()=>F(U)&&F(W)?{type:"info",message:F(W)}:null);BY(qe,{onUploadImage:()=>F(T)?.openFileDialog(),onResetPostContent:I,get balloonMessage(){return F(Ue)}})}var et=We(qe,2);Ki(oW(et,{get rxNostr(){return F(g)},get hasStoredKey(){return F(u)},onPostSuccess:N,onUploadStatusChange:D,onUploadProgress:H}),Ue=>ye(T,Ue,!0),()=>F(T));var Ze=We(Te,2);Ki(QY(Ze,{get isAuthenticated(){return F(u)},get isAuthInitialized(){return F(f)},get isLoadingProfile(){return Vr.value},get profileLoaded(){return Gg.value},get profileData(){return Kg.value},get swNeedRefresh(){return i()},get onShowLoginDialog(){return GB},get onOpenSettingsDialog(){return YB},get onOpenLogoutDialog(){return ZB}}),Ue=>ye(M,Ue,!0),()=>F(M));var pe=We(Ze,2);{var Se=Ue=>{OY(Ue,{get show(){return Dc.value},get onClose(){return Jg},onSave:A,onNostrLogin:S,get isLoadingNostrLogin(){return F(x)},get secretKey(){return F(l)},set secretKey(bt){ye(l,bt,!0)}})};ft(pe,Ue=>{Dc.value&&Ue(Se)})}var _e=We(pe,2);{var Ye=Ue=>{bY(Ue,{get show(){return yh.value},get onClose(){return N2},onLogout:E})};ft(_e,Ue=>{yh.value&&Ue(Ye)})}var gt=We(_e,2);mY(gt,{get show(){return Pb.value},get onClose(){return JB},onRefreshRelaysAndProfile:$,get selectedCompression(){return F(he)},onSelectedCompressionChange:oe,get selectedEndpoint(){return F(Y)},onSelectedEndpointChange:be}),$e(ce,xe)};ft(de,ce=>{n()&&F(k)&&ce(Me)})}$e(t,Re),qn(),o()}mS(tJ,{target:document.getElementById("app")});
