(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const V2=!1;var Ib=Array.isArray,p7=Array.prototype.indexOf,Ob=Array.from,u4=Object.defineProperty,xc=Object.getOwnPropertyDescriptor,d4=Object.getOwnPropertyDescriptors,f4=Object.prototype,m7=Array.prototype,Mb=Object.getPrototypeOf,F_=Object.isExtensible;function Mh(t){return typeof t=="function"}const Ft=()=>{};function h4(t){for(var e=0;e<t.length;e++)t[e]()}function p4(){var t,e,n=new Promise((r,i)=>{t=r,e=i});return{promise:n,resolve:t,reject:e}}const Xr=2,E0=4,Cm=8,rk=1<<24,ml=16,gl=32,Zc=64,ik=128,Fs=512,fi=1024,Ai=2048,yl=4096,ds=8192,Ja=16384,sk=32768,ll=65536,$_=1<<17,m4=1<<18,hd=1<<19,g4=1<<20,ja=1<<25,Gu=32768,W2=1<<21,ok=1<<22,Sc=1<<23,Ko=Symbol("$state"),y4=Symbol("legacy props"),g7=Symbol(""),Xd=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function ak(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function y7(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function b7(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function w7(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function v7(t){throw new Error("https://svelte.dev/e/effect_orphan")}function x7(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function S7(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function k7(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function E7(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function T7(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function C7(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const _7=1,A7=2,b4=4,P7=8,I7=16,O7=1,M7=4,N7=8,R7=16,D7=1,L7=2,br=Symbol(),B7="http://www.w3.org/1999/xhtml",F7="http://www.w3.org/2000/svg",w4="@attach";function $7(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function z7(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function v4(t){return t===this.v}function lk(t,e){return t!=t?e==e:t!==e||t!==null&&typeof t=="object"||typeof t=="function"}function x4(t){return!lk(t,this.v)}let U7=!1;const H7=[];function V7(t,e=!1,n=!1){return r0(t,new Map,"",H7,null,n)}function r0(t,e,n,r,i=null,s=!1){if(typeof t=="object"&&t!==null){var o=e.get(t);if(o!==void 0)return o;if(t instanceof Map)return new Map(t);if(t instanceof Set)return new Set(t);if(Ib(t)){var a=Array(t.length);e.set(t,a),i!==null&&e.set(i,a);for(var l=0;l<t.length;l+=1){var c=t[l];l in t&&(a[l]=r0(c,e,n,r,null,s))}return a}if(Mb(t)===f4){a={},e.set(t,a),i!==null&&e.set(i,a);for(var u in t)a[u]=r0(t[u],e,n,r,null,s);return a}if(t instanceof Date)return structuredClone(t);if(typeof t.toJSON=="function"&&!s)return r0(t.toJSON(),e,n,r,t)}if(t instanceof EventTarget)return t;try{return structuredClone(t)}catch{return t}}let Zr=null;function If(t){Zr=t}function j2(t){return Nb().get(t)}function W7(t,e){return Nb().set(t,e),e}function j7(t){return Nb().has(t)}function q7(){return Nb()}function St(t,e=!1,n){Zr={p:Zr,i:!1,c:null,e:null,s:t,x:null,l:null}}function kt(t){var e=Zr,n=e.e;if(n!==null){e.e=null;for(var r of n)H4(r)}return t!==void 0&&(e.x=t),e.i=!0,Zr=e.p,t??{}}function S4(){return!0}function Nb(t){return Zr===null&&ak(),Zr.c??=new Map(K7(Zr)||void 0)}function K7(t){let e=t.p;for(;e!==null;){const n=e.c;if(n!==null)return n;e=e.p}return null}let Eu=[];function k4(){var t=Eu;Eu=[],h4(t)}function pd(t){if(Eu.length===0&&!yp){var e=Eu;queueMicrotask(()=>{e===Eu&&k4()})}Eu.push(t)}function G7(){for(;Eu.length>0;)k4()}function E4(t){var e=pn;if(e===null)return qt.f|=Sc,t;if((e.f&sk)===0){if((e.f&ik)===0)throw t;e.b.error(t)}else Of(t,e)}function Of(t,e){for(;e!==null;){if((e.f&ik)!==0)try{e.b.error(t);return}catch(n){t=n}e=e.parent}throw t}const Z7=-7169;function Or(t,e){t.f=t.f&Z7|e}function ck(t){(t.f&Fs)!==0||t.deps===null?Or(t,fi):Or(t,yl)}function T4(t){if(t!==null)for(const e of t)(e.f&Xr)===0||(e.f&Gu)===0||(e.f^=Gu,T4(e.deps))}function C4(t,e,n){(t.f&Ai)!==0?e.add(t):(t.f&yl)!==0&&n.add(t),T4(t.deps),Or(t,fi)}const xg=new Set;let dn=null,gp=null,to=null,Is=[],Rb=null,q2=!1,yp=!1;class ro{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#n=0;#r=0;#i=null;#a=new Set;#s=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#r>0}process(e){Is=[],gp=null,this.apply();var n=[],r=[];for(const i of e)this.#o(i,n,r);this.is_fork||this.#c(),this.is_deferred()?(this.#l(r),this.#l(n)):(gp=this,dn=null,z_(r),z_(n),gp=null,this.#i?.resolve()),to=null}#o(e,n,r){e.f^=fi;for(var i=e.first,s=null;i!==null;){var o=i.f,a=(o&(gl|Zc))!==0,l=a&&(o&fi)!==0,c=l||(o&ds)!==0||this.skipped_effects.has(i);if(!c&&i.fn!==null){a?i.f^=fi:s!==null&&(o&(E0|Cm|rk))!==0?s.b.defer_effect(i):(o&E0)!==0?n.push(i):Om(i)&&((o&ml)!==0&&this.#a.add(i),qp(i));var u=i.first;if(u!==null){i=u;continue}}var d=i.parent;for(i=i.next;i===null&&d!==null;)d===s&&(s=null),i=d.next,d=d.parent}}#l(e){for(var n=0;n<e.length;n+=1)C4(e[n],this.#a,this.#s)}capture(e,n){n!==br&&!this.previous.has(e)&&this.previous.set(e,n),(e.f&Sc)===0&&(this.current.set(e,e.v),to?.set(e,e.v))}activate(){dn=this,this.apply()}deactivate(){dn===this&&(dn=null,to=null)}flush(){if(this.activate(),Is.length>0){if(_4(),dn!==null&&dn!==this)return}else this.#n===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#c(){if(this.#r===0){for(const e of this.#e)e();this.#e.clear()}this.#n===0&&this.#u()}#u(){if(xg.size>1){this.previous.clear();var e=to,n=!0;for(const i of xg){if(i===this){n=!1;continue}const s=[];for(const[a,l]of this.current){if(i.current.has(a))if(n&&l!==i.current.get(a))i.current.set(a,l);else continue;s.push(a)}if(s.length===0)continue;const o=[...i.current.keys()].filter(a=>!this.current.has(a));if(o.length>0){var r=Is;Is=[];const a=new Set,l=new Map;for(const c of s)A4(c,o,a,l);if(Is.length>0){dn=i,i.apply();for(const c of Is)i.#o(c,[],[]);i.deactivate()}Is=r}}dn=null,to=e}this.committed=!0,xg.delete(this)}increment(e){this.#n+=1,e&&(this.#r+=1)}decrement(e){this.#n-=1,e&&(this.#r-=1),this.revive()}revive(){for(const e of this.#a)this.#s.delete(e),Or(e,Ai),cl(e);for(const e of this.#s)Or(e,yl),cl(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#i??=p4()).promise}static ensure(){if(dn===null){const e=dn=new ro;xg.add(dn),yp||ro.enqueue(()=>{dn===e&&e.flush()})}return dn}static enqueue(e){pd(e)}apply(){}}function X7(t){var e=yp;yp=!0;try{for(var n;;){if(G7(),Is.length===0&&(dn?.flush(),Is.length===0))return Rb=null,n;_4()}}finally{yp=e}}function _4(){var t=Fu;q2=!0;var e=null;try{var n=0;for(_0(!0);Is.length>0;){var r=ro.ensure();if(n++>1e3){var i,s;Q7()}r.process(Is),kc.clear()}}finally{q2=!1,_0(t),Rb=null}}function Q7(){try{x7()}catch(t){Of(t,Rb)}}let _a=null;function z_(t){var e=t.length;if(e!==0){for(var n=0;n<e;){var r=t[n++];if((r.f&(Ja|ds))===0&&Om(r)&&(_a=new Set,qp(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?q4(r):r.fn=null),_a?.size>0)){kc.clear();for(const i of _a){if((i.f&(Ja|ds))!==0)continue;const s=[i];let o=i.parent;for(;o!==null;)_a.has(o)&&(_a.delete(o),s.push(o)),o=o.parent;for(let a=s.length-1;a>=0;a--){const l=s[a];(l.f&(Ja|ds))===0&&qp(l)}}_a.clear()}}_a=null}}function A4(t,e,n,r){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const i of t.reactions){const s=i.f;(s&Xr)!==0?A4(i,e,n,r):(s&(ok|ml))!==0&&(s&Ai)===0&&P4(i,e,r)&&(Or(i,Ai),cl(i))}}function P4(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(t.deps!==null)for(const i of t.deps){if(e.includes(i))return!0;if((i.f&Xr)!==0&&P4(i,e,n))return n.set(i,!0),!0}return n.set(t,!1),!1}function cl(t){for(var e=Rb=t;e.parent!==null;){e=e.parent;var n=e.f;if(q2&&e===pn&&(n&ml)!==0&&(n&m4)===0)return;if((n&(Zc|gl))!==0){if((n&fi)===0)return;e.f^=fi}}Is.push(e)}function uk(t){let e=0,n=Lc(0),r;return()=>{hk()&&(E(n),Im(()=>(e===0&&(r=ms(()=>t(()=>Ro(n)))),e+=1,()=>{pd(()=>{e-=1,e===0&&(r?.(),r=void 0,Ro(n))})})))}}var Y7=ll|hd|ik;function J7(t,e,n){new e9(t,e,n)}class e9{parent;is_pending=!1;#e;#t=null;#n;#r;#i;#a=null;#s=null;#o=null;#l=null;#c=null;#u=0;#d=0;#h=!1;#p=new Set;#g=new Set;#f=null;#m=uk(()=>(this.#f=Lc(this.#u),()=>{this.#f=null}));constructor(e,n,r){this.#e=e,this.#n=n,this.#r=r,this.parent=pn.b,this.is_pending=!!this.#n.pending,this.#i=md(()=>{pn.b=this;{var i=this.#b();try{this.#a=Hi(()=>r(i))}catch(s){this.error(s)}this.#d>0?this.#x():this.is_pending=!1}return()=>{this.#c?.remove()}},Y7)}#y(){try{this.#a=Hi(()=>this.#r(this.#e))}catch(e){this.error(e)}}#w(){const e=this.#n.pending;e&&(this.#s=Hi(()=>e(this.#e)),ro.enqueue(()=>{var n=this.#b();this.#a=this.#v(()=>(ro.ensure(),Hi(()=>this.#r(n)))),this.#d>0?this.#x():(Bu(this.#s,()=>{this.#s=null}),this.is_pending=!1)}))}#b(){var e=this.#e;return this.is_pending&&(this.#c=Go(),this.#e.before(this.#c),e=this.#c),e}defer_effect(e){C4(e,this.#p,this.#g)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#n.pending}#v(e){var n=pn,r=qt,i=Zr;Qo(this.#i),qi(this.#i),If(this.#i.ctx);try{return e()}catch(s){return E4(s),null}finally{Qo(n),qi(r),If(i)}}#x(){const e=this.#n.pending;this.#a!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Z4(this.#a,this.#l)),this.#s===null&&(this.#s=Hi(()=>e(this.#e)))}#S(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#S(e);return}if(this.#d+=e,this.#d===0){this.is_pending=!1;for(const n of this.#p)Or(n,Ai),cl(n);for(const n of this.#g)Or(n,yl),cl(n);this.#p.clear(),this.#g.clear(),this.#s&&Bu(this.#s,()=>{this.#s=null}),this.#l&&(this.#e.before(this.#l),this.#l=null)}}update_pending_count(e){this.#S(e),this.#u+=e,this.#f&&Mf(this.#f,this.#u)}get_effect_pending(){return this.#m(),E(this.#f)}error(e){var n=this.#n.onerror;let r=this.#n.failed;if(this.#h||!n&&!r)throw e;this.#a&&(Ar(this.#a),this.#a=null),this.#s&&(Ar(this.#s),this.#s=null),this.#o&&(Ar(this.#o),this.#o=null);var i=!1,s=!1;const o=()=>{if(i){z7();return}i=!0,s&&C7(),ro.ensure(),this.#u=0,this.#o!==null&&Bu(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#a=this.#v(()=>(this.#h=!1,Hi(()=>this.#r(this.#e)))),this.#d>0?this.#x():this.is_pending=!1};var a=qt;try{qi(null),s=!0,n?.(e,o),s=!1}catch(l){Of(l,this.#i&&this.#i.parent)}finally{qi(a)}r&&pd(()=>{this.#o=this.#v(()=>{ro.ensure(),this.#h=!0;try{return Hi(()=>{r(this.#e,()=>e,()=>o)})}catch(l){return Of(l,this.#i.parent),null}finally{this.#h=!1}})})}}function I4(t,e,n,r){const i=Db;if(n.length===0&&t.length===0){r(e.map(i));return}var s=dn,o=pn,a=t9();function l(){Promise.all(n.map(c=>n9(c))).then(c=>{a();try{r([...e.map(i),...c])}catch(u){(o.f&Ja)===0&&Of(u,o)}s?.deactivate(),T0()}).catch(c=>{Of(c,o)})}t.length>0?Promise.all(t).then(()=>{a();try{return l()}finally{s?.deactivate(),T0()}}):l()}function t9(){var t=pn,e=qt,n=Zr,r=dn;return function(s=!0){Qo(t),qi(e),If(n),s&&r?.activate()}}function T0(){Qo(null),qi(null),If(null)}function Db(t){var e=Xr|Ai,n=qt!==null&&(qt.f&Xr)!==0?qt:null;return pn!==null&&(pn.f|=hd),{ctx:Zr,deps:null,effects:null,equals:v4,f:e,fn:t,reactions:null,rv:0,v:br,wv:0,parent:n??pn,ac:null}}function n9(t,e,n){let r=pn;r===null&&y7();var i=r.b,s=void 0,o=Lc(br),a=!qt,l=new Map;return p9(()=>{var c=p4();s=c.promise;try{Promise.resolve(t()).then(c.resolve,c.reject).then(()=>{u===dn&&u.committed&&u.deactivate(),T0()})}catch(h){c.reject(h),T0()}var u=dn;if(a){var d=i.is_rendered();i.update_pending_count(1),u.increment(d),l.get(u)?.reject(Xd),l.delete(u),l.set(u,c)}const f=(h,p=void 0)=>{if(u.activate(),p)p!==Xd&&(o.f|=Sc,Mf(o,p));else{(o.f&Sc)!==0&&(o.f^=Sc),Mf(o,h);for(const[m,g]of l){if(l.delete(m),m===u)break;g.reject(Xd)}}a&&(i.update_pending_count(-1),u.decrement(d))};c.promise.then(f,h=>f(null,h||"unknown"))}),Am(()=>{for(const c of l.values())c.reject(Xd)}),new Promise(c=>{function u(d){function f(){d===s?c(o):u(s)}d.then(f,f)}u(s)})}function oe(t){const e=Db(t);return X4(e),e}function O4(t){const e=Db(t);return e.equals=x4,e}function M4(t){var e=t.effects;if(e!==null){t.effects=null;for(var n=0;n<e.length;n+=1)Ar(e[n])}}function r9(t){for(var e=t.parent;e!==null;){if((e.f&Xr)===0)return(e.f&Ja)===0?e:null;e=e.parent}return null}function dk(t){var e,n=pn;Qo(r9(t));try{t.f&=~Gu,M4(t),e=eM(t)}finally{Qo(n)}return e}function N4(t){var e=dk(t);if(!t.equals(e)&&(t.wv=Y4(),(!dn?.is_fork||t.deps===null)&&(t.v=e,t.deps===null))){Or(t,fi);return}Bc||(to!==null?(hk()||dn?.is_fork)&&to.set(t,e):ck(t))}let K2=new Set;const kc=new Map;let R4=!1;function Lc(t,e){var n={f:0,v:t,reactions:null,equals:v4,rv:0,wv:0};return n}function me(t,e){const n=Lc(t);return X4(n),n}function D4(t,e=!1,n=!0){const r=Lc(t);return e||(r.equals=x4),r}function K(t,e,n=!1){qt!==null&&(!io||(qt.f&$_)!==0)&&S4()&&(qt.f&(Xr|ml|ok|$_))!==0&&!el?.includes(t)&&T7();let r=n?Wt(e):e;return Mf(t,r)}function Mf(t,e){if(!t.equals(e)){var n=t.v;Bc?kc.set(t,e):kc.set(t,n),t.v=e;var r=ro.ensure();if(r.capture(t,n),(t.f&Xr)!==0){const i=t;(t.f&Ai)!==0&&dk(i),ck(i)}t.wv=Y4(),L4(t,Ai),pn!==null&&(pn.f&fi)!==0&&(pn.f&(gl|Zc))===0&&(Ts===null?y9([t]):Ts.push(t)),!r.is_fork&&K2.size>0&&!R4&&i9()}return e}function i9(){R4=!1;var t=Fu;_0(!0);const e=Array.from(K2);try{for(const n of e)(n.f&fi)!==0&&Or(n,yl),Om(n)&&qp(n)}finally{_0(t)}K2.clear()}function Ro(t){K(t,t.v+1)}function L4(t,e){var n=t.reactions;if(n!==null)for(var r=n.length,i=0;i<r;i++){var s=n[i],o=s.f,a=(o&Ai)===0;if(a&&Or(s,e),(o&Xr)!==0){var l=s;to?.delete(l),(o&Gu)===0&&(o&Fs&&(s.f|=Gu),L4(l,yl))}else a&&((o&ml)!==0&&_a!==null&&_a.add(s),cl(s))}}function Wt(t){if(typeof t!="object"||t===null||Ko in t)return t;const e=Mb(t);if(e!==f4&&e!==m7)return t;var n=new Map,r=Ib(t),i=me(0),s=tl,o=a=>{if(tl===s)return a();var l=qt,c=tl;qi(null),j_(s);var u=a();return qi(l),j_(c),u};return r&&n.set("length",me(t.length)),new Proxy(t,{defineProperty(a,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&k7();var u=n.get(l);return u===void 0?u=o(()=>{var d=me(c.value);return n.set(l,d),d}):K(u,c.value,!0),!0},deleteProperty(a,l){var c=n.get(l);if(c===void 0){if(l in a){const u=o(()=>me(br));n.set(l,u),Ro(i)}}else K(c,br),Ro(i);return!0},get(a,l,c){if(l===Ko)return t;var u=n.get(l),d=l in a;if(u===void 0&&(!d||xc(a,l)?.writable)&&(u=o(()=>{var h=Wt(d?a[l]:br),p=me(h);return p}),n.set(l,u)),u!==void 0){var f=E(u);return f===br?void 0:f}return Reflect.get(a,l,c)},getOwnPropertyDescriptor(a,l){var c=Reflect.getOwnPropertyDescriptor(a,l);if(c&&"value"in c){var u=n.get(l);u&&(c.value=E(u))}else if(c===void 0){var d=n.get(l),f=d?.v;if(d!==void 0&&f!==br)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return c},has(a,l){if(l===Ko)return!0;var c=n.get(l),u=c!==void 0&&c.v!==br||Reflect.has(a,l);if(c!==void 0||pn!==null&&(!u||xc(a,l)?.writable)){c===void 0&&(c=o(()=>{var f=u?Wt(a[l]):br,h=me(f);return h}),n.set(l,c));var d=E(c);if(d===br)return!1}return u},set(a,l,c,u){var d=n.get(l),f=l in a;if(r&&l==="length")for(var h=c;h<d.v;h+=1){var p=n.get(h+"");p!==void 0?K(p,br):h in a&&(p=o(()=>me(br)),n.set(h+"",p))}if(d===void 0)(!f||xc(a,l)?.writable)&&(d=o(()=>me(void 0)),K(d,Wt(c)),n.set(l,d));else{f=d.v!==br;var m=o(()=>Wt(c));K(d,m)}var g=Reflect.getOwnPropertyDescriptor(a,l);if(g?.set&&g.set.call(u,c),!f){if(r&&typeof l=="string"){var y=n.get("length"),b=Number(l);Number.isInteger(b)&&b>=y.v&&K(y,b+1)}Ro(i)}return!0},ownKeys(a){E(i);var l=Reflect.ownKeys(a).filter(d=>{var f=n.get(d);return f===void 0||f.v!==br});for(var[c,u]of n)u.v!==br&&!(c in a)&&l.push(c);return l},setPrototypeOf(){E7()}})}function U_(t){try{if(t!==null&&typeof t=="object"&&Ko in t)return t[Ko]}catch{}return t}function s9(t,e){return Object.is(U_(t),U_(e))}var H_,B4,F4,$4;function o9(){if(H_===void 0){H_=window,B4=/Firefox/.test(navigator.userAgent);var t=Element.prototype,e=Node.prototype,n=Text.prototype;F4=xc(e,"firstChild").get,$4=xc(e,"nextSibling").get,F_(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),F_(n)&&(n.__t=void 0)}}function Go(t=""){return document.createTextNode(t)}function C0(t){return F4.call(t)}function _m(t){return $4.call(t)}function ie(t,e){return C0(t)}function Ee(t,e=!1){{var n=C0(t);return n instanceof Comment&&n.data===""?_m(n):n}}function we(t,e=1,n=!1){let r=t;for(;e--;)r=_m(r);return r}function a9(t){t.textContent=""}function z4(){return!1}function l9(t,e){if(e){const n=document.body;t.autofocus=!0,pd(()=>{document.activeElement===n&&t.focus()})}}let V_=!1;function c9(){V_||(V_=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{if(!t.defaultPrevented)for(const e of t.target.elements)e.__on_r?.()})},{capture:!0}))}function Lb(t){var e=qt,n=pn;qi(null),Qo(null);try{return t()}finally{qi(e),Qo(n)}}function fk(t,e,n,r=n){t.addEventListener(e,()=>Lb(n));const i=t.__on_r;i?t.__on_r=()=>{i(),r(!0)}:t.__on_r=()=>r(!0),c9()}function U4(t){pn===null&&(qt===null&&v7(),w7()),Bc&&b7()}function u9(t,e){var n=e.last;n===null?e.last=e.first=t:(n.next=t,t.prev=n,e.last=t)}function Ws(t,e,n){var r=pn;r!==null&&(r.f&ds)!==0&&(t|=ds);var i={ctx:Zr,deps:null,nodes:null,f:t|Ai|Fs,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(n)try{qp(i),i.f|=sk}catch(a){throw Ar(i),a}else e!==null&&cl(i);var s=i;if(n&&s.deps===null&&s.teardown===null&&s.nodes===null&&s.first===s.last&&(s.f&hd)===0&&(s=s.first,(t&ml)!==0&&(t&ll)!==0&&s!==null&&(s.f|=ll)),s!==null&&(s.parent=r,r!==null&&u9(s,r),qt!==null&&(qt.f&Xr)!==0&&(t&Zc)===0)){var o=qt;(o.effects??=[]).push(s)}return i}function hk(){return qt!==null&&!io}function Am(t){const e=Ws(Cm,null,!1);return Or(e,fi),e.teardown=t,e}function Ge(t){U4();var e=pn.f,n=!qt&&(e&gl)!==0&&(e&sk)===0;if(n){var r=Zr;(r.e??=[]).push(t)}else return H4(t)}function H4(t){return Ws(E0|g4,t,!1)}function d9(t){return U4(),Ws(Cm|g4,t,!0)}function f9(t){ro.ensure();const e=Ws(Zc|hd,t,!0);return()=>{Ar(e)}}function h9(t){ro.ensure();const e=Ws(Zc|hd,t,!0);return(n={})=>new Promise(r=>{n.outro?Bu(e,()=>{Ar(e),r(void 0)}):(Ar(e),r(void 0))})}function Pm(t){return Ws(E0,t,!1)}function p9(t){return Ws(ok|hd,t,!0)}function Im(t,e=0){return Ws(Cm|e,t,!0)}function Ke(t,e=[],n=[],r=[]){I4(r,e,n,i=>{Ws(Cm,()=>t(...i.map(E)),!0)})}function md(t,e=0){var n=Ws(ml|e,t,!0);return n}function V4(t,e=0){var n=Ws(rk|e,t,!0);return n}function Hi(t){return Ws(gl|hd,t,!0)}function W4(t){var e=t.teardown;if(e!==null){const n=Bc,r=qt;W_(!0),qi(null);try{e.call(null)}finally{W_(n),qi(r)}}}function j4(t,e=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const i=n.ac;i!==null&&Lb(()=>{i.abort(Xd)});var r=n.next;(n.f&Zc)!==0?n.parent=null:Ar(n,e),n=r}}function m9(t){for(var e=t.first;e!==null;){var n=e.next;(e.f&gl)===0&&Ar(e),e=n}}function Ar(t,e=!0){var n=!1;(e||(t.f&m4)!==0)&&t.nodes!==null&&t.nodes.end!==null&&(g9(t.nodes.start,t.nodes.end),n=!0),j4(t,e&&!n),A0(t,0),Or(t,Ja);var r=t.nodes&&t.nodes.t;if(r!==null)for(const s of r)s.stop();W4(t);var i=t.parent;i!==null&&i.first!==null&&q4(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes=t.ac=null}function g9(t,e){for(;t!==null;){var n=t===e?null:_m(t);t.remove(),t=n}}function q4(t){var e=t.parent,n=t.prev,r=t.next;n!==null&&(n.next=r),r!==null&&(r.prev=n),e!==null&&(e.first===t&&(e.first=r),e.last===t&&(e.last=n))}function Bu(t,e,n=!0){var r=[];K4(t,r,!0);var i=()=>{n&&Ar(t),e&&e()},s=r.length;if(s>0){var o=()=>--s||i();for(var a of r)a.out(o)}else i()}function K4(t,e,n){if((t.f&ds)===0){t.f^=ds;var r=t.nodes&&t.nodes.t;if(r!==null)for(const a of r)(a.is_global||n)&&e.push(a);for(var i=t.first;i!==null;){var s=i.next,o=(i.f&ll)!==0||(i.f&gl)!==0&&(t.f&ml)!==0;K4(i,e,o?n:!1),i=s}}}function pk(t){G4(t,!0)}function G4(t,e){if((t.f&ds)!==0){t.f^=ds,(t.f&fi)===0&&(Or(t,Ai),cl(t));for(var n=t.first;n!==null;){var r=n.next,i=(n.f&ll)!==0||(n.f&gl)!==0;G4(n,i?e:!1),n=r}var s=t.nodes&&t.nodes.t;if(s!==null)for(const o of s)(o.is_global||e)&&o.in()}}function Z4(t,e){if(t.nodes)for(var n=t.nodes.start,r=t.nodes.end;n!==null;){var i=n===r?null:_m(n);e.append(n),n=i}}let Fu=!1;function _0(t){Fu=t}let Bc=!1;function W_(t){Bc=t}let qt=null,io=!1;function qi(t){qt=t}let pn=null;function Qo(t){pn=t}let el=null;function X4(t){qt!==null&&(el===null?el=[t]:el.push(t))}let Ti=null,ns=0,Ts=null;function y9(t){Ts=t}let Q4=1,jp=0,tl=jp;function j_(t){tl=t}function Y4(){return++Q4}function Om(t){var e=t.f;if((e&Ai)!==0)return!0;if(e&Xr&&(t.f&=~Gu),(e&yl)!==0){for(var n=t.deps,r=n.length,i=0;i<r;i++){var s=n[i];if(Om(s)&&N4(s),s.wv>t.wv)return!0}(e&Fs)!==0&&to===null&&Or(t,fi)}return!1}function J4(t,e,n=!0){var r=t.reactions;if(r!==null&&!el?.includes(t))for(var i=0;i<r.length;i++){var s=r[i];(s.f&Xr)!==0?J4(s,e,!1):e===s&&(n?Or(s,Ai):(s.f&fi)!==0&&Or(s,yl),cl(s))}}function eM(t){var e=Ti,n=ns,r=Ts,i=qt,s=el,o=Zr,a=io,l=tl,c=t.f;Ti=null,ns=0,Ts=null,qt=(c&(gl|Zc))===0?t:null,el=null,If(t.ctx),io=!1,tl=++jp,t.ac!==null&&(Lb(()=>{t.ac.abort(Xd)}),t.ac=null);try{t.f|=W2;var u=t.fn,d=u(),f=t.deps;if(Ti!==null){var h;if(A0(t,ns),f!==null&&ns>0)for(f.length=ns+Ti.length,h=0;h<Ti.length;h++)f[ns+h]=Ti[h];else t.deps=f=Ti;if(hk()&&(t.f&Fs)!==0)for(h=ns;h<f.length;h++)(f[h].reactions??=[]).push(t)}else f!==null&&ns<f.length&&(A0(t,ns),f.length=ns);if(S4()&&Ts!==null&&!io&&f!==null&&(t.f&(Xr|yl|Ai))===0)for(h=0;h<Ts.length;h++)J4(Ts[h],t);return i!==null&&i!==t&&(jp++,Ts!==null&&(r===null?r=Ts:r.push(...Ts))),(t.f&Sc)!==0&&(t.f^=Sc),d}catch(p){return E4(p)}finally{t.f^=W2,Ti=e,ns=n,Ts=r,qt=i,el=s,If(o),io=a,tl=l}}function b9(t,e){let n=e.reactions;if(n!==null){var r=p7.call(n,t);if(r!==-1){var i=n.length-1;i===0?n=e.reactions=null:(n[r]=n[i],n.pop())}}if(n===null&&(e.f&Xr)!==0&&(Ti===null||!Ti.includes(e))){var s=e;(s.f&Fs)!==0&&(s.f^=Fs,s.f&=~Gu),ck(s),M4(s),A0(s,0)}}function A0(t,e){var n=t.deps;if(n!==null)for(var r=e;r<n.length;r++)b9(t,n[r])}function qp(t){var e=t.f;if((e&Ja)===0){Or(t,fi);var n=pn,r=Fu;pn=t,Fu=!0;try{(e&(ml|rk))!==0?m9(t):j4(t),W4(t);var i=eM(t);t.teardown=typeof i=="function"?i:null,t.wv=Q4;var s;V2&&U7&&(t.f&Ai)!==0&&t.deps}finally{Fu=r,pn=n}}}async function ul(){await Promise.resolve(),X7()}function E(t){var e=t.f,n=(e&Xr)!==0;if(qt!==null&&!io){var r=pn!==null&&(pn.f&Ja)!==0;if(!r&&!el?.includes(t)){var i=qt.deps;if((qt.f&W2)!==0)t.rv<jp&&(t.rv=jp,Ti===null&&i!==null&&i[ns]===t?ns++:Ti===null?Ti=[t]:Ti.includes(t)||Ti.push(t));else{(qt.deps??=[]).push(t);var s=t.reactions;s===null?t.reactions=[qt]:s.includes(qt)||s.push(qt)}}}if(Bc&&kc.has(t))return kc.get(t);if(n){var o=t;if(Bc){var a=o.v;return((o.f&fi)===0&&o.reactions!==null||nM(o))&&(a=dk(o)),kc.set(o,a),a}var l=(o.f&Fs)===0&&!io&&qt!==null&&(Fu||(qt.f&Fs)!==0),c=o.deps===null;Om(o)&&(l&&(o.f|=Fs),N4(o)),l&&!c&&tM(o)}if(to?.has(t))return to.get(t);if((t.f&Sc)!==0)throw t.v;return t.v}function tM(t){if(t.deps!==null){t.f|=Fs;for(const e of t.deps)(e.reactions??=[]).push(t),(e.f&Xr)!==0&&(e.f&Fs)===0&&tM(e)}}function nM(t){if(t.v===br)return!0;if(t.deps===null)return!1;for(const e of t.deps)if(kc.has(e)||(e.f&Xr)!==0&&nM(e))return!0;return!1}function ms(t){var e=io;try{return io=!0,t()}finally{io=e}}function w9(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Ko in t)G2(t);else if(!Array.isArray(t))for(let e in t){const n=t[e];typeof n=="object"&&n&&Ko in n&&G2(n)}}}function G2(t,e=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!e.has(t)){e.add(t),t instanceof Date&&t.getTime();for(let r in t)try{G2(t[r],e)}catch{}const n=Mb(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const r=d4(n);for(let i in r){const s=r[i].get;if(s)try{s.call(t)}catch{}}}}}function v9(){return Symbol(w4)}function x9(t){return t.endsWith("capture")&&t!=="gotpointercapture"&&t!=="lostpointercapture"}const S9=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function k9(t){return S9.includes(t)}const E9={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function T9(t){return t=t.toLowerCase(),E9[t]??t}const C9=["touchstart","touchmove"];function _9(t){return C9.includes(t)}const rM=new Set,Z2=new Set;function mk(t,e,n,r={}){function i(s){if(r.capture||np.call(e,s),!s.cancelBubble)return Lb(()=>n?.call(this,s))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?pd(()=>{e.addEventListener(t,i,r)}):e.addEventListener(t,i,r),i}function Sr(t,e,n,r={}){var i=mk(e,t,n,r);return()=>{t.removeEventListener(e,i,r)}}function eo(t,e,n,r,i){var s={capture:r,passive:i},o=mk(t,e,n,s);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Am(()=>{e.removeEventListener(t,o,s)})}function Mi(t){for(var e=0;e<t.length;e++)rM.add(t[e]);for(var n of Z2)n(t)}let q_=null;function np(t){var e=this,n=e.ownerDocument,r=t.type,i=t.composedPath?.()||[],s=i[0]||t.target;q_=t;var o=0,a=q_===t&&t.__root;if(a){var l=i.indexOf(a);if(l!==-1&&(e===document||e===window)){t.__root=e;return}var c=i.indexOf(e);if(c===-1)return;l<=c&&(o=l)}if(s=i[o]||t.target,s!==e){u4(t,"currentTarget",{configurable:!0,get(){return s||n}});var u=qt,d=pn;qi(null),Qo(null);try{for(var f,h=[];s!==null;){var p=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+r];m!=null&&(!s.disabled||t.target===s)&&m.call(s,t)}catch(g){f?h.push(g):f=g}if(t.cancelBubble||p===e||p===null)break;s=p}if(f){for(let g of h)queueMicrotask(()=>{throw g});throw f}}finally{t.__root=e,delete t.currentTarget,qi(u),Qo(d)}}}function A9(t){var e=document.createElement("template");return e.innerHTML=t.replaceAll("<!>","<!---->"),e.content}function Kp(t,e){var n=pn;n.nodes===null&&(n.nodes={start:t,end:e,a:null,t:null})}function Ce(t,e){var n=(e&D7)!==0,r=(e&L7)!==0,i,s=!t.startsWith("<!>");return()=>{i===void 0&&(i=A9(s?t:"<!>"+t),n||(i=C0(i)));var o=r||B4?document.importNode(i,!0):i.cloneNode(!0);if(n){var a=C0(o),l=o.lastChild;Kp(a,l)}else Kp(o,o);return o}}function an(t=""){{var e=Go(t+"");return Kp(e,e),e}}function Ue(){var t=document.createDocumentFragment(),e=document.createComment(""),n=Go();return t.append(e,n),Kp(e,n),t}function Y(t,e){t!==null&&t.before(e)}function sa(){return(window.__svelte??={}).uid??=1,`c${window.__svelte.uid++}`}function Re(t,e){var n=e==null?"":typeof e=="object"?e+"":e;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function gk(t,e){return P9(t,e)}const Ad=new Map;function P9(t,{target:e,anchor:n,props:r={},events:i,context:s,intro:o=!0}){o9();var a=new Set,l=d=>{for(var f=0;f<d.length;f++){var h=d[f];if(!a.has(h)){a.add(h);var p=_9(h);e.addEventListener(h,np,{passive:p});var m=Ad.get(h);m===void 0?(document.addEventListener(h,np,{passive:p}),Ad.set(h,1)):Ad.set(h,m+1)}}};l(Ob(rM)),Z2.add(l);var c=void 0,u=h9(()=>{var d=n??e.appendChild(Go());return J7(d,{pending:()=>{}},f=>{if(s){St({});var h=Zr;h.c=s}i&&(r.$$events=i),c=t(f,r)||{},s&&kt()}),()=>{for(var f of a){e.removeEventListener(f,np);var h=Ad.get(f);--h===0?(document.removeEventListener(f,np),Ad.delete(f)):Ad.set(f,h)}Z2.delete(l),d!==n&&d.parentNode?.removeChild(d)}});return X2.set(c,u),c}let X2=new WeakMap;function iM(t,e){const n=X2.get(t);return n?(X2.delete(t),n(e)):Promise.resolve()}class Mm{anchor;#e=new Map;#t=new Map;#n=new Map;#r=new Set;#i=!0;constructor(e,n=!0){this.anchor=e,this.#i=n}#a=()=>{var e=dn;if(this.#e.has(e)){var n=this.#e.get(e),r=this.#t.get(n);if(r)pk(r),this.#r.delete(n);else{var i=this.#n.get(n);i&&(this.#t.set(n,i.effect),this.#n.delete(n),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),r=i.effect)}for(const[s,o]of this.#e){if(this.#e.delete(s),s===e)break;const a=this.#n.get(o);a&&(Ar(a.effect),this.#n.delete(o))}for(const[s,o]of this.#t){if(s===n||this.#r.has(s))continue;const a=()=>{if(Array.from(this.#e.values()).includes(s)){var c=document.createDocumentFragment();Z4(o,c),c.append(Go()),this.#n.set(s,{effect:o,fragment:c})}else Ar(o);this.#r.delete(s),this.#t.delete(s)};this.#i||!r?(this.#r.add(s),Bu(o,a,!1)):a()}}};#s=e=>{this.#e.delete(e);const n=Array.from(this.#e.values());for(const[r,i]of this.#n)n.includes(r)||(Ar(i.effect),this.#n.delete(r))};ensure(e,n){var r=dn,i=z4();if(n&&!this.#t.has(e)&&!this.#n.has(e))if(i){var s=document.createDocumentFragment(),o=Go();s.append(o),this.#n.set(e,{effect:Hi(()=>n(o)),fragment:s})}else this.#t.set(e,Hi(()=>n(this.anchor)));if(this.#e.set(r,e),i){for(const[a,l]of this.#t)a===e?r.skipped_effects.delete(l):r.skipped_effects.add(l);for(const[a,l]of this.#n)a===e?r.skipped_effects.delete(l.effect):r.skipped_effects.add(l.effect);r.oncommit(this.#a),r.ondiscard(this.#s)}else this.#a()}}function Ve(t,e,n=!1){var r=new Mm(t),i=n?ll:0;function s(o,a){r.ensure(o,a)}md(()=>{var o=!1;e((a,l=!0)=>{o=!0,s(l,a)}),o||s(!1,null)},i)}function I9(t,e,n){var r=new Mm(t);md(()=>{var i=e();r.ensure(i,n)})}function gu(t,e){return e}function O9(t,e,n){for(var r=[],i=e.length,s,o=e.length,a=0;a<i;a++){let d=e[a];Bu(d,()=>{if(s){if(s.pending.delete(d),s.done.add(d),s.pending.size===0){var f=t.outrogroups;Q2(Ob(s.done)),f.delete(s),f.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=r.length===0&&n!==null;if(l){var c=n,u=c.parentNode;a9(u),u.append(c),t.items.clear()}Q2(e,!l)}else s={pending:new Set(e),done:new Set},(t.outrogroups??=new Set).add(s)}function Q2(t,e=!0){for(var n=0;n<t.length;n++)Ar(t[n],e)}var K_;function Na(t,e,n,r,i,s=null){var o=t,a=new Map,l=(e&b4)!==0;if(l){var c=t;o=c.appendChild(Go())}var u=null,d=O4(()=>{var y=n();return Ib(y)?y:y==null?[]:Ob(y)}),f,h=!0;function p(){g.fallback=u,M9(g,f,o,e,r),u!==null&&(f.length===0?(u.f&ja)===0?pk(u):(u.f^=ja,rp(u,null,o)):Bu(u,()=>{u=null}))}var m=md(()=>{f=E(d);for(var y=f.length,b=new Set,S=dn,C=z4(),_=0;_<y;_+=1){var x=f[_],I=r(x,_),k=h?null:a.get(I);k?(k.v&&Mf(k.v,x),k.i&&Mf(k.i,_),C&&S.skipped_effects.delete(k.e)):(k=N9(a,h?o:K_??=Go(),x,I,_,i,e,n),h||(k.e.f|=ja),a.set(I,k)),b.add(I)}if(y===0&&s&&!u&&(h?u=Hi(()=>s(o)):(u=Hi(()=>s(K_??=Go())),u.f|=ja)),!h)if(C){for(const[T,P]of a)b.has(T)||S.skipped_effects.add(P.e);S.oncommit(p),S.ondiscard(()=>{})}else p();E(d)}),g={effect:m,items:a,outrogroups:null,fallback:u};h=!1}function M9(t,e,n,r,i){var s=(r&P7)!==0,o=e.length,a=t.items,l=t.effect.first,c,u=null,d,f=[],h=[],p,m,g,y;if(s)for(y=0;y<o;y+=1)p=e[y],m=i(p,y),g=a.get(m).e,(g.f&ja)===0&&(g.nodes?.a?.measure(),(d??=new Set).add(g));for(y=0;y<o;y+=1){if(p=e[y],m=i(p,y),g=a.get(m).e,t.outrogroups!==null)for(const P of t.outrogroups)P.pending.delete(g),P.done.delete(g);if((g.f&ja)!==0)if(g.f^=ja,g===l)rp(g,null,n);else{var b=u?u.next:l;g===t.effect.last&&(t.effect.last=g.prev),g.prev&&(g.prev.next=g.next),g.next&&(g.next.prev=g.prev),$l(t,u,g),$l(t,g,b),rp(g,b,n),u=g,f=[],h=[],l=u.next;continue}if((g.f&ds)!==0&&(pk(g),s&&(g.nodes?.a?.unfix(),(d??=new Set).delete(g))),g!==l){if(c!==void 0&&c.has(g)){if(f.length<h.length){var S=h[0],C;u=S.prev;var _=f[0],x=f[f.length-1];for(C=0;C<f.length;C+=1)rp(f[C],S,n);for(C=0;C<h.length;C+=1)c.delete(h[C]);$l(t,_.prev,x.next),$l(t,u,_),$l(t,x,S),l=S,u=x,y-=1,f=[],h=[]}else c.delete(g),rp(g,l,n),$l(t,g.prev,g.next),$l(t,g,u===null?t.effect.first:u.next),$l(t,u,g),u=g;continue}for(f=[],h=[];l!==null&&l!==g;)(c??=new Set).add(l),h.push(l),l=l.next;if(l===null)continue}(g.f&ja)===0&&f.push(g),u=g,l=g.next}if(t.outrogroups!==null){for(const P of t.outrogroups)P.pending.size===0&&(Q2(Ob(P.done)),t.outrogroups?.delete(P));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||c!==void 0){var I=[];if(c!==void 0)for(g of c)(g.f&ds)===0&&I.push(g);for(;l!==null;)(l.f&ds)===0&&l!==t.fallback&&I.push(l),l=l.next;var k=I.length;if(k>0){var T=(r&b4)!==0&&o===0?n:null;if(s){for(y=0;y<k;y+=1)I[y].nodes?.a?.measure();for(y=0;y<k;y+=1)I[y].nodes?.a?.fix()}O9(t,I,T)}}s&&pd(()=>{if(d!==void 0)for(g of d)g.nodes?.a?.apply()})}function N9(t,e,n,r,i,s,o,a){var l=(o&_7)!==0?(o&I7)===0?D4(n,!1,!1):Lc(n):null,c=(o&A7)!==0?Lc(i):null;return{v:l,i:c,e:Hi(()=>(s(e,l??n,c??i,a),()=>{t.delete(r)}))}}function rp(t,e,n){if(t.nodes)for(var r=t.nodes.start,i=t.nodes.end,s=e&&(e.f&ja)===0?e.nodes.start:n;r!==null;){var o=_m(r);if(s.before(r),r===i)return;r=o}}function $l(t,e,n){e===null?t.effect.first=n:e.next=n,n===null?t.effect.last=e:n.prev=e}function _t(t,e,...n){var r=new Mm(t);md(()=>{const i=e()??null;r.ensure(i,i&&(s=>i(s,...n)))},ll)}function Nt(t,e,n){var r=new Mm(t);md(()=>{var i=e()??null;r.ensure(i,i&&(s=>n(s,i)))},ll)}function R9(t,e,n,r,i,s){var o=null,a=t,l=new Mm(a,!1);md(()=>{const c=e()||null;var u=c==="svg"?F7:null;if(c===null){l.ensure(null,null);return}return l.ensure(c,d=>{if(c){if(o=u?document.createElementNS(u,c):document.createElement(c),Kp(o,o),r){var f=o.appendChild(Go());r(o,f)}pn.nodes.end=o,d.before(o)}}),()=>{}},ll),Am(()=>{})}function Sg(t,e,n){Pm(()=>{var r=ms(()=>e(t,n?.())||{});if(n&&r?.update){var i=!1,s={};Im(()=>{var o=n();w9(o),i&&lk(s,o)&&(s=o,r.update(o))}),i=!0}if(r?.destroy)return()=>r.destroy()})}function D9(t,e){var n=void 0,r;V4(()=>{n!==(n=e())&&(r&&(Ar(r),r=null),n&&(r=Hi(()=>{Pm(()=>n(t))})))})}function sM(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=sM(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function i0(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=sM(t))&&(r&&(r+=" "),r+=e);return r}function oM(t){return typeof t=="object"?i0(t):t??""}const G_=[...` 	
\r\fÂ \v\uFEFF`];function L9(t,e,n){var r=t==null?"":""+t;if(e&&(r=r?r+" "+e:e),n){for(var i in n)if(n[i])r=r?r+" "+i:i;else if(r.length)for(var s=i.length,o=0;(o=r.indexOf(i,o))>=0;){var a=o+s;(o===0||G_.includes(r[o-1]))&&(a===r.length||G_.includes(r[a]))?r=(o===0?"":r.substring(0,o))+r.substring(a+1):o=a}}return r===""?null:r}function Z_(t,e=!1){var n=e?" !important;":";",r="";for(var i in t){var s=t[i];s!=null&&s!==""&&(r+=" "+i+": "+s+n)}return r}function Cv(t){return t[0]!=="-"||t[1]!=="-"?t.toLowerCase():t}function B9(t,e){if(e){var n="",r,i;if(Array.isArray(e)?(r=e[0],i=e[1]):r=e,t){t=String(t).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,o=0,a=!1,l=[];r&&l.push(...Object.keys(r).map(Cv)),i&&l.push(...Object.keys(i).map(Cv));var c=0,u=-1;const m=t.length;for(var d=0;d<m;d++){var f=t[d];if(a?f==="/"&&t[d-1]==="*"&&(a=!1):s?s===f&&(s=!1):f==="/"&&t[d+1]==="*"?a=!0:f==='"'||f==="'"?s=f:f==="("?o++:f===")"&&o--,!a&&s===!1&&o===0){if(f===":"&&u===-1)u=d;else if(f===";"||d===m-1){if(u!==-1){var h=Cv(t.substring(c,u).trim());if(!l.includes(h)){f!==";"&&d++;var p=t.substring(c,d).trim();n+=" "+p+";"}}c=d+1,u=-1}}}}return r&&(n+=Z_(r)),i&&(n+=Z_(i,!0)),n=n.trim(),n===""?null:n}return t==null?null:String(t)}function ao(t,e,n,r,i,s){var o=t.__className;if(o!==n||o===void 0){var a=L9(n,r,s);a==null?t.removeAttribute("class"):e?t.className=a:t.setAttribute("class",a),t.__className=n}else if(s&&i!==s)for(var l in s){var c=!!s[l];(i==null||c!==!!i[l])&&t.classList.toggle(l,c)}return s}function _v(t,e={},n,r){for(var i in n){var s=n[i];e[i]!==s&&(n[i]==null?t.style.removeProperty(i):t.style.setProperty(i,s,r))}}function qa(t,e,n,r){var i=t.__style;if(i!==e){var s=B9(e,r);s==null?t.removeAttribute("style"):t.style.cssText=s,t.__style=e}else r&&(Array.isArray(r)?(_v(t,n?.[0],r[0]),_v(t,n?.[1],r[1],"important")):_v(t,n,r));return r}function P0(t,e,n=!1){if(t.multiple){if(e==null)return;if(!Ib(e))return $7();for(var r of t.options)r.selected=e.includes(bp(r));return}for(r of t.options){var i=bp(r);if(s9(i,e)){r.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function aM(t){var e=new MutationObserver(()=>{P0(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Am(()=>{e.disconnect()})}function F9(t,e,n=e){var r=new WeakSet,i=!0;fk(t,"change",s=>{var o=s?"[selected]":":checked",a;if(t.multiple)a=[].map.call(t.querySelectorAll(o),bp);else{var l=t.querySelector(o)??t.querySelector("option:not([disabled])");a=l&&bp(l)}n(a),dn!==null&&r.add(dn)}),Pm(()=>{var s=e();if(t===document.activeElement){var o=gp??dn;if(r.has(o))return}if(P0(t,s,i),i&&s===void 0){var a=t.querySelector(":checked");a!==null&&(s=bp(a),n(s))}t.__value=s,i=!1}),aM(t)}function bp(t){return"__value"in t?t.__value:t.value}const Nh=Symbol("class"),Rh=Symbol("style"),lM=Symbol("is custom element"),cM=Symbol("is html");function uM(t,e){var n=Bb(t);n.value===(n.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function $9(t,e){var n=Bb(t);n.checked!==(n.checked=e??void 0)&&(t.checked=e)}function z9(t,e){e?t.hasAttribute("selected")||t.setAttribute("selected",""):t.removeAttribute("selected")}function wn(t,e,n,r){var i=Bb(t);i[e]!==(i[e]=n)&&(e==="loading"&&(t[g7]=n),n==null?t.removeAttribute(e):typeof n!="string"&&dM(t).includes(e)?t[e]=n:t.setAttribute(e,n))}function U9(t,e,n,r,i=!1,s=!1){var o=Bb(t),a=o[lM],l=!o[cM],c=e||{},u=t.tagName==="OPTION";for(var d in e)d in n||(n[d]=null);n.class?n.class=oM(n.class):(r||n[Nh])&&(n.class=null),n[Rh]&&(n.style??=null);var f=dM(t);for(const S in n){let C=n[S];if(u&&S==="value"&&C==null){t.value=t.__value="",c[S]=C;continue}if(S==="class"){var h=t.namespaceURI==="http://www.w3.org/1999/xhtml";ao(t,h,C,r,e?.[Nh],n[Nh]),c[S]=C,c[Nh]=n[Nh];continue}if(S==="style"){qa(t,C,e?.[Rh],n[Rh]),c[S]=C,c[Rh]=n[Rh];continue}var p=c[S];if(!(C===p&&!(C===void 0&&t.hasAttribute(S)))){c[S]=C;var m=S[0]+S[1];if(m!=="$$")if(m==="on"){const _={},x="$$"+S;let I=S.slice(2);var g=k9(I);if(x9(I)&&(I=I.slice(0,-7),_.capture=!0),!g&&p){if(C!=null)continue;t.removeEventListener(I,c[x],_),c[x]=null}if(C!=null)if(g)t[`__${I}`]=C,Mi([I]);else{let k=function(T){c[S].call(this,T)};c[x]=mk(I,t,k,_)}else g&&(t[`__${I}`]=void 0)}else if(S==="style")wn(t,S,C);else if(S==="autofocus")l9(t,!!C);else if(!a&&(S==="__value"||S==="value"&&C!=null))t.value=t.__value=C;else if(S==="selected"&&u)z9(t,C);else{var y=S;l||(y=T9(y));var b=y==="defaultValue"||y==="defaultChecked";if(C==null&&!a&&!b)if(o[S]=null,y==="value"||y==="checked"){let _=t;const x=e===void 0;if(y==="value"){let I=_.defaultValue;_.removeAttribute(y),_.defaultValue=I,_.value=_.__value=x?I:null}else{let I=_.defaultChecked;_.removeAttribute(y),_.defaultChecked=I,_.checked=x?I:!1}}else t.removeAttribute(S);else b||f.includes(y)&&(a||typeof C!="string")?(t[y]=C,y in o&&(o[y]=br)):typeof C!="function"&&wn(t,y,C)}}}return c}function kr(t,e,n=[],r=[],i=[],s,o=!1,a=!1){I4(i,n,r,l=>{var c=void 0,u={},d=t.nodeName==="SELECT",f=!1;if(V4(()=>{var p=e(...l.map(E)),m=U9(t,c,p,s,o,a);f&&d&&"value"in p&&P0(t,p.value);for(let y of Object.getOwnPropertySymbols(u))p[y]||Ar(u[y]);for(let y of Object.getOwnPropertySymbols(p)){var g=p[y];y.description===w4&&(!c||g!==c[y])&&(u[y]&&Ar(u[y]),u[y]=Hi(()=>D9(t,()=>g))),m[y]=g}c=m}),d){var h=t;Pm(()=>{P0(h,c.value,!0),aM(h)})}f=!0})}function Bb(t){return t.__attributes??={[lM]:t.nodeName.includes("-"),[cM]:t.namespaceURI===B7}}var X_=new Map;function dM(t){var e=t.getAttribute("is")||t.nodeName,n=X_.get(e);if(n)return n;X_.set(e,n=[]);for(var r,i=t,s=Element.prototype;s!==i;){r=d4(i);for(var o in r)r[o].set&&n.push(o);i=Mb(i)}return n}function H9(t,e,n=e){var r=new WeakSet;fk(t,"input",async i=>{var s=i?t.defaultValue:t.value;if(s=Av(t)?Pv(s):s,n(s),dn!==null&&r.add(dn),await ul(),s!==(s=e())){var o=t.selectionStart,a=t.selectionEnd,l=t.value.length;if(t.value=s??"",a!==null){var c=t.value.length;o===a&&a===l&&c>l?(t.selectionStart=c,t.selectionEnd=c):(t.selectionStart=o,t.selectionEnd=Math.min(a,c))}}}),ms(e)==null&&t.value&&(n(Av(t)?Pv(t.value):t.value),dn!==null&&r.add(dn)),Im(()=>{var i=e();if(t===document.activeElement){var s=gp??dn;if(r.has(s))return}Av(t)&&i===Pv(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function V9(t,e,n=e){fk(t,"change",r=>{var i=r?t.defaultChecked:t.checked;n(i)}),ms(e)==null&&n(t.checked),Im(()=>{var r=e();t.checked=!!r})}function Av(t){var e=t.type;return e==="number"||e==="range"}function Pv(t){return t===""?null:+t}function Q_(t,e){return t===e||t?.[Ko]===e}function gr(t={},e,n,r){return Pm(()=>{var i,s;return Im(()=>{i=s,s=[],ms(()=>{t!==n(...s)&&(e(t,...s),i&&Q_(n(...i),t)&&e(null,...i))})}),()=>{pd(()=>{s&&Q_(n(...s),t)&&e(null,...s)})}}),t}function yk(t,e,n){if(t==null)return e(void 0),n&&n(void 0),Ft;const r=ms(()=>t.subscribe(e,n));return r.unsubscribe?()=>r.unsubscribe():r}const Pd=[];function fM(t,e){return{subscribe:Ds(t,e).subscribe}}function Ds(t,e=Ft){let n=null;const r=new Set;function i(a){if(lk(t,a)&&(t=a,n)){const l=!Pd.length;for(const c of r)c[1](),Pd.push(c,t);if(l){for(let c=0;c<Pd.length;c+=2)Pd[c][0](Pd[c+1]);Pd.length=0}}}function s(a){i(a(t))}function o(a,l=Ft){const c=[a,l];return r.add(c),r.size===1&&(n=e(i,s)||Ft),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:i,update:s,subscribe:o}}function nl(t,e,n){const r=!Array.isArray(t),i=r?[t]:t;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const s=e.length<2;return fM(n,(o,a)=>{let l=!1;const c=[];let u=0,d=Ft;const f=()=>{if(u)return;d();const p=e(r?c[0]:c,o,a);s?o(p):d=typeof p=="function"?p:Ft},h=i.map((p,m)=>yk(p,g=>{c[m]=g,u&=~(1<<m),l&&f()},()=>{u|=1<<m}));return l=!0,f(),function(){h4(h),d(),l=!1}})}function oo(t){let e;return yk(t,n=>e=n)(),e}let kg=!1,Y2=Symbol();function Xn(t,e,n){const r=n[e]??={store:null,source:D4(void 0),unsubscribe:Ft};if(r.store!==t&&!(Y2 in n))if(r.unsubscribe(),r.store=t??null,t==null)r.source.v=void 0,r.unsubscribe=Ft;else{var i=!0;r.unsubscribe=yk(t,s=>{i?r.source.v=s:K(r.source,s)}),i=!1}return t&&Y2 in n?oo(t):E(r.source)}function hi(){const t={};function e(){Am(()=>{for(var n in t)t[n].unsubscribe();u4(t,Y2,{enumerable:!1,value:!0})})}return[t,e]}function W9(t){var e=kg;try{return kg=!1,[t(),kg]}finally{kg=e}}const j9={get(t,e){if(!t.exclude.includes(e))return t.props[e]},set(t,e){return!1},getOwnPropertyDescriptor(t,e){if(!t.exclude.includes(e)&&e in t.props)return{enumerable:!0,configurable:!0,value:t.props[e]}},has(t,e){return t.exclude.includes(e)?!1:e in t.props},ownKeys(t){return Reflect.ownKeys(t.props).filter(e=>!t.exclude.includes(e))}};function Ni(t,e,n){return new Proxy({props:t,exclude:e},j9)}const q9={get(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(Mh(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r)return r[e]}},set(t,e,n){let r=t.props.length;for(;r--;){let i=t.props[r];Mh(i)&&(i=i());const s=xc(i,e);if(s&&s.set)return s.set(n),!0}return!1},getOwnPropertyDescriptor(t,e){let n=t.props.length;for(;n--;){let r=t.props[n];if(Mh(r)&&(r=r()),typeof r=="object"&&r!==null&&e in r){const i=xc(r,e);return i&&!i.configurable&&(i.configurable=!0),i}}},has(t,e){if(e===Ko||e===y4)return!1;for(let n of t.props)if(Mh(n)&&(n=n()),n!=null&&e in n)return!0;return!1},ownKeys(t){const e=[];for(let n of t.props)if(Mh(n)&&(n=n()),!!n){for(const r in n)e.includes(r)||e.push(r);for(const r of Object.getOwnPropertySymbols(n))e.includes(r)||e.push(r)}return e}};function Qn(...t){return new Proxy({props:t},q9)}function le(t,e,n,r){var i=(n&N7)!==0,s=(n&R7)!==0,o=r,a=!0,l=()=>(a&&(a=!1,o=s?ms(r):r),o),c;if(i){var u=Ko in t||y4 in t;c=xc(t,e)?.set??(u&&e in t?b=>t[e]=b:void 0)}var d,f=!1;i?[d,f]=W9(()=>t[e]):d=t[e],d===void 0&&r!==void 0&&(d=l(),c&&(S7(),c(d)));var h;if(h=()=>{var b=t[e];return b===void 0?l():(a=!0,b)},(n&M7)===0)return h;if(c){var p=t.$$legacy;return(function(b,S){return arguments.length>0?((!S||p||f)&&c(S?h():b),b):h()})}var m=!1,g=((n&O7)!==0?Db:O4)(()=>(m=!1,h()));i&&E(g);var y=pn;return(function(b,S){if(arguments.length>0){const C=S?E(g):i?Wt(b):b;return K(g,C),m=!0,o!==void 0&&(o=C),b}return Bc&&m||(y.f&Ja)!==0?g.v:E(g)})}function bs(t){Zr===null&&ak(),Ge(()=>{const e=ms(t);if(typeof e=="function")return e})}function Zu(t){Zr===null&&ak(),bs(()=>()=>ms(t))}const K9="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(K9);var G9=Object.defineProperty,Z9=(t,e,n)=>e in t?G9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,lt=(t,e,n)=>(Z9(t,typeof e!="symbol"?e+"":e,n),n);let Nm=class extends Error{},Y_=class extends Nm{constructor(e){super(`RxNostrWebSocketError: WebSocket was closed with code ${e} by relay.`),this.code=e,this.name="RxNostrWebSocketError"}},s0=class extends Nm{constructor(e){super(`RxNostrInvalidUsageError: ${e}`),this.name="RxNostrInvalidUsageError"}},Iv=class extends Nm{constructor(e){super(`RxNostrEnvironmentError: ${e}`),this.name="RxNostrEnvironmentError"}},hM=class extends Nm{constructor(){super("RxNostrLogicError: This is rx-nostr's internal bug. Please report to the author of the library."),this.name="RxNostrLogicError"}},Aa=class extends Nm{constructor(){super("RxNostrAlreadyDisposedError: Attempted to access a disposed resource."),this.name="RxNostrAlreadyDisposedError"}};const Rm=(t,e)=>({...e,...t});function X9(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function Ov(t){throw t}function Q9(t){return{async signEvent(e){var n,r;const i={...e,pubkey:e.pubkey??await((n=window?.nostr)==null?void 0:n.getPublicKey())??Ov(new Iv("window.nostr.getPublicKey() is not found")),tags:[...e.tags??[]],created_at:e.created_at??Math.floor(Date.now()/1e3)};return X9(i)?i:await((r=window?.nostr)==null?void 0:r.signEvent(i))??Ov(new Iv("window.nostr.signEvent() is not found"))},getPublicKey(){var e;return((e=window?.nostr)==null?void 0:e.getPublicKey())??Ov(new Iv("window.nostr.getPublicKey() is not found"))}}}const Y9=t=>Rm(t,{signer:Q9(),connectionStrategy:"lazy",retry:{strategy:"exponential",maxCount:5,initialDelay:1e3},disconnectTimeout:1e4,eoseTimeout:30*1e3,okTimeout:30*1e3,authTimeout:30*1e3,skipVerify:!1,skipValidateFilterMatching:!1,skipExpirationCheck:!1,skipFetchNip11:!1});function J9(t){return"length"in t?t.map(J_):[J_(t)]}function J_(t){return{...t,since:t.since?eA(t.since):void 0,until:t.until?eA(t.until):void 0}}function eA(t){return typeof t=="number"?t:t()}async function eH(t){try{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws(s?):/,"http$1:"),await(await fetch(e.toString(),{headers:{Accept:"application/nostr+json"}})).json()}catch{return{}}}function tA(t,e){try{return t()}catch(n){return e instanceof Function?e(n):e}}function Ra(t){let e="";try{e=t.trim();const n=new URL(e);n.hash="",n.pathname=tA(()=>decodeURI(n.pathname),n.pathname),n.pathname=n.pathname.replace(/\/$/,""),n.hostname=n.hostname.replace(/\.$/,""),n.searchParams.sort(),n.search=tA(()=>decodeURIComponent(n.search),n.search);let r=n.toString();return n.search||(r=r.replace(/\/$/,"")),r}catch{return e}}let o0=class pM extends Map{constructor(e){if(super(),!!e)for(const[n,r]of Object.entries(e))this.set(Ra(n),r)}get(e){return super.get(Ra(e))}getMany(e){const n=[];for(const r of new Set(e.map(Ra))){const i=this.get(r);i!==void 0&&n.push(i)}return n}set(e,n){return super.set(Ra(e),n)}has(e){return super.has(Ra(e))}delete(e){return super.delete(Ra(e))}toObject(){const e={};for(const[n,r]of this.entries())e[n]=r;return e}toKeys(){return[...super.keys()]}toValues(){return[...super.values()]}copy(){return new pM(this.toObject())}},I0=class{static async getValue(e,n,r){if(!(r!=null&&r.skipCache)){const i=await this.cache.get(e);if(i)return n(i)}if(!(r!=null&&r.skipFetch)){const i=await this.fetch(e);if(i)return n(i)}return n(this.default)}static get(e){const n=this.cache.get(e);if(n&&!(n instanceof Promise))return n}static async fetch(e){const n=eH(e);return this.cache.set(e,n),n.then(r=>{this.cache.set(e,r)}),n}static async getOrFetch(e){return this.cache.get(e)??this.fetch(e)}static set(e,n){this.cache.set(e,n)}static getDefault(){return this.default}static setDefault(e){this.default=e}static forget(e){this.cache.delete(e)}static forgetAll(){this.cache.clear()}};lt(I0,"cache",new o0),lt(I0,"default",{});new Uint8Array(new Uint32Array([287454020]).buffer)[0];function tH(t,e,n){return Array.isArray(e)?e.some(r=>nA(t,r)):nA(t,e)}function nA(t,e,n){const{sinceInclusive:r,untilInclusive:i}=Rm({},{sinceInclusive:!0,untilInclusive:!0});if(e.ids&&e.ids.every(s=>!t.id.startsWith(s))||e.kinds&&!e.kinds.includes(t.kind)||e.authors&&e.authors.every(s=>!t.pubkey.startsWith(s))||e.since&&(r&&!(e.since<=t.created_at)||!r&&!(e.since<t.created_at))||e.until&&(i&&!(t.created_at<=e.until)||!i&&!(t.created_at<e.until)))return!1;for(const[s,o]of Object.entries(e)){if(!s.startsWith("#")||!Array.isArray(o))continue;const a=s.slice(1);if(!t.tags.find(([l,c])=>a===l&&o.includes(c)))return!1}return!0}function nH(t,e){const n=t.tags.find(r=>r[0]==="expiration");if(!n)return!1;try{const r=Number(n[1]);return Number.isInteger(r)?r<=(e??Math.floor(Date.now()/1e3)):!1}catch{return!1}}var J2=function(t,e){return J2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},J2(t,e)};function bl(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");J2(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function rH(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):i(u.value).then(a,l)}c((r=r.apply(t,[])).next())})}function mM(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Nf(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rf(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Df(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function ff(t){return this instanceof ff?(this.v=t,this):new ff(t)}function iH(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(h){return new Promise(function(p,m){s.push([f,h,p,m])>1||a(f,h)})})}function a(f,h){try{l(r[f](h))}catch(p){d(s[0][3],p)}}function l(f){f.value instanceof ff?Promise.resolve(f.value.v).then(c,u):d(s[0][2],f)}function c(f){a("next",f)}function u(f){a("throw",f)}function d(f,h){f(h),s.shift(),s.length&&a(s[0][0],s[0][1])}}function sH(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Nf=="function"?Nf(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),i(a,l,o.done,o.value)})}}function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function sr(t){return typeof t=="function"}function Fb(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Mv=Fb(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function O0(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Dm=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Nf(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(m){e={error:m}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(sr(u))try{u()}catch(m){s=m instanceof Mv?m.errors:[m]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Nf(d),h=f.next();!h.done;h=f.next()){var p=h.value;try{rA(p)}catch(m){s=s??[],m instanceof Mv?s=Df(Df([],Rf(s)),Rf(m.errors)):s.push(m)}}}catch(m){r={error:m}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}if(s)throw new Mv(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)rA(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&O0(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&O0(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),gM=Dm.EMPTY;function yM(t){return t instanceof Dm||t&&"closed"in t&&sr(t.remove)&&sr(t.add)&&sr(t.unsubscribe)}function rA(t){sr(t)?t():t.unsubscribe()}var oH={Promise:void 0},aH={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Df([t,e],Rf(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function bM(t){aH.setTimeout(function(){throw t})}function ex(){}function a0(t){t()}var bk=(function(t){bl(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,yM(n)&&n.add(r)):r.destination=uH,r}return e.create=function(n,r,i){return new M0(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(Dm),lH=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Eg(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Eg(r)}else Eg(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Eg(n)}},t})(),M0=(function(t){bl(e,t);function e(n,r,i){var s=t.call(this)||this,o;return sr(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new lH(o),s}return e})(bk);function Eg(t){bM(t)}function cH(t){throw t}var uH={closed:!0,next:ex,error:cH,complete:ex},wk=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function wl(t){return t}function dH(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wM(t)}function wM(t){return t.length===0?wl:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var Yi=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=hH(e)?e:new M0(e,n,r);return a0(function(){var o=i,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=iA(n),new n(function(i,s){var o=new M0({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[wk]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return wM(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=iA(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function iA(t){var e;return(e=t??oH.Promise)!==null&&e!==void 0?e:Promise}function fH(t){return t&&sr(t.next)&&sr(t.error)&&sr(t.complete)}function hH(t){return t&&t instanceof bk||fH(t)&&yM(t)}function pH(t){return sr(t?.lift)}function pi(t){return function(e){if(pH(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Qr(t,e,n,r,i){return new mH(t,e,n,r,i)}var mH=(function(t){bl(e,t);function e(n,r,i,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=r?function(c){try{r(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=i?function(){try{i()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(bk),gH=Fb(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Gn=(function(t){bl(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new sA(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new gH},e.prototype.next=function(n){var r=this;a0(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Nf(r.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){i={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;a0(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;a0(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?gM:(this.currentObservers=null,a.push(n),new Dm(function(){r.currentObservers=null,O0(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Yi;return n.source=this,n},e.create=function(n,r){return new sA(n,r)},e})(Yi),sA=(function(t){bl(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:gM},e})(Gn),yH=(function(t){bl(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(Gn),bH={now:function(){return Date.now()}},wH=(function(t){bl(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(Dm),tx={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=tx.delegate;return i!=null&&i.setInterval?i.setInterval.apply(i,Df([t,e],Rf(n))):setInterval.apply(void 0,Df([t,e],Rf(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},vH=(function(t){bl(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),tx.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&tx.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,O0(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(wH),oA=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=bH.now,t})(),xH=(function(t){bl(e,t);function e(n,r){r===void 0&&(r=oA.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(oA),vM=new xH(vH),SH=vM,Lm=new Yi(function(t){return t.complete()});function kH(t){return t&&sr(t.schedule)}function vk(t){return t[t.length-1]}function EH(t){return sr(vk(t))?t.pop():void 0}function xk(t){return kH(vk(t))?t.pop():void 0}function TH(t,e){return typeof vk(t)=="number"?t.pop():e}var xM=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function SM(t){return sr(t?.then)}function kM(t){return sr(t[wk])}function EM(t){return Symbol.asyncIterator&&sr(t?.[Symbol.asyncIterator])}function TM(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function CH(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var CM=CH();function _M(t){return sr(t?.[CM])}function AM(t){return iH(this,arguments,function(){var e,n,r,i;return mM(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,ff(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,ff(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,ff(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function PM(t){return sr(t?.getReader)}function oa(t){if(t instanceof Yi)return t;if(t!=null){if(kM(t))return _H(t);if(xM(t))return AH(t);if(SM(t))return PH(t);if(EM(t))return IM(t);if(_M(t))return IH(t);if(PM(t))return OH(t)}throw TM(t)}function _H(t){return new Yi(function(e){var n=t[wk]();if(sr(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function AH(t){return new Yi(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function PH(t){return new Yi(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,bM)})}function IH(t){return new Yi(function(e){var n,r;try{for(var i=Nf(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function IM(t){return new Yi(function(e){MH(t,e).catch(function(n){return e.error(n)})})}function OH(t){return IM(AM(t))}function MH(t,e){var n,r,i,s;return rH(this,void 0,void 0,function(){var o,a;return mM(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=sH(t),l.label=1;case 1:return[4,n.next()];case 2:if(r=l.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),i={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Zo(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function OM(t,e){return e===void 0&&(e=0),pi(function(n,r){n.subscribe(Qr(r,function(i){return Zo(r,t,function(){return r.next(i)},e)},function(){return Zo(r,t,function(){return r.complete()},e)},function(i){return Zo(r,t,function(){return r.error(i)},e)}))})}function MM(t,e){return e===void 0&&(e=0),pi(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function NH(t,e){return oa(t).pipe(MM(e),OM(e))}function RH(t,e){return oa(t).pipe(MM(e),OM(e))}function DH(t,e){return new Yi(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function LH(t,e){return new Yi(function(n){var r;return Zo(n,e,function(){r=t[CM](),Zo(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return sr(r?.return)&&r.return()}})}function NM(t,e){if(!t)throw new Error("Iterable cannot be null");return new Yi(function(n){Zo(n,e,function(){var r=t[Symbol.asyncIterator]();Zo(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function BH(t,e){return NM(AM(t),e)}function FH(t,e){if(t!=null){if(kM(t))return NH(t,e);if(xM(t))return DH(t,e);if(SM(t))return RH(t,e);if(EM(t))return NM(t,e);if(_M(t))return LH(t,e);if(PM(t))return BH(t,e)}throw TM(t)}function Bm(t,e){return e?FH(t,e):oa(t)}function RM(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=xk(t);return Bm(t,n)}var Sk=Fb(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function DM(t,e){return new Promise(function(n,r){var i=new M0({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new Sk)}});t.subscribe(i)})}function LM(t){return t instanceof Date&&!isNaN(t)}var BM=Fb(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function FM(t,e){var n=LM(t)?{first:t}:typeof t=="number"?{each:t}:t,r=n.first,i=n.each,s=n.with,o=s===void 0?$H:s,a=n.scheduler,l=a===void 0?vM:a,c=n.meta,u=c===void 0?null:c;if(r==null&&i==null)throw new TypeError("No timeout provided.");return pi(function(d,f){var h,p,m=null,g=0,y=function(b){p=Zo(f,l,function(){try{h.unsubscribe(),oa(o({meta:u,lastValue:m,seen:g})).subscribe(f)}catch(S){f.error(S)}},b)};h=d.subscribe(Qr(f,function(b){p?.unsubscribe(),g++,f.next(m=b),i>0&&y(i)},void 0,void 0,function(){p!=null&&p.closed||p==null||p.unsubscribe(),m=null})),!g&&y(r!=null?typeof r=="number"?r:+r-l.now():i)})}function $H(t){throw new BM(t)}function Ec(t,e){return pi(function(n,r){var i=0;n.subscribe(Qr(r,function(s){r.next(t.call(e,s,i++))}))})}var zH=Array.isArray;function UH(t,e){return zH(e)?t.apply(void 0,Df([],Rf(e))):t(e)}function HH(t){return Ec(function(e){return UH(t,e)})}var VH=Array.isArray,WH=Object.getPrototypeOf,jH=Object.prototype,qH=Object.keys;function KH(t){if(t.length===1){var e=t[0];if(VH(e))return{args:e,keys:null};if(GH(e)){var n=qH(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function GH(t){return t&&typeof t=="object"&&WH(t)===jH}function ZH(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function XH(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=xk(t),r=EH(t),i=KH(t),s=i.args,o=i.keys;if(s.length===0)return Bm([],n);var a=new Yi(QH(s,n,o?function(l){return ZH(o,l)}:wl));return r?a.pipe(HH(r)):a}function QH(t,e,n){return n===void 0&&(n=wl),function(r){aA(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,l=function(u){aA(e,function(){var d=Bm(t[u],e),f=!1;d.subscribe(Qr(r,function(h){s[u]=h,f||(f=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},c=0;c<i;c++)l(c)},r)}}function aA(t,e,n){t?Zo(n,t,e):e()}function YH(t,e,n,r,i,s,o,a){var l=[],c=0,u=0,d=!1,f=function(){d&&!l.length&&!c&&e.complete()},h=function(m){return c<r?p(m):l.push(m)},p=function(m){c++;var g=!1;oa(n(m,u++)).subscribe(Qr(e,function(y){e.next(y)},function(){g=!0},void 0,function(){if(g)try{c--;for(var y=function(){var b=l.shift();o?Zo(e,o,function(){return p(b)}):p(b)};l.length&&c<r;)y();f()}catch(b){e.error(b)}}))};return t.subscribe(Qr(e,h,function(){d=!0,f()})),function(){}}function N0(t,e,n){return n===void 0&&(n=1/0),sr(e)?N0(function(r,i){return Ec(function(s,o){return e(r,s,i,o)})(oa(t(r,i)))},n):(typeof e=="number"&&(n=e),pi(function(r,i){return YH(r,i,t,n)}))}function $M(t){return t===void 0&&(t=1/0),N0(wl,t)}function lA(t,e,n){return t===void 0&&(t=0),n===void 0&&(n=SH),new Yi(function(r){var i=LM(t)?+t-n.now():t;i<0&&(i=0);var s=0;return n.schedule(function(){r.closed||(r.next(s++),r.complete())},i)})}function JH(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=xk(t),r=TH(t,1/0),i=t;return i.length?i.length===1?oa(i[0]):$M(r)(Bm(i,n)):Lm}function Ns(t,e){return pi(function(n,r){var i=0;n.subscribe(Qr(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function zM(t){return pi(function(e,n){var r=null,i=!1,s;r=e.subscribe(Qr(n,void 0,void 0,function(o){s=oa(t(o,zM(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function eV(t){return pi(function(e,n){var r=!1;e.subscribe(Qr(n,function(i){r=!0,n.next(i)},function(){r||n.next(t),n.complete()}))})}function tV(t){return t<=0?function(){return Lm}:pi(function(e,n){var r=0;e.subscribe(Qr(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function nV(t,e){return e===void 0&&(e=wl),t=t??rV,pi(function(n,r){var i,s=!0;n.subscribe(Qr(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function rV(t,e){return t===e}function iV(t){return t===void 0&&(t=sV),pi(function(e,n){var r=!1;e.subscribe(Qr(n,function(i){r=!0,n.next(i)},function(){return r?n.complete():n.error(t())}))})}function sV(){return new Sk}function Nv(t){return pi(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function nx(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?Ns(function(i,s){return t(i,s,r)}):wl,tV(1),n?eV(e):iV(function(){return new Sk}))}}function oV(t,e){return pi(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Qr(r,function(l){i?.unsubscribe();var c=0,u=s++;oa(t(l,u)).subscribe(i=Qr(r,function(d){return r.next(e?e(l,d,u,c++):d)},function(){i=null,a()}))},function(){o=!0,a()}))})}function aV(){return oV(wl)}function Dh(t){return pi(function(e,n){oa(t).subscribe(Qr(n,function(){return n.complete()},ex)),!n.closed&&e.subscribe(n)})}function lV(t,e){return pi(function(n,r){var i=0;n.subscribe(Qr(r,function(s){var o=t(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function Tg(t,e,n){var r=sr(t)||e||n?{next:t,error:e,complete:n}:t;return r?pi(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Qr(s,function(l){var c;(c=r.next)===null||c===void 0||c.call(r,l),s.next(l)},function(){var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),s.complete()},function(l){var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),s.error(l)},function(){var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):wl}function cV(t){return N0((e,n)=>Bm(t(e,n)).pipe(N0(r=>r?RM(e):Lm)))}function cA(t){return dH(FM(t),zM(e=>{if(e instanceof BM)return Lm;throw e}))}function Rv(t,e){const{not:n}=Rm(e,{not:!1});return Ns(r=>uV(r.subId===t,n))}function uV(t,e){return!t&&e||t&&!e}let dV=class{constructor(e){lt(this,"relay"),lt(this,"config"),lt(this,"authenticator"),lt(this,"ongoings",new Set),lt(this,"authResult$",new Gn),lt(this,"disposed",!1),this.relay=e.relay,this.config=e.config,this.authenticator=e.authenticator;const n=this.relay.getOKObservable().subscribe(i=>{const{eventId:s,ok:o}=i;this.ongoings.has(s)&&(this.ongoings.delete(s),this.authResult$.next(o),o||(n.unsubscribe(),r.unsubscribe()))}),r=this.relay.getAUTHObservable().subscribe(({challenge:i})=>{this.challenge(i)})}getAuthResultObservable(){return this.authResult$.asObservable()}async challenge(e){try{const n=await this.signer.signEvent({kind:22242,content:"",tags:[["relay",this.relay.url],["challenge",e]]});this.ongoings.add(n.id),this.relay.send(["AUTH",n])}catch{this.authResult$.next(!1)}}get signer(){return this.authenticator.signer??this.config.signer}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.authResult$];for(const n of e)n.complete()}},UM=class extends yH{constructor(e){super(e??0)}increment(){this.next(this.getValue()+1)}decrement(){this.next(this.getValue()-1)}next(e){typeof e=="number"?super.next(e):super.next(e(this.getValue()))}},fV=class extends Gn{waitNext(){return DM(this.pipe(nx(null,void 0)))}},hV=class{constructor(e){lt(this,"relay"),lt(this,"authProxy"),lt(this,"pubs",new Map),lt(this,"authRequiredPubs",new Set),lt(this,"count$",new UM(0)),lt(this,"ok$",new Gn),lt(this,"disposed",!1);var n;this.relay=e.relay,this.authProxy=e.authProxy,this.relay.getReconnectedObservable().subscribe(r=>{for(const[i,s]of r)i==="EVENT"&&this.pubs.has(s.id)&&this.sendEVENT(s)}),this.relay.getOKObservable().subscribe(async r=>{const{eventId:i,notice:s}=r;this.pubs.get(i)&&(this.authProxy&&s!=null&&s.startsWith("auth-required:")?(this.authRequiredPubs.add(i),this.ok$.next({...r,done:!1})):(this.ok$.next({...r,done:!0}),this.confirmOK(i)))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{if(r)for(const i of this.authRequiredPubs){const s=this.pubs.get(i);s&&this.sendEVENT(s)}else for(const i of this.authRequiredPubs)this.confirmOK(i);this.authRequiredPubs.clear()})}async publish(e){if(!this.disposed)return this.pubs.has(e.id)||(this.pubs.set(e.id,e),this.count$.increment()),this.sendEVENT(e)}confirmOK(e){this.disposed||this.pubs.has(e)||(this.pubs.delete(e),this.count$.decrement())}getOkAgainstEventObservable(){return this.ok$.asObservable()}getLogicalConnectionSizeObservable(){return this.count$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.count$,this.ok$];for(const n of e)n.complete()}sendEVENT(e){return this.relay.send(["EVENT",e])}};const uA={OPEN:1};let pV=class{constructor(e,n){lt(this,"socket",null),lt(this,"buffer",[]),lt(this,"unsent",[]),lt(this,"reconnected$",new Gn),lt(this,"outgoing$",new Gn),lt(this,"message$",new Gn),lt(this,"error$",new Gn),lt(this,"retryTimer",null),lt(this,"sendAttempted$",new fV),lt(this,"isFirstTry",!0),lt(this,"maybeDown",!1),lt(this,"disposed",!1),lt(this,"state$",new Gn),lt(this,"_state","initialized"),this.url=e,this.config=n,n.skipFetchNip11||I0.getOrFetch(e),this.setState("initialized")}get state(){return this._state}setState(e){this._state=e,this.state$.next(e)}connectManually(){this.connect()}connect(e){if(this.state==="terminated")return;const n=typeof e=="number";(this.state==="initialized"||this.state==="dormant"||this.state==="error"||this.state==="rejected"||n)&&(this.socket=this.createSocket(e??0))}createSocket(e){const n=this.isFirstTry;this.isFirstTry=!1;let r=!1;const i=e>0,s=!i&&(this.state==="error"||this.state==="rejected");i?this.setState("retrying"):this.setState("connecting");const o=async()=>{if(this.state==="terminated"){u?.close($d.RX_NOSTR_DISPOSED);return}this.setState("connected"),r=!0,e=0,(i||s)&&(this.reconnected$.next(this.unsent),this.unsent=[]);try{for(const d of this.buffer)this.send(d)}catch(d){this.error$.next(d)}finally{this.buffer=[]}},a=({data:d})=>{if(this.state!=="terminated")try{this.message$.next(this.pack(JSON.parse(d)))}catch(f){this.error$.next(f)}},l=({code:d})=>{var f;if(u?.removeEventListener("open",o),u?.removeEventListener("message",a),u?.removeEventListener("close",l),this.socket===u&&(this.socket=null),this.state==="terminated"||d===$d.RX_NOSTR_DISPOSED){this.unsent=[],this.buffer=[];return}if(d===$d.RX_NOSTR_IDLE)this.setState("dormant"),this.buffer.length>0&&this.connect();else if(d===$d.DONT_RETRY)this.unsent=[],this.buffer=[],this.error$.next(new Y_(d)),this.setState("rejected");else{n&&!r&&(this.maybeDown=!0),this.unsent.push(...this.buffer),this.buffer=[],this.error$.next(new Y_(d));const h=e+1;this.config.retry.strategy!=="off"&&!(this.config.retry.polite&&this.maybeDown)&&h<=this.config.retry.maxCount?(this.setState("waiting-for-retrying"),(f=this.retryTimer)==null||f.unsubscribe(),this.retryTimer=mV(this.config.retry,h).subscribe(()=>{this.disposed||this.connect(h)})):this.setState("error")}},c=this.config.websocketCtor??globalThis.WebSocket;if(!c)throw new s0("WebSocket constructor is missing");const u=(()=>{try{return new c(this.url)}catch{return l({code:0}),null}})();return u?.addEventListener("open",o),u?.addEventListener("message",a),u?.addEventListener("close",l),u}pack(e){const n=e[0],r=this.url;switch(n){case"EVENT":return{from:r,type:n,message:e,subId:e[1],event:e[2]};case"EOSE":return{from:r,type:n,message:e,subId:e[1]};case"OK":return{from:r,type:n,message:e,eventId:e[1],ok:e[2],notice:e[3]};case"CLOSED":return{from:r,type:n,message:e,subId:e[1],notice:e[2]};case"NOTICE":return{from:r,type:n,message:e,notice:e[1]};case"AUTH":return{from:r,type:n,message:e,challenge:e[1]};case"COUNT":return{from:r,type:n,message:e,subId:e[1],count:e[2]};default:return{from:r,type:"unknown",message:e}}}disconnect(e){var n;((n=this.socket)==null?void 0:n.readyState)===uA.OPEN&&this.socket.close(e)}send(e){const n=this.sendAttempted$.waitNext();switch(this.state){case"terminated":case"rejected":return this.sendAttempted$.next(),n;case"initialized":case"connecting":case"dormant":return this.buffer.push(e),this.connect(),n;case"connected":{if(!this.socket)throw new hM;return this.socket.readyState===uA.OPEN?(this.outgoing$.next({to:this.url,message:e}),this.socket.send(JSON.stringify(e)),this.sendAttempted$.next(),n):(this.buffer.push(e),n)}case"waiting-for-retrying":case"retrying":case"error":return this.sendAttempted$.next(),this.unsent.push(e),n}}getEVENTObservable(){return this.message$.pipe(Ns(e=>e.type==="EVENT"))}getEOSEObservable(){return this.message$.pipe(Ns(e=>e.type==="EOSE"))}getCLOSEDObservable(){return this.message$.pipe(Ns(e=>e.type==="CLOSED"))}getOKObservable(){return this.message$.pipe(Ns(e=>e.type==="OK"))}getAUTHObservable(){return this.message$.pipe(Ns(e=>e.type==="AUTH"))}getAllMessageObservable(){return this.message$.asObservable()}getOutgoingMessageObservable(){return this.outgoing$.asObservable()}getReconnectedObservable(){return this.reconnected$.asObservable()}getConnectionStateObservable(){return this.state$.pipe(nV(),Ec(e=>({from:this.url,state:e})))}getErrorObservable(){return this.error$.asObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){var e,n;if(this.disposed)return;this.disposed=!0,this.setState("terminated"),(e=this.retryTimer)==null||e.unsubscribe(),(n=this.socket)==null||n.close($d.RX_NOSTR_DISPOSED),this.socket=null;const r=[this.state$,this.outgoing$,this.message$,this.error$,this.reconnected$,this.sendAttempted$];for(const i of r)i.complete()}};function mV(t,e){switch(t.strategy){case"exponential":{const n=Math.max(t.initialDelay*2**(e-1)+(Math.random()-.5)*1e3,1e3);return lA(n)}case"immediately":return RM(0);case"linear":return lA(t.interval);case"off":return Lm}}const $d={DONT_RETRY:4e3,RX_NOSTR_IDLE:4537,RX_NOSTR_DISPOSED:4538};let gV=class{constructor(e){lt(this,"relay"),lt(this,"authProxy"),lt(this,"config"),lt(this,"subs",new Map),lt(this,"authRequiredSubs",new Set),lt(this,"fin$",new Gn),lt(this,"disposed",!1),lt(this,"queue");var n;this.relay=e.relay,this.authProxy=e.authProxy,this.config=e.config,this.queue=new yV(this.relay.url,this.config),this.queue.getActivationObservable().subscribe(r=>{for(const{req:i}of r)this.sendREQ(i)}),this.relay.getReconnectedObservable().subscribe(()=>{for(const{req:r}of this.queue.ongoings)this.sendREQ(r)}),this.relay.getEOSEObservable().subscribe(({subId:r})=>{var i;(i=this.subs.get(r))!=null&&i.autoclose&&this.unsubscribe(r)}),this.relay.getCLOSEDObservable().subscribe(async({subId:r,notice:i})=>{this.subs.get(r)&&(this.authProxy&&i!=null&&i.startsWith("auth-required:")?this.authRequiredSubs.add(r):this.fin(r))}),(n=this.authProxy)==null||n.getAuthResultObservable().subscribe(r=>{var i;if(r)for(const s of this.authRequiredSubs){const o=(i=this.subs.get(s))==null?void 0:i.req;o&&this.sendREQ(o)}else for(const s of this.authRequiredSubs)this.fin(s);this.authRequiredSubs.clear()})}subscribe(e,n){if(this.disposed)return;const r=e[1],i={subId:r,req:e,autoclose:n};this.subs.set(r,i),this.queue.enqueue(i)}unsubscribe(e){this.disposed||(this.subs.has(e)&&this.sendCLOSE(e),this.fin(e))}isOngoingOrQueued(e){return this.subs.has(e)}getEventObservable(){return this.relay.getEVENTObservable().pipe(Ns(({subId:e,event:n})=>{var r;const i=(r=this.subs.get(e))==null?void 0:r.filters;return i?this.config.skipValidateFilterMatching||tH(n,i):!1}))}getFinObservable(){return this.fin$.asObservable()}getLogicalConnectionSizeObservable(){return this.queue.getSizeObservable()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;const e=[this.fin$];for(const n of e)n.complete();this.queue.dispose()}sendREQ([,e,...n]){const r=J9(n),i=this.subs.get(e);i&&(i.filters=r,this.relay.send(["REQ",e,...r]))}sendCLOSE(e){this.relay.send(["CLOSE",e])}fin(e){this.subs.delete(e),this.queue.drop(e),this.fin$.next({from:this.relay.url,subId:e})}},yV=class{constructor(e,n){lt(this,"_queuings",[]),lt(this,"_ongoings",[]),lt(this,"activated$",new Gn),lt(this,"count$",new UM),this.url=e,this.config=n}get queuings(){return this._queuings}set queuings(e){this._queuings=e}get ongoings(){return this._ongoings}set ongoings(e){this._ongoings=e}enqueue(e){this.queuings=[...this.queuings,e],this.count$.increment(),this.shift()}drop(e){const n=(a,l)=>{const c=a.length,u=a.filter(f=>f.subId!==l),d=c-u.length;return[u,d]},[r,i]=n(this.queuings,e),[s,o]=n(this.ongoings,e);this.queuings=r,this.ongoings=s,this.count$.next(a=>a-(i+o)),this.shift()}getActivationObservable(){return this.activated$.asObservable()}getSizeObservable(){return this.count$.asObservable()}dispose(){const e=[this.activated$,this.count$];for(const n of e)n.complete()}async shift(){const e=await this.capacity(),n=[...this.ongoings,...this.queuings],r=n.slice(0,e),i=n.slice(e),s=this.queuings.slice(0,e-this.ongoings.length);this.ongoings=r,this.queuings=i,s.length>0&&this.activated$.next(s)}async capacity(){return await I0.getValue(this.url,e=>{var n;return(n=e.limitation)==null?void 0:n.max_subscriptions},{skipFetch:this.config.skipFetchNip11})??1/0}},bV=class{constructor(e,n){lt(this,"relay"),lt(this,"pubProxy"),lt(this,"subProxy"),lt(this,"defaultSubscriptionIds",new Set),lt(this,"communicating",!1),lt(this,"strategy","lazy"),lt(this,"disconnectTimeout"),lt(this,"disconnectTimer"),lt(this,"isDefaultRelay",!1),lt(this,"disposed",!1),lt(this,"_url"),this._url=Ra(e);const r=wV(e,n),i=new pV(this.url,n),s=r?new dV({relay:i,config:n,authenticator:r}):null,o=new hV({relay:i,authProxy:s}),a=new gV({relay:i,authProxy:s,config:n});this.relay=i,this.pubProxy=o,this.subProxy=a,this.disconnectTimeout=n.disconnectTimeout,XH([this.pubProxy.getLogicalConnectionSizeObservable(),this.subProxy.getLogicalConnectionSizeObservable()]).pipe(Ec(([l,c])=>l+c)).subscribe(l=>{this.communicating=l>0,this.resetConnection()})}get url(){return this._url}setConnectionStrategy(e){this.disposed||(this.strategy=e,this.resetConnection())}resetConnection(){let e=this.strategy;switch(this.isDefaultRelay||(e="lazy"),e){case"lazy":{const n=()=>{this.communicating||this.relay.disconnect($d.RX_NOSTR_IDLE)};this.disconnectTimeout>0?(this.disconnectTimeout&&(clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0),this.disconnectTimer=setTimeout(n,this.disconnectTimeout)):n();break}case"lazy-keep":break;case"aggressive":{(this.connectionState==="initialized"||this.connectionState==="dormant")&&this.relay.connectManually();break}}}markAsDefault(e){if(!this.disposed){if(this.isDefaultRelay=e,!this.isDefaultRelay){for(const n of this.defaultSubscriptionIds)this.subProxy.unsubscribe(n);this.defaultSubscriptionIds.clear()}this.resetConnection()}}async publish(e){if(!this.disposed)return this.pubProxy.publish(e)}confirmOK(e){this.disposed||this.pubProxy.confirmOK(e)}subscribe(e,n){if(this.disposed)return;const{mode:r,overwrite:i,autoclose:s}=Rm(n??{},{overwrite:!1,autoclose:!1,mode:"default"}),[,o]=e;r==="default"&&!this.isDefaultRelay||!i&&this.subProxy.isOngoingOrQueued(o)||(r==="default"&&this.defaultSubscriptionIds.add(o),this.subProxy.subscribe(e,s))}unsubscribe(e){this.disposed||(this.defaultSubscriptionIds.delete(e),this.subProxy.unsubscribe(e))}getEventObservable(){if(this.disposed)throw new Aa;return this.subProxy.getEventObservable()}getFinObservable(){if(this.disposed)throw new Aa;return this.subProxy.getFinObservable()}getOkAgainstEventObservable(){if(this.disposed)throw new Aa;return this.pubProxy.getOkAgainstEventObservable()}getAllMessageObservable(){if(this.disposed)throw new Aa;return this.relay.getAllMessageObservable()}getOutgoingMessageObservable(){if(this.disposed)throw new Aa;return this.relay.getOutgoingMessageObservable()}getConnectionStateObservable(){if(this.disposed)throw new Aa;return this.relay.getConnectionStateObservable()}get connectionState(){return this.relay.state}getErrorObservable(){if(this.disposed)throw new Aa;return this.relay.getErrorObservable().pipe(Ec(e=>({from:this.url,reason:e})))}connectManually(){this.relay.connectManually()}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){this.disposed||(this.disposed=!0,this.disconnectTimer&&clearTimeout(this.disconnectTimer),this.disconnectTimer=void 0,this.relay.dispose(),this.pubProxy.dispose(),this.subProxy.dispose())}};function wV(t,e){const n=e.authenticator;if(!n)return;const r=n instanceof Function?n(t):n;return r==="auto"?{}:r}function vV(t,e){return t.filter(n=>!e.includes(n))}function xV(t){const{rxReq:e,index:n}=t,{rxReqId:r,strategy:i}=e;return`${r}:${i==="backward"?n:0}`}function SV(t){const{rxReq:e,filters:n,index:r}=t;return["REQ",xV({rxReq:e,index:r}),...n]}function dA(t){if(Array.isArray(t)){const e=t.map(n=>{let r="",i=!1,s=!1;if(typeof n=="string")r=n,i=!0,s=!0;else if(Array.isArray(n)){const o=n[2];r=n[1],i=!o||o==="read",s=!o||o==="write"}else r=n.url,i=n.read,s=n.write;return{url:r,read:i,write:s}});return Object.fromEntries(e.map(n=>[n.url,n]))}else{const e=Object.entries(t).map(([n,r])=>({url:n,...r}));return Object.fromEntries(e.map(n=>[n.url,n]))}}function fA(t,e){const n=new Set;if(e!=null&&e.on){const r=e.on;if(!r.defaultReadRelays&&!r.defaultWriteRelays&&!r.relays)return;const i=t.getDefaultRelays();if(r.defaultReadRelays)for(const{url:s}of Object.values(i).filter(o=>o.read))n.add(s);if(r.defaultWriteRelays)for(const{url:s}of Object.values(i).filter(o=>o.write))n.add(s);if(r.relays)for(const s of r.relays)n.add(Ra(s));return[...n]}else if(e!=null&&e.relays){for(const r of e.relays)n.add(Ra(r));return[...n]}else return}function kV(t){return new EV(Y9(t??{}))}let EV=class{constructor(e){lt(this,"connections",new o0),lt(this,"defaultRelays",new o0),lt(this,"defaultSubscriptions",new Map),lt(this,"event$",new Gn),lt(this,"fin$",new Gn),lt(this,"ok$",new Gn),lt(this,"all$",new Gn),lt(this,"error$",new Gn),lt(this,"connectionState$",new Gn),lt(this,"outgoing$",new Gn),lt(this,"dispose$",new Gn),lt(this,"disposed",!1),this.config=e}get defaultReadableConnections(){const e=[];for(const{url:n,read:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}get defaultWritableConnections(){const e=[];for(const{url:n,write:r}of this.defaultRelays.values()){const i=this.connections.get(n);r&&i&&e.push(i)}return e}getDefaultRelays(){if(this.disposed)throw new Aa;return this.defaultRelays.toObject()}getDefaultRelay(e){return this.defaultRelays.get(e)}setDefaultRelays(e){if(this.disposed)throw new Aa;const n=new o0(dA(e)),r=[];for(const{read:i,url:s}of n.values()){const o=this.ensureNostrConnection(s);o.setConnectionStrategy(this.config.connectionStrategy),i&&r.push(o)}this.updateDefaultSubscriptions(r),this.defaultRelays=n}ensureNostrConnection(e){let n=this.connections.get(e);return n||(n=new bV(e,this.config),this.attachNostrConnection(n),this.connections.set(e,n),n)}attachNostrConnection(e){e.getEventObservable().subscribe(this.event$),e.getFinObservable().subscribe(this.fin$),e.getOkAgainstEventObservable().subscribe(this.ok$),e.getAllMessageObservable().subscribe(this.all$),e.getConnectionStateObservable().subscribe(this.connectionState$),e.getErrorObservable().subscribe(this.error$),e.getOutgoingMessageObservable().subscribe(this.outgoing$)}updateDefaultSubscriptions(e){const n=vV(this.defaultReadableConnections,e);for(const r of n)r.markAsDefault(!1);for(const r of e){r.markAsDefault(!0);for(const{req:i,autoclose:s}of this.defaultSubscriptions.values())r?.subscribe(i,{mode:"default",overwrite:!1,autoclose:s})}}addDefaultRelays(e){const n=dA(e);this.setDefaultRelays({...this.defaultRelays.toObject(),...n})}removeDefaultRelays(e){const n=this.defaultRelays.copy(),r=Array.isArray(e)?e:[e];for(const i of r)n.delete(i);this.setDefaultRelays(n.toObject())}getAllRelayStatus(){return Object.fromEntries(Array.from(this.connections.values()).map(e=>[e.url,{connection:e.connectionState}]))}getRelayStatus(e){const n=this.connections.get(e);if(n)return{connection:n.connectionState}}reconnect(e){const n=this.getDefaultRelay(e);if(!n)throw new s0(`The relay (${e}) is not a default relay. \`reconnect()\` can be used only for a readable default relay.`);if(!n.read)throw new s0(`The relay (${e}) is not readable. \`reconnect()\` can be used only for a readable default relay.`);const r=this.connections.get(e);if(!r)throw new hM;(r.connectionState==="error"||r.connectionState==="rejected")&&r.connectManually()}use(e,n){const r=fA(this,n),i=({filters:u,relays:d},f)=>{var h;const p=e.strategy==="backward"?d:void 0,m=SV({rxReq:e,filters:u,index:f});return{subId:m[1],req:m,targetConnections:((h=p??r)==null?void 0:h.map(g=>this.ensureNostrConnection(g)))??this.defaultReadableConnections,mode:p===void 0&&r===void 0?"default":"temporary"}},s=({req:u,targetConnections:d,mode:f})=>{this.startSubscription({req:u,targetConnections:d,mode:f,overwrite:e.strategy==="forward",autoclose:e.strategy==="backward"})},o=({subId:u,targetConnections:d,mode:f})=>{this.teardownSubscription({subId:u,targetConnections:d,mode:f})},a=({req:u,targetConnections:d})=>e.strategy==="forward"?this.createForwardEventObservable({req:u}).pipe(Dh(this.dispose$)):this.createBackwardEventObservable({req:u,targetConnections:d}).pipe(Dh(this.dispose$)),l=e.getReqPacketObservable().pipe(Ns(({filters:u})=>u.length>0),Ec(i),Dh(this.dispose$)),c=()=>cV(async({event:u})=>(this.config.skipVerify||await this.config.verifier(u))&&(this.config.skipExpirationCheck||!nH(u)));if(e.strategy==="forward"){let u;return l.pipe(Tg(d=>{u=d}),Tg(s),Ec(a),Nv(()=>{u&&o(u)}),aV(),c())}else return l.pipe(Tg(s),Ec(u=>a(u).pipe(Nv(()=>{o(u)}))),$M(),c())}createForwardEventObservable(e){const{req:n}=e,r=n[1];return this.event$.pipe(Rv(r))}createBackwardEventObservable(e){const{req:n,targetConnections:r}=e,i=n[1],s=new Set,o=u=>u==="error"||u==="rejected"||u==="terminated",a=()=>r.every(({connectionState:u,url:d})=>o(u)||s.has(d)),l=this.fin$.pipe(Rv(i),Tg(({from:u})=>{s.add(u)})),c=JH(l,this.connectionState$.asObservable()).pipe(Ns(()=>a()),nx(null,void 0));return this.event$.pipe(Dh(c),cA(this.config.eoseTimeout),Rv(i),Ns(u=>!s.has(u.from)))}startSubscription(e){const{req:n,targetConnections:r,mode:i,overwrite:s,autoclose:o}=e,a=n[1];i==="default"&&this.defaultSubscriptions.set(a,{req:n,autoclose:o});for(const l of r)l.subscribe(n,{mode:i,overwrite:s,autoclose:o})}teardownSubscription(e){const{subId:n,targetConnections:r,mode:i}=e;i==="default"&&this.defaultSubscriptions.delete(n);for(const s of r)s.unsubscribe(n)}createAllEventObservable(){return this.event$.asObservable()}createAllErrorObservable(){return this.error$.asObservable()}createAllMessageObservable(){return this.all$.asObservable()}createConnectionStateObservable(){return this.connectionState$.asObservable()}createOutgoingMessageObservable(){return this.outgoing$.asObservable()}send(e,n){const{signer:r,errorOnTimeout:i,completeOn:s}=Rm(n??{},{signer:this.config.signer,errorOnTimeout:!1,completeOn:"all-ok"}),o=fA(this,n),a=o===void 0?this.defaultWritableConnections:o.map(h=>this.ensureNostrConnection(h)),l=new Gn,c=new Set;let u="";const d=()=>{l.closed||l.complete();for(const h of a)h.confirmOK(u)};r.signEvent(e).then(async h=>{l.closed||(u=h.id,this.ok$.pipe(Ns(({eventId:p})=>p===h.id)).subscribe(l),await Promise.all(a.map(p=>p.publish(h))),s==="sent"&&l.complete())}).catch(h=>{throw d(),new s0(h instanceof Error?h.message:"Failed to sign the given event")});const f=(()=>{switch(s){case"sent":return wl;case"all-ok":return lV(({from:h,done:p})=>(p&&c.add(h),c.size<a.length),!0);case"any-ok":return nx(h=>h.ok)}})();return l.pipe(f,Dh(this.dispose$),i?FM(this.config.okTimeout):cA(this.config.okTimeout),Nv(d))}async cast(e,n){await DM(this.send(e,{...n,completeOn:"sent"}))}dispose(){this[Symbol.dispose]()}[Symbol.dispose](){if(this.disposed)return;this.disposed=!0;for(const n of this.connections.values())n.dispose();this.connections.clear();const e=[this.event$,this.ok$,this.fin$,this.all$,this.connectionState$,this.error$,this.outgoing$];for(const n of e)n.complete();this.dispose$.next(),this.dispose$.complete()}};const HM=t=>{const{strategy:e}=t,n=t.operators??[],r=t.rxReqId??TV(),i=t.subject??new Gn;return{strategy:e,rxReqId:r,getReqPacketObservable(){return i.pipe(...n)},pipe(...s){return HM({strategy:e,rxReqId:r,operators:[...n,...s],subject:i})},emit(s,o){i.next({filters:_V(s),...o??{}})},over(){i.complete()}}};function R0(t){return HM({strategy:"backward",rxReqId:t})}function TV(){return`${Math.floor(Math.random()*1e6)}`}function CV(t){var e,n;const r={},i=s=>/^#[a-zA-Z]$/.test(s);for(const s of Object.keys(t)){if(s==="limit"&&(t[s]??-1)>=0){r[s]=t[s];continue}if(s==="since"||s==="until"){const o=t[s];if(typeof o!="number"||(o??-1)>=0){r[s]=o;continue}}if((i(s)||s==="ids"||s==="authors")&&t[s]!==void 0&&(((e=t[s])==null?void 0:e.length)??-1)>0){r[s]=t[s];continue}if(s==="kinds"&&t[s]!==void 0&&(((n=t[s])==null?void 0:n.length)??-1)>0){r[s]=t[s];continue}if(s==="search"&&t[s]!==void 0){r[s]=t[s];continue}}return typeof r.since!="number"||typeof r.until!="number"||r.since<=r.until?r:null}function _V(t){return(Array.isArray(t)?t:[t]).map(e=>CV(e)).filter(e=>e!==null)}function hA(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function AV(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Fm(t,...e){if(!AV(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function PV(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");hA(t.outputLen),hA(t.blockLen)}function D0(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function IV(t,e){Fm(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Dv=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const Lv=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),wo=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const OV=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function L0(t){Fm(t);let e="";for(let n=0;n<t.length;n++)e+=OV[t[n]];return e}function MV(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function kk(t){return typeof t=="string"&&(t=MV(t)),Fm(t),t}function NV(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Fm(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}let VM=class{clone(){return this._cloneInto()}};function RV(t){const e=r=>t().update(kk(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function WM(t=32){if(Dv&&typeof Dv.getRandomValues=="function")return Dv.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function DV(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const LV=(t,e,n)=>t&e^~t&n,BV=(t,e,n)=>t&e^t&n^e&n;let FV=class extends VM{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Lv(this.buffer)}update(e){D0(this);const{view:n,buffer:r,blockLen:i}=this;e=kk(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=Lv(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){D0(this),IV(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;DV(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Lv(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const $V=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),zl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ul=new Uint32Array(64);let zV=class extends FV{constructor(){super(64,32,8,!1),this.A=zl[0]|0,this.B=zl[1]|0,this.C=zl[2]|0,this.D=zl[3]|0,this.E=zl[4]|0,this.F=zl[5]|0,this.G=zl[6]|0,this.H=zl[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)Ul[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=Ul[d-15],h=Ul[d-2],p=wo(f,7)^wo(f,18)^f>>>3,m=wo(h,17)^wo(h,19)^h>>>10;Ul[d]=m+Ul[d-7]+p+Ul[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=wo(a,6)^wo(a,11)^wo(a,25),h=u+f+LV(a,l,c)+$V[d]+Ul[d]|0,p=(wo(r,2)^wo(r,13)^wo(r,22))+BV(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Ul.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const B0=RV(()=>new zV);const jM=BigInt(0),$b=BigInt(1),UV=BigInt(2);function Xu(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function $m(t){if(!Xu(t))throw new Error("Uint8Array expected")}const HV=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Lf(t){$m(t);let e="";for(let n=0;n<t.length;n++)e+=HV[t[n]];return e}function qM(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function Ek(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}const ba={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function pA(t){if(t>=ba._0&&t<=ba._9)return t-ba._0;if(t>=ba._A&&t<=ba._F)return t-(ba._A-10);if(t>=ba._a&&t<=ba._f)return t-(ba._a-10)}function Bf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=pA(t.charCodeAt(s)),a=pA(t.charCodeAt(s+1));if(o===void 0||a===void 0){const l=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function Gi(t){return Ek(Lf(t))}function Tk(t){return $m(t),Ek(Lf(Uint8Array.from(t).reverse()))}function Fc(t,e){return Bf(t.toString(16).padStart(e*2,"0"))}function Ck(t,e){return Fc(t,e).reverse()}function VV(t){return Bf(qM(t))}function si(t,e,n){let r;if(typeof e=="string")try{r=Bf(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Xu(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function Qu(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];$m(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}function WV(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}function jV(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function qV(t){let e;for(e=0;t>jM;t>>=$b,e+=1);return e}function KV(t,e){return t>>BigInt(e)&$b}function GV(t,e,n){return t|(n?$b:jM)<<BigInt(e)}const _k=t=>(UV<<BigInt(t-1))-$b,Bv=t=>new Uint8Array(t),mA=t=>Uint8Array.from(t);function KM(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Bv(t),i=Bv(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=Bv())=>{i=a(mA([0]),u),r=a(),u.length!==0&&(i=a(mA([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){r=a();const f=r.slice();d.push(f),u+=r.length}return Qu(...d)};return(u,d)=>{o(),l(u);let f;for(;!(f=d(c()));)l();return o(),f}}const ZV={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Xu(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function zm(t,e,n={}){const r=(i,s,o)=>{const a=ZV[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const XV=Object.freeze(Object.defineProperty({__proto__:null,abytes:$m,bitGet:KV,bitLen:qV,bitMask:_k,bitSet:GV,bytesToHex:Lf,bytesToNumberBE:Gi,bytesToNumberLE:Tk,concatBytes:Qu,createHmacDrbg:KM,ensureBytes:si,equalBytes:WV,hexToBytes:Bf,hexToNumber:Ek,isBytes:Xu,numberToBytesBE:Fc,numberToBytesLE:Ck,numberToHexUnpadded:qM,numberToVarBytesBE:VV,utf8ToBytes:jV,validateObject:zm},Symbol.toStringTag,{value:"Module"}));const Er=BigInt(0),rr=BigInt(1),wu=BigInt(2),QV=BigInt(3),rx=BigInt(4),gA=BigInt(5),yA=BigInt(8);BigInt(9);BigInt(16);function Hr(t,e){const n=t%e;return n>=Er?n:e+n}function YV(t,e,n){if(n<=Er||e<Er)throw new Error("Expected power/modulo > 0");if(n===rr)return Er;let r=rr;for(;e>Er;)e&rr&&(r=r*t%n),t=t*t%n,e>>=rr;return r}function vs(t,e,n){let r=t;for(;e-- >Er;)r*=r,r%=n;return r}function ix(t,e){if(t===Er||e<=Er)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Hr(t,e),r=e,i=Er,s=rr;for(;n!==Er;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==rr)throw new Error("invert: does not exist");return Hr(i,e)}function JV(t){const e=(t-rr)/wu;let n,r,i;for(n=t-rr,r=0;n%wu===Er;n/=wu,r++);for(i=wu;i<t&&YV(i,e,t)!==t-rr;i++);if(r===1){const o=(t+rr)/rx;return function(a,l){const c=a.pow(l,o);if(!a.eql(a.sqr(c),l))throw new Error("Cannot find square root");return c}}const s=(n+rr)/wu;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let l=r,c=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),d=o.pow(a,n);for(;!o.eql(d,o.ONE);){if(o.eql(d,o.ZERO))return o.ZERO;let f=1;for(let p=o.sqr(d);f<l&&!o.eql(p,o.ONE);f++)p=o.sqr(p);const h=o.pow(c,rr<<BigInt(l-f-1));c=o.sqr(h),u=o.mul(u,h),d=o.mul(d,c),l=f}return u}}function eW(t){if(t%rx===QV){const e=(t+rr)/rx;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%yA===gA){const e=(t-gA)/yA;return function(n,r){const i=n.mul(r,wu),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,wu),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return JV(t)}const tW=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nW(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=tW.reduce((r,i)=>(r[i]="function",r),e);return zm(t,n)}function rW(t,e,n){if(n<Er)throw new Error("Expected power > 0");if(n===Er)return t.ONE;if(n===rr)return e;let r=t.ONE,i=e;for(;n>Er;)n&rr&&(r=t.mul(r,i)),i=t.sqr(i),n>>=rr;return r}function iW(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function GM(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function sW(t,e,n=!1,r={}){if(t<=Er)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=GM(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=eW(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:_k(i),ZERO:Er,ONE:rr,create:l=>Hr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Er<=l&&l<t},is0:l=>l===Er,isOdd:l=>(l&rr)===rr,neg:l=>Hr(-l,t),eql:(l,c)=>l===c,sqr:l=>Hr(l*l,t),add:(l,c)=>Hr(l+c,t),sub:(l,c)=>Hr(l-c,t),mul:(l,c)=>Hr(l*c,t),pow:(l,c)=>rW(a,l,c),div:(l,c)=>Hr(l*ix(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>ix(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>iW(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?Ck(l,s):Fc(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?Tk(l):Gi(l)}});return Object.freeze(a)}function ZM(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function XM(t){const e=ZM(t);return e+Math.ceil(e/2)}function oW(t,e,n=!1){const r=t.length,i=ZM(e),s=XM(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Gi(t):Tk(t),a=Hr(o,e-rr)+rr;return n?Ck(a,i):Fc(a,i)}const aW=BigInt(0),Fv=BigInt(1);function lW(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>aW;)s&Fv&&(o=o.add(a)),a=a.double(),s>>=Fv;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let d=0;d<o;d++){u=c,l.push(u);for(let f=1;f<a;f++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const d=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const m=p*l;let g=Number(o&d);o>>=h,g>l&&(g-=f,o+=Fv);const y=m,b=m+Math.abs(g)-1,S=p%2!==0,C=g<0;g===0?u=u.add(n(S,s[y])):c=c.add(n(C,s[b]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function QM(t){return nW(t.Fp),zm(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...GM(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function cW(t){const e=QM(t);zm(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:uW,hexToBytes:dW}=XV,Tu={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=Tu;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:uW(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Tu,n=typeof t=="string"?dW(t):t;$m(n);let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=Tu._parseInt(n.subarray(2)),{d:o,l:a}=Tu._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},$a=BigInt(0),Cs=BigInt(1);BigInt(2);const bA=BigInt(3);BigInt(4);function fW(t){const e=cW(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return Qu(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1),g=n.fromBytes(m.subarray(0,n.BYTES)),y=n.fromBytes(m.subarray(n.BYTES,2*n.BYTES));return{x:g,y}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&$a<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(Xu(p)&&(p=Lf(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let S;try{S=typeof p=="bigint"?p:Gi(si("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(S=Hr(S,b)),a(S),S}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=S=>n.eql(S,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map(y=>y.pz));return m.map((y,b)=>y.toAffine(g[b])).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(si("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:S,py:C,pz:_}=m,x=n.eql(n.mul(g,_),n.mul(S,b)),I=n.eql(n.mul(y,_),n.mul(C,b));return x&&I}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,bA),{px:b,py:S,pz:C}=this;let _=n.ZERO,x=n.ZERO,I=n.ZERO,k=n.mul(b,b),T=n.mul(S,S),P=n.mul(C,C),O=n.mul(b,S);return O=n.add(O,O),I=n.mul(b,C),I=n.add(I,I),_=n.mul(m,I),x=n.mul(y,P),x=n.add(_,x),_=n.sub(T,x),x=n.add(T,x),x=n.mul(_,x),_=n.mul(O,_),I=n.mul(y,I),P=n.mul(m,P),O=n.sub(k,P),O=n.mul(m,O),O=n.add(O,I),I=n.add(k,k),k=n.add(I,k),k=n.add(k,P),k=n.mul(k,O),x=n.add(x,k),P=n.mul(S,C),P=n.add(P,P),k=n.mul(P,O),_=n.sub(_,k),I=n.mul(P,T),I=n.add(I,I),I=n.add(I,I),new d(_,x,I)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:S,py:C,pz:_}=m;let x=n.ZERO,I=n.ZERO,k=n.ZERO;const T=e.a,P=n.mul(e.b,bA);let O=n.mul(g,S),D=n.mul(y,C),F=n.mul(b,_),B=n.add(g,y),N=n.add(S,C);B=n.mul(B,N),N=n.add(O,D),B=n.sub(B,N),N=n.add(g,b);let M=n.add(S,_);return N=n.mul(N,M),M=n.add(O,F),N=n.sub(N,M),M=n.add(y,b),x=n.add(C,_),M=n.mul(M,x),x=n.add(D,F),M=n.sub(M,x),k=n.mul(T,N),x=n.mul(P,F),k=n.add(x,k),x=n.sub(D,k),k=n.add(D,k),I=n.mul(x,k),D=n.add(O,O),D=n.add(D,O),F=n.mul(T,F),N=n.mul(P,N),D=n.add(D,F),F=n.sub(O,F),F=n.mul(T,F),N=n.add(N,F),O=n.mul(D,N),I=n.add(I,O),O=n.mul(M,N),x=n.mul(B,x),x=n.sub(x,O),O=n.mul(B,D),k=n.mul(M,k),k=n.add(k,O),new d(x,I,k)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,g=>{const y=n.invertBatch(g.map(b=>b.pz));return g.map((b,S)=>b.toAffine(y[S])).map(d.fromAffine)})}multiplyUnsafe(m){const g=d.ZERO;if(m===$a)return g;if(a(m),m===Cs)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:S,k2neg:C,k2:_}=y.splitScalar(m),x=g,I=g,k=this;for(;S>$a||_>$a;)S&Cs&&(x=x.add(k)),_&Cs&&(I=I.add(k)),k=k.double(),S>>=Cs,_>>=Cs;return b&&(x=x.negate()),C&&(I=I.negate()),I=new d(n.mul(I.px,y.beta),I.py,I.pz),x.add(I)}multiply(m){a(m);let g=m,y,b;const{endo:S}=e;if(S){const{k1neg:C,k1:_,k2neg:x,k2:I}=S.splitScalar(g);let{p:k,f:T}=this.wNAF(_),{p:P,f:O}=this.wNAF(I);k=h.constTimeNegate(C,k),P=h.constTimeNegate(x,P),P=new d(n.mul(P.px,S.beta),P.py,P.pz),y=k.add(P),b=T.add(O)}else{const{p:C,f:_}=this.wNAF(g);y=C,b=_}return d.normalizeZ([y,b])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,S=(_,x)=>x===$a||x===Cs||!_.equals(b)?_.multiplyUnsafe(x):_.multiply(x),C=S(this,g).add(S(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,S=this.is0();m==null&&(m=S?n.ONE:n.inv(b));const C=n.mul(g,m),_=n.mul(y,m),x=n.mul(b,m);if(S)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:C,y:_}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===Cs)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===Cs?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return Lf(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=lW(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function hW(t){const e=QM(t);return zm(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function pW(t){const e=hW(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(N){return $a<N&&N<n.ORDER}function a(N){return Hr(N,r)}function l(N){return ix(N,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=fW({...e,toBytes(N,M,R){const H=M.toAffine(),z=n.toBytes(H.x),V=Qu;return R?V(Uint8Array.from([M.hasEvenY()?2:3]),z):V(Uint8Array.from([4]),z,n.toBytes(H.y))},fromBytes(N){const M=N.length,R=N[0],H=N.subarray(1);if(M===i&&(R===2||R===3)){const z=Gi(H);if(!o(z))throw new Error("Point is not on curve");const V=d(z);let X;try{X=n.sqrt(V)}catch(te){const ne=te instanceof Error?": "+te.message:"";throw new Error("Point is not on curve"+ne)}const Z=(X&Cs)===Cs;return(R&1)===1!==Z&&(X=n.neg(X)),{x:z,y:X}}else if(M===s&&R===4){const z=n.fromBytes(H.subarray(0,n.BYTES)),V=n.fromBytes(H.subarray(n.BYTES,2*n.BYTES));return{x:z,y:V}}else throw new Error(`Point of length ${M} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=N=>Lf(Fc(N,e.nByteLength));function p(N){const M=r>>Cs;return N>M}function m(N){return p(N)?a(-N):N}const g=(N,M,R)=>Gi(N.slice(M,R));class y{constructor(M,R,H){this.r=M,this.s=R,this.recovery=H,this.assertValidity()}static fromCompact(M){const R=e.nByteLength;return M=si("compactSignature",M,R*2),new y(g(M,0,R),g(M,R,2*R))}static fromDER(M){const{r:R,s:H}=Tu.toSig(si("DER",M));return new y(R,H)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(M){return new y(this.r,this.s,M)}recoverPublicKey(M){const{r:R,s:H,recovery:z}=this,V=I(si("msgHash",M));if(z==null||![0,1,2,3].includes(z))throw new Error("recovery id invalid");const X=z===2||z===3?R+e.n:R;if(X>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const Z=z&1?"03":"02",te=c.fromHex(Z+h(X)),ne=l(X),J=a(-V*ne),xe=a(H*ne),Le=c.BASE.multiplyAndAddUnsafe(te,J,xe);if(!Le)throw new Error("point at infinify");return Le.assertValidity(),Le}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Bf(this.toDERHex())}toDERHex(){return Tu.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Bf(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const b={isValidPrivateKey(N){try{return u(N),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const N=XM(e.n);return oW(e.randomBytes(N),e.n)},precompute(N=8,M=c.BASE){return M._setWindowSize(N),M.multiply(BigInt(3)),M}};function S(N,M=!0){return c.fromPrivateKey(N).toRawBytes(M)}function C(N){const M=Xu(N),R=typeof N=="string",H=(M||R)&&N.length;return M?H===i||H===s:R?H===2*i||H===2*s:N instanceof c}function _(N,M,R=!0){if(C(N))throw new Error("first arg must be private key");if(!C(M))throw new Error("second arg must be public key");return c.fromHex(M).multiply(u(N)).toRawBytes(R)}const x=e.bits2int||function(N){const M=Gi(N),R=N.length*8-e.nBitLength;return R>0?M>>BigInt(R):M},I=e.bits2int_modN||function(N){return a(x(N))},k=_k(e.nBitLength);function T(N){if(typeof N!="bigint")throw new Error("bigint expected");if(!($a<=N&&N<k))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Fc(N,e.nByteLength)}function P(N,M,R=O){if(["recovered","canonical"].some(ke=>ke in R))throw new Error("sign() legacy options not supported");const{hash:H,randomBytes:z}=e;let{lowS:V,prehash:X,extraEntropy:Z}=R;V==null&&(V=!0),N=si("msgHash",N),X&&(N=si("prehashed msgHash",H(N)));const te=I(N),ne=u(M),J=[T(ne),T(te)];if(Z!=null&&Z!==!1){const ke=Z===!0?z(n.BYTES):Z;J.push(si("extraEntropy",ke))}const xe=Qu(...J),Le=te;function he(ke){const Be=x(ke);if(!f(Be))return;const je=l(Be),Fe=c.BASE.multiply(Be).toAffine(),ve=a(Fe.x);if(ve===$a)return;const Ie=a(je*a(Le+ve*ne));if(Ie===$a)return;let Oe=(Fe.x===ve?0:2)|Number(Fe.y&Cs),qe=Ie;return V&&p(Ie)&&(qe=m(Ie),Oe^=1),new y(ve,qe,Oe)}return{seed:xe,k2sig:he}}const O={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function F(N,M,R=O){const{seed:H,k2sig:z}=P(N,M,R),V=e;return KM(V.hash.outputLen,V.nByteLength,V.hmac)(H,z)}c.BASE._setWindowSize(8);function B(N,M,R,H=D){var z;const V=N;if(M=si("msgHash",M),R=si("publicKey",R),"strict"in H)throw new Error("options.strict was renamed to lowS");const{lowS:X,prehash:Z}=H;let te,ne;try{if(typeof V=="string"||Xu(V))try{te=y.fromDER(V)}catch(Fe){if(!(Fe instanceof Tu.Err))throw Fe;te=y.fromCompact(V)}else if(typeof V=="object"&&typeof V.r=="bigint"&&typeof V.s=="bigint"){const{r:Fe,s:ve}=V;te=new y(Fe,ve)}else throw new Error("PARSE");ne=c.fromHex(R)}catch(Fe){if(Fe.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(X&&te.hasHighS())return!1;Z&&(M=e.hash(M));const{r:J,s:xe}=te,Le=I(M),he=l(xe),ke=a(Le*he),Be=a(J*he),je=(z=c.BASE.multiplyAndAddUnsafe(ne,ke,Be))==null?void 0:z.toAffine();return je?a(je.x)===J:!1}return{CURVE:e,getPublicKey:S,getSharedSecret:_,sign:F,verify:B,ProjectivePoint:c,Signature:y,utils:b}}let YM=class extends VM{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,PV(e);const r=kk(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return D0(this),this.iHash.update(e),this}digestInto(e){D0(this),Fm(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const JM=(t,e,n)=>new YM(t,e).update(n).digest();JM.create=(t,e)=>new YM(t,e);function mW(t){return{hash:t,hmac:(e,...n)=>JM(t,e,NV(...n)),randomBytes:WM}}function gW(t,e){const n=r=>pW({...t,...mW(r)});return Object.freeze({...n(e),create:n})}const zb=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),F0=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),e8=BigInt(1),$0=BigInt(2),wA=(t,e)=>(t+e/$0)/e;function t8(t){const e=zb,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=vs(u,n,e)*u%e,f=vs(d,n,e)*u%e,h=vs(f,$0,e)*c%e,p=vs(h,i,e)*h%e,m=vs(p,s,e)*p%e,g=vs(m,a,e)*m%e,y=vs(g,l,e)*g%e,b=vs(y,a,e)*m%e,S=vs(b,n,e)*u%e,C=vs(S,o,e)*p%e,_=vs(C,r,e)*c%e,x=vs(_,$0,e);if(!sx.eql(sx.sqr(x),t))throw new Error("Cannot find square root");return x}const sx=sW(zb,void 0,void 0,{sqrt:t8}),Ak=gW({a:BigInt(0),b:BigInt(7),Fp:sx,n:F0,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=F0,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-e8*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=wA(s*t,e),l=wA(-r*t,e);let c=Hr(t-a*n-l*i,e),u=Hr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},B0),Ub=BigInt(0),n8=t=>typeof t=="bigint"&&Ub<t&&t<zb,yW=t=>typeof t=="bigint"&&Ub<t&&t<F0,vA={};function z0(t,...e){let n=vA[t];if(n===void 0){const r=B0(Uint8Array.from(t,i=>i.charCodeAt(0)));n=Qu(r,r),vA[t]=n}return B0(Qu(n,...e))}const Pk=t=>t.toRawBytes(!0).slice(1),ox=t=>Fc(t,32),$v=t=>Hr(t,zb),Gp=t=>Hr(t,F0),Ik=Ak.ProjectivePoint,bW=(t,e,n)=>Ik.BASE.multiplyAndAddUnsafe(t,e,n);function ax(t){let e=Ak.utils.normPrivateKeyToScalar(t),n=Ik.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Gp(-e),bytes:Pk(n)}}function r8(t){if(!n8(t))throw new Error("bad x: need 0 < x < p");const e=$v(t*t),n=$v(e*t+BigInt(7));let r=t8(n);r%$0!==Ub&&(r=$v(-r));const i=new Ik(t,r,e8);return i.assertValidity(),i}function i8(...t){return Gp(Gi(z0("BIP0340/challenge",...t)))}function wW(t){return ax(t).bytes}function vW(t,e,n=WM(32)){const r=si("message",t),{bytes:i,scalar:s}=ax(e),o=si("auxRand",n,32),a=ox(s^Gi(z0("BIP0340/aux",o))),l=z0("BIP0340/nonce",a,i,r),c=Gp(Gi(l));if(c===Ub)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=ax(c),f=i8(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(ox(Gp(d+f*s)),32),!s8(h,r,i))throw new Error("sign: Invalid signature produced");return h}function s8(t,e,n){const r=si("signature",t,64),i=si("message",e),s=si("publicKey",n,32);try{const o=r8(Gi(s)),a=Gi(r.subarray(0,32));if(!n8(a))return!1;const l=Gi(r.subarray(32,64));if(!yW(l))return!1;const c=i8(ox(a),Pk(o),i),u=bW(o,l,Gp(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const zv={getPublicKey:wW,sign:vW,verify:s8,utils:{randomPrivateKey:Ak.utils.randomPrivateKey,lift_x:r8,pointToBytes:Pk,numberToBytesBE:Fc,bytesToNumberBE:Gi,taggedHash:z0,mod:Hr}};function xW(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function SW(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function kW(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function EW(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}const o8=(t,e)=>e?o8(e,t%e):t,U0=(t,e)=>t+(e-o8(t,e));function lx(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(U0(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${U0(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function TW(t,e=!1){if(U0(8,t)>32||U0(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!xW(n))throw new Error("radix2.encode input should be Uint8Array");return lx(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(lx(n,t,8,e))}}}function xA(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const cx=SW(kW("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),EW("")),SA=[996825010,642813549,513874426,1027748829,705979059];function Lh(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<SA.length;r++)(e>>r&1)===1&&(n^=SA[r]);return n}function kA(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=Lh(i)^o>>5}i=Lh(i);for(let s=0;s<r;s++)i=Lh(i)^t.charCodeAt(s)&31;for(let s of e)i=Lh(i)^s;for(let s=0;s<6;s++)i=Lh(i);return i^=n,cx.encode(lx([i%2**30],30,5,!1))}function CW(t){const n=TW(5),r=n.decode,i=n.encode,s=xA(r);function o(u,d,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof d}`);if(u.length===0)throw new TypeError(`Invalid prefix length ${u.length}`);const h=u.length+7+d.length;if(f!==!1&&h>f)throw new TypeError(`Length ${h} exceeds limit ${f}`);const p=u.toLowerCase(),m=kA(p,d,1);return`${p}1${cx.encode(d)}${m}`}function a(u,d=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||d!==!1&&u.length>d)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${d})`);const f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");const h=f.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=f.slice(0,h),m=f.slice(h+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const g=cx.decode(m).slice(0,-6),y=kA(p,g,1);if(!m.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:g}}const l=xA(a);function c(u){const{prefix:d,words:f}=a(u,!1);return{prefix:d,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const EA=CW(),_W=new TextEncoder;function AW(t){return L0(B0(_W.encode(t)))}const Ok={sign:(t,e)=>L0(zv.sign(t,e)),verify:zv.verify,getPublicKey:t=>L0(zv.getPublicKey(t))};function PW(t){return Ok.getPublicKey(t)}function a8(t){const e=JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]);return AW(e)}function IW(t,e){return Ok.sign(t,e)}function OW(t){try{return Ok.verify(t.sig,a8(t),t.pubkey)}catch(e){return console.warn("The following error occurred during verify():",e),!1}}function MW(t){const{words:e}=EA.decode(t),n=new Uint8Array(EA.fromWords(e));return L0(n)}function ux(t,e){const n=t.startsWith("nsec1")?MW(t):t,r=PW(n);return{async signEvent(i){const s={...i,pubkey:i.pubkey??r,tags:[...i.tags??[],...e?.tags??[]],created_at:i.created_at??Math.floor(Date.now()/1e3)};if(NW(s))return s;const o=s.id??a8(s),a=s.sig??IW(o,n);return{...s,id:o,sig:a}},async getPublicKey(){return r}}}function NW(t){if(typeof t.id!="string"||typeof t.sig!="string"||typeof t.kind!="number"||typeof t.pubkey!="string"||typeof t.content!="string"||typeof t.created_at!="number"||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){const n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}const RW=async t=>OW(t),DW="modulepreload",LW=function(t){return"/ehagaki/"+t},TA={},Hb=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=l(n.map(c=>{if(c=LW(c),c in TA)return;TA[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":DW,u||(f.as="script"),f.crossOrigin="",f.href=c,a&&f.setAttribute("nonce",a),document.head.appendChild(f),u)return new Promise((h,p)=>{f.addEventListener("load",h),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};var CA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function BW(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Uv,_A;function FW(){if(_A)return Uv;_A=1;var t=function(b){return e(b)&&!n(b)};function e(y){return!!y&&typeof y=="object"}function n(y){var b=Object.prototype.toString.call(y);return b==="[object RegExp]"||b==="[object Date]"||s(y)}var r=typeof Symbol=="function"&&Symbol.for,i=r?Symbol.for("react.element"):60103;function s(y){return y.$$typeof===i}function o(y){return Array.isArray(y)?[]:{}}function a(y,b){return b.clone!==!1&&b.isMergeableObject(y)?m(o(y),y,b):y}function l(y,b,S){return y.concat(b).map(function(C){return a(C,S)})}function c(y,b){if(!b.customMerge)return m;var S=b.customMerge(y);return typeof S=="function"?S:m}function u(y){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(y).filter(function(b){return Object.propertyIsEnumerable.call(y,b)}):[]}function d(y){return Object.keys(y).concat(u(y))}function f(y,b){try{return b in y}catch{return!1}}function h(y,b){return f(y,b)&&!(Object.hasOwnProperty.call(y,b)&&Object.propertyIsEnumerable.call(y,b))}function p(y,b,S){var C={};return S.isMergeableObject(y)&&d(y).forEach(function(_){C[_]=a(y[_],S)}),d(b).forEach(function(_){h(y,_)||(f(y,_)&&S.isMergeableObject(b[_])?C[_]=c(_,S)(y[_],b[_],S):C[_]=a(b[_],S))}),C}function m(y,b,S){S=S||{},S.arrayMerge=S.arrayMerge||l,S.isMergeableObject=S.isMergeableObject||t,S.cloneUnlessOtherwiseSpecified=a;var C=Array.isArray(b),_=Array.isArray(y),x=C===_;return x?C?S.arrayMerge(y,b,S):p(y,b,S):a(b,S)}m.all=function(b,S){if(!Array.isArray(b))throw new Error("first argument should be an array");return b.reduce(function(C,_){return m(C,_,S)},{})};var g=m;return Uv=g,Uv}var $W=FW();const zW=BW($W);var dx=function(t,e){return dx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},dx(t,e)};function Vb(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");dx(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var on=function(){return on=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},on.apply(this,arguments)};function UW(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Hv(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function Vv(t,e){var n=e&&e.cache?e.cache:GW,r=e&&e.serializer?e.serializer:qW,i=e&&e.strategy?e.strategy:WW;return i(t,{cache:n,serializer:r})}function HW(t){return t==null||typeof t=="number"||typeof t=="boolean"}function VW(t,e,n,r){var i=HW(r)?r:n(r),s=e.get(i);return typeof s>"u"&&(s=t.call(this,r),e.set(i,s)),s}function l8(t,e,n){var r=Array.prototype.slice.call(arguments,3),i=n(r),s=e.get(i);return typeof s>"u"&&(s=t.apply(this,r),e.set(i,s)),s}function c8(t,e,n,r,i){return n.bind(e,t,r,i)}function WW(t,e){var n=t.length===1?VW:l8;return c8(t,this,n,e.cache.create(),e.serializer)}function jW(t,e){return c8(t,this,l8,e.cache.create(),e.serializer)}var qW=function(){return JSON.stringify(arguments)},KW=(function(){function t(){this.cache=Object.create(null)}return t.prototype.get=function(e){return this.cache[e]},t.prototype.set=function(e,n){this.cache[e]=n},t})(),GW={create:function(){return new KW}},Wv={variadic:jW},jt;(function(t){t[t.EXPECT_ARGUMENT_CLOSING_BRACE=1]="EXPECT_ARGUMENT_CLOSING_BRACE",t[t.EMPTY_ARGUMENT=2]="EMPTY_ARGUMENT",t[t.MALFORMED_ARGUMENT=3]="MALFORMED_ARGUMENT",t[t.EXPECT_ARGUMENT_TYPE=4]="EXPECT_ARGUMENT_TYPE",t[t.INVALID_ARGUMENT_TYPE=5]="INVALID_ARGUMENT_TYPE",t[t.EXPECT_ARGUMENT_STYLE=6]="EXPECT_ARGUMENT_STYLE",t[t.INVALID_NUMBER_SKELETON=7]="INVALID_NUMBER_SKELETON",t[t.INVALID_DATE_TIME_SKELETON=8]="INVALID_DATE_TIME_SKELETON",t[t.EXPECT_NUMBER_SKELETON=9]="EXPECT_NUMBER_SKELETON",t[t.EXPECT_DATE_TIME_SKELETON=10]="EXPECT_DATE_TIME_SKELETON",t[t.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE=11]="UNCLOSED_QUOTE_IN_ARGUMENT_STYLE",t[t.EXPECT_SELECT_ARGUMENT_OPTIONS=12]="EXPECT_SELECT_ARGUMENT_OPTIONS",t[t.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE=13]="EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE=14]="INVALID_PLURAL_ARGUMENT_OFFSET_VALUE",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR=15]="EXPECT_SELECT_ARGUMENT_SELECTOR",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR=16]="EXPECT_PLURAL_ARGUMENT_SELECTOR",t[t.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT=17]="EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT",t[t.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT=18]="EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT",t[t.INVALID_PLURAL_ARGUMENT_SELECTOR=19]="INVALID_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_PLURAL_ARGUMENT_SELECTOR=20]="DUPLICATE_PLURAL_ARGUMENT_SELECTOR",t[t.DUPLICATE_SELECT_ARGUMENT_SELECTOR=21]="DUPLICATE_SELECT_ARGUMENT_SELECTOR",t[t.MISSING_OTHER_CLAUSE=22]="MISSING_OTHER_CLAUSE",t[t.INVALID_TAG=23]="INVALID_TAG",t[t.INVALID_TAG_NAME=25]="INVALID_TAG_NAME",t[t.UNMATCHED_CLOSING_TAG=26]="UNMATCHED_CLOSING_TAG",t[t.UNCLOSED_TAG=27]="UNCLOSED_TAG"})(jt||(jt={}));var $n;(function(t){t[t.literal=0]="literal",t[t.argument=1]="argument",t[t.number=2]="number",t[t.date=3]="date",t[t.time=4]="time",t[t.select=5]="select",t[t.plural=6]="plural",t[t.pound=7]="pound",t[t.tag=8]="tag"})($n||($n={}));var Ff;(function(t){t[t.number=0]="number",t[t.dateTime=1]="dateTime"})(Ff||(Ff={}));function AA(t){return t.type===$n.literal}function ZW(t){return t.type===$n.argument}function u8(t){return t.type===$n.number}function d8(t){return t.type===$n.date}function f8(t){return t.type===$n.time}function h8(t){return t.type===$n.select}function p8(t){return t.type===$n.plural}function XW(t){return t.type===$n.pound}function m8(t){return t.type===$n.tag}function g8(t){return!!(t&&typeof t=="object"&&t.type===Ff.number)}function fx(t){return!!(t&&typeof t=="object"&&t.type===Ff.dateTime)}var y8=/[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,QW=/(?:[Eec]{1,6}|G{1,5}|[Qq]{1,5}|(?:[yYur]+|U{1,5})|[ML]{1,5}|d{1,2}|D{1,3}|F{1}|[abB]{1,5}|[hkHK]{1,2}|w{1,2}|W{1}|m{1,2}|s{1,2}|[zZOvVxX]{1,4})(?=([^']*'[^']*')*[^']*$)/g;function YW(t){var e={};return t.replace(QW,function(n){var r=n.length;switch(n[0]){case"G":e.era=r===4?"long":r===5?"narrow":"short";break;case"y":e.year=r===2?"2-digit":"numeric";break;case"Y":case"u":case"U":case"r":throw new RangeError("`Y/u/U/r` (year) patterns are not supported, use `y` instead");case"q":case"Q":throw new RangeError("`q/Q` (quarter) patterns are not supported");case"M":case"L":e.month=["numeric","2-digit","short","long","narrow"][r-1];break;case"w":case"W":throw new RangeError("`w/W` (week) patterns are not supported");case"d":e.day=["numeric","2-digit"][r-1];break;case"D":case"F":case"g":throw new RangeError("`D/F/g` (day) patterns are not supported, use `d` instead");case"E":e.weekday=r===4?"long":r===5?"narrow":"short";break;case"e":if(r<4)throw new RangeError("`e..eee` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"c":if(r<4)throw new RangeError("`c..ccc` (weekday) patterns are not supported");e.weekday=["short","long","narrow","short"][r-4];break;case"a":e.hour12=!0;break;case"b":case"B":throw new RangeError("`b/B` (period) patterns are not supported, use `a` instead");case"h":e.hourCycle="h12",e.hour=["numeric","2-digit"][r-1];break;case"H":e.hourCycle="h23",e.hour=["numeric","2-digit"][r-1];break;case"K":e.hourCycle="h11",e.hour=["numeric","2-digit"][r-1];break;case"k":e.hourCycle="h24",e.hour=["numeric","2-digit"][r-1];break;case"j":case"J":case"C":throw new RangeError("`j/J/C` (hour) patterns are not supported, use `h/H/K/k` instead");case"m":e.minute=["numeric","2-digit"][r-1];break;case"s":e.second=["numeric","2-digit"][r-1];break;case"S":case"A":throw new RangeError("`S/A` (second) patterns are not supported, use `s` instead");case"z":e.timeZoneName=r<4?"short":"long";break;case"Z":case"O":case"v":case"V":case"X":case"x":throw new RangeError("`Z/O/v/V/X/x` (timeZone) patterns are not supported, use `z` instead")}return""}),e}var JW=/[\t-\r \x85\u200E\u200F\u2028\u2029]/i;function ej(t){if(t.length===0)throw new Error("Number skeleton cannot be empty");for(var e=t.split(JW).filter(function(f){return f.length>0}),n=[],r=0,i=e;r<i.length;r++){var s=i[r],o=s.split("/");if(o.length===0)throw new Error("Invalid number skeleton");for(var a=o[0],l=o.slice(1),c=0,u=l;c<u.length;c++){var d=u[c];if(d.length===0)throw new Error("Invalid number skeleton")}n.push({stem:a,options:l})}return n}function tj(t){return t.replace(/^(.*?)-/,"")}var PA=/^\.(?:(0+)(\*)?|(#+)|(0+)(#+))$/g,b8=/^(@+)?(\+|#+)?[rs]?$/g,nj=/(\*)(0+)|(#+)(0+)|(0+)/g,w8=/^(0+)$/;function IA(t){var e={};return t[t.length-1]==="r"?e.roundingPriority="morePrecision":t[t.length-1]==="s"&&(e.roundingPriority="lessPrecision"),t.replace(b8,function(n,r,i){return typeof i!="string"?(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length):i==="+"?e.minimumSignificantDigits=r.length:r[0]==="#"?e.maximumSignificantDigits=r.length:(e.minimumSignificantDigits=r.length,e.maximumSignificantDigits=r.length+(typeof i=="string"?i.length:0)),""}),e}function v8(t){switch(t){case"sign-auto":return{signDisplay:"auto"};case"sign-accounting":case"()":return{currencySign:"accounting"};case"sign-always":case"+!":return{signDisplay:"always"};case"sign-accounting-always":case"()!":return{signDisplay:"always",currencySign:"accounting"};case"sign-except-zero":case"+?":return{signDisplay:"exceptZero"};case"sign-accounting-except-zero":case"()?":return{signDisplay:"exceptZero",currencySign:"accounting"};case"sign-never":case"+_":return{signDisplay:"never"}}}function rj(t){var e;if(t[0]==="E"&&t[1]==="E"?(e={notation:"engineering"},t=t.slice(2)):t[0]==="E"&&(e={notation:"scientific"},t=t.slice(1)),e){var n=t.slice(0,2);if(n==="+!"?(e.signDisplay="always",t=t.slice(2)):n==="+?"&&(e.signDisplay="exceptZero",t=t.slice(2)),!w8.test(t))throw new Error("Malformed concise eng/scientific notation");e.minimumIntegerDigits=t.length}return e}function OA(t){var e={},n=v8(t);return n||e}function ij(t){for(var e={},n=0,r=t;n<r.length;n++){var i=r[n];switch(i.stem){case"percent":case"%":e.style="percent";continue;case"%x100":e.style="percent",e.scale=100;continue;case"currency":e.style="currency",e.currency=i.options[0];continue;case"group-off":case",_":e.useGrouping=!1;continue;case"precision-integer":case".":e.maximumFractionDigits=0;continue;case"measure-unit":case"unit":e.style="unit",e.unit=tj(i.options[0]);continue;case"compact-short":case"K":e.notation="compact",e.compactDisplay="short";continue;case"compact-long":case"KK":e.notation="compact",e.compactDisplay="long";continue;case"scientific":e=on(on(on({},e),{notation:"scientific"}),i.options.reduce(function(l,c){return on(on({},l),OA(c))},{}));continue;case"engineering":e=on(on(on({},e),{notation:"engineering"}),i.options.reduce(function(l,c){return on(on({},l),OA(c))},{}));continue;case"notation-simple":e.notation="standard";continue;case"unit-width-narrow":e.currencyDisplay="narrowSymbol",e.unitDisplay="narrow";continue;case"unit-width-short":e.currencyDisplay="code",e.unitDisplay="short";continue;case"unit-width-full-name":e.currencyDisplay="name",e.unitDisplay="long";continue;case"unit-width-iso-code":e.currencyDisplay="symbol";continue;case"scale":e.scale=parseFloat(i.options[0]);continue;case"rounding-mode-floor":e.roundingMode="floor";continue;case"rounding-mode-ceiling":e.roundingMode="ceil";continue;case"rounding-mode-down":e.roundingMode="trunc";continue;case"rounding-mode-up":e.roundingMode="expand";continue;case"rounding-mode-half-even":e.roundingMode="halfEven";continue;case"rounding-mode-half-down":e.roundingMode="halfTrunc";continue;case"rounding-mode-half-up":e.roundingMode="halfExpand";continue;case"integer-width":if(i.options.length>1)throw new RangeError("integer-width stems only accept a single optional option");i.options[0].replace(nj,function(l,c,u,d,f,h){if(c)e.minimumIntegerDigits=u.length;else{if(d&&f)throw new Error("We currently do not support maximum integer digits");if(h)throw new Error("We currently do not support exact integer digits")}return""});continue}if(w8.test(i.stem)){e.minimumIntegerDigits=i.stem.length;continue}if(PA.test(i.stem)){if(i.options.length>1)throw new RangeError("Fraction-precision stems only accept a single optional option");i.stem.replace(PA,function(l,c,u,d,f,h){return u==="*"?e.minimumFractionDigits=c.length:d&&d[0]==="#"?e.maximumFractionDigits=d.length:f&&h?(e.minimumFractionDigits=f.length,e.maximumFractionDigits=f.length+h.length):(e.minimumFractionDigits=c.length,e.maximumFractionDigits=c.length),""});var s=i.options[0];s==="w"?e=on(on({},e),{trailingZeroDisplay:"stripIfInteger"}):s&&(e=on(on({},e),IA(s)));continue}if(b8.test(i.stem)){e=on(on({},e),IA(i.stem));continue}var o=v8(i.stem);o&&(e=on(on({},e),o));var a=rj(i.stem);a&&(e=on(on({},e),a))}return e}var Cg={"001":["H","h"],419:["h","H","hB","hb"],AC:["H","h","hb","hB"],AD:["H","hB"],AE:["h","hB","hb","H"],AF:["H","hb","hB","h"],AG:["h","hb","H","hB"],AI:["H","h","hb","hB"],AL:["h","H","hB"],AM:["H","hB"],AO:["H","hB"],AR:["h","H","hB","hb"],AS:["h","H"],AT:["H","hB"],AU:["h","hb","H","hB"],AW:["H","hB"],AX:["H"],AZ:["H","hB","h"],BA:["H","hB","h"],BB:["h","hb","H","hB"],BD:["h","hB","H"],BE:["H","hB"],BF:["H","hB"],BG:["H","hB","h"],BH:["h","hB","hb","H"],BI:["H","h"],BJ:["H","hB"],BL:["H","hB"],BM:["h","hb","H","hB"],BN:["hb","hB","h","H"],BO:["h","H","hB","hb"],BQ:["H"],BR:["H","hB"],BS:["h","hb","H","hB"],BT:["h","H"],BW:["H","h","hb","hB"],BY:["H","h"],BZ:["H","h","hb","hB"],CA:["h","hb","H","hB"],CC:["H","h","hb","hB"],CD:["hB","H"],CF:["H","h","hB"],CG:["H","hB"],CH:["H","hB","h"],CI:["H","hB"],CK:["H","h","hb","hB"],CL:["h","H","hB","hb"],CM:["H","h","hB"],CN:["H","hB","hb","h"],CO:["h","H","hB","hb"],CP:["H"],CR:["h","H","hB","hb"],CU:["h","H","hB","hb"],CV:["H","hB"],CW:["H","hB"],CX:["H","h","hb","hB"],CY:["h","H","hb","hB"],CZ:["H"],DE:["H","hB"],DG:["H","h","hb","hB"],DJ:["h","H"],DK:["H"],DM:["h","hb","H","hB"],DO:["h","H","hB","hb"],DZ:["h","hB","hb","H"],EA:["H","h","hB","hb"],EC:["h","H","hB","hb"],EE:["H","hB"],EG:["h","hB","hb","H"],EH:["h","hB","hb","H"],ER:["h","H"],ES:["H","hB","h","hb"],ET:["hB","hb","h","H"],FI:["H"],FJ:["h","hb","H","hB"],FK:["H","h","hb","hB"],FM:["h","hb","H","hB"],FO:["H","h"],FR:["H","hB"],GA:["H","hB"],GB:["H","h","hb","hB"],GD:["h","hb","H","hB"],GE:["H","hB","h"],GF:["H","hB"],GG:["H","h","hb","hB"],GH:["h","H"],GI:["H","h","hb","hB"],GL:["H","h"],GM:["h","hb","H","hB"],GN:["H","hB"],GP:["H","hB"],GQ:["H","hB","h","hb"],GR:["h","H","hb","hB"],GT:["h","H","hB","hb"],GU:["h","hb","H","hB"],GW:["H","hB"],GY:["h","hb","H","hB"],HK:["h","hB","hb","H"],HN:["h","H","hB","hb"],HR:["H","hB"],HU:["H","h"],IC:["H","h","hB","hb"],ID:["H"],IE:["H","h","hb","hB"],IL:["H","hB"],IM:["H","h","hb","hB"],IN:["h","H"],IO:["H","h","hb","hB"],IQ:["h","hB","hb","H"],IR:["hB","H"],IS:["H"],IT:["H","hB"],JE:["H","h","hb","hB"],JM:["h","hb","H","hB"],JO:["h","hB","hb","H"],JP:["H","K","h"],KE:["hB","hb","H","h"],KG:["H","h","hB","hb"],KH:["hB","h","H","hb"],KI:["h","hb","H","hB"],KM:["H","h","hB","hb"],KN:["h","hb","H","hB"],KP:["h","H","hB","hb"],KR:["h","H","hB","hb"],KW:["h","hB","hb","H"],KY:["h","hb","H","hB"],KZ:["H","hB"],LA:["H","hb","hB","h"],LB:["h","hB","hb","H"],LC:["h","hb","H","hB"],LI:["H","hB","h"],LK:["H","h","hB","hb"],LR:["h","hb","H","hB"],LS:["h","H"],LT:["H","h","hb","hB"],LU:["H","h","hB"],LV:["H","hB","hb","h"],LY:["h","hB","hb","H"],MA:["H","h","hB","hb"],MC:["H","hB"],MD:["H","hB"],ME:["H","hB","h"],MF:["H","hB"],MG:["H","h"],MH:["h","hb","H","hB"],MK:["H","h","hb","hB"],ML:["H"],MM:["hB","hb","H","h"],MN:["H","h","hb","hB"],MO:["h","hB","hb","H"],MP:["h","hb","H","hB"],MQ:["H","hB"],MR:["h","hB","hb","H"],MS:["H","h","hb","hB"],MT:["H","h"],MU:["H","h"],MV:["H","h"],MW:["h","hb","H","hB"],MX:["h","H","hB","hb"],MY:["hb","hB","h","H"],MZ:["H","hB"],NA:["h","H","hB","hb"],NC:["H","hB"],NE:["H"],NF:["H","h","hb","hB"],NG:["H","h","hb","hB"],NI:["h","H","hB","hb"],NL:["H","hB"],NO:["H","h"],NP:["H","h","hB"],NR:["H","h","hb","hB"],NU:["H","h","hb","hB"],NZ:["h","hb","H","hB"],OM:["h","hB","hb","H"],PA:["h","H","hB","hb"],PE:["h","H","hB","hb"],PF:["H","h","hB"],PG:["h","H"],PH:["h","hB","hb","H"],PK:["h","hB","H"],PL:["H","h"],PM:["H","hB"],PN:["H","h","hb","hB"],PR:["h","H","hB","hb"],PS:["h","hB","hb","H"],PT:["H","hB"],PW:["h","H"],PY:["h","H","hB","hb"],QA:["h","hB","hb","H"],RE:["H","hB"],RO:["H","hB"],RS:["H","hB","h"],RU:["H"],RW:["H","h"],SA:["h","hB","hb","H"],SB:["h","hb","H","hB"],SC:["H","h","hB"],SD:["h","hB","hb","H"],SE:["H"],SG:["h","hb","H","hB"],SH:["H","h","hb","hB"],SI:["H","hB"],SJ:["H"],SK:["H"],SL:["h","hb","H","hB"],SM:["H","h","hB"],SN:["H","h","hB"],SO:["h","H"],SR:["H","hB"],SS:["h","hb","H","hB"],ST:["H","hB"],SV:["h","H","hB","hb"],SX:["H","h","hb","hB"],SY:["h","hB","hb","H"],SZ:["h","hb","H","hB"],TA:["H","h","hb","hB"],TC:["h","hb","H","hB"],TD:["h","H","hB"],TF:["H","h","hB"],TG:["H","hB"],TH:["H","h"],TJ:["H","h"],TL:["H","hB","hb","h"],TM:["H","h"],TN:["h","hB","hb","H"],TO:["h","H"],TR:["H","hB"],TT:["h","hb","H","hB"],TW:["hB","hb","h","H"],TZ:["hB","hb","H","h"],UA:["H","hB","h"],UG:["hB","hb","H","h"],UM:["h","hb","H","hB"],US:["h","hb","H","hB"],UY:["h","H","hB","hb"],UZ:["H","hB","h"],VA:["H","h","hB"],VC:["h","hb","H","hB"],VE:["h","H","hB","hb"],VG:["h","hb","H","hB"],VI:["h","hb","H","hB"],VN:["H","h"],VU:["h","H"],WF:["H","hB"],WS:["h","H"],XK:["H","hB","h"],YE:["h","hB","hb","H"],YT:["H","hB"],ZA:["H","h","hb","hB"],ZM:["h","hb","H","hB"],ZW:["H","h"],"af-ZA":["H","h","hB","hb"],"ar-001":["h","hB","hb","H"],"ca-ES":["H","h","hB"],"en-001":["h","hb","H","hB"],"en-HK":["h","hb","H","hB"],"en-IL":["H","h","hb","hB"],"en-MY":["h","hb","H","hB"],"es-BR":["H","h","hB","hb"],"es-ES":["H","h","hB","hb"],"es-GQ":["H","h","hB","hb"],"fr-CA":["H","h","hB"],"gl-ES":["H","h","hB"],"gu-IN":["hB","hb","h","H"],"hi-IN":["hB","h","H"],"it-CH":["H","h","hB"],"it-IT":["H","h","hB"],"kn-IN":["hB","h","H"],"ml-IN":["hB","h","H"],"mr-IN":["hB","hb","h","H"],"pa-IN":["hB","hb","h","H"],"ta-IN":["hB","h","hb","H"],"te-IN":["hB","h","H"],"zu-ZA":["H","hB","hb","h"]};function sj(t,e){for(var n="",r=0;r<t.length;r++){var i=t.charAt(r);if(i==="j"){for(var s=0;r+1<t.length&&t.charAt(r+1)===i;)s++,r++;var o=1+(s&1),a=s<2?1:3+(s>>1),l="a",c=oj(e);for((c=="H"||c=="k")&&(a=0);a-- >0;)n+=l;for(;o-- >0;)n=c+n}else i==="J"?n+="H":n+=i}return n}function oj(t){var e=t.hourCycle;if(e===void 0&&t.hourCycles&&t.hourCycles.length&&(e=t.hourCycles[0]),e)switch(e){case"h24":return"k";case"h23":return"H";case"h12":return"h";case"h11":return"K";default:throw new Error("Invalid hourCycle")}var n=t.language,r;n!=="root"&&(r=t.maximize().region);var i=Cg[r||""]||Cg[n||""]||Cg["".concat(n,"-001")]||Cg["001"];return i[0]}var jv,aj=new RegExp("^".concat(y8.source,"*")),lj=new RegExp("".concat(y8.source,"*$"));function Xt(t,e){return{start:t,end:e}}var cj=!!String.prototype.startsWith&&"_a".startsWith("a",1),uj=!!String.fromCodePoint,dj=!!Object.fromEntries,fj=!!String.prototype.codePointAt,hj=!!String.prototype.trimStart,pj=!!String.prototype.trimEnd,mj=!!Number.isSafeInteger,gj=mj?Number.isSafeInteger:function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<=9007199254740991},hx=!0;try{var yj=S8("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");hx=((jv=yj.exec("a"))===null||jv===void 0?void 0:jv[0])==="a"}catch{hx=!1}var MA=cj?function(e,n,r){return e.startsWith(n,r)}:function(e,n,r){return e.slice(r,r+n.length)===n},px=uj?String.fromCodePoint:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r="",i=e.length,s=0,o;i>s;){if(o=e[s++],o>1114111)throw RangeError(o+" is not a valid code point");r+=o<65536?String.fromCharCode(o):String.fromCharCode(((o-=65536)>>10)+55296,o%1024+56320)}return r},NA=dj?Object.fromEntries:function(e){for(var n={},r=0,i=e;r<i.length;r++){var s=i[r],o=s[0],a=s[1];n[o]=a}return n},x8=fj?function(e,n){return e.codePointAt(n)}:function(e,n){var r=e.length;if(!(n<0||n>=r)){var i=e.charCodeAt(n),s;return i<55296||i>56319||n+1===r||(s=e.charCodeAt(n+1))<56320||s>57343?i:(i-55296<<10)+(s-56320)+65536}},bj=hj?function(e){return e.trimStart()}:function(e){return e.replace(aj,"")},wj=pj?function(e){return e.trimEnd()}:function(e){return e.replace(lj,"")};function S8(t,e){return new RegExp(t,e)}var mx;if(hx){var RA=S8("([^\\p{White_Space}\\p{Pattern_Syntax}]*)","yu");mx=function(e,n){var r;RA.lastIndex=n;var i=RA.exec(e);return(r=i[1])!==null&&r!==void 0?r:""}}else mx=function(e,n){for(var r=[];;){var i=x8(e,n);if(i===void 0||k8(i)||kj(i))break;r.push(i),n+=i>=65536?2:1}return px.apply(void 0,r)};var vj=(function(){function t(e,n){n===void 0&&(n={}),this.message=e,this.position={offset:0,line:1,column:1},this.ignoreTag=!!n.ignoreTag,this.locale=n.locale,this.requiresOtherClause=!!n.requiresOtherClause,this.shouldParseSkeletons=!!n.shouldParseSkeletons}return t.prototype.parse=function(){if(this.offset()!==0)throw Error("parser can only be used once");return this.parseMessage(0,"",!1)},t.prototype.parseMessage=function(e,n,r){for(var i=[];!this.isEOF();){var s=this.char();if(s===123){var o=this.parseArgument(e,r);if(o.err)return o;i.push(o.val)}else{if(s===125&&e>0)break;if(s===35&&(n==="plural"||n==="selectordinal")){var a=this.clonePosition();this.bump(),i.push({type:$n.pound,location:Xt(a,this.clonePosition())})}else if(s===60&&!this.ignoreTag&&this.peek()===47){if(r)break;return this.error(jt.UNMATCHED_CLOSING_TAG,Xt(this.clonePosition(),this.clonePosition()))}else if(s===60&&!this.ignoreTag&&gx(this.peek()||0)){var o=this.parseTag(e,n);if(o.err)return o;i.push(o.val)}else{var o=this.parseLiteral(e,n);if(o.err)return o;i.push(o.val)}}}return{val:i,err:null}},t.prototype.parseTag=function(e,n){var r=this.clonePosition();this.bump();var i=this.parseTagName();if(this.bumpSpace(),this.bumpIf("/>"))return{val:{type:$n.literal,value:"<".concat(i,"/>"),location:Xt(r,this.clonePosition())},err:null};if(this.bumpIf(">")){var s=this.parseMessage(e+1,n,!0);if(s.err)return s;var o=s.val,a=this.clonePosition();if(this.bumpIf("</")){if(this.isEOF()||!gx(this.char()))return this.error(jt.INVALID_TAG,Xt(a,this.clonePosition()));var l=this.clonePosition(),c=this.parseTagName();return i!==c?this.error(jt.UNMATCHED_CLOSING_TAG,Xt(l,this.clonePosition())):(this.bumpSpace(),this.bumpIf(">")?{val:{type:$n.tag,value:i,children:o,location:Xt(r,this.clonePosition())},err:null}:this.error(jt.INVALID_TAG,Xt(a,this.clonePosition())))}else return this.error(jt.UNCLOSED_TAG,Xt(r,this.clonePosition()))}else return this.error(jt.INVALID_TAG,Xt(r,this.clonePosition()))},t.prototype.parseTagName=function(){var e=this.offset();for(this.bump();!this.isEOF()&&Sj(this.char());)this.bump();return this.message.slice(e,this.offset())},t.prototype.parseLiteral=function(e,n){for(var r=this.clonePosition(),i="";;){var s=this.tryParseQuote(n);if(s){i+=s;continue}var o=this.tryParseUnquoted(e,n);if(o){i+=o;continue}var a=this.tryParseLeftAngleBracket();if(a){i+=a;continue}break}var l=Xt(r,this.clonePosition());return{val:{type:$n.literal,value:i,location:l},err:null}},t.prototype.tryParseLeftAngleBracket=function(){return!this.isEOF()&&this.char()===60&&(this.ignoreTag||!xj(this.peek()||0))?(this.bump(),"<"):null},t.prototype.tryParseQuote=function(e){if(this.isEOF()||this.char()!==39)return null;switch(this.peek()){case 39:return this.bump(),this.bump(),"'";case 123:case 60:case 62:case 125:break;case 35:if(e==="plural"||e==="selectordinal")break;return null;default:return null}this.bump();var n=[this.char()];for(this.bump();!this.isEOF();){var r=this.char();if(r===39)if(this.peek()===39)n.push(39),this.bump();else{this.bump();break}else n.push(r);this.bump()}return px.apply(void 0,n)},t.prototype.tryParseUnquoted=function(e,n){if(this.isEOF())return null;var r=this.char();return r===60||r===123||r===35&&(n==="plural"||n==="selectordinal")||r===125&&e>0?null:(this.bump(),px(r))},t.prototype.parseArgument=function(e,n){var r=this.clonePosition();if(this.bump(),this.bumpSpace(),this.isEOF())return this.error(jt.EXPECT_ARGUMENT_CLOSING_BRACE,Xt(r,this.clonePosition()));if(this.char()===125)return this.bump(),this.error(jt.EMPTY_ARGUMENT,Xt(r,this.clonePosition()));var i=this.parseIdentifierIfPossible().value;if(!i)return this.error(jt.MALFORMED_ARGUMENT,Xt(r,this.clonePosition()));if(this.bumpSpace(),this.isEOF())return this.error(jt.EXPECT_ARGUMENT_CLOSING_BRACE,Xt(r,this.clonePosition()));switch(this.char()){case 125:return this.bump(),{val:{type:$n.argument,value:i,location:Xt(r,this.clonePosition())},err:null};case 44:return this.bump(),this.bumpSpace(),this.isEOF()?this.error(jt.EXPECT_ARGUMENT_CLOSING_BRACE,Xt(r,this.clonePosition())):this.parseArgumentOptions(e,n,i,r);default:return this.error(jt.MALFORMED_ARGUMENT,Xt(r,this.clonePosition()))}},t.prototype.parseIdentifierIfPossible=function(){var e=this.clonePosition(),n=this.offset(),r=mx(this.message,n),i=n+r.length;this.bumpTo(i);var s=this.clonePosition(),o=Xt(e,s);return{value:r,location:o}},t.prototype.parseArgumentOptions=function(e,n,r,i){var s,o=this.clonePosition(),a=this.parseIdentifierIfPossible().value,l=this.clonePosition();switch(a){case"":return this.error(jt.EXPECT_ARGUMENT_TYPE,Xt(o,l));case"number":case"date":case"time":{this.bumpSpace();var c=null;if(this.bumpIf(",")){this.bumpSpace();var u=this.clonePosition(),d=this.parseSimpleArgStyleIfPossible();if(d.err)return d;var f=wj(d.val);if(f.length===0)return this.error(jt.EXPECT_ARGUMENT_STYLE,Xt(this.clonePosition(),this.clonePosition()));var h=Xt(u,this.clonePosition());c={style:f,styleLocation:h}}var p=this.tryParseArgumentClose(i);if(p.err)return p;var m=Xt(i,this.clonePosition());if(c&&MA(c?.style,"::",0)){var g=bj(c.style.slice(2));if(a==="number"){var d=this.parseNumberSkeletonFromString(g,c.styleLocation);return d.err?d:{val:{type:$n.number,value:r,location:m,style:d.val},err:null}}else{if(g.length===0)return this.error(jt.EXPECT_DATE_TIME_SKELETON,m);var y=g;this.locale&&(y=sj(g,this.locale));var f={type:Ff.dateTime,pattern:y,location:c.styleLocation,parsedOptions:this.shouldParseSkeletons?YW(y):{}},b=a==="date"?$n.date:$n.time;return{val:{type:b,value:r,location:m,style:f},err:null}}}return{val:{type:a==="number"?$n.number:a==="date"?$n.date:$n.time,value:r,location:m,style:(s=c?.style)!==null&&s!==void 0?s:null},err:null}}case"plural":case"selectordinal":case"select":{var S=this.clonePosition();if(this.bumpSpace(),!this.bumpIf(","))return this.error(jt.EXPECT_SELECT_ARGUMENT_OPTIONS,Xt(S,on({},S)));this.bumpSpace();var C=this.parseIdentifierIfPossible(),_=0;if(a!=="select"&&C.value==="offset"){if(!this.bumpIf(":"))return this.error(jt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,Xt(this.clonePosition(),this.clonePosition()));this.bumpSpace();var d=this.tryParseDecimalInteger(jt.EXPECT_PLURAL_ARGUMENT_OFFSET_VALUE,jt.INVALID_PLURAL_ARGUMENT_OFFSET_VALUE);if(d.err)return d;this.bumpSpace(),C=this.parseIdentifierIfPossible(),_=d.val}var x=this.tryParsePluralOrSelectOptions(e,a,n,C);if(x.err)return x;var p=this.tryParseArgumentClose(i);if(p.err)return p;var I=Xt(i,this.clonePosition());return a==="select"?{val:{type:$n.select,value:r,options:NA(x.val),location:I},err:null}:{val:{type:$n.plural,value:r,options:NA(x.val),offset:_,pluralType:a==="plural"?"cardinal":"ordinal",location:I},err:null}}default:return this.error(jt.INVALID_ARGUMENT_TYPE,Xt(o,l))}},t.prototype.tryParseArgumentClose=function(e){return this.isEOF()||this.char()!==125?this.error(jt.EXPECT_ARGUMENT_CLOSING_BRACE,Xt(e,this.clonePosition())):(this.bump(),{val:!0,err:null})},t.prototype.parseSimpleArgStyleIfPossible=function(){for(var e=0,n=this.clonePosition();!this.isEOF();){var r=this.char();switch(r){case 39:{this.bump();var i=this.clonePosition();if(!this.bumpUntil("'"))return this.error(jt.UNCLOSED_QUOTE_IN_ARGUMENT_STYLE,Xt(i,this.clonePosition()));this.bump();break}case 123:{e+=1,this.bump();break}case 125:{if(e>0)e-=1;else return{val:this.message.slice(n.offset,this.offset()),err:null};break}default:this.bump();break}}return{val:this.message.slice(n.offset,this.offset()),err:null}},t.prototype.parseNumberSkeletonFromString=function(e,n){var r=[];try{r=ej(e)}catch{return this.error(jt.INVALID_NUMBER_SKELETON,n)}return{val:{type:Ff.number,tokens:r,location:n,parsedOptions:this.shouldParseSkeletons?ij(r):{}},err:null}},t.prototype.tryParsePluralOrSelectOptions=function(e,n,r,i){for(var s,o=!1,a=[],l=new Set,c=i.value,u=i.location;;){if(c.length===0){var d=this.clonePosition();if(n!=="select"&&this.bumpIf("=")){var f=this.tryParseDecimalInteger(jt.EXPECT_PLURAL_ARGUMENT_SELECTOR,jt.INVALID_PLURAL_ARGUMENT_SELECTOR);if(f.err)return f;u=Xt(d,this.clonePosition()),c=this.message.slice(d.offset,this.offset())}else break}if(l.has(c))return this.error(n==="select"?jt.DUPLICATE_SELECT_ARGUMENT_SELECTOR:jt.DUPLICATE_PLURAL_ARGUMENT_SELECTOR,u);c==="other"&&(o=!0),this.bumpSpace();var h=this.clonePosition();if(!this.bumpIf("{"))return this.error(n==="select"?jt.EXPECT_SELECT_ARGUMENT_SELECTOR_FRAGMENT:jt.EXPECT_PLURAL_ARGUMENT_SELECTOR_FRAGMENT,Xt(this.clonePosition(),this.clonePosition()));var p=this.parseMessage(e+1,n,r);if(p.err)return p;var m=this.tryParseArgumentClose(h);if(m.err)return m;a.push([c,{value:p.val,location:Xt(h,this.clonePosition())}]),l.add(c),this.bumpSpace(),s=this.parseIdentifierIfPossible(),c=s.value,u=s.location}return a.length===0?this.error(n==="select"?jt.EXPECT_SELECT_ARGUMENT_SELECTOR:jt.EXPECT_PLURAL_ARGUMENT_SELECTOR,Xt(this.clonePosition(),this.clonePosition())):this.requiresOtherClause&&!o?this.error(jt.MISSING_OTHER_CLAUSE,Xt(this.clonePosition(),this.clonePosition())):{val:a,err:null}},t.prototype.tryParseDecimalInteger=function(e,n){var r=1,i=this.clonePosition();this.bumpIf("+")||this.bumpIf("-")&&(r=-1);for(var s=!1,o=0;!this.isEOF();){var a=this.char();if(a>=48&&a<=57)s=!0,o=o*10+(a-48),this.bump();else break}var l=Xt(i,this.clonePosition());return s?(o*=r,gj(o)?{val:o,err:null}:this.error(n,l)):this.error(e,l)},t.prototype.offset=function(){return this.position.offset},t.prototype.isEOF=function(){return this.offset()===this.message.length},t.prototype.clonePosition=function(){return{offset:this.position.offset,line:this.position.line,column:this.position.column}},t.prototype.char=function(){var e=this.position.offset;if(e>=this.message.length)throw Error("out of bound");var n=x8(this.message,e);if(n===void 0)throw Error("Offset ".concat(e," is at invalid UTF-16 code unit boundary"));return n},t.prototype.error=function(e,n){return{val:null,err:{kind:e,message:this.message,location:n}}},t.prototype.bump=function(){if(!this.isEOF()){var e=this.char();e===10?(this.position.line+=1,this.position.column=1,this.position.offset+=1):(this.position.column+=1,this.position.offset+=e<65536?1:2)}},t.prototype.bumpIf=function(e){if(MA(this.message,e,this.offset())){for(var n=0;n<e.length;n++)this.bump();return!0}return!1},t.prototype.bumpUntil=function(e){var n=this.offset(),r=this.message.indexOf(e,n);return r>=0?(this.bumpTo(r),!0):(this.bumpTo(this.message.length),!1)},t.prototype.bumpTo=function(e){if(this.offset()>e)throw Error("targetOffset ".concat(e," must be greater than or equal to the current offset ").concat(this.offset()));for(e=Math.min(e,this.message.length);;){var n=this.offset();if(n===e)break;if(n>e)throw Error("targetOffset ".concat(e," is at invalid UTF-16 code unit boundary"));if(this.bump(),this.isEOF())break}},t.prototype.bumpSpace=function(){for(;!this.isEOF()&&k8(this.char());)this.bump()},t.prototype.peek=function(){if(this.isEOF())return null;var e=this.char(),n=this.offset(),r=this.message.charCodeAt(n+(e>=65536?2:1));return r??null},t})();function gx(t){return t>=97&&t<=122||t>=65&&t<=90}function xj(t){return gx(t)||t===47}function Sj(t){return t===45||t===46||t>=48&&t<=57||t===95||t>=97&&t<=122||t>=65&&t<=90||t==183||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}function k8(t){return t>=9&&t<=13||t===32||t===133||t>=8206&&t<=8207||t===8232||t===8233}function kj(t){return t>=33&&t<=35||t===36||t>=37&&t<=39||t===40||t===41||t===42||t===43||t===44||t===45||t>=46&&t<=47||t>=58&&t<=59||t>=60&&t<=62||t>=63&&t<=64||t===91||t===92||t===93||t===94||t===96||t===123||t===124||t===125||t===126||t===161||t>=162&&t<=165||t===166||t===167||t===169||t===171||t===172||t===174||t===176||t===177||t===182||t===187||t===191||t===215||t===247||t>=8208&&t<=8213||t>=8214&&t<=8215||t===8216||t===8217||t===8218||t>=8219&&t<=8220||t===8221||t===8222||t===8223||t>=8224&&t<=8231||t>=8240&&t<=8248||t===8249||t===8250||t>=8251&&t<=8254||t>=8257&&t<=8259||t===8260||t===8261||t===8262||t>=8263&&t<=8273||t===8274||t===8275||t>=8277&&t<=8286||t>=8592&&t<=8596||t>=8597&&t<=8601||t>=8602&&t<=8603||t>=8604&&t<=8607||t===8608||t>=8609&&t<=8610||t===8611||t>=8612&&t<=8613||t===8614||t>=8615&&t<=8621||t===8622||t>=8623&&t<=8653||t>=8654&&t<=8655||t>=8656&&t<=8657||t===8658||t===8659||t===8660||t>=8661&&t<=8691||t>=8692&&t<=8959||t>=8960&&t<=8967||t===8968||t===8969||t===8970||t===8971||t>=8972&&t<=8991||t>=8992&&t<=8993||t>=8994&&t<=9e3||t===9001||t===9002||t>=9003&&t<=9083||t===9084||t>=9085&&t<=9114||t>=9115&&t<=9139||t>=9140&&t<=9179||t>=9180&&t<=9185||t>=9186&&t<=9254||t>=9255&&t<=9279||t>=9280&&t<=9290||t>=9291&&t<=9311||t>=9472&&t<=9654||t===9655||t>=9656&&t<=9664||t===9665||t>=9666&&t<=9719||t>=9720&&t<=9727||t>=9728&&t<=9838||t===9839||t>=9840&&t<=10087||t===10088||t===10089||t===10090||t===10091||t===10092||t===10093||t===10094||t===10095||t===10096||t===10097||t===10098||t===10099||t===10100||t===10101||t>=10132&&t<=10175||t>=10176&&t<=10180||t===10181||t===10182||t>=10183&&t<=10213||t===10214||t===10215||t===10216||t===10217||t===10218||t===10219||t===10220||t===10221||t===10222||t===10223||t>=10224&&t<=10239||t>=10240&&t<=10495||t>=10496&&t<=10626||t===10627||t===10628||t===10629||t===10630||t===10631||t===10632||t===10633||t===10634||t===10635||t===10636||t===10637||t===10638||t===10639||t===10640||t===10641||t===10642||t===10643||t===10644||t===10645||t===10646||t===10647||t===10648||t>=10649&&t<=10711||t===10712||t===10713||t===10714||t===10715||t>=10716&&t<=10747||t===10748||t===10749||t>=10750&&t<=11007||t>=11008&&t<=11055||t>=11056&&t<=11076||t>=11077&&t<=11078||t>=11079&&t<=11084||t>=11085&&t<=11123||t>=11124&&t<=11125||t>=11126&&t<=11157||t===11158||t>=11159&&t<=11263||t>=11776&&t<=11777||t===11778||t===11779||t===11780||t===11781||t>=11782&&t<=11784||t===11785||t===11786||t===11787||t===11788||t===11789||t>=11790&&t<=11798||t===11799||t>=11800&&t<=11801||t===11802||t===11803||t===11804||t===11805||t>=11806&&t<=11807||t===11808||t===11809||t===11810||t===11811||t===11812||t===11813||t===11814||t===11815||t===11816||t===11817||t>=11818&&t<=11822||t===11823||t>=11824&&t<=11833||t>=11834&&t<=11835||t>=11836&&t<=11839||t===11840||t===11841||t===11842||t>=11843&&t<=11855||t>=11856&&t<=11857||t===11858||t>=11859&&t<=11903||t>=12289&&t<=12291||t===12296||t===12297||t===12298||t===12299||t===12300||t===12301||t===12302||t===12303||t===12304||t===12305||t>=12306&&t<=12307||t===12308||t===12309||t===12310||t===12311||t===12312||t===12313||t===12314||t===12315||t===12316||t===12317||t>=12318&&t<=12319||t===12320||t===12336||t===64830||t===64831||t>=65093&&t<=65094}function yx(t){t.forEach(function(e){if(delete e.location,h8(e)||p8(e))for(var n in e.options)delete e.options[n].location,yx(e.options[n].value);else u8(e)&&g8(e.style)||(d8(e)||f8(e))&&fx(e.style)?delete e.style.location:m8(e)&&yx(e.children)})}function Ej(t,e){e===void 0&&(e={}),e=on({shouldParseSkeletons:!0,requiresOtherClause:!0},e);var n=new vj(t,e).parse();if(n.err){var r=SyntaxError(jt[n.err.kind]);throw r.location=n.err.location,r.originalMessage=n.err.message,r}return e?.captureLocation||yx(n.val),n.val}var $f;(function(t){t.MISSING_VALUE="MISSING_VALUE",t.INVALID_VALUE="INVALID_VALUE",t.MISSING_INTL_API="MISSING_INTL_API"})($f||($f={}));var Wb=(function(t){Vb(e,t);function e(n,r,i){var s=t.call(this,n)||this;return s.code=r,s.originalMessage=i,s}return e.prototype.toString=function(){return"[formatjs Error: ".concat(this.code,"] ").concat(this.message)},e})(Error),DA=(function(t){Vb(e,t);function e(n,r,i,s){return t.call(this,'Invalid values for "'.concat(n,'": "').concat(r,'". Options are "').concat(Object.keys(i).join('", "'),'"'),$f.INVALID_VALUE,s)||this}return e})(Wb),Tj=(function(t){Vb(e,t);function e(n,r,i){return t.call(this,'Value for "'.concat(n,'" must be of type ').concat(r),$f.INVALID_VALUE,i)||this}return e})(Wb),Cj=(function(t){Vb(e,t);function e(n,r){return t.call(this,'The intl string context variable "'.concat(n,'" was not provided to the string "').concat(r,'"'),$f.MISSING_VALUE,r)||this}return e})(Wb),Ei;(function(t){t[t.literal=0]="literal",t[t.object=1]="object"})(Ei||(Ei={}));function _j(t){return t.length<2?t:t.reduce(function(e,n){var r=e[e.length-1];return!r||r.type!==Ei.literal||n.type!==Ei.literal?e.push(n):r.value+=n.value,e},[])}function Aj(t){return typeof t=="function"}function l0(t,e,n,r,i,s,o){if(t.length===1&&AA(t[0]))return[{type:Ei.literal,value:t[0].value}];for(var a=[],l=0,c=t;l<c.length;l++){var u=c[l];if(AA(u)){a.push({type:Ei.literal,value:u.value});continue}if(XW(u)){typeof s=="number"&&a.push({type:Ei.literal,value:n.getNumberFormat(e).format(s)});continue}var d=u.value;if(!(i&&d in i))throw new Cj(d,o);var f=i[d];if(ZW(u)){(!f||typeof f=="string"||typeof f=="number")&&(f=typeof f=="string"||typeof f=="number"?String(f):""),a.push({type:typeof f=="string"?Ei.literal:Ei.object,value:f});continue}if(d8(u)){var h=typeof u.style=="string"?r.date[u.style]:fx(u.style)?u.style.parsedOptions:void 0;a.push({type:Ei.literal,value:n.getDateTimeFormat(e,h).format(f)});continue}if(f8(u)){var h=typeof u.style=="string"?r.time[u.style]:fx(u.style)?u.style.parsedOptions:r.time.medium;a.push({type:Ei.literal,value:n.getDateTimeFormat(e,h).format(f)});continue}if(u8(u)){var h=typeof u.style=="string"?r.number[u.style]:g8(u.style)?u.style.parsedOptions:void 0;h&&h.scale&&(f=f*(h.scale||1)),a.push({type:Ei.literal,value:n.getNumberFormat(e,h).format(f)});continue}if(m8(u)){var p=u.children,m=u.value,g=i[m];if(!Aj(g))throw new Tj(m,"function",o);var y=l0(p,e,n,r,i,s),b=g(y.map(function(_){return _.value}));Array.isArray(b)||(b=[b]),a.push.apply(a,b.map(function(_){return{type:typeof _=="string"?Ei.literal:Ei.object,value:_}}))}if(h8(u)){var S=u.options[f]||u.options.other;if(!S)throw new DA(u.value,f,Object.keys(u.options),o);a.push.apply(a,l0(S.value,e,n,r,i));continue}if(p8(u)){var S=u.options["=".concat(f)];if(!S){if(!Intl.PluralRules)throw new Wb(`Intl.PluralRules is not available in this environment.
Try polyfilling it using "@formatjs/intl-pluralrules"
`,$f.MISSING_INTL_API,o);var C=n.getPluralRules(e,{type:u.pluralType}).select(f-(u.offset||0));S=u.options[C]||u.options.other}if(!S)throw new DA(u.value,f,Object.keys(u.options),o);a.push.apply(a,l0(S.value,e,n,r,i,f-(u.offset||0)));continue}}return _j(a)}function Pj(t,e){return e?on(on(on({},t||{}),e||{}),Object.keys(t).reduce(function(n,r){return n[r]=on(on({},t[r]),e[r]||{}),n},{})):t}function Ij(t,e){return e?Object.keys(t).reduce(function(n,r){return n[r]=Pj(t[r],e[r]),n},on({},t)):t}function qv(t){return{create:function(){return{get:function(e){return t[e]},set:function(e,n){t[e]=n}}}}}function Oj(t){return t===void 0&&(t={number:{},dateTime:{},pluralRules:{}}),{getNumberFormat:Vv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.NumberFormat).bind.apply(e,Hv([void 0],n,!1)))},{cache:qv(t.number),strategy:Wv.variadic}),getDateTimeFormat:Vv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.DateTimeFormat).bind.apply(e,Hv([void 0],n,!1)))},{cache:qv(t.dateTime),strategy:Wv.variadic}),getPluralRules:Vv(function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new((e=Intl.PluralRules).bind.apply(e,Hv([void 0],n,!1)))},{cache:qv(t.pluralRules),strategy:Wv.variadic})}}var E8=(function(){function t(e,n,r,i){n===void 0&&(n=t.defaultLocale);var s=this;if(this.formatterCache={number:{},dateTime:{},pluralRules:{}},this.format=function(l){var c=s.formatToParts(l);if(c.length===1)return c[0].value;var u=c.reduce(function(d,f){return!d.length||f.type!==Ei.literal||typeof d[d.length-1]!="string"?d.push(f.value):d[d.length-1]+=f.value,d},[]);return u.length<=1?u[0]||"":u},this.formatToParts=function(l){return l0(s.ast,s.locales,s.formatters,s.formats,l,void 0,s.message)},this.resolvedOptions=function(){var l;return{locale:((l=s.resolvedLocale)===null||l===void 0?void 0:l.toString())||Intl.NumberFormat.supportedLocalesOf(s.locales)[0]}},this.getAst=function(){return s.ast},this.locales=n,this.resolvedLocale=t.resolveLocale(n),typeof e=="string"){if(this.message=e,!t.__parse)throw new TypeError("IntlMessageFormat.__parse must be set to process `message` of type `string`");var o=i||{};o.formatters;var a=UW(o,["formatters"]);this.ast=t.__parse(e,on(on({},a),{locale:this.resolvedLocale}))}else this.ast=e;if(!Array.isArray(this.ast))throw new TypeError("A message must be provided as a String or AST.");this.formats=Ij(t.formats,r),this.formatters=i&&i.formatters||Oj(this.formatterCache)}return Object.defineProperty(t,"defaultLocale",{get:function(){return t.memoizedDefaultLocale||(t.memoizedDefaultLocale=new Intl.NumberFormat().resolvedOptions().locale),t.memoizedDefaultLocale},enumerable:!1,configurable:!0}),t.memoizedDefaultLocale=null,t.resolveLocale=function(e){if(!(typeof Intl.Locale>"u")){var n=Intl.NumberFormat.supportedLocalesOf(e);return n.length>0?new Intl.Locale(n[0]):new Intl.Locale(typeof e=="string"?e:e[0])}},t.__parse=Ej,t.formats={number:{integer:{maximumFractionDigits:0},currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}},t})();function Mj(t,e){if(e==null)return;if(e in t)return t[e];const n=e.split(".");let r=t;for(let i=0;i<n.length;i++)if(typeof r=="object"){if(i>0){const s=n.slice(i,n.length).join(".");if(s in r){r=r[s];break}}r=r[n[i]]}else r=void 0;return r}const fc={},Nj=(t,e,n)=>n&&(e in fc||(fc[e]={}),t in fc[e]||(fc[e][t]=n),n),T8=(t,e)=>{if(e==null)return;if(e in fc&&t in fc[e])return fc[e][t];const n=Um(e);for(let r=0;r<n.length;r++){const i=n[r],s=Dj(i,t);if(s)return Nj(t,e,s)}};let Mk;const ah=Ds({});function Rj(t){return Mk[t]||null}function Nk(t){return t in Mk}function Dj(t,e){if(!Nk(t))return null;const n=Rj(t);return Mj(n,e)}function Lj(t){if(t==null)return;const e=Um(t);for(let n=0;n<e.length;n++){const r=e[n];if(Nk(r))return r}}function Bj(t,...e){delete fc[t],ah.update(n=>(n[t]=zW.all([n[t]||{},...e]),n))}nl([ah],([t])=>Object.keys(t));ah.subscribe(t=>Mk=t);const wp={};function Fj(t){wp[t]=new Set}function $j(t,e){wp[t].delete(e),wp[t].size===0&&delete wp[t]}function vp(t){return wp[t]}function zj(t){return Um(t).map(e=>{const n=vp(e);return[e,n?[...n]:[]]}).filter(([,e])=>e.length>0)}function H0(t){return t==null?!1:Um(t).some(e=>{var n;return(n=vp(e))==null?void 0:n.size})}function Uj(t,e){return Promise.all(e.map(r=>($j(t,r),r().then(i=>i.default||i)))).then(r=>Bj(t,...r))}const Bh={};function Rk(t){if(!H0(t))return t in Bh?Bh[t]:Promise.resolve();const e=zj(t);return Bh[t]=Promise.all(e.map(([n,r])=>Uj(n,r))).then(()=>{if(H0(t))return Rk(t);delete Bh[t]}),Bh[t]}function C8(t,e){vp(t)||Fj(t);const n=vp(t);vp(t).has(e)||(Nk(t)||ah.update(r=>(r[t]={},r)),n.add(e))}var LA=Object.getOwnPropertySymbols,Hj=Object.prototype.hasOwnProperty,Vj=Object.prototype.propertyIsEnumerable,Wj=(t,e)=>{var n={};for(var r in t)Hj.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&LA)for(var r of LA(t))e.indexOf(r)<0&&Vj.call(t,r)&&(n[r]=t[r]);return n};const jj={number:{scientific:{notation:"scientific"},engineering:{notation:"engineering"},compactLong:{notation:"compact",compactDisplay:"long"},compactShort:{notation:"compact",compactDisplay:"short"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};function qj({locale:t,id:e}){console.warn(`[svelte-i18n] The message "${e}" was not found in "${Um(t).join('", "')}".${H0(vl())?`

Note: there are at least one loader still registered to this locale that wasn't executed.`:""}`)}const Kj={fallbackLocale:null,loadingDelay:200,formats:jj,warnOnMissingMessages:!0,handleMissingMessage:void 0,ignoreTag:!0},ip=Kj;function Yu(){return ip}function Gj(t){const e=t,{formats:n}=e,r=Wj(e,["formats"]);let i=t.fallbackLocale;if(t.initialLocale)try{E8.resolveLocale(t.initialLocale)&&(i=t.initialLocale)}catch{console.warn(`[svelte-i18n] The initial locale "${t.initialLocale}" is not a valid locale.`)}return r.warnOnMissingMessages&&(delete r.warnOnMissingMessages,r.handleMissingMessage==null?r.handleMissingMessage=qj:console.warn('[svelte-i18n] The "warnOnMissingMessages" option is deprecated. Please use the "handleMissingMessage" option instead.')),Object.assign(ip,r,{initialLocale:i}),n&&("number"in n&&Object.assign(ip.formats.number,n.number),"date"in n&&Object.assign(ip.formats.date,n.date),"time"in n&&Object.assign(ip.formats.time,n.time)),gs.set(i)}const Kv=Ds(!1);var Zj=Object.defineProperty,Xj=Object.defineProperties,Qj=Object.getOwnPropertyDescriptors,BA=Object.getOwnPropertySymbols,Yj=Object.prototype.hasOwnProperty,Jj=Object.prototype.propertyIsEnumerable,FA=(t,e,n)=>e in t?Zj(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,eq=(t,e)=>{for(var n in e||(e={}))Yj.call(e,n)&&FA(t,n,e[n]);if(BA)for(var n of BA(e))Jj.call(e,n)&&FA(t,n,e[n]);return t},tq=(t,e)=>Xj(t,Qj(e));let bx;const V0=Ds(null);function $A(t){return t.split("-").map((e,n,r)=>r.slice(0,n+1).join("-")).reverse()}function Um(t,e=Yu().fallbackLocale){const n=$A(t);return e?[...new Set([...n,...$A(e)])]:n}function vl(){return bx??void 0}V0.subscribe(t=>{bx=t??void 0,typeof window<"u"&&t!=null&&document.documentElement.setAttribute("lang",t)});const nq=t=>{if(t&&Lj(t)&&H0(t)){const{loadingDelay:e}=Yu();let n;return typeof window<"u"&&vl()!=null&&e?n=window.setTimeout(()=>Kv.set(!0),e):Kv.set(!0),Rk(t).then(()=>{V0.set(t)}).finally(()=>{clearTimeout(n),Kv.set(!1)})}return V0.set(t)},gs=tq(eq({},V0),{set:nq}),rq=()=>typeof window>"u"?null:window.navigator.language||window.navigator.languages[0],jb=t=>{const e=Object.create(null);return r=>{const i=JSON.stringify(r);return i in e?e[i]:e[i]=t(r)}};var iq=Object.defineProperty,W0=Object.getOwnPropertySymbols,_8=Object.prototype.hasOwnProperty,A8=Object.prototype.propertyIsEnumerable,zA=(t,e,n)=>e in t?iq(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Dk=(t,e)=>{for(var n in e||(e={}))_8.call(e,n)&&zA(t,n,e[n]);if(W0)for(var n of W0(e))A8.call(e,n)&&zA(t,n,e[n]);return t},lh=(t,e)=>{var n={};for(var r in t)_8.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&W0)for(var r of W0(t))e.indexOf(r)<0&&A8.call(t,r)&&(n[r]=t[r]);return n};const Zp=(t,e)=>{const{formats:n}=Yu();if(t in n&&e in n[t])return n[t][e];throw new Error(`[svelte-i18n] Unknown "${e}" ${t} format.`)},sq=jb(t=>{var e=t,{locale:n,format:r}=e,i=lh(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format numbers');return r&&(i=Zp("number",r)),new Intl.NumberFormat(n,i)}),oq=jb(t=>{var e=t,{locale:n,format:r}=e,i=lh(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format dates');return r?i=Zp("date",r):Object.keys(i).length===0&&(i=Zp("date","short")),new Intl.DateTimeFormat(n,i)}),aq=jb(t=>{var e=t,{locale:n,format:r}=e,i=lh(e,["locale","format"]);if(n==null)throw new Error('[svelte-i18n] A "locale" must be set to format time values');return r?i=Zp("time",r):Object.keys(i).length===0&&(i=Zp("time","short")),new Intl.DateTimeFormat(n,i)}),lq=(t={})=>{var e=t,{locale:n=vl()}=e,r=lh(e,["locale"]);return sq(Dk({locale:n},r))},cq=(t={})=>{var e=t,{locale:n=vl()}=e,r=lh(e,["locale"]);return oq(Dk({locale:n},r))},uq=(t={})=>{var e=t,{locale:n=vl()}=e,r=lh(e,["locale"]);return aq(Dk({locale:n},r))},dq=jb((t,e=vl())=>new E8(t,e,Yu().formats,{ignoreTag:Yu().ignoreTag})),fq=(t,e={})=>{var n,r,i,s;let o=e;typeof t=="object"&&(o=t,t=o.id);const{values:a,locale:l=vl(),default:c}=o;if(l==null)throw new Error("[svelte-i18n] Cannot format a message without first setting the initial locale.");let u=T8(t,l);if(!u)u=(s=(i=(r=(n=Yu()).handleMissingMessage)==null?void 0:r.call(n,{locale:l,id:t,defaultValue:c}))!=null?i:c)!=null?s:t;else if(typeof u!="string")return console.warn(`[svelte-i18n] Message with id "${t}" must be of type "string", found: "${typeof u}". Gettin its value through the "$format" method is deprecated; use the "json" method instead.`),u;if(!a)return u;let d=u;try{d=dq(u,l).format(a)}catch(f){f instanceof Error&&console.warn(`[svelte-i18n] Message "${t}" has syntax error:`,f.message)}return d},hq=(t,e)=>uq(e).format(t),pq=(t,e)=>cq(e).format(t),mq=(t,e)=>lq(e).format(t),gq=(t,e=vl())=>T8(t,e),or=nl([gs,ah],()=>fq);nl([gs],()=>hq);nl([gs],()=>pq);nl([gs],()=>mq);nl([gs,ah],()=>gq);function yq(t){return Rk(vl()||Yu().initialLocale)}C8("ja",()=>Hb(()=>import("./ja-Ssp3ABV6.js"),[]));C8("en",()=>Hb(()=>import("./en-BYey4n9P.js"),[]));function bq(){const t=localStorage.getItem("locale"),e=rq();return t&&(t==="ja"||t==="en")?t:e&&e.startsWith("ja")?"ja":"en"}const P8=bq();Gj({fallbackLocale:"ja",initialLocale:P8,loadingDelay:0});gs.set(P8);function wq(t){return typeof t=="function"}function Hm(t){return t!==null&&typeof t=="object"}const vq=["string","number","bigint","boolean"];function wx(t){return t==null||vq.includes(typeof t)?!0:Array.isArray(t)?t.every(e=>wx(e)):typeof t=="object"?Object.getPrototypeOf(t)===Object.prototype:!1}const j0=Symbol("box"),I8=Symbol("is-writable");function $e(t,e){const n=oe(t);return e?{[j0]:!0,[I8]:!0,get current(){return E(n)},set current(r){e(r)}}:{[j0]:!0,get current(){return t()}}}function O8(t){return Hm(t)&&j0 in t}function xq(t){return O8(t)?t:wq(t)?$e(t):Ls(t)}function Ls(t){let e=me(Wt(t));return{[j0]:!0,[I8]:!0,get current(){return E(e)},set current(n){K(e,n,!0)}}}function M8(...t){return function(e){for(const n of t)if(n){if(e.defaultPrevented)return;typeof n=="function"?n.call(this,e):n.current?.call(this,e)}}}var UA=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,Sq=/\n/g,kq=/^\s*/,Eq=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,Tq=/^:\s*/,Cq=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,_q=/^[;\s]*/,Aq=/^\s+|\s+$/g,Pq=`
`,HA="/",VA="*",vu="",Iq="comment",Oq="declaration";function Mq(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function i(p){var m=p.match(Sq);m&&(n+=m.length);var g=p.lastIndexOf(Pq);r=~g?p.length-g:r+p.length}function s(){var p={line:n,column:r};return function(m){return m.position=new o(p),c(),m}}function o(p){this.start=p,this.end={line:n,column:r},this.source=e.source}o.prototype.content=t;function a(p){var m=new Error(e.source+":"+n+":"+r+": "+p);if(m.reason=p,m.filename=e.source,m.line=n,m.column=r,m.source=t,!e.silent)throw m}function l(p){var m=p.exec(t);if(m){var g=m[0];return i(g),t=t.slice(g.length),m}}function c(){l(kq)}function u(p){var m;for(p=p||[];m=d();)m!==!1&&p.push(m);return p}function d(){var p=s();if(!(HA!=t.charAt(0)||VA!=t.charAt(1))){for(var m=2;vu!=t.charAt(m)&&(VA!=t.charAt(m)||HA!=t.charAt(m+1));)++m;if(m+=2,vu===t.charAt(m-1))return a("End of comment missing");var g=t.slice(2,m-2);return r+=2,i(g),t=t.slice(m),r+=2,p({type:Iq,comment:g})}}function f(){var p=s(),m=l(Eq);if(m){if(d(),!l(Tq))return a("property missing ':'");var g=l(Cq),y=p({type:Oq,property:WA(m[0].replace(UA,vu)),value:g?WA(g[0].replace(UA,vu)):vu});return l(_q),y}}function h(){var p=[];u(p);for(var m;m=f();)m!==!1&&(p.push(m),u(p));return p}return c(),h()}function WA(t){return t?t.replace(Aq,vu):vu}function Nq(t,e){let n=null;if(!t||typeof t!="string")return n;const r=Mq(t),i=typeof e=="function";return r.forEach(s=>{if(s.type!=="declaration")return;const{property:o,value:a}=s;i?e(o,a,s):a&&(n=n||{},n[o]=a)}),n}const Rq=/\d/,Dq=["-","_","/","."];function Lq(t=""){if(!Rq.test(t))return t!==t.toLowerCase()}function Bq(t){const e=[];let n="",r,i;for(const s of t){const o=Dq.includes(s);if(o===!0){e.push(n),n="",r=void 0;continue}const a=Lq(s);if(i===!1){if(r===!1&&a===!0){e.push(n),n=s,r=a;continue}if(r===!0&&a===!1&&n.length>1){const l=n.at(-1);e.push(n.slice(0,Math.max(0,n.length-1))),n=l+s,r=a;continue}}n+=s,r=a,i=o}return e.push(n),e}function N8(t){return t?Bq(t).map(e=>$q(e)).join(""):""}function Fq(t){return zq(N8(t||""))}function $q(t){return t?t[0].toUpperCase()+t.slice(1):""}function zq(t){return t?t[0].toLowerCase()+t.slice(1):""}function sp(t){if(!t)return{};const e={};function n(r,i){if(r.startsWith("-moz-")||r.startsWith("-webkit-")||r.startsWith("-ms-")||r.startsWith("-o-")){e[N8(r)]=i;return}if(r.startsWith("--")){e[r]=i;return}e[Fq(r)]=i}return Nq(t,n),e}function xp(...t){return(...e)=>{for(const n of t)typeof n=="function"&&n(...e)}}function Uq(t,e){const n=RegExp(t,"g");return r=>{if(typeof r!="string")throw new TypeError(`expected an argument of type string, but got ${typeof r}`);return r.match(n)?r.replace(n,e):r}}const Hq=Uq(/[A-Z]/,t=>`-${t.toLowerCase()}`);function Vq(t){if(!t||typeof t!="object"||Array.isArray(t))throw new TypeError(`expected an argument of type object, but got ${typeof t}`);return Object.keys(t).map(e=>`${Hq(e)}: ${t[e]};`).join(`
`)}function R8(t={}){return Vq(t).replace(`
`," ")}const Wq=["onabort","onanimationcancel","onanimationend","onanimationiteration","onanimationstart","onauxclick","onbeforeinput","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncompositionend","oncompositionstart","oncompositionupdate","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onfocusin","onfocusout","onformdata","ongotpointercapture","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onlostpointercapture","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onpaste","onpause","onplay","onplaying","onpointercancel","onpointerdown","onpointerenter","onpointerleave","onpointermove","onpointerout","onpointerover","onpointerup","onprogress","onratechange","onreset","onresize","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onselectionchange","onselectstart","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","ontouchcancel","ontouchend","ontouchmove","ontouchstart","ontransitioncancel","ontransitionend","ontransitionrun","ontransitionstart","onvolumechange","onwaiting","onwebkitanimationend","onwebkitanimationiteration","onwebkitanimationstart","onwebkittransitionend","onwheel"],jq=new Set(Wq);function qq(t){return jq.has(t)}function yr(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const r=t[n];if(r){for(const i of Object.keys(r)){const s=e[i],o=r[i],a=typeof s=="function",l=typeof o=="function";if(a&&qq(i)){const c=s,u=o;e[i]=M8(c,u)}else if(a&&l)e[i]=xp(s,o);else if(i==="class"){const c=wx(s),u=wx(o);c&&u?e[i]=i0(s,o):c?e[i]=i0(s):u&&(e[i]=i0(o))}else if(i==="style"){const c=typeof s=="object",u=typeof o=="object",d=typeof s=="string",f=typeof o=="string";if(c&&u)e[i]={...s,...o};else if(c&&f){const h=sp(o);e[i]={...s,...h}}else if(d&&u){const h=sp(s);e[i]={...h,...o}}else if(d&&f){const h=sp(s),p=sp(o);e[i]={...h,...p}}else c?e[i]=s:u?e[i]=o:d?e[i]=s:f&&(e[i]=o)}else e[i]=o!==void 0?o:s}for(const i of Object.getOwnPropertySymbols(r)){const s=e[i],o=r[i];e[i]=o!==void 0?o:s}}}return typeof e.style=="object"&&(e.style=R8(e.style).replaceAll(`
`," ")),e.hidden===!1&&(e.hidden=void 0,delete e.hidden),e.disabled===!1&&(e.disabled=void 0,delete e.disabled),e}const D8=typeof window<"u"?window:void 0;function Kq(t){let e=t.activeElement;for(;e?.shadowRoot;){const n=e.shadowRoot.activeElement;if(n===e)break;e=n}return e}class L8 extends Map{#e=new Map;#t=me(0);#n=me(0);#r=tl||-1;constructor(e){if(super(),e){for(var[n,r]of e)super.set(n,r);this.#n.v=super.size}}#i(e){return tl===this.#r?me(e):Lc(e)}has(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#i(0),n.set(e,r);else return E(this.#t),!1}return E(r),!0}forEach(e,n){this.#a(),super.forEach(e,n)}get(e){var n=this.#e,r=n.get(e);if(r===void 0){var i=super.get(e);if(i!==void 0)r=this.#i(0),n.set(e,r);else{E(this.#t);return}}return E(r),super.get(e)}set(e,n){var r=this.#e,i=r.get(e),s=super.get(e),o=super.set(e,n),a=this.#t;if(i===void 0)i=this.#i(0),r.set(e,i),K(this.#n,super.size),Ro(a);else if(s!==n){Ro(i);var l=a.reactions===null?null:new Set(a.reactions),c=l===null||!i.reactions?.every(u=>l.has(u));c&&Ro(a)}return o}delete(e){var n=this.#e,r=n.get(e),i=super.delete(e);return r!==void 0&&(n.delete(e),K(this.#n,super.size),K(r,-1),Ro(this.#t)),i}clear(){if(super.size!==0){super.clear();var e=this.#e;K(this.#n,0);for(var n of e.values())K(n,-1);Ro(this.#t),e.clear()}}#a(){E(this.#t);var e=this.#e;if(this.#n.v!==e.size){for(var n of super.keys())if(!e.has(n)){var r=this.#i(0);e.set(n,r)}}for([,r]of this.#e)E(r)}keys(){return E(this.#t),super.keys()}values(){return this.#a(),super.values()}entries(){return this.#a(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return E(this.#n),super.size}}class Gq{#e;#t;constructor(e={}){const{window:n=D8,document:r=n?.document}=e;n!==void 0&&(this.#e=r,this.#t=uk(i=>{const s=Sr(n,"focusin",i),o=Sr(n,"focusout",i);return()=>{s(),o()}}))}get current(){return this.#t?.(),this.#e?Kq(this.#e):null}}new Gq;function Zq(t){return typeof t=="function"}class Xc{#e;#t;constructor(e){this.#e=e,this.#t=Symbol(e)}get key(){return this.#t}exists(){return j7(this.#t)}get(){const e=j2(this.#t);if(e===void 0)throw new Error(`Context "${this.#e}" not found`);return e}getOr(e){const n=j2(this.#t);return n===void 0?e:n}set(e){return W7(this.#t,e)}}function Xq(t,e){switch(t){case"post":Ge(e);break;case"pre":d9(e);break}}function B8(t,e,n,r={}){const{lazy:i=!1}=r;let s=!i,o=Array.isArray(t)?[]:void 0;Xq(e,()=>{const a=Array.isArray(t)?t.map(c=>c()):t();if(!s){s=!0,o=a;return}const l=ms(()=>n(a,o));return o=a,l})}function Mr(t,e,n){B8(t,"post",e,n)}function Qq(t,e,n){B8(t,"pre",e,n)}Mr.pre=Qq;function jA(t){return Zq(t)?t():t}class Yq{#e={width:0,height:0};#t=!1;#n;#r;#i;#a=oe(()=>(E(this.#o)?.(),this.getSize().width));#s=oe(()=>(E(this.#o)?.(),this.getSize().height));#o=oe(()=>{const e=jA(this.#r);if(e)return uk(n=>{if(!this.#i)return;const r=new this.#i.ResizeObserver(i=>{this.#t=!0;for(const s of i){const o=this.#n.box==="content-box"?s.contentBoxSize:s.borderBoxSize,a=Array.isArray(o)?o:[o];this.#e.width=a.reduce((l,c)=>Math.max(l,c.inlineSize),0),this.#e.height=a.reduce((l,c)=>Math.max(l,c.blockSize),0)}n()});return r.observe(e),()=>{this.#t=!1,r.disconnect()}})});constructor(e,n={box:"border-box"}){this.#i=n.window??D8,this.#n=n,this.#r=e,this.#e={width:0,height:0}}calculateSize(){const e=jA(this.#r);if(!e||!this.#i)return;const n=e.offsetWidth,r=e.offsetHeight;if(this.#n.box==="border-box")return{width:n,height:r};const i=this.#i.getComputedStyle(e),s=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),o=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),a=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth),l=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth),c=n-s-a,u=r-o-l;return{width:c,height:u}}getSize(){return this.#t?this.#e:this.calculateSize()??this.#e}get current(){return E(this.#o)?.(),this.getSize()}get width(){return E(this.#a)}get height(){return E(this.#s)}}function gd(t){Ge(()=>()=>{t()})}function Jq(t){Ge(()=>ms(()=>t()))}function eK(t,e){return setTimeout(e,t)}function Lk(t){ul().then(t)}const tK=1,nK=9,rK=11;function vx(t){return Hm(t)&&t.nodeType===tK&&typeof t.nodeName=="string"}function F8(t){return Hm(t)&&t.nodeType===nK}function iK(t){return Hm(t)&&t.constructor?.name==="VisualViewport"}function sK(t){return Hm(t)&&t.nodeType!==void 0}function $8(t){return sK(t)&&t.nodeType===rK&&"host"in t}function oK(t,e){if(!t||!e||!vx(t)||!vx(e))return!1;const n=e.getRootNode?.();if(t===e||t.contains(e))return!0;if(n&&$8(n)){let r=e;for(;r;){if(t===r)return!0;r=r.parentNode||r.host}}return!1}function z8(t){return F8(t)?t:iK(t)?t.document:t?.ownerDocument??document}function U8(t){return $8(t)?U8(t.host):F8(t)?t.defaultView??window:vx(t)?t.ownerDocument?.defaultView??window:window}function aK(t){let e=t.activeElement;for(;e?.shadowRoot;){const n=e.shadowRoot.activeElement;if(n===e)break;e=n}return e}class qb{element;#e=oe(()=>this.element.current?this.element.current.getRootNode()??document:document);get root(){return E(this.#e)}set root(e){K(this.#e,e)}constructor(e){typeof e=="function"?this.element=$e(e):this.element=e}getDocument=()=>z8(this.root);getWindow=()=>this.getDocument().defaultView??window;getActiveElement=()=>aK(this.root);isActiveElement=e=>e===this.getActiveElement();getElementById(e){return this.root.getElementById(e)}querySelector=e=>this.root?this.root.querySelector(e):null;querySelectorAll=e=>this.root?this.root.querySelectorAll(e):[];setTimeout=(e,n)=>this.getWindow().setTimeout(e,n);clearTimeout=e=>this.getWindow().clearTimeout(e)}function $s(t,e){return{[v9()]:n=>O8(t)?(t.current=n,ms(()=>e?.(n)),()=>{"isConnected"in n&&n.isConnected||(t.current=null,e?.(null))}):(t(n),ms(()=>e?.(n)),()=>{"isConnected"in n&&n.isConnected||(t(null),e?.(null))})}}function lK(t){return t?"true":"false"}function zf(t){return t?"":void 0}function Bk(t){return t?"open":"closed"}class cK{#e;#t;attrs;constructor(e){this.#e=e.getVariant?e.getVariant():null,this.#t=this.#e?`data-${this.#e}-`:`data-${e.component}-`,this.getAttr=this.getAttr.bind(this),this.selector=this.selector.bind(this),this.attrs=Object.fromEntries(e.parts.map(n=>[n,this.getAttr(n)]))}getAttr(e,n){return n?`data-${n}-${e}`:`${this.#t}${e}`}selector(e,n){return`[${this.getAttr(e,n)}]`}}function Kb(t){const e=new cK(t);return{...e.attrs,selector:e.selector,getAttr:e.getAttr}}const H8="Enter",uK="Escape",V8=" ",W8=typeof document<"u",qA=dK();function dK(){return W8&&window?.navigator?.userAgent&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||window?.navigator?.maxTouchPoints>2&&/iPad|Macintosh/.test(window?.navigator.userAgent))}function KA(t){return t instanceof HTMLElement}function hf(t){return t instanceof Element}function fK(t){return t instanceof Element||t instanceof SVGElement}function q0(t){return t.pointerType==="touch"}function hK(t){return t.matches(":focus-visible")}function pK(t){return t!==null}class mK{#e;#t=null;constructor(e){this.#e=e,gd(()=>this.#n())}#n(){this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null)}run(e){this.#n();const n=this.#e.ref.current;if(n){if(typeof n.getAnimations!="function"){this.#r(e);return}this.#t=window.requestAnimationFrame(()=>{const r=n.getAnimations();if(r.length===0){this.#r(e);return}Promise.allSettled(r.map(i=>i.finished)).then(()=>{this.#r(e)})})}}#r(e){const n=()=>{e()};this.#e.afterTick?Lk(n):n()}}class Xp{#e;#t;#n;#r=me(!1);constructor(e){this.#e=e,K(this.#r,e.open.current,!0),this.#t=e.enabled??!0,this.#n=new mK({ref:this.#e.ref,afterTick:this.#e.open}),Mr(()=>this.#e.open.current,n=>{n&&K(this.#r,!0),this.#t&&this.#n.run(()=>{n===this.#e.open.current&&(this.#e.open.current||K(this.#r,!1),this.#e.onComplete?.())})})}get shouldRender(){return E(this.#r)}}function vn(){}function xl(t,e){return`bits-${t}`}const gK=Kb({component:"dialog",parts:["content","trigger","overlay","title","description","close","cancel","action"]}),Ju=new Xc("Dialog.Root | AlertDialog.Root");class Fk{static create(e){const n=Ju.getOr(null);return Ju.set(new Fk(e,n))}opts;#e=me(null);get triggerNode(){return E(this.#e)}set triggerNode(e){K(this.#e,e,!0)}#t=me(null);get contentNode(){return E(this.#t)}set contentNode(e){K(this.#t,e,!0)}#n=me(null);get overlayNode(){return E(this.#n)}set overlayNode(e){K(this.#n,e,!0)}#r=me(null);get descriptionNode(){return E(this.#r)}set descriptionNode(e){K(this.#r,e,!0)}#i=me(void 0);get contentId(){return E(this.#i)}set contentId(e){K(this.#i,e,!0)}#a=me(void 0);get titleId(){return E(this.#a)}set titleId(e){K(this.#a,e,!0)}#s=me(void 0);get triggerId(){return E(this.#s)}set triggerId(e){K(this.#s,e,!0)}#o=me(void 0);get descriptionId(){return E(this.#o)}set descriptionId(e){K(this.#o,e,!0)}#l=me(null);get cancelNode(){return E(this.#l)}set cancelNode(e){K(this.#l,e,!0)}#c=me(0);get nestedOpenCount(){return E(this.#c)}set nestedOpenCount(e){K(this.#c,e,!0)}depth;parent;contentPresence;overlayPresence;constructor(e,n){this.opts=e,this.parent=n,this.depth=n?n.depth+1:0,this.handleOpen=this.handleOpen.bind(this),this.handleClose=this.handleClose.bind(this),this.contentPresence=new Xp({ref:$e(()=>this.contentNode),open:this.opts.open,enabled:!0,onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),this.overlayPresence=new Xp({ref:$e(()=>this.overlayNode),open:this.opts.open,enabled:!0}),Mr(()=>this.opts.open.current,r=>{this.parent&&(r?this.parent.incrementNested():this.parent.decrementNested())},{lazy:!0}),gd(()=>{this.opts.open.current&&this.parent?.decrementNested()})}handleOpen(){this.opts.open.current||(this.opts.open.current=!0)}handleClose(){this.opts.open.current&&(this.opts.open.current=!1)}getBitsAttr=e=>gK.getAttr(e,this.opts.variant.current);incrementNested(){this.nestedOpenCount++,this.parent?.incrementNested()}decrementNested(){this.nestedOpenCount!==0&&(this.nestedOpenCount--,this.parent?.decrementNested())}#u=oe(()=>({"data-state":Bk(this.opts.open.current)}));get sharedProps(){return E(this.#u)}set sharedProps(e){K(this.#u,e)}}class $k{static create(e){return new $k(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=$s(this.opts.ref),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}onclick(e){this.opts.disabled.current||e.button>0||this.root.handleClose()}onkeydown(e){this.opts.disabled.current||(e.key===V8||e.key===H8)&&(e.preventDefault(),this.root.handleClose())}#e=oe(()=>({id:this.opts.id.current,[this.root.getBitsAttr(this.opts.variant.current)]:"",onclick:this.onclick,onkeydown:this.onkeydown,disabled:this.opts.disabled.current?!0:void 0,tabindex:0,...this.root.sharedProps,...this.attachment}));get props(){return E(this.#e)}set props(e){K(this.#e,e)}}class zk{static create(e){return new zk(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.root.titleId=this.opts.id.current,this.attachment=$s(this.opts.ref),Mr.pre(()=>this.opts.id.current,r=>{this.root.titleId=r})}#e=oe(()=>({id:this.opts.id.current,role:"heading","aria-level":this.opts.level.current,[this.root.getBitsAttr("title")]:"",...this.root.sharedProps,...this.attachment}));get props(){return E(this.#e)}set props(e){K(this.#e,e)}}class Uk{static create(e){return new Uk(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.root.descriptionId=this.opts.id.current,this.attachment=$s(this.opts.ref,r=>{this.root.descriptionNode=r}),Mr.pre(()=>this.opts.id.current,r=>{this.root.descriptionId=r})}#e=oe(()=>({id:this.opts.id.current,[this.root.getBitsAttr("description")]:"",...this.root.sharedProps,...this.attachment}));get props(){return E(this.#e)}set props(e){K(this.#e,e)}}class Hk{static create(e){return new Hk(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=$s(this.opts.ref,r=>{this.root.contentNode=r,this.root.contentId=r?.id})}#e=oe(()=>({open:this.root.opts.open.current}));get snippetProps(){return E(this.#e)}set snippetProps(e){K(this.#e,e)}#t=oe(()=>({id:this.opts.id.current,role:this.root.opts.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-modal":"true","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.getBitsAttr("content")]:"",style:{pointerEvents:"auto",outline:this.root.opts.variant.current==="alert-dialog"?"none":void 0,"--bits-dialog-depth":this.root.depth,"--bits-dialog-nested-count":this.root.nestedOpenCount},tabindex:this.root.opts.variant.current==="alert-dialog"?-1:void 0,"data-nested-open":zf(this.root.nestedOpenCount>0),"data-nested":zf(this.root.parent!==null),...this.root.sharedProps,...this.attachment}));get props(){return E(this.#t)}set props(e){K(this.#t,e)}get shouldRender(){return this.root.contentPresence.shouldRender}}class Vk{static create(e){return new Vk(e,Ju.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=$s(this.opts.ref,r=>this.root.overlayNode=r)}#e=oe(()=>({open:this.root.opts.open.current}));get snippetProps(){return E(this.#e)}set snippetProps(e){K(this.#e,e)}#t=oe(()=>({id:this.opts.id.current,[this.root.getBitsAttr("overlay")]:"",style:{pointerEvents:"auto","--bits-dialog-depth":this.root.depth,"--bits-dialog-nested-count":this.root.nestedOpenCount},"data-nested-open":zf(this.root.nestedOpenCount>0),"data-nested":zf(this.root.parent!==null),...this.root.sharedProps,...this.attachment}));get props(){return E(this.#t)}set props(e){K(this.#t,e)}get shouldRender(){return this.root.overlayPresence.shouldRender}}var yK=Ce("<div><!></div>");function bK(t,e){const n=sa();St(e,!0);let r=le(e,"id",19,()=>xl(n)),i=le(e,"ref",15,null),s=le(e,"level",3,2),o=Ni(e,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const a=zk.create({id:$e(()=>r()),level:$e(()=>s()),ref:$e(()=>i(),h=>i(h))}),l=oe(()=>yr(o,a.props));var c=Ue(),u=Ee(c);{var d=h=>{var p=Ue(),m=Ee(p);_t(m,()=>e.child,()=>({props:E(l)})),Y(h,p)},f=h=>{var p=yK();kr(p,()=>({...E(l)}));var m=ie(p);_t(m,()=>e.children??Ft),Y(h,p)};Ve(u,h=>{e.child?h(d):h(f,!1)})}Y(t,c),kt()}function wK(t,e){var n=Ue(),r=Ee(n);I9(r,()=>e.children,i=>{var s=Ue(),o=Ee(s);_t(o,()=>e.children??Ft),Y(i,s)}),Y(t,n)}const vK=new Xc("BitsConfig");function xK(){const t=new SK(null,{});return vK.getOr(t).opts}class SK{opts;constructor(e,n){const r=kK(e,n);this.opts={defaultPortalTo:r(i=>i.defaultPortalTo),defaultLocale:r(i=>i.defaultLocale)}}}function kK(t,e){return n=>$e(()=>{const i=n(e)?.current;if(i!==void 0)return i;if(t!==null)return n(t.opts)?.current})}function EK(t,e){return n=>{const r=xK();return $e(()=>{const i=n();if(i!==void 0)return i;const s=t(r).current;return s!==void 0?s:e})}}const TK=EK(t=>t.defaultPortalTo,"body");function Tc(t,e){St(e,!0);const n=TK(()=>e.to),r=q7();let i=oe(s);function s(){if(!W8||e.disabled)return null;let d=null;return typeof n.current=="string"?d=document.querySelector(n.current):d=n.current,d}let o;function a(){o&&(iM(o),o=null)}Mr([()=>E(i),()=>e.disabled],([d,f])=>{if(!d||f){a();return}return o=gk(wK,{target:d,props:{children:e.children},context:r}),()=>{a()}});var l=Ue(),c=Ee(l);{var u=d=>{var f=Ue(),h=Ee(f);_t(h,()=>e.children??Ft),Y(d,f)};Ve(c,d=>{e.disabled&&d(u)})}Y(t,l),kt()}function GA(t,e=500){let n=null;const r=(...i)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{t(...i)},e)};return r.destroy=()=>{n!==null&&(clearTimeout(n),n=null)},r}function j8(t,e){return t===e||t.contains(e)}function q8(t){return t?.ownerDocument??document}function CK(t,e){const{clientX:n,clientY:r}=t,i=e.getBoundingClientRect();return n<i.left||n>i.right||r<i.top||r>i.bottom}var K8=["input:not([inert]):not([inert] *)","select:not([inert]):not([inert] *)","textarea:not([inert]):not([inert] *)","a[href]:not([inert]):not([inert] *)","button:not([inert]):not([inert] *)","[tabindex]:not(slot):not([inert]):not([inert] *)","audio[controls]:not([inert]):not([inert] *)","video[controls]:not([inert]):not([inert] *)",'[contenteditable]:not([contenteditable="false"]):not([inert]):not([inert] *)',"details>summary:first-of-type:not([inert]):not([inert] *)","details:not([inert]):not([inert] *)"],K0=K8.join(","),G8=typeof Element>"u",ed=G8?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,G0=!G8&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},Z0=function(e,n){var r;n===void 0&&(n=!0);var i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=i===""||i==="true",o=s||n&&e&&(typeof e.closest=="function"?e.closest("[inert]"):Z0(e.parentNode));return o},_K=function(e){var n,r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return r===""||r==="true"},Z8=function(e,n,r){if(Z0(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(K0));return n&&ed.call(e,K0)&&i.unshift(e),i=i.filter(r),i},X0=function(e,n,r){for(var i=[],s=Array.from(e);s.length;){var o=s.shift();if(!Z0(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=X0(l,!0,r);r.flatten?i.push.apply(i,c):i.push({scopeParent:o,candidates:c})}else{var u=ed.call(o,K0);u&&r.filter(o)&&(n||!e.includes(o))&&i.push(o);var d=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!Z0(d,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(d&&f){var h=X0(d===!0?o.children:d.children,!0,r);r.flatten?i.push.apply(i,h):i.push({scopeParent:o,candidates:h})}else s.unshift.apply(s,o.children)}}return i},X8=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Q8=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||_K(e))&&!X8(e)?0:e.tabIndex},AK=function(e,n){var r=Q8(e);return r<0&&n&&!X8(e)?0:r},PK=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},Y8=function(e){return e.tagName==="INPUT"},IK=function(e){return Y8(e)&&e.type==="hidden"},OK=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return n},MK=function(e,n){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===n)return e[r]},NK=function(e){if(!e.name)return!0;var n=e.form||G0(e),r=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=r(window.CSS.escape(e.name));else try{i=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=MK(i,e.form);return!s||s===e},RK=function(e){return Y8(e)&&e.type==="radio"},DK=function(e){return RK(e)&&!NK(e)},LK=function(e){var n,r=e&&G0(e),i=(n=r)===null||n===void 0?void 0:n.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&i;){var c,u,d;r=G0(i),i=(c=r)===null||c===void 0?void 0:c.host,s=!!((u=i)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(i))}}return s},ZA=function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height;return r===0&&i===0},BK=function(e,n){var r=n.displayCheck,i=n.getShadowRoot;if(r==="full-native"&&"checkVisibility"in e){var s=e.checkVisibility({checkOpacity:!1,opacityProperty:!1,contentVisibilityAuto:!0,visibilityProperty:!0,checkVisibilityCSS:!0});return!s}if(getComputedStyle(e).visibility==="hidden")return!0;var o=ed.call(e,"details>summary:first-of-type"),a=o?e.parentElement:e;if(ed.call(a,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="full-native"||r==="legacy-full"){if(typeof i=="function"){for(var l=e;e;){var c=e.parentElement,u=G0(e);if(c&&!c.shadowRoot&&i(c)===!0)return ZA(e);e.assignedSlot?e=e.assignedSlot:!c&&u!==e.ownerDocument?e=u.host:e=c}e=l}if(LK(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return ZA(e);return!1},FK=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var i=n.children.item(r);if(i.tagName==="LEGEND")return ed.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},Q0=function(e,n){return!(n.disabled||IK(n)||BK(n,e)||OK(n)||FK(n))},xx=function(e,n){return!(DK(n)||Q8(n)<0||!Q0(e,n))},$K=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},J8=function(e){var n=[],r=[];return e.forEach(function(i,s){var o=!!i.scopeParent,a=o?i.scopeParent:i,l=AK(a,o),c=o?J8(i.candidates):a;l===0?o?n.push.apply(n,c):n.push(a):r.push({documentOrder:s,tabIndex:l,item:i,isScope:o,content:c})}),r.sort(PK).reduce(function(i,s){return s.isScope?i.push.apply(i,s.content):i.push(s.content),i},[]).concat(n)},zK=function(e,n){n=n||{};var r;return n.getShadowRoot?r=X0([e],n.includeContainer,{filter:xx.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:$K}):r=Z8(e,n.includeContainer,xx.bind(null,n)),J8(r)},UK=function(e,n){n=n||{};var r;return n.getShadowRoot?r=X0([e],n.includeContainer,{filter:Q0.bind(null,n),flatten:!0,getShadowRoot:n.getShadowRoot}):r=Z8(e,n.includeContainer,Q0.bind(null,n)),r},HK=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return ed.call(e,K0)===!1?!1:xx(n,e)},VK=K8.concat("iframe:not([inert]):not([inert] *)").join(","),WK=function(e,n){if(n=n||{},!e)throw new Error("No node provided");return ed.call(e,VK)===!1?!1:Q0(n,e)};const jK="data-context-menu-trigger",qK="data-context-menu-content";Kb({component:"menu",parts:["trigger","content","sub-trigger","item","group","group-heading","checkbox-group","checkbox-item","radio-group","radio-item","separator","sub-content","arrow"]});globalThis.bitsDismissableLayers??=new Map;class Wk{static create(e){return new Wk(e)}opts;#e;#t;#n={pointerdown:!1};#r=!1;#i=!1;#a=void 0;#s;#o=vn;constructor(e){this.opts=e,this.#t=e.interactOutsideBehavior,this.#e=e.onInteractOutside,this.#s=e.onFocusOutside,Ge(()=>{this.#a=q8(this.opts.ref.current)});let n=vn;const r=()=>{this.#m(),globalThis.bitsDismissableLayers.delete(this),this.#d.destroy(),n()};Mr([()=>this.opts.enabled.current,()=>this.opts.ref.current],()=>{if(!(!this.opts.enabled.current||!this.opts.ref.current))return eK(1,()=>{this.opts.ref.current&&(globalThis.bitsDismissableLayers.set(this,this.#t),n(),n=this.#c())}),r}),gd(()=>{this.#m.destroy(),globalThis.bitsDismissableLayers.delete(this),this.#d.destroy(),this.#o(),n()})}#l=e=>{e.defaultPrevented||this.opts.ref.current&&Lk(()=>{!this.opts.ref.current||this.#f(e.target)||e.target&&!this.#i&&this.#s.current?.(e)})};#c(){return xp(Sr(this.#a,"pointerdown",xp(this.#h,this.#g),{capture:!0}),Sr(this.#a,"pointerdown",xp(this.#p,this.#d)),Sr(this.#a,"focusin",this.#l))}#u=e=>{let n=e;n.defaultPrevented&&(n=XA(e)),this.#e.current(e)};#d=GA(e=>{if(!this.opts.ref.current){this.#o();return}const n=this.opts.isValidEvent.current(e,this.opts.ref.current)||ZK(e,this.opts.ref.current);if(!this.#r||this.#y()||!n){this.#o();return}let r=e;if(r.defaultPrevented&&(r=XA(r)),this.#t.current!=="close"&&this.#t.current!=="defer-otherwise-close"){this.#o();return}e.pointerType==="touch"?(this.#o(),this.#o=Sr(this.#a,"click",this.#u,{once:!0})):this.#e.current(r)},10);#h=e=>{this.#n[e.type]=!0};#p=e=>{this.#n[e.type]=!1};#g=()=>{this.opts.ref.current&&(this.#r=GK(this.opts.ref.current))};#f=e=>this.opts.ref.current?j8(this.opts.ref.current,e):!1;#m=GA(()=>{for(const e in this.#n)this.#n[e]=!1;this.#r=!1},20);#y(){return Object.values(this.#n).some(Boolean)}#w=()=>{this.#i=!0};#b=()=>{this.#i=!1};props={onfocuscapture:this.#w,onblurcapture:this.#b}}function KK(t=[...globalThis.bitsDismissableLayers]){return t.findLast(([e,{current:n}])=>n==="close"||n==="ignore")}function GK(t){const e=[...globalThis.bitsDismissableLayers],n=KK(e);if(n)return n[0].opts.ref.current===t;const[r]=e[0];return r.opts.ref.current===t}function ZK(t,e){const n=t.target;if(!fK(n))return!1;const r=!!n.closest(`[${jK}]`);if("button"in t&&t.button>0&&!r)return!1;if("button"in t&&t.button===0&&r)return!0;const i=!!e.closest(`[${qK}]`);return r&&i?!1:q8(n).documentElement.contains(n)&&!j8(e,n)&&CK(t,e)}function XA(t){const e=t.currentTarget,n=t.target;let r;t instanceof PointerEvent?r=new PointerEvent(t.type,t):r=new PointerEvent("pointerdown",t);let i=!1;return new Proxy(r,{get:(o,a)=>a==="currentTarget"?e:a==="target"?n:a==="preventDefault"?()=>{i=!0,typeof o.preventDefault=="function"&&o.preventDefault()}:a==="defaultPrevented"?i:a in o?o[a]:t[a]})}function eN(t,e){St(e,!0);let n=le(e,"interactOutsideBehavior",3,"close"),r=le(e,"onInteractOutside",3,vn),i=le(e,"onFocusOutside",3,vn),s=le(e,"isValidEvent",3,()=>!1);const o=Wk.create({id:$e(()=>e.id),interactOutsideBehavior:$e(()=>n()),onInteractOutside:$e(()=>r()),enabled:$e(()=>e.enabled),onFocusOutside:$e(()=>i()),isValidEvent:$e(()=>s()),ref:e.ref});var a=Ue(),l=Ee(a);_t(l,()=>e.children??Ft,()=>({props:o.props})),Y(t,a),kt()}globalThis.bitsEscapeLayers??=new Map;class jk{static create(e){return new jk(e)}opts;domContext;constructor(e){this.opts=e,this.domContext=new qb(this.opts.ref);let n=vn;Mr(()=>e.enabled.current,r=>(r&&(globalThis.bitsEscapeLayers.set(this,e.escapeKeydownBehavior),n=this.#e()),()=>{n(),globalThis.bitsEscapeLayers.delete(this)}))}#e=()=>Sr(this.domContext.getDocument(),"keydown",this.#t,{passive:!1});#t=e=>{if(e.key!==uK||!XK(this))return;const n=new KeyboardEvent(e.type,e);e.preventDefault();const r=this.opts.escapeKeydownBehavior.current;r!=="close"&&r!=="defer-otherwise-close"||this.opts.onEscapeKeydown.current(n)}}function XK(t){const e=[...globalThis.bitsEscapeLayers],n=e.findLast(([i,{current:s}])=>s==="close"||s==="ignore");if(n)return n[0]===t;const[r]=e[0];return r===t}function tN(t,e){St(e,!0);let n=le(e,"escapeKeydownBehavior",3,"close"),r=le(e,"onEscapeKeydown",3,vn);jk.create({escapeKeydownBehavior:$e(()=>n()),onEscapeKeydown:$e(()=>r()),enabled:$e(()=>e.enabled),ref:e.ref});var i=Ue(),s=Ee(i);_t(s,()=>e.children??Ft),Y(t,i),kt()}class qk{static instance;#e=Ls([]);#t=new WeakMap;#n=new WeakMap;static getInstance(){return this.instance||(this.instance=new qk),this.instance}register(e){const n=this.getActive();n&&n!==e&&n.pause();const r=document.activeElement;r&&r!==document.body&&this.#n.set(e,r),this.#e.current=this.#e.current.filter(i=>i!==e),this.#e.current.unshift(e)}unregister(e){this.#e.current=this.#e.current.filter(r=>r!==e);const n=this.getActive();n&&n.resume()}getActive(){return this.#e.current[0]}setFocusMemory(e,n){this.#t.set(e,n)}getFocusMemory(e){return this.#t.get(e)}isActiveScope(e){return this.getActive()===e}setPreFocusMemory(e,n){this.#n.set(e,n)}getPreFocusMemory(e){return this.#n.get(e)}clearPreFocusMemory(e){this.#n.delete(e)}}class Kk{#e=!1;#t=null;#n=qk.getInstance();#r=[];#i;constructor(e){this.#i=e}get paused(){return this.#e}pause(){this.#e=!0}resume(){this.#e=!1}#a(){for(const e of this.#r)e();this.#r=[]}mount(e){this.#t&&this.unmount(),this.#t=e,this.#n.register(this),this.#l(),this.#s()}unmount(){this.#t&&(this.#a(),this.#o(),this.#n.unregister(this),this.#n.clearPreFocusMemory(this),this.#t=null)}#s(){if(!this.#t)return;const e=new CustomEvent("focusScope.onOpenAutoFocus",{bubbles:!1,cancelable:!0});this.#i.onOpenAutoFocus.current(e),e.defaultPrevented||requestAnimationFrame(()=>{if(!this.#t)return;const n=this.#u();n?(n.focus(),this.#n.setFocusMemory(this,n)):this.#t.focus()})}#o(){const e=new CustomEvent("focusScope.onCloseAutoFocus",{bubbles:!1,cancelable:!0});if(this.#i.onCloseAutoFocus.current?.(e),!e.defaultPrevented){const n=this.#n.getPreFocusMemory(this);if(n&&document.contains(n))try{n.focus()}catch{document.body.focus()}}}#l(){if(!this.#t||!this.#i.trap.current)return;const e=this.#t,n=e.ownerDocument,r=o=>{if(this.#e||!this.#n.isActiveScope(this))return;const a=o.target;if(!a)return;if(e.contains(a))this.#n.setFocusMemory(this,a);else{const c=this.#n.getFocusMemory(this);if(c&&e.contains(c)&&WK(c))o.preventDefault(),c.focus();else{const u=this.#u(),d=this.#d()[0];(u||d||e).focus()}}},i=o=>{if(!this.#i.loop||this.#e||o.key!=="Tab"||!this.#n.isActiveScope(this))return;const a=this.#c();if(a.length<2)return;const l=a[0],c=a[a.length-1];!o.shiftKey&&n.activeElement===c?(o.preventDefault(),l.focus()):o.shiftKey&&n.activeElement===l&&(o.preventDefault(),c.focus())};this.#r.push(Sr(n,"focusin",r,{capture:!0}),Sr(e,"keydown",i));const s=new MutationObserver(()=>{const o=this.#n.getFocusMemory(this);if(o&&!e.contains(o)){const a=this.#u(),l=this.#d()[0],c=a||l;c?(c.focus(),this.#n.setFocusMemory(this,c)):e.focus()}});s.observe(e,{childList:!0,subtree:!0}),this.#r.push(()=>s.disconnect())}#c(){return this.#t?zK(this.#t,{includeContainer:!1,getShadowRoot:!0}):[]}#u(){return this.#c()[0]||null}#d(){return this.#t?UK(this.#t,{includeContainer:!1,getShadowRoot:!0}):[]}static use(e){let n=null;return Mr([()=>e.ref.current,()=>e.enabled.current],([r,i])=>{r&&i?(n||(n=new Kk(e)),n.mount(r)):n&&(n.unmount(),n=null)}),gd(()=>{n?.unmount()}),{get props(){return{tabindex:-1}}}}}function nN(t,e){St(e,!0);let n=le(e,"enabled",3,!1),r=le(e,"trapFocus",3,!1),i=le(e,"loop",3,!1),s=le(e,"onCloseAutoFocus",3,vn),o=le(e,"onOpenAutoFocus",3,vn);const a=Kk.use({enabled:$e(()=>n()),trap:$e(()=>r()),loop:i(),onCloseAutoFocus:$e(()=>s()),onOpenAutoFocus:$e(()=>o()),ref:e.ref});var l=Ue(),c=Ee(l);_t(c,()=>e.focusScope??Ft,()=>({props:a.props})),Y(t,l),kt()}globalThis.bitsTextSelectionLayers??=new Map;class Gk{static create(e){return new Gk(e)}opts;domContext;#e=vn;constructor(e){this.opts=e,this.domContext=new qb(e.ref);let n=vn;Mr(()=>this.opts.enabled.current,r=>(r&&(globalThis.bitsTextSelectionLayers.set(this,this.opts.enabled),n(),n=this.#t()),()=>{n(),this.#r(),globalThis.bitsTextSelectionLayers.delete(this)}))}#t(){return xp(Sr(this.domContext.getDocument(),"pointerdown",this.#n),Sr(this.domContext.getDocument(),"pointerup",M8(this.#r,this.opts.onPointerUp.current)))}#n=e=>{const n=this.opts.ref.current,r=e.target;!KA(n)||!KA(r)||!this.opts.enabled.current||!YK(this)||!oK(n,r)||(this.opts.onPointerDown.current(e),!e.defaultPrevented&&(this.#e=QK(n,this.domContext.getDocument().body)))};#r=()=>{this.#e(),this.#e=vn}}const QA=t=>t.style.userSelect||t.style.webkitUserSelect;function QK(t,e){const n=QA(e),r=QA(t);return _g(e,"none"),_g(t,"text"),()=>{_g(e,n),_g(t,r)}}function _g(t,e){t.style.userSelect=e,t.style.webkitUserSelect=e}function YK(t){const e=[...globalThis.bitsTextSelectionLayers];if(!e.length)return!1;const n=e.at(-1);return n?n[0]===t:!1}function rN(t,e){St(e,!0);let n=le(e,"preventOverflowTextSelection",3,!0),r=le(e,"onPointerDown",3,vn),i=le(e,"onPointerUp",3,vn);Gk.create({id:$e(()=>e.id),onPointerDown:$e(()=>r()),onPointerUp:$e(()=>i()),enabled:$e(()=>e.enabled&&n()),ref:e.ref});var s=Ue(),o=Ee(s);_t(o,()=>e.children??Ft),Y(t,s),kt()}globalThis.bitsIdCounter??={current:0};function Zk(t="bits"){return globalThis.bitsIdCounter.current++,`${t}-${globalThis.bitsIdCounter.current}`}class JK{#e;#t=0;#n=me();#r;constructor(e){this.#e=e}#i(){this.#t-=1,this.#r&&this.#t<=0&&(this.#r(),K(this.#n,void 0),this.#r=void 0)}get(...e){return this.#t+=1,E(this.#n)===void 0&&(this.#r=f9(()=>{K(this.#n,this.#e(...e),!0)})),Ge(()=>()=>{this.#i()}),E(this.#n)}}const c0=new L8;let Ag=me(null),Gv=null,Fh=null,$h=!1;const YA=$e(()=>{for(const t of c0.values())if(t)return!0;return!1});let Zv=null;const eG=new JK(()=>{function t(){document.body.setAttribute("style",E(Ag)??""),document.body.style.removeProperty("--scrollbar-width"),qA&&Gv?.(),K(Ag,null)}function e(){Fh!==null&&(window.clearTimeout(Fh),Fh=null)}function n(i,s){e(),$h=!0,Zv=Date.now();const o=Zv,a=()=>{Fh=null,Zv===o&&(iN(c0)?$h=!1:($h=!1,s()))},l=i===null?24:i;Fh=window.setTimeout(a,l)}function r(){E(Ag)===null&&c0.size===0&&!$h&&K(Ag,document.body.getAttribute("style"),!0)}return Mr(()=>YA.current,()=>{if(!YA.current)return;r(),$h=!1;const i=getComputedStyle(document.documentElement),s=getComputedStyle(document.body),o=i.scrollbarGutter?.includes("stable")||s.scrollbarGutter?.includes("stable"),a=window.innerWidth-document.documentElement.clientWidth,c={padding:Number.parseInt(s.paddingRight??"0",10)+a,margin:Number.parseInt(s.marginRight??"0",10)};a>0&&!o&&(document.body.style.paddingRight=`${c.padding}px`,document.body.style.marginRight=`${c.margin}px`,document.body.style.setProperty("--scrollbar-width",`${a}px`)),document.body.style.overflow="hidden",qA&&(Gv=Sr(document,"touchmove",u=>{u.target===document.documentElement&&(u.touches.length>1||u.preventDefault())},{passive:!1})),Lk(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})}),gd(()=>()=>{Gv?.()}),{get lockMap(){return c0},resetBodyStyle:t,scheduleCleanupIfNoNewLocks:n,cancelPendingCleanup:e,ensureInitialStyleCaptured:r}});class tG{#e=Zk();#t;#n=()=>null;#r;locked;constructor(e,n=()=>null){this.#t=e,this.#n=n,this.#r=eG.get(),this.#r&&(this.#r.cancelPendingCleanup(),this.#r.ensureInitialStyleCaptured(),this.#r.lockMap.set(this.#e,this.#t??!1),this.locked=$e(()=>this.#r.lockMap.get(this.#e)??!1,r=>this.#r.lockMap.set(this.#e,r)),gd(()=>{if(this.#r.lockMap.delete(this.#e),iN(this.#r.lockMap))return;const r=this.#n();this.#r.scheduleCleanupIfNoNewLocks(r,()=>{this.#r.resetBodyStyle()})}))}}function iN(t){for(const[e,n]of t)if(n)return!0;return!1}function Y0(t,e){St(e,!0);let n=le(e,"preventScroll",3,!0),r=le(e,"restoreScrollDelay",3,null);n()&&new tG(n(),()=>r()),kt()}var nG=Ce("<div><!></div>");function rG(t,e){const n=sa();St(e,!0);let r=le(e,"id",19,()=>xl(n)),i=le(e,"forceMount",3,!1),s=le(e,"ref",15,null),o=Ni(e,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const a=Vk.create({id:$e(()=>r()),ref:$e(()=>s(),f=>s(f))}),l=oe(()=>yr(o,a.props));var c=Ue(),u=Ee(c);{var d=f=>{var h=Ue(),p=Ee(h);{var m=y=>{var b=Ue(),S=Ee(b);{let C=oe(()=>({props:yr(E(l)),...a.snippetProps}));_t(S,()=>e.child,()=>E(C))}Y(y,b)},g=y=>{var b=nG();kr(b,C=>({...C}),[()=>yr(E(l))]);var S=ie(b);_t(S,()=>e.children??Ft,()=>a.snippetProps),Y(y,b)};Ve(p,y=>{e.child?y(m):y(g,!1)})}Y(f,h)};Ve(u,f=>{(a.shouldRender||i())&&f(d)})}Y(t,c),kt()}var iG=Ce("<div><!></div>");function sG(t,e){const n=sa();St(e,!0);let r=le(e,"id",19,()=>xl(n)),i=le(e,"ref",15,null),s=Ni(e,["$$slots","$$events","$$legacy","id","children","child","ref"]);const o=Uk.create({id:$e(()=>r()),ref:$e(()=>i(),f=>i(f))}),a=oe(()=>yr(s,o.props));var l=Ue(),c=Ee(l);{var u=f=>{var h=Ue(),p=Ee(h);_t(p,()=>e.child,()=>({props:E(a)})),Y(f,h)},d=f=>{var h=iG();kr(h,()=>({...E(a)}));var p=ie(h);_t(p,()=>e.children??Ft),Y(f,h)};Ve(c,f=>{e.child?f(u):f(d,!1)})}Y(t,l),kt()}const oG=["top","right","bottom","left"],$c=Math.min,as=Math.max,J0=Math.round,Pg=Math.floor,Xo=t=>({x:t,y:t}),aG={left:"right",right:"left",bottom:"top",top:"bottom"},lG={start:"end",end:"start"};function Sx(t,e,n){return as(t,$c(e,n))}function dl(t,e){return typeof t=="function"?t(e):t}function fl(t){return t.split("-")[0]}function ch(t){return t.split("-")[1]}function Xk(t){return t==="x"?"y":"x"}function Qk(t){return t==="y"?"height":"width"}const cG=new Set(["top","bottom"]);function $o(t){return cG.has(fl(t))?"y":"x"}function Yk(t){return Xk($o(t))}function uG(t,e,n){n===void 0&&(n=!1);const r=ch(t),i=Yk(t),s=Qk(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=ey(o)),[o,ey(o)]}function dG(t){const e=ey(t);return[kx(t),e,kx(e)]}function kx(t){return t.replace(/start|end/g,e=>lG[e])}const JA=["left","right"],eP=["right","left"],fG=["top","bottom"],hG=["bottom","top"];function pG(t,e,n){switch(t){case"top":case"bottom":return n?e?eP:JA:e?JA:eP;case"left":case"right":return e?fG:hG;default:return[]}}function mG(t,e,n,r){const i=ch(t);let s=pG(fl(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(kx)))),s}function ey(t){return t.replace(/left|right|bottom|top/g,e=>aG[e])}function gG(t){return{top:0,right:0,bottom:0,left:0,...t}}function sN(t){return typeof t!="number"?gG(t):{top:t,right:t,bottom:t,left:t}}function ty(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}function tP(t,e,n){let{reference:r,floating:i}=t;const s=$o(e),o=Yk(e),a=Qk(o),l=fl(e),c=s==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,f=r[a]/2-i[a]/2;let h;switch(l){case"top":h={x:u,y:r.y-i.height};break;case"bottom":h={x:u,y:r.y+r.height};break;case"right":h={x:r.x+r.width,y:d};break;case"left":h={x:r.x-i.width,y:d};break;default:h={x:r.x,y:r.y}}switch(ch(e)){case"start":h[o]-=f*(n&&c?-1:1);break;case"end":h[o]+=f*(n&&c?-1:1);break}return h}const yG=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:d}=tP(c,r,l),f=r,h={},p=0;for(let m=0;m<a.length;m++){const{name:g,fn:y}=a[m],{x:b,y:S,data:C,reset:_}=await y({x:u,y:d,initialPlacement:r,placement:f,strategy:i,middlewareData:h,rects:c,platform:o,elements:{reference:t,floating:e}});u=b??u,d=S??d,h={...h,[g]:{...h[g],...C}},_&&p<=50&&(p++,typeof _=="object"&&(_.placement&&(f=_.placement),_.rects&&(c=_.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):_.rects),{x:u,y:d}=tP(c,f,l)),m=-1)}return{x:u,y:d,placement:f,strategy:i,middlewareData:h}};async function Qp(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=dl(e,t),p=sN(h),g=a[f?d==="floating"?"reference":"floating":d],y=ty(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(g)))==null||n?g:g.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),b=d==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,S=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),C=await(s.isElement==null?void 0:s.isElement(S))?await(s.getScale==null?void 0:s.getScale(S))||{x:1,y:1}:{x:1,y:1},_=ty(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:S,strategy:l}):b);return{top:(y.top-_.top+p.top)/C.y,bottom:(_.bottom-y.bottom+p.bottom)/C.y,left:(y.left-_.left+p.left)/C.x,right:(_.right-y.right+p.right)/C.x}}const bG=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=dl(t,e)||{};if(c==null)return{};const d=sN(u),f={x:n,y:r},h=Yk(i),p=Qk(h),m=await o.getDimensions(c),g=h==="y",y=g?"top":"left",b=g?"bottom":"right",S=g?"clientHeight":"clientWidth",C=s.reference[p]+s.reference[h]-f[h]-s.floating[p],_=f[h]-s.reference[h],x=await(o.getOffsetParent==null?void 0:o.getOffsetParent(c));let I=x?x[S]:0;(!I||!await(o.isElement==null?void 0:o.isElement(x)))&&(I=a.floating[S]||s.floating[p]);const k=C/2-_/2,T=I/2-m[p]/2-1,P=$c(d[y],T),O=$c(d[b],T),D=P,F=I-m[p]-O,B=I/2-m[p]/2+k,N=Sx(D,B,F),M=!l.arrow&&ch(i)!=null&&B!==N&&s.reference[p]/2-(B<D?P:O)-m[p]/2<0,R=M?B<D?B-D:B-F:0;return{[h]:f[h]+R,data:{[h]:N,centerOffset:B-N-R,...M&&{alignmentOffset:R}},reset:M}}}),wG=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:m=!0,...g}=dl(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const y=fl(i),b=$o(a),S=fl(a)===a,C=await(l.isRTL==null?void 0:l.isRTL(c.floating)),_=f||(S||!m?[ey(a)]:dG(a)),x=p!=="none";!f&&x&&_.push(...mG(a,m,p,C));const I=[a,..._],k=await Qp(e,g),T=[];let P=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&T.push(k[y]),d){const B=uG(i,o,C);T.push(k[B[0]],k[B[1]])}if(P=[...P,{placement:i,overflows:T}],!T.every(B=>B<=0)){var O,D;const B=(((O=s.flip)==null?void 0:O.index)||0)+1,N=I[B];if(N&&(!(d==="alignment"?b!==$o(N):!1)||P.every(H=>$o(H.placement)===b?H.overflows[0]>0:!0)))return{data:{index:B,overflows:P},reset:{placement:N}};let M=(D=P.filter(R=>R.overflows[0]<=0).sort((R,H)=>R.overflows[1]-H.overflows[1])[0])==null?void 0:D.placement;if(!M)switch(h){case"bestFit":{var F;const R=(F=P.filter(H=>{if(x){const z=$o(H.placement);return z===b||z==="y"}return!0}).map(H=>[H.placement,H.overflows.filter(z=>z>0).reduce((z,V)=>z+V,0)]).sort((H,z)=>H[1]-z[1])[0])==null?void 0:F[0];R&&(M=R);break}case"initialPlacement":M=a;break}if(i!==M)return{reset:{placement:M}}}return{}}}};function nP(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function rP(t){return oG.some(e=>t[e]>=0)}const vG=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=dl(t,e);switch(r){case"referenceHidden":{const s=await Qp(e,{...i,elementContext:"reference"}),o=nP(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:rP(o)}}}case"escaped":{const s=await Qp(e,{...i,altBoundary:!0}),o=nP(s,n.floating);return{data:{escapedOffsets:o,escaped:rP(o)}}}default:return{}}}}},oN=new Set(["left","top"]);async function xG(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=fl(n),a=ch(n),l=$o(n)==="y",c=oN.has(o)?-1:1,u=s&&l?-1:1,d=dl(e,t);let{mainAxis:f,crossAxis:h,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof p=="number"&&(h=a==="end"?p*-1:p),l?{x:h*u,y:f*c}:{x:f*c,y:h*u}}const SG=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,l=await xG(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:s+l.y,data:{...l,placement:o}}}}},kG=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:g=>{let{x:y,y:b}=g;return{x:y,y:b}}},...l}=dl(t,e),c={x:n,y:r},u=await Qp(e,l),d=$o(fl(i)),f=Xk(d);let h=c[f],p=c[d];if(s){const g=f==="y"?"top":"left",y=f==="y"?"bottom":"right",b=h+u[g],S=h-u[y];h=Sx(b,h,S)}if(o){const g=d==="y"?"top":"left",y=d==="y"?"bottom":"right",b=p+u[g],S=p-u[y];p=Sx(b,p,S)}const m=a.fn({...e,[f]:h,[d]:p});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[f]:s,[d]:o}}}}}},EG=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=dl(t,e),u={x:n,y:r},d=$o(i),f=Xk(d);let h=u[f],p=u[d];const m=dl(a,e),g=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(l){const S=f==="y"?"height":"width",C=s.reference[f]-s.floating[S]+g.mainAxis,_=s.reference[f]+s.reference[S]-g.mainAxis;h<C?h=C:h>_&&(h=_)}if(c){var y,b;const S=f==="y"?"width":"height",C=oN.has(fl(i)),_=s.reference[d]-s.floating[S]+(C&&((y=o.offset)==null?void 0:y[d])||0)+(C?0:g.crossAxis),x=s.reference[d]+s.reference[S]+(C?0:((b=o.offset)==null?void 0:b[d])||0)-(C?g.crossAxis:0);p<_?p=_:p>x&&(p=x)}return{[f]:h,[d]:p}}}},TG=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:l=()=>{},...c}=dl(t,e),u=await Qp(e,c),d=fl(i),f=ch(i),h=$o(i)==="y",{width:p,height:m}=s.floating;let g,y;d==="top"||d==="bottom"?(g=d,y=f===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(y=d,g=f==="end"?"top":"bottom");const b=m-u.top-u.bottom,S=p-u.left-u.right,C=$c(m-u[g],b),_=$c(p-u[y],S),x=!e.middlewareData.shift;let I=C,k=_;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(k=S),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(I=b),x&&!f){const P=as(u.left,0),O=as(u.right,0),D=as(u.top,0),F=as(u.bottom,0);h?k=p-2*(P!==0||O!==0?P+O:as(u.left,u.right)):I=m-2*(D!==0||F!==0?D+F:as(u.top,u.bottom))}await l({...e,availableWidth:k,availableHeight:I});const T=await o.getDimensions(a.floating);return p!==T.width||m!==T.height?{reset:{rects:!0}}:{}}}};function Gb(){return typeof window<"u"}function uh(t){return aN(t)?(t.nodeName||"").toLowerCase():"#document"}function fs(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function aa(t){var e;return(e=(aN(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function aN(t){return Gb()?t instanceof Node||t instanceof fs(t).Node:!1}function lo(t){return Gb()?t instanceof Element||t instanceof fs(t).Element:!1}function Yo(t){return Gb()?t instanceof HTMLElement||t instanceof fs(t).HTMLElement:!1}function iP(t){return!Gb()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof fs(t).ShadowRoot}const CG=new Set(["inline","contents"]);function Vm(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=co(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!CG.has(i)}const _G=new Set(["table","td","th"]);function AG(t){return _G.has(uh(t))}const PG=[":popover-open",":modal"];function Zb(t){return PG.some(e=>{try{return t.matches(e)}catch{return!1}})}const IG=["transform","translate","scale","rotate","perspective"],OG=["transform","translate","scale","rotate","perspective","filter"],MG=["paint","layout","strict","content"];function Jk(t){const e=eE(),n=lo(t)?co(t):t;return IG.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||OG.some(r=>(n.willChange||"").includes(r))||MG.some(r=>(n.contain||"").includes(r))}function NG(t){let e=zc(t);for(;Yo(e)&&!Uf(e);){if(Jk(e))return e;if(Zb(e))return null;e=zc(e)}return null}function eE(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const RG=new Set(["html","body","#document"]);function Uf(t){return RG.has(uh(t))}function co(t){return fs(t).getComputedStyle(t)}function Xb(t){return lo(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function zc(t){if(uh(t)==="html")return t;const e=t.assignedSlot||t.parentNode||iP(t)&&t.host||aa(t);return iP(e)?e.host:e}function lN(t){const e=zc(t);return Uf(e)?t.ownerDocument?t.ownerDocument.body:t.body:Yo(e)&&Vm(e)?e:lN(e)}function Yp(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=lN(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=fs(i);if(s){const a=Ex(o);return e.concat(o,o.visualViewport||[],Vm(i)?i:[],a&&n?Yp(a):[])}return e.concat(i,Yp(i,[],n))}function Ex(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function cN(t){const e=co(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Yo(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=J0(n)!==s||J0(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function tE(t){return lo(t)?t:t.contextElement}function pf(t){const e=tE(t);if(!Yo(e))return Xo(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=cN(e);let o=(s?J0(n.width):n.width)/r,a=(s?J0(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const DG=Xo(0);function uN(t){const e=fs(t);return!eE()||!e.visualViewport?DG:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function LG(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==fs(t)?!1:e}function td(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=tE(t);let o=Xo(1);e&&(r?lo(r)&&(o=pf(r)):o=pf(t));const a=LG(s,n,r)?uN(s):Xo(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,u=i.width/o.x,d=i.height/o.y;if(s){const f=fs(s),h=r&&lo(r)?fs(r):r;let p=f,m=Ex(p);for(;m&&r&&h!==p;){const g=pf(m),y=m.getBoundingClientRect(),b=co(m),S=y.left+(m.clientLeft+parseFloat(b.paddingLeft))*g.x,C=y.top+(m.clientTop+parseFloat(b.paddingTop))*g.y;l*=g.x,c*=g.y,u*=g.x,d*=g.y,l+=S,c+=C,p=fs(m),m=Ex(p)}}return ty({width:u,height:d,x:l,y:c})}function Qb(t,e){const n=Xb(t).scrollLeft;return e?e.left+n:td(aa(t)).left+n}function dN(t,e){const n=t.getBoundingClientRect(),r=n.left+e.scrollLeft-Qb(t,n),i=n.top+e.scrollTop;return{x:r,y:i}}function BG(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=aa(r),a=e?Zb(e.floating):!1;if(r===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=Xo(1);const u=Xo(0),d=Yo(r);if((d||!d&&!s)&&((uh(r)!=="body"||Vm(o))&&(l=Xb(r)),Yo(r))){const h=td(r);c=pf(r),u.x=h.x+r.clientLeft,u.y=h.y+r.clientTop}const f=o&&!d&&!s?dN(o,l):Xo(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:n.y*c.y-l.scrollTop*c.y+u.y+f.y}}function FG(t){return Array.from(t.getClientRects())}function $G(t){const e=aa(t),n=Xb(t),r=t.ownerDocument.body,i=as(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=as(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+Qb(t);const a=-n.scrollTop;return co(r).direction==="rtl"&&(o+=as(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}const sP=25;function zG(t,e){const n=fs(t),r=aa(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const u=eE();(!u||u&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}const c=Qb(r);if(c<=0){const u=r.ownerDocument,d=u.body,f=getComputedStyle(d),h=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,p=Math.abs(r.clientWidth-d.clientWidth-h);p<=sP&&(s-=p)}else c<=sP&&(s+=c);return{width:s,height:o,x:a,y:l}}const UG=new Set(["absolute","fixed"]);function HG(t,e){const n=td(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=Yo(t)?pf(t):Xo(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=i*s.x,c=r*s.y;return{width:o,height:a,x:l,y:c}}function oP(t,e,n){let r;if(e==="viewport")r=zG(t,n);else if(e==="document")r=$G(aa(t));else if(lo(e))r=HG(e,n);else{const i=uN(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return ty(r)}function fN(t,e){const n=zc(t);return n===e||!lo(n)||Uf(n)?!1:co(n).position==="fixed"||fN(n,e)}function VG(t,e){const n=e.get(t);if(n)return n;let r=Yp(t,[],!1).filter(a=>lo(a)&&uh(a)!=="body"),i=null;const s=co(t).position==="fixed";let o=s?zc(t):t;for(;lo(o)&&!Uf(o);){const a=co(o),l=Jk(o);!l&&a.position==="fixed"&&(i=null),(s?!l&&!i:!l&&a.position==="static"&&!!i&&UG.has(i.position)||Vm(o)&&!l&&fN(t,o))?r=r.filter(u=>u!==o):i=a,o=zc(o)}return e.set(t,r),r}function WG(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?Zb(e)?[]:VG(e,this._c):[].concat(n),r],a=o[0],l=o.reduce((c,u)=>{const d=oP(e,u,i);return c.top=as(d.top,c.top),c.right=$c(d.right,c.right),c.bottom=$c(d.bottom,c.bottom),c.left=as(d.left,c.left),c},oP(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function jG(t){const{width:e,height:n}=cN(t);return{width:e,height:n}}function qG(t,e,n){const r=Yo(e),i=aa(e),s=n==="fixed",o=td(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Xo(0);function c(){l.x=Qb(i)}if(r||!r&&!s)if((uh(e)!=="body"||Vm(i))&&(a=Xb(e)),r){const h=td(e,!0,s,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else i&&c();s&&!r&&i&&c();const u=i&&!r&&!s?dN(i,a):Xo(0),d=o.left+a.scrollLeft-l.x-u.x,f=o.top+a.scrollTop-l.y-u.y;return{x:d,y:f,width:o.width,height:o.height}}function Xv(t){return co(t).position==="static"}function aP(t,e){if(!Yo(t)||co(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return aa(t)===n&&(n=n.ownerDocument.body),n}function hN(t,e){const n=fs(t);if(Zb(t))return n;if(!Yo(t)){let i=zc(t);for(;i&&!Uf(i);){if(lo(i)&&!Xv(i))return i;i=zc(i)}return n}let r=aP(t,e);for(;r&&AG(r)&&Xv(r);)r=aP(r,e);return r&&Uf(r)&&Xv(r)&&!Jk(r)?n:r||NG(t)||n}const KG=async function(t){const e=this.getOffsetParent||hN,n=this.getDimensions,r=await n(t.floating);return{reference:qG(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function GG(t){return co(t).direction==="rtl"}const ZG={convertOffsetParentRelativeRectToViewportRelativeRect:BG,getDocumentElement:aa,getClippingRect:WG,getOffsetParent:hN,getElementRects:KG,getClientRects:FG,getDimensions:jG,getScale:pf,isElement:lo,isRTL:GG};function pN(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function XG(t,e){let n=null,r;const i=aa(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:h}=c;if(a||e(),!f||!h)return;const p=Pg(d),m=Pg(i.clientWidth-(u+f)),g=Pg(i.clientHeight-(d+h)),y=Pg(u),S={rootMargin:-p+"px "+-m+"px "+-g+"px "+-y+"px",threshold:as(0,$c(1,l))||1};let C=!0;function _(x){const I=x[0].intersectionRatio;if(I!==l){if(!C)return o();I?o(!1,I):r=setTimeout(()=>{o(!1,1e-7)},1e3)}I===1&&!pN(c,t.getBoundingClientRect())&&o(),C=!1}try{n=new IntersectionObserver(_,{...S,root:i.ownerDocument})}catch{n=new IntersectionObserver(_,S)}n.observe(t)}return o(!0),s}function QG(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=tE(t),u=i||s?[...c?Yp(c):[],...Yp(e)]:[];u.forEach(y=>{i&&y.addEventListener("scroll",n,{passive:!0}),s&&y.addEventListener("resize",n)});const d=c&&a?XG(c,n):null;let f=-1,h=null;o&&(h=new ResizeObserver(y=>{let[b]=y;b&&b.target===c&&h&&(h.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var S;(S=h)==null||S.observe(e)})),n()}),c&&!l&&h.observe(c),h.observe(e));let p,m=l?td(t):null;l&&g();function g(){const y=td(t);m&&!pN(m,y)&&n(),m=y,p=requestAnimationFrame(g)}return n(),()=>{var y;u.forEach(b=>{i&&b.removeEventListener("scroll",n),s&&b.removeEventListener("resize",n)}),d?.(),(y=h)==null||y.disconnect(),h=null,l&&cancelAnimationFrame(p)}}const YG=SG,JG=kG,eZ=wG,tZ=TG,nZ=vG,rZ=bG,iZ=EG,sZ=(t,e,n)=>{const r=new Map,i={platform:ZG,...n},s={...i.platform,_c:r};return yG(t,e,{...i,platform:s})};function cu(t){return typeof t=="function"?t():t}function mN(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function lP(t,e){const n=mN(t);return Math.round(e*n)/n}function ny(t){return{[`--bits-${t}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${t}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${t}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${t}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${t}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function oZ(t){const e=t.whileElementsMounted,n=oe(()=>cu(t.open)??!0),r=oe(()=>cu(t.middleware)),i=oe(()=>cu(t.transform)??!0),s=oe(()=>cu(t.placement)??"bottom"),o=oe(()=>cu(t.strategy)??"absolute"),a=oe(()=>cu(t.sideOffset)??0),l=oe(()=>cu(t.alignOffset)??0),c=t.reference;let u=me(0),d=me(0);const f=Ls(null);let h=me(Wt(E(o))),p=me(Wt(E(s))),m=me(Wt({})),g=me(!1);const y=oe(()=>{const I=f.current?lP(f.current,E(u)):E(u),k=f.current?lP(f.current,E(d)):E(d);return E(i)?{position:E(h),left:"0",top:"0",transform:`translate(${I}px, ${k}px)`,...f.current&&mN(f.current)>=1.5&&{willChange:"transform"}}:{position:E(h),left:`${I}px`,top:`${k}px`}});let b;function S(){c.current===null||f.current===null||sZ(c.current,f.current,{middleware:E(r),placement:E(s),strategy:E(o)}).then(I=>{if(!E(n)&&E(u)!==0&&E(d)!==0){const k=Math.max(Math.abs(E(a)),Math.abs(E(l)),15);if(I.x<=k&&I.y<=k)return}K(u,I.x,!0),K(d,I.y,!0),K(h,I.strategy,!0),K(p,I.placement,!0),K(m,I.middlewareData,!0),K(g,!0)})}function C(){typeof b=="function"&&(b(),b=void 0)}function _(){if(C(),e===void 0){S();return}c.current===null||f.current===null||(b=e(c.current,f.current,S))}function x(){E(n)||K(g,!1)}return Ge(S),Ge(_),Ge(x),Ge(()=>C),{floating:f,reference:c,get strategy(){return E(h)},get placement(){return E(p)},get middlewareData(){return E(m)},get isPositioned(){return E(g)},get floatingStyles(){return E(y)},get update(){return S}}}const aZ={top:"bottom",right:"left",bottom:"top",left:"right"},nE=new Xc("Floating.Root"),cP=new Xc("Floating.Content"),rE=new Xc("Floating.Root");class ry{static create(e=!1){return e?rE.set(new ry):nE.set(new ry)}anchorNode=Ls(null);customAnchorNode=Ls(null);triggerNode=Ls(null);constructor(){Ge(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}class iy{static create(e,n=!1){return n?cP.set(new iy(e,rE.get())):cP.set(new iy(e,nE.get()))}opts;root;contentRef=Ls(null);wrapperRef=Ls(null);arrowRef=Ls(null);contentAttachment=$s(this.contentRef);wrapperAttachment=$s(this.wrapperRef);arrowAttachment=$s(this.arrowRef);arrowId=Ls(Zk());#e=oe(()=>{if(typeof this.opts.style=="string")return sp(this.opts.style);if(!this.opts.style)return{}});#t=void 0;#n=new Yq(()=>this.arrowRef.current??void 0);#r=oe(()=>this.#n?.width??0);#i=oe(()=>this.#n?.height??0);#a=oe(()=>this.opts.side?.current+(this.opts.align.current!=="center"?`-${this.opts.align.current}`:""));#s=oe(()=>Array.isArray(this.opts.collisionBoundary.current)?this.opts.collisionBoundary.current:[this.opts.collisionBoundary.current]);#o=oe(()=>E(this.#s).length>0);get hasExplicitBoundaries(){return E(this.#o)}set hasExplicitBoundaries(e){K(this.#o,e)}#l=oe(()=>({padding:this.opts.collisionPadding.current,boundary:E(this.#s).filter(pK),altBoundary:this.hasExplicitBoundaries}));get detectOverflowOptions(){return E(this.#l)}set detectOverflowOptions(e){K(this.#l,e)}#c=me(void 0);#u=me(void 0);#d=me(void 0);#h=me(void 0);#p=oe(()=>[YG({mainAxis:this.opts.sideOffset.current+E(this.#i),alignmentAxis:this.opts.alignOffset.current}),this.opts.avoidCollisions.current&&JG({mainAxis:!0,crossAxis:!1,limiter:this.opts.sticky.current==="partial"?iZ():void 0,...this.detectOverflowOptions}),this.opts.avoidCollisions.current&&eZ({...this.detectOverflowOptions}),tZ({...this.detectOverflowOptions,apply:({rects:e,availableWidth:n,availableHeight:r})=>{const{width:i,height:s}=e.reference;K(this.#c,n,!0),K(this.#u,r,!0),K(this.#d,i,!0),K(this.#h,s,!0)}}),this.arrowRef.current&&rZ({element:this.arrowRef.current,padding:this.opts.arrowPadding.current}),lZ({arrowWidth:E(this.#r),arrowHeight:E(this.#i)}),this.opts.hideWhenDetached.current&&nZ({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean));get middleware(){return E(this.#p)}set middleware(e){K(this.#p,e)}floating;#g=oe(()=>cZ(this.floating.placement));get placedSide(){return E(this.#g)}set placedSide(e){K(this.#g,e)}#f=oe(()=>uZ(this.floating.placement));get placedAlign(){return E(this.#f)}set placedAlign(e){K(this.#f,e)}#m=oe(()=>this.floating.middlewareData.arrow?.x??0);get arrowX(){return E(this.#m)}set arrowX(e){K(this.#m,e)}#y=oe(()=>this.floating.middlewareData.arrow?.y??0);get arrowY(){return E(this.#y)}set arrowY(e){K(this.#y,e)}#w=oe(()=>this.floating.middlewareData.arrow?.centerOffset!==0);get cannotCenterArrow(){return E(this.#w)}set cannotCenterArrow(e){K(this.#w,e)}#b=me();get contentZIndex(){return E(this.#b)}set contentZIndex(e){K(this.#b,e,!0)}#v=oe(()=>aZ[this.placedSide]);get arrowBaseSide(){return E(this.#v)}set arrowBaseSide(e){K(this.#v,e)}#x=oe(()=>({id:this.opts.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${this.floating.middlewareData.transformOrigin?.x} ${this.floating.middlewareData.transformOrigin?.y}`,"--bits-floating-available-width":`${E(this.#c)}px`,"--bits-floating-available-height":`${E(this.#u)}px`,"--bits-floating-anchor-width":`${E(this.#d)}px`,"--bits-floating-anchor-height":`${E(this.#h)}px`,...this.floating.middlewareData.hide?.referenceHidden&&{visibility:"hidden","pointer-events":"none"},...E(this.#e)},dir:this.opts.dir.current,...this.wrapperAttachment}));get wrapperProps(){return E(this.#x)}set wrapperProps(e){K(this.#x,e)}#S=oe(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:R8({...E(this.#e)}),...this.contentAttachment}));get props(){return E(this.#S)}set props(e){K(this.#S,e)}#k=oe(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0}));get arrowStyle(){return E(this.#k)}set arrowStyle(e){K(this.#k,e)}constructor(e,n){this.opts=e,this.root=n,e.customAnchor&&(this.root.customAnchorNode.current=e.customAnchor.current),Mr(()=>e.customAnchor.current,r=>{this.root.customAnchorNode.current=r}),this.floating=oZ({strategy:()=>this.opts.strategy.current,placement:()=>E(this.#a),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...r)=>QG(...r,{animationFrame:this.#t?.current==="always"}),open:()=>this.opts.enabled.current,sideOffset:()=>this.opts.sideOffset.current,alignOffset:()=>this.opts.alignOffset.current}),Ge(()=>{this.floating.isPositioned&&this.opts.onPlaced?.current()}),Mr(()=>this.contentRef.current,r=>{if(!r)return;const i=U8(r);this.contentZIndex=i.getComputedStyle(r).zIndex}),Ge(()=>{this.floating.floating.current=this.wrapperRef.current})}}class sy{static create(e,n=!1){return n?new sy(e,rE.get()):new sy(e,nE.get())}opts;root;constructor(e,n){this.opts=e,this.root=n,e.virtualEl&&e.virtualEl.current?n.triggerNode=xq(e.virtualEl.current):n.triggerNode=e.ref}}function lZ(t){return{name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:i}=e,o=i.arrow?.centerOffset!==0,a=o?0:t.arrowWidth,l=o?0:t.arrowHeight,[c,u]=iE(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(i.arrow?.x??0)+a/2,h=(i.arrow?.y??0)+l/2;let p="",m="";return c==="bottom"?(p=o?d:`${f}px`,m=`${-l}px`):c==="top"?(p=o?d:`${f}px`,m=`${r.floating.height+l}px`):c==="right"?(p=`${-l}px`,m=o?d:`${h}px`):c==="left"&&(p=`${r.floating.width+l}px`,m=o?d:`${h}px`),{data:{x:p,y:m}}}}}function iE(t){const[e,n="center"]=t.split("-");return[e,n]}function cZ(t){return iE(t)[0]}function uZ(t){return iE(t)[1]}function gN(t,e){St(e,!0);let n=le(e,"tooltip",3,!1);ry.create(n());var r=Ue(),i=Ee(r);_t(i,()=>e.children??Ft),Y(t,r),kt()}function yN(t,e){St(e,!0);let n=le(e,"tooltip",3,!1);sy.create({id:$e(()=>e.id),virtualEl:$e(()=>e.virtualEl),ref:e.ref},n());var r=Ue(),i=Ee(r);_t(i,()=>e.children??Ft),Y(t,r),kt()}function dZ(t,e){St(e,!0);let n=le(e,"side",3,"bottom"),r=le(e,"sideOffset",3,0),i=le(e,"align",3,"center"),s=le(e,"alignOffset",3,0),o=le(e,"arrowPadding",3,0),a=le(e,"avoidCollisions",3,!0),l=le(e,"collisionBoundary",19,()=>[]),c=le(e,"collisionPadding",3,0),u=le(e,"hideWhenDetached",3,!1),d=le(e,"onPlaced",3,()=>{}),f=le(e,"sticky",3,"partial"),h=le(e,"updatePositionStrategy",3,"optimized"),p=le(e,"strategy",3,"fixed"),m=le(e,"dir",3,"ltr"),g=le(e,"style",19,()=>({})),y=le(e,"wrapperId",19,Zk),b=le(e,"customAnchor",3,null),S=le(e,"tooltip",3,!1);const C=iy.create({side:$e(()=>n()),sideOffset:$e(()=>r()),align:$e(()=>i()),alignOffset:$e(()=>s()),id:$e(()=>e.id),arrowPadding:$e(()=>o()),avoidCollisions:$e(()=>a()),collisionBoundary:$e(()=>l()),collisionPadding:$e(()=>c()),hideWhenDetached:$e(()=>u()),onPlaced:$e(()=>d()),sticky:$e(()=>f()),updatePositionStrategy:$e(()=>h()),strategy:$e(()=>p()),dir:$e(()=>m()),style:$e(()=>g()),enabled:$e(()=>e.enabled),wrapperId:$e(()=>y()),customAnchor:$e(()=>b())},S()),_=oe(()=>yr(C.wrapperProps,{style:{pointerEvents:"auto"}}));var x=Ue(),I=Ee(x);_t(I,()=>e.content??Ft,()=>({props:C.props,wrapperProps:E(_)})),Y(t,x),kt()}function fZ(t,e){St(e,!0),bs(()=>{e.onPlaced?.()});var n=Ue(),r=Ee(n);_t(r,()=>e.content??Ft,()=>({props:{},wrapperProps:{}})),Y(t,n),kt()}function hZ(t,e){let n=le(e,"isStatic",3,!1),r=Ni(e,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var i=Ue(),s=Ee(i);{var o=l=>{fZ(l,{get content(){return e.content},get onPlaced(){return e.onPlaced}})},a=l=>{dZ(l,Qn({get content(){return e.content},get onPlaced(){return e.onPlaced}},()=>r))};Ve(s,l=>{n()?l(o):l(a,!1)})}Y(t,i)}var pZ=Ce("<!> <!>",1);function bN(t,e){St(e,!0);let n=le(e,"interactOutsideBehavior",3,"close"),r=le(e,"trapFocus",3,!0),i=le(e,"isValidEvent",3,()=>!1),s=le(e,"customAnchor",3,null),o=le(e,"isStatic",3,!1),a=le(e,"tooltip",3,!1),l=le(e,"contentPointerEvents",3,"auto"),c=Ni(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled","ref","tooltip","contentPointerEvents"]);hZ(t,{get isStatic(){return o()},get id(){return e.id},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get enabled(){return e.enabled},get tooltip(){return a()},content:(d,f)=>{let h=()=>f?.().props,p=()=>f?.().wrapperProps;var m=pZ(),g=Ee(m);{var y=C=>{Y0(C,{get preventScroll(){return e.preventScroll}})},b=C=>{var _=Ue(),x=Ee(_);{var I=k=>{Y0(k,{get preventScroll(){return e.preventScroll}})};Ve(x,k=>{e.forceMount||k(I)},!0)}Y(C,_)};Ve(g,C=>{e.forceMount&&e.enabled?C(y):C(b,!1)})}var S=we(g,2);nN(S,{get onOpenAutoFocus(){return e.onOpenAutoFocus},get onCloseAutoFocus(){return e.onCloseAutoFocus},get loop(){return e.loop},get enabled(){return e.enabled},get trapFocus(){return r()},get forceMount(){return e.forceMount},get ref(){return e.ref},focusScope:(_,x)=>{let I=()=>x?.().props;tN(_,{get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get enabled(){return e.enabled},get ref(){return e.ref},children:(k,T)=>{eN(k,{get id(){return e.id},get onInteractOutside(){return e.onInteractOutside},get onFocusOutside(){return e.onFocusOutside},get interactOutsideBehavior(){return n()},get isValidEvent(){return i()},get enabled(){return e.enabled},get ref(){return e.ref},children:(O,D)=>{let F=()=>D?.().props;rN(O,{get id(){return e.id},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get enabled(){return e.enabled},get ref(){return e.ref},children:(B,N)=>{var M=Ue(),R=Ee(M);{let H=oe(()=>({props:yr(c,h(),F(),I(),{style:{pointerEvents:l()}}),wrapperProps:p()}));_t(R,()=>e.popper??Ft,()=>E(H))}Y(B,M)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),Y(d,m)},$$slots:{content:!0}}),kt()}function wN(t,e){let n=le(e,"interactOutsideBehavior",3,"close"),r=le(e,"trapFocus",3,!0),i=le(e,"isValidEvent",3,()=>!1),s=le(e,"customAnchor",3,null),o=le(e,"isStatic",3,!1),a=Ni(e,["$$slots","$$events","$$legacy","popper","open","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","ref","shouldRender"]);var l=Ue(),c=Ee(l);{var u=d=>{bN(d,Qn({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get isStatic(){return o()},get enabled(){return e.open},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return n()},get loop(){return e.loop},get trapFocus(){return r()},get isValidEvent(){return i()},get onFocusOutside(){return e.onFocusOutside},forceMount:!1,get ref(){return e.ref}},()=>a))};Ve(c,d=>{e.shouldRender&&d(u)})}Y(t,l)}function vN(t,e){let n=le(e,"interactOutsideBehavior",3,"close"),r=le(e,"trapFocus",3,!0),i=le(e,"isValidEvent",3,()=>!1),s=le(e,"customAnchor",3,null),o=le(e,"isStatic",3,!1),a=Ni(e,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);bN(t,Qn({get popper(){return e.popper},get onEscapeKeydown(){return e.onEscapeKeydown},get escapeKeydownBehavior(){return e.escapeKeydownBehavior},get preventOverflowTextSelection(){return e.preventOverflowTextSelection},get id(){return e.id},get onPointerDown(){return e.onPointerDown},get onPointerUp(){return e.onPointerUp},get side(){return e.side},get sideOffset(){return e.sideOffset},get align(){return e.align},get alignOffset(){return e.alignOffset},get arrowPadding(){return e.arrowPadding},get avoidCollisions(){return e.avoidCollisions},get collisionBoundary(){return e.collisionBoundary},get collisionPadding(){return e.collisionPadding},get sticky(){return e.sticky},get hideWhenDetached(){return e.hideWhenDetached},get updatePositionStrategy(){return e.updatePositionStrategy},get strategy(){return e.strategy},get dir(){return e.dir},get preventScroll(){return e.preventScroll},get wrapperId(){return e.wrapperId},get style(){return e.style},get onPlaced(){return e.onPlaced},get customAnchor(){return s()},get isStatic(){return o()},get enabled(){return e.enabled},get onInteractOutside(){return e.onInteractOutside},get onCloseAutoFocus(){return e.onCloseAutoFocus},get onOpenAutoFocus(){return e.onOpenAutoFocus},get interactOutsideBehavior(){return n()},get loop(){return e.loop},get trapFocus(){return r()},get isValidEvent(){return i()},get onFocusOutside(){return e.onFocusOutside}},()=>a,{forceMount:!0}))}function uP(t,e){const[n,r]=t;let i=!1;const s=e.length;for(let o=0,a=s-1;o<s;a=o++){const[l,c]=e[o]??[0,0],[u,d]=e[a]??[0,0];c>=r!=d>=r&&n<=(u-l)*(r-c)/(d-c)+l&&(i=!i)}return i}function dP(t,e){return t[0]>=e.left&&t[0]<=e.right&&t[1]>=e.top&&t[1]<=e.bottom}function mZ(t,e){const n=t.left+t.width/2,r=t.top+t.height/2,i=e.left+e.width/2,s=e.top+e.height/2,o=i-n,a=s-r;return Math.abs(o)>Math.abs(a)?o>0?"right":"left":a>0?"bottom":"top"}class xN{#e;#t;#n=null;#r=null;constructor(e){this.#e=e,this.#t=e.buffer??1,Mr([e.triggerNode,e.contentNode,e.enabled],([n,r,i])=>{if(!n||!r||!i){this.#n=null,this.#r=null;return}const s=z8(n),o=d=>{this.#i(d,n,r)},a=d=>{const f=d.relatedTarget;hf(f)&&r.contains(f)||(this.#n=[d.clientX,d.clientY],this.#r="content")},l=()=>{this.#n=null,this.#r=null},c=()=>{this.#n=null,this.#r=null},u=d=>{const f=d.relatedTarget;hf(f)&&n.contains(f)||(this.#n=[d.clientX,d.clientY],this.#r="trigger")};return[Sr(s,"pointermove",o),Sr(n,"pointerleave",a),Sr(n,"pointerenter",l),Sr(r,"pointerenter",c),Sr(r,"pointerleave",u)].reduce((d,f)=>()=>{d(),f()},()=>{})})}#i(e,n,r){if(!this.#n||!this.#r)return;const i=[e.clientX,e.clientY],s=n.getBoundingClientRect(),o=r.getBoundingClientRect();if(this.#r==="content"&&dP(i,o)){this.#n=null,this.#r=null;return}if(this.#r==="trigger"&&dP(i,s)){this.#n=null,this.#r=null;return}const a=mZ(s,o),l=this.#a(s,o,a);if(l&&uP(i,l))return;const c=this.#r==="content"?o:s,u=this.#s(this.#n,c,a,this.#r);uP(i,u)||(this.#n=null,this.#r=null,this.#e.onPointerExit())}#a(e,n,r){const i=this.#t;switch(r){case"top":return[[Math.min(e.left,n.left)-i,e.top],[Math.min(e.left,n.left)-i,n.bottom],[Math.max(e.right,n.right)+i,n.bottom],[Math.max(e.right,n.right)+i,e.top]];case"bottom":return[[Math.min(e.left,n.left)-i,e.bottom],[Math.min(e.left,n.left)-i,n.top],[Math.max(e.right,n.right)+i,n.top],[Math.max(e.right,n.right)+i,e.bottom]];case"left":return[[e.left,Math.min(e.top,n.top)-i],[n.right,Math.min(e.top,n.top)-i],[n.right,Math.max(e.bottom,n.bottom)+i],[e.left,Math.max(e.bottom,n.bottom)+i]];case"right":return[[e.right,Math.min(e.top,n.top)-i],[n.left,Math.min(e.top,n.top)-i],[n.left,Math.max(e.bottom,n.bottom)+i],[e.right,Math.max(e.bottom,n.bottom)+i]]}}#s(e,n,r,i){const s=this.#t*4,[o,a]=e;switch(i==="trigger"?this.#o(r):r){case"top":return[[o-s,a+s],[o+s,a+s],[n.right+s,n.bottom],[n.right+s,n.top],[n.left-s,n.top],[n.left-s,n.bottom]];case"bottom":return[[o-s,a-s],[o+s,a-s],[n.right+s,n.top],[n.right+s,n.bottom],[n.left-s,n.bottom],[n.left-s,n.top]];case"left":return[[o+s,a-s],[o+s,a+s],[n.right,n.bottom+s],[n.left,n.bottom+s],[n.left,n.top-s],[n.right,n.top-s]];case"right":return[[o-s,a-s],[o-s,a+s],[n.left,n.bottom+s],[n.right,n.bottom+s],[n.right,n.top-s],[n.left,n.top-s]]}}#o(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"left":return"right";case"right":return"left"}}}const Tx=Kb({component:"popover",parts:["root","trigger","content","close","overlay"]}),sE=new Xc("Popover.Root");class oE{static create(e){return sE.set(new oE(e))}opts;#e=me(null);get contentNode(){return E(this.#e)}set contentNode(e){K(this.#e,e,!0)}contentPresence;#t=me(null);get triggerNode(){return E(this.#t)}set triggerNode(e){K(this.#t,e,!0)}#n=me(null);get overlayNode(){return E(this.#n)}set overlayNode(e){K(this.#n,e,!0)}overlayPresence;#r=me(!1);get openedViaHover(){return E(this.#r)}set openedViaHover(e){K(this.#r,e,!0)}#i=me(!1);get hasInteractedWithContent(){return E(this.#i)}set hasInteractedWithContent(e){K(this.#i,e,!0)}#a=me(!1);get hoverCooldown(){return E(this.#a)}set hoverCooldown(e){K(this.#a,e,!0)}#s=me(0);get closeDelay(){return E(this.#s)}set closeDelay(e){K(this.#s,e,!0)}#o=null;#l=null;constructor(e){this.opts=e,this.contentPresence=new Xp({ref:$e(()=>this.contentNode),open:this.opts.open,onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),this.overlayPresence=new Xp({ref:$e(()=>this.overlayNode),open:this.opts.open}),Mr(()=>this.opts.open.current,n=>{n||(this.openedViaHover=!1,this.hasInteractedWithContent=!1,this.#c())})}setDomContext(e){this.#l=e}#c(){this.#o!==null&&this.#l&&(this.#l.clearTimeout(this.#o),this.#o=null)}toggleOpen(){this.#c(),this.opts.open.current=!this.opts.open.current}handleClose(){this.#c(),this.opts.open.current&&(this.opts.open.current=!1)}handleHoverOpen(){this.#c(),!this.opts.open.current&&(this.openedViaHover=!0,this.opts.open.current=!0)}handleHoverClose(){this.opts.open.current&&this.openedViaHover&&!this.hasInteractedWithContent&&(this.opts.open.current=!1)}handleDelayedHoverClose(){this.opts.open.current&&(!this.openedViaHover||this.hasInteractedWithContent||(this.#c(),this.closeDelay<=0?this.opts.open.current=!1:this.#l&&(this.#o=this.#l.setTimeout(()=>{this.openedViaHover&&!this.hasInteractedWithContent&&(this.opts.open.current=!1),this.#o=null},this.closeDelay))))}cancelDelayedClose(){this.#c()}markInteraction(){this.hasInteractedWithContent=!0,this.#c()}}class aE{static create(e){return new aE(e,sE.get())}opts;root;attachment;domContext;#e=null;#t=null;#n=me(!1);constructor(e,n){this.opts=e,this.root=n,this.attachment=$s(this.opts.ref,r=>this.root.triggerNode=r),this.domContext=new qb(e.ref),this.root.setDomContext(this.domContext),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this),this.onpointerenter=this.onpointerenter.bind(this),this.onpointerleave=this.onpointerleave.bind(this),Mr(()=>this.opts.closeDelay.current,r=>{this.root.closeDelay=r})}#r(){this.#e!==null&&(this.domContext.clearTimeout(this.#e),this.#e=null)}#i(){this.#t!==null&&(this.domContext.clearTimeout(this.#t),this.#t=null)}#a(){this.#r(),this.#i()}onpointerenter(e){if(this.opts.disabled.current||!this.opts.openOnHover.current||q0(e)||(K(this.#n,!0),this.#i(),this.root.cancelDelayedClose(),this.root.opts.open.current||this.root.hoverCooldown))return;const n=this.opts.openDelay.current;n<=0?this.root.handleHoverOpen():this.#e=this.domContext.setTimeout(()=>{this.root.handleHoverOpen(),this.#e=null},n)}onpointerleave(e){this.opts.disabled.current||this.opts.openOnHover.current&&(q0(e)||(K(this.#n,!1),this.#r(),this.root.hoverCooldown=!1))}onclick(e){if(!this.opts.disabled.current&&e.button===0){if(this.#a(),E(this.#n)&&this.root.opts.open.current&&this.root.openedViaHover){this.root.openedViaHover=!1,this.root.hasInteractedWithContent=!0;return}E(this.#n)&&this.opts.openOnHover.current&&this.root.opts.open.current&&(this.root.hoverCooldown=!0),this.root.hoverCooldown&&!this.root.opts.open.current&&(this.root.hoverCooldown=!1),this.root.toggleOpen()}}onkeydown(e){this.opts.disabled.current||(e.key===H8||e.key===V8)&&(e.preventDefault(),this.#a(),this.root.toggleOpen())}#s(){if(this.root.opts.open.current&&this.root.contentNode?.id)return this.root.contentNode?.id}#o=oe(()=>({id:this.opts.id.current,"aria-haspopup":"dialog","aria-expanded":lK(this.root.opts.open.current),"data-state":Bk(this.root.opts.open.current),"aria-controls":this.#s(),[Tx.trigger]:"",disabled:this.opts.disabled.current,onkeydown:this.onkeydown,onclick:this.onclick,onpointerenter:this.onpointerenter,onpointerleave:this.onpointerleave,...this.attachment}));get props(){return E(this.#o)}set props(e){K(this.#o,e)}}class lE{static create(e){return new lE(e,sE.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=$s(this.opts.ref,r=>this.root.contentNode=r),this.onpointerdown=this.onpointerdown.bind(this),this.onfocusin=this.onfocusin.bind(this),this.onpointerenter=this.onpointerenter.bind(this),this.onpointerleave=this.onpointerleave.bind(this),new xN({triggerNode:()=>this.root.triggerNode,contentNode:()=>this.root.contentNode,enabled:()=>this.root.opts.open.current&&this.root.openedViaHover&&!this.root.hasInteractedWithContent,onPointerExit:()=>{this.root.handleDelayedHoverClose()}})}onpointerdown(e){this.root.markInteraction()}onfocusin(e){const n=e.target;hf(n)&&HK(n)&&this.root.markInteraction()}onpointerenter(e){q0(e)||this.root.cancelDelayedClose()}onpointerleave(e){q0(e)}onInteractOutside=e=>{if(this.opts.onInteractOutside.current(e),e.defaultPrevented||!hf(e.target))return;const n=e.target.closest(Tx.selector("trigger"));if(!(n&&n===this.root.triggerNode)){if(this.opts.customAnchor.current){if(hf(this.opts.customAnchor.current)){if(this.opts.customAnchor.current.contains(e.target))return}else if(typeof this.opts.customAnchor.current=="string"){const r=document.querySelector(this.opts.customAnchor.current);if(r&&r.contains(e.target))return}}this.root.handleClose()}};onEscapeKeydown=e=>{this.opts.onEscapeKeydown.current(e),!e.defaultPrevented&&this.root.handleClose()};get shouldRender(){return this.root.contentPresence.shouldRender}get shouldTrapFocus(){return!(this.root.openedViaHover&&!this.root.hasInteractedWithContent)}#e=oe(()=>({open:this.root.opts.open.current}));get snippetProps(){return E(this.#e)}set snippetProps(e){K(this.#e,e)}#t=oe(()=>({id:this.opts.id.current,tabindex:-1,"data-state":Bk(this.root.opts.open.current),[Tx.content]:"",style:{pointerEvents:"auto"},onpointerdown:this.onpointerdown,onfocusin:this.onfocusin,onpointerenter:this.onpointerenter,onpointerleave:this.onpointerleave,...this.attachment}));get props(){return E(this.#t)}set props(e){K(this.#t,e)}popperProps={onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown}}var gZ=Ce("<div><div><!></div></div>"),yZ=Ce("<div><div><!></div></div>");function bZ(t,e){const n=sa();St(e,!0);let r=le(e,"ref",15,null),i=le(e,"id",19,()=>xl(n)),s=le(e,"forceMount",3,!1),o=le(e,"onOpenAutoFocus",3,vn),a=le(e,"onCloseAutoFocus",3,vn),l=le(e,"onEscapeKeydown",3,vn),c=le(e,"onInteractOutside",3,vn),u=le(e,"trapFocus",3,!0),d=le(e,"preventScroll",3,!1),f=le(e,"customAnchor",3,null),h=Ni(e,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onOpenAutoFocus","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","customAnchor"]);const p=lE.create({id:$e(()=>i()),ref:$e(()=>r(),x=>r(x)),onInteractOutside:$e(()=>c()),onEscapeKeydown:$e(()=>l()),customAnchor:$e(()=>f())}),m=oe(()=>yr(h,p.props)),g=oe(()=>u()&&p.shouldTrapFocus);function y(x){p.shouldTrapFocus||x.preventDefault(),o()(x)}var b=Ue(),S=Ee(b);{var C=x=>{vN(x,Qn(()=>E(m),()=>p.popperProps,{get ref(){return p.opts.ref},get enabled(){return p.root.opts.open.current},get id(){return i()},get trapFocus(){return E(g)},get preventScroll(){return d()},loop:!0,forceMount:!0,get customAnchor(){return f()},onOpenAutoFocus:y,get onCloseAutoFocus(){return a()},get shouldRender(){return p.shouldRender},popper:(k,T)=>{let P=()=>T?.().props,O=()=>T?.().wrapperProps;const D=oe(()=>yr(P(),{style:ny("popover")}));var F=Ue(),B=Ee(F);{var N=R=>{var H=Ue(),z=Ee(H);{let V=oe(()=>({props:E(D),wrapperProps:O(),...p.snippetProps}));_t(z,()=>e.child,()=>E(V))}Y(R,H)},M=R=>{var H=gZ();kr(H,()=>({...O()}));var z=ie(H);kr(z,()=>({...E(D)}));var V=ie(z);_t(V,()=>e.children??Ft),Y(R,H)};Ve(B,R=>{e.child?R(N):R(M,!1)})}Y(k,F)},$$slots:{popper:!0}}))},_=x=>{var I=Ue(),k=Ee(I);{var T=P=>{wN(P,Qn(()=>E(m),()=>p.popperProps,{get ref(){return p.opts.ref},get open(){return p.root.opts.open.current},get id(){return i()},get trapFocus(){return E(g)},get preventScroll(){return d()},loop:!0,forceMount:!1,get customAnchor(){return f()},onOpenAutoFocus:y,get onCloseAutoFocus(){return a()},get shouldRender(){return p.shouldRender},popper:(D,F)=>{let B=()=>F?.().props,N=()=>F?.().wrapperProps;const M=oe(()=>yr(B(),{style:ny("popover")}));var R=Ue(),H=Ee(R);{var z=X=>{var Z=Ue(),te=Ee(Z);{let ne=oe(()=>({props:E(M),wrapperProps:N(),...p.snippetProps}));_t(te,()=>e.child,()=>E(ne))}Y(X,Z)},V=X=>{var Z=yZ();kr(Z,()=>({...N()}));var te=ie(Z);kr(te,()=>({...E(M)}));var ne=ie(te);_t(ne,()=>e.children??Ft),Y(X,Z)};Ve(H,X=>{e.child?X(z):X(V,!1)})}Y(D,R)},$$slots:{popper:!0}}))};Ve(k,P=>{s()||P(T)},!0)}Y(x,I)};Ve(S,x=>{s()?x(C):x(_,!1)})}Y(t,b),kt()}var wZ=Ce("<button><!></button>");function vZ(t,e){const n=sa();St(e,!0);let r=le(e,"id",19,()=>xl(n)),i=le(e,"ref",15,null),s=le(e,"type",3,"button"),o=le(e,"disabled",3,!1),a=le(e,"openOnHover",3,!1),l=le(e,"openDelay",3,700),c=le(e,"closeDelay",3,300),u=Ni(e,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled","openOnHover","openDelay","closeDelay"]);const d=aE.create({id:$e(()=>r()),ref:$e(()=>i(),h=>i(h)),disabled:$e(()=>!!o()),openOnHover:$e(()=>a()),openDelay:$e(()=>l()),closeDelay:$e(()=>c())}),f=oe(()=>yr(u,d.props,{type:s()}));yN(t,{get id(){return r()},get ref(){return d.opts.ref},children:(h,p)=>{var m=Ue(),g=Ee(m);{var y=S=>{var C=Ue(),_=Ee(C);_t(_,()=>e.child,()=>({props:E(f)})),Y(S,C)},b=S=>{var C=wZ();kr(C,()=>({...E(f)}));var _=ie(C);_t(_,()=>e.children??Ft),Y(S,C)};Ve(g,S=>{e.child?S(y):S(b,!1)})}Y(h,m)},$$slots:{default:!0}}),kt()}function xZ(t,e){St(e,!0);let n=le(e,"open",15,!1),r=le(e,"onOpenChange",3,vn),i=le(e,"onOpenChangeComplete",3,vn);Fk.create({variant:$e(()=>"dialog"),open:$e(()=>n(),a=>{n(a),r()(a)}),onOpenChangeComplete:$e(()=>i())});var s=Ue(),o=Ee(s);_t(o,()=>e.children??Ft),Y(t,s),kt()}var SZ=Ce("<button><!></button>");function dh(t,e){const n=sa();St(e,!0);let r=le(e,"id",19,()=>xl(n)),i=le(e,"ref",15,null),s=le(e,"disabled",3,!1),o=Ni(e,["$$slots","$$events","$$legacy","children","child","id","ref","disabled"]);const a=$k.create({variant:$e(()=>"close"),id:$e(()=>r()),ref:$e(()=>i(),h=>i(h)),disabled:$e(()=>!!s())}),l=oe(()=>yr(o,a.props));var c=Ue(),u=Ee(c);{var d=h=>{var p=Ue(),m=Ee(p);_t(m,()=>e.child,()=>({props:E(l)})),Y(h,p)},f=h=>{var p=SZ();kr(p,()=>({...E(l)}));var m=ie(p);_t(m,()=>e.children??Ft),Y(h,p)};Ve(u,h=>{e.child?h(d):h(f,!1)})}Y(t,c),kt()}var kZ=Ce("<!> <!>",1),EZ=Ce("<!> <div><!></div>",1);function TZ(t,e){const n=sa();St(e,!0);let r=le(e,"id",19,()=>xl(n)),i=le(e,"ref",15,null),s=le(e,"forceMount",3,!1),o=le(e,"onCloseAutoFocus",3,vn),a=le(e,"onOpenAutoFocus",3,vn),l=le(e,"onEscapeKeydown",3,vn),c=le(e,"onInteractOutside",3,vn),u=le(e,"trapFocus",3,!0),d=le(e,"preventScroll",3,!0),f=le(e,"restoreScrollDelay",3,null),h=Ni(e,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onOpenAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const p=Hk.create({id:$e(()=>r()),ref:$e(()=>i(),S=>i(S))}),m=oe(()=>yr(h,p.props));var g=Ue(),y=Ee(g);{var b=S=>{nN(S,{get ref(){return p.opts.ref},loop:!0,get trapFocus(){return u()},get enabled(){return p.root.opts.open.current},get onOpenAutoFocus(){return a()},get onCloseAutoFocus(){return o()},focusScope:(_,x)=>{let I=()=>x?.().props;tN(_,Qn(()=>E(m),{get enabled(){return p.root.opts.open.current},get ref(){return p.opts.ref},onEscapeKeydown:k=>{l()(k),!k.defaultPrevented&&p.root.handleClose()},children:(k,T)=>{eN(k,Qn(()=>E(m),{get ref(){return p.opts.ref},get enabled(){return p.root.opts.open.current},onInteractOutside:P=>{c()(P),!P.defaultPrevented&&p.root.handleClose()},children:(P,O)=>{rN(P,Qn(()=>E(m),{get ref(){return p.opts.ref},get enabled(){return p.root.opts.open.current},children:(D,F)=>{var B=Ue(),N=Ee(B);{var M=H=>{var z=kZ(),V=Ee(z);{var X=te=>{Y0(te,{get preventScroll(){return d()},get restoreScrollDelay(){return f()}})};Ve(V,te=>{p.root.opts.open.current&&te(X)})}var Z=we(V,2);{let te=oe(()=>({props:yr(E(m),I()),...p.snippetProps}));_t(Z,()=>e.child,()=>E(te))}Y(H,z)},R=H=>{var z=EZ(),V=Ee(z);Y0(V,{get preventScroll(){return d()}});var X=we(V,2);kr(X,te=>({...te}),[()=>yr(E(m),I())]);var Z=ie(X);_t(Z,()=>e.children??Ft),Y(H,z)};Ve(N,H=>{e.child?H(M):H(R,!1)})}Y(D,B)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}})};Ve(y,S=>{(p.shouldRender||s())&&S(b)})}Y(t,g),kt()}function CZ(t,e){St(e,!0);let n=le(e,"open",15,!1),r=le(e,"onOpenChange",3,vn),i=le(e,"onOpenChangeComplete",3,vn);oE.create({open:$e(()=>n(),s=>{n(s),r()(s)}),onOpenChangeComplete:$e(()=>i())}),gN(t,{children:(s,o)=>{var a=Ue(),l=Ee(a);_t(l,()=>e.children??Ft),Y(s,a)},$$slots:{default:!0}}),kt()}class Cx{#e;#t;#n=null;constructor(e,n){this.#t=e,this.#e=n,this.stop=this.stop.bind(this),this.start=this.start.bind(this),gd(this.stop)}#r(){this.#n!==null&&(window.clearTimeout(this.#n),this.#n=null)}stop(){this.#r()}start(...e){this.#r(),this.#n=window.setTimeout(()=>{this.#n=null,this.#t(...e)},this.#e)}}const SN=Kb({component:"tooltip",parts:["content","trigger"]}),kN=new Xc("Tooltip.Provider"),cE=new Xc("Tooltip.Root");class uE{static create(e){return kN.set(new uE(e))}opts;#e=me(!0);get isOpenDelayed(){return E(this.#e)}set isOpenDelayed(e){K(this.#e,e,!0)}isPointerInTransit=Ls(!1);#t;#n=me(null);constructor(e){this.opts=e,this.#t=new Cx(()=>{this.isOpenDelayed=!0},this.opts.skipDelayDuration.current)}#r=()=>{this.opts.skipDelayDuration.current!==0&&this.#t.start()};#i=()=>{this.#t.stop()};onOpen=e=>{E(this.#n)&&E(this.#n)!==e&&E(this.#n).handleClose(),this.#i(),this.isOpenDelayed=!1,K(this.#n,e,!0)};onClose=e=>{E(this.#n)===e&&K(this.#n,null),this.#r()};isTooltipOpen=e=>E(this.#n)===e}class dE{static create(e){return cE.set(new dE(e,kN.get()))}opts;provider;#e=oe(()=>this.opts.delayDuration.current??this.provider.opts.delayDuration.current);get delayDuration(){return E(this.#e)}set delayDuration(e){K(this.#e,e)}#t=oe(()=>this.opts.disableHoverableContent.current??this.provider.opts.disableHoverableContent.current);get disableHoverableContent(){return E(this.#t)}set disableHoverableContent(e){K(this.#t,e)}#n=oe(()=>this.opts.disableCloseOnTriggerClick.current??this.provider.opts.disableCloseOnTriggerClick.current);get disableCloseOnTriggerClick(){return E(this.#n)}set disableCloseOnTriggerClick(e){K(this.#n,e)}#r=oe(()=>this.opts.disabled.current??this.provider.opts.disabled.current);get disabled(){return E(this.#r)}set disabled(e){K(this.#r,e)}#i=oe(()=>this.opts.ignoreNonKeyboardFocus.current??this.provider.opts.ignoreNonKeyboardFocus.current);get ignoreNonKeyboardFocus(){return E(this.#i)}set ignoreNonKeyboardFocus(e){K(this.#i,e)}#a=me(null);get contentNode(){return E(this.#a)}set contentNode(e){K(this.#a,e,!0)}contentPresence;#s=me(null);get triggerNode(){return E(this.#s)}set triggerNode(e){K(this.#s,e,!0)}#o=me(!1);#l;#c=oe(()=>this.opts.open.current?E(this.#o)?"delayed-open":"instant-open":"closed");get stateAttr(){return E(this.#c)}set stateAttr(e){K(this.#c,e)}constructor(e,n){this.opts=e,this.provider=n,this.#l=new Cx(()=>{K(this.#o,!0),this.opts.open.current=!0},this.delayDuration??0),this.contentPresence=new Xp({open:this.opts.open,ref:$e(()=>this.contentNode),onComplete:()=>{this.opts.onOpenChangeComplete.current(this.opts.open.current)}}),Mr(()=>this.delayDuration,()=>{this.delayDuration!==void 0&&(this.#l=new Cx(()=>{K(this.#o,!0),this.opts.open.current=!0},this.delayDuration))}),Mr(()=>this.opts.open.current,r=>{r?this.provider.onOpen(this):this.provider.onClose(this)},{lazy:!0})}handleOpen=()=>{this.#l.stop(),K(this.#o,!1),this.opts.open.current=!0};handleClose=()=>{this.#l.stop(),this.opts.open.current=!1};#u=()=>{this.#l.stop();const e=!this.provider.isOpenDelayed,n=this.delayDuration??0;e||n===0?(K(this.#o,n>0&&e,!0),this.opts.open.current=!0):this.#l.start()};onTriggerEnter=()=>{this.#u()};onTriggerLeave=()=>{this.disableHoverableContent?this.handleClose():this.#l.stop()}}class fE{static create(e){return new fE(e,cE.get())}opts;root;attachment;#e=Ls(!1);#t=me(!1);#n=oe(()=>this.opts.disabled.current||this.root.disabled);domContext;#r=null;constructor(e,n){this.opts=e,this.root=n,this.domContext=new qb(e.ref),this.attachment=$s(this.opts.ref,r=>this.root.triggerNode=r)}#i=()=>{this.#r!==null&&(clearTimeout(this.#r),this.#r=null)};handlePointerUp=()=>{this.#e.current=!1};#a=()=>{E(this.#n)||(this.#e.current=!1)};#s=()=>{E(this.#n)||(this.#e.current=!0,this.domContext.getDocument().addEventListener("pointerup",()=>{this.handlePointerUp()},{once:!0}))};#o=e=>{if(!E(this.#n)&&e.pointerType!=="touch"){if(this.root.provider.isPointerInTransit.current){this.#i(),this.#r=window.setTimeout(()=>{this.root.provider.isPointerInTransit.current&&(this.root.provider.isPointerInTransit.current=!1,this.root.onTriggerEnter(),K(this.#t,!0))},250);return}this.root.onTriggerEnter(),K(this.#t,!0)}};#l=e=>{E(this.#n)||e.pointerType!=="touch"&&(E(this.#t)||(this.#i(),this.root.provider.isPointerInTransit.current=!1,this.root.onTriggerEnter(),K(this.#t,!0)))};#c=()=>{E(this.#n)||(this.#i(),this.root.onTriggerLeave(),K(this.#t,!1))};#u=e=>{this.#e.current||E(this.#n)||this.root.ignoreNonKeyboardFocus&&!hK(e.currentTarget)||this.root.handleOpen()};#d=()=>{E(this.#n)||this.root.handleClose()};#h=()=>{this.root.disableCloseOnTriggerClick||E(this.#n)||this.root.handleClose()};#p=oe(()=>({id:this.opts.id.current,"aria-describedby":this.root.opts.open.current?this.root.contentNode?.id:void 0,"data-state":this.root.stateAttr,"data-disabled":zf(E(this.#n)),"data-delay-duration":`${this.root.delayDuration}`,[SN.trigger]:"",tabindex:E(this.#n)?void 0:0,disabled:this.opts.disabled.current,onpointerup:this.#a,onpointerdown:this.#s,onpointerenter:this.#o,onpointermove:this.#l,onpointerleave:this.#c,onfocus:this.#u,onblur:this.#d,onclick:this.#h,...this.attachment}));get props(){return E(this.#p)}set props(e){K(this.#p,e)}}class hE{static create(e){return new hE(e,cE.get())}opts;root;attachment;constructor(e,n){this.opts=e,this.root=n,this.attachment=$s(this.opts.ref,r=>this.root.contentNode=r),new xN({triggerNode:()=>this.root.triggerNode,contentNode:()=>this.root.contentNode,enabled:()=>this.root.opts.open.current&&!this.root.disableHoverableContent,onPointerExit:()=>{this.root.provider.isTooltipOpen(this.root)&&this.root.handleClose()}}),Jq(()=>Sr(window,"scroll",r=>{const i=r.target;i&&i.contains(this.root.triggerNode)&&this.root.handleClose()}))}onInteractOutside=e=>{if(hf(e.target)&&this.root.triggerNode?.contains(e.target)&&this.root.disableCloseOnTriggerClick){e.preventDefault();return}this.opts.onInteractOutside.current(e),!e.defaultPrevented&&this.root.handleClose()};onEscapeKeydown=e=>{this.opts.onEscapeKeydown.current?.(e),!e.defaultPrevented&&this.root.handleClose()};onOpenAutoFocus=e=>{e.preventDefault()};onCloseAutoFocus=e=>{e.preventDefault()};get shouldRender(){return this.root.contentPresence.shouldRender}#e=oe(()=>({open:this.root.opts.open.current}));get snippetProps(){return E(this.#e)}set snippetProps(e){K(this.#e,e)}#t=oe(()=>({id:this.opts.id.current,"data-state":this.root.stateAttr,"data-disabled":zf(this.root.disabled),style:{outline:"none"},[SN.content]:"",...this.attachment}));get props(){return E(this.#t)}set props(e){K(this.#t,e)}popperProps={onInteractOutside:this.onInteractOutside,onEscapeKeydown:this.onEscapeKeydown,onOpenAutoFocus:this.onOpenAutoFocus,onCloseAutoFocus:this.onCloseAutoFocus}}function mf(t,e){St(e,!0);let n=le(e,"open",15,!1),r=le(e,"onOpenChange",3,vn),i=le(e,"onOpenChangeComplete",3,vn);dE.create({open:$e(()=>n(),s=>{n(s),r()(s)}),delayDuration:$e(()=>e.delayDuration),disableCloseOnTriggerClick:$e(()=>e.disableCloseOnTriggerClick),disableHoverableContent:$e(()=>e.disableHoverableContent),ignoreNonKeyboardFocus:$e(()=>e.ignoreNonKeyboardFocus),disabled:$e(()=>e.disabled),onOpenChangeComplete:$e(()=>i())}),gN(t,{tooltip:!0,children:(s,o)=>{var a=Ue(),l=Ee(a);_t(l,()=>e.children??Ft),Y(s,a)},$$slots:{default:!0}}),kt()}var _Z=Ce("<div><div><!></div></div>"),AZ=Ce("<div><div><!></div></div>");function gf(t,e){const n=sa();St(e,!0);let r=le(e,"id",19,()=>xl(n)),i=le(e,"ref",15,null),s=le(e,"side",3,"top"),o=le(e,"sideOffset",3,0),a=le(e,"align",3,"center"),l=le(e,"avoidCollisions",3,!0),c=le(e,"arrowPadding",3,0),u=le(e,"sticky",3,"partial"),d=le(e,"hideWhenDetached",3,!1),f=le(e,"collisionPadding",3,0),h=le(e,"onInteractOutside",3,vn),p=le(e,"onEscapeKeydown",3,vn),m=le(e,"forceMount",3,!1),g=Ni(e,["$$slots","$$events","$$legacy","children","child","id","ref","side","sideOffset","align","avoidCollisions","arrowPadding","sticky","strategy","hideWhenDetached","collisionPadding","onInteractOutside","onEscapeKeydown","forceMount"]);const y=hE.create({id:$e(()=>r()),ref:$e(()=>i(),k=>i(k)),onInteractOutside:$e(()=>h()),onEscapeKeydown:$e(()=>p())}),b=oe(()=>({side:s(),sideOffset:o(),align:a(),avoidCollisions:l(),arrowPadding:c(),sticky:u(),hideWhenDetached:d(),collisionPadding:f(),strategy:e.strategy})),S=oe(()=>yr(g,E(b),y.props));var C=Ue(),_=Ee(C);{var x=k=>{{const T=(O,D)=>{let F=()=>D?.().props,B=()=>D?.().wrapperProps;const N=oe(()=>yr(F(),{style:ny("tooltip")}));var M=Ue(),R=Ee(M);{var H=V=>{var X=Ue(),Z=Ee(X);{let te=oe(()=>({props:E(N),wrapperProps:B(),...y.snippetProps}));_t(Z,()=>e.child,()=>E(te))}Y(V,X)},z=V=>{var X=_Z();kr(X,()=>({...B()}));var Z=ie(X);kr(Z,()=>({...E(N)}));var te=ie(Z);_t(te,()=>e.children??Ft),Y(V,X)};Ve(R,V=>{e.child?V(H):V(z,!1)})}Y(O,M)};let P=oe(()=>y.root.disableHoverableContent?"none":"auto");vN(k,Qn(()=>E(S),()=>y.popperProps,{get enabled(){return y.root.opts.open.current},get id(){return r()},trapFocus:!1,loop:!1,preventScroll:!1,forceMount:!0,get ref(){return y.opts.ref},tooltip:!0,get shouldRender(){return y.shouldRender},get contentPointerEvents(){return E(P)},popper:T,$$slots:{popper:!0}}))}},I=k=>{var T=Ue(),P=Ee(T);{var O=D=>{{const F=(N,M)=>{let R=()=>M?.().props,H=()=>M?.().wrapperProps;const z=oe(()=>yr(R(),{style:ny("tooltip")}));var V=Ue(),X=Ee(V);{var Z=ne=>{var J=Ue(),xe=Ee(J);{let Le=oe(()=>({props:E(z),wrapperProps:H(),...y.snippetProps}));_t(xe,()=>e.child,()=>E(Le))}Y(ne,J)},te=ne=>{var J=AZ();kr(J,()=>({...H()}));var xe=ie(J);kr(xe,()=>({...E(z)}));var Le=ie(xe);_t(Le,()=>e.children??Ft),Y(ne,J)};Ve(X,ne=>{e.child?ne(Z):ne(te,!1)})}Y(N,V)};let B=oe(()=>y.root.disableHoverableContent?"none":"auto");wN(D,Qn(()=>E(S),()=>y.popperProps,{get open(){return y.root.opts.open.current},get id(){return r()},trapFocus:!1,loop:!1,preventScroll:!1,forceMount:!1,get ref(){return y.opts.ref},tooltip:!0,get shouldRender(){return y.shouldRender},get contentPointerEvents(){return E(B)},popper:F,$$slots:{popper:!0}}))}};Ve(P,D=>{m()||D(O)},!0)}Y(k,T)};Ve(_,k=>{m()?k(x):k(I,!1)})}Y(t,C),kt()}var PZ=Ce("<button><!></button>");function yf(t,e){const n=sa();St(e,!0);let r=le(e,"id",19,()=>xl(n)),i=le(e,"disabled",3,!1),s=le(e,"type",3,"button"),o=le(e,"ref",15,null),a=Ni(e,["$$slots","$$events","$$legacy","children","child","id","disabled","type","ref"]);const l=fE.create({id:$e(()=>r()),disabled:$e(()=>i()??!1),ref:$e(()=>o(),u=>o(u))}),c=oe(()=>yr(a,l.props,{type:s()}));yN(t,{get id(){return r()},get ref(){return l.opts.ref},tooltip:!0,children:(u,d)=>{var f=Ue(),h=Ee(f);{var p=g=>{var y=Ue(),b=Ee(y);_t(b,()=>e.child,()=>({props:E(c)})),Y(g,y)},m=g=>{var y=PZ();kr(y,()=>({...E(c)}));var b=ie(y);_t(b,()=>e.children??Ft),Y(g,y)};Ve(h,g=>{e.child?g(p):g(m,!1)})}Y(u,f)},$$slots:{default:!0}}),kt()}function IZ(t,e){St(e,!0);let n=le(e,"delayDuration",3,700),r=le(e,"disableCloseOnTriggerClick",3,!1),i=le(e,"disableHoverableContent",3,!1),s=le(e,"disabled",3,!1),o=le(e,"ignoreNonKeyboardFocus",3,!1),a=le(e,"skipDelayDuration",3,300);uE.create({delayDuration:$e(()=>n()),disableCloseOnTriggerClick:$e(()=>r()),disableHoverableContent:$e(()=>i()),disabled:$e(()=>s()),ignoreNonKeyboardFocus:$e(()=>o()),skipDelayDuration:$e(()=>a())});var l=Ue(),c=Ee(l);_t(c,()=>e.children??Ft),Y(t,l),kt()}function fP(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function EN(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function OZ(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");fP(t.outputLen),fP(t.blockLen)}function oy(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function MZ(t,e){EN(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Qv=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const TN=t=>t instanceof Uint8Array,Yv=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),vo=(t,e)=>t<<32-e|t>>>e,NZ=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!NZ)throw new Error("Non little-endian hardware is not supported");function RZ(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function pE(t){if(typeof t=="string"&&(t=RZ(t)),!TN(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function DZ(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!TN(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let CN=class{clone(){return this._cloneInto()}};function LZ(t){const e=r=>t().update(pE(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function _N(t=32){if(Qv&&typeof Qv.getRandomValues=="function")return Qv.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function BZ(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}let FZ=class extends CN{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Yv(this.buffer)}update(e){oy(this);const{view:n,buffer:r,blockLen:i}=this;e=pE(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=Yv(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){oy(this),MZ(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;BZ(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Yv(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const $Z=(t,e,n)=>t&e^~t&n,zZ=(t,e,n)=>t&e^t&n^e&n,UZ=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Hl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vl=new Uint32Array(64);let HZ=class extends FZ{constructor(){super(64,32,8,!1),this.A=Hl[0]|0,this.B=Hl[1]|0,this.C=Hl[2]|0,this.D=Hl[3]|0,this.E=Hl[4]|0,this.F=Hl[5]|0,this.G=Hl[6]|0,this.H=Hl[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)Vl[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=Vl[d-15],h=Vl[d-2],p=vo(f,7)^vo(f,18)^f>>>3,m=vo(h,17)^vo(h,19)^h>>>10;Vl[d]=m+Vl[d-7]+p+Vl[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=vo(a,6)^vo(a,11)^vo(a,25),h=u+f+$Z(a,l,c)+UZ[d]+Vl[d]|0,m=(vo(r,2)^vo(r,13)^vo(r,22))+zZ(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Vl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const _x=LZ(()=>new HZ);const AN=BigInt(0),Yb=BigInt(1),VZ=BigInt(2),Jb=t=>t instanceof Uint8Array,WZ=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Hf(t){if(!Jb(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=WZ[t[n]];return e}function PN(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function mE(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function Vf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Zi(t){return mE(Hf(t))}function gE(t){if(!Jb(t))throw new Error("Uint8Array expected");return mE(Hf(Uint8Array.from(t).reverse()))}function Uc(t,e){return Vf(t.toString(16).padStart(e*2,"0"))}function yE(t,e){return Uc(t,e).reverse()}function jZ(t){return Vf(PN(t))}function oi(t,e,n){let r;if(typeof e=="string")try{r=Vf(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Jb(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function nd(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!Jb(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function qZ(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function KZ(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function GZ(t){let e;for(e=0;t>AN;t>>=Yb,e+=1);return e}function ZZ(t,e){return t>>BigInt(e)&Yb}const XZ=(t,e,n)=>t|(n?Yb:AN)<<BigInt(e),bE=t=>(VZ<<BigInt(t-1))-Yb,Jv=t=>new Uint8Array(t),hP=t=>Uint8Array.from(t);function IN(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Jv(t),i=Jv(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...d)=>n(i,r,...d),l=(d=Jv())=>{i=a(hP([0]),d),r=a(),d.length!==0&&(i=a(hP([1]),d),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<e;){r=a();const h=r.slice();f.push(h),d+=r.length}return nd(...f)};return(d,f)=>{o(),l(d);let h;for(;!(h=f(c()));)l();return o(),h}}const QZ={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Wm(t,e,n={}){const r=(i,s,o)=>{const a=QZ[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0)&&!a(l,t))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const YZ=Object.freeze(Object.defineProperty({__proto__:null,bitGet:ZZ,bitLen:GZ,bitMask:bE,bitSet:XZ,bytesToHex:Hf,bytesToNumberBE:Zi,bytesToNumberLE:gE,concatBytes:nd,createHmacDrbg:IN,ensureBytes:oi,equalBytes:qZ,hexToBytes:Vf,hexToNumber:mE,numberToBytesBE:Uc,numberToBytesLE:yE,numberToHexUnpadded:PN,numberToVarBytesBE:jZ,utf8ToBytes:KZ,validateObject:Wm},Symbol.toStringTag,{value:"Module"}));const Tr=BigInt(0),ir=BigInt(1),xu=BigInt(2),JZ=BigInt(3),Ax=BigInt(4),pP=BigInt(5),mP=BigInt(8);BigInt(9);BigInt(16);function Vr(t,e){const n=t%e;return n>=Tr?n:e+n}function eX(t,e,n){if(n<=Tr||e<Tr)throw new Error("Expected power/modulo > 0");if(n===ir)return Tr;let r=ir;for(;e>Tr;)e&ir&&(r=r*t%n),t=t*t%n,e>>=ir;return r}function xs(t,e,n){let r=t;for(;e-- >Tr;)r*=r,r%=n;return r}function Px(t,e){if(t===Tr||e<=Tr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Vr(t,e),r=e,i=Tr,s=ir;for(;n!==Tr;){const a=r/n,l=r%n,c=i-s*a;r=n,n=l,i=s,s=c}if(r!==ir)throw new Error("invert: does not exist");return Vr(i,e)}function tX(t){const e=(t-ir)/xu;let n,r,i;for(n=t-ir,r=0;n%xu===Tr;n/=xu,r++);for(i=xu;i<t&&eX(i,e,t)!==t-ir;i++);if(r===1){const o=(t+ir)/Ax;return function(l,c){const u=l.pow(c,o);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+ir)/xu;return function(a,l){if(a.pow(l,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=r,u=a.pow(a.mul(a.ONE,i),n),d=a.pow(l,s),f=a.pow(l,n);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let m=a.sqr(f);h<c&&!a.eql(m,a.ONE);h++)m=a.sqr(m);const p=a.pow(u,ir<<BigInt(c-h-1));u=a.sqr(p),d=a.mul(d,p),f=a.mul(f,u),c=h}return d}}function nX(t){if(t%Ax===JZ){const e=(t+ir)/Ax;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%mP===pP){const e=(t-pP)/mP;return function(r,i){const s=r.mul(i,xu),o=r.pow(s,e),a=r.mul(i,o),l=r.mul(r.mul(a,xu),o),c=r.mul(a,r.sub(l,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return tX(t)}const rX=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function iX(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=rX.reduce((r,i)=>(r[i]="function",r),e);return Wm(t,n)}function sX(t,e,n){if(n<Tr)throw new Error("Expected power > 0");if(n===Tr)return t.ONE;if(n===ir)return e;let r=t.ONE,i=e;for(;n>Tr;)n&ir&&(r=t.mul(r,i)),i=t.sqr(i),n>>=ir;return r}function oX(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function ON(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function aX(t,e,n=!1,r={}){if(t<=Tr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=ON(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=nX(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:bE(i),ZERO:Tr,ONE:ir,create:l=>Vr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return Tr<=l&&l<t},is0:l=>l===Tr,isOdd:l=>(l&ir)===ir,neg:l=>Vr(-l,t),eql:(l,c)=>l===c,sqr:l=>Vr(l*l,t),add:(l,c)=>Vr(l+c,t),sub:(l,c)=>Vr(l-c,t),mul:(l,c)=>Vr(l*c,t),pow:(l,c)=>sX(a,l,c),div:(l,c)=>Vr(l*Px(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>Px(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>oX(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?yE(l,s):Uc(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?gE(l):Zi(l)}});return Object.freeze(a)}function MN(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function NN(t){const e=MN(t);return e+Math.ceil(e/2)}function lX(t,e,n=!1){const r=t.length,i=MN(e),s=NN(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Zi(t):gE(t),a=Vr(o,e-ir)+ir;return n?yE(a,i):Uc(a,i)}const cX=BigInt(0),e1=BigInt(1);function uX(t,e){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=t.ZERO,a=i;for(;s>cX;)s&e1&&(o=o.add(a)),a=a.double(),s>>=e1;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),l=[];let c=i,u=c;for(let d=0;d<o;d++){u=c,l.push(u);for(let f=1;f<a;f++)u=u.add(c),l.push(u);c=u.double()}return l},wNAF(i,s,o){const{windows:a,windowSize:l}=r(i);let c=t.ZERO,u=t.BASE;const d=BigInt(2**i-1),f=2**i,h=BigInt(i);for(let p=0;p<a;p++){const m=p*l;let g=Number(o&d);o>>=h,g>l&&(g-=f,o+=e1);const y=m,b=m+Math.abs(g)-1,S=p%2!==0,C=g<0;g===0?u=u.add(n(S,s[y])):c=c.add(n(C,s[b]))}return{p:c,f:u}},wNAFCached(i,s,o,a){const l=i._WINDOW_SIZE||1;let c=s.get(i);return c||(c=this.precomputeWindow(i,l),l!==1&&s.set(i,a(c))),this.wNAF(l,c,o)}}}function RN(t){return iX(t.Fp),Wm(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ON(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function dX(t){const e=RN(t);Wm(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:fX,hexToBytes:hX}=YZ,Cu={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=Cu;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:fX(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Cu,n=typeof t=="string"?hX(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=Cu._parseInt(n.subarray(2)),{d:o,l:a}=Cu._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>Number.parseInt(c[0],16)&8?"00"+c:c,n=c=>{const u=c.toString(16);return u.length&1?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},za=BigInt(0),_s=BigInt(1);BigInt(2);const gP=BigInt(3);BigInt(4);function pX(t){const e=dX(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return nd(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1),g=n.fromBytes(m.subarray(0,n.BYTES)),y=n.fromBytes(m.subarray(n.BYTES,2*n.BYTES));return{x:g,y}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&za<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Hf(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(g*2,"0")}let S;try{S=typeof p=="bigint"?p:Zi(oi("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(S=Vr(S,b)),a(S),S}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=S=>n.eql(S,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map(y=>y.pz));return m.map((y,b)=>y.toAffine(g[b])).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(oi("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:S,py:C,pz:_}=m,x=n.eql(n.mul(g,_),n.mul(S,b)),I=n.eql(n.mul(y,_),n.mul(C,b));return x&&I}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,gP),{px:b,py:S,pz:C}=this;let _=n.ZERO,x=n.ZERO,I=n.ZERO,k=n.mul(b,b),T=n.mul(S,S),P=n.mul(C,C),O=n.mul(b,S);return O=n.add(O,O),I=n.mul(b,C),I=n.add(I,I),_=n.mul(m,I),x=n.mul(y,P),x=n.add(_,x),_=n.sub(T,x),x=n.add(T,x),x=n.mul(_,x),_=n.mul(O,_),I=n.mul(y,I),P=n.mul(m,P),O=n.sub(k,P),O=n.mul(m,O),O=n.add(O,I),I=n.add(k,k),k=n.add(I,k),k=n.add(k,P),k=n.mul(k,O),x=n.add(x,k),P=n.mul(S,C),P=n.add(P,P),k=n.mul(P,O),_=n.sub(_,k),I=n.mul(P,T),I=n.add(I,I),I=n.add(I,I),new d(_,x,I)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:S,py:C,pz:_}=m;let x=n.ZERO,I=n.ZERO,k=n.ZERO;const T=e.a,P=n.mul(e.b,gP);let O=n.mul(g,S),D=n.mul(y,C),F=n.mul(b,_),B=n.add(g,y),N=n.add(S,C);B=n.mul(B,N),N=n.add(O,D),B=n.sub(B,N),N=n.add(g,b);let M=n.add(S,_);return N=n.mul(N,M),M=n.add(O,F),N=n.sub(N,M),M=n.add(y,b),x=n.add(C,_),M=n.mul(M,x),x=n.add(D,F),M=n.sub(M,x),k=n.mul(T,N),x=n.mul(P,F),k=n.add(x,k),x=n.sub(D,k),k=n.add(D,k),I=n.mul(x,k),D=n.add(O,O),D=n.add(D,O),F=n.mul(T,F),N=n.mul(P,N),D=n.add(D,F),F=n.sub(O,F),F=n.mul(T,F),N=n.add(N,F),O=n.mul(D,N),I=n.add(I,O),O=n.mul(M,N),x=n.mul(B,x),x=n.sub(x,O),O=n.mul(B,D),k=n.mul(M,k),k=n.add(k,O),new d(x,I,k)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,g=>{const y=n.invertBatch(g.map(b=>b.pz));return g.map((b,S)=>b.toAffine(y[S])).map(d.fromAffine)})}multiplyUnsafe(m){const g=d.ZERO;if(m===za)return g;if(a(m),m===_s)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:S,k2neg:C,k2:_}=y.splitScalar(m),x=g,I=g,k=this;for(;S>za||_>za;)S&_s&&(x=x.add(k)),_&_s&&(I=I.add(k)),k=k.double(),S>>=_s,_>>=_s;return b&&(x=x.negate()),C&&(I=I.negate()),I=new d(n.mul(I.px,y.beta),I.py,I.pz),x.add(I)}multiply(m){a(m);let g=m,y,b;const{endo:S}=e;if(S){const{k1neg:C,k1:_,k2neg:x,k2:I}=S.splitScalar(g);let{p:k,f:T}=this.wNAF(_),{p:P,f:O}=this.wNAF(I);k=h.constTimeNegate(C,k),P=h.constTimeNegate(x,P),P=new d(n.mul(P.px,S.beta),P.py,P.pz),y=k.add(P),b=T.add(O)}else{const{p:C,f:_}=this.wNAF(g);y=C,b=_}return d.normalizeZ([y,b])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,S=(_,x)=>x===za||x===_s||!_.equals(b)?_.multiplyUnsafe(x):_.multiply(x),C=S(this,g).add(S(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,S=this.is0();m==null&&(m=S?n.ONE:n.inv(b));const C=n.mul(g,m),_=n.mul(y,m),x=n.mul(b,m);if(S)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:C,y:_}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===_s)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===_s?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return Hf(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=uX(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function mX(t){const e=RN(t);return Wm(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function gX(t){const e=mX(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(N){return za<N&&N<n.ORDER}function a(N){return Vr(N,r)}function l(N){return Px(N,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=pX({...e,toBytes(N,M,R){const H=M.toAffine(),z=n.toBytes(H.x),V=nd;return R?V(Uint8Array.from([M.hasEvenY()?2:3]),z):V(Uint8Array.from([4]),z,n.toBytes(H.y))},fromBytes(N){const M=N.length,R=N[0],H=N.subarray(1);if(M===i&&(R===2||R===3)){const z=Zi(H);if(!o(z))throw new Error("Point is not on curve");const V=d(z);let X=n.sqrt(V);const Z=(X&_s)===_s;return(R&1)===1!==Z&&(X=n.neg(X)),{x:z,y:X}}else if(M===s&&R===4){const z=n.fromBytes(H.subarray(0,n.BYTES)),V=n.fromBytes(H.subarray(n.BYTES,2*n.BYTES));return{x:z,y:V}}else throw new Error(`Point of length ${M} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=N=>Hf(Uc(N,e.nByteLength));function p(N){const M=r>>_s;return N>M}function m(N){return p(N)?a(-N):N}const g=(N,M,R)=>Zi(N.slice(M,R));class y{constructor(M,R,H){this.r=M,this.s=R,this.recovery=H,this.assertValidity()}static fromCompact(M){const R=e.nByteLength;return M=oi("compactSignature",M,R*2),new y(g(M,0,R),g(M,R,2*R))}static fromDER(M){const{r:R,s:H}=Cu.toSig(oi("DER",M));return new y(R,H)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(M){return new y(this.r,this.s,M)}recoverPublicKey(M){const{r:R,s:H,recovery:z}=this,V=I(oi("msgHash",M));if(z==null||![0,1,2,3].includes(z))throw new Error("recovery id invalid");const X=z===2||z===3?R+e.n:R;if(X>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const Z=(z&1)===0?"02":"03",te=c.fromHex(Z+h(X)),ne=l(X),J=a(-V*ne),xe=a(H*ne),Le=c.BASE.multiplyAndAddUnsafe(te,J,xe);if(!Le)throw new Error("point at infinify");return Le.assertValidity(),Le}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new y(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Vf(this.toDERHex())}toDERHex(){return Cu.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Vf(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const b={isValidPrivateKey(N){try{return u(N),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const N=NN(e.n);return lX(e.randomBytes(N),e.n)},precompute(N=8,M=c.BASE){return M._setWindowSize(N),M.multiply(BigInt(3)),M}};function S(N,M=!0){return c.fromPrivateKey(N).toRawBytes(M)}function C(N){const M=N instanceof Uint8Array,R=typeof N=="string",H=(M||R)&&N.length;return M?H===i||H===s:R?H===2*i||H===2*s:N instanceof c}function _(N,M,R=!0){if(C(N))throw new Error("first arg must be private key");if(!C(M))throw new Error("second arg must be public key");return c.fromHex(M).multiply(u(N)).toRawBytes(R)}const x=e.bits2int||function(N){const M=Zi(N),R=N.length*8-e.nBitLength;return R>0?M>>BigInt(R):M},I=e.bits2int_modN||function(N){return a(x(N))},k=bE(e.nBitLength);function T(N){if(typeof N!="bigint")throw new Error("bigint expected");if(!(za<=N&&N<k))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Uc(N,e.nByteLength)}function P(N,M,R=O){if(["recovered","canonical"].some(ke=>ke in R))throw new Error("sign() legacy options not supported");const{hash:H,randomBytes:z}=e;let{lowS:V,prehash:X,extraEntropy:Z}=R;V==null&&(V=!0),N=oi("msgHash",N),X&&(N=oi("prehashed msgHash",H(N)));const te=I(N),ne=u(M),J=[T(ne),T(te)];if(Z!=null){const ke=Z===!0?z(n.BYTES):Z;J.push(oi("extraEntropy",ke))}const xe=nd(...J),Le=te;function he(ke){const Be=x(ke);if(!f(Be))return;const je=l(Be),Fe=c.BASE.multiply(Be).toAffine(),ve=a(Fe.x);if(ve===za)return;const Ie=a(je*a(Le+ve*ne));if(Ie===za)return;let Oe=(Fe.x===ve?0:2)|Number(Fe.y&_s),qe=Ie;return V&&p(Ie)&&(qe=m(Ie),Oe^=1),new y(ve,qe,Oe)}return{seed:xe,k2sig:he}}const O={lowS:e.lowS,prehash:!1},D={lowS:e.lowS,prehash:!1};function F(N,M,R=O){const{seed:H,k2sig:z}=P(N,M,R),V=e;return IN(V.hash.outputLen,V.nByteLength,V.hmac)(H,z)}c.BASE._setWindowSize(8);function B(N,M,R,H=D){const z=N;if(M=oi("msgHash",M),R=oi("publicKey",R),"strict"in H)throw new Error("options.strict was renamed to lowS");const{lowS:V,prehash:X}=H;let Z,te;try{if(typeof z=="string"||z instanceof Uint8Array)try{Z=y.fromDER(z)}catch(Fe){if(!(Fe instanceof Cu.Err))throw Fe;Z=y.fromCompact(z)}else if(typeof z=="object"&&typeof z.r=="bigint"&&typeof z.s=="bigint"){const{r:Fe,s:ve}=z;Z=new y(Fe,ve)}else throw new Error("PARSE");te=c.fromHex(R)}catch(Fe){if(Fe.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(V&&Z.hasHighS())return!1;X&&(M=e.hash(M));const{r:ne,s:J}=Z,xe=I(M),Le=l(J),he=a(xe*Le),ke=a(ne*Le),Be=c.BASE.multiplyAndAddUnsafe(te,he,ke)?.toAffine();return Be?a(Be.x)===ne:!1}return{CURVE:e,getPublicKey:S,getSharedSecret:_,sign:F,verify:B,ProjectivePoint:c,Signature:y,utils:b}}let DN=class extends CN{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,OZ(e);const r=pE(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return oy(this),this.iHash.update(e),this}digestInto(e){oy(this),EN(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const LN=(t,e,n)=>new DN(t,e).update(n).digest();LN.create=(t,e)=>new DN(t,e);function yX(t){return{hash:t,hmac:(e,...n)=>LN(t,e,DZ(...n)),randomBytes:_N}}function bX(t,e){const n=r=>gX({...t,...yX(r)});return Object.freeze({...n(e),create:n})}const ew=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ay=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),BN=BigInt(1),ly=BigInt(2),yP=(t,e)=>(t+e/ly)/e;function FN(t){const e=ew,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=xs(u,n,e)*u%e,f=xs(d,n,e)*u%e,h=xs(f,ly,e)*c%e,p=xs(h,i,e)*h%e,m=xs(p,s,e)*p%e,g=xs(m,a,e)*m%e,y=xs(g,l,e)*g%e,b=xs(y,a,e)*m%e,S=xs(b,n,e)*u%e,C=xs(S,o,e)*p%e,_=xs(C,r,e)*c%e,x=xs(_,ly,e);if(!Ix.eql(Ix.sqr(x),t))throw new Error("Cannot find square root");return x}const Ix=aX(ew,void 0,void 0,{sqrt:FN}),fh=bX({a:BigInt(0),b:BigInt(7),Fp:Ix,n:ay,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=ay,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-BN*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=yP(s*t,e),l=yP(-r*t,e);let c=Vr(t-a*n-l*i,e),u=Vr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},_x),tw=BigInt(0),$N=t=>typeof t=="bigint"&&tw<t&&t<ew,wX=t=>typeof t=="bigint"&&tw<t&&t<ay,bP={};function cy(t,...e){let n=bP[t];if(n===void 0){const r=_x(Uint8Array.from(t,i=>i.charCodeAt(0)));n=nd(r,r),bP[t]=n}return _x(nd(n,...e))}const wE=t=>t.toRawBytes(!0).slice(1),Ox=t=>Uc(t,32),t1=t=>Vr(t,ew),Jp=t=>Vr(t,ay),vE=fh.ProjectivePoint,vX=(t,e,n)=>vE.BASE.multiplyAndAddUnsafe(t,e,n);function Mx(t){let e=fh.utils.normPrivateKeyToScalar(t),n=vE.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Jp(-e),bytes:wE(n)}}function zN(t){if(!$N(t))throw new Error("bad x: need 0 < x < p");const e=t1(t*t),n=t1(e*t+BigInt(7));let r=FN(n);r%ly!==tw&&(r=t1(-r));const i=new vE(t,r,BN);return i.assertValidity(),i}function UN(...t){return Jp(Zi(cy("BIP0340/challenge",...t)))}function xX(t){return Mx(t).bytes}function SX(t,e,n=_N(32)){const r=oi("message",t),{bytes:i,scalar:s}=Mx(e),o=oi("auxRand",n,32),a=Ox(s^Zi(cy("BIP0340/aux",o))),l=cy("BIP0340/nonce",a,i,r),c=Jp(Zi(l));if(c===tw)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=Mx(c),f=UN(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(Ox(Jp(d+f*s)),32),!HN(h,r,i))throw new Error("sign: Invalid signature produced");return h}function HN(t,e,n){const r=oi("signature",t,64),i=oi("message",e),s=oi("publicKey",n,32);try{const o=zN(Zi(s)),a=Zi(r.subarray(0,32));if(!$N(a))return!1;const l=Zi(r.subarray(32,64));if(!wX(l))return!1;const c=UN(Ox(a),wE(o),i),u=vX(o,l,Jp(-c));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const Do={getPublicKey:xX,sign:SX,verify:HN,utils:{randomPrivateKey:fh.utils.randomPrivateKey,lift_x:zN,pointToBytes:wE,numberToBytesBE:Uc,bytesToNumberBE:Zi,taggedHash:cy,mod:Vr}},n1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const xE=t=>t instanceof Uint8Array,r1=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),xo=(t,e)=>t<<32-e|t>>>e,kX=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!kX)throw new Error("Non little-endian hardware is not supported");const EX=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function dr(t){if(!xE(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=EX[t[n]];return e}function rd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=r*2,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function TX(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function em(t){if(typeof t=="string"&&(t=TX(t)),!xE(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function nw(...t){const e=new Uint8Array(t.reduce((r,i)=>r+i.length,0));let n=0;return t.forEach(r=>{if(!xE(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class VN{clone(){return this._cloneInto()}}function WN(t){const e=r=>t().update(em(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function jN(t=32){if(n1&&typeof n1.getRandomValues=="function")return n1.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Nx(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function CX(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function qN(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function _X(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Nx(t.outputLen),Nx(t.blockLen)}function AX(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function PX(t,e){qN(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const zo={number:Nx,bool:CX,bytes:qN,hash:_X,exists:AX,output:PX};function IX(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}class OX extends VN{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=r1(this.buffer)}update(e){zo.exists(this);const{view:n,buffer:r,blockLen:i}=this;e=em(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const l=r1(e);for(;i<=s-o;o+=i)this.process(l,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){zo.exists(this),zo.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;IX(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=r1(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const MX=(t,e,n)=>t&e^~t&n,NX=(t,e,n)=>t&e^t&n^e&n,RX=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Wl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),jl=new Uint32Array(64);class KN extends OX{constructor(){super(64,32,8,!1),this.A=Wl[0]|0,this.B=Wl[1]|0,this.C=Wl[2]|0,this.D=Wl[3]|0,this.E=Wl[4]|0,this.F=Wl[5]|0,this.G=Wl[6]|0,this.H=Wl[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,n){for(let d=0;d<16;d++,n+=4)jl[d]=e.getUint32(n,!1);for(let d=16;d<64;d++){const f=jl[d-15],h=jl[d-2],p=xo(f,7)^xo(f,18)^f>>>3,m=xo(h,17)^xo(h,19)^h>>>10;jl[d]=m+jl[d-7]+p+jl[d-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let d=0;d<64;d++){const f=xo(a,6)^xo(a,11)^xo(a,25),h=u+f+MX(a,l,c)+RX[d]+jl[d]|0,m=(xo(r,2)^xo(r,13)^xo(r,22))+NX(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+m|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){jl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class DX extends KN{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Qc=WN(()=>new KN);WN(()=>new DX);function hh(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Sl(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce((i,s)=>i?e(i,s.encode):s.encode,void 0),r=t.reduce((i,s)=>i?e(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function kl(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(hh(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function El(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function rw(t,e="="){if(hh(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function GN(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function wP(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach(o=>{if(hh(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!==e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[l]?a=!1:r=l;else continue}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const ZN=(t,e)=>e?ZN(e,t%e):t,uy=(t,e)=>t+(e-ZN(t,e));function Rx(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(uy(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${uy(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(hh(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function LX(t){return hh(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return wP(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(wP(e,t,2**8))}}}function Yc(t,e=!1){if(hh(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(uy(8,t)>32||uy(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Rx(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Rx(n,t,8,e))}}}function vP(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const BX=Sl(Yc(4),kl("0123456789ABCDEF"),El("")),FX=Sl(Yc(5),kl("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),rw(5),El(""));Sl(Yc(5),kl("0123456789ABCDEFGHIJKLMNOPQRSTUV"),rw(5),El(""));Sl(Yc(5),kl("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),El(""),GN(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Jo=Sl(Yc(6),kl("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),rw(6),El("")),$X=Sl(Yc(6),kl("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),rw(6),El("")),SE=t=>Sl(LX(58),kl(t),El("")),Dx=SE("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");SE("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");SE("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const xP=[0,2,3,5,6,7,9,10,11],zX={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=Dx.encode(r).padStart(xP[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),i=xP.indexOf(r.length),s=Dx.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(e)}},Lx=Sl(kl("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),El("")),SP=[996825010,642813549,513874426,1027748829,705979059];function zh(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<SP.length;r++)(e>>r&1)===1&&(n^=SP[r]);return n}function kP(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=zh(i)^o>>5}i=zh(i);for(let s=0;s<r;s++)i=zh(i)^t.charCodeAt(s)&31;for(let s of e)i=zh(i)^s;for(let s=0;s<6;s++)i=zh(i);return i^=n,Lx.encode(Rx([i%2**30],30,5,!1))}function XN(t){const e=t==="bech32"?1:734539939,n=Yc(5),r=n.decode,i=n.encode,s=vP(r);function o(u,d,f=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(d)||d.length&&typeof d[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof d}`);const h=u.length+7+d.length;if(f!==!1&&h>f)throw new TypeError(`Length ${h} exceeds limit ${f}`);return u=u.toLowerCase(),`${u}1${Lx.encode(d)}${kP(u,d,e)}`}function a(u,d=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||d!==!1&&u.length>d)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${d})`);const f=u.toLowerCase();if(u!==f&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=f;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const p=u.slice(0,h),m=u.slice(h+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const g=Lx.decode(m).slice(0,-6),y=kP(p,g,e);if(!m.endsWith(y))throw new Error(`Invalid checksum in ${u}: expected "${y}"`);return{prefix:p,words:g}}const l=vP(a);function c(u){const{prefix:d,words:f}=a(u,!1);return{prefix:d,words:f,bytes:r(f)}}return{encode:o,decode:a,decodeToBytes:c,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:s,toWords:i}}const Wf=XN("bech32");XN("bech32m");const UX={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},HX=Sl(Yc(4),kl("0123456789abcdef"),El(""),GN(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),VX={utf8:UX,hex:HX,base16:BX,base32:FX,base64:Jo,base64url:$X,base58:Dx,base58xmr:zX};`${Object.keys(VX).join(", ")}`;function i1(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function EP(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function WX(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function Uo(t,...e){if(!WX(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}const di=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),jX=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!jX)throw new Error("Non little-endian hardware is not supported");const qX=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Id(t){Uo(t);let e="";for(let n=0;n<t.length;n++)e+=qX[t[n]];return e}const wa={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function TP(t){if(t>=wa._0&&t<=wa._9)return t-wa._0;if(t>=wa._A&&t<=wa._F)return t-(wa._A-10);if(t>=wa._a&&t<=wa._f)return t-(wa._a-10)}function QN(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=TP(t.charCodeAt(s)),a=TP(t.charCodeAt(s+1));if(o===void 0||a===void 0){const l=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}r[i]=o*16+a}return r}function KX(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function GX(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const ZX=(t,e)=>(Object.assign(e,t),e),Cc=16,XX=283;function kE(t){return t<<1^XX&-(t>>7)}function Qd(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=kE(t);return n}const Bx=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=kE(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),QX=Bx.map((t,e)=>Bx.indexOf(e)),YX=t=>t<<24|t>>>8,s1=t=>t<<8|t>>>24;function YN(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((c,u)=>e(t[u])),r=n.map(s1),i=r.map(s1),s=i.map(s1),o=new Uint32Array(256*256),a=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const d=c*256+u;o[d]=n[c]^r[u],a[d]=i[c]^s[u],l[d]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const EE=YN(Bx,t=>Qd(t,3)<<24|t<<16|t<<8|Qd(t,2)),JN=YN(QX,t=>Qd(t,11)<<24|Qd(t,13)<<16|Qd(t,9)<<8|Qd(t,14)),JX=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=kE(n))t[e]=n;return t})();function eR(t){Uo(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=EE,r=di(t),i=r.length,s=a=>Ho(n,a,a,a,a),o=new Uint32Array(e+28);o.set(r);for(let a=i;a<o.length;a++){let l=o[a-1];a%i===0?l=s(YX(l))^JX[a/i-1]:i>6&&a%i===4&&(l=s(l)),o[a]=o[a-i]^l}return o}function eQ(t){const e=eR(t),n=e.slice(),r=e.length,{sbox2:i}=EE,{T0:s,T1:o,T2:a,T3:l}=JN;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],d=Ho(i,u,u,u,u);n[c]=s[d&255]^o[d>>>8&255]^a[d>>>16&255]^l[d>>>24]}return n}function hc(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function Ho(t,e,n,r,i){return t[e&255|n&65280]|t[r>>>16&255|i>>>16&65280]<<16}function CP(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=EE;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const m=t[l++]^hc(o,a,e,n,r,i),g=t[l++]^hc(o,a,n,r,i,e),y=t[l++]^hc(o,a,r,i,e,n),b=t[l++]^hc(o,a,i,e,n,r);e=m,n=g,r=y,i=b}const u=t[l++]^Ho(s,e,n,r,i),d=t[l++]^Ho(s,n,r,i,e),f=t[l++]^Ho(s,r,i,e,n),h=t[l++]^Ho(s,i,e,n,r);return{s0:u,s1:d,s2:f,s3:h}}function tQ(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=JN;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let p=0;p<c;p++){const m=t[l++]^hc(o,a,e,i,r,n),g=t[l++]^hc(o,a,n,e,i,r),y=t[l++]^hc(o,a,r,n,e,i),b=t[l++]^hc(o,a,i,r,n,e);e=m,n=g,r=y,i=b}const u=t[l++]^Ho(s,e,i,r,n),d=t[l++]^Ho(s,n,e,i,r),f=t[l++]^Ho(s,r,n,e,i),h=t[l++]^Ho(s,i,r,n,e);return{s0:u,s1:d,s2:f,s3:h}}function tR(t,e){if(!e)return new Uint8Array(t);if(Uo(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function nQ(t){if(Uo(t),t.length%Cc!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Cc}`)}function rQ(t,e,n){let r=t.length;const i=r%Cc;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=di(t);if(e){let l=Cc-i;l||(l=Cc),r=r+l}const o=tR(r,n),a=di(o);return{b:s,o:a,out:o}}function iQ(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function sQ(t){const e=new Uint8Array(16),n=di(e);e.set(t);const r=Cc-t.length;for(let i=Cc-r;i<Cc;i++)e[i]=r;return n}const nR=ZX({blockSize:16,nonceLength:16},function(e,n,r={}){Uo(e),Uo(n,16);const i=!r.disablePadding;return{encrypt:(s,o)=>{const a=eR(e),{b:l,o:c,out:u}=rQ(s,i,o),d=di(n);let f=d[0],h=d[1],p=d[2],m=d[3],g=0;for(;g+4<=l.length;)f^=l[g+0],h^=l[g+1],p^=l[g+2],m^=l[g+3],{s0:f,s1:h,s2:p,s3:m}=CP(a,f,h,p,m),c[g++]=f,c[g++]=h,c[g++]=p,c[g++]=m;if(i){const y=sQ(s.subarray(g*4));f^=y[0],h^=y[1],p^=y[2],m^=y[3],{s0:f,s1:h,s2:p,s3:m}=CP(a,f,h,p,m),c[g++]=f,c[g++]=h,c[g++]=p,c[g++]=m}return a.fill(0),u},decrypt:(s,o)=>{nQ(s);const a=eQ(e),l=di(n),c=tR(s.length,o),u=di(s),d=di(c);let f=l[0],h=l[1],p=l[2],m=l[3];for(let g=0;g+4<=u.length;){const y=f,b=h,S=p,C=m;f=u[g+0],h=u[g+1],p=u[g+2],m=u[g+3];const{s0:_,s1:x,s2:I,s3:k}=tQ(a,f,h,p,m);d[g++]=_^y,d[g++]=x^b,d[g++]=I^S,d[g++]=k^C}return a.fill(0),iQ(c,i)}}}),rR=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),oQ=rR("expand 16-byte k"),aQ=rR("expand 32-byte k"),lQ=di(oQ),iR=di(aQ);iR.slice();function sn(t,e){return t<<e|t>>>32-e}function Fx(t){return t.byteOffset%4===0}const Ig=64,cQ=16,sR=2**32-1,_P=new Uint32Array;function uQ(t,e,n,r,i,s,o,a){const l=i.length,c=new Uint8Array(Ig),u=di(c),d=Fx(i)&&Fx(s),f=d?di(i):_P,h=d?di(s):_P;for(let p=0;p<l;o++){if(t(e,n,r,u,o,a),o>=sR)throw new Error("arx: counter overflow");const m=Math.min(Ig,l-p);if(d&&m===Ig){const g=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let y=0,b;y<cQ;y++)b=g+y,h[b]=f[b]^u[y];p+=Ig;continue}for(let g=0,y;g<m;g++)y=p+g,s[y]=i[y]^c[g];p+=m}}function dQ(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=KX({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return i1(i),i1(o),EP(s),EP(n),(a,l,c,u,d=0)=>{Uo(a),Uo(l),Uo(c);const f=c.length;if(u||(u=new Uint8Array(f)),Uo(u),i1(d),d<0||d>=sR)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const h=[];let p=a.length,m,g;if(p===32)m=a.slice(),h.push(m),g=iR;else if(p===16&&n)m=new Uint8Array(32),m.set(a),m.set(a,16),g=lQ,h.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Fx(l)||(l=l.slice(),h.push(l));const y=di(m);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,y,di(l.subarray(0,16)),y),l=l.subarray(16)}const b=16-i;if(b!==l.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const C=new Uint8Array(12);C.set(l,s?0:12-l.length),l=C,h.push(l)}const S=di(l);for(uQ(t,g,y,S,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function fQ(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],d=e[1],f=e[2],h=e[3],p=e[4],m=e[5],g=e[6],y=e[7],b=i,S=n[0],C=n[1],_=n[2],x=o,I=a,k=l,T=c,P=u,O=d,D=f,F=h,B=p,N=m,M=g,R=y,H=b,z=S,V=C,X=_;for(let te=0;te<s;te+=2)x=x+P|0,H=sn(H^x,16),B=B+H|0,P=sn(P^B,12),x=x+P|0,H=sn(H^x,8),B=B+H|0,P=sn(P^B,7),I=I+O|0,z=sn(z^I,16),N=N+z|0,O=sn(O^N,12),I=I+O|0,z=sn(z^I,8),N=N+z|0,O=sn(O^N,7),k=k+D|0,V=sn(V^k,16),M=M+V|0,D=sn(D^M,12),k=k+D|0,V=sn(V^k,8),M=M+V|0,D=sn(D^M,7),T=T+F|0,X=sn(X^T,16),R=R+X|0,F=sn(F^R,12),T=T+F|0,X=sn(X^T,8),R=R+X|0,F=sn(F^R,7),x=x+O|0,X=sn(X^x,16),M=M+X|0,O=sn(O^M,12),x=x+O|0,X=sn(X^x,8),M=M+X|0,O=sn(O^M,7),I=I+D|0,H=sn(H^I,16),R=R+H|0,D=sn(D^R,12),I=I+D|0,H=sn(H^I,8),R=R+H|0,D=sn(D^R,7),k=k+F|0,z=sn(z^k,16),B=B+z|0,F=sn(F^B,12),k=k+F|0,z=sn(z^k,8),B=B+z|0,F=sn(F^B,7),T=T+P|0,V=sn(V^T,16),N=N+V|0,P=sn(P^N,12),T=T+P|0,V=sn(V^T,8),N=N+V|0,P=sn(P^N,7);let Z=0;r[Z++]=o+x|0,r[Z++]=a+I|0,r[Z++]=l+k|0,r[Z++]=c+T|0,r[Z++]=u+P|0,r[Z++]=d+O|0,r[Z++]=f+D|0,r[Z++]=h+F|0,r[Z++]=p+B|0,r[Z++]=m+N|0,r[Z++]=g+M|0,r[Z++]=y+R|0,r[Z++]=b+H|0,r[Z++]=S+z|0,r[Z++]=C+V|0,r[Z++]=_+X|0}const oR=dQ(fQ,{counterRight:!1,counterLength:4,allowShortKeys:!1});class aR extends VN{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,zo.hash(e);const r=em(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return zo.exists(this),this.iHash.update(e),this}digestInto(e){zo.exists(this),zo.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const iw=(t,e,n)=>new aR(t,e).update(n).digest();iw.create=(t,e)=>new aR(t,e);function hQ(t,e,n){return zo.hash(t),iw(t,em(n),em(e))}const o1=new Uint8Array([0]),AP=new Uint8Array;function pQ(t,e,n,r=32){if(zo.hash(t),zo.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=AP);const s=new Uint8Array(i*t.outputLen),o=iw.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)o1[0]=c+1,a.update(c===0?AP:l).update(n).update(o1).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),o1.fill(0),s.slice(0,r)}var mQ=Object.defineProperty,Bn=(t,e)=>{for(var n in e)mQ(t,n,{get:e[n],enumerable:!0})},Od=Symbol("verified"),gQ=t=>t instanceof Object;function TE(t){if(!gQ(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var yQ={};Bn(yQ,{Queue:()=>xQ,QueueNode:()=>lR,binarySearch:()=>CE,bytesToHex:()=>dr,hexToBytes:()=>rd,insertEventIntoAscendingList:()=>vQ,insertEventIntoDescendingList:()=>wQ,normalizeURL:()=>bQ,utf8Decoder:()=>Ka,utf8Encoder:()=>uo});var Ka=new TextDecoder("utf-8"),uo=new TextEncoder;function bQ(t){try{t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.protocol==="http:"?e.protocol="ws:":e.protocol==="https:"&&(e.protocol="wss:"),e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${t}`)}}function wQ(t,e){const[n,r]=CE(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at);return r||t.splice(n,0,e),t}function vQ(t,e){const[n,r]=CE(t,i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at);return r||t.splice(n,0,e),t}function CE(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var lR=class{value;next=null;prev=null;constructor(t){this.value=t}},xQ=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new lR(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},SQ=class{generateSecretKey(){return Do.utils.randomPrivateKey()}getPublicKey(e){return dr(Do.getPublicKey(e))}finalizeEvent(e,n){const r=e;return r.pubkey=dr(Do.getPublicKey(n)),r.id=u0(r),r.sig=dr(Do.sign(u0(r),n)),r[Od]=!0,r}verifyEvent(e){if(typeof e[Od]=="boolean")return e[Od];const n=u0(e);if(n!==e.id)return e[Od]=!1,!1;try{const r=Do.verify(e.sig,n,e.pubkey);return e[Od]=r,r}catch{return e[Od]=!1,!1}}};function kQ(t){if(!TE(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function u0(t){let e=Qc(uo.encode(kQ(t)));return dr(e)}var sw=new SQ,EQ=sw.generateSecretKey,ow=sw.getPublicKey,la=sw.finalizeEvent,_E=sw.verifyEvent,TQ={};Bn(TQ,{Application:()=>BY,BadgeAward:()=>NQ,BadgeDefinition:()=>IY,BlockedRelaysList:()=>fY,BlossomServerList:()=>wY,BookmarkList:()=>cY,Bookmarksets:()=>_Y,Calendar:()=>WY,CalendarEventRSVP:()=>jY,ChannelCreation:()=>pR,ChannelHideMessage:()=>yR,ChannelMessage:()=>gR,ChannelMetadata:()=>mR,ChannelMuteUser:()=>bR,ChatMessage:()=>RQ,ClassifiedListing:()=>zY,ClientAuth:()=>vR,Comment:()=>VQ,CommunitiesList:()=>uY,CommunityDefinition:()=>ZY,CommunityPostApproval:()=>QQ,Contacts:()=>IQ,CreateOrUpdateProduct:()=>NY,CreateOrUpdateStall:()=>MY,Curationsets:()=>AY,Date:()=>HY,DirectMessageRelaysList:()=>yY,DraftClassifiedListing:()=>UY,DraftLong:()=>DY,Emojisets:()=>LY,EncryptedDirectMessage:()=>OQ,EventDeletion:()=>MQ,FavoriteRelays:()=>pY,FileMessage:()=>LQ,FileMetadata:()=>HQ,FileServerPreference:()=>bY,Followsets:()=>EY,ForumThread:()=>DQ,GenericRepost:()=>ME,Genericlists:()=>TY,GiftWrap:()=>wR,GroupMetadata:()=>XY,HTTPAuth:()=>NE,Handlerinformation:()=>GY,Handlerrecommendation:()=>KY,Highlights:()=>iY,InterestsList:()=>mY,Interestsets:()=>OY,JobFeedback:()=>eY,JobRequest:()=>YQ,JobResult:()=>JQ,Label:()=>XQ,LightningPubRPC:()=>xY,LiveChatMessage:()=>WQ,LiveEvent:()=>FY,LongFormArticle:()=>RY,Metadata:()=>AQ,Mutelist:()=>oY,NWCWalletInfo:()=>vY,NWCWalletRequest:()=>xR,NWCWalletResponse:()=>SY,NormalVideo:()=>FQ,NostrConnect:()=>kY,OpenTimestamps:()=>zQ,Photo:()=>BQ,Pinlist:()=>aY,Poll:()=>UQ,PollResponse:()=>sY,PrivateDirectMessage:()=>hR,ProblemTracker:()=>KQ,ProfileBadges:()=>PY,PublicChatsList:()=>dY,Reaction:()=>OE,RecommendRelay:()=>PQ,RelayList:()=>lY,RelayReview:()=>qY,Relaysets:()=>CY,Report:()=>GQ,Reporting:()=>ZQ,Repost:()=>IE,Seal:()=>fR,SearchRelaysList:()=>hY,ShortTextNote:()=>dR,ShortVideo:()=>$Q,Time:()=>VY,UserEmojiList:()=>gY,UserStatuses:()=>$Y,Voice:()=>jQ,VoiceComment:()=>qQ,Zap:()=>rY,ZapGoal:()=>tY,ZapRequest:()=>nY,classifyKind:()=>CQ,isAddressableKind:()=>PE,isEphemeralKind:()=>uR,isKind:()=>_Q,isRegularKind:()=>cR,isReplaceableKind:()=>AE});function cR(t){return t<1e4&&t!==0&&t!==3}function AE(t){return t===0||t===3||1e4<=t&&t<2e4}function uR(t){return 2e4<=t&&t<3e4}function PE(t){return 3e4<=t&&t<4e4}function CQ(t){return cR(t)?"regular":AE(t)?"replaceable":uR(t)?"ephemeral":PE(t)?"parameterized":"unknown"}function _Q(t,e){const n=e instanceof Array?e:[e];return TE(t)&&n.includes(t.kind)||!1}var AQ=0,dR=1,PQ=2,IQ=3,OQ=4,MQ=5,IE=6,OE=7,NQ=8,RQ=9,DQ=11,fR=13,hR=14,LQ=15,ME=16,BQ=20,FQ=21,$Q=22,pR=40,mR=41,gR=42,yR=43,bR=44,zQ=1040,wR=1059,UQ=1068,HQ=1063,VQ=1111,WQ=1311,jQ=1222,qQ=1244,KQ=1971,GQ=1984,ZQ=1984,XQ=1985,QQ=4550,YQ=5999,JQ=6999,eY=7e3,tY=9041,nY=9734,rY=9735,iY=9802,sY=1018,oY=1e4,aY=10001,lY=10002,cY=10003,uY=10004,dY=10005,fY=10006,hY=10007,pY=10012,mY=10015,gY=10030,yY=10050,bY=10096,wY=10063,vY=13194,xY=21e3,vR=22242,xR=23194,SY=23195,kY=24133,NE=27235,EY=3e4,TY=30001,CY=30002,_Y=30003,AY=30004,PY=30008,IY=30009,OY=30015,MY=30017,NY=30018,RY=30023,DY=30024,LY=30030,BY=30078,FY=30311,$Y=30315,zY=30402,UY=30403,HY=31922,VY=31923,WY=31924,jY=31925,qY=31987,KY=31989,GY=31990,ZY=34550,XY=39e3,QY={};Bn(QY,{getHex64:()=>RE,getInt:()=>SR,getSubscriptionId:()=>YY,matchEventId:()=>JY,matchEventKind:()=>tJ,matchEventPubkey:()=>eJ});function RE(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function SR(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function YY(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function JY(t,e){return e===RE(t,"id")}function eJ(t,e){return e===RE(t,"pubkey")}function tJ(t,e){return e===SR(t,"kind")}var nJ={};Bn(nJ,{makeAuthEvent:()=>rJ});function rJ(t,e){return{kind:vR,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}var iJ;try{iJ=WebSocket}catch{}var sJ;try{sJ=WebSocket}catch{}var hl={};Bn(hl,{BECH32_REGEX:()=>kR,Bech32MaxSize:()=>DE,NostrTypeGuard:()=>oJ,decode:()=>aw,decodeNostrURI:()=>lJ,encodeBytes:()=>cw,naddrEncode:()=>pJ,neventEncode:()=>hJ,noteEncode:()=>dJ,nprofileEncode:()=>fJ,npubEncode:()=>uJ,nsecEncode:()=>cJ});var oJ={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},DE=5e3,kR=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function aJ(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function lJ(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),aw(t)}catch{return{type:"invalid",data:null}}}function aw(t){let{prefix:e,words:n}=Wf.decode(t,DE),r=new Uint8Array(Wf.fromWords(n));switch(e){case"nprofile":{let i=a1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:dr(i[0][0]),relays:i[1]?i[1].map(s=>Ka.decode(s)):[]}}}case"nevent":{let i=a1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:dr(i[0][0]),relays:i[1]?i[1].map(s=>Ka.decode(s)):[],author:i[2]?.[0]?dr(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(dr(i[3][0]),16):void 0}}}case"naddr":{let i=a1(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ka.decode(i[0][0]),pubkey:dr(i[2][0]),kind:parseInt(dr(i[3][0]),16),relays:i[1]?i[1].map(s=>Ka.decode(s)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:dr(r)};default:throw new Error(`unknown prefix ${e}`)}}function a1(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function cJ(t){return cw("nsec",t)}function uJ(t){return cw("npub",rd(t))}function dJ(t){return cw("note",rd(t))}function lw(t,e){let n=Wf.toWords(e);return Wf.encode(t,n,DE)}function cw(t,e){return lw(t,e)}function fJ(t){let e=LE({0:[rd(t.pubkey)],1:(t.relays||[]).map(n=>uo.encode(n))});return lw("nprofile",e)}function hJ(t){let e;t.kind!==void 0&&(e=aJ(t.kind));let n=LE({0:[rd(t.id)],1:(t.relays||[]).map(r=>uo.encode(r)),2:t.author?[rd(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return lw("nevent",n)}function pJ(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=LE({0:[uo.encode(t.identifier)],1:(t.relays||[]).map(r=>uo.encode(r)),2:[rd(t.pubkey)],3:[new Uint8Array(e)]});return lw("naddr",n)}function LE(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)})}),nw(...e)}var mJ={};Bn(mJ,{decrypt:()=>gJ,encrypt:()=>ER});function ER(t,e,n){const r=t instanceof Uint8Array?dr(t):t,i=fh.getSharedSecret(r,"02"+e),s=TR(i);let o=Uint8Array.from(jN(16)),a=uo.encode(n),l=nR(s,o).encrypt(a),c=Jo.encode(new Uint8Array(l)),u=Jo.encode(new Uint8Array(o.buffer));return`${c}?iv=${u}`}function gJ(t,e,n){const r=t instanceof Uint8Array?dr(t):t;let[i,s]=n.split("?iv="),o=fh.getSharedSecret(r,"02"+e),a=TR(o),l=Jo.decode(s),c=Jo.decode(i),u=nR(a,l).decrypt(c);return Ka.decode(u)}function TR(t){return t.slice(1,33)}var yJ={};Bn(yJ,{NIP05_REGEX:()=>BE,isNip05:()=>bJ,isValid:()=>xJ,queryProfile:()=>CR,searchDomain:()=>vJ,useFetchImplementation:()=>wJ});var BE=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,bJ=t=>BE.test(t||""),uw;try{uw=fetch}catch{}function wJ(t){uw=t}async function vJ(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await uw(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function CR(t){const e=t.match(BE);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await uw(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function xJ(t,e){const n=await CR(e);return n?n.pubkey===t:!1}var SJ={};Bn(SJ,{parse:()=>kJ});function kJ(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,d={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=d;continue}if(c==="reply"){e.reply=d;continue}if(c==="mention"){e.mentions.push(d);continue}n?r=d:n=d,e.mentions.push(d);continue}if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),e.mentions.forEach(i=>{if(i.author){let s=e.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),e}var EJ={};Bn(EJ,{fetchRelayInformation:()=>CJ,useFetchImplementation:()=>TJ});var _R;try{_R=fetch}catch{}function TJ(t){_R=t}async function CJ(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var _J={};Bn(_J,{fastEventHash:()=>PR,getPow:()=>AR,minePow:()=>AJ});function AR(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function AJ(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=PR(r),AR(r.id)>=e)break}return r}function PR(t){return dr(Qc(uo.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var PJ={};Bn(PJ,{unwrapEvent:()=>UJ,unwrapManyEvents:()=>HJ,wrapEvent:()=>HR,wrapManyEvents:()=>zJ});var IJ={};Bn(IJ,{createRumor:()=>FR,createSeal:()=>$R,createWrap:()=>zR,unwrapEvent:()=>HE,unwrapManyEvents:()=>UR,wrapEvent:()=>dy,wrapManyEvents:()=>FJ});var OJ={};Bn(OJ,{decrypt:()=>UE,encrypt:()=>zE,getConversationKey:()=>FE,v2:()=>LJ});var IR=1,OR=65535;function FE(t,e){const n=fh.getSharedSecret(t,"02"+e).subarray(1,33);return hQ(Qc,n,"nip44-v2")}function MR(t,e){const n=pQ(Qc,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function $E(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function MJ(t){if(!Number.isSafeInteger(t)||t<IR||t>OR)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function NJ(t){const e=uo.encode(t),n=e.length,r=MJ(n),i=new Uint8Array($E(n)-n);return nw(r,e,i)}function RJ(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<IR||e>OR||n.length!==e||t.length!==2+$E(e))throw new Error("invalid padding");return Ka.decode(n)}function NR(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=nw(n,e);return iw(Qc,t,r)}function DJ(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=Jo.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function zE(t,e,n=jN(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=MR(e,n),o=NJ(t),a=oR(r,i,o),l=NR(s,a,n);return Jo.encode(nw(new Uint8Array([2]),n,a,l))}function UE(t,e){const{nonce:n,ciphertext:r,mac:i}=DJ(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=MR(e,n),l=NR(a,r,n);if(!GX(l,i))throw new Error("invalid MAC");const c=oR(s,o,r);return RJ(c)}var LJ={utils:{getConversationKey:FE,calcPaddedLen:$E},encrypt:zE,decrypt:UE},BJ=2880*60,RR=()=>Math.round(Date.now()/1e3),DR=()=>Math.round(RR()-Math.random()*BJ),LR=(t,e)=>FE(t,e),BR=(t,e,n)=>zE(JSON.stringify(t),LR(e,n)),PP=(t,e)=>JSON.parse(UE(t.content,LR(e,t.pubkey)));function FR(t,e){const n={created_at:RR(),content:"",tags:[],...t,pubkey:ow(e)};return n.id=u0(n),n}function $R(t,e,n){return la({kind:fR,content:BR(t,e,n),created_at:DR(),tags:[]},e)}function zR(t,e){const n=EQ();return la({kind:wR,content:BR(t,n,e),created_at:DR(),tags:[["p",e]]},n)}function dy(t,e,n){const r=FR(t,e),i=$R(r,e,n);return zR(i,n)}function FJ(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=ow(e),i=[dy(t,e,r)];return n.forEach(s=>{i.push(dy(t,e,s))}),i}function HE(t,e){const n=PP(t,e);return PP(n,e)}function UR(t,e){let n=[];return t.forEach(r=>{n.push(HE(r,e))}),n.sort((r,i)=>r.created_at-i.created_at),n}function $J(t,e,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:hR,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function HR(t,e,n,r,i){const s=$J(e,n,r,i);return dy(s,t,e.publicKey)}function zJ(t,e,n,r,i){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:ow(t)},...e].map(o=>HR(t,o,n,r,i))}var UJ=HE,HJ=UR,VJ={};Bn(VJ,{finishRepostEvent:()=>WJ,getRepostedEvent:()=>jJ,getRepostedEventPointer:()=>VR});function WJ(t,e,n,r){let i;const s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===dR?i=IE:(i=ME,s.push(["k",String(e.kind)])),la({kind:i,tags:s,content:t.content===""||e.tags?.find(o=>o[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function VR(t){if(![IE,ME].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(e!==void 0)return{id:e[1],relays:[e[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function jJ(t,{skipVerification:e}={}){const n=VR(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!_E(r)))return r}var qJ={};Bn(qJ,{NOSTR_URI_REGEX:()=>VE,parse:()=>GJ,test:()=>KJ});var VE=new RegExp(`nostr:(${kR.source})`);function KJ(t){return typeof t=="string"&&new RegExp(`^${VE.source}$`).test(t)}function GJ(t){const e=t.match(new RegExp(`^${VE.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:aw(e[1])}}var ZJ={};Bn(ZJ,{finishReactionEvent:()=>XJ,getReactedEventPointer:()=>QJ});function XJ(t,e,n){const r=e.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return la({...t,kind:OE,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function QJ(t){if(t.kind!==OE)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var YJ={};Bn(YJ,{parse:()=>eee});var IP=/\W/m,OP=/[^\w\/] |[^\w\/]$|$|,| /m,JJ=42;function*eee(t){let e=[];if(typeof t!="string"){for(let s=0;s<t.tags.length;s++){const o=t.tags[s];o[0]==="emoji"&&o.length>=3&&e.push({type:"emoji",shortcode:o[1],url:o[2]})}t=t.content}const n=t.length;let r=0,i=0;e:for(;i<n;){const s=t.indexOf(":",i),o=t.indexOf("#",i);if(s===-1&&o===-1)break e;if(s===-1||o>=0&&o<s){if(o===0||t[o-1]===" "){const a=t.slice(o+1,o+JJ).match(IP),l=a?o+1+a.index:n;yield{type:"text",text:t.slice(r,o)},yield{type:"hashtag",value:t.slice(o+1,l)},i=l,r=i;continue e}i=o+1;continue e}if(t.slice(s-5,s)==="nostr"){const a=t.slice(s+60).match(IP),l=a?s+60+a.index:n;try{let c,{data:u,type:d}=aw(t.slice(s+1,l));switch(d){case"npub":c={pubkey:u};break;case"note":c={id:u};break;case"nsec":i=l+1;continue;default:c=u}r!==s-5&&(yield{type:"text",text:t.slice(r,s-5)}),yield{type:"reference",pointer:c},i=l,r=i;continue e}catch{i=s+1;continue e}}else if(t.slice(s-5,s)==="https"||t.slice(s-4,s)==="http"){const a=t.slice(s+4).match(OP),l=a?s+4+a.index:n,c=t[s-1]==="s"?5:4;try{let u=new URL(t.slice(s-c,l));if(u.hostname.indexOf(".")===-1)throw new Error("invalid url");if(r!==s-c&&(yield{type:"text",text:t.slice(r,s-c)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(u.pathname)){yield{type:"image",url:u.toString()},i=l,r=i;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(u.pathname)){yield{type:"video",url:u.toString()},i=l,r=i;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(u.pathname)){yield{type:"audio",url:u.toString()},i=l,r=i;continue e}yield{type:"url",url:u.toString()},i=l,r=i;continue e}catch{i=l+1;continue e}}else if(t.slice(s-3,s)==="wss"||t.slice(s-2,s)==="ws"){const a=t.slice(s+4).match(OP),l=a?s+4+a.index:n,c=t[s-1]==="s"?3:2;try{let u=new URL(t.slice(s-c,l));if(u.hostname.indexOf(".")===-1)throw new Error("invalid ws url");r!==s-c&&(yield{type:"text",text:t.slice(r,s-c)}),yield{type:"relay",url:u.toString()},i=l,r=i;continue e}catch{i=l+1;continue e}}else{for(let a=0;a<e.length;a++){const l=e[a];if(t[s+l.shortcode.length+1]===":"&&t.slice(s+1,s+l.shortcode.length+1)===l.shortcode){r!==s&&(yield{type:"text",text:t.slice(r,s)}),yield l,i=s+l.shortcode.length+2,r=i;continue e}}i=s+1;continue e}}r!==n&&(yield{type:"text",text:t.slice(r)})}var tee={};Bn(tee,{channelCreateEvent:()=>nee,channelHideMessageEvent:()=>see,channelMessageEvent:()=>iee,channelMetadataEvent:()=>ree,channelMuteUserEvent:()=>oee});var nee=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return la({kind:pR,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},ree=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return la({kind:mR,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},iee=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),la({kind:gR,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},see=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return la({kind:yR,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},oee=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return la({kind:bR,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},aee={};Bn(aee,{EMOJI_SHORTCODE_REGEX:()=>WR,matchAll:()=>lee,regex:()=>WE,replaceAll:()=>cee});var WR=/:(\w+):/,WE=()=>new RegExp(`\\B${WR.source}\\B`,"g");function*lee(t){const e=t.matchAll(WE());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function cee(t,e){return t.replaceAll(WE(),(n,r)=>e({shortcode:n,name:r}))}var uee={};Bn(uee,{useFetchImplementation:()=>dee,validateGithub:()=>fee});var jE;try{jE=fetch}catch{}function dee(t){jE=t}async function fee(t,e,n){try{return await(await jE(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var hee={};Bn(hee,{makeNwcRequestEvent:()=>mee,parseConnectionString:()=>pee});function pee(t){const{host:e,pathname:n,searchParams:r}=new URL(t),i=n||e,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function mee(t,e,n){const i=ER(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:xR,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return la(s,e)}var gee={};Bn(gee,{normalizeIdentifier:()=>yee});function yee(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var bee={};Bn(bee,{getSatoshisAmountFromBolt11:()=>Eee,getZapEndpoint:()=>vee,makeZapReceipt:()=>kee,makeZapRequest:()=>xee,useFetchImplementation:()=>wee,validateZapRequest:()=>See});var qE;try{qE=fetch}catch{}function wee(t){qE=t}async function vee(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(r){let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else if(n){let{words:o}=Wf.decode(n,1e3),a=Wf.fromWords(o);e=Ka.decode(a)}else return null;let s=await(await qE(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function xee(t){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:t.comment||"",tags:[["p","pubkey"in t?t.pubkey:t.event.pubkey],["amount",t.amount.toString()],["relays",...t.relays]]};if("event"in t){if(e.tags.push(["e",t.event.id]),AE(t.event.kind)){const n=["a",`${t.event.kind}:${t.event.pubkey}:`];e.tags.push(n)}else if(PE(t.event.kind)){let n=t.event.tags.find(([i,s])=>i==="d"&&s);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${t.event.kind}:${t.event.pubkey}:${n[1]}`];e.tags.push(r)}e.tags.push(["k",t.event.kind.toString()])}return e}function See(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!TE(e))return"Zap request is not a valid Nostr event.";if(!_E(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function kee({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}function Eee(t){if(t.length<50)return 0;t=t.substring(0,50);const e=t.lastIndexOf("1");if(e===-1)return 0;const n=t.substring(0,e);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const l=parseInt(r.substring(0,a));switch(i){case"m":return l*1e5;case"u":return l*100;case"n":return l/10;case"p":return l/1e4;default:return l*1e8}}var Tee={};Bn(Tee,{Negentropy:()=>qR,NegentropyStorageVector:()=>Aee,NegentropySync:()=>Pee});var l1=97,bf=32,jR=16,uu={Skip:0,Fingerprint:1,IdList:2},Ua=class{_raw;length;constructor(t){typeof t=="number"?(this._raw=new Uint8Array(t),this.length=0):t instanceof Uint8Array?(this._raw=new Uint8Array(t),this.length=t.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(t){if(t instanceof Ua&&(t=t.unwrap()),typeof t.length!="number")throw Error("bad length");const e=t.length+this.length;if(this.capacity<e){const n=this._raw,r=Math.max(this.capacity*2,e);this._raw=new Uint8Array(r),this._raw.set(n)}this._raw.set(t,this.length),this.length+=t.length}shift(){const t=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,t}shiftN(t=1){const e=this._raw.subarray(0,t);return this._raw=this._raw.subarray(t),this.length-=t,e}};function Og(t){let e=0;for(;;){if(t.length===0)throw Error("parse ends prematurely");let n=t.shift();if(e=e<<7|n&127,(n&128)===0)break}return e}function Ea(t){if(t===0)return new Ua(new Uint8Array([0]));let e=[];for(;t!==0;)e.push(t&127),t>>>=7;e.reverse();for(let n=0;n<e.length-1;n++)e[n]|=128;return new Ua(new Uint8Array(e))}function Cee(t){return d0(t,1)[0]}function d0(t,e){if(t.length<e)throw Error("parse ends prematurely");return t.shiftN(e)}var _ee=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(bf)}add(t){let e=0,n=0,r=new DataView(this.buf.buffer),i=new DataView(t.buffer);for(let s=0;s<8;s++){let o=s*4,a=r.getUint32(o,!0),l=i.getUint32(o,!0),c=a;c+=e,c+=l,c>4294967295&&(n=1),r.setUint32(o,c&4294967295,!0),e=n,n=0}}negate(){let t=new DataView(this.buf.buffer);for(let n=0;n<8;n++){let r=n*4;t.setUint32(r,~t.getUint32(r,!0))}let e=new Uint8Array(bf);e[0]=1,this.add(e)}getFingerprint(t){let e=new Ua;return e.extend(this.buf),e.extend(Ea(t)),Qc(e.unwrap()).subarray(0,jR)}},Aee=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(t,e){if(this.sealed)throw Error("already sealed");const n=QN(e);if(n.byteLength!==bf)throw Error("bad id size for added item");this.items.push({timestamp:t,id:n})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(c1);for(let t=1;t<this.items.length;t++)if(c1(this.items[t-1],this.items[t])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(t){if(this._checkSealed(),t>=this.items.length)throw Error("out of range");return this.items[t]}iterate(t,e,n){this._checkSealed(),this._checkBounds(t,e);for(let r=t;r<e&&n(this.items[r],r);++r);}findLowerBound(t,e,n){return this._checkSealed(),this._checkBounds(t,e),this._binarySearch(this.items,t,e,r=>c1(r,n)<0)}fingerprint(t,e){let n=new _ee;return n.setToZero(),this.iterate(t,e,r=>(n.add(r.id),!0)),n.getFingerprint(e-t)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(t,e){if(t>e||e>this.items.length)throw Error("bad range")}_binarySearch(t,e,n,r){let i=n-e;for(;i>0;){let s=e,o=Math.floor(i/2);s+=o,r(t[s])?(e=++s,i-=o+1):i=o}return e}},qR=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(t,e=6e4){if(e<4096)throw Error("frameSizeLimit too small");this.storage=t,this.frameSizeLimit=e,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(t,e){return{timestamp:t,id:e||new Uint8Array(0)}}initiate(){let t=new Ua;return t.extend(new Uint8Array([l1])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),t),Id(t.unwrap())}reconcile(t,e,n){const r=new Ua(QN(t));this.lastTimestampIn=this.lastTimestampOut=0;let i=new Ua;i.extend(new Uint8Array([l1]));let s=Cee(r);if(s<96||s>111)throw Error("invalid negentropy protocol version byte");if(s!==l1)throw Error("unsupported negentropy protocol version requested: "+(s-96));let o=this.storage.size(),a=this._bound(0),l=0,c=!1;for(;r.length!==0;){let u=new Ua,d=()=>{c&&(c=!1,u.extend(this.encodeBound(a)),u.extend(Ea(uu.Skip)))},f=this.decodeBound(r),h=Og(r),p=l,m=this.storage.findLowerBound(l,o,f);if(h===uu.Skip)c=!0;else if(h===uu.Fingerprint){let g=d0(r,jR),y=this.storage.fingerprint(p,m);KR(g,y)!==0?(d(),this.splitRange(p,m,f,u)):c=!0}else if(h===uu.IdList){let g=Og(r),y={};for(let b=0;b<g;b++){let S=d0(r,bf);y[Id(S)]=S}if(c=!0,this.storage.iterate(p,m,b=>{let S=b.id;const C=Id(S);return y[C]?delete y[Id(S)]:e?.(C),!0}),n)for(let b of Object.values(y))n(Id(b))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(i.length+u.length)){let g=this.storage.fingerprint(m,o);i.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),i.extend(Ea(uu.Fingerprint)),i.extend(g);break}else i.extend(u);l=m,a=f}return i.length===1?null:Id(i.unwrap())}splitRange(t,e,n,r){let i=e-t,s=16;if(i<s*2)r.extend(this.encodeBound(n)),r.extend(Ea(uu.IdList)),r.extend(Ea(i)),this.storage.iterate(t,e,o=>(r.extend(o.id),!0));else{let o=Math.floor(i/s),a=i%s,l=t;for(let c=0;c<s;c++){let u=o+(c<a?1:0),d=this.storage.fingerprint(l,l+u);l+=u;let f;if(l===e)f=n;else{let h,p;this.storage.iterate(l-1,l+1,(m,g)=>(g===l-1?h=m:p=m,!0)),f=this.getMinimalBound(h,p)}r.extend(this.encodeBound(f)),r.extend(Ea(uu.Fingerprint)),r.extend(d)}}}exceededFrameSizeLimit(t){return t>this.frameSizeLimit-200}decodeTimestampIn(t){let e=Og(t);return e=e===0?Number.MAX_VALUE:e-1,this.lastTimestampIn===Number.MAX_VALUE||e===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(e+=this.lastTimestampIn,this.lastTimestampIn=e,e)}decodeBound(t){let e=this.decodeTimestampIn(t),n=Og(t);if(n>bf)throw Error("bound key too long");let r=d0(t,n);return{timestamp:e,id:r}}encodeTimestampOut(t){if(t===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,Ea(0);let e=t;return t-=this.lastTimestampOut,this.lastTimestampOut=e,Ea(t+1)}encodeBound(t){let e=new Ua;return e.extend(this.encodeTimestampOut(t.timestamp)),e.extend(Ea(t.id.length)),e.extend(t.id),e}getMinimalBound(t,e){if(e.timestamp!==t.timestamp)return this._bound(e.timestamp);{let n=0,r=e.id,i=t.id;for(let s=0;s<bf&&r[s]===i[s];s++)n++;return this._bound(e.timestamp,e.id.subarray(0,n+1))}}};function KR(t,e){for(let n=0;n<t.byteLength;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}function c1(t,e){return t.timestamp===e.timestamp?KR(t.id,e.id):t.timestamp-e.timestamp}var Pee=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(t,e,n,r={}){this.relay=t,this.storage=e,this.neg=new qR(e),this.onhave=r.onhave,this.onneed=r.onneed,this.filter=n,this.subscription=this.relay.prepareSubscription([{}],{label:r.label||"negentropy"}),this.subscription.oncustom=i=>{switch(i[0]){case"NEG-MSG":{i.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${i}`);try{const s=this.neg.reconcile(i[2],this.onhave,this.onneed);s?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${s}"]`):(this.close(),r.onclose?.())}catch(s){console.error("negentropy reconcile error:",s),r?.onclose?.(`reconcile error: ${s}`)}break}case"NEG-CLOSE":{const s=i[2];console.warn("negentropy error:",s),r.onclose?.(s);break}case"NEG-ERR":r.onclose?.()}}}async start(){const t=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${t}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},Iee={};Bn(Iee,{getToken:()=>Oee,hashPayload:()=>KE,unpackEventFromToken:()=>ZR,validateEvent:()=>tD,validateEventKind:()=>QR,validateEventMethodTag:()=>JR,validateEventPayloadTag:()=>eD,validateEventTimestamp:()=>XR,validateEventUrlTag:()=>YR,validateToken:()=>Mee});var GR="Nostr ";async function Oee(t,e,n,r=!1,i){const s={kind:NE,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",KE(i)]);const o=await n(s);return(r?GR:"")+Jo.encode(uo.encode(JSON.stringify(o)))}async function Mee(t,e,n){const r=await ZR(t).catch(s=>{throw s});return await tD(r,e,n).catch(s=>{throw s})}async function ZR(t){if(!t)throw new Error("Missing token");t=t.replace(GR,"");const e=Ka.decode(Jo.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function XR(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function QR(t){return t.kind===NE}function YR(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function JR(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function KE(t){const e=Qc(uo.encode(JSON.stringify(t)));return dr(e)}function eD(t,e){const n=t.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=KE(e);return n.length>0&&n[1]===r}async function tD(t,e,n,r){if(!_E(t))throw new Error("Invalid nostr event, signature invalid");if(!QR(t))throw new Error("Invalid nostr event, kind invalid");if(!XR(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!YR(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!JR(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!eD(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function Nee(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t;let a,l,c;const u=async(f=!0)=>{await l,c?.()};async function d(){if("serviceWorker"in navigator){if(a=await Hb(async()=>{const{Workbox:f}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:f}},[]).then(({Workbox:f})=>new f("/ehagaki/sw.js",{scope:"/ehagaki/",type:"classic"})).catch(f=>{o?.(f)}),!a)return;c=()=>{a?.messageSkipWaiting()};{let f=!1;const h=()=>{f=!0,a?.addEventListener("controlling",p=>{p.isUpdate&&window.location.reload()}),n?.()};a.addEventListener("installed",p=>{typeof p.isUpdate>"u"?typeof p.isExternal<"u"&&p.isExternal?h():!f&&r?.():p.isUpdate||r?.()}),a.addEventListener("waiting",h)}a.register({immediate:e}).then(f=>{s?s("/ehagaki/sw.js",f):i?.(f)}).catch(f=>{o?.(f)})}}return l=d(),u}function MP(t={}){const{immediate:e=!0,onNeedRefresh:n,onOfflineReady:r,onRegistered:i,onRegisteredSW:s,onRegisterError:o}=t,a=Ds(!1),l=Ds(!1),c=Nee({immediate:e,onOfflineReady(){l.set(!0),r?.()},onNeedRefresh(){a.set(!0),n?.()},onRegistered:i,onRegisteredSW:s,onRegisterError:o});return{needRefresh:a,offlineReady:l,updateServiceWorker:c}}function W(t){if(!t)throw new Error("Assertion failed.")}const GE=t=>{const e=(t%360+360)%360;if(e===0||e===90||e===180||e===270)return e;throw new Error(`Invalid rotation ${t}.`)},Wn=t=>t&&t[t.length-1],jf=t=>t>=0&&t<2**32;class Ln{constructor(e){this.bytes=e,this.pos=0}seekToByte(e){this.pos=8*e}readBit(){const e=Math.floor(this.pos/8),n=this.bytes[e]??0,r=7-(this.pos&7),i=(n&1<<r)>>r;return this.pos++,i}readBits(e){if(e===1)return this.readBit();let n=0;for(let r=0;r<e;r++)n<<=1,n|=this.readBit();return n}writeBits(e,n){const r=this.pos+e;for(let i=this.pos;i<r;i++){const s=Math.floor(i/8);let o=this.bytes[s];const a=7-(i&7);o&=~(1<<a),o|=(n&1<<r-i-1)>>r-i-1<<a,this.bytes[s]=o}this.pos=r}readAlignedByte(){if(this.pos%8!==0)throw new Error("Bitstream is not byte-aligned.");const e=this.pos/8,n=this.bytes[e]??0;return this.pos+=8,n}skipBits(e){this.pos+=e}getBitsLeft(){return this.bytes.length*8-this.pos}clone(){const e=new Ln(this.bytes);return e.pos=this.pos,e}}const Ye=t=>{let e=0;for(;t.readBits(1)===0&&e<32;)e++;if(e>=32)throw new Error("Invalid exponential-Golomb code.");return(1<<e)-1+t.readBits(e)},Ga=t=>{const e=Ye(t);return(e&1)===0?-(e>>1):e+1>>1},hs=t=>t.constructor===Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t),jn=t=>t.constructor===DataView?t:ArrayBuffer.isView(t)?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(t),zs=new TextDecoder,Vo=new TextEncoder,ZE=t=>Object.fromEntries(Object.entries(t).map(([e,n])=>[n,e])),jm={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},fy=ZE(jm),qm={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pq:16,hlg:18},hy=ZE(qm),Km={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},py=ZE(Km),Ree=t=>!!t&&!!t.primaries&&!!t.transfer&&!!t.matrix&&t.fullRange!==void 0,dw=t=>t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer||ArrayBuffer.isView(t);class yd{constructor(){this.currentPromise=Promise.resolve(),this.pending=0}async acquire(){let e;const n=new Promise(i=>{let s=!1;e=()=>{s||(i(),this.pending--,s=!0)}}),r=this.currentPromise;return this.currentPromise=n,this.pending++,await r,e}}const NP=t=>[...t].map(e=>e.toString(16).padStart(2,"0")).join(""),RP=t=>(t=t>>1&1431655765|(t&1431655765)<<1,t=t>>2&858993459|(t&858993459)<<2,t=t>>4&252645135|(t&252645135)<<4,t=t>>8&16711935|(t&16711935)<<8,t=t>>16&65535|(t&65535)<<16,t>>>0),Gm=(t,e,n)=>{let r=0,i=t.length-1,s=-1;for(;r<=i;){const o=r+i>>1,a=n(t[o]);a===e?(s=o,i=o-1):a<e?r=o+1:i=o-1}return s},fn=(t,e,n)=>{let r=0,i=t.length-1,s=-1;for(;r<=i;){const o=r+(i-r+1)/2|0;n(t[o])<=e?(s=o,r=o+1):i=o-1}return s},DP=(t,e,n)=>{const r=fn(t,n(e),n);t.splice(r+1,0,e)},ai=()=>{let t,e;return{promise:new Promise((r,i)=>{t=r,e=i}),resolve:t,reject:e}},nD=(t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n]))return t[n]},XE=(t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n]))return n;return-1},Dee=async function*(t){Symbol.iterator in t?yield*t[Symbol.iterator]():yield*t[Symbol.asyncIterator]()},Lee=t=>{if(!(Symbol.iterator in t)&&!(Symbol.asyncIterator in t))throw new TypeError("Argument must be an iterable or async iterable.")},Hc=t=>{throw new Error(`Unexpected value: ${t}`)},fw=(t,e,n)=>{const r=t.getUint8(e),i=t.getUint8(e+1),s=t.getUint8(e+2);return n?r|i<<8|s<<16:r<<16|i<<8|s},Bee=(t,e,n)=>fw(t,e,n)<<8>>8,QE=(t,e,n,r)=>{n=n>>>0,n=n&16777215,r?(t.setUint8(e,n&255),t.setUint8(e+1,n>>>8&255),t.setUint8(e+2,n>>>16&255)):(t.setUint8(e,n>>>16&255),t.setUint8(e+1,n>>>8&255),t.setUint8(e+2,n&255))},Fee=(t,e,n,r)=>{n=zr(n,-8388608,8388607),n<0&&(n=n+16777216&16777215),QE(t,e,n,r)},LP=(t,e)=>({async next(){const n=await t.next();return n.done?{value:void 0,done:!0}:{value:e(n.value),done:!1}},return(){return t.return()},throw(n){return t.throw(n)},[Symbol.asyncIterator](){return this}}),zr=(t,e,n)=>Math.max(e,Math.min(n,t)),cs="und",tm=t=>{const e=Math.round(t);return Math.abs(t/e-1)<10*Number.EPSILON?e:t},rD=(t,e)=>Math.round(t/e)*e,$ee=t=>{let e=0;for(;t;)e++,t>>=1;return e},zee=/^[a-z]{3}$/,nm=t=>zee.test(t),pc=1e6*(1+Number.EPSILON),Uee=(t,e)=>{const n=t<0?-1:1;t=Math.abs(t);let r=0,i=1,s=1,o=0,a=t;for(;;){const l=Math.floor(a),c=l*s+r,u=l*o+i;if(u>e)return{numerator:n*s,denominator:o};if(r=s,i=o,s=c,o=u,a=1/(a-l),!isFinite(a))break}return{numerator:n*s,denominator:o}};class hw{constructor(){this.currentPromise=Promise.resolve()}call(e){return this.currentPromise=this.currentPromise.then(e)}}let u1=null;const Sp=()=>u1!==null?u1:u1=!!(typeof navigator<"u"&&(navigator.vendor?.match(/apple/i)||/AppleWebKit/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)||/\b(iPad|iPhone|iPod)\b/.test(navigator.userAgent)));let d1=null;const qf=()=>d1!==null?d1:d1=typeof navigator<"u"&&navigator.userAgent?.includes("Firefox");let f1=null;const $x=()=>f1!==null?f1:f1=!!(typeof navigator<"u"&&(navigator.vendor?.includes("Google Inc")||/Chrome/.test(navigator.userAgent)));let h1=null;const Hee=()=>{if(h1!==null)return h1;if(typeof navigator>"u")return null;const t=/\bChrome\/(\d+)/.exec(navigator.userAgent);return t?h1=Number(t[1]):null},zd=(t,e)=>t!==-1?t:e,BP=(t,e,n,r)=>t<=r&&n<=e,iD=function*(t){for(const e in t){const n=t[e];n!==void 0&&(yield{key:e,value:n})}},Vee=t=>{const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},sD=()=>{Symbol.dispose??=Symbol("Symbol.dispose")},oD=t=>typeof t=="number"&&!Number.isNaN(t);class wf{constructor(e,n){if(this.data=e,this.mimeType=n,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(typeof n!="string")throw new TypeError("mimeType must be a string.")}}class aD{constructor(e,n,r,i){if(this.data=e,this.mimeType=n,this.name=r,this.description=i,!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(n!==void 0&&typeof n!="string")throw new TypeError("mimeType, when provided, must be a string.");if(r!==void 0&&typeof r!="string")throw new TypeError("name, when provided, must be a string.");if(i!==void 0&&typeof i!="string")throw new TypeError("description, when provided, must be a string.")}}const zx=t=>{if(!t||typeof t!="object")throw new TypeError("tags must be an object.");if(t.title!==void 0&&typeof t.title!="string")throw new TypeError("tags.title, when provided, must be a string.");if(t.description!==void 0&&typeof t.description!="string")throw new TypeError("tags.description, when provided, must be a string.");if(t.artist!==void 0&&typeof t.artist!="string")throw new TypeError("tags.artist, when provided, must be a string.");if(t.album!==void 0&&typeof t.album!="string")throw new TypeError("tags.album, when provided, must be a string.");if(t.albumArtist!==void 0&&typeof t.albumArtist!="string")throw new TypeError("tags.albumArtist, when provided, must be a string.");if(t.trackNumber!==void 0&&(!Number.isInteger(t.trackNumber)||t.trackNumber<=0))throw new TypeError("tags.trackNumber, when provided, must be a positive integer.");if(t.tracksTotal!==void 0&&(!Number.isInteger(t.tracksTotal)||t.tracksTotal<=0))throw new TypeError("tags.tracksTotal, when provided, must be a positive integer.");if(t.discNumber!==void 0&&(!Number.isInteger(t.discNumber)||t.discNumber<=0))throw new TypeError("tags.discNumber, when provided, must be a positive integer.");if(t.discsTotal!==void 0&&(!Number.isInteger(t.discsTotal)||t.discsTotal<=0))throw new TypeError("tags.discsTotal, when provided, must be a positive integer.");if(t.genre!==void 0&&typeof t.genre!="string")throw new TypeError("tags.genre, when provided, must be a string.");if(t.date!==void 0&&(!(t.date instanceof Date)||Number.isNaN(t.date.getTime())))throw new TypeError("tags.date, when provided, must be a valid Date.");if(t.lyrics!==void 0&&typeof t.lyrics!="string")throw new TypeError("tags.lyrics, when provided, must be a string.");if(t.images!==void 0){if(!Array.isArray(t.images))throw new TypeError("tags.images, when provided, must be an array.");for(const e of t.images){if(!e||typeof e!="object")throw new TypeError("Each image in tags.images must be an object.");if(!(e.data instanceof Uint8Array))throw new TypeError("Each image.data must be a Uint8Array.");if(typeof e.mimeType!="string")throw new TypeError("Each image.mimeType must be a string.");if(!["coverFront","coverBack","unknown"].includes(e.kind))throw new TypeError("Each image.kind must be 'coverFront', 'coverBack', or 'unknown'.")}}if(t.comment!==void 0&&typeof t.comment!="string")throw new TypeError("tags.comment, when provided, must be a string.");if(t.raw!==void 0){if(!t.raw||typeof t.raw!="object")throw new TypeError("tags.raw, when provided, must be an object.");for(const e of Object.values(t.raw))if(e!==null&&typeof e!="string"&&!(e instanceof Uint8Array)&&!(e instanceof wf)&&!(e instanceof aD))throw new TypeError("Each value in tags.raw must be a string, Uint8Array, RichImageData, AttachedFile, or null.")}},Jc={default:!0,forced:!1,original:!1,commentary:!1,hearingImpaired:!1,visuallyImpaired:!1},Wee=t=>{if(!t||typeof t!="object")throw new TypeError("disposition must be an object.");if(t.default!==void 0&&typeof t.default!="boolean")throw new TypeError("disposition.default must be a boolean.");if(t.forced!==void 0&&typeof t.forced!="boolean")throw new TypeError("disposition.forced must be a boolean.");if(t.original!==void 0&&typeof t.original!="boolean")throw new TypeError("disposition.original must be a boolean.");if(t.commentary!==void 0&&typeof t.commentary!="boolean")throw new TypeError("disposition.commentary must be a boolean.");if(t.hearingImpaired!==void 0&&typeof t.hearingImpaired!="boolean")throw new TypeError("disposition.hearingImpaired must be a boolean.");if(t.visuallyImpaired!==void 0&&typeof t.visuallyImpaired!="boolean")throw new TypeError("disposition.visuallyImpaired must be a boolean.")};const ea=["avc","hevc","vp9","av1","vp8"],Pi=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],kp=["aac","opus","mp3","vorbis","flac"],ta=[...kp,...Pi],my=["webvtt"],gy=[{maxMacroblocks:99,maxBitrate:64e3,maxDpbMbs:396,level:10},{maxMacroblocks:396,maxBitrate:192e3,maxDpbMbs:900,level:11},{maxMacroblocks:396,maxBitrate:384e3,maxDpbMbs:2376,level:12},{maxMacroblocks:396,maxBitrate:768e3,maxDpbMbs:2376,level:13},{maxMacroblocks:396,maxBitrate:2e6,maxDpbMbs:2376,level:20},{maxMacroblocks:792,maxBitrate:4e6,maxDpbMbs:4752,level:21},{maxMacroblocks:1620,maxBitrate:4e6,maxDpbMbs:8100,level:22},{maxMacroblocks:1620,maxBitrate:1e7,maxDpbMbs:8100,level:30},{maxMacroblocks:3600,maxBitrate:14e6,maxDpbMbs:18e3,level:31},{maxMacroblocks:5120,maxBitrate:2e7,maxDpbMbs:20480,level:32},{maxMacroblocks:8192,maxBitrate:2e7,maxDpbMbs:32768,level:40},{maxMacroblocks:8192,maxBitrate:5e7,maxDpbMbs:32768,level:41},{maxMacroblocks:8704,maxBitrate:5e7,maxDpbMbs:34816,level:42},{maxMacroblocks:22080,maxBitrate:135e6,maxDpbMbs:110400,level:50},{maxMacroblocks:36864,maxBitrate:24e7,maxDpbMbs:184320,level:51},{maxMacroblocks:36864,maxBitrate:24e7,maxDpbMbs:184320,level:52},{maxMacroblocks:139264,maxBitrate:24e7,maxDpbMbs:696320,level:60},{maxMacroblocks:139264,maxBitrate:48e7,maxDpbMbs:696320,level:61},{maxMacroblocks:139264,maxBitrate:8e8,maxDpbMbs:696320,level:62}],FP=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:35651584,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:35651584,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:35651584,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:186}],mc=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:35651584,maxBitrate:18e7,level:60},{maxPictureSize:35651584,maxBitrate:24e7,level:61},{maxPictureSize:35651584,maxBitrate:48e7,level:62}],$P=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:35651584,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:35651584,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:35651584,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:35651584,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:35651584,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:35651584,maxBitrate:8e8,tier:"H",level:19}],zP=".01.01.01.01.00",UP=".0.110.01.01.01.0",jee=(t,e,n,r)=>{if(t==="avc"){const s=Math.ceil(e/16)*Math.ceil(n/16),o=gy.find(d=>s<=d.maxMacroblocks&&r<=d.maxBitrate)??Wn(gy),a=o?o.level:0,l="64".padStart(2,"0"),c="00",u=a.toString(16).padStart(2,"0");return`avc1.${l}${c}${u}`}else if(t==="hevc"){const a=e*n,l=FP.find(u=>a<=u.maxPictureSize&&r<=u.maxBitrate)??Wn(FP);return`hev1.1.6.${l.tier}${l.level}.B0`}else{if(t==="vp8")return"vp8";if(t==="vp9"){const s=e*n;return`vp09.00.${(mc.find(l=>s<=l.maxPictureSize&&r<=l.maxBitrate)??Wn(mc)).level.toString().padStart(2,"0")}.08`}else if(t==="av1"){const s=e*n,o=$P.find(c=>s<=c.maxPictureSize&&r<=c.maxBitrate)??Wn($P);return`av01.0.${o.level.toString().padStart(2,"0")}${o.tier}.08`}}throw new TypeError(`Unhandled codec '${t}'.`)},qee=t=>{const e=t.split("."),i=(1<<7)+1,s=Number(e[1]),o=e[2],a=Number(o.slice(0,-1)),l=(s<<5)+a,c=o.slice(-1)==="H"?1:0,d=Number(e[3])===8?0:1,f=0,h=e[4]?Number(e[4]):0,p=e[5]?Number(e[5][0]):1,m=e[5]?Number(e[5][1]):1,g=e[5]?Number(e[5][2]):0,y=(c<<7)+(d<<6)+(f<<5)+(h<<4)+(p<<3)+(m<<2)+g;return[i,l,y,0]},YE=t=>{const{codec:e,codecDescription:n,colorSpace:r,avcCodecInfo:i,hevcCodecInfo:s,vp9CodecInfo:o,av1CodecInfo:a}=t;if(e==="avc"){if(W(t.avcType!==null),i){const l=new Uint8Array([i.avcProfileIndication,i.profileCompatibility,i.avcLevelIndication]);return`avc${t.avcType}.${NP(l)}`}if(!n||n.byteLength<4)throw new TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return`avc${t.avcType}.${NP(n.subarray(1,4))}`}else if(e==="hevc"){let l,c,u,d,f,h;if(s)l=s.generalProfileSpace,c=s.generalProfileIdc,u=RP(s.generalProfileCompatibilityFlags),d=s.generalTierFlag,f=s.generalLevelIdc,h=[...s.generalConstraintIndicatorFlags];else{if(!n||n.byteLength<23)throw new TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");const m=jn(n),g=m.getUint8(1);l=g>>6&3,c=g&31,u=RP(m.getUint32(2)),d=g>>5&1,f=m.getUint8(12),h=[];for(let y=0;y<6;y++)h.push(m.getUint8(6+y))}let p="hev1.";for(p+=["","A","B","C"][l]+c,p+=".",p+=u.toString(16).toUpperCase(),p+=".",p+=d===0?"L":"H",p+=f;h.length>0&&h[h.length-1]===0;)h.pop();return h.length>0&&(p+=".",p+=h.map(m=>m.toString(16).toUpperCase()).join(".")),p}else{if(e==="vp8")return"vp8";if(e==="vp9"){if(!o){const y=t.width*t.height;let b=Wn(mc).level;for(const S of mc)if(y<=S.maxPictureSize){b=S.level;break}return`vp09.00.${b.toString().padStart(2,"0")}.08`}const l=o.profile.toString().padStart(2,"0"),c=o.level.toString().padStart(2,"0"),u=o.bitDepth.toString().padStart(2,"0"),d=o.chromaSubsampling.toString().padStart(2,"0"),f=o.colourPrimaries.toString().padStart(2,"0"),h=o.transferCharacteristics.toString().padStart(2,"0"),p=o.matrixCoefficients.toString().padStart(2,"0"),m=o.videoFullRangeFlag.toString().padStart(2,"0");let g=`vp09.${l}.${c}.${u}.${d}`;return g+=`.${f}.${h}.${p}.${m}`,g.endsWith(zP)&&(g=g.slice(0,-zP.length)),g}else if(e==="av1"){if(!a){const S=t.width*t.height;let C=Wn(mc).level;for(const _ of mc)if(S<=_.maxPictureSize){C=_.level;break}return`av01.0.${C.toString().padStart(2,"0")}M.08`}const l=a.profile,c=a.level.toString().padStart(2,"0"),u=a.tier?"H":"M",d=a.bitDepth.toString().padStart(2,"0"),f=a.monochrome?"1":"0",h=100*a.chromaSubsamplingX+10*a.chromaSubsamplingY+1*(a.chromaSubsamplingX&&a.chromaSubsamplingY?a.chromaSamplePosition:0),p=r?.primaries?jm[r.primaries]:1,m=r?.transfer?qm[r.transfer]:1,g=r?.matrix?Km[r.matrix]:1,y=r?.fullRange?1:0;let b=`av01.${l}.${c}${u}.${d}`;return b+=`.${f}.${h.toString().padStart(3,"0")}`,b+=`.${p.toString().padStart(2,"0")}`,b+=`.${m.toString().padStart(2,"0")}`,b+=`.${g.toString().padStart(2,"0")}`,b+=`.${y}`,b.endsWith(UP)&&(b=b.slice(0,-UP.length)),b}}throw new TypeError(`Unhandled codec '${e}'.`)},Kee=(t,e,n)=>{if(t==="aac")return e>=2&&n<=24e3?"mp4a.40.29":n<=24e3?"mp4a.40.5":"mp4a.40.2";if(t==="mp3")return"mp3";if(t==="opus")return"opus";if(t==="vorbis")return"vorbis";if(t==="flac")return"flac";if(Pi.includes(t))return t;throw new TypeError(`Unhandled codec '${t}'.`)},JE=t=>{const{codec:e,codecDescription:n,aacCodecInfo:r}=t;if(e==="aac"){if(!r)throw new TypeError("AAC codec info must be provided.");if(r.isMpeg2)return"mp4a.67";{let i;return r.objectType!==null?i=r.objectType:i=eT(n).objectType,`mp4a.40.${i}`}}else{if(e==="mp3")return"mp3";if(e==="opus")return"opus";if(e==="vorbis")return"vorbis";if(e==="flac")return"flac";if(e&&Pi.includes(e))return e}throw new TypeError(`Unhandled codec '${e}'.`)},id=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Zm=[-1,1,2,3,4,5,6,8],eT=t=>{if(!t||t.byteLength<2)throw new TypeError("AAC description must be at least 2 bytes long.");const e=new Ln(t);let n=e.readBits(5);n===31&&(n=32+e.readBits(6));const r=e.readBits(4);let i=null;r===15?i=e.readBits(24):r<id.length&&(i=id[r]);const s=e.readBits(4);let o=null;return s>=1&&s<=7&&(o=Zm[s]),{objectType:n,frequencyIndex:r,sampleRate:i,channelConfiguration:s,numberOfChannels:o}},lD=t=>{let e=id.indexOf(t.sampleRate),n=null;e===-1&&(e=15,n=t.sampleRate);const r=Zm.indexOf(t.numberOfChannels);if(r===-1)throw new TypeError(`Unsupported number of channels: ${t.numberOfChannels}`);let i=13;t.objectType>=32&&(i+=6),e===15&&(i+=24);const s=Math.ceil(i/8),o=new Uint8Array(s),a=new Ln(o);return t.objectType<32?a.writeBits(5,t.objectType):(a.writeBits(5,31),a.writeBits(6,t.objectType-32)),a.writeBits(4,e),e===15&&a.writeBits(24,n),a.writeBits(4,r),o},pw=48e3,cD=/^pcm-([usf])(\d+)+(be)?$/,eu=t=>{if(W(Pi.includes(t)),t==="ulaw")return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if(t==="alaw")return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};const e=cD.exec(t);W(e);let n;e[1]==="u"?n="unsigned":e[1]==="s"?n="signed":n="float";const r=Number(e[2])/8,i=e[3]!=="be",s=t==="pcm-u8"?2**7:0;return{dataType:n,sampleSize:r,littleEndian:i,silentValue:s}},uD=t=>t.startsWith("avc1")||t.startsWith("avc3")?"avc":t.startsWith("hev1")||t.startsWith("hvc1")?"hevc":t==="vp8"?"vp8":t.startsWith("vp09")?"vp9":t.startsWith("av01")?"av1":t.startsWith("mp4a.40")||t==="mp4a.67"?"aac":t==="mp3"||t==="mp4a.69"||t==="mp4a.6B"||t==="mp4a.6b"?"mp3":t==="opus"?"opus":t==="vorbis"?"vorbis":t==="flac"?"flac":t==="ulaw"?"ulaw":t==="alaw"?"alaw":cD.test(t)?t:t==="webvtt"?"webvtt":null,Gee=t=>t==="avc"?{avc:{format:"avc"}}:t==="hevc"?{hevc:{format:"hevc"}}:{},Zee=t=>t==="aac"?{aac:{format:"aac"}}:t==="opus"?{opus:{format:"opus"}}:{},Xee=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],Qee=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,Yee=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,Jee=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,ete=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,tte=t=>{if(!t)throw new TypeError("Video chunk metadata must be provided.");if(typeof t!="object")throw new TypeError("Video chunk metadata must be an object.");if(!t.decoderConfig)throw new TypeError("Video chunk metadata must include a decoder configuration.");if(typeof t.decoderConfig!="object")throw new TypeError("Video chunk metadata decoder configuration must be an object.");if(typeof t.decoderConfig.codec!="string")throw new TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!Xee.some(e=>t.decoderConfig.codec.startsWith(e)))throw new TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(t.decoderConfig.codedWidth)||t.decoderConfig.codedWidth<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(t.decoderConfig.codedHeight)||t.decoderConfig.codedHeight<=0)throw new TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(t.decoderConfig.description!==void 0&&!dw(t.decoderConfig.description))throw new TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(t.decoderConfig.colorSpace!==void 0){const{colorSpace:e}=t.decoderConfig;if(typeof e!="object")throw new TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");const n=Object.keys(jm);if(e.primaries!=null&&!n.includes(e.primaries))throw new TypeError(`Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of ${n.join(", ")}.`);const r=Object.keys(qm);if(e.transfer!=null&&!r.includes(e.transfer))throw new TypeError(`Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of ${r.join(", ")}.`);const i=Object.keys(Km);if(e.matrix!=null&&!i.includes(e.matrix))throw new TypeError(`Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of ${i.join(", ")}.`);if(e.fullRange!=null&&typeof e.fullRange!="boolean")throw new TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(t.decoderConfig.codec.startsWith("avc1")||t.decoderConfig.codec.startsWith("avc3")){if(!Qee.test(t.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(t.decoderConfig.codec.startsWith("hev1")||t.decoderConfig.codec.startsWith("hvc1")){if(!Yee.test(t.decoderConfig.codec))throw new TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(t.decoderConfig.codec.startsWith("vp8")){if(t.decoderConfig.codec!=="vp8")throw new TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(t.decoderConfig.codec.startsWith("vp09")){if(!Jee.test(t.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(t.decoderConfig.codec.startsWith("av01")&&!ete.test(t.decoderConfig.codec))throw new TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},nte=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],rte=t=>{if(!t)throw new TypeError("Audio chunk metadata must be provided.");if(typeof t!="object")throw new TypeError("Audio chunk metadata must be an object.");if(!t.decoderConfig)throw new TypeError("Audio chunk metadata must include a decoder configuration.");if(typeof t.decoderConfig!="object")throw new TypeError("Audio chunk metadata decoder configuration must be an object.");if(typeof t.decoderConfig.codec!="string")throw new TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!nte.some(e=>t.decoderConfig.codec.startsWith(e)))throw new TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(t.decoderConfig.sampleRate)||t.decoderConfig.sampleRate<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(t.decoderConfig.numberOfChannels)||t.decoderConfig.numberOfChannels<=0)throw new TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(t.decoderConfig.description!==void 0&&!dw(t.decoderConfig.description))throw new TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(t.decoderConfig.codec.startsWith("mp4a")&&t.decoderConfig.codec!=="mp4a.69"&&t.decoderConfig.codec!=="mp4a.6B"&&t.decoderConfig.codec!=="mp4a.6b"){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(t.decoderConfig.codec))throw new TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.")}else if(t.decoderConfig.codec.startsWith("mp3")||t.decoderConfig.codec.startsWith("mp4a")){if(t.decoderConfig.codec!=="mp3"&&t.decoderConfig.codec!=="mp4a.69"&&t.decoderConfig.codec!=="mp4a.6B"&&t.decoderConfig.codec!=="mp4a.6b")throw new TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(t.decoderConfig.codec.startsWith("opus")){if(t.decoderConfig.codec!=="opus")throw new TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(t.decoderConfig.description&&t.decoderConfig.description.byteLength<18)throw new TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(t.decoderConfig.codec.startsWith("vorbis")){if(t.decoderConfig.codec!=="vorbis")throw new TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!t.decoderConfig.description)throw new TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(t.decoderConfig.codec.startsWith("flac")){if(t.decoderConfig.codec!=="flac")throw new TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');if(!t.decoderConfig.description||t.decoderConfig.description.byteLength<42)throw new TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((t.decoderConfig.codec.startsWith("pcm")||t.decoderConfig.codec.startsWith("ulaw")||t.decoderConfig.codec.startsWith("alaw"))&&!Pi.includes(t.decoderConfig.codec))throw new TypeError(`Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM codecs (${Pi.join(", ")}).`)},ite=t=>{if(!t)throw new TypeError("Subtitle metadata must be provided.");if(typeof t!="object")throw new TypeError("Subtitle metadata must be an object.");if(!t.config)throw new TypeError("Subtitle metadata must include a config object.");if(typeof t.config!="object")throw new TypeError("Subtitle metadata config must be an object.");if(typeof t.config.description!="string")throw new TypeError("Subtitle metadata config description must be a string.")};class ste{constructor(e){this.mutex=new yd,this.firstMediaStreamTimestamp=null,this.trackTimestampInfo=new WeakMap,this.output=e}onTrackClose(e){}validateAndNormalizeTimestamp(e,n,r){n+=e.source._timestampOffset;let i=this.trackTimestampInfo.get(e);if(!i){if(!r)throw new Error("First packet must be a key packet.");i={maxTimestamp:n,maxTimestampBeforeLastKeyPacket:n},this.trackTimestampInfo.set(e,i)}if(n<0)throw new Error(`Timestamps must be non-negative (got ${n}s).`);if(r&&(i.maxTimestampBeforeLastKeyPacket=i.maxTimestamp),n<i.maxTimestampBeforeLastKeyPacket)throw new Error(`Timestamps cannot be smaller than the largest timestamp of the previous GOP (a GOP begins with a key packet and ends right before the next key packet). Got ${n}s, but largest timestamp is ${i.maxTimestampBeforeLastKeyPacket}s.`);return i.maxTimestamp=Math.max(i.maxTimestamp,n),n}}var Wo;(function(t){t[t.NON_IDR_SLICE=1]="NON_IDR_SLICE",t[t.SLICE_DPA=2]="SLICE_DPA",t[t.SLICE_DPB=3]="SLICE_DPB",t[t.SLICE_DPC=4]="SLICE_DPC",t[t.IDR=5]="IDR",t[t.SEI=6]="SEI",t[t.SPS=7]="SPS",t[t.PPS=8]="PPS",t[t.AUD=9]="AUD",t[t.SPS_EXT=13]="SPS_EXT"})(Wo||(Wo={}));var li;(function(t){t[t.RASL_N=8]="RASL_N",t[t.RASL_R=9]="RASL_R",t[t.BLA_W_LP=16]="BLA_W_LP",t[t.RSV_IRAP_VCL23=23]="RSV_IRAP_VCL23",t[t.VPS_NUT=32]="VPS_NUT",t[t.SPS_NUT=33]="SPS_NUT",t[t.PPS_NUT=34]="PPS_NUT",t[t.AUD_NUT=35]="AUD_NUT",t[t.PREFIX_SEI_NUT=39]="PREFIX_SEI_NUT",t[t.SUFFIX_SEI_NUT=40]="SUFFIX_SEI_NUT"})(li||(li={}));const Xm=function*(t){let e=0,n=-1;for(;e<t.length-2;){const r=t.indexOf(0,e);if(r===-1||r>=t.length-2)break;e=r;let i=0;if(e+3<t.length&&t[e+1]===0&&t[e+2]===0&&t[e+3]===1?i=4:t[e+1]===0&&t[e+2]===1&&(i=3),i===0){e++;continue}n!==-1&&e>n&&(yield{offset:n,length:e-n}),n=e+i,e=n}n!==-1&&n<t.length&&(yield{offset:n,length:t.length-n})},dD=function*(t,e){let n=0;const r=new DataView(t.buffer,t.byteOffset,t.byteLength);for(;n+e<=t.length;){let i;e===1?i=r.getUint8(n):e===2?i=r.getUint16(n,!1):e===3?i=fw(r,n,!1):(W(e===4),i=r.getUint32(n,!1)),n+=e,yield{offset:n,length:i},n+=i}},fD=(t,e)=>{if(e.description){const i=(hs(e.description)[4]&3)+1;return dD(t,i)}else return Xm(t)},ote=function*(t){yield*Xm(t)},mw=t=>t&31,gw=t=>{const e=[],n=t.length;for(let r=0;r<n;r++)r+2<n&&t[r]===0&&t[r+1]===0&&t[r+2]===3?(e.push(0,0),r+=2):e.push(t[r]);return new Uint8Array(e)},p1=new Uint8Array([0,0,0,1]),ate=t=>{const e=t.reduce((i,s)=>i+p1.byteLength+s.byteLength,0),n=new Uint8Array(e);let r=0;for(const i of t)n.set(p1,r),r+=p1.byteLength,n.set(i,r),r+=i.byteLength;return n},hD=(t,e)=>{const n=t.reduce((s,o)=>s+e+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of t){const o=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(e){case 1:o.setUint8(i,s.byteLength);break;case 2:o.setUint16(i,s.byteLength,!1);break;case 3:QE(o,i,s.byteLength,!1);break;case 4:o.setUint32(i,s.byteLength,!1);break}i+=e,r.set(s,i),i+=s.byteLength}return r},lte=(t,e)=>{if(e.description){const i=(hs(e.description)[4]&3)+1;return hD(t,i)}else return ate(t)},tT=t=>{try{const e=[],n=[],r=[];for(const a of ote(t)){const l=t.subarray(a.offset,a.offset+a.length),c=mw(l[0]);c===Wo.SPS?e.push(l):c===Wo.PPS?n.push(l):c===Wo.SPS_EXT&&r.push(l)}if(e.length===0||n.length===0)return null;const i=e[0],s=nT(i);W(s!==null);const o=s.profileIdc===100||s.profileIdc===110||s.profileIdc===122||s.profileIdc===144;return{configurationVersion:1,avcProfileIndication:s.profileIdc,profileCompatibility:s.constraintFlags,avcLevelIndication:s.levelIdc,lengthSizeMinusOne:3,sequenceParameterSets:e,pictureParameterSets:n,chromaFormat:o?s.chromaFormatIdc:null,bitDepthLumaMinus8:o?s.bitDepthLumaMinus8:null,bitDepthChromaMinus8:o?s.bitDepthChromaMinus8:null,sequenceParameterSetExt:o?r:null}}catch(e){return console.error("Error building AVC Decoder Configuration Record:",e),null}},cte=t=>{const e=[];e.push(t.configurationVersion),e.push(t.avcProfileIndication),e.push(t.profileCompatibility),e.push(t.avcLevelIndication),e.push(252|t.lengthSizeMinusOne&3),e.push(224|t.sequenceParameterSets.length&31);for(const n of t.sequenceParameterSets){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}e.push(t.pictureParameterSets.length);for(const n of t.pictureParameterSets){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}if(t.avcProfileIndication===100||t.avcProfileIndication===110||t.avcProfileIndication===122||t.avcProfileIndication===144){W(t.chromaFormat!==null),W(t.bitDepthLumaMinus8!==null),W(t.bitDepthChromaMinus8!==null),W(t.sequenceParameterSetExt!==null),e.push(252|t.chromaFormat&3),e.push(248|t.bitDepthLumaMinus8&7),e.push(248|t.bitDepthChromaMinus8&7),e.push(t.sequenceParameterSetExt.length);for(const n of t.sequenceParameterSetExt){const r=n.byteLength;e.push(r>>8),e.push(r&255);for(let i=0;i<r;i++)e.push(n[i])}}return new Uint8Array(e)},ute=t=>{try{const e=jn(t);let n=0;const r=e.getUint8(n++),i=e.getUint8(n++),s=e.getUint8(n++),o=e.getUint8(n++),a=e.getUint8(n++)&3,l=e.getUint8(n++)&31,c=[];for(let h=0;h<l;h++){const p=e.getUint16(n,!1);n+=2,c.push(t.subarray(n,n+p)),n+=p}const u=e.getUint8(n++),d=[];for(let h=0;h<u;h++){const p=e.getUint16(n,!1);n+=2,d.push(t.subarray(n,n+p)),n+=p}const f={configurationVersion:r,avcProfileIndication:i,profileCompatibility:s,avcLevelIndication:o,lengthSizeMinusOne:a,sequenceParameterSets:c,pictureParameterSets:d,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if((i===100||i===110||i===122||i===144)&&n+4<=t.length){const h=e.getUint8(n++)&3,p=e.getUint8(n++)&7,m=e.getUint8(n++)&7,g=e.getUint8(n++);f.chromaFormat=h,f.bitDepthLumaMinus8=p,f.bitDepthChromaMinus8=m;const y=[];for(let b=0;b<g;b++){const S=e.getUint16(n,!1);n+=2,y.push(t.subarray(n,n+S)),n+=S}f.sequenceParameterSetExt=y}return f}catch(e){return console.error("Error deserializing AVC Decoder Configuration Record:",e),null}},nT=t=>{try{const e=new Ln(gw(t));if(e.skipBits(1),e.skipBits(2),e.readBits(5)!==7)return null;const r=e.readAlignedByte(),i=e.readAlignedByte(),s=e.readAlignedByte();Ye(e);let o=1,a=0,l=0,c=0;if((r===100||r===110||r===122||r===244||r===44||r===83||r===86||r===118||r===128)&&(o=Ye(e),o===3&&(c=e.readBits(1)),a=Ye(e),l=Ye(e),e.skipBits(1),e.readBits(1))){for(let O=0;O<(o!==3?8:12);O++)if(e.readBits(1)){const F=O<6?16:64;let B=8,N=8;for(let M=0;M<F;M++){if(N!==0){const R=Ga(e);N=(B+R+256)%256}B=N===0?B:N}}}Ye(e);const u=Ye(e);if(u===0)Ye(e);else if(u===1){e.skipBits(1),Ga(e),Ga(e);const P=Ye(e);for(let O=0;O<P;O++)Ga(e)}Ye(e),e.skipBits(1);const d=Ye(e),f=Ye(e),h=16*(d+1),p=16*(f+1);let m=h,g=p;const y=e.readBits(1);if(y||e.skipBits(1),e.skipBits(1),e.readBits(1)){const P=Ye(e),O=Ye(e),D=Ye(e),F=Ye(e);let B,N;if((c===0?o:0)===0)B=1,N=2-y;else{const R=o===3?1:2,H=o===1?2:1;B=R,N=H*(2-y)}m-=B*(P+O),g-=N*(D+F)}let S=2,C=2,_=2,x=0,I=null,k=null;if(e.readBits(1)){e.readBits(1)&&e.readBits(8)===255&&(e.skipBits(16),e.skipBits(16)),e.readBits(1)&&e.skipBits(1),e.readBits(1)&&(e.skipBits(3),x=e.readBits(1),e.readBits(1)&&(S=e.readBits(8),C=e.readBits(8),_=e.readBits(8))),e.readBits(1)&&(Ye(e),Ye(e)),e.readBits(1)&&(e.skipBits(32),e.skipBits(32),e.skipBits(1));const N=e.readBits(1);N&&HP(e);const M=e.readBits(1);M&&HP(e),(N||M)&&e.skipBits(1),e.skipBits(1),e.readBits(1)&&(e.skipBits(1),Ye(e),Ye(e),Ye(e),Ye(e),I=Ye(e),k=Ye(e))}if(I===null){W(k===null);const P=i&16;if((r===44||r===86||r===100||r===110||r===122||r===244)&&P)I=0,k=0;else{const O=d+1,D=f+1,F=(2-y)*D,B=gy.find(M=>M.level>=s)??Wn(gy),N=Math.min(Math.floor(B.maxDpbMbs/(O*F)),16);I=N,k=N}}return W(k!==null),{profileIdc:r,constraintFlags:i,levelIdc:s,frameMbsOnlyFlag:y,chromaFormatIdc:o,bitDepthLumaMinus8:a,bitDepthChromaMinus8:l,codedWidth:h,codedHeight:p,displayWidth:m,displayHeight:g,colourPrimaries:S,matrixCoefficients:_,transferCharacteristics:C,fullRangeFlag:x,numReorderFrames:I,maxDecFrameBuffering:k}}catch(e){return console.error("Error parsing AVC SPS:",e),null}},HP=t=>{const e=Ye(t);t.skipBits(4),t.skipBits(4);for(let n=0;n<=e;n++)Ye(t),Ye(t),t.skipBits(1);t.skipBits(5),t.skipBits(5),t.skipBits(5),t.skipBits(5)},pD=(t,e)=>{if(e.description){const i=(hs(e.description)[21]&3)+1;return dD(t,i)}else return Xm(t)},dte=function*(t){yield*Xm(t)},rm=t=>t>>1&63,mD=t=>{try{const e=new Ln(gw(t));e.skipBits(16),e.readBits(4);const n=e.readBits(3),r=e.readBits(1),{general_profile_space:i,general_tier_flag:s,general_profile_idc:o,general_profile_compatibility_flags:a,general_constraint_indicator_flags:l,general_level_idc:c}=fte(e,n);Ye(e);const u=Ye(e);let d=0;u===3&&(d=e.readBits(1));const f=Ye(e),h=Ye(e);let p=f,m=h;if(e.readBits(1)){const O=Ye(e),D=Ye(e),F=Ye(e),B=Ye(e);let N=1,M=1;const R=d===0?u:0;R===1?(N=2,M=2):R===2&&(N=2,M=1),p-=(O+D)*N,m-=(F+B)*M}const g=Ye(e),y=Ye(e);Ye(e);const S=e.readBits(1)?0:n;let C=0;for(let O=S;O<=n;O++)Ye(e),C=Ye(e),Ye(e);Ye(e),Ye(e),Ye(e),Ye(e),Ye(e),Ye(e),e.readBits(1)&&e.readBits(1)&&hte(e),e.skipBits(1),e.skipBits(1),e.readBits(1)&&(e.skipBits(4),e.skipBits(4),Ye(e),Ye(e),e.skipBits(1));const _=Ye(e);if(pte(e,_),e.readBits(1)){const O=Ye(e);for(let D=0;D<O;D++)Ye(e),e.skipBits(1)}e.skipBits(1),e.skipBits(1);let x=2,I=2,k=2,T=0,P=0;if(e.readBits(1)){const O=gte(e,n);x=O.colourPrimaries,I=O.transferCharacteristics,k=O.matrixCoefficients,T=O.fullRangeFlag,P=O.minSpatialSegmentationIdc}return{displayWidth:p,displayHeight:m,colourPrimaries:x,transferCharacteristics:I,matrixCoefficients:k,fullRangeFlag:T,maxDecFrameBuffering:C+1,spsMaxSubLayersMinus1:n,spsTemporalIdNestingFlag:r,generalProfileSpace:i,generalTierFlag:s,generalProfileIdc:o,generalProfileCompatibilityFlags:a,generalConstraintIndicatorFlags:l,generalLevelIdc:c,chromaFormatIdc:u,bitDepthLumaMinus8:g,bitDepthChromaMinus8:y,minSpatialSegmentationIdc:P}}catch(e){return console.error("Error parsing HEVC SPS:",e),null}},rT=t=>{try{const e=[],n=[],r=[],i=[];for(const c of dte(t)){const u=t.subarray(c.offset,c.offset+c.length),d=rm(u[0]);d===li.VPS_NUT?e.push(u):d===li.SPS_NUT?n.push(u):d===li.PPS_NUT?r.push(u):(d===li.PREFIX_SEI_NUT||d===li.SUFFIX_SEI_NUT)&&i.push(u)}if(n.length===0||r.length===0)return null;const s=mD(n[0]);if(!s)return null;let o=0;if(r.length>0){const c=r[0],u=new Ln(gw(c));u.skipBits(16),Ye(u),Ye(u),u.skipBits(1),u.skipBits(1),u.skipBits(3),u.skipBits(1),u.skipBits(1),Ye(u),Ye(u),Ga(u),u.skipBits(1),u.skipBits(1),u.readBits(1)&&Ye(u),Ga(u),Ga(u),u.skipBits(1),u.skipBits(1),u.skipBits(1),u.skipBits(1);const d=u.readBits(1),f=u.readBits(1);!d&&!f?o=0:d&&!f?o=2:!d&&f?o=3:o=0}const a=[...e.length?[{arrayCompleteness:1,nalUnitType:li.VPS_NUT,nalUnits:e}]:[],...n.length?[{arrayCompleteness:1,nalUnitType:li.SPS_NUT,nalUnits:n}]:[],...r.length?[{arrayCompleteness:1,nalUnitType:li.PPS_NUT,nalUnits:r}]:[],...i.length?[{arrayCompleteness:1,nalUnitType:rm(i[0][0]),nalUnits:i}]:[]];return{configurationVersion:1,generalProfileSpace:s.generalProfileSpace,generalTierFlag:s.generalTierFlag,generalProfileIdc:s.generalProfileIdc,generalProfileCompatibilityFlags:s.generalProfileCompatibilityFlags,generalConstraintIndicatorFlags:s.generalConstraintIndicatorFlags,generalLevelIdc:s.generalLevelIdc,minSpatialSegmentationIdc:s.minSpatialSegmentationIdc,parallelismType:o,chromaFormatIdc:s.chromaFormatIdc,bitDepthLumaMinus8:s.bitDepthLumaMinus8,bitDepthChromaMinus8:s.bitDepthChromaMinus8,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:s.spsMaxSubLayersMinus1+1,temporalIdNested:s.spsTemporalIdNestingFlag,lengthSizeMinusOne:3,arrays:a}}catch(e){return console.error("Error building HEVC Decoder Configuration Record:",e),null}},fte=(t,e)=>{const n=t.readBits(2),r=t.readBits(1),i=t.readBits(5);let s=0;for(let u=0;u<32;u++)s=s<<1|t.readBits(1);const o=new Uint8Array(6);for(let u=0;u<6;u++)o[u]=t.readBits(8);const a=t.readBits(8),l=[],c=[];for(let u=0;u<e;u++)l.push(t.readBits(1)),c.push(t.readBits(1));if(e>0)for(let u=e;u<8;u++)t.skipBits(2);for(let u=0;u<e;u++)l[u]&&t.skipBits(88),c[u]&&t.skipBits(8);return{general_profile_space:n,general_tier_flag:r,general_profile_idc:i,general_profile_compatibility_flags:s,general_constraint_indicator_flags:o,general_level_idc:a}},hte=t=>{for(let e=0;e<4;e++)for(let n=0;n<(e===3?2:6);n++)if(!t.readBits(1))Ye(t);else{const i=Math.min(64,1<<4+(e<<1));e>1&&Ga(t);for(let s=0;s<i;s++)Ga(t)}},pte=(t,e)=>{const n=[];for(let r=0;r<e;r++)n[r]=mte(t,r,e,n)},mte=(t,e,n,r)=>{let i=0,s=0,o=0;if(e!==0&&(s=t.readBits(1)),s){if(e===n){const l=Ye(t);o=e-(l+1)}else o=e-1;t.readBits(1),Ye(t);const a=r[o]??0;for(let l=0;l<=a;l++)t.readBits(1)||t.readBits(1);i=r[o]}else{const a=Ye(t),l=Ye(t);for(let c=0;c<a;c++)Ye(t),t.readBits(1);for(let c=0;c<l;c++)Ye(t),t.readBits(1);i=a+l}return i},gte=(t,e)=>{let n=2,r=2,i=2,s=0,o=0;return t.readBits(1)&&t.readBits(8)===255&&(t.readBits(16),t.readBits(16)),t.readBits(1)&&t.readBits(1),t.readBits(1)&&(t.readBits(3),s=t.readBits(1),t.readBits(1)&&(n=t.readBits(8),r=t.readBits(8),i=t.readBits(8))),t.readBits(1)&&(Ye(t),Ye(t)),t.readBits(1),t.readBits(1),t.readBits(1),t.readBits(1)&&(Ye(t),Ye(t),Ye(t),Ye(t)),t.readBits(1)&&(t.readBits(32),t.readBits(32),t.readBits(1)&&Ye(t),t.readBits(1)&&yte(t,!0,e)),t.readBits(1)&&(t.readBits(1),t.readBits(1),t.readBits(1),o=Ye(t),Ye(t),Ye(t),Ye(t),Ye(t)),{colourPrimaries:n,transferCharacteristics:r,matrixCoefficients:i,fullRangeFlag:s,minSpatialSegmentationIdc:o}},yte=(t,e,n)=>{let r=!1,i=!1,s=!1;r=t.readBits(1)===1,i=t.readBits(1)===1,(r||i)&&(s=t.readBits(1)===1,s&&(t.readBits(8),t.readBits(5),t.readBits(1),t.readBits(5)),t.readBits(4),t.readBits(4),s&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let o=0;o<=n;o++){const a=t.readBits(1)===1;let l=!0;a||(l=t.readBits(1)===1);let c=!1;l?Ye(t):c=t.readBits(1)===1;let u=1;c||(u=Ye(t)+1),r&&VP(t,u,s),i&&VP(t,u,s)}},VP=(t,e,n)=>{for(let r=0;r<e;r++)Ye(t),Ye(t),n&&(Ye(t),Ye(t)),t.readBits(1)},bte=t=>{const e=[];e.push(t.configurationVersion),e.push((t.generalProfileSpace&3)<<6|(t.generalTierFlag&1)<<5|t.generalProfileIdc&31),e.push(t.generalProfileCompatibilityFlags>>>24&255),e.push(t.generalProfileCompatibilityFlags>>>16&255),e.push(t.generalProfileCompatibilityFlags>>>8&255),e.push(t.generalProfileCompatibilityFlags&255),e.push(...t.generalConstraintIndicatorFlags),e.push(t.generalLevelIdc&255),e.push(240|t.minSpatialSegmentationIdc>>8&15),e.push(t.minSpatialSegmentationIdc&255),e.push(252|t.parallelismType&3),e.push(252|t.chromaFormatIdc&3),e.push(248|t.bitDepthLumaMinus8&7),e.push(248|t.bitDepthChromaMinus8&7),e.push(t.avgFrameRate>>8&255),e.push(t.avgFrameRate&255),e.push((t.constantFrameRate&3)<<6|(t.numTemporalLayers&7)<<3|(t.temporalIdNested&1)<<2|t.lengthSizeMinusOne&3),e.push(t.arrays.length&255);for(const n of t.arrays){e.push((n.arrayCompleteness&1)<<7|0|n.nalUnitType&63),e.push(n.nalUnits.length>>8&255),e.push(n.nalUnits.length&255);for(const r of n.nalUnits){e.push(r.length>>8&255),e.push(r.length&255);for(let i=0;i<r.length;i++)e.push(r[i])}}return new Uint8Array(e)},gD=t=>{const e=new Ln(t);if(e.readBits(2)!==2)return null;const r=e.readBits(1),s=(e.readBits(1)<<1)+r;if(s===3&&e.skipBits(1),e.readBits(1)===1||e.readBits(1)!==0||(e.skipBits(2),e.readBits(24)!==4817730))return null;let c=8;s>=2&&(c=e.readBits(1)?12:10);const u=e.readBits(3);let d=0,f=0;if(u!==7)if(f=e.readBits(1),s===1||s===3){const I=e.readBits(1),k=e.readBits(1);d=!I&&!k?3:I&&!k?2:1,e.skipBits(1)}else d=1;else d=3,f=1;const h=e.readBits(16),p=e.readBits(16),m=h+1,g=p+1,y=m*g;let b=Wn(mc).level;for(const x of mc)if(y<=x.maxPictureSize){b=x.level;break}return{profile:s,level:b,bitDepth:c,chromaSubsampling:d,videoFullRangeFlag:f,colourPrimaries:u===2?1:u===1?6:2,transferCharacteristics:u===2?1:u===1?6:2,matrixCoefficients:u===7?0:u===2?1:u===1?6:2}},yD=function*(t){const e=new Ln(t),n=()=>{let r=0;for(let i=0;i<8;i++){const s=e.readAlignedByte();if(r|=(s&127)<<i*7,!(s&128))break;if(i===7&&s&128)return null}return r>=2**32-1?null:r};for(;e.getBitsLeft()>=8;){e.skipBits(1);const r=e.readBits(4),i=e.readBits(1),s=e.readBits(1);e.skipBits(1),i&&e.skipBits(8);let o;if(s){const a=n();if(a===null)return;o=a}else o=Math.floor(e.getBitsLeft()/8);W(e.pos%8===0),yield{type:r,data:t.subarray(e.pos/8,e.pos/8+o)},e.skipBits(o*8)}},bD=t=>{for(const{type:e,data:n}of yD(t)){if(e!==1)continue;const r=new Ln(n),i=r.readBits(3);r.readBits(1);const s=r.readBits(1);let o=0,a=0,l=0;if(s)o=r.readBits(5);else{if(r.readBits(1)&&(r.skipBits(32),r.skipBits(32),r.readBits(1)))return null;const _=r.readBits(1);_&&(l=r.readBits(5),r.skipBits(32),r.skipBits(5),r.skipBits(5));const x=r.readBits(5);for(let I=0;I<=x;I++){r.skipBits(12);const k=r.readBits(5);if(I===0&&(o=k),k>7){const P=r.readBits(1);I===0&&(a=P)}if(_&&r.readBits(1)){const O=l+1;r.skipBits(O),r.skipBits(O),r.skipBits(1)}r.readBits(1)&&r.skipBits(4)}}const c=r.readBits(4),u=r.readBits(4),d=c+1;r.skipBits(d);const f=u+1;r.skipBits(f);let h=0;if(s?h=0:h=r.readBits(1),h&&(r.skipBits(4),r.skipBits(3)),r.skipBits(1),r.skipBits(1),r.skipBits(1),!s){r.skipBits(1),r.skipBits(1),r.skipBits(1),r.skipBits(1);const C=r.readBits(1);C&&(r.skipBits(1),r.skipBits(1));const _=r.readBits(1);let x=0;_?x=2:x=r.readBits(1),x>0&&(r.readBits(1)||r.skipBits(1)),C&&r.skipBits(3)}r.skipBits(1),r.skipBits(1),r.skipBits(1);const p=r.readBits(1);let m=8;i===2&&p?m=r.readBits(1)?12:10:i<=2&&(m=p?10:8);let g=0;i!==1&&(g=r.readBits(1));let y=1,b=1,S=0;return g||(i===0?(y=1,b=1):i===1?(y=0,b=0):m===12&&(y=r.readBits(1),y&&(b=r.readBits(1))),y&&b&&(S=r.readBits(2))),{profile:i,level:o,tier:a,bitDepth:m,monochrome:g,chromaSubsamplingX:y,chromaSubsamplingY:b,chromaSamplePosition:S}}return null},wD=t=>{const e=jn(t),n=e.getUint8(9),r=e.getUint16(10,!0),i=e.getUint32(12,!0),s=e.getInt16(16,!0),o=e.getUint8(18);let a=null;return o&&(a=t.subarray(19,21+n)),{outputChannelCount:n,preSkip:r,inputSampleRate:i,outputGain:s,channelMappingFamily:o,channelMappingTable:a}},wte=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],vte=t=>{const e=t[0]>>3;return{durationInSamples:wte[e]}},xte=t=>{if(t.length<7)throw new Error("Setup header is too short.");if(t[0]!==5)throw new Error("Wrong packet type in Setup header.");if(String.fromCharCode(...t.slice(1,7))!=="vorbis")throw new Error("Invalid packet signature in Setup header.");const n=t.length,r=new Uint8Array(n);for(let d=0;d<n;d++)r[d]=t[n-1-d];const i=new Ln(r);let s=0;for(;i.getBitsLeft()>97;)if(i.readBits(1)===1){s=i.pos;break}if(s===0)throw new Error("Invalid Setup header: framing bit not found.");let o=0,a=!1,l=0;for(;i.getBitsLeft()>=97;){const d=i.pos,f=i.readBits(8),h=i.readBits(16),p=i.readBits(16);if(f>63||h!==0||p!==0){i.pos=d;break}if(i.skipBits(1),o++,o>64)break;i.clone().readBits(6)+1===o&&(a=!0,l=o)}if(!a)throw new Error("Invalid Setup header: mode header not found.");if(l>63)throw new Error(`Unsupported mode count: ${l}.`);const c=l;i.pos=0,i.skipBits(s);const u=Array(c).fill(0);for(let d=c-1;d>=0;d--)i.skipBits(40),u[d]=i.readBits(1);return{modeBlockflags:u}},iT=(t,e,n)=>{switch(t){case"avc":{for(const r of fD(n,e)){const i=n[r.offset],s=mw(i);if(s>=Wo.NON_IDR_SLICE&&s<=Wo.SLICE_DPC)return"delta";if(s===Wo.IDR)return"key";if(s===Wo.SEI&&(!$x()||Hee()>=144)){const o=n.subarray(r.offset,r.offset+r.length),a=gw(o);let l=1;do{let c=0;for(;;){const f=a[l++];if(f===void 0||(c+=f,f<255))break}let u=0;for(;;){const f=a[l++];if(f===void 0||(u+=f,f<255))break}if(c===6){const f=new Ln(a);f.pos=8*l;const h=Ye(f),p=f.readBits(1);if(h===0&&p===1)return"key"}l+=u}while(l<a.length-1)}}return"delta"}case"hevc":{for(const r of pD(n,e)){const i=rm(n[r.offset]);if(i<li.BLA_W_LP)return"delta";if(i<=li.RSV_IRAP_VCL23)return"key"}return"delta"}case"vp8":return(n[0]&1)===0?"key":"delta";case"vp9":{const r=new Ln(n);if(r.readBits(2)!==2)return null;const i=r.readBits(1);return(r.readBits(1)<<1)+i===3&&r.skipBits(1),r.readBits(1)?null:r.readBits(1)===0?"key":"delta"}case"av1":{let r=!1;for(const{type:i,data:s}of yD(n))if(i===1){const o=new Ln(s);o.skipBits(4),r=!!o.readBits(1)}else if(i===3||i===6||i===7){if(r)return"key";const o=new Ln(s);return o.readBits(1)?null:o.readBits(2)===0?"key":"delta"}return null}default:Hc(t),W(!1)}};var vf;(function(t){t[t.STREAMINFO=0]="STREAMINFO",t[t.VORBIS_COMMENT=4]="VORBIS_COMMENT",t[t.PICTURE=6]="PICTURE"})(vf||(vf={}));const Ux=(t,e)=>{const n=jn(t);let r=0;const i=n.getUint32(r,!0);r+=4;const s=zs.decode(t.subarray(r,r+i));r+=i,i>0&&(e.raw??={},e.raw.vendor??=s);const o=n.getUint32(r,!0);r+=4;for(let a=0;a<o;a++){const l=n.getUint32(r,!0);r+=4;const c=zs.decode(t.subarray(r,r+l));r+=l;const u=c.indexOf("=");if(u===-1)continue;const d=c.slice(0,u).toUpperCase(),f=c.slice(u+1);switch(e.raw??={},e.raw[d]??=f,d){case"TITLE":e.title??=f;break;case"DESCRIPTION":e.description??=f;break;case"ARTIST":e.artist??=f;break;case"ALBUM":e.album??=f;break;case"ALBUMARTIST":e.albumArtist??=f;break;case"COMMENT":e.comment??=f;break;case"LYRICS":e.lyrics??=f;break;case"TRACKNUMBER":{const h=f.split("/"),p=Number.parseInt(h[0],10),m=h[1]&&Number.parseInt(h[1],10);Number.isInteger(p)&&p>0&&(e.trackNumber??=p),m&&Number.isInteger(m)&&m>0&&(e.tracksTotal??=m)}break;case"TRACKTOTAL":{const h=Number.parseInt(f,10);Number.isInteger(h)&&h>0&&(e.tracksTotal??=h)}break;case"DISCNUMBER":{const h=f.split("/"),p=Number.parseInt(h[0],10),m=h[1]&&Number.parseInt(h[1],10);Number.isInteger(p)&&p>0&&(e.discNumber??=p),m&&Number.isInteger(m)&&m>0&&(e.discsTotal??=m)}break;case"DISCTOTAL":{const h=Number.parseInt(f,10);Number.isInteger(h)&&h>0&&(e.discsTotal??=h)}break;case"DATE":{const h=new Date(f);Number.isNaN(h.getTime())||(e.date??=h)}break;case"GENRE":e.genre??=f;break;case"METADATA_BLOCK_PICTURE":{const h=Vee(f),p=jn(h),m=p.getUint32(0,!1),g=p.getUint32(4,!1),y=String.fromCharCode(...h.subarray(8,8+g)),b=p.getUint32(8+g,!1),S=zs.decode(h.subarray(12+g,12+g+b)),C=p.getUint32(g+b+28),_=h.subarray(g+b+32,g+b+32+C);e.images??=[],e.images.push({data:_,mimeType:y,kind:m===3?"coverFront":m===4?"coverBack":"unknown",name:void 0,description:S||void 0})}break}}};class tu{constructor(e){this.input=e}}const vD=[],xD=[],Hx=[],Vx=[];const ys=new Uint8Array(0);class Mn{constructor(e,n,r,i,s=-1,o,a){if(this.data=e,this.type=n,this.timestamp=r,this.duration=i,this.sequenceNumber=s,e===ys&&o===void 0)throw new Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(o===void 0&&(o=e.byteLength),!(e instanceof Uint8Array))throw new TypeError("data must be a Uint8Array.");if(n!=="key"&&n!=="delta")throw new TypeError('type must be either "key" or "delta".');if(!Number.isFinite(r))throw new TypeError("timestamp must be a number.");if(!Number.isFinite(i)||i<0)throw new TypeError("duration must be a non-negative number.");if(!Number.isFinite(s))throw new TypeError("sequenceNumber must be a number.");if(!Number.isInteger(o)||o<0)throw new TypeError("byteLength must be a non-negative integer.");if(a!==void 0&&(typeof a!="object"||!a))throw new TypeError("sideData, when provided, must be an object.");if(a?.alpha!==void 0&&!(a.alpha instanceof Uint8Array))throw new TypeError("sideData.alpha, when provided, must be a Uint8Array.");if(a?.alphaByteLength!==void 0&&(!Number.isInteger(a.alphaByteLength)||a.alphaByteLength<0))throw new TypeError("sideData.alphaByteLength, when provided, must be a non-negative integer.");this.byteLength=o,this.sideData=a??{},this.sideData.alpha&&this.sideData.alphaByteLength===void 0&&(this.sideData.alphaByteLength=this.sideData.alpha.byteLength)}get isMetadataOnly(){return this.data===ys}get microsecondTimestamp(){return Math.trunc(pc*this.timestamp)}get microsecondDuration(){return Math.trunc(pc*this.duration)}toEncodedVideoChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}alphaToEncodedVideoChunk(e=this.type){if(!this.sideData.alpha)throw new TypeError("This packet does not contain alpha side data.");if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to a video chunk.");if(typeof EncodedVideoChunk>"u")throw new Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.sideData.alpha,type:e,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}toEncodedAudioChunk(){if(this.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be converted to an audio chunk.");if(typeof EncodedAudioChunk>"u")throw new Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}static fromEncodedChunk(e,n){if(!(e instanceof EncodedVideoChunk||e instanceof EncodedAudioChunk))throw new TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");const r=new Uint8Array(e.byteLength);return e.copyTo(r),new Mn(r,e.type,e.timestamp/1e6,(e.duration??0)/1e6,void 0,void 0,n)}clone(e){if(e!==void 0&&(typeof e!="object"||e===null))throw new TypeError("options, when provided, must be an object.");if(e?.data!==void 0&&!(e.data instanceof Uint8Array))throw new TypeError("options.data, when provided, must be a Uint8Array.");if(e?.type!==void 0&&e.type!=="key"&&e.type!=="delta")throw new TypeError('options.type, when provided, must be either "key" or "delta".');if(e?.timestamp!==void 0&&!Number.isFinite(e.timestamp))throw new TypeError("options.timestamp, when provided, must be a number.");if(e?.duration!==void 0&&!Number.isFinite(e.duration))throw new TypeError("options.duration, when provided, must be a number.");if(e?.sequenceNumber!==void 0&&!Number.isFinite(e.sequenceNumber))throw new TypeError("options.sequenceNumber, when provided, must be a number.");if(e?.sideData!==void 0&&(typeof e.sideData!="object"||e.sideData===null))throw new TypeError("options.sideData, when provided, must be an object.");return new Mn(e?.data??this.data,e?.type??this.type,e?.timestamp??this.timestamp,e?.duration??this.duration,e?.sequenceNumber??this.sequenceNumber,this.byteLength,e?.sideData??this.sideData)}}const Ste=t=>{let r=t,i=4096,s=0,o=12,a=0;for(r<0&&(r=-r,s=128),r+=33,r>8191&&(r=8191);(r&i)!==i&&o>=5;)i>>=1,o--;return a=r>>o-4&15,~(s|o-5<<4|a)&255},kte=t=>{let n=0,r=0,i=~t;i&128&&(i&=-129,n=-1),r=((i&240)>>4)+5;const s=(1<<r|(i&15)<<r-4|1<<r-5)-33;return n===0?s:-s},Ete=t=>{let n=2048,r=0,i=11,s=0,o=t;for(o<0&&(o=-o,r=128),o>4095&&(o=4095);(o&n)!==n&&i>=5;)n>>=1,i--;return s=o>>(i===4?1:i-4)&15,(r|i-4<<4|s)^85},Tte=t=>{let e=0,n=0,r=t^85;r&128&&(r&=-129,e=-1),n=((r&240)>>4)+4;let i=0;return n!==4?i=1<<n|(r&15)<<n-4|1<<n-5:i=r<<1|1,e===0?i:-i};sD();let WP=-1/0,jP=-1/0,im=null;typeof FinalizationRegistry<"u"&&(im=new FinalizationRegistry(t=>{const e=Date.now();t.type==="video"?(e-WP>=1e3&&(console.error("A VideoSample was garbage collected without first being closed. For proper resource management, make sure to call close() on all your VideoSamples as soon as you're done using them."),WP=e),typeof VideoFrame<"u"&&t.data instanceof VideoFrame&&t.data.close()):(e-jP>=1e3&&(console.error("An AudioSample was garbage collected without first being closed. For proper resource management, make sure to call close() on all your AudioSamples as soon as you're done using them."),jP=e),typeof AudioData<"u"&&t.data instanceof AudioData&&t.data.close())}));const SD=["I420","I420P10","I420P12","I420A","I420AP10","I420AP12","I422","I422P10","I422P12","I422A","I422AP10","I422AP12","I444","I444P10","I444P12","I444A","I444AP10","I444AP12","NV12","RGBA","RGBX","BGRA","BGRX"],Cte=new Set(SD);class _i{get displayWidth(){return this.rotation%180===0?this.codedWidth:this.codedHeight}get displayHeight(){return this.rotation%180===0?this.codedHeight:this.codedWidth}get microsecondTimestamp(){return Math.trunc(pc*this.timestamp)}get microsecondDuration(){return Math.trunc(pc*this.duration)}get hasAlpha(){return this.format&&this.format.includes("A")}constructor(e,n){if(this._closed=!1,e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer||ArrayBuffer.isView(e)){if(!n||typeof n!="object")throw new TypeError("init must be an object.");if(n.format===void 0||!Cte.has(n.format))throw new TypeError("init.format must be one of: "+SD.join(", "));if(!Number.isInteger(n.codedWidth)||n.codedWidth<=0)throw new TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(n.codedHeight)||n.codedHeight<=0)throw new TypeError("init.codedHeight must be a positive integer.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(n.timestamp))throw new TypeError("init.timestamp must be a number.");if(n.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=hs(e).slice(),this._layout=n.layout??_te(n.format,n.codedWidth,n.codedHeight),this.format=n.format,this.codedWidth=n.codedWidth,this.codedHeight=n.codedHeight,this.rotation=n.rotation??0,this.timestamp=n.timestamp,this.duration=n.duration??0,this.colorSpace=new m1(n.colorSpace)}else if(typeof VideoFrame<"u"&&e instanceof VideoFrame){if(n?.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(n?.timestamp!==void 0&&!Number.isFinite(n?.timestamp))throw new TypeError("init.timestamp, when provided, must be a number.");if(n?.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");this._data=e,this._layout=null,this.format=e.format,this.codedWidth=e.displayWidth,this.codedHeight=e.displayHeight,this.rotation=n?.rotation??0,this.timestamp=n?.timestamp??e.timestamp/1e6,this.duration=n?.duration??(e.duration??0)/1e6,this.colorSpace=new m1(e.colorSpace)}else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof SVGImageElement<"u"&&e instanceof SVGImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){if(!n||typeof n!="object")throw new TypeError("init must be an object.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(n.timestamp))throw new TypeError("init.timestamp must be a number.");if(n.duration!==void 0&&(!Number.isFinite(n.duration)||n.duration<0))throw new TypeError("init.duration, when provided, must be a non-negative number.");if(typeof VideoFrame<"u")return new _i(new VideoFrame(e,{timestamp:Math.trunc(n.timestamp*pc),duration:Math.trunc((n.duration??0)*pc)||void 0}),n);let r=0,i=0;if("naturalWidth"in e?(r=e.naturalWidth,i=e.naturalHeight):"videoWidth"in e?(r=e.videoWidth,i=e.videoHeight):"width"in e&&(r=Number(e.width),i=Number(e.height)),!r||!i)throw new TypeError("Could not determine dimensions.");const s=new OffscreenCanvas(r,i),o=s.getContext("2d",{alpha:qf(),willReadFrequently:!0});W(o),o.drawImage(e,0,0),this._data=s,this._layout=null,this.format="RGBX",this.codedWidth=r,this.codedHeight=i,this.rotation=n.rotation??0,this.timestamp=n.timestamp,this.duration=n.duration??0,this.colorSpace=new m1({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}else throw new TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.");im?.register(this,{type:"video",data:this._data},this)}clone(){if(this._closed)throw new Error("VideoSample is closed.");return W(this._data!==null),du(this._data)?new _i(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?(W(this._layout),new _i(this._data,{format:this.format,layout:this._layout,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})):new _i(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}close(){this._closed||(im?.unregister(this),du(this._data)?this._data.close():this._data=null,this._closed=!0)}allocationSize(e={}){if(qP(e),this._closed)throw new Error("VideoSample is closed.");if(this.format===null)throw new Error("Cannot get allocation size when format is null. Sorry!");if(W(this._data!==null),!du(this._data)&&(e.colorSpace||e.format&&e.format!==this.format||e.layout||e.rect)){const n=this.toVideoFrame(),r=n.allocationSize(e);return n.close(),r}return du(this._data)?this._data.allocationSize(e):this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}async copyTo(e,n={}){if(!dw(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(qP(n),this._closed)throw new Error("VideoSample is closed.");if(this.format===null)throw new Error("Cannot copy video sample data when format is null. Sorry!");if(W(this._data!==null),!du(this._data)&&(n.colorSpace||n.format&&n.format!==this.format||n.layout||n.rect)){const r=this.toVideoFrame(),i=await r.copyTo(e,n);return r.close(),i}if(du(this._data))return this._data.copyTo(e,n);if(this._data instanceof Uint8Array)return W(this._layout),hs(e).set(this._data),this._layout;{const i=this._data.getContext("2d");W(i);const s=i.getImageData(0,0,this.codedWidth,this.codedHeight);return hs(e).set(s.data),[{offset:0,stride:4*this.codedWidth}]}}toVideoFrame(){if(this._closed)throw new Error("VideoSample is closed.");return W(this._data!==null),du(this._data)?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0})}draw(e,n,r,i,s,o,a,l,c){let u=0,d=0,f=this.displayWidth,h=this.displayHeight,p=0,m=0,g=this.displayWidth,y=this.displayHeight;if(o!==void 0?(u=n,d=r,f=i,h=s,p=o,m=a,l!==void 0?(g=l,y=c):(g=f,y=h)):(p=n,m=r,i!==void 0&&(g=i,y=s)),!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(u))throw new TypeError("sx must be a number.");if(!Number.isFinite(d))throw new TypeError("sy must be a number.");if(!Number.isFinite(f)||f<0)throw new TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(h)||h<0)throw new TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(p))throw new TypeError("dx must be a number.");if(!Number.isFinite(m))throw new TypeError("dy must be a number.");if(!Number.isFinite(g)||g<0)throw new TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(y)||y<0)throw new TypeError("dHeight must be a non-negative number.");if(this._closed)throw new Error("VideoSample is closed.");({sx:u,sy:d,sWidth:f,sHeight:h}=this._rotateSourceRegion(u,d,f,h,this.rotation));const b=this.toCanvasImageSource();e.save();const S=p+g/2,C=m+y/2;e.translate(S,C),e.rotate(this.rotation*Math.PI/180);const _=this.rotation%180===0?1:g/y;e.scale(1/_,_),e.drawImage(b,u,d,f,h,-g/2,-y/2,g,y),e.restore()}drawWithFit(e,n){if(!(typeof CanvasRenderingContext2D<"u"&&e instanceof CanvasRenderingContext2D||typeof OffscreenCanvasRenderingContext2D<"u"&&e instanceof OffscreenCanvasRenderingContext2D))throw new TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(!["fill","contain","cover"].includes(n.fit))throw new TypeError("options.fit must be 'fill', 'contain', or 'cover'.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180, or 270.");n.crop!==void 0&&oT(n.crop,"options.");const r=e.canvas.width,i=e.canvas.height,s=n.rotation??this.rotation,[o,a]=s%180===0?[this.codedWidth,this.codedHeight]:[this.codedHeight,this.codedWidth];n.crop&&sT(n.crop,o,a);let l,c,u,d;const{sx:f,sy:h,sWidth:p,sHeight:m}=this._rotateSourceRegion(n.crop?.left??0,n.crop?.top??0,n.crop?.width??o,n.crop?.height??a,s);if(n.fit==="fill")l=0,c=0,u=r,d=i;else{const[y,b]=n.crop?[n.crop.width,n.crop.height]:[o,a],S=n.fit==="contain"?Math.min(r/y,i/b):Math.max(r/y,i/b);u=y*S,d=b*S,l=(r-u)/2,c=(i-d)/2}e.save();const g=s%180===0?1:u/d;e.translate(r/2,i/2),e.rotate(s*Math.PI/180),e.scale(1/g,g),e.translate(-r/2,-i/2),e.drawImage(this.toCanvasImageSource(),f,h,p,m,l,c,u,d),e.restore()}_rotateSourceRegion(e,n,r,i,s){return s===90?[e,n,r,i]=[n,this.codedHeight-e-r,i,r]:s===180?[e,n]=[this.codedWidth-e-r,this.codedHeight-n-i]:s===270&&([e,n,r,i]=[this.codedWidth-n-i,e,i,r]),{sx:e,sy:n,sWidth:r,sHeight:i}}toCanvasImageSource(){if(this._closed)throw new Error("VideoSample is closed.");if(W(this._data!==null),this._data instanceof Uint8Array){const e=this.toVideoFrame();return queueMicrotask(()=>e.close()),e}else return this._data}setRotation(e){if(![0,90,180,270].includes(e))throw new TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}setDuration(e){if(!Number.isFinite(e)||e<0)throw new TypeError("newDuration must be a non-negative number.");this.duration=e}[Symbol.dispose](){this.close()}}class m1{constructor(e){this.primaries=e?.primaries??null,this.transfer=e?.transfer??null,this.matrix=e?.matrix??null,this.fullRange=e?.fullRange??null}toJSON(){return{primaries:this.primaries,transfer:this.transfer,matrix:this.matrix,fullRange:this.fullRange}}}const du=t=>typeof VideoFrame<"u"&&t instanceof VideoFrame,sT=(t,e,n)=>{t.left=Math.min(t.left,e),t.top=Math.min(t.top,n),t.width=Math.min(t.width,e-t.left),t.height=Math.min(t.height,n-t.top),W(t.width>=0),W(t.height>=0)},oT=(t,e)=>{if(!t||typeof t!="object")throw new TypeError(e+"crop, when provided, must be an object.");if(!Number.isInteger(t.left)||t.left<0)throw new TypeError(e+"crop.left must be a non-negative integer.");if(!Number.isInteger(t.top)||t.top<0)throw new TypeError(e+"crop.top must be a non-negative integer.");if(!Number.isInteger(t.width)||t.width<0)throw new TypeError(e+"crop.width must be a non-negative integer.");if(!Number.isInteger(t.height)||t.height<0)throw new TypeError(e+"crop.height must be a non-negative integer.")},qP=t=>{if(!t||typeof t!="object")throw new TypeError("options must be an object.");if(t.colorSpace!==void 0&&!["display-p3","srgb"].includes(t.colorSpace))throw new TypeError("options.colorSpace, when provided, must be 'display-p3' or 'srgb'.");if(t.format!==void 0&&typeof t.format!="string")throw new TypeError("options.format, when provided, must be a string.");if(t.layout!==void 0){if(!Array.isArray(t.layout))throw new TypeError("options.layout, when provided, must be an array.");for(const e of t.layout){if(!e||typeof e!="object")throw new TypeError("Each entry in options.layout must be an object.");if(!Number.isInteger(e.offset)||e.offset<0)throw new TypeError("plane.offset must be a non-negative integer.");if(!Number.isInteger(e.stride)||e.stride<0)throw new TypeError("plane.stride must be a non-negative integer.")}}if(t.rect!==void 0){if(!t.rect||typeof t.rect!="object")throw new TypeError("options.rect, when provided, must be an object.");if(t.rect.x!==void 0&&(!Number.isInteger(t.rect.x)||t.rect.x<0))throw new TypeError("options.rect.x, when provided, must be a non-negative integer.");if(t.rect.y!==void 0&&(!Number.isInteger(t.rect.y)||t.rect.y<0))throw new TypeError("options.rect.y, when provided, must be a non-negative integer.");if(t.rect.width!==void 0&&(!Number.isInteger(t.rect.width)||t.rect.width<0))throw new TypeError("options.rect.width, when provided, must be a non-negative integer.");if(t.rect.height!==void 0&&(!Number.isInteger(t.rect.height)||t.rect.height<0))throw new TypeError("options.rect.height, when provided, must be a non-negative integer.")}},_te=(t,e,n)=>{const r=Ate(t),i=[];let s=0;for(const o of r){const a=Math.ceil(e/o.widthDivisor),l=Math.ceil(n/o.heightDivisor),c=a*o.sampleBytes,u=c*l;i.push({offset:s,stride:c}),s+=u}return i},Ate=t=>{const e=(n,r,i,s,o)=>{const a=[{sampleBytes:n,widthDivisor:1,heightDivisor:1},{sampleBytes:r,widthDivisor:i,heightDivisor:s},{sampleBytes:r,widthDivisor:i,heightDivisor:s}];return o&&a.push({sampleBytes:n,widthDivisor:1,heightDivisor:1}),a};switch(t){case"I420":return e(1,1,2,2,!1);case"I420P10":case"I420P12":return e(2,2,2,2,!1);case"I420A":return e(1,1,2,2,!0);case"I420AP10":case"I420AP12":return e(2,2,2,2,!0);case"I422":return e(1,1,2,1,!1);case"I422P10":case"I422P12":return e(2,2,2,1,!1);case"I422A":return e(1,1,2,1,!0);case"I422AP10":case"I422AP12":return e(2,2,2,1,!0);case"I444":return e(1,1,1,1,!1);case"I444P10":case"I444P12":return e(2,2,1,1,!1);case"I444A":return e(1,1,1,1,!0);case"I444AP10":case"I444AP12":return e(2,2,1,1,!0);case"NV12":return[{sampleBytes:1,widthDivisor:1,heightDivisor:1},{sampleBytes:2,widthDivisor:2,heightDivisor:2}];case"RGBA":case"RGBX":case"BGRA":case"BGRX":return[{sampleBytes:4,widthDivisor:1,heightDivisor:1}];default:Hc(t),W(!1)}},g1=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]);class Bs{get microsecondTimestamp(){return Math.trunc(pc*this.timestamp)}get microsecondDuration(){return Math.trunc(pc*this.duration)}constructor(e){if(this._closed=!1,Uh(e)){if(e.format===null)throw new TypeError("AudioData with null format is not supported.");this._data=e,this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=e.numberOfFrames,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp/1e6,this.duration=e.numberOfFrames/e.sampleRate}else{if(!e||typeof e!="object")throw new TypeError("Invalid AudioDataInit: must be an object.");if(!g1.has(e.format))throw new TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(e.sampleRate)||e.sampleRate<=0)throw new TypeError("Invalid AudioDataInit: sampleRate must be > 0.");if(!Number.isInteger(e.numberOfChannels)||e.numberOfChannels===0)throw new TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(e?.timestamp))throw new TypeError("init.timestamp must be a number.");const n=e.data.byteLength/(Su(e.format)*e.numberOfChannels);if(!Number.isInteger(n))throw new TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");this.format=e.format,this.sampleRate=e.sampleRate,this.numberOfFrames=n,this.numberOfChannels=e.numberOfChannels,this.timestamp=e.timestamp,this.duration=n/e.sampleRate;let r;if(e.data instanceof ArrayBuffer)r=new Uint8Array(e.data);else if(ArrayBuffer.isView(e.data))r=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);else throw new TypeError("Invalid AudioDataInit: data is not a BufferSource.");const i=this.numberOfFrames*this.numberOfChannels*Su(this.format);if(r.byteLength<i)throw new TypeError("Invalid AudioDataInit: insufficient data size.");this._data=r}im?.register(this,{type:"audio",data:this._data},this)}allocationSize(e){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(e.format!==void 0&&!g1.has(e.format))throw new TypeError("Invalid format.");if(e.frameOffset!==void 0&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(e.frameCount!==void 0&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const n=e.format??this.format,r=e.frameOffset??0;if(r>=this.numberOfFrames)throw new RangeError("frameOffset out of range");const i=e.frameCount!==void 0?e.frameCount:this.numberOfFrames-r;if(i>this.numberOfFrames-r)throw new RangeError("frameCount out of range");const s=Su(n),o=Yd(n);if(o&&e.planeIndex>=this.numberOfChannels)throw new RangeError("planeIndex out of range");if(!o&&e.planeIndex!==0)throw new RangeError("planeIndex out of range");return(o?i:i*this.numberOfChannels)*s}copyTo(e,n){if(!dw(e))throw new TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(!Number.isInteger(n.planeIndex)||n.planeIndex<0)throw new TypeError("planeIndex must be a non-negative integer.");if(n.format!==void 0&&!g1.has(n.format))throw new TypeError("Invalid format.");if(n.frameOffset!==void 0&&(!Number.isInteger(n.frameOffset)||n.frameOffset<0))throw new TypeError("frameOffset must be a non-negative integer.");if(n.frameCount!==void 0&&(!Number.isInteger(n.frameCount)||n.frameCount<0))throw new TypeError("frameCount must be a non-negative integer.");if(this._closed)throw new Error("AudioSample is closed.");const{planeIndex:r,format:i,frameCount:s,frameOffset:o}=n,a=this.format,l=i??this.format;if(!l)throw new Error("Destination format not determined");const c=this.numberOfFrames,u=this.numberOfChannels,d=o??0;if(d>=c)throw new RangeError("frameOffset out of range");const f=s!==void 0?s:c-d;if(f>c-d)throw new RangeError("frameCount out of range");const h=Su(l),p=Yd(l);if(p&&r>=u)throw new RangeError("planeIndex out of range");if(!p&&r!==0)throw new RangeError("planeIndex out of range");const g=(p?f:f*u)*h;if(e.byteLength<g)throw new RangeError("Destination buffer is too small");const y=jn(e),b=ED(l);if(Uh(this._data))Sp()&&u>2&&l!==a?Pte(this._data,y,a,l,u,r,d,f):this._data.copyTo(e,{planeIndex:r,frameOffset:d,frameCount:f,format:l});else{const S=this._data,C=jn(S),_=kD(a),x=Su(a),I=Yd(a);for(let k=0;k<f;k++)if(p){const T=k*h;let P;I?P=(r*c+(k+d))*x:P=((k+d)*u+r)*x;const O=_(C,P);b(y,T,O)}else for(let T=0;T<u;T++){const O=(k*u+T)*h;let D;I?D=(T*c+(k+d))*x:D=((k+d)*u+T)*x;const F=_(C,D);b(y,O,F)}}}clone(){if(this._closed)throw new Error("AudioSample is closed.");if(Uh(this._data)){const e=new Bs(this._data.clone());return e.setTimestamp(this.timestamp),e}else return new Bs({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data})}close(){this._closed||(im?.unregister(this),Uh(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}toAudioData(){if(this._closed)throw new Error("AudioSample is closed.");if(Uh(this._data)){if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(Yd(this.format)){const e=this.allocationSize({planeIndex:0,format:this.format}),n=new ArrayBuffer(e*this.numberOfChannels);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(new Uint8Array(n,r*e,e),{planeIndex:r,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:n})}else{const e=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(e,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:e})}}else return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data.buffer instanceof ArrayBuffer?this._data.buffer:this._data.slice()})}toAudioBuffer(){if(this._closed)throw new Error("AudioSample is closed.");const e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),n=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4);for(let r=0;r<this.numberOfChannels;r++)this.copyTo(n,{planeIndex:r,format:"f32-planar"}),e.copyToChannel(n,r);return e}setTimestamp(e){if(!Number.isFinite(e))throw new TypeError("newTimestamp must be a number.");this.timestamp=e}[Symbol.dispose](){this.close()}static*_fromAudioBuffer(e,n){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const r=48e3*5,i=e.numberOfChannels,s=e.sampleRate,o=e.length,a=Math.floor(r/i);let l=0,c=o;for(;c>0;){const u=Math.min(a,c),d=new Float32Array(i*u);for(let f=0;f<i;f++)e.copyFromChannel(d.subarray(f*u,(f+1)*u),f,l);yield new Bs({format:"f32-planar",sampleRate:s,numberOfFrames:u,numberOfChannels:i,timestamp:n+l/s,data:d}),l+=u,c-=u}}static fromAudioBuffer(e,n){if(!(e instanceof AudioBuffer))throw new TypeError("audioBuffer must be an AudioBuffer.");const r=48e3*5,i=e.numberOfChannels,s=e.sampleRate,o=e.length,a=Math.floor(r/i);let l=0,c=o;const u=[];for(;c>0;){const d=Math.min(a,c),f=new Float32Array(i*d);for(let p=0;p<i;p++)e.copyFromChannel(f.subarray(p*d,(p+1)*d),p,l);const h=new Bs({format:"f32-planar",sampleRate:s,numberOfFrames:d,numberOfChannels:i,timestamp:n+l/s,data:f});u.push(h),l+=d,c-=d}return u}}const Su=t=>{switch(t){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":return 4;case"f32":case"f32-planar":return 4;default:throw new Error("Unknown AudioSampleFormat")}},Yd=t=>{switch(t){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},kD=t=>{switch(t){case"u8":case"u8-planar":return(e,n)=>(e.getUint8(n)-128)/128;case"s16":case"s16-planar":return(e,n)=>e.getInt16(n,!0)/32768;case"s32":case"s32-planar":return(e,n)=>e.getInt32(n,!0)/2147483648;case"f32":case"f32-planar":return(e,n)=>e.getFloat32(n,!0)}},ED=t=>{switch(t){case"u8":case"u8-planar":return(e,n,r)=>e.setUint8(n,zr((r+1)*127.5,0,255));case"s16":case"s16-planar":return(e,n,r)=>e.setInt16(n,zr(Math.round(r*32767),-32768,32767),!0);case"s32":case"s32-planar":return(e,n,r)=>e.setInt32(n,zr(Math.round(r*2147483647),-2147483648,2147483647),!0);case"f32":case"f32-planar":return(e,n,r)=>e.setFloat32(n,r,!0)}},Uh=t=>typeof AudioData<"u"&&t instanceof AudioData,Pte=(t,e,n,r,i,s,o,a)=>{const l=kD(n),c=ED(r),u=Su(n),d=Su(r),f=Yd(n);if(Yd(r))if(f){const p=new ArrayBuffer(a*u),m=jn(p);t.copyTo(p,{planeIndex:s,frameOffset:o,frameCount:a,format:n});for(let g=0;g<a;g++){const y=g*u,b=g*d,S=l(m,y);c(e,b,S)}}else{const p=new ArrayBuffer(a*i*u),m=jn(p);t.copyTo(p,{planeIndex:0,frameOffset:o,frameCount:a,format:n});for(let g=0;g<a;g++){const y=(g*i+s)*u,b=g*d,S=l(m,y);c(e,b,S)}}else if(f){const p=a*u,m=new ArrayBuffer(p),g=jn(m);for(let y=0;y<i;y++){t.copyTo(m,{planeIndex:y,frameOffset:o,frameCount:a,format:n});for(let b=0;b<a;b++){const S=b*u,C=(b*i+y)*d,_=l(g,S);c(e,C,_)}}}else{const p=new ArrayBuffer(a*i*u),m=jn(p);t.copyTo(p,{planeIndex:0,frameOffset:o,frameCount:a,format:n});for(let g=0;g<a;g++)for(let y=0;y<i;y++){const b=g*i+y,S=b*u,C=b*d,_=l(m,S);c(e,C,_)}}};const Md=t=>{if(!t||typeof t!="object")throw new TypeError("options must be an object.");if(t.metadataOnly!==void 0&&typeof t.metadataOnly!="boolean")throw new TypeError("options.metadataOnly, when defined, must be a boolean.");if(t.verifyKeyPackets!==void 0&&typeof t.verifyKeyPackets!="boolean")throw new TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(t.verifyKeyPackets&&t.metadataOnly)throw new TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},_c=t=>{if(!oD(t))throw new TypeError("timestamp must be a number.")},y1=(t,e,n)=>n.verifyKeyPackets?e.then(async r=>{if(!r||r.type==="delta")return r;const i=await t.determinePacketType(r);return i&&(r.type=i),r}):e;class sm{constructor(e){if(!(e instanceof lT))throw new TypeError("track must be an InputTrack.");this._track=e}getFirstPacket(e={}){if(Md(e),this._track.input._disposed)throw new ss;return y1(this._track,this._track._backing.getFirstPacket(e),e)}getPacket(e,n={}){if(_c(e),Md(n),this._track.input._disposed)throw new ss;return y1(this._track,this._track._backing.getPacket(e,n),n)}getNextPacket(e,n={}){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(Md(n),this._track.input._disposed)throw new ss;return y1(this._track,this._track._backing.getNextPacket(e,n),n)}async getKeyPacket(e,n={}){if(_c(e),Md(n),this._track.input._disposed)throw new ss;if(!n.verifyKeyPackets)return this._track._backing.getKeyPacket(e,n);const r=await this._track._backing.getKeyPacket(e,n);return r&&(W(r.type==="key"),await this._track.determinePacketType(r)==="delta"?this.getKeyPacket(r.timestamp-1/this._track.timeResolution,n):r)}async getNextKeyPacket(e,n={}){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(Md(n),this._track.input._disposed)throw new ss;if(!n.verifyKeyPackets)return this._track._backing.getNextKeyPacket(e,n);const r=await this._track._backing.getNextKeyPacket(e,n);return r&&(W(r.type==="key"),await this._track.determinePacketType(r)==="delta"?this.getNextKeyPacket(r,n):r)}packets(e,n,r={}){if(e!==void 0&&!(e instanceof Mn))throw new TypeError("startPacket must be an EncodedPacket.");if(e!==void 0&&e.isMetadataOnly&&!r?.metadataOnly)throw new TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(n!==void 0&&!(n instanceof Mn))throw new TypeError("endPacket must be an EncodedPacket.");if(Md(r),this._track.input._disposed)throw new ss;const i=[];let{promise:s,resolve:o}=ai(),{promise:a,resolve:l}=ai(),c=!1,u=!1,d=null;const f=[],h=()=>Math.max(2,f.length);(async()=>{let m=e??await this.getFirstPacket(r);for(;m&&!u&&!this._track.input._disposed&&!(n&&m.sequenceNumber>=n?.sequenceNumber);){if(i.length>h()){({promise:a,resolve:l}=ai()),await a;continue}i.push(m),o(),{promise:s,resolve:o}=ai(),m=await this.getNextPacket(m,r)}c=!0,o()})().catch(m=>{d||(d=m,o())});const p=this._track;return{async next(){for(;;){if(p.input._disposed)throw new ss;if(u)return{value:void 0,done:!0};if(d)throw d;if(i.length>0){const m=i.shift(),g=performance.now();for(f.push(g);f.length>0&&g-f[0]>=1e3;)f.shift();return l(),{value:m,done:!1}}else{if(c)return{value:void 0,done:!0};await s}}},async return(){return u=!0,l(),o(),{value:void 0,done:!0}},async throw(m){throw m},[Symbol.asyncIterator](){return this}}}}class aT{constructor(e,n){this.onSample=e,this.onError=n}}class TD{mediaSamplesInRange(e=0,n=1/0){_c(e),_c(n);const r=[];let i=!1,s=null,{promise:o,resolve:a}=ai(),{promise:l,resolve:c}=ai(),u=!1,d=!1,f=!1,h=null;(async()=>{const g=await this._createDecoder(x=>{if(c(),x.timestamp>=n&&(d=!0),d){x.close();return}s&&(x.timestamp>e?(r.push(s),i=!0):s.close()),x.timestamp>=e&&(r.push(x),i=!0),s=i?null:x,r.length>0&&(a(),{promise:o,resolve:a}=ai())},x=>{h||(h=x,a())}),y=this._createPacketSink(),b=await y.getKeyPacket(e,{verifyKeyPackets:!0})??await y.getFirstPacket();let S=b;const _=y.packets(b??void 0,void 0);for(await _.next();S&&!d&&!this._track.input._disposed;){const x=KP(r.length);if(r.length+g.getDecodeQueueSize()>x){({promise:l,resolve:c}=ai()),await l;continue}g.decode(S);const I=await _.next();if(I.done)break;S=I.value}await _.return(),!f&&!this._track.input._disposed&&await g.flush(),g.close(),!i&&s&&r.push(s),u=!0,a()})().catch(g=>{h||(h=g,a())});const p=this._track,m=()=>{s?.close();for(const g of r)g.close()};return{async next(){for(;;){if(p.input._disposed)throw m(),new ss;if(f)return{value:void 0,done:!0};if(h)throw m(),h;if(r.length>0){const g=r.shift();return c(),{value:g,done:!1}}else if(!u)await o;else return{value:void 0,done:!0}}},async return(){return f=!0,d=!0,c(),a(),m(),{value:void 0,done:!0}},async throw(g){throw g},[Symbol.asyncIterator](){return this}}}mediaSamplesAtTimestamps(e){Lee(e);const n=Dee(e),r=[],i=[];let{promise:s,resolve:o}=ai(),{promise:a,resolve:l}=ai(),c=!1,u=!1,d=null;const f=m=>{i.push(m),o(),{promise:s,resolve:o}=ai()};(async()=>{const m=await this._createDecoder(x=>{if(l(),u){x.close();return}let I=0;for(;r.length>0&&x.timestamp-r[0]>-1e-10;)I++,r.shift();if(I>0)for(let k=0;k<I;k++)f(k<I-1?x.clone():x);else x.close()},x=>{d||(d=x,o())}),g=this._createPacketSink();let y=null,b=null,S=-1;const C=async()=>{W(b);let x=b;for(m.decode(x);x.sequenceNumber<S;){const I=KP(i.length);for(;i.length+m.getDecodeQueueSize()>I&&!u;)({promise:a,resolve:l}=ai()),await a;if(u)break;const k=await g.getNextPacket(x);W(k),m.decode(k),x=k}S=-1},_=async()=>{await m.flush();for(let x=0;x<r.length;x++)f(null);r.length=0};for await(const x of n){if(_c(x),u||this._track.input._disposed)break;const I=await g.getPacket(x),k=I&&await g.getKeyPacket(x,{verifyKeyPackets:!0});if(!k){S!==-1&&(await C(),await _()),f(null),y=null;continue}y&&(k.sequenceNumber!==b.sequenceNumber||I.timestamp<y.timestamp)&&(await C(),await _()),r.push(I.timestamp),S=Math.max(I.sequenceNumber,S),y=I,b=k}!u&&!this._track.input._disposed&&(S!==-1&&await C(),await _()),m.close(),c=!0,o()})().catch(m=>{d||(d=m,o())});const h=this._track,p=()=>{for(const m of i)m?.close()};return{async next(){for(;;){if(h.input._disposed)throw p(),new ss;if(u)return{value:void 0,done:!0};if(d)throw p(),d;if(i.length>0){const m=i.shift();return W(m!==void 0),l(),{value:m,done:!1}}else if(!c)await s;else return{value:void 0,done:!0}}},async return(){return u=!0,l(),o(),p(),{value:void 0,done:!0}},async throw(m){throw m},[Symbol.asyncIterator](){return this}}}}const KP=t=>t===0?40:8;class Ite extends aT{constructor(e,n,r,i,s,o){super(e,n),this.codec=r,this.decoderConfig=i,this.rotation=s,this.timeResolution=o,this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new hw,this.customDecoderQueueSize=0,this.inputTimestamps=[],this.sampleQueue=[],this.currentPacketIndex=0,this.raslSkipped=!1,this.alphaDecoder=null,this.alphaHadKeyframe=!1,this.colorQueue=[],this.alphaQueue=[],this.merger=null,this.mergerCreationFailed=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue=[],this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1;const a=vD.find(l=>l.supports(r,i));if(a)this.customDecoder=new a,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=l=>{if(!(l instanceof _i))throw new TypeError("The argument passed to onSample must be a VideoSample.");this.finalizeAndEmitSample(l)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const l=u=>{if(this.alphaQueue.length>0){const d=this.alphaQueue.shift();W(d!==void 0),this.mergeAlpha(u,d)}else this.colorQueue.push(u)};if(r==="avc"&&this.decoderConfig.description&&$x()){const u=ute(hs(this.decoderConfig.description));if(u&&u.sequenceParameterSets.length>0){const d=nT(u.sequenceParameterSets[0]);d&&d.frameMbsOnlyFlag===0&&(this.decoderConfig={...this.decoderConfig,hardwareAcceleration:"prefer-software"})}}const c=new Error("Decoding error").stack;this.decoder=new VideoDecoder({output:u=>{try{l(u)}catch(d){this.onError(d)}},error:u=>{u.stack=c,this.onError(u)}}),this.decoder.configure(this.decoderConfig)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(W(this.decoder),Math.max(this.decoder.decodeQueueSize,this.alphaDecoder?.decodeQueueSize??0))}decode(e){if(this.codec==="hevc"&&this.currentPacketIndex>0&&!this.raslSkipped){if(this.hasHevcRaslPicture(e.data))return;this.raslSkipped=!0}if(this.customDecoder)this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--);else{if(W(this.decoder),Sp()||DP(this.inputTimestamps,e.timestamp,n=>n),$x()&&this.currentPacketIndex===0&&this.codec==="avc"){const n=[];for(const i of fD(e.data,this.decoderConfig)){const s=mw(e.data[i.offset]);s>=20&&s<=31||n.push(e.data.subarray(i.offset,i.offset+i.length))}const r=lte(n,this.decoderConfig);e=new Mn(r,e.type,e.timestamp,e.duration)}this.decoder.decode(e.toEncodedVideoChunk()),this.decodeAlphaData(e)}this.currentPacketIndex++}decodeAlphaData(e){if(!e.sideData.alpha||this.mergerCreationFailed){this.pushNullAlphaFrame();return}if(!this.merger)try{this.merger=new Ote}catch(r){console.error("Due to an error, only color data will be decoded.",r),this.mergerCreationFailed=!0,this.decodeAlphaData(e);return}if(!this.alphaDecoder){const r=s=>{if(this.alphaDecoderQueueSize--,this.colorQueue.length>0){const o=this.colorQueue.shift();W(o!==void 0),this.mergeAlpha(o,s)}else this.alphaQueue.push(s);for(this.decodedAlphaChunkCount++;this.nullAlphaFrameQueue.length>0&&this.nullAlphaFrameQueue[0]===this.decodedAlphaChunkCount;)if(this.nullAlphaFrameQueue.shift(),this.colorQueue.length>0){const o=this.colorQueue.shift();W(o!==void 0),this.mergeAlpha(o,null)}else this.alphaQueue.push(null)},i=new Error("Decoding error").stack;this.alphaDecoder=new VideoDecoder({output:s=>{try{r(s)}catch(o){this.onError(o)}},error:s=>{s.stack=i,this.onError(s)}}),this.alphaDecoder.configure(this.decoderConfig)}const n=iT(this.codec,this.decoderConfig,e.sideData.alpha);if(this.alphaHadKeyframe||(this.alphaHadKeyframe=n==="key"),this.alphaHadKeyframe){if(this.codec==="hevc"&&this.currentAlphaPacketIndex>0&&!this.alphaRaslSkipped){if(this.hasHevcRaslPicture(e.sideData.alpha)){this.pushNullAlphaFrame();return}this.alphaRaslSkipped=!0}this.currentAlphaPacketIndex++,this.alphaDecoder.decode(e.alphaToEncodedVideoChunk(n??e.type)),this.alphaDecoderQueueSize++}else this.pushNullAlphaFrame()}pushNullAlphaFrame(){this.alphaDecoderQueueSize===0?this.alphaQueue.push(null):this.nullAlphaFrameQueue.push(this.decodedAlphaChunkCount+this.alphaDecoderQueueSize)}hasHevcRaslPicture(e){for(const n of pD(e,this.decoderConfig)){const r=rm(e[n.offset]);if(r===li.RASL_N||r===li.RASL_R)return!0}return!1}sampleHandler(e){if(Sp()){if(this.sampleQueue.length>0&&e.timestamp>=Wn(this.sampleQueue).timestamp){for(const n of this.sampleQueue)this.finalizeAndEmitSample(n);this.sampleQueue.length=0}DP(this.sampleQueue,e,n=>n.timestamp)}else{const n=this.inputTimestamps.shift();W(n!==void 0),e.setTimestamp(n),this.finalizeAndEmitSample(e)}}finalizeAndEmitSample(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}mergeAlpha(e,n){if(!n){const s=new _i(e);this.sampleHandler(s);return}W(this.merger),this.merger.update(e,n),e.close(),n.close();const r=new VideoFrame(this.merger.canvas,{timestamp:e.timestamp,duration:e.duration??void 0}),i=new _i(r);this.sampleHandler(i)}async flush(){if(this.customDecoder?await this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(W(this.decoder),await Promise.all([this.decoder.flush(),this.alphaDecoder?.flush()]),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.alphaHadKeyframe=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue.length=0,this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1),Sp()){for(const e of this.sampleQueue)this.finalizeAndEmitSample(e);this.sampleQueue.length=0}this.currentPacketIndex=0,this.raslSkipped=!1}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(W(this.decoder),this.decoder.close(),this.alphaDecoder?.close(),this.colorQueue.forEach(e=>e.close()),this.colorQueue.length=0,this.alphaQueue.forEach(e=>e?.close()),this.alphaQueue.length=0,this.merger?.close());for(const e of this.sampleQueue)e.close();this.sampleQueue.length=0}}class Ote{constructor(){typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(300,150):this.canvas=document.createElement("canvas");const e=this.canvas.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=e,this.program=this.createProgram(),this.vao=this.createVAO(),this.colorTexture=this.createTexture(),this.alphaTexture=this.createTexture(),this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_colorTexture"),0),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_alphaTexture"),1)}createProgram(){const e=this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_colorTexture;
			uniform sampler2D u_alphaTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec3 color = texture(u_colorTexture, v_texCoord).rgb;
				float alpha = texture(u_alphaTexture, v_texCoord).r;
				fragColor = vec4(color, alpha);
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createShader(e,n){const r=this.gl.createShader(e);return this.gl.shaderSource(r,n),this.gl.compileShader(r),r}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const n=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(this.program,"a_position"),s=this.gl.getAttribLocation(this.program,"a_texCoord");return this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}update(e,n){(e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.alphaTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class Wx extends TD{constructor(e){if(!(e instanceof ph))throw new TypeError("videoTrack must be an InputVideoTrack.");super(),this._track=e}async _createDecoder(e,n){if(!await this._track.canDecode())throw new Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._track.codec,i=this._track.rotation,s=await this._track.getDecoderConfig(),o=this._track.timeResolution;return W(r&&s),new Ite(e,n,r,s,i,o)}_createPacketSink(){return new sm(this._track)}async getSample(e){_c(e);for await(const n of this.mediaSamplesAtTimestamps([e]))return n;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,n=1/0){return this.mediaSamplesInRange(e,n)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class Mte{constructor(e,n={}){if(this._nextCanvasIndex=0,!(e instanceof ph))throw new TypeError("videoTrack must be an InputVideoTrack.");if(n&&typeof n!="object")throw new TypeError("options must be an object.");if(n.alpha!==void 0&&typeof n.alpha!="boolean")throw new TypeError("options.alpha, when provided, must be a boolean.");if(n.width!==void 0&&(!Number.isInteger(n.width)||n.width<=0))throw new TypeError("options.width, when defined, must be a positive integer.");if(n.height!==void 0&&(!Number.isInteger(n.height)||n.height<=0))throw new TypeError("options.height, when defined, must be a positive integer.");if(n.fit!==void 0&&!["fill","contain","cover"].includes(n.fit))throw new TypeError('options.fit, when provided, must be one of "fill", "contain", or "cover".');if(n.width!==void 0&&n.height!==void 0&&n.fit===void 0)throw new TypeError("When both options.width and options.height are provided, options.fit must also be provided.");if(n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError("options.rotation, when provided, must be 0, 90, 180 or 270.");if(n.crop!==void 0&&oT(n.crop,"options."),n.poolSize!==void 0&&(typeof n.poolSize!="number"||!Number.isInteger(n.poolSize)||n.poolSize<0))throw new TypeError("poolSize must be a non-negative integer.");const r=n.rotation??e.rotation,[i,s]=r%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],o=n.crop;o&&sT(o,i,s);let[a,l]=o?[o.width,o.height]:[i,s];const c=a/l;n.width!==void 0&&n.height===void 0?(a=n.width,l=Math.round(a/c)):n.width===void 0&&n.height!==void 0?(l=n.height,a=Math.round(l*c)):n.width!==void 0&&n.height!==void 0&&(a=n.width,l=n.height),this._videoTrack=e,this._alpha=n.alpha??!1,this._width=a,this._height=l,this._rotation=r,this._crop=o,this._fit=n.fit??"fill",this._videoSampleSink=new Wx(e),this._canvasPool=Array.from({length:n.poolSize??0},()=>null)}_videoSampleToWrappedCanvas(e){let n=this._canvasPool[this._nextCanvasIndex],r=!1;n||(typeof document<"u"?(n=document.createElement("canvas"),n.width=this._width,n.height=this._height):n=new OffscreenCanvas(this._width,this._height),this._canvasPool.length>0&&(this._canvasPool[this._nextCanvasIndex]=n),r=!0),this._canvasPool.length>0&&(this._nextCanvasIndex=(this._nextCanvasIndex+1)%this._canvasPool.length);const i=n.getContext("2d",{alpha:this._alpha||qf()});W(i),i.resetTransform(),r||(!this._alpha&&qf()?(i.fillStyle="black",i.fillRect(0,0,this._width,this._height)):i.clearRect(0,0,this._width,this._height)),e.drawWithFit(i,{fit:this._fit,rotation:this._rotation,crop:this._crop});const s={canvas:n,timestamp:e.timestamp,duration:e.duration};return e.close(),s}async getCanvas(e){_c(e);const n=await this._videoSampleSink.getSample(e);return n&&this._videoSampleToWrappedCanvas(n)}canvases(e=0,n=1/0){return LP(this._videoSampleSink.samples(e,n),r=>this._videoSampleToWrappedCanvas(r))}canvasesAtTimestamps(e){return LP(this._videoSampleSink.samplesAtTimestamps(e),n=>n&&this._videoSampleToWrappedCanvas(n))}}class Nte extends aT{constructor(e,n,r,i){super(e,n),this.decoder=null,this.customDecoder=null,this.customDecoderCallSerializer=new hw,this.customDecoderQueueSize=0,this.currentTimestamp=null;const s=a=>{(this.currentTimestamp===null||Math.abs(a.timestamp-this.currentTimestamp)>=a.duration)&&(this.currentTimestamp=a.timestamp);const l=this.currentTimestamp;if(this.currentTimestamp+=a.duration,a.numberOfFrames===0){a.close();return}const c=i.sampleRate;a.setTimestamp(Math.round(l*c)/c),e(a)},o=xD.find(a=>a.supports(r,i));if(o)this.customDecoder=new o,this.customDecoder.codec=r,this.customDecoder.config=i,this.customDecoder.onSample=a=>{if(!(a instanceof Bs))throw new TypeError("The argument passed to onSample must be an AudioSample.");s(a)},this.customDecoderCallSerializer.call(()=>this.customDecoder.init());else{const a=new Error("Decoding error").stack;this.decoder=new AudioDecoder({output:l=>{try{s(new Bs(l))}catch(c){this.onError(c)}},error:l=>{l.stack=a,this.onError(l)}}),this.decoder.configure(i)}}getDecodeQueueSize(){return this.customDecoder?this.customDecoderQueueSize:(W(this.decoder),this.decoder.decodeQueueSize)}decode(e){this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(()=>this.customDecoder.decode(e)).then(()=>this.customDecoderQueueSize--)):(W(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}flush(){return this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.flush()):(W(this.decoder),this.decoder.flush())}close(){this.customDecoder?this.customDecoderCallSerializer.call(()=>this.customDecoder.close()):(W(this.decoder),this.decoder.close())}}class Rte extends aT{constructor(e,n,r){super(e,n),this.decoderConfig=r,this.currentTimestamp=null,W(Pi.includes(r.codec)),this.codec=r.codec;const{dataType:i,sampleSize:s,littleEndian:o}=eu(this.codec);switch(this.inputSampleSize=s,s){case 1:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint8(l)-2**7:i==="signed"?this.readInputValue=(a,l)=>a.getInt8(l):i==="ulaw"?this.readInputValue=(a,l)=>kte(a.getUint8(l)):i==="alaw"?this.readInputValue=(a,l)=>Tte(a.getUint8(l)):W(!1);break;case 2:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint16(l,o)-2**15:i==="signed"?this.readInputValue=(a,l)=>a.getInt16(l,o):W(!1);break;case 3:i==="unsigned"?this.readInputValue=(a,l)=>fw(a,l,o)-2**23:i==="signed"?this.readInputValue=(a,l)=>Bee(a,l,o):W(!1);break;case 4:i==="unsigned"?this.readInputValue=(a,l)=>a.getUint32(l,o)-2**31:i==="signed"?this.readInputValue=(a,l)=>a.getInt32(l,o):i==="float"?this.readInputValue=(a,l)=>a.getFloat32(l,o):W(!1);break;case 8:i==="float"?this.readInputValue=(a,l)=>a.getFloat64(l,o):W(!1);break;default:Hc(s),W(!1)}switch(s){case 1:i==="ulaw"||i==="alaw"?(this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(a,l,c)=>a.setInt16(l,c,!0)):(this.outputSampleSize=1,this.outputFormat="u8",this.writeOutputValue=(a,l,c)=>a.setUint8(l,c+2**7));break;case 2:this.outputSampleSize=2,this.outputFormat="s16",this.writeOutputValue=(a,l,c)=>a.setInt16(l,c,!0);break;case 3:this.outputSampleSize=4,this.outputFormat="s32",this.writeOutputValue=(a,l,c)=>a.setInt32(l,c<<8,!0);break;case 4:this.outputSampleSize=4,i==="float"?(this.outputFormat="f32",this.writeOutputValue=(a,l,c)=>a.setFloat32(l,c,!0)):(this.outputFormat="s32",this.writeOutputValue=(a,l,c)=>a.setInt32(l,c,!0));break;case 8:this.outputSampleSize=4,this.outputFormat="f32",this.writeOutputValue=(a,l,c)=>a.setFloat32(l,c,!0);break;default:Hc(s),W(!1)}}getDecodeQueueSize(){return 0}decode(e){const n=jn(e.data),r=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,i=r*this.decoderConfig.numberOfChannels*this.outputSampleSize,s=new ArrayBuffer(i),o=new DataView(s);for(let u=0;u<r*this.decoderConfig.numberOfChannels;u++){const d=u*this.inputSampleSize,f=u*this.outputSampleSize,h=this.readInputValue(n,d);this.writeOutputValue(o,f,h)}const a=r/this.decoderConfig.sampleRate;(this.currentTimestamp===null||Math.abs(e.timestamp-this.currentTimestamp)>=a)&&(this.currentTimestamp=e.timestamp);const l=this.currentTimestamp;this.currentTimestamp+=a;const c=new Bs({format:this.outputFormat,data:s,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:r,timestamp:l});this.onSample(c)}async flush(){}close(){}}class GP extends TD{constructor(e){if(!(e instanceof ca))throw new TypeError("audioTrack must be an InputAudioTrack.");super(),this._track=e}async _createDecoder(e,n){if(!await this._track.canDecode())throw new Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");const r=this._track.codec,i=await this._track.getDecoderConfig();return W(r&&i),Pi.includes(i.codec)?new Rte(e,n,i):new Nte(e,n,r,i)}_createPacketSink(){return new sm(this._track)}async getSample(e){_c(e);for await(const n of this.mediaSamplesAtTimestamps([e]))return n;throw new Error("Internal error: Iterator returned nothing.")}samples(e=0,n=1/0){return this.mediaSamplesInRange(e,n)}samplesAtTimestamps(e){return this.mediaSamplesAtTimestamps(e)}}class lT{constructor(e,n){this.input=e,this._backing=n}isVideoTrack(){return this instanceof ph}isAudioTrack(){return this instanceof ca}get id(){return this._backing.getId()}get internalCodecId(){return this._backing.getInternalCodecId()}get languageCode(){return this._backing.getLanguageCode()}get name(){return this._backing.getName()}get timeResolution(){return this._backing.getTimeResolution()}get disposition(){return this._backing.getDisposition()}getFirstTimestamp(){return this._backing.getFirstTimestamp()}computeDuration(){return this._backing.computeDuration()}async computePacketStats(e=1/0){const n=new sm(this);let r=1/0,i=-1/0,s=0,o=0;for await(const a of n.packets(void 0,void 0,{metadataOnly:!0})){if(s>=e&&a.timestamp>=i)break;r=Math.min(r,a.timestamp),i=Math.max(i,a.timestamp+a.duration),s++,o+=a.byteLength}return{packetCount:s,averagePacketRate:s?Number((s/(i-r)).toPrecision(16)):0,averageBitrate:s?Number((8*o/(i-r)).toPrecision(16)):0}}}class ph extends lT{constructor(e,n){super(e,n),this._backing=n}get type(){return"video"}get codec(){return this._backing.getCodec()}get codedWidth(){return this._backing.getCodedWidth()}get codedHeight(){return this._backing.getCodedHeight()}get rotation(){return this._backing.getRotation()}get displayWidth(){return this._backing.getRotation()%180===0?this._backing.getCodedWidth():this._backing.getCodedHeight()}get displayHeight(){return this._backing.getRotation()%180===0?this._backing.getCodedHeight():this._backing.getCodedWidth()}getColorSpace(){return this._backing.getColorSpace()}async hasHighDynamicRange(){const e=await this._backing.getColorSpace();return e.primaries==="bt2020"||e.primaries==="smpte432"||e.transfer==="pg"||e.transfer==="hlg"||e.matrix==="bt2020-ncl"}canBeTransparent(){return this._backing.canBeTransparent()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const n=this._backing.getCodec();return W(n!==null),vD.some(i=>i.supports(n,e))?!0:typeof VideoDecoder>"u"?!1:(await VideoDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("packet must not be metadata-only to determine its type.");if(this.codec===null)return null;const n=await this.getDecoderConfig();return W(n),iT(this.codec,n,e.data)}}class ca extends lT{constructor(e,n){super(e,n),this._backing=n}get type(){return"audio"}get codec(){return this._backing.getCodec()}get numberOfChannels(){return this._backing.getNumberOfChannels()}get sampleRate(){return this._backing.getSampleRate()}getDecoderConfig(){return this._backing.getDecoderConfig()}async getCodecParameterString(){return(await this._backing.getDecoderConfig())?.codec??null}async canDecode(){try{const e=await this._backing.getDecoderConfig();if(!e)return!1;const n=this._backing.getCodec();return W(n!==null),xD.some(r=>r.supports(n,e))||e.codec.startsWith("pcm-")?!0:typeof AudioDecoder>"u"?!1:(await AudioDecoder.isConfigSupported(e)).supported===!0}catch(e){return console.error("Error during decodability check:",e),!1}}async determinePacketType(e){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");return this.codec===null?null:"key"}}const CD=t=>{let n=(t.hasVideo?"video/":t.hasAudio?"audio/":"application/")+(t.isQuickTime?"quicktime":"mp4");if(t.codecStrings.length>0){const r=[...new Set(t.codecStrings)];n+=`; codecs="${r.join(", ")}"`}return n};const Ha=8,_u=16,nc=t=>{let e=nt(t);const n=Gr(t,4);let r=8;e===1&&(e=Xs(t),r=16);const s=e-r;return s<0?null:{name:n,totalSize:e,headerSize:r,contentSize:s}},fu=t=>Pu(t)/65536,b1=t=>Pu(t)/1073741824,w1=t=>{let e=0;for(let n=0;n<4;n++){e<<=7;const r=mt(t);if(e|=r&127,(r&128)===0)break}return e},So=t=>{let e=Fr(t);return t.skip(2),e=Math.min(e,t.remainingLength),zs.decode(Ct(t,e))},Dte=t=>{const e=nc(t);if(!e||e.name!=="data"||t.remainingLength<8)return null;const n=nt(t);t.skip(4);const r=Ct(t,e.contentSize-8);switch(n){case 1:return zs.decode(r);case 2:return new TextDecoder("utf-16be").decode(r);case 13:return new wf(r,"image/jpeg");case 14:return new wf(r,"image/png");case 27:return new wf(r,"image/bmp");default:return r}};class Lte extends tu{constructor(e){super(e),this.moovSlice=null,this.currentTrack=null,this.tracks=[],this.metadataPromise=null,this.movieTimescale=-1,this.movieDurationInTimescale=-1,this.isQuickTime=!1,this.metadataTags={},this.currentMetadataKeys=null,this.isFragmented=!1,this.fragmentTrackDefaults=[],this.currentFragment=null,this.lastReadFragment=null,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getTracks(){return await this.readMetadata(),this.tracks.map(e=>e.inputTrack)}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(n=>n.inputTrack.getCodecParameterString()));return CD({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some(n=>n.info?.type==="video"),hasAudio:this.tracks.some(n=>n.info?.type==="audio"),codecStrings:e.filter(Boolean)})}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,Ha,_u);if(n instanceof Promise&&(n=await n),!n)break;const r=e,i=nc(n);if(!i)break;if(i.name==="ftyp"){const s=Gr(n,4);this.isQuickTime=s==="qt  "}else if(i.name==="moov"){let s=this.reader.requestSlice(n.filePos,i.contentSize);if(s instanceof Promise&&(s=await s),!s)break;this.moovSlice=s,this.readContiguousBoxes(this.moovSlice),this.tracks.sort((o,a)=>Number(a.disposition.default)-Number(o.disposition.default));for(const o of this.tracks){const a=o.editListPreviousSegmentDurations/this.movieTimescale;o.editListOffset-=Math.round(a*o.timescale)}break}e=r+i.totalSize}if(this.isFragmented&&this.reader.fileSize!==null){let n=this.reader.requestSlice(this.reader.fileSize-4,4);n instanceof Promise&&(n=await n),W(n);const r=nt(n),i=this.reader.fileSize-r;if(i>=0&&i<=this.reader.fileSize-_u){let s=this.reader.requestSliceRange(i,Ha,_u);if(s instanceof Promise&&(s=await s),s){const o=nc(s);if(o&&o.name==="mfra"){let a=this.reader.requestSlice(s.filePos,o.contentSize);a instanceof Promise&&(a=await a),a&&this.readContiguousBoxes(a)}}}}})()}getSampleTableForTrack(e){if(e.sampleTable)return e.sampleTable;const n={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};e.sampleTable=n,W(this.moovSlice);const r=this.moovSlice.slice(e.sampleTableByteOffset);if(this.currentTrack=e,this.traverseBox(r),this.currentTrack=null,e.info?.type==="audio"&&e.info.codec&&Pi.includes(e.info.codec)&&n.sampleCompositionTimeOffsets.length===0){W(e.info?.type==="audio");const s=eu(e.info.codec),o=[],a=[];for(let l=0;l<n.sampleToChunk.length;l++){const c=n.sampleToChunk[l],u=n.sampleToChunk[l+1],d=(u?u.startChunkIndex:n.chunkOffsets.length)-c.startChunkIndex;for(let f=0;f<d;f++){const h=c.startSampleIndex+f*c.samplesPerChunk,p=h+c.samplesPerChunk,m=fn(n.sampleTimingEntries,h,k=>k.startIndex),g=n.sampleTimingEntries[m],y=fn(n.sampleTimingEntries,p,k=>k.startIndex),b=n.sampleTimingEntries[y],S=g.startDecodeTimestamp+(h-g.startIndex)*g.delta,_=b.startDecodeTimestamp+(p-b.startIndex)*b.delta-S,x=Wn(o);x&&x.delta===_?x.count++:o.push({startIndex:c.startChunkIndex+f,startDecodeTimestamp:S,count:1,delta:_});const I=c.samplesPerChunk*s.sampleSize*e.info.numberOfChannels;a.push(I)}c.startSampleIndex=c.startChunkIndex,c.samplesPerChunk=1}n.sampleTimingEntries=o,n.sampleSizes=a}if(n.sampleCompositionTimeOffsets.length>0){n.presentationTimestamps=[];for(const s of n.sampleTimingEntries)for(let o=0;o<s.count;o++)n.presentationTimestamps.push({presentationTimestamp:s.startDecodeTimestamp+o*s.delta,sampleIndex:s.startIndex+o});for(const s of n.sampleCompositionTimeOffsets)for(let o=0;o<s.count;o++){const a=s.startIndex+o,l=n.presentationTimestamps[a];l&&(l.presentationTimestamp+=s.offset)}n.presentationTimestamps.sort((s,o)=>s.presentationTimestamp-o.presentationTimestamp),n.presentationTimestampIndexMap=Array(n.presentationTimestamps.length).fill(-1);for(let s=0;s<n.presentationTimestamps.length;s++)n.presentationTimestampIndexMap[n.presentationTimestamps[s].sampleIndex]=s}return n}async readFragment(e){if(this.lastReadFragment?.moofOffset===e)return this.lastReadFragment;let n=this.reader.requestSliceRange(e,Ha,_u);n instanceof Promise&&(n=await n),W(n);const r=nc(n);W(r?.name==="moof");let i=this.reader.requestSlice(e,r.totalSize);i instanceof Promise&&(i=await i),W(i),this.traverseBox(i);const s=this.lastReadFragment;W(s&&s.moofOffset===e);for(const[,o]of s.trackData){const a=o.track,{fragmentPositionCache:l}=a;if(!o.startTimestampIsFinal){const u=a.fragmentLookupTable.find(d=>d.moofOffset===s.moofOffset);if(u)v1(o,u.timestamp);else{const d=fn(l,s.moofOffset-1,f=>f.moofOffset);if(d!==-1){const f=l[d];v1(o,f.endTimestamp)}}o.startTimestampIsFinal=!0}const c=fn(l,o.startTimestamp,u=>u.startTimestamp);(c===-1||l[c].moofOffset!==s.moofOffset)&&l.splice(c+1,0,{moofOffset:s.moofOffset,startTimestamp:o.startTimestamp,endTimestamp:o.endTimestamp})}return s}readContiguousBoxes(e){const n=e.filePos;for(;e.filePos-n<=e.length-Ha&&this.traverseBox(e););}*iterateContiguousBoxes(e){const n=e.filePos;for(;e.filePos-n<=e.length-Ha;){const r=e.filePos,i=nc(e);if(!i)break;yield{boxInfo:i,slice:e},e.filePos=r+i.totalSize}}traverseBox(e){const n=e.filePos,r=nc(e);if(!r)return!1;const i=e.filePos,s=n+r.totalSize;switch(r.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"mvhd":{const o=mt(e);e.skip(3),o===1?(e.skip(16),this.movieTimescale=nt(e),this.movieDurationInTimescale=Xs(e)):(e.skip(8),this.movieTimescale=nt(e),this.movieDurationInTimescale=nt(e))}break;case"trak":{const o={id:-1,demuxer:this,inputTrack:null,disposition:{...Jc},info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,internalCodecId:null,name:null,languageCode:cs,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:[],currentFragmentState:null,fragmentPositionCache:[],editListPreviousSegmentDurations:0,editListOffset:0};if(this.currentTrack=o,this.readContiguousBoxes(e.slice(i,r.contentSize)),o.id!==-1&&o.timescale!==-1&&o.info!==null){if(o.info.type==="video"&&o.info.width!==-1){const a=o;o.inputTrack=new ph(this.input,new Bte(a)),this.tracks.push(o)}else if(o.info.type==="audio"&&o.info.numberOfChannels!==-1){const a=o;o.inputTrack=new ca(this.input,new Fte(a)),this.tracks.push(o)}}this.currentTrack=null}break;case"tkhd":{const o=this.currentTrack;if(!o)break;const a=mt(e),c=!!(Wd(e)&1);if(o.disposition.default=c,a===0)e.skip(8),o.id=nt(e),e.skip(4),o.durationInMovieTimescale=nt(e);else if(a===1)e.skip(16),o.id=nt(e),e.skip(4),o.durationInMovieTimescale=Xs(e);else throw new Error(`Incorrect track header version ${a}.`);e.skip(16);const u=[fu(e),fu(e),b1(e),fu(e),fu(e),b1(e),fu(e),fu(e),b1(e)],d=GE(rD(Hte(u),90));W(d===0||d===90||d===180||d===270),o.rotation=d}break;case"elst":{const o=this.currentTrack;if(!o)break;const a=mt(e);e.skip(3);let l=!1,c=0;const u=nt(e);for(let d=0;d<u;d++){const f=a===1?Xs(e):nt(e),h=a===1?Yne(e):Pu(e),p=fu(e);if(f!==0){if(l){console.warn("Unsupported edit list: multiple edits are not currently supported. Only using first edit.");break}if(h===-1){c+=f;continue}if(p!==1){console.warn("Unsupported edit list entry: media rate must be 1.");break}o.editListPreviousSegmentDurations=c,o.editListOffset=h,l=!0}}}break;case"mdhd":{const o=this.currentTrack;if(!o)break;const a=mt(e);e.skip(3),a===0?(e.skip(8),o.timescale=nt(e),o.durationInMediaTimescale=nt(e)):a===1&&(e.skip(16),o.timescale=nt(e),o.durationInMediaTimescale=Xs(e));let l=Fr(e);if(l>0){o.languageCode="";for(let c=0;c<3;c++)o.languageCode=String.fromCharCode(96+(l&31))+o.languageCode,l>>=5;nm(o.languageCode)||(o.languageCode=cs)}}break;case"hdlr":{const o=this.currentTrack;if(!o)break;e.skip(8);const a=Gr(e,4);a==="vide"?o.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcType:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:a==="soun"&&(o.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case"stbl":{const o=this.currentTrack;if(!o)break;o.sampleTableByteOffset=n,this.readContiguousBoxes(e.slice(i,r.contentSize))}break;case"stsd":{const o=this.currentTrack;if(!o||o.info===null||o.sampleTable)break;const a=mt(e);e.skip(3);const l=nt(e);for(let c=0;c<l;c++){const u=e.filePos,d=nc(e);if(!d)break;o.internalCodecId=d.name;const f=d.name.toLowerCase();if(o.info.type==="video")f==="avc1"||f==="avc3"?(o.info.codec="avc",o.info.avcType=f==="avc1"?1:3):f==="hvc1"||f==="hev1"?o.info.codec="hevc":f==="vp08"?o.info.codec="vp8":f==="vp09"?o.info.codec="vp9":f==="av01"?o.info.codec="av1":console.warn(`Unsupported video codec (sample entry type '${d.name}').`),e.skip(24),o.info.width=Fr(e),o.info.height=Fr(e),e.skip(50),this.readContiguousBoxes(e.slice(e.filePos,u+d.totalSize-e.filePos));else{f==="mp4a"||(f==="opus"?o.info.codec="opus":f==="flac"?o.info.codec="flac":f==="twos"||f==="sowt"||f==="raw "||f==="in24"||f==="in32"||f==="fl32"||f==="fl64"||f==="lpcm"||f==="ipcm"||f==="fpcm"||(f==="ulaw"?o.info.codec="ulaw":f==="alaw"?o.info.codec="alaw":console.warn(`Unsupported audio codec (sample entry type '${d.name}').`))),e.skip(8);const h=Fr(e);e.skip(6);let p=Fr(e),m=Fr(e);e.skip(4);let g=nt(e)/65536;if(a===0&&h>0){if(h===1)e.skip(4),m=8*nt(e),e.skip(8);else if(h===2){e.skip(4),g=zD(e),p=nt(e),e.skip(4),m=nt(e);const y=nt(e);if(e.skip(8),f==="lpcm"){const b=m+7>>3,S=!!(y&1),C=!!(y&2),_=y&4?-1:0;m>0&&m<=64&&(S?m===32&&(o.info.codec=C?"pcm-f32be":"pcm-f32"):_&1<<b-1?b===1?o.info.codec="pcm-s8":b===2?o.info.codec=C?"pcm-s16be":"pcm-s16":b===3?o.info.codec=C?"pcm-s24be":"pcm-s24":b===4&&(o.info.codec=C?"pcm-s32be":"pcm-s32"):b===1&&(o.info.codec="pcm-u8")),o.info.codec===null&&console.warn("Unsupported PCM format.")}}}o.info.codec==="opus"&&(g=pw),o.info.numberOfChannels=p,o.info.sampleRate=g,f==="twos"?m===8?o.info.codec="pcm-s8":m===16?o.info.codec="pcm-s16be":(console.warn(`Unsupported sample size ${m} for codec 'twos'.`),o.info.codec=null):f==="sowt"?m===8?o.info.codec="pcm-s8":m===16?o.info.codec="pcm-s16":(console.warn(`Unsupported sample size ${m} for codec 'sowt'.`),o.info.codec=null):f==="raw "?o.info.codec="pcm-u8":f==="in24"?o.info.codec="pcm-s24be":f==="in32"?o.info.codec="pcm-s32be":f==="fl32"?o.info.codec="pcm-f32be":f==="fl64"?o.info.codec="pcm-f64be":f==="ipcm"?o.info.codec="pcm-s16be":f==="fpcm"&&(o.info.codec="pcm-f32be"),this.readContiguousBoxes(e.slice(e.filePos,u+d.totalSize-e.filePos))}}}break;case"avcC":{const o=this.currentTrack;if(!o)break;W(o.info),o.info.codecDescription=Ct(e,r.contentSize)}break;case"hvcC":{const o=this.currentTrack;if(!o)break;W(o.info),o.info.codecDescription=Ct(e,r.contentSize)}break;case"vpcC":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="video"),e.skip(4);const a=mt(e),l=mt(e),c=mt(e),u=c>>4,d=c>>1&7,f=c&1,h=mt(e),p=mt(e),m=mt(e);o.info.vp9CodecInfo={profile:a,level:l,bitDepth:u,chromaSubsampling:d,videoFullRangeFlag:f,colourPrimaries:h,transferCharacteristics:p,matrixCoefficients:m}}break;case"av1C":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="video"),e.skip(1);const a=mt(e),l=a>>5,c=a&31,u=mt(e),d=u>>7,f=u>>6&1,h=u>>5&1,p=u>>4&1,m=u>>3&1,g=u>>2&1,y=u&3,b=l===2&&f?h?12:10:f?10:8;o.info.av1CodecInfo={profile:l,level:c,tier:d,bitDepth:b,monochrome:p,chromaSubsamplingX:m,chromaSubsamplingY:g,chromaSamplePosition:y}}break;case"colr":{const o=this.currentTrack;if(!o||(W(o.info?.type==="video"),Gr(e,4)!=="nclx"))break;const l=Fr(e),c=Fr(e),u=Fr(e),d=!!(mt(e)&128);o.info.colorSpace={primaries:fy[l],transfer:hy[c],matrix:py[u],fullRange:d}}break;case"wave":this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"esds":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),e.skip(4);const a=mt(e);W(a===3),w1(e),e.skip(2);const l=mt(e),c=(l&128)!==0,u=(l&64)!==0,d=(l&32)!==0;if(c&&e.skip(2),u){const g=mt(e);e.skip(g)}d&&e.skip(2);const f=mt(e);W(f===4);const h=w1(e),p=e.filePos,m=mt(e);if(m===64||m===103?(o.info.codec="aac",o.info.aacCodecInfo={isMpeg2:m===103,objectType:null}):m===105||m===107?o.info.codec="mp3":m===221?o.info.codec="vorbis":console.warn(`Unsupported audio codec (objectTypeIndication ${m}) - discarding track.`),e.skip(12),h>e.filePos-p){const g=mt(e);W(g===5);const y=w1(e);if(o.info.codecDescription=Ct(e,y),o.info.codec==="aac"){const b=eT(o.info.codecDescription);b.numberOfChannels!==null&&(o.info.numberOfChannels=b.numberOfChannels),b.sampleRate!==null&&(o.info.sampleRate=b.sampleRate)}}}break;case"enda":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),Fr(e)&255&&(o.info.codec==="pcm-s16be"?o.info.codec="pcm-s16":o.info.codec==="pcm-s24be"?o.info.codec="pcm-s24":o.info.codec==="pcm-s32be"?o.info.codec="pcm-s32":o.info.codec==="pcm-f32be"?o.info.codec="pcm-f32":o.info.codec==="pcm-f64be"&&(o.info.codec="pcm-f64"))}break;case"pcmC":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),e.skip(4);const l=!!(mt(e)&1),c=mt(e);o.info.codec==="pcm-s16be"?l?c===16?o.info.codec="pcm-s16":c===24?o.info.codec="pcm-s24":c===32?o.info.codec="pcm-s32":(console.warn(`Invalid ipcm sample size ${c}.`),o.info.codec=null):c===16?o.info.codec="pcm-s16be":c===24?o.info.codec="pcm-s24be":c===32?o.info.codec="pcm-s32be":(console.warn(`Invalid ipcm sample size ${c}.`),o.info.codec=null):o.info.codec==="pcm-f32be"&&(l?c===32?o.info.codec="pcm-f32":c===64?o.info.codec="pcm-f64":(console.warn(`Invalid fpcm sample size ${c}.`),o.info.codec=null):c===32?o.info.codec="pcm-f32be":c===64?o.info.codec="pcm-f64be":(console.warn(`Invalid fpcm sample size ${c}.`),o.info.codec=null));break}case"dOps":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),e.skip(1);const a=mt(e),l=Fr(e),c=nt(e),u=Qx(e),d=mt(e);let f;d!==0?f=Ct(e,2+a):f=new Uint8Array(0);const h=new Uint8Array(19+f.byteLength),p=new DataView(h.buffer);p.setUint32(0,1332770163,!1),p.setUint32(4,1214603620,!1),p.setUint8(8,1),p.setUint8(9,a),p.setUint16(10,l,!0),p.setUint32(12,c,!0),p.setInt16(16,u,!0),p.setUint8(18,d),h.set(f,19),o.info.codecDescription=h,o.info.numberOfChannels=a}break;case"dfLa":{const o=this.currentTrack;if(!o)break;W(o.info?.type==="audio"),e.skip(4);const a=127,l=128,c=e.filePos;for(;e.filePos<s;){const p=mt(e),m=Wd(e);if((p&a)===vf.STREAMINFO){e.skip(10);const y=nt(e),b=y>>>12,S=(y>>9&7)+1;o.info.sampleRate=b,o.info.numberOfChannels=S,e.skip(20)}else e.skip(m);if(p&l)break}const u=e.filePos;e.filePos=c;const d=Ct(e,u-c),f=new Uint8Array(4+d.byteLength);new DataView(f.buffer).setUint32(0,1716281667,!1),f.set(d,4),o.info.codecDescription=f}break;case"stts":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=nt(e);let l=0,c=0;for(let u=0;u<a;u++){const d=nt(e),f=nt(e);o.sampleTable.sampleTimingEntries.push({startIndex:l,startDecodeTimestamp:c,count:d,delta:f}),l+=d,c+=d*f}}break;case"ctts":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=nt(e);let l=0;for(let c=0;c<a;c++){const u=nt(e),d=Pu(e);o.sampleTable.sampleCompositionTimeOffsets.push({startIndex:l,count:u,offset:d}),l+=u}}break;case"stsz":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=nt(e),l=nt(e);if(a===0)for(let c=0;c<l;c++){const u=nt(e);o.sampleTable.sampleSizes.push(u)}else o.sampleTable.sampleSizes.push(a)}break;case"stz2":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4),e.skip(3);const a=mt(e),l=nt(e),c=Ct(e,Math.ceil(l*a/8)),u=new Ln(c);for(let d=0;d<l;d++){const f=u.readBits(a);o.sampleTable.sampleSizes.push(f)}}break;case"stss":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4),o.sampleTable.keySampleIndices=[];const a=nt(e);for(let l=0;l<a;l++){const c=nt(e)-1;o.sampleTable.keySampleIndices.push(c)}o.sampleTable.keySampleIndices[0]!==0&&o.sampleTable.keySampleIndices.unshift(0)}break;case"stsc":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=nt(e);for(let c=0;c<a;c++){const u=nt(e)-1,d=nt(e),f=nt(e);o.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:u,samplesPerChunk:d,sampleDescriptionIndex:f})}let l=0;for(let c=0;c<o.sampleTable.sampleToChunk.length;c++)if(o.sampleTable.sampleToChunk[c].startSampleIndex=l,c<o.sampleTable.sampleToChunk.length-1){const d=o.sampleTable.sampleToChunk[c+1].startChunkIndex-o.sampleTable.sampleToChunk[c].startChunkIndex;l+=d*o.sampleTable.sampleToChunk[c].samplesPerChunk}}break;case"stco":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=nt(e);for(let l=0;l<a;l++){const c=nt(e);o.sampleTable.chunkOffsets.push(c)}}break;case"co64":{const o=this.currentTrack;if(!o||!o.sampleTable)break;e.skip(4);const a=nt(e);for(let l=0;l<a;l++){const c=Xs(e);o.sampleTable.chunkOffsets.push(c)}}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(e.slice(i,r.contentSize));break;case"mehd":{const o=mt(e);e.skip(3);const a=o===1?Xs(e):nt(e);this.movieDurationInTimescale=a}break;case"trex":{e.skip(4);const o=nt(e),a=nt(e),l=nt(e),c=nt(e),u=nt(e);this.fragmentTrackDefaults.push({trackId:o,defaultSampleDescriptionIndex:a,defaultSampleDuration:l,defaultSampleSize:c,defaultSampleFlags:u})}break;case"tfra":{const o=mt(e);e.skip(3);const a=nt(e),l=this.tracks.find(b=>b.id===a);if(!l)break;const c=nt(e),u=(c&48)>>4,d=(c&12)>>2,f=c&3,h=[mt,Fr,Wd,nt],p=h[u],m=h[d],g=h[f],y=nt(e);for(let b=0;b<y;b++){const S=o===1?Xs(e):nt(e),C=o===1?Xs(e):nt(e);p(e),m(e),g(e),l.fragmentLookupTable.push({timestamp:S,moofOffset:C})}l.fragmentLookupTable.sort((b,S)=>b.timestamp-S.timestamp);for(let b=0;b<l.fragmentLookupTable.length-1;b++){const S=l.fragmentLookupTable[b],C=l.fragmentLookupTable[b+1];S.timestamp===C.timestamp&&(l.fragmentLookupTable.splice(b+1,1),b--)}}break;case"moof":this.currentFragment={moofOffset:n,moofSize:r.totalSize,implicitBaseDataOffset:n,trackData:new Map},this.readContiguousBoxes(e.slice(i,r.contentSize)),this.lastReadFragment=this.currentFragment,this.currentFragment=null;break;case"traf":if(W(this.currentFragment),this.readContiguousBoxes(e.slice(i,r.contentSize)),this.currentTrack){const o=this.currentFragment.trackData.get(this.currentTrack.id);if(o){const{currentFragmentState:a}=this.currentTrack;W(a),a.startTimestamp!==null&&(v1(o,a.startTimestamp),o.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":{W(this.currentFragment),e.skip(1);const o=Wd(e),a=!!(o&1),l=!!(o&2),c=!!(o&8),u=!!(o&16),d=!!(o&32),f=!!(o&65536),h=!!(o&131072),p=nt(e),m=this.tracks.find(y=>y.id===p);if(!m)break;const g=this.fragmentTrackDefaults.find(y=>y.trackId===p);this.currentTrack=m,m.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:g?.defaultSampleDescriptionIndex??null,defaultSampleDuration:g?.defaultSampleDuration??null,defaultSampleSize:g?.defaultSampleSize??null,defaultSampleFlags:g?.defaultSampleFlags??null,startTimestamp:null},a?m.currentFragmentState.baseDataOffset=Xs(e):h&&(m.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),l&&(m.currentFragmentState.sampleDescriptionIndex=nt(e)),c&&(m.currentFragmentState.defaultSampleDuration=nt(e)),u&&(m.currentFragmentState.defaultSampleSize=nt(e)),d&&(m.currentFragmentState.defaultSampleFlags=nt(e)),f&&(m.currentFragmentState.defaultSampleDuration=0)}break;case"tfdt":{const o=this.currentTrack;if(!o)break;W(o.currentFragmentState);const a=mt(e);e.skip(3);const l=a===0?nt(e):Xs(e);o.currentFragmentState.startTimestamp=l}break;case"trun":{const o=this.currentTrack;if(!o)break;if(W(this.currentFragment),W(o.currentFragmentState),this.currentFragment.trackData.has(o.id)){console.warn("Can't have two trun boxes for the same track in one fragment. Ignoring...");break}const a=mt(e),l=Wd(e),c=!!(l&1),u=!!(l&4),d=!!(l&256),f=!!(l&512),h=!!(l&1024),p=!!(l&2048),m=nt(e);let g=o.currentFragmentState.baseDataOffset;c&&(g+=Pu(e));let y=null;u&&(y=nt(e));let b=g;if(m===0){this.currentFragment.implicitBaseDataOffset=b;break}let S=0;const C={track:o,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(o.id,C);for(let I=0;I<m;I++){let k;d?k=nt(e):(W(o.currentFragmentState.defaultSampleDuration!==null),k=o.currentFragmentState.defaultSampleDuration);let T;f?T=nt(e):(W(o.currentFragmentState.defaultSampleSize!==null),T=o.currentFragmentState.defaultSampleSize);let P;h?P=nt(e):(W(o.currentFragmentState.defaultSampleFlags!==null),P=o.currentFragmentState.defaultSampleFlags),I===0&&y!==null&&(P=y);let O=0;p&&(a===0?O=nt(e):O=Pu(e));const D=!(P&65536);C.samples.push({presentationTimestamp:S+O,duration:k,byteOffset:b,byteSize:T,isKeyFrame:D}),b+=T,S+=k}C.presentationTimestamps=C.samples.map((I,k)=>({presentationTimestamp:I.presentationTimestamp,sampleIndex:k})).sort((I,k)=>I.presentationTimestamp-k.presentationTimestamp);for(let I=0;I<C.presentationTimestamps.length;I++){const k=C.presentationTimestamps[I],T=C.samples[k.sampleIndex];if(C.firstKeyFrameTimestamp===null&&T.isKeyFrame&&(C.firstKeyFrameTimestamp=T.presentationTimestamp),I<C.presentationTimestamps.length-1){const P=C.presentationTimestamps[I+1];T.duration=P.presentationTimestamp-k.presentationTimestamp}}const _=C.samples[C.presentationTimestamps[0].sampleIndex],x=C.samples[Wn(C.presentationTimestamps).sampleIndex];C.startTimestamp=_.presentationTimestamp,C.endTimestamp=x.presentationTimestamp+x.duration,this.currentFragment.implicitBaseDataOffset=b}break;case"udta":{const o=this.iterateContiguousBoxes(e.slice(i,r.contentSize));for(const{boxInfo:a,slice:l}of o){if(a.name!=="meta"&&!this.currentTrack){const c=l.filePos;this.metadataTags.raw??={},a.name[0]==="Â©"?this.metadataTags.raw[a.name]??=So(l):this.metadataTags.raw[a.name]??=Ct(l,a.contentSize),l.filePos=c}switch(a.name){case"meta":l.skip(-a.headerSize),this.traverseBox(l);break;case"Â©nam":case"name":this.currentTrack?this.currentTrack.name=zs.decode(Ct(l,a.contentSize)):this.metadataTags.title??=So(l);break;case"Â©des":this.currentTrack||(this.metadataTags.description??=So(l));break;case"Â©ART":this.currentTrack||(this.metadataTags.artist??=So(l));break;case"Â©alb":this.currentTrack||(this.metadataTags.album??=So(l));break;case"albr":this.currentTrack||(this.metadataTags.albumArtist??=So(l));break;case"Â©gen":this.currentTrack||(this.metadataTags.genre??=So(l));break;case"Â©day":if(!this.currentTrack){const c=new Date(So(l));Number.isNaN(c.getTime())||(this.metadataTags.date??=c)}break;case"Â©cmt":this.currentTrack||(this.metadataTags.comment??=So(l));break;case"Â©lyr":this.currentTrack||(this.metadataTags.lyrics??=So(l));break}}}break;case"meta":{if(this.currentTrack)break;const a=nt(e)!==0;this.currentMetadataKeys=new Map,a?this.readContiguousBoxes(e.slice(i,r.contentSize)):this.readContiguousBoxes(e.slice(i+4,r.contentSize-4)),this.currentMetadataKeys=null}break;case"keys":{if(!this.currentMetadataKeys)break;e.skip(4);const o=nt(e);for(let a=0;a<o;a++){const l=nt(e);e.skip(4);const c=zs.decode(Ct(e,l-8));this.currentMetadataKeys.set(a+1,c)}}break;case"ilst":{if(!this.currentMetadataKeys)break;const o=this.iterateContiguousBoxes(e.slice(i,r.contentSize));for(const{boxInfo:a,slice:l}of o){let c=a.name;const u=(c.charCodeAt(0)<<24)+(c.charCodeAt(1)<<16)+(c.charCodeAt(2)<<8)+c.charCodeAt(3);this.currentMetadataKeys.has(u)&&(c=this.currentMetadataKeys.get(u));const d=Dte(l);switch(this.metadataTags.raw??={},this.metadataTags.raw[c]??=d,c){case"Â©nam":case"titl":case"com.apple.quicktime.title":case"title":typeof d=="string"&&(this.metadataTags.title??=d);break;case"Â©des":case"desc":case"dscp":case"com.apple.quicktime.description":case"description":typeof d=="string"&&(this.metadataTags.description??=d);break;case"Â©ART":case"com.apple.quicktime.artist":case"artist":typeof d=="string"&&(this.metadataTags.artist??=d);break;case"Â©alb":case"albm":case"com.apple.quicktime.album":case"album":typeof d=="string"&&(this.metadataTags.album??=d);break;case"aART":case"album_artist":typeof d=="string"&&(this.metadataTags.albumArtist??=d);break;case"Â©cmt":case"com.apple.quicktime.comment":case"comment":typeof d=="string"&&(this.metadataTags.comment??=d);break;case"Â©gen":case"gnre":case"com.apple.quicktime.genre":case"genre":typeof d=="string"&&(this.metadataTags.genre??=d);break;case"Â©lyr":case"lyrics":typeof d=="string"&&(this.metadataTags.lyrics??=d);break;case"Â©day":case"rldt":case"com.apple.quicktime.creationdate":case"date":if(typeof d=="string"){const f=new Date(d);Number.isNaN(f.getTime())||(this.metadataTags.date??=f)}break;case"covr":case"com.apple.quicktime.artwork":d instanceof wf?(this.metadataTags.images??=[],this.metadataTags.images.push({data:d.data,kind:"coverFront",mimeType:d.mimeType})):d instanceof Uint8Array&&(this.metadataTags.images??=[],this.metadataTags.images.push({data:d,kind:"coverFront",mimeType:"image/*"}));break;case"track":if(typeof d=="string"){const f=d.split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(this.metadataTags.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(this.metadataTags.tracksTotal??=p)}break;case"trkn":if(d instanceof Uint8Array&&d.length>=6){const f=jn(d),h=f.getUint16(2,!1),p=f.getUint16(4,!1);h>0&&(this.metadataTags.trackNumber??=h),p>0&&(this.metadataTags.tracksTotal??=p)}break;case"disc":case"disk":if(d instanceof Uint8Array&&d.length>=6){const f=jn(d),h=f.getUint16(2,!1),p=f.getUint16(4,!1);h>0&&(this.metadataTags.discNumber??=h),p>0&&(this.metadataTags.discsTotal??=p)}break}}}break}return e.filePos=s,!0}}class _D{constructor(e){this.internalTrack=e,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.internalCodecId}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}getTimeResolution(){return this.internalTrack.timescale}getDisposition(){return this.internalTrack.disposition}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}async getFirstPacket(e){const n=await this.fetchPacketForSampleIndex(0,e);return n||!this.internalTrack.demuxer.isFragmented?n:this.performFragmentedLookup(null,r=>r.trackData.get(this.internalTrack.id)?{sampleIndex:0,correctSampleFound:!0}:{sampleIndex:-1,correctSampleFound:!1},-1/0,1/0,e)}mapTimestampIntoTimescale(e){return tm(e*this.internalTrack.timescale)+this.internalTrack.editListOffset}async getPacket(e,n){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=jx(i,r),o=await this.fetchPacketForSampleIndex(s,n);return!ZP(i)||!this.internalTrack.demuxer.isFragmented?o:this.performFragmentedLookup(null,a=>{const l=a.trackData.get(this.internalTrack.id);if(!l)return{sampleIndex:-1,correctSampleFound:!1};const c=fn(l.presentationTimestamps,r,f=>f.presentationTimestamp),u=c!==-1?l.presentationTimestamps[c].sampleIndex:-1,d=c!==-1&&r<l.endTimestamp;return{sampleIndex:u,correctSampleFound:d}},r,r,n)}async getNextPacket(e,n){const r=this.packetToSampleIndex.get(e);if(r!==void 0)return this.fetchPacketForSampleIndex(r+1,n);const i=this.packetToFragmentLocation.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(i.fragment,s=>{if(s===i.fragment){const o=s.trackData.get(this.internalTrack.id);if(i.sampleIndex+1<o.samples.length)return{sampleIndex:i.sampleIndex+1,correctSampleFound:!0}}else if(s.trackData.get(this.internalTrack.id))return{sampleIndex:0,correctSampleFound:!0};return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,n)}async getKeyPacket(e,n){const r=this.mapTimestampIntoTimescale(e),i=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),s=$te(i,r),o=await this.fetchPacketForSampleIndex(s,n);return!ZP(i)||!this.internalTrack.demuxer.isFragmented?o:this.performFragmentedLookup(null,a=>{const l=a.trackData.get(this.internalTrack.id);if(!l)return{sampleIndex:-1,correctSampleFound:!1};const c=XE(l.presentationTimestamps,f=>l.samples[f.sampleIndex].isKeyFrame&&f.presentationTimestamp<=r),u=c!==-1?l.presentationTimestamps[c].sampleIndex:-1,d=c!==-1&&r<l.endTimestamp;return{sampleIndex:u,correctSampleFound:d}},r,r,n)}async getNextKeyPacket(e,n){const r=this.packetToSampleIndex.get(e);if(r!==void 0){const s=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),o=Ute(s,r);return this.fetchPacketForSampleIndex(o,n)}const i=this.packetToFragmentLocation.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");return this.performFragmentedLookup(i.fragment,s=>{if(s===i.fragment){const a=s.trackData.get(this.internalTrack.id).samples.findIndex((l,c)=>l.isKeyFrame&&c>i.sampleIndex);if(a!==-1)return{sampleIndex:a,correctSampleFound:!0}}else{const o=s.trackData.get(this.internalTrack.id);if(o&&o.firstKeyFrameTimestamp!==null){const a=o.samples.findIndex(l=>l.isKeyFrame);return W(a!==-1),{sampleIndex:a,correctSampleFound:!0}}}return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,n)}async fetchPacketForSampleIndex(e,n){if(e===-1)return null;const r=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),i=zte(r,e);if(!i)return null;let s;if(n.metadataOnly)s=ys;else{let c=this.internalTrack.demuxer.reader.requestSlice(i.sampleOffset,i.sampleSize);c instanceof Promise&&(c=await c),W(c),s=Ct(c,i.sampleSize)}const o=(i.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,a=i.duration/this.internalTrack.timescale,l=new Mn(s,i.isKeyFrame?"key":"delta",o,a,e,i.sampleSize);return this.packetToSampleIndex.set(l,e),l}async fetchPacketInFragment(e,n,r){if(n===-1)return null;const s=e.trackData.get(this.internalTrack.id).samples[n];W(s);let o;if(r.metadataOnly)o=ys;else{let u=this.internalTrack.demuxer.reader.requestSlice(s.byteOffset,s.byteSize);u instanceof Promise&&(u=await u),W(u),o=Ct(u,s.byteSize)}const a=(s.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,l=s.duration/this.internalTrack.timescale,c=new Mn(o,s.isKeyFrame?"key":"delta",a,l,e.moofOffset+n,s.byteSize);return this.packetToFragmentLocation.set(c,{fragment:e,sampleIndex:n}),c}async performFragmentedLookup(e,n,r,i,s){const o=this.internalTrack.demuxer;let a=null,l=null,c=-1;if(e){const{sampleIndex:g,correctSampleFound:y}=n(e);if(y)return this.fetchPacketInFragment(e,g,s);g!==-1&&(l=e,c=g)}const u=fn(this.internalTrack.fragmentLookupTable,r,g=>g.timestamp),d=u!==-1?this.internalTrack.fragmentLookupTable[u]:null,f=fn(this.internalTrack.fragmentPositionCache,r,g=>g.startTimestamp),h=f!==-1?this.internalTrack.fragmentPositionCache[f]:null,p=Math.max(d?.moofOffset??0,h?.moofOffset??0)||null;let m;for(e?p===null||e.moofOffset>=p?(m=e.moofOffset+e.moofSize,a=e):m=p:m=p??0;;){if(a){const S=a.trackData.get(this.internalTrack.id);if(S&&S.startTimestamp>i)break}let g=o.reader.requestSliceRange(m,Ha,_u);if(g instanceof Promise&&(g=await g),!g)break;const y=m,b=nc(g);if(!b)break;if(b.name==="moof"){a=await o.readFragment(y);const{sampleIndex:S,correctSampleFound:C}=n(a);if(C)return this.fetchPacketInFragment(a,S,s);S!==-1&&(l=a,c=S)}m=y+b.totalSize}if(d&&(!l||l.moofOffset<d.moofOffset)){const g=this.internalTrack.fragmentLookupTable[u-1];W(!g||g.timestamp<d.timestamp);const y=g?.timestamp??-1/0;return this.performFragmentedLookup(null,n,y,i,s)}return l?this.fetchPacketInFragment(l,c,s):null}}class Bte extends _D{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return!1}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{if(this.internalTrack.info.codec==="vp9"&&!this.internalTrack.info.vp9CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.vp9CodecInfo=e&&gD(e.data)}else if(this.internalTrack.info.codec==="av1"&&!this.internalTrack.info.av1CodecInfo){const e=await this.getFirstPacket({});this.internalTrack.info.av1CodecInfo=e&&bD(e.data)}return{codec:YE(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class Fte extends _D{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:JE(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const jx=(t,e)=>{if(t.presentationTimestamps){const n=fn(t.presentationTimestamps,e,r=>r.presentationTimestamp);return n===-1?-1:t.presentationTimestamps[n].sampleIndex}else{const n=fn(t.sampleTimingEntries,e,i=>i.startDecodeTimestamp);if(n===-1)return-1;const r=t.sampleTimingEntries[n];return r.startIndex+Math.min(Math.floor((e-r.startDecodeTimestamp)/r.delta),r.count-1)}},$te=(t,e)=>{if(!t.keySampleIndices)return jx(t,e);if(t.presentationTimestamps){const n=fn(t.presentationTimestamps,e,r=>r.presentationTimestamp);if(n===-1)return-1;for(let r=n;r>=0;r--){const i=t.presentationTimestamps[r].sampleIndex;if(Gm(t.keySampleIndices,i,o=>o)!==-1)return i}return-1}else{const n=jx(t,e),r=fn(t.keySampleIndices,n,i=>i);return t.keySampleIndices[r]??-1}},zte=(t,e)=>{const n=fn(t.sampleTimingEntries,e,y=>y.startIndex),r=t.sampleTimingEntries[n];if(!r||r.startIndex+r.count<=e)return null;let s=r.startDecodeTimestamp+(e-r.startIndex)*r.delta;const o=fn(t.sampleCompositionTimeOffsets,e,y=>y.startIndex),a=t.sampleCompositionTimeOffsets[o];a&&e-a.startIndex<a.count&&(s+=a.offset);const l=t.sampleSizes[Math.min(e,t.sampleSizes.length-1)],c=fn(t.sampleToChunk,e,y=>y.startSampleIndex),u=t.sampleToChunk[c];W(u);const d=u.startChunkIndex+Math.floor((e-u.startSampleIndex)/u.samplesPerChunk),f=t.chunkOffsets[d],h=u.startSampleIndex+(d-u.startChunkIndex)*u.samplesPerChunk;let p=0,m=f;if(t.sampleSizes.length===1)m+=l*(e-h),p+=l*u.samplesPerChunk;else for(let y=h;y<h+u.samplesPerChunk;y++){const b=t.sampleSizes[y];y<e&&(m+=b),p+=b}let g=r.delta;if(t.presentationTimestamps){const y=t.presentationTimestampIndexMap[e];W(y!==void 0),y<t.presentationTimestamps.length-1&&(g=t.presentationTimestamps[y+1].presentationTimestamp-s)}return{presentationTimestamp:s,duration:g,sampleOffset:m,sampleSize:l,chunkOffset:f,chunkSize:p,isKeyFrame:t.keySampleIndices?Gm(t.keySampleIndices,e,y=>y)!==-1:!0}},Ute=(t,e)=>{if(!t.keySampleIndices)return e+1;const n=fn(t.keySampleIndices,e,r=>r);return t.keySampleIndices[n+1]??-1},v1=(t,e)=>{t.startTimestamp+=e,t.endTimestamp+=e;for(const n of t.samples)n.presentationTimestamp+=e;for(const n of t.presentationTimestamps)n.presentationTimestamp+=e},Hte=t=>{const[e,,,n]=t,r=Math.hypot(e,n),i=e/r,s=n/r,o=-Math.atan2(s,i)*(180/Math.PI);return Number.isFinite(o)?o:0},ZP=t=>t.sampleSizes.length===0;var Pe;(function(t){t[t.EBML=440786851]="EBML",t[t.EBMLVersion=17030]="EBMLVersion",t[t.EBMLReadVersion=17143]="EBMLReadVersion",t[t.EBMLMaxIDLength=17138]="EBMLMaxIDLength",t[t.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",t[t.DocType=17026]="DocType",t[t.DocTypeVersion=17031]="DocTypeVersion",t[t.DocTypeReadVersion=17029]="DocTypeReadVersion",t[t.Void=236]="Void",t[t.Segment=408125543]="Segment",t[t.SeekHead=290298740]="SeekHead",t[t.Seek=19899]="Seek",t[t.SeekID=21419]="SeekID",t[t.SeekPosition=21420]="SeekPosition",t[t.Duration=17545]="Duration",t[t.Info=357149030]="Info",t[t.TimestampScale=2807729]="TimestampScale",t[t.MuxingApp=19840]="MuxingApp",t[t.WritingApp=22337]="WritingApp",t[t.Tracks=374648427]="Tracks",t[t.TrackEntry=174]="TrackEntry",t[t.TrackNumber=215]="TrackNumber",t[t.TrackUID=29637]="TrackUID",t[t.TrackType=131]="TrackType",t[t.FlagEnabled=185]="FlagEnabled",t[t.FlagDefault=136]="FlagDefault",t[t.FlagForced=21930]="FlagForced",t[t.FlagOriginal=21934]="FlagOriginal",t[t.FlagHearingImpaired=21931]="FlagHearingImpaired",t[t.FlagVisualImpaired=21932]="FlagVisualImpaired",t[t.FlagCommentary=21935]="FlagCommentary",t[t.FlagLacing=156]="FlagLacing",t[t.Name=21358]="Name",t[t.Language=2274716]="Language",t[t.LanguageBCP47=2274717]="LanguageBCP47",t[t.CodecID=134]="CodecID",t[t.CodecPrivate=25506]="CodecPrivate",t[t.CodecDelay=22186]="CodecDelay",t[t.SeekPreRoll=22203]="SeekPreRoll",t[t.DefaultDuration=2352003]="DefaultDuration",t[t.Video=224]="Video",t[t.PixelWidth=176]="PixelWidth",t[t.PixelHeight=186]="PixelHeight",t[t.AlphaMode=21440]="AlphaMode",t[t.Audio=225]="Audio",t[t.SamplingFrequency=181]="SamplingFrequency",t[t.Channels=159]="Channels",t[t.BitDepth=25188]="BitDepth",t[t.SimpleBlock=163]="SimpleBlock",t[t.BlockGroup=160]="BlockGroup",t[t.Block=161]="Block",t[t.BlockAdditions=30113]="BlockAdditions",t[t.BlockMore=166]="BlockMore",t[t.BlockAdditional=165]="BlockAdditional",t[t.BlockAddID=238]="BlockAddID",t[t.BlockDuration=155]="BlockDuration",t[t.ReferenceBlock=251]="ReferenceBlock",t[t.Cluster=524531317]="Cluster",t[t.Timestamp=231]="Timestamp",t[t.Cues=475249515]="Cues",t[t.CuePoint=187]="CuePoint",t[t.CueTime=179]="CueTime",t[t.CueTrackPositions=183]="CueTrackPositions",t[t.CueTrack=247]="CueTrack",t[t.CueClusterPosition=241]="CueClusterPosition",t[t.Colour=21936]="Colour",t[t.MatrixCoefficients=21937]="MatrixCoefficients",t[t.TransferCharacteristics=21946]="TransferCharacteristics",t[t.Primaries=21947]="Primaries",t[t.Range=21945]="Range",t[t.Projection=30320]="Projection",t[t.ProjectionType=30321]="ProjectionType",t[t.ProjectionPoseRoll=30325]="ProjectionPoseRoll",t[t.Attachments=423732329]="Attachments",t[t.AttachedFile=24999]="AttachedFile",t[t.FileDescription=18046]="FileDescription",t[t.FileName=18030]="FileName",t[t.FileMediaType=18016]="FileMediaType",t[t.FileData=18012]="FileData",t[t.FileUID=18094]="FileUID",t[t.Chapters=272869232]="Chapters",t[t.Tags=307544935]="Tags",t[t.Tag=29555]="Tag",t[t.Targets=25536]="Targets",t[t.TargetTypeValue=26826]="TargetTypeValue",t[t.TargetType=25546]="TargetType",t[t.TagTrackUID=25541]="TagTrackUID",t[t.TagEditionUID=25545]="TagEditionUID",t[t.TagChapterUID=25540]="TagChapterUID",t[t.TagAttachmentUID=25542]="TagAttachmentUID",t[t.SimpleTag=26568]="SimpleTag",t[t.TagName=17827]="TagName",t[t.TagLanguage=17530]="TagLanguage",t[t.TagString=17543]="TagString",t[t.TagBinary=17541]="TagBinary",t[t.ContentEncodings=28032]="ContentEncodings",t[t.ContentEncoding=25152]="ContentEncoding",t[t.ContentEncodingOrder=20529]="ContentEncodingOrder",t[t.ContentEncodingScope=20530]="ContentEncodingScope",t[t.ContentCompression=20532]="ContentCompression",t[t.ContentCompAlgo=16980]="ContentCompAlgo",t[t.ContentCompSettings=16981]="ContentCompSettings",t[t.ContentEncryption=20533]="ContentEncryption"})(Pe||(Pe={}));const Vte=[Pe.EBML,Pe.Segment],om=[Pe.SeekHead,Pe.Info,Pe.Cluster,Pe.Tracks,Pe.Cues,Pe.Attachments,Pe.Chapters,Pe.Tags],f0=[...Vte,...om],qx=8,Ms=2,Va=2*qx,AD=t=>{if(t.remainingLength<1)return null;const e=mt(t);if(t.skip(-1),e===0)return null;let n=1,r=128;for(;(e&r)===0;)n++,r>>=1;return t.remainingLength<n?null:n},op=t=>{if(t.remainingLength<1)return null;const e=mt(t);if(e===0)return null;let n=1,r=128;for(;(e&r)===0;)n++,r>>=1;if(t.remainingLength<n-1)return null;let i=e&r-1;for(let s=1;s<n;s++)i*=256,i+=mt(t);return i},Ut=(t,e)=>{if(e<1||e>8)throw new Error("Bad unsigned int size "+e);let n=0;for(let r=0;r<e;r++)n*=256,n+=mt(t);return n},Wte=(t,e)=>{if(e<1)throw new Error("Bad unsigned int size "+e);let n=0n;for(let r=0;r<e;r++)n<<=8n,n+=BigInt(mt(t));return n},cT=t=>{const e=AD(t);return e===null||t.remainingLength<e?null:Ut(t,e)},PD=t=>{if(t.remainingLength<1)return null;if(mt(t)===255)return;t.skip(-1);const n=op(t);if(n===null)return null;if(n!==72057594037927940)return n},Da=t=>{W(t.remainingLength>=Ms);const e=cT(t);if(e===null)return null;const n=PD(t);return n===null?null:{id:e,size:n}},Ud=(t,e)=>{const n=Ct(t,e);let r=0;for(;r<e&&n[r]!==0;)r+=1;return String.fromCharCode(...n.subarray(0,r))},Hh=(t,e)=>{const n=Ct(t,e);let r=0;for(;r<e&&n[r]!==0;)r+=1;return zs.decode(n.subarray(0,r))},x1=(t,e)=>{if(e===0)return 0;if(e!==4&&e!==8)throw new Error("Bad float size "+e);return e===4?ere(t):zD(t)},Kx=async(t,e,n,r)=>{const i=new Set(n);let s=e;for(;r===null||s<r;){let o=t.requestSliceRange(s,Ms,Va);if(o instanceof Promise&&(o=await o),!o)break;const a=Da(o);if(!a)break;if(i.has(a.id))return{pos:s,found:!0};ec(a.size),s=o.filePos+a.size}return{pos:r!==null&&r>s?r:s,found:!1}},ID=async(t,e,n,r)=>{const s=new Set(n);let o=e;for(;o<r;){let a=t.requestSliceRange(o,0,Math.min(65536,r-o));if(a instanceof Promise&&(a=await a),!a||a.length<qx)break;for(let l=0;l<a.length-qx;l++){a.filePos=o;const c=cT(a);if(c!==null&&s.has(c))return o;o++}}return null},ko={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC"};function ec(t){if(t===void 0)throw new Error("Undefined element size is used in a place where it is not supported.")}const jte=t=>{let n=(t.hasVideo?"video/":t.hasAudio?"audio/":"application/")+(t.isWebM?"webm":"x-matroska");if(t.codecStrings.length>0){const r=[...new Set(t.codecStrings.filter(Boolean))];n+=`; codecs="${r.join(", ")}"`}return n};var Pa;(function(t){t[t.None=0]="None",t[t.Xiph=1]="Xiph",t[t.FixedSize=2]="FixedSize",t[t.Ebml=3]="Ebml"})(Pa||(Pa={}));var yy;(function(t){t[t.Block=1]="Block",t[t.Private=2]="Private",t[t.Next=4]="Next"})(yy||(yy={}));var Ep;(function(t){t[t.Zlib=0]="Zlib",t[t.Bzlib=1]="Bzlib",t[t.lzo1x=2]="lzo1x",t[t.HeaderStripping=3]="HeaderStripping"})(Ep||(Ep={}));const S1=[{id:Pe.SeekHead,flag:"seekHeadSeen"},{id:Pe.Info,flag:"infoSeen"},{id:Pe.Tracks,flag:"tracksSeen"},{id:Pe.Cues,flag:"cuesSeen"}],OD=10*2**20;class qte extends tu{constructor(e){super(e),this.readMetadataPromise=null,this.segments=[],this.currentSegment=null,this.currentTrack=null,this.currentCluster=null,this.currentBlock=null,this.currentBlockAdditional=null,this.currentCueTime=null,this.currentDecodingInstruction=null,this.currentTagTargetIsMovie=!0,this.currentSimpleTagName=null,this.currentAttachedFile=null,this.isWebM=!1,this.reader=e._reader}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getTracks(){return await this.readMetadata(),this.segments.flatMap(e=>e.tracks.map(n=>n.inputTrack))}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.getCodecParameterString()));return jte({isWebM:this.isWebM,hasVideo:this.segments.some(r=>r.tracks.some(i=>i.info?.type==="video")),hasAudio:this.segments.some(r=>r.tracks.some(i=>i.info?.type==="audio")),codecStrings:n.filter(Boolean)})}async getMetadataTags(){await this.readMetadata();for(const n of this.segments)n.metadataTagsCollected||(this.reader.fileSize!==null&&await this.loadSegmentMetadata(n),n.metadataTagsCollected=!0);let e={};for(const n of this.segments)e={...e,...n.metadataTags};return e}readMetadata(){return this.readMetadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,Ms,Va);if(n instanceof Promise&&(n=await n),!n)break;const r=Da(n);if(!r)break;const i=r.id;let s=r.size;const o=n.filePos;if(i===Pe.EBML){ec(s);let a=this.reader.requestSlice(o,s);if(a instanceof Promise&&(a=await a),!a)break;this.readContiguousElements(a)}else if(i===Pe.Segment){if(await this.readSegment(o,s),s===void 0||this.reader.fileSize===null)break}else if(i===Pe.Cluster){if(this.reader.fileSize===null)break;s===void 0&&(s=(await Kx(this.reader,o,f0,this.reader.fileSize)).pos-o);const a=Wn(this.segments);a&&(a.elementEndPos=o+s)}ec(s),e=o+s}})()}async readSegment(e,n){this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,tagsSeen:!1,attachmentsSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:e,elementEndPos:n===void 0?null:e+n,clusterSeekStartPos:e,lastReadCluster:null,metadataTags:{},metadataTagsCollected:!1},this.segments.push(this.currentSegment);let r=e;for(;this.currentSegment.elementEndPos===null||r<this.currentSegment.elementEndPos;){let a=this.reader.requestSliceRange(r,Ms,Va);if(a instanceof Promise&&(a=await a),!a)break;const l=r,c=Da(a);if(!c||!om.includes(c.id)&&c.id!==Pe.Void){const p=await ID(this.reader,l,om,Math.min(this.currentSegment.elementEndPos??1/0,l+OD));if(p){r=p;continue}else break}const{id:u,size:d}=c,f=a.filePos,h=S1.findIndex(p=>p.id===u);if(h!==-1){const p=S1[h].flag;this.currentSegment[p]=!0,ec(d);let m=this.reader.requestSlice(f,d);m instanceof Promise&&(m=await m),m&&this.readContiguousElements(m)}else if(u===Pe.Tags||u===Pe.Attachments){u===Pe.Tags?this.currentSegment.tagsSeen=!0:this.currentSegment.attachmentsSeen=!0,ec(d);let p=this.reader.requestSlice(f,d);p instanceof Promise&&(p=await p),p&&this.readContiguousElements(p)}else if(u===Pe.Cluster){this.currentSegment.clusterSeekStartPos=l;break}if(d===void 0)break;r=f+d}if(this.currentSegment.seekEntries.sort((a,l)=>a.segmentPosition-l.segmentPosition),this.reader.fileSize!==null)for(const a of this.currentSegment.seekEntries){const l=S1.find(p=>p.id===a.id);if(!l||this.currentSegment[l.flag])continue;let c=this.reader.requestSliceRange(e+a.segmentPosition,Ms,Va);if(c instanceof Promise&&(c=await c),!c)continue;const u=Da(c);if(!u)continue;const{id:d,size:f}=u;if(d!==l.id)continue;ec(f),this.currentSegment[l.flag]=!0;let h=this.reader.requestSlice(c.filePos,f);h instanceof Promise&&(h=await h),h&&this.readContiguousElements(h)}this.currentSegment.timestampScale===-1&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e9/1e6);for(const a of this.currentSegment.tracks)a.defaultDurationNs!==null&&(a.defaultDuration=this.currentSegment.timestampFactor*a.defaultDurationNs/1e9);this.currentSegment.tracks.sort((a,l)=>Number(l.disposition.default)-Number(a.disposition.default));const i=new Map(this.currentSegment.tracks.map(a=>[a.id,a]));for(const a of this.currentSegment.cuePoints){const l=i.get(a.trackId);l&&l.cuePoints.push(a)}for(const a of this.currentSegment.tracks){a.cuePoints.sort((l,c)=>l.time-c.time);for(let l=0;l<a.cuePoints.length-1;l++){const c=a.cuePoints[l],u=a.cuePoints[l+1];c.time===u.time&&(a.cuePoints.splice(l+1,1),l--)}}let s=null,o=-1/0;for(const a of this.currentSegment.tracks)a.cuePoints.length>o&&(o=a.cuePoints.length,s=a);for(const a of this.currentSegment.tracks)a.cuePoints.length===0&&(a.cuePoints=s.cuePoints);this.currentSegment=null}async readCluster(e,n){if(n.lastReadCluster?.elementStartPos===e)return n.lastReadCluster;let r=this.reader.requestSliceRange(e,Ms,Va);r instanceof Promise&&(r=await r),W(r);const i=e,s=Da(r);W(s);const o=s.id;W(o===Pe.Cluster);let a=s.size;const l=r.filePos;a===void 0&&(a=(await Kx(this.reader,l,f0,n.elementEndPos)).pos-l);let c=this.reader.requestSlice(l,a);c instanceof Promise&&(c=await c);const u={segment:n,elementStartPos:i,elementEndPos:l+a,dataStartPos:l,timestamp:-1,trackData:new Map};if(this.currentCluster=u,c){const d=this.readContiguousElements(c,f0);u.elementEndPos=d}for(const[,d]of u.trackData){const f=d.track;W(d.blocks.length>0);let h=!1;for(let y=0;y<d.blocks.length;y++){const b=d.blocks[y];b.timestamp+=u.timestamp,h||=b.lacing!==Pa.None}d.presentationTimestamps=d.blocks.map((y,b)=>({timestamp:y.timestamp,blockIndex:b})).sort((y,b)=>y.timestamp-b.timestamp);for(let y=0;y<d.presentationTimestamps.length;y++){const b=d.presentationTimestamps[y],S=d.blocks[b.blockIndex];if(d.firstKeyFrameTimestamp===null&&S.isKeyFrame&&(d.firstKeyFrameTimestamp=S.timestamp),y<d.presentationTimestamps.length-1){const C=d.presentationTimestamps[y+1];S.duration=C.timestamp-S.timestamp}else S.duration===0&&f.defaultDuration!=null&&S.lacing===Pa.None&&(S.duration=f.defaultDuration)}h&&(this.expandLacedBlocks(d.blocks,f),d.presentationTimestamps=d.blocks.map((y,b)=>({timestamp:y.timestamp,blockIndex:b})).sort((y,b)=>y.timestamp-b.timestamp));const p=d.blocks[d.presentationTimestamps[0].blockIndex],m=d.blocks[Wn(d.presentationTimestamps).blockIndex];d.startTimestamp=p.timestamp,d.endTimestamp=m.timestamp+m.duration;const g=fn(f.clusterPositionCache,d.startTimestamp,y=>y.startTimestamp);(g===-1||f.clusterPositionCache[g].elementStartPos!==i)&&f.clusterPositionCache.splice(g+1,0,{elementStartPos:u.elementStartPos,startTimestamp:d.startTimestamp})}return n.lastReadCluster=u,u}getTrackDataInCluster(e,n){let r=e.trackData.get(n);if(!r){const i=e.segment.tracks.find(s=>s.id===n);if(!i)return null;r={track:i,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(n,r)}return r}expandLacedBlocks(e,n){for(let r=0;r<e.length;r++){const i=e[r];if(i.lacing===Pa.None)continue;i.decoded||(i.data=this.decodeBlockData(n,i.data),i.decoded=!0);const s=fo.tempFromBytes(i.data),o=[],a=mt(s)+1;switch(i.lacing){case Pa.Xiph:{let c=0;for(let u=0;u<a-1;u++){let d=0;for(;s.bufferPos<s.length;){const f=mt(s);if(d+=f,f<255){o.push(d),c+=d;break}}}o.push(s.length-(s.bufferPos+c))}break;case Pa.FixedSize:{const c=s.length-1,u=Math.floor(c/a);for(let d=0;d<a;d++)o.push(u)}break;case Pa.Ebml:{const c=op(s);W(c!==null);let u=c;o.push(u);let d=u;for(let f=1;f<a-1;f++){const h=s.bufferPos,p=op(s);W(p!==null);const m=p,y=(1<<(s.bufferPos-h)*7-1)-1,b=m-y;u+=b,o.push(u),d+=u}o.push(s.length-(s.bufferPos+d))}break;default:W(!1)}W(o.length===a),e.splice(r,1);const l=i.duration||a*(n.defaultDuration??0);for(let c=0;c<a;c++){const u=o[c],d=Ct(s,u),f=i.timestamp+l*c/a,h=l/a;e.splice(r+c,0,{timestamp:f,duration:h,isKeyFrame:i.isKeyFrame,data:d,lacing:Pa.None,decoded:!0,mainAdditional:i.mainAdditional})}r+=a,r--}}async loadSegmentMetadata(e){for(const n of e.seekEntries){if(!(n.id===Pe.Tags&&!e.tagsSeen)){if(!(n.id===Pe.Attachments&&!e.attachmentsSeen))continue}let r=this.reader.requestSliceRange(e.dataStartPos+n.segmentPosition,Ms,Va);if(r instanceof Promise&&(r=await r),!r)continue;const i=Da(r);if(!i||i.id!==n.id)continue;const{size:s}=i;ec(s),W(!this.currentSegment),this.currentSegment=e;let o=this.reader.requestSlice(r.filePos,s);o instanceof Promise&&(o=await o),o&&this.readContiguousElements(o),this.currentSegment=null,n.id===Pe.Tags?e.tagsSeen=!0:n.id===Pe.Attachments&&(e.attachmentsSeen=!0)}}readContiguousElements(e,n){for(;e.remainingLength>=Ms;){const r=e.filePos;if(!this.traverseElement(e,n))return r}return e.filePos}traverseElement(e,n){const r=Da(e);if(!r||n&&n.includes(r.id))return!1;const{id:i,size:s}=r,o=e.filePos;switch(ec(s),i){case Pe.DocType:this.isWebM=Ud(e,s)==="webm";break;case Pe.Seek:{if(!this.currentSegment)break;const a={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(a),this.readContiguousElements(e.slice(o,s)),(a.id===-1||a.segmentPosition===-1)&&this.currentSegment.seekEntries.pop()}break;case Pe.SeekID:{const a=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!a)break;a.id=Ut(e,s)}break;case Pe.SeekPosition:{const a=this.currentSegment?.seekEntries[this.currentSegment.seekEntries.length-1];if(!a)break;a.segmentPosition=Ut(e,s)}break;case Pe.TimestampScale:{if(!this.currentSegment)break;this.currentSegment.timestampScale=Ut(e,s),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale}break;case Pe.Duration:{if(!this.currentSegment)break;this.currentSegment.duration=x1(e,s)}break;case Pe.TrackEntry:{if(!this.currentSegment||(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusterPositionCache:[],cuePoints:[],disposition:{...Jc},inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,defaultDurationNs:null,name:null,languageCode:cs,decodingInstructions:[],info:null},this.readContiguousElements(e.slice(o,s)),!this.currentTrack))break;if(this.currentTrack.decodingInstructions.some(a=>a.data?.type!=="decompress"||a.scope!==yy.Block||a.data.algorithm!==Ep.HeaderStripping)&&(console.warn(`Track #${this.currentTrack.id} has an unsupported content encoding; dropping.`),this.currentTrack=null),this.currentTrack&&this.currentTrack.id!==-1&&this.currentTrack.codecId&&this.currentTrack.info){const a=this.currentTrack.codecId.indexOf("/"),l=a===-1?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,a);if(this.currentTrack.info.type==="video"&&this.currentTrack.info.width!==-1&&this.currentTrack.info.height!==-1){this.currentTrack.codecId===ko.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===ko.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):l===ko.vp8?this.currentTrack.info.codec="vp8":l===ko.vp9?this.currentTrack.info.codec="vp9":l===ko.av1&&(this.currentTrack.info.codec="av1");const c=this.currentTrack,u=new ph(this.input,new Kte(c));this.currentTrack.inputTrack=u,this.currentSegment.tracks.push(this.currentTrack)}else if(this.currentTrack.info.type==="audio"&&this.currentTrack.info.numberOfChannels!==-1&&this.currentTrack.info.sampleRate!==-1){l===ko.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2"),objectType:null},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===ko.mp3?this.currentTrack.info.codec="mp3":l===ko.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate,this.currentTrack.info.sampleRate=pw):l===ko.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):l===ko.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId==="A_PCM/INT/LIT"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32"):this.currentTrack.codecId==="A_PCM/INT/BIG"?this.currentTrack.info.bitDepth===8?this.currentTrack.info.codec="pcm-u8":this.currentTrack.info.bitDepth===16?this.currentTrack.info.codec="pcm-s16be":this.currentTrack.info.bitDepth===24?this.currentTrack.info.codec="pcm-s24be":this.currentTrack.info.bitDepth===32&&(this.currentTrack.info.codec="pcm-s32be"):this.currentTrack.codecId==="A_PCM/FLOAT/IEEE"&&(this.currentTrack.info.bitDepth===32?this.currentTrack.info.codec="pcm-f32":this.currentTrack.info.bitDepth===64&&(this.currentTrack.info.codec="pcm-f64"));const c=this.currentTrack,u=new ca(this.input,new Gte(c));this.currentTrack.inputTrack=u,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null}break;case Pe.TrackNumber:{if(!this.currentTrack)break;this.currentTrack.id=Ut(e,s)}break;case Pe.TrackType:{if(!this.currentTrack)break;const a=Ut(e,s);a===1?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null,alphaMode:!1}:a===2&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null})}break;case Pe.FlagEnabled:{if(!this.currentTrack)break;Ut(e,s)||(this.currentTrack=null)}break;case Pe.FlagDefault:{if(!this.currentTrack)break;this.currentTrack.disposition.default=!!Ut(e,s)}break;case Pe.FlagForced:{if(!this.currentTrack)break;this.currentTrack.disposition.forced=!!Ut(e,s)}break;case Pe.FlagOriginal:{if(!this.currentTrack)break;this.currentTrack.disposition.original=!!Ut(e,s)}break;case Pe.FlagHearingImpaired:{if(!this.currentTrack)break;this.currentTrack.disposition.hearingImpaired=!!Ut(e,s)}break;case Pe.FlagVisualImpaired:{if(!this.currentTrack)break;this.currentTrack.disposition.visuallyImpaired=!!Ut(e,s)}break;case Pe.FlagCommentary:{if(!this.currentTrack)break;this.currentTrack.disposition.commentary=!!Ut(e,s)}break;case Pe.CodecID:{if(!this.currentTrack)break;this.currentTrack.codecId=Ud(e,s)}break;case Pe.CodecPrivate:{if(!this.currentTrack)break;this.currentTrack.codecPrivate=Ct(e,s)}break;case Pe.DefaultDuration:{if(!this.currentTrack)break;this.currentTrack.defaultDurationNs=Ut(e,s)}break;case Pe.Name:{if(!this.currentTrack)break;this.currentTrack.name=Hh(e,s)}break;case Pe.Language:{if(!this.currentTrack||this.currentTrack.languageCode!==cs)break;this.currentTrack.languageCode=Ud(e,s),nm(this.currentTrack.languageCode)||(this.currentTrack.languageCode=cs)}break;case Pe.LanguageBCP47:{if(!this.currentTrack)break;const l=Ud(e,s).split("-")[0];l?this.currentTrack.languageCode=l:this.currentTrack.languageCode=cs}break;case Pe.Video:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(o,s))}break;case Pe.PixelWidth:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.width=Ut(e,s)}break;case Pe.PixelHeight:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.height=Ut(e,s)}break;case Pe.AlphaMode:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.alphaMode=Ut(e,s)===1}break;case Pe.Colour:{if(this.currentTrack?.info?.type!=="video")break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e.slice(o,s))}break;case Pe.MatrixCoefficients:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Ut(e,s),l=py[a]??null;this.currentTrack.info.colorSpace.matrix=l}break;case Pe.Range:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=Ut(e,s)===2}break;case Pe.TransferCharacteristics:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Ut(e,s),l=hy[a]??null;this.currentTrack.info.colorSpace.transfer=l}break;case Pe.Primaries:{if(this.currentTrack?.info?.type!=="video"||!this.currentTrack.info.colorSpace)break;const a=Ut(e,s),l=fy[a]??null;this.currentTrack.info.colorSpace.primaries=l}break;case Pe.Projection:{if(this.currentTrack?.info?.type!=="video")break;this.readContiguousElements(e.slice(o,s))}break;case Pe.ProjectionPoseRoll:{if(this.currentTrack?.info?.type!=="video")break;const l=-x1(e,s);try{this.currentTrack.info.rotation=GE(l)}catch{}}break;case Pe.Audio:{if(this.currentTrack?.info?.type!=="audio")break;this.readContiguousElements(e.slice(o,s))}break;case Pe.SamplingFrequency:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.sampleRate=x1(e,s)}break;case Pe.Channels:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.numberOfChannels=Ut(e,s)}break;case Pe.BitDepth:{if(this.currentTrack?.info?.type!=="audio")break;this.currentTrack.info.bitDepth=Ut(e,s)}break;case Pe.CuePoint:{if(!this.currentSegment)break;this.readContiguousElements(e.slice(o,s)),this.currentCueTime=null}break;case Pe.CueTime:this.currentCueTime=Ut(e,s);break;case Pe.CueTrackPositions:{if(this.currentCueTime===null)break;W(this.currentSegment);const a={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(a),this.readContiguousElements(e.slice(o,s)),(a.trackId===-1||a.clusterPosition===-1)&&this.currentSegment.cuePoints.pop()}break;case Pe.CueTrack:{const a=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!a)break;a.trackId=Ut(e,s)}break;case Pe.CueClusterPosition:{const a=this.currentSegment?.cuePoints[this.currentSegment.cuePoints.length-1];if(!a)break;W(this.currentSegment),a.clusterPosition=this.currentSegment.dataStartPos+Ut(e,s)}break;case Pe.Timestamp:{if(!this.currentCluster)break;this.currentCluster.timestamp=Ut(e,s)}break;case Pe.SimpleBlock:{if(!this.currentCluster)break;const a=op(e);if(a===null)break;const l=this.getTrackDataInCluster(this.currentCluster,a);if(!l)break;const c=Qx(e),u=mt(e),d=u>>1&3;let f=!!(u&128);l.track.info?.type==="audio"&&l.track.info.codec&&(f=!0);const h=Ct(e,s-(e.filePos-o)),p=l.track.decodingInstructions.length>0;l.blocks.push({timestamp:c,duration:0,isKeyFrame:f,data:h,lacing:d,decoded:!p,mainAdditional:null})}break;case Pe.BlockGroup:{if(!this.currentCluster)break;this.readContiguousElements(e.slice(o,s)),this.currentBlock=null}break;case Pe.Block:{if(!this.currentCluster)break;const a=op(e);if(a===null)break;const l=this.getTrackDataInCluster(this.currentCluster,a);if(!l)break;const c=Qx(e),d=mt(e)>>1&3,f=Ct(e,s-(e.filePos-o)),h=l.track.decodingInstructions.length>0;this.currentBlock={timestamp:c,duration:0,isKeyFrame:!0,data:f,lacing:d,decoded:!h,mainAdditional:null},l.blocks.push(this.currentBlock)}break;case Pe.BlockAdditions:this.readContiguousElements(e.slice(o,s));break;case Pe.BlockMore:{if(!this.currentBlock)break;this.currentBlockAdditional={addId:1,data:null},this.readContiguousElements(e.slice(o,s)),this.currentBlockAdditional.data&&this.currentBlockAdditional.addId===1&&(this.currentBlock.mainAdditional=this.currentBlockAdditional.data),this.currentBlockAdditional=null}break;case Pe.BlockAdditional:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.data=Ct(e,s)}break;case Pe.BlockAddID:{if(!this.currentBlockAdditional)break;this.currentBlockAdditional.addId=Ut(e,s)}break;case Pe.BlockDuration:{if(!this.currentBlock)break;this.currentBlock.duration=Ut(e,s)}break;case Pe.ReferenceBlock:{if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1}break;case Pe.Tag:this.currentTagTargetIsMovie=!0,this.readContiguousElements(e.slice(o,s));break;case Pe.Targets:this.readContiguousElements(e.slice(o,s));break;case Pe.TargetTypeValue:Ut(e,s)!==50&&(this.currentTagTargetIsMovie=!1);break;case Pe.TagTrackUID:case Pe.TagEditionUID:case Pe.TagChapterUID:case Pe.TagAttachmentUID:this.currentTagTargetIsMovie=!1;break;case Pe.SimpleTag:{if(!this.currentTagTargetIsMovie)break;this.currentSimpleTagName=null,this.readContiguousElements(e.slice(o,s))}break;case Pe.TagName:this.currentSimpleTagName=Hh(e,s);break;case Pe.TagString:{if(!this.currentSimpleTagName)break;const a=Hh(e,s);this.processTagValue(this.currentSimpleTagName,a)}break;case Pe.TagBinary:{if(!this.currentSimpleTagName)break;const a=Ct(e,s);this.processTagValue(this.currentSimpleTagName,a)}break;case Pe.AttachedFile:{if(!this.currentSegment)break;this.currentAttachedFile={fileUid:null,fileName:null,fileMediaType:null,fileData:null,fileDescription:null},this.readContiguousElements(e.slice(o,s));const a=this.currentSegment.metadataTags;if(this.currentAttachedFile.fileUid&&this.currentAttachedFile.fileData&&(a.raw??={},a.raw[this.currentAttachedFile.fileUid.toString()]=new aD(this.currentAttachedFile.fileData,this.currentAttachedFile.fileMediaType??void 0,this.currentAttachedFile.fileName??void 0,this.currentAttachedFile.fileDescription??void 0)),this.currentAttachedFile.fileMediaType?.startsWith("image/")&&this.currentAttachedFile.fileData){const l=this.currentAttachedFile.fileName;let c="unknown";if(l){const u=l.toLowerCase();u.startsWith("cover.")?c="coverFront":u.startsWith("back.")&&(c="coverBack")}a.images??=[],a.images.push({data:this.currentAttachedFile.fileData,mimeType:this.currentAttachedFile.fileMediaType,kind:c,name:this.currentAttachedFile.fileName??void 0,description:this.currentAttachedFile.fileDescription??void 0})}this.currentAttachedFile=null}break;case Pe.FileUID:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileUid=Wte(e,s)}break;case Pe.FileName:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileName=Hh(e,s)}break;case Pe.FileMediaType:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileMediaType=Ud(e,s)}break;case Pe.FileData:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileData=Ct(e,s)}break;case Pe.FileDescription:{if(!this.currentAttachedFile)break;this.currentAttachedFile.fileDescription=Hh(e,s)}break;case Pe.ContentEncodings:{if(!this.currentTrack)break;this.readContiguousElements(e.slice(o,s)),this.currentTrack.decodingInstructions.sort((a,l)=>l.order-a.order)}break;case Pe.ContentEncoding:this.currentDecodingInstruction={order:0,scope:yy.Block,data:null},this.readContiguousElements(e.slice(o,s)),this.currentDecodingInstruction.data&&this.currentTrack.decodingInstructions.push(this.currentDecodingInstruction),this.currentDecodingInstruction=null;break;case Pe.ContentEncodingOrder:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.order=Ut(e,s)}break;case Pe.ContentEncodingScope:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.scope=Ut(e,s)}break;case Pe.ContentCompression:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decompress",algorithm:Ep.Zlib,settings:null},this.readContiguousElements(e.slice(o,s))}break;case Pe.ContentCompAlgo:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.algorithm=Ut(e,s)}break;case Pe.ContentCompSettings:{if(this.currentDecodingInstruction?.data?.type!=="decompress")break;this.currentDecodingInstruction.data.settings=Ct(e,s)}break;case Pe.ContentEncryption:{if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decrypt"}}break}return e.filePos=o+s,!0}decodeBlockData(e,n){W(e.decodingInstructions.length>0);let r=n;for(const i of e.decodingInstructions)switch(W(i.data),i.data.type){case"decompress":switch(i.data.algorithm){case Ep.HeaderStripping:if(i.data.settings&&i.data.settings.length>0){const s=i.data.settings,o=new Uint8Array(s.length+r.length);o.set(s,0),o.set(r,s.length),r=o}break}break}return r}processTagValue(e,n){if(!this.currentSegment?.metadataTags)return;const r=this.currentSegment.metadataTags;if(r.raw??={},r.raw[e]??=n,typeof n=="string")switch(e.toLowerCase()){case"title":r.title??=n;break;case"description":r.description??=n;break;case"artist":r.artist??=n;break;case"album":r.album??=n;break;case"album_artist":r.albumArtist??=n;break;case"genre":r.genre??=n;break;case"comment":r.comment??=n;break;case"lyrics":r.lyrics??=n;break;case"date":{const i=new Date(n);Number.isNaN(i.getTime())||(r.date??=i)}break;case"track_number":case"part_number":{const i=n.split("/"),s=Number.parseInt(i[0],10),o=i[1]&&Number.parseInt(i[1],10);Number.isInteger(s)&&s>0&&(r.trackNumber??=s),o&&Number.isInteger(o)&&o>0&&(r.tracksTotal??=o)}break;case"disc_number":case"disc":{const i=n.split("/"),s=Number.parseInt(i[0],10),o=i[1]&&Number.parseInt(i[1],10);Number.isInteger(s)&&s>0&&(r.discNumber??=s),o&&Number.isInteger(o)&&o>0&&(r.discsTotal??=o)}break}}}class MD{constructor(e){this.internalTrack=e,this.packetToClusterLocation=new WeakMap}getId(){return this.internalTrack.id}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.internalTrack.codecId}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return this.internalTrack.name}getLanguageCode(){return this.internalTrack.languageCode}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}getTimeResolution(){return this.internalTrack.segment.timestampFactor}getDisposition(){return this.internalTrack.disposition}async getFirstPacket(e){return this.performClusterLookup(null,n=>n.trackData.get(this.internalTrack.id)?{blockIndex:0,correctBlockFound:!0}:{blockIndex:-1,correctBlockFound:!1},-1/0,1/0,e)}intoTimescale(e){return tm(e*this.internalTrack.segment.timestampFactor)}async getPacket(e,n){const r=this.intoTimescale(e);return this.performClusterLookup(null,i=>{const s=i.trackData.get(this.internalTrack.id);if(!s)return{blockIndex:-1,correctBlockFound:!1};const o=fn(s.presentationTimestamps,r,c=>c.timestamp),a=o!==-1?s.presentationTimestamps[o].blockIndex:-1,l=o!==-1&&r<s.endTimestamp;return{blockIndex:a,correctBlockFound:l}},r,r,n)}async getNextPacket(e,n){const r=this.packetToClusterLocation.get(e);if(r===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(r.cluster,i=>{if(i===r.cluster){const s=i.trackData.get(this.internalTrack.id);if(r.blockIndex+1<s.blocks.length)return{blockIndex:r.blockIndex+1,correctBlockFound:!0}}else if(i.trackData.get(this.internalTrack.id))return{blockIndex:0,correctBlockFound:!0};return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,n)}async getKeyPacket(e,n){const r=this.intoTimescale(e);return this.performClusterLookup(null,i=>{const s=i.trackData.get(this.internalTrack.id);if(!s)return{blockIndex:-1,correctBlockFound:!1};const o=XE(s.presentationTimestamps,c=>s.blocks[c.blockIndex].isKeyFrame&&c.timestamp<=r),a=o!==-1?s.presentationTimestamps[o].blockIndex:-1,l=o!==-1&&r<s.endTimestamp;return{blockIndex:a,correctBlockFound:l}},r,r,n)}async getNextKeyPacket(e,n){const r=this.packetToClusterLocation.get(e);if(r===void 0)throw new Error("Packet was not created from this track.");return this.performClusterLookup(r.cluster,i=>{if(i===r.cluster){const o=i.trackData.get(this.internalTrack.id).blocks.findIndex((a,l)=>a.isKeyFrame&&l>r.blockIndex);if(o!==-1)return{blockIndex:o,correctBlockFound:!0}}else{const s=i.trackData.get(this.internalTrack.id);if(s&&s.firstKeyFrameTimestamp!==null){const o=s.blocks.findIndex(a=>a.isKeyFrame);return W(o!==-1),{blockIndex:o,correctBlockFound:!0}}}return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,n)}async fetchPacketInCluster(e,n,r){if(n===-1)return null;const s=e.trackData.get(this.internalTrack.id).blocks[n];W(s),s.decoded||(s.data=this.internalTrack.demuxer.decodeBlockData(this.internalTrack,s.data),s.decoded=!0);const o=r.metadataOnly?ys:s.data,a=s.timestamp/this.internalTrack.segment.timestampFactor,l=s.duration/this.internalTrack.segment.timestampFactor,c={};s.mainAdditional&&this.internalTrack.info?.type==="video"&&this.internalTrack.info.alphaMode&&(c.alpha=r.metadataOnly?ys:s.mainAdditional,c.alphaByteLength=s.mainAdditional.byteLength);const u=new Mn(o,s.isKeyFrame?"key":"delta",a,l,e.dataStartPos+n,s.data.byteLength,c);return this.packetToClusterLocation.set(u,{cluster:e,blockIndex:n}),u}async performClusterLookup(e,n,r,i,s){const{demuxer:o,segment:a}=this.internalTrack;let l=null,c=null,u=-1;if(e){const{blockIndex:y,correctBlockFound:b}=n(e);if(b)return this.fetchPacketInCluster(e,y,s);y!==-1&&(c=e,u=y)}const d=fn(this.internalTrack.cuePoints,r,y=>y.time),f=d!==-1?this.internalTrack.cuePoints[d]:null,h=fn(this.internalTrack.clusterPositionCache,r,y=>y.startTimestamp),p=h!==-1?this.internalTrack.clusterPositionCache[h]:null,m=Math.max(f?.clusterPosition??0,p?.elementStartPos??0)||null;let g;for(e?m===null||e.elementStartPos>=m?(g=e.elementEndPos,l=e):g=m:g=m??a.clusterSeekStartPos;a.elementEndPos===null||g<=a.elementEndPos-Ms;){if(l){const k=l.trackData.get(this.internalTrack.id);if(k&&k.startTimestamp>i)break}let y=o.reader.requestSliceRange(g,Ms,Va);if(y instanceof Promise&&(y=await y),!y)break;const b=g,S=Da(y);if(!S||!om.includes(S.id)&&S.id!==Pe.Void){const k=await ID(o.reader,b,om,Math.min(a.elementEndPos??1/0,b+OD));if(k){g=k;continue}else break}const C=S.id;let _=S.size;const x=y.filePos;if(C===Pe.Cluster){l=await o.readCluster(b,a),_=l.elementEndPos-x;const{blockIndex:k,correctBlockFound:T}=n(l);if(T)return this.fetchPacketInCluster(l,k,s);k!==-1&&(c=l,u=k)}_===void 0&&(W(C!==Pe.Cluster),_=(await Kx(o.reader,x,f0,a.elementEndPos)).pos-x);const I=x+_;if(a.elementEndPos===null){let k=o.reader.requestSliceRange(I,Ms,Va);if(k instanceof Promise&&(k=await k),!k)break;if(cT(k)===Pe.Segment){a.elementEndPos=I;break}}g=I}if(f&&(!c||c.elementStartPos<f.clusterPosition)){const y=this.internalTrack.cuePoints[d-1];W(!y||y.time<f.time);const b=y?.time??-1/0;return this.performClusterLookup(null,n,b,i,s)}return c?this.fetchPacketInCluster(c,u,s):null}}class Kte extends MD{constructor(e){super(e),this.decoderConfigPromise=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getCodedWidth(){return this.internalTrack.info.width}getCodedHeight(){return this.internalTrack.info.height}getRotation(){return this.internalTrack.info.rotation}async getColorSpace(){return{primaries:this.internalTrack.info.colorSpace?.primaries,transfer:this.internalTrack.info.colorSpace?.transfer,matrix:this.internalTrack.info.colorSpace?.matrix,fullRange:this.internalTrack.info.colorSpace?.fullRange}}async canBeTransparent(){return this.internalTrack.info.alphaMode}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfigPromise??=(async()=>{let e=null;return(this.internalTrack.info.codec==="vp9"||this.internalTrack.info.codec==="av1"||this.internalTrack.info.codec==="avc"&&!this.internalTrack.info.codecDescription||this.internalTrack.info.codec==="hevc"&&!this.internalTrack.info.codecDescription)&&(e=await this.getFirstPacket({})),{codec:YE({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcType:1,avcCodecInfo:this.internalTrack.info.codec==="avc"&&e?tT(e.data):null,hevcCodecInfo:this.internalTrack.info.codec==="hevc"&&e?rT(e.data):null,vp9CodecInfo:this.internalTrack.info.codec==="vp9"&&e?gD(e.data):null,av1CodecInfo:this.internalTrack.info.codec==="av1"&&e?bD(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:this.internalTrack.info.codecDescription??void 0,colorSpace:this.internalTrack.info.colorSpace??void 0}})():null}}class Gte extends MD{constructor(e){super(e),this.decoderConfig=null,this.internalTrack=e}getCodec(){return this.internalTrack.info.codec}getNumberOfChannels(){return this.internalTrack.info.numberOfChannels}getSampleRate(){return this.internalTrack.info.sampleRate}async getDecoderConfig(){return this.internalTrack.info.codec?this.decoderConfig??={codec:JE({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:this.internalTrack.info.codecDescription??void 0}:null}}const Tp=4,Zte=[44100,48e3,32e3],Xte=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1,-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1,-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],Qte=1483304551,Yte=1231971951,Jte=(t,e,n,r,i)=>e===0?0:e===1?Math.floor(144*n/(r<<t))+i:e===2?Math.floor(144*n/r)+i:(Math.floor(12*n/r)+i)*4,ene=(t,e)=>t===3?e===3?21:36:e===3?13:21,uT=(t,e)=>{const n=t>>>24,r=t>>>16&255,i=t>>>8&255,s=t&255;if(n!==255&&r!==255&&i!==255&&s!==255)return{header:null,bytesAdvanced:4};if(n!==255)return{header:null,bytesAdvanced:1};if((r&224)!==224)return{header:null,bytesAdvanced:1};let o=0,a=0;r&16?o=r&8?0:1:(o=1,a=1);const l=r>>3&3,c=r>>1&3,u=i>>4&15,d=(i>>2&3)%3,f=i>>1&1,h=s>>6&3,p=s>>4&3,m=s>>3&1,g=s>>2&1,y=s&3,b=Xte[o*16*4+c*16+u];if(b===-1)return{header:null,bytesAdvanced:1};const S=b*1e3,C=Zte[d]>>o+a,_=Jte(o,c,S,C,f);if(e!==null&&e<_)return{header:null,bytesAdvanced:1};let x;return l===3?x=c===3?384:1152:c===3?x=384:c===2?x=1152:x=576,{header:{totalSize:_,mpegVersionId:l,layer:c,bitrate:S,frequencyIndex:d,sampleRate:C,channel:h,modeExtension:p,copyright:m,original:g,emphasis:y,audioSamplesInFrame:x},bytesAdvanced:1}},Gx=t=>{let e=2130706432,n=0;for(;e!==0;)n>>=1,n|=t&e,e>>=8;return n};var Jd;(function(t){t[t.Unsynchronisation=128]="Unsynchronisation",t[t.ExtendedHeader=64]="ExtendedHeader",t[t.ExperimentalIndicator=32]="ExperimentalIndicator",t[t.Footer=16]="Footer"})(Jd||(Jd={}));var ef;(function(t){t[t.ISO_8859_1=0]="ISO_8859_1",t[t.UTF_16_WITH_BOM=1]="UTF_16_WITH_BOM",t[t.UTF_16_BE_NO_BOM=2]="UTF_16_BE_NO_BOM",t[t.UTF_8=3]="UTF_8"})(ef||(ef={}));const h0=128,by=10,tf=["Blues","Classic rock","Country","Dance","Disco","Funk","Grunge","Hip-hop","Jazz","Metal","New age","Oldies","Other","Pop","Rhythm and blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death metal","Pranks","Soundtrack","Euro-techno","Ambient","Trip-hop","Vocal","Jazz & funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound clip","Gospel","Noise","Alternative rock","Bass","Soul","Punk","Space","Meditative","Instrumental pop","Instrumental rock","Ethnic","Gothic","Darkwave","Techno-industrial","Electronic","Pop-folk","Eurodance","Dream","Southern rock","Comedy","Cult","Gangsta","Top 40","Christian rap","Pop/funk","Jungle music","Native US","Cabaret","New wave","Psychedelic","Rave","Showtunes","Trailer","Lo-fi","Tribal","Acid punk","Acid jazz","Polka","Retro","Musical","Rock 'n' roll","Hard rock","Folk","Folk rock","National folk","Swing","Fast fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic rock","Progressive rock","Psychedelic rock","Symphonic rock","Slow rock","Big band","Chorus","Easy listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber music","Sonata","Symphony","Booty bass","Primus","Porn groove","Satire","Slow jam","Club","Tango","Samba","Folklore","Ballad","Power ballad","Rhythmic Soul","Freestyle","Duet","Punk rock","Drum solo","A cappella","Euro-house","Dance hall","Goa music","Drum & bass","Club-house","Hardcore techno","Terror","Indie","Britpop","Negerpunk","Polsk punk","Beat","Christian gangsta rap","Heavy metal","Black metal","Crossover","Contemporary Christian","Christian rock","Merengue","Salsa","Thrash metal","Anime","Jpop","Synthpop","Christmas","Art rock","Baroque","Bhangra","Big beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math rock","New romantic","Nu-breakz","Post-punk","Post-rock","Psytrance","Shoegaze","Space rock","Trop rock","World music","Neoclassical","Audiobook","Audio theatre","Neue Deutsche Welle","Podcast","Indie rock","G-Funk","Dubstep","Garage rock","Psybient"],tne=(t,e)=>{const n=t.filePos;e.raw??={},e.raw.TAG??=Ct(t,h0-3),t.filePos=n;const r=Nd(t,30);r&&(e.title??=r);const i=Nd(t,30);i&&(e.artist??=i);const s=Nd(t,30);s&&(e.album??=s);const o=Nd(t,4),a=Number.parseInt(o,10);Number.isInteger(a)&&a>0&&(e.date??=new Date(a,0,1));const l=Ct(t,30);let c;if(l[28]===0&&l[29]!==0){const d=l[29];d>0&&(e.trackNumber??=d),t.skip(-30),c=Nd(t,28),t.skip(2)}else t.skip(-30),c=Nd(t,30);c&&(e.comment??=c);const u=mt(t);u<tf.length&&(e.genre??=tf[u])},Nd=(t,e)=>{const n=Ct(t,e),r=zd(n.indexOf(0),n.length),i=n.subarray(0,r);let s="";for(let o=0;o<i.length;o++)s+=String.fromCharCode(i[o]);return s.trimEnd()},wy=t=>{const e=t.filePos,n=Gr(t,3),r=mt(t),i=mt(t),s=mt(t),o=nt(t);if(n!=="ID3"||r===255||i===255||(o&2155905152)!==0)return t.filePos=e,null;const a=Gx(o);return{majorVersion:r,revision:i,flags:s,size:a}},ND=(t,e,n)=>{if(![2,3,4].includes(e.majorVersion)){console.warn(`Unsupported ID3v2 major version: ${e.majorVersion}`);return}const r=Ct(t,e.size),i=new nne(e,r);if(e.flags&Jd.Footer&&i.removeFooter(),e.flags&Jd.Unsynchronisation&&e.majorVersion===3&&i.ununsynchronizeAll(),e.flags&Jd.ExtendedHeader){const s=i.readU32();e.majorVersion===3?i.pos+=s:i.pos+=s-4}for(;i.pos<=i.bytes.length-i.frameHeaderSize();){const s=i.readId3V2Frame();if(!s)break;const o=i.pos,a=i.pos+s.size;let l=!1,c=!1,u=!1;if(e.majorVersion===3?(l=!!(s.flags&64),c=!!(s.flags&128)):e.majorVersion===4&&(l=!!(s.flags&4),c=!!(s.flags&8),u=!!(s.flags&2)||!!(e.flags&Jd.Unsynchronisation)),l){console.warn(`Skipping encrypted ID3v2 frame ${s.id}`),i.pos=a;continue}if(c){console.warn(`Skipping compressed ID3v2 frame ${s.id}`),i.pos=a;continue}switch(u&&i.ununsynchronizeRegion(i.pos,a),n.raw??={},s.id[0]==="T"?n.raw[s.id]??=i.readId3V2EncodingAndText(a):n.raw[s.id]??=i.readBytes(s.size),i.pos=o,s.id){case"TIT2":case"TT2":n.title??=i.readId3V2EncodingAndText(a);break;case"TIT3":case"TT3":n.description??=i.readId3V2EncodingAndText(a);break;case"TPE1":case"TP1":n.artist??=i.readId3V2EncodingAndText(a);break;case"TALB":case"TAL":n.album??=i.readId3V2EncodingAndText(a);break;case"TPE2":case"TP2":n.albumArtist??=i.readId3V2EncodingAndText(a);break;case"TRCK":case"TRK":{const f=i.readId3V2EncodingAndText(a).split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(n.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(n.tracksTotal??=p)}break;case"TPOS":case"TPA":{const f=i.readId3V2EncodingAndText(a).split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(n.discNumber??=h),p&&Number.isInteger(p)&&p>0&&(n.discsTotal??=p)}break;case"TCON":case"TCO":{const d=i.readId3V2EncodingAndText(a);let f=/^\((\d+)\)/.exec(d);if(f){const h=Number.parseInt(f[1]);if(tf[h]!==void 0){n.genre??=tf[h];break}}if(f=/^\d+$/.exec(d),f){const h=Number.parseInt(f[0]);if(tf[h]!==void 0){n.genre??=tf[h];break}}n.genre??=d}break;case"TDRC":case"TDAT":{const d=i.readId3V2EncodingAndText(a),f=new Date(d);Number.isNaN(f.getTime())||(n.date??=f)}break;case"TYER":case"TYE":{const d=i.readId3V2EncodingAndText(a),f=Number.parseInt(d,10);Number.isInteger(f)&&(n.date??=new Date(f,0,1))}break;case"USLT":case"ULT":{const d=i.readU8();i.pos+=3,i.readId3V2Text(d,a),n.lyrics??=i.readId3V2Text(d,a)}break;case"COMM":case"COM":{const d=i.readU8();i.pos+=3,i.readId3V2Text(d,a),n.comment??=i.readId3V2Text(d,a)}break;case"APIC":case"PIC":{const d=i.readId3V2TextEncoding();let f;if(e.majorVersion===2){const g=i.readAscii(3);f=g==="PNG"?"image/png":g==="JPG"?"image/jpeg":"image/*"}else f=i.readId3V2Text(d,a);const h=i.readU8(),p=i.readId3V2Text(d,a).trimEnd(),m=a-i.pos;if(m>=0){const g=i.readBytes(m);n.images||(n.images=[]),n.images.push({data:g,mimeType:f,kind:h===3?"coverFront":h===4?"coverBack":"unknown",description:p})}}break;default:i.pos+=s.size;break}i.pos=a}};class nne{constructor(e,n){this.header=e,this.bytes=n,this.pos=0,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength)}frameHeaderSize(){return this.header.majorVersion===2?6:10}ununsynchronizeAll(){const e=[];for(let n=0;n<this.bytes.length;n++){const r=this.bytes[n];e.push(r),r===255&&n!==this.bytes.length-1&&this.bytes[n]===0&&n++}this.bytes=new Uint8Array(e),this.view=new DataView(this.bytes.buffer)}ununsynchronizeRegion(e,n){const r=[];for(let o=e;o<n;o++){const a=this.bytes[o];r.push(a),a===255&&o!==n-1&&this.bytes[o+1]===0&&o++}const i=this.bytes.subarray(0,e),s=this.bytes.subarray(n);this.bytes=new Uint8Array(i.length+r.length+s.length),this.bytes.set(i,0),this.bytes.set(r,i.length),this.bytes.set(s,i.length+r.length),this.view=new DataView(this.bytes.buffer)}removeFooter(){this.bytes=this.bytes.subarray(0,this.bytes.length-by),this.view=new DataView(this.bytes.buffer)}readBytes(e){const n=this.bytes.subarray(this.pos,this.pos+e);return this.pos+=e,n}readU8(){const e=this.view.getUint8(this.pos);return this.pos+=1,e}readU16(){const e=this.view.getUint16(this.pos,!1);return this.pos+=2,e}readU24(){const e=this.view.getUint16(this.pos,!1),n=this.view.getUint8(this.pos+1);return this.pos+=3,e*256+n}readU32(){const e=this.view.getUint32(this.pos,!1);return this.pos+=4,e}readAscii(e){let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(this.view.getUint8(this.pos+r));return this.pos+=e,n}readId3V2Frame(){if(this.header.majorVersion===2){const e=this.readAscii(3);if(e==="\0\0\0")return null;const n=this.readU24();return{id:e,size:n,flags:0}}else{const e=this.readAscii(4);if(e==="\0\0\0\0")return null;const n=this.readU32();let r=this.header.majorVersion===4?Gx(n):n;const i=this.readU16(),s=this.pos,o=a=>{const l=this.pos+a;if(l>this.bytes.length)return!1;if(l<=this.bytes.length-this.frameHeaderSize()){this.pos+=a;const c=this.readAscii(4);if(c!=="\0\0\0\0"&&!/[0-9A-Z]{4}/.test(c))return!1}return!0};if(!o(r)){const a=this.header.majorVersion===4?n:Gx(n);o(a)&&(r=a)}return this.pos=s,{id:e,size:r,flags:i}}}readId3V2TextEncoding(){const e=this.readU8();if(e>3)throw new Error(`Unsupported text encoding: ${e}`);return e}readId3V2Text(e,n){const r=this.pos,i=this.readBytes(n-this.pos);switch(e){case ef.ISO_8859_1:{let s="";for(let o=0;o<i.length;o++){const a=i[o];if(a===0){this.pos=r+o+1;break}s+=String.fromCharCode(a)}return s}case ef.UTF_16_WITH_BOM:if(i[0]===255&&i[1]===254){const s=new TextDecoder("utf-16le"),o=zd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(2,o))}else if(i[0]===254&&i[1]===255){const s=new TextDecoder("utf-16be"),o=zd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(2,o))}else{const s=zd(i.findIndex(o=>o===0),i.length);return this.pos=r+Math.min(s+1,i.length),zs.decode(i.subarray(0,s))}case ef.UTF_16_BE_NO_BOM:{const s=new TextDecoder("utf-16be"),o=zd(i.findIndex((a,l)=>a===0&&i[l+1]===0&&l%2===0),i.length);return this.pos=r+Math.min(o+2,i.length),s.decode(i.subarray(0,o))}case ef.UTF_8:{const s=zd(i.findIndex(o=>o===0),i.length);return this.pos=r+Math.min(s+1,i.length),zs.decode(i.subarray(0,s))}}}readId3V2EncodingAndText(e){if(this.pos>=e)return"";const n=this.readId3V2TextEncoding();return this.readId3V2Text(n,e)}}const Zx=async(t,e,n)=>{let r=e;for(;n===null||r<n;){let i=t.requestSlice(r,Tp);if(i instanceof Promise&&(i=await i),!i)break;const s=nt(i),o=uT(s,t.fileSize!==null?t.fileSize-r:null);if(o.header)return{header:o.header,startPos:r};r+=o.bytesAdvanced}return null};class rne extends tu{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.metadataTags=null,this.tracks=[],this.readingMutex=new yd,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();if(!this.firstFrameHeader)throw new Error("No valid MP3 frame found.");this.tracks=[new ca(this.input,new ine(this))]})()}async advanceReader(){if(this.lastLoadedPos===0)for(;;){let a=this.reader.requestSlice(this.lastLoadedPos,by);if(a instanceof Promise&&(a=await a),!a){this.lastSampleLoaded=!0;return}const l=wy(a);if(!l)break;this.lastLoadedPos=a.filePos+l.size}const e=await Zx(this.reader,this.lastLoadedPos,this.reader.fileSize);if(!e){this.lastSampleLoaded=!0;return}const n=e.header;this.lastLoadedPos=e.startPos+n.totalSize-1;const r=ene(n.mpegVersionId,n.channel);let i=this.reader.requestSlice(e.startPos+r,4);if(i instanceof Promise&&(i=await i),i){const a=nt(i);if(a===Qte||a===Yte)return}this.firstFrameHeader||(this.firstFrameHeader=n),n.sampleRate!==this.firstFrameHeader.sampleRate&&console.warn(`MP3 changed sample rate mid-file: ${this.firstFrameHeader.sampleRate} Hz to ${n.sampleRate} Hz. Might be a bug, so please report this file.`);const s=n.audioSamplesInFrame/this.firstFrameHeader.sampleRate,o={timestamp:this.nextTimestampInSamples/this.firstFrameHeader.sampleRate,duration:s,dataStart:e.startPos,dataSize:n.totalSize};this.loadedSamples.push(o),this.nextTimestampInSamples+=n.audioSamplesInFrame}async getMimeType(){return"audio/mpeg"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return W(e),e.computeDuration()}async getMetadataTags(){const e=await this.readingMutex.acquire();try{if(await this.readMetadata(),this.metadataTags)return this.metadataTags;this.metadataTags={};let n=0,r=!1;for(;;){let i=this.reader.requestSlice(n,by);if(i instanceof Promise&&(i=await i),!i)break;const s=wy(i);if(!s)break;r=!0;let o=this.reader.requestSlice(i.filePos,s.size);if(o instanceof Promise&&(o=await o),!o)break;ND(o,s,this.metadataTags),n=i.filePos+s.size}if(!r&&this.reader.fileSize!==null&&this.reader.fileSize>=h0){let i=this.reader.requestSlice(this.reader.fileSize-h0,h0);i instanceof Promise&&(i=await i),W(i),Gr(i,3)==="TAG"&&tne(i,this.metadataTags)}return this.metadataTags}finally{e()}}}class ine{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return W(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return cs}getCodec(){return"mp3"}getInternalCodecId(){return null}getNumberOfChannels(){return W(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.channel===3?1:2}getSampleRate(){return W(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}getDisposition(){return{...Jc}}async getDecoderConfig(){return W(this.demuxer.firstFrameHeader),{codec:"mp3",numberOfChannels:this.demuxer.firstFrameHeader.channel===3?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}}async getPacketAtIndex(e,n){if(e===-1)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=ys;else{let s=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize);if(s instanceof Promise&&(s=await s),!s)return null;i=Ct(s,r.dataSize)}return new Mn(i,"key",r.timestamp,r.duration,e,r.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=Gm(this.demuxer.loadedSamples,e.timestamp,o=>o.timestamp);if(i===-1)throw new Error("Packet was not created from this track.");const s=i+1;for(;s>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(s,n)}finally{r()}}async getPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=fn(this.demuxer.loadedSamples,e,s=>s.timestamp);if(i===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(i,n);if(i>=0&&i+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(i,n);await this.demuxer.advanceReader()}}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const RD=1399285583,sne=79764919,DD=new Uint32Array(256);for(let t=0;t<256;t++){let e=t<<24;for(let n=0;n<8;n++)e=e&2147483648?e<<1^sne:e<<1;DD[t]=e>>>0&4294967295}const one=t=>{const e=jn(t),n=e.getUint32(22,!0);e.setUint32(22,0,!0);let r=0;for(let i=0;i<t.length;i++){const s=t[i];r=(r<<8^DD[r>>>24^s])>>>0}return e.setUint32(22,n,!0),r},ane=(t,e,n)=>{let r=0,i=null;if(t.length>0)if(e.codec==="vorbis"){W(e.vorbisInfo);const s=e.vorbisInfo.modeBlockflags.length,a=(1<<$ee(s-1))-1<<1,l=(t[0]&a)>>1;if(l>=e.vorbisInfo.modeBlockflags.length)throw new Error("Invalid mode number.");let c=n;const u=e.vorbisInfo.modeBlockflags[l];if(i=e.vorbisInfo.blocksizes[u],u===1){const d=(a|1)+1,f=t[0]&d?1:0;c=e.vorbisInfo.blocksizes[f]}r=c!==null?c+i>>2:0}else e.codec==="opus"&&(r=vte(t).durationInSamples);return{durationInSamples:r,vorbisBlockSize:i}},lne=t=>{let e="audio/ogg";if(t.codecStrings){const n=[...new Set(t.codecStrings)];e+=`; codecs="${n.join(", ")}"`}return e};const Au=27,xf=282,cne=xf+65025,Cp=t=>{const e=t.filePos;if(sf(t)!==RD)return null;t.skip(1);const r=mt(t),i=Jne(t),s=sf(t),o=sf(t),a=sf(t),l=mt(t),c=new Uint8Array(l);for(let h=0;h<l;h++)c[h]=mt(t);const u=27+l,d=c.reduce((h,p)=>h+p,0),f=u+d;return{headerStartPos:e,totalSize:f,dataStartPos:e+u,dataSize:d,headerType:r,granulePosition:i,serialNumber:s,sequenceNumber:o,checksum:a,lacingValues:c}},une=(t,e)=>{for(;t.filePos<e-3;){const n=sf(t),r=n&255,i=n>>>8&255,s=n>>>16&255,o=n>>>24&255,a=79;if(!(r!==a&&i!==a&&s!==a&&o!==a)){if(t.skip(-4),n===RD)return!0;t.skip(1)}}return!1};class dne extends tu{constructor(e){super(e),this.metadataPromise=null,this.bitstreams=[],this.tracks=[],this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=0;for(;;){let n=this.reader.requestSliceRange(e,Au,xf);if(n instanceof Promise&&(n=await n),!n)break;const r=Cp(n);if(!r||!!!(r.headerType&2))break;this.bitstreams.push({serialNumber:r.serialNumber,bosPage:r,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),e=r.headerStartPos+r.totalSize}for(const n of this.bitstreams){const r=await this.readPacket(n.bosPage,0);r&&(r.data.byteLength>=7&&r.data[0]===1&&r.data[1]===118&&r.data[2]===111&&r.data[3]===114&&r.data[4]===98&&r.data[5]===105&&r.data[6]===115?await this.readVorbisMetadata(r,n):r.data.byteLength>=8&&r.data[0]===79&&r.data[1]===112&&r.data[2]===117&&r.data[3]===115&&r.data[4]===72&&r.data[5]===101&&r.data[6]===97&&r.data[7]===100&&await this.readOpusMetadata(r,n),n.codecInfo.codec!==null&&this.tracks.push(new ca(this.input,new fne(n,this))))}})()}async readVorbisMetadata(e,n){let r=await this.findNextPacketStart(e);if(!r)return;const i=await this.readPacket(r.startPage,r.startSegmentIndex);if(!i||(r=await this.findNextPacketStart(i),!r))return;const s=await this.readPacket(r.startPage,r.startSegmentIndex);if(!s||i.data[0]!==3||s.data[0]!==5)return;const o=[],a=d=>{for(;o.push(Math.min(255,d)),!(d<255);)d-=255};a(e.data.length),a(i.data.length);const l=new Uint8Array(1+o.length+e.data.length+i.data.length+s.data.length);l[0]=2,l.set(o,1),l.set(e.data,1+o.length),l.set(i.data,1+o.length+e.data.length),l.set(s.data,1+o.length+e.data.length+i.data.length),n.codecInfo.codec="vorbis",n.description=l,n.lastMetadataPacket=s;const c=jn(e.data);n.numberOfChannels=c.getUint8(11),n.sampleRate=c.getUint32(12,!0);const u=c.getUint8(28);n.codecInfo.vorbisInfo={blocksizes:[1<<(u&15),1<<(u>>4)],modeBlockflags:xte(s.data).modeBlockflags},Ux(i.data.subarray(7),this.metadataTags)}async readOpusMetadata(e,n){const r=await this.findNextPacketStart(e);if(!r)return;const i=await this.readPacket(r.startPage,r.startSegmentIndex);if(!i)return;n.codecInfo.codec="opus",n.description=e.data,n.lastMetadataPacket=i;const s=wD(e.data);n.numberOfChannels=s.outputChannelCount,n.sampleRate=pw,n.codecInfo.opusInfo={preSkip:s.preSkip},Ux(i.data.subarray(8),this.metadataTags)}async readPacket(e,n){W(n<e.lacingValues.length);let r=0;for(let d=0;d<n;d++)r+=e.lacingValues[d];let i=e,s=r,o=n;const a=[];e:for(;;){let d=this.reader.requestSlice(i.dataStartPos,i.dataSize);d instanceof Promise&&(d=await d),W(d);const f=Ct(d,i.dataSize);for(;;){if(o===i.lacingValues.length){a.push(f.subarray(r,s));break}const p=i.lacingValues[o];if(s+=p,p<255){a.push(f.subarray(r,s));break e}o++}let h=i.headerStartPos+i.totalSize;for(;;){let p=this.reader.requestSliceRange(h,Au,xf);if(p instanceof Promise&&(p=await p),!p)return null;const m=Cp(p);if(!m)return null;if(i=m,i.serialNumber===e.serialNumber)break;h=i.headerStartPos+i.totalSize}r=0,s=0,o=0}const l=a.reduce((d,f)=>d+f.length,0);if(l===0)return null;const c=new Uint8Array(l);let u=0;for(let d=0;d<a.length;d++){const f=a[d];c.set(f,u),u+=f.length}return{data:c,endPage:i,endSegmentIndex:o}}async findNextPacketStart(e){if(e.endSegmentIndex<e.endPage.lacingValues.length-1)return{startPage:e.endPage,startSegmentIndex:e.endSegmentIndex+1};if(!!(e.endPage.headerType&4))return null;let r=e.endPage.headerStartPos+e.endPage.totalSize;for(;;){let i=this.reader.requestSliceRange(r,Au,xf);if(i instanceof Promise&&(i=await i),!i)return null;const s=Cp(i);if(!s)return null;if(s.serialNumber===e.endPage.serialNumber)return{startPage:s,startSegmentIndex:0};r=s.headerStartPos+s.totalSize}}async getMimeType(){await this.readMetadata();const e=await Promise.all(this.tracks.map(n=>n.getCodecParameterString()));return lne({codecStrings:e.filter(Boolean)})}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}class fne{constructor(e,n){this.bitstream=e,this.demuxer=n,this.encodedPacketToMetadata=new WeakMap,this.sequentialScanCache=[],this.sequentialScanMutex=new yd,this.internalSampleRate=e.codecInfo.codec==="opus"?pw:e.sampleRate}getId(){return this.bitstream.serialNumber}getNumberOfChannels(){return this.bitstream.numberOfChannels}getSampleRate(){return this.bitstream.sampleRate}getTimeResolution(){return this.bitstream.sampleRate}getCodec(){return this.bitstream.codecInfo.codec}getInternalCodecId(){return null}async getDecoderConfig(){return W(this.bitstream.codecInfo.codec),{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:this.bitstream.description??void 0}}getName(){return null}getLanguageCode(){return cs}getDisposition(){return{...Jc}}async getFirstTimestamp(){return 0}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}granulePositionToTimestampInSamples(e){return this.bitstream.codecInfo.codec==="opus"?(W(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}createEncodedPacketFromOggPacket(e,n,r){if(!e)return null;const{durationInSamples:i,vorbisBlockSize:s}=ane(e.data,this.bitstream.codecInfo,n.vorbisLastBlocksize),o=new Mn(r.metadataOnly?ys:e.data,"key",Math.max(0,n.timestampInSamples)/this.internalSampleRate,i/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(o,{packet:e,timestampInSamples:n.timestampInSamples,durationInSamples:i,vorbisLastBlockSize:n.vorbisLastBlocksize,vorbisBlockSize:s}),o}async getFirstPacket(e){W(this.bitstream.lastMetadataPacket);const n=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!n)return null;let r=0;this.bitstream.codecInfo.codec==="opus"&&(W(this.bitstream.codecInfo.opusInfo),r-=this.bitstream.codecInfo.opusInfo.preSkip);const i=await this.demuxer.readPacket(n.startPage,n.startSegmentIndex);return this.createEncodedPacketFromOggPacket(i,{timestampInSamples:r,vorbisLastBlocksize:null},e)}async getNextPacket(e,n){const r=this.encodedPacketToMetadata.get(e);if(!r)throw new Error("Packet was not created from this track.");const i=await this.demuxer.findNextPacketStart(r.packet);if(!i)return null;const s=r.timestampInSamples+r.durationInSamples,o=await this.demuxer.readPacket(i.startPage,i.startSegmentIndex);return this.createEncodedPacketFromOggPacket(o,{timestampInSamples:s,vorbisLastBlocksize:r.vorbisBlockSize},n)}async getPacket(e,n){if(this.demuxer.reader.fileSize===null)return this.getPacketSequential(e,n);const r=tm(e*this.internalSampleRate);if(r===0)return this.getFirstPacket(n);if(r<0)return null;W(this.bitstream.lastMetadataPacket);const i=await this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket);if(!i)return null;let s=i.startPage,o=this.demuxer.reader.fileSize;const a=[s];e:for(;s.headerStartPos+s.totalSize<o;){const b=s.headerStartPos,S=Math.floor((b+o)/2);let C=S;for(;;){const _=Math.min(C+cne,o-Au);let x=this.demuxer.reader.requestSlice(C,_-C);if(x instanceof Promise&&(x=await x),W(x),!une(x,_)){o=S+Au;continue e}let k=this.demuxer.reader.requestSliceRange(x.filePos,Au,xf);k instanceof Promise&&(k=await k),W(k);const T=Cp(k);W(T);let P=!1;if(T.serialNumber===this.bitstream.serialNumber)P=!0;else{let D=this.demuxer.reader.requestSlice(T.headerStartPos,T.totalSize);D instanceof Promise&&(D=await D),W(D);const F=Ct(D,T.totalSize);P=one(F)===T.checksum}if(!P){C=T.headerStartPos+4;continue}if(P&&T.serialNumber!==this.bitstream.serialNumber){C=T.headerStartPos+T.totalSize;continue}if(T.granulePosition===-1){C=T.headerStartPos+T.totalSize;continue}this.granulePositionToTimestampInSamples(T.granulePosition)>r?o=T.headerStartPos:(s=T,a.push(T));continue e}}let l=i.startPage;for(const b of a){if(b.granulePosition===s.granulePosition)break;(!l||b.headerStartPos>l.headerStartPos)&&(l=b)}let c=l;const u=[c];for(;!(c.serialNumber===this.bitstream.serialNumber&&c.granulePosition===s.granulePosition);){const b=c.headerStartPos+c.totalSize;let S=this.demuxer.reader.requestSliceRange(b,Au,xf);S instanceof Promise&&(S=await S),W(S);const C=Cp(S);W(C),c=C,c.serialNumber===this.bitstream.serialNumber&&u.push(c)}W(c.granulePosition!==-1);let d=null,f,h,p=c,m=0;if(c.headerStartPos===i.startPage.headerStartPos)f=this.granulePositionToTimestampInSamples(0),h=!0,d=0;else{f=0,h=!1;for(let C=c.lacingValues.length-1;C>=0;C--)if(c.lacingValues[C]<255){d=C+1;break}if(d===null)throw new Error("Invalid page with granule position: no packets end on this page.");m=d-1;const b={data:ys,endPage:p,endSegmentIndex:m};if(await this.demuxer.findNextPacketStart(b)){const C=QP(u,c,d);W(C);const _=XP(u,C.page,C.segmentIndex);_&&(c=_.page,d=_.segmentIndex)}else for(;;){const C=QP(u,c,d);if(!C)break;const _=XP(u,C.page,C.segmentIndex);if(!_)break;if(c=_.page,d=_.segmentIndex,C.page.headerStartPos!==p.headerStartPos){p=C.page,m=C.segmentIndex;break}}}let g=null,y=null;for(;c!==null;){W(d!==null);const b=await this.demuxer.readPacket(c,d);if(!b)break;if(!(c.headerStartPos===i.startPage.headerStartPos&&d<i.startSegmentIndex)){let _=this.createEncodedPacketFromOggPacket(b,{timestampInSamples:f,vorbisLastBlocksize:y?.vorbisBlockSize??null},n);W(_);let x=this.encodedPacketToMetadata.get(_);if(W(x),!h&&b.endPage.headerStartPos===p.headerStartPos&&b.endSegmentIndex===m?(f=this.granulePositionToTimestampInSamples(c.granulePosition),h=!0,_=this.createEncodedPacketFromOggPacket(b,{timestampInSamples:f-x.durationInSamples,vorbisLastBlocksize:y?.vorbisBlockSize??null},n),W(_),x=this.encodedPacketToMetadata.get(_),W(x)):f+=x.durationInSamples,g=_,y=x,h&&(Math.max(f,0)>r||Math.max(x.timestampInSamples,0)===r))break}const C=await this.demuxer.findNextPacketStart(b);if(!C)break;c=C.startPage,d=C.startSegmentIndex}return g}async getPacketSequential(e,n){const r=await this.sequentialScanMutex.acquire();try{const i=tm(e*this.internalSampleRate);e=i/this.internalSampleRate;const s=fn(this.sequentialScanCache,i,l=>l.timestampInSamples);let o;if(s!==-1){const l=this.sequentialScanCache[s];o=this.createEncodedPacketFromOggPacket(l.packet,{timestampInSamples:l.timestampInSamples,vorbisLastBlocksize:l.vorbisLastBlockSize},n)}else o=await this.getFirstPacket(n);let a=0;for(;o&&o.timestamp<e;){const l=await this.getNextPacket(o,n);if(!l||l.timestamp>e)break;if(o=l,a++,a===100){a=0;const c=this.encodedPacketToMetadata.get(o);W(c),this.sequentialScanCache.length>0&&W(Wn(this.sequentialScanCache).timestampInSamples<=c.timestampInSamples),this.sequentialScanCache.push(c)}}return o}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const XP=(t,e,n)=>{let r=e,i=n;e:for(;;){for(i--,i;i>=0;i--)if(r.lacingValues[i]<255){i++;break e}if(W(i===-1),!(r.headerType&1)){i=0;break}const o=nD(t,a=>a.headerStartPos<r.headerStartPos);if(!o)return null;r=o,i=r.lacingValues.length}if(W(i!==-1),i===r.lacingValues.length){const s=t[t.indexOf(r)+1];W(s),r=s,i=0}return{page:r,segmentIndex:i}},QP=(t,e,n)=>{if(n>0)return{page:e,segmentIndex:n-1};const r=nD(t,i=>i.headerStartPos<e.headerStartPos);return r?{page:r,segmentIndex:r.lacingValues.length-1}:null};var Ia;(function(t){t[t.PCM=1]="PCM",t[t.IEEE_FLOAT=3]="IEEE_FLOAT",t[t.ALAW=6]="ALAW",t[t.MULAW=7]="MULAW",t[t.EXTENSIBLE=65534]="EXTENSIBLE"})(Ia||(Ia={}));class hne extends tu{constructor(e){super(e),this.metadataPromise=null,this.dataStart=-1,this.dataSize=-1,this.audioInfo=null,this.tracks=[],this.lastKnownPacketIndex=0,this.metadataTags={},this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{let e=this.reader.requestSlice(0,12);e instanceof Promise&&(e=await e),W(e);const n=Gr(e,4),r=n!=="RIFX",i=n==="RF64",s=gc(e,r);let o=i?this.reader.fileSize:Math.min(s+8,this.reader.fileSize??1/0);if(Gr(e,4)!=="WAVE")throw new Error("Invalid WAVE file - wrong format");let l=0,c=null,u=e.filePos;for(;o===null||u<o;){let f=this.reader.requestSlice(u,8);if(f instanceof Promise&&(f=await f),!f)break;const h=Gr(f,4),p=gc(f,r),m=f.filePos;if(i&&l===0&&h!=="ds64")throw new Error('Invalid RF64 file: First chunk must be "ds64".');if(h==="fmt ")await this.parseFmtChunk(m,p,r);else if(h==="data"){if(c??=p,this.dataStart=f.filePos,this.dataSize=Math.min(c,(o??1/0)-this.dataStart),this.reader.fileSize===null)break}else if(h==="ds64"){let g=this.reader.requestSlice(m,p);if(g instanceof Promise&&(g=await g),!g)break;const y=eI(g,r);c=eI(g,r),o=Math.min(y+8,this.reader.fileSize??1/0)}else h==="LIST"?await this.parseListChunk(m,p,r):(h==="ID3 "||h==="id3 ")&&await this.parseId3Chunk(m,p);u=m+p+(p&1),l++}if(!this.audioInfo)throw new Error('Invalid WAVE file - missing "fmt " chunk');if(this.dataStart===-1)throw new Error('Invalid WAVE file - missing "data" chunk');const d=this.audioInfo.blockSizeInBytes;this.dataSize=Math.floor(this.dataSize/d)*d,this.tracks.push(new ca(this.input,new pne(this)))})()}async parseFmtChunk(e,n,r){let i=this.reader.requestSlice(e,n);if(i instanceof Promise&&(i=await i),!i)return;let s=Vh(i,r);const o=Vh(i,r),a=gc(i,r);i.skip(4);const l=Vh(i,r);let c;if(n===14?c=8:c=Vh(i,r),n>=18&&s!==357){const u=Vh(i,r),d=n-18;if(Math.min(d,u)>=22&&s===Ia.EXTENSIBLE){i.skip(6);const h=Ct(i,16);s=h[0]|h[1]<<8}}(s===Ia.MULAW||s===Ia.ALAW)&&(c=8),this.audioInfo={format:s,numberOfChannels:o,sampleRate:a,sampleSizeInBytes:Math.ceil(c/8),blockSizeInBytes:l}}async parseListChunk(e,n,r){let i=this.reader.requestSlice(e,n);if(i instanceof Promise&&(i=await i),!i)return;const s=Gr(i,4);if(s!=="INFO"&&s!=="INF0")return;let o=i.filePos;for(;o<=e+n-8;){i.filePos=o;const a=Gr(i,4),l=gc(i,r),c=Ct(i,l);let u=0;for(let f=0;f<c.length&&c[f]!==0;f++)u++;const d=String.fromCharCode(...c.subarray(0,u));switch(this.metadataTags.raw??={},this.metadataTags.raw[a]=d,a){case"INAM":case"TITL":this.metadataTags.title??=d;break;case"TIT3":this.metadataTags.description??=d;break;case"IART":this.metadataTags.artist??=d;break;case"IPRD":this.metadataTags.album??=d;break;case"IPRT":case"ITRK":case"TRCK":{const f=d.split("/"),h=Number.parseInt(f[0],10),p=f[1]&&Number.parseInt(f[1],10);Number.isInteger(h)&&h>0&&(this.metadataTags.trackNumber??=h),p&&Number.isInteger(p)&&p>0&&(this.metadataTags.tracksTotal??=p)}break;case"ICRD":case"IDIT":{const f=new Date(d);Number.isNaN(f.getTime())||(this.metadataTags.date??=f)}break;case"YEAR":{const f=Number.parseInt(d,10);Number.isInteger(f)&&f>0&&(this.metadataTags.date??=new Date(f,0,1))}break;case"IGNR":case"GENR":this.metadataTags.genre??=d;break;case"ICMT":case"CMNT":case"COMM":this.metadataTags.comment??=d;break}o+=8+l+(l&1)}}async parseId3Chunk(e,n){let r=this.reader.requestSlice(e,n);if(r instanceof Promise&&(r=await r),!r)return;const i=wy(r);if(i){const s=r.slice(e+10,i.size);ND(s,i,this.metadataTags)}}getCodec(){if(W(this.audioInfo),this.audioInfo.format===Ia.MULAW)return"ulaw";if(this.audioInfo.format===Ia.ALAW)return"alaw";if(this.audioInfo.format===Ia.PCM){if(this.audioInfo.sampleSizeInBytes===1)return"pcm-u8";if(this.audioInfo.sampleSizeInBytes===2)return"pcm-s16";if(this.audioInfo.sampleSizeInBytes===3)return"pcm-s24";if(this.audioInfo.sampleSizeInBytes===4)return"pcm-s32"}return this.audioInfo.format===Ia.IEEE_FLOAT&&this.audioInfo.sampleSizeInBytes===4?"pcm-f32":null}async getMimeType(){return"audio/wav"}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return W(e),e.computeDuration()}async getTracks(){return await this.readMetadata(),this.tracks}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}}const Rd=2048;class pne{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return this.demuxer.getCodec()}getInternalCodecId(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.format}async getDecoderConfig(){const e=this.demuxer.getCodec();return e?(W(this.demuxer.audioInfo),{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}):null}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getNumberOfChannels(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}getSampleRate(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getTimeResolution(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return cs}getDisposition(){return{...Jc}}async getFirstTimestamp(){return 0}async getPacketAtIndex(e,n){W(this.demuxer.audioInfo);const r=e*Rd*this.demuxer.audioInfo.blockSizeInBytes;if(r>=this.demuxer.dataSize)return null;const i=Math.min(Rd*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-r);if(this.demuxer.reader.fileSize===null){let l=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,i);if(l instanceof Promise&&(l=await l),!l)return null}let s;if(n.metadataOnly)s=ys;else{let l=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,i);l instanceof Promise&&(l=await l),W(l),s=Ct(l,i)}const o=e*Rd/this.demuxer.audioInfo.sampleRate,a=i/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate;return this.demuxer.lastKnownPacketIndex=Math.max(e,o),new Mn(s,"key",o,a,e,i)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getPacket(e,n){W(this.demuxer.audioInfo);const r=Math.floor(Math.min(e*this.demuxer.audioInfo.sampleRate/Rd,(this.demuxer.dataSize-1)/(Rd*this.demuxer.audioInfo.blockSizeInBytes))),i=await this.getPacketAtIndex(r,n);if(i)return i;if(r===0)return null;W(this.demuxer.reader.fileSize===null);let s=await this.getPacketAtIndex(this.demuxer.lastKnownPacketIndex,n);for(;s;){const o=await this.getNextPacket(s,n);if(!o)break;s=o}return s}getNextPacket(e,n){W(this.demuxer.audioInfo);const r=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/Rd);return this.getPacketAtIndex(r+1,n)}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const vy=7,$u=9,sd=t=>{const e=t.filePos,n=Ct(t,9),r=new Ln(n);if(r.readBits(12)!==4095||(r.skipBits(1),r.readBits(2)!==0))return null;const o=r.readBits(1),a=r.readBits(2)+1,l=r.readBits(4);if(l===15)return null;r.skipBits(1);const c=r.readBits(3);if(c===0)throw new Error("ADTS frames with channel configuration 0 are not supported.");r.skipBits(1),r.skipBits(1),r.skipBits(1),r.skipBits(1);const u=r.readBits(13);r.skipBits(11);const d=r.readBits(2)+1;if(d!==1)throw new Error("ADTS frames with more than one AAC frame are not supported.");let f=null;return o===1?t.filePos-=2:f=r.readBits(16),{objectType:a,samplingFrequencyIndex:l,channelConfiguration:c,frameLength:u,numberOfAacFrames:d,crcCheck:f,startPos:e}};const xy=1024;class mne extends tu{constructor(e){super(e),this.metadataPromise=null,this.firstFrameHeader=null,this.loadedSamples=[],this.tracks=[],this.readingMutex=new yd,this.lastSampleLoaded=!1,this.lastLoadedPos=0,this.nextTimestampInSamples=0,this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{for(;!this.firstFrameHeader&&!this.lastSampleLoaded;)await this.advanceReader();W(this.firstFrameHeader),this.tracks=[new ca(this.input,new gne(this))]})()}async advanceReader(){let e=this.reader.requestSliceRange(this.lastLoadedPos,vy,$u);if(e instanceof Promise&&(e=await e),!e){this.lastSampleLoaded=!0;return}const n=sd(e);if(!n){this.lastSampleLoaded=!0;return}if(this.reader.fileSize!==null&&n.startPos+n.frameLength>this.reader.fileSize){this.lastSampleLoaded=!0;return}this.firstFrameHeader||(this.firstFrameHeader=n);const r=id[n.samplingFrequencyIndex];W(r!==void 0);const i=xy/r,s={timestamp:this.nextTimestampInSamples/r,duration:i,dataStart:n.startPos,dataSize:n.frameLength};this.loadedSamples.push(s),this.nextTimestampInSamples+=xy,this.lastLoadedPos=n.startPos+n.frameLength}async getMimeType(){return"audio/aac"}async getTracks(){return await this.readMetadata(),this.tracks}async computeDuration(){await this.readMetadata();const e=this.tracks[0];return W(e),e.computeDuration()}async getMetadataTags(){return{}}}class gne{constructor(e){this.demuxer=e}getId(){return 1}async getFirstTimestamp(){return 0}getTimeResolution(){return this.getSampleRate()/xy}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getName(){return null}getLanguageCode(){return cs}getCodec(){return"aac"}getInternalCodecId(){return W(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.objectType}getNumberOfChannels(){W(this.demuxer.firstFrameHeader);const e=Zm[this.demuxer.firstFrameHeader.channelConfiguration];return W(e!==void 0),e}getSampleRate(){W(this.demuxer.firstFrameHeader);const e=id[this.demuxer.firstFrameHeader.samplingFrequencyIndex];return W(e!==void 0),e}getDisposition(){return{...Jc}}async getDecoderConfig(){return W(this.demuxer.firstFrameHeader),{codec:`mp4a.40.${this.demuxer.firstFrameHeader.objectType}`,numberOfChannels:this.getNumberOfChannels(),sampleRate:this.getSampleRate()}}async getPacketAtIndex(e,n){if(e===-1)return null;const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=ys;else{let s=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize);if(s instanceof Promise&&(s=await s),!s)return null;i=Ct(s,r.dataSize)}return new Mn(i,"key",r.timestamp,r.duration,e,r.dataSize)}getFirstPacket(e){return this.getPacketAtIndex(0,e)}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=Gm(this.demuxer.loadedSamples,e.timestamp,o=>o.timestamp);if(i===-1)throw new Error("Packet was not created from this track.");const s=i+1;for(;s>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(s,n)}finally{r()}}async getPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=fn(this.demuxer.loadedSamples,e,s=>s.timestamp);if(i===-1&&this.demuxer.loadedSamples.length>0)return null;if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(i,n);if(i>=0&&i+1<this.demuxer.loadedSamples.length)return this.getPacketAtIndex(i,n);await this.demuxer.advanceReader()}}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}}const yne=t=>t===0?null:t===1?192:t>=2&&t<=5?144*2**t:t===6?"uncommon-u8":t===7?"uncommon-u16":t>=8&&t<=15?2**t:null,bne=(t,e)=>{switch(t){case 0:return e;case 1:return 88200;case 2:return 176400;case 3:return 192e3;case 4:return 8e3;case 5:return 16e3;case 6:return 22050;case 7:return 24e3;case 8:return 32e3;case 9:return 44100;case 10:return 48e3;case 11:return 96e3;case 12:return"uncommon-u8";case 13:return"uncommon-u16";case 14:return"uncommon-u16-10";default:return null}},wne=t=>{let e=0;const n=new Ln(Ct(t,1));for(;n.readBits(1)===1;)e++;if(e===0)return n.readBits(7);const r=[],i=e-1,s=new Ln(Ct(t,i)),o=8-e-1;for(let l=0;l<o;l++)r.unshift(n.readBits(1));for(let l=0;l<i;l++)for(let c=0;c<8;c++){const u=s.readBits(1);c<2||r.unshift(u)}return r.reduce((l,c,u)=>l|c<<u,0)},vne=(t,e)=>{if(e==="uncommon-u16")return Fr(t)+1;if(e==="uncommon-u8")return mt(t)+1;if(typeof e=="number")return e;Hc(e),W(!1)},xne=(t,e)=>e==="uncommon-u16"?Fr(t):e==="uncommon-u16-10"?Fr(t)*10:e==="uncommon-u8"?mt(t):typeof e=="number"?e:null,Sne=t=>{let n=0;for(const r of t){n^=r;for(let i=0;i<8;i++)(n&128)!==0?n=n<<1^7:n<<=1,n&=255}return n};class kne extends tu{constructor(e){super(e),this.loadedSamples=[],this.metadataPromise=null,this.track=null,this.metadataTags={},this.audioInfo=null,this.lastLoadedPos=null,this.blockingBit=null,this.readingMutex=new yd,this.lastSampleLoaded=!1,this.reader=e._reader}async computeDuration(){return await this.readMetadata(),W(this.track),this.track.computeDuration()}async getMetadataTags(){return await this.readMetadata(),this.metadataTags}async getTracks(){return await this.readMetadata(),W(this.track),[this.track]}async getMimeType(){return"audio/flac"}async readMetadata(){let e=4;return this.metadataPromise??=(async()=>{for(;this.reader.fileSize===null||e<this.reader.fileSize;){let n=this.reader.requestSlice(e,4);if(n instanceof Promise&&(n=await n),e+=4,n===null)throw new Error(`Metadata block at position ${e} is too small! Corrupted file.`);W(n);const r=mt(n),i=Wd(n),s=(r&128)!==0;switch(r&127){case vf.STREAMINFO:{let a=this.reader.requestSlice(e,i);if(a instanceof Promise&&(a=await a),W(a),a===null)throw new Error(`StreamInfo block at position ${e} is too small! Corrupted file.`);const l=Ct(a,34),c=new Ln(l),u=c.readBits(16),d=c.readBits(16),f=c.readBits(24),h=c.readBits(24),p=c.readBits(20),m=c.readBits(3)+1;c.readBits(5);const g=c.readBits(36);c.skipBits(128);const y=new Uint8Array(42);y.set(new Uint8Array([102,76,97,67]),0),y.set(new Uint8Array([128,0,0,34]),4),y.set(l,8),this.audioInfo={numberOfChannels:m,sampleRate:p,totalSamples:g,minimumBlockSize:u,maximumBlockSize:d,minimumFrameSize:f,maximumFrameSize:h,description:y},this.track=new ca(this.input,new Ene(this));break}case vf.VORBIS_COMMENT:{let a=this.reader.requestSlice(e,i);a instanceof Promise&&(a=await a),W(a),Ux(Ct(a,i),this.metadataTags);break}case vf.PICTURE:{let a=this.reader.requestSlice(e,i);a instanceof Promise&&(a=await a),W(a);const l=nt(a),c=nt(a),u=zs.decode(Ct(a,c)),d=nt(a),f=zs.decode(Ct(a,d));a.skip(16);const h=nt(a),p=Ct(a,h);this.metadataTags.images??=[],this.metadataTags.images.push({data:p,mimeType:u,kind:l===3?"coverFront":l===4?"coverBack":"unknown",description:f});break}}if(e+=i,s){this.lastLoadedPos=e;break}}})()}async readNextFlacFrame({startPos:e,isFirstPacket:n}){W(this.audioInfo);const r=6,s=this.audioInfo.maximumFrameSize+16,o=await this.reader.requestSliceRange(e,this.audioInfo.minimumFrameSize,s);if(!o)return null;const a=this.readFlacFrameHeader({slice:o,isFirstPacket:n});if(!a)return null;for(o.filePos=e+this.audioInfo.minimumFrameSize;;){if(o.filePos>o.end-r)return{num:a.num,blockSize:a.blockSize,sampleRate:a.sampleRate,size:o.end-e,isLastFrame:!0};if(mt(o)===255){const c=o.filePos,u=mt(o),d=this.blockingBit===1?249:248;if(u!==d){o.filePos=c;continue}o.skip(-2);const f=o.filePos-e,h=this.readFlacFrameHeader({slice:o,isFirstPacket:!1});if(!h){o.filePos=c;continue}if(this.blockingBit===0){if(h.num-a.num!==1){o.filePos=c;continue}}else if(h.num-a.num!==a.blockSize){o.filePos=c;continue}return{num:a.num,blockSize:a.blockSize,sampleRate:a.sampleRate,size:f,isLastFrame:!1}}}}readFlacFrameHeader({slice:e,isFirstPacket:n}){const r=e.filePos,i=Ct(e,4),s=new Ln(i);if(s.readBits(15)!==32764)return null;if(this.blockingBit===null){W(n);const g=s.readBits(1);this.blockingBit=g}else if(this.blockingBit===1){if(W(!n),s.readBits(1)!==1)return null}else if(this.blockingBit===0){if(W(!n),s.readBits(1)!==0)return null}else throw new Error("Invalid blocking bit");const a=yne(s.readBits(4));if(!a)return null;W(this.audioInfo);const l=bne(s.readBits(4),this.audioInfo.sampleRate);if(!l||(s.readBits(4),s.readBits(3),s.readBits(1)!==0))return null;const u=wne(e),d=vne(e,a),f=xne(e,l);if(f===null||f!==this.audioInfo.sampleRate)return null;const h=e.filePos-r,p=mt(e);e.skip(-h),e.skip(-1);const m=Sne(Ct(e,h));return p!==m?null:{num:u,blockSize:d,sampleRate:f}}async advanceReader(){await this.readMetadata(),W(this.lastLoadedPos!==null),W(this.audioInfo);const e=this.lastLoadedPos,n=await this.readNextFlacFrame({startPos:e,isFirstPacket:this.loadedSamples.length===0});if(!n){this.lastSampleLoaded=!0;return}const r=this.loadedSamples[this.loadedSamples.length-1],s={blockOffset:r?r.blockOffset+r.blockSize:0,blockSize:n.blockSize,byteOffset:e,byteSize:n.size};if(this.lastLoadedPos=this.lastLoadedPos+n.size,this.loadedSamples.push(s),n.isLastFrame){this.lastSampleLoaded=!0;return}}}class Ene{constructor(e){this.demuxer=e}getId(){return 1}getCodec(){return"flac"}getInternalCodecId(){return null}getNumberOfChannels(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}getSampleRate(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getName(){return null}getLanguageCode(){return cs}getTimeResolution(){return W(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}getDisposition(){return{...Jc}}async getFirstTimestamp(){return 0}async getDecoderConfig(){return W(this.demuxer.audioInfo),{codec:"flac",numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate,description:this.demuxer.audioInfo.description}}async getPacket(e,n){if(W(this.demuxer.audioInfo),e<0)throw new Error("Timestamp cannot be negative");const r=await this.demuxer.readingMutex.acquire();try{for(;;){const i=fn(this.demuxer.loadedSamples,e,l=>l.blockOffset/this.demuxer.audioInfo.sampleRate);if(i===-1){await this.demuxer.advanceReader();continue}const s=this.demuxer.loadedSamples[i],o=s.blockOffset/this.demuxer.audioInfo.sampleRate,a=s.blockSize/this.demuxer.audioInfo.sampleRate;if(o+a<=e){if(this.demuxer.lastSampleLoaded)return this.getPacketAtIndex(this.demuxer.loadedSamples.length-1,n);await this.demuxer.advanceReader();continue}return this.getPacketAtIndex(i,n)}}finally{r()}}async getNextPacket(e,n){const r=await this.demuxer.readingMutex.acquire();try{const i=e.sequenceNumber+1;if(this.demuxer.lastSampleLoaded&&i>=this.demuxer.loadedSamples.length)return null;for(;i>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(i,n)}finally{r()}}getKeyPacket(e,n){return this.getPacket(e,n)}getNextKeyPacket(e,n){return this.getNextPacket(e,n)}async getPacketAtIndex(e,n){const r=this.demuxer.loadedSamples[e];if(!r)return null;let i;if(n.metadataOnly)i=ys;else{let a=this.demuxer.reader.requestSlice(r.byteOffset,r.byteSize);if(a instanceof Promise&&(a=await a),!a)return null;i=Ct(a,r.byteSize)}W(this.demuxer.audioInfo);const s=r.blockOffset/this.demuxer.audioInfo.sampleRate,o=r.blockSize/this.demuxer.audioInfo.sampleRate;return new Mn(i,"key",s,o,e,r.byteSize)}async getFirstPacket(e){for(;this.demuxer.loadedSamples.length===0&&!this.demuxer.lastSampleLoaded;)await this.demuxer.advanceReader();return this.getPacketAtIndex(0,e)}}const Oa=9e4,rs=188,Tne=t=>{let e="video/MP2T";const n=[...new Set(t.filter(Boolean))];return n.length>0&&(e+=`; codecs="${n.join(", ")}"`),e};const Hd="No PES packet found where one was expected.";class Cne extends tu{constructor(e){super(e),this.metadataPromise=null,this.elementaryStreams=[],this.tracks=[],this.packetOffset=0,this.packetStride=-1,this.sectionEndPositions=[],this.reader=e._reader}async readMetadata(){return this.metadataPromise??=(async()=>{const e=rs+16+1;let n=this.reader.requestSlice(0,e);n instanceof Promise&&(n=await n),W(n);const r=Ct(n,e);if(r[0]===71&&r[rs]===71)this.packetOffset=0,this.packetStride=rs;else if(r[0]===71&&r[rs+16]===71)this.packetOffset=0,this.packetStride=rs+16;else if(r[4]===71&&r[4+rs]===71)this.packetOffset=4,this.packetStride=rs;else throw new Error("Unreachable.");let i=this.packetOffset,s=null,o=!1,a=!1;for(;;){const l=await this.readSection(i,!0,!a);if(!l)break;const c=3,u=32;if(l.pid===0&&!o){const f=new Ln(l.payload),h=f.readAlignedByte();f.skipBits(8*h),f.skipBits(14);const p=f.readBits(10);for(f.skipBits(40);8*(p+c)-f.pos>u;){const m=f.readBits(16);if(f.skipBits(3),m!==0){if(s!==null)throw new Error("Only files with a single program are supported.");s=f.readBits(13)}}if(s===null)throw new Error("Program Association Table must link to a Program Map Table.");o=!0}else if(l.pid===s&&!a){const f=new Ln(l.payload),h=f.readAlignedByte();f.skipBits(8*h),f.skipBits(12);const p=f.readBits(12);f.skipBits(43),f.readBits(13),f.skipBits(6);const m=f.readBits(10);for(f.skipBits(8*m);8*(p+c)-f.pos>u;){const g=f.readBits(8);f.skipBits(3);const y=f.readBits(13);f.skipBits(6);const b=f.readBits(10);f.skipBits(8*b);let S=null;switch(g){case 3:case 4:case 15:S={type:"audio",codec:g===15?"aac":"mp3",aacCodecInfo:null,numberOfChannels:-1,sampleRate:-1};break;case 27:case 36:S={type:"video",codec:g===27?"avc":"hevc",avcCodecInfo:null,hevcCodecInfo:null,colorSpace:{primaries:null,transfer:null,matrix:null,fullRange:null},width:-1,height:-1,reorderSize:-1};break}S&&this.elementaryStreams.push({demuxer:this,pid:y,streamType:g,initialized:!1,firstSection:null,info:S})}a=!0}else{const f=this.elementaryStreams.find(h=>h.pid===l.pid);if(f&&!f.initialized){const h=nf(l);if(!h)throw new Error(`Couldn't read first PES packet for Elementary Stream with PID ${f.pid}`);if(f.firstSection=l,f.info.type==="video")if(f.info.codec==="avc"){if(f.info.avcCodecInfo=tT(h.data),!f.info.avcCodecInfo)throw new Error("Invalid AVC video stream; could not extract AVCDecoderConfigurationRecord from first packet.");const p=f.info.avcCodecInfo.sequenceParameterSets[0];W(p);const m=nT(p);f.info.width=m.displayWidth,f.info.height=m.displayHeight,f.info.colorSpace={primaries:fy[m.colourPrimaries],transfer:hy[m.transferCharacteristics],matrix:py[m.matrixCoefficients],fullRange:!!m.fullRangeFlag},f.info.reorderSize=m.maxDecFrameBuffering,f.initialized=!0}else if(f.info.codec==="hevc"){if(f.info.hevcCodecInfo=rT(h.data),!f.info.hevcCodecInfo)throw new Error("Invalid HEVC video stream; could not extract HVCDecoderConfigurationRecord from first packet.");const m=f.info.hevcCodecInfo.arrays.find(y=>y.nalUnitType===li.SPS_NUT).nalUnits[0];W(m);const g=mD(m);f.info.width=g.displayWidth,f.info.height=g.displayHeight,f.info.colorSpace={primaries:fy[g.colourPrimaries],transfer:hy[g.transferCharacteristics],matrix:py[g.matrixCoefficients],fullRange:!!g.fullRangeFlag},f.info.reorderSize=g.maxDecFrameBuffering,f.initialized=!0}else throw new Error("Unhandled.");else if(f.info.codec==="aac"){const p=fo.tempFromBytes(h.data),m=sd(p);if(!m)throw new Error("Invalid AAC audio stream; could not read ADTS frame header from first packet.");f.info.aacCodecInfo={isMpeg2:!1,objectType:m.objectType},f.info.numberOfChannels=Zm[m.channelConfiguration],f.info.sampleRate=id[m.samplingFrequencyIndex],f.initialized=!0}else if(f.info.codec==="mp3"){const p=nt(fo.tempFromBytes(h.data)),m=uT(p,h.data.byteLength);if(!m.header)throw new Error("Invalid MP3 audio stream; could not read frame header from first packet.");f.info.numberOfChannels=m.header.channel===3?1:2,f.info.sampleRate=m.header.sampleRate,f.initialized=!0}else throw new Error("Unhandled.")}}if(a&&this.elementaryStreams.every(f=>f.initialized))break;W(l.endPos!==null),i=l.endPos}for(const l of this.elementaryStreams)l.info.type==="video"?this.tracks.push(new ph(this.input,new _ne(l))):this.tracks.push(new ca(this.input,new Ane(l)))})()}async getTracks(){return await this.readMetadata(),this.tracks}async getMetadataTags(){return{}}async computeDuration(){const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.computeDuration()));return Math.max(0,...n)}async getMimeType(){await this.readMetadata();const e=await this.getTracks(),n=await Promise.all(e.map(r=>r.getCodecParameterString()));return Tne(n)}async readSection(e,n,r=!1){let i=e,s=e;const o=[];let a=0,l=null,c=!0;for(;;){const d=await this.readPacket(s);if(s+=this.packetStride,!d)break;if(l){if(d.pid!==l.pid){if(r)break;continue}if(d.payloadUnitStartIndicator===1)break}else{if(d.payloadUnitStartIndicator===0)break;l=d}const f=!!(d.adaptationFieldControl&2),h=!!(d.adaptationFieldControl&1);let p=0;if(f&&(p=1+d.body[0]),h&&(p===0?(o.push(d.body),a+=d.body.byteLength):(o.push(d.body.subarray(p)),a+=d.body.byteLength-p)),i=s,!n&&a>=64){c=!1;break}if(Gm(this.sectionEndPositions,i,g=>g)!==-1){c=!1;break}}if(c){const d=fn(this.sectionEndPositions,i,f=>f);this.sectionEndPositions.splice(d+1,0,i)}if(!l)return null;let u;if(o.length===1)u=o[0];else{const d=o.reduce((h,p)=>h+p.length,0);u=new Uint8Array(d);let f=0;for(const h of o)u.set(h,f),f+=h.length}return{startPos:e,endPos:n?i:null,pid:l.pid,payload:u}}async readPacketHeader(e){let n=this.reader.requestSlice(e,4);if(n instanceof Promise&&(n=await n),!n)return null;if(mt(n)!==71)throw new Error("Invalid TS packet sync byte. Likely an internal bug, please report this file.");const i=Fr(n),s=i>>14&1,o=i&8191,l=mt(n)>>4&3;return{payloadUnitStartIndicator:s,pid:o,adaptationFieldControl:l}}async readPacket(e){let n=this.reader.requestSlice(e,rs);if(n instanceof Promise&&(n=await n),!n)return null;const r=Ct(n,rs);if(r[0]!==71)throw new Error("Invalid TS packet sync byte. Likely an internal bug, please report this file.");const s=(r[1]<<8)+r[2],o=s>>14&1,a=s&8191,c=r[3]>>4&3;return{payloadUnitStartIndicator:o,pid:a,adaptationFieldControl:c,body:r.subarray(4)}}}const Vd=t=>{const e=new Ln(t.payload);if(e.readBits(24)!==1)return null;const r=e.readBits(8);if(e.skipBits(16),r===188||r===190||r===191||r===240||r===241||r===255||r===242||r===248)return null;e.skipBits(8);const i=e.readBits(2);e.skipBits(14);let s=0;if(i===2||i===3)e.skipBits(4),s+=e.readBits(3)*(1<<30),e.skipBits(1),s+=e.readBits(15)*32768,e.skipBits(1),s+=e.readBits(15);else throw new Error("PES packets without PTS are not currently supported. If you think this file should be supported, please report it.");return{sectionStartPos:t.startPos,sectionEndPos:t.endPos,pts:s}},nf=t=>{W(t.endPos!==null);const e=Vd(t);if(!e)return null;const n=new Ln(t.payload);n.skipBits(32);const r=n.readBits(16),i=6;n.skipBits(16);const s=n.readBits(8),o=n.pos+8*s;n.pos=o;const a=o/8;W(Number.isInteger(a));const l=t.payload.subarray(a,r>0?i+r:t.payload.byteLength);return{...e,data:l}};class LD{constructor(e){this.elementaryStream=e,this.referencePesPackets=[],this.endReferencePesPacketAdded=!1,this.packetBuffers=new WeakMap,this.packetSectionStarts=new WeakMap,this.mutex=new yd}getId(){return this.elementaryStream.pid}getCodec(){throw new Error("Not implemented on base class.")}getInternalCodecId(){return this.elementaryStream.streamType}getName(){return null}getLanguageCode(){return cs}getDisposition(){return Jc}getTimeResolution(){return Oa}async computeDuration(){const e=await this.getPacket(1/0,{metadataOnly:!0});return(e?.timestamp??0)+(e?.duration??0)}async getFirstTimestamp(){return(await this.getFirstPacket({metadataOnly:!0}))?.timestamp??0}createEncodedPacket(e,n,r){return new Mn(r.metadataOnly?ys:e.data,this.getPacketType(e.data),e.pts/Oa,Math.max(n/Oa,0),e.sequenceNumber,e.data.byteLength)}maybeInsertReferencePacket(e,n,r){if(r&&this.mutex.pending>0)return;const i=fn(this.referencePesPackets,e.pts,s=>s.pts);if(i>=0){const s=this.referencePesPackets[i];if(e.sectionStartPos<=s.sectionStartPos||!n&&e.pts-s.pts<Oa/2)return!1;if(i<this.referencePesPackets.length-1){const o=this.referencePesPackets[i+1];if(o.sectionStartPos<e.sectionStartPos||!n&&o.pts-e.pts<Oa/2)return!1}}return this.referencePesPackets.splice(i+1,0,e),!0}async getFirstPacket(e){const n=this.elementaryStream.firstSection;W(n);const r=nf(n);W(r);const i=new rf(this,r,!0),s=new Mg(this,i),o=await s.readNext();if(!o)return null;const a=this.createEncodedPacket(o.packet,o.duration,e);return this.packetBuffers.set(a,s),this.packetSectionStarts.set(a,o.packet.sectionStartPos),a}async getNextPacket(e,n){let r=this.packetBuffers.get(e);if(r){const u=await r.readNext();if(!u)return null;this.packetBuffers.delete(e);const d=this.createEncodedPacket(u.packet,u.duration,n);return this.packetBuffers.set(d,r),this.packetSectionStarts.set(d,u.packet.sectionStartPos),d}const i=this.packetSectionStarts.get(e);if(i===void 0)throw new Error("Packet was not created from this track.");const o=await this.elementaryStream.demuxer.readSection(i,!0);W(o);const a=nf(o);W(a);const l=new rf(this,a,!0);r=new Mg(this,l);const c=e.sequenceNumber;for(;;){const u=await r.readNext();if(!u)return null;if(u.packet.sequenceNumber>c){const d=this.createEncodedPacket(u.packet,u.duration,n);return this.packetBuffers.set(d,r),this.packetSectionStarts.set(d,u.packet.sectionStartPos),d}}}async getNextKeyPacket(e,n){let r=e;for(;;){if(r=await this.getNextPacket(r,n),!r)return null;if(r.type==="key")return r}}getPacket(e,n){return this.doPacketLookup(e,!1,n)}getKeyPacket(e,n){return this.doPacketLookup(e,!0,n)}async doPacketLookup(e,n,r){const i=tm(e*Oa),s=this.elementaryStream.demuxer,o=s.reader,a=await this.mutex.acquire();let l;try{if(this.referencePesPackets.length===0){const b=this.elementaryStream.firstSection;W(b);const S=Vd(b);W(S),this.maybeInsertReferencePacket(S,!1,!1),W(this.referencePesPackets.length===1)}let g=fn(this.referencePesPackets,i,b=>b.pts);if(g===-1)return null;if(o.fileSize!==null&&g===this.referencePesPackets.length-1&&!this.endReferencePesPacketAdded){let b=o.fileSize-s.packetStride+s.packetOffset,S=await s.readPacketHeader(b);if(!S)return null;for(;S.pid!==this.elementaryStream.pid||S.payloadUnitStartIndicator===0;){b-=s.packetStride;const x=await s.readPacketHeader(b);if(!x)return null;S=x}const C=await s.readSection(b,!1);W(C);const _=Vd(C);if(!_)throw new Error(Hd);this.maybeInsertReferencePacket(_,!0,!1),this.endReferencePesPacketAdded=!0}for(g=fn(this.referencePesPackets,i,b=>b.pts),W(g!==-1);o.fileSize!==null;){const b=this.referencePesPackets[g],S=this.referencePesPackets[g+1];if(i-b.pts<Oa||!S)break;let _=rD((b.sectionStartPos+S.sectionStartPos)/2,s.packetStride)+s.packetOffset,x=await s.readPacketHeader(_);for(W(x);_<S.sectionStartPos&&(x.pid!==this.elementaryStream.pid||x.payloadUnitStartIndicator===0);){_+=s.packetStride;const P=await s.readPacketHeader(_);if(!P)return null;x=P}if(_>=S.sectionStartPos)break;const I=await s.readSection(_,!1);W(I);const k=Vd(I);if(!k)throw new Error(Hd);if(!this.maybeInsertReferencePacket(k,!1,!1))break;k.pts<=i&&g++}l=this.referencePesPackets[g],W(l.pts<=i)}finally{a()}a();e:for(;;){let g=l.sectionStartPos+s.packetStride;for(;;){const S=await s.readPacketHeader(g);if(!S)break e;if(S.pid===this.elementaryStream.pid&&S.payloadUnitStartIndicator===1)break;g+=s.packetStride}const y=await s.readSection(g,!1);if(!y)break;const b=Vd(y);if(!b)throw new Error(Hd);if(b.pts>i)break;l=b,o.fileSize===null&&this.maybeInsertReferencePacket(b,!1,!0)}const c=this.getReorderSize();for(let g=0;g<c;g++){let y=l.sectionStartPos-s.packetStride;for(;;){const b=await s.readPacketHeader(y);if(!b)break;if(b.pid===this.elementaryStream.pid&&b.payloadUnitStartIndicator===1){const S=await s.readSection(y,!1);W(S);const C=Vd(S);if(!C)throw new Error(Hd);l=C;break}y-=s.packetStride}}const u=await s.readSection(l.sectionStartPos,!0);W(u);const d=nf(u);W(d);const f=new rf(this,d,!0),h=new Mg(this,f);for(;!((Wn(h.presentationOrderPackets)?.pts??-1/0)>=i||!await h.readNextDecodeOrderPacket()););const p=XE(h.presentationOrderPackets,g=>g.pts<=i&&(!n||this.getPacketType(g.data)==="key"));if(p!==-1){const g=h.presentationOrderPackets[p],y=p===0?0:g.pts-h.presentationOrderPackets[p-1].pts;for(;h.decodeOrderPackets[0]!==g;)h.decodeOrderPackets.shift();h.lastDuration=y;const b=await h.readNext();W(b);const S=this.createEncodedPacket(b.packet,b.duration,r);return this.packetBuffers.set(S,h),this.packetSectionStarts.set(S,b.packet.sectionStartPos),S}if(!n)return null;let m=l.sectionStartPos;for(;;){m-=s.packetStride;const g=await s.readPacketHeader(m);if(!g)return null;if(g.pid!==this.elementaryStream.pid||g.payloadUnitStartIndicator!==1)continue;const y=await s.readSection(m,!0);W(y);const b=nf(y);if(!b)throw new Error(Hd);const S=new rf(this,b,!1);if(await this.markNextPacket(S),!S.suppliedPacket||this.getPacketType(S.suppliedPacket.data)!=="key")continue;S.uncapped=!0;const C=new Mg(this,S),_=await C.readNext();W(_);const x=this.createEncodedPacket(_.packet,_.duration,r);return this.packetBuffers.set(x,C),this.packetSectionStarts.set(x,_.packet.sectionStartPos),x}}}class _ne extends LD{constructor(e){super(e),this.elementaryStream=e,this.decoderConfig={codec:YE({width:this.elementaryStream.info.width,height:this.elementaryStream.info.height,codec:this.elementaryStream.info.codec,codecDescription:null,colorSpace:this.elementaryStream.info.colorSpace,avcType:1,avcCodecInfo:this.elementaryStream.info.avcCodecInfo,hevcCodecInfo:this.elementaryStream.info.hevcCodecInfo,vp9CodecInfo:null,av1CodecInfo:null}),codedWidth:this.elementaryStream.info.width,codedHeight:this.elementaryStream.info.height,colorSpace:this.elementaryStream.info.colorSpace}}getCodec(){return this.elementaryStream.info.codec}getCodedWidth(){return this.elementaryStream.info.width}getCodedHeight(){return this.elementaryStream.info.height}getRotation(){return 0}async getColorSpace(){return this.elementaryStream.info.colorSpace}async canBeTransparent(){return!1}async getDecoderConfig(){return this.decoderConfig}getPacketType(e){return iT(this.elementaryStream.info.codec,this.decoderConfig,e)??"key"}getReorderSize(){return this.elementaryStream.info.reorderSize}async markNextPacket(e){W(!e.suppliedPacket);const n=this.elementaryStream.info.codec,r=1024;if(n!=="avc"&&n!=="hevc")throw new Error("Unhandled.");let i=null;for(;;){let s=e.ensureBuffered(r);if(s instanceof Promise&&(s=await s),s===0)break;const o=e.currentPos,a=e.readBytes(s),l=a.byteLength;let c=0;for(;c<l;){const u=a.indexOf(0,c);if(u===-1||u>=l)break;c=u;const d=o+c;if(c+4>=l){e.seekTo(d);break}const f=a[c+1],h=a[c+2],p=a[c+3];let m=0,g=null;if(f===0&&h===0&&p===1?(m=4,g=a[c+4]):f===0&&h===1&&(m=3,g=p),m===0){c++;continue}const y=d;if(i===null){i=y,c+=m;continue}if(g!==null){const b=n==="avc"?mw(g):rm(g);if(n==="avc"?b===Wo.AUD:b===li.AUD_NUT){const C=y-i;return e.seekTo(i),e.supplyPacket(C,0)}}c+=m}if(s<r)break}if(i!==null){const s=e.endPos-i;return e.seekTo(i),e.supplyPacket(s,0)}}}class Ane extends LD{constructor(e){super(e),this.elementaryStream=e}getCodec(){return this.elementaryStream.info.codec}getNumberOfChannels(){return this.elementaryStream.info.numberOfChannels}getSampleRate(){return this.elementaryStream.info.sampleRate}async getDecoderConfig(){return{codec:JE({codec:this.elementaryStream.info.codec,codecDescription:null,aacCodecInfo:this.elementaryStream.info.aacCodecInfo}),numberOfChannels:this.elementaryStream.info.numberOfChannels,sampleRate:this.elementaryStream.info.sampleRate}}getPacketType(e){return"key"}getReorderSize(){return 1}async markNextPacket(e){W(!e.suppliedPacket);const n=this.elementaryStream.info.codec,r=128;for(;;){let i=e.ensureBuffered(r);i instanceof Promise&&(i=await i);const s=e.currentPos;for(;e.currentPos-s<i;){const o=e.readU8();if(n==="aac"){if(o!==255)continue;e.skip(-1);const a=e.currentPos;let l=e.ensureBuffered($u);if(l instanceof Promise&&(l=await l),l<$u)return;const c=e.readBytes($u),u=sd(fo.tempFromBytes(c));if(u){e.seekTo(a);let d=e.ensureBuffered(u.frameLength);return d instanceof Promise&&(d=await d),e.supplyPacket(d,Math.round(xy*Oa/this.elementaryStream.info.sampleRate))}else e.seekTo(a+1)}else if(n==="mp3"){if(o!==255)continue;e.skip(-1);const a=e.currentPos;let l=e.ensureBuffered(Tp);if(l instanceof Promise&&(l=await l),l<Tp)return;const c=e.readBytes(Tp),u=jn(c).getUint32(0),d=uT(u,null);if(d.header){e.seekTo(a);let f=e.ensureBuffered(d.header.totalSize);f instanceof Promise&&(f=await f);const h=d.header.audioSamplesInFrame*Oa/this.elementaryStream.info.sampleRate;return e.supplyPacket(f,Math.round(h))}else e.seekTo(a+1)}else throw new Error("Unhandled.")}if(i<r)break}}}class rf{constructor(e,n,r){this.currentPos=0,this.pesPackets=[],this.currentPesPacketIndex=0,this.currentPesPacketPos=0,this.endPos=0,this.nextPts=0,this.suppliedPacket=null,this.backing=e,this.pid=e.elementaryStream.pid,this.demuxer=e.elementaryStream.demuxer,this.startingPesPacket=n,this.uncapped=r}clone(){const e=new rf(this.backing,this.startingPesPacket,!0);return e.currentPos=this.currentPos,e.pesPackets=[...this.pesPackets],e.currentPesPacketIndex=this.currentPesPacketIndex,e.currentPesPacketPos=this.currentPesPacketPos,e.endPos=this.endPos,e.nextPts=this.nextPts,e}ensureBuffered(e){const n=this.endPos-this.currentPos;return n>=e?e:this.bufferData(e-n).then(()=>Math.min(this.endPos-this.currentPos,e))}getCurrentPesPacket(){const e=this.pesPackets[this.currentPesPacketIndex];return W(e),e}async bufferData(e){const n=this.endPos+e;for(;this.endPos<n;){let r;if(this.pesPackets.length===0)r=this.startingPesPacket;else{let i=Wn(this.pesPackets).sectionEndPos;for(W(i!==null);;){const a=await this.demuxer.readPacketHeader(i);if(!a)return;if(a.pid===this.pid)break;i+=this.demuxer.packetStride}const s=await this.demuxer.readSection(i,!0);if(!s)return;const o=nf(s);if(!o)throw new Error(Hd);r=o}this.pesPackets.push(r),this.endPos+=r.data.byteLength,this.pesPackets.length===1&&(this.nextPts=r.pts)}}readBytes(e){const n=this.getCurrentPesPacket(),r=this.currentPos-this.currentPesPacketPos,i=r+e;if(this.currentPos+=e,i<=n.data.byteLength)return n.data.subarray(r,i);const s=new Uint8Array(e);s.set(n.data.subarray(r));let o=n.data.byteLength-r;for(;;){this.advanceCurrentPacket();const a=this.getCurrentPesPacket(),l=e-o;if(l<=a.data.byteLength){s.set(a.data.subarray(0,l),o);break}s.set(a.data,o),o+=a.data.byteLength}return s}readU8(){let e=this.getCurrentPesPacket();const n=this.currentPos-this.currentPesPacketPos;return this.currentPos++,n<e.data.byteLength?e.data[n]:(this.advanceCurrentPacket(),e=this.getCurrentPesPacket(),e.data[0])}seekTo(e){if(e!==this.currentPos){if(e<this.currentPos)for(;e<this.currentPesPacketPos;){this.currentPesPacketIndex--;const n=this.getCurrentPesPacket();this.currentPesPacketPos-=n.data.byteLength,this.nextPts=n.pts}else for(;;){const n=this.getCurrentPesPacket(),r=this.currentPesPacketPos+n.data.byteLength;if(e<r)break;this.currentPesPacketPos+=n.data.byteLength,this.currentPesPacketIndex++,this.nextPts=this.getCurrentPesPacket().pts}this.currentPos=e}}skip(e){this.seekTo(this.currentPos+e)}advanceCurrentPacket(){this.currentPesPacketPos+=this.getCurrentPesPacket().data.byteLength,this.currentPesPacketIndex++,this.nextPts=this.getCurrentPesPacket().pts}supplyPacket(e,n){const r=this.getCurrentPesPacket();if(!this.uncapped&&r!==this.startingPesPacket){this.suppliedPacket=null;return}this.backing.maybeInsertReferencePacket(r,!1,!0);const i=this.nextPts;this.nextPts+=n;const s=r.sectionStartPos,o=s+(this.currentPos-this.currentPesPacketPos),a=this.readBytes(e);this.suppliedPacket={pts:i,data:a,sequenceNumber:o,sectionStartPos:s},this.pesPackets.splice(0,this.currentPesPacketIndex),this.currentPesPacketIndex=0}}class Mg{constructor(e,n){this.decodeOrderPackets=[],this.reorderBuffer=[],this.presentationOrderPackets=[],this.reachedEnd=!1,this.lastDuration=0,this.backing=e,this.context=n,this.reorderSize=e.getReorderSize(),W(this.reorderSize>=0)}async readNext(){if(this.decodeOrderPackets.length===0&&!await this.readNextDecodeOrderPacket())return null;await this.ensureCurrentPacketHasNext();const e=this.decodeOrderPackets[0],n=this.presentationOrderPackets.indexOf(e);W(n!==-1);let r;for(n===this.presentationOrderPackets.length-1?r=this.lastDuration:(r=this.presentationOrderPackets[n+1].pts-e.pts,this.lastDuration=r),this.decodeOrderPackets.shift();this.presentationOrderPackets.length>0;){const i=this.presentationOrderPackets[0];if(this.decodeOrderPackets.includes(i))break;this.presentationOrderPackets.shift()}return{packet:e,duration:r}}async readNextDecodeOrderPacket(){if(this.reachedEnd)return!1;let e;return this.context.suppliedPacket?e=this.context.suppliedPacket:(await this.backing.markNextPacket(this.context),e=this.context.suppliedPacket),this.context.suppliedPacket=null,e?(this.decodeOrderPackets.push(e),this.processPacketThroughReorderBuffer(e),!0):(this.reachedEnd=!0,this.flushReorderBuffer(),!1)}async ensureCurrentPacketHasNext(){const e=this.decodeOrderPackets[0];for(W(e);;){const n=this.presentationOrderPackets.indexOf(e);if(n!==-1&&n<=this.presentationOrderPackets.length-2||!await this.readNextDecodeOrderPacket())break}}processPacketThroughReorderBuffer(e){if(this.reorderBuffer.push(e),this.reorderBuffer.length>=this.reorderSize){let n=0;for(let i=1;i<this.reorderBuffer.length;i++)this.reorderBuffer[i].pts<this.reorderBuffer[n].pts&&(n=i);const r=this.reorderBuffer.splice(n,1)[0];this.presentationOrderPackets.push(r)}}flushReorderBuffer(){this.reorderBuffer.sort((e,n)=>e.pts-n.pts),this.presentationOrderPackets.push(...this.reorderBuffer),this.reorderBuffer.length=0}}class Tl{}class BD extends Tl{async _getMajorBrand(e){let n=e._reader.requestSlice(0,12);return n instanceof Promise&&(n=await n),!n||(n.skip(4),Gr(n,4)!=="ftyp")?null:Gr(n,4)}_createDemuxer(e){return new Lte(e)}}class Pne extends BD{async _canReadInput(e){const n=await this._getMajorBrand(e);return!!n&&n!=="qt  "}get name(){return"MP4"}get mimeType(){return"video/mp4"}}class Ine extends BD{async _canReadInput(e){return await this._getMajorBrand(e)==="qt  "}get name(){return"QuickTime File Format"}get mimeType(){return"video/quicktime"}}class FD extends Tl{async isSupportedEBMLOfDocType(e,n){let r=e._reader.requestSlice(0,Va);if(r instanceof Promise&&(r=await r),!r)return!1;const i=AD(r);if(i===null||i<1||i>8||Ut(r,i)!==Pe.EBML)return!1;const o=PD(r);if(typeof o!="number")return!1;let a=e._reader.requestSlice(r.filePos,o);if(a instanceof Promise&&(a=await a),!a)return!1;const l=r.filePos;for(;a.filePos<=l+o-Ms;){const c=Da(a);if(!c)break;const{id:u,size:d}=c,f=a.filePos;if(d===void 0)return!1;switch(u){case Pe.EBMLVersion:if(Ut(a,d)!==1)return!1;break;case Pe.EBMLReadVersion:if(Ut(a,d)!==1)return!1;break;case Pe.DocType:if(Ud(a,d)!==n)return!1;break;case Pe.DocTypeVersion:if(Ut(a,d)>4)return!1;break}a.filePos=f+d}return!0}_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"matroska")}_createDemuxer(e){return new qte(e)}get name(){return"Matroska"}get mimeType(){return"video/x-matroska"}}class One extends FD{_canReadInput(e){return this.isSupportedEBMLOfDocType(e,"webm")}get name(){return"WebM"}get mimeType(){return"video/webm"}}class Mne extends Tl{async _canReadInput(e){let n=e._reader.requestSlice(0,10);if(n instanceof Promise&&(n=await n),!n)return!1;let r=0,i=!1;for(;;){let c=e._reader.requestSlice(r,by);if(c instanceof Promise&&(c=await c),!c)break;const u=wy(c);if(!u)break;i=!0,r=c.filePos+u.size}const s=await Zx(e._reader,r,r+4096);if(!s)return!1;if(i)return!0;r=s.startPos+s.header.totalSize;const o=await Zx(e._reader,r,r+Tp);if(!o)return!1;const a=s.header,l=o.header;return!(a.channel!==l.channel||a.sampleRate!==l.sampleRate)}_createDemuxer(e){return new rne(e)}get name(){return"MP3"}get mimeType(){return"audio/mpeg"}}class Nne extends Tl{async _canReadInput(e){let n=e._reader.requestSlice(0,12);if(n instanceof Promise&&(n=await n),!n)return!1;const r=Gr(n,4);return r!=="RIFF"&&r!=="RIFX"&&r!=="RF64"?!1:(n.skip(4),Gr(n,4)==="WAVE")}_createDemuxer(e){return new hne(e)}get name(){return"WAVE"}get mimeType(){return"audio/wav"}}class Rne extends Tl{async _canReadInput(e){let n=e._reader.requestSlice(0,4);return n instanceof Promise&&(n=await n),n?Gr(n,4)==="OggS":!1}_createDemuxer(e){return new dne(e)}get name(){return"Ogg"}get mimeType(){return"application/ogg"}}class Dne extends Tl{async _canReadInput(e){let n=e._reader.requestSlice(0,4);return n instanceof Promise&&(n=await n),n?Gr(n,4)==="fLaC":!1}get name(){return"FLAC"}get mimeType(){return"audio/flac"}_createDemuxer(e){return new kne(e)}}class Lne extends Tl{async _canReadInput(e){let n=e._reader.requestSliceRange(0,vy,$u);if(n instanceof Promise&&(n=await n),!n)return!1;const r=sd(n);if(!r||(n=e._reader.requestSliceRange(r.frameLength,vy,$u),n instanceof Promise&&(n=await n),!n))return!1;const i=sd(n);return i?r.objectType===i.objectType&&r.samplingFrequencyIndex===i.samplingFrequencyIndex&&r.channelConfiguration===i.channelConfiguration:!1}_createDemuxer(e){return new mne(e)}get name(){return"ADTS"}get mimeType(){return"audio/aac"}}class Bne extends Tl{async _canReadInput(e){const n=rs+16+1;let r=e._reader.requestSlice(0,n);if(r instanceof Promise&&(r=await r),!r)return!1;const i=Ct(r,n);return i[0]===71&&i[rs]===71||i[0]===71&&i[rs+16]===71?!0:i[4]===71&&i[4+rs]===71}_createDemuxer(e){return new Cne(e)}get name(){return"MPEG Transport Stream"}get mimeType(){return"video/MP2T"}}const Fne=new Pne,$ne=new Ine,zne=new FD,Une=new One,Hne=new Mne,Vne=new Nne,Wne=new Rne,jne=new Lne,qne=new Dne,Kne=new Bne,YP=[Fne,$ne,zne,Une,Vne,Wne,qne,Hne,jne,Kne];class $D{constructor(){this._disposed=!1,this._sizePromise=null,this.onread=null}async getSizeOrNull(){if(this._disposed)throw new ss;return this._sizePromise??=Promise.resolve(this._retrieveSize())}async getSize(){if(this._disposed)throw new ss;const e=await this.getSizeOrNull();if(e===null)throw new Error("Cannot determine the size of an unsized source.");return e}}class JP extends $D{constructor(e,n={}){if(!(e instanceof Blob))throw new TypeError("blob must be a Blob.");if(!n||typeof n!="object")throw new TypeError("options must be an object.");if(n.maxCacheSize!==void 0&&(!oD(n.maxCacheSize)||n.maxCacheSize<0))throw new TypeError("options.maxCacheSize, when provided, must be a non-negative number.");super(),this._readers=new WeakMap,this._blob=e,this._orchestrator=new Zne({maxCacheSize:n.maxCacheSize??8*2**20,maxWorkerCount:4,runWorker:this._runWorker.bind(this),prefetchProfile:Gne.fileSystem})}_retrieveSize(){const e=this._blob.size;return this._orchestrator.fileSize=e,e}_read(e,n){return this._orchestrator.read(e,n)}async _runWorker(e){let n=this._readers.get(e);for(n===void 0&&("stream"in this._blob&&!Sp()?n=this._blob.slice(e.currentPos).stream().getReader():n=null,this._readers.set(e,n));e.currentPos<e.targetPos&&!e.aborted;)if(n){const{done:r,value:i}=await n.read();if(r)throw this._orchestrator.forgetWorker(e),new Error("Blob reader stopped unexpectedly before all requested data was read.");if(e.aborted)break;this.onread?.(e.currentPos,e.currentPos+i.length),this._orchestrator.supplyWorkerData(e,i)}else{const r=await this._blob.slice(e.currentPos,e.targetPos).arrayBuffer();if(e.aborted)break;this.onread?.(e.currentPos,e.currentPos+r.byteLength),this._orchestrator.supplyWorkerData(e,new Uint8Array(r))}e.running=!1,e.aborted&&await n?.cancel()}_dispose(){this._orchestrator.dispose()}}const Gne={fileSystem:(t,e)=>(t=Math.floor((t-65536)/65536)*65536,e=Math.ceil((e+65536)/65536)*65536,{start:t,end:e})};class Zne{constructor(e){this.options=e,this.fileSize=null,this.nextAge=0,this.workers=[],this.cache=[],this.currentCacheSize=0,this.disposed=!1}read(e,n){W(this.fileSize!==null);const r=this.options.prefetchProfile(e,n,this.workers),i=Math.max(r.start,0),s=Math.min(r.end,this.fileSize);W(i<=e&&n<=s);let o=null;const a=fn(this.cache,e,b=>b.start),l=a!==-1?this.cache[a]:null;l&&l.start<=e&&n<=l.end&&(l.age=this.nextAge++,o={bytes:l.bytes,view:l.view,offset:l.start});const c=fn(this.cache,i,b=>b.start),u=o?null:new Uint8Array(n-e);let d=0,f=i;const h=[];if(c!==-1){for(let b=c;b<this.cache.length;b++){const S=this.cache[b];if(S.start>=s)break;if(S.end<=i)continue;const C=Math.max(i,S.start),_=Math.min(s,S.end);if(W(C<=_),f<C&&h.push({start:f,end:C}),f=_,u){const x=Math.max(e,S.start),I=Math.min(n,S.end);if(x<I){const k=x-e;u.set(S.bytes.subarray(x-S.start,I-S.start),k),k===d&&(d=I-e)}}S.age=this.nextAge++}f<s&&h.push({start:f,end:s})}else h.push({start:i,end:s});if(u&&d>=u.length&&(o={bytes:u,view:jn(u),offset:e}),h.length===0)return W(o),o;const{promise:p,resolve:m,reject:g}=ai(),y=[];for(const b of h){const S=Math.max(e,b.start),C=Math.min(n,b.end);S===b.start&&C===b.end?y.push(b):S<C&&y.push({start:S,end:C})}for(const b of h){const S=u&&{start:e,bytes:u,holes:y,resolve:m,reject:g};let C=!1;for(const _ of this.workers)if(BP(b.start-131072,b.start,_.currentPos,_.targetPos)){_.targetPos=Math.max(_.targetPos,b.end),C=!0,S&&!_.pendingSlices.includes(S)&&_.pendingSlices.push(S),_.running||this.runWorker(_);break}if(!C){const _=this.createWorker(b.start,b.end);S&&(_.pendingSlices=[S]),this.runWorker(_)}}return o||(W(u),o=p.then(b=>({bytes:b,view:jn(b),offset:e}))),o}createWorker(e,n){const r={startPos:e,currentPos:e,targetPos:n,running:!1,aborted:this.disposed,pendingSlices:[],age:this.nextAge++};for(this.workers.push(r);this.workers.length>this.options.maxWorkerCount;){let i=0,s=this.workers[0];for(let o=1;o<this.workers.length;o++){const a=this.workers[o];a.age<s.age&&(i=o,s=a)}if(s.running&&s.pendingSlices.length>0)break;s.aborted=!0,this.workers.splice(i,1)}return r}runWorker(e){W(!e.running),W(e.currentPos<e.targetPos),e.running=!0,e.age=this.nextAge++,this.options.runWorker(e).catch(n=>{if(e.running=!1,e.pendingSlices.length>0)e.pendingSlices.forEach(r=>r.reject(n)),e.pendingSlices.length=0;else throw n})}supplyWorkerData(e,n){W(!e.aborted);const r=e.currentPos,i=r+n.length;this.insertIntoCache({start:r,end:i,bytes:n,view:jn(n),age:this.nextAge++}),e.currentPos+=n.length,e.targetPos=Math.max(e.targetPos,e.currentPos);for(let s=0;s<e.pendingSlices.length;s++){const o=e.pendingSlices[s],a=Math.max(r,o.start),l=Math.min(i,o.start+o.bytes.length);a<l&&o.bytes.set(n.subarray(a-r,l-r),a-o.start);for(let c=0;c<o.holes.length;c++){const u=o.holes[c];r<=u.start&&i>u.start&&(u.start=i),u.end<=u.start&&(o.holes.splice(c,1),c--)}o.holes.length===0&&(o.resolve(o.bytes),e.pendingSlices.splice(s,1),s--)}for(let s=0;s<this.workers.length;s++){const o=this.workers[s];e===o||o.running||BP(r,i,o.currentPos,o.targetPos)&&(this.workers.splice(s,1),s--)}}forgetWorker(e){const n=this.workers.indexOf(e);W(n!==-1),this.workers.splice(n,1)}insertIntoCache(e){if(this.options.maxCacheSize===0)return;let n=fn(this.cache,e.start,r=>r.start)+1;if(n>0){const r=this.cache[n-1];if(r.end>=e.end)return;if(r.end>e.start){const i=new Uint8Array(e.end-r.start);i.set(r.bytes,0),i.set(e.bytes,e.start-r.start),this.currentCacheSize+=e.end-r.end,r.bytes=i,r.view=jn(i),r.end=e.end,n--,e=r}else this.cache.splice(n,0,e),this.currentCacheSize+=e.bytes.length}else this.cache.splice(n,0,e),this.currentCacheSize+=e.bytes.length;for(let r=n+1;r<this.cache.length;r++){const i=this.cache[r];if(e.end<=i.start)break;if(e.end>=i.end){this.cache.splice(r,1),this.currentCacheSize-=i.bytes.length,r--;continue}const s=new Uint8Array(i.end-e.start);s.set(e.bytes,0),s.set(i.bytes,i.start-e.start),this.currentCacheSize-=e.end-i.start,e.bytes=s,e.view=jn(s),e.end=i.end,this.cache.splice(r,1);break}for(;this.currentCacheSize>this.options.maxCacheSize;){let r=0,i=this.cache[0];for(let s=1;s<this.cache.length;s++){const o=this.cache[s];o.age<i.age&&(r=s,i=o)}if(this.currentCacheSize-i.bytes.length<=this.options.maxCacheSize)break;this.cache.splice(r,1),this.currentCacheSize-=i.bytes.length}}dispose(){for(const e of this.workers)e.aborted=!0;this.workers.length=0,this.cache.length=0,this.disposed=!0}}sD();class Xx{get disposed(){return this._disposed}constructor(e){if(this._demuxerPromise=null,this._format=null,this._disposed=!1,!e||typeof e!="object")throw new TypeError("options must be an object.");if(!Array.isArray(e.formats)||e.formats.some(n=>!(n instanceof Tl)))throw new TypeError("options.formats must be an array of InputFormat.");if(!(e.source instanceof $D))throw new TypeError("options.source must be a Source.");if(e.source._disposed)throw new Error("options.source must not be disposed.");this._formats=e.formats,this._source=e.source,this._reader=new Xne(e.source)}_getDemuxer(){return this._demuxerPromise??=(async()=>{this._reader.fileSize=await this._source.getSizeOrNull();for(const e of this._formats)if(await e._canReadInput(this))return this._format=e,e._createDemuxer(this);throw new Error("Input has an unsupported or unrecognizable format.")})()}get source(){return this._source}async getFormat(){return await this._getDemuxer(),W(this._format),this._format}async computeDuration(){return(await this._getDemuxer()).computeDuration()}async getFirstTimestamp(){const e=await this.getTracks();if(e.length===0)return 0;const n=await Promise.all(e.map(r=>r.getFirstTimestamp()));return Math.min(...n)}async getTracks(){return(await this._getDemuxer()).getTracks()}async getVideoTracks(){return(await this.getTracks()).filter(n=>n.isVideoTrack())}async getAudioTracks(){return(await this.getTracks()).filter(n=>n.isAudioTrack())}async getPrimaryVideoTrack(){return(await this.getTracks()).find(n=>n.isVideoTrack())??null}async getPrimaryAudioTrack(){return(await this.getTracks()).find(n=>n.isAudioTrack())??null}async getMimeType(){return(await this._getDemuxer()).getMimeType()}async getMetadataTags(){return(await this._getDemuxer()).getMetadataTags()}dispose(){this._disposed||(this._disposed=!0,this._source._disposed=!0,this._source._dispose())}[Symbol.dispose](){this.dispose()}}class ss extends Error{constructor(e="Input has been disposed."){super(e),this.name="InputDisposedError"}}class Xne{constructor(e){this.source=e}requestSlice(e,n){if(this.source._disposed)throw new ss;if(e<0||this.fileSize!==null&&e+n>this.fileSize)return null;const r=e+n,i=this.source._read(e,r);return i instanceof Promise?i.then(s=>s?new fo(s.bytes,s.view,s.offset,e,r):null):i?new fo(i.bytes,i.view,i.offset,e,r):null}requestSliceRange(e,n,r){if(this.source._disposed)throw new ss;if(e<0)return null;if(this.fileSize!==null)return this.requestSlice(e,zr(this.fileSize-e,n,r));{const i=this.requestSlice(e,r),s=o=>{if(o)return o;const a=c=>(W(c!==null),this.requestSlice(e,zr(c-e,n,r))),l=this.source._retrieveSize();return l instanceof Promise?l.then(a):a(l)};return i instanceof Promise?i.then(s):s(i)}}}class fo{constructor(e,n,r,i,s){this.bytes=e,this.view=n,this.offset=r,this.start=i,this.end=s,this.bufferPos=i-r}static tempFromBytes(e){return new fo(e,jn(e),0,0,e.length)}get length(){return this.end-this.start}get filePos(){return this.offset+this.bufferPos}set filePos(e){this.bufferPos=e-this.offset}get remainingLength(){return Math.max(this.end-this.filePos,0)}skip(e){this.bufferPos+=e}slice(e,n=this.end-e){if(e<this.start||e+n>this.end)throw new RangeError("Slicing outside of original slice.");return new fo(this.bytes,this.view,this.offset,e,e+n)}}const Ji=(t,e)=>{if(t.filePos<t.start||t.filePos+e>t.end)throw new RangeError(`Tried reading [${t.filePos}, ${t.filePos+e}), but slice is [${t.start}, ${t.end}). This is likely an internal error, please report it alongside the file that caused it.`)},Ct=(t,e)=>{Ji(t,e);const n=t.bytes.subarray(t.bufferPos,t.bufferPos+e);return t.bufferPos+=e,n},mt=t=>(Ji(t,1),t.view.getUint8(t.bufferPos++)),Vh=(t,e)=>{Ji(t,2);const n=t.view.getUint16(t.bufferPos,e);return t.bufferPos+=2,n},Fr=t=>{Ji(t,2);const e=t.view.getUint16(t.bufferPos,!1);return t.bufferPos+=2,e},Wd=t=>{Ji(t,3);const e=fw(t.view,t.bufferPos,!1);return t.bufferPos+=3,e},Qx=t=>{Ji(t,2);const e=t.view.getInt16(t.bufferPos,!1);return t.bufferPos+=2,e},gc=(t,e)=>{Ji(t,4);const n=t.view.getUint32(t.bufferPos,e);return t.bufferPos+=4,n},nt=t=>{Ji(t,4);const e=t.view.getUint32(t.bufferPos,!1);return t.bufferPos+=4,e},sf=t=>{Ji(t,4);const e=t.view.getUint32(t.bufferPos,!0);return t.bufferPos+=4,e},Pu=t=>{Ji(t,4);const e=t.view.getInt32(t.bufferPos,!1);return t.bufferPos+=4,e},Qne=t=>{Ji(t,4);const e=t.view.getInt32(t.bufferPos,!0);return t.bufferPos+=4,e},eI=(t,e)=>{let n,r;return e?(n=gc(t,!0),r=gc(t,!0)):(r=gc(t,!1),n=gc(t,!1)),r*4294967296+n},Xs=t=>{const e=nt(t),n=nt(t);return e*4294967296+n},Yne=t=>{const e=Pu(t),n=nt(t);return e*4294967296+n},Jne=t=>{const e=sf(t);return Qne(t)*4294967296+e},ere=t=>{Ji(t,4);const e=t.view.getFloat32(t.bufferPos,!1);return t.bufferPos+=4,e},zD=t=>{Ji(t,8);const e=t.view.getFloat64(t.bufferPos,!1);return t.bufferPos+=8,e},Gr=(t,e)=>{Ji(t,e);let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t.bytes[t.bufferPos++]);return n};const tI=/<(?:(\d{2}):)?(\d{2}):(\d{2}).(\d{3})>/g,tre=t=>{const e=Math.floor(t/36e5),n=Math.floor(t%(3600*1e3)/(60*1e3)),r=Math.floor(t%(60*1e3)/1e3),i=t%1e3;return e.toString().padStart(2,"0")+":"+n.toString().padStart(2,"0")+":"+r.toString().padStart(2,"0")+"."+i.toString().padStart(3,"0")};class nI{constructor(e){this.writer=e,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap}writeU32(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}writeU64(e){this.helperView.setUint32(0,Math.floor(e/2**32),!1),this.helperView.setUint32(4,e,!1),this.writer.write(this.helper.subarray(0,8))}writeAscii(e){for(let n=0;n<e.length;n++)this.helperView.setUint8(n%8,e.charCodeAt(n)),n%8===7&&this.writer.write(this.helper);e.length%8!==0&&this.writer.write(this.helper.subarray(0,e.length%8))}writeBox(e){if(this.offsets.set(e,this.writer.getPos()),e.contents&&!e.children)this.writeBoxHeader(e,e.size??e.contents.byteLength+8),this.writer.write(e.contents);else{const n=this.writer.getPos();if(this.writeBoxHeader(e,0),e.contents&&this.writer.write(e.contents),e.children)for(const s of e.children)s&&this.writeBox(s);const r=this.writer.getPos(),i=e.size??r-n;this.writer.seek(n),this.writeBoxHeader(e,i),this.writer.seek(r)}}writeBoxHeader(e,n){this.writeU32(e.largeSize?1:n),this.writeAscii(e.type),e.largeSize&&this.writeU64(n)}measureBoxHeader(e){return 8+(e.largeSize?8:0)}patchBox(e){const n=this.offsets.get(e);W(n!==void 0);const r=this.writer.getPos();this.writer.seek(n),this.writeBox(e),this.writer.seek(r)}measureBox(e){if(e.contents&&!e.children)return this.measureBoxHeader(e)+e.contents.byteLength;{let n=this.measureBoxHeader(e);if(e.contents&&(n+=e.contents.byteLength),e.children)for(const r of e.children)r&&(n+=this.measureBox(r));return n}}}const Qt=new Uint8Array(8),na=new DataView(Qt.buffer),Zn=t=>[(t%256+256)%256],wt=t=>(na.setUint16(0,t,!1),[Qt[0],Qt[1]]),UD=t=>(na.setInt16(0,t,!1),[Qt[0],Qt[1]]),HD=t=>(na.setUint32(0,t,!1),[Qt[1],Qt[2],Qt[3]]),Xe=t=>(na.setUint32(0,t,!1),[Qt[0],Qt[1],Qt[2],Qt[3]]),ac=t=>(na.setInt32(0,t,!1),[Qt[0],Qt[1],Qt[2],Qt[3]]),od=t=>(na.setUint32(0,Math.floor(t/2**32),!1),na.setUint32(4,t,!1),[Qt[0],Qt[1],Qt[2],Qt[3],Qt[4],Qt[5],Qt[6],Qt[7]]),VD=t=>(na.setInt16(0,2**8*t,!1),[Qt[0],Qt[1]]),La=t=>(na.setInt32(0,2**16*t,!1),[Qt[0],Qt[1],Qt[2],Qt[3]]),k1=t=>(na.setInt32(0,2**30*t,!1),[Qt[0],Qt[1],Qt[2],Qt[3]]),E1=(t,e)=>{const n=[];let r=t;do{let i=r&127;r>>=7,n.length>0&&(i|=128),n.push(i)}while(r>0||e);return n.reverse()},ri=(t,e=!1)=>{const n=Array(t.length).fill(null).map((r,i)=>t.charCodeAt(i));return e&&n.push(0),n},dT=t=>{let e=null;for(const n of t)(!e||n.timestamp>e.timestamp)&&(e=n);return e},WD=t=>{const e=t*(Math.PI/180),n=Math.round(Math.cos(e)),r=Math.round(Math.sin(e));return[n,r,0,-r,n,0,0,0,1]},jD=WD(0),qD=t=>[La(t[0]),La(t[1]),k1(t[2]),La(t[3]),La(t[4]),k1(t[5]),La(t[6]),La(t[7]),k1(t[8])],vt=(t,e,n)=>({type:t,contents:e&&new Uint8Array(e.flat(10)),children:n}),un=(t,e,n,r,i)=>vt(t,[Zn(e),HD(n),r??[]],i),nre=t=>t.isQuickTime?vt("ftyp",[ri("qt  "),Xe(512),ri("qt  ")]):t.fragmented?vt("ftyp",[ri("iso5"),Xe(512),ri("iso5"),ri("iso6"),ri("mp41")]):vt("ftyp",[ri("isom"),Xe(512),ri("isom"),t.holdsAvc?ri("avc1"):[],ri("mp41")]),Ng=t=>({type:"mdat",largeSize:t}),rre=t=>({type:"free",size:t}),Wh=t=>vt("moov",void 0,[ire(t.creationTime,t.trackDatas),...t.trackDatas.map(e=>sre(e,t.creationTime)),t.isFragmented?zre(t.trackDatas):null,Jre(t)]),ire=(t,e)=>{const n=wr(Math.max(0,...e.filter(o=>o.samples.length>0).map(o=>{const a=dT(o.samples);return a.timestamp+a.duration})),Yx),r=Math.max(0,...e.map(o=>o.track.id))+1,i=!jf(t)||!jf(n),s=i?od:Xe;return un("mvhd",+i,0,[s(t),s(t),Xe(Yx),s(n),La(1),VD(1),Array(10).fill(0),qD(jD),Array(24).fill(0),Xe(r)])},sre=(t,e)=>{const n=die(t);return vt("trak",void 0,[ore(t,e),are(t,e),n.name!==void 0?vt("udta",void 0,[vt("name",[...Vo.encode(n.name)])]):null])},ore=(t,e)=>{const n=dT(t.samples),r=wr(n?n.timestamp+n.duration:0,Yx),i=!jf(e)||!jf(r),s=i?od:Xe;let o;if(t.type==="video"){const l=t.track.metadata.rotation;o=WD(l??0)}else o=jD;let a=2;return t.track.metadata.disposition?.default!==!1&&(a|=1),un("tkhd",+i,a,[s(e),s(e),Xe(t.track.id),Xe(0),s(r),Array(8).fill(0),wt(0),wt(t.track.id),VD(t.type==="audio"?1:0),wt(0),qD(o),La(t.type==="video"?t.info.width:0),La(t.type==="video"?t.info.height:0)])},are=(t,e)=>vt("mdia",void 0,[lre(t,e),fT(!0,cre[t.type],ure[t.type]),dre(t)]),lre=(t,e)=>{const n=dT(t.samples),r=wr(n?n.timestamp+n.duration:0,t.timescale),i=!jf(e)||!jf(r),s=i?od:Xe;return un("mdhd",+i,0,[s(e),s(e),Xe(t.timescale),s(r),wt(XD(t.track.metadata.languageCode??cs)),wt(0)])},cre={video:"vide",audio:"soun",subtitle:"text"},ure={video:"MediabunnyVideoHandler",audio:"MediabunnySoundHandler",subtitle:"MediabunnyTextHandler"},fT=(t,e,n,r="\0\0\0\0")=>un("hdlr",0,0,[t?ri("mhlr"):Xe(0),ri(e),ri(r),Xe(0),Xe(0),ri(n,!0)]),dre=t=>vt("minf",void 0,[mre[t.type](),gre(),wre(t)]),fre=()=>un("vmhd",0,1,[wt(0),wt(0),wt(0),wt(0)]),hre=()=>un("smhd",0,0,[wt(0),wt(0)]),pre=()=>un("nmhd",0,0),mre={video:fre,audio:hre,subtitle:pre},gre=()=>vt("dinf",void 0,[yre()]),yre=()=>un("dref",0,0,[Xe(1)],[bre()]),bre=()=>un("url ",0,1),wre=t=>{const e=t.compositionTimeOffsetTable.length>1||t.compositionTimeOffsetTable.some(n=>n.sampleCompositionTimeOffset!==0);return vt("stbl",void 0,[vre(t),Nre(t),e?Fre(t):null,e?$re(t):null,Dre(t),Lre(t),Bre(t),Rre(t)])},vre=t=>{let e;if(t.type==="video")e=xre(rie(t.track.source._codec,t.info.decoderConfig.codec),t);else if(t.type==="audio"){const n=ZD(t.track.source._codec,t.muxer.isQuickTime);W(n),e=Cre(n,t)}else t.type==="subtitle"&&(e=Ore(oie[t.track.source._codec],t));return W(e),un("stsd",0,0,[Xe(1)],[e])},xre=(t,e)=>vt(t,[Array(6).fill(0),wt(1),wt(0),wt(0),Array(12).fill(0),wt(e.info.width),wt(e.info.height),Xe(4718592),Xe(4718592),Xe(0),wt(1),Array(32).fill(0),wt(24),UD(65535)],[iie[e.track.source._codec](e),Ree(e.info.decoderConfig.colorSpace)?Sre(e):null]),Sre=t=>vt("colr",[ri("nclx"),wt(jm[t.info.decoderConfig.colorSpace.primaries]),wt(qm[t.info.decoderConfig.colorSpace.transfer]),wt(Km[t.info.decoderConfig.colorSpace.matrix]),Zn((t.info.decoderConfig.colorSpace.fullRange?1:0)<<7)]),kre=t=>t.info.decoderConfig&&vt("avcC",[...hs(t.info.decoderConfig.description)]),Ere=t=>t.info.decoderConfig&&vt("hvcC",[...hs(t.info.decoderConfig.description)]),rI=t=>{if(!t.info.decoderConfig)return null;const e=t.info.decoderConfig,n=e.codec.split("."),r=Number(n[1]),i=Number(n[2]),s=Number(n[3]),o=n[4]?Number(n[4]):1,a=n[8]?Number(n[8]):Number(e.colorSpace?.fullRange??0),l=(s<<4)+(o<<1)+a,c=n[5]?Number(n[5]):e.colorSpace?.primaries?jm[e.colorSpace.primaries]:2,u=n[6]?Number(n[6]):e.colorSpace?.transfer?qm[e.colorSpace.transfer]:2,d=n[7]?Number(n[7]):e.colorSpace?.matrix?Km[e.colorSpace.matrix]:2;return un("vpcC",1,0,[Zn(r),Zn(i),Zn(l),Zn(c),Zn(u),Zn(d),wt(0)])},Tre=t=>vt("av1C",qee(t.info.decoderConfig.codec)),Cre=(t,e)=>{let n=0,r,i=16;if(Pi.includes(e.track.source._codec)){const s=e.track.source._codec,{sampleSize:o}=eu(s);i=8*o,i>16&&(n=1)}return n===0?r=[Array(6).fill(0),wt(1),wt(n),wt(0),Xe(0),wt(e.info.numberOfChannels),wt(i),wt(0),wt(0),wt(e.info.sampleRate<2**16?e.info.sampleRate:0),wt(0)]:r=[Array(6).fill(0),wt(1),wt(n),wt(0),Xe(0),wt(e.info.numberOfChannels),wt(Math.min(i,16)),wt(0),wt(0),wt(e.info.sampleRate<2**16?e.info.sampleRate:0),wt(0),Xe(1),Xe(i/8),Xe(e.info.numberOfChannels*i/8),Xe(2)],vt(t,r,[sie(e.track.source._codec,e.muxer.isQuickTime)?.(e)??null])},T1=t=>{let e;switch(t.track.source._codec){case"aac":e=64;break;case"mp3":e=107;break;case"vorbis":e=221;break;default:throw new Error(`Unhandled audio codec: ${t.track.source._codec}`)}let n=[...Zn(e),...Zn(21),...HD(0),...Xe(0),...Xe(0)];if(t.info.decoderConfig.description){const r=hs(t.info.decoderConfig.description);n=[...n,...Zn(5),...E1(r.byteLength),...r]}return n=[...wt(1),...Zn(0),...Zn(4),...E1(n.length),...n,...Zn(6),...Zn(1),...Zn(2)],n=[...Zn(3),...E1(n.length),...n],un("esds",0,0,n)},ql=t=>vt("wave",void 0,[_re(t),Are(t),vt("\0\0\0\0")]),_re=t=>vt("frma",[ri(ZD(t.track.source._codec,t.muxer.isQuickTime))]),Are=t=>{const{littleEndian:e}=eu(t.track.source._codec);return vt("enda",[wt(+e)])},Pre=t=>{let e=t.info.numberOfChannels,n=3840,r=t.info.sampleRate,i=0,s=0,o=new Uint8Array(0);const a=t.info.decoderConfig?.description;if(a){W(a.byteLength>=18);const l=hs(a),c=wD(l);e=c.outputChannelCount,n=c.preSkip,r=c.inputSampleRate,i=c.outputGain,s=c.channelMappingFamily,c.channelMappingTable&&(o=c.channelMappingTable)}return vt("dOps",[Zn(0),Zn(e),wt(n),Xe(r),UD(i),Zn(s),...o])},Ire=t=>{const e=t.info.decoderConfig?.description;W(e);const n=hs(e);return un("dfLa",0,0,[...n.subarray(4)])},Eo=t=>{const{littleEndian:e,sampleSize:n}=eu(t.track.source._codec),r=+e;return un("pcmC",0,0,[Zn(r),Zn(8*n)])},Ore=(t,e)=>vt(t,[Array(6).fill(0),wt(1)],[aie[e.track.source._codec](e)]),Mre=t=>vt("vttC",[...Vo.encode(t.info.config.description)]),Nre=t=>un("stts",0,0,[Xe(t.timeToSampleTable.length),t.timeToSampleTable.map(e=>[Xe(e.sampleCount),Xe(e.sampleDelta)])]),Rre=t=>{if(t.samples.every(n=>n.type==="key"))return null;const e=[...t.samples.entries()].filter(([,n])=>n.type==="key");return un("stss",0,0,[Xe(e.length),e.map(([n])=>Xe(n+1))])},Dre=t=>un("stsc",0,0,[Xe(t.compactlyCodedChunkTable.length),t.compactlyCodedChunkTable.map(e=>[Xe(e.firstChunk),Xe(e.samplesPerChunk),Xe(1)])]),Lre=t=>{if(t.type==="audio"&&t.info.requiresPcmTransformation){const{sampleSize:e}=eu(t.track.source._codec);return un("stsz",0,0,[Xe(e*t.info.numberOfChannels),Xe(t.samples.reduce((n,r)=>n+wr(r.duration,t.timescale),0))])}return un("stsz",0,0,[Xe(0),Xe(t.samples.length),t.samples.map(e=>Xe(e.size))])},Bre=t=>t.finalizedChunks.length>0&&Wn(t.finalizedChunks).offset>=2**32?un("co64",0,0,[Xe(t.finalizedChunks.length),t.finalizedChunks.map(e=>od(e.offset))]):un("stco",0,0,[Xe(t.finalizedChunks.length),t.finalizedChunks.map(e=>Xe(e.offset))]),Fre=t=>un("ctts",1,0,[Xe(t.compositionTimeOffsetTable.length),t.compositionTimeOffsetTable.map(e=>[Xe(e.sampleCount),ac(e.sampleCompositionTimeOffset)])]),$re=t=>{let e=1/0,n=-1/0,r=1/0,i=-1/0;W(t.compositionTimeOffsetTable.length>0),W(t.samples.length>0);for(let o=0;o<t.compositionTimeOffsetTable.length;o++){const a=t.compositionTimeOffsetTable[o];e=Math.min(e,a.sampleCompositionTimeOffset),n=Math.max(n,a.sampleCompositionTimeOffset)}for(let o=0;o<t.samples.length;o++){const a=t.samples[o];r=Math.min(r,wr(a.timestamp,t.timescale)),i=Math.max(i,wr(a.timestamp+a.duration,t.timescale))}const s=Math.max(-e,0);return i>=2**31?null:un("cslg",0,0,[ac(s),ac(e),ac(n),ac(r),ac(i)])},zre=t=>vt("mvex",void 0,t.map(Ure)),Ure=t=>un("trex",0,0,[Xe(t.track.id),Xe(1),Xe(0),Xe(0),Xe(0)]),iI=(t,e)=>vt("moof",void 0,[Hre(t),...e.map(Vre)]),Hre=t=>un("mfhd",0,0,[Xe(t)]),KD=t=>{let e=0,n=0;const r=0,i=0,s=t.type==="delta";return n|=+s,s?e|=1:e|=2,e<<24|n<<16|r<<8|i},Vre=t=>vt("traf",void 0,[Wre(t),jre(t),qre(t)]),Wre=t=>{W(t.currentChunk);let e=0;e|=8,e|=16,e|=32,e|=131072;const n=t.currentChunk.samples[1]??t.currentChunk.samples[0],r={duration:n.timescaleUnitsToNextSample,size:n.size,flags:KD(n)};return un("tfhd",0,e,[Xe(t.track.id),Xe(r.duration),Xe(r.size),Xe(r.flags)])},jre=t=>(W(t.currentChunk),un("tfdt",1,0,[od(wr(t.currentChunk.startTimestamp,t.timescale))])),qre=t=>{W(t.currentChunk);const e=t.currentChunk.samples.map(m=>m.timescaleUnitsToNextSample),n=t.currentChunk.samples.map(m=>m.size),r=t.currentChunk.samples.map(KD),i=t.currentChunk.samples.map(m=>wr(m.timestamp-m.decodeTimestamp,t.timescale)),s=new Set(e),o=new Set(n),a=new Set(r),l=new Set(i),c=a.size===2&&r[0]!==r[1],u=s.size>1,d=o.size>1,f=!c&&a.size>1,h=l.size>1||[...l].some(m=>m!==0);let p=0;return p|=1,p|=4*+c,p|=256*+u,p|=512*+d,p|=1024*+f,p|=2048*+h,un("trun",1,p,[Xe(t.currentChunk.samples.length),Xe(t.currentChunk.offset-t.currentChunk.moofOffset||0),c?Xe(r[0]):[],t.currentChunk.samples.map((m,g)=>[u?Xe(e[g]):[],d?Xe(n[g]):[],f?Xe(r[g]):[],h?ac(i[g]):[]])])},Kre=t=>vt("mfra",void 0,[...t.map(Gre),Zre()]),Gre=(t,e)=>un("tfra",1,0,[Xe(t.track.id),Xe(63),Xe(t.finalizedChunks.length),t.finalizedChunks.map(r=>[od(wr(r.samples[0].timestamp,t.timescale)),od(r.moofOffset),Xe(e+1),Xe(1),Xe(1)])]),Zre=()=>un("mfro",0,0,[Xe(0)]),Xre=()=>vt("vtte"),Qre=(t,e,n,r,i)=>vt("vttc",void 0,[i!==null?vt("vsid",[ac(i)]):null,n!==null?vt("iden",[...Vo.encode(n)]):null,e!==null?vt("ctim",[...Vo.encode(tre(e))]):null,r!==null?vt("sttg",[...Vo.encode(r)]):null,vt("payl",[...Vo.encode(t)])]),Yre=t=>vt("vtta",[...Vo.encode(t)]),Jre=t=>{const e=[],n=t.format._options.metadataFormat??"auto",r=t.output._metadataTags;if(n==="mdir"||n==="auto"&&!t.isQuickTime){const i=tie(r);i&&e.push(i)}else if(n==="mdta"){const i=nie(r);i&&e.push(i)}else(n==="udta"||n==="auto"&&t.isQuickTime)&&eie(e,t.output._metadataTags);return e.length===0?null:vt("udta",void 0,e)},eie=(t,e)=>{for(const{key:n,value:r}of iD(e))switch(n){case"title":t.push(To("Â©nam",r));break;case"description":t.push(To("Â©des",r));break;case"artist":t.push(To("Â©ART",r));break;case"album":t.push(To("Â©alb",r));break;case"albumArtist":t.push(To("albr",r));break;case"genre":t.push(To("Â©gen",r));break;case"date":t.push(To("Â©day",r.toISOString().slice(0,10)));break;case"comment":t.push(To("Â©cmt",r));break;case"lyrics":t.push(To("Â©lyr",r));break;case"raw":break;case"discNumber":case"discsTotal":case"trackNumber":case"tracksTotal":case"images":break;default:Hc(n)}if(e.raw)for(const n in e.raw){const r=e.raw[n];r==null||n.length!==4||t.some(i=>i.type===n)||(typeof r=="string"?t.push(To(n,r)):r instanceof Uint8Array&&t.push(vt(n,Array.from(r))))}},To=(t,e)=>{const n=Vo.encode(e);return vt(t,[wt(n.length),wt(XD("und")),Array.from(n)])},sI={"image/jpeg":13,"image/png":14,"image/bmp":27},GD=(t,e)=>{const n=[];for(const{key:r,value:i}of iD(t))switch(r){case"title":n.push({key:e?"title":"Â©nam",value:Zs(i)});break;case"description":n.push({key:e?"description":"Â©des",value:Zs(i)});break;case"artist":n.push({key:e?"artist":"Â©ART",value:Zs(i)});break;case"album":n.push({key:e?"album":"Â©alb",value:Zs(i)});break;case"albumArtist":n.push({key:e?"album_artist":"aART",value:Zs(i)});break;case"comment":n.push({key:e?"comment":"Â©cmt",value:Zs(i)});break;case"genre":n.push({key:e?"genre":"Â©gen",value:Zs(i)});break;case"lyrics":n.push({key:e?"lyrics":"Â©lyr",value:Zs(i)});break;case"date":n.push({key:e?"date":"Â©day",value:Zs(i.toISOString().slice(0,10))});break;case"images":for(const s of i)s.kind==="coverFront"&&n.push({key:"covr",value:vt("data",[Xe(sI[s.mimeType]??0),Xe(0),Array.from(s.data)])});break;case"trackNumber":if(e){const s=t.tracksTotal!==void 0?`${i}/${t.tracksTotal}`:i.toString();n.push({key:"track",value:Zs(s)})}else n.push({key:"trkn",value:vt("data",[Xe(0),Xe(0),wt(0),wt(i),wt(t.tracksTotal??0),wt(0)])});break;case"discNumber":e||n.push({key:"disc",value:vt("data",[Xe(0),Xe(0),wt(0),wt(i),wt(t.discsTotal??0),wt(0)])});break;case"tracksTotal":case"discsTotal":break;case"raw":break;default:Hc(r)}if(t.raw)for(const r in t.raw){const i=t.raw[r];i==null||!e&&r.length!==4||n.some(s=>s.key===r)||(typeof i=="string"?n.push({key:r,value:Zs(i)}):i instanceof Uint8Array?n.push({key:r,value:vt("data",[Xe(0),Xe(0),Array.from(i)])}):i instanceof wf&&n.push({key:r,value:vt("data",[Xe(sI[i.mimeType]??0),Xe(0),Array.from(i.data)])}))}return n},tie=t=>{const e=GD(t,!1);return e.length===0?null:un("meta",0,0,void 0,[fT(!1,"mdir","","appl"),vt("ilst",void 0,e.map(n=>vt(n.key,void 0,[n.value])))])},nie=t=>{const e=GD(t,!0);return e.length===0?null:vt("meta",void 0,[fT(!1,"mdta",""),un("keys",0,0,[Xe(e.length)],e.map(n=>vt("mdta",[...Vo.encode(n.key)]))),vt("ilst",void 0,e.map((n,r)=>{const i=String.fromCharCode(...Xe(r+1));return vt(i,void 0,[n.value])}))])},Zs=t=>vt("data",[Xe(1),Xe(0),...Vo.encode(t)]),rie=(t,e)=>{switch(t){case"avc":return e.startsWith("avc3")?"avc3":"avc1";case"hevc":return"hvc1";case"vp8":return"vp08";case"vp9":return"vp09";case"av1":return"av01"}},iie={avc:kre,hevc:Ere,vp8:rI,vp9:rI,av1:Tre},ZD=(t,e)=>{switch(t){case"aac":return"mp4a";case"mp3":return"mp4a";case"opus":return"Opus";case"vorbis":return"mp4a";case"flac":return"fLaC";case"ulaw":return"ulaw";case"alaw":return"alaw";case"pcm-u8":return"raw ";case"pcm-s8":return"sowt"}if(e)switch(t){case"pcm-s16":return"sowt";case"pcm-s16be":return"twos";case"pcm-s24":return"in24";case"pcm-s24be":return"in24";case"pcm-s32":return"in32";case"pcm-s32be":return"in32";case"pcm-f32":return"fl32";case"pcm-f32be":return"fl32";case"pcm-f64":return"fl64";case"pcm-f64be":return"fl64"}else switch(t){case"pcm-s16":return"ipcm";case"pcm-s16be":return"ipcm";case"pcm-s24":return"ipcm";case"pcm-s24be":return"ipcm";case"pcm-s32":return"ipcm";case"pcm-s32be":return"ipcm";case"pcm-f32":return"fpcm";case"pcm-f32be":return"fpcm";case"pcm-f64":return"fpcm";case"pcm-f64be":return"fpcm"}},sie=(t,e)=>{switch(t){case"aac":return T1;case"mp3":return T1;case"opus":return Pre;case"vorbis":return T1;case"flac":return Ire}if(e)switch(t){case"pcm-s24":return ql;case"pcm-s24be":return ql;case"pcm-s32":return ql;case"pcm-s32be":return ql;case"pcm-f32":return ql;case"pcm-f32be":return ql;case"pcm-f64":return ql;case"pcm-f64be":return ql}else switch(t){case"pcm-s16":return Eo;case"pcm-s16be":return Eo;case"pcm-s24":return Eo;case"pcm-s24be":return Eo;case"pcm-s32":return Eo;case"pcm-s32be":return Eo;case"pcm-f32":return Eo;case"pcm-f32be":return Eo;case"pcm-f64":return Eo;case"pcm-f64be":return Eo}return null},oie={webvtt:"wvtt"},aie={webvtt:Mre},XD=t=>{W(t.length===3);let e=0;for(let n=0;n<3;n++)e<<=5,e+=t.charCodeAt(n)-96;return e};class QD{constructor(){this.ensureMonotonicity=!1,this.trackedWrites=null,this.trackedStart=-1,this.trackedEnd=-1}start(){}maybeTrackWrites(e){if(!this.trackedWrites)return;let n=this.getPos();if(n<this.trackedStart){if(n+e.byteLength<=this.trackedStart)return;e=e.subarray(this.trackedStart-n),n=0}const r=n+e.byteLength-this.trackedStart;let i=this.trackedWrites.byteLength;for(;i<r;)i*=2;if(i!==this.trackedWrites.byteLength){const s=new Uint8Array(i);s.set(this.trackedWrites,0),this.trackedWrites=s}this.trackedWrites.set(e,n-this.trackedStart),this.trackedEnd=Math.max(this.trackedEnd,n+e.byteLength)}startTrackingWrites(){this.trackedWrites=new Uint8Array(2**10),this.trackedStart=this.getPos(),this.trackedEnd=this.trackedStart}stopTrackingWrites(){if(!this.trackedWrites)throw new Error("Internal error: Can't get tracked writes since nothing was tracked.");const n={data:this.trackedWrites.subarray(0,this.trackedEnd-this.trackedStart),start:this.trackedStart,end:this.trackedEnd};return this.trackedWrites=null,n}}const C1=2**16,_1=2**32;class YD extends QD{constructor(e){if(super(),this.pos=0,this.maxPos=0,this.target=e,this.supportsResize="resize"in new ArrayBuffer(0),this.supportsResize)try{this.buffer=new ArrayBuffer(C1,{maxByteLength:_1})}catch{this.buffer=new ArrayBuffer(C1),this.supportsResize=!1}else this.buffer=new ArrayBuffer(C1);this.bytes=new Uint8Array(this.buffer)}ensureSize(e){let n=this.buffer.byteLength;for(;n<e;)n*=2;if(n!==this.buffer.byteLength){if(n>_1)throw new Error(`ArrayBuffer exceeded maximum size of ${_1} bytes. Please consider using another target.`);if(this.supportsResize)this.buffer.resize(n);else{const r=new ArrayBuffer(n),i=new Uint8Array(r);i.set(this.bytes,0),this.buffer=r,this.bytes=i}}}write(e){this.maybeTrackWrites(e),this.ensureSize(this.pos+e.byteLength),this.bytes.set(e,this.pos),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength,this.maxPos=Math.max(this.maxPos,this.pos)}seek(e){this.pos=e}getPos(){return this.pos}async flush(){}async finalize(){this.ensureSize(this.pos),this.target.buffer=this.buffer.slice(0,Math.max(this.maxPos,this.pos))}async close(){}getSlice(e,n){return this.bytes.slice(e,n)}}class lie extends QD{constructor(e){super(),this.target=e,this.pos=0}write(e){this.maybeTrackWrites(e),this.target.onwrite?.(this.pos,this.pos+e.byteLength),this.pos+=e.byteLength}getPos(){return this.pos}seek(e){this.pos=e}async flush(){}async finalize(){}async close(){}}class hT{constructor(){this._output=null,this.onwrite=null}}class JD extends hT{constructor(){super(...arguments),this.buffer=null}_createWriter(){return new YD(this)}}class cie extends hT{_createWriter(){return new lie(this)}}const Yx=1e3,uie=2082844800,die=t=>{const e={},n=t.track;return n.metadata.name!==void 0&&(e.name=n.metadata.name),e},wr=(t,e,n=!0)=>{const r=t*e;return n?Math.round(r):r};class fie extends ste{constructor(e,n){super(e),this.auxTarget=new JD,this.auxWriter=this.auxTarget._createWriter(),this.auxBoxWriter=new nI(this.auxWriter),this.mdat=null,this.ftypSize=null,this.trackDatas=[],this.allTracksKnown=ai(),this.creationTime=Math.floor(Date.now()/1e3)+uie,this.finalizedChunks=[],this.nextFragmentNumber=1,this.maxWrittenTimestamp=-1/0,this.format=n,this.writer=e._writer,this.boxWriter=new nI(this.writer),this.isQuickTime=n instanceof n5;const r=this.writer instanceof YD?"in-memory":!1;this.fastStart=n._options.fastStart??r,this.isFragmented=this.fastStart==="fragmented",(this.fastStart==="in-memory"||this.isFragmented)&&(this.writer.ensureMonotonicity=!0),this.minimumFragmentDuration=n._options.minimumFragmentDuration??1}async start(){const e=await this.mutex.acquire(),n=this.output._tracks.some(r=>r.type==="video"&&r.source._codec==="avc");if(this.format._options.onFtyp&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(nre({isQuickTime:this.isQuickTime,holdsAvc:n,fragmented:this.isFragmented})),this.format._options.onFtyp){const{data:r,start:i}=this.writer.stopTrackingWrites();this.format._options.onFtyp(r,i)}if(this.ftypSize=this.writer.getPos(),this.fastStart!=="in-memory")if(this.fastStart==="reserve"){for(const r of this.output._tracks)if(r.metadata.maximumPacketCount===void 0)throw new Error("All tracks must specify maximumPacketCount in their metadata when using fastStart: 'reserve'.")}else this.isFragmented||(this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=Ng(!0),this.boxWriter.writeBox(this.mdat));await this.writer.flush(),e()}allTracksAreKnown(){for(const e of this.output._tracks)if(!e.source._closed&&!this.trackDatas.some(n=>n.track===e))return!1;return!0}async getMimeType(){await this.allTracksKnown.promise;const e=this.trackDatas.map(n=>n.type==="video"||n.type==="audio"?n.info.decoderConfig.codec:{webvtt:"wvtt"}[n.track.source._codec]);return CD({isQuickTime:this.isQuickTime,hasVideo:this.trackDatas.some(n=>n.type==="video"),hasAudio:this.trackDatas.some(n=>n.type==="audio"),codecStrings:e})}getVideoTrackData(e,n,r){const i=this.trackDatas.find(c=>c.track===e);if(i)return i;tte(r),W(r),W(r.decoderConfig);const s={...r.decoderConfig};W(s.codedWidth!==void 0),W(s.codedHeight!==void 0);let o=!1;if(e.source._codec==="avc"&&!s.description){const c=tT(n.data);if(!c)throw new Error("Couldn't extract an AVCDecoderConfigurationRecord from the AVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.264) when not providing a description, or provide a description (must be an AVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in AVCC format.");s.description=cte(c),o=!0}else if(e.source._codec==="hevc"&&!s.description){const c=rT(n.data);if(!c)throw new Error("Couldn't extract an HEVCDecoderConfigurationRecord from the HEVC packet. Make sure the packets are in Annex B format (as specified in ITU-T-REC-H.265) when not providing a description, or provide a description (must be an HEVCDecoderConfigurationRecord as specified in ISO 14496-15) and ensure the packets are in HEVC format.");s.description=bte(c),o=!0}const a=Uee(1/(e.metadata.frameRate??57600),1e6).denominator,l={muxer:this,track:e,type:"video",info:{width:s.codedWidth,height:s.codedHeight,decoderConfig:s,requiresAnnexBTransformation:o},timescale:a,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(l),this.trackDatas.sort((c,u)=>c.track.id-u.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),l}getAudioTrackData(e,n,r){const i=this.trackDatas.find(l=>l.track===e);if(i)return i;rte(r),W(r),W(r.decoderConfig);const s={...r.decoderConfig};let o=!1;if(e.source._codec==="aac"&&!s.description){const l=sd(fo.tempFromBytes(n.data));if(!l)throw new Error("Couldn't parse ADTS header from the AAC packet. Make sure the packets are in ADTS format (as specified in ISO 13818-7) when not providing a description, or provide a description (must be an AudioSpecificConfig as specified in ISO 14496-3) and ensure the packets are raw AAC data.");const c=id[l.samplingFrequencyIndex],u=Zm[l.channelConfiguration];if(c===void 0||u===void 0)throw new Error("Invalid ADTS frame header.");s.description=lD({objectType:l.objectType,sampleRate:c,numberOfChannels:u}),o=!0}const a={muxer:this,track:e,type:"audio",info:{numberOfChannels:r.decoderConfig.numberOfChannels,sampleRate:r.decoderConfig.sampleRate,decoderConfig:s,requiresPcmTransformation:!this.isFragmented&&Pi.includes(e.source._codec),requiresAdtsStripping:o},timescale:r.decoderConfig.sampleRate,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[]};return this.trackDatas.push(a),this.trackDatas.sort((l,c)=>l.track.id-c.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),a}getSubtitleTrackData(e,n){const r=this.trackDatas.find(s=>s.track===e);if(r)return r;ite(n),W(n),W(n.config);const i={muxer:this,track:e,type:"subtitle",info:{config:n.config},timescale:1e3,samples:[],sampleQueue:[],timestampProcessingQueue:[],timeToSampleTable:[],compositionTimeOffsetTable:[],lastTimescaleUnits:null,lastSample:null,finalizedChunks:[],currentChunk:null,compactlyCodedChunkTable:[],lastCueEndTimestamp:0,cueQueue:[],nextSourceId:0,cueToSourceId:new WeakMap};return this.trackDatas.push(i),this.trackDatas.sort((s,o)=>s.track.id-o.track.id),this.allTracksAreKnown()&&this.allTracksKnown.resolve(),i}async addEncodedVideoPacket(e,n,r){const i=await this.mutex.acquire();try{const s=this.getVideoTrackData(e,n,r);let o=n.data;if(s.info.requiresAnnexBTransformation){const c=[...Xm(o)].map(u=>o.subarray(u.offset,u.offset+u.length));if(c.length===0)throw new Error("Failed to transform packet data. Make sure all packets are provided in Annex B format, as specified in ITU-T-REC-H.264 and ITU-T-REC-H.265.");o=hD(c,4)}const a=this.validateAndNormalizeTimestamp(s.track,n.timestamp,n.type==="key"),l=this.createSampleForTrack(s,o,a,n.duration,n.type);await this.registerSample(s,l)}finally{i()}}async addEncodedAudioPacket(e,n,r){const i=await this.mutex.acquire();try{const s=this.getAudioTrackData(e,n,r);let o=n.data;if(s.info.requiresAdtsStripping){const c=sd(fo.tempFromBytes(o));if(!c)throw new Error("Expected ADTS frame, didn't get one.");const u=c.crcCheck===null?vy:$u;o=o.subarray(u)}const a=this.validateAndNormalizeTimestamp(s.track,n.timestamp,n.type==="key"),l=this.createSampleForTrack(s,o,a,n.duration,n.type);s.info.requiresPcmTransformation&&await this.maybePadWithSilence(s,a),await this.registerSample(s,l)}finally{i()}}async maybePadWithSilence(e,n){const r=Wn(e.samples),i=r?r.timestamp+r.duration:0,s=n-i,o=wr(s,e.timescale);if(o>0){const{sampleSize:a,silentValue:l}=eu(e.info.decoderConfig.codec),c=o*e.info.numberOfChannels,u=new Uint8Array(a*c).fill(l),d=this.createSampleForTrack(e,new Uint8Array(u.buffer),i,s,"key");await this.registerSample(e,d)}}async addSubtitleCue(e,n,r){const i=await this.mutex.acquire();try{const s=this.getSubtitleTrackData(e,r);this.validateAndNormalizeTimestamp(s.track,n.timestamp,!0),e.source._codec==="webvtt"&&(s.cueQueue.push(n),await this.processWebVTTCues(s,n.timestamp))}finally{i()}}async processWebVTTCues(e,n){for(;e.cueQueue.length>0;){const r=new Set([]);for(const c of e.cueQueue)W(c.timestamp<=n),W(e.lastCueEndTimestamp<=c.timestamp+c.duration),r.add(Math.max(c.timestamp,e.lastCueEndTimestamp)),r.add(c.timestamp+c.duration);const i=[...r].sort((c,u)=>c-u),s=i[0],o=i[1]??s;if(n<o)break;if(e.lastCueEndTimestamp<s){this.auxWriter.seek(0);const c=Xre();this.auxBoxWriter.writeBox(c);const u=this.auxWriter.getSlice(0,this.auxWriter.getPos()),d=this.createSampleForTrack(e,u,e.lastCueEndTimestamp,s-e.lastCueEndTimestamp,"key");await this.registerSample(e,d),e.lastCueEndTimestamp=s}this.auxWriter.seek(0);for(let c=0;c<e.cueQueue.length;c++){const u=e.cueQueue[c];if(u.timestamp>=o)break;tI.lastIndex=0;const d=tI.test(u.text),f=u.timestamp+u.duration;let h=e.cueToSourceId.get(u);if(h===void 0&&o<f&&(h=e.nextSourceId++,e.cueToSourceId.set(u,h)),u.notes){const m=Yre(u.notes);this.auxBoxWriter.writeBox(m)}const p=Qre(u.text,d?s:null,u.identifier??null,u.settings??null,h??null);this.auxBoxWriter.writeBox(p),f===o&&e.cueQueue.splice(c--,1)}const a=this.auxWriter.getSlice(0,this.auxWriter.getPos()),l=this.createSampleForTrack(e,a,s,o-s,"key");await this.registerSample(e,l),e.lastCueEndTimestamp=o}}createSampleForTrack(e,n,r,i,s){return{timestamp:r,decodeTimestamp:r,duration:i,data:n,size:n.byteLength,type:s,timescaleUnitsToNextSample:wr(i,e.timescale)}}processTimestamps(e,n){if(e.timestampProcessingQueue.length===0)return;if(e.type==="audio"&&e.info.requiresPcmTransformation){let i=0;for(let s=0;s<e.timestampProcessingQueue.length;s++){const o=e.timestampProcessingQueue[s],a=wr(o.duration,e.timescale);i+=a}if(e.timeToSampleTable.length===0)e.timeToSampleTable.push({sampleCount:i,sampleDelta:1});else{const s=Wn(e.timeToSampleTable);s.sampleCount+=i}e.timestampProcessingQueue.length=0;return}const r=e.timestampProcessingQueue.map(i=>i.timestamp).sort((i,s)=>i-s);for(let i=0;i<e.timestampProcessingQueue.length;i++){const s=e.timestampProcessingQueue[i];s.decodeTimestamp=r[i],!this.isFragmented&&e.lastTimescaleUnits===null&&(s.decodeTimestamp=0);const o=wr(s.timestamp-s.decodeTimestamp,e.timescale),a=wr(s.duration,e.timescale);if(e.lastTimescaleUnits!==null){W(e.lastSample);const l=wr(s.decodeTimestamp,e.timescale,!1),c=Math.round(l-e.lastTimescaleUnits);if(W(c>=0),e.lastTimescaleUnits+=c,e.lastSample.timescaleUnitsToNextSample=c,!this.isFragmented){let u=Wn(e.timeToSampleTable);if(W(u),u.sampleCount===1){u.sampleDelta=c;const f=e.timeToSampleTable[e.timeToSampleTable.length-2];f&&f.sampleDelta===c&&(f.sampleCount++,e.timeToSampleTable.pop(),u=f)}else u.sampleDelta!==c&&(u.sampleCount--,e.timeToSampleTable.push(u={sampleCount:1,sampleDelta:c}));u.sampleDelta===a?u.sampleCount++:e.timeToSampleTable.push({sampleCount:1,sampleDelta:a});const d=Wn(e.compositionTimeOffsetTable);W(d),d.sampleCompositionTimeOffset===o?d.sampleCount++:e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:o})}}else e.lastTimescaleUnits=wr(s.decodeTimestamp,e.timescale,!1),this.isFragmented||(e.timeToSampleTable.push({sampleCount:1,sampleDelta:a}),e.compositionTimeOffsetTable.push({sampleCount:1,sampleCompositionTimeOffset:o}));e.lastSample=s}if(e.timestampProcessingQueue.length=0,W(e.lastSample),W(e.lastTimescaleUnits!==null),n!==void 0&&e.lastSample.timescaleUnitsToNextSample===0){W(n.type==="key");const i=wr(n.timestamp,e.timescale,!1),s=Math.round(i-e.lastTimescaleUnits);e.lastSample.timescaleUnitsToNextSample=s}}async registerSample(e,n){n.type==="key"&&this.processTimestamps(e,n),e.timestampProcessingQueue.push(n),this.isFragmented?(e.sampleQueue.push(n),await this.interleaveSamples()):this.fastStart==="reserve"?await this.registerSampleFastStartReserve(e,n):await this.addSampleToTrack(e,n)}async addSampleToTrack(e,n){if(!this.isFragmented&&(e.samples.push(n),this.fastStart==="reserve")){const i=e.track.metadata.maximumPacketCount;if(W(i!==void 0),e.samples.length>i)throw new Error(`Track #${e.track.id} has already reached the maximum packet count (${i}). Either add less packets or increase the maximum packet count.`)}let r=!1;if(!e.currentChunk)r=!0;else{e.currentChunk.startTimestamp=Math.min(e.currentChunk.startTimestamp,n.timestamp);const i=n.timestamp-e.currentChunk.startTimestamp;if(this.isFragmented){const s=this.trackDatas.every(o=>{if(e===o)return n.type==="key";const a=o.sampleQueue[0];return a?a.type==="key":o.track.source._closed});i>=this.minimumFragmentDuration&&s&&n.timestamp>this.maxWrittenTimestamp&&(r=!0,await this.finalizeFragment())}else r=i>=.5}r&&(e.currentChunk&&await this.finalizeCurrentChunk(e),e.currentChunk={startTimestamp:n.timestamp,samples:[],offset:null,moofOffset:null}),W(e.currentChunk),e.currentChunk.samples.push(n),this.isFragmented&&(this.maxWrittenTimestamp=Math.max(this.maxWrittenTimestamp,n.timestamp))}async finalizeCurrentChunk(e){if(W(!this.isFragmented),!e.currentChunk)return;e.finalizedChunks.push(e.currentChunk),this.finalizedChunks.push(e.currentChunk);let n=e.currentChunk.samples.length;if(e.type==="audio"&&e.info.requiresPcmTransformation&&(n=e.currentChunk.samples.reduce((r,i)=>r+wr(i.duration,e.timescale),0)),(e.compactlyCodedChunkTable.length===0||Wn(e.compactlyCodedChunkTable).samplesPerChunk!==n)&&e.compactlyCodedChunkTable.push({firstChunk:e.finalizedChunks.length,samplesPerChunk:n}),this.fastStart==="in-memory"){e.currentChunk.offset=0;return}e.currentChunk.offset=this.writer.getPos();for(const r of e.currentChunk.samples)W(r.data),this.writer.write(r.data),r.data=null;await this.writer.flush()}async interleaveSamples(e=!1){if(W(this.isFragmented),!(!e&&!this.allTracksAreKnown()))e:for(;;){let n=null,r=1/0;for(const s of this.trackDatas){if(!e&&s.sampleQueue.length===0&&!s.track.source._closed)break e;s.sampleQueue.length>0&&s.sampleQueue[0].timestamp<r&&(n=s,r=s.sampleQueue[0].timestamp)}if(!n)break;const i=n.sampleQueue.shift();await this.addSampleToTrack(n,i)}}async finalizeFragment(e=!0){W(this.isFragmented);const n=this.nextFragmentNumber++;if(n===1){this.format._options.onMoov&&this.writer.startTrackingWrites();const h=Wh(this);if(this.boxWriter.writeBox(h),this.format._options.onMoov){const{data:p,start:m}=this.writer.stopTrackingWrites();this.format._options.onMoov(p,m)}}const r=this.trackDatas.filter(h=>h.currentChunk),i=iI(n,r),s=this.writer.getPos(),o=s+this.boxWriter.measureBox(i);let a=o+Ha,l=1/0;for(const h of r){h.currentChunk.offset=a,h.currentChunk.moofOffset=s;for(const p of h.currentChunk.samples)a+=p.size;l=Math.min(l,h.currentChunk.startTimestamp)}const c=a-o,u=c>=2**32;if(u)for(const h of r)h.currentChunk.offset+=_u-Ha;this.format._options.onMoof&&this.writer.startTrackingWrites();const d=iI(n,r);if(this.boxWriter.writeBox(d),this.format._options.onMoof){const{data:h,start:p}=this.writer.stopTrackingWrites();this.format._options.onMoof(h,p,l)}W(this.writer.getPos()===o),this.format._options.onMdat&&this.writer.startTrackingWrites();const f=Ng(u);f.size=c,this.boxWriter.writeBox(f),this.writer.seek(o+(u?_u:Ha));for(const h of r)for(const p of h.currentChunk.samples)this.writer.write(p.data),p.data=null;if(this.format._options.onMdat){const{data:h,start:p}=this.writer.stopTrackingWrites();this.format._options.onMdat(h,p)}for(const h of r)h.finalizedChunks.push(h.currentChunk),this.finalizedChunks.push(h.currentChunk),h.currentChunk=null;e&&await this.writer.flush()}async registerSampleFastStartReserve(e,n){if(this.allTracksAreKnown()){if(!this.mdat){const r=Wh(this),s=this.boxWriter.measureBox(r)+this.computeSampleTableSizeUpperBound()+4096;W(this.ftypSize!==null),this.writer.seek(this.ftypSize+s),this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat=Ng(!0),this.boxWriter.writeBox(this.mdat);for(const o of this.trackDatas){for(const a of o.sampleQueue)await this.addSampleToTrack(o,a);o.sampleQueue.length=0}}await this.addSampleToTrack(e,n)}else e.sampleQueue.push(n)}computeSampleTableSizeUpperBound(){W(this.fastStart==="reserve");let e=0;for(const n of this.trackDatas){const r=n.track.metadata.maximumPacketCount;W(r!==void 0),e+=8*Math.ceil(2/3*r),e+=4*r,e+=8*Math.ceil(2/3*r),e+=12*Math.ceil(2/3*r),e+=4*r,e+=8*r}return e}async onTrackClose(e){const n=await this.mutex.acquire();if(e.type==="subtitle"&&e.source._codec==="webvtt"){const r=this.trackDatas.find(i=>i.track===e);r&&await this.processWebVTTCues(r,1/0)}this.allTracksAreKnown()&&this.allTracksKnown.resolve(),this.isFragmented&&await this.interleaveSamples(),n()}async finalize(){const e=await this.mutex.acquire();this.allTracksKnown.resolve();for(const n of this.trackDatas)n.type==="subtitle"&&n.track.source._codec==="webvtt"&&await this.processWebVTTCues(n,1/0);if(this.isFragmented){await this.interleaveSamples(!0);for(const n of this.trackDatas)this.processTimestamps(n);await this.finalizeFragment(!1)}else for(const n of this.trackDatas)this.processTimestamps(n),await this.finalizeCurrentChunk(n);if(this.fastStart==="in-memory"){this.mdat=Ng(!1);let n;for(let i=0;i<2;i++){const s=Wh(this),o=this.boxWriter.measureBox(s);n=this.boxWriter.measureBox(this.mdat);let a=this.writer.getPos()+o+n;for(const l of this.finalizedChunks){l.offset=a;for(const{data:c}of l.samples)W(c),a+=c.byteLength,n+=c.byteLength}if(a<2**32)break;n>=2**32&&(this.mdat.largeSize=!0)}this.format._options.onMoov&&this.writer.startTrackingWrites();const r=Wh(this);if(this.boxWriter.writeBox(r),this.format._options.onMoov){const{data:i,start:s}=this.writer.stopTrackingWrites();this.format._options.onMoov(i,s)}this.format._options.onMdat&&this.writer.startTrackingWrites(),this.mdat.size=n,this.boxWriter.writeBox(this.mdat);for(const i of this.finalizedChunks)for(const s of i.samples)W(s.data),this.writer.write(s.data),s.data=null;if(this.format._options.onMdat){const{data:i,start:s}=this.writer.stopTrackingWrites();this.format._options.onMdat(i,s)}}else if(this.isFragmented){const n=this.writer.getPos(),r=Kre(this.trackDatas);this.boxWriter.writeBox(r);const i=this.writer.getPos()-n;this.writer.seek(this.writer.getPos()-4),this.boxWriter.writeU32(i)}else{W(this.mdat);const n=this.boxWriter.offsets.get(this.mdat);W(n!==void 0);const r=this.writer.getPos()-n;if(this.mdat.size=r,this.mdat.largeSize=r>=2**32,this.boxWriter.patchBox(this.mdat),this.format._options.onMdat){const{data:s,start:o}=this.writer.stopTrackingWrites();this.format._options.onMdat(s,o)}const i=Wh(this);if(this.fastStart==="reserve"){W(this.ftypSize!==null),this.writer.seek(this.ftypSize),this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(i);const s=this.boxWriter.offsets.get(this.mdat)-this.writer.getPos();this.boxWriter.writeBox(rre(s))}else this.format._options.onMoov&&this.writer.startTrackingWrites(),this.boxWriter.writeBox(i);if(this.format._options.onMoov){const{data:s,start:o}=this.writer.stopTrackingWrites();this.format._options.onMoov(s,o)}}e()}}class e5{getSupportedVideoCodecs(){return this.getSupportedCodecs().filter(e=>ea.includes(e))}getSupportedAudioCodecs(){return this.getSupportedCodecs().filter(e=>ta.includes(e))}getSupportedSubtitleCodecs(){return this.getSupportedCodecs().filter(e=>my.includes(e))}_codecUnsupportedHint(e){return""}}class t5 extends e5{constructor(e={}){if(!e||typeof e!="object")throw new TypeError("options must be an object.");if(e.fastStart!==void 0&&![!1,"in-memory","reserve","fragmented"].includes(e.fastStart))throw new TypeError("options.fastStart, when provided, must be false, 'in-memory', 'reserve', or 'fragmented'.");if(e.minimumFragmentDuration!==void 0&&(!Number.isFinite(e.minimumFragmentDuration)||e.minimumFragmentDuration<0))throw new TypeError("options.minimumFragmentDuration, when provided, must be a non-negative number.");if(e.onFtyp!==void 0&&typeof e.onFtyp!="function")throw new TypeError("options.onFtyp, when provided, must be a function.");if(e.onMoov!==void 0&&typeof e.onMoov!="function")throw new TypeError("options.onMoov, when provided, must be a function.");if(e.onMdat!==void 0&&typeof e.onMdat!="function")throw new TypeError("options.onMdat, when provided, must be a function.");if(e.onMoof!==void 0&&typeof e.onMoof!="function")throw new TypeError("options.onMoof, when provided, must be a function.");if(e.metadataFormat!==void 0&&!["mdir","mdta","udta","auto"].includes(e.metadataFormat))throw new TypeError("options.metadataFormat, when provided, must be either 'auto', 'mdir', 'mdta', or 'udta'.");super(),this._options=e}getSupportedTrackCounts(){return{video:{min:0,max:4294967295},audio:{min:0,max:4294967295},subtitle:{min:0,max:4294967295},total:{min:1,max:4294967295}}}get supportsVideoRotationMetadata(){return!0}_createMuxer(e){return new fie(e,this)}}class pT extends t5{constructor(e){super(e)}get _name(){return"MP4"}get fileExtension(){return".mp4"}get mimeType(){return"video/mp4"}getSupportedCodecs(){return[...ea,...kp,"pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be",...my]}_codecUnsupportedHint(e){return new n5().getSupportedCodecs().includes(e)?" Switching to MOV will grant support for this codec.":""}}class n5 extends t5{constructor(e){super(e)}get _name(){return"MOV"}get fileExtension(){return".mov"}get mimeType(){return"video/quicktime"}getSupportedCodecs(){return[...ea,...ta]}_codecUnsupportedHint(e){return new pT().getSupportedCodecs().includes(e)?" Switching to MP4 will grant support for this codec.":""}}const hie=t=>{if(!t||typeof t!="object")throw new TypeError("Encoding config must be an object.");if(!ea.includes(t.codec))throw new TypeError(`Invalid video codec '${t.codec}'. Must be one of: ${ea.join(", ")}.`);if(!(t.bitrate instanceof po)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("config.bitrate must be a positive integer or a quality.");if(t.keyFrameInterval!==void 0&&(!Number.isFinite(t.keyFrameInterval)||t.keyFrameInterval<0))throw new TypeError("config.keyFrameInterval, when provided, must be a non-negative number.");if(t.sizeChangeBehavior!==void 0&&!["deny","passThrough","fill","contain","cover"].includes(t.sizeChangeBehavior))throw new TypeError("config.sizeChangeBehavior, when provided, must be 'deny', 'passThrough', 'fill', 'contain' or 'cover'.");if(t.onEncodedPacket!==void 0&&typeof t.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(t.onEncoderConfig!==void 0&&typeof t.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");r5(t.codec,t)},r5=(t,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.alpha!==void 0&&!["discard","keep"].includes(e.alpha))throw new TypeError("options.alpha, when provided, must be 'discard' or 'keep'.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.latencyMode!==void 0&&!["quality","realtime"].includes(e.latencyMode))throw new TypeError("latencyMode, when provided, must be 'quality' or 'realtime'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&uD(e.fullCodecString)!==t)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${t}).`);if(e.hardwareAcceleration!==void 0&&!["no-preference","prefer-hardware","prefer-software"].includes(e.hardwareAcceleration))throw new TypeError("hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.");if(e.scalabilityMode!==void 0&&typeof e.scalabilityMode!="string")throw new TypeError("scalabilityMode, when provided, must be a string.");if(e.contentHint!==void 0&&typeof e.contentHint!="string")throw new TypeError("contentHint, when provided, must be a string.")},Jx=t=>{const e=t.bitrate instanceof po?t.bitrate._toVideoBitrate(t.codec,t.width,t.height):t.bitrate;return{codec:t.fullCodecString??jee(t.codec,t.width,t.height,e),width:t.width,height:t.height,bitrate:e,bitrateMode:t.bitrateMode,alpha:t.alpha??"discard",framerate:t.framerate,latencyMode:t.latencyMode,hardwareAcceleration:t.hardwareAcceleration,scalabilityMode:t.scalabilityMode,contentHint:t.contentHint,...Gee(t.codec)}},pie=t=>{if(!t||typeof t!="object")throw new TypeError("Encoding config must be an object.");if(!ta.includes(t.codec))throw new TypeError(`Invalid audio codec '${t.codec}'. Must be one of: ${ta.join(", ")}.`);if(t.bitrate===void 0&&(!Pi.includes(t.codec)||t.codec==="flac"))throw new TypeError("config.bitrate must be provided for compressed audio codecs.");if(t.bitrate!==void 0&&!(t.bitrate instanceof po)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("config.bitrate, when provided, must be a positive integer or a quality.");if(t.onEncodedPacket!==void 0&&typeof t.onEncodedPacket!="function")throw new TypeError("config.onEncodedChunk, when provided, must be a function.");if(t.onEncoderConfig!==void 0&&typeof t.onEncoderConfig!="function")throw new TypeError("config.onEncoderConfig, when provided, must be a function.");i5(t.codec,t)},i5=(t,e)=>{if(!e||typeof e!="object")throw new TypeError("Encoding options must be an object.");if(e.bitrateMode!==void 0&&!["constant","variable"].includes(e.bitrateMode))throw new TypeError("bitrateMode, when provided, must be 'constant' or 'variable'.");if(e.fullCodecString!==void 0&&typeof e.fullCodecString!="string")throw new TypeError("fullCodecString, when provided, must be a string.");if(e.fullCodecString!==void 0&&uD(e.fullCodecString)!==t)throw new TypeError(`fullCodecString, when provided, must be a string that matches the specified codec (${t}).`)},eS=t=>{const e=t.bitrate instanceof po?t.bitrate._toAudioBitrate(t.codec):t.bitrate;return{codec:t.fullCodecString??Kee(t.codec,t.numberOfChannels,t.sampleRate),numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate,bitrate:e,bitrateMode:t.bitrateMode,...Zee(t.codec)}};class po{constructor(e){this._factor=e}_toVideoBitrate(e,n,r){const i=n*r,s={avc:1,hevc:.6,vp9:.6,av1:.4,vp8:1.2},o=1920*1080,a=3e6,l=Math.pow(i/o,.95),d=a*l*s[e]*this._factor;return Math.ceil(d/1e3)*1e3}_toAudioBitrate(e){if(Pi.includes(e)||e==="flac")return;const r={aac:128e3,opus:64e3,mp3:16e4,vorbis:64e3}[e];if(!r)throw new Error(`Unhandled codec: ${e}`);let i=r*this._factor;return e==="aac"?i=[96e3,128e3,16e4,192e3].reduce((o,a)=>Math.abs(a-i)<Math.abs(o-i)?a:o):e==="opus"||e==="vorbis"?i=Math.max(6e3,i):e==="mp3"&&(i=[8e3,16e3,24e3,32e3,4e4,48e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4].reduce((o,a)=>Math.abs(a-i)<Math.abs(o-i)?a:o)),Math.round(i/1e3)*1e3}}const oI=new po(.3),aI=new po(1),Sy=new po(2),mie=async(t,e={})=>{const{width:n=1280,height:r=720,bitrate:i=1e6,...s}=e;if(!ea.includes(t))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("width must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("height must be a positive integer.");if(!(i instanceof po)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer or a quality.");r5(t,s);let o=null;return Hx.length>0&&(o??=Jx({codec:t,width:n,height:r,bitrate:i,framerate:void 0,...s}),Hx.some(c=>c.supports(t,o)))?!0:typeof VideoEncoder>"u"||(n%2===1||r%2===1)&&(t==="avc"||t==="hevc")||(o??=Jx({codec:t,width:n,height:r,bitrate:i,framerate:void 0,...s,alpha:"discard"}),!(await VideoEncoder.isConfigSupported(o)).supported)?!1:qf()?new Promise(async c=>{try{const u=new VideoEncoder({output:()=>{},error:()=>c(!1)});u.configure(o);const d=new Uint8Array(n*r*4),f=new VideoFrame(d,{format:"RGBA",codedWidth:n,codedHeight:r,timestamp:0});u.encode(f),f.close(),await u.flush(),c(!0)}catch{c(!1)}}):!0},gie=async(t,e={})=>{const{numberOfChannels:n=2,sampleRate:r=48e3,bitrate:i=128e3,...s}=e;if(!ta.includes(t))return!1;if(!Number.isInteger(n)||n<=0)throw new TypeError("numberOfChannels must be a positive integer.");if(!Number.isInteger(r)||r<=0)throw new TypeError("sampleRate must be a positive integer.");if(!(i instanceof po)&&(!Number.isInteger(i)||i<=0))throw new TypeError("bitrate must be a positive integer.");i5(t,s);let o=null;return Vx.length>0&&(o??=eS({codec:t,numberOfChannels:n,sampleRate:r,bitrate:i,...s}),Vx.some(l=>l.supports(t,o)))||Pi.includes(t)?!0:typeof AudioEncoder>"u"?!1:(o??=eS({codec:t,numberOfChannels:n,sampleRate:r,bitrate:i,...s}),(await AudioEncoder.isConfigSupported(o)).supported===!0)},tS=async(t=ta,e)=>{const n=await Promise.all(t.map(r=>gie(r,e)));return t.filter((r,i)=>n[i])},yie=async(t,e)=>{for(const n of t)if(await mie(n,e))return n;return null};class mT{constructor(){this._connectedTrack=null,this._closingPromise=null,this._closed=!1,this._timestampOffset=0}_ensureValidAdd(){if(!this._connectedTrack)throw new Error("Source is not connected to an output track.");if(this._connectedTrack.output.state==="canceled")throw new Error("Output has been canceled.");if(this._connectedTrack.output.state==="finalizing"||this._connectedTrack.output.state==="finalized")throw new Error("Output has been finalized.");if(this._connectedTrack.output.state==="pending")throw new Error("Output has not started.");if(this._closed)throw new Error("Source is closed.")}async _start(){}async _flushAndClose(e){}close(){if(this._closingPromise)return;const e=this._connectedTrack;if(!e)throw new Error("Cannot call close without connecting the source to an output track.");if(e.output.state==="pending")throw new Error("Cannot call close before output has been started.");this._closingPromise=(async()=>{await this._flushAndClose(!1),this._closed=!0,!(e.output.state==="finalizing"||e.output.state==="finalized")&&e.output._muxer.onTrackClose(e)})()}async _flushOrWaitForOngoingClose(e){return this._closingPromise??=(async()=>{await this._flushAndClose(e),this._closed=!0})()}}class gT extends mT{constructor(e){if(super(),this._connectedTrack=null,!ea.includes(e))throw new TypeError(`Invalid video codec '${e}'. Must be one of: ${ea.join(", ")}.`);this._codec=e}}class bie extends gT{constructor(e){super(e)}add(e,n){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedVideoPacket(this._connectedTrack,e,n)}}class wie{constructor(e,n){this.source=e,this.encodingConfig=n,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastMultipleOfKeyFrameInterval=-1,this.codedWidth=null,this.codedHeight=null,this.resizeCanvas=null,this.customEncoder=null,this.customEncoderCallSerializer=new hw,this.customEncoderQueueSize=0,this.alphaEncoder=null,this.splitter=null,this.splitterCreationFailed=!1,this.alphaFrameQueue=[],this.error=null,this.errorNeedsNewStack=!0}async add(e,n,r){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.codedWidth!==null&&this.codedHeight!==null){if(e.codedWidth!==this.codedWidth||e.codedHeight!==this.codedHeight){const a=this.encodingConfig.sizeChangeBehavior??"deny";if(a!=="passThrough"){if(a==="deny")throw new Error(`Video sample size must remain constant. Expected ${this.codedWidth}x${this.codedHeight}, got ${e.codedWidth}x${e.codedHeight}. To allow the sample size to change over time, set \`sizeChangeBehavior\` to a value other than 'strict' in the encoding options.`);{let l=!1;this.resizeCanvas||(typeof document<"u"?(this.resizeCanvas=document.createElement("canvas"),this.resizeCanvas.width=this.codedWidth,this.resizeCanvas.height=this.codedHeight):this.resizeCanvas=new OffscreenCanvas(this.codedWidth,this.codedHeight),l=!0);const c=this.resizeCanvas.getContext("2d",{alpha:qf()});W(c),l||(qf()?(c.fillStyle="black",c.fillRect(0,0,this.codedWidth,this.codedHeight)):c.clearRect(0,0,this.codedWidth,this.codedHeight)),e.drawWithFit(c,{fit:a}),n&&e.close(),e=new _i(this.resizeCanvas,{timestamp:e.timestamp,duration:e.duration,rotation:e.rotation}),n=!0}}}}else this.codedWidth=e.codedWidth,this.codedHeight=e.codedHeight;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),W(this.encoderInitialized);const i=this.encodingConfig.keyFrameInterval??5,s=Math.floor(e.timestamp/i),o={...r,keyFrame:r?.keyFrame||i===0||s!==this.lastMultipleOfKeyFrameInterval};if(this.lastMultipleOfKeyFrameInterval=s,this.customEncoder){this.customEncoderQueueSize++;const a=e.clone(),l=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(a,o)).then(()=>this.customEncoderQueueSize--).catch(c=>this.error??=c).finally(()=>{a.close()});this.customEncoderQueueSize>=4&&await l}else{W(this.encoder);const a=e.toVideoFrame();if(!this.alphaEncoder)this.encoder.encode(a,o),a.close();else if(!!a.format&&!a.format.includes("A")||this.splitterCreationFailed)this.alphaFrameQueue.push(null),this.encoder.encode(a,o),a.close();else{const c=a.displayWidth,u=a.displayHeight;if(!this.splitter)try{this.splitter=new vie(c,u)}catch(d){console.error("Due to an error, only color data will be encoded.",d),this.splitterCreationFailed=!0,this.alphaFrameQueue.push(null),this.encoder.encode(a,o),a.close()}if(this.splitter){const d=this.splitter.extractColor(a),f=this.splitter.extractAlpha(a);this.alphaFrameQueue.push(f),this.encoder.encode(d,o),d.close(),a.close()}}n&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(l=>this.encoder.addEventListener("dequeue",l,{once:!0}))}await this.muxer.mutex.currentPromise}finally{n&&e.close()}}ensureEncoder(e){const n=new Error;this.ensureEncoderPromise=(async()=>{const r=Jx({width:e.codedWidth,height:e.codedHeight,...this.encodingConfig,framerate:this.source._connectedTrack?.metadata.frameRate});this.encodingConfig.onEncoderConfig?.(r);const i=Hx.find(s=>s.supports(this.encodingConfig.codec,r));if(i)this.customEncoder=new i,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=r,this.customEncoder.onPacket=(s,o)=>{if(!(s instanceof Mn))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(o!==void 0&&(!o||typeof o!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(s,o),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,s,o).catch(a=>{this.error??=a,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else{if(typeof VideoEncoder>"u")throw new Error("VideoEncoder is not supported by this browser.");if(r.alpha="discard",this.encodingConfig.alpha==="keep"&&(r.latencyMode="quality"),(r.width%2===1||r.height%2===1)&&(this.encodingConfig.codec==="avc"||this.encodingConfig.codec==="hevc"))throw new Error(`The dimensions ${r.width}x${r.height} are not supported for codec '${this.encodingConfig.codec}'; both width and height must be even numbers. Make sure to round your dimensions to the nearest even number.`);if(!(await VideoEncoder.isConfigSupported(r)).supported)throw new Error(`This specific encoder configuration (${r.codec}, ${r.bitrate} bps, ${r.width}x${r.height}, hardware acceleration: ${r.hardwareAcceleration??"no-preference"}) is not supported by this browser. Consider using another codec or changing your video parameters.`);const a=[],l=[];let c=0,u=0;const d=(f,h,p)=>{const m={};if(h){const y=new Uint8Array(h.byteLength);h.copyTo(y),m.alpha=y}const g=Mn.fromEncodedChunk(f,m);this.encodingConfig.onEncodedPacket?.(g,p),this.muxer.addEncodedVideoPacket(this.source._connectedTrack,g,p).catch(y=>{this.error??=y,this.errorNeedsNewStack=!1})};this.encoder=new VideoEncoder({output:(f,h)=>{if(!this.alphaEncoder){d(f,null,h);return}const p=this.alphaFrameQueue.shift();W(p!==void 0),p?(this.alphaEncoder.encode(p,{keyFrame:f.type==="key"}),u++,p.close(),a.push({chunk:f,meta:h})):u===0?d(f,null,h):(l.push(c+u),a.push({chunk:f,meta:h}))},error:f=>{f.stack=n.stack,this.error??=f}}),this.encoder.configure(r),this.encodingConfig.alpha==="keep"&&(this.alphaEncoder=new VideoEncoder({output:(f,h)=>{u--;const p=a.shift();for(W(p!==void 0),d(p.chunk,f,p.meta),c++;l.length>0&&l[0]===c;){l.shift();const m=a.shift();W(m!==void 0),d(m.chunk,null,m.meta)}},error:f=>{f.stack=n.stack,this.error??=f}}),this.alphaEncoder.configure(r))}W(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||(await this.encoder.flush(),await this.alphaEncoder?.flush()),this.encoder.state!=="closed"&&this.encoder.close(),this.alphaEncoder&&this.alphaEncoder.state!=="closed"&&this.alphaEncoder.close(),this.alphaFrameQueue.forEach(n=>n?.close()),this.splitter?.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class vie{constructor(e,n){this.lastFrame=null,typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(e,n):(this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=n);const r=this.canvas.getContext("webgl2",{alpha:!0});if(!r)throw new Error("Couldn't acquire WebGL 2 context.");this.gl=r,this.colorProgram=this.createColorProgram(),this.alphaProgram=this.createAlphaProgram(),this.vao=this.createVAO(),this.sourceTexture=this.createTexture(),this.alphaResolutionLocation=this.gl.getUniformLocation(this.alphaProgram,"u_resolution"),this.gl.useProgram(this.colorProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.colorProgram,"u_sourceTexture"),0),this.gl.useProgram(this.alphaProgram),this.gl.uniform1i(this.gl.getUniformLocation(this.alphaProgram,"u_sourceTexture"),0)}createVertexShader(){return this.createShader(this.gl.VERTEX_SHADER,`#version 300 es
			in vec2 a_position;
			in vec2 a_texCoord;
			out vec2 v_texCoord;
			
			void main() {
				gl_Position = vec4(a_position, 0.0, 1.0);
				v_texCoord = a_texCoord;
			}
		`)}createColorProgram(){const e=this.createVertexShader(),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			in vec2 v_texCoord;
			out vec4 fragColor;
			
			void main() {
				vec4 source = texture(u_sourceTexture, v_texCoord);
				fragColor = vec4(source.rgb, 1.0);
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createAlphaProgram(){const e=this.createVertexShader(),n=this.createShader(this.gl.FRAGMENT_SHADER,`#version 300 es
			precision highp float;
			
			uniform sampler2D u_sourceTexture;
			uniform vec2 u_resolution; // The width and height of the canvas
			in vec2 v_texCoord;
			out vec4 fragColor;

			// This function determines the value for a single byte in the YUV stream
			float getByteValue(float byteOffset) {
				float width = u_resolution.x;
				float height = u_resolution.y;

				float yPlaneSize = width * height;

				if (byteOffset < yPlaneSize) {
					// This byte is in the luma plane. Find the corresponding pixel coordinates to sample from
					float y = floor(byteOffset / width);
					float x = mod(byteOffset, width);
					
					// Add 0.5 to sample the center of the texel
					vec2 sampleCoord = (vec2(x, y) + 0.5) / u_resolution;
					
					// The luma value is the alpha from the source texture
					return texture(u_sourceTexture, sampleCoord).a;
				} else {
					// Write a fixed value for chroma and beyond
					return 128.0 / 255.0;
				}
			}
			
			void main() {
				// Each fragment writes 4 bytes (R, G, B, A)
				float pixelIndex = floor(gl_FragCoord.y) * u_resolution.x + floor(gl_FragCoord.x);
				float baseByteOffset = pixelIndex * 4.0;

				vec4 result;
				for (int i = 0; i < 4; i++) {
					float currentByteOffset = baseByteOffset + float(i);
					result[i] = getByteValue(currentByteOffset);
				}
				
				fragColor = result;
			}
		`),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.linkProgram(r),r}createShader(e,n){const r=this.gl.createShader(e);return this.gl.shaderSource(r,n),this.gl.compileShader(r),this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)||console.error("Shader compile error:",this.gl.getShaderInfoLog(r)),r}createVAO(){const e=this.gl.createVertexArray();this.gl.bindVertexArray(e);const n=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);const i=this.gl.getAttribLocation(this.colorProgram,"a_position"),s=this.gl.getAttribLocation(this.colorProgram,"a_texCoord");return this.gl.enableVertexAttribArray(i),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,2,this.gl.FLOAT,!1,16,8),e}createTexture(){const e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}updateTexture(e){this.lastFrame!==e&&((e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sourceTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.lastFrame=e)}extractColor(e){return this.updateTexture(e),this.gl.useProgram(this.colorProgram),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),new VideoFrame(this.canvas,{timestamp:e.timestamp,duration:e.duration??void 0,alpha:"discard"})}extractAlpha(e){this.updateTexture(e),this.gl.useProgram(this.alphaProgram),this.gl.uniform2f(this.alphaResolutionLocation,this.canvas.width,this.canvas.height),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const{width:n,height:r}=this.canvas,i=Math.ceil(n/2)*Math.ceil(r/2),s=n*r+i*2,o=Math.ceil(s/(n*4));let a=new Uint8Array(4*n*o);this.gl.readPixels(0,0,n,o,this.gl.RGBA,this.gl.UNSIGNED_BYTE,a),a=a.subarray(0,s),W(a[n*r]===128),W(a[a.length-1]===128);const l={format:"I420",codedWidth:n,codedHeight:r,timestamp:e.timestamp,duration:e.duration??void 0,transfer:[a.buffer]};return new VideoFrame(a,l)}close(){this.gl.getExtension("WEBGL_lose_context")?.loseContext(),this.gl=null}}class lI extends gT{constructor(e){hie(e),super(e.codec),this._encoder=new wie(this,e)}add(e,n){if(!(e instanceof _i))throw new TypeError("videoSample must be a VideoSample.");return this._encoder.add(e,!1,n)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class yT extends mT{constructor(e){if(super(),this._connectedTrack=null,!ta.includes(e))throw new TypeError(`Invalid audio codec '${e}'. Must be one of: ${ta.join(", ")}.`);this._codec=e}}class xie extends yT{constructor(e){super(e)}add(e,n){if(!(e instanceof Mn))throw new TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw new TypeError("Metadata-only packets cannot be added.");if(n!==void 0&&(!n||typeof n!="object"))throw new TypeError("meta, when provided, must be an object.");return this._ensureValidAdd(),this._connectedTrack.output._muxer.addEncodedAudioPacket(this._connectedTrack,e,n)}}class Sie{constructor(e,n){this.source=e,this.encodingConfig=n,this.ensureEncoderPromise=null,this.encoderInitialized=!1,this.encoder=null,this.muxer=null,this.lastNumberOfChannels=null,this.lastSampleRate=null,this.isPcmEncoder=!1,this.outputSampleSize=null,this.writeOutputValue=null,this.customEncoder=null,this.customEncoderCallSerializer=new hw,this.customEncoderQueueSize=0,this.lastEndSampleIndex=null,this.error=null,this.errorNeedsNewStack=!0}async add(e,n){try{if(this.checkForEncoderError(),this.source._ensureValidAdd(),this.lastNumberOfChannels!==null&&this.lastSampleRate!==null){if(e.numberOfChannels!==this.lastNumberOfChannels||e.sampleRate!==this.lastSampleRate)throw new Error(`Audio parameters must remain constant. Expected ${this.lastNumberOfChannels} channels at ${this.lastSampleRate} Hz, got ${e.numberOfChannels} channels at ${e.sampleRate} Hz.`)}else this.lastNumberOfChannels=e.numberOfChannels,this.lastSampleRate=e.sampleRate;this.encoderInitialized||(this.ensureEncoderPromise||this.ensureEncoder(e),this.encoderInitialized||await this.ensureEncoderPromise),W(this.encoderInitialized);{const r=Math.round(e.timestamp*e.sampleRate),i=Math.round((e.timestamp+e.duration)*e.sampleRate);if(this.lastEndSampleIndex===null)this.lastEndSampleIndex=i;else{const s=r-this.lastEndSampleIndex;if(s>=64){const o=new Bs({data:new Float32Array(s*e.numberOfChannels),format:"f32-planar",sampleRate:e.sampleRate,numberOfChannels:e.numberOfChannels,numberOfFrames:s,timestamp:this.lastEndSampleIndex/e.sampleRate});await this.add(o,!0)}this.lastEndSampleIndex+=e.numberOfFrames}}if(this.customEncoder){this.customEncoderQueueSize++;const r=e.clone(),i=this.customEncoderCallSerializer.call(()=>this.customEncoder.encode(r)).then(()=>this.customEncoderQueueSize--).catch(s=>this.error??=s).finally(()=>{r.close()});this.customEncoderQueueSize>=4&&await i,await this.muxer.mutex.currentPromise}else if(this.isPcmEncoder)await this.doPcmEncoding(e,n);else{W(this.encoder);const r=e.toAudioData();this.encoder.encode(r),r.close(),n&&e.close(),this.encoder.encodeQueueSize>=4&&await new Promise(i=>this.encoder.addEventListener("dequeue",i,{once:!0})),await this.muxer.mutex.currentPromise}}finally{n&&e.close()}}async doPcmEncoding(e,n){W(this.outputSampleSize),W(this.writeOutputValue);const{numberOfChannels:r,numberOfFrames:i,sampleRate:s,timestamp:o}=e,a=2048,l=[];for(let f=0;f<i;f+=a){const h=Math.min(a,e.numberOfFrames-f),p=h*r*this.outputSampleSize,m=new ArrayBuffer(p),g=new DataView(m);l.push({frameCount:h,view:g})}const c=e.allocationSize({planeIndex:0,format:"f32-planar"}),u=new Float32Array(c/Float32Array.BYTES_PER_ELEMENT);for(let f=0;f<r;f++){e.copyTo(u,{planeIndex:f,format:"f32-planar"});for(let h=0;h<l.length;h++){const{frameCount:p,view:m}=l[h];for(let g=0;g<p;g++)this.writeOutputValue(m,(g*r+f)*this.outputSampleSize,u[h*a+g])}}n&&e.close();const d={decoderConfig:{codec:this.encodingConfig.codec,numberOfChannels:r,sampleRate:s}};for(let f=0;f<l.length;f++){const{frameCount:h,view:p}=l[f],m=p.buffer,g=f*a,y=new Mn(new Uint8Array(m),"key",o+g/s,h/s);this.encodingConfig.onEncodedPacket?.(y,d),await this.muxer.addEncodedAudioPacket(this.source._connectedTrack,y,d)}}ensureEncoder(e){const n=new Error;this.ensureEncoderPromise=(async()=>{const{numberOfChannels:r,sampleRate:i}=e,s=eS({numberOfChannels:r,sampleRate:i,...this.encodingConfig});this.encodingConfig.onEncoderConfig?.(s);const o=Vx.find(a=>a.supports(this.encodingConfig.codec,s));if(o)this.customEncoder=new o,this.customEncoder.codec=this.encodingConfig.codec,this.customEncoder.config=s,this.customEncoder.onPacket=(a,l)=>{if(!(a instanceof Mn))throw new TypeError("The first argument passed to onPacket must be an EncodedPacket.");if(l!==void 0&&(!l||typeof l!="object"))throw new TypeError("The second argument passed to onPacket must be an object or undefined.");this.encodingConfig.onEncodedPacket?.(a,l),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,a,l).catch(c=>{this.error??=c,this.errorNeedsNewStack=!1})},await this.customEncoder.init();else if(Pi.includes(this.encodingConfig.codec))this.initPcmEncoder();else{if(typeof AudioEncoder>"u")throw new Error("AudioEncoder is not supported by this browser.");if(!(await AudioEncoder.isConfigSupported(s)).supported)throw new Error(`This specific encoder configuration (${s.codec}, ${s.bitrate} bps, ${s.numberOfChannels} channels, ${s.sampleRate} Hz) is not supported by this browser. Consider using another codec or changing your audio parameters.`);this.encoder=new AudioEncoder({output:(l,c)=>{if(this.encodingConfig.codec==="aac"&&c?.decoderConfig){let d=!1;if(!c.decoderConfig.description||c.decoderConfig.description.byteLength<2?d=!0:d=eT(hs(c.decoderConfig.description)).objectType===0,d){const f=Number(Wn(s.codec.split(".")));c.decoderConfig.description=lD({objectType:f,numberOfChannels:c.decoderConfig.numberOfChannels,sampleRate:c.decoderConfig.sampleRate})}}const u=Mn.fromEncodedChunk(l);this.encodingConfig.onEncodedPacket?.(u,c),this.muxer.addEncodedAudioPacket(this.source._connectedTrack,u,c).catch(d=>{this.error??=d,this.errorNeedsNewStack=!1})},error:l=>{l.stack=n.stack,this.error??=l}}),this.encoder.configure(s)}W(this.source._connectedTrack),this.muxer=this.source._connectedTrack.output._muxer,this.encoderInitialized=!0})()}initPcmEncoder(){this.isPcmEncoder=!0;const e=this.encodingConfig.codec,{dataType:n,sampleSize:r,littleEndian:i}=eu(e);switch(this.outputSampleSize=r,r){case 1:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint8(o,zr((a+1)*127.5,0,255)):n==="signed"?this.writeOutputValue=(s,o,a)=>{s.setInt8(o,zr(Math.round(a*128),-128,127))}:n==="ulaw"?this.writeOutputValue=(s,o,a)=>{const l=zr(Math.floor(a*32767),-32768,32767);s.setUint8(o,Ste(l))}:n==="alaw"?this.writeOutputValue=(s,o,a)=>{const l=zr(Math.floor(a*32767),-32768,32767);s.setUint8(o,Ete(l))}:W(!1);break;case 2:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint16(o,zr((a+1)*32767.5,0,65535),i):n==="signed"?this.writeOutputValue=(s,o,a)=>s.setInt16(o,zr(Math.round(a*32767),-32768,32767),i):W(!1);break;case 3:n==="unsigned"?this.writeOutputValue=(s,o,a)=>QE(s,o,zr((a+1)*83886075e-1,0,16777215),i):n==="signed"?this.writeOutputValue=(s,o,a)=>Fee(s,o,zr(Math.round(a*8388607),-8388608,8388607),i):W(!1);break;case 4:n==="unsigned"?this.writeOutputValue=(s,o,a)=>s.setUint32(o,zr((a+1)*21474836475e-1,0,4294967295),i):n==="signed"?this.writeOutputValue=(s,o,a)=>s.setInt32(o,zr(Math.round(a*2147483647),-2147483648,2147483647),i):n==="float"?this.writeOutputValue=(s,o,a)=>s.setFloat32(o,a,i):W(!1);break;case 8:n==="float"?this.writeOutputValue=(s,o,a)=>s.setFloat64(o,a,i):W(!1);break;default:Hc(r),W(!1)}}async flushAndClose(e){e||this.checkForEncoderError(),this.customEncoder?(e||this.customEncoderCallSerializer.call(()=>this.customEncoder.flush()),await this.customEncoderCallSerializer.call(()=>this.customEncoder.close())):this.encoder&&(e||await this.encoder.flush(),this.encoder.state!=="closed"&&this.encoder.close()),e||this.checkForEncoderError()}getQueueSize(){return this.customEncoder?this.customEncoderQueueSize:this.isPcmEncoder?0:this.encoder?.encodeQueueSize??0}checkForEncoderError(){if(this.error)throw this.errorNeedsNewStack&&(this.error.stack=new Error().stack),this.error}}class cI extends yT{constructor(e){pie(e),super(e.codec),this._encoder=new Sie(this,e)}add(e){if(!(e instanceof Bs))throw new TypeError("audioSample must be an AudioSample.");return this._encoder.add(e,!1)}_flushAndClose(e){return this._encoder.flushAndClose(e)}}class kie extends mT{constructor(e){if(super(),this._connectedTrack=null,!my.includes(e))throw new TypeError(`Invalid subtitle codec '${e}'. Must be one of: ${my.join(", ")}.`);this._codec=e}}const Eie=["video","audio","subtitle"],A1=t=>{if(!t||typeof t!="object")throw new TypeError("metadata must be an object.");if(t.languageCode!==void 0&&!nm(t.languageCode))throw new TypeError("metadata.languageCode, when provided, must be a three-letter, ISO 639-2/T language code.");if(t.name!==void 0&&typeof t.name!="string")throw new TypeError("metadata.name, when provided, must be a string.");if(t.disposition!==void 0&&Wee(t.disposition),t.maximumPacketCount!==void 0&&(!Number.isInteger(t.maximumPacketCount)||t.maximumPacketCount<0))throw new TypeError("metadata.maximumPacketCount, when provided, must be a non-negative integer.")};class nS{constructor(e){if(this.state="pending",this._tracks=[],this._startPromise=null,this._cancelPromise=null,this._finalizePromise=null,this._mutex=new yd,this._metadataTags={},!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.format instanceof e5))throw new TypeError("options.format must be an OutputFormat.");if(!(e.target instanceof hT))throw new TypeError("options.target must be a Target.");if(e.target._output)throw new Error("Target is already used for another output.");e.target._output=this,this.format=e.format,this.target=e.target,this._writer=e.target._createWriter(),this._muxer=e.format._createMuxer(this)}addVideoTrack(e,n={}){if(!(e instanceof gT))throw new TypeError("source must be a VideoSource.");if(A1(n),n.rotation!==void 0&&![0,90,180,270].includes(n.rotation))throw new TypeError(`Invalid video rotation: ${n.rotation}. Has to be 0, 90, 180 or 270.`);if(!this.format.supportsVideoRotationMetadata&&n.rotation)throw new Error(`${this.format._name} does not support video rotation metadata.`);if(n.frameRate!==void 0&&(!Number.isFinite(n.frameRate)||n.frameRate<=0))throw new TypeError(`Invalid video frame rate: ${n.frameRate}. Must be a positive number.`);this._addTrack("video",e,n)}addAudioTrack(e,n={}){if(!(e instanceof yT))throw new TypeError("source must be an AudioSource.");A1(n),this._addTrack("audio",e,n)}addSubtitleTrack(e,n={}){if(!(e instanceof kie))throw new TypeError("source must be a SubtitleSource.");A1(n),this._addTrack("subtitle",e,n)}setMetadataTags(e){if(zx(e),this.state!=="pending")throw new Error("Cannot set metadata tags after output has been started or canceled.");this._metadataTags=e}_addTrack(e,n,r){if(this.state!=="pending")throw new Error("Cannot add track after output has been started or canceled.");if(n._connectedTrack)throw new Error("Source is already used for a track.");const i=this.format.getSupportedTrackCounts(),s=this._tracks.reduce((c,u)=>c+(u.type===e?1:0),0),o=i[e].max;if(s===o)throw new Error(o===0?`${this.format._name} does not support ${e} tracks.`:`${this.format._name} does not support more than ${o} ${e} track${o===1?"":"s"}.`);const a=i.total.max;if(this._tracks.length===a)throw new Error(`${this.format._name} does not support more than ${a} tracks${a===1?"":"s"} in total.`);const l={id:this._tracks.length+1,output:this,type:e,source:n,metadata:r};if(l.type==="video"){const c=this.format.getSupportedVideoCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support video tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported video codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}else if(l.type==="audio"){const c=this.format.getSupportedAudioCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support audio tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported audio codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}else if(l.type==="subtitle"){const c=this.format.getSupportedSubtitleCodecs();if(c.length===0)throw new Error(`${this.format._name} does not support subtitle tracks.`+this.format._codecUnsupportedHint(l.source._codec));if(!c.includes(l.source._codec))throw new Error(`Codec '${l.source._codec}' cannot be contained within ${this.format._name}. Supported subtitle codecs are: ${c.map(u=>`'${u}'`).join(", ")}.`+this.format._codecUnsupportedHint(l.source._codec))}this._tracks.push(l),n._connectedTrack=l}async start(){const e=this.format.getSupportedTrackCounts();for(const r of Eie){const i=this._tracks.reduce((o,a)=>o+(a.type===r?1:0),0),s=e[r].min;if(i<s)throw new Error(s===e[r].max?`${this.format._name} requires exactly ${s} ${r} track${s===1?"":"s"}.`:`${this.format._name} requires at least ${s} ${r} track${s===1?"":"s"}.`)}const n=e.total.min;if(this._tracks.length<n)throw new Error(n===e.total.max?`${this.format._name} requires exactly ${n} track${n===1?"":"s"}.`:`${this.format._name} requires at least ${n} track${n===1?"":"s"}.`);if(this.state==="canceled")throw new Error("Output has been canceled.");return this._startPromise?(console.warn("Output has already been started."),this._startPromise):this._startPromise=(async()=>{this.state="started",this._writer.start();const r=await this._mutex.acquire();await this._muxer.start();const i=this._tracks.map(s=>s.source._start());await Promise.all(i),r()})()}getMimeType(){return this._muxer.getMimeType()}async cancel(){if(this._cancelPromise)return console.warn("Output has already been canceled."),this._cancelPromise;if(this.state==="finalizing"||this.state==="finalized"){console.warn("Output has already been finalized.");return}return this._cancelPromise=(async()=>{this.state="canceled";const e=await this._mutex.acquire(),n=this._tracks.map(r=>r.source._flushOrWaitForOngoingClose(!0));await Promise.all(n),await this._writer.close(),e()})()}async finalize(){if(this.state==="pending")throw new Error("Cannot finalize before starting.");if(this.state==="canceled")throw new Error("Cannot finalize after canceling.");return this._finalizePromise?(console.warn("Output has already been finalized."),this._finalizePromise):this._finalizePromise=(async()=>{this.state="finalizing";const e=await this._mutex.acquire(),n=this._tracks.map(r=>r.source._flushOrWaitForOngoingClose(!1));await Promise.all(n),await this._muxer.finalize(),await this._writer.flush(),await this._writer.finalize(),this.state="finalized",e()})()}}const uI=t=>{if(t!==void 0&&(!t||typeof t!="object"))throw new TypeError("options.video, when provided, must be an object.");if(t?.discard!==void 0&&typeof t.discard!="boolean")throw new TypeError("options.video.discard, when provided, must be a boolean.");if(t?.forceTranscode!==void 0&&typeof t.forceTranscode!="boolean")throw new TypeError("options.video.forceTranscode, when provided, must be a boolean.");if(t?.codec!==void 0&&!ea.includes(t.codec))throw new TypeError(`options.video.codec, when provided, must be one of: ${ea.join(", ")}.`);if(t?.bitrate!==void 0&&!(t.bitrate instanceof po)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("options.video.bitrate, when provided, must be a positive integer or a quality.");if(t?.width!==void 0&&(!Number.isInteger(t.width)||t.width<=0))throw new TypeError("options.video.width, when provided, must be a positive integer.");if(t?.height!==void 0&&(!Number.isInteger(t.height)||t.height<=0))throw new TypeError("options.video.height, when provided, must be a positive integer.");if(t?.fit!==void 0&&!["fill","contain","cover"].includes(t.fit))throw new TypeError("options.video.fit, when provided, must be one of 'fill', 'contain', or 'cover'.");if(t?.width!==void 0&&t.height!==void 0&&t.fit===void 0)throw new TypeError("When both options.video.width and options.video.height are provided, options.video.fit must also be provided.");if(t?.rotate!==void 0&&![0,90,180,270].includes(t.rotate))throw new TypeError("options.video.rotate, when provided, must be 0, 90, 180 or 270.");if(t?.allowRotationMetadata!==void 0&&typeof t.allowRotationMetadata!="boolean")throw new TypeError("options.video.allowRotationMetadata, when provided, must be a boolean.");if(t?.crop!==void 0&&oT(t.crop,"options.video."),t?.frameRate!==void 0&&(!Number.isFinite(t.frameRate)||t.frameRate<=0))throw new TypeError("options.video.frameRate, when provided, must be a finite positive number.");if(t?.alpha!==void 0&&!["discard","keep"].includes(t.alpha))throw new TypeError("options.video.alpha, when provided, must be either 'discard' or 'keep'.");if(t?.keyFrameInterval!==void 0&&(!Number.isFinite(t.keyFrameInterval)||t.keyFrameInterval<0))throw new TypeError("options.video.keyFrameInterval, when provided, must be a non-negative number.");if(t?.process!==void 0&&typeof t.process!="function")throw new TypeError("options.video.process, when provided, must be a function.");if(t?.processedWidth!==void 0&&(!Number.isInteger(t.processedWidth)||t.processedWidth<=0))throw new TypeError("options.video.processedWidth, when provided, must be a positive integer.");if(t?.processedHeight!==void 0&&(!Number.isInteger(t.processedHeight)||t.processedHeight<=0))throw new TypeError("options.video.processedHeight, when provided, must be a positive integer.");if(t?.hardwareAcceleration!==void 0&&!["no-preference","prefer-hardware","prefer-software"].includes(t.hardwareAcceleration))throw new TypeError("options.video.hardwareAcceleration, when provided, must be 'no-preference', 'prefer-hardware' or 'prefer-software'.")},dI=t=>{if(t!==void 0&&(!t||typeof t!="object"))throw new TypeError("options.audio, when provided, must be an object.");if(t?.discard!==void 0&&typeof t.discard!="boolean")throw new TypeError("options.audio.discard, when provided, must be a boolean.");if(t?.forceTranscode!==void 0&&typeof t.forceTranscode!="boolean")throw new TypeError("options.audio.forceTranscode, when provided, must be a boolean.");if(t?.codec!==void 0&&!ta.includes(t.codec))throw new TypeError(`options.audio.codec, when provided, must be one of: ${ta.join(", ")}.`);if(t?.bitrate!==void 0&&!(t.bitrate instanceof po)&&(!Number.isInteger(t.bitrate)||t.bitrate<=0))throw new TypeError("options.audio.bitrate, when provided, must be a positive integer or a quality.");if(t?.numberOfChannels!==void 0&&(!Number.isInteger(t.numberOfChannels)||t.numberOfChannels<=0))throw new TypeError("options.audio.numberOfChannels, when provided, must be a positive integer.");if(t?.sampleRate!==void 0&&(!Number.isInteger(t.sampleRate)||t.sampleRate<=0))throw new TypeError("options.audio.sampleRate, when provided, must be a positive integer.");if(t?.process!==void 0&&typeof t.process!="function")throw new TypeError("options.audio.process, when provided, must be a function.");if(t?.processedNumberOfChannels!==void 0&&(!Number.isInteger(t.processedNumberOfChannels)||t.processedNumberOfChannels<=0))throw new TypeError("options.audio.processedNumberOfChannels, when provided, must be a positive integer.");if(t?.processedSampleRate!==void 0&&(!Number.isInteger(t.processedSampleRate)||t.processedSampleRate<=0))throw new TypeError("options.audio.processedSampleRate, when provided, must be a positive integer.")},P1=2,I1=48e3;class bT{static async init(e){const n=new bT(e);return await n._init(),n}constructor(e){if(this._addedCounts={video:0,audio:0,subtitle:0},this._totalTrackCount=0,this._trackPromises=[],this._executed=!1,this._synchronizer=new Cie,this._totalDuration=null,this._maxTimestamps=new Map,this._canceled=!1,this.onProgress=void 0,this._computeProgress=!1,this._lastProgress=0,this.isValid=!1,this.utilizedTracks=[],this.discardedTracks=[],!e||typeof e!="object")throw new TypeError("options must be an object.");if(!(e.input instanceof Xx))throw new TypeError("options.input must be an Input.");if(!(e.output instanceof nS))throw new TypeError("options.output must be an Output.");if(e.output._tracks.length>0||Object.keys(e.output._metadataTags).length>0||e.output.state!=="pending")throw new TypeError("options.output must be fresh: no tracks or metadata tags added and not started.");if(typeof e.video!="function"&&uI(e.video),typeof e.audio!="function"&&dI(e.audio),e.trim!==void 0&&(!e.trim||typeof e.trim!="object"))throw new TypeError("options.trim, when provided, must be an object.");if(e.trim?.start!==void 0&&(!Number.isFinite(e.trim.start)||e.trim.start<0))throw new TypeError("options.trim.start, when provided, must be a non-negative number.");if(e.trim?.end!==void 0&&(!Number.isFinite(e.trim.end)||e.trim.end<0))throw new TypeError("options.trim.end, when provided, must be a non-negative number.");if(e.trim?.start!==void 0&&e.trim.end!==void 0&&e.trim.start>=e.trim.end)throw new TypeError("options.trim.start must be less than options.trim.end.");if(e.tags!==void 0&&(typeof e.tags!="object"||!e.tags)&&typeof e.tags!="function")throw new TypeError("options.tags, when provided, must be an object or a function.");if(typeof e.tags=="object"&&zx(e.tags),e.showWarnings!==void 0&&typeof e.showWarnings!="boolean")throw new TypeError("options.showWarnings, when provided, must be a boolean.");this._options=e,this.input=e.input,this.output=e.output;const{promise:n,resolve:r}=ai();this._started=n,this._start=r}async _init(){this._startTimestamp=this._options.trim?.start??Math.max(await this.input.getFirstTimestamp(),0),this._endTimestamp=this._options.trim?.end??1/0;const e=await this.input.getTracks(),n=this.output.format.getSupportedTrackCounts();let r=1,i=1;for(const c of e){let u;if(c.isVideoTrack()?this._options.video&&(typeof this._options.video=="function"?(u=await this._options.video(c,r),uI(u),r++):u=this._options.video):c.isAudioTrack()?this._options.audio&&(typeof this._options.audio=="function"?(u=await this._options.audio(c,i),dI(u),i++):u=this._options.audio):W(!1),u?.discard){this.discardedTracks.push({track:c,reason:"discarded_by_user"});continue}if(this._totalTrackCount===n.total.max){this.discardedTracks.push({track:c,reason:"max_track_count_reached"});continue}if(this._addedCounts[c.type]===n[c.type].max){this.discardedTracks.push({track:c,reason:"max_track_count_of_type_reached"});continue}c.isVideoTrack()?await this._processVideoTrack(c,u??{}):c.isAudioTrack()&&await this._processAudioTrack(c,u??{})}const s=await this.input.getMetadataTags();let o;if(this._options.tags){const c=typeof this._options.tags=="function"?await this._options.tags(s):this._options.tags;zx(c),o=c}else o=s;const a=(await this.input.getFormat()).mimeType===this.output.format.mimeType,l=s.raw===o.raw;if(s.raw&&l&&!a&&delete o.raw,this.output.setMetadataTags(o),this.isValid=this._totalTrackCount>=n.total.min&&this._addedCounts.video>=n.video.min&&this._addedCounts.audio>=n.audio.min&&this._addedCounts.subtitle>=n.subtitle.min,this._options.showWarnings??!0){const c=[],u=this.discardedTracks.filter(d=>d.reason!=="discarded_by_user");u.length>0&&c.push("Some tracks had to be discarded from the conversion:",u),this.isValid||c.push(`

`+this._getInvalidityExplanation().join("")),c.length>0&&console.warn(...c)}}_getInvalidityExplanation(){const e=[];if(this.discardedTracks.length===0)e.push("Due to missing tracks, this conversion cannot be executed.");else{const n=this.discardedTracks.every(r=>r.reason==="discarded_by_user"||r.reason==="no_encodable_target_codec");if(e.push("Due to discarded tracks, this conversion cannot be executed."),n){const r=this.discardedTracks.flatMap(i=>i.reason==="discarded_by_user"?[]:i.track.type==="video"?this.output.format.getSupportedVideoCodecs():i.track.type==="audio"?this.output.format.getSupportedAudioCodecs():this.output.format.getSupportedSubtitleCodecs());r.length===1?e.push(`
Tracks were discarded because your environment is not able to encode '${r[0]}'.`):e.push(`
Tracks were discarded because your environment is not able to encode any of the following codecs: ${r.map(i=>`'${i}'`).join(", ")}.`),r.includes("mp3")&&e.push(`
The @mediabunny/mp3-encoder extension package provides support for encoding MP3.`)}else e.push(`
Check the discardedTracks field for more info.`)}return e}async execute(){if(!this.isValid)throw new Error(`Cannot execute this conversion because its output configuration is invalid. Make sure to always check the isValid field before executing a conversion.
`+this._getInvalidityExplanation().join(""));if(this._executed)throw new Error("Conversion cannot be executed twice.");if(this._executed=!0,this.onProgress){this._computeProgress=!0,this._totalDuration=Math.min(await this.input.computeDuration()-this._startTimestamp,this._endTimestamp-this._startTimestamp);for(const e of this.utilizedTracks)this._maxTimestamps.set(e.id,0);this.onProgress?.(0)}await this.output.start(),this._start();try{await Promise.all(this._trackPromises)}catch(e){throw this._canceled||this.cancel(),e}if(this._canceled)throw new Tie;await this.output.finalize(),this._computeProgress&&this.onProgress?.(1)}async cancel(){if(!(this.output.state==="finalizing"||this.output.state==="finalized")){if(this._canceled){console.warn("Conversion already canceled.");return}this._canceled=!0,await this.output.cancel()}}async _processVideoTrack(e,n){const r=e.codec;if(!r){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let i;const s=GE(e.rotation+(n.rotate??0)),o=this.output.format.supportsVideoRotationMetadata&&(n.allowRotationMetadata??!0),[a,l]=s%180===0?[e.codedWidth,e.codedHeight]:[e.codedHeight,e.codedWidth],c=n.crop;c&&sT(c,a,l);const[u,d]=c?[c.width,c.height]:[a,l];let f=u,h=d;const p=f/h,m=_=>Math.ceil(_/2)*2;n.width!==void 0&&n.height===void 0?(f=m(n.width),h=m(Math.round(f/p))):n.width===void 0&&n.height!==void 0?(h=m(n.height),f=m(Math.round(h*p))):n.width!==void 0&&n.height!==void 0&&(f=m(n.width),h=m(n.height));const g=await e.getFirstTimestamp(),y=!!n.forceTranscode||g<this._startTimestamp||!!n.frameRate||n.keyFrameInterval!==void 0||n.process!==void 0;let b=f!==u||h!==d||s!==0&&(!o||n.process!==void 0)||!!c;const S=n.alpha??"discard";let C=this.output.format.getSupportedVideoCodecs();if(!y&&!n.bitrate&&!b&&C.includes(r)&&(!n.codec||n.codec===r)){const _=new bie(r);i=_,this._trackPromises.push((async()=>{await this._started;const x=new sm(e),k={decoderConfig:await e.getDecoderConfig()??void 0},T=Number.isFinite(this._endTimestamp)?await x.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const P of x.packets(void 0,T,{verifyKeyPackets:!0})){if(this._canceled)return;const O=P.clone({timestamp:P.timestamp-this._startTimestamp,sideData:S==="discard"?{}:P.sideData});W(O.timestamp>=0),this._reportProgress(e.id,O.timestamp),await _.add(O,k),this._synchronizer.shouldWait(e.id,O.timestamp)&&await this._synchronizer.wait(O.timestamp)}_.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}n.codec&&(C=C.filter(P=>P===n.codec));const x=n.bitrate??Sy,I=await yie(C,{width:n.process&&n.processedWidth?n.processedWidth:f,height:n.process&&n.processedHeight?n.processedHeight:h,bitrate:x});if(!I){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}const k={codec:I,bitrate:x,keyFrameInterval:n.keyFrameInterval,sizeChangeBehavior:n.fit??"passThrough",alpha:S,hardwareAcceleration:n.hardwareAcceleration},T=new lI(k);if(i=T,!b){const P=new nS({format:new pT,target:new cie}),O=new lI(k);P.addVideoTrack(O),await P.start();const F=await new Wx(e).getSample(g);if(F)try{await O.add(F),F.close(),await P.finalize()}catch(B){console.info("Error when probing encoder support. Falling back to rerender path.",B),b=!0,P.cancel()}else await P.cancel()}b?this._trackPromises.push((async()=>{await this._started;const O=new Mte(e,{width:f,height:h,fit:n.fit??"fill",rotation:s,crop:n.crop,poolSize:1,alpha:S==="keep"}).canvases(this._startTimestamp,this._endTimestamp),D=n.frameRate;let F=null,B=null,N=null;const M=async R=>{W(F),W(D!==void 0);const H=Math.round((R-B)*D);for(let z=1;z<H;z++){const V=new _i(F,{timestamp:B+z/D,duration:1/D});await this._registerVideoSample(e,n,T,V),V.close()}};for await(const{canvas:R,timestamp:H,duration:z}of O){if(this._canceled)return;let V=Math.max(H-this._startTimestamp,0);if(N=V+z,D!==void 0){const Z=Math.floor(V*D)/D;if(F!==null)if(Z<=B){F=R,B=Z;continue}else await M(Z);V=Z}const X=new _i(R,{timestamp:V,duration:D!==void 0?1/D:z});await this._registerVideoSample(e,n,T,X),X.close(),D!==void 0&&(F=R,B=V)}F&&(W(N!==null),W(D!==void 0),await M(Math.floor(N*D)/D)),T.close(),this._synchronizer.closeTrack(e.id)})()):this._trackPromises.push((async()=>{await this._started;const P=new Wx(e),O=n.frameRate;let D=null,F=null,B=null;const N=async M=>{W(D),W(O!==void 0);const R=Math.round((M-F)*O);for(let H=1;H<R;H++)D.setTimestamp(F+H/O),D.setDuration(1/O),await this._registerVideoSample(e,n,T,D);D.close()};for await(const M of P.samples(this._startTimestamp,this._endTimestamp)){if(this._canceled){M.close(),D?.close();return}let R=Math.max(M.timestamp-this._startTimestamp,0);if(B=R+M.duration,O!==void 0){const H=Math.floor(R*O)/O;if(D!==null)if(H<=F){D.close(),D=M,F=H;continue}else await N(H);R=H,M.setDuration(1/O)}M.setTimestamp(R),await this._registerVideoSample(e,n,T,M),O!==void 0?(D=M,F=R):M.close()}D&&(W(B!==null),W(O!==void 0),await N(Math.floor(B*O)/O)),T.close(),this._synchronizer.closeTrack(e.id)})())}this.output.addVideoTrack(i,{frameRate:n.frameRate,languageCode:nm(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,disposition:e.disposition,rotation:b?0:s}),this._addedCounts.video++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerVideoSample(e,n,r,i){if(this._canceled)return;this._reportProgress(e.id,i.timestamp);let s;if(!n.process)s=[i];else{let o=n.process(i);o instanceof Promise&&(o=await o),Array.isArray(o)||(o=o===null?[]:[o]),s=o.map(a=>a instanceof _i?a:typeof VideoFrame<"u"&&a instanceof VideoFrame?new _i(a):new _i(a,{timestamp:i.timestamp,duration:i.duration}))}for(const o of s){if(this._canceled)break;await r.add(o),this._synchronizer.shouldWait(e.id,o.timestamp)&&await this._synchronizer.wait(o.timestamp)}for(const o of s)o!==i&&o.close()}async _processAudioTrack(e,n){const r=e.codec;if(!r){this.discardedTracks.push({track:e,reason:"unknown_source_codec"});return}let i;const s=e.numberOfChannels,o=e.sampleRate,a=await e.getFirstTimestamp();let l=n.numberOfChannels??s,c=n.sampleRate??o,u=l!==s||c!==o||a<this._startTimestamp,d=this.output.format.getSupportedAudioCodecs();if(!n.forceTranscode&&!n.bitrate&&!u&&d.includes(r)&&(!n.codec||n.codec===r)&&!n.process){const f=new xie(r);i=f,this._trackPromises.push((async()=>{await this._started;const h=new sm(e),m={decoderConfig:await e.getDecoderConfig()??void 0},g=Number.isFinite(this._endTimestamp)?await h.getPacket(this._endTimestamp,{metadataOnly:!0})??void 0:void 0;for await(const y of h.packets(void 0,g)){if(this._canceled)return;const b=y.clone({timestamp:y.timestamp-this._startTimestamp});W(b.timestamp>=0),this._reportProgress(e.id,b.timestamp),await f.add(b,m),this._synchronizer.shouldWait(e.id,b.timestamp)&&await this._synchronizer.wait(b.timestamp)}f.close(),this._synchronizer.closeTrack(e.id)})())}else{if(!await e.canDecode()){this.discardedTracks.push({track:e,reason:"undecodable_source_codec"});return}let h=null;n.codec&&(d=d.filter(g=>g===n.codec));const p=n.bitrate??Sy,m=await tS(d,{numberOfChannels:n.process&&n.processedNumberOfChannels?n.processedNumberOfChannels:l,sampleRate:n.process&&n.processedSampleRate?n.processedSampleRate:c,bitrate:p});if(!m.some(g=>kp.includes(g))&&d.some(g=>kp.includes(g))&&(l!==P1||c!==I1)){const y=(await tS(d,{numberOfChannels:P1,sampleRate:I1,bitrate:p})).find(b=>kp.includes(b));y&&(u=!0,h=y,l=P1,c=I1)}else h=m[0]??null;if(h===null){this.discardedTracks.push({track:e,reason:"no_encodable_target_codec"});return}if(u)i=this._resampleAudio(e,n,h,l,c,p);else{const g=new cI({codec:h,bitrate:p});i=g,this._trackPromises.push((async()=>{await this._started;const y=new GP(e);for await(const b of y.samples(void 0,this._endTimestamp)){if(this._canceled){b.close();return}b.setTimestamp(b.timestamp-this._startTimestamp),await this._registerAudioSample(e,n,g,b),b.close()}g.close(),this._synchronizer.closeTrack(e.id)})())}}this.output.addAudioTrack(i,{languageCode:nm(e.languageCode)?e.languageCode:void 0,name:e.name??void 0,disposition:e.disposition}),this._addedCounts.audio++,this._totalTrackCount++,this.utilizedTracks.push(e)}async _registerAudioSample(e,n,r,i){if(this._canceled)return;this._reportProgress(e.id,i.timestamp);let s;if(!n.process)s=[i];else{let o=n.process(i);if(o instanceof Promise&&(o=await o),Array.isArray(o)||(o=o===null?[]:[o]),!o.every(a=>a instanceof Bs))throw new TypeError("The audio process function must return an AudioSample, null, or an array of AudioSamples.");s=o}for(const o of s){if(this._canceled)break;await r.add(o),this._synchronizer.shouldWait(e.id,o.timestamp)&&await this._synchronizer.wait(o.timestamp)}for(const o of s)o!==i&&o.close()}_resampleAudio(e,n,r,i,s,o){const a=new cI({codec:r,bitrate:o});return this._trackPromises.push((async()=>{await this._started;const l=new _ie({targetNumberOfChannels:i,targetSampleRate:s,startTime:this._startTimestamp,endTime:this._endTimestamp,onSample:async d=>{await this._registerAudioSample(e,n,a,d),d.close()}}),u=new GP(e).samples(this._startTimestamp,this._endTimestamp);for await(const d of u){if(this._canceled){d.close();return}await l.add(d),d.close()}await l.finalize(),a.close(),this._synchronizer.closeTrack(e.id)})()),a}_reportProgress(e,n){if(!this._computeProgress)return;W(this._totalDuration!==null),this._maxTimestamps.set(e,Math.max(n,this._maxTimestamps.get(e)));const r=Math.min(...this._maxTimestamps.values()),i=zr(r/this._totalDuration,0,1);i!==this._lastProgress&&(this._lastProgress=i,this.onProgress?.(i))}}class Tie extends Error{constructor(e="Conversion has been canceled."){super(e),this.name="ConversionCanceledError"}}const fI=5;class Cie{constructor(){this.maxTimestamps=new Map,this.resolvers=[]}computeMinAndMaybeResolve(){let e=1/0;for(const[,n]of this.maxTimestamps)e=Math.min(e,n);for(let n=0;n<this.resolvers.length;n++){const r=this.resolvers[n];r.timestamp-e<fI&&(r.resolve(),this.resolvers.splice(n,1),n--)}return e}shouldWait(e,n){this.maxTimestamps.set(e,Math.max(n,this.maxTimestamps.get(e)??-1/0));const r=this.computeMinAndMaybeResolve();return n-r>=fI}wait(e){const{promise:n,resolve:r}=ai();return this.resolvers.push({timestamp:e,resolve:r}),n}closeTrack(e){this.maxTimestamps.delete(e),this.computeMinAndMaybeResolve()}}class _ie{constructor(e){this.sourceSampleRate=null,this.sourceNumberOfChannels=null,this.targetSampleRate=e.targetSampleRate,this.targetNumberOfChannels=e.targetNumberOfChannels,this.startTime=e.startTime,this.endTime=e.endTime,this.onSample=e.onSample,this.bufferSizeInFrames=Math.floor(this.targetSampleRate*5),this.bufferSizeInSamples=this.bufferSizeInFrames*this.targetNumberOfChannels,this.outputBuffer=new Float32Array(this.bufferSizeInSamples),this.bufferStartFrame=0,this.maxWrittenFrame=-1}doChannelMixerSetup(){W(this.sourceNumberOfChannels!==null);const e=this.sourceNumberOfChannels,n=this.targetNumberOfChannels;e===1&&n===2?this.channelMixer=(r,i)=>r[i*e]:e===1&&n===4?this.channelMixer=(r,i,s)=>r[i*e]*+(s<2):e===1&&n===6?this.channelMixer=(r,i,s)=>r[i*e]*+(s===2):e===2&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return .5*(r[s]+r[s+1])}:e===2&&n===4?this.channelMixer=(r,i,s)=>r[i*e+s]*+(s<2):e===2&&n===6?this.channelMixer=(r,i,s)=>r[i*e+s]*+(s<2):e===4&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return .25*(r[s]+r[s+1]+r[s+2]+r[s+3])}:e===4&&n===2?this.channelMixer=(r,i,s)=>{const o=i*e;return .5*(r[o+s]+r[o+s+2])}:e===4&&n===6?this.channelMixer=(r,i,s)=>{const o=i*e;return s<2?r[o+s]:s===2||s===3?0:r[o+s-2]}:e===6&&n===1?this.channelMixer=(r,i)=>{const s=i*e;return Math.SQRT1_2*(r[s]+r[s+1])+r[s+2]+.5*(r[s+4]+r[s+5])}:e===6&&n===2?this.channelMixer=(r,i,s)=>{const o=i*e;return r[o+s]+Math.SQRT1_2*(r[o+2]+r[o+s+4])}:e===6&&n===4?this.channelMixer=(r,i,s)=>{const o=i*e;return s<2?r[o+s]+Math.SQRT1_2*r[o+2]:r[o+s+2]}:this.channelMixer=(r,i,s)=>s<e?r[i*e+s]:0}ensureTempBufferSize(e){let n=this.tempSourceBuffer.length;for(;n<e;)n*=2;if(n!==this.tempSourceBuffer.length){const r=new Float32Array(n);r.set(this.tempSourceBuffer),this.tempSourceBuffer=r}}async add(e){this.sourceSampleRate===null&&(this.sourceSampleRate=e.sampleRate,this.sourceNumberOfChannels=e.numberOfChannels,this.tempSourceBuffer=new Float32Array(this.sourceSampleRate*this.sourceNumberOfChannels),this.doChannelMixerSetup());const n=e.numberOfFrames*e.numberOfChannels;this.ensureTempBufferSize(n);const r=e.allocationSize({planeIndex:0,format:"f32"}),i=new Float32Array(this.tempSourceBuffer.buffer,0,r/4);e.copyTo(i,{planeIndex:0,format:"f32"});const s=e.timestamp-this.startTime,o=e.numberOfFrames/this.sourceSampleRate,a=Math.min(s+o,this.endTime-this.startTime),l=Math.floor(s*this.targetSampleRate),c=Math.ceil(a*this.targetSampleRate);for(let u=l;u<c;u++){if(u<this.bufferStartFrame)continue;for(;u>=this.bufferStartFrame+this.bufferSizeInFrames;)await this.finalizeCurrentBuffer(),this.bufferStartFrame+=this.bufferSizeInFrames;const d=u-this.bufferStartFrame;W(d<this.bufferSizeInFrames);const p=(u/this.targetSampleRate-s)*this.sourceSampleRate,m=Math.floor(p),g=Math.ceil(p),y=p-m;for(let b=0;b<this.targetNumberOfChannels;b++){let S=0,C=0;m>=0&&m<e.numberOfFrames&&(S=this.channelMixer(i,m,b)),g>=0&&g<e.numberOfFrames&&(C=this.channelMixer(i,g,b));const _=S+y*(C-S),x=d*this.targetNumberOfChannels+b;this.outputBuffer[x]+=_}this.maxWrittenFrame=Math.max(this.maxWrittenFrame,d)}}async finalizeCurrentBuffer(){if(this.maxWrittenFrame<0)return;const e=(this.maxWrittenFrame+1)*this.targetNumberOfChannels,n=new Float32Array(e);n.set(this.outputBuffer.subarray(0,e));const r=this.bufferStartFrame/this.targetSampleRate,i=new Bs({format:"f32",sampleRate:this.targetSampleRate,numberOfChannels:this.targetNumberOfChannels,timestamp:r,data:n});await this.onSample(i),this.outputBuffer.fill(0),this.maxWrittenFrame=-1}finalize(){return this.finalizeCurrentBuffer()}}const Rg=["wss://purplepag.es/","wss://directory.yabu.me/","wss://indexer.coracle.social/","wss://user.kindpag.es/"],Dg=["wss://relay.nostr.band/","wss://nos.lol/","wss://relay.damus.io/","wss://relay-jp.nostr.wirednet.jp/","wss://yabu.me/","wss://r.kojira.io/","wss://nrelay-jp.c-stellar.net/"],jh="https://nostr.build/api/v2/upload/files",hI=1024*1024*1024,yu={none:{skip:!0},low:{maxWidthOrHeight:2048,fileType:"image/webp",initialQuality:.95,useWebWorker:!0},medium:{maxWidthOrHeight:1024,fileType:"image/webp",initialQuality:.8,useWebWorker:!0},high:{maxWidthOrHeight:800,fileType:"image/webp",initialQuality:.5,useWebWorker:!0}},p0={none:{skip:!0},low:{crf:20,preset:"superfast",maxSize:1280,audioBitrate:"128k",mediabunnyVideoQuality:Sy,mediabunnyAudioQuality:Sy},medium:{crf:26,preset:"superfast",maxSize:640,audioBitrate:"64k",audioSampleRate:44100,mediabunnyVideoQuality:aI,mediabunnyAudioQuality:aI},high:{crf:28,preset:"medium",maxSize:320,audioBitrate:"32k",audioSampleRate:16e3,audioChannels:1,mediabunnyVideoQuality:oI,mediabunnyAudioQuality:oI}},rS=/(?:^|[\s\n\u3000])#([^\s\n\u3000#]+)/g,Aie=["http:","https:"],Pie=[".png",".jpg",".jpeg",".gif",".webp",".svg"],Iie=[".mp4",".webm",".mov",".avi",".mkv"],Oie=400,Mie=10,pI=100,mI=1,Nie=10,Ci={LOCALE:"locale",UPLOAD_ENDPOINT:"uploadEndpoint",CLIENT_TAG_ENABLED:"clientTagEnabled",IMAGE_COMPRESSION_LEVEL:"imageCompressionLevel",VIDEO_COMPRESSION_LEVEL:"videoCompressionLevel",DRAFTS:"nostr-drafts"},s5=20,Lg=50,Rie=1e3,o5=[{label:"share.yabu.me",url:"https://share.yabu.me/api/v2/media"},{label:"nostpic.com",url:"https://nostpic.com/api/v2/media"},{label:"nostrcheck.me",url:"https://nostrcheck.me/api/v2/media"},{label:"files.sovbit.host",url:"https://files.sovbit.host/api/v2/media"},{label:"nostr.build",url:"https://nostr.build/api/v2/nip96/upload"}];function wT(t){return t==="ja"?"https://share.yabu.me/api/v2/media":"https://nostrcheck.me/api/v2/media"}function Die(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}function Lie(t){return[{label:t("settingsDialog.quality_lossless"),value:"none"},{label:t("settingsDialog.quality_high"),value:"low"},{label:t("settingsDialog.quality_medium"),value:"medium"},{label:t("settingsDialog.quality_low"),value:"high"}]}const ur={MIN_SCALE:1,MAX_SCALE:100,DEFAULT_SCALE:1,DOUBLE_CLICK_SCALE:2.5,RESET_THRESHOLD:1.3,ZOOM_DELTA:{IN:1.1,OUT:.9},THRESHOLD:.1,PINCH_MIN_DISTANCE:10},gI={FRICTION:.92,MIN_VELOCITY:.1},a5={EDITOR_FOCUS_DELAY:100,TRANSITION_DURATION:"0.3s"},Bie={EDITOR:".tiptap-editor"},Ao={URL_REGEX:/https?:\/\/[^\s\u3000]+/gi,DEBOUNCE_DELAY:300,ENABLE_HASHTAGS:!0,ENABLE_AUTO_LINK:!0,ENABLE_IMAGE_CONVERSION:!0,HASHTAG_CLASS:"hashtag",PLUGIN_KEYS:{HASHTAG_DECORATION:"hashtag-decoration",LINK_AND_IMAGE_CONVERSION:"link-and-image-conversion",CONTENT_UPDATE_TRACKER:"content-update-tracker"}},Fie=["balloonMessage.info.hello","balloonMessage.info.hello2","balloonMessage.info.welcome","balloonMessage.info.waited","balloonMessage.info.relax","balloonMessage.info.good_weather","balloonMessage.info.thwomp","balloonMessage.info.sleep_on_floor","balloonMessage.info.home_here","balloonMessage.info.donai","balloonMessage.info.kita_na","balloonMessage.info.no_licking","balloonMessage.info.not_thwomp","balloonMessage.info.kitte_origin","balloonMessage.info.normal_stamp","balloonMessage.info.backside_curious","balloonMessage.info.corner_weapon","balloonMessage.info.square_peace","balloonMessage.info.how_much_stamp","balloonMessage.info.cancellation_done","balloonMessage.info.want_to_roll","balloonMessage.info.want_candy","balloonMessage.info.tetris_gone","balloonMessage.info.comfy_here","balloonMessage.info.what_did_you_eat","balloonMessage.info.go_to_bed_early","balloonMessage.info.did_you_brush_teeth","balloonMessage.info.kit-ten_ketten","balloonMessage.info.such_is_life"],$ie=["balloonMessage.success.post_success","balloonMessage.success.sent","balloonMessage.success.to_everyone"],zie="balloonMessage.error.post_error",O1={MAX_WAIT_TIME:15e3,RETRY_INTERVAL:1e3,TIMEOUT_MESSAGE:"Upload processing timeout"},Uie=/nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{10,}/,Hie=/^nsec1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58}$/,Ba={INDEXEDDB_NAME:"share-handler-db",INDEXEDDB_VERSION:1,STORE_NAME:"flags",REQUEST_TIMEOUT:3e3,SW_CONTROLLER_WAIT_TIMEOUT:100};class ky{static parseKind10002Tags(e){const n={};return e.filter(r=>Array.isArray(r)&&r.length>=2&&r[0]==="r").forEach(r=>{const i=r[1];if(!i||typeof i!="string")return;let s=!0,o=!0;r.length>2&&(r.length===3?r[2]==="read"?o=!1:r[2]==="write"&&(s=!1):(s=r.includes("read"),o=r.includes("write"))),n[i]={read:s,write:o}}),n}static parseKind3Content(e){try{const n=JSON.parse(e);return n&&typeof n=="object"&&!Array.isArray(n)?n:null}catch{return null}}static isValidRelayConfig(e){return e?Array.isArray(e)?e.every(n=>typeof n=="string"):typeof e=="object"?Object.entries(e).every(([n,r])=>typeof n=="string"&&r&&typeof r=="object"&&"read"in r&&"write"in r&&typeof r.read=="boolean"&&typeof r.write=="boolean"):!1:!1}}class ap{static normalizeRelayUrl(e){return e.endsWith("/")?e:e+"/"}static mergeRelayConfigs(...e){const n=new Set;return e.forEach(r=>{Array.isArray(r)?r.forEach(i=>n.add(this.normalizeRelayUrl(i))):typeof r=="object"&&Object.keys(r).forEach(i=>{n.add(this.normalizeRelayUrl(i))})}),Array.from(n)}static extractWriteRelays(e){return Array.isArray(e)?e.map(n=>this.normalizeRelayUrl(n)):typeof e=="object"?Object.keys(e).filter(n=>e[n]?.write!==!1).map(n=>this.normalizeRelayUrl(n)):[]}static extractAllRelays(e){return Array.isArray(e)?e.map(n=>this.normalizeRelayUrl(n)):typeof e=="object"?Object.keys(e).map(n=>this.normalizeRelayUrl(n)):[]}}class Vie{constructor(e,n,r,i){this.localStorage=e,this.console=n,this.relayListUpdatedStore=r,this.pubkeyHex=i}setPubkey(e){this.pubkeyHex=e}save(e,n){try{const r=`nostr-relays-${e}`;if(n===null){if(this.localStorage.removeItem(r),this.console.log(`ãªã¬ã¼ãªã¹ããåé¤: ${e}`),typeof window<"u")try{MI(e,{})}catch{}return}if(!ky.isValidRelayConfig(n)){this.console.warn("ç¡å¹ãªãªã¬ã¼è¨­å®ã®ããä¿å­ãã¹ã­ãã:",n);return}if(this.localStorage.setItem(r,JSON.stringify(n)),typeof window<"u")try{MI(e,n)}catch(i){this.console.warn("ã¹ãã¢ã®æ´æ°ã«å¤±æ:",i)}this.relayListUpdatedStore&&this.relayListUpdatedStore.set(this.relayListUpdatedStore.value+1),this.console.log("ãªã¬ã¼ãªã¹ããã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){this.console.error("ãªã¬ã¼ãªã¹ãã®ä¿å­ã«å¤±æ:",r)}}get(e){try{const n=`nostr-relays-${e}`,r=this.localStorage.getItem(n);if(!r)return null;const i=JSON.parse(r);return ky.isValidRelayConfig(i)?i:null}catch(n){return this.console.error("ãªã¬ã¼ãªã¹ãã®åå¾ã«å¤±æ:",n),null}}clear(e){this.save(e,null)}}class Wie{constructor(e,n,r,i){this.rxNostr=e,this.console=n,this.setTimeoutFn=r,this.clearTimeoutFn=i}async fetchKind10002(e,n,r=3e3){return this.console.log(`Kind 10002åå¾è©¦è¡: ${e}`),new Promise(i=>{const s=R0();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=d=>{a||(a=!0,c(),i(d))};try{l=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:d=>{if(!a&&d.event?.kind===10002&&d.event.pubkey===e)try{const f=ky.parseKind10002Tags(d.event.tags);Object.keys(f).length>0&&(o=!0,this.console.log("Kind 10002ãããªã¬ã¼ãåå¾:",f),u({success:!0,relayConfig:f,source:"kind10002"}))}catch(f){this.console.error("Kind 10002ã®ãã¼ã¹ã¨ã©ã¼:",f)}},complete:()=>{a||(o||this.console.log("Kind 10002: EOSEåä¿¡ãã¤ãã³ããªã"),u({success:o,error:o?void 0:"not_found"}))},error:d=>{a||(this.console.error("Kind 10002åå¾ã¨ã©ã¼:",d),u({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[10002],until:Math.floor(Date.now()/1e3)}),s.over()}catch(d){this.console.error("Kind 10002ãªã¯ã¨ã¹ãä½æã¨ã©ã¼:",d),u({success:!1,error:"request_error"})}})}async fetchKind3(e,n,r=3e3){return this.console.log(`Kind 3åå¾è©¦è¡: ${e}`),new Promise(i=>{const s=R0();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=d=>{a||(a=!0,c(),i(d))};try{l=this.rxNostr.use(s,{on:{relays:n}}).subscribe({next:d=>{if(!a&&d.event?.kind===3&&d.event.pubkey===e){const f=ky.parseKind3Content(d.event.content);f&&(o=!0,this.console.log("Kind 3ãããªã¬ã¼ãåå¾:",f),u({success:!0,relayConfig:f,source:"kind3"}))}},complete:()=>{a||(o||this.console.log("Kind 3: EOSEåä¿¡ãã¤ãã³ããªã"),u({success:o,error:o?void 0:"not_found"}))},error:d=>{a||(this.console.error("Kind 3åå¾ã¨ã©ã¼:",d),u({success:!1,error:"network_error"}))}}),s.emit({authors:[e],kinds:[3],until:Math.floor(Date.now()/1e3)}),s.over()}catch(d){this.console.error("Kind 3ãªã¯ã¨ã¹ãä½æã¨ã©ã¼:",d),u({success:!1,error:"request_error"})}})}}class jie{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.console||(typeof window<"u"?window.console:{}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.relayListUpdatedStore||(typeof window<"u"?{value:0,set:l=>{}}:void 0);this.storage=new Vie(r,i,a),this.networkFetcher=new Wie(e,i,s,o)}storage;networkFetcher;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}setBootstrapRelays(){try{this.rxNostr.use(R0(),{on:{relays:Rg}}).subscribe()}catch(e){console.error("Bootstrap relaysè¨­å®ã¨ã©ã¼:",e)}}useRelaysFromLocalStorageIfExists(e){const n=this.storage.get(e);if(n)try{return this.rxNostr.setDefaultRelays(n),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼ãªã¹ããä½¿ç¨:",n),!0}catch(r){return console.error("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã®ãªã¬ã¼è¨­å®ã¨ã©ã¼:",r),this.storage.clear(e),!1}return!1}async fetchUserRelays(e,n={}){const r=n.timeoutMs||3e3;if(console.log(`ãªã¬ã¼åå¾éå§: ${e}`),!n.forceRemote){const o=this.storage.get(e);if(o)return this.rxNostr.setDefaultRelays(o),console.log("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ãããªã¬ã¼ãå¾©åãã¾ãã"),{success:!0,relayConfig:o,source:"localStorage"}}console.log("ãªã¢ã¼ããããªã¬ã¼æå ±ãåå¾ä¸­...");const i=await this.networkFetcher.fetchKind10002(e,Rg,r);if(i.success&&i.relayConfig)return this.rxNostr.setDefaultRelays(i.relayConfig),this.storage.save(e,i.relayConfig),console.log("Kind 10002ãããªã¬ã¼åå¾æå"),{success:!0,relayConfig:i.relayConfig,source:"kind10002"};const s=await this.networkFetcher.fetchKind3(e,Rg,r);return s.success&&s.relayConfig?(this.rxNostr.setDefaultRelays(s.relayConfig),this.storage.save(e,s.relayConfig),console.log("Kind 3ãããªã¬ã¼åå¾æå"),{success:!0,relayConfig:s.relayConfig,source:"kind3"}):(console.log("ãªã¢ã¼ãåå¾å¤±æããã©ã¼ã«ããã¯ãªã¬ã¼ãä½¿ç¨"),this.rxNostr.setDefaultRelays(Dg),console.log("ãã©ã¼ã«ããã¯ãªã¬ã¼ãè¨­å®:",Dg),this.storage.save(e,Dg),{success:!1,relayConfig:Dg,source:"fallback"})}getRelayListsForProfile(e,n=Rg){const r=this.storage.get(e);let i=[],s=[];return r?(i=ap.extractWriteRelays(r),s=ap.mergeRelayConfigs(r,n)):s=n.map(o=>ap.normalizeRelayUrl(o)),{writeRelays:i,additionalRelays:s}}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}loadRelayConfigForUI(e){const n=this.storage.get(e);if(!n)return null;const r=ap.extractWriteRelays(n);return{relayConfig:n,writeRelays:r}}}let yI=me(Wt({info:null,visible:!1}));const of={get value(){return E(yI)},set:t=>{K(yI,t,!0)}};let M1=me(!1);const ln={get value(){return E(M1)},set:t=>{K(M1,t,!0)},reset:()=>{K(M1,!1)}};let Ey=null;function qie(t){Ey=t}function Kie(){return Ey}let Ty=null;function Gie(t){Ty=t}function Zie(){return Ty}function Xie(){ln.set(!0),Ey&&Ey.abort(),Ty&&Ty.abort(),Ap.set(0),Pp.set(0)}const Cy={type:"none",isAuthenticated:!1,pubkey:"",npub:"",nprofile:"",isValid:!1,isInitialized:!1,isExtensionLogin:!1};let Kf=me(Wt({...Cy}));const Wr={get value(){return E(Kf)||Cy},subscribe:t=>{Ge(()=>{t(E(Kf)||Cy)})}};function vT(t){const n={...E(Kf),...t};n.isAuthenticated=n.type!=="none"&&n.isValid,n.isExtensionLogin=n.isAuthenticated&&n.type==="nostr-login"&&typeof window<"u"&&typeof window.nostr=="object"&&typeof window.nostr.signEvent=="function",K(Kf,n,!0),console.log("[updateAuthState] èªè¨¼ç¶æãæ´æ°:",{type:n.type,isAuthenticated:n.isAuthenticated,isValid:n.isValid,pubkey:n.pubkey?n.pubkey.substring(0,8)+"...":"empty"})}function bI(t=!0){K(Kf,{...Cy,isInitialized:t?E(Kf).isInitialized:!1},!0)}function Qie(t,e,n){if(!t||!e||!n){console.warn("setNsecAuth: All parameters are required");return}vT({type:"nsec",pubkey:t,npub:e,nprofile:n,isValid:!0})}function wI(t,e,n,r){if(!t||!e||!n){console.warn("setNostrLoginAuth: All parameters are required");return}console.log("[setNostrLoginAuth] NostrLoginèªè¨¼ç¶æãæ´æ°:",{pubkey:t.substring(0,8)+"...",npub:e.substring(0,12)+"...",type:"nostr-login",nostrLoginAuthMethod:r}),vT({type:"nostr-login",pubkey:t,npub:e,nprofile:n,isValid:!0,nostrLoginAuthMethod:r})}function Yie(){vT({isInitialized:!0})}const Ur=Wt({file:null,metadata:void 0,received:!1});function vI(t,e){Ur.file=t,Ur.metadata=e,Ur.received=!!t}function Jie(){Ur.file=null,Ur.metadata=void 0,Ur.received=!1}const zu=Wt({content:null,received:!1});function ese(t){zu.content=t,zu.received=!!t}function tse(){zu.content=null,zu.received=!1}function nse(){return Ur.file}function rse(){return Ur.metadata}let xI=me(!1),SI=me(!1),kI=me(!1),EI=me(!1);const _p={get value(){return E(xI)},set:t=>{K(xI,t,!0)}},_y={get value(){return E(SI)},set:t=>{K(SI,t,!0)}},xT={get value(){return E(kI)},set:t=>{K(kI,t,!0)}},qh={get value(){return E(EI)},set:t=>{K(EI,t,!0)}};let TI=me(!1),CI=me(!1),_I=me(null);const Bg={get value(){return E(TI)},set:t=>{K(TI,t,!0)}},Dd={get value(){return E(CI)},set:t=>{K(CI,t,!0)}},Fg={get value(){return E(_I)},set:t=>{K(_I,t,!0)}},l5=(()=>{try{if(typeof MP=="function")return MP({onRegistered:t=>{console.log("SW registered successfully",t)},onRegisterError(t){console.warn("SW registration error",t)},onNeedRefresh(){console.log("SW needs refresh - showing prompt")},immediate:!0,onOfflineReady(){console.log("App ready to work offline")}})}catch(t){console.warn("Failed to initialize Service Worker:",t)}return{needRefresh:{subscribe:()=>{}},updateServiceWorker:()=>{}}})(),ST=l5.needRefresh,ise=l5.updateServiceWorker;let N1=me(null);const c5={get value(){return E(N1)},set:t=>{K(N1,t,!0)},subscribe:t=>{Ge(()=>{t(E(N1))})}};let R1=me(Wt({name:"",picture:"",npub:"",nprofile:""})),D1=me(!1),L1=me(!1);const lc={get value(){return E(R1)},set:t=>{K(R1,t,!0)},subscribe:t=>{Ge(()=>{t(E(R1))})}},jd={get value(){return E(D1)},set:t=>{K(D1,t,!0)},subscribe:t=>{Ge(()=>{t(E(D1))})}},Qs={get value(){return E(L1)},set:t=>{K(L1,t,!0)},subscribe:t=>{Ge(()=>{t(E(L1))})}};let B1=me(!1);const sse={get value(){return E(B1)},set:t=>{K(B1,t,!0)},subscribe:t=>{Ge(()=>{t(E(B1))})}};let F1=me(0);const Ap={get value(){return E(F1)},set:t=>{K(F1,t,!0)},subscribe:t=>{Ge(()=>{t(E(F1))})}};let $1=me(0);const Pp={get value(){return E($1)},set:t=>{K($1,t,!0)},subscribe:t=>{Ge(()=>{t(E($1))})}};Wt({content:"",hashtags:[],tags:[]});let z1=me(null);const ose={get value(){return E(z1)},set:t=>{K(z1,t,!0)},subscribe:t=>{Ge(()=>{t(E(z1))})}};let iS=null,U1=me(Wt([])),H1=me(null),AI=me(!1),PI=me(!1);const Ip={get value(){return E(U1)},set:t=>{K(U1,t,!0)},subscribe:t=>{Ge(()=>{t(E(U1))})}},m0={get value(){return E(H1)},set:t=>{K(H1,t,!0)},subscribe:t=>{Ge(()=>{t(E(H1))})}},V1={get value(){return E(AI)},set:t=>{K(AI,t,!0)}},II={get value(){return E(PI)},set:t=>{K(PI,t,!0)}};let g0=me(0);const sS={get value(){return E(g0)},set:t=>{K(g0,t,!0)},subscribe:t=>{Ge(()=>{t(E(g0))})}};function ase(t){iS=t}function OI(t){if(!iS||!t){m0.set(null),Ip.set([]);return}const e=iS.loadRelayConfigForUI(t);if(!e){m0.set(null),Ip.set([]);return}m0.set(e.relayConfig),Ip.set(e.writeRelays)}function MI(t,e){if(!t)return;const n=`nostr-relays-${t}`;try{localStorage.setItem(n,JSON.stringify(e)),m0.set(e);const r=ap.extractWriteRelays(e);Ip.set(r),sS.set(E(g0)+1)}catch(r){console.error("ãªã¬ã¼è¨­å®ã®ä¿å­ã¨ã©ã¼:",r)}}const us=Ds({open:!1,nodeId:void 0,src:void 0});let NI=me(null);const Za={get value(){return E(NI)},set:t=>{K(NI,t,!0)}};let pr=Wt({showSecretKeyDialog:!1,pendingPost:"",showImageFullscreen:!1,fullscreenImageSrc:"",fullscreenImageAlt:"",showPopupModal:!1,popupX:0,popupY:0,popupMessage:""});const va={get value(){return pr},subscribe:t=>{Ge(()=>{t(pr)})},showSecretKeyDialog:t=>{pr.pendingPost=t,pr.showSecretKeyDialog=!0},hideSecretKeyDialog:()=>{pr.showSecretKeyDialog=!1,pr.pendingPost=""},getPendingPost:()=>pr.pendingPost,showImageFullscreen:(t,e="")=>{pr.fullscreenImageSrc=t,pr.fullscreenImageAlt=e,pr.showImageFullscreen=!0},hideImageFullscreen:()=>{pr.showImageFullscreen=!1,pr.fullscreenImageSrc="",pr.fullscreenImageAlt=""},showPopupMessage:(t,e,n,r=1800)=>{pr.popupX=t,pr.popupY=e,pr.popupMessage=n,pr.showPopupModal=!0,setTimeout(()=>{pr.showPopupModal=!1},r)},hidePopupMessage:()=>{pr.showPopupModal=!1}};function RI(t,e=3e3){if(t===null){u5();return}of.set({info:t,visible:!0})}function u5(){of.set({info:null,visible:!1})}function lse(){_p.set(!0)}function W1(){_p.set(!1)}function cse(){_y.set(!0)}function use(){_y.set(!1)}function dse(){xT.set(!0)}function fse(){xT.set(!1)}function hse(){ise(!0)}function pse(){return navigator.serviceWorker?.controller?new Promise(t=>{const e=new MessageChannel;if(e.port1.onmessage=n=>{n.data?.version?(c5.set(n.data.version),t(n.data.version)):t(null)},navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({type:"GET_VERSION"},[e.port2]);else{t(null);return}setTimeout(()=>t(null),2e3)}):Promise.resolve(null)}const Vc={setBodyStyle(t,e){document.body.style.setProperty(t,e)},querySelector(t){return document.querySelector(t)},querySelectorAll(t){return document.querySelectorAll(t)},focusElement(t){t.focus()}};function Uu(t,e){Vc.setBodyStyle(t,e)}function mse(){Uu("overflow",""),Uu("user-select",""),Uu("-webkit-user-select","")}function gse(){return document.activeElement}function yse(t){return t.classList?.contains?.("tiptap-editor")||!!t.closest?.(".tiptap-editor")}function bse(t){return["INPUT","TEXTAREA"].includes(t.tagName)||t.isContentEditable}function wse(){const t=gse();t&&(yse(t)||bse(t))&&(t.blur?.(),document.body?.focus?.())}function Xa(){return typeof window<"u"&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0||navigator&&!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|Mobile/i))}function d5(){try{if(wse(),Xa()){const t=document.querySelector(".tiptap-editor");t&&t.blur?.()}}catch{}}const vse={setTimeout:(t,e)=>setTimeout(t,e)};function xse(t,e,n=vse){n.setTimeout(()=>{const r=Vc.querySelector(t);r&&Vc.focusElement(r)},e)}function Sse(t=200){if(!(typeof window>"u"||typeof navigator>"u"))if("vibrate"in navigator)try{navigator.vibrate(t)}catch{}else try{const e=document.getElementById("vibrateSwitch");e&&e.click()}catch{}}var kse=1063;function Ese(t){const e={content:t.content,created_at:Math.floor(Date.now()/1e3),kind:kse,tags:[["url",t.url],["m",t.m],["x",t.x],["ox",t.ox]]};return t.size&&e.tags.push(["size",t.size]),t.dim&&e.tags.push(["dim",t.dim]),t.i&&e.tags.push(["i",t.i]),t.blurhash&&e.tags.push(["blurhash",t.blurhash]),t.thumb&&e.tags.push(["thumb",t.thumb]),t.image&&e.tags.push(["image",t.image]),t.summary&&e.tags.push(["summary",t.summary]),t.alt&&e.tags.push(["alt",t.alt]),t.fallback&&t.fallback.forEach(n=>e.tags.push(["fallback",n])),e}var f5=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],lp=t=>{let e=0;for(let n=0;n<t.length;n++){let r=t[n],i=f5.indexOf(r);e=e*83+i}return e},Kh=(t,e)=>{var n="";for(let r=1;r<=e;r++){let i=Math.floor(t)/Math.pow(83,e-r)%83;n+=f5[Math.floor(i)]}return n},Sf=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},kf=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(e*12.92*255+.5):Math.trunc((1.055*Math.pow(e,.4166666666666667)-.055)*255+.5)},Tse=t=>t<0?-1:1,Ef=(t,e)=>Tse(t)*Math.pow(Math.abs(t),e),Ay=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},Cse=t=>{if(!t||t.length<6)throw new Ay("The blurhash string must be at least 6 characters");let e=lp(t[0]),n=Math.floor(e/9)+1,r=e%9+1;if(t.length!==4+2*r*n)throw new Ay(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*r*n}`)},_se=t=>{let e=t>>16,n=t>>8&255,r=t&255;return[Sf(e),Sf(n),Sf(r)]},Ase=(t,e)=>{let n=Math.floor(t/361),r=Math.floor(t/19)%19,i=t%19;return[Ef((n-9)/9,2)*e,Ef((r-9)/9,2)*e,Ef((i-9)/9,2)*e]},Pse=(t,e,n,r)=>{Cse(t),r=r|1;let i=lp(t[0]),s=Math.floor(i/9)+1,o=i%9+1,a=(lp(t[1])+1)/166,l=new Array(o*s);for(let d=0;d<l.length;d++)if(d===0){let f=lp(t.substring(2,6));l[d]=_se(f)}else{let f=lp(t.substring(4+d*2,6+d*2));l[d]=Ase(f,a*r)}let c=e*4,u=new Uint8ClampedArray(c*n);for(let d=0;d<n;d++)for(let f=0;f<e;f++){let h=0,p=0,m=0;for(let S=0;S<s;S++)for(let C=0;C<o;C++){let _=Math.cos(Math.PI*f*C/e)*Math.cos(Math.PI*d*S/n),x=l[C+S*o];h+=x[0]*_,p+=x[1]*_,m+=x[2]*_}let g=kf(h),y=kf(p),b=kf(m);u[4*f+0+d*c]=g,u[4*f+1+d*c]=y,u[4*f+2+d*c]=b,u[4*f+3+d*c]=255}return u},Ise=Pse,DI=4,Ose=(t,e,n,r)=>{let i=0,s=0,o=0,a=e*DI;for(let c=0;c<e;c++){let u=DI*c;for(let d=0;d<n;d++){let f=u+d*a,h=r(c,d);i+=h*Sf(t[f]),s+=h*Sf(t[f+1]),o+=h*Sf(t[f+2])}}let l=1/(e*n);return[i*l,s*l,o*l]},Mse=t=>{let e=kf(t[0]),n=kf(t[1]),r=kf(t[2]);return(e<<16)+(n<<8)+r},Nse=(t,e)=>{let n=Math.floor(Math.max(0,Math.min(18,Math.floor(Ef(t[0]/e,.5)*9+9.5)))),r=Math.floor(Math.max(0,Math.min(18,Math.floor(Ef(t[1]/e,.5)*9+9.5)))),i=Math.floor(Math.max(0,Math.min(18,Math.floor(Ef(t[2]/e,.5)*9+9.5))));return n*19*19+r*19+i},Rse=(t,e,n,r,i)=>{if(r<1||r>9||i<1||i>9)throw new Ay("BlurHash must have between 1 and 9 components");if(e*n*4!==t.length)throw new Ay("Width and height must match the pixels array");let s=[];for(let d=0;d<i;d++)for(let f=0;f<r;f++){let h=f==0&&d==0?1:2,p=Ose(t,e,n,(m,g)=>h*Math.cos(Math.PI*f*m/e)*Math.cos(Math.PI*d*g/n));s.push(p)}let o=s[0],a=s.slice(1),l="",c=r-1+(i-1)*9;l+=Kh(c,1);let u;if(a.length>0){let d=Math.max(...a.map(h=>Math.max(...h))),f=Math.floor(Math.max(0,Math.min(82,Math.floor(d*166-.5))));u=(f+1)/166,l+=Kh(f,1)}else u=1,l+=Kh(0,1);return l+=Kh(Mse(o),4),a.forEach(d=>{l+=Kh(Nse(d,u),2)}),l},Dse=Rse;async function h5(t){if(!t.url)throw new Error("url is required for imeta tag");if(!t.m)throw new Error("m (MIME type) is required for imeta tag");let e=t.dim;if(!e&&t.url)try{e=await new Promise(i=>{const s=new window.Image;s.onload=()=>{i(`${s.naturalWidth}x${s.naturalHeight}`)},s.onerror=()=>i(void 0),s.src=t.url})}catch{e=void 0}const n=Ese({content:t.content||"",url:t.url,m:t.m,x:t.x||"",ox:t.ox||"",size:t.size,dim:e,blurhash:t.blurhash,thumb:t.thumb,image:t.image,summary:t.summary,alt:t.alt,fallback:t.fallback}),r=[`url ${t.url}`];for(const i of n.tags){const[s,...o]=i;s!=="url"&&(o.length===1?r.push(`${s} ${o[0]}`):o.length>1&&r.push(`${s} ${o.join(" ")}`))}return["imeta",...r]}async function Lse(t){try{if(ln.value)return null;const e=await new Promise((o,a)=>{const l=URL.createObjectURL(t),c=new window.Image;c.onload=()=>{URL.revokeObjectURL(l),o(c)},c.onerror=u=>{URL.revokeObjectURL(l),a(u)},c.src=l});if(ln.value)return null;const n=document.createElement("canvas");n.width=Math.min(e.width,64),n.height=Math.min(e.height,64);const r=n.getContext("2d");if(!r)return null;r.drawImage(e,0,0,n.width,n.height);const i=r.getImageData(0,0,n.width,n.height);return Dse(i.data,i.width,i.height,4,4)}catch{return null}}async function Bse(t){try{return URL.createObjectURL(t)}catch{return null}}async function Fse(t){return await Lse(t)}function p5(t){const e={};return t&&t.state&&t.state.doc&&t.state.doc.descendants(n=>{n.type?.name==="image"&&n.attrs?.src&&n.attrs?.blurhash&&!n.attrs?.isPlaceholder&&!n.attrs?.src?.startsWith("placeholder-")&&(e[n.attrs.src]=n.attrs.blurhash)}),e}function $se(t,e,n,r){try{const i=Ise(t,n,r),s=e.getContext("2d");if(!s)return!1;const o=new ImageData(new Uint8ClampedArray(Array.from(i)),n,r);return s.putImageData(o,0,0),!0}catch(i){return console.warn("Failed to decode blurhash:",i),!1}}function m5(t){const e=t.split(".").pop()?.toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",svg:"image/svg+xml"}[e||""]||"image/jpeg"}async function zse(t){try{const e=await fetch(t);if(!e.ok)return null;const n=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}catch(e){return console.warn("Failed to calculate image hash:",e),null}}const LI={maxWidth:780,maxHeight:240};function g5(t,e,n=LI.maxWidth,r=LI.maxHeight){if(t<=n&&e<=r)return{width:t,height:e,displayWidth:t,displayHeight:e};const i=t/e;let s,o;return t/n>e/r?(s=n,o=Math.round(n/i)):(o=r,s=Math.round(r*i)),{width:t,height:e,displayWidth:s,displayHeight:o}}function Use(t){if(!t)return null;const e=t.match(/^(\d+)x(\d+)$/);return e?{width:parseInt(e[1],10),height:parseInt(e[2],10)}:null}function j1(){return{width:200,height:150,displayWidth:200,displayHeight:150}}function Hse(t,e,n){return{start:{nodePos:n?.()},move:e,end:{nodeData:e?.nodeData||{pos:n?.()},dropX:0,dropY:0,target:null,dropPosition:null,...e}}[t]}function Vse(t){return{start:"touch-image-drag-start",move:"touch-image-drag-move",end:"touch-image-drop"}[t]}function Gh(t,e,n){const r=Vse(t),i=Hse(t,e,n),s=new CustomEvent(r,{detail:i,bubbles:!0,cancelable:!0});window.dispatchEvent(s),document.dispatchEvent(new CustomEvent(r,{detail:s.detail}))}function Wse(t,e){return document.elementFromPoint(t,e)?.closest(".drop-zone-indicator")||null}function jse(){Vc.querySelectorAll(".drop-zone-indicator").forEach(t=>{t.classList.remove("drop-zone-hover")})}function qse(t){t?.classList.add("drop-zone-hover")}function Kse(t,e){jse();const n=Wse(t,e);qse(n)}function Gse(t,e=140){const n=Math.min(e,t.width||e),r=t.width>0?Math.round(t.height/t.width*n):n;return{width:n,height:r}}function Zse(t){if(!t)return null;const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");return n&&n.drawImage(t,0,0),e}function Xse(t){if(!t)return null;const e=document.createElement("img");return e.src=t.src,e.alt=t.alt||"",e}function Qse(t,e,n){Object.assign(t.style,{width:`${e.width}px`,height:`${e.height}px`,left:`${n.x-e.width/2}px`,top:`${n.y-e.height/2}px`,transformOrigin:"center center",transition:"transform 120ms ease, opacity 120ms ease"})}function Yse(t,e,n,r=!1){const i=t.getBoundingClientRect(),s=Gse(i);let o=null;if(r){const a=t.querySelector("canvas");a&&(o=Zse(a))}else{const a=t.querySelector("img");a&&(o=Xse(a))}return o?(Qse(o,s,{x:e,y:n}),o.classList.add("drag-preview"),document.body.appendChild(o),requestAnimationFrame(()=>{o.style.transform="scale(0.8) rotate(0deg)",o.style.opacity="0.95"}),o):null}function Jse(t,e,n){if(!t)return;const r=t.getBoundingClientRect(),i=r.width||100,s=r.height||100;t.style.left=`${e-i/2}px`,t.style.top=`${n-s/2}px`}function q1(t){t?.parentNode?.removeChild(t)}function eoe(t,e,n,r,i){const s=t-n,o=e-r;return s*s+o*o>i*i}function toe(t,e,n,r){return!!(t||e||n&&!r)}function cp(t){const e=t();if(e===void 0)return;Xa()&&d5();const n=new CustomEvent("select-image-node",{detail:{pos:e}});window.dispatchEvent(n),document.dispatchEvent(n)}function noe(t,e,n,r,i,s,o,a,l){return toe(n,r,s,e)?(t.preventDefault(),!1):(cp(l),t.preventDefault(),e||t.stopPropagation(),!0)}function roe(t,e,n){return!!(t&&e&&n.displayWidth>0&&n.displayHeight>0)}function ioe(t,e){t.width=e.displayWidth,t.height=e.displayHeight}function BI(t,e,n,r,i=!1){roe(t,e,n)&&(ioe(e,n),$se(t,e,n.displayWidth,n.displayHeight))}const soe={getItem:t=>localStorage.getItem(t),setItem:(t,e)=>localStorage.setItem(t,e)},ooe={language:navigator.language},aoe={location:{reload:()=>window.location.reload()}},loe={setTimeout:(t,e)=>setTimeout(t,e)};function coe(t,e){if(t<=0)return 100;const n=e/t*100;return Number(n.toPrecision(2))}function uoe(t,e){const n=t/1024>=1e3,r=i=>n?`${(i/1048576).toFixed(2)}MB`:`${Math.round(i/1024)}KB`;return`${r(t)} â ${r(e)}`}function doe(t,e,n,r,i,s){return{originalSize:t,compressedSize:e,wasCompressed:n,compressionRatio:coe(t,e),sizeReduction:uoe(t,e),originalFilename:r,compressedFilename:i,wasSkipped:s}}function foe(t){return t.wasCompressed||t.originalFilename!==t.compressedFilename||t.originalSize!==t.compressedSize||!!t.wasSkipped}function FI(t){if(!t||!foe(t))return null;const e=t.originalSize/1024>=1e3,n=r=>e?`${(r/1048576).toFixed(2)}MB`:`${Math.round(r/1024)}KB`;return{wasCompressed:t.wasCompressed,originalSize:n(t.originalSize),compressedSize:n(t.compressedSize),compressionRatio:t.compressionRatio,originalFilename:t.originalFilename,compressedFilename:t.compressedFilename,wasSkipped:t.wasSkipped}}function hoe(t){return Uie.test(t)}function poe(t){return Hie.test(t)}function moe(t){return ow(t)}function goe(t){return{npub:hl.npubEncode(t),nprofile:hl.nprofileEncode({pubkey:t,relays:[]})}}function yoe(t){try{const{type:e,data:n}=hl.decode(t);if(e!=="nsec")return console.warn("ç¡å¹ãªnsecå½¢å¼ã§ã"),{hex:"",npub:"",nprofile:""};const r=moe(n),{npub:i,nprofile:s}=goe(r);return{hex:r,npub:i,nprofile:s}}catch{return{hex:"",npub:"",nprofile:""}}}function y5(t){try{return hl.npubEncode(t)}catch{return`npub1${t.slice(0,10)}...`}}function boe(t,e=[],n=[]){try{const r=[];e.length>0&&r.push(e[0]);const i=3-r.length;if(i>0){const s=n.filter(o=>!r.includes(o));r.push(...s.slice(0,Math.min(i,2)))}return hl.nprofileEncode({pubkey:t,relays:r})}catch{return""}}async function b5(t,e=window.crypto.subtle){if(ln.value)throw new Error("Upload aborted by user");const n=await t.arrayBuffer(),r=await e.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function woe(t,e){try{return await b5(t,e)}catch{return}}async function voe(t){return new Promise(e=>{if(!t.type.startsWith("image/")){e(null);return}const n=new Image,r=URL.createObjectURL(t);n.onload=()=>{try{const i=g5(n.naturalWidth,n.naturalHeight);URL.revokeObjectURL(r),e(i)}catch(i){console.error("Failed to calculate image display size:",i),URL.revokeObjectURL(r),e(null)}},n.onerror=()=>{URL.revokeObjectURL(r),e(null)},n.src=r})}function xoe(t,e){const r={"image/webp":".webp","image/jpeg":".jpg","image/png":".png","image/gif":".gif","image/avif":".avif","image/bmp":".bmp"}[e];return r?`${t.replace(/\.[^.]+$/,"")}${r}`:t}function Soe(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function koe(t,e){const n=t.getItem(Ci.LOCALE),r=e.language;return n||(r&&r.startsWith("ja")?"ja":"en")}function Eoe(t,e,n){const r=e.getItem(Ci.UPLOAD_ENDPOINT);return r&&o5.some(i=>i.url===r)?r:n||wT(t)}function Toe(t){const e=t.getItem(Ci.CLIENT_TAG_ENABLED),n=e===null?!0:e==="true";return e===null&&t.setItem(Ci.CLIENT_TAG_ENABLED,"true"),n}function Coe(t,e){return t.getItem(Ci.IMAGE_COMPRESSION_LEVEL)||e||"medium"}function _oe(t={}){const{selectedEndpoint:e,selectedCompression:n,storage:r=soe,navigator:i=ooe}=t,s=koe(r,i),o=Eoe(s,r,e),a=Toe(r),l=Coe(r,n);return{endpoint:o,clientTagEnabled:a,compression:l}}function Aoe(t,e,n={}){const{timeout:r=1e3,windowAdapter:i=aoe,timeoutAdapter:s=loe}=n;e(!0),t(),s.setTimeout(()=>{i.location.reload()},r)}async function w5(t,e,n,r="readonly"){return new Promise(i=>{try{const s=indexedDB.open(t,e);s.onupgradeneeded=o=>{const a=o.target.result;a.objectStoreNames.contains(n)||a.createObjectStore(n,{keyPath:"id"})},s.onerror=()=>i(null),s.onsuccess=o=>{try{const a=o.target.result;if(!a.objectStoreNames.contains(n)){a.close(),i(null);return}const l=a.transaction([n],r),c=l.objectStore(n);i({db:a,transaction:l,store:c})}catch{i(null)}}}catch{i(null)}})}async function Poe(t,e,n,r){const i=await w5(t,e,n,"readonly");if(!i)return null;const{db:s,store:o}=i;return new Promise(a=>{const l=o.get(r);l.onsuccess=()=>{s.close(),a(l.result)},l.onerror=()=>{s.close(),a(null)}})}async function Ioe(t,e,n,r){const i=await w5(t,e,n,"readwrite");if(!i)return!1;const{db:s,store:o}=i;return new Promise(a=>{const l=o.delete(r);l.onsuccess=()=>{s.close(),a(!0)},l.onerror=()=>{s.close(),a(!1)}})}function Ooe(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function kT(t,e=Ba.REQUEST_TIMEOUT){if(!navigator.serviceWorker.controller)throw new Error("No ServiceWorker controller available");const n=new MessageChannel,r=Ooe();return new Promise((i,s)=>{const o=setTimeout(()=>{n.port1.close(),s(new Error("ServiceWorker communication timeout"))},e);n.port1.onmessage=a=>{clearTimeout(o),n.port1.close();const{data:l}=a.data||{};i(l)},n.port1.addEventListener("error",a=>{clearTimeout(o),n.port1.close(),s(a)});try{if(navigator.serviceWorker.controller)navigator.serviceWorker.controller.postMessage({...t,requestId:r},[n.port2]);else throw new Error("ServiceWorker controller became unavailable")}catch(a){clearTimeout(o),n.port1.close(),s(a)}})}async function Moe(){if(!navigator.serviceWorker.controller)return new Promise((t,e)=>{const n=setTimeout(()=>{navigator.serviceWorker.removeEventListener("controllerchange",r),e(new Error("ServiceWorkerã³ã³ãã­ã¼ã©ã¼å¾æ©ã¿ã¤ã ã¢ã¦ã"))},Ba.REQUEST_TIMEOUT),r=()=>{clearTimeout(n),navigator.serviceWorker.removeEventListener("controllerchange",r),setTimeout(t,Ba.SW_CONTROLLER_WAIT_TIMEOUT)};navigator.serviceWorker.addEventListener("controllerchange",r)})}async function Noe(){const t=await Poe(Ba.INDEXEDDB_NAME,Ba.INDEXEDDB_VERSION,Ba.STORE_NAME,"sharedImageData");return t?.data?(await Ioe(Ba.INDEXEDDB_NAME,Ba.INDEXEDDB_VERSION,Ba.STORE_NAME,"sharedImageData"),t.data.image?.arrayBuffer&&t.data.image._isFile?{image:new File([t.data.image.arrayBuffer],t.data.image.name||"shared-image",{type:t.data.image.type||"image/jpeg"}),metadata:t.data.metadata}:t.data):null}async function Roe(){try{const t=await kT({action:"getSharedImage"});return t&&t.image?t:null}catch(t){return console.error("Failed to send message to ServiceWorker:",t),null}}async function Doe(){try{try{await Promise.race([Moe(),new Promise((t,e)=>setTimeout(()=>e(new Error("SW controller timeout")),2e3))])}catch(t){console.warn("Service Worker controller not ready, trying alternatives:",t)}try{const t=await Roe();if(t)return console.log("Shared image retrieved via ServiceWorker MessageChannel"),t}catch(t){console.warn("Service Worker MessageChannel failed:",t)}try{const t=await Noe();if(t)return console.log("Shared image retrieved via IndexedDB fallback"),t}catch(t){console.warn("IndexedDB fallback failed:",t)}try{const t=await kT({action:"getSharedImageForce"},1e3),e=t&&t.image?t:null;if(e)return console.log("Shared image retrieved via forced Service Worker request"),e}catch(t){console.warn("Forced Service Worker request failed:",t)}return console.log("No shared image found through any method"),null}catch(t){return console.error("Error in getSharedImageWithFallback:",t),null}}async function Loe(){if(!("serviceWorker"in navigator))return{isReady:!1,hasController:!1,error:"Service Worker not supported"};const t=await navigator.serviceWorker.getRegistration(),e=!!navigator.serviceWorker.controller;return t?{isReady:t.active!==null,hasController:e}:{isReady:!1,hasController:e,error:"Service Worker not registered"}}async function Boe(){try{const t=await kT({type:"PING_TEST"},3e3);return console.log("ServiceWorker communication test successful:",t),!0}catch(t){return console.warn("ServiceWorker communication test timeout"),console.error("ServiceWorker communication test error:",t),!1}}function af(t){if(t.type.startsWith("touch")){const e=t,n=e.touches[0]||e.changedTouches[0];return{x:n.clientX,y:n.clientY}}else{const e=t;return{x:e.clientX,y:e.clientY}}}function Tf(t,e,n,r,i){const s=window.innerWidth||document.documentElement.clientWidth||0,o=window.innerHeight||document.documentElement.clientHeight||0,a=typeof n=="number"?n:0,l=r?s-r-a:s-a,c=i?o-i-a:o-a;return{x:Math.max(a,Math.min(l,t)),y:Math.max(a,Math.min(c,e))}}async function Foe(t,e){const n=[];if(ln.value)throw new Error("Upload aborted by user");for(let r=0;r<t.length;r++){const i=t[r],[s,o]=await Promise.all([woe(i,e.crypto),e.getImageDimensions(i)]);n.push({file:i,index:r,ox:s,dimensions:o??void 0})}return n}function $oe(t){return t.map(e=>({caption:e.name,expiration:"",size:e.size,alt:e.name,media_type:void 0,content_type:e.type||"",no_transform:"true"}))}function $I(t,e){const n=[];for(let r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}class zI{static addCacheBuster(e){if(!e)return e;try{const n=new URL(e);return n.searchParams.set("cb",Date.now().toString()),n.toString()}catch{return e}}static addProfileMarker(e,n=!1,r=!0){if(!e)return e;try{const i=new URL(e);return i.searchParams.set("profile","true"),n&&r?i.searchParams.has("cb")&&i.searchParams.set("cb",Date.now().toString()):i.searchParams.delete("cb"),i.toString()}catch{return e}}}class zoe{constructor(e={}){this.deps=e}createProfileData(e,n,r){const i=r?.profileRelays||[],s=r?.writeRelays||[],o=r?.forceRemote||!1;let a=e?.picture||"";if(a){o&&(a=zI.addCacheBuster(a));const l=this.deps.navigator?.onLine??!0;a=zI.addProfileMarker(a,o,l)}return{name:e?.name||"",picture:a,npub:y5(n),nprofile:boe(n,i,s),profileRelays:i.length>0?i:void 0}}}class Uoe{constructor(e,n,r){this.localStorage=e,this.console=n,this.profileDataFactory=r}save(e,n){try{if(n===null){this.localStorage.removeItem(`nostr-profile-${e}`);return}this.localStorage.setItem(`nostr-profile-${e}`,JSON.stringify(n)),this.console.log("ãã­ãã£ã¼ã«æå ±ãã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã«ä¿å­:",e)}catch(r){this.console.error("ãã­ãã£ã¼ã«æå ±ã®ä¿å­ã«å¤±æ:",r)}}get(e){try{const n=this.localStorage.getItem(`nostr-profile-${e}`);if(!n)return null;const r=JSON.parse(n);return r.npub&&r.nprofile?{...r,profileRelays:r.profileRelays||void 0}:this.profileDataFactory.createProfileData(r,e,{forceRemote:!1})}catch(n){return this.console.error("ãã­ãã£ã¼ã«æå ±ã®åå¾ã«å¤±æ:",n),null}}clear(e){this.save(e,null)}}class Hoe{constructor(e,n,r,i,s){this.rxNostr=e,this.profileDataFactory=n,this.setTimeoutFn=r,this.clearTimeoutFn=i,this.console=s}async fetchFromNetwork(e,n){n?.timeoutMs;const r=n?.additionalRelays??[];return new Promise(i=>{const s=R0();let o=!1,a=!1,l;const c=()=>{l&&typeof l.unsubscribe=="function"&&(l.unsubscribe(),l=void 0)},u=h=>{a||(a=!0,c(),i(h))},d=r.length>0?{on:{relays:r}}:void 0;l=(d?this.rxNostr.use(s,d):this.rxNostr.use(s)).subscribe({next:h=>{if(!a&&h.event?.kind===0&&h.event.pubkey===e){o=!0;try{const p=JSON.parse(h.event.content),m=[];if(h.from&&typeof h.from=="string"){const y=h.from.endsWith("/")?h.from:h.from+"/";m.push(y)}const g=this.profileDataFactory.createProfileData(p,e,{profileRelays:m,writeRelays:n?.writeRelays,forceRemote:n?.forceRemote});this.console.log("Kind 0ãããã­ãã£ã¼ã«æå ±ãåå¾:",g,"from relay:",h.from),u(g)}catch(p){this.console.error("Kind 0ã®ãã¼ã¹ã¨ã©ã¼:",p),u(null)}}},complete:()=>{if(!a&&!o){this.console.log("ãã­ãã£ã¼ã«åå¾EOSEãããã©ã«ããã­ãã£ã¼ã«ãä½¿ç¨");const h=this.profileDataFactory.createProfileData({},e,{writeRelays:n?.writeRelays,forceRemote:n?.forceRemote});u(h)}},error:h=>{a||(this.console.error("ãã­ãã£ã¼ã«åå¾ã¨ã©ã¼:",h),u(null))}}),s.emit({authors:[e],kinds:[0],until:Math.floor(Date.now()/1e3)}),s.over()})}}class Voe{constructor(e,n={}){this.rxNostr=e;const r=n.localStorage||(typeof window<"u"?window.localStorage:{}),i=n.navigator||(typeof window<"u"?window.navigator:{onLine:!0}),s=n.setTimeoutFn||((l,c)=>setTimeout(l,c)),o=n.clearTimeoutFn||(l=>clearTimeout(l)),a=n.console||(typeof window<"u"?window.console:{});this.profileDataFactory=new zoe({navigator:i}),this.storage=new Uoe(r,a,this.profileDataFactory),this.networkFetcher=new Hoe(e,this.profileDataFactory,s,o,a)}storage;networkFetcher;profileDataFactory;saveToLocalStorage(e,n){this.storage.save(e,n)}getFromLocalStorage(e){return this.storage.get(e)}async fetchProfileData(e,n){const r=this.networkFetcher.console;if(r.log(`ãã­ãã£ã¼ã«åå¾éå§: ${e}`),!n?.forceRemote){const s=this.storage.get(e);if(s)return r.log("ã­ã£ãã·ã¥ãããã­ãã£ã¼ã«ãå¾©å:",s),s}r.log("ãªã¢ã¼ããããã­ãã£ã¼ã«æå ±ãåå¾ä¸­...");const i=await this.networkFetcher.fetchFromNetwork(e,n);return i&&this.storage.save(e,i),i}getStorage(){return this.storage}getNetworkFetcher(){return this.networkFetcher}getProfileDataFactory(){return this.profileDataFactory}}class Woe{relayManager;profileManager;constructor(e,n,r){this.relayManager=n,this.profileManager=r}async initializeRelays(e){e?this.relayManager.useRelaysFromLocalStorageIfExists(e)||this.relayManager.setBootstrapRelays():this.relayManager.setBootstrapRelays()}async fetchRelays(e,n=!1){if(!n){const i=this.relayManager.getFromLocalStorage(e);if(i)return console.log("ã­ã£ãã·ã¥ãããªã¬ã¼ãªã¹ããå¾©å:",i),{success:!0,relayConfig:i,source:"localStorage"}}return await this.relayManager.fetchUserRelays(e,{forceRemote:n})}async fetchProfile(e,n=!1){if(!e)return null;n&&this.profileManager.saveToLocalStorage(e,null);const{writeRelays:r,additionalRelays:i}=this.relayManager.getRelayListsForProfile(e);return await this.profileManager.fetchProfileData(e,{forceRemote:n,writeRelays:r,additionalRelays:i})}async initializeForLogin(e){console.log(`ã­ã°ã¤ã³åæåéå§: ${e}`),await this.fetchRelays(e,!1);const n=await this.fetchProfile(e,!1);return console.log(`ã­ã°ã¤ã³åæåå®äº: ${e}`),n}async refreshRelaysAndProfile(e){console.log(`ãªã¬ã¼ã»ãã­ãã£ã¼ã«ååå¾éå§: ${e}`),await this.fetchRelays(e,!0);const n=await this.fetchProfile(e,!0);return console.log(`ãªã¬ã¼ã»ãã­ãã£ã¼ã«ååå¾å®äº: ${e}`),n}getRelayManager(){return this.relayManager}getProfileManager(){return this.profileManager}}function $r(t){this.content=t}$r.prototype={constructor:$r,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return i==-1?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new $r(s)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new $r(n)},addToStart:function(t,e){return new $r([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new $r(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(s==-1?i.length:s,0,e,n),new $r(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=$r.from(t),t.size?new $r(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=$r.from(t),t.size?new $r(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=$r.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};$r.from=function(t){if(t instanceof $r)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new $r(e)};function v5(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i==s){n+=i.nodeSize;continue}if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let o=0;i.text[o]==s.text[o];o++)n++;return n}if(i.content.size||s.content.size){let o=v5(i.content,s.content,n+1);if(o!=null)return o}n+=i.nodeSize}}function x5(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(i==0||s==0)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=x5(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class De{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,s){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,i+a,s||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,i+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let s="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:s+=r),s+=c},0),s}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),s=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),s=1);s<e.content.length;s++)i.push(e.content[s]);return new De(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let s=0,o=0;o<n;s++){let a=this.content[s],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),i+=a.nodeSize),o=l}return new De(r,i)}cutByIndex(e,n){return e==n?De.empty:e==0&&n==this.content.length?this:new De(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),s=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new De(i,s)}addToStart(e){return new De([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new De(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return v5(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return x5(this,e,n,r)}findIndex(e){if(e==0)return $g(0,e);if(e==this.size)return $g(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),s=r+i.nodeSize;if(s>=e)return s==e?$g(n+1,s):$g(n,r);r=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return De.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new De(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return De.empty;let n,r=0;for(let i=0;i<e.length;i++){let s=e[i];r+=s.nodeSize,i&&s.isText&&e[i-1].sameMarkup(s)?(n||(n=e.slice(0,i)),n[n.length-1]=s.withText(n[n.length-1].text+s.text)):n&&n.push(s)}return new De(n||e,r)}static from(e){if(!e)return De.empty;if(e instanceof De)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new De([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}De.empty=new De([],0);const K1={index:0,offset:0};function $g(t,e){return K1.index=t,K1.offset=e,K1}function Py(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Py(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Py(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let An=class oS{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let s=e[i];if(this.eq(s))return e;if(this.type.excludes(s.type))n||(n=e.slice(0,i));else{if(s.type.excludes(this.type))return e;!r&&s.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(s)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Py(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let i=r.create(n.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return oS.none;if(e instanceof oS)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}};An.none=[];class Iy extends Error{}class rt{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=k5(this.content,e+this.openStart,n);return r&&new rt(r,this.openStart,this.openEnd)}removeBetween(e,n){return new rt(S5(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return rt.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new rt(De.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let s=e.firstChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.firstChild)r++;for(let s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)i++;return new rt(e,r,i)}}rt.empty=new rt(De.empty,0,0);function S5(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(S5(s.content,e-i-1,n-i-1)))}function k5(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=k5(o.content,e-s-1,n,o);return a&&t.replaceChild(i,o.copy(a))}function joe(t,e,n){if(n.openStart>t.depth)throw new Iy("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Iy("Inconsistent open depths");return E5(t,e,n,0)}function E5(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=E5(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Vu(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=qoe(n,t);return Vu(s,C5(t,o,a,e,r))}else return Vu(s,Oy(t,e,r))}function T5(t,e){if(!e.type.compatibleContent(t.type))throw new Iy("Cannot join "+e.type.name+" onto "+t.type.name)}function aS(t,e,n){let r=t.node(n);return T5(r,e.node(n)),r}function Hu(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Op(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(Hu(t.nodeAfter,r),s++));for(let a=s;a<o;a++)Hu(i.child(a),r);e&&e.depth==n&&e.textOffset&&Hu(e.nodeBefore,r)}function Vu(t,e){return t.type.checkContent(e),t.copy(e)}function C5(t,e,n,r,i){let s=t.depth>i&&aS(t,e,i+1),o=r.depth>i&&aS(n,r,i+1),a=[];return Op(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(T5(s,o),Hu(Vu(s,C5(t,e,n,r,i+1)),a)):(s&&Hu(Vu(s,Oy(t,e,i+1)),a),Op(e,n,i,a),o&&Hu(Vu(o,Oy(n,r,i+1)),a)),Op(r,null,i,a),new De(a)}function Oy(t,e,n){let r=[];if(Op(null,t,n,r),t.depth>n){let i=aS(t,e,n+1);Hu(Vu(i,Oy(t,e,n+1)),r)}return Op(e,null,n,r),new De(r)}function qoe(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(De.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class am{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let s=0;s<e;s++)i+=r.child(s).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return An.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let s=r.marks;for(var o=0;o<s.length;o++)s[o].type.spec.inclusive===!1&&(!i||!s[o].isInSet(i.marks))&&(s=s[o--].removeFromSet(s));return s}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new My(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,s=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(s),c=s-l;if(r.push(o,a,i+l),!c||(o=o.child(a),o.isText))break;s=c-1,i+=l+1}return new am(n,r,s)}static resolveCached(e,n){let r=UI.get(e);if(r)for(let s=0;s<r.elts.length;s++){let o=r.elts[s];if(o.pos==n)return o}else UI.set(e,r=new Koe);let i=r.elts[r.i]=am.resolve(e,n);return r.i=(r.i+1)%Goe,i}}class Koe{constructor(){this.elts=[],this.i=0}}const Goe=12,UI=new WeakMap;class My{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Zoe=Object.create(null);let Ac=class lS{constructor(e,n,r,i=An.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||De.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Py(this.attrs,n||e.defaultAttrs||Zoe)&&An.sameSet(this.marks,r||An.none)}copy(e=null){return e==this.content?this:new lS(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new lS(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return rt.empty;let i=this.resolve(e),s=this.resolve(n),o=r?0:i.sharedDepth(n),a=i.start(o),c=i.node(o).content.cut(i.pos-a,s.pos-a);return new rt(c,i.depth-o,s.depth-o)}replace(e,n,r){return joe(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return am.resolveCached(this,e)}resolveNoCache(e){return am.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,s=>(r.isInSet(s.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),_5(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=De.empty,i=0,s=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,i,s),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<s;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let s=this.contentMatchAt(e).matchType(r),o=s&&s.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=An.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!An.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=De.fromJSON(e,n.content),s=e.nodeType(n.type).create(n.attrs,i,r);return s.type.checkAttrs(s.attrs),s}};Ac.prototype.text=void 0;class Ny extends Ac{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):_5(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Ny(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Ny(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function _5(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class ad{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new Xoe(e,n);if(r.next==null)return ad.empty;let i=A5(r);r.next&&r.err("Unexpected trailing text");let s=rae(nae(i));return iae(s,r),s}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let s=n;i&&s<r;s++)i=i.matchType(e.child(s).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function s(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return De.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(d)==-1){i.push(d);let f=s(d,a.concat(u));if(f)return f}}return null}return s(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),s=i.match;if(s.matchType(e)){let o=[];for(let a=i;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<s.next.length;o++){let{type:a,next:l}=s.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let s=i+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)s+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return s}).join(`
`)}}ad.empty=new ad(!0);class Xoe{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function A5(t){let e=[];do e.push(Qoe(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Qoe(t){let e=[];do e.push(Yoe(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Yoe(t){let e=tae(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=Joe(t,e);else break;return e}function HI(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function Joe(t,e){let n=HI(t),r=n;return t.eat(",")&&(t.next!="}"?r=HI(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function eae(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let o=n[s];o.isInGroup(e)&&i.push(o)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function tae(t){if(t.eat("(")){let e=A5(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=eae(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function nae(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function i(o,a){o.forEach(l=>l.to=a)}function s(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(s(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=s(o.exprs[l],a);if(l==o.exprs.length-1)return c;i(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),i(s(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return i(s(o.expr,a),l),i(s(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(s(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();i(s(o.expr,l),u),l=u}if(o.max==-1)i(s(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),i(s(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function P5(t,e){return e-t}function VI(t,e){let n=[];return r(e),n.sort(P5);function r(i){let s=t[i];if(s.length==1&&!s[0].term)return r(s[0].to);n.push(i);for(let o=0;o<s.length;o++){let{term:a,to:l}=s[o];!a&&n.indexOf(l)==-1&&r(l)}}}function rae(t){let e=Object.create(null);return n(VI(t,0));function n(r){let i=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<i.length;u++)i[u][0]==a&&(c=i[u][1]);VI(t,l).forEach(u=>{c||i.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let s=e[r.join(",")]=new ad(r.indexOf(t.length-1)>-1);for(let o=0;o<i.length;o++){let a=i[o][1].sort(P5);s.next.push({type:i[o][0],next:e[a.join(",")]||n(a)})}return s}}function iae(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],s=!i.validEnd,o=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];o.push(l.name),s&&!(l.isText||l.hasRequiredAttrs())&&(s=!1),r.indexOf(c)==-1&&r.push(c)}s&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function I5(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function O5(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let s=t[r];if(s.hasDefault)i=s.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function M5(t,e,n,r){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${n} of type ${i}`);for(let i in t){let s=t[i];s.validate&&s.validate(e[i])}}function N5(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new oae(t,r,e[r]);return n}let WI=class R5{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=N5(e,r.attrs),this.defaultAttrs=I5(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ad.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:O5(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Ac(this,this.computeAttrs(e),De.from(n),An.setFrom(r))}createChecked(e=null,n,r){return n=De.from(n),this.checkContent(n),new Ac(this,this.computeAttrs(e),n,An.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=De.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let i=this.contentMatch.matchFragment(n),s=i&&i.fillBefore(De.empty,!0);return s?new Ac(this,e,n.append(s),An.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){M5(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:An.none:e}static compile(e,n){let r=Object.create(null);e.forEach((s,o)=>r[s]=new R5(s,n,o));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let s in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function sae(t,e,n){let r=n.split("|");return i=>{let s=i===null?"null":typeof i;if(r.indexOf(s)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${s}`)}}class oae{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?sae(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class yw{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=N5(e,i.attrs),this.excluded=null;let s=I5(this.attrs);this.instance=s?new An(this,s):null}create(e=null){return!e&&this.instance?this.instance:new An(this,O5(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((s,o)=>r[s]=new yw(s,i++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){M5(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class D5{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let i in e)n[i]=e[i];n.nodes=$r.from(e.nodes),n.marks=$r.from(e.marks||{}),this.nodes=WI.compile(this.spec.nodes,this),this.marks=yw.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let s=this.nodes[i],o=s.spec.content||"",a=s.spec.marks;if(s.contentMatch=r[o]||(r[o]=ad.parse(o,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet=a=="_"?null:a?jI(this,a.split(" ")):a==""||!s.inlineContent?[]:null}for(let i in this.marks){let s=this.marks[i],o=s.spec.excludes;s.excluded=o==null?[s]:o==""?[]:jI(this,o.split(" "))}this.nodeFromJSON=i=>Ac.fromJSON(this,i),this.markFromJSON=i=>An.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof WI){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new Ny(r,r.defaultAttrs,e,An.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function jI(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function aae(t){return t.tag!=null}function lae(t){return t.style!=null}class Pc{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(i=>{if(aae(i))this.tags.push(i);else if(lae(i)){let s=/[^=]*/.exec(i.style)[0];r.indexOf(s)<0&&r.push(s),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let s=e.nodes[i.node];return s.contentMatch.matchType(s)})}parse(e,n={}){let r=new KI(this,n,!1);return r.addAll(e,An.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new KI(this,n,!0);return r.addAll(e,An.none,n.from,n.to),rt.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let s=this.tags[i];if(dae(e,s.tag)&&(s.namespace===void 0||e.namespaceURI==s.namespace)&&(!s.context||n.matchesContext(s.context))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}matchStyle(e,n,r,i){for(let s=i?this.styles.indexOf(i)+1:0;s<this.styles.length;s++){let o=this.styles[s],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(i){let s=i.priority==null?50:i.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<s)break}n.splice(o,0,i)}for(let i in e.marks){let s=e.marks[i].spec.parseDOM;s&&s.forEach(o=>{r(o=GI(o)),o.mark||o.ignore||o.clearMark||(o.mark=i)})}for(let i in e.nodes){let s=e.nodes[i].spec.parseDOM;s&&s.forEach(o=>{r(o=GI(o)),o.node||o.ignore||o.mark||(o.node=i)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Pc(e,Pc.schemaRules(e)))}}const L5={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},cae={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},B5={ol:!0,ul:!0},lm=1,cS=2,Mp=4;function qI(t,e,n){return e!=null?(e?lm:0)|(e==="full"?cS:0):t&&t.whitespace=="pre"?lm|cS:n&~Mp}class zg{constructor(e,n,r,i,s,o){this.type=e,this.attrs=n,this.marks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=An.none,this.match=s||(o&Mp?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(De.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&lm)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let s=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=s.withText(s.text.slice(0,s.text.length-i[0].length))}}let n=De.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(De.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!L5.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class KI{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let i=n.topNode,s,o=qI(null,n.preserveWhitespace,0)|(r?Mp:0);i?s=new zg(i.type,i.attrs,An.none,!0,n.topMatch||i.type.contentMatch,o):r?s=new zg(null,null,An.none,!0,null,o):s=new zg(e.schema.topNodeType,null,An.none,!0,null,o),this.nodes=[s],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,i=this.top,s=i.options&cS?"full":this.localPreserveWS||(i.options&lm)>0,{schema:o}=this.parser;if(s==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(s)if(s==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=i.content[i.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let i=this.localPreserveWS,s=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;B5.hasOwnProperty(o)&&this.parser.normalizeLists&&uae(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:cae.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(L5.hasOwnProperty(o))s.content.length&&s.content[0].isInline&&this.open&&(this.open--,s=this.top),c=!0,s.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let d=l&&l.skip?n:this.readStyles(e,n);d&&this.addAll(e,d),c&&this.sync(s),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let s=this.parser.matchedStyles[i],o=r.getPropertyValue(s);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(s,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,i){let s,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(s=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}s&&this.sync(a)&&this.open--}addAll(e,n,r,i){let s=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];o!=a;o=o.nextSibling,++s)this.findAtPoint(e,s),this.addDOM(o,n);this.findAtPoint(e,s)}findPlace(e,n,r){let i,s;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,s=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!i)return null;this.sync(s);for(let o=0;o<i.length;o++)n=this.enterInner(i[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let s=this.textblockFromContext();s&&(n=this.enterInner(s,null,n))}let i=this.findPlace(e,n,r);if(i){this.closeExtra();let s=this.top;s.match&&(s.match=s.match.matchType(e.type));let o=An.none;for(let a of i.concat(e.marks))(s.type?s.type.allowsMarkType(a.type):ZI(a.type,e.type))&&(o=a.addToSet(o));return s.content.push(e.mark(o)),!0}return!1}enter(e,n,r,i){let s=this.findPlace(e.create(n),r,!1);return s&&(s=this.enterInner(e,n,r,!0,i)),s}enterInner(e,n,r,i=!1,s){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=qI(e,s,o.options);o.options&Mp&&o.content.length==0&&(a|=Mp);let l=An.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):ZI(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new zg(e,n,l,i,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=lm)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),s=-(r?r.depth+1:0)+(i?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=s;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&i?this.nodes[l].type:r&&l>=s?r.node(l-s).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function uae(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&B5.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function dae(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function GI(t){let e={};for(let n in t)e[n]=t[n];return e}function ZI(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=a=>{s.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||s.indexOf(u)<0&&o(u))return!0}};if(o(i.contentMatch))return!0}}class bd{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=G1(n).createDocumentFragment());let i=r,s=[];return e.forEach(o=>{if(s.length||o.marks.length){let a=0,l=0;for(;a<s.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(s[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<s.length;)i=s.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(s.push([c,i]),i.appendChild(u.dom),i=u.contentDOM||u.dom)}}i.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=y0(G1(n),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let s=this.serializeMark(e.marks[i],e.isInline,n);s&&((s.contentDOM||s.dom).appendChild(r),r=s.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&y0(G1(r),i(e,n),null,e.attrs)}static renderSpec(e,n,r=null,i){return y0(e,n,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new bd(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=XI(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return XI(e.marks)}}function XI(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function G1(t){return t.document||window.document}const QI=new WeakMap;function fae(t){let e=QI.get(t);return e===void 0&&QI.set(t,e=hae(t)),e}function hae(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)n(r[i]);else for(let i in r)n(r[i])}return n(t),e}function y0(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],s;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(s=fae(r))&&s.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));let a,l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let f=d.indexOf(" ");f>0?l.setAttributeNS(d.slice(0,f),d.slice(f+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let f=e[d];if(f===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:h,contentDOM:p}=y0(t,f,n,r);if(l.appendChild(h),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const F5=65535,$5=Math.pow(2,16);function pae(t,e){return t+e*$5}function YI(t){return t&F5}function mae(t){return(t-(t&F5))/$5}const z5=1,U5=2,b0=4,H5=8;class uS{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&H5)>0}get deletedBefore(){return(this.delInfo&(z5|b0))>0}get deletedAfter(){return(this.delInfo&(U5|b0))>0}get deletedAcross(){return(this.delInfo&b0)>0}}class ls{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ls.empty)return ls.empty}recover(e){let n=0,r=YI(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+mae(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+s],u=this.ranges[a+o],d=l+c;if(e<=d){let f=c?e==l?-1:e==d?1:n:n,h=l+i+(f<0?0:u);if(r)return h;let p=e==(n<0?l:d)?null:pae(a/3,e-l),m=e==l?U5:e==d?z5:b0;return(n<0?e!=l:e!=d)&&(m|=H5),new uS(h,m,p)}i+=u-c}return r?e+i:new uS(e+i,0,null)}touches(e,n){let r=0,i=YI(n),s=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+s],u=l+c;if(e<=u&&a==i*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,s=0;i<this.ranges.length;i+=3){let o=this.ranges[i],a=o-(this.inverted?s:0),l=o+(this.inverted?0:s),c=this.ranges[i+n],u=this.ranges[i+r];e(a,a+c,l,l+u),s+=u-c}}invert(){return new ls(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ls.empty:new ls(e<0?[0,-e,0]:[0,0,e])}}ls.empty=new ls([]);class cm{constructor(e,n,r=0,i=e?e.length:0){this.mirror=n,this.from=r,this.to=i,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new cm(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let i=e.getMirror(n);this.appendMap(e._maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e._maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new cm;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let s=this.from;s<this.to;s++){let o=this._maps[s],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(s);if(l!=null&&l>s&&l<this.to){s=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new uS(e,i,null)}}const Z1=Object.create(null);class mi{getMap(){return ls.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=Z1[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Z1)throw new RangeError("Duplicate use of step JSON ID "+e);return Z1[e]=n,n.prototype.jsonID=e,n}}class fr{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new fr(e,null)}static fail(e){return new fr(null,e)}static fromReplace(e,n,r,i){try{return fr.ok(e.replace(n,r,i))}catch(s){if(s instanceof Iy)return fr.fail(s.message);throw s}}}function ET(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(ET(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return De.fromArray(r)}class yc extends mi{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),s=new rt(ET(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),i),n.openStart,n.openEnd);return fr.fromReplace(e,this.from,this.to,s)}invert(){return new so(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new yc(n.pos,r.pos,this.mark)}merge(e){return e instanceof yc&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new yc(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new yc(n.from,n.to,e.markFromJSON(n.mark))}}mi.jsonID("addMark",yc);class so extends mi{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new rt(ET(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return fr.fromReplace(e,this.from,this.to,r)}invert(){return new yc(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new so(n.pos,r.pos,this.mark)}merge(e){return e instanceof so&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new so(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new so(n.from,n.to,e.markFromJSON(n.mark))}}mi.jsonID("removeMark",so);class bc extends mi{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return fr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return fr.fromReplace(e,this.pos,this.pos+1,new rt(De.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new bc(this.pos,n.marks[i]);return new bc(this.pos,this.mark)}}return new ld(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new bc(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new bc(n.pos,e.markFromJSON(n.mark))}}mi.jsonID("addNodeMark",bc);class ld extends mi{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return fr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return fr.fromReplace(e,this.pos,this.pos+1,new rt(De.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new bc(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ld(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new ld(n.pos,e.markFromJSON(n.mark))}}mi.jsonID("removeNodeMark",ld);class xr extends mi{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&dS(e,this.from,this.to)?fr.fail("Structure replace would overwrite content"):fr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ls([this.from,this.to-this.from,this.slice.size])}invert(e){return new xr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new xr(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof xr)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?rt.empty:new rt(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new xr(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?rt.empty:new rt(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new xr(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new xr(n.from,n.to,rt.fromJSON(e,n.slice),!!n.structure)}}mi.jsonID("replace",xr);class Pr extends mi{constructor(e,n,r,i,s,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=s,this.insert=o,this.structure=a}apply(e){if(this.structure&&(dS(e,this.from,this.gapFrom)||dS(e,this.gapTo,this.to)))return fr.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return fr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?fr.fromReplace(e,this.from,this.to,r):fr.fail("Content does not fit in gap")}getMap(){return new ls([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Pr(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),s=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||s>r.pos?null:new Pr(n.pos,r.pos,i,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Pr(n.from,n.to,n.gapFrom,n.gapTo,rt.fromJSON(e,n.slice),n.insert,!!n.structure)}}mi.jsonID("replaceAround",Pr);function dS(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let o=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,i--}}return!1}function gae(t,e,n,r){let i=[],s=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!r.isInSet(d)&&u.type.allowsMarkType(r.type)){let f=Math.max(c,e),h=Math.min(c+l.nodeSize,n),p=r.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==f&&o.mark.eq(d[m])?o.to=h:i.push(o=new so(f,h,d[m])));a&&a.to==f?a.to=h:s.push(a=new yc(f,h,r))}}),i.forEach(l=>t.step(l)),s.forEach(l=>t.step(l))}function yae(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;s++;let l=null;if(r instanceof yw){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let d=l[u],f;for(let h=0;h<i.length;h++){let p=i[h];p.step==s-1&&d.eq(i[h].style)&&(f=p)}f?(f.to=c,f.step=s):i.push({style:d,from:Math.max(a,e),to:c,step:s})}}}),i.forEach(o=>t.step(new so(o.from,o.to,o.style)))}function TT(t,e,n,r=n.contentMatch,i=!0){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<s.childCount;l++){let c=s.child(l),u=a+c.nodeSize,d=r.matchType(c.type);if(!d)o.push(new xr(a,u,rt.empty));else{r=d;for(let f=0;f<c.marks.length;f++)n.allowsMarkType(c.marks[f].type)||t.step(new so(a,u,c.marks[f]));if(i&&c.isText&&n.whitespace!="pre"){let f,h=/\r?\n|\r/g,p;for(;f=h.exec(c.text);)p||(p=new rt(De.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new xr(a+f.index,a+f.index+f[0].length,p))}}a=u}if(!r.validEnd){let l=r.fillBefore(De.empty,!0);t.replace(a,a,new rt(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function bae(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function mh(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,i=0,s=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+i,l=t.$to.indexAfter(r)-s;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!bae(o,a,l))break;a&&(i=1),l<o.childCount&&(s=1)}return null}function wae(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,u=De.empty,d=0;for(let p=s,m=!1;p>n;p--)m||r.index(p)>0?(m=!0,u=De.from(r.node(p).copy(u)),d++):l--;let f=De.empty,h=0;for(let p=s,m=!1;p>n;p--)m||i.after(p+1)<i.end(p)?(m=!0,f=De.from(i.node(p).copy(f)),h++):c++;t.step(new Pr(l,c,o,a,new rt(u.append(f),d,h),u.size-d,!0))}function CT(t,e,n=null,r=t){let i=vae(t,e),s=i&&xae(r,e);return s?i.map(JI).concat({type:e,attrs:n}).concat(s.map(JI)):null}function JI(t){return{type:t,attrs:null}}function vae(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function xae(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function Sae(t,e,n){let r=De.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=De.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new Pr(i,s,i,s,new rt(r,0,0),n.length,!0))}function kae(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof i=="function"?i(o):i;if(o.isTextblock&&!o.hasMarkup(r,l)&&Eae(t.doc,t.mapping.slice(s).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let h=r.whitespace=="pre",p=!!r.contentMatch.matchType(r.schema.linebreakReplacement);h&&!p?c=!1:!h&&p&&(c=!0)}c===!1&&W5(t,o,a,s),TT(t,t.mapping.slice(s).map(a,1),r,void 0,c===null);let u=t.mapping.slice(s),d=u.map(a,1),f=u.map(a+o.nodeSize,1);return t.step(new Pr(d,f,d+1,f-1,new rt(De.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&V5(t,o,a,s),!1}})}function V5(t,e,n,r){e.forEach((i,s)=>{if(i.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(i.text);){let l=t.mapping.slice(r).map(n+1+s+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function W5(t,e,n,r){e.forEach((i,s)=>{if(i.type==i.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+s);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function Eae(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function Tae(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Pr(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new rt(De.from(o),0,0),1,!0))}function rl(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,u=n-2;c>s;c--,u--){let d=i.node(c),f=i.index(c);if(d.type.spec.isolating)return!1;let h=d.content.cutByIndex(f,d.childCount),p=r&&r[u+1];p&&(h=h.replaceChild(0,p.type.create(p.attrs)));let m=r&&r[u]||d;if(!d.canReplace(f+1,d.childCount)||!m.type.validContent(h))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function Cae(t,e,n=1,r){let i=t.doc.resolve(e),s=De.empty,o=De.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=De.from(i.node(a).copy(s));let u=r&&r[c];o=De.from(u?u.type.create(u.attrs,o):i.node(a).copy(o))}t.step(new xr(e,e,new rt(s.append(o),n,n),!0))}function nu(t,e){let n=t.resolve(e),r=n.index();return j5(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function _ae(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let i=0;i<e.childCount;i++){let s=e.child(i),o=s.type==r?t.type.schema.nodes.text:s.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(s.marks))return!1}return n.validEnd}function j5(t,e){return!!(t&&e&&!t.isLeaf&&_ae(t,e))}function bw(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let s,o,a=r.index(i);if(i==r.depth?(s=r.nodeBefore,o=r.nodeAfter):n>0?(s=r.node(i+1),a++,o=r.node(i).maybeChild(a)):(s=r.node(i).maybeChild(a-1),o=r.node(i+1)),s&&!s.isTextblock&&j5(s,o)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=n<0?r.before(i):r.after(i)}}function Aae(t,e,n){let r=null,{linebreakReplacement:i}=t.doc.type.schema,s=t.doc.resolve(e-n),o=s.node().type;if(i&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(i);u&&!d?r=!1:!u&&d&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);W5(t,u.node(),u.before(),a)}o.inlineContent&&TT(t,e+n-1,o,s.node().contentMatchAt(s.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new xr(c,l.map(e+n,-1),rt.empty,!0)),r===!0){let u=t.doc.resolve(c);V5(t,u.node(),u.before(),t.steps.length)}return t}function Pae(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let s=r.index(i);if(r.node(i).canReplaceWith(s,s,n))return r.before(i+1);if(s>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let s=r.indexAfter(i);if(r.node(i).canReplaceWith(s,s,n))return r.after(i+1);if(s<r.node(i).childCount)return null}return null}function q5(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(n.openStart==0&&n.size?2:1);s++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(s==1)u=c.canReplace(l,l,i);else{let d=c.contentMatchAt(l).findWrapping(i.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function ww(t,e,n=e,r=rt.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return K5(i,s,r)?new xr(e,n,r):new Iae(i,s,r).fit()}function K5(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class Iae{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=De.empty;for(let i=0;i<=e.depth;i++){let s=e.node(i);this.frontier.push({type:s.type,match:s.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=De.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let s=this.placed,o=r.depth,a=i.depth;for(;o&&a&&s.childCount==1;)s=s.firstChild.content,o--,a--;let l=new rt(s,o,a);return e>-1?new Pr(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new xr(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let s=n.firstChild;if(n.childCount>1&&(i=0),s.type.spec.isolating&&i<=r){e=r;break}n=s.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let i,s=null;r?(s=X1(this.unplaced.content,r-1).firstChild,i=s.content):i=this.unplaced.content;let o=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(n==1&&(o?c.matchType(o.type)||(d=c.fillBefore(De.from(o),!1)):s&&l.compatibleContent(s.type)))return{sliceDepth:r,frontierDepth:a,parent:s,inject:d};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:s,wrap:u};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=X1(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new rt(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=X1(e,n);if(i.childCount<=1&&n>0){let s=e.size-n<=n+i.size;this.unplaced=new rt(up(e,n-1,1),n-1,s?n-1:r)}else this.unplaced=new rt(up(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:s}){for(;this.depth>n;)this.closeFrontierNode();if(s)for(let m=0;m<s.length;m++)this.openFrontierNode(s[m]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:f}=this.frontier[n];if(i){for(let m=0;m<i.childCount;m++)u.push(i.child(m));d=d.matchFragment(i)}let h=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(G5(m.mark(f.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?h:-1)))}let p=c==a.childCount;p||(h=-1),this.placed=dp(this.placed,n,De.from(u)),this.frontier[n].match=d,p&&h<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<h;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?rt.empty:new rt(up(o.content,e-1,1),e-1,h<0?o.openEnd:e-1):new rt(up(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Q1(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],s=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=Q1(e,n,i,r,s);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=Q1(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:s?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=dp(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),s=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,s)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=dp(this.placed,this.depth,De.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(De.empty,!0);n.childCount&&(this.placed=dp(this.placed,this.frontier.length,n))}}function up(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(up(t.firstChild.content,e-1,n)))}function dp(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(dp(t.lastChild.content,e-1,n)))}function X1(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function G5(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,G5(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(De.empty,!0)))),t.copy(r)}function Q1(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!Oae(n,s.content,o)?a:null}function Oae(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function Mae(t){return t.spec.defining||t.spec.definingForContent}function Nae(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(K5(i,s,r))return t.step(new xr(e,n,r));let o=X5(i,s);o[o.length-1]==0&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let f=i.depth,h=i.pos-1;f>0;f--,h--){let p=i.node(f).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(f)>-1?a=f:i.before(f)==h&&o.splice(1,0,-f)}let l=o.indexOf(a),c=[],u=r.openStart;for(let f=r.content,h=0;;h++){let p=f.firstChild;if(c.push(p),h==r.openStart)break;f=p.content}for(let f=u-1;f>=0;f--){let h=c[f],p=Mae(h.type);if(p&&!h.sameMarkup(i.node(Math.abs(a)-1)))u=f;else if(p||!h.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let h=(f+u+1)%(r.openStart+1),p=c[h];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let b=i.node(g-1),S=i.index(g-1);if(b.canReplaceWith(S,S,p.type,p.marks))return t.replace(i.before(g),y?s.after(g):n,new rt(Z5(r.content,0,r.openStart,h),h,r.openEnd))}}let d=t.steps.length;for(let f=o.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>d));f--){let h=o[f];h<0||(e=i.before(h),n=s.after(h))}}function Z5(t,e,n,r,i){if(e<n){let s=t.firstChild;t=t.replaceChild(0,s.copy(Z5(s.content,e+1,n,r,s)))}if(e>r){let s=i.contentMatchAt(0),o=s.fillBefore(t).append(t);t=o.append(s.matchFragment(o).fillBefore(De.empty,!0))}return t}function Rae(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=Pae(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new rt(De.from(r),0,0))}function Dae(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=X5(r,i);for(let o=0;o<s.length;o++){let a=s[o],l=o==s.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o&&r.start(o-1)==i.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),i.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function X5(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let s=t.start(i);if(s<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(s==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==s-1)&&n.push(i)}return n}class Cf extends mi{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return fr.fail("No node at attribute step's position");let r=Object.create(null);for(let s in n.attrs)r[s]=n.attrs[s];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return fr.fromReplace(e,this.pos,this.pos+1,new rt(De.from(i),0,n.isLeaf?0:1))}getMap(){return ls.empty}invert(e){return new Cf(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Cf(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Cf(n.pos,n.attr,n.value)}}mi.jsonID("attr",Cf);class um extends mi{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return fr.ok(r)}getMap(){return ls.empty}invert(e){return new um(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new um(n.attr,n.value)}}mi.jsonID("docAttr",um);let Gf=class extends Error{};Gf=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Gf.prototype=Object.create(Error.prototype);Gf.prototype.constructor=Gf;Gf.prototype.name="TransformError";class Q5{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new cm}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Gf(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=rt.empty){let i=ww(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new rt(De.from(r),0,0))}delete(e,n){return this.replace(e,n,rt.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return Nae(this,e,n,r),this}replaceRangeWith(e,n,r){return Rae(this,e,n,r),this}deleteRange(e,n){return Dae(this,e,n),this}lift(e,n){return wae(this,e,n),this}join(e,n=1){return Aae(this,e,n),this}wrap(e,n){return Sae(this,e,n),this}setBlockType(e,n=e,r,i=null){return kae(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i){return Tae(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new Cf(e,n,r)),this}setDocAttribute(e,n){return this.step(new um(e,n)),this}addNodeMark(e,n){return this.step(new bc(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof An)n.isInSet(r.marks)&&this.step(new ld(e,n));else{let i=r.marks,s,o=[];for(;s=n.isInSet(i);)o.push(new ld(e,s)),i=s.removeFromSet(i);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return Cae(this,e,n,r),this}addMark(e,n,r){return gae(this,e,n,r),this}removeMark(e,n,r){return yae(this,e,n,r),this}clearIncompatible(e,n,r){return TT(this,e,n,r),this}}const Y1=Object.create(null);class Bt{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new Lae(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=rt.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let s=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(s);e.replaceRange(u.map(l.pos),u.map(c.pos),a?rt.empty:n),a==0&&n3(e,s,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let s=0;s<i.length;s++){let{$from:o,$to:a}=i[s],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);s?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),n3(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new At(e):qd(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let s=e.depth-1;s>=0;s--){let o=n<0?qd(e.node(0),e.node(s),e.before(s+1),e.index(s),n,r):qd(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new ps(e.node(0))}static atStart(e){return qd(e,e,0,0,1)||new ps(e)}static atEnd(e){return qd(e,e,e.content.size,e.childCount,-1)||new ps(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Y1[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Y1)throw new RangeError("Duplicate use of selection JSON ID "+e);return Y1[e]=n,n.prototype.jsonID=e,n}getBookmark(){return At.between(this.$anchor,this.$head).getBookmark()}}Bt.prototype.visible=!0;class Lae{constructor(e,n){this.$from=e,this.$to=n}}let e3=!1;function t3(t){!e3&&!t.parent.inlineContent&&(e3=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class At extends Bt{constructor(e,n=e){t3(e),t3(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return Bt.near(r);let i=e.resolve(n.map(this.anchor));return new At(i.parent.inlineContent?i:r,r)}replace(e,n=rt.empty){if(super.replace(e,n),n==rt.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof At&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new vw(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new At(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let s=Bt.findFrom(n,r,!0)||Bt.findFrom(n,-r,!0);if(s)n=s.$head;else return Bt.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(Bt.findFrom(e,-r,!0)||Bt.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new At(e,n)}}Bt.jsonID("text",At);class vw{constructor(e,n){this.anchor=e,this.head=n}map(e){return new vw(e.map(this.anchor),e.map(this.head))}resolve(e){return At.between(e.resolve(this.anchor),e.resolve(this.head))}}class dt extends Bt{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),s=e.resolve(i);return r?Bt.near(s):new dt(s)}content(){return new rt(De.from(this.node),0,0)}eq(e){return e instanceof dt&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new _T(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new dt(e.resolve(n.anchor))}static create(e,n){return new dt(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}dt.prototype.visible=!1;Bt.jsonID("node",dt);class _T{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new vw(r,r):new _T(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&dt.isSelectable(r)?new dt(n):Bt.near(n)}}class ps extends Bt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=rt.empty){if(n==rt.empty){e.delete(0,e.doc.content.size);let r=Bt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new ps(e)}map(e){return new ps(e)}eq(e){return e instanceof ps}getBookmark(){return Bae}}Bt.jsonID("all",ps);const Bae={map(){return this},resolve(t){return new ps(t)}};function qd(t,e,n,r,i,s=!1){if(e.inlineContent)return At.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let a=e.child(o);if(a.isAtom){if(!s&&dt.isSelectable(a))return dt.create(t,n-(i<0?a.nodeSize:0))}else{let l=qd(t,a,n+i,i<0?a.childCount:0,i,s);if(l)return l}n+=a.nodeSize*i}return null}function n3(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof xr||i instanceof Pr))return;let s=t.mapping.maps[r],o;s.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(Bt.near(t.doc.resolve(o),n))}const r3=1,Ug=2,i3=4;class Fae extends Q5{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|r3)&~Ug,this.storedMarks=null,this}get selectionSet(){return(this.updated&r3)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Ug,this}ensureMarks(e){return An.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Ug)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Ug,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||An.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let s=this.storedMarks;if(!s){let o=this.doc.resolve(n);s=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,s)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(Bt.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=i3,this}get scrolledIntoView(){return(this.updated&i3)>0}}function s3(t,e){return!e||!t?t:t.bind(e)}class fp{constructor(e,n,r){this.name=e,this.init=s3(n.init,r),this.apply=s3(n.apply,r)}}const $ae=[new fp("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new fp("selection",{init(t,e){return t.selection||Bt.atStart(e.doc)},apply(t){return t.selection}}),new fp("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new fp("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class J1{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=$ae.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new fp(r.key,r.spec.state,r))})}}class lf{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let s=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=i?i[o].n:0,c=i?i[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!i){i=[];for(let d=0;d<this.config.plugins.length;d++)i.push(d<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),s=!0}i&&(i[o]={state:r,n:n.length})}}if(!s)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new lf(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let s=r[i];n[s.name]=s.apply(e,this[s.name],this,n)}return n}get tr(){return new Fae(this)}static create(e){let n=new J1(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new lf(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new J1(this.schema,e.plugins),r=n.fields,i=new lf(n);for(let s=0;s<r.length;s++){let o=r[s].name;i[o]=this.hasOwnProperty(o)?this[o]:r[s].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],s=i.spec.state;s&&s.toJSON&&(n[r]=s.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new J1(e.schema,e.plugins),s=new lf(i);return i.fields.forEach(o=>{if(o.name=="doc")s.doc=Ac.fromJSON(e.schema,n.doc);else if(o.name=="selection")s.selection=Bt.fromJSON(s.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(s.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){s[o.name]=c.fromJSON.call(l,e,n[a],s);return}}s[o.name]=o.init(e,s)}}),s}}function Y5(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=Y5(i,e,{})),n[r]=i}return n}class cn{constructor(e){this.spec=e,this.props={},e.props&&Y5(e.props,this,this.props),this.key=e.key?e.key.key:J5("plugin")}getState(e){return e[this.key]}}const e2=Object.create(null);function J5(t){return t in e2?t+"$"+ ++e2[t]:(e2[t]=0,t+"$")}class En{constructor(e="key"){this.key=J5(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const AT=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function eL(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const tL=(t,e,n)=>{let r=eL(t,n);if(!r)return!1;let i=PT(r);if(!i){let o=r.blockRange(),a=o&&mh(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let s=i.nodeBefore;if(uL(t,i,e,-1))return!0;if(r.parent.content.size==0&&(Zf(s,"end")||dt.isSelectable(s)))for(let o=r.depth;;o--){let a=ww(t.doc,r.before(o),r.after(o),rt.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Zf(s,"end")?Bt.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):dt.create(l.doc,i.pos-s.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0):!1},zae=(t,e,n)=>{let r=eL(t,n);if(!r)return!1;let i=PT(r);return i?nL(t,i,e):!1},Uae=(t,e,n)=>{let r=iL(t,n);if(!r)return!1;let i=IT(r);return i?nL(t,i,e):!1};function nL(t,e,n){let r=e.nodeBefore,i=r,s=e.pos-1;for(;!i.isTextblock;s--){if(i.type.spec.isolating)return!1;let u=i.lastChild;if(!u)return!1;i=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=ww(t.doc,s,l,rt.empty);if(!c||c.from!=s||c instanceof xr&&c.slice.size>=l-s)return!1;if(n){let u=t.tr.step(c);u.setSelection(At.create(u.doc,s)),n(u.scrollIntoView())}return!0}function Zf(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const rL=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=PT(r)}let o=s&&s.nodeBefore;return!o||!dt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(dt.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)};function PT(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function iL(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const sL=(t,e,n)=>{let r=iL(t,n);if(!r)return!1;let i=IT(r);if(!i)return!1;let s=i.nodeAfter;if(uL(t,i,e,1))return!0;if(r.parent.content.size==0&&(Zf(s,"start")||dt.isSelectable(s))){let o=ww(t.doc,r.before(),r.after(),rt.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Zf(s,"start")?Bt.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):dt.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return s.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1},oL=(t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=IT(r)}let o=s&&s.nodeAfter;return!o||!dt.isSelectable(o)?!1:(e&&e(t.tr.setSelection(dt.create(t.doc,s.pos)).scrollIntoView()),!0)};function IT(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const Hae=(t,e)=>{let n=t.selection,r=n instanceof dt,i;if(r){if(n.node.isTextblock||!nu(t.doc,n.from))return!1;i=n.from}else if(i=bw(t.doc,n.from,-1),i==null)return!1;if(e){let s=t.tr.join(i);r&&s.setSelection(dt.create(s.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(s.scrollIntoView())}return!0},Vae=(t,e)=>{let n=t.selection,r;if(n instanceof dt){if(n.node.isTextblock||!nu(t.doc,n.to))return!1;r=n.to}else if(r=bw(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},Wae=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&mh(i);return s==null?!1:(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},aL=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function OT(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const jae=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=OT(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(Bt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},lL=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof ps||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=OT(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let o=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(o,s.createAndFill());a.setSelection(At.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},cL=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let s=n.before();if(rl(t.doc,s))return e&&e(t.tr.split(s).scrollIntoView()),!0}let r=n.blockRange(),i=r&&mh(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function qae(t){return(e,n)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof dt&&e.selection.node.isBlock)return!r.parentOffset||!rl(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let s=[],o,a,l=!1,c=!1;for(let h=r.depth;;h--)if(r.node(h).isBlock){l=r.end(h)==r.pos+(r.depth-h),c=r.start(h)==r.pos-(r.depth-h),a=OT(r.node(h-1).contentMatchAt(r.indexAfter(h-1))),s.unshift(l&&a?{type:a}:null),o=h;break}else{if(h==1)return!1;s.unshift(null)}let u=e.tr;(e.selection instanceof At||e.selection instanceof ps)&&u.deleteSelection();let d=u.mapping.map(r.pos),f=rl(u.doc,d,s.length,s);if(f||(s[0]=a?{type:a}:null,f=rl(u.doc,d,s.length,s)),!f)return!1;if(u.split(d,s.length,s),!l&&c&&r.node(o).type!=a){let h=u.mapping.map(r.before(o)),p=u.doc.resolve(h);a&&r.node(o-1).canReplaceWith(p.index(),p.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const Kae=qae(),Gae=(t,e)=>{let{$from:n,to:r}=t.selection,i,s=n.sharedDepth(r);return s==0?!1:(i=n.before(s),e&&e(t.tr.setSelection(dt.create(t.doc,i))),!0)};function Zae(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(s,s+1)||!(i.isTextblock||nu(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function uL(t,e,n,r){let i=e.nodeBefore,s=e.nodeAfter,o,a,l=i.type.spec.isolating||s.type.spec.isolating;if(!l&&Zae(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=i.contentMatchAt(i.childCount)).findWrapping(s.type))&&a.matchType(o[0]||s.type).validEnd){if(n){let h=e.pos+s.nodeSize,p=De.empty;for(let y=o.length-1;y>=0;y--)p=De.from(o[y].create(null,p));p=De.from(i.copy(p));let m=t.tr.step(new Pr(e.pos-1,h,e.pos,h,new rt(p,1,0),o.length,!0)),g=m.doc.resolve(h+2*o.length);g.nodeAfter&&g.nodeAfter.type==i.type&&nu(m.doc,g.pos)&&m.join(g.pos),n(m.scrollIntoView())}return!0}let u=s.type.spec.isolating||r>0&&l?null:Bt.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),f=d&&mh(d);if(f!=null&&f>=e.depth)return n&&n(t.tr.lift(d,f).scrollIntoView()),!0;if(c&&Zf(s,"start",!0)&&Zf(i,"end")){let h=i,p=[];for(;p.push(h),!h.isTextblock;)h=h.lastChild;let m=s,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(h.canReplace(h.childCount,h.childCount,m.content)){if(n){let y=De.empty;for(let S=p.length-1;S>=0;S--)y=De.from(p[S].copy(y));let b=t.tr.step(new Pr(e.pos-p.length,e.pos+s.nodeSize,e.pos+g,e.pos+s.nodeSize-g,new rt(y,p.length,0),0,!0));n(b.scrollIntoView())}return!0}}return!1}function dL(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return i.node(s).isTextblock?(n&&n(e.tr.setSelection(At.create(e.doc,t<0?i.start(s):i.end(s)))),!0):!1}}const Xae=dL(-1),Qae=dL(1);function Yae(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&CT(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function o3(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[s];n.doc.nodesBetween(o,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let u=n.doc.resolve(c),d=u.index();i=u.parent.canReplaceWith(d,d+1,t)}})}if(!i)return!1;if(r){let s=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];s.setBlockType(a,l,t,e)}r(s.scrollIntoView())}return!0}}function MT(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}MT(AT,tL,rL);MT(AT,sL,oL);MT(aL,lL,cL,Kae);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Jae(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s);if(!o)return!1;let a=r?n.tr:null;return ele(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function ele(t,e,n,r=null){let i=!1,s=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);s=new My(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new My(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=CT(s,n,r,e);return a?(t&&tle(t,e,a,i,n),!0):!1}function tle(t,e,n,r,i){let s=De.empty;for(let u=n.length-1;u>=0;u--)s=De.from(n[u].type.create(n[u].attrs,s));t.step(new Pr(e.start-(r?2:0),e.end,e.start,e.end,new rt(s,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==i&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,f=!0;u<d;u++,f=!1)!f&&rl(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function nle(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,o=>o.childCount>0&&o.firstChild.type==t);return s?n?r.node(s.depth-1).type==t?rle(e,n,t,s):ile(e,n,s):!0:!1}}function rle(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new Pr(s-1,o,s,o,new rt(De.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new My(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=mh(r);if(a==null)return!1;i.lift(r,a);let l=i.doc.resolve(i.mapping.map(s,-1)-1);return nu(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function ile(t,e,n){let r=t.tr,i=n.parent;for(let h=n.end,p=n.endIndex-1,m=n.startIndex;p>m;p--)h-=i.child(p).nodeSize,r.delete(h-1,h+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=s.node(-1),u=s.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?De.empty:De.from(i))))return!1;let d=s.pos,f=d+o.nodeSize;return r.step(new Pr(d-(a?1:0),f+(l?1:0),d+1,f-1,new rt((a?De.empty:De.from(i.copy(De.empty))).append(l?De.empty:De.from(i.copy(De.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function sle(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!s)return!1;let o=s.startIndex;if(o==0)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=De.from(c?t.create():null),d=new rt(De.from(t.create(null,De.from(a.type.create(null,u)))),c?3:1,0),f=s.start,h=s.end;n(e.tr.step(new Pr(f-(c?3:1),h,f,h,d,1,!0)).scrollIntoView())}return!0}}const qr=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Xf=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let fS=null;const Ma=function(t,e,n){let r=fS||(fS=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},ole=function(){fS=null},cd=function(t,e,n,r){return n&&(a3(t,e,n,r,-1)||a3(t,e,n,r,1))},ale=/^(img|br|input|textarea|hr)$/i;function a3(t,e,n,r,i){for(var s;;){if(t==n&&e==r)return!0;if(e==(i<0?0:Rs(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Qm(t)||ale.test(t.nodeName)||t.contentEditable=="false")return!1;e=qr(t)+(i<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(i<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((s=o.pmViewDesc)===null||s===void 0)&&s.ignoreForSelection)e+=i;else return!1;else t=o,e=i<0?Rs(t):0}else return!1}}function Rs(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function lle(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Rs(t)}else if(t.parentNode&&!Qm(t))e=qr(t),t=t.parentNode;else return null}}function cle(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Qm(t))e=qr(t)+1,t=t.parentNode;else return null}}function ule(t,e,n){for(let r=e==0,i=e==Rs(t);r||i;){if(t==n)return!0;let s=qr(t);if(t=t.parentNode,!t)return!1;r=r&&s==0,i=i&&s==Rs(t)}}function Qm(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const xw=function(t){return t.focusNode&&cd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function ku(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function dle(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function fle(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(Rs(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(Rs(r.startContainer),r.startOffset)}}}const ra=typeof navigator<"u"?navigator:null,l3=typeof document<"u"?document:null,ru=ra&&ra.userAgent||"",hS=/Edge\/(\d+)/.exec(ru),fL=/MSIE \d/.exec(ru),pS=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ru),Xi=!!(fL||pS||hS),Ic=fL?document.documentMode:pS?+pS[1]:hS?+hS[1]:0,Us=!Xi&&/gecko\/(\d+)/i.test(ru);Us&&+(/Firefox\/(\d+)/.exec(ru)||[0,0])[1];const mS=!Xi&&/Chrome\/(\d+)/.exec(ru),Cr=!!mS,hL=mS?+mS[1]:0,Yr=!Xi&&!!ra&&/Apple Computer/.test(ra.vendor),Qf=Yr&&(/Mobile\/\w+/.test(ru)||!!ra&&ra.maxTouchPoints>2),Os=Qf||(ra?/Mac/.test(ra.platform):!1),pL=ra?/Win/.test(ra.platform):!1,Qa=/Android \d/.test(ru),Ym=!!l3&&"webkitFontSmoothing"in l3.documentElement.style,hle=Ym?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function ple(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function xa(t,e){return typeof t=="number"?t:t[e]}function mle(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function c3(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=Xf(o);continue}let a=o,l=a==s.body,c=l?ple(s):mle(a),u=0,d=0;if(e.top<c.top+xa(r,"top")?d=-(c.top-e.top+xa(i,"top")):e.bottom>c.bottom-xa(r,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+xa(i,"top")-c.top:e.bottom-c.bottom+xa(i,"bottom")),e.left<c.left+xa(r,"left")?u=-(c.left-e.left+xa(i,"left")):e.right>c.right-xa(r,"right")&&(u=e.right-c.right+xa(i,"right")),u||d)if(l)s.defaultView.scrollBy(u,d);else{let h=a.scrollLeft,p=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let m=a.scrollLeft-h,g=a.scrollTop-p;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}let f=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:Xf(o)}}function gle(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let s=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(s,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:mL(t.dom)}}function mL(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=Xf(r));return e}function yle({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;gL(n,r==0?0:r-e)}function gL(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let Ld=null;function ble(t){if(t.setActive)return t.setActive();if(Ld)return t.focus(Ld);let e=mL(t);t.focus(Ld==null?{get preventScroll(){return Ld={preventScroll:!0},!0}}:void 0),Ld||(Ld=!1,gL(e,0))}function yL(t,e){let n,r=2e8,i,s=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,d=0;u;u=u.nextSibling,d++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=Ma(u).getClientRects();else continue;for(let h=0;h<f.length;h++){let p=f[h];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<r){n=u,r=m,i=m&&n.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&m&&(s=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(s=d+1)}}return!n&&l&&(n=l,i=c,r=0),n&&n.nodeType==3?wle(n,i):!n||r&&n.nodeType==1?{node:t,offset:s}:yL(n,i)}function wle(t,e){let n=t.nodeValue.length,r=document.createRange(),i;for(let s=0;s<n;s++){r.setEnd(t,s+1),r.setStart(t,s);let o=tc(r,1);if(o.top!=o.bottom&&NT(e,o)){i={node:t,offset:s+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),i||{node:t,offset:0}}function NT(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function vle(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function xle(t,e,n){let{node:r,offset:i}=yL(e,n),s=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();s=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function Sle(t,e,n,r){let i=-1;for(let s=e,o=!1;s!=t.dom;){let a=t.docView.nearestDesc(s,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?i=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),o=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;s=a.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function bL(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let o=t.childNodes[s];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(NT(e,c))return bL(o,e,c)}}if((s=(s+1)%r)==i)break}return t}function kle(t,e){let n=t.dom.ownerDocument,r,i=0,s=fle(n,e.left,e.top);s&&({node:r,offset:i}=s);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!NT(e,c)||(o=bL(t.dom,e,c),!o))return null}if(Yr)for(let c=o;r&&c;c=Xf(c))c.draggable&&(r=void 0);if(o=vle(o,e),r){if(Us&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let u=r.childNodes[i],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&i++}let c;Ym&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=Sle(t,r,i,e))}a==null&&(a=xle(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function u3(t){return t.top<t.bottom||t.left<t.right}function tc(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(u3(r))return r}return Array.prototype.find.call(n,u3)||t.getBoundingClientRect()}const Ele=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function wL(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=Ym||Us;if(r.nodeType==3)if(o&&(Ele.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=tc(Ma(r,i,i),n);if(Us&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=tc(Ma(r,i-1,i-1),-1);if(c.top==l.top){let u=tc(Ma(r,i,i+1),-1);if(u.top!=l.top)return Zh(u,u.left<c.left)}}return l}else{let l=i,c=i,u=n<0?1:-1;return n<0&&!i?(c++,u=-1):n>=0&&i==r.nodeValue.length?(l--,u=1):n<0?l--:c++,Zh(tc(Ma(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(s==null&&i&&(n<0||i==Rs(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return t2(l.getBoundingClientRect(),!1)}if(s==null&&i<Rs(r)){let l=r.childNodes[i];if(l.nodeType==1)return t2(l.getBoundingClientRect(),!0)}return t2(r.getBoundingClientRect(),n>=0)}if(s==null&&i&&(n<0||i==Rs(r))){let l=r.childNodes[i-1],c=l.nodeType==3?Ma(l,Rs(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Zh(tc(c,1),!1)}if(s==null&&i<Rs(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Ma(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Zh(tc(c,-1),!0)}return Zh(tc(r.nodeType==3?Ma(r):r,-n),n>=0)}function Zh(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function t2(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function vL(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function Tle(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return vL(t,e,()=>{let{node:s}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.contentDOM||a.dom;break}s=a.dom.parentNode}let o=wL(t,i.pos,1);for(let a=s.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Ma(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const Cle=/[\u0590-\u08ac]/;function _le(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return a?!Cle.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?s:o:vL(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=t.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",n,"character");let h=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:p,focusOffset:m}=t.domSelectionRange(),g=p&&!h.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==m;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return f!=null&&(a.caretBidiLevel=f),g}):r.pos==r.start()||r.pos==r.end()}let d3=null,f3=null,h3=!1;function Ale(t,e,n){return d3==e&&f3==n?h3:(d3=e,f3=n,h3=n=="up"||n=="down"?Tle(t,e,n):_le(t,e,n))}const Hs=0,p3=1,Iu=2,ia=3;class Jm{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=Hs,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let s,o;if(e==this.contentDOM)s=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.previousSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.previousSibling;return s?this.posBeforeChild(o)+o.size:this.posAtStart}else{let s,o;if(e==this.contentDOM)s=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((o=s.pmViewDesc)&&o.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(o):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>qr(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!1;break}if(s.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let s=e;;s=s.parentNode){if(s==this.dom){i=!0;break}if(s.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let s=this.getDesc(i),o;if(s&&(!n||s.node))if(r&&(o=s.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return s}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let s=this.getDesc(i);if(s)return s.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],s=r+i.size;if(r==e&&s!=r){for(;!i.border&&i.children.length;)for(let o=0;o<i.children.length;o++){let a=i.children[o];if(a.size){i=a;break}}return i}if(e<s)return i.descAt(e-r-i.border);r=s}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let s=0;r<this.children.length;r++){let o=this.children[r],a=s+o.size;if(a>e||o instanceof SL){i=e-s;break}s=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let s;r&&!(s=this.children[r-1]).size&&s instanceof xL&&s.side>=0;r--);if(n<=0){let s,o=!0;for(;s=r?this.children[r-1]:null,!(!s||s.dom.parentNode==this.contentDOM);r--,o=!1);return s&&n&&o&&!s.border&&!s.domAtom?s.domFromPos(s.size,n):{node:this.contentDOM,offset:s?qr(s.dom)+1:0}}else{let s,o=!0;for(;s=r<this.children.length?this.children[r]:null,!(!s||s.dom.parentNode==this.contentDOM);r++,o=!1);return s&&o&&!s.border&&!s.domAtom?s.domFromPos(0,n):{node:this.contentDOM,offset:s?qr(s.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,s=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(i==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let d=a;d>0;d--){let f=this.children[d-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){i=qr(f.dom)+1;break}e-=f.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){s=qr(d.dom);break}n+=d.size}s==-1&&(s=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let s=Math.min(e,n),o=Math.max(e,n);for(let h=0,p=0;h<this.children.length;h++){let m=this.children[h],g=p+m.size;if(s>p&&o<g)return m.setSelection(e-p-m.border,n-p-m.border,r,i);p=g}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),d=!1;if((Us||Yr)&&e==n){let{node:h,offset:p}=a;if(h.nodeType==3){if(d=!!(p&&h.nodeValue[p-1]==`
`),d&&p==h.nodeValue.length)for(let m=h,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:qr(g)+1});break}let y=m.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let m=h.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(Us&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let h=u.focusNode.childNodes[u.focusOffset];h&&h.contentEditable=="false"&&(i=!0)}if(!(i||d&&Yr)&&cd(a.node,a.offset,u.anchorNode,u.anchorOffset)&&cd(l.node,l.offset,u.focusNode,u.focusOffset))return;let f=!1;if((c.extend||e==n)&&!(d&&Us)){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>n){let p=a;a=l,l=p}let h=document.createRange();h.setEnd(l.node,l.offset),h.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(h)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let s=this.children[i],o=r+s.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+s.border,l=o-s.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?Iu:p3,e==a&&n==l&&(s.contentLost||s.dom.parentNode!=this.contentDOM)?s.dirty=ia:s.markDirty(e-a,n-a);return}else s.dirty=s.dom==s.contentDOM&&s.dom.parentNode==this.contentDOM&&!s.children.length?Iu:ia}r=o}this.dirty=Iu}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Iu:p3;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class xL extends Jm{constructor(e,n,r,i){let s,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!s)return i;if(s.parent)return s.parent.posBeforeChild(s)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,s=this}matchesWidget(e){return this.dirty==Hs&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class Ple extends Jm{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class ud extends Jm{constructor(e,n,r,i,s){super(e,[],r,i),this.mark=n,this.spec=s}static create(e,n,r,i){let s=i.nodeViews[n.type.name],o=s&&s(n,i,r);return(!o||!o.dom)&&(o=bd.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new ud(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&ia||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=ia&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Hs){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Hs}}slice(e,n,r){let i=ud.create(this.parent,this.mark,!0,r),s=this.children,o=this.size;n<o&&(s=yS(s,n,o,r)),e>0&&(s=yS(s,0,e,r));for(let a=0;a<s.length;a++)s[a].parent=i;return i.children=s,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Oc extends Jm{constructor(e,n,r,i,s,o,a,l,c){super(e,[],s,o),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,n,r,i,s,o){let a=s.nodeViews[n.type.name],l,c=a&&a(n,s,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,i),u=c&&c.dom,d=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=bd.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!d&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let f=u;return u=TL(u,r,n),c?l=new Ile(e,n,r,i,u,d||null,f,c,s,o+1):n.isText?new Sw(e,n,r,i,u,f,s):new Oc(e,n,r,i,u,d||null,f,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>De.empty)}return e}matchesNode(e,n,r){return this.dirty==Hs&&e.eq(this.node)&&Ry(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,s=e.composing?this.localCompositionInfo(e,n):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,l=new Mle(this,o&&o.node,e);Dle(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e,u):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?An.none:this.node.child(u).marks,r,e,u),l.placeWidget(c,e,i)},(c,u,d,f)=>{l.syncToMarks(c.marks,r,e,f);let h;l.findNodeMatch(c,u,d,f)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(h=l.findIndexWithChild(s.node))>-1&&l.updateNodeAt(c,u,d,h,e)||l.updateNextNode(c,u,d,e,f,i)||l.addNode(c,u,d,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e,0),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Iu)&&(o&&this.protectLocalComposition(e,o),kL(this.contentDOM,this.children,e),Qf&&Lle(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof At)||r<n||i>n+this.node.content.size)return null;let s=e.input.compositionNode;if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let o=s.nodeValue,a=Ble(this.node.content,o,r-n,i-n);return a<0?null:{node:s,pos:a,text:o}}else return{node:s,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let s=n;for(;s.parentNode!=this.contentDOM;s=s.parentNode){for(;s.previousSibling;)s.parentNode.removeChild(s.previousSibling);for(;s.nextSibling;)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let o=new Ple(this,s,n,i);e.input.compositionNodes.push(o),this.children=yS(this.children,r,r+i.length,e,o)}update(e,n,r,i){return this.dirty==ia||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=Hs}updateOuterDeco(e){if(Ry(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=EL(this.dom,this.nodeDOM,gS(this.outerDeco,this.node,n),gS(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function m3(t,e,n,r,i){TL(r,e,t);let s=new Oc(void 0,t,e,n,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class Sw extends Oc{constructor(e,n,r,i,s,o,a){super(e,n,r,i,s,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==ia||this.dirty!=Hs&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Hs||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=Hs,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),s=document.createTextNode(i.text);return new Sw(this.parent,i,this.outerDeco,this.innerDeco,s,s,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=ia)}get domAtom(){return!1}isText(e){return this.node.text==e}}class SL extends Jm{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Hs&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class Ile extends Oc{constructor(e,n,r,i,s,o,a,l,c,u){super(e,n,r,i,s,o,a,c,u),this.spec=l}update(e,n,r,i){if(this.dirty==ia)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let s=this.spec.update(e,n,r);return s&&this.updateInner(e,n,r,i),s}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function kL(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=g3(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof ud){let l=r?r.previousSibling:t.lastChild;kL(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=g3(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const Np=function(t){t&&(this.nodeName=t)};Np.prototype=Object.create(null);const Ou=[new Np];function gS(t,e,n){if(t.length==0)return Ou;let r=n?Ou[0]:new Np,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new Np(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&i.length==1&&i.push(r=new Np(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function EL(t,e,n,r){if(n==Ou&&r==Ou)return e;let i=e;for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(s){let l;a&&a.nodeName==o.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Ou[0]),i=l}Ole(i,a||Ou[0],o)}return i}function Ole(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let s=0;s<r.length;s++)i.indexOf(r[s])==-1&&t.classList.remove(r[s]);for(let s=0;s<i.length;s++)r.indexOf(i[s])==-1&&t.classList.add(i[s]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function TL(t,e,n){return EL(t,t,Ou,gS(e,n,t.nodeType!=1))}function Ry(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function g3(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Mle{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Nle(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r,i){let s=0,o=this.stack.length>>1,a=Math.min(o,e.length);for(;s<a&&(s==o-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<o;)this.destroyRest(),this.top.dirty=Hs,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<e.length;){this.stack.push(this.top,this.index+1);let l=-1,c=this.top.children.length;i<this.preMatch.index&&(c=Math.min(this.index+3,c));for(let u=this.index;u<c;u++){let d=this.top.children[u];if(d.matchesMark(e[o])&&!this.isLocked(d.dom)){l=u;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let u=ud.create(this.top,e[o],n,r);this.top.children.splice(this.index,0,u),this.top=u,this.changed=!0}this.index=0,o++}}findNodeMatch(e,n,r,i){let s=-1,o;if(i>=this.preMatch.index&&(o=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))s=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){s=a;break}}return s<0?!1:(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(e,n,r,i,s){let o=this.top.children[i];return o.dirty==ia&&o.dom==o.contentDOM&&(o.dirty=Iu),o.update(e,n,r,s)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,s,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Oc){let c=this.preMatch.matched.get(l);if(c!=null&&c!=s)return!1;let u=l.dom,d,f=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=ia&&Ry(n,l.outerDeco));if(!f&&l.update(e,n,r,i))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(d=this.recreateWrapper(l,e,n,r,i,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=Iu,d.updateChildren(i,o+1),d.dirty=Hs),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,i,s,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Ry(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=Oc.create(this.top,n,r,i,s,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,i,s){let o=Oc.create(this.top,e,n,r,i,s);o.contentDOM&&o.updateChildren(i,s+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let s=new xL(this.top,e,n,r);this.top.children.splice(this.index++,0,s),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof ud;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Sw)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Yr||Cr)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new SL(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function Nle(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof ud)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function Rle(t,e){return t.type.side-e.type.side}function Dle(t,e,n,r){let i=e.locals(t),s=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,i,e.forChild(s,u),c),s+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<i.length&&i[o].to==s;){let g=i[o++];g.widget&&(u?(d||(d=[u])).push(g):u=g)}if(u)if(d){d.sort(Rle);for(let g=0;g<d.length;g++)n(d[g],c,!!l)}else n(u,c,!!l);let f,h;if(l)h=-1,f=l,l=null;else if(c<t.childCount)h=c,f=t.child(c++);else break;for(let g=0;g<a.length;g++)a[g].to<=s&&a.splice(g--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+f.nodeSize;if(f.isText){let g=p;o<i.length&&i[o].from<g&&(g=i[o].from);for(let y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<p&&(l=f.cut(g-s),f=f.cut(0,g-s),p=g,h=-1)}else for(;o<i.length&&i[o].to<p;)o++;let m=f.isInline&&!f.isLeaf?a.filter(g=>!g.inline):a.slice();r(f,m,e.forChild(s,f),h),s=p}}function Lle(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Ble(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let c=t.child(i++);if(s+=c.nodeSize,!c.isText)break;l+=c.text}if(s>=n){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function yS(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),u>n&&s.push(l.slice(n-c,l.size,r)))}return s}function RT(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&i.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(xw(n)){for(l=o;i&&!i.node;)i=i.parent;let d=i.node;if(i&&d.isAtom&&dt.isSelectable(d)&&i.parent&&!(d.isInline&&ule(n.focusNode,n.focusOffset,i.dom))){let f=i.posBefore;c=new dt(o==f?a:r.resolve(f))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let d=o,f=o;for(let h=0;h<n.rangeCount;h++){let p=n.getRangeAt(h);d=Math.min(d,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=f==t.state.selection.anchor?[f,d]:[d,f],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let d=e=="pointer"||t.state.selection.head<a.pos&&!s?1:-1;c=DT(t,u,a,d)}return c}function CL(t){return t.editable?t.hasFocus():AL(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function il(t,e=!1){let n=t.state.selection;if(_L(t,n),!!CL(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Cr){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&cd(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)$le(t);else{let{anchor:r,head:i}=n,s,o;y3&&!(n instanceof At)&&(n.$from.parent.inlineContent||(s=b3(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=b3(t,n.to))),t.docView.setSelection(r,i,t,e),y3&&(s&&w3(s),o&&w3(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Fle(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const y3=Yr||Cr&&hL<63;function b3(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(Yr&&i&&i.contentEditable=="false")return n2(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return n2(i);if(s)return n2(s)}}function n2(t){return t.contentEditable="true",Yr&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function w3(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Fle(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!CL(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function $le(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,qr(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Xi&&Ic<=11&&(n.disabled=!0,n.disabled=!1)}function _L(t,e){if(e instanceof dt){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(v3(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else v3(t)}function v3(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function DT(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||At.between(e,n,r)}function x3(t){return t.editable&&!t.hasFocus()?!1:AL(t)}function AL(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function zle(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return cd(e.node,e.offset,n.anchorNode,n.anchorOffset)}function bS(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&Bt.findFrom(s,e)}function rc(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function S3(t,e,n){let r=t.state.selection;if(r instanceof At)if(n.indexOf("s")>-1){let{$head:i}=r,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;let o=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return rc(t,new At(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=bS(t.state,e);return i&&i instanceof dt?rc(t,i):!1}else if(!(Os&&n.indexOf("m")>-1)){let i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,o;if(!s||s.isText)return!1;let a=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?dt.isSelectable(s)?rc(t,new dt(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):Ym?rc(t,new At(t.state.doc.resolve(e<0?a:a+s.nodeSize))):!1:!1}}else return!1;else{if(r instanceof dt&&r.node.isInline)return rc(t,new At(e>0?r.$to:r.$from));{let i=bS(t.state,e);return i?rc(t,i):!1}}}function Dy(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Rp(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Bd(t,e){return e<0?Ule(t):Hle(t)}function Ule(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;for(Us&&n.nodeType==1&&r<Dy(n)&&Rp(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(Rp(a,-1))i=n,s=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(PL(n))break;{let a=n.previousSibling;for(;a&&Rp(a,-1);)i=n.parentNode,s=qr(a),a=a.previousSibling;if(a)n=a,r=Dy(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?wS(t,n,r):i&&wS(t,i,s)}function Hle(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=Dy(n),s,o;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if(Rp(a,1))s=n,o=++r;else break}else{if(PL(n))break;{let a=n.nextSibling;for(;a&&Rp(a,1);)s=a.parentNode,o=qr(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=Dy(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}s&&wS(t,s,o)}function PL(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function Vle(t,e){for(;t&&e==t.childNodes.length&&!Qm(t);)e=qr(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function Wle(t,e){for(;t&&!e&&!Qm(t);)e=qr(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function wS(t,e,n){if(e.nodeType!=3){let s,o;(o=Vle(e,n))?(e=o,n=0):(s=Wle(e,n))&&(e=s,n=s.nodeValue.length)}let r=t.domSelection();if(!r)return;if(xw(r)){let s=document.createRange();s.setEnd(e,n),s.setStart(e,n),r.removeAllRanges(),r.addRange(s)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&il(t)},50)}function k3(t,e){let n=t.state.doc.resolve(e);if(!(Cr||pL)&&n.parent.inlineContent){let i=t.coordsAtPos(e);if(e>n.start()){let s=t.coordsAtPos(e-1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left<i.left?"ltr":"rtl"}if(e<n.end()){let s=t.coordsAtPos(e+1),o=(s.top+s.bottom)/2;if(o>i.top&&o<i.bottom&&Math.abs(s.left-i.left)>1)return s.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function E3(t,e,n){let r=t.state.selection;if(r instanceof At&&!r.empty||n.indexOf("s")>-1||Os&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=bS(t.state,e);if(o&&o instanceof dt)return rc(t,o)}if(!i.parent.inlineContent){let o=e<0?i:s,a=r instanceof ps?Bt.near(o,e):Bt.findFrom(o,e);return a?rc(t,a):!1}return!1}function T3(t,e){if(!(t.state.selection instanceof At))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let o=t.state.tr;return e<0?o.delete(n.pos-s.nodeSize,n.pos):o.delete(n.pos,n.pos+s.nodeSize),t.dispatch(o),!0}return!1}function C3(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function jle(t){if(!Yr||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;C3(t,r,"true"),setTimeout(()=>C3(t,r,"false"),20)}return!1}function qle(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function Kle(t,e){let n=e.keyCode,r=qle(e);if(n==8||Os&&n==72&&r=="c")return T3(t,-1)||Bd(t,-1);if(n==46&&!e.shiftKey||Os&&n==68&&r=="c")return T3(t,1)||Bd(t,1);if(n==13||n==27)return!0;if(n==37||Os&&n==66&&r=="c"){let i=n==37?k3(t,t.state.selection.from)=="ltr"?-1:1:-1;return S3(t,i,r)||Bd(t,i)}else if(n==39||Os&&n==70&&r=="c"){let i=n==39?k3(t,t.state.selection.from)=="ltr"?1:-1:1;return S3(t,i,r)||Bd(t,i)}else{if(n==38||Os&&n==80&&r=="c")return E3(t,-1,r)||Bd(t,-1);if(n==40||Os&&n==78&&r=="c")return jle(t)||E3(t,1,r)||Bd(t,1);if(r==(Os?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function LT(t,e){t.someProp("transformCopied",h=>{e=h(e,t)});let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,s--;let h=r.firstChild;n.push(h.type.name,h.attrs!=h.type.defaultAttrs?h.attrs:null),r=h.content}let o=t.someProp("clipboardSerializer")||bd.fromSchema(t.state.schema),a=DL(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=RL[c.nodeName.toLowerCase()]);){for(let h=u.length-1;h>=0;h--){let p=a.createElement(u[h]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${s}${d?` -${d}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",h=>h(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:f,slice:e}}function IL(t,e,n,r,i){let s=i.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||s||!n);if(l){if(t.someProp("transformPastedText",f=>{e=f(e,s||r,t)}),s)return a=new rt(De.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{a=f(a,t,!0)}),a;let d=t.someProp("clipboardTextParser",f=>f(e,i,r,t));if(d)a=d;else{let f=i.marks(),{schema:h}=t.state,p=bd.fromSchema(h);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(h.text(m,f)))})}}else t.someProp("transformPastedHTML",d=>{n=d(n,t)}),o=Qle(n),Ym&&Yle(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||Pc.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:i,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!Gle.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)a=Jle(_3(a,+u[1],+u[2]),u[4]);else if(a=rt.maxOpen(Zle(a.content,i),!0),a.openStart||a.openEnd){let d=0,f=0;for(let h=a.content.firstChild;d<a.openStart&&!h.type.spec.isolating;d++,h=h.firstChild);for(let h=a.content.lastChild;f<a.openEnd&&!h.type.spec.isolating;f++,h=h.lastChild);a=_3(a,d,f)}return t.someProp("transformPasted",d=>{a=d(a,t,l)}),a}const Gle=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Zle(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),s,o=[];if(t.forEach(a=>{if(!o)return;let l=i.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&s.length&&ML(l,s,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=NL(o[o.length-1],s.length));let u=OL(a,l);o.push(u),i=i.matchType(u.type),s=l}}),o)return De.from(o)}return t}function OL(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,De.from(t));return t}function ML(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=ML(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(De.from(OL(n,t,i+1))))}}function NL(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,NL(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(De.empty,!0);return t.copy(n.append(r))}function vS(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),i<r-1&&(a=vS(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(De.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function _3(t,e,n){return e<t.openStart&&(t=new rt(vS(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new rt(vS(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const RL={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let A3=null;function DL(){return A3||(A3=document.implementation.createHTMLDocument("title"))}let r2=null;function Xle(t){let e=window.trustedTypes;return e?(r2||(r2=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),r2.createHTML(t)):t}function Qle(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=DL().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&RL[r[1].toLowerCase()])&&(t=i.map(s=>"<"+s+">").join("")+t+i.map(s=>"</"+s+">").reverse().join("")),n.innerHTML=Xle(t),i)for(let s=0;s<i.length;s++)n=n.querySelector(i[s])||n;return n}function Yle(t){let e=t.querySelectorAll(Cr?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent=="Â "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function Jle(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=De.from(l.create(r[a+1],i)),s++,o++}return new rt(i,s,o)}const Ii={},Oi={},ece={touchstart:!0,touchmove:!0};class tce{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function nce(t){for(let e in Ii){let n=Ii[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{ice(t,r)&&!BT(t,r)&&(t.editable||!(r.type in Oi))&&n(t,r)},ece[e]?{passive:!0}:void 0)}Yr&&t.dom.addEventListener("input",()=>null),xS(t)}function wc(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function rce(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function xS(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>BT(t,r))})}function BT(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function ice(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function sce(t,e){!BT(t,e)&&Ii[e.type]&&(t.editable||!(e.type in Oi))&&Ii[e.type](t,e)}Oi.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!BL(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Qa&&Cr&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Qf&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,ku(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||Kle(t,n)?n.preventDefault():wc(t,"key")};Oi.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Oi.keypress=(t,e)=>{let n=e;if(BL(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Os&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof At)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode),s=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,i,s))&&t.dispatch(s()),n.preventDefault()}};function kw(t){return{left:t.clientX,top:t.clientY}}function oce(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function FT(t,e,n,r,i){if(r==-1)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,a=>o>s.depth?a(t,n,s.nodeAfter,s.before(o),i,!0):a(t,n,s.node(o),s.before(o),i,!1)))return!0;return!1}function _f(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function ace(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&dt.isSelectable(r)?(_f(t,new dt(n)),!0):!1}function lce(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof dt&&(r=n.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o);if(dt.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&s.before(n.$from.depth+1)==n.$from.pos?i=s.before(n.$from.depth):i=s.before(o);break}}return i!=null?(_f(t,dt.create(t.state.doc,i)),!0):!1}function cce(t,e,n,r,i){return FT(t,"handleClickOn",e,n,r)||t.someProp("handleClick",s=>s(t,e,r))||(i?lce(t,n):ace(t,n))}function uce(t,e,n,r){return FT(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function dce(t,e,n,r){return FT(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||fce(t,n,r)}function fce(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(_f(t,At.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let o=s>i.depth?i.nodeAfter:i.node(s),a=i.before(s);if(o.inlineContent)_f(t,At.create(r,a+1,a+1+o.content.size));else if(dt.isSelectable(o))_f(t,dt.create(r,a));else continue;return!0}}function $T(t){return Ly(t)}const LL=Os?"metaKey":"ctrlKey";Ii.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=$T(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&oce(n,t.input.lastClick)&&!n[LL]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?s="doubleClick":t.input.lastClick.type=="doubleClick"&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s,button:n.button};let o=t.posAtCoords(kw(n));o&&(s=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new hce(t,o,n,!!r)):(s=="doubleClick"?uce:dce)(t,o.pos,o.inside,n)?n.preventDefault():wc(t,"pointer"))};class hce{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[LL],this.allowDefault=r.shiftKey;let s,o;if(n.inside>-1)s=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);s=u.parent,o=u.depth?u.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||c instanceof dt&&c.from<=o&&c.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Us&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),wc(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>il(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(kw(e))),this.updateAllowDefault(e),this.allowDefault||!n?wc(this.view,"pointer"):cce(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Yr&&this.mightDrag&&!this.mightDrag.node.isAtom||Cr&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(_f(this.view,Bt.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):wc(this.view,"pointer")}move(e){this.updateAllowDefault(e),wc(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Ii.touchstart=t=>{t.input.lastTouch=Date.now(),$T(t),wc(t,"pointer")};Ii.touchmove=t=>{t.input.lastTouch=Date.now(),wc(t,"pointer")};Ii.contextmenu=t=>$T(t);function BL(t,e){return t.composing?!0:Yr&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const pce=Qa?5e3:-1;Oi.compositionstart=Oi.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof At&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||Cr&&pL&&mce(t)))t.markCursor=t.state.storedMarks||n.marks(),Ly(t,!0),t.markCursor=null;else if(Ly(t,!e.selection.empty),Us&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,s=r.focusOffset;i&&i.nodeType==1&&s!=0;){let o=s<0?i.lastChild:i.childNodes[s-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else i=o,s=-1}}t.input.composing=!0}FL(t,pce)};function mce(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Oi.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,FL(t,20))};function FL(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Ly(t),e))}function $L(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=yce());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function gce(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=lle(e.focusNode,e.focusOffset),r=cle(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let i=r.pmViewDesc,s=t.domObserver.lastChangedTextNode;if(n==s||r==s)return s;if(!i||!i.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function yce(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Ly(t,e=!1){if(!(Qa&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),$L(t),e||t.docView&&t.docView.dirty){let n=RT(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function bce(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const dm=Xi&&Ic<15||Qf&&hle<604;Ii.copy=Oi.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let s=dm?null:n.clipboardData,o=r.content(),{dom:a,text:l}=LT(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):bce(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function wce(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function vce(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?fm(t,r.value,null,i,e):fm(t,r.textContent,r.innerHTML,i,e)},50)}function fm(t,e,n,r,i){let s=IL(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,s||rt.empty)))return!0;if(!s)return!1;let o=wce(s),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function zL(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Oi.paste=(t,e)=>{let n=e;if(t.composing&&!Qa)return;let r=dm?null:n.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&fm(t,zL(r),r.getData("text/html"),i,n)?n.preventDefault():vce(t,n)};class UL{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const xce=Os?"altKey":"ctrlKey";function HL(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[xce]}Ii.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(kw(n)),o;if(!(s&&s.pos>=i.from&&s.pos<=(i instanceof dt?i.to-1:i.to))){if(r&&r.mightDrag)o=dt.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let d=t.docView.nearestDesc(n.target,!0);d&&d.node.type.spec.draggable&&d!=t.docView&&(o=dt.create(t.state.doc,d.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=LT(t,a);(!n.dataTransfer.files.length||!Cr||hL>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(dm?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",dm||n.dataTransfer.setData("text/plain",c),t.dragging=new UL(u,HL(t,n),o)};Ii.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Oi.dragover=Oi.dragenter=(t,e)=>e.preventDefault();Oi.drop=(t,e)=>{try{Sce(t,e,t.dragging)}finally{t.dragging=null}};function Sce(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(kw(e));if(!r)return;let i=t.state.doc.resolve(r.pos),s=n&&n.slice;s?t.someProp("transformPasted",h=>{s=h(s,t,!1)}):s=IL(t,zL(e.dataTransfer),dm?null:e.dataTransfer.getData("text/html"),!1,i);let o=!!(n&&HL(t,e));if(t.someProp("handleDrop",h=>h(t,e,s||rt.empty,o))){e.preventDefault();return}if(!s)return;e.preventDefault();let a=s?q5(t.state.doc,i.pos,s):i.pos;a==null&&(a=i.pos);let l=t.state.tr;if(o){let{node:h}=n;h?h.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,d=l.doc;if(u?l.replaceRangeWith(c,c,s.content.firstChild):l.replaceRange(c,c,s),l.doc.eq(d))return;let f=l.doc.resolve(c);if(u&&dt.isSelectable(s.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(s.content.firstChild))l.setSelection(new dt(f));else{let h=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((p,m,g,y)=>h=y),l.setSelection(DT(t,f,l.doc.resolve(h)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Ii.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&il(t)},20))};Ii.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Ii.beforeinput=(t,e)=>{if(Cr&&Qa&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",s=>s(t,ku(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in Oi)Ii[t]=Oi[t];function hm(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class By{constructor(e,n){this.toDOM=e,this.spec=n||Wu,this.side=this.spec.side||0}map(e,n,r,i){let{pos:s,deleted:o}=e.mapResult(n.from+i,this.side<0?-1:1);return o?null:new _r(s-r,s-r,this)}valid(){return!0}eq(e){return this==e||e instanceof By&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&hm(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Mc{constructor(e,n){this.attrs=e,this.spec=n||Wu}map(e,n,r,i){let s=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return s>=o?null:new _r(s,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Mc&&hm(this.attrs,e.attrs)&&hm(this.spec,e.spec)}static is(e){return e.type instanceof Mc}destroy(){}}class zT{constructor(e,n){this.attrs=e,this.spec=n||Wu}map(e,n,r,i){let s=e.mapResult(n.from+i,1);if(s.deleted)return null;let o=e.mapResult(n.to+i,-1);return o.deleted||o.pos<=s.pos?null:new _r(s.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),s;return i==n.from&&!(s=e.child(r)).isText&&i+s.nodeSize==n.to}eq(e){return this==e||e instanceof zT&&hm(this.attrs,e.attrs)&&hm(this.spec,e.spec)}destroy(){}}class _r{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new _r(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new _r(e,e,new By(n,r))}static inline(e,n,r,i){return new _r(e,n,new Mc(r,i))}static node(e,n,r,i){return new _r(e,n,new zT(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Mc}get widget(){return this.type instanceof By}}const Kd=[],Wu={};class kn{constructor(e,n){this.local=e.length?e:Kd,this.children=n.length?n:Kd}static create(e,n){return n.length?Fy(n,e,0,Wu):ii}find(e,n,r){let i=[];return this.findInner(e??0,n??1e9,i,0,r),i}findInner(e,n,r,i,s){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!s||s(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,i+a,s)}}map(e,n,r){return this==ii||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Wu)}mapInner(e,n,r,i,s){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(o||(o=[])).push(l):s.onRemove&&s.onRemove(this.local[a].spec)}return this.children.length?kce(this.children,o||[],e,n,r,i,s):o?new kn(o.sort(ju),Kd):ii}add(e,n){return n.length?this==ii?kn.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,s=0;e.forEach((a,l)=>{let c=l+r,u;if(u=WL(n,a,c)){for(i||(i=this.children.slice());s<i.length&&i[s]<l;)s+=3;i[s]==l?i[s+2]=i[s+2].addInner(a,u,c+1):i.splice(s,0,l,l+a.nodeSize,Fy(u,a,c+1,Wu)),s+=3}});let o=VL(s?jL(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new kn(o.length?this.local.concat(o).sort(ju):this.local,i||this.children)}remove(e){return e.length==0||this==ii?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let s=0;s<r.length;s+=3){let o,a=r[s]+n,l=r[s+1]+n;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[s+2].removeInner(o,a+1);c!=ii?r[s+2]=c:(r.splice(s,3),s-=3)}if(i.length){for(let s=0,o;s<e.length;s++)if(o=e[s])for(let a=0;a<i.length;a++)i[a].eq(o,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new kn(i,r):ii}forChild(e,n){if(this==ii)return this;if(n.isLeaf)return kn.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let s=e+1,o=s+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>s&&l.type instanceof Mc){let c=Math.max(s,l.from)-s,u=Math.min(o,l.to)-s;c<u&&(i||(i=[])).push(l.copy(c,u))}}if(i){let a=new kn(i.sort(ju),Kd);return r?new cc([a,r]):a}return r||ii}eq(e){if(this==e)return!0;if(!(e instanceof kn)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return UT(this.localsInner(e))}localsInner(e){if(this==ii)return Kd;if(e.inlineContent||!this.local.some(Mc.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Mc||n.push(this.local[r]);return n}forEachSet(e){e(this)}}kn.empty=new kn([],[]);kn.removeOverlap=UT;const ii=kn.empty;class cc{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,Wu));return cc.from(r)}forChild(e,n){if(n.isLeaf)return kn.empty;let r=[];for(let i=0;i<this.members.length;i++){let s=this.members[i].forChild(e,n);s!=ii&&(s instanceof cc?r=r.concat(s.members):r.push(s))}return cc.from(r)}eq(e){if(!(e instanceof cc)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let s=this.members[i].localsInner(e);if(s.length)if(!n)n=s;else{r&&(n=n.slice(),r=!1);for(let o=0;o<s.length;o++)n.push(s[o])}}return n?UT(r?n:n.sort(ju)):Kd}static from(e){switch(e.length){case 0:return ii;case 1:return e[0];default:return new cc(e.every(n=>n instanceof kn)?e:e.reduce((n,r)=>n.concat(r instanceof kn?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function kce(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,u=s;c<n.maps.length;c++){let d=0;n.maps[c].forEach((f,h,p,m)=>{let g=m-p-(h-f);for(let y=0;y<a.length;y+=3){let b=a[y+1];if(b<0||f>b+u-d)continue;let S=a[y]+u-d;h>=S?a[y+1]=f<=S?-2:-1:f>=u&&g&&(a[y]+=g,a[y+1]+=g)}d+=g}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+s),d=u-i;if(d<0||d>=r.content.size){l=!0;continue}let f=n.map(t[c+1]+s,-1),h=f-i,{index:p,offset:m}=r.content.findIndex(d),g=r.maybeChild(p);if(g&&m==d&&m+g.nodeSize==h){let y=a[c+2].mapInner(n,g,u+1,t[c]+s+1,o);y!=ii?(a[c]=d,a[c+1]=h,a[c+2]=y):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=Ece(a,t,e,n,i,s,o),u=Fy(c,r,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,f=0;d<u.children.length;d+=3){let h=u.children[d];for(;f<a.length&&a[f]<h;)f+=3;a.splice(f,0,u.children[d],u.children[d+1],u.children[d+2])}}return new kn(e.sort(ju),a)}function VL(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new _r(i.from+e,i.to+e,i.type))}return n}function Ece(t,e,n,r,i,s,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(r,i,c);d?n.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+s+1);return n}function WL(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s=0,o;s<t.length;s++)(o=t[s])&&o.from>n&&o.to<r&&((i||(i=[])).push(o),t[s]=null);return i}function jL(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Fy(t,e,n,r){let i=[],s=!1;e.forEach((a,l)=>{let c=WL(t,a,l+n);if(c){s=!0;let u=Fy(c,a,n+l+1,r);u!=ii&&i.push(l,l+a.nodeSize,u)}});let o=VL(s?jL(t):t,-n).sort(ju);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new kn(o,i):ii}function ju(t,e){return t.from-e.from||t.to-e.to}function UT(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from==r.from){s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),P3(e,i+1,s.copy(r.to,s.to)));continue}else{s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),P3(e,i,r.copy(s.from,r.to)));break}}}return e}function P3(t,e,n){for(;e<t.length&&ju(n,t[e])>0;)e++;t.splice(e,0,n)}function i2(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=ii&&e.push(r)}),t.cursorWrapper&&e.push(kn.create(t.state.doc,[t.cursorWrapper.deco])),cc.from(e)}const Tce={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Cce=Xi&&Ic<=11;class _ce{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Ace{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new _ce,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);Xi&&Ic<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():Yr&&e.composing&&r.some(i=>i.type=="childList"&&i.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),Cce&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Tce)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(x3(this.view)){if(this.suppressingSelectionUpdates)return il(this.view);if(Xi&&Ic<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&cd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let s=e.focusNode;s;s=Xf(s))n.add(s);for(let s=e.anchorNode;s;s=Xf(s))if(n.has(s)){r=s;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&x3(e)&&!this.ignoreSelectionChange(r),s=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let d=this.registerMutation(n[u],l);d&&(s=s<0?d.from:Math.min(d.from,s),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if(Us&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,f]=u;d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let f of u){let h=f.parentNode;h&&h.nodeName=="LI"&&(!d||Oce(e,d)!=h)&&f.remove()}}}else if((Cr||Yr)&&l.some(u=>u.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let u of l)if(u.nodeName=="BR"&&u.parentNode){let d=u.nextSibling;d&&d.nodeType==1&&d.contentEditable=="false"&&u.parentNode.removeChild(u)}}let c=null;s<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&xw(r)&&(c=RT(e))&&c.eq(Bt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,il(e),this.currentSelection.set(r),e.scrollToSelection()):(s>-1||i)&&(s>-1&&(e.docView.markDirty(s,o),Pce(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,Mce(e,l)),this.handleDOMChange(s,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||il(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];n.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,s=e.nextSibling;if(Xi&&Ic<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:f}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(s=f)}let o=i&&i.parentNode==e.target?qr(i)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=s&&s.parentNode==e.target?qr(s):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let I3=new WeakMap,O3=!1;function Pce(t){if(!I3.has(t)&&(I3.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Us,O3)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),O3=!0}}function M3(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return cd(o.node,o.offset,i,s)&&([n,r,i,s]=[i,s,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:s}}function Ice(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return M3(t,i)}let n;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?M3(t,n):null}function Oce(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function Mce(t,e){var n;let{focusNode:r,focusOffset:i}=t.domSelectionRange();for(let s of e)if(((n=s.parentNode)===null||n===void 0?void 0:n.nodeName)=="TR"){let o=s.nextSibling;for(;o&&o.nodeName!="TD"&&o.nodeName!="TH";)o=o.nextSibling;if(o){let a=o;for(;;){let l=a.firstChild;if(!l||l.nodeType!=1||l.contentEditable=="false"||/^(BR|IMG)$/.test(l.nodeName))break;a=l}a.insertBefore(s,a.firstChild),r==s&&t.domSelection().collapse(s,i)}else s.parentNode.removeChild(s)}}function Nce(t,e,n){let{node:r,fromOffset:i,toOffset:s,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],xw(l)||c.push({node:l.focusNode,offset:l.focusOffset})),Cr&&t.input.lastKeyCode===8)for(let g=s;g>i;g--){let y=r.childNodes[g-1],b=y.pmViewDesc;if(y.nodeName=="BR"&&!b){s=g;break}if(!b||b.size)break}let d=t.state.doc,f=t.someProp("domParser")||Pc.fromSchema(t.state.schema),h=d.resolve(o),p=null,m=f.parse(r,{topNode:h.parent,topMatch:h.parent.contentMatchAt(h.index()),topOpen:!0,from:i,to:s,preserveWhitespace:h.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:Rce,context:h});if(c&&c[0].pos!=null){let g=c[0].pos,y=c[1]&&c[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:m,sel:p,from:o,to:a}}function Rce(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Yr&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Yr&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Dce=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Lce(t,e,n,r,i){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let I=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,k=RT(t,I);if(k&&!t.state.selection.eq(k)){if(Cr&&Qa&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",P=>P(t,ku(13,"Enter"))))return;let T=t.state.tr.setSelection(k);I=="pointer"?T.setMeta("pointer",!0):I=="key"&&T.scrollIntoView(),s&&T.setMeta("composition",s),t.dispatch(T)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=Nce(t,e,n),u=t.state.doc,d=u.slice(c.from,c.to),f,h;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,h="end"):(f=t.state.selection.from,h="start"),t.input.lastKeyCode=null;let p=$ce(d.content,c.doc.content,c.from,f,h);if(p&&t.input.domChangeCount++,(Qf&&t.input.lastIOSEnter>Date.now()-225||Qa)&&i.some(I=>I.nodeType==1&&!Dce.test(I.nodeName))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",I=>I(t,ku(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!p)if(r&&l instanceof At&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let I=N3(t,t.state.doc,c.sel);if(I&&!I.eq(t.state.selection)){let k=t.state.tr.setSelection(I);s&&k.setMeta("composition",s),t.dispatch(k)}}return}t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof At&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),Xi&&Ic<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" Â "&&(p.start--,p.endA--,p.endB--);let m=c.doc.resolveNoCache(p.start-c.from),g=c.doc.resolveNoCache(p.endB-c.from),y=u.resolve(p.start),b=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=p.endA;if((Qf&&t.input.lastIOSEnter>Date.now()-225&&(!b||i.some(I=>I.nodeName=="DIV"||I.nodeName=="P"))||!b&&m.pos<c.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&m.pos<g.pos&&!/\S/.test(c.doc.textBetween(m.pos,g.pos,"","")))&&t.someProp("handleKeyDown",I=>I(t,ku(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>p.start&&Fce(u,p.start,p.endA,m,g)&&t.someProp("handleKeyDown",I=>I(t,ku(8,"Backspace")))){Qa&&Cr&&t.domObserver.suppressSelectionUpdates();return}Cr&&p.endB==p.start&&(t.input.lastChromeDelete=Date.now()),Qa&&!b&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,g=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(I){return I(t,ku(13,"Enter"))})},20));let S=p.start,C=p.endA,_=I=>{let k=I||t.state.tr.replace(S,C,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let T=N3(t,k.doc,c.sel);T&&!(Cr&&t.composing&&T.empty&&(p.start!=p.endB||t.input.lastChromeDelete<Date.now()-100)&&(T.head==S||T.head==k.mapping.map(C)-1)||Xi&&T.empty&&T.head==S)&&k.setSelection(T)}return s&&k.setMeta("composition",s),k.scrollIntoView()},x;if(b)if(m.pos==g.pos){Xi&&Ic<=11&&m.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>il(t),20));let I=_(t.state.tr.delete(S,C)),k=u.resolve(p.start).marksAcross(u.resolve(p.endA));k&&I.ensureMarks(k),t.dispatch(I)}else if(p.endA==p.endB&&(x=Bce(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start())))){let I=_(t.state.tr);x.type=="add"?I.addMark(S,C,x.mark):I.removeMark(S,C,x.mark),t.dispatch(I)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let I=m.parent.textBetween(m.parentOffset,g.parentOffset),k=()=>_(t.state.tr.insertText(I,S,C));t.someProp("handleTextInput",T=>T(t,S,C,I,k))||t.dispatch(k())}else t.dispatch(_());else t.dispatch(_())}function N3(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:DT(t,e.resolve(n.anchor),e.resolve(n.head))}function Bce(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,s=r,o,a,l;for(let u=0;u<r.length;u++)i=r[u].removeFromSet(i);for(let u=0;u<n.length;u++)s=n[u].removeFromSet(s);if(i.length==1&&s.length==0)a=i[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(i.length==0&&s.length==1)a=s[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(De.from(c).eq(t))return{mark:a,type:o}}function Fce(t,e,n,r,i){if(n-e<=i.pos-r.pos||s2(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(!r.parent.isTextblock){let a=s.nodeAfter;return a!=null&&n==e+a.nodeSize}if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(s2(s,!0,!0));return!o.parent.isTextblock||o.pos>n||s2(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function s2(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let s=t.node(r).maybeChild(t.indexAfter(r));for(;s&&!s.isLeaf;)s=s.firstChild,i++}return i}function $ce(t,e,n,r,i){let s=t.findDiffStart(e,n);if(s==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,s-Math.min(o,a));r-=o+l-s}if(o<s&&t.size<e.size){let l=r<=s&&r>=o?s-r:0;s-=l,s&&s<e.size&&R3(e.textBetween(s-1,s+1))&&(s+=l?1:-1),a=s+(a-o),o=s}else if(a<s){let l=r<=s&&r>=a?s-r:0;s-=l,s&&s<t.size&&R3(t.textBetween(s-1,s+1))&&(s+=l?1:-1),o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}function R3(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class qL{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new tce,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach($3),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=B3(this),L3(this),this.nodeViews=F3(this),this.docView=m3(this.state.doc,D3(this),i2(this),this.dom,this),this.domObserver=new Ace(this,(r,i,s,o)=>Lce(this,r,i,s,o)),this.domObserver.start(),nce(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&xS(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach($3),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let i=this.state,s=!1,o=!1;e.storedMarks&&this.composing&&($L(this),o=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let h=F3(this);Uce(h,this.nodeViews)&&(this.nodeViews=h,s=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&xS(this),this.editable=B3(this),L3(this);let l=i2(this),c=D3(this),u=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",d=s||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(i.selection))&&(o=!0);let f=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&gle(this);if(o){this.domObserver.stop();let h=d&&(Xi||Cr)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&zce(i.selection,e.selection);if(d){let p=Cr?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=gce(this)),(s||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=m3(e.doc,c,l,this.dom,this)),p&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(h=!0)}h||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&zle(this))?il(this,h):(_L(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&yle(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof dt){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&c3(this,n.getBoundingClientRect(),e)}else c3(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let s=r.from+(this.state.doc.content.size-n.doc.content.size);(s>0&&this.state.doc.nodeAt(s))==r.node&&(i=s)}this.dragging=new UL(e.slice,e.move,i<0?void 0:dt.create(this.state.doc,i))}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(i=n?n(a):a))return i}let s=this.state.plugins;if(s)for(let o=0;o<s.length;o++){let a=s[o].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(Xi){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&ble(this.dom),il(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return kle(this,e)}coordsAtPos(e,n=1){return wL(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return Ale(this,n||this.state,e)}pasteHTML(e,n){return fm(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return fm(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return LT(this,e)}destroy(){this.docView&&(rce(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],i2(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,ole())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return sce(this,e)}domSelectionRange(){let e=this.domSelection();return e?Yr&&this.root.nodeType===11&&dle(this.dom.ownerDocument)==this.dom&&Ice(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}qL.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function D3(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[_r.node(0,t.state.doc.content.size,e)]}function L3(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:_r.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function B3(t){return!t.someProp("editable",e=>e(t.state)===!1)}function zce(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function F3(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function Uce(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function $3(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Wc={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},$y={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Hce=typeof navigator<"u"&&/Mac/.test(navigator.platform),Vce=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Kr=0;Kr<10;Kr++)Wc[48+Kr]=Wc[96+Kr]=String(Kr);for(var Kr=1;Kr<=24;Kr++)Wc[Kr+111]="F"+Kr;for(var Kr=65;Kr<=90;Kr++)Wc[Kr]=String.fromCharCode(Kr+32),$y[Kr]=String.fromCharCode(Kr);for(var o2 in Wc)$y.hasOwnProperty(o2)||($y[o2]=Wc[o2]);function Wce(t){var e=Hce&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||Vce&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?$y:Wc)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const jce=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),qce=typeof navigator<"u"&&/Win/.test(navigator.platform);function Kce(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))jce?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),o&&(n="Meta-"+n),s&&(n="Shift-"+n),n}function Gce(t){let e=Object.create(null);for(let n in t)e[Kce(n)]=t[n];return e}function a2(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function Zce(t){return new cn({props:{handleKeyDown:KL(t)}})}function KL(t){let e=Gce(t);return function(n,r){let i=Wce(r),s,o=e[a2(i,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[a2(i,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(qce&&r.ctrlKey&&r.altKey)&&(s=Wc[r.keyCode])&&s!=i){let a=e[a2(s,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}var Xce=Object.defineProperty,HT=(t,e)=>{for(var n in e)Xce(t,n,{get:e[n],enumerable:!0})};function Ew(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}var Tw=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:i}=n,s=this.buildProps(i);return Object.fromEntries(Object.entries(t).map(([o,a])=>[o,(...c)=>{const u=a(...c)(s);return!i.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(i),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o=[],a=!!t,l=t||i.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(l),o.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(n).map(([d,f])=>[d,(...p)=>{const m=this.buildProps(l,e),g=f(...p)(m);return o.push(g),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,r=!1,i=t||n.tr,s=this.buildProps(i,r);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...s,dispatch:void 0})])),chain:()=>this.createChain(i,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o={tr:t,editor:r,view:s,state:Ew({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},GL={};HT(GL,{blur:()=>Qce,clearContent:()=>Yce,clearNodes:()=>Jce,command:()=>eue,createParagraphNear:()=>tue,cut:()=>nue,deleteCurrentNode:()=>rue,deleteNode:()=>iue,deleteRange:()=>sue,deleteSelection:()=>oue,enter:()=>aue,exitCode:()=>lue,extendMarkRange:()=>cue,first:()=>uue,focus:()=>fue,forEach:()=>hue,insertContent:()=>pue,insertContentAt:()=>yue,joinBackward:()=>vue,joinDown:()=>wue,joinForward:()=>xue,joinItemBackward:()=>Sue,joinItemForward:()=>kue,joinTextblockBackward:()=>Eue,joinTextblockForward:()=>Tue,joinUp:()=>bue,keyboardShortcut:()=>_ue,lift:()=>Aue,liftEmptyBlock:()=>Pue,liftListItem:()=>Iue,newlineInCode:()=>Oue,resetAttributes:()=>Mue,scrollIntoView:()=>Nue,selectAll:()=>Rue,selectNodeBackward:()=>Due,selectNodeForward:()=>Lue,selectParentNode:()=>Bue,selectTextblockEnd:()=>Fue,selectTextblockStart:()=>$ue,setContent:()=>zue,setMark:()=>ode,setMeta:()=>ade,setNode:()=>lde,setNodeSelection:()=>cde,setTextDirection:()=>ude,setTextSelection:()=>dde,sinkListItem:()=>fde,splitBlock:()=>hde,splitListItem:()=>pde,toggleList:()=>mde,toggleMark:()=>gde,toggleNode:()=>yde,toggleWrap:()=>bde,undoInputRule:()=>wde,unsetAllMarks:()=>vde,unsetMark:()=>xde,unsetTextDirection:()=>Sde,updateAttributes:()=>kde,wrapIn:()=>Ede,wrapInList:()=>Tde});var Qce=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())==null||n.removeAllRanges())}),!0),Yce=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),Jce=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:s,$to:o})=>{t.doc.nodesBetween(s.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),f=c.resolve(u.map(l+a.nodeSize)),h=d.blockRange(f);if(!h)return;const p=mh(h);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(h.start,m)}(p||p===0)&&e.lift(h,p)})}),!0},eue=t=>e=>t(e),tue=()=>({state:t,dispatch:e})=>lL(t,e),nue=(t,e)=>({editor:n,tr:r})=>{const{state:i}=n,s=i.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,s.content),r.setSelection(new At(r.doc.resolve(Math.max(o-1,0)))),!0},rue=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let s=i.depth;s>0;s-=1)if(i.node(s).type===r.type){if(e){const a=i.before(s),l=i.after(s);t.delete(a,l).scrollIntoView()}return!0}return!1};function hr(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var iue=t=>({tr:e,state:n,dispatch:r})=>{const i=hr(t,n.schema),s=e.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i){if(r){const l=s.before(o),c=s.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},sue=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},oue=()=>({state:t,dispatch:e})=>AT(t,e),aue=()=>({commands:t})=>t.keyboardShortcut("Enter"),lue=()=>({state:t,dispatch:e})=>jae(t,e);function VT(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function zy(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:VT(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function ZL(t,e,n={}){return t.find(r=>r.type===e&&zy(Object.fromEntries(Object.keys(n).map(i=>[i,r.attrs[i]])),n))}function z3(t,e,n={}){return!!ZL(t,e,n)}function WT(t,e,n){var r;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(u=>u.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(u=>u.type===e)||(n=n||((r=i.node.marks[0])==null?void 0:r.attrs),!ZL([...i.node.marks],e,n)))return;let o=i.index,a=t.start()+i.offset,l=o+1,c=a+i.node.nodeSize;for(;o>0&&z3([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&z3([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Cl(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var cue=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const s=Cl(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(i){const d=WT(l,s,e);if(d&&d.from<=c&&d.to>=u){const f=At.create(o,d.from,d.to);n.setSelection(f)}}return!0},uue=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function XL(t){return t instanceof At}function Mu(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function QL(t,e=null){if(!e)return null;const n=Bt.atStart(t),r=Bt.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,s=r.to;return e==="all"?At.create(t,Mu(0,i,s),Mu(t.content.size,i,s)):At.create(t,Mu(e,i,s),Mu(e,i,s))}function SS(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function pm(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function due(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var fue=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{(pm()||SS())&&r.dom.focus(),due()&&!pm()&&!SS()&&r.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(s&&t===null&&!XL(n.state.selection))return o(),!0;const a=QL(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return s&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},hue=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),pue=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),YL=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&YL(r)}return t};function Hg(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return YL(n)}function mm(t,e,n){if(t instanceof Ac||t instanceof De)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,i=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return De.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(s){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",s),mm("",e,n)}if(i){if(n.errorOnInvalidContent){let o=!1,a="";const l=new D5({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?Pc.fromSchema(l).parseSlice(Hg(t),n.parseOptions):Pc.fromSchema(l).parse(Hg(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const s=Pc.fromSchema(e);return n.slice?s.parseSlice(Hg(t),n.parseOptions).content:s.parse(Hg(t),n.parseOptions)}return mm("",e,n)}function mue(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof xr||i instanceof Pr))return;const s=t.mapping.maps[r];let o=0;s.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(Bt.near(t.doc.resolve(o),n))}var gue=t=>!("type"in t),yue=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{var o;if(i){n={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=g=>{s.emit("contentError",{editor:s,error:g,disableCollaboration:()=>{"collaboration"in s.storage&&typeof s.storage.collaboration=="object"&&s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!s.options.enableContentCheck&&s.options.emitContentError)try{mm(e,s.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=mm(e,s.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!=null?o:s.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,h=!0;if((gue(a)?a:[a]).forEach(g=>{g.check(),f=f?g.isText&&g.marks.length===0:!1,h=h?g.isBlock:!1}),u===d&&h){const{parent:g}=r.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(f){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof De){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;r.insertText(m,u,d)}else{m=a;const g=r.doc.resolve(u),y=g.node(),b=g.parentOffset===0,S=y.isText||y.isTextblock,C=y.content.size>0;b&&S&&C&&(u=Math.max(0,u-1)),r.replaceWith(u,d,m)}n.updateSelection&&mue(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:m}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:m})}return!0},bue=()=>({state:t,dispatch:e})=>Hae(t,e),wue=()=>({state:t,dispatch:e})=>Vae(t,e),vue=()=>({state:t,dispatch:e})=>tL(t,e),xue=()=>({state:t,dispatch:e})=>sL(t,e),Sue=()=>({state:t,dispatch:e,tr:n})=>{try{const r=bw(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},kue=()=>({state:t,dispatch:e,tr:n})=>{try{const r=bw(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},Eue=()=>({state:t,dispatch:e})=>zae(t,e),Tue=()=>({state:t,dispatch:e})=>Uae(t,e);function JL(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Cue(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,s,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))s=!0;else if(/^mod$/i.test(l))pm()||JL()?o=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}var _ue=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=Cue(t).split(/-(?!$)/),o=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l?.steps.forEach(c=>{const u=c.map(r.mapping);u&&i&&r.maybeStep(u)}),!0};function jc(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?hr(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(d,f)=>{if(d.isText)return;const h=Math.max(r,f),p=Math.min(i,f+d.nodeSize);a.push({node:d,from:h,to:p})});const l=i-r,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>zy(d.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((d,f)=>d+f.to-f.from,0)>=l}var Aue=(t,e={})=>({state:n,dispatch:r})=>{const i=hr(t,n.schema);return jc(n,i,e)?Wae(n,r):!1},Pue=()=>({state:t,dispatch:e})=>cL(t,e),Iue=t=>({state:e,dispatch:n})=>{const r=hr(t,e.schema);return nle(r)(e,n)},Oue=()=>({state:t,dispatch:e})=>aL(t,e);function Cw(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function U3(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}var Mue=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=Cw(typeof t=="string"?t:t.name,r.schema);if(!a)return!1;a==="node"&&(s=hr(t,r.schema)),a==="mark"&&(o=Cl(t,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{s&&s===u.type&&(l=!0,i&&n.setNodeMarkup(d,void 0,U3(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&(l=!0,i&&n.addMark(d,d+u.nodeSize,o.create(U3(f.attrs,e))))})})}),l},Nue=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),Rue=()=>({tr:t,dispatch:e})=>{if(e){const n=new ps(t.doc);t.setSelection(n)}return!0},Due=()=>({state:t,dispatch:e})=>rL(t,e),Lue=()=>({state:t,dispatch:e})=>oL(t,e),Bue=()=>({state:t,dispatch:e})=>Gae(t,e),Fue=()=>({state:t,dispatch:e})=>Qae(t,e),$ue=()=>({state:t,dispatch:e})=>Xae(t,e);function kS(t,e,n={},r={}){return mm(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var zue=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:i,tr:s,dispatch:o,commands:a})=>{const{doc:l}=s;if(r.preserveWhitespace!=="full"){const c=kS(t,i.schema,r,{errorOnInvalidContent:e??i.options.enableContentCheck});return o&&s.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return o&&s.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:r,errorOnInvalidContent:e??i.options.enableContentCheck})};function e6(t,e){const n=Cl(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function jT(t,e){const n=new Q5(t);return e.forEach(r=>{r.steps.forEach(i=>{n.step(i)})}),n}function Uue(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Hue(t,e){const n=[];return t.descendants((r,i)=>{e(r)&&n.push({node:r,pos:i})}),n}function t6(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(i,s)=>{n(i)&&r.push({node:i,pos:s})}),r}function Vue(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function _w(t){return e=>Vue(e.$from,t)}function gt(t,e,n){return t.config[e]===void 0&&t.parent?gt(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?gt(t.parent,e,n):null}):t.config[e]}function qT(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},r=gt(e,"addExtensions",n);return r?[e,...qT(r())]:e}).flat(10)}function KT(t,e){const n=bd.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}function n6(t){return typeof t=="function"}function bn(t,e=void 0,...n){return n6(t)?e?t.bind(e)(...n):t(...n):t}function Wue(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Yf(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function r6(t){const e=[],{nodeExtensions:n,markExtensions:r}=Yf(t),i=[...n,...r],s={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:i},l=gt(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([f,h])=>{e.push({type:d,name:f,attribute:{...s,...h}})})})})}),i.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=gt(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const f={...s,...d};typeof f?.default=="function"&&(f.default=f.default()),f?.isRequired&&f?.default===void 0&&delete f.default,e.push({type:o.name,name:u,attribute:f})})}),e}function Yn(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,s])=>{if(!r[i]){r[i]=s;return}if(i==="class"){const a=s?String(s).split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(u=>!l.includes(u));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=s?s.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),a.forEach(u=>{const[d,f]=u.split(":").map(h=>h.trim());c.set(d,f)}),r[i]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else r[i]=s}),r},{})}function Jf(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>Yn(n,r),{})}function jue(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function H3(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((s,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):jue(n.getAttribute(o.name));return a==null?s:{...s,[o.name]:a}},{});return{...r,...i}}}}function V3(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&Wue(n)?!1:n!=null))}function W3(t){var e,n;const r={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(r.default=t.attribute.default),((n=t?.attribute)==null?void 0:n.validate)!==void 0&&(r.validate=t.attribute.validate),[t.name,r]}function que(t,e){var n;const r=r6(t),{nodeExtensions:i,markExtensions:s}=Yf(t),o=(n=i.find(c=>gt(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(i.map(c=>{const u=r.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((y,b)=>{const S=gt(b,"extendNodeSchema",d);return{...y,...S?S(c):{}}},{}),h=V3({...f,content:bn(gt(c,"content",d)),marks:bn(gt(c,"marks",d)),group:bn(gt(c,"group",d)),inline:bn(gt(c,"inline",d)),atom:bn(gt(c,"atom",d)),selectable:bn(gt(c,"selectable",d)),draggable:bn(gt(c,"draggable",d)),code:bn(gt(c,"code",d)),whitespace:bn(gt(c,"whitespace",d)),linebreakReplacement:bn(gt(c,"linebreakReplacement",d)),defining:bn(gt(c,"defining",d)),isolating:bn(gt(c,"isolating",d)),attrs:Object.fromEntries(u.map(W3))}),p=bn(gt(c,"parseHTML",d));p&&(h.parseDOM=p.map(y=>H3(y,u)));const m=gt(c,"renderHTML",d);m&&(h.toDOM=y=>m({node:y,HTMLAttributes:Jf(y,u)}));const g=gt(c,"renderText",d);return g&&(h.toText=g),[c.name,h]})),l=Object.fromEntries(s.map(c=>{const u=r.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((g,y)=>{const b=gt(y,"extendMarkSchema",d);return{...g,...b?b(c):{}}},{}),h=V3({...f,inclusive:bn(gt(c,"inclusive",d)),excludes:bn(gt(c,"excludes",d)),group:bn(gt(c,"group",d)),spanning:bn(gt(c,"spanning",d)),code:bn(gt(c,"code",d)),attrs:Object.fromEntries(u.map(W3))}),p=bn(gt(c,"parseHTML",d));p&&(h.parseDOM=p.map(g=>H3(g,u)));const m=gt(c,"renderHTML",d);return m&&(h.toDOM=g=>m({mark:g,HTMLAttributes:Jf(g,u)})),[c.name,h]}));return new D5({topNode:o,nodes:a,marks:l})}function Kue(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}function Uy(t){return t.sort((n,r)=>{const i=gt(n,"priority")||100,s=gt(r,"priority")||100;return i>s?-1:i<s?1:0})}function i6(t){const e=Uy(qT(t)),n=Kue(e.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}function s6(t,e,n){const{from:r,to:i}=e,{blockSeparator:s=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,i,(l,c,u,d)=>{var f;l.isBlock&&c>r&&(a+=s);const h=o?.[l.type.name];if(h)return u&&(a+=h({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(f=l?.text)==null?void 0:f.slice(Math.max(r,c)-c,i-c))}),a}function Gue(t,e){const n={from:0,to:t.content.size};return s6(t,n,e)}function o6(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function Zue(t,e){const n=hr(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,a=>{s.push(a)});const o=s.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function a6(t,e){const n=Cw(typeof e=="string"?e:e.name,t.schema);return n==="node"?Zue(t,e):n==="mark"?e6(t,e):{}}function Xue(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function Que(t){const e=Xue(t);return e.length===1?e:e.filter((n,r)=>!e.filter((s,o)=>o!==r).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function GT(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((i,s)=>{const o=[];if(i.ranges.length)i.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[s];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(s).map(a,-1),u=e.slice(s).map(l),d=e.invert().map(c,-1),f=e.invert().map(u);r.push({oldRange:{from:d,to:f},newRange:{from:c,to:u}})})}),Que(r)}function ZT(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const s=n.resolve(t),o=WT(s,i.type);o&&r.push({mark:i,...o})}):n.nodesBetween(t,e,(i,s)=>{!i||i?.nodeSize===void 0||r.push(...i.marks.map(o=>({from:s,to:s+i.nodeSize,mark:o})))}),r}var Yue=(t,e,n,r=20)=>{const i=t.doc.resolve(n);let s=r,o=null;for(;s>0&&o===null;){const a=i.node(s);a?.type.name===e?o=a:s-=1}return[o,s]};function Vg(t,e){return e.nodes[t]||e.marks[t]||null}function w0(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(s=>s.type===e&&s.name===r);return i?i.attribute.keepOnSplit:!1}))}var Jue=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,s,o,a)=>{var l,c;const u=((c=(l=i.type.spec).toText)==null?void 0:c.call(l,{node:i,pos:s,parent:o,index:a}))||i.textContent||"%leaf%";n+=i.isAtom&&!i.isText?u:u.slice(0,Math.max(0,r-s))}),n};function ES(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?Cl(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>s?s.name===d.type.name:!0).find(d=>zy(d.attrs,n,{strict:!1}));let o=0;const a=[];if(i.forEach(({$from:d,$to:f})=>{const h=d.pos,p=f.pos;t.doc.nodesBetween(h,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(h,g),b=Math.min(p,g+m.nodeSize),S=b-y;o+=S,a.push(...m.marks.map(C=>({mark:C,from:y,to:b})))})}),o===0)return!1;const l=a.filter(d=>s?s.name===d.mark.type.name:!0).filter(d=>zy(d.mark.attrs,n,{strict:!1})).reduce((d,f)=>d+f.to-f.from,0),c=a.filter(d=>s?d.mark.type!==s&&d.mark.type.excludes(s):!0).reduce((d,f)=>d+f.to-f.from,0);return(l>0?l+c:l)>=o}function ede(t,e,n={}){if(!e)return jc(t,null,n)||ES(t,null,n);const r=Cw(e,t.schema);return r==="node"?jc(t,e,n):r==="mark"?ES(t,e,n):!1}var tde=(t,e)=>{const{$from:n,$to:r,$anchor:i}=t.selection;if(e){const s=_w(a=>a.type.name===e)(t.selection);if(!s)return!1;const o=t.doc.resolve(s.pos+1);return i.pos+1===o.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)},nde=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function j3(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function q3(t,e){const{nodeExtensions:n}=Yf(e),r=n.find(o=>o.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=bn(gt(r,"group",i));return typeof s!="string"?!1:s.split(" ").includes("list")}function Aw(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!=null?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(s=>{i!==!1&&(Aw(s,{ignoreWhitespace:n,checkChildren:e})||(i=!1))}),i}return!1}function l6(t){return t instanceof dt}var c6=class u6{constructor(e){this.position=e}static fromJSON(e){return new u6(e.position)}toJSON(){return{position:this.position}}};function rde(t,e){const n=e.mapping.mapResult(t.position);return{position:new c6(n.pos),mapResult:n}}function ide(t){return new c6(t)}function sde(t,e,n){var r;const{selection:i}=e;let s=null;if(XL(i)&&(s=i.$cursor),s){const a=(r=t.storedMarks)!=null?r:s.marks();return s.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:o}=i;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,f)=>{if(c)return!1;if(u.isInline){const h=!f||f.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(n));c=h&&p}return!c}),c})}var ode=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,l=Cl(t,r.schema);if(i)if(o){const c=e6(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;r.doc.nodesBetween(u,d,(f,h)=>{const p=Math.max(h,u),m=Math.min(h+f.nodeSize,d);f.marks.find(y=>y.type===l)?f.marks.forEach(y=>{l===y.type&&n.addMark(p,m,l.create({...y.attrs,...e}))}):n.addMark(p,m,l.create(e))})});return sde(r,n,l)},ade=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),lde=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=hr(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),s.isTextblock?i().command(({commands:a})=>o3(s,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>o3(s,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},cde=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=Mu(t,0,r.content.size),s=dt.create(r,i);e.setSelection(s)}return!0},ude=(t,e)=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=r;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=s.from,a=s.to),i&&n.doc.nodesBetween(o,a,(l,c)=>{l.isText||n.setNodeMarkup(c,void 0,{...l.attrs,dir:t})}),!0},dde=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:s}=typeof t=="number"?{from:t,to:t}:t,o=At.atStart(r).from,a=At.atEnd(r).to,l=Mu(i,o,a),c=Mu(s,o,a),u=At.create(r,l,c);e.setSelection(u)}return!0},fde=t=>({state:e,dispatch:n})=>{const r=hr(t,e.schema);return sle(r)(e,n)};function K3(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(r)}}var hde=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:s,doc:o}=e,{$from:a,$to:l}=s,c=i.extensionManager.attributes,u=w0(c,a.node().type.name,a.node().attrs);if(s instanceof dt&&s.node.isBlock)return!a.parentOffset||!rl(o,a.pos)?!1:(r&&(t&&K3(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:Uue(a.node(-1).contentMatchAt(a.indexAfter(-1)));let h=d&&f?[{type:f,attrs:u}]:void 0,p=rl(e.doc,e.mapping.map(a.pos),1,h);if(!h&&!p&&rl(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(p=!0,h=f?[{type:f,attrs:u}]:void 0),r){if(p&&(s instanceof At&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,h),f&&!d&&!a.parentOffset&&a.parent.type!==f)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}t&&K3(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return p},pde=(t,e={})=>({tr:n,state:r,dispatch:i,editor:s})=>{var o;const a=hr(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const f=s.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let y=De.empty;const b=l.index(-1)?1:l.index(-2)?2:3;for(let k=l.depth-b;k>=l.depth-3;k-=1)y=De.from(l.node(k).copy(y));const S=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,C={...w0(f,l.node().type.name,l.node().attrs),...e},_=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(C))||void 0;y=y.append(De.from(a.createAndFill(null,_)||void 0));const x=l.before(l.depth-(b-1));n.replace(x,l.after(-S),new rt(y,4-b,0));let I=-1;n.doc.nodesBetween(x,n.doc.content.size,(k,T)=>{if(I>-1)return!1;k.isTextblock&&k.content.size===0&&(I=T+1)}),I>-1&&n.setSelection(At.near(n.doc.resolve(I))),n.scrollIntoView()}return!0}const h=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...w0(f,d.type.name,d.attrs),...e},m={...w0(f,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const g=h?[{type:a,attrs:p},{type:h,attrs:m}]:[{type:a,attrs:p}];if(!rl(n.doc,l.pos,2))return!1;if(i){const{selection:y,storedMarks:b}=r,{splittableMarks:S}=s.extensionManager,C=b||y.$to.parentOffset&&y.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!C||!i)return!0;const _=C.filter(x=>S.includes(x.type.name));n.ensureMarks(_)}return!0},l2=(t,e)=>{const n=_w(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&nu(t.doc,n.pos)&&t.join(n.pos),!0},c2=(t,e)=>{const n=_w(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&nu(t.doc,r)&&t.join(r),!0},mde=(t,e,n,r={})=>({editor:i,tr:s,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:f}=i.extensionManager,h=hr(t,o.schema),p=hr(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:b}=m,S=y.blockRange(b),C=g||m.$to.parentOffset&&m.$from.marks();if(!S)return!1;const _=_w(x=>q3(x.type.name,d))(m);if(S.depth>=1&&_&&S.depth-_.depth<=1){if(_.node.type===h)return c.liftListItem(p);if(q3(_.node.type.name,d)&&h.validContent(_.node.content)&&a)return l().command(()=>(s.setNodeMarkup(_.pos,h),!0)).command(()=>l2(s,h)).command(()=>c2(s,h)).run()}return!n||!C||!a?l().command(()=>u().wrapInList(h,r)?!0:c.clearNodes()).wrapInList(h,r).command(()=>l2(s,h)).command(()=>c2(s,h)).run():l().command(()=>{const x=u().wrapInList(h,r),I=C.filter(k=>f.includes(k.type.name));return s.ensureMarks(I),x?!0:c.clearNodes()}).wrapInList(h,r).command(()=>l2(s,h)).command(()=>c2(s,h)).run()},gde=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=Cl(t,r.schema);return ES(r,o,e)?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},yde=(t,e,n={})=>({state:r,commands:i})=>{const s=hr(t,r.schema),o=hr(e,r.schema),a=jc(r,s,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(o,l):i.setNode(s,{...l,...n})},bde=(t,e={})=>({state:n,commands:r})=>{const i=hr(t,n.schema);return jc(n,i,e)?r.lift(i):r.wrapIn(i,e)},wde=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const o=t.tr,a=s.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(s.text){const l=o.doc.resolve(s.from).marks();o.replaceWith(s.from,s.to,t.schema.text(s.text,l))}else o.delete(s.from,s.to)}return!0}}return!1},vde=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(s=>{t.removeMark(s.$from.pos,s.$to.pos)}),!0},xde=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=Cl(t,r.schema),{$from:c,empty:u,ranges:d}=a;if(!i)return!0;if(u&&o){let{from:f,to:h}=a;const p=(s=c.marks().find(g=>g.type===l))==null?void 0:s.attrs,m=WT(c,l,p);m&&(f=m.from,h=m.to),n.removeMark(f,h,l)}else d.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,l)});return n.removeStoredMark(l),!0},Sde=t=>({tr:e,state:n,dispatch:r})=>{const{selection:i}=n;let s,o;return typeof t=="number"?(s=t,o=t):t&&"from"in t&&"to"in t?(s=t.from,o=t.to):(s=i.from,o=i.to),r&&e.doc.nodesBetween(s,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},kde=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=Cw(typeof t=="string"?t:t.name,r.schema);if(!a)return!1;a==="node"&&(s=hr(t,r.schema)),a==="mark"&&(o=Cl(t,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let f,h,p,m;n.selection.empty?r.doc.nodesBetween(u,d,(g,y)=>{s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),f=y,h=g)}):r.doc.nodesBetween(u,d,(g,y)=>{y<u&&s&&s===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),f=y,h=g),y>=u&&y<=d&&(s&&s===g.type&&(l=!0,i&&n.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(b=>{if(o===b.type&&(l=!0,i)){const S=Math.max(y,u),C=Math.min(y+g.nodeSize,d);n.addMark(S,C,o.create({...b.attrs,...e}))}}))}),h&&(f!==void 0&&i&&n.setNodeMarkup(f,void 0,{...h.attrs,...e}),o&&h.marks.length&&h.marks.forEach(g=>{o===g.type&&i&&n.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},Ede=(t,e={})=>({state:n,dispatch:r})=>{const i=hr(t,n.schema);return Yae(i,e)(n,r)},Tde=(t,e={})=>({state:n,dispatch:r})=>{const i=hr(t,n.schema);return Jae(i,e)(n,r)},Cde=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(r=>r.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(r=>r!==e):delete this.callbacks[t]),this}once(t,e){const n=(...r)=>{this.off(t,n),e.apply(this,r)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},Pw=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},_de=(t,e)=>{if(VT(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Wg(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const d=Jue(c)+s;return o.forEach(f=>{if(u)return;const h=_de(d,f.find);if(!h)return;const p=l.state.tr,m=Ew({state:l.state,transaction:p}),g={from:r-(h[0].length-s.length),to:i},{commands:y,chain:b,can:S}=new Tw({editor:n,state:m});f.handler({state:m,range:g,match:h,commands:y,chain:b,can:S})===null||!p.steps.length||(f.undoable&&p.setMeta(a,{transform:p,from:r,to:i,text:s}),l.dispatch(p),u=!0)}),u}function Ade(t){const{editor:e,rules:n}=t,r=new cn({state:{init(){return null},apply(i,s,o){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=KT(De.from(u),o.schema);const{from:d}=l,f=d+u.length;Wg({editor:e,from:d,to:f,text:u,rules:n,plugin:r})}),i.selectionSet||i.docChanged?null:s}},props:{handleTextInput(i,s,o,a){return Wg({editor:e,from:s,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:s}=i.state.selection;s&&Wg({editor:e,from:s.pos,to:s.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,s){if(s.key!=="Enter")return!1;const{$cursor:o}=i.state.selection;return o?Wg({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function Pde(t){return Object.prototype.toString.call(t).slice(8,-1)}function jg(t){return Pde(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function d6(t,e){const n={...t};return jg(t)&&jg(e)&&Object.keys(e).forEach(r=>{jg(e[r])&&jg(t[r])?n[r]=d6(t[r],e[r]):n[r]=e[r]}),n}var XT=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...bn(gt(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...bn(gt(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>d6(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},wd=class f6 extends XT{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new f6(n)}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const o=i.marks();if(!!!o.find(c=>c?.type.name===n.name))return!1;const l=o.find(c=>c?.type.name===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function Ide(t){return typeof t=="number"}var Ode=class{constructor(t){this.find=t.find,this.handler=t.handler}},Mde=(t,e,n)=>{if(VT(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(i=>{const s=[i.text];return s.index=i.index,s.input=t,s.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(i.replaceWith)),s}):[]};function Nde(t){const{editor:e,state:n,from:r,to:i,rule:s,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new Tw({editor:e,state:n}),d=[];return n.doc.nodesBetween(r,i,(h,p)=>{var m,g,y,b,S;if((g=(m=h.type)==null?void 0:m.spec)!=null&&g.code||!(h.isText||h.isTextblock||h.isInline))return;const C=(S=(b=(y=h.content)==null?void 0:y.size)!=null?b:h.nodeSize)!=null?S:0,_=Math.max(r,p),x=Math.min(i,p+C);if(_>=x)return;const I=h.isText?h.text||"":h.textBetween(_-p,x-p,void 0,"ï¿¼");Mde(I,s.find,o).forEach(T=>{if(T.index===void 0)return;const P=_+T.index+1,O=P+T[0].length,D={from:n.tr.mapping.map(P),to:n.tr.mapping.map(O)},F=s.handler({state:n,range:D,match:T,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(F)})}),d.every(h=>h!==null)}var qg=null,Rde=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function Dde(t){const{editor:e,rules:n}=t;let r=null,i=!1,s=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:f,rule:h,pasteEvt:p})=>{const m=u.tr,g=Ew({state:u,transaction:m});if(!(!Nde({editor:e,state:g,from:Math.max(d-1,0),to:f.b-1,rule:h,pasteEvent:p,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return n.map(u=>new cn({view(d){const f=p=>{var m;r=(m=d.dom.parentElement)!=null&&m.contains(p.target)?d.dom.parentElement:null,r&&(qg=e)},h=()=>{qg&&(qg=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",h),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",h)}}},props:{handleDOMEvents:{drop:(d,f)=>{if(s=r===d.dom.parentElement,a=f,!s){const h=qg;h?.isEditable&&setTimeout(()=>{const p=h.state.selection;p&&h.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,f)=>{var h;const p=(h=f.clipboardData)==null?void 0:h.getData("text/html");return o=f,i=!!p?.includes("data-pm-slice"),!1}}},appendTransaction:(d,f,h)=>{const p=d[0],m=p.getMeta("uiEvent")==="paste"&&!i,g=p.getMeta("uiEvent")==="drop"&&!s,y=p.getMeta("applyPasteRules"),b=!!y;if(!m&&!g&&!b)return;if(b){let{text:_}=y;typeof _=="string"?_=_:_=KT(De.from(_),h.schema);const{from:x}=y,I=x+_.length,k=Rde(_);return l({rule:u,state:h,from:x,to:{b:I},pasteEvt:k})}const S=f.doc.content.findDiffStart(h.doc.content),C=f.doc.content.findDiffEnd(h.doc.content);if(!(!Ide(S)||!C||S===C.b))return l({rule:u,state:h,from:S,to:C,pasteEvt:o})}}))}var Iw=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=i6(t),this.schema=que(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Vg(e.name,this.schema)},r=gt(e,"addCommands",n);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this;return Uy([...this.extensions].reverse()).flatMap(r=>{const i={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:Vg(r.name,this.schema)},s=[],o=gt(r,"addKeyboardShortcuts",i);let a={};if(r.type==="mark"&&gt(r,"exitable",i)&&(a.ArrowRight=()=>wd.handleExit({editor:t,mark:r})),o){const f=Object.fromEntries(Object.entries(o()).map(([h,p])=>[h,()=>p({editor:t})]));a={...a,...f}}const l=Zce(a);s.push(l);const c=gt(r,"addInputRules",i);if(j3(r,t.options.enableInputRules)&&c){const f=c();if(f&&f.length){const h=Ade({editor:t,rules:f}),p=Array.isArray(h)?h:[h];s.push(...p)}}const u=gt(r,"addPasteRules",i);if(j3(r,t.options.enablePasteRules)&&u){const f=u();if(f&&f.length){const h=Dde({editor:t,rules:f});s.push(...h)}}const d=gt(r,"addProseMirrorPlugins",i);if(d){const f=d();s.push(...f)}return s})}get attributes(){return r6(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Yf(this.extensions);return Object.fromEntries(e.filter(n=>!!gt(n,"addNodeView")).map(n=>{const r=this.attributes.filter(l=>l.type===n.name),i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:hr(n.name,this.schema)},s=gt(n,"addNodeView",i);if(!s)return[];const o=s();if(!o)return[];const a=(l,c,u,d,f)=>{const h=Jf(l,r);return o({node:l,view:c,getPos:u,decorations:d,innerDecorations:f,editor:t,extension:n,HTMLAttributes:h})};return[n.name,a]}))}dispatchTransaction(t){const{editor:e}=this;return Uy([...this.extensions].reverse()).reduceRight((r,i)=>{const s={name:i.name,options:i.options,storage:this.editor.extensionStorage[i.name],editor:e,type:Vg(i.name,this.schema)},o=gt(i,"dispatchTransaction",s);return o?a=>{o.call(s,{transaction:a,next:r})}:r},t)}get markViews(){const{editor:t}=this,{markExtensions:e}=Yf(this.extensions);return Object.fromEntries(e.filter(n=>!!gt(n,"addMarkView")).map(n=>{const r=this.attributes.filter(a=>a.type===n.name),i={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Cl(n.name,this.schema)},s=gt(n,"addMarkView",i);if(!s)return[];const o=(a,l,c)=>{const u=Jf(a,r);return s()({mark:a,view:l,inline:c,editor:t,extension:n,HTMLAttributes:u,updateAttributes:d=>{Xde(a,t,d)}})};return[n.name,o]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Vg(e.name,this.schema)};e.type==="mark"&&((n=bn(gt(e,"keepOnSplit",r)))==null||n)&&this.splittableMarks.push(e.name);const i=gt(e,"onBeforeCreate",r),s=gt(e,"onCreate",r),o=gt(e,"onUpdate",r),a=gt(e,"onSelectionUpdate",r),l=gt(e,"onTransaction",r),c=gt(e,"onFocus",r),u=gt(e,"onBlur",r),d=gt(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),s&&this.editor.on("create",s),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};Iw.resolve=i6;Iw.sort=Uy;Iw.flatten=qT;var Lde={};HT(Lde,{ClipboardTextSerializer:()=>p6,Commands:()=>m6,Delete:()=>g6,Drop:()=>y6,Editable:()=>b6,FocusEvents:()=>v6,Keymap:()=>x6,Paste:()=>S6,Tabindex:()=>k6,TextDirection:()=>E6,focusEventsPluginKey:()=>w6});var Tn=class h6 extends XT{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new h6(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},p6=Tn.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new cn({key:new En("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map(u=>u.$from.pos)),a=Math.max(...s.map(u=>u.$to.pos)),l=o6(n);return s6(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),m6=Tn.create({name:"commands",addCommands(){return{...GL}}}),g6=Tn.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,i;const s=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=jT(t.before,[t,...e]);GT(u).forEach(h=>{u.mapping.mapResult(h.oldRange.from).deletedAfter&&u.mapping.mapResult(h.oldRange.to).deletedBefore&&u.before.nodesBetween(h.oldRange.from,h.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=h.oldRange.from<=m&&g<=h.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:h.oldRange,newRange:h.newRange,partial:!y,editor:this.editor,transaction:t,combinedTransform:u})})});const f=u.mapping;u.steps.forEach((h,p)=>{var m,g;if(h instanceof so){const y=f.slice(p).map(h.from,-1),b=f.slice(p).map(h.to),S=f.invert().map(y,-1),C=f.invert().map(b),_=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(I=>I.eq(h.mark)),x=(g=u.doc.nodeAt(b))==null?void 0:g.marks.some(I=>I.eq(h.mark));this.editor.emit("delete",{type:"mark",mark:h.mark,from:h.from,to:h.to,deletedRange:{from:S,to:C},newRange:{from:y,to:b},partial:!!(x||_),editor:this.editor,transaction:t,combinedTransform:u})}})};(i=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||i?setTimeout(s,0):s()}}),y6=Tn.create({name:"drop",addProseMirrorPlugins(){return[new cn({key:new En("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),b6=Tn.create({name:"editable",addProseMirrorPlugins(){return[new cn({key:new En("editable"),props:{editable:()=>this.editor.options.editable}})]}}),w6=new En("focusEvents"),v6=Tn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new cn({key:w6,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),x6=Tn.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:f,parent:h}=d,p=d.parent.isTextblock&&f>0?a.doc.resolve(f-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:Bt.atStart(c).from===f;return!u||!h.type.isTextblock||h.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},s={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return pm()||JL()?s:i},addProseMirrorPlugins(){return[new cn({key:new En("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(m=>m.getMeta("composition")))return;const r=t.some(m=>m.docChanged)&&!e.doc.eq(n.doc),i=t.some(m=>m.getMeta("preventClearDocument"));if(!r||i)return;const{empty:s,from:o,to:a}=e.selection,l=Bt.atStart(e.doc).from,c=Bt.atEnd(e.doc).to;if(s||!(o===l&&a===c)||!Aw(n.doc))return;const f=n.tr,h=Ew({state:n,transaction:f}),{commands:p}=new Tw({editor:this.editor,state:h});if(p.clearNodes(),!!f.steps.length)return f}})]}}),S6=Tn.create({name:"paste",addProseMirrorPlugins(){return[new cn({key:new En("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),k6=Tn.create({name:"tabindex",addProseMirrorPlugins(){return[new cn({key:new En("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),E6=Tn.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Yf(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new cn({key:new En("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),Bde=class Gd{constructor(e,n,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=i}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You canât set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Gd(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Gd(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Gd(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const i=n.isBlock&&!n.isTextblock,s=n.isAtom&&!n.isText,o=this.pos+r+(s?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!i&&a.depth<=this.depth)return;const l=new Gd(a,this.editor,i,i?n:null);i&&(l.actualDepth=this.depth+1),e.push(new Gd(a,this.editor,i,i?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(n).length>0){const s=i.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(s[l]!==n[l])break}}else r=i;i=i.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const s=Object.keys(n);return this.children.forEach(o=>{r&&i.length>0||(o.node.type.name===e&&s.every(l=>n[l]===o.node.attrs[l])&&i.push(o),!(r&&i.length>0)&&(i=i.concat(o.querySelectorAll(e,n,r))))}),i}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},Fde=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function $de(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}var zde=class extends Cde{constructor(e={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:i})=>{throw i},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:rde,createMappablePosition:ide},this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:i,slice:s,moved:o})=>this.options.onDrop(i,s,o)),this.on("paste",({event:i,slice:s})=>this.options.onPaste(i,s)),this.on("delete",this.options.onDelete);const n=this.createDoc(),r=QL(n,this.options.autofocus);this.editorState=lf.create({doc:n,schema:this.schema,selection:r||void 0}),this.options.element&&this.mount(this.options.element)}mount(e){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(e),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const e=this.editorView.dom;e?.editor&&delete e.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(e){console.warn("Failed to remove CSS element:",e)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=$de(Fde,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:e=>{this.editorState=e},dispatch:e=>{this.dispatchTransaction(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(e,n)=>{if(this.editorView)return this.editorView[n];if(n==="state")return this.editorState;if(n in e)return Reflect.get(e,n);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${n}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(e,n){const r=n6(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(s=>{const o=typeof s=="string"?`${s}$`:s.key;r=r.filter(a=>!a.key.startsWith(o))}),n.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,n;const i=[...this.options.enableCoreExtensions?[b6,p6.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)==null?void 0:e.clipboardTextSerializer)==null?void 0:n.blockSeparator}),m6,v6,x6,k6,y6,S6,g6,E6.configure({direction:this.options.textDirection})].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s?.type));this.extensionManager=new Iw(i,this)}createCommandManager(){this.commandManager=new Tw({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let e;try{e=kS(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(n){if(!(n instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(n.message))throw n;this.emit("contentError",{editor:this,error:n,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(r=>r.name!=="collaboration"),this.createExtensionManager()}}),e=kS(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return e}createView(e){const{editorProps:n,enableExtensionDispatchTransaction:r}=this.options,i=n.dispatchTransaction||this.dispatchTransaction.bind(this),s=r?this.extensionManager.dispatchTransaction(i):i;this.editorView=new qL(e,{...n,attributes:{role:"textbox",...n?.attributes},dispatchTransaction:s,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const o=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(o),this.prependClass(),this.injectCSS();const a=this.view.dom;a.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(u=>{var d;return(d=this.capturedTransaction)==null?void 0:d.step(u)});return}const{state:n,transactions:r}=this.state.applyTransaction(e),i=!this.state.selection.eq(n.selection),s=r.includes(e),o=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),!s)return;this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e,appendedTransactions:r.slice(1)}),i&&this.emit("selectionUpdate",{editor:this,transaction:e});const a=r.findLast(u=>u.getMeta("focus")||u.getMeta("blur")),l=a?.getMeta("focus"),c=a?.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:a}),c&&this.emit("blur",{editor:this,event:c.event,transaction:a}),!(e.getMeta("preventUpdate")||!r.some(u=>u.docChanged)||o.doc.eq(n.doc))&&this.emit("update",{editor:this,transaction:e,appendedTransactions:r.slice(1)})}getAttributes(e){return a6(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return ede(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return KT(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return Gue(this.state.doc,{blockSeparator:n,textSerializers:{...o6(this.schema),...r}})}get isEmpty(){return Aw(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var e,n;return(n=(e=this.editorView)==null?void 0:e.isDestroyed)!=null?n:!0}$node(e,n){var r;return((r=this.$doc)==null?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)==null?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new Bde(n,this)}get $doc(){return this.$pos(0)}};function eh(t){return new Pw({find:t.find,handler:({state:e,range:n,match:r})=>{const i=bn(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(ZT(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(m=>m===t.type&&m!==h.mark.type)).filter(h=>h.to>c).length)return null;u<n.to&&s.delete(u,n.to),c>n.from&&s.delete(n.from+l,c);const f=n.from+l+o.length;s.addMark(n.from+l,f,t.type.create(i||{})),s.removeStoredMark(t.type)}},undoable:t.undoable})}function T6(t){return new Pw({find:t.find,handler:({state:e,range:n,match:r})=>{const i=bn(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;const l=t.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const d=r[0][r[0].length-1];s.insertText(d,o+r[0].length-1),s.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;s.insert(c,t.type.create(i)).delete(s.mapping.map(o),s.mapping.map(a))}s.scrollIntoView()},undoable:t.undoable})}function TS(t){return new Pw({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=bn(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)},undoable:t.undoable})}function th(t){return new Pw({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const s=bn(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&CT(l,t.type,s);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:f}=e,{splittableMarks:h}=t.editor.extensionManager,p=f||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(g=>h.includes(g.type.name));o.ensureMarks(m)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(d,s).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&nu(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)},undoable:t.undoable})}var Ude=t=>"touches"in t,Hde=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.clientX-this.startX,c=a.clientY-this.startY;this.handleResize(l,c)},this.handleTouchMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.touches[0];if(!l)return;const c=l.clientX-this.startX,u=l.clientY-this.startY;this.handleResize(c,u)},this.handleMouseUp=()=>{if(!this.isResizing)return;const a=this.element.offsetWidth,l=this.element.offsetHeight;this.onCommit(a,l),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!1)};var e,n,r,i,s,o;this.node=t.node,this.editor=t.editor,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(e=t.options)!=null&&e.min&&(this.minSize={...this.minSize,...t.options.min}),(n=t.options)!=null&&n.max&&(this.maxSize=t.options.max),(r=t?.options)!=null&&r.directions&&(this.directions=t.options.directions),(i=t.options)!=null&&i.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(s=t.options)!=null&&s.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),(o=t.options)!=null&&o.createCustomHandle&&(this.createCustomHandle=t.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){return this.contentElement}handleEditorUpdate(){const t=this.editor.isEditable;t!==this.lastEditableState&&(this.lastEditableState=t,t?t&&this.handleMap.size===0&&this.attachHandles():this.removeHandles())}update(t,e,n){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,e,n):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const e=document.createElement("div");return e.dataset.resizeHandle=t,e.style.position="absolute",this.classNames.handle&&(e.className=this.classNames.handle),e}positionHandle(t,e){const n=e.includes("top"),r=e.includes("bottom"),i=e.includes("left"),s=e.includes("right");n&&(t.style.top="0"),r&&(t.style.bottom="0"),i&&(t.style.left="0"),s&&(t.style.right="0"),(e==="top"||e==="bottom")&&(t.style.left="0",t.style.right="0"),(e==="left"||e==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{let e;this.createCustomHandle?e=this.createCustomHandle(t):e=this.createHandle(t),e instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${t}") did not return an HTMLElement. Falling back to default handle.`),e=this.createHandle(t)),this.createCustomHandle||this.positionHandle(e,t),e.addEventListener("mousedown",n=>this.handleResizeStart(n,t)),e.addEventListener("touchstart",n=>this.handleResizeStart(n,t)),this.handleMap.set(t,e),this.wrapper.appendChild(e)})}removeHandles(){this.handleMap.forEach(t=>t.remove()),this.handleMap.clear()}applyInitialSize(){const t=this.node.attrs.width,e=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,e?(this.element.style.height=`${e}px`,this.initialHeight=e):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=e,Ude(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,e){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:r,height:i}=this.calculateNewDimensions(this.activeHandle,t,e),s=this.applyConstraints(r,i,n);this.element.style.width=`${s.width}px`,this.element.style.height=`${s.height}px`,this.onResize&&this.onResize(s.width,s.height)}calculateNewDimensions(t,e,n){let r=this.startWidth,i=this.startHeight;const s=t.includes("right"),o=t.includes("left"),a=t.includes("bottom"),l=t.includes("top");return s?r=this.startWidth+e:o&&(r=this.startWidth-e),a?i=this.startHeight+n:l&&(i=this.startHeight-n),(t==="right"||t==="left")&&(r=this.startWidth+(s?e:-e)),(t==="top"||t==="bottom")&&(i=this.startHeight+(a?n:-n)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(r,i,t):{width:r,height:i}}applyConstraints(t,e,n){var r,i,s,o;if(!n){let c=Math.max(this.minSize.width,t),u=Math.max(this.minSize.height,e);return(r=this.maxSize)!=null&&r.width&&(c=Math.min(this.maxSize.width,c)),(i=this.maxSize)!=null&&i.height&&(u=Math.min(this.maxSize.height,u)),{width:c,height:u}}let a=t,l=e;return a<this.minSize.width&&(a=this.minSize.width,l=a/this.aspectRatio),l<this.minSize.height&&(l=this.minSize.height,a=l*this.aspectRatio),(s=this.maxSize)!=null&&s.width&&a>this.maxSize.width&&(a=this.maxSize.width,l=a/this.aspectRatio),(o=this.maxSize)!=null&&o.height&&l>this.maxSize.height&&(l=this.maxSize.height,a=l*this.aspectRatio),{width:a,height:l}}applyAspectRatio(t,e,n){const r=n==="left"||n==="right",i=n==="top"||n==="bottom";return r?{width:t,height:t/this.aspectRatio}:i?{width:e*this.aspectRatio,height:e}:{width:t,height:t/this.aspectRatio}}};function Vde(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof dt){const s=r.index();return r.parent.canReplaceWith(s,s+1,e)}let i=r.depth;for(;i>=0;){const s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}var Wde={};HT(Wde,{createAtomBlockMarkdownSpec:()=>jde,createBlockMarkdownSpec:()=>qde,createInlineMarkdownSpec:()=>Zde,parseAttributes:()=>QT,parseIndentedBlocks:()=>CS,renderNestedMarkdownContent:()=>JT,serializeAttributes:()=>YT});function QT(t){if(!t?.trim())return{};const e={},n=[],r=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),i=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(i){const c=i.map(u=>u.trim().slice(1));e.class=c.join(" ")}const s=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(o)).forEach(([,c,u])=>{var d;const f=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),h=n[f];h&&(e[c]=h.slice(1,-1))});const l=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function YT(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?e.push(n):r!==!1&&r!=null&&e.push(`${n}="${String(r)}"`))}),e.join(" ")}function jde(t){const{nodeName:e,name:n,parseAttributes:r=QT,serializeAttributes:i=YT,defaultAttributes:s={},requiredAttributes:o=[],allowedAttributes:a}=t,l=n||e,c=u=>{if(!a)return u;const d={};return a.forEach(f=>{f in u&&(d[f]=u[f])}),d};return{parseMarkdown:(u,d)=>{const f={...s,...u.attributes};return d.createNode(e,f,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const f=new RegExp(`^:::${l}(?:\\s|$)`,"m"),h=(d=u.match(f))==null?void 0:d.index;return h!==void 0?h:-1},tokenize(u,d,f){const h=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(h);if(!p)return;const m=p[1]||"",g=r(m);if(!o.find(b=>!(b in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),f=i(d),h=f?` {${f}}`:"";return`:::${l}${h} :::`}}}function qde(t){const{nodeName:e,name:n,getContent:r,parseAttributes:i=QT,serializeAttributes:s=YT,defaultAttributes:o={},content:a="block",allowedAttributes:l}=t,c=n||e,u=d=>{if(!l)return d;const f={};return l.forEach(h=>{h in d&&(f[h]=d[h])}),f};return{parseMarkdown:(d,f)=>{let h;if(r){const m=r(d);h=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?h=f.parseChildren(d.tokens||[]):h=f.parseInline(d.tokens||[]);const p={...o,...d.attributes};return f.createNode(e,p,h)},markdownTokenizer:{name:e,level:"block",start(d){var f;const h=new RegExp(`^:::${c}`,"m"),p=(f=d.match(h))==null?void 0:f.index;return p!==void 0?p:-1},tokenize(d,f,h){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,b=""]=g,S=i(b);let C=1;const _=y.length;let x="";const I=/^:::([\w-]*)(\s.*)?/gm,k=d.slice(_);for(I.lastIndex=0;;){const T=I.exec(k);if(T===null)break;const P=T.index,O=T[1];if(!((p=T[2])!=null&&p.endsWith(":::"))){if(O)C+=1;else if(C-=1,C===0){const D=k.slice(0,P);x=D.trim();const F=d.slice(0,_+P+T[0].length);let B=[];if(x)if(a==="block")for(B=h.blockTokens(D),B.forEach(N=>{N.text&&(!N.tokens||N.tokens.length===0)&&(N.tokens=h.inlineTokens(N.text))});B.length>0;){const N=B[B.length-1];if(N.type==="paragraph"&&(!N.text||N.text.trim()===""))B.pop();else break}else B=h.inlineTokens(x);return{type:e,raw:F,attributes:S,content:x,tokens:B}}}}}},renderMarkdown:(d,f)=>{const h=u(d.attrs||{}),p=s(h),m=p?` {${p}}`:"",g=f.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function Kde(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(t);for(;r!==null;){const[,i,s,o]=r;e[i]=s||o,r=n.exec(t)}return e}function Gde(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function Zde(t){const{nodeName:e,name:n,getContent:r,parseAttributes:i=Kde,serializeAttributes:s=Gde,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=t,c=n||e,u=f=>{if(!l)return f;const h={};return l.forEach(p=>{const m=typeof p=="string"?p:p.name,g=typeof p=="string"?void 0:p.skipIfDefault;if(m in f){const y=f[m];if(g!==void 0&&y===g)return;h[m]=y}}),h},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(f,h)=>{const p={...o,...f.attributes};if(a)return h.createNode(e,p);const m=r?r(f):f.content||"";return m?h.createNode(e,p,[h.createTextNode(m)]):h.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(f){const h=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=f.match(h),m=p?.index;return m!==void 0?m:-1},tokenize(f,h,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=f.match(m);if(!g)return;let y="",b="";if(a){const[,C]=g;b=C}else{const[,C,_]=g;b=C,y=_||""}const S=i(b.trim());return{type:e,raw:g[0],content:y.trim(),attributes:S}}},renderMarkdown:f=>{let h="";r?h=r(f):f.content&&f.content.length>0&&(h=f.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(f.attrs||{}),m=s(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${h}[/${c}]`}}}function CS(t,e,n){var r,i,s,o;const a=t.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const f=a[u],h=f.match(e.itemPattern);if(!h){if(l.length>0)break;if(f.trim()===""){u+=1,c=`${c}${f}
`;continue}else return}const p=e.extractItemData(h),{indentLevel:m,mainContent:g}=p;c=`${c}${f}
`;const y=[g];for(u+=1;u<a.length;){const _=a[u];if(_.trim()===""){const I=a.slice(u+1).findIndex(P=>P.trim()!=="");if(I===-1)break;if((((i=(r=a[u+1+I].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:i.length)||0)>m){y.push(_),c=`${c}${_}
`,u+=1;continue}else break}if((((o=(s=_.match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m)y.push(_),c=`${c}${_}
`,u+=1;else break}let b;const S=y.slice(1);if(S.length>0){const _=S.map(x=>x.slice(m+d)).join(`
`);_.trim()&&(e.customNestedParser?b=e.customNestedParser(_):b=n.blockTokens(_))}const C=e.createToken(p,b);l.push(C)}if(l.length!==0)return{items:l,raw:c}}function JT(t,e,n,r){if(!t||!Array.isArray(t.content))return"";const i=typeof n=="function"?n(r):n,[s,...o]=t.content,a=e.renderChildren([s]),l=[`${i}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(f=>f?e.indent(f):"").join(`
`);l.push(d)}}),l.join(`
`)}function Xde(t,e,n={}){const{state:r}=e,{doc:i,tr:s}=r,o=t;i.descendants((a,l)=>{const c=s.mapping.map(l),u=s.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(h=>{if(h!==o)return!1;d=h}),!d)return;let f=!1;if(Object.keys(n).forEach(h=>{n[h]!==d.attrs[h]&&(f=!0)}),f){const h=t.type.create({...t.attrs,...n});s.removeMark(c,u,t.type),s.addMark(c,u,h)}}),s.docChanged&&e.view.dispatch(s)}var Ri=class C6 extends XT{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new C6(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},Qde=class{constructor(t,e,n){this.isDragging=!1,this.component=t,this.editor=e.editor,this.options={stopEvent:null,ignoreMutation:null,...n},this.extension=e.extension,this.node=e.node,this.decorations=e.decorations,this.innerDecorations=e.innerDecorations,this.view=e.view,this.HTMLAttributes=e.HTMLAttributes,this.getPos=e.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(t){var e,n,r,i,s,o,a;const{view:l}=this.editor,c=t.target,u=c.nodeType===3?(e=c.parentElement)==null?void 0:e.closest("[data-drag-handle]"):c.closest("[data-drag-handle]");if(!this.dom||(n=this.contentDOM)!=null&&n.contains(c)||!u)return;let d=0,f=0;if(this.dom!==u){const b=this.dom.getBoundingClientRect(),S=u.getBoundingClientRect(),C=(i=t.offsetX)!=null?i:(r=t.nativeEvent)==null?void 0:r.offsetX,_=(o=t.offsetY)!=null?o:(s=t.nativeEvent)==null?void 0:s.offsetY;d=S.x-b.x+C,f=S.y-b.y+_}const h=this.dom.cloneNode(!0);try{const b=this.dom.getBoundingClientRect();h.style.width=`${Math.round(b.width)}px`,h.style.height=`${Math.round(b.height)}px`,h.style.boxSizing="border-box",h.style.pointerEvents="none"}catch{}let p=null;try{p=document.createElement("div"),p.style.position="absolute",p.style.top="-9999px",p.style.left="-9999px",p.style.pointerEvents="none",p.appendChild(h),document.body.appendChild(p),(a=t.dataTransfer)==null||a.setDragImage(h,d,f)}finally{p&&setTimeout(()=>{try{p?.remove()}catch{}},0)}const m=this.getPos();if(typeof m!="number")return;const g=dt.create(l.state.doc,m),y=l.state.tr.setSelection(g);l.dispatch(y)}stopEvent(t){var e;if(!this.dom)return!1;if(typeof this.options.stopEvent=="function")return this.options.stopEvent({event:t});const n=t.target;if(!(this.dom.contains(n)&&!((e=this.contentDOM)!=null&&e.contains(n))))return!1;const i=t.type.startsWith("drag"),s=t.type==="drop";if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(n.tagName)||n.isContentEditable)&&!s&&!i)return!0;const{isEditable:a}=this.editor,{isDragging:l}=this,c=!!this.node.type.spec.draggable,u=dt.isSelectable(this.node),d=t.type==="copy",f=t.type==="paste",h=t.type==="cut",p=t.type==="mousedown";if(!c&&u&&i&&t.target===this.dom&&t.preventDefault(),c&&i&&!l&&t.target===this.dom)return t.preventDefault(),!1;if(c&&a&&!l&&p){const m=n.closest("[data-drag-handle]");m&&(this.dom===m||this.dom.contains(m))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!(l||s||d||f||h||p&&u)}ignoreMutation(t){return!this.dom||!this.contentDOM?!0:typeof this.options.ignoreMutation=="function"?this.options.ignoreMutation({mutation:t}):this.node.isLeaf||this.node.isAtom?!0:t.type==="selection"||this.dom.contains(t.target)&&t.type==="childList"&&(pm()||SS())&&this.editor.isFocused&&[...Array.from(t.addedNodes),...Array.from(t.removedNodes)].every(n=>n.isContentEditable)?!1:this.contentDOM===t.target&&t.type==="attributes"?!0:!this.contentDOM.contains(t.target)}updateAttributes(t){this.editor.commands.command(({tr:e})=>{const n=this.getPos();return typeof n!="number"?!1:(e.setNodeMarkup(n,void 0,{...this.node.attrs,...t}),!0)})}deleteNode(){const t=this.getPos();if(typeof t!="number")return;const e=t+this.node.nodeSize;this.editor.commands.deleteRange({from:t,to:e})}};function dd(t){return new Ode({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:i})=>{const s=bn(t.getAttributes,void 0,r,i);if(s===!1||s===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),f=d+a.length;if(ZT(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===t.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;f<n.to&&o.delete(f,n.to),d>n.from&&o.delete(n.from+u,d),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(s||{})),o.removeStoredMark(t.type)}}})}class Yde extends zde{contentElement=null}const Jde=t=>{const e=new Yde(t);return fM(e,n=>(e.on("transaction",()=>{n(e)}),()=>{e.destroy()}))};class efe{component;props;dom;constructor(e,{element:n,props:r}){this.component=e,this.props=r,this.dom=n,this.dom.classList.add("svelte-renderer")}updateProps(e){Object.assign(this.props,e)}updateAttributes(e){Object.keys(e).forEach(n=>{this.dom.setAttribute(n,e[n])})}destroy(){iM(this.component)}}const _6="TipTapNodeView",tfe=(t,e)=>{if(!t)throw new Error(e)};class nfe extends Qde{mount(){const e=this.component,n=Wt({editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(a={})=>this.updateAttributes(a),deleteNode:()=>this.deleteNode()});this.contentDOMElement=this.node.isLeaf?null:document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.style.whiteSpace="inherit");const r=this.options.context||new L8;r.set(_6,{onDragStart:this.onDragStart.bind(this)});const i=this.options.as??(this.node.isInline?"span":"div"),s=document.createElement(i);s.classList.add(`node-${this.node.type.name}`),this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.editor.on("selectionUpdate",this.handleSelectionUpdate);const o=gk(e,{target:s,props:n,context:r});this.renderer=new efe(o,{element:s,props:n}),this.appendContendDom(),this.updateElementAttributes()}appendContendDom(){const e=this.dom.querySelector("[data-node-view-content]");this.contentDOMElement&&e&&!e.contains(this.contentDOMElement)&&e.appendChild(this.contentDOMElement)}get dom(){return tfe(this.renderer.dom.firstElementChild?.hasAttribute("data-node-view-wrapper"),"Please use the NodeViewWrapper component for your node view."),this.renderer.dom}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:n}=this.editor.state.selection,r=this.getPos();if(typeof r=="number")if(e<=r&&n>=r+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,n,r){const i=s=>{this.renderer.updateProps(s),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(typeof this.options.update=="function"){const s=this.node,o=this.decorations,a=this.innerDecorations;return this.node=e,this.decorations=n,this.innerDecorations=r,this.options.update({oldNode:s,oldDecorations:o,oldInnerDecorations:a,newNode:e,newDecorations:n,newInnerDecorations:r,updateProps:()=>i({node:e,decorations:n,innerDecorations:r})})}return e.type!==this.node.type?!1:(e===this.node&&this.decorations===n&&this.innerDecorations===r||(this.node=e,this.decorations=n,this.innerDecorations=r,i({node:e,decorations:n,innerDecorations:r})),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.dom.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.dom.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const n=this.editor.extensionManager.attributes,r=Jf(this.node,n);e=this.options.attrs({node:this.node,HTMLAttributes:r})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}const A6=(t,e)=>n=>new nfe(t,n,e);var rfe=Ce("<div></div> <!>",1);function ife(t,e){St(e,!0);const n=le(e,"editor",7);let r;bs(async()=>{await ul(),r&&n()?.options.element&&(n().contentElement||(r.append(...Array.from(n().options.element?.childNodes||[])),n().setOptions({element:r}),n().contentElement=r))}),Zu(()=>{if(!n()||(n().contentElement=null,!n().options.element?.firstChild))return;const c=document.createElement("div");c.append(...Array.from(n().options.element?.childNodes||[])),n().setOptions({element:c})});var s=rfe(),o=Ee(s);gr(o,c=>r=c,()=>r);var a=we(o,2);{var l=c=>{var u=Ue(),d=Ee(u);_t(d,()=>e.children),Y(c,u)};Ve(a,c=>{e.children&&c(l)})}Ke(()=>ao(o,1,oM(e.class))),Y(t,s),kt()}function P6(t,e){St(e,!0);const n=le(e,"as",3,"div"),r=Ni(e,["$$slots","$$events","$$legacy","as","children"]),{onDragStart:i}=j2(_6);let s;bs(async()=>{await ul(),s.style.whiteSpace="normal"});var o=Ue(),a=Ee(o);R9(a,n,!1,(l,c)=>{gr(l,h=>s=h,()=>s),kr(l,()=>({"data-node-view-wrapper":"",role:"none",...r,ondragstart:i}));var u=Ue(),d=Ee(u);{var f=h=>{var p=Ue(),m=Ee(p);_t(m,()=>e.children),Y(h,p)};Ve(d,h=>{e.children&&h(f)})}Y(c,u)}),Y(t,o),kt()}class Dp{static isValidNsec(e){return poe(e)}static derivePublicKey(e){return yoe(e)}static pubkeyToNpub(e){try{return e?y5(e):""}catch(n){return console.error("pubkeyããnpubã¸ã®å¤æã¨ã©ã¼:",n),""}}}class sfe{constructor(e,n,r){this.localStorage=e,this.console=n,this.secretKeyStore=r}saveToStorage(e){if(!e?.trim())return{success:!1,error:{type:"validation",message:"Key cannot be empty"}};try{const n=e.trim();return this.localStorage.setItem("nostr-secret-key",n),this.secretKeyStore.set(n),{success:!0}}catch(n){const r={type:"storage",message:"éµã®ä¿å­ã«å¤±æãã¾ãã",originalError:n};return this.console.error("éµã®ä¿å­ã«å¤±æ:",n),{success:!1,error:r}}}loadFromStorage(){let e=this.secretKeyStore.value;if(e)return e;try{return e=this.localStorage.getItem("nostr-secret-key"),e&&this.secretKeyStore.set(e),e}catch(n){return this.console.error("éµã®èª­ã¿è¾¼ã¿ã«å¤±æ:",n),null}}getFromStore(){return this.secretKeyStore.value}hasStoredKey(){try{return!!this.localStorage.getItem("nostr-secret-key")}catch(e){return this.console.error("ã¹ãã¬ã¼ã¸ã¢ã¯ã»ã¹ã¨ã©ã¼:",e),!1}}}class ofe{constructor(e){this.window=e}isWindowNostrAvailable(){return typeof this.window<"u"&&"nostr"in this.window&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}async getPublicKeyFromWindowNostr(){if(!this.isWindowNostrAvailable()||!this.window?.nostr)return{success:!1,error:{type:"validation",message:"window.nostr is not available"}};try{return{success:!0,pubkey:await this.window.nostr.getPublicKey()}}catch(e){const n={type:"network",message:"window.nostrããå¬ééµã®åå¾ã«å¤±æãã¾ãã",originalError:e};return console.error("window.nostrããå¬ééµã®åå¾ã«å¤±æ:",e),{success:!1,error:n}}}}class I6{constructor(e={}){this.deps=e,this._nsecStore.subscribe(n=>this.updateFromNsec(n))}_nsecStore=Ds("");_dataStore=Ds({hex:"",npub:"",nprofile:""});_isValidStore=Ds(!1);_isNostrLoginStore=Ds(!1);nsec={subscribe:this._nsecStore.subscribe};data={subscribe:this._dataStore.subscribe};isValid={subscribe:this._isValidStore.subscribe};isNostrLogin={subscribe:this._isNostrLoginStore.subscribe};hex=nl(this._dataStore,e=>e.hex);npub=nl(this._dataStore,e=>e.npub);nprofile=nl(this._dataStore,e=>e.nprofile);setNsec(e){const n=e?.trim()||"";this._nsecStore.set(n),this._isNostrLoginStore.set(!1)}setNostrLoginAuth(e){if(e.type==="logout"){this.clear();return}if(!e.pubkey){console.warn("NostrLoginAuth: pubkey is required for login/signup");return}try{const n=e.npub||hl.npubEncode(e.pubkey),r=hl.nprofileEncode({pubkey:e.pubkey,relays:[]});let i;if(this.deps.localStorage&&typeof this.deps.localStorage.getItem=="function")try{const s=this.deps.localStorage.getItem("__nostrlogin_accounts");if(s){const o=JSON.parse(s);if(Array.isArray(o)){const a=o.find(l=>l?.pubkey===e.pubkey);if(a?.authMethod){const l=a.authMethod;(l==="connect"||l==="extension"||l==="local")&&(i=l)}}}}catch(s){console.warn("Failed to get authMethod from localStorage:",s)}this._dataStore.set({hex:e.pubkey,npub:n,nprofile:r}),this._isValidStore.set(!0),this._isNostrLoginStore.set(!0),this._nsecStore.set(""),this.deps.setNostrLoginAuthFn?this.deps.setNostrLoginAuthFn(e.pubkey,n,r,i):setTimeout(()=>{this.deps.setNostrLoginAuthFn&&this.deps.setNostrLoginAuthFn(e.pubkey,n,r,i)},10),console.log("[PublicKeyState] NostrLoginèªè¨¼ç¶æãè¨­å®:",{pubkey:e.pubkey,npub:n,type:e.type,authMethod:i})}catch(n){console.error("Failed to set NostrLogin auth:",n),this.clear()}}updateFromNsec(e){if(!e||!Dp.isValidNsec(e)){this._resetState();return}try{const n=Dp.derivePublicKey(e);n.hex?(this._dataStore.set(n),this._isValidStore.set(!0)):this._resetState()}catch(n){console.error("Failed to derive public key from nsec:",n),this._resetState()}}_resetState(){this._dataStore.set({hex:"",npub:"",nprofile:""}),this._isValidStore.set(!1)}clear(){this._nsecStore.set(""),this._isNostrLoginStore.set(!1),this.deps.clearAuthStateFn&&this.deps.clearAuthStateFn()}get currentIsValid(){return oo(this._isValidStore)}get currentHex(){return oo(this.hex)}get currentIsNostrLogin(){return oo(this._isNostrLoginStore)}}class O6{storage;externalAuth;constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.console||(typeof window<"u"?window.console:{}),i=e.secretKeyStore||{value:null,set:()=>{}},s=e.window||(typeof window<"u"?window:void 0);this.storage=new sfe(n,r,i),this.externalAuth=new ofe(s)}isValidNsec(e){return Dp.isValidNsec(e)}derivePublicKey(e){return Dp.derivePublicKey(e)}pubkeyToNpub(e){return Dp.pubkeyToNpub(e)}saveToStorage(e){return this.storage.saveToStorage(e)}loadFromStorage(){return this.storage.loadFromStorage()}getFromStore(){return this.storage.getFromStore()}hasStoredKey(){return this.storage.hasStoredKey()}isWindowNostrAvailable(){return this.externalAuth.isWindowNostrAvailable()}async getPublicKeyFromWindowNostr(){return await this.externalAuth.getPublicKeyFromWindowNostr()}getStorage(){return this.storage}getExternalAuth(){return this.externalAuth}}const _S=new O6;let M6=Wt({content:"",hashtags:[],tags:[]});const uc=M6;function afe(){return V7(M6)}Wt({});let Xh=Wt({});const AS={get value(){return Xh},set:t=>{Object.assign(Xh,t)},update:t=>{const e=t(Xh);Object.assign(Xh,e)},subscribe:t=>(Ge(()=>{t(Xh)}),()=>{})};let Qh=me(!1),u2=me("");const qu={get value(){return E(Qh)},set:t=>{K(Qh,t,!0)},toggle:()=>{K(Qh,!E(Qh))},reset:()=>{K(Qh,!1)}},Af={get value(){return E(u2)},set:t=>{K(u2,t,!0)},reset:()=>{K(u2,"")}},G3=["client","eHagaki","31990:ec42c765418b3db9c85abff3a88f4a3bbe57535eebbdc54522041fa5328c0600:1754918316480","wss://relay.nostr.band"];function lfe(){try{const t=localStorage.getItem("clientTagEnabled");return(t===null?!0:t==="true")?[...G3]:null}catch{return[...G3]}}function cfe(t){return encodeURI(t.trim())}function ufe(t){return Aie.includes(t)}function dfe(t){const e=t.toLowerCase();return Pie.some(n=>e.endsWith(n))}function ffe(t){const e=t.toLowerCase();return Iie.some(n=>e.endsWith(n))}function N6(t){try{const e=cfe(t),n=new URL(e);return ufe(n.protocol)?n.href:null}catch{return null}}function R6(t){const e=N6(t);if(!e)return null;try{const n=new URL(e);return dfe(n.pathname)?e:null}catch{return null}}function hfe(t){const e=N6(t);if(!e)return null;try{const n=new URL(e);return ffe(n.pathname)?e:null}catch{return null}}function D6(t){return t.replace(/\r\n/g,`
`).replace(/\r/g,`
`)}function pfe(t){return!t||/[\s\n\u3000]/.test(t)}function mfe(t){const e=/([.,;:!?ï¼ãããããã\]}>ï¼]){2,}$/,n=t.match(e);if(n){const r=n[0];return{cleanUrl:t.slice(0,-r.length),trailingChars:r}}return{cleanUrl:t,trailingChars:""}}function gfe(t){const{cleanUrl:e}=mfe(t);return{cleanUrl:e,actualLength:e.length}}function yfe(t){if(t.childCount===1){const e=t.firstChild;return e?.type.name==="paragraph"&&e.content.size===0}return t.childCount===0}function bfe(t){return yfe(t.doc)}function wfe(t,e){return t.type.name==="paragraph"&&t.content.size===e&&t.textContent.trim().length===e}function vfe(t){const e=[];return t.descendants(n=>{if(n.type.name==="paragraph"){const r=n.textContent;e.push(r)}else if(n.type.name==="image"){const r=n.attrs?.src;r&&e.push(r)}else if(n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}}),e}function xfe(t){if(!t)return null;try{const e=typeof t=="function"?t():t;return e?.state?.doc??e?.view?.state?.doc??null}catch{return null}}function L6(t){const e=xfe(t);return e?vfe(e).join(`
`):""}function Sfe(t,e,n){if(t===e)return null;let r=t;if(n){const i=n.resolve(t);i.parent.type.name==="paragraph"&&(r=i.after())}return r<e?{insertPos:r,deleteStart:e+1,deleteEnd:e+2}:r>e+1?{insertPos:r-1,deleteStart:e,deleteEnd:e+1}:null}function kfe(t,e,n){return n.insertPos<n.deleteStart?t.insert(n.insertPos,e).delete(n.deleteStart,n.deleteEnd):t.delete(n.deleteStart,n.deleteEnd).insert(n.insertPos,e)}function d2(t,e,n){const{tr:r,doc:i,schema:s}=t.state,o=e.pos,a=Sfe(n,o,i);if(!a)return!0;const l=s.nodes.image.create(e.attrs);try{const c=kfe(r,l,a);return t.dispatch(c),!0}catch(c){return console.error("Error moving image:",c),!1}}function Z3(t){t.dispatch(t.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null}))}function eC(t,e,n){if(!t)return;t.state.doc.descendants((i,s)=>{if(e(i,s))return n(i,s),!1})}function Efe(t,e,n,r){t.update(i=>{const s={...i};return e&&delete s[e],s})}function f2(t,e,n,r,i=!1){n&&(Efe(r,t),eC(n,(s,o)=>{const a=s.type?.name;return(e&&a==="video"||!e&&a==="image")&&(s.attrs?.src===t||s.attrs?.id===t)},(s,o)=>{const a=n.state.tr.delete(o,o+s.nodeSize);n.view.dispatch(a),i&&console.log("[uploadHelper] Deleted placeholder:",t)}))}function B6(t,e=!1){if(!t)return;const{state:n}=t,{doc:r}=n,i=n.tr;let s=0;const o=[];r.descendants((a,l)=>{const c=a.type?.name,u=a.attrs?.isPlaceholder===!0||a.attrs?.src?.startsWith("placeholder-")||a.attrs?.src?.startsWith("blob:");(c==="image"||c==="video")&&u&&o.push({pos:l,size:a.nodeSize})}),o.reverse().forEach(({pos:a,size:l})=>{i.delete(a,a+l),s++}),s>0&&(t.view.dispatch(i),e&&console.log(`[editorUtils] Deleted ${s} placeholder(s)`))}function PS(t){if(!t||!t.types)return!1;try{return Array.from(t.types).some(e=>e==="application/x-tiptap-node")}catch{return!1}}function F6(t){if(!t)return!1;try{return Array.from(t.types).includes("Files")||t.files&&t.files.length>0}catch{return!!(t.files&&t.files.length>0)}}function Tfe(t){let e=me(!1);function n(s){const o=s.dataTransfer,a=PS(o);F6(o)&&!a?(s.preventDefault(),E(e)||(K(e,!0),t.classList.add("drag-over"))):E(e)&&(K(e,!1),t.classList.remove("drag-over"))}function r(s){E(e)&&(K(e,!1),t.classList.remove("drag-over"))}async function i(s){K(e,!1),t.classList.remove("drag-over");const o=s.dataTransfer;PS(o)||o?.files&&o.files.length>0&&typeof t.__uploadFiles=="function"&&(s.preventDefault(),t.__uploadFiles(o.files))}return t.addEventListener("dragover",n),t.addEventListener("dragleave",r),t.addEventListener("drop",i),{destroy(){t.removeEventListener("dragover",n),t.removeEventListener("dragleave",r),t.removeEventListener("drop",i)}}}function Cfe(t,e){const n=Tfe(t);function r(o){const a=o.dataTransfer,l=PS(a);F6(a)&&!l?e.dragOver(!0):e.dragOver(!1)}function i(o){e.dragOver(!1)}function s(o){e.dragOver(!1)}return t.addEventListener("dragover",r),t.addEventListener("dragleave",i),t.addEventListener("drop",s),{destroy(){n?.destroy?.(),t.removeEventListener("dragover",r),t.removeEventListener("dragleave",i),t.removeEventListener("drop",s)}}}function _fe(t){function e(n){if(!n.clipboardData)return;const r=[];for(const i of n.clipboardData.items)if(i.kind==="file"&&i.type.startsWith("image/")){const s=i.getAsFile();s&&r.push(s)}r.length>0&&(n.preventDefault(),t.__uploadFiles?.(r))}return t.addEventListener("paste",e),{destroy(){t.removeEventListener("paste",e)}}}function Afe(t){function e(r){const i=r.target;if(i&&i.closest('.editor-image-button[data-dragging="true"]')){const s=r.touches[0],o=120,a=Vc.querySelector(".tiptap-editor");if(a){const l=a.getBoundingClientRect(),c=s.clientY<l.top+o,u=s.clientY>l.bottom-o;if(!c&&!u)return r.preventDefault(),!1}}}function n(r){const i=Vc.querySelectorAll(".drop-zone-indicator");i.forEach(s=>{s.classList.remove("drop-zone-hover"),s.classList.add("drop-zone-fade-out")}),setTimeout(()=>{i.forEach(s=>{s.parentNode&&s.parentNode.removeChild(s)})},300)}return t.addEventListener("touchmove",e),t.addEventListener("touchend",n),{destroy(){t.removeEventListener("touchmove",e),t.removeEventListener("touchend",n)}}}function Pfe(t){function e(n){if((n.ctrlKey||n.metaKey)&&(n.key==="Enter"||n.key==="NumpadEnter")){n.preventDefault();const r=t.__currentEditor,i=typeof r=="function"?r():r,s=t.__hasStoredKey,o=typeof s=="function"?s():s,a=t.__postStatus,l=typeof a=="function"?a():a,c=i?L6(i):"";!l?.sending&&c.trim()&&o&&t.__submitPost?.()}}return t.addEventListener("keydown",e),{destroy(){t.removeEventListener("keydown",e)}}}function Ife(t){let e=!1;return t?.descendants(n=>{n.type?.name==="image"&&(e=!0)}),e}function Ofe(t){let e=!1;return t?.descendants(n=>{n.type?.name==="video"&&(e=!0)}),e}function Mfe(t){return Ife(t)||Ofe(t)}function Nfe(t){const{currentEditor:e,editorContainerEl:n,callbacks:r}=t,i=a=>{const c=a.detail.plainText,u=e?Mfe(e.state?.doc):!1;r.onContentUpdate?.(c,u)},s=a=>{const l=a;r.onImageFullscreenRequest?.(l.detail.src,l.detail.alt||"")},o=a=>{const c=a?.detail?.pos;if(c!=null&&!(!e||!e.view)){try{"ontouchstart"in window||navigator.maxTouchPoints>0||e.view.focus();const u=dt.create(e.state.doc,c);e.view.dispatch(e.state.tr.setSelection(u).scrollIntoView())}catch(u){console.warn("select-image-node handler failed:",u)}r.onSelectImageNode?.(c)}};return window.addEventListener("editor-content-changed",i),window.addEventListener("image-fullscreen-request",s),window.addEventListener("select-image-node",o),n&&(n.addEventListener("image-fullscreen-request",s),n.addEventListener("select-image-node",o)),{handleContentUpdate:i,handleImageFullscreenRequest:s,handleSelectImageNode:o}}function Rfe(t,e){window.removeEventListener("editor-content-changed",t.handleContentUpdate),window.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),window.removeEventListener("select-image-node",t.handleSelectImageNode),e&&(e.removeEventListener("image-fullscreen-request",t.handleImageFullscreenRequest),e.removeEventListener("select-image-node",t.handleSelectImageNode))}function $6(t){const e=[],n=rS.source;return t.descendants((r,i)=>{if(!r.isText||!r.text)return;const s=r.text,o=new RegExp(n,"g");let a;for(;(a=o.exec(s))!==null;){const l=a[0].indexOf("#");if(l===-1)continue;const c=i+a.index+l,u=c+1+a[1].length;e.push({from:c,to:u,hashtag:a[1]})}}),e}function Dfe(t){const e=[],n=new Set;rS.lastIndex=0;let r;for(;(r=rS.exec(t))!==null;){const i=r[1];i&&i.trim()&&(n.has(i)||(n.add(i),e.push(i)))}return e}function Lfe(t){const e=$6(t),n=[],r=new Set;for(const i of e)r.has(i.hashtag)||(r.add(i.hashtag),n.push(i.hashtag));return n}function Bfe(t){Array.isArray(uc.hashtags)&&[...uc.hashtags];let e,n;typeof t=="string"?(n=t,e=Dfe(n)):(e=Lfe(t),n=t.textContent);const r=e.map(i=>["t",i.toLowerCase()]);uc.content=n,uc.hashtags=e,uc.tags=r}function X3(t){const n=$6(t).map(({from:r,to:i})=>_r.inline(r,i,{class:Ao.HASHTAG_CLASS}));return kn.create(t,n)}function Ffe(t,e,n,r,i,s){const o=e.doc.resolve(i),a=o.parent,l=a.type.name==="paragraph"&&a.textContent.trim().length===0,c=wfe(a,s-i),u=bfe(e),d=n.create({src:r,alt:"Image"});if(l||c){const f=o.depth,h=o.start(f),p=o.end(f);return u||e.doc.childCount===1&&c?t.delete(0,e.doc.content.size).insert(0,d):t.replaceWith(h,p,d)}return t.replaceWith(i,s,d)}function $fe(t,e,n){const r=t.schema.marks.link,i=t.schema.nodes.image;if(!r)return null;let s=t.tr,o=!1;const a=[];e&&t.doc.descendants((l,c)=>{if(!l.isText)return;l.marks.find(d=>d.type===r)&&a.push({type:"removeMark",from:c,to:c+l.nodeSize})}),t.doc.descendants((l,c)=>{if(!l.isTextblock||l.childCount===0)return;let u="";const d=[];if(l.forEach((h,p)=>{h.isText&&h.text&&(d.push({textOffset:u.length,docPos:c+1+p}),u+=h.text)}),!u)return;let f;for(;(f=Ao.URL_REGEX.exec(u))!==null;){if(typeof f.index!="number")continue;const h=f.index,p=f[0],m=h>0?u[h-1]:void 0;if(!pfe(m))continue;const{cleanUrl:g,actualLength:y}=gfe(p),b=h+y,S=c+1+h,C=c+1+b;if(n){const _=R6(g);if(_&&i){a.push({type:"replaceImage",from:S,to:C,imageUrl:_});break}}if(e){if(g.length<8||!/^https?:\/\/[a-zA-Z0-9]/.test(g))continue;try{const x=new URL(g).hostname;if(x.length>0&&x.includes(".")){const I=x.split("."),k=I[I.length-1];if(k&&k.length>=2){const T=r.create({href:g});a.push({type:"addMark",from:S,to:C,mark:T})}}}catch{continue}}}}),a.sort((l,c)=>c.from-l.from);for(const l of a)l.type==="removeMark"?(s=s.removeMark(l.from,l.to,r),o=!0):l.type==="addMark"&&l.mark?(s=s.addMark(l.from,l.to,l.mark),o=!0):l.type==="replaceImage"&&l.imageUrl&&(s=Ffe(s,t,i,l.imageUrl,l.from,l.to),o=!0);return o&&s.docChanged?s:null}const zfe=Tn.create({name:"contentTracking",addOptions(){return{debounceDelay:Ao.DEBOUNCE_DELAY,enableHashtags:Ao.ENABLE_HASHTAGS,enableAutoLink:Ao.ENABLE_AUTO_LINK,enableImageConversion:Ao.ENABLE_IMAGE_CONVERSION}},addStorage(){return{updateTimeout:null}},addProseMirrorPlugins(){const t=this.storage,e=this.options;return[...e.enableHashtags?[new cn({key:new En(Ao.PLUGIN_KEYS.HASHTAG_DECORATION),state:{init:(n,{doc:r})=>X3(r),apply(n,r){return n.docChanged?X3(n.doc):r.map(n.mapping,n.doc)}},props:{decorations(n){return this.getState(n)}}})]:[],...e.enableAutoLink||e.enableImageConversion?[new cn({key:new En(Ao.PLUGIN_KEYS.LINK_AND_IMAGE_CONVERSION),appendTransaction:(n,r,i)=>{if(!n.some(l=>l.docChanged))return null;const o=!n.some(l=>l.getMeta("paste")),a=$fe(i,e.enableAutoLink??!0,o&&(e.enableImageConversion??!0));return a&&a.setMeta("addToHistory",!1),a}})]:[],new cn({key:new En(Ao.PLUGIN_KEYS.CONTENT_UPDATE_TRACKER),state:{init:()=>null,apply(n){return n.docChanged&&(t.updateTimeout&&clearTimeout(t.updateTimeout),t.updateTimeout=setTimeout(()=>{Bfe(n.doc),window.dispatchEvent(new CustomEvent("editor-content-changed",{detail:{plainText:n.doc.textContent}}))},e.debounceDelay??Ao.DEBOUNCE_DELAY)),null}}})]},onDestroy(){this.storage.updateTimeout&&clearTimeout(this.storage.updateTimeout)}});function Q3(t){return t.split(/[\n ]+/).map(e=>e.trim()).filter(Boolean).map(e=>{const n=R6(e);if(n)return{url:n,type:"image"};const r=hfe(e);return r?{url:r,type:"video"}:null}).filter(e=>e!==null)}function Ufe(t,e){const n=e.parent;return n.type.name==="paragraph"&&n.textContent.trim().length===0}function Hfe(t){const{selection:e}=t,n=t.doc.resolve(e.from);if(Ufe(e,n)){const r=n.depth,i=n.start(r),s=n.end(r);return{start:i,end:s}}return null}function Y3(t,e){return t.map((n,r)=>{const i=Date.now();if(n.type==="image")return e.nodes.image.create({src:n.url,alt:"Pasted image"});{const s=`pasted-video-${i}-${r}`;return e.nodes.video.create({src:n.url,id:s})}})}function J3(t){const e=t.doc;if(!e)return t;const n=[];return e.descendants((r,i)=>{if(r.type.name==="paragraph"&&r.textContent.trim().length===0){if(e.childCount===1&&e.firstChild===r)return;let s=!1;r.descendants(o=>o.type&&(o.type.name==="image"||o.type.name==="video")?(s=!0,!1):!0),s||n.push([i,i+r.nodeSize])}}),n.sort((r,i)=>i[0]-r[0]),n.forEach(([r,i])=>{t=t.delete(r,i)}),t}const Vfe=Tn.create({name:"mediaPaste",addProseMirrorPlugins(){return[new cn({key:new En("image-paste"),props:{handlePaste:(t,e)=>{const n=e.clipboardData?.getData("text/plain")||"",r=Q3(n);if(r.length>0){e.preventDefault();const{state:i,dispatch:s}=t,{tr:o,selection:a,schema:l}=i,c=Y3(r,l);let u=o;const d=Hfe(i);if(d&&c.length>0){u=u.replaceWith(d.start,d.end,c[0]);let f=d.start+c[0].nodeSize;for(let h=1;h<c.length;h++)u=u.insert(f,c[h]),f+=c[h].nodeSize}else{let f=a.from;c.forEach(h=>{u=u.insert(f,h),f+=h.nodeSize})}return u=J3(u),s(u),!0}return!1},handleTextInput:(t,e,n,r)=>{if(r.includes(`
`)||r.length>20){const i=Q3(r);if(i.length>0){const{state:s,dispatch:o}=t,{tr:a,schema:l}=s,c=Y3(i,l);let u=a;u=u.delete(e,n);let d=e;return c.forEach(f=>{u=u.insert(d,f),d+=f.nodeSize}),u=J3(u),o(u),!0}}return!1}}})]}}),Wfe=Tn.create({name:"imageDragDrop",addProseMirrorPlugins(){const t=new En("image-drag-drop"),e=new En("drop-zone-indicator");return[new cn({key:t,state:{init:()=>({isDragging:!1,draggedNodePos:null,autoScrollInterval:null}),apply:(n,r)=>{const i=n.getMeta("imageDrag");return i?i.isDragging===!1&&r.autoScrollInterval?(clearInterval(r.autoScrollInterval),{...r,...i,autoScrollInterval:null}):{...r,...i}:r}},props:{handleDrop:(n,r,i,s)=>{const o=r.dataTransfer?.getData("application/x-tiptap-node");if(!s&&o)try{const a=JSON.parse(o);if(a.type==="image"){r.preventDefault();const l=n.posAtCoords({left:r.clientX,top:r.clientY});if(l&&typeof a.pos=="number")return Z3(n),d2(n,a,l.pos),!0}}catch(a){console.warn("Failed to parse drag data:",a)}return!1},handleDOMEvents:{dragstart:(n,r)=>Xa()?(r.preventDefault(),!0):!1,dragover:(n,r)=>Xa()?(r.preventDefault(),!0):!1,drop:(n,r)=>Xa()?(r.preventDefault(),!0):!1}},view:n=>{let r=null;const i=(c,u)=>{r&&(cancelAnimationFrame(r),r=null);const d=n.dom;if(!d)return;const f=d.getBoundingClientRect(),h=pI;let p=0;c==="up"?p=u-f.top:p=f.bottom-u;const m=Math.max(0,Math.min(1,p/h)),g=mI+(Nie-mI)*(1-m),y=()=>{const b=d.scrollTop,S=d.scrollHeight,C=d.clientHeight;if(c==="up"&&b>0){const _=Math.max(0,b-g);d.scrollTop=_,_>0&&(r=requestAnimationFrame(y))}else if(c==="down"&&b<S-C){const _=Math.min(S-C,b+g);d.scrollTop=_,_<S-C&&(r=requestAnimationFrame(y))}};r=requestAnimationFrame(y)},s=()=>{r&&(cancelAnimationFrame(r),r=null)},o=c=>{const{nodeData:u,dropPosition:d,dropX:f,dropY:h}=c.detail;if(s(),n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!1,draggedNodePos:null})),u&&u.type==="image"){let p;typeof d=="number"?p=d:p=n.posAtCoords({left:f,top:h})?.pos||u.pos,typeof u.pos=="number"&&d2(n,u,p)}},a=c=>{const{nodePos:u}=c.detail;n.dispatch(n.state.tr.setMeta("imageDrag",{isDragging:!0,draggedNodePos:u}))},l=c=>{const{touchY:u}=c.detail;if(typeof u!="number"||!t.getState(n.state)?.isDragging)return;const f=n.dom;if(!f)return;const h=f.getBoundingClientRect(),p=pI;u<h.top+p?i("up",u):u>h.bottom-p?i("down",u):s()};return window.addEventListener("touch-image-drop",o),window.addEventListener("touch-image-drag-start",a),window.addEventListener("touch-image-drag-move",l),{destroy(){s(),window.removeEventListener("touch-image-drop",o),window.removeEventListener("touch-image-drag-start",a),window.removeEventListener("touch-image-drag-move",l)}}}}),new cn({key:e,state:{init(){return kn.empty},apply(n,r,i,s){if(!Xa())return kn.empty;const o=t.getState(s);if(!o?.isDragging)return kn.empty;const a=[],l=s.doc;let c=!1;if(typeof o.draggedNodePos=="number"){const u=l.firstChild;u&&u.type.name==="image"&&u.attrs&&o.draggedNodePos===0&&(c=!0)}return c||a.push(_r.widget(0,()=>{const u=document.createElement("div");u.className="drop-zone-indicator drop-zone-top",u.setAttribute("data-drop-pos","0");const d=document.createElement("div");return d.className="drop-zone-bar",u.appendChild(d),u},{side:-1})),l.descendants((u,d)=>{if(u.type.name==="paragraph"||u.type.name==="image"){const f=d+u.nodeSize;if(typeof o.draggedNodePos=="number"&&f===o.draggedNodePos)return;o.draggedNodePos!==d&&a.push(_r.widget(f,()=>{const h=document.createElement("div");h.className="drop-zone-indicator drop-zone-between",h.setAttribute("data-drop-pos",f.toString());const p=document.createElement("div");return p.className="drop-zone-bar",h.appendChild(p),h},{side:1}))}}),kn.create(l,a)}},props:{decorations(n){return this.getState(n)}}})]},addStorage(){return{moveImageNode:(t,e,n)=>(Z3(t),d2(t,e,n))}}}),jfe=Tn.create({name:"smartBackspace",addProseMirrorPlugins(){return[new cn({key:new En("smart-backspace"),props:{handleKeyDown(t,e){if(e.key!=="Backspace"||Xa()&&document.activeElement!==t.dom)return!1;const{state:n}=t,{selection:r,doc:i}=n;if(r.empty&&r.from===1){const s=i.firstChild,o=i.childCount>1?i.child(1):null;if(s&&s.type.name==="paragraph"&&s.content.size===0&&o&&o.type.name==="image")return t.dispatch(n.tr.delete(0,s.nodeSize)),!0}return!1}}})]}});var qfe=Ce('<div class="loader-container svelte-11vtpur"><div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div> <div class="square svelte-11vtpur"></div></div>'),Kfe=Ce('<div class="placeholder-image svelte-11vtpur" aria-hidden="true"></div>'),Gfe=Ce('<span class="placeholder-text loading-text svelte-11vtpur"> </span>'),Zfe=Ce("<div><!> <!> <!></div>");function Nc(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=le(e,"text",3,!1),o=le(e,"showImage",3,!1),a=le(e,"showLoader",3,!1),l=le(e,"customClass",3,""),c=oe(()=>typeof s()=="string"?s():s()===!0?n()("loadingPlaceholder.loading"):"");var u=Zfe(),d=ie(u);{var f=y=>{var b=qfe();Y(y,b)};Ve(d,y=>{a()&&y(f)})}var h=we(d,2);{var p=y=>{var b=Kfe();Y(y,b)};Ve(h,y=>{o()&&y(p)})}var m=we(h,2);{var g=y=>{var b=Gfe(),S=ie(b);Ke(()=>Re(S,E(c))),Y(y,b)};Ve(m,y=>{E(c)&&y(g)})}Ke(()=>{ao(u,1,`loading-placeholder ${l()??""}`,"svelte-11vtpur"),wn(u,"aria-label",E(c))}),Y(t,u),kt(),i()}function Xfe(t,e={}){const{collapseEmptyLines:n=!1,maxConsecutiveEmptyLines:r=2}=e;let i=D6(t);if(n){const o=new RegExp(`\\n{${r+2},}`,"g");i=i.replace(o,`
`.repeat(r+1))}let s=i.split(`
`);return s.length>0&&s[s.length-1]===""&&(s=s.slice(0,-1)),s.length===1&&s[0]===""&&(s=[]),{normalized:i,lines:s}}function Qfe(t){return t.join(`
`)}async function Ow(t,e="",n,r){const i=n??navigator;try{if(i?.clipboard&&typeof i.clipboard.writeText=="function"){await i.clipboard.writeText(t),console.log(`${e} copied to clipboard`);return}}catch(s){console.error(`Failed to copy ${e}:`,s),await eO(t,e,r);return}await eO(t,e,r)}async function eO(t,e="",n){const r=n??window;try{const i=r&&r.document||document,s=i.createElement("textarea");s.value=t,s.style.position="fixed",s.style.left="-9999px",s.style.top="0",s.setAttribute("readonly","true"),i.body.appendChild(s),s.focus(),s.select();const o=i.execCommand&&i.execCommand("copy");if(i.body.removeChild(s),o)console.log(`${e} copied to clipboard (fallback)`);else throw new Error("fallback_copy_failed")}catch(i){console.warn(`Failed to copy ${e} (both clipboard API and fallback failed):`,i)}}function Yfe(t,e,n,r,i,s){const o=window,a=navigator,l=s?.editorObj??window.__currentEditor,c=or,u=typeof c=="function"?c:oo(c);return[{label:u("videoContextMenu.playPause"),action:()=>{const d=document.querySelector(`video[data-node-id="${i}"]`);d?d.paused?d.play().catch(f=>{console.warn("Failed to play video:",f)}):d.pause():console.warn("Video element not found for nodeId:",i)},src:t,icon:"/icons/play_pause_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg"},{label:u("videoContextMenu.copyUrl"),action:async()=>{Ow(t,"video URL",a,o)},src:t,icon:"/icons/copy-solid-full.svg"},{label:u("videoContextMenu.delete"),action:()=>{const d=l?.view;if(d?.state&&d?.dispatch){let f=!1;d.state.doc.descendants((h,p)=>{if(!f&&h.type.name==="video"&&h.attrs.id===i)return d.dispatch(d.state.tr.delete(p,p+h.nodeSize)),f=!0,!1})}},disabled:!1,src:t,icon:"/icons/trash-solid-full.svg"}]}function Kg(t,e,n,r,i,s){const o=((c,u,...d)=>setTimeout(c,u,...d));let a=!1,l;if(t.update(c=>(a=c.open&&c.nodeId!==e,l=c.nodeId,c)),a&&l){t.set({open:!1,nodeId:void 0,src:void 0,videoElement:void 0}),o(()=>{t.set({open:!0,nodeId:e,src:r,videoElement:i})},0);return}t.set({open:!0,nodeId:e,src:r,videoElement:i})}function Jfe(t,e,n,r){if(!t.open||!t.nodeId)return null;const i=t.nodeId,s=t.src||"";t.videoElement;let o=0,a=1;e?.state?.doc&&e.state.doc.descendants((d,f)=>{if(d.attrs.id===i)return o=f,a=d.nodeSize,!1});const c=Yfe(s,()=>o,a,!0,i,{editorObj:e});let u={x:0,y:0};return n&&(u=Tf(n.x,n.y)),{items:c,x:u.x,y:u.y}}var ehe=Ce('<video controls playsinline="" autoplay loop preload="metadata"><track kind="captions"/> </video>',2),the=Ce('<div class="video-wrapper svelte-gkj9ee" data-video-node="" role="button" tabindex="0"><!></div>');function nhe(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=me(void 0),o=me(!1),a=me(void 0),l=oe(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src?.startsWith("placeholder-")||e.node.attrs.src?.startsWith("blob:")||!e.node.attrs.src),c=oe(()=>e.node.attrs.id||(typeof e.getPos=="function"?(e.getPos()??"unknown").toString():"unknown"));function u(){K(o,!0)}function d(){E(l)||console.error("Failed to load video:",e.node.attrs.src)}function f(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}function h(x){if(E(l)||f()||x.target===E(s))return;x.stopPropagation(),x.preventDefault(),cp(e.getPos);const I=af(x);Za.set(I),Kg(us,E(c),I,e.node.attrs.src||"",E(s))}function p(x){if(E(l)||f())return;if(E(s)){const k=E(s).getBoundingClientRect(),T=x.clientY,P=k.bottom;if(T>P-48)return}if(x.button===2)return;x.stopPropagation(),x.preventDefault(),cp(e.getPos);const I=af(x);Za.set(I),Kg(us,E(c),I,e.node.attrs.src||"",E(s))}function m(x){if(x.key==="Enter"||x.key===" "){x.preventDefault(),cp(e.getPos);const I={x:0,y:0};Za.set(I),E(l)||Kg(us,E(c),I,e.node.attrs.src||"",E(s))}}let g=0,y={x:0,y:0};const b=200,S=10;function C(x){if(E(l)||x.touches.length!==1)return;g=Date.now();const I=x.touches[0];y={x:I.clientX,y:I.clientY}}function _(x){if(E(l)||f())return;if(Date.now()-g<b&&x.changedTouches.length===1){const T=x.changedTouches[0],P={x:T.clientX,y:T.clientY};if(Math.sqrt(Math.pow(P.x-y.x,2)+Math.pow(P.y-y.y,2))<S){if(E(s)){const F=E(s).getBoundingClientRect(),B=T.clientY,N=F.bottom;if(B>N-48)return}x.stopPropagation(),x.preventDefault(),cp(e.getPos);const D={x:T.clientX,y:T.clientY};Za.set(D),Kg(us,E(c),D,e.node.attrs.src||"")}}}bs(()=>(E(s)&&(E(s).addEventListener("touchstart",C,{passive:!1}),E(s).addEventListener("touchend",_,{passive:!1})),()=>{E(s)&&(E(s).removeEventListener("touchstart",C),E(s).removeEventListener("touchend",_))})),P6(t,{children:(x,I)=>{var k=the();k.__click=h,k.__keydown=m;var T=ie(k);{var P=D=>{{let F=oe(()=>n()("videoNode.uploading"));Nc(D,{get text(){return E(F)},showLoader:!0})}},O=D=>{var F=ehe();F.muted=!0;let B;F.__click=p,F.__touchstart=C,F.__touchend=_;var N=we(ie(F));gr(F,M=>K(s,M),()=>E(s)),Ke(M=>{wn(F,"src",e.node.attrs.src),B=ao(F,1,"editor-video svelte-gkj9ee",null,B,{loaded:E(o)}),wn(F,"data-node-id",E(c)),Re(N,` ${M??""}`)},[()=>n()("videoNode.not_supported")]),eo("loadeddata",F,u),eo("error",F,d),Y(D,F)};Ve(T,D=>{E(l)?D(P):D(O,!1)})}gr(k,D=>K(a,D),()=>E(a)),Y(x,k)},$$slots:{default:!0}}),kt(),i()}Mi(["click","keydown","touchstart","touchend"]);const rhe=Ri.create({name:"video",group:"block",draggable:!1,addAttributes(){return{src:{default:null},isPlaceholder:{default:!1}}},parseHTML(){return[{tag:"video[src]"}]},renderHTML({HTMLAttributes:t}){return["video",Yn(t,{controls:!0})]},addNodeView(){return A6(nhe)}});function ihe(t){const e=[];return t.content.forEach(n=>{if(n.type.name==="paragraph"){let r="";n.content.forEach(i=>{i.isText&&(r+=i.text||"")}),e.push(r)}else if(n.type.name==="image"||n.type.name==="video"){const r=n.attrs?.src;r&&e.push(r)}else n.isTextblock&&e.push(n.textContent)}),e}const she=Tn.create({name:"clipboardExtension",addProseMirrorPlugins(){return[new cn({key:new En("clipboardExtension"),props:{handlePaste(t,e,n){const{state:r,dispatch:i}=t,{clipboardData:s}=e;if(!s||s.files&&s.files.length>0)return!1;const a=s.getData("text/plain");if(!a)return!1;const l=s.types.includes("text/html");let c=!1;if(l){const g=s.getData("text/html");if(g.includes("<strong>")||g.includes("<b>")||g.includes("<em>")||g.includes("<i>")||g.includes("<a ")||g.includes("<a>"))return!1;c=g.includes('data-block="true"')&&g.includes("data-editor=")}const{lines:u}=Xfe(a,{collapseEmptyLines:c,maxConsecutiveEmptyLines:1});if(u.length===0)return!1;const d=u.join(`
`),f=r.schema.text(d),h=De.from(f),p=new rt(h,0,0),m=r.tr.replaceSelection(p).setMeta("paste",!0).setMeta("uiEvent","paste").setMeta("addToHistory",!0);return i(m),!0},clipboardTextSerializer(t){const e=ihe(t);return Qfe(e)}}})]}});var Hy=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...r}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,r,n]},ohe=/^\s*>\s$/,ahe=Ri.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return Hy("blockquote",{...Yn(this.options.HTMLAttributes,t),children:Hy("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=">",r=[];return t.content.forEach(i=>{const a=e.renderChildren([i]).split(`
`).map(l=>l.trim()===""?n:`${n} ${l}`);r.push(a.join(`
`))}),r.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[th({find:ohe,type:this.type})]}}),lhe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,che=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,uhe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,dhe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,fhe=wd.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return Hy("strong",{...Yn(this.options.HTMLAttributes,t),children:Hy("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[eh({find:lhe,type:this.type}),eh({find:uhe,type:this.type})]},addPasteRules(){return[dd({find:che,type:this.type}),dd({find:dhe,type:this.type})]}}),hhe=/(^|[^`])`([^`]+)`(?!`)$/,phe=/(^|[^`])`([^`]+)`(?!`)/g,mhe=wd.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[eh({find:hhe,type:this.type})]},addPasteRules(){return[dd({find:phe,type:this.type})]}}),h2=4,ghe=/^```([a-z]+)?[\s\n]$/,yhe=/^~~~([a-z]+)?[\s\n]$/,bhe=Ri.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:h2,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const s=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Yn(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let r="";const i=((n=t.attrs)==null?void 0:n.language)||"";return t.content?r=[`\`\`\`${i}`,e.renderChildren(t.content),"```"].join(`
`):r=`\`\`\`${i}

\`\`\``,r},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:h2,{state:r}=t,{selection:i}=r,{$from:s,empty:o}=i;if(s.parent.type!==this.type)return!1;const a=" ".repeat(n);return o?t.commands.insertContent(a):t.commands.command(({tr:l})=>{const{from:c,to:u}=i,h=r.doc.textBetween(c,u,`
`,`
`).split(`
`).map(p=>a+p).join(`
`);return l.replaceWith(c,u,r.schema.text(h)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:h2,{state:r}=t,{selection:i}=r,{$from:s,empty:o}=i;return s.parent.type!==this.type?!1:o?t.commands.command(({tr:a})=>{var l;const{pos:c}=s,u=s.start(),d=s.end(),h=r.doc.textBetween(u,d,`
`,`
`).split(`
`);let p=0,m=0;const g=c-u;for(let x=0;x<h.length;x+=1){if(m+h[x].length>=g){p=x;break}m+=h[x].length+1}const b=((l=h[p].match(/^ */))==null?void 0:l[0])||"",S=Math.min(b.length,n);if(S===0)return!0;let C=u;for(let x=0;x<p;x+=1)C+=h[x].length+1;return a.delete(C,C+S),c-C<=S&&a.setSelection(At.create(a.doc,C)),!0}):t.commands.command(({tr:a})=>{const{from:l,to:c}=i,f=r.doc.textBetween(l,c,`
`,`
`).split(`
`).map(h=>{var p;const m=((p=h.match(/^ */))==null?void 0:p[0])||"",g=Math.min(m.length,n);return h.slice(g)}).join(`
`);return a.replaceWith(l,c,r.schema.text(f)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!s||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(Bt.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[TS({find:ghe,type:this.type,getAttributes:t=>({language:t[1]})}),TS({find:yhe,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new cn({key:new En("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=i?.mode;if(!n||!s)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:s},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(At.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),whe=Ri.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),vhe=Ri.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Yn(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:s}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=s||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(f=>a.includes(f.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),xhe=Ri.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Yn(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const r=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,i="#".repeat(r);return t.content?`${i} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>TS({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),She=Ri.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Yn(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!Vde(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:r}=n,i=t();return l6(n)?i.insertContentAt(r.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({state:s,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(At.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(dt.create(o.doc,l.pos)):o.setSelection(At.create(o.doc,l.pos));else{const u=s.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,d=u?.create();d&&(o.insert(c,d),o.setSelection(At.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[T6({find:/^(?:---|â-|___\s|\*\*\*\s)$/,type:this.type})]}}),khe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,Ehe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,The=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Che=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,_he=wd.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Yn(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[eh({find:khe,type:this.type}),eh({find:The,type:this.type})]},addPasteRules(){return[dd({find:Ehe,type:this.type}),dd({find:Che,type:this.type})]}});const Ahe="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mÃ¶gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Phe="ÎµÎ»1Ï2Ð±Ð³1ÐµÐ»3Ð´ÐµÑÐ¸4ÐµÑ2ÐºÐ°ÑÐ¾Ð»Ð¸Ðº6Ð¾Ð¼3Ð¼ÐºÐ´2Ð¾Ð½1ÑÐºÐ²Ð°6Ð¾Ð½Ð»Ð°Ð¹Ð½5ÑÐ³3ÑÑÑ2Ñ2ÑÐ°Ð¹Ñ3ÑÐ±3ÑÐºÑ3ÒÐ°Ð·3Õ°Õ¡Õµ3××©×¨××5×§××3Ø§Ø¨ÙØ¸Ø¨Ù5Ø±Ø§ÙÙÙ5ÙØ§Ø±Ø¯Ù4Ø¨Ø­Ø±ÙÙ5Ø¬Ø²Ø§Ø¦Ø±5Ø³Ø¹ÙØ¯ÙØ©6Ø¹ÙÙØ§Ù5ÙØºØ±Ø¨5ÙØ§Ø±Ø§Øª5ÛØ±Ø§Ù5Ø¨Ø§Ø±Øª2Ø²Ø§Ø±4ÙØªÙ3Ú¾Ø§Ø±Øª5ØªÙÙØ³4Ø³ÙØ¯Ø§Ù3Ø±ÙØ©5Ø´Ø¨ÙØ©4Ø¹Ø±Ø§Ù2Ø¨2ÙØ§Ù4ÙÙØ³Ø·ÙÙ6ÙØ·Ø±3ÙØ§Ø«ÙÙÙÙ6ÙÙ3ÙØµØ±2ÙÙØ³ÙØ§5ÙØ±ÙØªØ§ÙÙØ§7ÙØ¹4ÙÙØ±Ø§Ù5Ù¾Ø§Ú©Ø³ØªØ§Ù7ÚØ§Ø±Øª4à¤à¥à¤®3à¤¨à¥à¤3à¤­à¤¾à¤°à¤¤0à¤®à¥3à¥à¤¤5à¤¸à¤à¤à¤ à¤¨5à¦¬à¦¾à¦à¦²à¦¾5à¦­à¦¾à¦°à¦¤2à§°à¦¤4à¨­à¨¾à¨°à¨¤4àª­àª¾àª°àª¤4à¬­à¬¾à¬°à¬¤4à®à®¨à¯à®¤à®¿à®¯à®¾6à®²à®à¯à®à¯6à®à®¿à®à¯à®à®ªà¯à®ªà¯à®°à¯11à°­à°¾à°°à°¤à±5à²­à²¾à²°à²¤4à´­à´¾à´°à´¤à´5à¶½à¶à¶à·4à¸à¸­à¸¡3à¹à¸à¸¢3àº¥àº²àº§3áá2ã¿ããª3ã¢ãã¾ã³4ã¯ã©ã¦ã4ã°ã¼ã°ã«4ã³ã 2ã¹ãã¢3ã»ã¼ã«3ãã¡ãã·ã§ã³6ãã¤ã³ã4ä¸ç2ä¸­ä¿¡1å½1å1æç½3äºé©¬é3ä¼ä¸2ä½å±±2ä¿¡æ¯2å¥åº·2å«å¦2å¬å¸1ç2å°æ¹¾1ç£2åå1åº1æ 2åé0å¤§éåº5å¨çº¿2å¤§æ¿2å¤©ä¸»æ3å¨±ä¹2å®¶é»2å¹¿ä¸2å¾®å2æå2æç±ä½ 3ææº2æè2æ¿å¡1åº2æ°å å¡2é»2æ¶å°2æ¸ç±2æºæ2æ·¡é©¬é¡3æ¸¸æ2æ¾³é2ç¹ç2ç§»å¨2ç»ç»æºæ4ç½å1åº1ç«1ç»2èé2è°·æ­2è´­ç©2éè²©2éå¢2é»è¨çç§4é£å©æµ¦3é£å2é¤å2é¦æ ¼éæ3æ¸¯2ë·ë·1ì»´2ì¼ì±2íêµ­2",IS="numeric",OS="ascii",MS="alpha",Lp="asciinumeric",hp="alphanumeric",NS="domain",z6="emoji",Ihe="scheme",Ohe="slashscheme",p2="whitespace";function Mhe(t,e){return t in e||(e[t]=[]),e[t]}function Nu(t,e,n){e[IS]&&(e[Lp]=!0,e[hp]=!0),e[OS]&&(e[Lp]=!0,e[MS]=!0),e[Lp]&&(e[hp]=!0),e[MS]&&(e[hp]=!0),e[hp]&&(e[NS]=!0),e[z6]&&(e[NS]=!0);for(const r in e){const i=Mhe(r,n);i.indexOf(t)<0&&i.push(t)}}function Nhe(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Vi(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Vi.groups={};Vi.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const i=e.jr[r][0],s=e.jr[r][1];if(s&&i.test(t))return s}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let i=0;i<t.length;i++)this.tt(t[i],e,n,r)},tr(t,e,n,r){r=r||Vi.groups;let i;return e&&e.j?i=e:(i=new Vi(e),n&&r&&Nu(e,n,r)),this.jr.push([t,i]),i},ts(t,e,n,r){let i=this;const s=t.length;if(!s)return i;for(let o=0;o<s-1;o++)i=i.tt(t[o]);return i.tt(t[s-1],e,n,r)},tt(t,e,n,r){r=r||Vi.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const s=e;let o,a=i.go(t);if(a?(o=new Vi,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Vi,s){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(Nhe(o.t,r),n);Nu(s,l,r)}else n&&Nu(s,n,r);o.t=s}return i.j[t]=o,o}};const Lt=(t,e,n,r,i)=>t.ta(e,n,r,i),Kn=(t,e,n,r,i)=>t.tr(e,n,r,i),tO=(t,e,n,r,i)=>t.ts(e,n,r,i),We=(t,e,n,r,i)=>t.tt(e,n,r,i),Ta="WORD",RS="UWORD",U6="ASCIINUMERICAL",H6="ALPHANUMERICAL",gm="LOCALHOST",DS="TLD",LS="UTLD",v0="SCHEME",Zd="SLASH_SCHEME",tC="NUM",BS="WS",nC="NL",Bp="OPENBRACE",Fp="CLOSEBRACE",Vy="OPENBRACKET",Wy="CLOSEBRACKET",jy="OPENPAREN",qy="CLOSEPAREN",Ky="OPENANGLEBRACKET",Gy="CLOSEANGLEBRACKET",Zy="FULLWIDTHLEFTPAREN",Xy="FULLWIDTHRIGHTPAREN",Qy="LEFTCORNERBRACKET",Yy="RIGHTCORNERBRACKET",Jy="LEFTWHITECORNERBRACKET",eb="RIGHTWHITECORNERBRACKET",tb="FULLWIDTHLESSTHAN",nb="FULLWIDTHGREATERTHAN",rb="AMPERSAND",ib="APOSTROPHE",sb="ASTERISK",ic="AT",ob="BACKSLASH",ab="BACKTICK",lb="CARET",dc="COLON",rC="COMMA",cb="DOLLAR",Po="DOT",ub="EQUALS",iC="EXCLAMATION",Es="HYPHEN",$p="PERCENT",db="PIPE",fb="PLUS",hb="POUND",zp="QUERY",sC="QUOTE",V6="FULLWIDTHMIDDLEDOT",oC="SEMI",Io="SLASH",Up="TILDE",pb="UNDERSCORE",W6="EMOJI",mb="SYM";var j6=Object.freeze({__proto__:null,ALPHANUMERICAL:H6,AMPERSAND:rb,APOSTROPHE:ib,ASCIINUMERICAL:U6,ASTERISK:sb,AT:ic,BACKSLASH:ob,BACKTICK:ab,CARET:lb,CLOSEANGLEBRACKET:Gy,CLOSEBRACE:Fp,CLOSEBRACKET:Wy,CLOSEPAREN:qy,COLON:dc,COMMA:rC,DOLLAR:cb,DOT:Po,EMOJI:W6,EQUALS:ub,EXCLAMATION:iC,FULLWIDTHGREATERTHAN:nb,FULLWIDTHLEFTPAREN:Zy,FULLWIDTHLESSTHAN:tb,FULLWIDTHMIDDLEDOT:V6,FULLWIDTHRIGHTPAREN:Xy,HYPHEN:Es,LEFTCORNERBRACKET:Qy,LEFTWHITECORNERBRACKET:Jy,LOCALHOST:gm,NL:nC,NUM:tC,OPENANGLEBRACKET:Ky,OPENBRACE:Bp,OPENBRACKET:Vy,OPENPAREN:jy,PERCENT:$p,PIPE:db,PLUS:fb,POUND:hb,QUERY:zp,QUOTE:sC,RIGHTCORNERBRACKET:Yy,RIGHTWHITECORNERBRACKET:eb,SCHEME:v0,SEMI:oC,SLASH:Io,SLASH_SCHEME:Zd,SYM:mb,TILDE:Up,TLD:DS,UNDERSCORE:pb,UTLD:LS,UWORD:RS,WORD:Ta,WS:BS});const Sa=/[a-z]/,Yh=new RegExp("\\p{L}","u"),m2=new RegExp("\\p{Emoji}","u"),ka=/\d/,g2=/\s/,nO="\r",y2=`
`,Rhe="ï¸",Dhe="â",b2="ï¿¼";let Gg=null,Zg=null;function Lhe(t=[]){const e={};Vi.groups=e;const n=new Vi;Gg==null&&(Gg=rO(Ahe)),Zg==null&&(Zg=rO(Phe)),We(n,"'",ib),We(n,"{",Bp),We(n,"}",Fp),We(n,"[",Vy),We(n,"]",Wy),We(n,"(",jy),We(n,")",qy),We(n,"<",Ky),We(n,">",Gy),We(n,"ï¼",Zy),We(n,"ï¼",Xy),We(n,"ã",Qy),We(n,"ã",Yy),We(n,"ã",Jy),We(n,"ã",eb),We(n,"ï¼",tb),We(n,"ï¼",nb),We(n,"&",rb),We(n,"*",sb),We(n,"@",ic),We(n,"`",ab),We(n,"^",lb),We(n,":",dc),We(n,",",rC),We(n,"$",cb),We(n,".",Po),We(n,"=",ub),We(n,"!",iC),We(n,"-",Es),We(n,"%",$p),We(n,"|",db),We(n,"+",fb),We(n,"#",hb),We(n,"?",zp),We(n,'"',sC),We(n,"/",Io),We(n,";",oC),We(n,"~",Up),We(n,"_",pb),We(n,"\\",ob),We(n,"ã»",V6);const r=Kn(n,ka,tC,{[IS]:!0});Kn(r,ka,r);const i=Kn(r,Sa,U6,{[Lp]:!0}),s=Kn(r,Yh,H6,{[hp]:!0}),o=Kn(n,Sa,Ta,{[OS]:!0});Kn(o,ka,i),Kn(o,Sa,o),Kn(i,ka,i),Kn(i,Sa,i);const a=Kn(n,Yh,RS,{[MS]:!0});Kn(a,Sa),Kn(a,ka,s),Kn(a,Yh,a),Kn(s,ka,s),Kn(s,Sa),Kn(s,Yh,s);const l=We(n,y2,nC,{[p2]:!0}),c=We(n,nO,BS,{[p2]:!0}),u=Kn(n,g2,BS,{[p2]:!0});We(n,b2,u),We(c,y2,l),We(c,b2,u),Kn(c,g2,u),We(u,nO),We(u,y2),Kn(u,g2,u),We(u,b2,u);const d=Kn(n,m2,W6,{[z6]:!0});We(d,"#"),Kn(d,m2,d),We(d,Rhe,d);const f=We(d,Dhe);We(f,"#"),Kn(f,m2,d);const h=[[Sa,o],[ka,i]],p=[[Sa,null],[Yh,a],[ka,s]];for(let m=0;m<Gg.length;m++)Kl(n,Gg[m],DS,Ta,h);for(let m=0;m<Zg.length;m++)Kl(n,Zg[m],LS,RS,p);Nu(DS,{tld:!0,ascii:!0},e),Nu(LS,{utld:!0,alpha:!0},e),Kl(n,"file",v0,Ta,h),Kl(n,"mailto",v0,Ta,h),Kl(n,"http",Zd,Ta,h),Kl(n,"https",Zd,Ta,h),Kl(n,"ftp",Zd,Ta,h),Kl(n,"ftps",Zd,Ta,h),Nu(v0,{scheme:!0,ascii:!0},e),Nu(Zd,{slashscheme:!0,ascii:!0},e),t=t.sort((m,g)=>m[0]>g[0]?1:-1);for(let m=0;m<t.length;m++){const g=t[m][0],b=t[m][1]?{[Ihe]:!0}:{[Ohe]:!0};g.indexOf("-")>=0?b[NS]=!0:Sa.test(g)?ka.test(g)?b[Lp]=!0:b[OS]=!0:b[IS]=!0,tO(n,g,g,b)}return tO(n,"localhost",gm,{ascii:!0}),n.jd=new Vi(mb),{start:n,tokens:Object.assign({groups:e},j6)}}function q6(t,e){const n=Bhe(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,i=[];let s=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,d=-1,f=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(d=0,f=0,u=a):d>=0&&(d+=n[o].length,f++),c+=n[o].length,s+=n[o].length,o++;s-=d,o-=f,c-=d,i.push({t:u.t,v:e.slice(s-c,s),s:s-c,e:s})}return i}function Bhe(t){const e=[],n=t.length;let r=0;for(;r<n;){let i=t.charCodeAt(r),s,o=i<55296||i>56319||r+1===n||(s=t.charCodeAt(r+1))<56320||s>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function Kl(t,e,n,r,i){let s;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?s=t.j[l]:(s=new Vi(r),s.jr=i.slice(),t.j[l]=s),t=s}return s=new Vi(n),s.jr=i.slice(),t.j[e[o-1]]=s,s}function rO(t){const e=[],n=[];let r=0,i="0123456789";for(;r<t.length;){let s=0;for(;i.indexOf(t[r+s])>=0;)s++;if(s>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+s),10);o>0;o--)n.pop();r+=s}else n.push(t[r]),r++}return e}const ym={defaultProtocol:"http",events:null,format:iO,formatHref:iO,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function aC(t,e=null){let n=Object.assign({},ym);t&&(n=Object.assign(n,t instanceof aC?t.o:t));const r=n.ignoreTags,i=[];for(let s=0;s<r.length;s++)i.push(r[s].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=i}aC.prototype={o:ym,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:ym[t],typeof i=="function"&&r&&(i=i(e,n))):typeof i=="function"&&r&&(i=i(e,n.t,n)),i)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function iO(t){return t}function K6(t,e){this.t="token",this.v=t,this.tk=e}K6.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"â¦":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=ym.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),i=t.get("tagName",n,e),s=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),d=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:i,attributes:o,content:s,eventListeners:d}}};function Mw(t,e){class n extends K6{constructor(i,s){super(i,s),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const sO=Mw("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),oO=Mw("text"),Fhe=Mw("nl"),Xg=Mw("url",{isLink:!0,toHref(t=ym.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==gm&&t[1].t===dc}}),Ss=t=>new Vi(t);function $he({groups:t}){const e=t.domain.concat([rb,sb,ic,ob,ab,lb,cb,ub,Es,tC,$p,db,fb,hb,Io,mb,Up,pb]),n=[ib,dc,rC,Po,iC,$p,zp,sC,oC,Ky,Gy,Bp,Fp,Wy,Vy,jy,qy,Zy,Xy,Qy,Yy,Jy,eb,tb,nb],r=[rb,ib,sb,ob,ab,lb,cb,ub,Es,Bp,Fp,$p,db,fb,hb,zp,Io,mb,Up,pb],i=Ss(),s=We(i,Up);Lt(s,r,s),Lt(s,t.domain,s);const o=Ss(),a=Ss(),l=Ss();Lt(i,t.domain,o),Lt(i,t.scheme,a),Lt(i,t.slashscheme,l),Lt(o,r,s),Lt(o,t.domain,o);const c=We(o,ic);We(s,ic,c),We(a,ic,c),We(l,ic,c);const u=We(s,Po);Lt(u,r,s),Lt(u,t.domain,s);const d=Ss();Lt(c,t.domain,d),Lt(d,t.domain,d);const f=We(d,Po);Lt(f,t.domain,d);const h=Ss(sO);Lt(f,t.tld,h),Lt(f,t.utld,h),We(c,gm,h);const p=We(d,Es);We(p,Es,p),Lt(p,t.domain,d),Lt(h,t.domain,d),We(h,Po,f),We(h,Es,p);const m=We(h,dc);Lt(m,t.numeric,sO);const g=We(o,Es),y=We(o,Po);We(g,Es,g),Lt(g,t.domain,o),Lt(y,r,s),Lt(y,t.domain,o);const b=Ss(Xg);Lt(y,t.tld,b),Lt(y,t.utld,b),Lt(b,t.domain,o),Lt(b,r,s),We(b,Po,y),We(b,Es,g),We(b,ic,c);const S=We(b,dc),C=Ss(Xg);Lt(S,t.numeric,C);const _=Ss(Xg),x=Ss();Lt(_,e,_),Lt(_,n,x),Lt(x,e,_),Lt(x,n,x),We(b,Io,_),We(C,Io,_);const I=We(a,dc),k=We(l,dc),T=We(k,Io),P=We(T,Io);Lt(a,t.domain,o),We(a,Po,y),We(a,Es,g),Lt(l,t.domain,o),We(l,Po,y),We(l,Es,g),Lt(I,t.domain,_),We(I,Io,_),We(I,zp,_),Lt(P,t.domain,_),Lt(P,e,_),We(P,Io,_);const O=[[Bp,Fp],[Vy,Wy],[jy,qy],[Ky,Gy],[Zy,Xy],[Qy,Yy],[Jy,eb],[tb,nb]];for(let D=0;D<O.length;D++){const[F,B]=O[D],N=We(_,F);We(x,F,N),We(N,B,_);const M=Ss(Xg);Lt(N,e,M);const R=Ss();Lt(N,n),Lt(M,e,M),Lt(M,n,R),Lt(R,e,M),Lt(R,n,R),We(M,B,_),We(R,B,_)}return We(i,gm,b),We(i,nC,Fhe),{start:i,tokens:j6}}function zhe(t,e,n){let r=n.length,i=0,s=[],o=[];for(;i<r;){let a=t,l=null,c=null,u=0,d=null,f=-1;for(;i<r&&!(l=a.go(n[i].t));)o.push(n[i++]);for(;i<r&&(c=l||a.go(n[i].t));)l=null,a=c,a.accepts()?(f=0,d=a):f>=0&&f++,i++,u++;if(f<0)i-=u,i<r&&(o.push(n[i]),i++);else{o.length>0&&(s.push(w2(oO,e,o)),o=[]),i-=f,u-=f;const h=d.t,p=n.slice(i-u,i);s.push(w2(h,e,p))}}return o.length>0&&s.push(w2(oO,e,o)),s}function w2(t,e,n){const r=n[0].s,i=n[n.length-1].e,s=e.slice(r,i);return new t(s,n)}const Uhe=typeof console<"u"&&console&&console.warn||(()=>{}),Hhe="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Dn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Vhe(){return Vi.groups={},Dn.scanner=null,Dn.parser=null,Dn.tokenQueue=[],Dn.pluginQueue=[],Dn.customSchemes=[],Dn.initialized=!1,Dn}function aO(t,e=!1){if(Dn.initialized&&Uhe(`linkifyjs: already initialized - will not register custom scheme "${t}" ${Hhe}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Dn.customSchemes.push([t,e])}function Whe(){Dn.scanner=Lhe(Dn.customSchemes);for(let t=0;t<Dn.tokenQueue.length;t++)Dn.tokenQueue[t][1]({scanner:Dn.scanner});Dn.parser=$he(Dn.scanner.tokens);for(let t=0;t<Dn.pluginQueue.length;t++)Dn.pluginQueue[t][1]({scanner:Dn.scanner,parser:Dn.parser});return Dn.initialized=!0,Dn}function lC(t){return Dn.initialized||Whe(),zhe(Dn.parser.start,t,q6(Dn.scanner.start,t))}lC.scan=q6;function G6(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new aC(n),i=lC(t),s=[];for(let o=0;o<i.length;o++){const a=i[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&s.push(a.toFormattedObject(r))}return s}var cC="[\0- Â áá â-\u2029âã]",jhe=new RegExp(cC),qhe=new RegExp(`${cC}$`),Khe=new RegExp(cC,"g");function Ghe(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function Zhe(t){return new cn({key:new En("autolink"),appendTransaction:(e,n,r)=>{const i=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),s=e.some(c=>c.getMeta("preventAutolink"));if(!i||s)return;const{tr:o}=r,a=jT(n.doc,[...e]);if(GT(a).forEach(({newRange:c})=>{const u=t6(r.doc,c,h=>h.isTextblock);let d,f;if(u.length>1)d=u[0],f=r.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const h=r.doc.textBetween(c.from,c.to," "," ");if(!qhe.test(h))return;d=u[0],f=r.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&f){const h=f.split(jhe).filter(Boolean);if(h.length<=0)return!1;const p=h[h.length-1],m=d.pos+f.lastIndexOf(p);if(!p)return!1;const g=lC(p).map(y=>y.toObject(t.defaultProtocol));if(!Ghe(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:m+y.start+1,to:m+y.end+1})).filter(y=>r.schema.marks.code?!r.doc.rangeHasMark(y.from,y.to,r.schema.marks.code):!0).filter(y=>t.validate(y.value)).filter(y=>t.shouldAutoLink(y.value)).forEach(y=>{ZT(y.from,y.to,r.doc).some(b=>b.mark.type===t.type)||o.addMark(y.from,y.to,t.type.create({href:y.href}))})}}),!!o.steps.length)return o}})}function Xhe(t){return new cn({key:new En("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,s;if(r.button!==0||!e.editable)return!1;let o=null;if(r.target instanceof HTMLAnchorElement)o=r.target;else{const l=r.target;if(!l)return!1;const c=t.editor.view.dom;o=l.closest("a"),o&&!c.contains(o)&&(o=null)}if(!o)return!1;let a=!1;if(t.enableClickSelection&&(a=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){const l=a6(e.state,t.type.name),c=(i=o.href)!=null?i:l.href,u=(s=o.target)!=null?s:l.target;c&&(window.open(c,u),a=!0)}return a}}})}function Qhe(t){return new cn({key:new En("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{shouldAutoLink:i}=t,{state:s}=e,{selection:o}=s,{empty:a}=o;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=G6(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||i!==void 0&&!i(c.value)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function hu(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const i=typeof r=="string"?r:r.scheme;i&&n.push(i)}),!t||t.replace(Khe,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var Z6=wd.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){aO(t);return}aO(t.scheme,t.optionalSlashes)})},onDestroy(){Vhe()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!hu(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),n=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||n&&!t.includes("@"))return!0;const i=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(i)||!/\./.test(i))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!hu(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!hu(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Yn(this.options.HTMLAttributes,t),0]:["a",Yn(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n;const r=((n=t.attrs)==null?void 0:n.href)||"";return`[${e.renderChildren(t)}](${r})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!hu(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!hu(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[dd({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,i=G6(t).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:o=>!!hu(o,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(s=>{this.options.shouldAutoLink(s.value)&&e.push({text:s.value,data:{href:s.href},index:s.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(Zhe({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:i=>!!hu(i,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),t.push(Xhe({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(Qhe({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),Yhe=Z6,Jhe=Object.defineProperty,epe=(t,e)=>{for(var n in e)Jhe(t,n,{get:e[n],enumerable:!0})},tpe="listItem",lO="textStyle",cO=/^\s*([-+*])\s$/,X6=Ri.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(tpe,this.editor.getAttributes(lO)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=th({find:cO,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=th({find:cO,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(lO),editor:this.editor})),[t]}}),Q6=Ri.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(i=>i.type==="paragraph"))n=e.parseChildren(t.tokens);else{const i=t.tokens[0];if(i&&i.type==="text"&&i.tokens&&i.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(i.tokens)}],t.tokens.length>1){const o=t.tokens.slice(1),a=e.parseChildren(o);n.push(...a)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>JT(t,e,r=>r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${r.index+1}. `:"- ",n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),npe={};epe(npe,{findListItemPos:()=>eg,getNextListDepth:()=>uC,handleBackspace:()=>FS,handleDelete:()=>$S,hasListBefore:()=>Y6,hasListItemAfter:()=>rpe,hasListItemBefore:()=>J6,listItemHasSubList:()=>eB,nextListIsDeeper:()=>tB,nextListIsHigher:()=>nB});var eg=(t,e)=>{const{$from:n}=e.selection,r=hr(t,e.schema);let i=null,s=n.depth,o=n.pos,a=null;for(;s>0&&a===null;)i=n.node(s),i.type===r?a=s:(s-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},uC=(t,e)=>{const n=eg(t,e);if(!n)return!1;const[,r]=Yue(e,t,n.$pos.pos+4);return r},Y6=(t,e,n)=>{const{$anchor:r}=t.selection,i=Math.max(0,r.pos-2),s=t.doc.resolve(i).node();return!(!s||!n.includes(s.type.name))},J6=(t,e)=>{var n;const{$anchor:r}=e.selection,i=e.doc.resolve(r.pos-2);return!(i.index()===0||((n=i.nodeBefore)==null?void 0:n.type.name)!==t)},eB=(t,e,n)=>{if(!n)return!1;const r=hr(t,e.schema);let i=!1;return n.descendants(s=>{s.type===r&&(i=!0)}),i},FS=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!jc(t.state,e)&&Y6(t.state,e,n)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((f,h)=>{f.type.name===e&&c.push({node:f,pos:h})});const u=c.at(-1);if(!u)return!1;const d=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!jc(t.state,e)||!nde(t.state))return!1;const r=eg(e,t.state);if(!r)return!1;const s=t.state.doc.resolve(r.$pos.pos-2).node(r.depth),o=eB(e,t.state,s);return J6(e,t.state)&&!o?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},tB=(t,e)=>{const n=uC(t,e),r=eg(t,e);return!r||!n?!1:n>r.depth},nB=(t,e)=>{const n=uC(t,e),r=eg(t,e);return!r||!n?!1:n<r.depth},$S=(t,e)=>{if(!jc(t.state,e)||!tde(t.state,e))return!1;const{selection:n}=t.state,{$from:r,$to:i}=n;return!n.empty&&r.sameParent(i)?!1:tB(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():nB(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},rpe=(t,e)=>{var n;const{$anchor:r}=e.selection,i=e.doc.resolve(r.pos-r.parentOffset-2);return!(i.index()===i.parent.childCount-1||((n=i.nodeAfter)==null?void 0:n.type.name)!==t)},rB=Tn.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&$S(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&$S(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&FS(t,n,r)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&FS(t,n,r)&&(e=!0)}),e}}}}),uO=/^(\s*)(\d+)\.\s+(.*)$/,ipe=/^\s/;function spe(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n],s=i.match(uO);if(!s)break;const[,o,a,l]=s,c=o.length;let u=l,d=n+1;const f=[i];for(;d<t.length;){const h=t[d];if(h.match(uO))break;if(h.trim()==="")f.push(h),u+=`
`,d+=1;else if(h.match(ipe))f.push(h),u+=`
${h.slice(c+2)}`,d+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:f.join(`
`)}),r=d,n=d}return[e,r]}function iB(t,e,n){var r;const i=[];let s=0;for(;s<t.length;){const o=t[s];if(o.indent===e){const a=o.content.split(`
`),l=((r=a[0])==null?void 0:r.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const h=n.blockTokens(u);c.push(...h)}let d=s+1;const f=[];for(;d<t.length&&t[d].indent>e;)f.push(t[d]),d+=1;if(f.length>0){const h=Math.min(...f.map(m=>m.indent)),p=iB(f,h,n);c.push({type:"list",ordered:!0,start:f[0].number,items:p,raw:f.map(m=>m.raw).join(`
`)})}i.push({type:"list_item",raw:o.raw,tokens:c}),s=d}else s+=1}return i}function ope(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const r=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(i=>{if(i.type==="paragraph"||i.type==="list"||i.type==="blockquote"||i.type==="code")r.push(...e.parseChildren([i]));else if(i.type==="text"&&i.tokens){const s=e.parseChildren([i]);r.push({type:"paragraph",content:s})}else{const s=e.parseChildren([i]);s.length>0&&r.push(...s)}}),{type:"listItem",content:r}})}var ape="listItem",dO="textStyle",fO=/^(\d+)\.\s$/,sB=Ri.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",Yn(this.options.HTMLAttributes,n),0]:["ol",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,r=t.items?ope(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e?.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var r;const i=t.split(`
`),[s,o]=spe(i);if(s.length===0)return;const a=iB(s,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((r=s[0])==null?void 0:r.number)||1,items:a,raw:i.slice(0,o).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ape,this.editor.getAttributes(dO)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=th({find:fO,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=th({find:fO,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(dO)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),lpe=/^\s*(\[([( |x])?\])\s$/,cpe=Ri.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Yn(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const r=e.parseChildren(t.nestedTokens);n.push(...r)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const i=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return JT(t,e,i)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const i=document.createElement("li"),s=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=d=>{var f,h;a.ariaLabel=((h=(f=this.options.a11y)==null?void 0:f.checkboxLabel)==null?void 0:h.call(f,d,a.checked))||`Task item checkbox for ${d.textContent||"empty task item"}`};c(t),s.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",d=>d.preventDefault()),a.addEventListener("change",d=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:f}=d.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:h})=>{const p=n();if(typeof p!="number")return!1;const m=h.doc.nodeAt(p);return h.setNodeMarkup(p,void 0,{...m?.attrs,checked:f}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,f)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([d,f])=>{i.setAttribute(d,f)}),i.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,s.append(a,o),i.append(s,l),Object.entries(e).forEach(([d,f])=>{i.setAttribute(d,f)});let u=new Set(Object.keys(e));return{dom:i,contentDOM:l,update:d=>{if(d.type!==this.type)return!1;i.dataset.checked=d.attrs.checked,a.checked=d.attrs.checked,c(d);const f=r.extensionManager.attributes,h=Jf(d,f),p=new Set(Object.keys(h)),m=this.options.HTMLAttributes;return u.forEach(g=>{p.has(g)||(g in m?i.setAttribute(g,m[g]):i.removeAttribute(g))}),Object.entries(h).forEach(([g,y])=>{y==null?g in m?i.setAttribute(g,m[g]):i.removeAttribute(g):i.setAttribute(g,y)}),u=p,!0}}}},addInputRules(){return[th({find:lpe,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),upe=Ri.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Yn(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const r=s=>{const o=CS(s,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:r},n);return o?[{type:"taskList",raw:o.raw,items:o.items}]:n.blockTokens(s)},i=CS(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:s=>({indentLevel:s[1].length,mainContent:s[4],checked:s[3].toLowerCase()==="x"}),createToken:(s,o)=>({type:"taskItem",raw:"",mainContent:s.mainContent,indentLevel:s.indentLevel,checked:s.checked,text:s.mainContent,tokens:n.inlineTokens(s.mainContent),nestedTokens:o}),customNestedParser:r},n);if(i)return{type:"taskList",raw:i.raw,items:i.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Tn.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(X6.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(Q6.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(rB.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(sB.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(cpe.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(upe.configure(this.options.taskList)),t}});var dpe=Ri.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Yn(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];return n.length===1&&n[0].type==="image"?e.parseChildren([n[0]]):e.createNode("paragraph",void 0,e.parseInline(n))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),fpe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,hpe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,ppe=wd.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Yn(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[eh({find:fpe,type:this.type})]},addPasteRules(){return[dd({find:hpe,type:this.type})]}}),mpe=Ri.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),gpe=wd.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Yn(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const i=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!i)return;const s=i[2].trim();return{type:"underline",raw:i[0],text:s,tokens:n.inlineTokens(s)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function ype(t={}){return new cn({view(e){return new bpe(e,t)}})}class bpe{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let s=o=>{this[i](o)};return e.dom.addEventListener(i,s),{name:i,handler:s}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,i=this.editorView.dom,s=i.getBoundingClientRect(),o=s.width/i.offsetWidth,a=s.height/i.offsetHeight;if(n){let d=e.nodeBefore,f=e.nodeAfter;if(d||f){let h=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(h){let p=h.getBoundingClientRect(),m=d?p.bottom:p.top;d&&f&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*a;r={left:p.left,right:p.right,top:m-g,bottom:m+g}}}}if(!r){let d=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;r={left:d.left-f,right:d.left+f,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),f=d.width/l.offsetWidth,h=d.height/l.offsetHeight;c=d.left-l.scrollLeft*f,u=d.top-l.scrollTop*h}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,s=typeof i=="function"?i(this.editorView,n,e):i;if(n&&!s){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=q5(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class Vn extends Bt{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Vn.valid(r)?new Vn(r):Bt.near(r)}content(){return rt.empty}eq(e){return e instanceof Vn&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Vn(e.resolve(n.pos))}getBookmark(){return new dC(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!wpe(e)||!vpe(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Vn.valid(e))return e;let i=e.pos,s=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){s=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;i+=n;let l=e.doc.resolve(i);if(Vn.valid(l))return l}for(;;){let o=n>0?s.firstChild:s.lastChild;if(!o){if(s.isAtom&&!s.isText&&!dt.isSelectable(s)){e=e.doc.resolve(i+s.nodeSize*n),r=!1;continue e}break}s=o,i+=n;let a=e.doc.resolve(i);if(Vn.valid(a))return a}return null}}}Vn.prototype.visible=!1;Vn.findFrom=Vn.findGapCursorFrom;Bt.jsonID("gapcursor",Vn);class dC{constructor(e){this.pos=e}map(e){return new dC(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Vn.valid(n)?new Vn(n):Bt.near(n)}}function oB(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function wpe(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||oB(i.type))return!0;if(i.inlineContent)return!1}}return!0}function vpe(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||oB(i.type))return!0;if(i.inlineContent)return!1}}return!0}function xpe(){return new cn({props:{decorations:Tpe,createSelectionBetween(t,e,n){return e.pos==n.pos&&Vn.valid(n)?new Vn(n):null},handleClick:kpe,handleKeyDown:Spe,handleDOMEvents:{beforeinput:Epe}}})}const Spe=KL({ArrowLeft:Qg("horiz",-1),ArrowRight:Qg("horiz",1),ArrowUp:Qg("vert",-1),ArrowDown:Qg("vert",1)});function Qg(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,s){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof At){if(!s.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=Vn.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new Vn(c))),!0):!1}}function kpe(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Vn.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&dt.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Vn(r))),!0)}function Epe(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Vn))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=De.empty;for(let o=r.length-1;o>=0;o--)i=De.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new rt(i,0,0));return s.setSelection(At.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function Tpe(t){if(!(t.selection instanceof Vn))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",kn.create(t.doc,[_r.widget(t.selection.head,e,{key:"gapcursor"})])}var gb=200,Ir=function(){};Ir.prototype.append=function(e){return e.length?(e=Ir.from(e),!this.length&&e||e.length<gb&&this.leafAppend(e)||this.length<gb&&e.leafPrepend(this)||this.appendInner(e)):this};Ir.prototype.prepend=function(e){return e.length?Ir.from(e).append(this):this};Ir.prototype.appendInner=function(e){return new Cpe(this,e)};Ir.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Ir.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Ir.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Ir.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Ir.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(s,o){return i.push(e(s,o))},n,r),i};Ir.from=function(e){return e instanceof Ir?e:e&&e.length?new aB(e):Ir.empty};var aB=(function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,s){return i==0&&s==this.length?this:new e(this.values.slice(i,s))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,s,o,a){for(var l=s;l<o;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,s,o,a){for(var l=s-1;l>=o;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=gb)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=gb)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(Ir);Ir.empty=new aB([]);var Cpe=(function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,s,o){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(s,a),o)===!1||s>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,s)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,s,o){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(s,a)-a,o+a)===!1||s<a&&this.left.forEachInvertedInner(r,Math.min(i,a),s,o)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var s=this.left.length;return i<=s?this.left.slice(r,i):r>=s?this.right.slice(r-s,i-s):this.left.slice(r,s).append(this.right.slice(0,i-s))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(Ir);const _pe=500;class no{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,s;n&&(i=this.remapping(r,this.items.length),s=i.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((d,f)=>{if(!d.step){i||(i=this.remapping(r,f+1),s=i.maps.length),s--,u.push(d);return}if(i){u.push(new Oo(d.map));let h=d.step.map(i.slice(s)),p;h&&o.maybeStep(h).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new Oo(p,void 0,void 0,c.length+u.length))),s--,p&&i.appendMap(p,s)}else o.maybeStep(d.step);if(d.selection)return a=i?d.selection.map(i.slice(s)):d.selection,l=new no(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,i){let s=[],o=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let d=e.steps[u].invert(e.docs[u]),f=new Oo(e.mapping.maps[u],d,n),h;(h=l&&l.merge(f))&&(f=h,u?s.pop():a=a.slice(0,a.length-1)),s.push(f),n&&(o++,n=void 0),i||(l=f)}let c=o-r.depth;return c>Ppe&&(a=Ape(a,c),o-=c),new no(a.append(s),o)}remapping(e,n){let r=new cm;return this.items.forEach((i,s)=>{let o=i.mirrorOffset!=null&&s-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new no(this.items.append(e.map(n=>new Oo(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),s=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(f=>{f.selection&&a--},i);let l=n;this.items.forEach(f=>{let h=s.getMirror(--l);if(h==null)return;o=Math.min(o,h);let p=s.maps[h];if(f.step){let m=e.steps[h].invert(e.docs[h]),g=f.selection&&f.selection.map(s.slice(l+1,h));g&&a++,r.push(new Oo(p,m,g))}else r.push(new Oo(p))},i);let c=[];for(let f=n;f<o;f++)c.push(new Oo(s.maps[f]));let u=this.items.slice(0,i).append(c).append(r),d=new no(u,a);return d.emptyItemCount()>_pe&&(d=d.compress(this.items.length-r.length)),d}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],s=0;return this.items.forEach((o,a)=>{if(a>=e)i.push(o),o.selection&&s++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&s++;let d=new Oo(c.invert(),l,u),f,h=i.length-1;(f=i.length&&i[h].merge(d))?i[h]=f:i.push(d)}}else o.map&&r--},this.items.length,0),new no(Ir.from(i.reverse()),s)}}no.empty=new no(Ir.empty,0);function Ape(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class Oo{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Oo(n.getMap().invert(),n,this.selection)}}}class sc{constructor(e,n,r,i,s){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=s}}const Ppe=20;function Ipe(t,e,n,r){let i=n.getMeta(Ku),s;if(i)return i.historyState;n.getMeta(Npe)&&(t=new sc(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Ku))return o.getMeta(Ku).redo?new sc(t.done.addTransform(n,void 0,r,x0(e)),t.undone,hO(n.mapping.maps),t.prevTime,t.prevComposition):new sc(t.done,t.undone.addTransform(n,void 0,r,x0(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!Ope(n,t.prevRanges)),c=o?v2(t.prevRanges,n.mapping):hO(n.mapping.maps);return new sc(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,x0(e)),no.empty,c,n.time,a??t.prevComposition)}else return(s=n.getMeta("rebased"))?new sc(t.done.rebased(n,s),t.undone.rebased(n,s),v2(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new sc(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),v2(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function Ope(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let s=0;s<e.length;s+=2)r<=e[s+1]&&i>=e[s]&&(n=!0)}),n}function hO(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,i,s,o)=>e.push(s,o));return e}function v2(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function Mpe(t,e,n){let r=x0(e),i=Ku.get(e).spec.config,s=(n?t.undone:t.done).popEvent(e,r);if(!s)return null;let o=s.selection.resolve(s.transform.doc),a=(n?t.done:t.undone).addTransform(s.transform,e.selection.getBookmark(),i,r),l=new sc(n?a:s.remaining,n?s.remaining:a,null,0,-1);return s.transform.setSelection(o).setMeta(Ku,{redo:n,historyState:l})}let x2=!1,pO=null;function x0(t){let e=t.plugins;if(pO!=e){x2=!1,pO=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){x2=!0;break}}return x2}const Ku=new En("history"),Npe=new En("closeHistory");function Rpe(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new cn({key:Ku,state:{init(){return new sc(no.empty,no.empty,null,0,-1)},apply(e,n,r){return Ipe(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?cB:r=="historyRedo"?uB:null;return!i||!e.editable?!1:(n.preventDefault(),i(e.state,e.dispatch))}}}})}function lB(t,e){return(n,r)=>{let i=Ku.getState(n);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(r){let s=Mpe(i,n,t);s&&r(e?s.scrollIntoView():s)}return!0}}const cB=lB(!1,!0),uB=lB(!0,!0);Tn.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new cn({key:new En("characterCount"),appendTransaction:(e,n,r)=>{if(t)return;const i=this.options.limit;if(i==null||i===0){t=!0;return}const s=this.storage.characters({node:r.doc});if(s>i){const o=s-i,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const i=this.storage.characters({node:n.doc}),s=this.storage.characters({node:e.doc});if(s<=r||i>r&&s>r&&s<=i)return!0;if(i>r&&s>r&&s>i||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=s-r,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>r)}})]}});var Dpe=Tn.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[ype(this.options)]}}),Lpe=Tn.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new cn({key:new En("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:i}=e,s=[];if(!n||!r)return kn.create(t,[]);let o=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(i>=c&&i<=c+l.nodeSize-1))return!1;o+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(i>=c&&i<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";s.push(_r.node(c,c+l.nodeSize,{class:this.options.className}))}),kn.create(t,s)}}})]}}),Bpe=Tn.create({name:"gapCursor",addProseMirrorPlugins(){return[xpe()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=bn(gt(t,"allowGapCursor",n)))!=null?e:null}}}),Fpe=Tn.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something â¦",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new cn({key:new En("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,i=[];if(!n)return null;const s=this.editor.isEmpty;return t.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&Aw(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];s&&u.push(this.options.emptyEditorClass);const d=_r.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});i.push(d)}return this.options.includeChildren}),kn.create(t,i)}}})]}});Tn.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new cn({key:new En("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||l6(n.selection)||t.view.dragging?null:kn.create(n.doc,[_r.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function mO({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var $pe=Tn.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new En(this.name),n=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,i])=>i).filter(i=>(this.options.notAfter||[]).concat(n).includes(i.name));return[new cn({key:e,appendTransaction:(i,s,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),d=a.content.size,f=c.nodes[n];if(u)return l.insert(d,f.create())},state:{init:(i,s)=>{const o=s.tr.doc.lastChild;return!mO({node:o,types:r})},apply:(i,s)=>{if(!i.docChanged||i.getMeta("__uniqueIDTransaction"))return s;const o=i.doc.lastChild;return!mO({node:o,types:r})}}})]}}),zpe=Tn.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>cB(t,e),redo:()=>({state:t,dispatch:e})=>uB(t,e)}},addProseMirrorPlugins(){return[Rpe(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-Ñ":()=>this.editor.commands.undo(),"Shift-Mod-Ñ":()=>this.editor.commands.redo()}}}),Upe=Tn.create({name:"starterKit",addExtensions(){var t,e,n,r;const i=[];return this.options.bold!==!1&&i.push(fhe.configure(this.options.bold)),this.options.blockquote!==!1&&i.push(ahe.configure(this.options.blockquote)),this.options.bulletList!==!1&&i.push(X6.configure(this.options.bulletList)),this.options.code!==!1&&i.push(mhe.configure(this.options.code)),this.options.codeBlock!==!1&&i.push(bhe.configure(this.options.codeBlock)),this.options.document!==!1&&i.push(whe.configure(this.options.document)),this.options.dropcursor!==!1&&i.push(Dpe.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&i.push(Bpe.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&i.push(vhe.configure(this.options.hardBreak)),this.options.heading!==!1&&i.push(xhe.configure(this.options.heading)),this.options.undoRedo!==!1&&i.push(zpe.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&i.push(She.configure(this.options.horizontalRule)),this.options.italic!==!1&&i.push(_he.configure(this.options.italic)),this.options.listItem!==!1&&i.push(Q6.configure(this.options.listItem)),this.options.listKeymap!==!1&&i.push(rB.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&i.push(Z6.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&i.push(sB.configure(this.options.orderedList)),this.options.paragraph!==!1&&i.push(dpe.configure(this.options.paragraph)),this.options.strike!==!1&&i.push(ppe.configure(this.options.strike)),this.options.text!==!1&&i.push(mpe.configure(this.options.text)),this.options.underline!==!1&&i.push(gpe.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&i.push($pe.configure((r=this.options)==null?void 0:r.trailingNode)),i}}),Hpe=Upe,Vpe=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Wpe=Ri.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",Yn(this.options.HTMLAttributes,t)]},parseMarkdown:(t,e)=>e.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var e,n,r,i,s,o;const a=(n=(e=t.attrs)==null?void 0:e.src)!=null?n:"",l=(i=(r=t.attrs)==null?void 0:r.alt)!=null?i:"",c=(o=(s=t.attrs)==null?void 0:s.title)!=null?o:"";return c?`![${l}](${a} "${c}")`:`![${l}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u")return null;const{directions:t,minWidth:e,minHeight:n,alwaysPreserveAspectRatio:r}=this.options.resize;return({node:i,getPos:s,HTMLAttributes:o,editor:a})=>{const l=document.createElement("img");Object.entries(o).forEach(([d,f])=>{if(f!=null)switch(d){case"width":case"height":break;default:l.setAttribute(d,f);break}}),l.src=o.src;const c=new Hde({element:l,editor:a,node:i,getPos:s,onResize:(d,f)=>{l.style.width=`${d}px`,l.style.height=`${f}px`},onCommit:(d,f)=>{const h=s();h!==void 0&&this.editor.chain().setNodeSelection(h).updateAttributes(this.name,{width:d,height:f}).run()},onUpdate:(d,f,h)=>d.type===i.type,options:{directions:t,min:{width:e,height:n},preserveAspectRatio:r===!0}}),u=c.dom;return u.style.visibility="hidden",u.style.pointerEvents="none",l.onload=()=>{u.style.visibility="",u.style.pointerEvents=""},c}},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[T6({find:Vpe,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),jpe=Wpe,Br=[];for(var S2=0;S2<256;++S2)Br.push((S2+256).toString(16).slice(1));function qpe(t,e=0){return(Br[t[e+0]]+Br[t[e+1]]+Br[t[e+2]]+Br[t[e+3]]+"-"+Br[t[e+4]]+Br[t[e+5]]+"-"+Br[t[e+6]]+Br[t[e+7]]+"-"+Br[t[e+8]]+Br[t[e+9]]+"-"+Br[t[e+10]]+Br[t[e+11]]+Br[t[e+12]]+Br[t[e+13]]+Br[t[e+14]]+Br[t[e+15]]).toLowerCase()}var Yg,Kpe=new Uint8Array(16);function Gpe(){if(!Yg&&(Yg=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Yg))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Yg(Kpe)}var Zpe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const gO={randomUUID:Zpe};function Xpe(t,e,n){if(gO.randomUUID&&!t)return gO.randomUUID();t=t||{};var r=t.random||(t.rng||Gpe)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,qpe(r)}function Qpe(t){const e=new Set,n=new Set;return t.forEach(r=>{e.has(r)?n.add(r):e.add(r)}),Array.from(n)}var Ype=Tn.create({name:"uniqueID",priority:1e4,addOptions(){return{attributeName:"id",types:[],generateID:()=>Xpe(),filterTransaction:null,updateDocument:!0}},addGlobalAttributes(){return[{types:this.options.types,attributes:{[this.options.attributeName]:{default:null,parseHTML:t=>t.getAttribute(`data-${this.options.attributeName}`),renderHTML:t=>t[this.options.attributeName]?{[`data-${this.options.attributeName}`]:t[this.options.attributeName]}:{}}}}]},onCreate(){var t;if(!this.options.updateDocument)return;const e=this.editor.extensionManager.extensions.find(a=>a.name==="collaboration"),n=this.editor.extensionManager.extensions.find(a=>a.name==="collaborationCaret"),i=[e,n].filter(Boolean).find(a=>{var l;return(l=a?.options)==null?void 0:l.provider}),s=(t=i?.options)==null?void 0:t.provider,o=()=>{const{view:a,state:l}=this.editor,{tr:c,doc:u}=l,{types:d,attributeName:f,generateID:h}=this.options;Hue(u,m=>d.includes(m.type.name)&&m.attrs[f]===null).forEach(({node:m,pos:g})=>{c.setNodeMarkup(g,void 0,{...m.attrs,[f]:h({node:m,pos:g})})}),c.setMeta("addToHistory",!1),a.dispatch(c),s&&s.off("synced",o)};if(i){if(!s)return o();s.on("synced",o)}else return o()},addProseMirrorPlugins(){if(!this.options.updateDocument)return[];let t=null,e=!1;return[new cn({key:new En("uniqueID"),appendTransaction:(n,r,i)=>{const s=n.some(m=>m.docChanged)&&!r.doc.eq(i.doc),o=this.options.filterTransaction&&n.some(m=>{var g,y;return!((y=(g=this.options).filterTransaction)!=null&&y.call(g,m))});if(n.find(m=>m.getMeta("y-sync$"))||!s||o)return;const{tr:l}=i,{types:c,attributeName:u,generateID:d}=this.options,f=jT(r.doc,n),{mapping:h}=f;if(GT(f).forEach(({newRange:m})=>{const g=t6(i.doc,m,b=>c.includes(b.type.name)),y=g.map(({node:b})=>b.attrs[u]).filter(b=>b!==null);g.forEach(({node:b,pos:S},C)=>{var _;const x=(_=l.doc.nodeAt(S))==null?void 0:_.attrs[u];if(x===null){l.setNodeMarkup(S,void 0,{...b.attrs,[u]:d({node:b,pos:S})});return}const I=g[C+1];if(I&&b.content.size===0){const O=l.doc.nodeAt(I.pos);if(O?.attrs[u]&&O.attrs[u]!==x)return;l.setNodeMarkup(I.pos,void 0,{...I.node.attrs,[u]:x}),y[C+1]=x;const D=d({node:b,pos:S});return l.setNodeMarkup(S,void 0,{...b.attrs,[u]:D}),y[C]=D,l}const k=Qpe(y),{deleted:T}=h.invert().mapResult(S);T&&k.includes(x)&&l.setNodeMarkup(S,void 0,{...b.attrs,[u]:d({node:b,pos:S})})})}),!!l.steps.length)return l.setStoredMarks(i.tr.storedMarks),l.setMeta("__uniqueIDTransaction",!0),l},view(n){const r=i=>{var s;t=(s=n.dom.parentElement)!=null&&s.contains(i.target)?n.dom.parentElement:null};return window.addEventListener("dragstart",r),{destroy(){window.removeEventListener("dragstart",r)}}},props:{handleDOMEvents:{drop:(n,r)=>{var i,s;return(t!==n.dom.parentElement||((i=r.dataTransfer)==null?void 0:i.effectAllowed)==="copyMove"||((s=r.dataTransfer)==null?void 0:s.effectAllowed)==="copy")&&(t=null,e=!0),!1},paste:()=>(e=!0,!1)},transformPasted:n=>{if(!e)return n;const{types:r,attributeName:i}=this.options,s=o=>{const a=[];return o.forEach(l=>{if(l.isText){a.push(l);return}if(!r.includes(l.type.name)){a.push(l.copy(s(l.content)));return}const c=l.type.create({...l.attrs,[i]:null},s(l.content),l.marks);a.push(c)}),De.from(a)};return e=!1,new rt(s(n.content),n.openStart,n.openEnd)}}})]}}),Jpe=Ype;function eme(t,e,n,r,i,s,o){const a=window,l=navigator,c=o?.editorObj??window.__currentEditor,u=or,d=typeof u=="function"?u:oo(u);return[{label:d("imageContextMenu.fullscreen"),action:()=>{let f=c?.view?.dom||document.querySelector(".editor-container")||a;typeof f.dispatchEvent!="function"&&(f=window),f.dispatchEvent(new CustomEvent("image-fullscreen-request",{detail:{src:t,alt:e},bubbles:!0,composed:!0}))},src:t,icon:"/icons/expand-solid-full.svg"},{label:d("imageContextMenu.copyUrl"),action:async()=>{Ow(t,"image URL",l,a)},src:t,icon:"/icons/copy-solid-full.svg"},{label:d("imageContextMenu.delete"),action:()=>{const f=c?.view;if(f?.state&&f?.dispatch){let h=!1;f.state.doc.descendants((p,m)=>{if(!h&&p.type.name==="image"&&p.attrs.id===s)return f.dispatch(f.state.tr.delete(m,m+p.nodeSize)),h=!0,!1})}},disabled:!1,src:t,icon:"/icons/trash-solid-full.svg"}]}function tme(t,e,n,r,i){const s=((l,c,...u)=>setTimeout(l,c,...u));let o=!1,a;if(t.update(l=>(o=l.open&&l.nodeId!==e,a=l.nodeId,l)),o&&a){t.set({open:!1,nodeId:void 0,src:void 0}),s(()=>{t.set({open:!0,nodeId:e,src:r})},0);return}t.set({open:!0,nodeId:e,src:r})}function nme(t,e,n,r){if(!t.open||!t.nodeId)return null;const i=t.nodeId,s=t.src||"",o="Image";let a=0,l=1;e?.state?.doc&&e.state.doc.descendants((f,h)=>{if(f.attrs.id===i)return a=h,l=f.nodeSize,!1});const u=eme(s,o,()=>a,l,!0,i,{editorObj:e});let d={x:0,y:0};return n&&(d=Tf(n.x,n.y)),{items:u,x:d.x,y:d.y}}var rme=Ce("<canvas></canvas>"),ime=Ce('<img draggable="false" style="z-index:2; position:relative;"/>'),sme=Ce('<button type="button" class="editor-image-button svelte-4wwag0" tabindex="0"><!> <!></button>');function ome(t,e){St(e,!0);let n=vO,r=xO,i=me(!1),s=me(!1),o=me(void 0),a=me(void 0);const l=Xa(),c=400;let u=oe(()=>e.node.attrs.isPlaceholder===!0||e.node.attrs.src&&e.node.attrs.src.startsWith("placeholder-")),d=oe(()=>!E(u)&&e.node.attrs.src&&!e.node.attrs.src.startsWith("placeholder-")),f=oe(()=>e.node.attrs.blurhash&&(E(u)||!E(i)||E(s))),h=me(null);const p=!1;Ge(()=>{const N=e.node.attrs.src;if(!N)return;const M=AS.value[N];if(M){K(h,M,!0);return}const R=Use(e.node.attrs.dim);if(R){const H=g5(R.width,R.height);K(h,H,!0),AS.update(z=>({...z,[N]:H}))}else E(u)&&K(h,j1(),!0)});let m=me(!1),g=oe(()=>Za.value);const y=oe(()=>e.node.attrs.id||`fallback-${typeof e.getPos=="function"?e.getPos():"unknown"}`);Ge(()=>{us.subscribe(N=>{(!N.open||N.nodeId!==E(y))&&K(m,!1)})});function b(){E(g)&&tme(us,E(y),E(g),e.node.attrs.src)}function S(N,M=!1){const R=af(N);Za.set(R),noe(N,M,n.isDragging,E(u),e.selected,r.justSelected,e.node.attrs.src,e.node.attrs.alt||"Image",e.getPos)&&!e.selected&&(r.justSelectedTimeout&&clearTimeout(r.justSelectedTimeout),r.justSelected=!0,r.justSelectedTimeout=setTimeout(()=>{r.justSelected=!1,r.justSelectedTimeout=null},c))}function C(){n.isDragging=!0,Gh("start",{},e.getPos),n.preview=Yse(n.startTarget,n.startPos.x,n.startPos.y,E(u))}function _(){n.longPressTimeout&&(clearTimeout(n.longPressTimeout),n.longPressTimeout=null),n.startTarget=null}function x(N,M,R){_(),n.startPos={x:M,y:R},n.startTarget=N,n.longPressTimeout=setTimeout(()=>{C()},Oie)}function I(){K(i,!0),K(s,!0),setTimeout(()=>{K(s,!1)},400)}function k(){K(i,!1)}function T(N){S(N,!1),b()}function P(N,M){if(N==="start"){const R=M;if(!R?.dataTransfer&&!l)return;if(l){M?.preventDefault();return}R?.dataTransfer&&(R.dataTransfer.setData("application/x-tiptap-node",JSON.stringify({type:"image",attrs:e.node.attrs,pos:e.getPos()})),R.dataTransfer.effectAllowed="move"),n.isDragging=!0,Gh("start")}else n.isDragging=!1,q1(n.preview),Gh("end")}function O(N){if(N.touches.length!==1)return;d5();const M=af(N);Za.set(M),x(N.currentTarget,M.x,M.y)}function D(N){if(N.touches.length!==1){_();return}const M=af(N);if(!n.isDragging&&n.longPressTimeout&&eoe(M.x,M.y,n.startPos.x,n.startPos.y,Mie)){_();return}n.isDragging&&(N.preventDefault(),Jse(n.preview,M.x,M.y),Kse(M.x,M.y),Gh("move",{touchX:M.x,touchY:M.y,nodePos:e.getPos()}))}function F(N){if(n.longPressTimeout&&(_(),!n.isDragging)){S(N,!0),b();return}if(!n.isDragging)return;N.preventDefault();const M=af(N),R=document.elementFromPoint(M.x,M.y);if(R){const z=R.closest(".drop-zone-indicator")?.getAttribute("data-drop-pos");Gh("end",{nodeData:{type:"image",attrs:e.node.attrs,pos:e.getPos()},dropX:M.x,dropY:M.y,target:R,dropPosition:z?parseInt(z,10):null})}n.isDragging=!1,q1(n.preview),n.preview=null}function B(N){N.preventDefault()}bs(()=>{e.node.attrs.blurhash&&E(o)&&BI(e.node.attrs.blurhash,E(o),E(h)||j1(),E(u),p),l&&E(a)&&(E(a).addEventListener("touchstart",O,{passive:!1}),E(a).addEventListener("touchmove",D,{passive:!1}),E(a).addEventListener("touchend",F,{passive:!1}))}),Ge(()=>{e.node.attrs.blurhash&&E(o)&&BI(e.node.attrs.blurhash,E(o),E(h)||j1(),E(u),p)}),Zu(()=>{_(),r.justSelectedTimeout&&clearTimeout(r.justSelectedTimeout),q1(n.preview),us.set({open:!1,nodeId:void 0}),l&&E(a)&&(E(a).removeEventListener("touchstart",O),E(a).removeEventListener("touchmove",D),E(a).removeEventListener("touchend",F)),Object.assign(vO,{isDragging:!1,longPressTimeout:null,startTarget:null,preview:null}),Object.assign(xO,{justSelected:!1,justSelectedTimeout:null}),K(o,void 0)}),P6(t,{children:(N,M)=>{var R=sme();R.__click=T;var H=ie(R);{var z=Z=>{var te=rme();let ne;gr(te,J=>K(o,J),()=>E(o)),Ke(()=>ne=ao(te,1,"blurhash-canvas svelte-4wwag0",null,ne,{"is-placeholder":E(u),"fade-out":E(i)&&E(s)&&E(d)})),Y(Z,te)};Ve(H,Z=>{E(f)&&Z(z)})}var V=we(H,2);{var X=Z=>{var te=ime();let ne;te.__contextmenu=B,Ke(()=>{wn(te,"src",e.node?.attrs?.src),wn(te,"alt",e.node?.attrs?.alt||""),ne=ao(te,1,"editor-image svelte-4wwag0",null,ne,{"image-loading":!E(i)})}),eo("load",te,I),eo("error",te,k),Y(Z,te)};Ve(V,Z=>{E(d)&&Z(X)})}gr(R,Z=>K(a,Z),()=>E(a)),Ke(()=>{wn(R,"data-dragging",n.isDragging),wn(R,"aria-label",e.node?.attrs?.alt||"Image"),wn(R,"draggable",!l)}),eo("dragstart",R,Z=>P("start",Z)),eo("dragend",R,()=>P("end")),eo("dragover",R,function(...Z){(l?te=>te.preventDefault():void 0)?.apply(this,Z)}),eo("drop",R,function(...Z){(l?te=>te.preventDefault():void 0)?.apply(this,Z)}),Y(N,R)},$$slots:{default:!0}}),kt()}Mi(["click","contextmenu"]);const yO=new Set(["image","video"]),bO=".node-image.is-node-focused, .node-video.is-node-focused",ame=Tn.create({name:"gapCursorFocusReset",onSelectionUpdate(){const{state:t,view:e}=this.editor,n=t.selection,r=i=>{e.dom.querySelectorAll(bO).forEach(s=>{i&&s===i||s.classList.remove("is-node-focused")})};if(n instanceof dt&&yO.has(n.node.type.name)){const i=e.nodeDOM(n.from),s=i?.matches(".node-image, .node-video")?i:i?.closest(".node-image, .node-video");if(s){r(s),s.classList.add("is-node-focused");return}}if(n instanceof Vn){r();return}r()},onCreate(){const t=e=>{const{view:n}=this.editor,r=e.target;if(n.dom.contains(r))return;n.dom.querySelectorAll(bO).forEach(o=>{o.classList.remove("is-node-focused")});const{state:i}=n,{selection:s}=i;if(s instanceof dt&&yO.has(s.node.type.name)){const o=i.doc.content.size,a=i.doc.resolve(o),l=i.tr.setSelection(At.near(a)).setMeta("addToHistory",!1);n.dispatch(l)}};document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),this.editor.__outsideClickHandler=t},onDestroy(){const t=this.editor.__outsideClickHandler;t&&(document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t),delete this.editor.__outsideClickHandler)}});function lme(t){const{placeholderText:e,onSubmitPost:n,onUpdate:r,onCreate:i,onDestroy:s}=t;return Jde({extensions:[Hpe.configure({paragraph:{HTMLAttributes:{class:"editor-paragraph"}},undoRedo:{depth:100,newGroupDelay:500},dropcursor:{color:"dodgerblue",width:5},link:!1}),Yhe.extend({renderHTML({mark:a,HTMLAttributes:l}){return["a",{...l,href:a.attrs.href},0]}}).configure({HTMLAttributes:{class:"preview-link",rel:null,target:"_blank"},autolink:!1,linkOnPaste:!1,defaultProtocol:"https",isAllowedUri:(a,l)=>{if(!l.defaultValidate(a)||a.startsWith("./")||a.startsWith("../"))return!1;try{const c=new URL(a,`${l.defaultProtocol}://`);return l.protocols.includes(c.protocol.replace(":",""))}catch{return!1}},shouldAutoLink:a=>{if(a.length<8)return!1;try{return new URL(a).hostname.length>0&&/^https?:\/\/[a-zA-Z0-9]/.test(a)}catch{return!1}},protocols:[{scheme:"http",optionalSlashes:!1},{scheme:"https",optionalSlashes:!1}]}),jpe.configure({HTMLAttributes:{class:"editor-image"},allowBase64:!1}).extend({addAttributes(){return{src:{default:null},blurhash:{default:null},isPlaceholder:{default:null},dim:{default:null},alt:{default:null}}},addNodeView(){return A6(ome)}}),Jpe.configure({types:["image","video"],attributeName:"id"}),Lpe.configure({className:"is-node-focused",mode:"all"}),ame,zfe,rhe,she,Vfe,Wfe,jfe,Fpe.configure({placeholder:e,emptyEditorClass:"is-editor-empty",showOnlyWhenEditable:!0,showOnlyCurrent:!1,includeChildren:!1})],enablePasteRules:["clipboardExtension"],content:{type:"doc",content:[{type:"paragraph"}]},editorProps:{attributes:{class:"tiptap-editor"},handleClickOn(a,l,c,u,d,f){let h=d.target;for(;h&&h!==a.dom;){if(h.tagName==="A"&&h.hasAttribute("href"))return d.ctrlKey||d.metaKey?!1:(d.preventDefault(),!0);h=h.parentElement}return!1},handleKeyDown:(a,l)=>(l.ctrlKey||l.metaKey)&&(l.key==="Enter"||l.key==="NumpadEnter")?(l.preventDefault(),n(),!0):!1},onCreate({editor:a}){window.__currentEditor=a,i?.(a)},onUpdate(){r?.()},onDestroy(){delete window.__currentEditor,s?.()}})}function cme(){return Date.now().toString(36)+Math.random().toString(36).substring(2,11)}function ume(t,e,n,r,i,s,o=!1){const a=[],l=new s,c=Date.now();if(!n)return a;const u=n.state,d=u.selection,f=d instanceof dt&&d.node?.type?.name==="image";o&&console.log("[dev] insertPlaceholdersIntoEditor:",{fileCount:t.length,isImageNodeSelected:f,selectionType:d.constructor.name,selectionFrom:d.from,selectionTo:d.to,docSize:u.doc.content.size});const h=u.doc.childCount===1&&u.doc.firstChild?.type.name==="paragraph"&&u.doc.firstChild.content.size===0;let p=u.tr,m=f?d.to:d.from;return t.forEach((g,y)=>{const b=g.type.startsWith("video/"),S=l.validateMediaFile(g);if(!S.isValid){r(S.errorMessage||"postComponent.upload_failed");return}const C=`placeholder-${c}-${y}-${cme()}`,_=e[y],x=_?.ox,I=_?.dimensions;try{let k;if(b){const T={src:C,isPlaceholder:!0};k=u.schema.nodes.video.create(T)}else{const T={src:C,isPlaceholder:!0};I&&(T.dim=`${I.width}x${I.height}`,i.update(P=>({...P,[C]:I}))),k=u.schema.nodes.image.create(T)}h&&y===0?(p=p.replaceWith(0,u.doc.content.size,k),m=k.nodeSize):(p=p.insert(m,k),m+=k.nodeSize),a.push({file:g,placeholderId:C,ox:x,dimensions:I})}catch(k){o&&console.error("[uploadHelper] failed to insert media node",{placeholderId:C,file:g.name,isVideo:b,error:k,insertPos:m,docSize:u.doc.content.size}),r(b?"åç»ã®æ¿å¥ã«å¤±æãã¾ãã":"ç»åã®æ¿å¥ã«å¤±æãã¾ãã")}}),a.length>0&&n.view.dispatch(p),a}async function dme(t,e,n,r=!1){if(ln.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted before blurhash generation");return}const i=new n,s=t.map(async o=>{if(ln.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted during blurhash generation");return}try{const a=await i.generateBlurhashForFile(o.file);if(ln.value){r&&console.log("[generateBlurhashesForPlaceholders] Aborted after blurhash generation");return}a&&(o.blurhash=a,e&&eC(e,(l,c)=>{const u=l.type?.name,d=o.file.type.startsWith("video/")&&u==="video",f=!o.file.type.startsWith("video/")&&u==="image";return(d||f)&&(l.attrs?.src===o.placeholderId||l.attrs?.id===o.placeholderId)},(l,c)=>{const u=e.state.tr.setNodeMarkup(c,void 0,{...l.attrs,blurhash:a});e.view.dispatch(u)}))}catch(a){r&&console.warn("[uploadHelper] blurhash generation failed",{file:o.file.name,error:a})}});await Promise.all(s)}async function fme(t,e,n,r,i,s,o,a,l,c,u=!1){const d=[],f={};let h="";const p=[...e];for(let m=0;m<t.length;m++){const g=t[m];if(u&&console.log("[uploadHelper] Processing result",m,":",{success:g.success,url:g.url,filename:g.filename,sizeInfo:g.sizeInfo,aborted:g.aborted}),g.aborted){const y=p.shift();if(y){const b=y.file.type.startsWith("video/");f2(y.placeholderId,b,n,s,u)}continue}if(g.success&&g.url){let y,b=-1;if(g.sizeInfo&&g.sizeInfo.originalFilename&&(b=p.findIndex(S=>S.file.name===g.sizeInfo.originalFilename),b!==-1&&(y=p[b])),!y&&p.length>0&&(y=p[0],b=0),y&&b!==-1&&n){p.splice(b,1);const S=y.file.type.startsWith("video/");if(u&&console.log("[uploadHelper] Replacing placeholder",{placeholderId:y.placeholderId,url:g.url,isVideo:S}),eC(n,(C,_)=>{const x=C.type?.name;return(S&&x==="video"||!S&&x==="image")&&C.attrs?.src===y.placeholderId},(C,_)=>{if(S){const x={...C.attrs,src:g.url,isPlaceholder:!1},I=n.state.tr.setNodeMarkup(_,void 0,x);n.view.dispatch(I)}else{const x={...C.attrs,src:g.url,isPlaceholder:!1,blurhash:y.blurhash??void 0};y.dimensions&&(x.dim=`${y.dimensions.width}x${y.dimensions.height}`);const I=n.state.tr.setNodeMarkup(_,void 0,x);n.view.dispatch(I),s.update(k=>{const T={...k};return delete T[y.placeholderId],y.dimensions&&(T[g.url]=y.dimensions),T})}}),!S){const C=g.nip94||{},_=C.blurhash??C.b??void 0;_&&g.url&&(f[g.url]=_);const x=C.ox??C.o??void 0,I=C.x??void 0;if(x&&g.url?r[g.url]=x:y.ox&&g.url&&(r[g.url]=y.ox),g.url)if(I)i[g.url]=I;else try{const k=await l(g.url);k&&(i[g.url]=k)}catch(k){u&&console.warn("[uploadHelper] failed to calculate x hash (fallback)",{url:g.url,error:k})}}}}else if(!g.success){d.push(g);const y=p.shift();if(y){const b=y.file.type.startsWith("video/");f2(y.placeholderId,b,n,s,u)}}}for(const m of p){const g=m.file.type.startsWith("video/");f2(m.placeholderId,g,n,s,u)}return d.length&&(h=d.length===1?d[0].error||"postComponent.upload_failed":`${d.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`),{failedResults:d,errorMessage:h,imageServerBlurhashMap:f}}let hme=Wt({value:""}),wO=me(null);const fC={get value(){return E(wO)},set:t=>{K(wO,t,!0)}};let Pn=Wt({content:"",canPost:!1,isUploading:!1,uploadErrorMessage:"",postStatus:{sending:!1,success:!1,error:!1,message:""},hasImage:!1});const vO=Wt({isDragging:!1,startPos:{x:0,y:0},longPressTimeout:null,startTarget:null,preview:null}),xO=Wt({justSelected:!1,justSelectedTimeout:null});function pme(t,e){return!!t.trim()||e}function mme(t,e=!1){Pn.content=t,Pn.hasImage=e,Pn.canPost=pme(t,e)}function Ca(t){Pn.postStatus=t}function gme(){Pn.content="",Pn.canPost=!1,Pn.uploadErrorMessage="",Pn.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1},Pn.hasImage=!1}function yme(){Pn.postStatus={sending:!1,success:!1,error:!1,message:"",completed:!1}}let zS;function bme(t){zS=t}async function wme(){zS&&await zS()}function vme(t){const{placeholderText:e,editorContainerEl:n,hasStoredKey:r,submitPost:i,uploadFiles:s,eventCallbacks:o}=t;hme.value=e;const a=lme({placeholderText:e,onSubmitPost:i,onCreate:d=>{fC.set(d)}});let l=null;const c=a.subscribe(d=>{l=d}),u=Nfe({currentEditor:l,editorContainerEl:n,callbacks:o});return bme(i),n&&Object.assign(n,{__uploadFiles:s,__currentEditor:()=>l,__hasStoredKey:()=>r,__postStatus:()=>Pn.postStatus,__submitPost:i}),{editor:a,unsubscribe:c,handlers:u}}function xme(t){const{unsubscribe:e,handlers:n,currentEditor:r,editorContainerEl:i}=t;Rfe(n,i),e(),r?.destroy?.(),i&&(delete i.__uploadFiles,delete i.__currentEditor,delete i.__hasStoredKey,delete i.__postStatus,delete i.__submitPost)}class Sme{allowedOrigins;console;windowObj;constructor(e={}){this.allowedOrigins=e.allowedOrigins||[],this.console=e.console||(typeof console<"u"?console:{log:()=>{},warn:()=>{},error:()=>{}}),this.windowObj=e.window||(typeof window<"u"?window:void 0)}isInIframe(){if(!this.windowObj)return!1;try{return this.windowObj.self!==this.windowObj.top}catch{return!0}}getParentOrigin(){if(!this.windowObj||!this.isInIframe())return null;try{return this.windowObj.parent.location.origin}catch{if(this.windowObj.document&&this.windowObj.document.referrer)try{return new URL(this.windowObj.document.referrer).origin}catch(n){return this.console.warn("è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ãåå¾ã§ãã¾ããã§ãã:",n),null}return null}}isOriginAllowed(e){return e?this.allowedOrigins.length===0?!0:this.allowedOrigins.includes(e):!1}sendMessageToParent(e){if(!this.windowObj||!this.isInIframe())return!1;const n=this.getParentOrigin();if(!n)return this.console.warn("è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ãç¹å®ã§ããªããããpostMessageãéä¿¡ã§ãã¾ãã"),!1;if(!this.isOriginAllowed(n))return this.console.warn(`è¦ªã¦ã£ã³ãã¦ã®ãªãªã¸ã³ ${n} ã¯è¨±å¯ããã¦ãã¾ãã`),!1;try{return this.windowObj.parent.postMessage(e,n),this.console.log(`è¦ªã¦ã£ã³ãã¦ (${n}) ã«ã¡ãã»ã¼ã¸ãéä¿¡ãã¾ãã:`,e),!0}catch(r){return this.console.error("postMessageã®éä¿¡ã«å¤±æãã¾ãã:",r),!1}}notifyPostSuccess(){return this.sendMessageToParent({type:"POST_SUCCESS",timestamp:Date.now()})}notifyPostError(e){return this.sendMessageToParent({type:"POST_ERROR",timestamp:Date.now(),error:e})}setAllowedOrigins(e){this.allowedOrigins=e}addAllowedOrigin(e){this.allowedOrigins.includes(e)||this.allowedOrigins.push(e)}}const kme=new Sme;class Eme{static validatePost(e,n,r){return e.trim()?r?n?{valid:!0}:{valid:!1,error:"login_required"}:{valid:!1,error:"nostr_not_ready"}:{valid:!1,error:"empty_content"}}}class SO{static async buildEvent(e,n,r,i,s,o,a,l,c){const u=Array.isArray(r)&&r.length?[...r]:Array.isArray(n)?n.map(h=>["t",h.toLowerCase()]):[],d=u.some(h=>h[0]==="t"&&h[1]==="nsfw");if((l||d)&&(c&&c.trim()?u.push(["content-warning",c.trim()]):u.push(["content-warning"]),l&&!d&&u.push(["t","nsfw"])),a){const h=a();h&&u.push(h)}if(s&&o){for(const[h,p]of Object.entries(s))if(h&&p&&p.m){const m=await o({url:h,...p});u.push(m)}}const f={kind:1,content:e,tags:u,created_at:Math.floor(Date.now()/1e3)};return i&&(f.pubkey=i),f}}class Tme{constructor(e,n){this.rxNostr=e,this.console=n}sendEvent(e,n){return new Promise(r=>{let i=!1,s=!1,o=null;const a=()=>{try{o?.unsubscribe()}catch{}},l={next:c=>{this.console.log(`ãªã¬ã¼ ${c.from} ã¸ã®éä¿¡çµæ:`,c.ok?"æå":"å¤±æ"),c.ok&&!i&&(s=!0,i=!0,a(),r({success:!0}))},error:c=>{this.console.error("éä¿¡ã¨ã©ã¼:",c),i||(i=!0,a(),r({success:!1,error:"post_error"}))},complete:()=>{!i&&!s&&(i=!0,a(),r({success:!1,error:"post_error"}))}};o=this.rxNostr.send(e,n?{signer:n}:void 0).subscribe(l),setTimeout(()=>{i||(i=!0,a(),r(s?{success:!0}:{success:!1,error:"post_error"}))},1e4)})}}class Cme{constructor(e,n={}){this.deps=n,e&&this.setRxNostr(e),this.deps.console=n.console||(typeof window<"u"?window.console:{}),this.deps.createImetaTagFn=n.createImetaTagFn||h5,this.deps.getClientTagFn=n.getClientTagFn||lfe,this.deps.seckeySignerFn=n.seckeySignerFn||ux,this.deps.extractContentWithImagesFn=n.extractContentWithImagesFn||L6,this.deps.extractImageBlurhashMapFn=n.extractImageBlurhashMapFn||p5,this.deps.resetEditorStateFn=n.resetEditorStateFn||gme,this.deps.resetPostStatusFn=n.resetPostStatusFn||yme,this.deps.iframeMessageService=n.iframeMessageService||kme}rxNostr=null;eventSender=null;setRxNostr(e){this.rxNostr=e,this.eventSender=new Tme(e,this.deps.console||console)}validatePost(e){const n=this.deps.authStateStore||{value:Wr.value};return Eme.validatePost(e,n.value.isAuthenticated,!!this.rxNostr)}async submitPost(e,n){const r=this.validatePost(e);if(!r.valid)return this.deps.iframeMessageService?.notifyPostError(r.error),{success:!1,error:r.error};if(!this.eventSender)return this.deps.iframeMessageService?.notifyPostError("nostr_not_ready"),{success:!1,error:"nostr_not_ready"};try{const i=this.deps.authStateStore||{value:Wr.value},s=this.deps.hashtagStore||uc,{hashtags:o,tags:a}=this.getHashtagArrays(s),l=this.deps.keyManager||_S,c=this.deps.window||(typeof window<"u"?window:void 0),u=qu.value,d=Af.value,f=i.value;if(f.type==="nostr-login"&&l.isWindowNostrAvailable()&&c?.nostr)try{const b=f.pubkey;if(!b)return this.deps.iframeMessageService?.notifyPostError("pubkey_not_found"),{success:!1,error:"pubkey_not_found"};const S=await SO.buildEvent(e,o,a,b,n,this.deps.createImetaTagFn,this.deps.getClientTagFn,u,d);if(typeof c.nostr.signEvent=="function"){const C=await c.nostr.signEvent(S);this.deps.console?.log("ç½²åæ¸ã¿ã¤ãã³ã:",C);const _=await this.eventSender.sendEvent(C);return _.success?this.deps.iframeMessageService?.notifyPostSuccess():this.deps.iframeMessageService?.notifyPostError(_.error),_}else return this.deps.iframeMessageService?.notifyPostError("nostr_sign_event_not_supported"),{success:!1,error:"nostr_sign_event_not_supported"}}catch(b){return this.deps.console?.error("window.nostrã§ã®æç¨¿ã¨ã©ã¼:",b),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}const p=l.getFromStore()||l.loadFromStorage();if(!p)return this.deps.iframeMessageService?.notifyPostError("key_not_found"),{success:!1,error:"key_not_found"};const m=await SO.buildEvent(e,o,a,void 0,n,this.deps.createImetaTagFn,this.deps.getClientTagFn,u,d),g=this.deps.seckeySignerFn?this.deps.seckeySignerFn(p):ux(p),y=await this.eventSender.sendEvent(m,g);return y.success?this.deps.iframeMessageService?.notifyPostSuccess():this.deps.iframeMessageService?.notifyPostError(y.error),y}catch(i){return this.deps.console?.error("æç¨¿ã¨ã©ã¼:",i),this.deps.iframeMessageService?.notifyPostError("post_error"),{success:!1,error:"post_error"}}}getEventSender(){return this.eventSender}getHashtagArrays(e){const n=e||uc,r=this.deps.hashtagSnapshotFn;if(r){const i=r(n);return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}if(n===uc)try{const i=afe();return{hashtags:Array.isArray(i?.hashtags)?[...i.hashtags]:[],tags:Array.isArray(i?.tags)?i.tags.map(s=>[...s]):[]}}catch(i){this.deps.console?.warn("hashtag_snapshot_failed",i)}return{hashtags:Array.isArray(n?.hashtags)?[...n.hashtags]:[],tags:Array.isArray(n?.tags)?n.tags.map(i=>[...i]):[]}}preparePostContent(e){return this.deps.extractContentWithImagesFn(e)||""}prepareImageBlurhashMap(e,n,r){const i=this.deps.extractImageBlurhashMapFn(e),s={};for(const[o,a]of Object.entries(i))s[o]={m:m5(o),blurhash:a,ox:n[o],x:r[o]};return s}async performPostSubmission(e,n,r,i,s,o){const a=this.preparePostContent(e),l=this.prepareImageBlurhashMap(e,n,r);i?.();try{const c=await this.submitPost(a,l);c.success?s?.():o?.(c.error||"post_error")}catch{o?.("post_error")}}applyEmptyStateToEditor(e){e.chain().clearContent().run()}resetPostContent(e){this.applyEmptyStateToEditor(e),this.deps.resetEditorStateFn?.(),this.deps.resetPostStatusFn?.(),qu.reset(),Af.reset()}clearContentAfterSuccess(e){this.applyEmptyStateToEditor(e),qu.reset(),Af.reset()}}function _me(t,e){return e.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}}))})),Object.freeze(t)}function dB(t,e){return new Promise((function(n,r){let i;return Ame(t).then((function(s){try{return i=s,n(new Blob([e.slice(0,2),i,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}}),r)}))}const Ame=t=>new Promise(((e,n)=>{const r=new FileReader;r.addEventListener("load",(({target:{result:i}})=>{const s=new DataView(i);let o=0;if(s.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=s.getUint16(o);if(a===65498)break;const l=s.getUint16(o+2);if(a===65505&&s.getUint32(o+4)===1165519206){const c=o+10;let u;switch(s.getUint16(c)){case 18761:u=!0;break;case 19789:u=!1;break;default:return n("TIFF header contains invalid endian")}if(s.getUint16(c+2,u)!==42)return n("TIFF header contains invalid version");const d=s.getUint32(c+4,u),f=c+d+2+12*s.getUint16(c+d,u);for(let h=c+d+2;h<f;h+=12)if(s.getUint16(h,u)==274){if(s.getUint16(h+2,u)!==3)return n("Orientation data type is invalid");if(s.getUint32(h+4,u)!==1)return n("Orientation data count is invalid");s.setUint16(h+8,1,u);break}return e(i.slice(o,o+2+l))}o+=2+l}return e(new Blob)})),r.readAsArrayBuffer(t)}));var yb={},Pme={get exports(){return yb},set exports(t){yb=t}};(function(t){var e,n,r={};Pme.exports=r,r.parse=function(i,s){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,c={},u=new Uint8Array(i),d=u.length-4;a(u,d)!=101010256;)d--;l=d,l+=4;var f=o(u,l+=4);o(u,l+=2);var h=a(u,l+=2),p=a(u,l+=4);l+=4,l=p;for(var m=0;m<f;m++){a(u,l),l+=4,l+=4,l+=4,a(u,l+=4),h=a(u,l+=4);var g=a(u,l+=4),y=o(u,l+=4),b=o(u,l+2),S=o(u,l+4);l+=6;var C=a(u,l+=8);l+=4,l+=y+b+S,r._readLocal(u,C,c,h,g,s)}return c},r._readLocal=function(i,s,o,a,l,c){var u=r.bin.readUshort,d=r.bin.readUint;d(i,s),u(i,s+=4),u(i,s+=2);var f=u(i,s+=2);d(i,s+=2),d(i,s+=4),s+=4;var h=u(i,s+=8),p=u(i,s+=2);s+=2;var m=r.bin.readUTF8(i,s,h);if(s+=h,s+=p,c)o[m]={size:l,csize:a};else{var g=new Uint8Array(i.buffer,s);if(f==0)o[m]=new Uint8Array(g.buffer.slice(s,s+a));else{if(f!=8)throw"unknown compression method: "+f;var y=new Uint8Array(l);r.inflateRaw(g,y),o[m]=y}}},r.inflateRaw=function(i,s){return r.F.inflate(i,s)},r.inflate=function(i,s){return i[0],i[1],r.inflateRaw(new Uint8Array(i.buffer,i.byteOffset+2,i.length-6),s)},r.deflate=function(i,s){s==null&&(s={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*i.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(i,a,o,s.level);var l=r.adler(i,0,i.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(i,s){s==null&&(s={level:6});var o=new Uint8Array(50+Math.floor(1.1*i.length)),a=r.F.deflateRaw(i,o,a,s.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(i,s){s==null&&(s=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,c={};for(var u in i){var d=!r._noNeed(u)&&!s,f=i[u],h=r.crc.crc(f,0,f.length);c[u]={cpr:d,usize:f.length,crc:h,file:d?r.deflateRaw(f):f}}for(var u in c)o+=c[u].file.length+30+46+2*r.bin.sizeUTF8(u);o+=22;var p=new Uint8Array(o),m=0,g=[];for(var u in c){var y=c[u];g.push(m),m=r._writeHeader(p,m,u,y,0)}var b=0,S=m;for(var u in c)y=c[u],g.push(m),m=r._writeHeader(p,m,u,y,1,g[b++]);var C=m-S;return a(p,m,101010256),m+=4,l(p,m+=4,b),l(p,m+=2,b),a(p,m+=2,C),a(p,m+=4,S),m+=4,m+=2,p.buffer},r._noNeed=function(i){var s=i.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(s)!=-1},r._writeHeader=function(i,s,o,a,l,c){var u=r.bin.writeUint,d=r.bin.writeUshort,f=a.file;return u(i,s,l==0?67324752:33639248),s+=4,l==1&&(s+=2),d(i,s,20),d(i,s+=2,0),d(i,s+=2,a.cpr?8:0),u(i,s+=2,0),u(i,s+=4,a.crc),u(i,s+=4,f.length),u(i,s+=4,a.usize),d(i,s+=4,r.bin.sizeUTF8(o)),d(i,s+=2,0),s+=2,l==1&&(s+=2,s+=2,u(i,s+=6,c),s+=4),s+=r.bin.writeUTF8(i,s,o),l==0&&(i.set(f,s),s+=f.length),s},r.crc={table:(function(){for(var i=new Uint32Array(256),s=0;s<256;s++){for(var o=s,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;i[s]=o}return i})(),update:function(i,s,o,a){for(var l=0;l<a;l++)i=r.crc.table[255&(i^s[o+l])]^i>>>8;return i},crc:function(i,s,o){return 4294967295^r.crc.update(4294967295,i,s,o)}},r.adler=function(i,s,o){for(var a=1,l=0,c=s,u=s+o;c<u;){for(var d=Math.min(c+5552,u);c<d;)l+=a+=i[c++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(i,s){return i[s]|i[s+1]<<8},writeUshort:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255},readUint:function(i,s){return 16777216*i[s+3]+(i[s+2]<<16|i[s+1]<<8|i[s])},writeUint:function(i,s,o){i[s]=255&o,i[s+1]=o>>8&255,i[s+2]=o>>16&255,i[s+3]=o>>24&255},readASCII:function(i,s,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(i[s+l]);return a},writeASCII:function(i,s,o){for(var a=0;a<o.length;a++)i[s+a]=o.charCodeAt(a)},pad:function(i){return i.length<2?"0"+i:i},readUTF8:function(i,s,o){for(var a,l="",c=0;c<o;c++)l+="%"+r.bin.pad(i[s+c].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(i,s,o)}return a},writeUTF8:function(i,s,o){for(var a=o.length,l=0,c=0;c<a;c++){var u=o.charCodeAt(c);if((4294967168&u)==0)i[s+l]=u,l++;else if((4294965248&u)==0)i[s+l]=192|u>>6,i[s+l+1]=128|u>>0&63,l+=2;else if((4294901760&u)==0)i[s+l]=224|u>>12,i[s+l+1]=128|u>>6&63,i[s+l+2]=128|u>>0&63,l+=3;else{if((4292870144&u)!=0)throw"e";i[s+l]=240|u>>18,i[s+l+1]=128|u>>12&63,i[s+l+2]=128|u>>6&63,i[s+l+3]=128|u>>0&63,l+=4}}return l},sizeUTF8:function(i){for(var s=i.length,o=0,a=0;a<s;a++){var l=i.charCodeAt(a);if((4294967168&l)==0)o++;else if((4294965248&l)==0)o+=2;else if((4294901760&l)==0)o+=3;else{if((4292870144&l)!=0)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(i,s,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],c=r.F.U,u=r.F._goodIndex;r.F._hash;var d=r.F._putsE,f=0,h=o<<3,p=0,m=i.length;if(a==0){for(;f<m;)d(s,h,f+(O=Math.min(65535,m-f))==m?1:0),h=r.F._copyExact(i,f,O,s,h+8),f+=O;return h>>>3}var g=c.lits,y=c.strt,b=c.prev,S=0,C=0,_=0,x=0,I=0,k=0;for(m>2&&(y[k=r.F._hash(i,0)]=0),f=0;f<m;f++){if(I=k,f+1<m-2){k=r.F._hash(i,f+1);var T=f+1&32767;b[T]=y[k],y[k]=T}if(p<=f){(S>14e3||C>26697)&&m-f>100&&(p<f&&(g[S]=f-p,S+=2,p=f),h=r.F._writeBlock(f==m-1||p==m?1:0,g,S,x,i,_,f-_,s,h),S=C=x=0,_=f);var P=0;f<m-2&&(P=r.F._bestMatch(i,f,b,I,Math.min(l[2],m-f),l[3]));var O=P>>>16,D=65535&P;if(P!=0){D=65535&P;var F=u(O=P>>>16,c.of0);c.lhst[257+F]++;var B=u(D,c.df0);c.dhst[B]++,x+=c.exb[F]+c.dxb[B],g[S]=O<<23|f-p,g[S+1]=D<<16|F<<8|B,S+=2,p=f+O}else c.lhst[i[f]]++;C++}}for(_==f&&i.length!=0||(p<f&&(g[S]=f-p,S+=2,p=f),h=r.F._writeBlock(1,g,S,x,i,_,f-_,s,h),S=0,C=0,S=C=x=0,_=f);(7&h)!=0;)h++;return h>>>3},r.F._bestMatch=function(i,s,o,a,l,c){var u=32767&s,d=o[u],f=u-d+32768&32767;if(d==u||a!=r.F._hash(i,s-f))return 0;for(var h=0,p=0,m=Math.min(32767,s);f<=m&&--c!=0&&d!=u;){if(h==0||i[s+h]==i[s+h-f]){var g=r.F._howLong(i,s,f);if(g>h){if(p=f,(h=g)>=l)break;f+2<g&&(g=f+2);for(var y=0,b=0;b<g-2;b++){var S=s-f+b+32768&32767,C=S-o[S]+32768&32767;C>y&&(y=C,d=S)}}}f+=(u=d)-(d=o[u])+32768&32767}return h<<16|p},r.F._howLong=function(i,s,o){if(i[s]!=i[s-o]||i[s+1]!=i[s+1-o]||i[s+2]!=i[s+2-o])return 0;var a=s,l=Math.min(i.length,s+258);for(s+=3;s<l&&i[s]==i[s-o];)s++;return s-a},r.F._hash=function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(i,s,o,a,l,c,u,d,f){var h,p,m,g,y,b,S,C,_,x=r.F.U,I=r.F._putsF,k=r.F._putsE;x.lhst[256]++,p=(h=r.F.getTrees())[0],m=h[1],g=h[2],y=h[3],b=h[4],S=h[5],C=h[6],_=h[7];var T=32+((f+3&7)==0?0:8-(f+3&7))+(u<<3),P=a+r.F.contSize(x.fltree,x.lhst)+r.F.contSize(x.fdtree,x.dhst),O=a+r.F.contSize(x.ltree,x.lhst)+r.F.contSize(x.dtree,x.dhst);O+=14+3*S+r.F.contSize(x.itree,x.ihst)+(2*x.ihst[16]+3*x.ihst[17]+7*x.ihst[18]);for(var D=0;D<286;D++)x.lhst[D]=0;for(D=0;D<30;D++)x.dhst[D]=0;for(D=0;D<19;D++)x.ihst[D]=0;var F=T<P&&T<O?0:P<O?1:2;if(I(d,f,i),I(d,f+1,F),f+=3,F==0){for(;(7&f)!=0;)f++;f=r.F._copyExact(l,c,u,d,f)}else{var B,N;if(F==1&&(B=x.fltree,N=x.fdtree),F==2){r.F.makeCodes(x.ltree,p),r.F.revCodes(x.ltree,p),r.F.makeCodes(x.dtree,m),r.F.revCodes(x.dtree,m),r.F.makeCodes(x.itree,g),r.F.revCodes(x.itree,g),B=x.ltree,N=x.dtree,k(d,f,y-257),k(d,f+=5,b-1),k(d,f+=5,S-4),f+=4;for(var M=0;M<S;M++)k(d,f+3*M,x.itree[1+(x.ordr[M]<<1)]);f+=3*S,f=r.F._codeTiny(C,x.itree,d,f),f=r.F._codeTiny(_,x.itree,d,f)}for(var R=c,H=0;H<o;H+=2){for(var z=s[H],V=z>>>23,X=R+(8388607&z);R<X;)f=r.F._writeLit(l[R++],B,d,f);if(V!=0){var Z=s[H+1],te=Z>>16,ne=Z>>8&255,J=255&Z;k(d,f=r.F._writeLit(257+ne,B,d,f),V-x.of0[ne]),f+=x.exb[ne],I(d,f=r.F._writeLit(J,N,d,f),te-x.df0[J]),f+=x.dxb[J],R+=V}}f=r.F._writeLit(256,B,d,f)}return f},r.F._copyExact=function(i,s,o,a,l){var c=l>>>3;return a[c]=o,a[c+1]=o>>>8,a[c+2]=255-a[c],a[c+3]=255-a[c+1],c+=4,a.set(new Uint8Array(i.buffer,s,o),c),l+(o+4<<3)},r.F.getTrees=function(){for(var i=r.F.U,s=r.F._hufTree(i.lhst,i.ltree,15),o=r.F._hufTree(i.dhst,i.dtree,15),a=[],l=r.F._lenCodes(i.ltree,a),c=[],u=r.F._lenCodes(i.dtree,c),d=0;d<a.length;d+=2)i.ihst[a[d]]++;for(d=0;d<c.length;d+=2)i.ihst[c[d]]++;for(var f=r.F._hufTree(i.ihst,i.itree,7),h=19;h>4&&i.itree[1+(i.ordr[h-1]<<1)]==0;)h--;return[s,o,f,l,u,h,a,c]},r.F.getSecond=function(i){for(var s=[],o=0;o<i.length;o+=2)s.push(i[o+1]);return s},r.F.nonZero=function(i){for(var s="",o=0;o<i.length;o+=2)i[o+1]!=0&&(s+=(o>>1)+",");return s},r.F.contSize=function(i,s){for(var o=0,a=0;a<s.length;a++)o+=s[a]*i[1+(a<<1)];return o},r.F._codeTiny=function(i,s,o,a){for(var l=0;l<i.length;l+=2){var c=i[l],u=i[l+1];a=r.F._writeLit(c,s,o,a);var d=c==16?2:c==17?3:7;c>15&&(r.F._putsE(o,a,u,d),a+=d)}return a},r.F._lenCodes=function(i,s){for(var o=i.length;o!=2&&i[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=i[a+1],c=a+3<o?i[a+3]:-1,u=a+5<o?i[a+5]:-1,d=a==0?-1:i[a-1];if(l==0&&c==l&&u==l){for(var f=a+5;f+2<o&&i[f+2]==l;)f+=2;(h=Math.min(f+1-a>>>1,138))<11?s.push(17,h-3):s.push(18,h-11),a+=2*h-2}else if(l==d&&c==l&&u==l){for(f=a+5;f+2<o&&i[f+2]==l;)f+=2;var h=Math.min(f+1-a>>>1,6);s.push(16,h-3),a+=2*h-2}else s.push(l,0)}return o>>>1},r.F._hufTree=function(i,s,o){var a=[],l=i.length,c=s.length,u=0;for(u=0;u<c;u+=2)s[u]=0,s[u+1]=0;for(u=0;u<l;u++)i[u]!=0&&a.push({lit:u,f:i[u]});var d=a.length,f=a.slice(0);if(d==0)return 0;if(d==1){var h=a[0].lit;return f=h==0?1:0,s[1+(h<<1)]=1,s[1+(f<<1)]=1,1}a.sort((function(C,_){return C.f-_.f}));var p=a[0],m=a[1],g=0,y=1,b=2;for(a[0]={lit:-1,f:p.f+m.f,l:p,r:m,d:0};y!=d-1;)p=g!=y&&(b==d||a[g].f<a[b].f)?a[g++]:a[b++],m=g!=y&&(b==d||a[g].f<a[b].f)?a[g++]:a[b++],a[y++]={lit:-1,f:p.f+m.f,l:p,r:m};var S=r.F.setDepth(a[y-1],0);for(S>o&&(r.F.restrictDepth(f,o,S),S=o),u=0;u<d;u++)s[1+(f[u].lit<<1)]=f[u].d;return S},r.F.setDepth=function(i,s){return i.lit!=-1?(i.d=s,s):Math.max(r.F.setDepth(i.l,s+1),r.F.setDepth(i.r,s+1))},r.F.restrictDepth=function(i,s,o){var a=0,l=1<<o-s,c=0;for(i.sort((function(d,f){return f.d==d.d?d.f-f.f:f.d-d.d})),a=0;a<i.length&&i[a].d>s;a++){var u=i[a].d;i[a].d=s,c+=l-(1<<o-u)}for(c>>>=o-s;c>0;)(u=i[a].d)<s?(i[a].d++,c-=1<<s-u-1):a++;for(;a>=0;a--)i[a].d==s&&c<0&&(i[a].d--,c++);c!=0&&console.log("debt left")},r.F._goodIndex=function(i,s){var o=0;return s[16|o]<=i&&(o|=16),s[8|o]<=i&&(o|=8),s[4|o]<=i&&(o|=4),s[2|o]<=i&&(o|=2),s[1|o]<=i&&(o|=1),o},r.F._writeLit=function(i,s,o,a){return r.F._putsF(o,a,s[i<<1]),a+s[1+(i<<1)]},r.F.inflate=function(i,s){var o=Uint8Array;if(i[0]==3&&i[1]==0)return s||new o(0);var a=r.F,l=a._bitsF,c=a._bitsE,u=a._decodeTiny,d=a.makeCodes,f=a.codes2map,h=a._get17,p=a.U,m=s==null;m&&(s=new o(i.length>>>2<<3));for(var g,y,b=0,S=0,C=0,_=0,x=0,I=0,k=0,T=0,P=0;b==0;)if(b=l(i,P,1),S=l(i,P+1,2),P+=3,S!=0){if(m&&(s=r.F._check(s,T+(1<<17))),S==1&&(g=p.flmap,y=p.fdmap,I=511,k=31),S==2){C=c(i,P,5)+257,_=c(i,P+5,5)+1,x=c(i,P+10,4)+4,P+=14;for(var O=0;O<38;O+=2)p.itree[O]=0,p.itree[O+1]=0;var D=1;for(O=0;O<x;O++){var F=c(i,P+3*O,3);p.itree[1+(p.ordr[O]<<1)]=F,F>D&&(D=F)}P+=3*x,d(p.itree,D),f(p.itree,D,p.imap),g=p.lmap,y=p.dmap,P=u(p.imap,(1<<D)-1,C+_,i,P,p.ttree);var B=a._copyOut(p.ttree,0,C,p.ltree);I=(1<<B)-1;var N=a._copyOut(p.ttree,C,_,p.dtree);k=(1<<N)-1,d(p.ltree,B),f(p.ltree,B,g),d(p.dtree,N),f(p.dtree,N,y)}for(;;){var M=g[h(i,P)&I];P+=15&M;var R=M>>>4;if(!(R>>>8))s[T++]=R;else{if(R==256)break;var H=T+R-254;if(R>264){var z=p.ldef[R-257];H=T+(z>>>3)+c(i,P,7&z),P+=7&z}var V=y[h(i,P)&k];P+=15&V;var X=V>>>4,Z=p.ddef[X],te=(Z>>>4)+l(i,P,15&Z);for(P+=15&Z,m&&(s=r.F._check(s,T+(1<<17)));T<H;)s[T]=s[T++-te],s[T]=s[T++-te],s[T]=s[T++-te],s[T]=s[T++-te];T=H}}}else{(7&P)!=0&&(P+=8-(7&P));var ne=4+(P>>>3),J=i[ne-4]|i[ne-3]<<8;m&&(s=r.F._check(s,T+J)),s.set(new o(i.buffer,i.byteOffset+ne,J),T),P=ne+J<<3,T+=J}return s.length==T?s:s.slice(0,T)},r.F._check=function(i,s){var o=i.length;if(s<=o)return i;var a=new Uint8Array(Math.max(o<<1,s));return a.set(i,0),a},r.F._decodeTiny=function(i,s,o,a,l,c){for(var u=r.F._bitsE,d=r.F._get17,f=0;f<o;){var h=i[d(a,l)&s];l+=15&h;var p=h>>>4;if(p<=15)c[f]=p,f++;else{var m=0,g=0;p==16?(g=3+u(a,l,2),l+=2,m=c[f-1]):p==17?(g=3+u(a,l,3),l+=3):p==18&&(g=11+u(a,l,7),l+=7);for(var y=f+g;f<y;)c[f]=m,f++}}return l},r.F._copyOut=function(i,s,o,a){for(var l=0,c=0,u=a.length>>>1;c<o;){var d=i[c+s];a[c<<1]=0,a[1+(c<<1)]=d,d>l&&(l=d),c++}for(;c<u;)a[c<<1]=0,a[1+(c<<1)]=0,c++;return l},r.F.makeCodes=function(i,s){for(var o,a,l,c,u=r.F.U,d=i.length,f=u.bl_count,h=0;h<=s;h++)f[h]=0;for(h=1;h<d;h+=2)f[i[h]]++;var p=u.next_code;for(o=0,f[0]=0,a=1;a<=s;a++)o=o+f[a-1]<<1,p[a]=o;for(l=0;l<d;l+=2)(c=i[l+1])!=0&&(i[l]=p[c],p[c]++)},r.F.codes2map=function(i,s,o){for(var a=i.length,l=r.F.U.rev15,c=0;c<a;c+=2)if(i[c+1]!=0)for(var u=c>>1,d=i[c+1],f=u<<4|d,h=s-d,p=i[c]<<h,m=p+(1<<h);p!=m;)o[l[p]>>>15-s]=f,p++},r.F.revCodes=function(i,s){for(var o=r.F.U.rev15,a=15-s,l=0;l<i.length;l+=2){var c=i[l]<<s-i[l+1];i[l]=o[c]>>>a}},r.F._putsE=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8},r.F._putsF=function(i,s,o){o<<=7&s;var a=s>>>3;i[a]|=o,i[a+1]|=o>>>8,i[a+2]|=o>>>16},r.F._bitsE=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8)>>>(7&s)&(1<<o)-1},r.F._bitsF=function(i,s,o){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)&(1<<o)-1},r.F._get17=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16)>>>(7&s)},r.F._get25=function(i,s){return(i[s>>>3]|i[1+(s>>>3)]<<8|i[2+(s>>>3)]<<16|i[3+(s>>>3)]<<24)>>>(7&s)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),(function(){for(var i=r.F.U,s=0;s<32768;s++){var o=s;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,i.rev15[s]=(o>>>16|o<<16)>>>17}function a(l,c,u){for(;c--!=0;)l.push(0,u)}for(s=0;s<32;s++)i.ldef[s]=i.of0[s]<<3|i.exb[s],i.ddef[s]=i.df0[s]<<4|i.dxb[s];a(i.fltree,144,8),a(i.fltree,112,9),a(i.fltree,24,7),a(i.fltree,8,8),r.F.makeCodes(i.fltree,9),r.F.codes2map(i.fltree,9,i.flmap),r.F.revCodes(i.fltree,9),a(i.fdtree,32,5),r.F.makeCodes(i.fdtree,5),r.F.codes2map(i.fdtree,5,i.fdmap),r.F.revCodes(i.fdtree,5),a(i.itree,19,0),a(i.ltree,286,0),a(i.dtree,30,0),a(i.ttree,320,0)})()})();var Ime=_me({__proto__:null,default:yb},[yb]);const Ys=(function(){var t={nextZero(u,d){for(;u[d]!=0;)d++;return d},readUshort:(u,d)=>u[d]<<8|u[d+1],writeUshort(u,d,f){u[d]=f>>8&255,u[d+1]=255&f},readUint:(u,d)=>16777216*u[d]+(u[d+1]<<16|u[d+2]<<8|u[d+3]),writeUint(u,d,f){u[d]=f>>24&255,u[d+1]=f>>16&255,u[d+2]=f>>8&255,u[d+3]=255&f},readASCII(u,d,f){let h="";for(let p=0;p<f;p++)h+=String.fromCharCode(u[d+p]);return h},writeASCII(u,d,f){for(let h=0;h<f.length;h++)u[d+h]=f.charCodeAt(h)},readBytes(u,d,f){const h=[];for(let p=0;p<f;p++)h.push(u[d+p]);return h},pad:u=>u.length<2?`0${u}`:u,readUTF8(u,d,f){let h,p="";for(let m=0;m<f;m++)p+=`%${t.pad(u[d+m].toString(16))}`;try{h=decodeURIComponent(p)}catch{return t.readASCII(u,d,f)}return h}};function e(u,d,f,h){const p=d*f,m=s(h),g=Math.ceil(d*m/8),y=new Uint8Array(4*p),b=new Uint32Array(y.buffer),{ctype:S}=h,{depth:C}=h,_=t.readUshort;if(S==6){const z=p<<2;if(C==8)for(var x=0;x<z;x+=4)y[x]=u[x],y[x+1]=u[x+1],y[x+2]=u[x+2],y[x+3]=u[x+3];if(C==16)for(x=0;x<z;x++)y[x]=u[x<<1]}else if(S==2){const z=h.tabs.tRNS;if(z==null){if(C==8)for(x=0;x<p;x++){var I=3*x;b[x]=255<<24|u[I+2]<<16|u[I+1]<<8|u[I]}if(C==16)for(x=0;x<p;x++)I=6*x,b[x]=255<<24|u[I+4]<<16|u[I+2]<<8|u[I]}else{var k=z[0];const V=z[1],X=z[2];if(C==8)for(x=0;x<p;x++){var T=x<<2;I=3*x,b[x]=255<<24|u[I+2]<<16|u[I+1]<<8|u[I],u[I]==k&&u[I+1]==V&&u[I+2]==X&&(y[T+3]=0)}if(C==16)for(x=0;x<p;x++)T=x<<2,I=6*x,b[x]=255<<24|u[I+4]<<16|u[I+2]<<8|u[I],_(u,I)==k&&_(u,I+2)==V&&_(u,I+4)==X&&(y[T+3]=0)}}else if(S==3){const z=h.tabs.PLTE,V=h.tabs.tRNS,X=V?V.length:0;if(C==1)for(var P=0;P<f;P++){var O=P*g,D=P*d;for(x=0;x<d;x++){T=D+x<<2;var F=3*(B=u[O+(x>>3)]>>7-((7&x)<<0)&1);y[T]=z[F],y[T+1]=z[F+1],y[T+2]=z[F+2],y[T+3]=B<X?V[B]:255}}if(C==2)for(P=0;P<f;P++)for(O=P*g,D=P*d,x=0;x<d;x++)T=D+x<<2,F=3*(B=u[O+(x>>2)]>>6-((3&x)<<1)&3),y[T]=z[F],y[T+1]=z[F+1],y[T+2]=z[F+2],y[T+3]=B<X?V[B]:255;if(C==4)for(P=0;P<f;P++)for(O=P*g,D=P*d,x=0;x<d;x++)T=D+x<<2,F=3*(B=u[O+(x>>1)]>>4-((1&x)<<2)&15),y[T]=z[F],y[T+1]=z[F+1],y[T+2]=z[F+2],y[T+3]=B<X?V[B]:255;if(C==8)for(x=0;x<p;x++){var B;T=x<<2,F=3*(B=u[x]),y[T]=z[F],y[T+1]=z[F+1],y[T+2]=z[F+2],y[T+3]=B<X?V[B]:255}}else if(S==4){if(C==8)for(x=0;x<p;x++){T=x<<2;var N=u[M=x<<1];y[T]=N,y[T+1]=N,y[T+2]=N,y[T+3]=u[M+1]}if(C==16)for(x=0;x<p;x++){var M;T=x<<2,N=u[M=x<<2],y[T]=N,y[T+1]=N,y[T+2]=N,y[T+3]=u[M+2]}}else if(S==0)for(k=h.tabs.tRNS?h.tabs.tRNS:-1,P=0;P<f;P++){const z=P*g,V=P*d;if(C==1)for(var R=0;R<d;R++){var H=(N=255*(u[z+(R>>>3)]>>>7-(7&R)&1))==255*k?0:255;b[V+R]=H<<24|N<<16|N<<8|N}else if(C==2)for(R=0;R<d;R++)H=(N=85*(u[z+(R>>>2)]>>>6-((3&R)<<1)&3))==85*k?0:255,b[V+R]=H<<24|N<<16|N<<8|N;else if(C==4)for(R=0;R<d;R++)H=(N=17*(u[z+(R>>>1)]>>>4-((1&R)<<2)&15))==17*k?0:255,b[V+R]=H<<24|N<<16|N<<8|N;else if(C==8)for(R=0;R<d;R++)H=(N=u[z+R])==k?0:255,b[V+R]=H<<24|N<<16|N<<8|N;else if(C==16)for(R=0;R<d;R++)N=u[z+(R<<1)],H=_(u,z+(R<<1))==k?0:255,b[V+R]=H<<24|N<<16|N<<8|N}return y}function n(u,d,f,h){const p=s(u),m=Math.ceil(f*p/8),g=new Uint8Array((m+1+u.interlace)*h);return d=u.tabs.CgBI?i(d,g):r(d,g),u.interlace==0?d=o(d,u,0,f,h):u.interlace==1&&(d=(function(b,S){const C=S.width,_=S.height,x=s(S),I=x>>3,k=Math.ceil(C*x/8),T=new Uint8Array(_*k);let P=0;const O=[0,0,4,0,2,0,1],D=[0,4,0,2,0,1,0],F=[8,8,8,4,4,2,2],B=[8,8,4,4,2,2,1];let N=0;for(;N<7;){const R=F[N],H=B[N];let z=0,V=0,X=O[N];for(;X<_;)X+=R,V++;let Z=D[N];for(;Z<C;)Z+=H,z++;const te=Math.ceil(z*x/8);o(b,S,P,z,V);let ne=0,J=O[N];for(;J<_;){let xe=D[N],Le=P+ne*te<<3;for(;xe<C;){var M;if(x==1&&(M=(M=b[Le>>3])>>7-(7&Le)&1,T[J*k+(xe>>3)]|=M<<7-((7&xe)<<0)),x==2&&(M=(M=b[Le>>3])>>6-(7&Le)&3,T[J*k+(xe>>2)]|=M<<6-((3&xe)<<1)),x==4&&(M=(M=b[Le>>3])>>4-(7&Le)&15,T[J*k+(xe>>1)]|=M<<4-((1&xe)<<2)),x>=8){const he=J*k+xe*I;for(let ke=0;ke<I;ke++)T[he+ke]=b[(Le>>3)+ke]}Le+=x,xe+=H}ne++,J+=R}z*V!=0&&(P+=V*(1+te)),N+=1}return T})(d,u)),d}function r(u,d){return i(new Uint8Array(u.buffer,2,u.length-6),d)}var i=(function(){const u={H:{}};return u.H.N=function(d,f){const h=Uint8Array;let p,m,g=0,y=0,b=0,S=0,C=0,_=0,x=0,I=0,k=0;if(d[0]==3&&d[1]==0)return f||new h(0);const T=u.H,P=T.b,O=T.e,D=T.R,F=T.n,B=T.A,N=T.Z,M=T.m,R=f==null;for(R&&(f=new h(d.length>>>2<<5));g==0;)if(g=P(d,k,1),y=P(d,k+1,2),k+=3,y!=0){if(R&&(f=u.H.W(f,I+(1<<17))),y==1&&(p=M.J,m=M.h,_=511,x=31),y==2){b=O(d,k,5)+257,S=O(d,k+5,5)+1,C=O(d,k+10,4)+4,k+=14;let z=1;for(var H=0;H<38;H+=2)M.Q[H]=0,M.Q[H+1]=0;for(H=0;H<C;H++){const Z=O(d,k+3*H,3);M.Q[1+(M.X[H]<<1)]=Z,Z>z&&(z=Z)}k+=3*C,F(M.Q,z),B(M.Q,z,M.u),p=M.w,m=M.d,k=D(M.u,(1<<z)-1,b+S,d,k,M.v);const V=T.V(M.v,0,b,M.C);_=(1<<V)-1;const X=T.V(M.v,b,S,M.D);x=(1<<X)-1,F(M.C,V),B(M.C,V,p),F(M.D,X),B(M.D,X,m)}for(;;){const z=p[N(d,k)&_];k+=15&z;const V=z>>>4;if(!(V>>>8))f[I++]=V;else{if(V==256)break;{let X=I+V-254;if(V>264){const xe=M.q[V-257];X=I+(xe>>>3)+O(d,k,7&xe),k+=7&xe}const Z=m[N(d,k)&x];k+=15&Z;const te=Z>>>4,ne=M.c[te],J=(ne>>>4)+P(d,k,15&ne);for(k+=15&ne;I<X;)f[I]=f[I++-J],f[I]=f[I++-J],f[I]=f[I++-J],f[I]=f[I++-J];I=X}}}}else{(7&k)!=0&&(k+=8-(7&k));const z=4+(k>>>3),V=d[z-4]|d[z-3]<<8;R&&(f=u.H.W(f,I+V)),f.set(new h(d.buffer,d.byteOffset+z,V),I),k=z+V<<3,I+=V}return f.length==I?f:f.slice(0,I)},u.H.W=function(d,f){const h=d.length;if(f<=h)return d;const p=new Uint8Array(h<<1);return p.set(d,0),p},u.H.R=function(d,f,h,p,m,g){const y=u.H.e,b=u.H.Z;let S=0;for(;S<h;){const C=d[b(p,m)&f];m+=15&C;const _=C>>>4;if(_<=15)g[S]=_,S++;else{let x=0,I=0;_==16?(I=3+y(p,m,2),m+=2,x=g[S-1]):_==17?(I=3+y(p,m,3),m+=3):_==18&&(I=11+y(p,m,7),m+=7);const k=S+I;for(;S<k;)g[S]=x,S++}}return m},u.H.V=function(d,f,h,p){let m=0,g=0;const y=p.length>>>1;for(;g<h;){const b=d[g+f];p[g<<1]=0,p[1+(g<<1)]=b,b>m&&(m=b),g++}for(;g<y;)p[g<<1]=0,p[1+(g<<1)]=0,g++;return m},u.H.n=function(d,f){const h=u.H.m,p=d.length;let m,g,y,b;const S=h.j;for(var C=0;C<=f;C++)S[C]=0;for(C=1;C<p;C+=2)S[d[C]]++;const _=h.K;for(m=0,S[0]=0,g=1;g<=f;g++)m=m+S[g-1]<<1,_[g]=m;for(y=0;y<p;y+=2)b=d[y+1],b!=0&&(d[y]=_[b],_[b]++)},u.H.A=function(d,f,h){const p=d.length,m=u.H.m.r;for(let g=0;g<p;g+=2)if(d[g+1]!=0){const y=g>>1,b=d[g+1],S=y<<4|b,C=f-b;let _=d[g]<<C;const x=_+(1<<C);for(;_!=x;)h[m[_]>>>15-f]=S,_++}},u.H.l=function(d,f){const h=u.H.m.r,p=15-f;for(let m=0;m<d.length;m+=2){const g=d[m]<<f-d[m+1];d[m]=h[g]>>>p}},u.H.M=function(d,f,h){h<<=7&f;const p=f>>>3;d[p]|=h,d[p+1]|=h>>>8},u.H.I=function(d,f,h){h<<=7&f;const p=f>>>3;d[p]|=h,d[p+1]|=h>>>8,d[p+2]|=h>>>16},u.H.e=function(d,f,h){return(d[f>>>3]|d[1+(f>>>3)]<<8)>>>(7&f)&(1<<h)-1},u.H.b=function(d,f,h){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)&(1<<h)-1},u.H.Z=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16)>>>(7&f)},u.H.i=function(d,f){return(d[f>>>3]|d[1+(f>>>3)]<<8|d[2+(f>>>3)]<<16|d[3+(f>>>3)]<<24)>>>(7&f)},u.H.m=(function(){const d=Uint16Array,f=Uint32Array;return{K:new d(16),j:new d(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new d(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new f(32),J:new d(512),_:[],h:new d(32),$:[],w:new d(32768),C:[],v:[],d:new d(32768),D:[],u:new d(512),Q:[],r:new d(32768),s:new f(286),Y:new f(30),a:new f(19),t:new f(15e3),k:new d(65536),g:new d(32768)}})(),(function(){const d=u.H.m;for(var f=0;f<32768;f++){let p=f;p=(2863311530&p)>>>1|(1431655765&p)<<1,p=(3435973836&p)>>>2|(858993459&p)<<2,p=(4042322160&p)>>>4|(252645135&p)<<4,p=(4278255360&p)>>>8|(16711935&p)<<8,d.r[f]=(p>>>16|p<<16)>>>17}function h(p,m,g){for(;m--!=0;)p.push(0,g)}for(f=0;f<32;f++)d.q[f]=d.S[f]<<3|d.T[f],d.c[f]=d.p[f]<<4|d.z[f];h(d._,144,8),h(d._,112,9),h(d._,24,7),h(d._,8,8),u.H.n(d._,9),u.H.A(d._,9,d.J),u.H.l(d._,9),h(d.$,32,5),u.H.n(d.$,5),u.H.A(d.$,5,d.h),u.H.l(d.$,5),h(d.Q,19,0),h(d.C,286,0),h(d.D,30,0),h(d.v,320,0)})(),u.H.N})();function s(u){return[1,null,3,1,2,null,4][u.ctype]*u.depth}function o(u,d,f,h,p){let m=s(d);const g=Math.ceil(h*m/8);let y,b;m=Math.ceil(m/8);let S=u[f],C=0;if(S>1&&(u[f]=[0,0,1][S-2]),S==3)for(C=m;C<g;C++)u[C+1]=u[C+1]+(u[C+1-m]>>>1)&255;for(let _=0;_<p;_++)if(y=f+_*g,b=y+_+1,S=u[b-1],C=0,S==0)for(;C<g;C++)u[y+C]=u[b+C];else if(S==1){for(;C<m;C++)u[y+C]=u[b+C];for(;C<g;C++)u[y+C]=u[b+C]+u[y+C-m]}else if(S==2)for(;C<g;C++)u[y+C]=u[b+C]+u[y+C-g];else if(S==3){for(;C<m;C++)u[y+C]=u[b+C]+(u[y+C-g]>>>1);for(;C<g;C++)u[y+C]=u[b+C]+(u[y+C-g]+u[y+C-m]>>>1)}else{for(;C<m;C++)u[y+C]=u[b+C]+a(0,u[y+C-g],0);for(;C<g;C++)u[y+C]=u[b+C]+a(u[y+C-m],u[y+C-g],u[y+C-m-g])}return u}function a(u,d,f){const h=u+d-f,p=h-u,m=h-d,g=h-f;return p*p<=m*m&&p*p<=g*g?u:m*m<=g*g?d:f}function l(u,d,f){f.width=t.readUint(u,d),d+=4,f.height=t.readUint(u,d),d+=4,f.depth=u[d],d++,f.ctype=u[d],d++,f.compress=u[d],d++,f.filter=u[d],d++,f.interlace=u[d],d++}function c(u,d,f,h,p,m,g,y,b){const S=Math.min(d,p),C=Math.min(f,m);let _=0,x=0;for(let N=0;N<C;N++)for(let M=0;M<S;M++)if(g>=0&&y>=0?(_=N*d+M<<2,x=(y+N)*p+g+M<<2):(_=(-y+N)*d-g+M<<2,x=N*p+M<<2),b==0)h[x]=u[_],h[x+1]=u[_+1],h[x+2]=u[_+2],h[x+3]=u[_+3];else if(b==1){var I=u[_+3]*.00392156862745098,k=u[_]*I,T=u[_+1]*I,P=u[_+2]*I,O=h[x+3]*(1/255),D=h[x]*O,F=h[x+1]*O,B=h[x+2]*O;const R=1-I,H=I+O*R,z=H==0?0:1/H;h[x+3]=255*H,h[x+0]=(k+D*R)*z,h[x+1]=(T+F*R)*z,h[x+2]=(P+B*R)*z}else if(b==2)I=u[_+3],k=u[_],T=u[_+1],P=u[_+2],O=h[x+3],D=h[x],F=h[x+1],B=h[x+2],I==O&&k==D&&T==F&&P==B?(h[x]=0,h[x+1]=0,h[x+2]=0,h[x+3]=0):(h[x]=k,h[x+1]=T,h[x+2]=P,h[x+3]=I);else if(b==3){if(I=u[_+3],k=u[_],T=u[_+1],P=u[_+2],O=h[x+3],D=h[x],F=h[x+1],B=h[x+2],I==O&&k==D&&T==F&&P==B)continue;if(I<220&&O>20)return!1}return!0}return{decode:function(d){const f=new Uint8Array(d);let h=8;const p=t,m=p.readUshort,g=p.readUint,y={tabs:{},frames:[]},b=new Uint8Array(f.length);let S,C=0,_=0;const x=[137,80,78,71,13,10,26,10];for(var I=0;I<8;I++)if(f[I]!=x[I])throw"The input is not a PNG file!";for(;h<f.length;){const N=p.readUint(f,h);h+=4;const M=p.readASCII(f,h,4);if(h+=4,M=="IHDR")l(f,h,y);else if(M=="iCCP"){for(var k=h;f[k]!=0;)k++;p.readASCII(f,h,k-h),f[k+1];const R=f.slice(k+2,h+N);let H=null;try{H=r(R)}catch{H=i(R)}y.tabs[M]=H}else if(M=="CgBI")y.tabs[M]=f.slice(h,h+4);else if(M=="IDAT"){for(I=0;I<N;I++)b[C+I]=f[h+I];C+=N}else if(M=="acTL")y.tabs[M]={num_frames:g(f,h),num_plays:g(f,h+4)},S=new Uint8Array(f.length);else if(M=="fcTL"){_!=0&&((B=y.frames[y.frames.length-1]).data=n(y,S.slice(0,_),B.rect.width,B.rect.height),_=0);const R={x:g(f,h+12),y:g(f,h+16),width:g(f,h+4),height:g(f,h+8)};let H=m(f,h+22);H=m(f,h+20)/(H==0?100:H);const z={rect:R,delay:Math.round(1e3*H),dispose:f[h+24],blend:f[h+25]};y.frames.push(z)}else if(M=="fdAT"){for(I=0;I<N-4;I++)S[_+I]=f[h+I+4];_+=N-4}else if(M=="pHYs")y.tabs[M]=[p.readUint(f,h),p.readUint(f,h+4),f[h+8]];else if(M=="cHRM")for(y.tabs[M]=[],I=0;I<8;I++)y.tabs[M].push(p.readUint(f,h+4*I));else if(M=="tEXt"||M=="zTXt"){y.tabs[M]==null&&(y.tabs[M]={});var T=p.nextZero(f,h),P=p.readASCII(f,h,T-h),O=h+N-T-1;if(M=="tEXt")F=p.readASCII(f,T+1,O);else{var D=r(f.slice(T+2,T+2+O));F=p.readUTF8(D,0,D.length)}y.tabs[M][P]=F}else if(M=="iTXt"){y.tabs[M]==null&&(y.tabs[M]={}),T=0,k=h,T=p.nextZero(f,k),P=p.readASCII(f,k,T-k);const R=f[k=T+1];var F;f[k+1],k+=2,T=p.nextZero(f,k),p.readASCII(f,k,T-k),k=T+1,T=p.nextZero(f,k),p.readUTF8(f,k,T-k),O=N-((k=T+1)-h),R==0?F=p.readUTF8(f,k,O):(D=r(f.slice(k,k+O)),F=p.readUTF8(D,0,D.length)),y.tabs[M][P]=F}else if(M=="PLTE")y.tabs[M]=p.readBytes(f,h,N);else if(M=="hIST"){const R=y.tabs.PLTE.length/3;for(y.tabs[M]=[],I=0;I<R;I++)y.tabs[M].push(m(f,h+2*I))}else if(M=="tRNS")y.ctype==3?y.tabs[M]=p.readBytes(f,h,N):y.ctype==0?y.tabs[M]=m(f,h):y.ctype==2&&(y.tabs[M]=[m(f,h),m(f,h+2),m(f,h+4)]);else if(M=="gAMA")y.tabs[M]=p.readUint(f,h)/1e5;else if(M=="sRGB")y.tabs[M]=f[h];else if(M=="bKGD")y.ctype==0||y.ctype==4?y.tabs[M]=[m(f,h)]:y.ctype==2||y.ctype==6?y.tabs[M]=[m(f,h),m(f,h+2),m(f,h+4)]:y.ctype==3&&(y.tabs[M]=f[h]);else if(M=="IEND")break;h+=N,p.readUint(f,h),h+=4}var B;return _!=0&&((B=y.frames[y.frames.length-1]).data=n(y,S.slice(0,_),B.rect.width,B.rect.height)),y.data=n(y,b,y.width,y.height),delete y.compress,delete y.interlace,delete y.filter,y},toRGBA8:function(d){const f=d.width,h=d.height;if(d.tabs.acTL==null)return[e(d.data,f,h,d).buffer];const p=[];d.frames[0].data==null&&(d.frames[0].data=d.data);const m=f*h*4,g=new Uint8Array(m),y=new Uint8Array(m),b=new Uint8Array(m);for(let C=0;C<d.frames.length;C++){const _=d.frames[C],x=_.rect.x,I=_.rect.y,k=_.rect.width,T=_.rect.height,P=e(_.data,k,T,d);if(C!=0)for(var S=0;S<m;S++)b[S]=g[S];if(_.blend==0?c(P,k,T,g,f,h,x,I,0):_.blend==1&&c(P,k,T,g,f,h,x,I,1),p.push(g.buffer.slice(0)),_.dispose!=0){if(_.dispose==1)c(y,k,T,g,f,h,x,I,0);else if(_.dispose==2)for(S=0;S<m;S++)g[S]=b[S]}}return p},_paeth:a,_copyTile:c,_bin:t}})();(function(){const{_copyTile:t}=Ys,{_bin:e}=Ys,n=Ys._paeth;var r={table:(function(){const k=new Uint32Array(256);for(let T=0;T<256;T++){let P=T;for(let O=0;O<8;O++)1&P?P=3988292384^P>>>1:P>>>=1;k[T]=P}return k})(),update(k,T,P,O){for(let D=0;D<O;D++)k=r.table[255&(k^T[P+D])]^k>>>8;return k},crc:(k,T,P)=>4294967295^r.update(4294967295,k,T,P)};function i(k,T,P,O){T[P]+=k[0]*O>>4,T[P+1]+=k[1]*O>>4,T[P+2]+=k[2]*O>>4,T[P+3]+=k[3]*O>>4}function s(k){return Math.max(0,Math.min(255,k))}function o(k,T){const P=k[0]-T[0],O=k[1]-T[1],D=k[2]-T[2],F=k[3]-T[3];return P*P+O*O+D*D+F*F}function a(k,T,P,O,D,F,B){B==null&&(B=1);const N=O.length,M=[];for(var R=0;R<N;R++){const J=O[R];M.push([J>>>0&255,J>>>8&255,J>>>16&255,J>>>24&255])}for(R=0;R<N;R++){let J=4294967295;for(var H=0,z=0;z<N;z++){var V=o(M[R],M[z]);z!=R&&V<J&&(J=V,H=z)}}const X=new Uint32Array(D.buffer),Z=new Int16Array(T*P*4),te=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(R=0;R<te.length;R++)te[R]=255*((te[R]+.5)/16-.5);for(let J=0;J<P;J++)for(let xe=0;xe<T;xe++){var ne;R=4*(J*T+xe),B!=2?ne=[s(k[R]+Z[R]),s(k[R+1]+Z[R+1]),s(k[R+2]+Z[R+2]),s(k[R+3]+Z[R+3])]:(V=te[4*(3&J)+(3&xe)],ne=[s(k[R]+V),s(k[R+1]+V),s(k[R+2]+V),s(k[R+3]+V)]),H=0;let Le=16777215;for(z=0;z<N;z++){const Be=o(ne,M[z]);Be<Le&&(Le=Be,H=z)}const he=M[H],ke=[ne[0]-he[0],ne[1]-he[1],ne[2]-he[2],ne[3]-he[3]];B==1&&(xe!=T-1&&i(ke,Z,R+4,7),J!=P-1&&(xe!=0&&i(ke,Z,R+4*T-4,3),i(ke,Z,R+4*T,5),xe!=T-1&&i(ke,Z,R+4*T+4,1))),F[R>>2]=H,X[R>>2]=O[H]}}function l(k,T,P,O,D){D==null&&(D={});const{crc:F}=r,B=e.writeUint,N=e.writeUshort,M=e.writeASCII;let R=8;const H=k.frames.length>1;let z,V=!1,X=33+(H?20:0);if(D.sRGB!=null&&(X+=13),D.pHYs!=null&&(X+=21),D.iCCP!=null&&(z=pako.deflate(D.iCCP),X+=21+z.length+4),k.ctype==3){for(var Z=k.plte.length,te=0;te<Z;te++)k.plte[te]>>>24!=255&&(V=!0);X+=8+3*Z+4+(V?8+1*Z+4:0)}for(var ne=0;ne<k.frames.length;ne++)H&&(X+=38),X+=(he=k.frames[ne]).cimg.length+12,ne!=0&&(X+=4);X+=12;const J=new Uint8Array(X),xe=[137,80,78,71,13,10,26,10];for(te=0;te<8;te++)J[te]=xe[te];if(B(J,R,13),R+=4,M(J,R,"IHDR"),R+=4,B(J,R,T),R+=4,B(J,R,P),R+=4,J[R]=k.depth,R++,J[R]=k.ctype,R++,J[R]=0,R++,J[R]=0,R++,J[R]=0,R++,B(J,R,F(J,R-17,17)),R+=4,D.sRGB!=null&&(B(J,R,1),R+=4,M(J,R,"sRGB"),R+=4,J[R]=D.sRGB,R++,B(J,R,F(J,R-5,5)),R+=4),D.iCCP!=null){const ke=13+z.length;B(J,R,ke),R+=4,M(J,R,"iCCP"),R+=4,M(J,R,"ICC profile"),R+=11,R+=2,J.set(z,R),R+=z.length,B(J,R,F(J,R-(ke+4),ke+4)),R+=4}if(D.pHYs!=null&&(B(J,R,9),R+=4,M(J,R,"pHYs"),R+=4,B(J,R,D.pHYs[0]),R+=4,B(J,R,D.pHYs[1]),R+=4,J[R]=D.pHYs[2],R++,B(J,R,F(J,R-13,13)),R+=4),H&&(B(J,R,8),R+=4,M(J,R,"acTL"),R+=4,B(J,R,k.frames.length),R+=4,B(J,R,D.loop!=null?D.loop:0),R+=4,B(J,R,F(J,R-12,12)),R+=4),k.ctype==3){for(B(J,R,3*(Z=k.plte.length)),R+=4,M(J,R,"PLTE"),R+=4,te=0;te<Z;te++){const ke=3*te,Be=k.plte[te],je=255&Be,Fe=Be>>>8&255,ve=Be>>>16&255;J[R+ke+0]=je,J[R+ke+1]=Fe,J[R+ke+2]=ve}if(R+=3*Z,B(J,R,F(J,R-3*Z-4,3*Z+4)),R+=4,V){for(B(J,R,Z),R+=4,M(J,R,"tRNS"),R+=4,te=0;te<Z;te++)J[R+te]=k.plte[te]>>>24&255;R+=Z,B(J,R,F(J,R-Z-4,Z+4)),R+=4}}let Le=0;for(ne=0;ne<k.frames.length;ne++){var he=k.frames[ne];H&&(B(J,R,26),R+=4,M(J,R,"fcTL"),R+=4,B(J,R,Le++),R+=4,B(J,R,he.rect.width),R+=4,B(J,R,he.rect.height),R+=4,B(J,R,he.rect.x),R+=4,B(J,R,he.rect.y),R+=4,N(J,R,O[ne]),R+=2,N(J,R,1e3),R+=2,J[R]=he.dispose,R++,J[R]=he.blend,R++,B(J,R,F(J,R-30,30)),R+=4);const ke=he.cimg;B(J,R,(Z=ke.length)+(ne==0?0:4)),R+=4;const Be=R;M(J,R,ne==0?"IDAT":"fdAT"),R+=4,ne!=0&&(B(J,R,Le++),R+=4),J.set(ke,R),R+=Z,B(J,R,F(J,Be,R-Be)),R+=4}return B(J,R,0),R+=4,M(J,R,"IEND"),R+=4,B(J,R,F(J,R-4,4)),R+=4,J.buffer}function c(k,T,P){for(let O=0;O<k.frames.length;O++){const D=k.frames[O];D.rect.width;const F=D.rect.height,B=new Uint8Array(F*D.bpl+F);D.cimg=h(D.img,F,D.bpp,D.bpl,B,T,P)}}function u(k,T,P,O,D){const F=D[0],B=D[1],N=D[2],M=D[3],R=D[4],H=D[5];let z=6,V=8,X=255;for(var Z=0;Z<k.length;Z++){const qe=new Uint8Array(k[Z]);for(var te=qe.length,ne=0;ne<te;ne+=4)X&=qe[ne+3]}const J=X!=255,xe=(function(Te,ze,ot,ct,pt,$t){const Rt=[];for(var Tt=0;Tt<Te.length;Tt++){const Ht=new Uint8Array(Te[Tt]),zt=new Uint32Array(Ht.buffer);var Ot;let tn=0,Cn=0,Nn=ze,Yt=ot,Gt=ct?1:0;if(Tt!=0){const nn=$t||ct||Tt==1||Rt[Tt-2].dispose!=0?1:2;let Jt=0,zn=1e9;for(let gi=0;gi<nn;gi++){var He=new Uint8Array(Te[Tt-1-gi]);const ws=new Uint32Array(Te[Tt-1-gi]);let Mt=ze,Fn=ot,ar=-1,yi=-1;for(let er=0;er<ot;er++)for(let bi=0;bi<ze;bi++)zt[yt=er*ze+bi]!=ws[yt]&&(bi<Mt&&(Mt=bi),bi>ar&&(ar=bi),er<Fn&&(Fn=er),er>yi&&(yi=er));ar==-1&&(Mt=Fn=ar=yi=0),pt&&((1&Mt)==1&&Mt--,(1&Fn)==1&&Fn--);const lr=(ar-Mt+1)*(yi-Fn+1);lr<zn&&(zn=lr,Jt=gi,tn=Mt,Cn=Fn,Nn=ar-Mt+1,Yt=yi-Fn+1)}He=new Uint8Array(Te[Tt-1-Jt]),Jt==1&&(Rt[Tt-1].dispose=2),Ot=new Uint8Array(Nn*Yt*4),t(He,ze,ot,Ot,Nn,Yt,-tn,-Cn,0),Gt=t(Ht,ze,ot,Ot,Nn,Yt,-tn,-Cn,3)?1:0,Gt==1?f(Ht,ze,ot,Ot,{x:tn,y:Cn,width:Nn,height:Yt}):t(Ht,ze,ot,Ot,Nn,Yt,-tn,-Cn,0)}else Ot=Ht.slice(0);Rt.push({rect:{x:tn,y:Cn,width:Nn,height:Yt},img:Ot,blend:Gt,dispose:0})}if(ct)for(Tt=0;Tt<Rt.length;Tt++){if((Kt=Rt[Tt]).blend==1)continue;const Ht=Kt.rect,zt=Rt[Tt-1].rect,tn=Math.min(Ht.x,zt.x),Cn=Math.min(Ht.y,zt.y),Nn={x:tn,y:Cn,width:Math.max(Ht.x+Ht.width,zt.x+zt.width)-tn,height:Math.max(Ht.y+Ht.height,zt.y+zt.height)-Cn};Rt[Tt-1].dispose=1,Tt-1!=0&&d(Te,ze,ot,Rt,Tt-1,Nn,pt),d(Te,ze,ot,Rt,Tt,Nn,pt)}let ut=0;if(Te.length!=1)for(var yt=0;yt<Rt.length;yt++){var Kt;ut+=(Kt=Rt[yt]).rect.width*Kt.rect.height}return Rt})(k,T,P,F,B,N),Le={},he=[],ke=[];if(O!=0){const qe=[];for(ne=0;ne<xe.length;ne++)qe.push(xe[ne].img.buffer);const Te=(function(pt){let $t=0;for(var Rt=0;Rt<pt.length;Rt++)$t+=pt[Rt].byteLength;const Tt=new Uint8Array($t);let Ot=0;for(Rt=0;Rt<pt.length;Rt++){const He=new Uint8Array(pt[Rt]),ut=He.length;for(let yt=0;yt<ut;yt+=4){let Kt=He[yt],Ht=He[yt+1],zt=He[yt+2];const tn=He[yt+3];tn==0&&(Kt=Ht=zt=0),Tt[Ot+yt]=Kt,Tt[Ot+yt+1]=Ht,Tt[Ot+yt+2]=zt,Tt[Ot+yt+3]=tn}Ot+=ut}return Tt.buffer})(qe),ze=m(Te,O);for(ne=0;ne<ze.plte.length;ne++)he.push(ze.plte[ne].est.rgba);let ot=0;for(ne=0;ne<xe.length;ne++){const ct=(je=xe[ne]).img.length;var Be=new Uint8Array(ze.inds.buffer,ot>>2,ct>>2);ke.push(Be);const pt=new Uint8Array(ze.abuf,ot,ct);H&&a(je.img,je.rect.width,je.rect.height,he,pt,Be),je.img.set(pt),ot+=ct}}else for(Z=0;Z<xe.length;Z++){var je=xe[Z];const qe=new Uint32Array(je.img.buffer);var Fe=je.rect.width;for(te=qe.length,Be=new Uint8Array(te),ke.push(Be),ne=0;ne<te;ne++){const Te=qe[ne];if(ne!=0&&Te==qe[ne-1])Be[ne]=Be[ne-1];else if(ne>Fe&&Te==qe[ne-Fe])Be[ne]=Be[ne-Fe];else{let ze=Le[Te];if(ze==null&&(Le[Te]=ze=he.length,he.push(Te),he.length>=300))break;Be[ne]=ze}}}const ve=he.length;for(ve<=256&&R==0&&(V=ve<=2?1:ve<=4?2:ve<=16?4:8,V=Math.max(V,M)),Z=0;Z<xe.length;Z++){(je=xe[Z]).rect.x,je.rect.y,Fe=je.rect.width;const qe=je.rect.height;let Te=je.img;new Uint32Array(Te.buffer);let ze=4*Fe,ot=4;if(ve<=256&&R==0){ze=Math.ceil(V*Fe/8);var Ie=new Uint8Array(ze*qe);const ct=ke[Z];for(let pt=0;pt<qe;pt++){ne=pt*ze;const $t=pt*Fe;if(V==8)for(var Oe=0;Oe<Fe;Oe++)Ie[ne+Oe]=ct[$t+Oe];else if(V==4)for(Oe=0;Oe<Fe;Oe++)Ie[ne+(Oe>>1)]|=ct[$t+Oe]<<4-4*(1&Oe);else if(V==2)for(Oe=0;Oe<Fe;Oe++)Ie[ne+(Oe>>2)]|=ct[$t+Oe]<<6-2*(3&Oe);else if(V==1)for(Oe=0;Oe<Fe;Oe++)Ie[ne+(Oe>>3)]|=ct[$t+Oe]<<7-1*(7&Oe)}Te=Ie,z=3,ot=1}else if(J==0&&xe.length==1){Ie=new Uint8Array(Fe*qe*3);const ct=Fe*qe;for(ne=0;ne<ct;ne++){const pt=3*ne,$t=4*ne;Ie[pt]=Te[$t],Ie[pt+1]=Te[$t+1],Ie[pt+2]=Te[$t+2]}Te=Ie,z=2,ot=3,ze=3*Fe}je.img=Te,je.bpl=ze,je.bpp=ot}return{ctype:z,depth:V,plte:he,frames:xe}}function d(k,T,P,O,D,F,B){const N=Uint8Array,M=Uint32Array,R=new N(k[D-1]),H=new M(k[D-1]),z=D+1<k.length?new N(k[D+1]):null,V=new N(k[D]),X=new M(V.buffer);let Z=T,te=P,ne=-1,J=-1;for(let Le=0;Le<F.height;Le++)for(let he=0;he<F.width;he++){const ke=F.x+he,Be=F.y+Le,je=Be*T+ke,Fe=X[je];Fe==0||O[D-1].dispose==0&&H[je]==Fe&&(z==null||z[4*je+3]!=0)||(ke<Z&&(Z=ke),ke>ne&&(ne=ke),Be<te&&(te=Be),Be>J&&(J=Be))}ne==-1&&(Z=te=ne=J=0),B&&((1&Z)==1&&Z--,(1&te)==1&&te--),F={x:Z,y:te,width:ne-Z+1,height:J-te+1};const xe=O[D];xe.rect=F,xe.blend=1,xe.img=new Uint8Array(F.width*F.height*4),O[D-1].dispose==0?(t(R,T,P,xe.img,F.width,F.height,-F.x,-F.y,0),f(V,T,P,xe.img,F)):t(V,T,P,xe.img,F.width,F.height,-F.x,-F.y,0)}function f(k,T,P,O,D){t(k,T,P,O,D.width,D.height,-D.x,-D.y,2)}function h(k,T,P,O,D,F,B){const N=[];let M,R=[0,1,2,3,4];F!=-1?R=[F]:(T*O>5e5||P==1)&&(R=[0]),B&&(M={level:0});const H=Ime;for(var z=0;z<R.length;z++){for(let Z=0;Z<T;Z++)p(D,k,Z,O,P,R[z]);N.push(H.deflate(D,M))}let V,X=1e9;for(z=0;z<N.length;z++)N[z].length<X&&(V=z,X=N[z].length);return N[V]}function p(k,T,P,O,D,F){const B=P*O;let N=B+P;if(k[N]=F,N++,F==0)if(O<500)for(var M=0;M<O;M++)k[N+M]=T[B+M];else k.set(new Uint8Array(T.buffer,B,O),N);else if(F==1){for(M=0;M<D;M++)k[N+M]=T[B+M];for(M=D;M<O;M++)k[N+M]=T[B+M]-T[B+M-D]+256&255}else if(P==0){for(M=0;M<D;M++)k[N+M]=T[B+M];if(F==2)for(M=D;M<O;M++)k[N+M]=T[B+M];if(F==3)for(M=D;M<O;M++)k[N+M]=T[B+M]-(T[B+M-D]>>1)+256&255;if(F==4)for(M=D;M<O;M++)k[N+M]=T[B+M]-n(T[B+M-D],0,0)+256&255}else{if(F==2)for(M=0;M<O;M++)k[N+M]=T[B+M]+256-T[B+M-O]&255;if(F==3){for(M=0;M<D;M++)k[N+M]=T[B+M]+256-(T[B+M-O]>>1)&255;for(M=D;M<O;M++)k[N+M]=T[B+M]+256-(T[B+M-O]+T[B+M-D]>>1)&255}if(F==4){for(M=0;M<D;M++)k[N+M]=T[B+M]+256-n(0,T[B+M-O],0)&255;for(M=D;M<O;M++)k[N+M]=T[B+M]+256-n(T[B+M-D],T[B+M-O],T[B+M-D-O])&255}}}function m(k,T){const P=new Uint8Array(k),O=P.slice(0),D=new Uint32Array(O.buffer),F=g(O,T),B=F[0],N=F[1],M=P.length,R=new Uint8Array(M>>2);let H;if(P.length<2e7)for(var z=0;z<M;z+=4)H=y(B,V=P[z]*(1/255),X=P[z+1]*(1/255),Z=P[z+2]*(1/255),te=P[z+3]*(1/255)),R[z>>2]=H.ind,D[z>>2]=H.est.rgba;else for(z=0;z<M;z+=4){var V=P[z]*.00392156862745098,X=P[z+1]*(1/255),Z=P[z+2]*(1/255),te=P[z+3]*(1/255);for(H=B;H.left;)H=b(H.est,V,X,Z,te)<=0?H.left:H.right;R[z>>2]=H.ind,D[z>>2]=H.est.rgba}return{abuf:O.buffer,inds:R,plte:N}}function g(k,T,P){P==null&&(P=1e-4);const O=new Uint32Array(k.buffer),D={i0:0,i1:k.length,bst:null,est:null,tdst:0,left:null,right:null};D.bst=_(k,D.i0,D.i1),D.est=x(D.bst);const F=[D];for(;F.length<T;){let N=0,M=0;for(var B=0;B<F.length;B++)F[B].est.L>N&&(N=F[B].est.L,M=B);if(N<P)break;const R=F[M],H=S(k,O,R.i0,R.i1,R.est.e,R.est.eMq255);if(R.i0>=H||R.i1<=H){R.est.L=0;continue}const z={i0:R.i0,i1:H,bst:null,est:null,tdst:0,left:null,right:null};z.bst=_(k,z.i0,z.i1),z.est=x(z.bst);const V={i0:H,i1:R.i1,bst:null,est:null,tdst:0,left:null,right:null};for(V.bst={R:[],m:[],N:R.bst.N-z.bst.N},B=0;B<16;B++)V.bst.R[B]=R.bst.R[B]-z.bst.R[B];for(B=0;B<4;B++)V.bst.m[B]=R.bst.m[B]-z.bst.m[B];V.est=x(V.bst),R.left=z,R.right=V,F[M]=z,F.push(V)}for(F.sort(((N,M)=>M.bst.N-N.bst.N)),B=0;B<F.length;B++)F[B].ind=B;return[D,F]}function y(k,T,P,O,D){if(k.left==null)return k.tdst=(function(z,V,X,Z,te){const ne=V-z[0],J=X-z[1],xe=Z-z[2],Le=te-z[3];return ne*ne+J*J+xe*xe+Le*Le})(k.est.q,T,P,O,D),k;const F=b(k.est,T,P,O,D);let B=k.left,N=k.right;F>0&&(B=k.right,N=k.left);const M=y(B,T,P,O,D);if(M.tdst<=F*F)return M;const R=y(N,T,P,O,D);return R.tdst<M.tdst?R:M}function b(k,T,P,O,D){const{e:F}=k;return F[0]*T+F[1]*P+F[2]*O+F[3]*D-k.eMq}function S(k,T,P,O,D,F){for(O-=4;P<O;){for(;C(k,P,D)<=F;)P+=4;for(;C(k,O,D)>F;)O-=4;if(P>=O)break;const B=T[P>>2];T[P>>2]=T[O>>2],T[O>>2]=B,P+=4,O-=4}for(;C(k,P,D)>F;)P-=4;return P+4}function C(k,T,P){return k[T]*P[0]+k[T+1]*P[1]+k[T+2]*P[2]+k[T+3]*P[3]}function _(k,T,P){const O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],D=[0,0,0,0],F=P-T>>2;for(let B=T;B<P;B+=4){const N=k[B]*.00392156862745098,M=k[B+1]*(1/255),R=k[B+2]*(1/255),H=k[B+3]*(1/255);D[0]+=N,D[1]+=M,D[2]+=R,D[3]+=H,O[0]+=N*N,O[1]+=N*M,O[2]+=N*R,O[3]+=N*H,O[5]+=M*M,O[6]+=M*R,O[7]+=M*H,O[10]+=R*R,O[11]+=R*H,O[15]+=H*H}return O[4]=O[1],O[8]=O[2],O[9]=O[6],O[12]=O[3],O[13]=O[7],O[14]=O[11],{R:O,m:D,N:F}}function x(k){const{R:T}=k,{m:P}=k,{N:O}=k,D=P[0],F=P[1],B=P[2],N=P[3],M=O==0?0:1/O,R=[T[0]-D*D*M,T[1]-D*F*M,T[2]-D*B*M,T[3]-D*N*M,T[4]-F*D*M,T[5]-F*F*M,T[6]-F*B*M,T[7]-F*N*M,T[8]-B*D*M,T[9]-B*F*M,T[10]-B*B*M,T[11]-B*N*M,T[12]-N*D*M,T[13]-N*F*M,T[14]-N*B*M,T[15]-N*N*M],H=R,z=I;let V=[Math.random(),Math.random(),Math.random(),Math.random()],X=0,Z=0;if(O!=0)for(let ne=0;ne<16&&(V=z.multVec(H,V),Z=Math.sqrt(z.dot(V,V)),V=z.sml(1/Z,V),!(ne!=0&&Math.abs(Z-X)<1e-9));ne++)X=Z;const te=[D*M,F*M,B*M,N*M];return{Cov:R,q:te,e:V,L:X,eMq255:z.dot(z.sml(255,te),V),eMq:z.dot(V,te),rgba:(Math.round(255*te[3])<<24|Math.round(255*te[2])<<16|Math.round(255*te[1])<<8|Math.round(255*te[0])<<0)>>>0}}var I={multVec:(k,T)=>[k[0]*T[0]+k[1]*T[1]+k[2]*T[2]+k[3]*T[3],k[4]*T[0]+k[5]*T[1]+k[6]*T[2]+k[7]*T[3],k[8]*T[0]+k[9]*T[1]+k[10]*T[2]+k[11]*T[3],k[12]*T[0]+k[13]*T[1]+k[14]*T[2]+k[15]*T[3]],dot:(k,T)=>k[0]*T[0]+k[1]*T[1]+k[2]*T[2]+k[3]*T[3],sml:(k,T)=>[k*T[0],k*T[1],k*T[2],k*T[3]]};Ys.encode=function(T,P,O,D,F,B,N){D==null&&(D=0),N==null&&(N=!1);const M=u(T,P,O,D,[!1,!1,!1,0,N,!1]);return c(M,-1),l(M,P,O,F,B)},Ys.encodeLL=function(T,P,O,D,F,B,N,M){const R={ctype:0+(D==1?0:2)+(F==0?0:4),depth:B,frames:[]},H=(D+F)*B,z=H*P;for(let V=0;V<T.length;V++)R.frames.push({rect:{x:0,y:0,width:P,height:O},img:new Uint8Array(T[V]),blend:0,dispose:1,bpp:Math.ceil(H/8),bpl:Math.ceil(z/8)});return c(R,0,!0),l(R,P,O,N,M)},Ys.encode.compress=u,Ys.encode.dither=a,Ys.quantize=m,Ys.quantize.getKDtree=g,Ys.quantize.getNearest=y})();const fB={toArrayBuffer(t,e){const n=t.width,r=t.height,i=n<<2,s=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(s.data.buffer),a=(32*n+31)/32<<2,l=a*r,c=122+l,u=new ArrayBuffer(c),d=new DataView(u),f=1<<20;let h,p,m,g,y=f,b=0,S=0,C=0;function _(k){d.setUint16(S,k,!0),S+=2}function x(k){d.setUint32(S,k,!0),S+=4}function I(k){S+=k}_(19778),x(c),I(4),x(122),x(108),x(n),x(-r>>>0),_(1),_(32),x(3),x(l),x(2835),x(2835),I(8),x(16711680),x(65280),x(255),x(4278190080),x(1466527264),(function k(){for(;b<r&&y>0;){for(g=122+b*a,h=0;h<i;)y--,p=o[C++],m=p>>>24,d.setUint32(g+h,p<<8|m),h+=4;b++}C<o.length?(y=f,setTimeout(k,fB._dly)):e(u)})()},toBlob(t,e){this.toArrayBuffer(t,(n=>{e(new Blob([n],{type:"image/bmp"}))}))},_dly:9};var Wi={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Ome={[Wi.CHROME]:16384,[Wi.FIREFOX]:11180,[Wi.DESKTOP_SAFARI]:16384,[Wi.IE]:8192,[Wi.IOS]:4096,[Wi.ETC]:8192};const hC=typeof window<"u",hB=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,bb=hC&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Mme=(hC||hB)&&(bb&&bb.getOriginalSymbol(window,"File")||typeof File<"u"&&File),pB=(hC||hB)&&(bb&&bb.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function pC(t,e,n=Date.now()){return new Promise((r=>{const i=t.split(","),s=i[0].match(/:(.*?);/)[1],o=globalThis.atob(i[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const c=new Blob([l],{type:s});c.name=e,c.lastModified=n,r(c)}))}function mB(t){return new Promise(((e,n)=>{const r=new pB;r.onload=()=>e(r.result),r.onerror=i=>n(i),r.readAsDataURL(t)}))}function gB(t){return new Promise(((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=i=>n(i),r.src=t}))}function Ru(){if(Ru.cachedResult!==void 0)return Ru.cachedResult;let t=Wi.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Wi.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Wi.IOS:/Safari/i.test(e)?t=Wi.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Wi.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Wi.IE),Ru.cachedResult=t,Ru.cachedResult}function yB(t,e){const n=Ru(),r=Ome[n];let i=t,s=e,o=i*s;const a=i>s?s/i:i/s;for(;o>r*r;){const l=(r+i)/2,c=(r+s)/2;l<c?(s=c,i=c*a):(s=l*a,i=l),o=i*s}return{width:i,height:s}}function Nw(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function bB(t,e){const{width:n,height:r}=yB(t.width,t.height),[i,s]=Nw(n,r);return e&&/jpe?g/.test(e)&&(s.fillStyle="white",s.fillRect(0,0,i.width,i.height)),s.drawImage(t,0,0,i.width,i.height),i}function S0(){return S0.cachedResult!==void 0||(S0.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),S0.cachedResult}function wb(t,e={}){return new Promise((function(n,r){let i,s;var o=function(){try{return s=bB(i,e.fileType||t.type),n([i,s])}catch(l){return r(l)}},a=function(l){try{var c=function(u){try{throw u}catch(d){return r(d)}};try{let u;return mB(t).then((function(d){try{return u=d,gB(u).then((function(f){try{return i=f,(function(){try{return o()}catch(h){return r(h)}})()}catch(h){return c(h)}}),c)}catch(f){return c(f)}}),c)}catch(u){c(u)}}catch(u){return r(u)}};try{if(S0()||[Wi.DESKTOP_SAFARI,Wi.MOBILE_SAFARI].includes(Ru()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then((function(l){try{return i=l,o()}catch{return a()}}),a)}catch{a()}}))}function vb(t,e,n,r,i=1){return new Promise((function(s,o){let a;if(e==="image/png"){let c,u,d;return c=t.getContext("2d"),{data:u}=c.getImageData(0,0,t.width,t.height),d=Ys.encode([u.buffer],t.width,t.height,4096*i),a=new Blob([d],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let c=function(){return l.call(this)};if(e==="image/bmp")return new Promise((u=>fB.toBlob(t,u))).then((function(u){try{return a=u,a.name=n,a.lastModified=r,c.call(this)}catch(d){return o(d)}}).bind(this),o);{let u=function(){return c.call(this)};if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:i}).then((function(d){try{return a=d,a.name=n,a.lastModified=r,u.call(this)}catch(f){return o(f)}}).bind(this),o);{let d;return d=t.toDataURL(e,i),pC(d,n,r).then((function(f){try{return a=f,u.call(this)}catch(h){return o(h)}}).bind(this),o)}}}function l(){return s(a)}}))}function No(t){t.width=0,t.height=0}function cf(){return new Promise((function(t,e){let n,r,i,s;return cf.cachedResult!==void 0?t(cf.cachedResult):pC("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(o){try{return n=o,wb(n).then((function(a){try{return r=a[1],vb(r,n.type,n.name,n.lastModified).then((function(l){try{return i=l,No(r),wb(i).then((function(c){try{return s=c[0],cf.cachedResult=s.width===1&&s.height===2,t(cf.cachedResult)}catch(u){return e(u)}}),e)}catch(c){return e(c)}}),e)}catch(l){return e(l)}}),e)}catch(a){return e(a)}}),e)}))}function wB(t){return new Promise(((e,n)=>{const r=new pB;r.onload=i=>{const s=new DataView(i.target.result);if(s.getUint16(0,!1)!=65496)return e(-2);const o=s.byteLength;let a=2;for(;a<o;){if(s.getUint16(a+2,!1)<=8)return e(-1);const l=s.getUint16(a,!1);if(a+=2,l==65505){if(s.getUint32(a+=2,!1)!=1165519206)return e(-1);const c=s.getUint16(a+=6,!1)==18761;a+=s.getUint32(a+4,c);const u=s.getUint16(a,c);a+=2;for(let d=0;d<u;d++)if(s.getUint16(a+12*d,c)==274)return e(s.getUint16(a+12*d+8,c))}else{if((65280&l)!=65280)break;a+=s.getUint16(a,!1)}}return e(-1)},r.onerror=i=>n(i),r.readAsArrayBuffer(t)}))}function vB(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:i}=e;let s,o=t;return isFinite(i)&&(n>i||r>i)&&([o,s]=Nw(n,r),n>r?(o.width=i,o.height=r/n*i):(o.width=n/r*i,o.height=i),s.drawImage(t,0,0,o.width,o.height),No(t)),o}function xB(t,e){const{width:n}=t,{height:r}=t,[i,s]=Nw(n,r);switch(e>4&&e<9?(i.width=r,i.height=n):(i.width=n,i.height=r),e){case 2:s.transform(-1,0,0,1,n,0);break;case 3:s.transform(-1,0,0,-1,n,r);break;case 4:s.transform(1,0,0,-1,0,r);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,r,0);break;case 7:s.transform(0,-1,-1,0,r,n);break;case 8:s.transform(0,-1,1,0,0,n)}return s.drawImage(t,0,0,n,r),No(t),i}function kO(t,e,n=0){return new Promise((function(r,i){let s,o,a,l,c,u,d,f,h,p,m,g,y,b,S,C,_,x,I,k;function T(O=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;s+=O,e.onProgress(Math.min(s,100))}function P(O){if(e.signal&&e.signal.aborted)throw e.signal.reason;s=Math.min(Math.max(O,s),100),e.onProgress(s)}return s=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,T(),wb(t,e).then((function(O){try{return[,l]=O,T(),c=vB(l,e),T(),new Promise((function(D,F){var B;if(!(B=e.exifOrientation))return wB(t).then((function(M){try{return B=M,N.call(this)}catch(R){return F(R)}}).bind(this),F);function N(){return D(B)}return N.call(this)})).then((function(D){try{return u=D,T(),cf().then((function(F){try{return d=F?c:xB(c,u),T(),f=e.initialQuality||1,h=e.fileType||t.type,vb(d,h,t.name,t.lastModified,f).then((function(B){try{{let M=function(){if(o--&&(S>a||S>y)){let H,z;return H=k?.95*I.width:I.width,z=k?.95*I.height:I.height,[_,x]=Nw(H,z),x.drawImage(I,0,0,H,z),f*=h==="image/png"?.85:.95,vb(_,h,t.name,t.lastModified,f).then((function(V){try{return C=V,No(I),I=_,S=C.size,P(Math.min(99,Math.floor((b-S)/(b-a)*100))),M}catch(X){return i(X)}}),i)}return[1]},R=function(){return No(I),No(_),No(c),No(d),No(l),P(100),r(C)};if(p=B,T(),m=p.size>a,g=p.size>t.size,!m&&!g)return P(100),r(p);var N;return y=t.size,b=p.size,S=b,I=d,k=!e.alwaysKeepResolution&&m,(N=(function(H){for(;H;){if(H.then)return void H.then(N,i);try{if(H.pop){if(H.length)return H.pop()?R.call(this):H;H=M}else H=H.call(this)}catch(z){return i(z)}}}).bind(this))(M)}}catch(M){return i(M)}}).bind(this),i)}catch(B){return i(B)}}).bind(this),i)}catch(F){return i(F)}}).bind(this),i)}catch(D){return i(D)}}).bind(this),i)}))}const Nme=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let k2;function Rme(t,e){return new Promise(((n,r)=>{k2||(k2=(function(o){const a=[];return a.push(o),URL.createObjectURL(new Blob(a))})(Nme));const i=new Worker(k2);i.addEventListener("message",(function(o){if(e.signal&&e.signal.aborted)i.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void i.terminate();n(o.data.file),i.terminate()}else e.onProgress(o.data.progress)})),i.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",(()=>{r(e.signal.reason),i.terminate()})),i.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})}))}function ni(t,e){return new Promise((function(n,r){let i,s,o,a,l,c;if(i={...e},o=0,{onProgress:a}=i,i.maxSizeMB=i.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof i.useWebWorker!="boolean"||i.useWebWorker,delete i.useWebWorker,i.onProgress=h=>{o=h,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof Mme))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(c=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||c)return kO(t,i).then((function(h){try{return s=h,f.call(this)}catch(p){return r(p)}}).bind(this),r);var u=(function(){try{return f.call(this)}catch(h){return r(h)}}).bind(this),d=function(h){try{return kO(t,i).then((function(p){try{return s=p,u()}catch(m){return r(m)}}),r)}catch(p){return r(p)}};try{return i.libURL=i.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Rme(t,i).then((function(h){try{return s=h,u()}catch{return d()}}),d)}catch{d()}function f(){try{s.name=t.name,s.lastModified=t.lastModified}catch{}try{i.preserveExif&&t.type==="image/jpeg"&&(!i.fileType||i.fileType&&i.fileType===t.type)&&(s=dB(t,s))}catch{}return n(s)}}))}ni.getDataUrlFromFile=mB,ni.getFilefromDataUrl=pC,ni.loadImage=gB,ni.drawImageInCanvas=bB,ni.drawFileInCanvas=wb,ni.canvasToFile=vb,ni.getExifOrientation=wB,ni.handleMaxWidthOrHeight=vB,ni.followExifOrientation=xB,ni.cleanupCanvasMemory=No,ni.isAutoOrientationInBrowser=cf,ni.approximateBelowMaximumCanvasSizeOfBrowser=yB,ni.copyExifWithoutOrientation=dB,ni.getBrowserName=Ru,ni.version="2.0.2";function Mo(t,...e){}function Js(t,...e){}function SB(t,e,n){if(t.size>=e.size)return{file:e,wasCompressed:!1};const r=e.name.replace(/\.[^.]+$/,"");return{file:new File([t],`${r}_compressed.mp4`,{type:"video/mp4"}),wasCompressed:!0}}function Dme(t,e,n){return ln.value?(n&&n(0),{file:t,wasCompressed:!1,wasSkipped:!0,aborted:!0}):null}function Lme(t,e){return!!(!t||typeof t=="object"&&t&&"skip"in t&&t.skip)}function Bme(t,e=200*1024){return t.size<=e}function Fme(t){return t.type.startsWith("video/")}class kB{onProgress;context;constructor(e){this.context=e}setProgressCallback(e){this.onProgress=e}checkAbort(e){return Dme(e,this.context,this.onProgress)}resetProgress(){this.onProgress&&this.onProgress(0)}updateProgress(e){this.onProgress&&this.onProgress(Math.round(e))}log(...e){Mo(this.context,...e)}}async function $me(){if(!(typeof VideoEncoder<"u"&&typeof VideoDecoder<"u")||/Android.*Firefox/.test(navigator.userAgent))return!1;try{const r=(await tS()).includes("opus");return Mo("MediaBunnyCompression","MediaBunny supported - Video encoding available, Opus codec available:",r),!0}catch{return!0}}async function zme(){if(typeof AudioEncoder>"u")return!1;try{const t={codec:"opus",sampleRate:48e3,numberOfChannels:2,bitrate:128e3};return(await AudioEncoder.isConfigSupported(t)).supported||!1}catch{return!1}}async function Ume(t,e,n){if(typeof AudioEncoder>"u")return!1;try{const r={codec:"opus",sampleRate:t,numberOfChannels:e,bitrate:n};return(await AudioEncoder.isConfigSupported(r)).supported||!1}catch{return!1}}function Jh(t,e,n=!1){if(t)try{t.dispose()}catch{}if(e&&n)try{e.finalize()}catch{}}class Hme extends kB{constructor(e,n,r){super("MediaBunnyCompression"),this.parseAudioBitrate=e,this.mergeVideoAndAudioWithFFmpeg=n,this.compressWithFFmpeg=r}abortController=null;abort(){this.log("Abort requested"),this.resetProgress(),this.abortController&&(this.log("Aborting Mediabunny conversion"),this.abortController.abort(),this.abortController=null)}async cleanup(){this.abortController=null}async findSupportedOpusConfig(e,n,r,i){const s=Math.max(i,64e3),o=Array.from(new Set([r,48e3,24e3,e.sampleRate])).filter(l=>Number.isFinite(l)&&l>0),a=[{sampleRate:r,bitrate:i},...o.map(l=>({sampleRate:l,bitrate:s}))];for(const{sampleRate:l,bitrate:c}of a){if(!Number.isFinite(l)||l<=0||!Number.isFinite(c)||c<=0)continue;const u=Math.round(l),d=Math.round(c),f=await Ume(u,n,d);if(this.log("Opus encoding support probe:",{trackId:e.id,codec:e.codec,targetChannels:n,sampleRate:u,bitrate:d,supported:f}),f)return{sampleRate:u,bitrate:d}}return null}async validateMediabunnyAudioConfig(e,n,r){const i=new Map;let s=await zme(),o=r?null:this.parseAudioBitrate(n?.audioBitrate),a=r?null:typeof n?.audioSampleRate=="number"?n.audioSampleRate:null;if(this.log("Opus encoding supported (global check):",s),s&&e.length>0)for(const l of e){const c=n.audioChannels??l.numberOfChannels,u=n.audioSampleRate??l.sampleRate,d=r?64e3:this.parseAudioBitrate(n.audioBitrate)??128e3,f=await this.findSupportedOpusConfig(l,c,u,d);if(!f){s=!1,this.log("Opus encoder does not support requested settings; will copy audio track as-is via Mediabunny.",{trackId:l.id,preferredSampleRate:u,preferredBitrate:d,targetChannels:c});break}i.set(l.id,{sampleRate:f.sampleRate,bitrate:f.bitrate,channels:c}),(f.sampleRate!==u||f.bitrate!==d)&&this.log("Adjusted Mediabunny audio target due to encoder support limitations.",{trackId:l.id,preferredSampleRate:u,preferredBitrate:d,resolvedSampleRate:f.sampleRate,resolvedBitrate:f.bitrate}),r||(a=f.sampleRate,o=f.bitrate)}return{canEncodeOpus:s,audioConfigByTrack:i,desiredAudioSampleRate:a,desiredAudioBitrate:o}}buildConversionOptions(e,n,r,i,s,o,a,l){return{input:e,output:n,video:u=>{const d={codec:"avc",...o?{bitrate:o}:{}},f=r.maxSize;return typeof f=="number"&&Number.isFinite(f)&&(u.displayWidth>u.displayHeight?d.width=Math.min(u.displayWidth,f):d.height=Math.min(u.displayHeight,f),this.log("Applying video resize:",{originalWidth:u.displayWidth,originalHeight:u.displayHeight,maxSize:f,targetWidth:d.width,targetHeight:d.height,bitrate:o||"custom"})),d},audio:a?i&&s?{codec:"opus",bitrate:s,forceTranscode:!0}:u=>{const d=l.get(u.id),f=d?.channels??r.audioChannels??u.numberOfChannels,h=d?.sampleRate??r.audioSampleRate??u.sampleRate;this.log("Configuring audio track for compression:",{inputCodec:u.codec,inputChannels:u.numberOfChannels,inputSampleRate:u.sampleRate,targetChannels:f,targetSampleRate:h});const p=d?.bitrate??this.parseAudioBitrate(r.audioBitrate)??128e3;return{codec:"opus",forceTranscode:!0,...typeof f=="number"?{numberOfChannels:f}:{},...typeof h=="number"?{sampleRate:h}:{},bitrate:p}}:u=>{this.log("Copying audio track as-is (Opus encoding not supported):",{trackId:u.id,codec:u.codec,channels:u.numberOfChannels,sampleRate:u.sampleRate})},showWarnings:!1}}validateConversion(e,n,r,i){if(e.discardedTracks.length>0){this.log("Discarded tracks:",e.discardedTracks.map(o=>({type:o.track.type,reason:o.reason})));const s=e.discardedTracks.filter(o=>o.track.type==="video"||o.track.type==="audio");if(s.length>0&&(console.warn("[MediaBunnyCompression] Important tracks discarded:",s.map(a=>({type:a.track.type,reason:a.reason,codec:a.track.type==="audio"?a.track.codec:void 0}))),s.some(a=>a.track.type==="audio"&&a.reason==="no_encodable_target_codec")&&i))throw Js(this.context,"Mediabunny cannot encode audio for this environment, falling back to FFmpeg."),Jh(n,r,!0),new Error("mediabunny-unsupported-audio-codec")}return e.isValid?null:(Js(this.context,"Conversion is not valid:",e.discardedTracks),Jh(n,r,!0),{file:new File([],""),wasCompressed:!1,wasSkipped:!0})}async executeConversion(e,n){const r=new Promise(i=>{this.abortController.signal.addEventListener("abort",()=>{this.log("Mediabunny conversion aborted"),e.cancel().then(i)})});return await Promise.race([e.execute(),r]),this.checkAbort(n)}async compressWithMediabunny(e,n){let r=null,i=null,s=null;const o=typeof n?.mediabunnyAudioQuality<"u",a=n?.mediabunnyAudioQuality,l=n?.mediabunnyVideoQuality??n?.mediabunnyAudioQuality;try{this.log("Starting Mediabunny compression"),this.abortController=new AbortController,r=new Xx({source:new JP(e),formats:YP}),s=new JD,i=new nS({target:s,format:new pT({fastStart:"in-memory"})});const c=await r.getAudioTracks(),u=c.length>0;this.log("Input audio tracks:",c.length),c.length>0&&this.log("First audio track codec:",c[0].codec);const d=await this.validateMediabunnyAudioConfig(c,n,o);let{canEncodeOpus:f,audioConfigByTrack:h,desiredAudioSampleRate:p,desiredAudioBitrate:m}=d;const g=this.buildConversionOptions(r,i,n,o,a,l,f,h),y=await bT.init(g),b=this.validateConversion(y,r,i,f);if(b)return this.abortController=null,b;y.onProgress=I=>{this.onProgress&&this.onProgress(Math.round(I*100))};const S=await this.executeConversion(y,e);if(S)return Jh(r,null),this.abortController=null,S;const C=s.buffer;if(!C)throw new Error("Output buffer is null");let _=new Blob([C],{type:"video/mp4"});if(Jh(r,null),!f&&u){this.log("Attempting to mux original audio track via FFmpeg copy");const I=await this.mergeVideoAndAudioWithFFmpeg(_,e),k=this.checkAbort(e);if(k)return this.abortController=null,k;if(!I)return Js(this.context,"Audio mux failed; falling back to FFmpeg compression."),this.abortController=null,await this.compressWithFFmpeg(e,n);_=I,this.log("Successfully muxed original audio track.")}const x=SB(_,e,this.context);if(!x.wasCompressed)return this.abortController=null,x;if(f&&u&&(m||p)){if(!(await this.verifyMediabunnyAudio(x.file,p,m)).passed)return this.abortController=null,await this.compressWithFFmpeg(e,n)}else!f&&u&&this.log("Audio was copied as-is, skipping audio verification");return this.onProgress&&this.onProgress(100),this.abortController=null,x}catch(c){Jh(r,null);const u=this.checkAbort(e);return u?(this.abortController=null,u):(console.error("[MediaBunnyCompression] Mediabunny compression failed:",c),this.abortController=null,{file:e,wasCompressed:!1,wasSkipped:!0})}}async verifyMediabunnyAudio(e,n,r){const i=typeof r=="number"&&Number.isFinite(r),s=typeof n=="number"&&Number.isFinite(n);if(!i&&!s)return{passed:!0};let o=null;try{o=new Xx({source:new JP(e),formats:YP});const a=await o.getAudioTracks();if(a.length===0)return Js(this.context,"Mediabunny output lost audio track; falling back to FFmpeg"),{passed:!1};const l=a[0],c=await l.computePacketStats(120),u=l.sampleRate,d=c.averageBitrate;if(this.log("Mediabunny audio verification:",{expectedBitrate:r,actualBitrate:d,expectedSampleRate:n,actualSampleRate:u}),s&&Math.abs(u-n)>1)return Js(this.context,"Audio sample rate mismatch detected, falling back to FFmpeg"),{passed:!1};if(i){const f=r*1.25;if(!Number.isFinite(d)||d>f)return Js(this.context,"Audio bitrate exceeds expected range, falling back to FFmpeg",{actualBitrate:d,allowedUpperBitrate:f}),{passed:!1}}return{passed:!0}}catch(a){return Js(this.context,"Audio verification error, falling back to FFmpeg:",a),{passed:!1}}finally{o?.dispose()}}}var yn;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(yn||(yn={}));const Vme=(()=>{let t=0;return()=>t++})(),Wme=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),jme=new Error("called FFmpeg.terminate()");class qme{#e=null;#t={};#n={};#r=[];#i=[];loaded=!1;#a=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:n,data:r}})=>{switch(n){case yn.LOAD:this.loaded=!0,this.#t[e](r);break;case yn.MOUNT:case yn.UNMOUNT:case yn.EXEC:case yn.FFPROBE:case yn.WRITE_FILE:case yn.READ_FILE:case yn.DELETE_FILE:case yn.RENAME:case yn.CREATE_DIR:case yn.LIST_DIR:case yn.DELETE_DIR:this.#t[e](r);break;case yn.LOG:this.#r.forEach(i=>i(r));break;case yn.PROGRESS:this.#i.forEach(i=>i(r));break;case yn.ERROR:this.#n[e](r);break}delete this.#t[e],delete this.#n[e]})};#s=({type:e,data:n},r=[],i)=>this.#e?new Promise((s,o)=>{const a=Vme();this.#e&&this.#e.postMessage({id:a,type:e,data:n},r),this.#t[a]=s,this.#n[a]=o,i?.addEventListener("abort",()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Wme);on(e,n){e==="log"?this.#r.push(n):e==="progress"&&this.#i.push(n)}off(e,n){e==="log"?this.#r=this.#r.filter(r=>r!==n):e==="progress"&&(this.#i=this.#i.filter(r=>r!==n))}load=({classWorkerURL:e,...n}={},{signal:r}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/ehagaki/assets/worker-DYSz7Krg.js",import.meta.url),{type:"module"}),this.#a()),this.#s({type:yn.LOAD,data:n},void 0,r));exec=(e,n=-1,{signal:r}={})=>this.#s({type:yn.EXEC,data:{args:e,timeout:n}},void 0,r);ffprobe=(e,n=-1,{signal:r}={})=>this.#s({type:yn.FFPROBE,data:{args:e,timeout:n}},void 0,r);terminate=()=>{const e=Object.keys(this.#n);for(const n of e)this.#n[n](jme),delete this.#n[n],delete this.#t[n];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,n,{signal:r}={})=>{const i=[];return n instanceof Uint8Array&&i.push(n.buffer),this.#s({type:yn.WRITE_FILE,data:{path:e,data:n}},i,r)};mount=(e,n,r)=>{const i=[];return this.#s({type:yn.MOUNT,data:{fsType:e,options:n,mountPoint:r}},i)};unmount=e=>{const n=[];return this.#s({type:yn.UNMOUNT,data:{mountPoint:e}},n)};readFile=(e,n="binary",{signal:r}={})=>this.#s({type:yn.READ_FILE,data:{path:e,encoding:n}},void 0,r);deleteFile=(e,{signal:n}={})=>this.#s({type:yn.DELETE_FILE,data:{path:e}},void 0,n);rename=(e,n,{signal:r}={})=>this.#s({type:yn.RENAME,data:{oldPath:e,newPath:n}},void 0,r);createDir=(e,{signal:n}={})=>this.#s({type:yn.CREATE_DIR,data:{path:e}},void 0,n);listDir=(e,{signal:n}={})=>this.#s({type:yn.LIST_DIR,data:{path:e}},void 0,n);deleteDir=(e,{signal:n}={})=>this.#s({type:yn.DELETE_DIR,data:{path:e}},void 0,n)}var EO;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(EO||(EO={}));const Kme=t=>new Promise((e,n)=>{const r=new FileReader;r.onload=()=>{const{result:i}=r;i instanceof ArrayBuffer?e(new Uint8Array(i)):e(new Uint8Array)},r.onerror=i=>{n(Error(`File could not be read! Code=${i?.target?.error?.code||-1}`))},r.readAsArrayBuffer(t)}),E2=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await Kme(t);else return new Uint8Array;return new Uint8Array(e)};class Gme extends kB{ffmpeg=null;isLoaded=!1;loadPromise=null;isCompressing=!1;constructor(){super("FFmpegCompression")}abort(){if(this.log("Abort requested"),this.resetProgress(),this.ffmpeg&&this.isCompressing){this.log("Terminating FFmpeg");try{this.ffmpeg.terminate()}catch(e){Js(this.context,"Error terminating FFmpeg:",e)}}}async loadFFmpeg(){if(!this.isLoaded)return this.loadPromise?this.loadPromise:(this.loadPromise=(async()=>{this.log("Loading FFmpeg from node_modules"),this.ffmpeg=new qme,this.ffmpeg.on("log",({message:e})=>{console.log("[FFmpeg]",e)}),this.ffmpeg.on("progress",({progress:e})=>{this.updateProgress(e*100)});try{const e="/ehagaki/",n=new URL(e,window.location.origin).href,r=new URL("ffmpeg-core/ffmpeg-core.js",n).href,i=new URL("ffmpeg-core/ffmpeg-core.wasm",n).href;this.log("Base URL:",n),this.log("Core URL:",r),this.log("WASM URL:",i),await this.ffmpeg.load({coreURL:r,wasmURL:i}),this.isLoaded=!0,this.log("FFmpeg loaded successfully")}catch(e){throw Js(this.context,"Failed to load FFmpeg:",e),e}})(),this.loadPromise)}async mergeVideoAndAudioWithFFmpeg(e,n){const r="mediabunny-video.mp4",i="mediabunny-audio-source.mp4",s="mediabunny-merged.mp4",o=async a=>{if(!a)return;const l=[r,i,s];for(const c of l)try{await a.deleteFile(c)}catch{}};try{if(ln.value)return this.log("Abort detected before audio mux"),null;await this.loadFFmpeg();const a=this.ffmpeg;if(!a)return Js(this.context,"FFmpeg instance unavailable for audio mux"),null;await a.writeFile(r,await E2(e)),await a.writeFile(i,await E2(n));const l=["-i",r,"-i",i,"-map","0:v:0","-map","1:a:0","-c:v","copy","-c:a","copy","-movflags","+faststart","-shortest","-y",s];if(this.log("Executing FFmpeg audio mux with args:",l),this.isCompressing=!0,await a.exec(l),ln.value)return this.log("Abort detected during audio mux"),await o(a),null;const c=await a.readFile(s),u=new Blob([c],{type:"video/mp4"});return await o(a),u}catch(a){return ln.value?this.log("Audio mux aborted, returning null"):Js(this.context,"Failed to mux audio with FFmpeg copy:",a),await o(this.ffmpeg),null}finally{this.isCompressing=!1}}buildFFmpegArgs(e,n,r){const i=["-i",e,"-c:v","libx264","-crf",String(r.crf),"-preset",r.preset,"-c:a","aac","-b:a",r.audioBitrate||"128k"];if(r.audioSampleRate&&i.push("-ar",String(r.audioSampleRate)),r.audioChannels&&i.push("-ac",String(r.audioChannels)),r.maxSize){const s=`scale='if(gte(iw,ih),min(${r.maxSize},iw),-2)':'if(lt(iw,ih),min(${r.maxSize},ih),-2)'`;i.push("-vf",s)}return i.push("-movflags","+faststart","-y",n),i}async compressWithFFmpeg(e,n){try{this.log("Loading FFmpeg..."),await this.loadFFmpeg();const r=this.checkAbort(e);if(r)return r;if(!this.ffmpeg)throw new Error("FFmpeg not loaded");const i="input.mp4",s="output.mp4";await this.ffmpeg.writeFile(i,await E2(e));const o=this.buildFFmpegArgs(i,s,n),a=this.checkAbort(e);if(a)return await this.ffmpeg.deleteFile(i),a;this.log("Starting compression with args:",o),this.isCompressing=!0;try{await this.ffmpeg.exec(o)}catch(u){if(ln.value)this.log("Compression aborted during execution");else throw console.error("[FFmpegCompression] FFmpeg execution error:",u),u}finally{this.isCompressing=!1}if(ln.value){this.log("Cleaning up after abort");try{await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s)}catch{}return{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}}const l=await this.ffmpeg.readFile(s),c=new Blob([l],{type:"video/mp4"});return await this.ffmpeg.deleteFile(i),await this.ffmpeg.deleteFile(s),SB(c,e,this.context)}catch(r){return this.isCompressing=!1,ln.value?(this.log("Compression aborted, using original file"),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0}):(console.error("[FFmpegCompression] Compression failed:",r),{file:e,wasCompressed:!1,wasSkipped:!0})}}async cleanup(){if(this.ffmpeg&&this.isLoaded)try{this.isLoaded=!1,this.ffmpeg=null,this.loadPromise=null}catch(e){console.error("[FFmpegCompression] Cleanup error:",e)}}}class TO{constructor(e){this.localStorage=e,this.ffmpegCompression=new Gme,this.mediabunnyCompression=new Hme(this.parseAudioBitrate.bind(this),this.ffmpegCompression.mergeVideoAndAudioWithFFmpeg.bind(this.ffmpegCompression),this.ffmpegCompression.compressWithFFmpeg.bind(this.ffmpegCompression))}context="VideoCompressionService";mediabunnyCompression;ffmpegCompression;useMediabunny=null;mediabunnyCheckPromise=null;onProgress;async checkMediaBunnySupport(){return this.useMediabunny!==null?this.useMediabunny:this.mediabunnyCheckPromise?this.mediabunnyCheckPromise:(this.mediabunnyCheckPromise=(async()=>{const e=await $me();return this.useMediabunny=e,Mo(this.context,`Using ${e?"Mediabunny":"FFmpeg"} for compression`),e})(),this.mediabunnyCheckPromise)}abort(){Mo(this.context,"Abort requested"),this.onProgress&&this.onProgress(0),this.mediabunnyCompression.abort(),this.ffmpegCompression.abort()}setProgressCallback(e){this.onProgress=e,this.mediabunnyCompression.setProgressCallback(e),this.ffmpegCompression.setProgressCallback(e)}getCompressionOptions(){const e=this.localStorage.getItem("videoCompressionLevel")||"medium",n=p0[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n||null}hasCompressionSettings(){return this.getCompressionOptions()!==null}parseAudioBitrate(e){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const n=Number.parseInt(e,10);if(Number.isFinite(n)&&n>0)return n*1e3}return null}async compress(e){if(!Fme(e))return Mo(this.context,"Skipping non-video file"),{file:e,wasCompressed:!1};if(Bme(e))return Mo(this.context,"Skipping small video file"),{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(Lme(n,this.context))return{file:e,wasCompressed:!1,wasSkipped:!0};if(ln.value)return Mo(this.context,"Compression aborted"),this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,wasSkipped:!0,aborted:!0};try{if(await this.checkMediaBunnySupport()){Mo(this.context,"Attempting compression with MediaBunny");const i=await this.mediabunnyCompression.compressWithMediabunny(e,n);return!i.wasCompressed&&!i.wasSkipped?(Mo(this.context,"MediaBunny failed, falling back to FFmpeg"),await this.ffmpegCompression.compressWithFFmpeg(e,n)):i}else return Mo(this.context,"Using FFmpeg for compression"),await this.ffmpegCompression.compressWithFFmpeg(e,n)}catch(r){return console.error("[VideoCompressionService] Compression failed:",r),{file:e,wasCompressed:!1,wasSkipped:!0}}}async cleanup(){await this.ffmpegCompression.cleanup(),await this.mediabunnyCompression.cleanup()}}var Fd=Symbol("verified"),Zme=t=>t instanceof Object;function Xme(t){if(!Zme(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}new TextDecoder("utf-8");var EB=new TextEncoder,Qme=class{generateSecretKey(){return Do.utils.randomPrivateKey()}getPublicKey(t){return dr(Do.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=dr(Do.getPublicKey(e)),n.id=T2(n),n.sig=dr(Do.sign(T2(n),e)),n[Fd]=!0,n}verifyEvent(t){if(typeof t[Fd]=="boolean")return t[Fd];const e=T2(t);if(e!==t.id)return t[Fd]=!1,!1;try{const n=Do.verify(t.sig,e,t.pubkey);return t[Fd]=n,n}catch{return t[Fd]=!1,!1}}};function Yme(t){if(!Xme(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function T2(t){let e=Qc(EB.encode(Yme(t)));return dr(e)}var Rw=new Qme;Rw.generateSecretKey;Rw.getPublicKey;Rw.finalizeEvent;Rw.verifyEvent;var Jme=27235,ege="Nostr ";async function tge(t,e,n,r=!1,i){const s={kind:Jme,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""},o=await n(s);return(r?ege:"")+Jo.encode(EB.encode(JSON.stringify(o)))}const mC=Ds([]);function nge(){return window.location.port==="4173"||window.location.hostname==="localhost"}function TB(){return nge()}function rge(...t){const e=t.map(n=>typeof n=="object"?JSON.stringify(n):String(n)).join(" ");mC.update(n=>[e,...n].slice(0,250))}const ige=console.log;typeof window<"u"&&(window.__originalConsoleLog=ige);async function sge(t){let e=[];t?e=t:mC.subscribe(r=>e=r)();const n=e?.join(`
`)??"";n&&Ow(n,"dev log",navigator,window)}typeof window<"u"&&(window.showSwUpdateModalDebug=()=>{ST.set(!0),console.log("SWæ´æ°ãã¿ã³ãå¼·å¶è¡¨ç¤ºãã¾ããï¼è¨­å®ãã¿ã³ã©ã³ãï¼SettingsDialogåï¼")});TB()&&(window.testDevLog=()=>{console.log("ãã¹ãç¨ã­ã°åºå:",new Date().toISOString()),rge("ç´æ¥devLogã«è¿½å :",Math.random())},window.showPostSuccessDebug=()=>{Pn.postStatus={...Pn.postStatus,success:!0,error:!1,message:"post_success",completed:!0}},window.showPostErrorDebug=()=>{Pn.postStatus={...Pn.postStatus,success:!1,error:!0,message:"post_error",completed:!1}});class oge{constructor(e){this.document=e}mimeSupportCache={};webpQualitySupport;async canEncodeWebpWithQuality(){if(this.webpQualitySupport!==void 0)return this.webpQualitySupport;try{if(!this.document)return this.webpQualitySupport=!1;const e=this.document.createElement("canvas");e.width=2,e.height=2;const n=e.getContext("2d");if(!n)return this.webpQualitySupport=!1;n.fillStyle="#f00",n.fillRect(0,0,2,2);const r=e.toDataURL("image/webp",.2),i=e.toDataURL("image/webp",.9),s=r.startsWith("data:image/webp")&&i.startsWith("data:image/webp")&&r.length!==i.length;return this.webpQualitySupport=s,s}catch{return this.webpQualitySupport=!1,!1}}canEncodeMimeType(e){if(!e)return!1;if(e in this.mimeSupportCache)return this.mimeSupportCache[e];try{if(!this.document)return this.mimeSupportCache[e]=!1;const n=this.document.createElement("canvas");n.width=2,n.height=2;const r=n.getContext("2d");if(!r)return this.mimeSupportCache[e]=!1;r.fillStyle="#000",r.fillRect(0,0,2,2);const i=n.toDataURL(e),s=typeof i=="string"&&i.startsWith(`data:${e}`);return this.mimeSupportCache[e]=s,s}catch{return this.mimeSupportCache[e]=!1,!1}}}class CO{constructor(e,n){this.mimeSupport=e,this.localStorage=n}onProgress;abort(){this.onProgress&&this.onProgress(0)}setProgressCallback(e){this.onProgress=e}getCompressionOptions(){const e=this.localStorage.getItem("imageCompressionLevel")||"medium",n=yu[e];return typeof n=="object"&&n&&"skip"in n&&n.skip?null:n?{...n,preserveExif:!1}:null}hasCompressionSettings(){return this.getCompressionOptions()!==null}async compress(e){if(ln.value)return{file:e,wasCompressed:!1,aborted:!0};if(!e.type.startsWith("image/"))return{file:e,wasCompressed:!1};if(e.size<=20*1024)return{file:e,wasCompressed:!1,wasSkipped:!0};const n=this.getCompressionOptions();if(!n)return{file:e,wasCompressed:!1,wasSkipped:!0};let r={...n,onProgress:s=>{this.onProgress&&this.onProgress(Math.round(s*100))}};if(r.fileType==="image/webp"&&(await this.mimeSupport.canEncodeWebpWithQuality()||(r.fileType=e.type==="image/png"?"image/png":"image/jpeg")),ln.value)return{file:e,wasCompressed:!1,aborted:!0};let i=r.fileType||e.type;this.mimeSupport.canEncodeMimeType(i)||(i=e.type,delete r.fileType);try{const s=await ni(e,r);if(ln.value)return this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0};if(s.size>=e.size)return{file:e,wasCompressed:!1};const o=r.fileType||s.type||i||e.type,a=xoe(e.name,o),l=new File([s],a,{type:o});return{file:l,wasCompressed:!0}}catch(s){return ln.value?(this.onProgress&&this.onProgress(0),{file:e,wasCompressed:!1,aborted:!0}):(console.warn("[ImageCompressionService] Compression failed:",s),{file:e,wasCompressed:!1,wasSkipped:!0})}}}class age{async waitForWindowNostr(e=3e3,n=100){const r=Date.now();for(;Date.now()-r<e;){const i=window?.nostr;if(i?.signEvent)return i;await new Promise(s=>setTimeout(s,n))}return null}async buildAuthHeader(e,n="POST"){const r=_S.getFromStore()||_S.loadFromStorage();let i;if(r)i=s=>ux(r).signEvent(s);else{let s=window?.nostr;if(s?.signEvent||(s=await this.waitForWindowNostr()),s?.signEvent)i=o=>s.signEvent(o);else throw new Error("Authentication required")}return await tge(e,n,i,!0)}}class CB{constructor(e={localStorage:window.localStorage,fetch:window.fetch.bind(window),crypto:window.crypto.subtle,document:window.document,window,navigator:window.navigator},n,r,i,s){this.dependencies=e,this.mimeSupport=s||new oge(e.document),this.imageCompressionService=r||new CO(this.mimeSupport,e.localStorage),this.videoCompressionService=i||new TO(e.localStorage),this.authService=n||new age,this.videoCompressionService instanceof TO&&!Kie()&&(qie(this.videoCompressionService),console.log("[FileUploadManager] VideoCompressionService registered to store")),this.imageCompressionService instanceof CO&&!Zie()&&(Gie(this.imageCompressionService),console.log("[FileUploadManager] ImageCompressionService registered to store"))}imageCompressionService;videoCompressionService;mimeSupport;authService;validateImageFile(e){return e.type.startsWith("image/")?e.size>hI?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}:{isValid:!1,errorMessage:"only_images_allowed"}}validateMediaFile(e){const n=e.type.startsWith("image/"),r=e.type.startsWith("video/");return!n&&!r?{isValid:!1,errorMessage:"only_images_or_videos_allowed"}:e.size>hI?{isValid:!1,errorMessage:"file_too_large"}:{isValid:!0}}async generateBlurhashForFile(e){return await Fse(e)}async createPlaceholderUrl(e){return await Bse(e)}getUploadEndpoint(e){const n=this.dependencies.localStorage.getItem("uploadEndpoint"),r=i=>i&&i.trim().length>0?i:void 0;return r(n)??r(e)??jh}async pollUploadStatus(e,n,r=O1.MAX_WAIT_TIME){const i=Date.now();for(;;){if(ln.value)throw new Error("Upload aborted by user");if(Date.now()-i>r)throw new Error(O1.TIMEOUT_MESSAGE);const s=await this.dependencies.fetch(e,{method:"GET",headers:{Authorization:n}});if(!s.ok)throw new Error(`Unexpected status code ${s.status} while polling processing_url`);let o=null;try{o=await s.json()}catch{o=null}if(s.status===201&&o)return o;if(o?.status==="processing"){await new Promise(a=>setTimeout(a,O1.RETRY_INTERVAL));continue}if(o?.status==="success")return o;if(o?.status==="error")throw new Error(o?.message||"File processing failed");if(s.status===200)return o;throw new Error("Unexpected processing status")}}async uploadFile(e,n=jh,r=!1,i,s){let o;try{if(!e)return{success:!1,error:"No file selected"};let a;try{a=await b5(e,this.dependencies.crypto)}catch{a=void 0}const l=e.size;if(ln.value)return r&&console.log("[FileUploadManager] Upload aborted before compression"),{success:!1,error:"Upload aborted by user",aborted:!0};const c=e.type.startsWith("video/"),u=c?this.videoCompressionService:this.imageCompressionService;c&&s?.onVideoCompressionProgress&&this.videoCompressionService.setProgressCallback(s.onVideoCompressionProgress),!c&&s?.onImageCompressionProgress&&this.imageCompressionService.setProgressCallback(s.onImageCompressionProgress);const{file:d,wasCompressed:f,wasSkipped:h,aborted:p}=await u.compress(e);if(c?this.videoCompressionService.setProgressCallback(void 0):this.imageCompressionService.setProgressCallback(void 0),p)return r&&console.log("[FileUploadManager] Upload aborted by user"),{success:!1,error:"Upload aborted by user",aborted:!0};const m=d.size,g=c?this.videoCompressionService.hasCompressionSettings():this.imageCompressionService.hasCompressionSettings();o=doe(l,m,g||f,e.name,d.name,h);const y=this.getUploadEndpoint(n),b=await this.authService.buildAuthHeader(y,"POST"),S=new FormData;S.append("file",d),i?.caption&&S.append("caption",String(i.caption)),i?.expiration!==void 0&&S.append("expiration",String(i.expiration)),S.append("size",String(d.size)),i?.alt&&S.append("alt",String(i.alt)),i?.media_type&&S.append("media_type",String(i.media_type)),S.append("content_type",i?.content_type?String(i.content_type):d.type||""),S.append("no_transform",i?.no_transform?String(i.no_transform):"true");const C=await this.dependencies.fetch(y,{method:"POST",headers:{Authorization:b},body:S});if(ln.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};if(!C.ok){const I=await C.text().catch(()=>"Unknown error");return{success:!1,error:`Upload failed: ${C.status} ${C.statusText} - ${I}`,sizeInfo:o}}let _;try{_=await C.json()}catch(I){return r&&console.error("[dev] JSON parse error:",I),{success:!1,error:"Could not parse upload response",sizeInfo:o}}if((C.status===200||C.status===202)&&_.processing_url)try{const I=await this.authService.buildAuthHeader(_.processing_url,"GET");if(_=await this.pollUploadStatus(_.processing_url,I),ln.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0}}catch(I){return{success:!1,error:I instanceof Error?I.message:String(I),sizeInfo:o}}const x={};if(_?.nip94_event?.tags&&Array.isArray(_.nip94_event.tags))for(const I of _.nip94_event.tags){if(!Array.isArray(I)||I.length<2)continue;const k=String(I[0]),T=I.slice(1).join(" ");k in x||(x[k]=T)}if(_.status==="success"&&_.nip94_event?.tags){const I=_.nip94_event.tags.find(k=>k[0]==="url");if(I?.[1])return{success:!0,url:I[1],sizeInfo:o,nip94:x}}return{success:!1,error:_.message||"Could not extract URL from response",sizeInfo:o,nip94:Object.keys(x).length?x:void 0}}catch(a){if(ln.value)return{success:!1,error:"Upload aborted by user",sizeInfo:o,aborted:!0};r&&console.error("[dev] Upload error:",a);const l=a instanceof Error?a.message:String(a);return l.includes("aborted by user")?{success:!1,error:l,sizeInfo:o,aborted:!0}:{success:!1,error:l.includes("Failed to fetch")?`${l} (Service Workerãç»åã¢ããã­ã¼ãããã­ãã¯ãã¦ããå¯è½æ§ãããã¾ã)`:l}}}async uploadMultipleFiles(e,n=jh,r,i=!1,s,o){if(!e?.length)return[];const a=new Array(e.length);let l=0,c=0,u=0;const d=()=>r?.({completed:l,failed:c,aborted:u,total:e.length,inProgress:l+c+u<e.length});d();for(let f=0;f<e.length;f++){if(ln.value){for(let p=f;p<e.length;p++)a[p]={success:!1,aborted:!0},u++;d();break}const h=e[f];try{const p=s?s[f]:void 0,m=await this.uploadFile(h,n,i,p,o);a[f]=m,m.success?l++:m.aborted?u++:c++,d()}catch(p){a[f]={success:!1,error:p instanceof Error?p.message:String(p)},c++,d()}}return a}async uploadFileWithCallbacks(e,n=jh,r,i=!1,s){r?.onProgress?.({completed:0,failed:0,aborted:0,total:1,inProgress:!0});try{const o=await this.uploadFile(e,n,i,s,r);if(r?.onProgress?.({completed:o.success?1:0,failed:!o.success&&!o.aborted?1:0,aborted:o.aborted?1:0,total:1,inProgress:!1}),o.success&&o.sizeInfo&&!o.aborted){const a=FI(o.sizeInfo);a&&RI(a)}return o}catch(o){return r?.onProgress?.({completed:0,failed:1,aborted:0,total:1,inProgress:!1}),{success:!1,error:o instanceof Error?o.message:String(o)}}}async uploadMultipleFilesWithCallbacks(e,n=jh,r,i){if(!e?.length)return[];r?.onProgress?.({completed:0,failed:0,aborted:0,total:e.length,inProgress:!0});const s=await this.uploadMultipleFiles(e,n,r?.onProgress,!1,i,r);if(!ln.value){const o=s.find(a=>a.success&&a.sizeInfo);if(o?.sizeInfo){const a=FI(o.sizeInfo);a&&RI(a)}}return s}async getSharedImageFromServiceWorker(){if(!this.dependencies.navigator?.serviceWorker?.controller)return null;try{const e=new MessageChannel,n=new Promise(r=>{e.port1.onmessage=i=>{i.data?.type==="SHARED_IMAGE"?r(i.data.data):r(null)},setTimeout(()=>r(null),3e3)});return this.dependencies.navigator.serviceWorker.controller.postMessage({action:"getSharedImage"},[e.port2]),await n}catch(e){return console.error("Service Workerããã®å±æç»ååå¾ã«å¤±æ:",e),null}}checkIfOpenedFromShare(){return this.dependencies.window?.location?new URLSearchParams(this.dependencies.window.location.search).get("shared")==="true":!1}async processSharedImageOnLaunch(){try{const e=await this.getSharedImageFromServiceWorker();return e?.image?{success:!0,data:e,fromServiceWorker:!0}:{success:!1,error:"å±æç»åãè¦ã¤ããã¾ãã"}}catch(e){return{success:!1,error:e instanceof Error?e.message:String(e)}}}}class lge{dependencies;devMode;fileUploadManager;constructor(e,n){this.dependencies=e,this.devMode=n,this.fileUploadManager=new this.dependencies.FileUploadManager}async uploadFiles(e,n,r,i){try{if(e.length===1)return[await this.fileUploadManager.uploadFileWithCallbacks(e[0],n,r,this.devMode,i?.[0])];if(e.length>1)return await this.fileUploadManager.uploadMultipleFilesWithCallbacks(e,n,r,i)}catch(s){if(this.devMode){const a=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";console.error(`${a} [uploadHelper] Upload error:`,s)}throw s}return null}}function C2(t,e,n,r,i,s=!1,o=!1){return r(!1),o&&n&&B6(n,s),i?.onProgress&&i.onProgress({completed:0,failed:0,aborted:t.length,total:t.length,inProgress:!1}),{placeholderMap:o?[]:e,results:null,imageOxMap:{},imageXMap:{},failedResults:[],errorMessage:"Upload aborted by user"}}const _B=()=>({localStorage:window.localStorage,crypto:window.crypto.subtle,tick:ul,FileUploadManager:CB,getImageDimensions:voe,extractImageBlurhashMap:p5,calculateImageHash:zse,getMimeTypeFromUrl:m5,createImetaTag:async t=>await h5(t),imageSizeMapStore:AS});async function cge({files:t,currentEditor:e,fileInput:n,uploadCallbacks:r,showUploadError:i,updateUploadState:s,devMode:o,dependencies:a=_B()}){const l=Array.from(t),c=a.localStorage.getItem("uploadEndpoint")||"",u={},d={},h=window.location.port==="4173"||window.location.hostname==="localhost"?"[preview]":"[dev]";r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:0,total:l.length,inProgress:!0}),ln.reset();const p=new lge(a,o);let m;try{m=await Foe(l,a)}catch(x){if(x instanceof Error&&x.message==="Upload aborted by user")return s(!1),r?.onProgress&&r.onProgress({completed:0,failed:0,aborted:l.length,total:l.length,inProgress:!1}),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:"Upload aborted by user"};throw x}if(ln.value)return C2(l,[],e,s,r,o,!1);let g=ume(l,m,e,i,a.imageSizeMapStore,a.FileUploadManager,o);if(g.length===0)return{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:""};if(ln.value||(s(!0,""),await dme(g,e,a.FileUploadManager,o),ln.value))return C2(l,g,e,s,r,o,!0);const y=g.map(x=>x.file);let b=null;try{const x=$oe(y);b=await p.uploadFiles(y,c,r,x)}catch(x){const I=x instanceof Error?x.message:String(x);i(I,5e3),b=null}finally{s(!1)}if(ln.value)return n&&(n.value=""),{placeholderMap:[],results:null,imageOxMap:u,imageXMap:d,failedResults:[],errorMessage:"Upload aborted by user"};await a.tick();const S=[];let C="",_={};if(b&&g.length>0){const x=await fme(b,g,e,u,d,a.imageSizeMapStore,a.extractImageBlurhashMap,a.getMimeTypeFromUrl,a.calculateImageHash,a.createImetaTag,o);S.push(...x.failedResults),C=x.errorMessage,_=x.imageServerBlurhashMap,g=[]}if(o&&e)try{const x=a.extractImageBlurhashMap(e),I=new Set([...Object.keys(x),...Object.keys(_)]);await Promise.all(Array.from(I).map(async T=>{if(!d[T]){const P=await a.calculateImageHash(T);P&&(d[T]=P)}}));const k=await Promise.all(Array.from(I).map(async T=>{const P=_[T]??x[T],O=a.getMimeTypeFromUrl(T),D=u[T],F=d[T];return(await a.createImetaTag({url:T,m:O,blurhash:P,ox:D,x:F})).join(" ")}))}catch(x){console.warn(`${h} [dev] imetaã¿ã°çæå¤±æ`,x)}return n&&(n.value=""),{placeholderMap:g,results:b,imageOxMap:u,imageXMap:d,failedResults:S,errorMessage:C}}function uge(t){const{onUploadProgress:e,videoCompressionProgressStore:n,imageCompressionProgressStore:r}=t;return e?{onProgress:e,onVideoCompressionProgress:i=>{n.set(i)},onImageCompressionProgress:i=>{r.set(i)}}:void 0}function _O(t,e=3e3,n){n.updateUploadState(!1,t),setTimeout(()=>n.updateUploadState(!1,""),e)}async function dge(t){const{files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,updateUploadState:s,devMode:o,imageOxMap:a,imageXMap:l,dependencies:c=_B(),getUploadFailedText:u}=t;if(!e||e.length===0)return;const d=await cge({files:e,currentEditor:n,fileInput:r,uploadCallbacks:i,showUploadError:(f,h)=>_O(f,h,{updateUploadState:s}),updateUploadState:s,devMode:o,dependencies:c});Object.assign(a,d.imageOxMap),Object.assign(l,d.imageXMap),d.failedResults?.length&&_O(d.errorMessage||(d.failedResults.length===1?d.failedResults[0].error||u("postComponent.upload_failed"):`${d.failedResults.length}åã®ãã¡ã¤ã«ã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã`),5e3,{updateUploadState:s}),r&&(r.value="")}async function fge(t){const{files:e,currentEditor:n,fileInput:r,onUploadProgress:i,updateUploadState:s,imageOxMap:o,imageXMap:a,videoCompressionProgressStore:l,imageCompressionProgressStore:c,getUploadFailedText:u,dependencies:d}=t,f=uge({onUploadProgress:i,videoCompressionProgressStore:l,imageCompressionProgressStore:c});await dge({files:e,currentEditor:n,fileInput:r,uploadCallbacks:f,updateUploadState:s,devMode:!1,imageOxMap:o,imageXMap:a,dependencies:d,getUploadFailedText:u})}var hge=Ce('<div class="context-menu-header svelte-l8h85k"> </div>'),pge=Ce('<span aria-hidden="true"></span>'),mge=Ce('<button role="menuitem"><!> </button>'),gge=Ce('<div class="context-menu svelte-l8h85k" role="menu" aria-label="Image context menu"><!> <!></div>');function yge(t,e){St(e,!0);let n=oe(()=>e.x),r=oe(()=>e.y),i=me(0),s=me(0),o=me(void 0);Ge(()=>{K(i,e.x,!0),K(s,e.y,!0)});let a=me(!0),l=0,c=!1;function u(k){if(E(a))return;const T=Date.now();c&&T-l<500||E(o)&&!E(o).contains(k.target)&&(e.onClose(),us.set({open:!1,nodeId:void 0}))}function d(k){E(a)||(c=!0,l=Date.now(),E(o)&&k.target instanceof Node&&!E(o).contains(k.target)&&(e.onClose(),us.set({open:!1,nodeId:void 0})))}function f(k){k.key==="Escape"&&(e.onClose(),us.set({open:!1,nodeId:void 0}))}async function h(){await ul();let k=E(o)?E(o).getBoundingClientRect().width:0,T=E(o)?E(o).getBoundingClientRect().height:0;(!k||k<8)&&(k=E(o)?.offsetWidth??160),(!T||T<4)&&(T=E(o)?.offsetHeight??40);const O=Tf(E(n),E(r),8,k,T);K(i,O.x,!0),K(s,O.y,!0)}Ge(()=>{K(n,e.x),K(r,e.y),h()});function p(){h()}bs(()=>{setTimeout(()=>{K(a,!1),document.addEventListener("click",u),document.addEventListener("touchend",d)},0),document.addEventListener("keydown",f),window.addEventListener("resize",p),h()}),Zu(()=>{document.removeEventListener("click",u),document.removeEventListener("touchend",d),document.removeEventListener("keydown",f),window.removeEventListener("resize",p)});let m=me(null);Ge(()=>{const k=e.items[0]?.src;if(typeof k=="string"){let T=k.replace(/^https?:\/\//,"");T.length>26?K(m,`${T.slice(0,18)}...${T.slice(-8)}`):K(m,T,!0)}else K(m,null)});const g=k=>{const T=oo(or);return typeof T=="function"?T(k):String(k)},y=oe(()=>()=>{const k=e.items[0];if(k&&k.label){const T=typeof k.label=="string"?k.label:"";if(T===g("videoContextMenu.copyUrl")||T===g("videoContextMenu.delete"))return"video"}return"image"});function b(k){let T;k&&typeof k.clientX=="number"&&typeof k.clientY=="number"?T={x:k.clientX,y:k.clientY}:T={x:e.x,y:e.y};const P=Tf(T.x,T.y),D=E(y)()==="video"?"videoContextMenu.copySuccess":"imageContextMenu.copySuccess";e.onShowPopup(P.x,P.y,g(D))}function S(k){let T;k&&typeof k.clientX=="number"&&typeof k.clientY=="number"?T={x:k.clientX,y:k.clientY}:T={x:e.x,y:e.y};const P=Tf(T.x,T.y),D=E(y)()==="video"?"videoContextMenu.copyFailed":"imageContextMenu.copyFailed";e.onShowPopup(P.x,P.y,g(D))}var C=gge(),_=ie(C);{var x=k=>{var T=hge(),P=ie(T);Ke(()=>Re(P,E(m))),Y(k,T)};Ve(_,k=>{E(m)&&k(x)})}var I=we(_,2);Na(I,17,()=>e.items,k=>k.label,(k,T)=>{var P=mge();let O;P.__click=async N=>{if(E(T).icon==="/icons/copy-solid-full.svg"||/copy/i.test(String(E(T).label)))try{E(T).action(),b(N)}catch(R){console.warn("Copy failed:",R),S(N)}else E(T).action();e.onClose()};var D=ie(P);{var F=N=>{var M=pge();let R;Ke(()=>R=ao(M,1,"menu-icon svg-icon svelte-l8h85k",null,R,{"expand-icon":E(T).icon==="/icons/expand-solid-full.svg","copy-icon":E(T).icon==="/icons/copy-solid-full.svg","play-pause-icon":E(T).icon==="/icons/play_pause_24dp_000000_FILL0_wght400_GRAD0_opsz24.svg","trash-icon":E(T).icon==="/icons/trash-solid-full.svg"})),Y(N,M)};Ve(D,N=>{E(T).icon&&N(F)})}var B=we(D);Ke(()=>{O=ao(P,1,"context-menu-item svelte-l8h85k",null,O,{disabled:E(T).disabled}),P.disabled=E(T).disabled,Re(B,` ${E(T).label??""}`)}),Y(k,P)}),gr(C,k=>K(o,k),()=>E(o)),Ke(()=>qa(C,`left: ${E(i)??""}px; top: ${E(s)??""}px;`)),Y(t,C),kt()}Mi(["click"]);var bge=Ce('<div class="popup-modal svelte-1lheb99" role="dialog" aria-modal="true" tabindex="0"><div class="popup-body svelte-1lheb99" role="document"><span class="info-icon svg-icon svelte-1lheb99" aria-hidden="true"></span> <div class="popup-children svelte-1lheb99"><!></div></div></div>');function gC(t,e){St(e,!0);let n=le(e,"show",3,!1),r=le(e,"x",3,0),i=le(e,"y",3,0),s=le(e,"onClose",3,void 0),o=le(e,"children",3,void 0);function a(){try{s()&&s()()}catch{}}function l(g){g.key==="Escape"&&a()}bs(()=>{window.addEventListener("keydown",l)}),Zu(()=>{window.removeEventListener("keydown",l)});let c=me(void 0);Ge(()=>{n()&&E(c)&&(async()=>(await ul(),E(c).parentElement!==document.body&&document.body.appendChild(E(c))))()}),Zu(()=>{if(E(c)&&E(c).parentElement===document.body)try{document.body.removeChild(E(c))}catch{}});let u=me(0),d=me(0);Ge(()=>{K(u,r()),K(d,i())});const f=10;Ge(()=>{n()&&E(c)&&(async()=>{if(await ul(),E(c).parentElement===document.body){const g=E(c).getBoundingClientRect(),y=g.width,b=g.height,S=window.innerWidth,C=window.innerHeight;let _=r(),x=i();_+y+f>S&&(_=S-y-f),_-f<0&&(_=f),x+b+f>C&&(x=C-b-f),x-f<0&&(x=f),K(u,_,!0),K(d,x,!0)}})()});var h=Ue(),p=Ee(h);{var m=g=>{var y=bge();y.__click=_=>_.stopPropagation?.(),y.__keydown=_=>{(_.key==="Enter"||_.key===" ")&&(_.preventDefault(),a())};var b=ie(y),S=we(ie(b),2),C=ie(S);_t(C,()=>o()??Ft),gr(y,_=>K(c,_),()=>E(c)),Ke(()=>qa(y,`left: ${E(u)??""}px; top: ${E(d)??""}px;`)),Y(g,y)};Ve(p,g=>{n()&&g(m)})}Y(t,h),kt()}Mi(["click","keydown"]);var wge=Ce("<button><!></button>");function en(t,e){St(e,!0);let n=le(e,"className",3,""),r=le(e,"disabled",3,!1),i=le(e,"type",3,"button"),s=le(e,"ariaLabel",3,""),o=le(e,"style",3,""),a=le(e,"variant",3,"default"),l=le(e,"shape",3,"rounded"),c=le(e,"onClick",3,void 0),u=le(e,"selected",3,!1),d=Ni(e,["$$slots","$$events","$$legacy","className","disabled","type","ariaLabel","style","variant","shape","children","onClick","selected"]);function f(m){c()&&c()(m)}var h=wge();kr(h,()=>({type:i(),class:`${n()} ${a()} ${l()} ${u()?"selected":""}`,disabled:r(),"aria-label":s(),style:o(),onclick:f,...d}),void 0,void 0,void 0,"svelte-1klcfz0");var p=ie(h);_t(p,()=>e.children??Ft),Y(t,h),kt()}var vge=Ce("<div><!></div>"),xge=Ce('<!> <!> <div class="dialog-content svelte-omvxe3"><!></div> <!>',1),Sge=Ce("<!> <!>",1);function gh(t,e){St(e,!0);let n=le(e,"open",15,!1),r=le(e,"contentClass",3,""),i=le(e,"footerVariant",3,"default");function s(c){c||e.onOpenChange?.(!1)}function o(c){c.preventDefault()}var a=Ue(),l=Ee(a);Nt(l,()=>xZ,(c,u)=>{u(c,{onOpenChange:s,get open(){return n()},set open(d){n(d)},children:(d,f)=>{var h=Ue(),p=Ee(h);Nt(p,()=>Tc,(m,g)=>{g(m,{children:(y,b)=>{var S=Sge(),C=Ee(S);Nt(C,()=>rG,(x,I)=>{I(x,{class:"dialog-overlay"})});var _=we(C,2);Nt(_,()=>TZ,(x,I)=>{I(x,{get class(){return`dialog ${r()??""}`},preventScroll:!1,onCloseAutoFocus:o,children:(k,T)=>{var P=xge(),O=Ee(P);Nt(O,()=>bK,(R,H)=>{H(R,{class:"visually-hidden",children:(z,V)=>{var X=an();Ke(()=>Re(X,e.title)),Y(z,X)},$$slots:{default:!0}})});var D=we(O,2);Nt(D,()=>sG,(R,H)=>{H(R,{class:"visually-hidden",children:(z,V)=>{var X=an();Ke(()=>Re(X,e.description)),Y(z,X)},$$slots:{default:!0}})});var F=we(D,2),B=ie(F);_t(B,()=>e.children??Ft);var N=we(F,2);{var M=R=>{var H=vge();let z;var V=ie(H);_t(V,()=>e.footer),Ke(()=>z=ao(H,1,"dialog-footer svelte-omvxe3",null,z,{"close-button-footer":i()==="close-button"})),Y(R,H)};Ve(N,R=>{e.footer&&R(M)})}Y(k,P)},$$slots:{default:!0}})}),Y(y,S)},$$slots:{default:!0}})}),Y(d,h)},$$slots:{default:!0}})}),Y(t,a),kt()}function yh(t,e,n=!0){if(typeof window>"u"||!(typeof n=="function"?n():n))return;let i=null,s=!1;const o=a=>{t()&&a.state?.modalId!==i&&e()};Ge(()=>{const a=t();if(a&&!s){i=`modal-${Soe()}`,history.pushState({modalId:i},"",window.location.href),s=!0;return}if(!a&&s){const l=history.state?.modalId===i;i=null,s=!1,l&&history.back()}}),bs(()=>{window.addEventListener("popstate",o)}),Zu(()=>{window.removeEventListener("popstate",o),s&&history.state?.modalId===i&&history.back()})}var kge=Ce('<div class="confirm-dialog-message svelte-1efofyg"> </div>'),Ege=Ce('<div class="confirm-dialog-content svelte-1efofyg"><!> <div class="confirm-dialog-buttons svelte-1efofyg"><!> <!></div></div>');function AB(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=le(e,"open",15,!1),o=le(e,"confirmVariant",3,"danger"),a=le(e,"confirmDisabled",3,!1),l=le(e,"autofocusConfirm",3,!1),c=le(e,"contentClass",3,"confirm-dialog"),u=le(e,"addToHistory",3,!1);const d=oe(()=>e.confirmLabel||n()("common.ok")),f=oe(()=>e.cancelLabel||n()("common.cancel")),h=oe(()=>e.title||n()("common.confirm"));function p(){s(!1),e.onCancel?.()}function m(){e.onConfirm(),s(!1)}yh(()=>s(),p,()=>u()),gh(t,{onOpenChange:g=>!g&&p(),get title(){return E(h)},get description(){return e.description},get contentClass(){return c()},get open(){return s()},set open(g){s(g)},children:(g,y)=>{var b=Ege(),S=ie(b);{var C=F=>{var B=Ue(),N=Ee(B);_t(N,()=>e.children),Y(F,B)},_=F=>{var B=kge(),N=ie(B);Ke(()=>Re(N,e.description)),Y(F,B)};Ve(S,F=>{e.children?F(C):F(_,!1)})}var x=we(S,2),I=ie(x);{var k=F=>{var B=Ue(),N=Ee(B);_t(N,()=>e.renderConfirm),Y(F,B)},T=F=>{en(F,{className:"btn-confirm",get variant(){return o()},shape:"square",onClick:m,get disabled(){return a()},get autofocus(){return l()},children:(B,N)=>{var M=an();Ke(()=>Re(M,E(d))),Y(B,M)},$$slots:{default:!0}})};Ve(I,F=>{e.renderConfirm?F(k):F(T,!1)})}var P=we(I,2);{var O=F=>{var B=Ue(),N=Ee(B);_t(N,()=>e.renderCancel),Y(F,B)},D=F=>{var B=Ue(),N=Ee(B);{const M=(R,H)=>{en(R,Qn(()=>H?.().props,{className:"btn-cancel",variant:"secondary",shape:"square",onClick:p,children:(V,X)=>{var Z=an();Ke(()=>Re(Z,E(f))),Y(V,Z)},$$slots:{default:!0}}))};Nt(N,()=>dh,(R,H)=>{H(R,{child:M,$$slots:{child:!0}})})}Y(F,B)};Ve(P,F=>{e.renderCancel?F(O):F(D,!1)})}Y(g,b)},$$slots:{default:!0}}),kt(),i()}function Tge(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=le(e,"show",15,!1);{let o=oe(()=>n()("postComponent.warning")),a=oe(()=>n()("postComponent.secret_key_detected")),l=oe(()=>n()("postComponent.post")),c=oe(()=>n()("postComponent.cancel"));AB(t,{get title(){return E(o)},get description(){return E(a)},get confirmLabel(){return E(l)},get cancelLabel(){return E(c)},confirmVariant:"danger",get onConfirm(){return e.onConfirm},get onCancel(){return e.onCancel},contentClass:"secretkey-warning-dialog",addToHistory:!1,get open(){return s()},set open(u){s(u)}})}kt(),i()}function Cge(t,e,n){const r=t.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{centerX:i.x,centerY:i.y,offsetX:e-r.left-i.x,offsetY:n-r.top-i.y}}function _ge(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Age(t,e,n){const r=e.getBoundingClientRect(),i={x:r.width/2,y:r.height/2};return{scale:n,offsetX:t.clientX-r.left-i.x,offsetY:t.clientY-r.top-i.y}}function Pge({scale:t,translate:e,useTransition:n},r){const i=r??document.querySelector(".image-container");i&&(i.style.transition=n?`transform ${a5.TRANSITION_DURATION} ease`:"none",i.style.transform=`scale(${t}) translate(${e.x/t}px, ${e.y/t}px)`,i.style.transformOrigin="center")}function Ige(t,e,n,r){const i=r??document.querySelector(".image-container");i&&(i.style.transition="none",i.style.transform=`scale(${t}) translate(${e/t}px, ${n/t}px)`)}function pu(t,e){const n=e??document.querySelector(".image-container");n&&(n.style.cursor=t>ur.DEFAULT_SCALE?"grab":"default")}function ep(t,e){const n=e??document.querySelector(".fullscreen-overlay");n&&(n.style.cursor=t>ur.DEFAULT_SCALE?"grab":"default")}function Gl(t){is.setTransition(t)}function AO(t){const e=t?"":"none";Uu("user-select",e),Uu("-webkit-user-select",e)}function bm(t){t!==null&&clearTimeout(t)}function PO(t,e){if(t&&e){const n=t.getBoundingClientRect(),r=e.getBoundingClientRect(),i={imageWidth:n.width,imageHeight:n.height,containerWidth:r.width,containerHeight:r.height};is.setBoundaryConstraints(i)}}function Jg(t,e,n,r,i){t!==null&&cancelAnimationFrame(t),e!==null&&cancelAnimationFrame(e),t=null,e=null,is.reset(),is.setBoundaryConstraints(null),n.isDragging=!1,r.isPinching=!1,bm(i),mse()}function Oge(t,e,n,r,i,s,o){if(!s)return{isDoubleTap:!1,newLastTapTime:t,newLastTapPosition:e,newTapTimeoutId:n};const a=Date.now(),l=e?Math.sqrt(Math.pow(r-e.x,2)+Math.pow(i-e.y,2)):0;if(a-t<200&&l<50&&n!==null)return bm(n),o(r,i),{isDoubleTap:!0,newLastTapTime:0,newLastTapPosition:null,newTapTimeoutId:null};const c=a,u={x:r,y:i};bm(n);const d=window.setTimeout(()=>{},300);return{isDoubleTap:!1,newLastTapTime:c,newLastTapPosition:u,newTapTimeoutId:d}}function IO(t,e,n,r,i,s,o,a,l,c){let u={...n},d=r,f=i,h=s;const p=Oge(r,i,s,o,a,l,c);return d=p.newLastTapTime,f=p.newLastTapPosition,h=p.newTapTimeoutId,p.isDoubleTap&&l?{newDragState:u,newLastTapTime:d,newLastTapPosition:f,newTapTimeoutId:h}:(t>ur.DEFAULT_SCALE&&(u.start={x:o,y:a},u.startTranslate={...e}),{newDragState:u,newLastTapTime:d,newLastTapPosition:f,newTapTimeoutId:h})}function OO(t,e,n,r,i,s,o,a){let l={...t},c=!1;return r&&(l.start?Math.sqrt(Math.pow(e-l.start.x,2)+Math.pow(n-l.start.y,2)):0)>i&&(c=!0,!l.isDragging&&s>ur.DEFAULT_SCALE&&(o(l.start.x,l.start.y),l.isDragging=!0)),l.isDragging&&a(e,n),{newDragState:l,touchMoved:c}}function MO(t,e,n,r,i){e&&Date.now()-n<200&&!r||i()}function US(t,e,n){return Math.max(e,Math.min(n,t))}function Mge(t,e,n){return Math.abs(t-e)<n}function Nge(t,e,n){const r=e.x-t.x,i=e.y-t.y;return{x:r/n*16,y:i/n*16}}function Rge(t,e,n,r,i,s,o){s!==null&&cancelAnimationFrame(s);let a={...t},l={...e};const c=gI.FRICTION,u=gI.MIN_VELOCITY;function d(){if(a.x*=c,a.y*=c,Math.abs(a.x)<u&&Math.abs(a.y)<u){o(null),i();return}l.x+=a.x,l.y+=a.y,l=is.applyBoundaryConstraints(l,n),r(l),o(requestAnimationFrame(d))}o(requestAnimationFrame(d))}let Rn=Wt({scale:ur.DEFAULT_SCALE,translate:{x:0,y:0},useTransition:!0}),HS=null;function NO(t,e){if(!HS)return t;const{imageWidth:n,imageHeight:r,containerWidth:i}=HS,s=n*e,o=r*e;let a=t.x,l=t.y;if(s>i){const d=(s-i)/2,f=-d;a=US(a,f,d)}else a=0;const c=o/2,u=-c;return l=US(l,u,c),{x:a,y:l}}const is={get state(){return Rn},reset(){Rn.scale=ur.DEFAULT_SCALE,Rn.translate={x:0,y:0},Rn.useTransition=!0},setDirectState(t){Rn.scale=t.scale,Rn.translate={...t.translate},Rn.useTransition=t.useTransition??Rn.useTransition},zoom(t){const e=US(t.scale,ur.MIN_SCALE,ur.MAX_SCALE);if(Mge(e,ur.DEFAULT_SCALE,ur.THRESHOLD)){this.reset();return}const n=e/Rn.scale;Rn.translate.x=Rn.translate.x*n-t.offsetX*(n-1),Rn.translate.y=Rn.translate.y*n-t.offsetY*(n-1),Rn.scale=e},zoomToPoint(t,e=0,n=0){if(Rn.scale>=ur.RESET_THRESHOLD){this.reset();return}const r=t/Rn.scale;Rn.translate.x=Rn.translate.x*r-e*(r-1),Rn.translate.y=Rn.translate.y*r-n*(r-1),Rn.scale=t},drag(t,e,n){const r={x:n.x+t,y:n.y+e},i=NO(r,Rn.scale);Rn.translate.x=i.x,Rn.translate.y=i.y},setTransition(t){Rn.useTransition=t},setBoundaryConstraints(t){HS=t},applyBoundaryConstraints(t,e){return NO(t,e)}};function Dge(){return{isDragging:!1,start:{x:0,y:0},startTranslate:{x:0,y:0}}}function Lge(){return{isPinching:!1,initialDistance:0,initialScale:1,centerX:0,centerY:0}}var Bge=Ce('<div class="fullscreen-overlay svelte-128lph0" tabindex="0" role="dialog" aria-label="ç»åå¨ç»é¢è¡¨ç¤º"><div class="close-button-container svelte-128lph0"><button type="button" class="close-button svelte-128lph0" aria-label="Close fullscreen image"><span class="svg-icon close-icon svelte-128lph0"></span></button></div> <div class="image-container svelte-128lph0"><img class="fullscreen-image svelte-128lph0" draggable="false"/></div></div>');function Fge(t,e){St(e,!0);let n=le(e,"src",3,""),r=le(e,"alt",3,""),i=le(e,"show",15,!1),s=le(e,"onClose",3,()=>{}),o=me(void 0),a=me(void 0),l=me(void 0),c=is.state,u=Dge(),d=Lge(),f=null,h=null,p=null,m=!1,g=0,y=null,b=null,S=0,C=!1,_=10,x=0,I={x:0,y:0},k={x:0,y:0};Ge(()=>{c=is.state,Pge({scale:c.scale,translate:c.translate,useTransition:c.useTransition??!1},E(l))});function T(ve){if(ve.preventDefault(),!E(l)||!E(a))return;const Ie=ve.deltaY>0?ur.ZOOM_DELTA.OUT:ur.ZOOM_DELTA.IN,Oe=c.scale*Ie,qe=Age(ve,E(a),Oe);is.zoom(qe),pu(c.scale,E(l)),ep(c.scale,E(a))}function P(ve,Ie){Gl(!0),setTimeout(()=>{if(c.scale>=ur.RESET_THRESHOLD)is.reset();else{const Oe=ve!==void 0&&Ie!==void 0&&E(a)?Cge(E(a),ve,Ie):{offsetX:0,offsetY:0};is.zoomToPoint(ur.DOUBLE_CLICK_SCALE,Oe.offsetX,Oe.offsetY)}pu(c.scale,E(l))},100)}function O(ve){N(),P(ve.clientX,ve.clientY)}function D(ve,Ie){c.scale<=ur.DEFAULT_SCALE||(u.isDragging=!0,u.start={x:ve,y:Ie},u.startTranslate={...c.translate},x=Date.now(),I={x:ve,y:Ie},k={x:0,y:0},E(l)&&(E(l).style.cursor="grabbing",Gl(!1)),E(a)&&(E(a).style.cursor="grabbing"),AO(!1))}function F(ve,Ie){u.isDragging&&(f!==null&&cancelAnimationFrame(f),f=requestAnimationFrame(()=>{const Oe=_ge({x:ve,y:Ie},u.start);is.drag(Oe.x,Oe.y,u.startTranslate);const qe=Date.now(),Te=qe-x;Te>0&&(k=Nge(I,{x:ve,y:Ie},Te)),x=qe,I={x:ve,y:Ie}}))}function B(){u.isDragging&&(u.isDragging=!1,f!==null&&(cancelAnimationFrame(f),f=null),Xa()?Rge(k,c.translate,c.scale,ve=>{is.setDirectState({...c,translate:ve,useTransition:!1})},()=>{Gl(!0),pu(c.scale,E(l)),ep(c.scale,E(a))},p,ve=>{p=ve}):(pu(c.scale,E(l)),ep(c.scale,E(a)),setTimeout(()=>Gl(!0),50)),AO(!0))}function N(){u.isDragging&&B()}function M(ve){const[Ie,Oe]=[ve.touches[0],ve.touches[1]],qe=Ie.clientX-Oe.clientX,Te=Ie.clientY-Oe.clientY,ze=Math.sqrt(qe*qe+Te*Te);ze>ur.PINCH_MIN_DISTANCE&&(d.isPinching=!0,d.initialDistance=ze,d.initialScale=c.scale,d.centerX=(Ie.clientX+Oe.clientX)/2,d.centerY=(Ie.clientY+Oe.clientY)/2,Gl(!1))}function R(ve){!d.isPinching||!E(a)||(h!==null&&cancelAnimationFrame(h),h=requestAnimationFrame(()=>{const[Ie,Oe]=[ve.touches[0],ve.touches[1]],qe=Ie.clientX-Oe.clientX,Te=Ie.clientY-Oe.clientY,ze=Math.sqrt(qe*qe+Te*Te);if(ze>ur.PINCH_MIN_DISTANCE){const ot=ze/d.initialDistance,ct=Math.max(ur.MIN_SCALE,Math.min(ur.MAX_SCALE,d.initialScale*ot));if(!E(a))return;const pt=E(a).getBoundingClientRect(),$t=pt.width/2,Rt=pt.height/2,Tt=d.centerX-pt.left-$t,Ot=d.centerY-pt.top-Rt,He=ct/c.scale,ut=c.translate.x*He-Tt*(He-1),yt=c.translate.y*He-Ot*(He-1);Ige(ct,ut,yt,E(l))}}))}function H(){if(d.isPinching){if(h!==null&&(cancelAnimationFrame(h),h=null),d.isPinching=!1,E(l)){const ve=E(l).style.transform,Ie=ve.match(/scale\(([^)]+)\)/),Oe=ve.match(/translate\(([^,]+)px,\s*([^)]+)px\)/);if(Ie&&Oe){const qe=parseFloat(Ie[1]),Te=parseFloat(Oe[1])*qe,ze=parseFloat(Oe[2])*qe;is.setDirectState({scale:qe,translate:{x:Te,y:ze},useTransition:!0})}}Gl(!0),pu(c.scale,E(l))}}function z(ve){if(!ve.target?.closest(".close-button-container"))if(ve.preventDefault(),p!==null&&(cancelAnimationFrame(p),p=null,Gl(!0),pu(c.scale,E(l)),ep(c.scale,E(a))),ve.touches.length===1){const Ie=ve.touches[0],Oe=IO(c.scale,c.translate,u,g,b,y,Ie.clientX,Ie.clientY,!0,(qe,Te)=>P(qe,Te));u=Oe.newDragState,g=Oe.newLastTapTime,b=Oe.newLastTapPosition,y=Oe.newTapTimeoutId}else ve.touches.length===2&&(B(),bm(y),M(ve))}function V(ve){if(ve.preventDefault(),ve.touches.length===1){const Ie=ve.touches[0],Oe=OO(u,Ie.clientX,Ie.clientY,!0,_,c.scale,D,F);u=Oe.newDragState,C=Oe.touchMoved}else ve.touches.length===2&&d.isPinching&&R(ve)}function X(ve){ve.preventDefault(),ve.touches.length===0?(MO(u,!0,S,C,B),H()):ve.touches.length===1&&d.isPinching&&H()}function Z(ve){if(ve.target?.closest(".close-button-container"))return;p!==null&&(cancelAnimationFrame(p),p=null,Gl(!0),pu(c.scale,E(l)),ep(c.scale,E(a)));const Ie=IO(c.scale,c.translate,u,g,b,y,ve.clientX,ve.clientY,!1,(Oe,qe)=>P(Oe,qe));u=Ie.newDragState,g=Ie.newLastTapTime,b=Ie.newLastTapPosition,y=Ie.newTapTimeoutId,D(ve.clientX,ve.clientY)}function te(ve){u.isDragging&&(ve.preventDefault(),u=OO(u,ve.clientX,ve.clientY,!1,_,c.scale,D,F).newDragState)}function ne(){MO(u,!1,S,C,B)}function J(ve){ve.key==="Escape"&&Le()}function xe(ve){i()&&m&&(ve.preventDefault(),Jg(f,h,u,d,g),f=null,h=null,g=0,y=null,i(!1),s()())}function Le(){Jg(f,h,u,d,g),f=null,h=null,g=0,y=null,i(!1),s()(),m&&(m=!1,history.back()),xse(Bie.EDITOR,a5.EDITOR_FOCUS_DELAY)}Ge(()=>{i()?(Jg(f,h,u,d,g),f=null,h=null,g=0,y=null,Uu("overflow","hidden"),m||(history.pushState({imageFullscreen:!0},"",""),m=!0),E(o)&&E(o).complete&&PO(E(o),E(a))):(Uu("overflow",""),m=!1)});function he(){const ve=[{event:"mousemove",handler:te,target:document},{event:"mouseup",handler:ne,target:document},{event:"popstate",handler:xe,target:window}];return ve.forEach(({event:Ie,handler:Oe,target:qe})=>qe.addEventListener(Ie,Oe)),ve}function ke(ve){ve.forEach(({event:Ie,handler:Oe,target:qe})=>qe.removeEventListener(Ie,Oe))}bs(()=>{const ve=he();return()=>{ke(ve),bm(y)}}),Zu(()=>{Jg(f,h,u,d,g),m=!1,b=null});var Be=Ue(),je=Ee(Be);{var Fe=ve=>{var Ie=Bge();Ie.__keydown=J,Ie.__mousedown=Z,Ie.__touchstart=z,Ie.__touchmove=V,Ie.__touchend=X;var Oe=ie(Ie),qe=ie(Oe);qe.__click=Le,qe.__touchstart=ot=>ot.stopPropagation(),qe.__touchend=ot=>{ot.stopPropagation(),Le()};var Te=we(Oe,2),ze=ie(Te);ze.__dblclick=O,gr(ze,ot=>K(o,ot),()=>E(o)),gr(Te,ot=>K(l,ot),()=>E(l)),gr(Ie,ot=>K(a,ot),()=>E(a)),Ke(()=>{wn(ze,"src",n()),wn(ze,"alt",r())}),eo("wheel",Ie,T),eo("load",ze,ot=>PO(E(o),E(a))),Y(ve,Ie)};Ve(je,ve=>{i()&&ve(Fe)})}Y(t,Be),kt()}Mi(["keydown","mousedown","touchstart","touchmove","touchend","click","dblclick"]);var $ge=Ce('<div class="upload-error svelte-8mn1et"> </div>'),zge=Ce('<div class="copy-success-message"> </div>'),Uge=Ce('<div class="post-container svelte-8mn1et"><div aria-label="ãã­ã¹ãå¥åã¨ãªã¢" role="textbox" tabindex="0"><!></div> <input type="file" accept="image/*,video/*" multiple style="display: none;"/> <!></div> <!> <!> <!> <!>',1);function Hge(t,e){St(e,!0);const n=()=>Xn(us,"$globalContextMenuStore",i),r=()=>Xn(or,"$_",i),[i,s]=hi();let o=me(null),a=me(null),l=me(!1),c=me(void 0),u=me(void 0),d=Wt({}),f=Wt({}),h=oe(()=>Pn.postStatus),p=oe(()=>Pn.uploadErrorMessage),m=null,g=null,y=oe(()=>va.value),b=oe(()=>E(y).showSecretKeyDialog),S=oe(()=>E(y).showImageFullscreen),C=oe(()=>E(y).fullscreenImageSrc),_=oe(()=>E(y).fullscreenImageAlt),x=oe(()=>E(y).showPopupModal),I=oe(()=>E(y).popupX),k=oe(()=>E(y).popupY),T=oe(()=>E(y).popupMessage),P=me(Wt(n())),O=oe(()=>E(P).open),D=me(0),F=me(0),B=me(Wt([]));Ge(()=>us.subscribe(ut=>{K(P,ut,!0)})),Ge(()=>{e.rxNostr&&(E(u)?E(u).setRxNostr(e.rxNostr):K(u,new Cme(e.rxNostr),!0))});async function N(He){!He||He.length===0||await fge({files:He,currentEditor:E(a),fileInput:E(c),onUploadProgress:e.onUploadProgress,updateUploadState:(ut,yt)=>{Pn.isUploading=ut,Pn.uploadErrorMessage=yt||""},imageOxMap:d,imageXMap:f,videoCompressionProgressStore:Ap,imageCompressionProgressStore:Pp,getUploadFailedText:ut=>r()(ut)})}bs(()=>{const He=r()("postComponent.enter_your_text")||"ãã­ã¹ããå¥åãã¦ãã ãã";return g=vme({placeholderText:He,editorContainerEl:m,currentEditor:E(a),hasStoredKey:e.hasStoredKey,submitPost:X,uploadFiles:ut=>{N(ut)},eventCallbacks:{onContentUpdate:mme,onImageFullscreenRequest:(ut,yt)=>{va.showImageFullscreen(ut,yt)},onSelectImageNode:ut=>{}}}),K(o,g.editor,!0),E(o).subscribe(ut=>{K(a,ut,!0),fC.set(ut)}),()=>{g&&xme({unsubscribe:g.unsubscribe,handlers:g.handlers,currentEditor:E(a),editorContainerEl:m})}});function M(He){const ut=He.target;ut?.files?.length&&N(ut.files)}async function R(He){await N(He)}function H(He){if(!E(a)||!He)return;const ut=E(a),Kt=He.split(`
`).map(Ht=>({type:"paragraph",content:Ht?[{type:"text",text:Ht}]:void 0}));ut.commands.setContent({type:"doc",content:Kt}),ut.commands.focus("end")}function z(He){!E(a)||!He||(E(a).commands.setContent(He),E(a).commands.focus("end"))}function V(){return E(a)?E(a).getHTML():""}async function X(){if(!E(u)||!E(a))return;const He=E(u).preparePostContent(E(a));if(hoe(He)){va.showSecretKeyDialog(He);return}await E(u).performPostSubmission(E(a),d,f,()=>Ca({sending:!0,success:!1,error:!1,message:"",completed:!1}),()=>{Ca({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),te(),e.onPostSuccess?.()},ut=>Ca({sending:!1,success:!1,error:!0,message:ut||"postComponent.post_error",completed:!1}))}function Z(){E(u)&&E(a)&&E(u).resetPostContent(E(a))}function te(){E(u)&&E(a)&&E(u).clearContentAfterSuccess(E(a))}function ne(){Vc.querySelector(".tiptap-editor")?.focus()}async function J(){const He=va.getPendingPost();if(va.hideSecretKeyDialog(),E(u)&&E(a)){const ut=E(u).prepareImageBlurhashMap(E(a),d,f);Ca({sending:!0,success:!1,error:!1,message:"",completed:!1});try{const yt=await E(u).submitPost(He,ut);yt.success?(Ca({sending:!1,success:!0,error:!1,message:"postComponent.post_success",completed:!0}),te(),e.onPostSuccess?.()):Ca({sending:!1,success:!1,error:!0,message:yt.error||"postComponent.post_error",completed:!1})}catch{Ca({sending:!1,success:!1,error:!0,message:"postComponent.post_error",completed:!1})}}}function xe(){va.hideSecretKeyDialog()}function Le(){va.hideImageFullscreen(),setTimeout(()=>{Vc.querySelector(".tiptap-editor")?.focus()},150)}Ge(()=>{if(E(O)&&E(P).nodeId){const He=E(P).nodeId;let ut=!1;E(a)?.state?.doc&&E(a).state.doc.descendants(Kt=>{if(Kt.attrs.id===He)return ut=Kt.type.name==="video",!1});let yt;ut?yt=Jfe(E(P),E(a),Za.value):yt=nme(E(P),E(a),Za.value),yt&&(K(B,yt.items,!0),K(D,yt.x,!0),K(F,yt.y,!0))}}),Ge(()=>{E(a)&&E(u)&&E(u).preparePostContent(E(a))!==Pn.content&&E(h).error&&Ca({...E(h),error:!1,message:""})});function he(){E(c)?.click()}var ke={uploadFiles:R,insertTextContent:H,loadDraftContent:z,getEditorHtml:V,submitPost:X,resetPostContent:Z,clearContentAfterSuccess:te,focusEditor:ne,openFileDialog:he},Be=Uge(),je=Ee(Be),Fe=ie(je);let ve;var Ie=ie(Fe);{var Oe=He=>{ife(He,{get editor(){return E(a)},class:"editor-content"})};Ve(Ie,He=>{E(o)&&E(a)&&He(Oe)})}Sg(Fe,(He,ut)=>Cfe?.(He,ut),()=>({dragOver:He=>K(l,He,!0)})),Sg(Fe,He=>_fe?.(He)),Sg(Fe,He=>Afe?.(He)),Sg(Fe,He=>Pfe?.(He)),gr(Fe,He=>m=He,()=>m);var qe=we(Fe,2);qe.__change=M,gr(qe,He=>K(c,He),()=>E(c));var Te=we(qe,2);{var ze=He=>{var ut=$ge(),yt=ie(ut);Ke(()=>Re(yt,E(p))),Y(He,ut)};Ve(Te,He=>{E(p)&&He(ze)})}var ot=we(je,2);Tge(ot,{onConfirm:J,onCancel:xe,get show(){return E(b)},set show(He){K(b,He)}});var ct=we(ot,2);Fge(ct,{get src(){return E(C)},get alt(){return E(_)},onClose:Le,get show(){return E(S)},set show(He){K(S,He)}});var pt=we(ct,2);{var $t=He=>{yge(He,{get x(){return E(D)},get y(){return E(F)},get items(){return E(B)},onClose:()=>us.set({open:!1,nodeId:void 0,src:void 0}),get onShowPopup(){return va.showPopupMessage}})};Ve(pt,He=>{E(O)&&He($t)})}var Rt=we(pt,2);{var Tt=He=>{gC(He,{get show(){return E(x)},get x(){return E(I)},get y(){return E(k)},onClose:()=>va.hidePopupMessage(),children:(ut,yt)=>{var Kt=zge(),Ht=ie(Kt);Ke(()=>Re(Ht,E(T))),Y(ut,Kt)},$$slots:{default:!0}})};Ve(Rt,He=>{E(x)&&He(Tt)})}Ke(()=>ve=ao(Fe,1,"editor-container svelte-8mn1et",null,ve,{"drag-over":E(l)})),Y(t,Be);var Ot=kt(ke);return s(),Ot}Mi(["change"]);var Vge=Ce('<input type="radio" style="display: none;"/> <!>',1);function RO(t,e){St(e,!0);let n=le(e,"checked",3,!1),r=le(e,"disabled",3,!1),i=le(e,"variant",3,"default"),s=le(e,"shape",3,"rounded"),o=le(e,"className",3,""),a=le(e,"ariaLabel",3,""),l=le(e,"style",3,""),c;function u(){!r()&&c&&c.click()}function d(){e.onChange&&e.onChange(e.value)}var f=Vge(),h=Ee(f);h.__change=d,gr(h,m=>c=m,()=>c);var p=we(h,2);en(p,{get variant(){return i()},get shape(){return s()},get className(){return o()},get ariaLabel(){return a()},get style(){return l()},get disabled(){return r()},get selected(){return n()},onClick:u,children:(m,g)=>{var y=Ue(),b=Ee(y);_t(b,()=>e.children??Ft),Y(m,y)},$$slots:{default:!0}}),Ke(()=>{uM(h,e.value),wn(h,"name",e.name),$9(h,n()),h.disabled=r()}),Y(t,f),kt()}Mi(["change"]);var Wge={203:(t,e)=>{function n(T){if(!Number.isSafeInteger(T))throw new Error(`Wrong integer: ${T}`)}function r(...T){const P=(F,B)=>N=>F(B(N)),O=Array.from(T).reverse().reduce(((F,B)=>F?P(F,B.encode):B.encode),void 0),D=T.reduce(((F,B)=>F?P(F,B.decode):B.decode),void 0);return{encode:O,decode:D}}function i(T){return{encode:P=>{if(!Array.isArray(P)||P.length&&typeof P[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return P.map((O=>{if(n(O),O<0||O>=T.length)throw new Error(`Digit index outside alphabet: ${O} (alphabet: ${T.length})`);return T[O]}))},decode:P=>{if(!Array.isArray(P)||P.length&&typeof P[0]!="string")throw new Error("alphabet.decode input should be array of strings");return P.map((O=>{if(typeof O!="string")throw new Error(`alphabet.decode: not string element=${O}`);const D=T.indexOf(O);if(D===-1)throw new Error(`Unknown letter: "${O}". Allowed: ${T}`);return D}))}}}function s(T=""){if(typeof T!="string")throw new Error("join separator should be string");return{encode:P=>{if(!Array.isArray(P)||P.length&&typeof P[0]!="string")throw new Error("join.encode input should be array of strings");for(let O of P)if(typeof O!="string")throw new Error(`join.encode: non-string input=${O}`);return P.join(T)},decode:P=>{if(typeof P!="string")throw new Error("join.decode input should be string");return P.split(T)}}}function o(T,P="="){if(n(T),typeof P!="string")throw new Error("padding chr should be string");return{encode(O){if(!Array.isArray(O)||O.length&&typeof O[0]!="string")throw new Error("padding.encode input should be array of strings");for(let D of O)if(typeof D!="string")throw new Error(`padding.encode: non-string input=${D}`);for(;O.length*T%8;)O.push(P);return O},decode(O){if(!Array.isArray(O)||O.length&&typeof O[0]!="string")throw new Error("padding.encode input should be array of strings");for(let F of O)if(typeof F!="string")throw new Error(`padding.decode: non-string input=${F}`);let D=O.length;if(D*T%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;D>0&&O[D-1]===P;D--)if(!((D-1)*T%8))throw new Error("Invalid padding: string has too much padding");return O.slice(0,D)}}}function a(T){if(typeof T!="function")throw new Error("normalize fn should be function");return{encode:P=>P,decode:P=>T(P)}}function l(T,P,O){if(P<2)throw new Error(`convertRadix: wrong from=${P}, base cannot be less than 2`);if(O<2)throw new Error(`convertRadix: wrong to=${O}, base cannot be less than 2`);if(!Array.isArray(T))throw new Error("convertRadix: data should be array");if(!T.length)return[];let D=0;const F=[],B=Array.from(T);for(B.forEach((N=>{if(n(N),N<0||N>=P)throw new Error(`Wrong integer: ${N}`)}));;){let N=0,M=!0;for(let R=D;R<B.length;R++){const H=B[R],z=P*N+H;if(!Number.isSafeInteger(z)||P*N/P!==N||z-H!=P*N)throw new Error("convertRadix: carry overflow");if(N=z%O,B[R]=Math.floor(z/O),!Number.isSafeInteger(B[R])||B[R]*O+N!==z)throw new Error("convertRadix: carry overflow");M&&(B[R]?M=!1:D=R)}if(F.push(N),M)break}for(let N=0;N<T.length-1&&T[N]===0;N++)F.push(0);return F.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const c=(T,P)=>P?c(P,T%P):T,u=(T,P)=>T+(P-c(T,P));function d(T,P,O,D){if(!Array.isArray(T))throw new Error("convertRadix2: data should be array");if(P<=0||P>32)throw new Error(`convertRadix2: wrong from=${P}`);if(O<=0||O>32)throw new Error(`convertRadix2: wrong to=${O}`);if(u(P,O)>32)throw new Error(`convertRadix2: carry overflow from=${P} to=${O} carryBits=${u(P,O)}`);let F=0,B=0;const N=2**O-1,M=[];for(const R of T){if(n(R),R>=2**P)throw new Error(`convertRadix2: invalid data word=${R} from=${P}`);if(F=F<<P|R,B+P>32)throw new Error(`convertRadix2: carry overflow pos=${B} from=${P}`);for(B+=P;B>=O;B-=O)M.push((F>>B-O&N)>>>0);F&=2**B-1}if(F=F<<O-B&N,!D&&B>=P)throw new Error("Excess padding");if(!D&&F)throw new Error(`Non-zero padding: ${F}`);return D&&B>0&&M.push(F>>>0),M}function f(T){return n(T),{encode:P=>{if(!(P instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return l(Array.from(P),256,T)},decode:P=>{if(!Array.isArray(P)||P.length&&typeof P[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(l(P,T,256))}}}function h(T,P=!1){if(n(T),T<=0||T>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,T)>32||u(T,8)>32)throw new Error("radix2: carry overflow");return{encode:O=>{if(!(O instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return d(Array.from(O),8,T,!P)},decode:O=>{if(!Array.isArray(O)||O.length&&typeof O[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(d(O,T,8,P))}}}function p(T){if(typeof T!="function")throw new Error("unsafeWrapper fn should be function");return function(...P){try{return T.apply(null,P)}catch{}}}function m(T,P){if(n(T),typeof P!="function")throw new Error("checksum fn should be function");return{encode(O){if(!(O instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const D=P(O).slice(0,T),F=new Uint8Array(O.length+T);return F.set(O),F.set(D,O.length),F},decode(O){if(!(O instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const D=O.slice(0,-T),F=P(D).slice(0,T),B=O.slice(-T);for(let N=0;N<T;N++)if(F[N]!==B[N])throw new Error("Invalid checksum");return D}}}e.utils={alphabet:i,chain:r,checksum:m,radix:f,radix2:h,join:s,padding:o},e.base16=r(h(4),i("0123456789ABCDEF"),s("")),e.base32=r(h(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),e.base32hex=r(h(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),e.base32crockford=r(h(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a((T=>T.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),e.base64url=r(h(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const g=T=>r(f(58),i(T),s(""));e.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(T){let P="";for(let O=0;O<T.length;O+=8){const D=T.subarray(O,O+8);P+=e.base58.encode(D).padStart(y[D.length],"1")}return P},decode(T){let P=[];for(let O=0;O<T.length;O+=11){const D=T.slice(O,O+11),F=y.indexOf(D.length),B=e.base58.decode(D);for(let N=0;N<B.length-F;N++)if(B[N]!==0)throw new Error("base58xmr: wrong padding");P=P.concat(Array.from(B.slice(B.length-F)))}return Uint8Array.from(P)}},e.base58check=T=>r(m(4,(P=>T(T(P)))),e.base58);const b=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),S=[996825010,642813549,513874426,1027748829,705979059];function C(T){const P=T>>25;let O=(33554431&T)<<5;for(let D=0;D<S.length;D++)(P>>D&1)==1&&(O^=S[D]);return O}function _(T,P,O=1){const D=T.length;let F=1;for(let B=0;B<D;B++){const N=T.charCodeAt(B);if(N<33||N>126)throw new Error(`Invalid prefix (${T})`);F=C(F)^N>>5}F=C(F);for(let B=0;B<D;B++)F=C(F)^31&T.charCodeAt(B);for(let B of P)F=C(F)^B;for(let B=0;B<6;B++)F=C(F);return F^=O,b.encode(d([F%2**30],30,5,!1))}function x(T){const P=T==="bech32"?1:734539939,O=h(5),D=O.decode,F=O.encode,B=p(D);function N(M,R=90){if(typeof M!="string")throw new Error("bech32.decode input should be string, not "+typeof M);if(M.length<8||R!==!1&&M.length>R)throw new TypeError(`Wrong string length: ${M.length} (${M}). Expected (8..${R})`);const H=M.toLowerCase();if(M!==H&&M!==M.toUpperCase())throw new Error("String must be lowercase or uppercase");const z=(M=H).lastIndexOf("1");if(z===0||z===-1)throw new Error('Letter "1" must be present between prefix and data only');const V=M.slice(0,z),X=M.slice(z+1);if(X.length<6)throw new Error("Data must be at least 6 characters long");const Z=b.decode(X).slice(0,-6),te=_(V,Z,P);if(!X.endsWith(te))throw new Error(`Invalid checksum in ${M}: expected "${te}"`);return{prefix:V,words:Z}}return{encode:function(M,R,H=90){if(typeof M!="string")throw new Error("bech32.encode prefix should be string, not "+typeof M);if(!Array.isArray(R)||R.length&&typeof R[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof R);const z=M.length+7+R.length;if(H!==!1&&z>H)throw new TypeError(`Length ${z} exceeds limit ${H}`);return`${M=M.toLowerCase()}1${b.encode(R)}${_(M,R,P)}`},decode:N,decodeToBytes:function(M){const{prefix:R,words:H}=N(M,!1);return{prefix:R,words:H,bytes:D(H)}},decodeUnsafe:p(N),fromWords:D,fromWordsUnsafe:B,toWords:F}}e.bech32=x("bech32"),e.bech32m=x("bech32m"),e.utf8={encode:T=>new TextDecoder().decode(T),decode:T=>new TextEncoder().encode(T)},e.hex=r(h(4),i("0123456789abcdef"),s(""),a((T=>{if(typeof T!="string"||T.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof T} with length ${T.length}`);return T.toLowerCase()})));const I={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},k=`Invalid encoding type. Available types: ${Object.keys(I).join(", ")}`;e.bytesToString=(T,P)=>{if(typeof T!="string"||!I.hasOwnProperty(T))throw new TypeError(k);if(!(P instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return I[T].encode(P)},e.str=e.bytesToString,e.stringToBytes=(T,P)=>{if(!I.hasOwnProperty(T))throw new TypeError(k);if(typeof P!="string")throw new TypeError("stringToBytes() expects string");return I[T].decode(P)},e.bytes=e.stringToBytes},806:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(601),i=n.n(r),s=n(314),o=n.n(s)()(i());o.push([t.id,`.zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

/* Color Classes Generator */
[class*="zap-amount-"] .zap-sender {
  border-radius: 6px;
}

[class*="zap-amount-"] .zap-sender.with-comment {
  border-radius: 6px 6px 0 0;
}

[class*="zap-amount-"] .zap-details {
  padding-top: 8px;
  padding-bottom: 8px;
}

/* Amount-based Styles */
.zap-amount-100 .zap-sender {
  background-color: var(--zap-100);
}

.zap-amount-200 .zap-sender {
  background-color: var(--zap-200);
}

.zap-amount-500 .zap-sender {
  background-color: var(--zap-500);
}

.zap-amount-1k .zap-sender {
  background-color: var(--zap-1k);
}

.zap-amount-2k .zap-sender {
  background-color: var(--zap-2k);
}

.zap-amount-5k .zap-sender {
  background-color: var(--zap-5k);
}

.zap-amount-10k .zap-sender {
  background-color: var(--zap-10k);
}

/* Details Background Colors */
.zap-amount-100 .zap-details {
  background-color: var(--zap-100-light);
}

.zap-amount-200 .zap-details {
  background-color: var(--zap-200-light);
}

.zap-amount-500 .zap-details {
  background-color: var(--zap-500-light);
}

.zap-amount-1k .zap-details {
  background-color: var(--zap-1k-light);
}

.zap-amount-2k .zap-details {
  background-color: var(--zap-2k-light);
}

.zap-amount-5k .zap-details {
  background-color: var(--zap-5k-light);
}

.zap-amount-10k .zap-details {
  background-color: var(--zap-10k-light);
}

/* Dark Text Colors */
.zap-amount-100,
.zap-amount-2k,
.zap-amount-5k,
.zap-amount-10k {
  .zap-amount {
    color: var(--text-light);
  }

  .sender-name {
    color: var(--text-light-secondary);
  }

  .sender-pubkey {
    color: var(--text-light-tertiary);
  }

  .zap-comment {
    color: var(--text-light);
  }
}

/* Light Text Colors */
.zap-amount-200,
.zap-amount-500,
.zap-amount-1k {
  .zap-amount {
    color: var(--text-dark);
  }

  .sender-name {
    color: var(--text-dark-secondary);
  }

  .sender-pubkey {
    color: var(--text-dark-tertiary);
  }

  .zap-comment {
    color: var(--text-dark);
  }
}`,""]);const a=o},540:(t,e,n)=>{n.r(e),n.d(e,{default:()=>c});var r=n(601),i=n.n(r),s=n(314),o=n.n(s),a=n(806),l=o()(i());l.i(a.A),l.push([t.id,`/* styles.css */

:host {
  --main-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  --main-text: Black;
  --pubkey-text: #888;
  --custom-title-text: #555;
  --stats-item-text: #333;
  --name-text: #444;
  --dialog-bg: #ffffff;
  --zap-stats-bg: #edf2f7;
  --hover-bg: #edf2f7;
  --border: #ddd;
  --skeleton: #fdfdfd;
  --skeleton2: #e2e5ec;
  --zap-stats-skeleton-bg: #bbc5cf;
  --new-mark: #22c55e;

  /* Zap Amount Colors */
  --zap-100: #1565c0;
  --zap-200: #00b8d4;
  --zap-500: #00bfa5;
  --zap-1k: #ffb300;
  --zap-2k: #e65100;
  --zap-5k: #c2185b;
  --zap-10k: #d00000;

  /* Light Variants */
  --zap-100-light: #1e88e5;
  --zap-200-light: #00e5ff;
  --zap-500-light: #1de9b6;
  --zap-1k-light: #ffca28;
  --zap-2k-light: #f57c00;
  --zap-5k-light: #e91e63;
  --zap-10k-light: #e62117;

  /* Text Colors */
  --text-light: #ffffff;
  --text-light-secondary: rgba(255, 255, 255, 0.9);
  --text-light-tertiary: rgba(255, 255, 255, 0.5);
  --text-dark: #000000;
  --text-dark-secondary: rgba(0, 0, 0, 0.7);
  --text-dark-tertiary: rgba(0, 0, 0, 0.5);
}

* {
  box-sizing: border-box;
}

button {
  color: var(--main-text);
  background: none;
  border: none;
  cursor: pointer;
}

.dialog {
  font-family: var(--main-font);
  color: var(--main-text);
  font-size: medium;
  font-weight: normal;
  max-height: 700px;
  height: 100dvh;
  width: 360px;
  margin: auto;
  padding: 0;
  border: none;
  border-radius: 10px;
  background: var(--dialog-bg);
  display: flex;
  flex-direction: column;
}

.close-dialog-button {
  color: var(--custom-title-text);
  font-size: 16px;
  font-weight: 500;
  position: absolute;
  right: 0;
  width: 2.625rem;
  height: 2.625rem;
  border: none;
  border-radius: 50%;
  background: none;
  cursor: pointer;
  padding: 10px;
  text-align: center;
}

.close-dialog-button:hover {
  background-color: var(--hover-bg);
}

.dialog-title {
  height: 42px;
  margin: 0;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;

  & a {
    font-size: 0.9rem;
    font-weight: normal;
    color: var(--pubkey-text);
    text-decoration: none;
    cursor: pointer;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
  }

  & a:hover {
    text-decoration: underline;
  }
}

.dialog-title.custom-title a {
  color: var(--custom-title-text);
  font-weight: 600;
  font-size: 1rem;
}

.zap-stats {
  min-height: 80px;
  padding: 6px 14px;
  background: var(--zap-stats-bg);
  border-radius: 6px;
  display: grid;
  grid-template-columns: 90px 1fr 40px;
  grid-template-rows: repeat(3, 1fr);
  gap: 4px;
  margin: 0 8px;

  .stats-item {
    height: 23px;
    color: var(--stats-item-text);
    font-size: 0.9rem;

    .number {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .number.skeleton {
      width: 100%;
      background: linear-gradient(90deg,
          var(--skeleton) 0%,
          var(--zap-stats-skeleton-bg) 50%,
          var(--skeleton) 100%);
      background-size: 200% 100%;
    }
  }
}

.stats-item:nth-child(3n + 1) {
  justify-content: flex-start;
}

.stats-item:nth-child(3n + 2),
.stats-item:nth-child(3n + 3) {
  justify-content: flex-end;
}

.text-muted {
  margin-right: 16px;
  opacity: 0.4;
}

.dialog-zap-list {
  list-style-type: none;
  margin: 10px 0;
  padding: 0 6px;
  flex: 1;
  overflow-y: auto;
  overscroll-behavior: contain;
  scroll-behavior: smooth;

  /* ã¹ã¯ã­ã¼ã«ãã¼ã®ã¹ã¿ã¤ãªã³ã° */
  &::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  &::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 3px;
  }

  &::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    transition: background 0.2s;
  }

  &::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.2);
  }

  /* Firefoxç¨ã®ã¹ã¯ã­ã¼ã«ãã¼ã¹ã¿ã¤ã« */
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 0, 0, 0.1) transparent;
}

.zap-list-item {
  display: flex;
  flex-direction: column;
  border-top: 1px solid var(--border);
  padding: 4px 0;
}

.zap-content {
  display: flex;
  flex-direction: column;
}

.reference-container {
  display: flex;
  flex-direction: column;
}

.zap-sender {
  gap: 12px;
  height: 46px;
  justify-content: space-between;
  padding: 6px;
}

.sender-icon {
  flex-shrink: 0;

  & img {
    width: 100%;
    height: 100%;
    border-radius: 4px;
    object-fit: cover;
    object-position: center;
  }
}

.sender-icon.is-new::before {
  content: "";
  position: absolute;
  top: -4px;
  left: -4px;
  width: 8px;
  height: 8px;
  background-color: var(--new-mark);
  border: 1px solid #fff;
  border-radius: 50%;
  z-index: 1;
  animation: pulse 2500ms cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  50% {
    opacity: 0.3;
  }
}

.sender-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  overflow: hidden;
  min-width: 0;
}

.sender-name {
  font-size: 0.9375rem;
  font-weight: bold;
  color: var(--name-text);
}

.sender-pubkey {
  font-size: 0.625rem;
  color: var(--pubkey-text);
  margin-top: -1px;
}

.zap-amount {
  font-size: 0.8rem;
  white-space: nowrap;
  flex-shrink: 0;

  .number {
    font-size: 1.4rem;
    font-weight: 500;
    text-align: right;
  }
}

.zap-details {
  padding: 2px 8px;
  border-radius: 0 0 6px 6px;
  margin: 0;
}

.zap-comment {
  font-size: 0.9375rem;
  margin: 0;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  max-width: 100%;
}

.no-zaps-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

.no-zaps-message {
  text-align: center;
  color: var(--pubkey-text);
  font-size: 1.8rem;
  font-weight: 700;
}

.zap-reference {
  padding: 2px 0 2px 12px;
  margin: 0;
  font-size: 0.875rem;
  color: var(--pubkey-text);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.reference-arrow {
  flex-shrink: 0;

  img {
    height: 16px;
    width: auto;
  }
}

.reference-text {
  font-size: 0.75rem;
  margin: 0 2px;
  flex-grow: 1;
}

.reference-link {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 1.5rem;
  width: 2.6rem;
  text-decoration: none;
  border-left: 1px solid var(--border);
  flex-shrink: 0;

  & img {
    height: 20px;
    width: auto;
  }
}

.zap-placeholder-name {
  height: 30px;
  width: 140px;
}

.zap-placeholder-name.skeleton {
  width: 120px;
  height: 19px;
  margin: 2px 0;
}

.skeleton {
  color: transparent;
  border-radius: 2px;
  background: linear-gradient(90deg,
      var(--skeleton) 0%,
      var(--skeleton2) 50%,
      var(--skeleton) 100%);
  background-size: 200% 100%;
  animation: loading-animation 3.5s infinite;
  opacity: 0.7;
}

@keyframes loading-animation {
  0% {
    background-position: 200% 0;
  }

  100% {
    background-position: -200% 0;
  }
}

/* å±éã®ãã­ã¹ããªã¼ãã¼ãã­ã¼å¦ç */
.dialog-title,
.sender-name,
.sender-pubkey,
.reference-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* å±éã®ãã¬ãã¯ã¹ããã¯ã¹è¨­å® */
.zap-sender,
.stats-item,
.zap-details,
.reference-link,
.zap-reference {
  display: flex;
  align-items: center;
}

/* å±éã®ã¢ã¤ã³ã³ãµã¤ãº */
.zap-placeholder-icon,
.sender-icon {
  width: 32px;
  height: 32px;
  border-radius: 4px;
  position: relative;
}

.load-more-trigger {
  height: 40px;
  margin: 10px 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--zap-stats-bg);
  border-top: 3px solid var(--pubkey-text);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}`,""]);const c=l},314:t=>{t.exports=function(e){var n=[];return n.toString=function(){return this.map((function(r){var i="",s=r[5]!==void 0;return r[4]&&(i+="@supports (".concat(r[4],") {")),r[2]&&(i+="@media ".concat(r[2]," {")),s&&(i+="@layer".concat(r[5].length>0?" ".concat(r[5]):""," {")),i+=e(r),s&&(i+="}"),r[2]&&(i+="}"),r[4]&&(i+="}"),i})).join("")},n.i=function(r,i,s,o,a){typeof r=="string"&&(r=[[null,r,void 0]]);var l={};if(s)for(var c=0;c<this.length;c++){var u=this[c][0];u!=null&&(l[u]=!0)}for(var d=0;d<r.length;d++){var f=[].concat(r[d]);s&&l[f[0]]||(a!==void 0&&(f[5]===void 0||(f[1]="@layer".concat(f[5].length>0?" ".concat(f[5]):""," {").concat(f[1],"}")),f[5]=a),i&&(f[2]&&(f[1]="@media ".concat(f[2]," {").concat(f[1],"}")),f[2]=i),o&&(f[4]?(f[1]="@supports (".concat(f[4],") {").concat(f[1],"}"),f[4]=o):f[4]="".concat(o)),n.push(f))}},n}},601:t=>{t.exports=function(e){return e[1]}},705:(t,e,n)=>{const{bech32:r,hex:i,utf8:s}=n(203),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},u={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},d=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],f={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},h=BigInt("2100000000000000000"),p=BigInt(1e11),m={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},g={};for(let _=0,x=Object.keys(m);_<x.length;_++){const I=x[_],k=m[x[_]].toString();g[k]=I}const y={1:_=>i.encode(r.fromWordsUnsafe(_)),16:_=>i.encode(r.fromWordsUnsafe(_)),13:_=>s.encode(r.fromWordsUnsafe(_)),19:_=>i.encode(r.fromWordsUnsafe(_)),23:_=>i.encode(r.fromWordsUnsafe(_)),27:_=>i.encode(r.fromWordsUnsafe(_)),6:S,24:S,3:function(_){const x=[];let I,k,T,P,O,D=r.fromWordsUnsafe(_);for(;D.length>0;)I=i.encode(D.slice(0,33)),k=i.encode(D.slice(33,41)),T=parseInt(i.encode(D.slice(41,45)),16),P=parseInt(i.encode(D.slice(45,49)),16),O=parseInt(i.encode(D.slice(49,51)),16),D=D.slice(51),x.push({pubkey:I,short_channel_id:k,fee_base_msat:T,fee_proportional_millionths:P,cltv_expiry_delta:O});return x},5:function(_){const x=_.slice().reverse().map((T=>[!!(1&T),!!(2&T),!!(4&T),!!(8&T),!!(16&T)])).reduce(((T,P)=>T.concat(P)),[]);for(;x.length<2*d.length;)x.push(!1);const I={};d.forEach(((T,P)=>{let O;O=x[2*P]?"required":x[2*P+1]?"supported":"unsupported",I[T]=O}));const k=x.slice(2*d.length);return I.extra_bits={start_bit:2*d.length,bits:k,has_required:k.reduce(((T,P,O)=>O%2!=0?T||!1:T||P),!1)},I}};function b(_){return x=>({tagCode:parseInt(_),words:r.encode("unknown",x,Number.MAX_SAFE_INTEGER)})}function S(_){return _.reverse().reduce(((x,I,k)=>x+I*Math.pow(32,k)),0)}function C(_,x){let I,k;if(_.slice(-1).match(/^[munp]$/))I=_.slice(-1),k=_.slice(0,-1);else{if(_.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");k=_}if(!k.match(/^\d+$/))throw new Error("Not a valid human readable amount");const T=BigInt(k),P=I?T*p/f[I]:T*p;if(I==="p"&&T%BigInt(10)!==BigInt(0)||P>h)throw new Error("Amount is outside of valid range");return x?P.toString():P}t.exports={decode:function(_,x){if(typeof _!="string")throw new Error("Lightning Payment Request must be string");if(_.slice(0,2).toLowerCase()!=="ln")throw new Error("Not a proper lightning payment request");const I=[],k=r.decode(_,Number.MAX_SAFE_INTEGER);_=_.toLowerCase();const T=k.prefix;let P=k.words,O=_.slice(T.length+1),D=P.slice(-104);P=P.slice(0,-104);let F=T.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(F&&!F[2]&&(F=T.match(/^ln(\S+)$/)),!F)throw new Error("Not a proper lightning payment request");I.push({name:"lightning_network",letters:"ln"});const B=F[1];let N;if(x){if(x.bech32===void 0||x.pubKeyHash===void 0||x.scriptHash===void 0||!Array.isArray(x.validWitnessVersions))throw new Error("Invalid network");N=x}else switch(B){case o.bech32:N=o;break;case a.bech32:N=a;break;case l.bech32:N=l;break;case c.bech32:N=c;break;case u.bech32:N=u}if(!N||N.bech32!==B)throw new Error("Unknown coin bech32 prefix");I.push({name:"coin_network",letters:B,value:N});const M=F[2];let R;M?(R=C(M+F[3],!0),I.push({name:"amount",letters:F[2]+F[3],value:R})):R=null,I.push({name:"separator",letters:"1"});const H=S(P.slice(0,7));let z,V,X,Z;for(P=P.slice(7),I.push({name:"timestamp",letters:O.slice(0,7),value:H}),O=O.slice(7);P.length>0;){const J=P[0].toString();z=g[J]||"unknown_tag",V=y[J]||b(J),P=P.slice(1),X=S(P.slice(0,2)),P=P.slice(2),Z=P.slice(0,X),P=P.slice(X),I.push({name:z,tag:O[0],letters:O.slice(0,3+X),value:V(Z)}),O=O.slice(3+X)}I.push({name:"signature",letters:O.slice(0,104),value:i.encode(r.fromWordsUnsafe(D))}),O=O.slice(104),I.push({name:"checksum",letters:O});let te={paymentRequest:_,sections:I,get expiry(){let J=I.find((xe=>xe.name==="expiry"));if(J)return ne("timestamp")+J.value},get route_hints(){return I.filter((J=>J.name==="route_hint")).map((J=>J.value))}};for(let J in m)J!=="route_hint"&&Object.defineProperty(te,J,{get:()=>ne(J)});return te;function ne(J){let xe=I.find((Le=>Le.name===J));return xe?xe.value:void 0}},hrpToMillisat:C}},0:(t,e,n)=>{var r=n(540);r&&r.__esModule&&(r=r.default),t.exports=typeof r=="string"?r:r.toString()}},DO={};function ui(t){var e=DO[t];if(e!==void 0)return e.exports;var n=DO[t]={id:t,exports:{}};return Wge[t](n,n.exports,ui),n.exports}ui.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return ui.d(e,{a:e}),e},ui.d=(t,e)=>{for(var n in e)ui.o(e,n)&&!ui.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},ui.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),ui.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var ua={};ui.d(ua,{vQ:()=>Et,ZM:()=>km,yk:()=>ht,h0:()=>Lu,n_:()=>V$,Xz:()=>Fwe,Uv:()=>Em,fU:()=>Tm,Dw:()=>Fo});var VS={};ui.r(VS),ui.d(VS,{OG:()=>vC,My:()=>nh,Ph:()=>Ki,lX:()=>bC,Id:()=>fd,fg:()=>RB,qj:()=>ci,aT:()=>wm,lq:()=>Rc,z:()=>wC,Q5:()=>vm});var WS={};ui.r(WS),ui.d(WS,{Relay:()=>WF,SimplePool:()=>obe,finalizeEvent:()=>mo,fj:()=>BF,generateSecretKey:()=>SF,getEventHash:()=>Hp,getFilterLimit:()=>Yye,getPublicKey:()=>OC,kinds:()=>kF,matchFilter:()=>DF,matchFilters:()=>LF,mergeFilters:()=>Qye,nip04:()=>KF,nip05:()=>XF,nip10:()=>YF,nip11:()=>JF,nip13:()=>e$,nip18:()=>r$,nip19:()=>jF,nip21:()=>s$,nip25:()=>o$,nip27:()=>a$,nip28:()=>l$,nip30:()=>c$,nip39:()=>d$,nip42:()=>zF,nip44:()=>f$,nip47:()=>y$,nip57:()=>b$,nip59:()=>w$,nip98:()=>A$,parseReferences:()=>mbe,serializeEvent:()=>xF,sortEvents:()=>D0e,utils:()=>bF,validateEvent:()=>Uw,verifiedSymbol:()=>oc,verifyEvent:()=>Sh});var jge=ui(705);function LO(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function PB(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function qge(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");LO(t.outputLen),LO(t.blockLen)}function xb(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Kge(t,e){PB(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const _2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,IB=t=>t instanceof Uint8Array,A2=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Co=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function yC(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!IB(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class OB{clone(){return this._cloneInto()}}function Gge(t){const e=r=>t().update(yC(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function MB(t=32){if(_2&&typeof _2.getRandomValues=="function")return _2.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class Zge extends OB{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=A2(this.buffer)}update(e){xb(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=yC(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=A2(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){xb(this),Kge(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;(function(d,f,h,p){if(typeof d.setBigUint64=="function")return d.setBigUint64(f,h,p);const m=BigInt(32),g=BigInt(4294967295),y=Number(h>>m&g),b=Number(h&g),S=p?4:0,C=p?0:4;d.setUint32(f+S,y,p),d.setUint32(f+C,b,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=A2(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const Xge=(t,e,n)=>t&e^t&n^e&n,Qge=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Zl=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xl=new Uint32Array(64);class Yge extends Zge{constructor(){super(64,32,8,!1),this.A=0|Zl[0],this.B=0|Zl[1],this.C=0|Zl[2],this.D=0|Zl[3],this.E=0|Zl[4],this.F=0|Zl[5],this.G=0|Zl[6],this.H=0|Zl[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let f=0;f<16;f++,n+=4)Xl[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Xl[f-15],p=Xl[f-2],m=Co(h,7)^Co(h,18)^h>>>3,g=Co(p,17)^Co(p,19)^p>>>10;Xl[f]=g+Xl[f-7]+m+Xl[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=u+(Co(a,6)^Co(a,11)^Co(a,25))+((d=a)&l^~d&c)+Qge[f]+Xl[f]|0,p=(Co(r,2)^Co(r,13)^Co(r,22))+Xge(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var d;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Xl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const jS=Gge((()=>new Yge)),Jge=(BigInt(0),BigInt(1)),e0e=BigInt(2),Dw=t=>t instanceof Uint8Array,t0e=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function nh(t){if(!Dw(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=t0e[t[n]];return e}function NB(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function wm(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Ki(t){return NB(nh(t))}function bC(t){if(!Dw(t))throw new Error("Uint8Array expected");return NB(nh(Uint8Array.from(t).reverse()))}function Rc(t,e){return wm(t.toString(16).padStart(2*e,"0"))}function wC(t,e){return Rc(t,e).reverse()}function ci(t,e,n){let r;if(typeof e=="string")try{r=wm(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else{if(!Dw(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${t} expected ${n} bytes, got ${i}`);return r}function fd(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!Dw(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}const vC=t=>(e0e<<BigInt(t-1))-Jge,P2=t=>new Uint8Array(t),BO=t=>Uint8Array.from(t);function RB(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=P2(t),i=P2(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...u)=>n(i,r,...u),l=(u=P2())=>{i=a(BO([0]),u),r=a(),u.length!==0&&(i=a(BO([1]),u),r=a())},c=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const d=[];for(;u<e;){r=a();const f=r.slice();d.push(f),u+=r.length}return fd(...d)};return(u,d)=>{let f;for(o(),l(u);!(f=d(c()));)l();return o(),f}}const n0e={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function vm(t,e,n={}){const r=(i,s,o)=>{const a=n0e[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const l=t[i];if(!(o&&l===void 0||a(l,t)))throw new Error(`Invalid param ${String(i)}=${l} (${typeof l}), expected ${s}`)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}const vr=BigInt(0),nr=BigInt(1),mu=BigInt(2),r0e=BigInt(3),I2=BigInt(4),FO=BigInt(5),$O=BigInt(8);BigInt(9),BigInt(16);function jr(t,e){const n=t%e;return n>=vr?n:e+n}function i0e(t,e,n){if(n<=vr||e<vr)throw new Error("Expected power/modulo > 0");if(n===nr)return vr;let r=nr;for(;e>vr;)e&nr&&(r=r*t%n),t=t*t%n,e>>=nr;return r}function ks(t,e,n){let r=t;for(;e-- >vr;)r*=r,r%=n;return r}function qS(t,e){if(t===vr||e<=vr)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=jr(t,e),r=e,i=vr,s=nr;for(;n!==vr;){const o=r/n,a=r%n,l=i-s*o;r=n,n=a,i=s,s=l}if(r!==nr)throw new Error("invert: does not exist");return jr(i,e)}function s0e(t){if(t%I2===r0e){const e=(t+nr)/I2;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%$O===FO){const e=(t-FO)/$O;return function(n,r){const i=n.mul(r,mu),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,mu),s),l=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(l),r))throw new Error("Cannot find square root");return l}}return(function(e){const n=(e-nr)/mu;let r,i,s;for(r=e-nr,i=0;r%mu===vr;r/=mu,i++);for(s=mu;s<e&&i0e(s,n,e)!==e-nr;s++);if(i===1){const a=(e+nr)/I2;return function(l,c){const u=l.pow(c,a);if(!l.eql(l.sqr(u),c))throw new Error("Cannot find square root");return u}}const o=(r+nr)/mu;return function(a,l){if(a.pow(l,n)===a.neg(a.ONE))throw new Error("Cannot find square root");let c=i,u=a.pow(a.mul(a.ONE,s),r),d=a.pow(l,o),f=a.pow(l,r);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let h=1;for(let m=a.sqr(f);h<c&&!a.eql(m,a.ONE);h++)m=a.sqr(m);const p=a.pow(u,nr<<BigInt(c-h-1));u=a.sqr(p),d=a.mul(d,p),f=a.mul(f,u),c=h}return d}})(t)}const o0e=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function DB(t,e){const n=e!==void 0?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function LB(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function zO(t){const e=LB(t);return e+Math.ceil(e/2)}class BB extends OB{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,qge(e);const r=yC(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return xb(this),this.iHash.update(e),this}digestInto(e){xb(this),PB(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const FB=(t,e,n)=>new BB(t,e).update(n).digest();FB.create=(t,e)=>new BB(t,e);const a0e=BigInt(0),O2=BigInt(1);function $B(t){return vm(t.Fp,o0e.reduce(((e,n)=>(e[n]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),vm(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...DB(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:l0e,aT:c0e}=VS,Du={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=Du;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(r[0]===0&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:l0e(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Du,n=typeof t=="string"?c0e(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=Du._parseInt(n.subarray(2)),{d:o,l:a}=Du._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(t){const e=c=>8&Number.parseInt(c[0],16)?"00"+c:c,n=c=>{const u=c.toString(16);return 1&u.length?`0${u}`:u},r=e(n(t.s)),i=e(n(t.r)),s=r.length/2,o=i.length/2,a=n(s),l=n(o);return`30${n(o+s+4)}02${l}${i}02${a}${r}`}},Wa=BigInt(0),As=BigInt(1),UO=(BigInt(2),BigInt(3));BigInt(4);function u0e(t){const e=(function(p){const m=$B(p);vm(m,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:g,Fp:y,a:b}=m;if(g){if(!y.eql(b,y.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof g!="object"||typeof g.beta!="bigint"||typeof g.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...m})})(t),{Fp:n}=e,r=e.toBytes||((p,m,g)=>{const y=m.toAffine();return fd(Uint8Array.from([4]),n.toBytes(y.x),n.toBytes(y.y))}),i=e.fromBytes||(p=>{const m=p.subarray(1);return{x:n.fromBytes(m.subarray(0,n.BYTES)),y:n.fromBytes(m.subarray(n.BYTES,2*n.BYTES))}});function s(p){const{a:m,b:g}=e,y=n.sqr(p),b=n.mul(y,p);return n.add(n.add(b,n.mul(p,m)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Wa<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(p){const{allowedPrivateKeyLengths:m,nByteLength:g,wrapPrivateKey:y,n:b}=e;if(m&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=nh(p)),typeof p!="string"||!m.includes(p.length))throw new Error("Invalid key");p=p.padStart(2*g,"0")}let S;try{S=typeof p=="bigint"?p:Ki(ci("private key",p,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof p}`)}return y&&(S=jr(S,b)),a(S),S}const c=new Map;function u(p){if(!(p instanceof d))throw new Error("ProjectivePoint expected")}class d{constructor(m,g,y){if(this.px=m,this.py=g,this.pz=y,m==null||!n.isValid(m))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(y==null||!n.isValid(y))throw new Error("z required")}static fromAffine(m){const{x:g,y}=m||{};if(!m||!n.isValid(g)||!n.isValid(y))throw new Error("invalid affine point");if(m instanceof d)throw new Error("projective point not allowed");const b=S=>n.eql(S,n.ZERO);return b(g)&&b(y)?d.ZERO:new d(g,y,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const g=n.invertBatch(m.map((y=>y.pz)));return m.map(((y,b)=>y.toAffine(g[b]))).map(d.fromAffine)}static fromHex(m){const g=d.fromAffine(i(ci("pointHex",m)));return g.assertValidity(),g}static fromPrivateKey(m){return d.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:g}=this.toAffine();if(!n.isValid(m)||!n.isValid(g))throw new Error("bad point: x or y not FE");const y=n.sqr(g),b=s(m);if(!n.eql(y,b))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(n.isOdd)return!n.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){u(m);const{px:g,py:y,pz:b}=this,{px:S,py:C,pz:_}=m,x=n.eql(n.mul(g,_),n.mul(S,b)),I=n.eql(n.mul(y,_),n.mul(C,b));return x&&I}negate(){return new d(this.px,n.neg(this.py),this.pz)}double(){const{a:m,b:g}=e,y=n.mul(g,UO),{px:b,py:S,pz:C}=this;let _=n.ZERO,x=n.ZERO,I=n.ZERO,k=n.mul(b,b),T=n.mul(S,S),P=n.mul(C,C),O=n.mul(b,S);return O=n.add(O,O),I=n.mul(b,C),I=n.add(I,I),_=n.mul(m,I),x=n.mul(y,P),x=n.add(_,x),_=n.sub(T,x),x=n.add(T,x),x=n.mul(_,x),_=n.mul(O,_),I=n.mul(y,I),P=n.mul(m,P),O=n.sub(k,P),O=n.mul(m,O),O=n.add(O,I),I=n.add(k,k),k=n.add(I,k),k=n.add(k,P),k=n.mul(k,O),x=n.add(x,k),P=n.mul(S,C),P=n.add(P,P),k=n.mul(P,O),_=n.sub(_,k),I=n.mul(P,T),I=n.add(I,I),I=n.add(I,I),new d(_,x,I)}add(m){u(m);const{px:g,py:y,pz:b}=this,{px:S,py:C,pz:_}=m;let x=n.ZERO,I=n.ZERO,k=n.ZERO;const T=e.a,P=n.mul(e.b,UO);let O=n.mul(g,S),D=n.mul(y,C),F=n.mul(b,_),B=n.add(g,y),N=n.add(S,C);B=n.mul(B,N),N=n.add(O,D),B=n.sub(B,N),N=n.add(g,b);let M=n.add(S,_);return N=n.mul(N,M),M=n.add(O,F),N=n.sub(N,M),M=n.add(y,b),x=n.add(C,_),M=n.mul(M,x),x=n.add(D,F),M=n.sub(M,x),k=n.mul(T,N),x=n.mul(P,F),k=n.add(x,k),x=n.sub(D,k),k=n.add(D,k),I=n.mul(x,k),D=n.add(O,O),D=n.add(D,O),F=n.mul(T,F),N=n.mul(P,N),D=n.add(D,F),F=n.sub(O,F),F=n.mul(T,F),N=n.add(N,F),O=n.mul(D,N),I=n.add(I,O),O=n.mul(M,N),x=n.mul(B,x),x=n.sub(x,O),O=n.mul(B,D),k=n.mul(M,k),k=n.add(k,O),new d(x,I,k)}subtract(m){return this.add(m.negate())}is0(){return this.equals(d.ZERO)}wNAF(m){return h.wNAFCached(this,c,m,(g=>{const y=n.invertBatch(g.map((b=>b.pz)));return g.map(((b,S)=>b.toAffine(y[S]))).map(d.fromAffine)}))}multiplyUnsafe(m){const g=d.ZERO;if(m===Wa)return g;if(a(m),m===As)return this;const{endo:y}=e;if(!y)return h.unsafeLadder(this,m);let{k1neg:b,k1:S,k2neg:C,k2:_}=y.splitScalar(m),x=g,I=g,k=this;for(;S>Wa||_>Wa;)S&As&&(x=x.add(k)),_&As&&(I=I.add(k)),k=k.double(),S>>=As,_>>=As;return b&&(x=x.negate()),C&&(I=I.negate()),I=new d(n.mul(I.px,y.beta),I.py,I.pz),x.add(I)}multiply(m){a(m);let g,y,b=m;const{endo:S}=e;if(S){const{k1neg:C,k1:_,k2neg:x,k2:I}=S.splitScalar(b);let{p:k,f:T}=this.wNAF(_),{p:P,f:O}=this.wNAF(I);k=h.constTimeNegate(C,k),P=h.constTimeNegate(x,P),P=new d(n.mul(P.px,S.beta),P.py,P.pz),g=k.add(P),y=T.add(O)}else{const{p:C,f:_}=this.wNAF(b);g=C,y=_}return d.normalizeZ([g,y])[0]}multiplyAndAddUnsafe(m,g,y){const b=d.BASE,S=(_,x)=>x!==Wa&&x!==As&&_.equals(b)?_.multiply(x):_.multiplyUnsafe(x),C=S(this,g).add(S(m,y));return C.is0()?void 0:C}toAffine(m){const{px:g,py:y,pz:b}=this,S=this.is0();m==null&&(m=S?n.ONE:n.inv(b));const C=n.mul(g,m),_=n.mul(y,m),x=n.mul(b,m);if(S)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:C,y:_}}isTorsionFree(){const{h:m,isTorsionFree:g}=e;if(m===As)return!0;if(g)return g(d,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:g}=e;return m===As?this:g?g(d,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(d,this,m)}toHex(m=!0){return nh(this.toRawBytes(m))}}d.BASE=new d(e.Gx,e.Gy,n.ONE),d.ZERO=new d(n.ZERO,n.ONE,n.ZERO);const f=e.nBitLength,h=(function(p,m){const g=(b,S)=>{const C=S.negate();return b?C:S},y=b=>({windows:Math.ceil(m/b)+1,windowSize:2**(b-1)});return{constTimeNegate:g,unsafeLadder(b,S){let C=p.ZERO,_=b;for(;S>a0e;)S&O2&&(C=C.add(_)),_=_.double(),S>>=O2;return C},precomputeWindow(b,S){const{windows:C,windowSize:_}=y(S),x=[];let I=b,k=I;for(let T=0;T<C;T++){k=I,x.push(k);for(let P=1;P<_;P++)k=k.add(I),x.push(k);I=k.double()}return x},wNAF(b,S,C){const{windows:_,windowSize:x}=y(b);let I=p.ZERO,k=p.BASE;const T=BigInt(2**b-1),P=2**b,O=BigInt(b);for(let D=0;D<_;D++){const F=D*x;let B=Number(C&T);C>>=O,B>x&&(B-=P,C+=O2);const N=F,M=F+Math.abs(B)-1,R=D%2!=0,H=B<0;B===0?k=k.add(g(R,S[N])):I=I.add(g(H,S[M]))}return{p:I,f:k}},wNAFCached(b,S,C,_){const x=b._WINDOW_SIZE||1;let I=S.get(b);return I||(I=this.precomputeWindow(b,x),x!==1&&S.set(b,_(I))),this.wNAF(x,I,C)}}})(d,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:l,weierstrassEquation:s,isWithinCurveOrder:o}}function d0e(t){const e=(function(T){const P=$B(T);return vm(P,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...P})})(t),{Fp:n,n:r}=e,i=n.BYTES+1,s=2*n.BYTES+1;function o(T){return jr(T,r)}function a(T){return qS(T,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:d}=u0e({...e,toBytes(T,P,O){const D=P.toAffine(),F=n.toBytes(D.x),B=fd;return O?B(Uint8Array.from([P.hasEvenY()?2:3]),F):B(Uint8Array.from([4]),F,n.toBytes(D.y))},fromBytes(T){const P=T.length,O=T[0],D=T.subarray(1);if(P!==i||O!==2&&O!==3){if(P===s&&O===4)return{x:n.fromBytes(D.subarray(0,n.BYTES)),y:n.fromBytes(D.subarray(n.BYTES,2*n.BYTES))};throw new Error(`Point of length ${P} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const B=Ki(D);if(!(Wa<(F=B)&&F<n.ORDER))throw new Error("Point is not on curve");const N=u(B);let M=n.sqrt(N);return!(1&~O)!=((M&As)===As)&&(M=n.neg(M)),{x:B,y:M}}var F}}),f=T=>nh(Rc(T,e.nByteLength));function h(T){return T>r>>As}const p=(T,P,O)=>Ki(T.slice(P,O));class m{constructor(P,O,D){this.r=P,this.s=O,this.recovery=D,this.assertValidity()}static fromCompact(P){const O=e.nByteLength;return P=ci("compactSignature",P,2*O),new m(p(P,0,O),p(P,O,2*O))}static fromDER(P){const{r:O,s:D}=Du.toSig(ci("DER",P));return new m(O,D)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(P){return new m(this.r,this.s,P)}recoverPublicKey(P){const{r:O,s:D,recovery:F}=this,B=S(ci("msgHash",P));if(F==null||![0,1,2,3].includes(F))throw new Error("recovery id invalid");const N=F===2||F===3?O+e.n:O;if(N>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const M=1&F?"03":"02",R=l.fromHex(M+f(N)),H=a(N),z=o(-B*H),V=o(D*H),X=l.BASE.multiplyAndAddUnsafe(R,z,V);if(!X)throw new Error("point at infinify");return X.assertValidity(),X}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return wm(this.toDERHex())}toDERHex(){return Du.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return wm(this.toCompactHex())}toCompactHex(){return f(this.r)+f(this.s)}}const g={isValidPrivateKey(T){try{return c(T),!0}catch{return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const T=zO(e.n);return(function(P,O,D=!1){const F=P.length,B=LB(O),N=zO(O);if(F<16||F<N||F>1024)throw new Error(`expected ${N}-1024 bytes of input, got ${F}`);const M=jr(D?Ki(P):bC(P),O-nr)+nr;return D?wC(M,B):Rc(M,B)})(e.randomBytes(T),e.n)},precompute:(T=8,P=l.BASE)=>(P._setWindowSize(T),P.multiply(BigInt(3)),P)};function y(T){const P=T instanceof Uint8Array,O=typeof T=="string",D=(P||O)&&T.length;return P?D===i||D===s:O?D===2*i||D===2*s:T instanceof l}const b=e.bits2int||function(T){const P=Ki(T),O=8*T.length-e.nBitLength;return O>0?P>>BigInt(O):P},S=e.bits2int_modN||function(T){return o(b(T))},C=vC(e.nBitLength);function _(T){if(typeof T!="bigint")throw new Error("bigint expected");if(!(Wa<=T&&T<C))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Rc(T,e.nByteLength)}function x(T,P,O=I){if(["recovered","canonical"].some((Z=>Z in O)))throw new Error("sign() legacy options not supported");const{hash:D,randomBytes:F}=e;let{lowS:B,prehash:N,extraEntropy:M}=O;B==null&&(B=!0),T=ci("msgHash",T),N&&(T=ci("prehashed msgHash",D(T)));const R=S(T),H=c(P),z=[_(H),_(R)];if(M!=null){const Z=M===!0?F(n.BYTES):M;z.push(ci("extraEntropy",Z))}const V=fd(...z),X=R;return{seed:V,k2sig:function(Z){const te=b(Z);if(!d(te))return;const ne=a(te),J=l.BASE.multiply(te).toAffine(),xe=o(J.x);if(xe===Wa)return;const Le=o(ne*o(X+xe*H));if(Le===Wa)return;let he=(J.x===xe?0:2)|Number(J.y&As),ke=Le;return B&&h(Le)&&(ke=(function(Be){return h(Be)?o(-Be):Be})(Le),he^=1),new m(xe,ke,he)}}}const I={lowS:e.lowS,prehash:!1},k={lowS:e.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(T,P=!0){return l.fromPrivateKey(T).toRawBytes(P)},getSharedSecret:function(T,P,O=!0){if(y(T))throw new Error("first arg must be private key");if(!y(P))throw new Error("second arg must be public key");return l.fromHex(P).multiply(c(T)).toRawBytes(O)},sign:function(T,P,O=I){const{seed:D,k2sig:F}=x(T,P,O),B=e;return RB(B.hash.outputLen,B.nByteLength,B.hmac)(D,F)},verify:function(T,P,O,D=k){const F=T;if(P=ci("msgHash",P),O=ci("publicKey",O),"strict"in D)throw new Error("options.strict was renamed to lowS");const{lowS:B,prehash:N}=D;let M,R;try{if(typeof F=="string"||F instanceof Uint8Array)try{M=m.fromDER(F)}catch(J){if(!(J instanceof Du.Err))throw J;M=m.fromCompact(F)}else{if(typeof F!="object"||typeof F.r!="bigint"||typeof F.s!="bigint")throw new Error("PARSE");{const{r:J,s:xe}=F;M=new m(J,xe)}}R=l.fromHex(O)}catch(J){if(J.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(B&&M.hasHighS())return!1;N&&(P=e.hash(P));const{r:H,s:z}=M,V=S(P),X=a(z),Z=o(V*X),te=o(H*X),ne=l.BASE.multiplyAndAddUnsafe(R,Z,te)?.toAffine();return!!ne&&o(ne.x)===H},ProjectivePoint:l,Signature:m,utils:g}}function f0e(t){return{hash:t,hmac:(e,...n)=>FB(t,e,(function(...r){const i=new Uint8Array(r.reduce(((o,a)=>o+a.length),0));let s=0;return r.forEach((o=>{if(!IB(o))throw new Error("Uint8Array expected");i.set(o,s),s+=o.length})),i})(...n)),randomBytes:MB}}const Lw=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Sb=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),zB=BigInt(1),kb=BigInt(2),HO=(t,e)=>(t+e/kb)/e;function UB(t){const e=Lw,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=t*t*t%e,u=c*c*t%e,d=ks(u,n,e)*u%e,f=ks(d,n,e)*u%e,h=ks(f,kb,e)*c%e,p=ks(h,i,e)*h%e,m=ks(p,s,e)*p%e,g=ks(m,a,e)*m%e,y=ks(g,l,e)*g%e,b=ks(y,a,e)*m%e,S=ks(b,n,e)*u%e,C=ks(S,o,e)*p%e,_=ks(C,r,e)*c%e,x=ks(_,kb,e);if(!KS.eql(KS.sqr(x),t))throw new Error("Cannot find square root");return x}const KS=(function(t,e,n=!1,r={}){if(t<=vr)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:i,nByteLength:s}=DB(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=s0e(t),a=Object.freeze({ORDER:t,BITS:i,BYTES:s,MASK:vC(i),ZERO:vr,ONE:nr,create:l=>jr(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("Invalid field element: expected bigint, got "+typeof l);return vr<=l&&l<t},is0:l=>l===vr,isOdd:l=>(l&nr)===nr,neg:l=>jr(-l,t),eql:(l,c)=>l===c,sqr:l=>jr(l*l,t),add:(l,c)=>jr(l+c,t),sub:(l,c)=>jr(l-c,t),mul:(l,c)=>jr(l*c,t),pow:(l,c)=>(function(u,d,f){if(f<vr)throw new Error("Expected power > 0");if(f===vr)return u.ONE;if(f===nr)return d;let h=u.ONE,p=d;for(;f>vr;)f&nr&&(h=u.mul(h,p)),p=u.sqr(p),f>>=nr;return h})(a,l,c),div:(l,c)=>jr(l*qS(c,t),t),sqrN:l=>l*l,addN:(l,c)=>l+c,subN:(l,c)=>l-c,mulN:(l,c)=>l*c,inv:l=>qS(l,t),sqrt:r.sqrt||(l=>o(a,l)),invertBatch:l=>(function(c,u){const d=new Array(u.length),f=u.reduce(((p,m,g)=>c.is0(m)?p:(d[g]=p,c.mul(p,m))),c.ONE),h=c.inv(f);return u.reduceRight(((p,m,g)=>c.is0(m)?p:(d[g]=c.mul(p,d[g]),c.mul(p,m))),h),d})(a,l),cmov:(l,c,u)=>u?c:l,toBytes:l=>n?wC(l,s):Rc(l,s),fromBytes:l=>{if(l.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${l.length}`);return n?bC(l):Ki(l)}});return Object.freeze(a)})(Lw,void 0,void 0,{sqrt:UB}),bh=(function(t,e){const n=r=>d0e({...t,...f0e(r)});return Object.freeze({...n(e),create:n})})({a:BigInt(0),b:BigInt(7),Fp:KS,n:Sb,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Sb,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-zB*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=HO(s*t,e),l=HO(-r*t,e);let c=jr(t-a*n-l*i,e),u=jr(-a*r-l*s,e);const d=c>o,f=u>o;if(d&&(c=e-c),f&&(u=e-u),c>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:c,k2neg:f,k2:u}}}},jS),Bw=BigInt(0),HB=t=>typeof t=="bigint"&&Bw<t&&t<Lw,VO={};function Eb(t,...e){let n=VO[t];if(n===void 0){const r=jS(Uint8Array.from(t,(i=>i.charCodeAt(0))));n=fd(r,r),VO[t]=n}return jS(fd(n,...e))}const xC=t=>t.toRawBytes(!0).slice(1),GS=t=>Rc(t,32),M2=t=>jr(t,Lw),xm=t=>jr(t,Sb),SC=bh.ProjectivePoint;function ZS(t){let e=bh.utils.normPrivateKeyToScalar(t),n=SC.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:xm(-e),bytes:xC(n)}}function VB(t){if(!HB(t))throw new Error("bad x: need 0 < x < p");const e=M2(t*t);let n=UB(M2(e*t+BigInt(7)));n%kb!==Bw&&(n=M2(-n));const r=new SC(t,n,zB);return r.assertValidity(),r}function WB(...t){return xm(Ki(Eb("BIP0340/challenge",...t)))}function h0e(t){return ZS(t).bytes}function p0e(t,e,n=MB(32)){const r=ci("message",t),{bytes:i,scalar:s}=ZS(e),o=ci("auxRand",n,32),a=GS(s^Ki(Eb("BIP0340/aux",o))),l=Eb("BIP0340/nonce",a,i,r),c=xm(Ki(l));if(c===Bw)throw new Error("sign failed: k is zero");const{bytes:u,scalar:d}=ZS(c),f=WB(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(GS(xm(d+f*s)),32),!jB(h,r,i))throw new Error("sign: Invalid signature produced");return h}function jB(t,e,n){const r=ci("signature",t,64),i=ci("message",e),s=ci("publicKey",n,32);try{const u=VB(Ki(s)),d=Ki(r.subarray(0,32));if(!HB(d))return!1;const f=Ki(r.subarray(32,64));if(!(typeof(c=f)=="bigint"&&Bw<c&&c<Sb))return!1;const h=WB(GS(d),xC(u),i),p=(o=u,a=f,l=xm(-h),SC.BASE.multiplyAndAddUnsafe(o,a,l));return!(!p||!p.hasEvenY()||p.toAffine().x!==d)}catch{return!1}var o,a,l,c}const Lo={getPublicKey:h0e,sign:p0e,verify:jB,utils:{randomPrivateKey:bh.utils.randomPrivateKey,lift_x:VB,pointToBytes:xC,numberToBytesBE:Rc,bytesToNumberBE:Ki,taggedHash:Eb,mod:jr}},N2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,kC=t=>t instanceof Uint8Array,R2=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),_o=(t,e)=>t<<32-e|t>>>e;if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");const m0e=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function mr(t){if(!kC(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=m0e[t[n]];return e}function rh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const i=2*r,s=t.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Sm(t){if(typeof t=="string"&&(t=(function(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t)),!kC(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function Fw(...t){const e=new Uint8Array(t.reduce(((r,i)=>r+i.length),0));let n=0;return t.forEach((r=>{if(!kC(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length})),e}class qB{clone(){return this._cloneInto()}}function KB(t){const e=r=>t().update(Sm(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function GB(t=32){if(N2&&typeof N2.getRandomValues=="function")return N2.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function D2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function WO(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const g0e={number:D2,bool:function(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)},bytes:WO,hash:function(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");D2(t.outputLen),D2(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){WO(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},jo=g0e;class y0e extends qB{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=R2(this.buffer)}update(e){jo.exists(this);const{view:n,buffer:r,blockLen:i}=this,s=(e=Sm(e)).length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a!==i)r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0);else{const l=R2(e);for(;i<=s-o;o+=i)this.process(l,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){jo.exists(this),jo.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let d=o;d<i;d++)n[d]=0;(function(d,f,h,p){if(typeof d.setBigUint64=="function")return d.setBigUint64(f,h,p);const m=BigInt(32),g=BigInt(4294967295),y=Number(h>>m&g),b=Number(h&g),S=p?4:0,C=p?0:4;d.setUint32(f+S,y,p),d.setUint32(f+C,b,p)})(r,i-8,BigInt(8*this.length),s),this.process(r,0);const a=R2(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<c;d++)a.setUint32(4*d,u[d],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}}const b0e=(t,e,n)=>t&e^t&n^e&n,w0e=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ql=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Yl=new Uint32Array(64);class ZB extends y0e{constructor(){super(64,32,8,!1),this.A=0|Ql[0],this.B=0|Ql[1],this.C=0|Ql[2],this.D=0|Ql[3],this.E=0|Ql[4],this.F=0|Ql[5],this.G=0|Ql[6],this.H=0|Ql[7]}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:l}=this;return[e,n,r,i,s,o,a,l]}set(e,n,r,i,s,o,a,l){this.A=0|e,this.B=0|n,this.C=0|r,this.D=0|i,this.E=0|s,this.F=0|o,this.G=0|a,this.H=0|l}process(e,n){for(let f=0;f<16;f++,n+=4)Yl[f]=e.getUint32(n,!1);for(let f=16;f<64;f++){const h=Yl[f-15],p=Yl[f-2],m=_o(h,7)^_o(h,18)^h>>>3,g=_o(p,17)^_o(p,19)^p>>>10;Yl[f]=g+Yl[f-7]+m+Yl[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let f=0;f<64;f++){const h=u+(_o(a,6)^_o(a,11)^_o(a,25))+((d=a)&l^~d&c)+w0e[f]+Yl[f]|0,p=(_o(r,2)^_o(r,13)^_o(r,22))+b0e(r,i,s)|0;u=c,c=l,l=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}var d;r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,l,c,u)}roundClean(){Yl.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class v0e extends ZB{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const vd=KB((()=>new ZB));KB((()=>new v0e));function wh(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function sl(...t){const e=(i,s)=>o=>i(s(o)),n=Array.from(t).reverse().reduce(((i,s)=>i?e(i,s.encode):s.encode),void 0),r=t.reduce(((i,s)=>i?e(i,s.decode):s.decode),void 0);return{encode:n,decode:r}}function ol(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map((n=>{if(wh(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]}))},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map((n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r}))}}}function al(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function Tb(t,e="="){if(wh(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function XB(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function jO(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const i=[],s=Array.from(t);for(s.forEach((o=>{if(wh(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)}));;){let o=0,a=!0;for(let l=r;l<s.length;l++){const c=s[l],u=e*o+c;if(!Number.isSafeInteger(u)||e*o/e!==o||u-c!=e*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[l]=Math.floor(u/n),!Number.isSafeInteger(s[l])||s[l]*n+o!==u)throw new Error("convertRadix: carry overflow");a&&(s[l]?a=!1:r=l)}if(i.push(o),a)break}for(let o=0;o<t.length-1&&t[o]===0;o++)i.push(0);return i.reverse()}const QB=(t,e)=>e?QB(e,t%e):t,Cb=(t,e)=>t+(e-QB(t,e));function XS(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Cb(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Cb(e,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const l of t){if(wh(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=e)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function x0e(t){return wh(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return jO(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(jO(e,t,256))}}}function Dc(t,e=!1){if(wh(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Cb(8,t)>32||Cb(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return XS(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(XS(n,t,8,e))}}}function qO(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}sl(Dc(4),ol("0123456789ABCDEF"),al(""));sl(Dc(5),ol("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Tb(5),al(""));const qc=(sl(Dc(5),ol("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Tb(5),al("")),sl(Dc(5),ol("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),al(""),XB((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),sl(Dc(6),ol("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Tb(6),al("")));sl(Dc(6),ol("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Tb(6),al(""));const QS=t=>sl(x0e(58),ol(t),al(""));QS("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");QS("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),QS("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const YS=sl(ol("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),al("")),KO=[996825010,642813549,513874426,1027748829,705979059];function tp(t){const e=t>>25;let n=(33554431&t)<<5;for(let r=0;r<KO.length;r++)(e>>r&1)==1&&(n^=KO[r]);return n}function GO(t,e,n=1){const r=t.length;let i=1;for(let s=0;s<r;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=tp(i)^o>>5}i=tp(i);for(let s=0;s<r;s++)i=tp(i)^31&t.charCodeAt(s);for(let s of e)i=tp(i)^s;for(let s=0;s<6;s++)i=tp(i);return i^=n,YS.encode(XS([i%2**30],30,5,!1))}function YB(t){const e=t==="bech32"?1:734539939,n=Dc(5),r=n.decode,i=n.encode,s=qO(r);function o(a,l=90){if(typeof a!="string")throw new Error("bech32.decode input should be string, not "+typeof a);if(a.length<8||l!==!1&&a.length>l)throw new TypeError(`Wrong string length: ${a.length} (${a}). Expected (8..${l})`);const c=a.toLowerCase();if(a!==c&&a!==a.toUpperCase())throw new Error("String must be lowercase or uppercase");const u=(a=c).lastIndexOf("1");if(u===0||u===-1)throw new Error('Letter "1" must be present between prefix and data only');const d=a.slice(0,u),f=a.slice(u+1);if(f.length<6)throw new Error("Data must be at least 6 characters long");const h=YS.decode(f).slice(0,-6),p=GO(d,h,e);if(!f.endsWith(p))throw new Error(`Invalid checksum in ${a}: expected "${p}"`);return{prefix:d,words:h}}return{encode:function(a,l,c=90){if(typeof a!="string")throw new Error("bech32.encode prefix should be string, not "+typeof a);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error("bech32.encode words should be array of numbers, not "+typeof l);const u=a.length+7+l.length;if(c!==!1&&u>c)throw new TypeError(`Length ${u} exceeds limit ${c}`);return`${a=a.toLowerCase()}1${YS.encode(l)}${GO(a,l,e)}`},decode:o,decodeToBytes:function(a){const{prefix:l,words:c}=o(a,!1);return{prefix:l,words:c,bytes:r(c)}},decodeUnsafe:qO(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const ih=YB("bech32");YB("bech32m");sl(Dc(4),ol("0123456789abcdef"),al(""),XB((t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));function L2(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function ZO(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function JB(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function xn(t,...e){if(!JB(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function sh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function EC(t,e){xn(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const TC=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),Vt=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),$w=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(new Uint8Array(new Uint32Array([287454020]).buffer)[0]!==68)throw new Error("Non little-endian hardware is not supported");function Kc(t){if(typeof t=="string")t=(function(e){if(typeof e!="string")throw new Error("string expected, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))})(t);else{if(!JB(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function CC(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const vh=(t,e)=>(Object.assign(e,t),e);function JS(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),l=r?4:0,c=r?0:4;t.setUint32(e+l,o,r),t.setUint32(e+c,a,r)}const Fa=16,_C=new Uint8Array(16),Bo=Vt(_C),Ps=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class eF{constructor(e,n){this.blockLen=Fa,this.outputLen=Fa,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,xn(e=Kc(e),16);const r=$w(e);let i=r.getUint32(0,!1),s=r.getUint32(4,!1),o=r.getUint32(8,!1),a=r.getUint32(12,!1);const l=[];for(let y=0;y<128;y++)l.push({s0:Ps(i),s1:Ps(s),s2:Ps(o),s3:Ps(a)}),{s0:i,s1:s,s2:o,s3:a}={s3:(d=o)<<31|(f=a)>>>1,s2:(u=s)<<31|d>>>1,s1:(c=i)<<31|u>>>1,s0:c>>>1^225<<24&-(1&f)};var c,u,d,f;const h=(y=>y>65536?8:y>1024?4:2)(n||1024);if(![1,2,4,8].includes(h))throw new Error(`ghash: wrong window size=${h}, should be 2, 4 or 8`);this.W=h;const p=128/h,m=this.windowSize=2**h,g=[];for(let y=0;y<p;y++)for(let b=0;b<m;b++){let S=0,C=0,_=0,x=0;for(let I=0;I<h;I++){if(!(b>>>h-I-1&1))continue;const{s0:k,s1:T,s2:P,s3:O}=l[h*y+I];S^=k,C^=T,_^=P,x^=O}g.push({s0:S,s1:C,s2:_,s3:x})}this.t=g}_updateBlock(e,n,r,i){e^=this.s0,n^=this.s1,r^=this.s2,i^=this.s3;const{W:s,t:o,windowSize:a}=this;let l=0,c=0,u=0,d=0;const f=(1<<s)-1;let h=0;for(const p of[e,n,r,i])for(let m=0;m<4;m++){const g=p>>>8*m&255;for(let y=8/s-1;y>=0;y--){const b=g>>>s*y&f,{s0:S,s1:C,s2:_,s3:x}=o[h*a+b];l^=S,c^=C,u^=_,d^=x,h+=1}}this.s0=l,this.s1=c,this.s2=u,this.s3=d}update(e){e=Kc(e),sh(this);const n=Vt(e),r=Math.floor(e.length/Fa),i=e.length%Fa;for(let s=0;s<r;s++)this._updateBlock(n[4*s+0],n[4*s+1],n[4*s+2],n[4*s+3]);return i&&(_C.set(e.subarray(r*Fa)),this._updateBlock(Bo[0],Bo[1],Bo[2],Bo[3]),Bo.fill(0)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){sh(this),EC(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Vt(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e}digest(){const e=new Uint8Array(Fa);return this.digestInto(e),this.destroy(),e}}class S0e extends eF{constructor(e,n){const r=(function(i){i.reverse();const s=1&i[15];let o=0;for(let a=0;a<i.length;a++){const l=i[a];i[a]=l>>>1|o,o=(1&l)<<7}return i[0]^=225&-s,i})((e=Kc(e)).slice());super(r,n),r.fill(0)}update(e){e=Kc(e),sh(this);const n=Vt(e),r=e.length%Fa,i=Math.floor(e.length/Fa);for(let s=0;s<i;s++)this._updateBlock(Ps(n[4*s+3]),Ps(n[4*s+2]),Ps(n[4*s+1]),Ps(n[4*s+0]));return r&&(_C.set(e.subarray(i*Fa)),this._updateBlock(Ps(Bo[3]),Ps(Bo[2]),Ps(Bo[1]),Ps(Bo[0])),Bo.fill(0)),this}digestInto(e){sh(this),EC(e,this),this.finished=!0;const{s0:n,s1:r,s2:i,s3:s}=this,o=Vt(e);return o[0]=n,o[1]=r,o[2]=i,o[3]=s,e.reverse()}}function tF(t){const e=(r,i)=>t(i,r.length).update(Kc(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,i)=>t(r,i),e}const XO=tF(((t,e)=>new eF(t,e))),k0e=tF(((t,e)=>new S0e(t,e))),Qi=16,e0=new Uint8Array(Qi);function AC(t){return t<<1^283&-(t>>7)}function uf(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=AC(t);return n}const ek=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=AC(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),E0e=ek.map(((t,e)=>ek.indexOf(e))),B2=t=>t<<8|t>>>24;function nF(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((c,u)=>e(t[u]))),r=n.map(B2),i=r.map(B2),s=i.map(B2),o=new Uint32Array(65536),a=new Uint32Array(65536),l=new Uint16Array(65536);for(let c=0;c<256;c++)for(let u=0;u<256;u++){const d=256*c+u;o[d]=n[c]^r[u],a[d]=i[c]^s[u],l[d]=t[c]<<8|t[u]}return{sbox:t,sbox2:l,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const PC=nF(ek,(t=>uf(t,3)<<24|t<<16|t<<8|uf(t,2))),rF=nF(E0e,(t=>uf(t,11)<<24|uf(t,13)<<16|uf(t,9)<<8|uf(t,14))),T0e=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=AC(n))t[e]=n;return t})();function Gc(t){xn(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=PC,r=Vt(t),i=r.length,s=l=>qo(n,l,l,l,l),o=new Uint32Array(e+28);o.set(r);for(let l=i;l<o.length;l++){let c=o[l-1];l%i==0?c=s((a=c)<<24|a>>>8)^T0e[l/i-1]:i>6&&l%i==4&&(c=s(c)),o[l]=o[l-i]^c}var a;return o}function iF(t){const e=Gc(t),n=e.slice(),r=e.length,{sbox2:i}=PC,{T0:s,T1:o,T2:a,T3:l}=rF;for(let c=0;c<r;c+=4)for(let u=0;u<4;u++)n[c+u]=e[r-c-4+u];e.fill(0);for(let c=4;c<r-4;c++){const u=n[c],d=qo(i,u,u,u,u);n[c]=s[255&d]^o[d>>>8&255]^a[d>>>16&255]^l[d>>>24]}return n}function vc(t,e,n,r,i,s){return t[n<<8&65280|r>>>8&255]^e[i>>>8&65280|s>>>24&255]}function qo(t,e,n,r,i){return t[255&e|65280&n]|t[r>>>16&255|i>>>16&65280]<<16}function Vs(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=PC;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const d=t[l++]^vc(o,a,e,n,r,i),f=t[l++]^vc(o,a,n,r,i,e),h=t[l++]^vc(o,a,r,i,e,n),p=t[l++]^vc(o,a,i,e,n,r);e=d,n=f,r=h,i=p}return{s0:t[l++]^qo(s,e,n,r,i),s1:t[l++]^qo(s,n,r,i,e),s2:t[l++]^qo(s,r,i,e,n),s3:t[l++]^qo(s,i,e,n,r)}}function sF(t,e,n,r,i){const{sbox2:s,T01:o,T23:a}=rF;let l=0;e^=t[l++],n^=t[l++],r^=t[l++],i^=t[l++];const c=t.length/4-2;for(let u=0;u<c;u++){const d=t[l++]^vc(o,a,e,i,r,n),f=t[l++]^vc(o,a,n,e,i,r),h=t[l++]^vc(o,a,r,n,e,i),p=t[l++]^vc(o,a,i,r,n,e);e=d,n=f,r=h,i=p}return{s0:t[l++]^qo(s,e,i,r,n),s1:t[l++]^qo(s,n,e,i,r),s2:t[l++]^qo(s,r,n,e,i),s3:t[l++]^qo(s,i,r,n,e)}}function xh(t,e){if(!e)return new Uint8Array(t);if(xn(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function C0e(t,e,n,r){xn(e,Qi),xn(n);const i=n.length;r=xh(i,r);const s=e,o=Vt(s);let{s0:a,s1:l,s2:c,s3:u}=Vs(t,o[0],o[1],o[2],o[3]);const d=Vt(n),f=Vt(r);for(let p=0;p+4<=d.length;p+=4){f[p+0]=d[p+0]^a,f[p+1]=d[p+1]^l,f[p+2]=d[p+2]^c,f[p+3]=d[p+3]^u;let m=1;for(let g=s.length-1;g>=0;g--)m=m+(255&s[g])|0,s[g]=255&m,m>>>=8;({s0:a,s1:l,s2:c,s3:u}=Vs(t,o[0],o[1],o[2],o[3]))}const h=Qi*Math.floor(d.length/4);if(h<i){const p=new Uint32Array([a,l,c,u]),m=TC(p);for(let g=h,y=0;g<i;g++,y++)r[g]=n[g]^m[y]}return r}function pp(t,e,n,r,i){xn(n,Qi),xn(r),i=xh(r.length,i);const s=n,o=Vt(s),a=$w(s),l=Vt(r),c=Vt(i),u=e?0:12,d=r.length;let f=a.getUint32(u,e),{s0:h,s1:p,s2:m,s3:g}=Vs(t,o[0],o[1],o[2],o[3]);for(let b=0;b+4<=l.length;b+=4)c[b+0]=l[b+0]^h,c[b+1]=l[b+1]^p,c[b+2]=l[b+2]^m,c[b+3]=l[b+3]^g,f=f+1>>>0,a.setUint32(u,f,e),{s0:h,s1:p,s2:m,s3:g}=Vs(t,o[0],o[1],o[2],o[3]);const y=Qi*Math.floor(l.length/4);if(y<d){const b=new Uint32Array([h,p,m,g]),S=TC(b);for(let C=y,_=0;C<d;C++,_++)i[C]=r[C]^S[_]}return i}vh({blockSize:16,nonceLength:16},(function(t,e){function n(r,i){const s=Gc(t),o=e.slice(),a=C0e(s,o,r,i);return s.fill(0),o.fill(0),a}return xn(t),xn(e,Qi),{encrypt:(r,i)=>n(r,i),decrypt:(r,i)=>n(r,i)}}));function oF(t){if(xn(t),t.length%Qi!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function aF(t,e,n){let r=t.length;const i=r%Qi;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=Vt(t);if(e){let a=Qi-i;a||(a=Qi),r+=a}const o=xh(r,n);return{b:s,o:Vt(o),out:o}}function lF(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function cF(t){const e=new Uint8Array(16),n=Vt(e);e.set(t);const r=Qi-t.length;for(let i=Qi-r;i<Qi;i++)e[i]=r;return n}vh({blockSize:16},(function(t,e={}){xn(t);const n=!e.disablePadding;return{encrypt:(r,i)=>{xn(r);const{b:s,o,out:a}=aF(r,n,i),l=Gc(t);let c=0;for(;c+4<=s.length;){const{s0:u,s1:d,s2:f,s3:h}=Vs(l,s[c+0],s[c+1],s[c+2],s[c+3]);o[c++]=u,o[c++]=d,o[c++]=f,o[c++]=h}if(n){const u=cF(r.subarray(4*c)),{s0:d,s1:f,s2:h,s3:p}=Vs(l,u[0],u[1],u[2],u[3]);o[c++]=d,o[c++]=f,o[c++]=h,o[c++]=p}return l.fill(0),a},decrypt:(r,i)=>{oF(r);const s=iF(t),o=xh(r.length,i),a=Vt(r),l=Vt(o);for(let c=0;c+4<=a.length;){const{s0:u,s1:d,s2:f,s3:h}=sF(s,a[c+0],a[c+1],a[c+2],a[c+3]);l[c++]=u,l[c++]=d,l[c++]=f,l[c++]=h}return s.fill(0),lF(o,n)}}}));const uF=vh({blockSize:16,nonceLength:16},(function(t,e,n={}){xn(t),xn(e,16);const r=!n.disablePadding;return{encrypt:(i,s)=>{const o=Gc(t),{b:a,o:l,out:c}=aF(i,r,s),u=Vt(e);let d=u[0],f=u[1],h=u[2],p=u[3],m=0;for(;m+4<=a.length;)d^=a[m+0],f^=a[m+1],h^=a[m+2],p^=a[m+3],{s0:d,s1:f,s2:h,s3:p}=Vs(o,d,f,h,p),l[m++]=d,l[m++]=f,l[m++]=h,l[m++]=p;if(r){const g=cF(i.subarray(4*m));d^=g[0],f^=g[1],h^=g[2],p^=g[3],{s0:d,s1:f,s2:h,s3:p}=Vs(o,d,f,h,p),l[m++]=d,l[m++]=f,l[m++]=h,l[m++]=p}return o.fill(0),c},decrypt:(i,s)=>{oF(i);const o=iF(t),a=Vt(e),l=xh(i.length,s),c=Vt(i),u=Vt(l);let d=a[0],f=a[1],h=a[2],p=a[3];for(let m=0;m+4<=c.length;){const g=d,y=f,b=h,S=p;d=c[m+0],f=c[m+1],h=c[m+2],p=c[m+3];const{s0:C,s1:_,s2:x,s3:I}=sF(o,d,f,h,p);u[m++]=C^g,u[m++]=_^y,u[m++]=x^b,u[m++]=I^S}return o.fill(0),lF(l,r)}}}));vh({blockSize:16,nonceLength:16},(function(t,e){function n(r,i,s){const o=Gc(t),a=r.length;s=xh(a,s);const l=Vt(r),c=Vt(s),u=i?c:l,d=Vt(e);let f=d[0],h=d[1],p=d[2],m=d[3];for(let y=0;y+4<=l.length;){const{s0:b,s1:S,s2:C,s3:_}=Vs(o,f,h,p,m);c[y+0]=l[y+0]^b,c[y+1]=l[y+1]^S,c[y+2]=l[y+2]^C,c[y+3]=l[y+3]^_,f=u[y++],h=u[y++],p=u[y++],m=u[y++]}const g=Qi*Math.floor(l.length/4);if(g<a){({s0:f,s1:h,s2:p,s3:m}=Vs(o,f,h,p,m));const y=TC(new Uint32Array([f,h,p,m]));for(let b=g,S=0;b<a;b++,S++)s[b]=r[b]^y[S];y.fill(0)}return o.fill(0),s}return xn(t),xn(e,16),{encrypt:(r,i)=>n(r,!0,i),decrypt:(r,i)=>n(r,!1,i)}}));function dF(t,e,n,r,i){const s=t.create(n,r.length+(i?.length||0));i&&s.update(i),s.update(r);const o=new Uint8Array(16),a=$w(o);return i&&JS(a,0,BigInt(8*i.length),e),JS(a,8,BigInt(8*r.length),e),s.update(o),s.digest()}vh({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(xn(e),e.length===0)throw new Error("aes/gcm: empty nonce");const r=16;function i(o,a,l){const c=dF(XO,!1,o,l,n);for(let u=0;u<a.length;u++)c[u]^=a[u];return c}function s(){const o=Gc(t),a=e0.slice(),l=e0.slice();if(pp(o,!1,l,l,a),e.length===12)l.set(e);else{const c=e0.slice();JS($w(c),8,BigInt(8*e.length),!1),XO.create(a).update(e).update(c).digestInto(l)}return{xk:o,authKey:a,counter:l,tagMask:pp(o,!1,l,e0)}}return{encrypt:o=>{xn(o);const{xk:a,authKey:l,counter:c,tagMask:u}=s(),d=new Uint8Array(o.length+r);pp(a,!1,c,o,d);const f=i(l,u,d.subarray(0,d.length-r));return d.set(f,o.length),a.fill(0),d},decrypt:o=>{if(xn(o),o.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:a,authKey:l,counter:c,tagMask:u}=s(),d=o.subarray(0,-16),f=o.subarray(-16);if(!CC(i(l,u,d),f))throw new Error("aes/gcm: invalid ghash tag");const h=pp(a,!1,c,d);return l.fill(0),u.fill(0),a.fill(0),h}}}));const t0=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};vh({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=t0("AAD",0,68719476736),i=t0("plaintext",0,2**36),s=t0("nonce",12,12),o=t0("ciphertext",16,2**36+16);function a(){const u=t.length;if(u!==16&&u!==24&&u!==32)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${u} bytes`);const d=Gc(t),f=new Uint8Array(u),h=new Uint8Array(16),p=Vt(e);let m=0,g=p[0],y=p[1],b=p[2],S=0;for(const C of[h,f].map(Vt)){const _=Vt(C);for(let x=0;x<_.length;x+=2){const{s0:I,s1:k}=Vs(d,m,g,y,b);_[x+0]=I,_[x+1]=k,m=++S}}return d.fill(0),{authKey:h,encKey:Gc(f)}}function l(u,d,f){const h=dF(k0e,!0,d,f,n);for(let S=0;S<12;S++)h[S]^=e[S];h[15]&=127;const p=Vt(h);let m=p[0],g=p[1],y=p[2],b=p[3];return{s0:m,s1:g,s2:y,s3:b}=Vs(u,m,g,y,b),p[0]=m,p[1]=g,p[2]=y,p[3]=b,h}function c(u,d,f){let h=d.slice();return h[15]|=128,pp(u,!0,h,f)}return xn(e),s(e.length),n&&(xn(n),r(n.length)),{encrypt:u=>{xn(u),i(u.length);const{encKey:d,authKey:f}=a(),h=l(d,f,u),p=new Uint8Array(u.length+16);return p.set(h,u.length),p.set(c(d,h,u)),d.fill(0),f.fill(0),p},decrypt:u=>{xn(u),o(u.length);const d=u.subarray(-16),{encKey:f,authKey:h}=a(),p=c(f,d,u.subarray(0,-16)),m=l(f,h,p);if(f.fill(0),h.fill(0),!CC(d,m))throw new Error("invalid polyval tag");return p}}}));const Lr=(t,e)=>255&t[e++]|(255&t[e++])<<8;class _0e{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,xn(e=Kc(e),32);const n=Lr(e,0),r=Lr(e,2),i=Lr(e,4),s=Lr(e,6),o=Lr(e,8),a=Lr(e,10),l=Lr(e,12),c=Lr(e,14);this.r[0]=8191&n,this.r[1]=8191&(n>>>13|r<<3),this.r[2]=7939&(r>>>10|i<<6),this.r[3]=8191&(i>>>7|s<<9),this.r[4]=255&(s>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|a<<2),this.r[7]=8065&(a>>>11|l<<5),this.r[8]=8191&(l>>>8|c<<8),this.r[9]=c>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Lr(e,16+2*u)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],l=o[1],c=o[2],u=o[3],d=o[4],f=o[5],h=o[6],p=o[7],m=o[8],g=o[9],y=Lr(e,n+0),b=Lr(e,n+2),S=Lr(e,n+4),C=Lr(e,n+6),_=Lr(e,n+8),x=Lr(e,n+10),I=Lr(e,n+12),k=Lr(e,n+14);let T=s[0]+(8191&y),P=s[1]+(8191&(y>>>13|b<<3)),O=s[2]+(8191&(b>>>10|S<<6)),D=s[3]+(8191&(S>>>7|C<<9)),F=s[4]+(8191&(C>>>4|_<<12)),B=s[5]+(_>>>1&8191),N=s[6]+(8191&(_>>>14|x<<2)),M=s[7]+(8191&(x>>>11|I<<5)),R=s[8]+(8191&(I>>>8|k<<8)),H=s[9]+(k>>>5|i),z=0,V=z+T*a+P*(5*g)+O*(5*m)+D*(5*p)+F*(5*h);z=V>>>13,V&=8191,V+=B*(5*f)+N*(5*d)+M*(5*u)+R*(5*c)+H*(5*l),z+=V>>>13,V&=8191;let X=z+T*l+P*a+O*(5*g)+D*(5*m)+F*(5*p);z=X>>>13,X&=8191,X+=B*(5*h)+N*(5*f)+M*(5*d)+R*(5*u)+H*(5*c),z+=X>>>13,X&=8191;let Z=z+T*c+P*l+O*a+D*(5*g)+F*(5*m);z=Z>>>13,Z&=8191,Z+=B*(5*p)+N*(5*h)+M*(5*f)+R*(5*d)+H*(5*u),z+=Z>>>13,Z&=8191;let te=z+T*u+P*c+O*l+D*a+F*(5*g);z=te>>>13,te&=8191,te+=B*(5*m)+N*(5*p)+M*(5*h)+R*(5*f)+H*(5*d),z+=te>>>13,te&=8191;let ne=z+T*d+P*u+O*c+D*l+F*a;z=ne>>>13,ne&=8191,ne+=B*(5*g)+N*(5*m)+M*(5*p)+R*(5*h)+H*(5*f),z+=ne>>>13,ne&=8191;let J=z+T*f+P*d+O*u+D*c+F*l;z=J>>>13,J&=8191,J+=B*a+N*(5*g)+M*(5*m)+R*(5*p)+H*(5*h),z+=J>>>13,J&=8191;let xe=z+T*h+P*f+O*d+D*u+F*c;z=xe>>>13,xe&=8191,xe+=B*l+N*a+M*(5*g)+R*(5*m)+H*(5*p),z+=xe>>>13,xe&=8191;let Le=z+T*p+P*h+O*f+D*d+F*u;z=Le>>>13,Le&=8191,Le+=B*c+N*l+M*a+R*(5*g)+H*(5*m),z+=Le>>>13,Le&=8191;let he=z+T*m+P*p+O*h+D*f+F*d;z=he>>>13,he&=8191,he+=B*u+N*c+M*l+R*a+H*(5*g),z+=he>>>13,he&=8191;let ke=z+T*g+P*m+O*p+D*h+F*f;z=ke>>>13,ke&=8191,ke+=B*d+N*u+M*c+R*l+H*a,z+=ke>>>13,ke&=8191,z=(z<<2)+z|0,z=z+V|0,V=8191&z,z>>>=13,X+=z,s[0]=V,s[1]=X,s[2]=Z,s[3]=te,s[4]=ne,s[5]=J,s[6]=xe,s[7]=Le,s[8]=he,s[9]=ke}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(1^i)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+n[0];e[0]=65535&o;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=65535&o}update(e){sh(this);const{buffer:n,blockLen:r}=this,i=(e=Kc(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0);else for(;r<=i-s;s+=r)this.process(e,s)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){sh(this),EC(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}(function(t){const e=(r,i)=>t(i).update(Kc(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e})((t=>new _0e(t)));const fF=t=>Uint8Array.from(t.split("").map((e=>e.charCodeAt(0)))),A0e=fF("expand 16-byte k"),P0e=fF("expand 32-byte k"),I0e=Vt(A0e),hF=Vt(P0e);hF.slice();function at(t,e){return t<<e|t>>>32-e}function F2(t){return t.byteOffset%4==0}const QO=2**32-1,YO=new Uint32Array;function pF(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=(function(a,l){if(l==null||typeof l!="object")throw new Error("options must be defined");return Object.assign(a,l)})({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return L2(i),L2(o),ZO(s),ZO(n),(a,l,c,u,d=0)=>{xn(a),xn(l),xn(c);const f=c.length;if(u||(u=new Uint8Array(f)),xn(u),L2(d),d<0||d>=QO)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const h=[];let p,m,g=a.length;if(g===32)p=a.slice(),h.push(p),m=hF;else{if(g!==16||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);p=new Uint8Array(32),p.set(a),p.set(a,16),m=I0e,h.push(p)}F2(l)||(l=l.slice(),h.push(l));const y=Vt(p);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(m,y,Vt(l.subarray(0,16)),y),l=l.subarray(16)}const b=16-i;if(b!==l.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const C=new Uint8Array(12);C.set(l,s?0:12-l.length),l=C,h.push(l)}const S=Vt(l);for(!(function(C,_,x,I,k,T,P,O){const D=k.length,F=new Uint8Array(64),B=Vt(F),N=F2(k)&&F2(T),M=N?Vt(k):YO,R=N?Vt(T):YO;for(let H=0;H<D;P++){if(C(_,x,I,B,P,O),P>=QO)throw new Error("arx: counter overflow");const z=Math.min(64,D-H);if(N&&z===64){const V=H/4;if(H%4!=0)throw new Error("arx: invalid block position");for(let X,Z=0;Z<16;Z++)X=V+Z,R[X]=M[X]^B[Z];H+=64}else{for(let V,X=0;X<z;X++)V=H+X,T[V]=k[V]^F[X];H+=z}}})(t,m,y,S,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function mF(t,e,n,r,i,s=20){let o=t[0],a=t[1],l=t[2],c=t[3],u=e[0],d=e[1],f=e[2],h=e[3],p=e[4],m=e[5],g=e[6],y=e[7],b=i,S=n[0],C=n[1],_=n[2],x=o,I=a,k=l,T=c,P=u,O=d,D=f,F=h,B=p,N=m,M=g,R=y,H=b,z=S,V=C,X=_;for(let te=0;te<s;te+=2)x=x+P|0,H=at(H^x,16),B=B+H|0,P=at(P^B,12),x=x+P|0,H=at(H^x,8),B=B+H|0,P=at(P^B,7),I=I+O|0,z=at(z^I,16),N=N+z|0,O=at(O^N,12),I=I+O|0,z=at(z^I,8),N=N+z|0,O=at(O^N,7),k=k+D|0,V=at(V^k,16),M=M+V|0,D=at(D^M,12),k=k+D|0,V=at(V^k,8),M=M+V|0,D=at(D^M,7),T=T+F|0,X=at(X^T,16),R=R+X|0,F=at(F^R,12),T=T+F|0,X=at(X^T,8),R=R+X|0,F=at(F^R,7),x=x+O|0,X=at(X^x,16),M=M+X|0,O=at(O^M,12),x=x+O|0,X=at(X^x,8),M=M+X|0,O=at(O^M,7),I=I+D|0,H=at(H^I,16),R=R+H|0,D=at(D^R,12),I=I+D|0,H=at(H^I,8),R=R+H|0,D=at(D^R,7),k=k+F|0,z=at(z^k,16),B=B+z|0,F=at(F^B,12),k=k+F|0,z=at(z^k,8),B=B+z|0,F=at(F^B,7),T=T+P|0,V=at(V^T,16),N=N+V|0,P=at(P^N,12),T=T+P|0,V=at(V^T,8),N=N+V|0,P=at(P^N,7);let Z=0;r[Z++]=o+x|0,r[Z++]=a+I|0,r[Z++]=l+k|0,r[Z++]=c+T|0,r[Z++]=u+P|0,r[Z++]=d+O|0,r[Z++]=f+D|0,r[Z++]=h+F|0,r[Z++]=p+B|0,r[Z++]=m+N|0,r[Z++]=g+M|0,r[Z++]=y+R|0,r[Z++]=b+H|0,r[Z++]=S+z|0,r[Z++]=C+V|0,r[Z++]=_+X|0}const gF=pF(mF,{counterRight:!1,counterLength:4,allowShortKeys:!1});pF(mF,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let i=t[0],s=t[1],o=t[2],a=t[3],l=e[0],c=e[1],u=e[2],d=e[3],f=e[4],h=e[5],p=e[6],m=e[7],g=n[0],y=n[1],b=n[2],S=n[3];for(let _=0;_<20;_+=2)i=i+l|0,g=at(g^i,16),f=f+g|0,l=at(l^f,12),i=i+l|0,g=at(g^i,8),f=f+g|0,l=at(l^f,7),s=s+c|0,y=at(y^s,16),h=h+y|0,c=at(c^h,12),s=s+c|0,y=at(y^s,8),h=h+y|0,c=at(c^h,7),o=o+u|0,b=at(b^o,16),p=p+b|0,u=at(u^p,12),o=o+u|0,b=at(b^o,8),p=p+b|0,u=at(u^p,7),a=a+d|0,S=at(S^a,16),m=m+S|0,d=at(d^m,12),a=a+d|0,S=at(S^a,8),m=m+S|0,d=at(d^m,7),i=i+c|0,S=at(S^i,16),p=p+S|0,c=at(c^p,12),i=i+c|0,S=at(S^i,8),p=p+S|0,c=at(c^p,7),s=s+u|0,g=at(g^s,16),m=m+g|0,u=at(u^m,12),s=s+u|0,g=at(g^s,8),m=m+g|0,u=at(u^m,7),o=o+d|0,y=at(y^o,16),f=f+y|0,d=at(d^f,12),o=o+d|0,y=at(y^o,8),f=f+y|0,d=at(d^f,7),a=a+l|0,b=at(b^a,16),h=h+b|0,l=at(l^h,12),a=a+l|0,b=at(b^a,8),h=h+b|0,l=at(l^h,7);let C=0;r[C++]=i,r[C++]=s,r[C++]=o,r[C++]=a,r[C++]=g,r[C++]=y,r[C++]=b,r[C++]=S},allowShortKeys:!1});class yF extends qB{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,jo.hash(e);const r=Sm(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return jo.exists(this),this.iHash.update(e),this}digestInto(e){jo.exists(this),jo.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const zw=(t,e,n)=>new yF(t,e).update(n).digest();function O0e(t,e,n){return jo.hash(t),zw(t,Sm(n),Sm(e))}zw.create=(t,e)=>new yF(t,e);const $2=new Uint8Array([0]),JO=new Uint8Array;function M0e(t,e,n,r=32){if(jo.hash(t),jo.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/t.outputLen);n===void 0&&(n=JO);const s=new Uint8Array(i*t.outputLen),o=zw.create(t,e),a=o._cloneInto(),l=new Uint8Array(o.outputLen);for(let c=0;c<i;c++)$2[0]=c+1,a.update(c===0?JO:l).update(n).update($2).digestInto(l),s.set(l,t.outputLen*c),o._cloneInto(a);return o.destroy(),a.destroy(),l.fill(0),$2.fill(0),s.slice(0,r)}var N0e=Object.defineProperty,Jn=(t,e)=>{for(var n in e)N0e(t,n,{get:e[n],enumerable:!0})},oc=Symbol("verified"),R0e=t=>t instanceof Object;function Uw(t){if(!R0e(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}function D0e(t){return t.sort(((e,n)=>e.created_at!==n.created_at?n.created_at-e.created_at:e.id.localeCompare(n.id)))}var bF={};Jn(bF,{Queue:()=>vF,QueueNode:()=>wF,binarySearch:()=>IC,insertEventIntoAscendingList:()=>B0e,insertEventIntoDescendingList:()=>L0e,normalizeURL:()=>df,utf8Decoder:()=>Ya,utf8Encoder:()=>ho});var Ya=new TextDecoder("utf-8"),ho=new TextEncoder;function df(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function L0e(t,e){const[n,r]=IC(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at));return r||t.splice(n,0,e),t}function B0e(t,e){const[n,r]=IC(t,(i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at));return r||t.splice(n,0,e),t}function IC(t,e){let n=0,r=t.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=e(t[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var wF=class{value;next=null;prev=null;constructor(t){this.value=t}},vF=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new wF(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function xF(t){if(!Uw(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function Hp(t){return mr(vd(ho.encode(xF(t))))}var Hw=new class{generateSecretKey(){return Lo.utils.randomPrivateKey()}getPublicKey(t){return mr(Lo.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=mr(Lo.getPublicKey(e)),n.id=Hp(n),n.sig=mr(Lo.sign(Hp(n),e)),n[oc]=!0,n}verifyEvent(t){if(typeof t[oc]=="boolean")return t[oc];const e=Hp(t);if(e!==t.id)return t[oc]=!1,!1;try{const n=Lo.verify(t.sig,e,t.pubkey);return t[oc]=n,n}catch{return t[oc]=!1,!1}}},SF=Hw.generateSecretKey,OC=Hw.getPublicKey,mo=Hw.finalizeEvent,Sh=Hw.verifyEvent,kF={};function EF(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function MC(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function TF(t){return 2e4<=t&&t<3e4}function NC(t){return 3e4<=t&&t<4e4}function F0e(t){return EF(t)?"regular":MC(t)?"replaceable":TF(t)?"ephemeral":NC(t)?"parameterized":"unknown"}function $0e(t,e){const n=e instanceof Array?e:[e];return Uw(t)&&n.includes(t.kind)||!1}Jn(kF,{Application:()=>$ye,BadgeAward:()=>q0e,BadgeDefinition:()=>Mye,BlockedRelaysList:()=>gye,BookmarkList:()=>hye,Bookmarksets:()=>Pye,Calendar:()=>qye,CalendarEventRSVP:()=>Kye,ChannelCreation:()=>_F,ChannelHideMessage:()=>IF,ChannelMessage:()=>PF,ChannelMetadata:()=>AF,ChannelMuteUser:()=>OF,ClassifiedListing:()=>Hye,ClientAuth:()=>NF,CommunitiesList:()=>pye,CommunityDefinition:()=>Xye,CommunityPostApproval:()=>nye,Contacts:()=>V0e,CreateOrUpdateProduct:()=>Dye,CreateOrUpdateStall:()=>Rye,Curationsets:()=>Iye,Date:()=>Wye,DirectMessageRelaysList:()=>vye,DraftClassifiedListing:()=>Vye,DraftLong:()=>Bye,Emojisets:()=>Fye,EncryptedDirectMessage:()=>W0e,EventDeletion:()=>j0e,FileMetadata:()=>X0e,FileServerPreference:()=>xye,Followsets:()=>Cye,GenericRepost:()=>G0e,Genericlists:()=>_ye,GiftWrap:()=>MF,HTTPAuth:()=>LC,Handlerinformation:()=>Zye,Handlerrecommendation:()=>Gye,Highlights:()=>cye,InterestsList:()=>bye,Interestsets:()=>Nye,JobFeedback:()=>sye,JobRequest:()=>rye,JobResult:()=>iye,Label:()=>tye,LightningPubRPC:()=>kye,LiveChatMessage:()=>Q0e,LiveEvent:()=>zye,LongFormArticle:()=>Lye,Metadata:()=>z0e,Mutelist:()=>uye,NWCWalletInfo:()=>Sye,NWCWalletRequest:()=>RF,NWCWalletResponse:()=>Eye,NostrConnect:()=>Tye,OpenTimestamps:()=>Z0e,Pinlist:()=>dye,PrivateDirectMessage:()=>K0e,ProblemTracker:()=>Y0e,ProfileBadges:()=>Oye,PublicChatsList:()=>mye,Reaction:()=>DC,RecommendRelay:()=>H0e,RelayList:()=>fye,Relaysets:()=>Aye,Report:()=>J0e,Reporting:()=>eye,Repost:()=>RC,Seal:()=>CF,SearchRelaysList:()=>yye,ShortTextNote:()=>U0e,Time:()=>jye,UserEmojiList:()=>wye,UserStatuses:()=>Uye,Zap:()=>lye,ZapGoal:()=>oye,ZapRequest:()=>aye,classifyKind:()=>F0e,isEphemeralKind:()=>TF,isKind:()=>$0e,isParameterizedReplaceableKind:()=>NC,isRegularKind:()=>EF,isReplaceableKind:()=>MC});var z0e=0,U0e=1,H0e=2,V0e=3,W0e=4,j0e=5,RC=6,DC=7,q0e=8,CF=13,K0e=14,G0e=16,_F=40,AF=41,PF=42,IF=43,OF=44,Z0e=1040,MF=1059,X0e=1063,Q0e=1311,Y0e=1971,J0e=1984,eye=1984,tye=1985,nye=4550,rye=5999,iye=6999,sye=7e3,oye=9041,aye=9734,lye=9735,cye=9802,uye=1e4,dye=10001,fye=10002,hye=10003,pye=10004,mye=10005,gye=10006,yye=10007,bye=10015,wye=10030,vye=10050,xye=10096,Sye=13194,kye=21e3,NF=22242,RF=23194,Eye=23195,Tye=24133,LC=27235,Cye=3e4,_ye=30001,Aye=30002,Pye=30003,Iye=30004,Oye=30008,Mye=30009,Nye=30015,Rye=30017,Dye=30018,Lye=30023,Bye=30024,Fye=30030,$ye=30078,zye=30311,Uye=30315,Hye=30402,Vye=30403,Wye=31922,jye=31923,qye=31924,Kye=31925,Gye=31989,Zye=31990,Xye=34550;function DF(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}function LF(t,e){for(let n=0;n<t.length;n++)if(DF(t[n],e))return!0;return!1}function Qye(...t){let e={};for(let n=0;n<t.length;n++){let r=t[n];Object.entries(r).forEach((([i,s])=>{if(i==="kinds"||i==="ids"||i==="authors"||i[0]==="#"){e[i]=e[i]||[];for(let o=0;o<s.length;o++){let a=s[o];e[i].includes(a)||e[i].push(a)}}})),r.limit&&(!e.limit||r.limit>e.limit)&&(e.limit=r.limit),r.until&&(!e.until||r.until>e.until)&&(e.until=r.until),r.since&&(!e.since||r.since<e.since)&&(e.since=r.since)}return e}function Yye(t){if(t.ids&&!t.ids.length||t.kinds&&!t.kinds.length||t.authors&&!t.authors.length)return 0;for(const[e,n]of Object.entries(t))if(e[0]==="#"&&Array.isArray(n)&&!n.length)return 0;return Math.min(Math.max(0,t.limit??1/0),t.ids?.length??1/0,t.authors?.length&&t.kinds?.every((e=>MC(e)))?t.authors.length*t.kinds.length:1/0,t.authors?.length&&t.kinds?.every((e=>NC(e)))&&t["#d"]?.length?t.authors.length*t.kinds.length*t["#d"].length:1/0)}var BF={};function Vw(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,i=t.slice(r).indexOf('"')+r+1;return t.slice(i,i+64)}function FF(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,i=t.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function $F(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,i=t.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return t.slice(r+1,s)}function Jye(t,e){return e===Vw(t,"id")}function ebe(t,e){return e===Vw(t,"pubkey")}function tbe(t,e){return e===FF(t,"kind")}Jn(BF,{getHex64:()=>Vw,getInt:()=>FF,getSubscriptionId:()=>$F,matchEventId:()=>Jye,matchEventKind:()=>tbe,matchEventPubkey:()=>ebe});var zF={};function UF(t,e){return{kind:NF,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function nbe(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}Jn(zF,{makeAuthEvent:()=>UF});var HF,rbe=t=>(t[oc]=!0,!0),BC=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new vF;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=df(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new BC(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await nbe();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=$F(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=Vw(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&LF(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t(UF(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new ibe(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},ibe=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}};try{HF=WebSocket}catch{}var VF,WF=class extends BC{constructor(t){super(t,{verifyEvent:Sh,websocketImplementation:HF})}static async connect(t){const e=new WF(t);return await e.connect(),e}},sbe=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=df(t);let n=this.relays.get(t);return n||(n=new BC(t,{verifyEvent:this.trustedRelayURLs.has(t)?rbe:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(df).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(d,f)=>{let h=this.seenOn.get(f);h||(h=new Set,this.seenOn.set(f,h)),h.add(d)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=d=>{s[d]=!0,s.filter((f=>f)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(d,f)=>{o(d),a[d]=f,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=d=>{if(e.alreadyHaveEvent?.(d))return!0;const f=n.has(d);return n.add(d),f},u=Promise.all(Object.entries(t).map((async(d,f,h)=>{if(h.indexOf(d)!==f)return void l(f,"duplicate url");let p,[m,g]=d;m=df(m);try{p=await this.ensureRelay(m,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(b){return void l(f,b?.message||String(b))}let y=p.subscribe(g,{...e,oneose:()=>o(f),onclose:b=>l(f,b),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)})));return{async close(){await u,r.forEach((d=>{d.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(df).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{VF=WebSocket}catch{}var obe=class extends sbe{constructor(){super({verifyEvent:Sh,websocketImplementation:VF})}},jF={};Jn(jF,{BECH32_REGEX:()=>qF,Bech32MaxSize:()=>FC,NostrTypeGuard:()=>abe,decode:()=>tg,encodeBytes:()=>jw,naddrEncode:()=>hbe,neventEncode:()=>fbe,noteEncode:()=>ube,nprofileEncode:()=>dbe,npubEncode:()=>cbe,nsecEncode:()=>lbe});var abe={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},FC=5e3,qF=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function tg(t){let{prefix:e,words:n}=ih.decode(t,FC),r=new Uint8Array(ih.fromWords(n));switch(e){case"nprofile":{let i=z2(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:mr(i[0][0]),relays:i[1]?i[1].map((s=>Ya.decode(s))):[]}}}case"nevent":{let i=z2(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:mr(i[0][0]),relays:i[1]?i[1].map((s=>Ya.decode(s))):[],author:i[2]?.[0]?mr(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(mr(i[3][0]),16):void 0}}}case"naddr":{let i=z2(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ya.decode(i[0][0]),pubkey:mr(i[2][0]),kind:parseInt(mr(i[3][0]),16),relays:i[1]?i[1].map((s=>Ya.decode(s))):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:mr(r)};default:throw new Error(`unknown prefix ${e}`)}}function z2(t){let e={},n=t;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function lbe(t){return jw("nsec",t)}function cbe(t){return jw("npub",rh(t))}function ube(t){return jw("note",rh(t))}function Ww(t,e){let n=ih.toWords(e);return ih.encode(t,n,FC)}function jw(t,e){return Ww(t,e)}function dbe(t){return Ww("nprofile",$C({0:[rh(t.pubkey)],1:(t.relays||[]).map((e=>ho.encode(e)))}))}function fbe(t){let e;return t.kind!==void 0&&(e=(function(n){const r=new Uint8Array(4);return r[0]=n>>24&255,r[1]=n>>16&255,r[2]=n>>8&255,r[3]=255&n,r})(t.kind)),Ww("nevent",$C({0:[rh(t.id)],1:(t.relays||[]).map((n=>ho.encode(n))),2:t.author?[rh(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function hbe(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),Ww("naddr",$C({0:[ho.encode(t.identifier)],1:(t.relays||[]).map((n=>ho.encode(n))),2:[rh(t.pubkey)],3:[new Uint8Array(e)]}))}function $C(t){let e=[];return Object.entries(t).reverse().forEach((([n,r])=>{r.forEach((i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),e.push(s)}))})),Fw(...e)}var pbe=/\bnostr:((note|npub|naddr|nevent|nprofile)1\w+)\b|#\[(\d+)\]/g;function mbe(t){let e=[];for(let n of t.content.matchAll(pbe))if(n[2])try{let{type:r,data:i}=tg(n[1]);switch(r){case"npub":e.push({text:n[0],profile:{pubkey:i,relays:[]}});break;case"nprofile":e.push({text:n[0],profile:i});break;case"note":e.push({text:n[0],event:{id:i,relays:[]}});break;case"nevent":e.push({text:n[0],event:i});break;case"naddr":e.push({text:n[0],address:i})}}catch{}else if(n[3]){let r=parseInt(n[3],10),i=t.tags[r];if(!i)continue;switch(i[0]){case"p":e.push({text:n[0],profile:{pubkey:i[1],relays:i[2]?[i[2]]:[]}});break;case"e":e.push({text:n[0],event:{id:i[1],relays:i[2]?[i[2]]:[]}});break;case"a":try{let[s,o,a]=i[1].split(":");e.push({text:n[0],address:{identifier:a,pubkey:o,kind:parseInt(s,10),relays:i[2]?[i[2]]:[]}})}catch{}}}return e}var KF={};async function GF(t,e,n){const r=t instanceof Uint8Array?mr(t):t,i=ZF(bh.getSharedSecret(r,"02"+e));let s=Uint8Array.from(GB(16)),o=ho.encode(n),a=uF(i,s).encrypt(o);return`${qc.encode(new Uint8Array(a))}?iv=${qc.encode(new Uint8Array(s.buffer))}`}async function gbe(t,e,n){const r=t instanceof Uint8Array?mr(t):t;let[i,s]=n.split("?iv="),o=ZF(bh.getSharedSecret(r,"02"+e)),a=qc.decode(s),l=qc.decode(i),c=uF(o,a).decrypt(l);return Ya.decode(c)}function ZF(t){return t.slice(1,33)}Jn(KF,{decrypt:()=>gbe,encrypt:()=>GF});var XF={};Jn(XF,{NIP05_REGEX:()=>zC,isNip05:()=>ybe,isValid:()=>vbe,queryProfile:()=>QF,searchDomain:()=>wbe,useFetchImplementation:()=>bbe});var qw,zC=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,ybe=t=>zC.test(t||"");try{qw=fetch}catch{}function bbe(t){qw=t}async function wbe(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await qw(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function QF(t){const e=t.match(zC);if(!e)return null;const[,n="_",r]=e;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await qw(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function vbe(t,e){const n=await QF(e);return!!n&&n.pubkey===t}var YF={};function xbe(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=t.tags.length-1;i>=0;i--){const s=t.tags[i];if(s[0]==="e"&&s[1]){const[o,a,l,c,u]=s,d={id:a,relays:l?[l]:[],author:u};if(c==="root"){e.root=d;continue}if(c==="reply"){e.reply=d;continue}if(c==="mention"){e.mentions.push(d);continue}n?r=d:n=d,e.mentions.push(d)}else{if(s[0]==="q"&&s[1]){const[o,a,l]=s;e.quotes.push({id:a,relays:l?[l]:[]})}s[0]==="p"&&s[1]&&e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach((i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find((a=>a.pubkey===i.author));o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach((a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)})),o.relays=i.relays)}})),e.mentions.forEach((i=>{if(i.author){let s=e.profiles.find((o=>o.pubkey===i.author));s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach((o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)})),s.relays=i.relays)}})),e}Jn(YF,{parse:()=>xbe});var JF={};Jn(JF,{fetchRelayInformation:()=>kbe,useFetchImplementation:()=>Sbe});function Sbe(t){}async function kbe(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var e$={};function t$(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r!==0){e+=Math.clz32(r);break}e+=32}return e}function Ebe(t,e){let n=0;const r=t,i=["nonce",n.toString(),e.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=n$(r),t$(r.id)>=e)break}return r}function n$(t){return mr(vd(ho.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}Jn(e$,{fastEventHash:()=>n$,getPow:()=>t$,minePow:()=>Ebe});var r$={};function Tbe(t,e,n,r){return mo({kind:RC,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:t.content===""?"":JSON.stringify(e),created_at:t.created_at},r)}function i$(t){if(t.kind!==RC)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0?{id:e[1],relays:[e[2],n?.[2]].filter((r=>typeof r=="string")),author:n?.[1]}:void 0}function Cbe(t,{skipVerification:e}={}){const n=i$(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}return r.id===n.id&&(e||Sh(r))?r:void 0}Jn(r$,{finishRepostEvent:()=>Tbe,getRepostedEvent:()=>Cbe,getRepostedEventPointer:()=>i$});var s$={};Jn(s$,{NOSTR_URI_REGEX:()=>Kw,parse:()=>Abe,test:()=>_be});var Kw=new RegExp(`nostr:(${qF.source})`);function _be(t){return typeof t=="string"&&new RegExp(`^${Kw.source}$`).test(t)}function Abe(t){const e=t.match(new RegExp(`^${Kw.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:tg(e[1])}}var o$={};function Pbe(t,e,n){const r=e.tags.filter((i=>i.length>=2&&(i[0]==="e"||i[0]==="p")));return mo({...t,kind:DC,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function Ibe(t){if(t.kind!==DC)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const i=t.tags[r];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&n===void 0&&(n=i))}return e!==void 0&&n!==void 0?{id:e[1],relays:[e[2],n[2]].filter((r=>r!==void 0)),author:n[1]}:void 0}Jn(o$,{finishReactionEvent:()=>Pbe,getReactedEventPointer:()=>Ibe});var a$={};Jn(a$,{matchAll:()=>Obe,regex:()=>UC,replaceAll:()=>Mbe});var UC=()=>new RegExp(`\\b${Kw.source}\\b`,"g");function*Obe(t){const e=t.matchAll(UC());for(const n of e)try{const[r,i]=n;yield{uri:r,value:i,decoded:tg(i),start:n.index,end:n.index+r.length}}catch{}}function Mbe(t,e){return t.replaceAll(UC(),((n,r)=>e({uri:n,value:r,decoded:tg(r)})))}var l$={};Jn(l$,{channelCreateEvent:()=>Nbe,channelHideMessageEvent:()=>Lbe,channelMessageEvent:()=>Dbe,channelMetadataEvent:()=>Rbe,channelMuteUserEvent:()=>Bbe});var Nbe=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return mo({kind:_F,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Rbe=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return mo({kind:AF,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Dbe=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),mo({kind:PF,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},Lbe=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return mo({kind:IF,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Bbe=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else{if(typeof t.content!="string")return;n=t.content}return mo({kind:OF,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},c$={};Jn(c$,{EMOJI_SHORTCODE_REGEX:()=>u$,matchAll:()=>Fbe,regex:()=>HC,replaceAll:()=>$be});var u$=/:(\w+):/,HC=()=>new RegExp(`\\B${u$.source}\\B`,"g");function*Fbe(t){const e=t.matchAll(HC());for(const n of e)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function $be(t,e){return t.replaceAll(HC(),((n,r)=>e({shortcode:n,name:r})))}var VC,d$={};Jn(d$,{useFetchImplementation:()=>zbe,validateGithub:()=>Ube});try{VC=fetch}catch{}function zbe(t){VC=t}async function Ube(t,e,n){try{return await(await VC(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var f$={};Jn(f$,{decrypt:()=>KC,encrypt:()=>qC,getConversationKey:()=>WC,v2:()=>Vbe});var h$=1,p$=65535;function WC(t,e){const n=bh.getSharedSecret(t,"02"+e).subarray(1,33);return O0e(vd,n,"nip44-v2")}function m$(t,e){const n=M0e(vd,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function jC(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function Hbe(t){const e=ho.encode(t),n=e.length;return Fw((function(r){if(!Number.isSafeInteger(r)||r<h$||r>p$)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const i=new Uint8Array(2);return new DataView(i.buffer).setUint16(0,r,!1),i})(n),e,new Uint8Array(jC(n)-n))}function g$(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=Fw(n,e);return zw(vd,t,r)}function qC(t,e,n=GB(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=m$(e,n),o=Hbe(t),a=gF(r,i,o),l=g$(s,a,n);return qc.encode(Fw(new Uint8Array([2]),n,a,l))}function KC(t,e){const{nonce:n,ciphertext:r,mac:i}=(function(l){if(typeof l!="string")throw new Error("payload must be a valid string");const c=l.length;if(c<132||c>87472)throw new Error("invalid payload length: "+c);if(l[0]==="#")throw new Error("unknown encryption version");let u;try{u=qc.decode(l)}catch(h){throw new Error("invalid base64: "+h.message)}const d=u.length;if(d<99||d>65603)throw new Error("invalid data length: "+d);const f=u[0];if(f!==2)throw new Error("unknown encryption version "+f);return{nonce:u.subarray(1,33),ciphertext:u.subarray(33,-32),mac:u.subarray(-32)}})(t),{chacha_key:s,chacha_nonce:o,hmac_key:a}=m$(e,n);if(!CC(g$(a,r,n),i))throw new Error("invalid MAC");return(function(l){const c=new DataView(l.buffer).getUint16(0),u=l.subarray(2,2+c);if(c<h$||c>p$||u.length!==c||l.length!==2+jC(c))throw new Error("invalid padding");return Ya.decode(u)})(gF(s,o,r))}var Vbe={utils:{getConversationKey:WC,calcPaddedLen:jC},encrypt:qC,decrypt:KC},y$={};function Wbe(t){const{pathname:e,searchParams:n}=new URL(t),r=e,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function jbe(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},i=await GF(e,t,JSON.stringify(r)),s={kind:RF,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t]]};return mo(s,e)}Jn(y$,{makeNwcRequestEvent:()=>jbe,parseConnectionString:()=>Wbe});var GC,b$={};Jn(b$,{getZapEndpoint:()=>Kbe,makeZapReceipt:()=>Xbe,makeZapRequest:()=>Gbe,useFetchImplementation:()=>qbe,validateZapRequest:()=>Zbe});try{GC=fetch}catch{}function qbe(t){GC=t}async function Kbe(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:o}=ih.decode(n,1e3),a=ih.fromWords(o);e=Ya.decode(a)}else{if(!r)return null;{let[o,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}}let i=await GC(e),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function Gbe({profile:t,event:e,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&s.tags.push(["e",e]),s}function Zbe(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!Uw(e))return"Zap request is not a valid Nostr event.";if(!Sh(e))return"Invalid signature on zap request.";let n=e.tags.find((([i,s])=>i==="p"&&s));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([i,s])=>i==="e"&&s));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([i,s])=>i==="relays"&&s))?null:"Zap request doesn't have a 'relays' tag."}function Xbe({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let i=JSON.parse(t),s=i.tags.filter((([a])=>a==="e"||a==="p"||a==="a")),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}var w$={};Jn(w$,{createRumor:()=>E$,createSeal:()=>T$,createWrap:()=>C$,unwrapEvent:()=>_$,unwrapManyEvents:()=>Ybe,wrapEvent:()=>tk,wrapManyEvents:()=>Qbe});var v$=()=>Math.round(Date.now()/1e3),x$=()=>Math.round(v$()-172800*Math.random()),S$=(t,e)=>WC(t,e),k$=(t,e,n)=>qC(JSON.stringify(t),S$(e,n)),e4=(t,e)=>JSON.parse(KC(t.content,S$(e,t.pubkey)));function E$(t,e){const n={created_at:v$(),content:"",tags:[],...t,pubkey:OC(e)};return n.id=Hp(n),n}function T$(t,e,n){return mo({kind:CF,content:k$(t,e,n),created_at:x$(),tags:[]},e)}function C$(t,e){const n=SF();return mo({kind:MF,content:k$(t,n,e),created_at:x$(),tags:[["p",e]]},n)}function tk(t,e,n){return C$(T$(E$(t,e),e,n),n)}function Qbe(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=OC(e),i=[tk(t,e,r)];return n.forEach((s=>{i.push(tk(t,e,s))})),i}function _$(t,e){const n=e4(t,e);return e4(n,e)}function Ybe(t,e){let n=[];return t.forEach((r=>{n.push(_$(r,e))})),n.sort(((r,i)=>r.created_at-i.created_at)),n}var A$={};Jn(A$,{getToken:()=>Jbe,hashPayload:()=>ZC,unpackEventFromToken:()=>I$,validateEvent:()=>L$,validateEventKind:()=>M$,validateEventMethodTag:()=>R$,validateEventPayloadTag:()=>D$,validateEventTimestamp:()=>O$,validateEventUrlTag:()=>N$,validateToken:()=>ewe});var P$="Nostr ";async function Jbe(t,e,n,r=!1,i){const s={kind:LC,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",ZC(i)]);const o=await n(s);return(r?P$:"")+qc.encode(ho.encode(JSON.stringify(o)))}async function ewe(t,e,n){const r=await I$(t).catch((i=>{throw i}));return await L$(r,e,n).catch((i=>{throw i}))}async function I$(t){if(!t)throw new Error("Missing token");t=t.replace(P$,"");const e=Ya.decode(qc.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function O$(t){return!!t.created_at&&Math.round(new Date().getTime()/1e3)-t.created_at<60}function M$(t){return t.kind===LC}function N$(t,e){const n=t.tags.find((r=>r[0]==="u"));return!!n&&n.length>0&&n[1]===e}function R$(t,e){const n=t.tags.find((r=>r[0]==="method"));return!!n&&n.length>0&&n[1].toLowerCase()===e.toLowerCase()}function ZC(t){return mr(vd(ho.encode(JSON.stringify(t))))}function D$(t,e){const n=t.tags.find((i=>i[0]==="payload"));if(!n)return!1;const r=ZC(e);return n.length>0&&n[1]===r}async function L$(t,e,n,r){if(!Sh(t))throw new Error("Invalid nostr event, signature invalid");if(!M$(t))throw new Error("Invalid nostr event, kind invalid");if(!O$(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!N$(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!R$(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!D$(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Et={LIBRARIES:{decodeBolt11:jge.decode,NostrTools:WS},DEFAULT_OPTIONS:{theme:"light",colorMode:!0},BATCH_SIZE:5,REQ_CONFIG:{INITIAL_LOAD_COUNT:15,ADDITIONAL_LOAD_COUNT:20},LOAD_TIMEOUT:1e4,BUFFER_INTERVAL:500,BUFFER_MIN_INTERVAL:100,INFINITE_SCROLL:{ROOT_MARGIN:"400px",THRESHOLD:.1,DEBOUNCE_TIME:500,RETRY_DELAY:500},ZAP_CONFIG:{DEFAULT_LIMIT:1,DEFAULT_COLOR_MODE:!0,ERRORS:{DIALOG_NOT_FOUND:"Zap dialog not found",BUTTON_NOT_FOUND:"Fetch button not found",DECODE_FAILED:"Failed to decode identifier"}},ZAP_AMOUNT_CONFIG:{DEFAULT_COLOR_MODE:!0,THRESHOLDS:[{value:1e4,className:"zap-amount-10k"},{value:5e3,className:"zap-amount-5k"},{value:2e3,className:"zap-amount-2k"},{value:1e3,className:"zap-amount-1k"},{value:500,className:"zap-amount-500"},{value:200,className:"zap-amount-200"},{value:100,className:"zap-amount-100"}],DEFAULT_CLASS:"default-color",DISABLED_CLASS:""},DIALOG_CONFIG:{DEFAULT_TITLE:"To ",NO_ZAPS_MESSAGE:"No Zaps yet!<br>Send the first Zap!",DEFAULT_NO_ZAPS_DELAY:1500,ZAP_LIST:{INITIAL_BATCH:30,REMAINING_BATCH:30,PROFILE_BATCH:30,MIN_HEIGHT:"100px"}},REQUEST_CONFIG:{METADATA_TIMEOUT:2e4,REQUEST_TIMEOUT:2e3,CACHE_DURATION:3e5},PROFILE_CONFIG:{BATCH_SIZE:20,BATCH_DELAY:100,RELAYS:["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine","wss://directory.yabu.me"]},BATCH_CONFIG:{REFERENCE_PROCESSOR:{BATCH_SIZE:20,BATCH_DELAY:100},SUPPORTED_EVENT_KINDS:[1,30023,30030,30009,40,42,31990]},BATCH_PROCESSOR_CONFIG:{DEFAULT_BATCH_SIZE:20,DEFAULT_BATCH_DELAY:100,DEFAULT_MAX_CACHE_AGE:18e5,DEFAULT_RELAY_URLS:[],TIMEOUT_DURATION:500}};class km{constructor(e,n,r=null){this.identifier=e,this.relayUrls=n,this.isColorModeEnabled=r===null?Et.ZAP_CONFIG.DEFAULT_COLOR_MODE:String(r).toLowerCase()==="true"}static determineColorMode(e){if(!e||!e.hasAttribute("data-zap-color-mode"))return Et.ZAP_CONFIG.DEFAULT_COLOR_MODE;const n=e.getAttribute("data-zap-color-mode");return n.toLowerCase()!=="true"&&n.toLowerCase()!=="false"||n.toLowerCase()==="true"}static fromButton(e){if(!e)throw new Error(Et.ZAP_CONFIG.ERRORS.BUTTON_NOT_FOUND);const n=km.determineColorMode(e);return new km(e.getAttribute("data-nzv-id"),e.getAttribute("data-relay-urls").split(","),n)}}class pl{constructor(e=1e3){this.cache=new Map,this.maxSize=e,this.accessOrder=new Map}set(e,n){if(this.cache.size>=this.maxSize&&!this.cache.has(e)){const r=this.accessOrder.keys().next().value;this.cache.delete(r),this.accessOrder.delete(r)}return this.cache.set(e,n),this.accessOrder.delete(e),this.accessOrder.set(e,Date.now()),n}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.accessOrder.set(e,Date.now()),n}has(e){return this.cache.has(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}}class XC extends pl{#e=new Map;setProfile(e,n){if(!e||!n)return;const r=this.get(e);r&&r._eventCreatedAt&&n._eventCreatedAt&&!(n._eventCreatedAt>r._eventCreatedAt)||(this.set(e,n),this.#t(e,n))}#t(e,n){this.#e.forEach((r=>{try{r(e,n)}catch{}}))}subscribe(e){if(typeof e!="function")return null;const n=Math.random().toString(36).substr(2,9);return this.#e.set(n,e),()=>this.#e.delete(n)}clearSubscriptions(){this.#e.clear()}}class twe extends pl{#e=new Map;initializeView(e){this.#e.set(e,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,batchProcessing:!1})}getViewState(e){return this.#e.get(e)||this.initializeView(e)}updateViewState(e,n){const r=this.getViewState(e);return this.#e.set(e,{...r,...n}),this.#e.get(e)}getEvents(e){return this.get(e)||[]}setEvents(e,n,r=!1){const i=r?this.getEvents(e):[],s=new Map(n.map((a=>[a.id,a]))),o=[...i.filter((a=>!s.has(a.id))),...n];this.set(e,o)}addEvent(e,n){if(!n?.id)return!1;const r=this.getEvents(e);return!this.#t(r,n)&&(r.push(n),r.sort(((i,s)=>s.created_at-i.created_at)),this.setEvents(e,r,!0),!0)}#t(e,n){return e.some((r=>r.id===n.id||r.kind===n.kind&&r.pubkey===n.pubkey&&r.content===n.content&&r.created_at===n.created_at))}}class nwe extends pl{#e=new Map;#t=new Map;async getOrFetch(e,n){const r=this.get(e);if(r)return r;const i=this.#e.get(e);if(i)return i;const s=n().then((o=>(o&&this.set(e,o),this.#e.delete(e),o))).catch((o=>(this.#e.delete(e),null)));return this.#e.set(e,s),s}clearPendingFetches(){this.#e.clear()}setComponent(e,n){this.#t.set(e,n)}getComponent(e){return this.#t.get(e)}clearComponents(){this.#t.clear()}clear(){super.clear(),this.clearPendingFetches(),this.clearComponents()}}class rwe extends pl{#e=new Map;#t=new Map;setCached(e,n,r){const i=`${e}:${n}`;this.set(i,{stats:r,timestamp:Date.now()}),this.updateViewStats(e,r)}getCached(e,n){const r=`${e}:${n}`;return this.get(r)}updateViewStats(e,n){n&&this.#e.set(e,{...n,lastUpdate:Date.now()})}getViewStats(e){return this.#e.get(e)}clearViewStats(e){this.#e.delete(e)}setNoZapsState(e,n){this.#t.set(e,n)}hasNoZaps(e){return this.#t.get(e)||!1}clearNoZapsState(e){this.#t.delete(e)}clear(){super.clear(),this.#e.clear(),this.#t.clear()}}class iwe extends pl{hasDecoded(e){return this.has(e)}setDecoded(e,n){this.set(e,n)}getDecoded(e){return this.get(e)}}class swe extends pl{initializeLoadState(e){const n={isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1,currentCount:0};return this.set(e,n),n}getLoadState(e){return this.has(e)?this.get(e):this.initializeLoadState(e)}updateLoadState(e,n){const r={...this.getLoadState(e),...n};return this.set(e,r),r}canLoadMore(e){const n=this.getLoadState(e);return n&&!n.isLoading&&n.lastEventTime}updateLoadProgress(e,n){const r=this.getLoadState(e);return r.currentCount+=n,this.updateLoadState(e,{currentCount:r.currentCount}),r.currentCount}}class owe extends pl{setZapInfo(e,n){this.set(e,n)}getZapInfo(e){return this.get(e)}clearZapInfo(e){this.delete(e)}}class awe extends XC{setImage(e,n){e&&n&&this.set(e,{image:n,timestamp:Date.now()})}getImage(e){return this.get(e)?.image}hasImage(e){return this.has(e)}clearExpired(e=36e5){const n=Date.now();for(const[r,i]of this.cache.entries())n-i.timestamp>e&&this.delete(r)}}class lwe extends XC{#e=new Map;setNip05(e,n){e&&this.set(e,{value:n,timestamp:Date.now(),verified:!0})}getNip05(e){return this.get(e)?.value}setPendingVerification(e,n){this.#e.set(e,n)}getPendingVerification(e){return this.#e.get(e)}deletePendingVerification(e){this.#e.delete(e)}clearPendingVerifications(){this.#e.clear()}clear(){super.clear(),this.clearPendingVerifications()}}class Vp{static#e=null;#t=null;#n={};constructor(){if(Vp.#e)return Vp.#e;this.profileCache=new XC,this.zapEventCache=new twe,this.referenceCache=new nwe,this.statsCache=new rwe,this.decodedCache=new iwe,this.loadStateCache=new swe,this.zapInfoCache=new owe,this.imageCache=new awe,this.nip05Cache=new lwe,this.nip05PendingCache=new pl,this.#n=["zapInfo","uiComponent","decoded","nip05","nip05PendingFetches","zapLoadStates","imageCache","isEventIdentifier"].reduce(((e,n)=>(e[n]=new pl,e)),{}),this.viewStats=new Map,this.viewStates=new Map,Vp.#e=this}setProfile(e,n){return this.profileCache.setProfile(e,n)}getProfile(e){return this.profileCache.get(e)}subscribeToProfileUpdates(e){return this.profileCache.subscribe(e)}initializeZapView(e){return this.zapEventCache.initializeView(e)}getZapEvents(e){return this.zapEventCache.getEvents(e)}setZapEvents(e,n,r){return this.zapEventCache.setEvents(e,n,r)}addZapEvent(e,n){return this.zapEventCache.addEvent(e,n)}getZapViewState(e){return this.zapEventCache.getViewState(e)}updateZapViewState(e,n){return this.zapEventCache.updateViewState(e,n)}setReference(e,n){return this.referenceCache.set(e,n)}getReference(e){return this.referenceCache.get(e)}getOrFetchReference(e,n){return this.referenceCache.getOrFetch(e,n)}getReferenceComponent(e){return this.referenceCache.getComponent(e)}setReferenceComponent(e,n){return this.referenceCache.setComponent(e,n)}getCachedStats(e,n){return this.statsCache.getCached(e,n)}updateStatsCache(e,n,r){this.statsCache.setCached(e,n,r),this.statsCache.updateViewStats(e,r)}getViewStats(e){return this.statsCache.getViewStats(e)}setNoZapsState(e,n){return this.statsCache.setNoZapsState(e,n)}hasNoZaps(e){return this.statsCache.hasNoZaps(e)}async processCachedData(e,n){this.setRelayUrls(n.relayUrls);const r=this.getZapEvents(e),i=r.some((s=>this.getReference(s.id)));return{stats:(await Promise.all([this.getCachedStats(e,n.identifier)]))[0],hasEnoughCachedEvents:r.length>=Et.REQ_CONFIG.INITIAL_LOAD_COUNT,hasReferences:i}}hasDecoded(e){return this.decodedCache.hasDecoded(e)}setDecoded(e,n){return this.decodedCache.setDecoded(e,n)}getDecoded(e){return this.decodedCache.getDecoded(e)}initializeLoadState(e){return this.loadStateCache.initializeLoadState(e)}getLoadState(e){return this.loadStateCache.getLoadState(e)}updateLoadState(e,n){return this.loadStateCache.updateLoadState(e,n)}canLoadMore(e){return this.loadStateCache.canLoadMore(e)}updateLoadProgress(e,n){return this.loadStateCache.updateLoadProgress(e,n)}setZapInfo(e,n){return this.zapInfoCache.setZapInfo(e,n)}getZapInfo(e){return this.zapInfoCache.getZapInfo(e)}clearZapInfo(e){return this.zapInfoCache.clearZapInfo(e)}setImageCache(e,n){return this.imageCache.setImage(e,n)}getImageCache(e){return this.imageCache.getImage(e)}hasImageCache(e){return this.imageCache.hasImage(e)}setNip05(e,n){return this.nip05Cache.setNip05(e,n)}getNip05(e){return this.nip05Cache.getNip05(e)}setNip05PendingFetch(e,n){this.nip05Cache.setPendingVerification(e,n)}getNip05PendingFetch(e){return this.nip05Cache.getPendingVerification(e)}deleteNip05PendingFetch(e){this.nip05Cache.deletePendingVerification(e)}getOrCreateViewState(e,n={}){return this.viewStates.has(e)||this.viewStates.set(e,{currentStats:null,...n}),this.viewStates.get(e)}getViewState(e){return this.getOrCreateViewState(e)}updateViewState(e,n){const r=this.getOrCreateViewState(e);return this.viewStates.set(e,{...r,...n}),this.viewStates.get(e)}setCacheItem(e,n,r){const i=this.#n[e];return i&&n!==void 0?i.set(n,r):null}getCacheItem(e,n){const r=this.#n[e];return r&&n!==void 0?r.get(n):null}setRelayUrls(e){this.#t=e}getRelayUrls(){return this.#t}clearAll(){this.profileCache.clear(),this.profileCache.clearSubscriptions(),this.zapEventCache.clear(),this.referenceCache.clear(),this.referenceCache.clearPendingFetches(),this.referenceCache.clearComponents(),this.statsCache.clear(),this.decodedCache.clear(),this.loadStateCache.clear(),this.zapInfoCache.clear(),this.imageCache.clear(),this.nip05Cache.clear(),this.nip05Cache.clearPendingVerifications(),Object.values(this.#n).forEach((e=>e.clear())),this.viewStats.clear(),this.viewStates.clear()}}const ht=new Vp,t4="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDYuMzMgMjA2LjMzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICA8ZGVmcz4KICAgICAgPHN0eWxlPgogICAgICAgICAuY2xzLTEgewogICAgICAgICAgICBmaWxsOiBub25lOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTIgewogICAgICAgICAgICBmaWxsOiAjZmZmOwogICAgICAgICB9CgogICAgICAgICAuY2xzLTMgewogICAgICAgICAgICBmaWxsOiAjNjY2OwogICAgICAgICB9CiAgICAgIDwvc3R5bGU+CiAgIDwvZGVmcz4KICAgPHBhdGggY2xhc3M9ImNscy0yIgogICAgICBkPSJtMjA2LjMzIDEzNC4zOWMwIDIwLjcxIDAgMzEuMDctMy41MyA0Mi4yMi00LjQzIDEyLjE3LTE0LjAyIDIxLjc2LTI2LjE5IDI2LjE5LTExLjE1IDMuNTMtMjEuNSAzLjUzLTQyLjIyIDMuNTNoLTYyLjQ2Yy0yMC43MSAwLTMxLjA2IDAtNDIuMjEtMy41My0xMi4xNy00LjQzLTIxLjc2LTE0LjAyLTI2LjE5LTI2LjE5LTMuNTMtMTEuMTUtMy41My0yMS41LTMuNTMtNDIuMjJ2LTYyLjQ2YzAtMjAuNzEgMC0zMS4wNyAzLjUzLTQyLjIyIDQuNDMtMTIuMTcgMTQuMDItMjEuNzYgMjYuMTktMjYuMTkgMTEuMTUtMy41MiAyMS41LTMuNTIgNDIuMjEtMy41Mmg2Mi40NmMyMC43MSAwIDMxLjA3IDAgNDIuMjIgMy41MiAxMi4xNyA0LjQzIDIxLjc2IDE0LjAyIDI2LjE5IDI2LjE5IDMuNTMgMTEuMTUgMy41MyAyMS41IDMuNTMgNDIuMjJ6IiAvPgogICA8cGF0aCBjbGFzcz0iY2xzLTMiCiAgICAgIGQ9Im0xODUuOTggOTEuMXY4My4yM2MwIDMuMTMtMi41NCA1LjY3LTUuNjcgNS42N2gtNjguMDRjLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNS41YzAuMzEtMTkgMi4zMi0zNy4yIDYuNTQtNDUuNDggMi41My00Ljk4IDYuNy03LjY5IDExLjQ5LTkuMTQgOS4wNS0yLjcyIDI0LjkzLTAuODYgMzEuNjctMS4xOCAwIDAgMjAuMzYgMC44MSAyMC4zNi0xMC43MiAwLTkuMjgtOS4xLTguNTUtOS4xLTguNTUtMTAuMDMgMC4yNi0xNy42Ny0wLjQyLTIyLjYyLTIuMzctOC4yOS0zLjI2LTguNTctOS4yNC04LjYtMTEuMjQtMC40MS0yMy4xLTM0LjQ3LTI1Ljg3LTY0LjQ4LTIwLjE0LTMyLjgxIDYuMjQgMC4zNiA1My4yNyAwLjM2IDExNi4wNXY4LjM4Yy0wLjA2IDMuMDgtMi41NSA1LjU3LTUuNjUgNS41N2gtMzMuNjljLTMuMTMgMC01LjY3LTIuNTQtNS42Ny01LjY3di0xNDMuOTVjMC0zLjEzIDIuNTQtNS42NyA1LjY3LTUuNjdoMzEuNjdjMy4xMyAwIDUuNjcgMi41NCA1LjY3IDUuNjcgMCA0LjY1IDUuMjMgNy4yNCA5LjAxIDQuNTMgMTEuMzktOC4xNiAyNi4wMS0xMi41MSA0Mi4zNy0xMi41MSAzNi42NSAwIDY0LjM2IDIxLjM2IDY0LjM2IDY4LjY5em0tNjAuODQtMTYuODljMC02LjctNS40My0xMi4xMy0xMi4xMy0xMi4xM3MtMTIuMTMgNS40My0xMi4xMyAxMi4xMyA1LjQzIDEyLjEzIDEyLjEzIDEyLjEzIDEyLjEzLTUuNDMgMTIuMTMtMTIuMTN6IiAvPgo8L3N2Zz4=",cwe=t=>typeof t=="string"&&t.length>0,uwe=t=>{try{return window.NostrTools.nip19.decode(t)}catch{return null}},dwe=(t,e,n)=>{const r={npub:()=>({kinds:[9735],"#p":[e]}),note:()=>({kinds:[9735],"#e":[e]}),nprofile:()=>({kinds:[9735],"#p":[e.pubkey]}),nevent:()=>({kinds:[9735],"#e":[e.id]}),naddr:()=>({kinds:[9735],"#a":[`${e.kind}:${e.pubkey}:${e.identifier}`]})}[t];if(!r)return null;const i=r();return i.limit=n?Et.REQ_CONFIG.ADDITIONAL_LOAD_COUNT:Et.REQ_CONFIG.INITIAL_LOAD_COUNT,n&&(i.until=n),{req:i}};function n4(t,e=null){const n=`${t}:${e}`;if(ht.hasDecoded(n))return ht.getDecoded(n);if(!cwe(t))throw new Error(Et.ZAP_CONFIG.ERRORS.DECODE_FAILED);const r=uwe(t);if(!r)return null;const i=dwe(r.type,r.data,e);return i&&ht.setDecoded(n,i),i}function B$(t){return t?.display_name||t?.name||"nameless"}async function fwe(t,e){if(!t||!e)return null;try{return(await window.NostrTools.nip05.queryProfile(t))?.pubkey===e?t:null}catch{return null}}function k0(t){return new Intl.NumberFormat().format(t)}function F$(t){if(!t||typeof t!="string")return"unknown";try{return`${window.NostrTools.nip19.decode(t).type.toLowerCase()}1${t.slice(5,11)}...${t.slice(-4)}`}catch{return"unknown"}}function Pf(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function hwe(t){try{return window.NostrTools.nip19.npubEncode(t)}catch{return null}}function oh(t){if(!t||typeof t!="string")return!1;const e=`isEventIdentifier:${t}`,n=ht.getCacheItem("isEventIdentifier",e);if(n!==void 0)return n;const r=t.startsWith("note1")||t.startsWith("nevent1")||t.startsWith("naddr1");return ht.setCacheItem("isEventIdentifier",e,r),r}async function pwe(t){const{pubkey:e,content:n}=(function(i){const s=i.tags.find((o=>o[0]==="description"))?.[1];if(!s)return{pubkey:null,content:""};try{const o=mwe(s);let a;try{a=JSON.parse(o)}catch{const c=o.match(/"pubkey"\s*:\s*"([^"]+)"|"content"\s*:\s*"([^"]+)"/g);if(!c)throw new Error("Invalid JSON structure");a={},c.forEach((u=>{const[d,f]=u.split(":").map((h=>h.trim().replace(/"/g,"")));a[d]=f}))}let l=null;return a.pubkey&&(l=typeof a.pubkey=="string"?a.pubkey:String(a.pubkey)),{pubkey:l,content:typeof a.content=="string"?a.content.trim():""}}catch{return{pubkey:null,content:""}}})(t),r=await(async function(i){const s=i.tags.find((o=>o[0].toLowerCase()==="bolt11"))?.[1];if(!s)return"Amount: Unknown";try{const o=window.decodeBolt11(s),a=o.sections.find((l=>l.name==="amount"))?.value;return a?`${k0(Math.floor(a/1e3))} sats`:"Amount: Unknown"}catch{return"Amount: Unknown"}})(t);return{pubkey:e,content:n,satsText:r}}function r4(t){try{return window.NostrTools.nip19.decode(t)}catch{return null}}function mwe(t){return t.replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/\\\\/g,"\\").replace(/\\(?!(["\\\/bfnrt]|u[0-9a-fA-F]{4}))/g,"").replace(/\\+(["\\/bfnrt])/g,"\\$1").replace(/\\u(?![0-9a-fA-F]{4})/g,"")}class gwe{constructor(e){this.root=e}displayStats(e){requestAnimationFrame((()=>{const n=this.root?.querySelector(".zap-stats");if(n)try{let r;r=e?e.skeleton?this.#e():e.error?this.createTimeoutStats():this.createNormalStats(e):this.createTimeoutStats(),n.innerHTML=r}catch{n.innerHTML=this.createTimeoutStats()}}))}#e(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number skeleton">...</span></div>
      <div class="stats-item">sats</div>
    `}createTimeoutStats(){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number text-muted">nostr.band</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number text-muted">Stats</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number text-muted">Unavailable</span></div>
      <div class="stats-item">sats</div>
    `}createNormalStats(e){return`
      <div class="stats-item">Total Count</div>
      <div class="stats-item"><span class="number">${k0(e.count)}</span></div>
      <div class="stats-item">times</div>
      <div class="stats-item">Total Amount</div>
      <div class="stats-item"><span class="number">${k0(Math.floor(e.msats/1e3))}</span></div>
      <div class="stats-item">sats</div>
      <div class="stats-item">Max Amount</div>
      <div class="stats-item"><span class="number">${k0(Math.floor(e.maxMsats/1e3))}</span></div>
      <div class="stats-item">sats</div>
    `}}class QC{constructor(e={}){this._validateOptions(e),this._initializeProperties(e)}_validateOptions(e){if(!e.pool?.ensureRelay)throw new Error("Invalid pool object: ensureRelay method is required")}_initializeProperties(e){this.pool=e.pool,this.batchSize=e.batchSize||Et.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_SIZE,this.batchDelay=e.batchDelay||Et.BATCH_PROCESSOR_CONFIG.DEFAULT_BATCH_DELAY,this.relayUrls=e.relayUrls||Et.BATCH_PROCESSOR_CONFIG.DEFAULT_RELAY_URLS,this.batchQueue=new Set,this.pendingFetches=new Map,this.resolvers=new Map,this.processingItems=new Set,this.batchTimer=null,this.eventCache=new Map,this.maxCacheAge=e.maxCacheAge||Et.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}getOrCreateFetchPromise(e){if(this.pendingFetches.has(e))return this.pendingFetches.get(e);const n=new Promise((r=>{this.resolvers.set(e,r)}));return this.pendingFetches.set(e,n),this.batchQueue.add(e),this._scheduleBatchProcess(),n}_scheduleBatchProcess(){this.batchTimer||(this.batchTimer=setTimeout((()=>{this.batchTimer=null,this._processBatchQueue()}),this.batchDelay))}async _processBatchQueue(){if(this.batchQueue.size===0)return;const e=this._getBatchItems();await this._processBatch(e),this.batchQueue.size>0&&this._scheduleBatchProcess()}_getBatchItems(){const e=Array.from(this.batchQueue).slice(0,this.batchSize);return e.forEach((n=>{this.batchQueue.delete(n),this.processingItems.add(n)})),e}async _processBatch(e){try{await this.onBatchProcess(e)}catch(n){this._handleBatchError(e,n)}finally{this._cleanupBatchItems(e)}}_handleBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanupBatchItems(e){e.forEach((n=>{this.processingItems.delete(n),this.pendingFetches.delete(n),this.resolvers.delete(n)}))}resolveItem(e,n){const r=this.resolvers.get(e);r&&(r(n),this.resolvers.delete(e))}async onBatchProcess(e){throw new Error("onBatchProcess must be implemented by derived class")}onBatchError(e,n){e.forEach((r=>this.resolveItem(r,null)))}_cleanup(e,n,r,i){clearTimeout(e),n&&n.close(),r.forEach((s=>{!i.has(s)&&this.resolvers.has(s)&&this.resolveItem(s,null)}))}_getSubscriptionPool(){return this.pool}async _createSubscriptionPromise(e,n,r,i){if(n?.length)return new Promise((s=>{const o=new Set,a=Et.BATCH_PROCESSOR_CONFIG.TIMEOUT_DURATION;let l,c,u=!1;const d=()=>{u||(u=!0,l&&clearTimeout(l),c&&c.close(),e.forEach((f=>{o.has(f)||this.resolveItem(f,null)})),s())};c=this.pool.subscribeMany(n,r,{onevent:f=>{try{u||(i(f,o),o.size===e.length&&d())}catch{}},oneose:()=>{setTimeout(d,100)},onerror:f=>{}}),l=setTimeout((()=>{u||d()}),a)}));e.forEach((s=>this.resolveItem(s,null)))}setRelayUrls(e){this.relayUrls=Array.isArray(e)?e:[]}getCachedItem(e){const n=this.eventCache.get(e);return this._isValidCache(n)?n.event:(this.eventCache.delete(e),null)}_isValidCache(e){return!!e&&Date.now()-e.timestamp<=this.maxCacheAge}setCachedItem(e,n){this.eventCache.set(e,{event:n,timestamp:Date.now()})}}class ywe extends QC{constructor(e={}){super(e)}async onBatchProcess(e){if(!e?.length)return;const n=[{ids:e.slice(0,this.batchSize)}];await this._createSubscriptionPromise(e,this.relayUrls,n,((r,i)=>{if(e.includes(r.id)){const s=this.getCachedItem(r.id);(!s||r.created_at>s.created_at)&&(this.setCachedItem(r.id,r),this.resolveItem(r.id,r),i.add(r.id))}}))}}class bwe extends QC{constructor(e={}){super(e)}_parseAtagValue(e){const n=e.split(":");return n.length!==3?null:{kind:parseInt(n[0]),pubkey:n[1],identifier:n[2]}}async onBatchProcess(e){if(!e?.length)return;const n=[],r={kinds:[],authors:[],"#d":[]};if(e.slice(0,this.batchSize).forEach((s=>{const o=this._parseAtagValue(s);o?(r.kinds.push(o.kind),r.authors.push(o.pubkey),r["#d"].push(o.identifier),n.push(s)):this.resolveItem(s,null)})),n.length===0)return;const i=[r];await this._createSubscriptionPromise(n,this.relayUrls,i,((s,o)=>{const a=n.find((l=>{const c=this._parseAtagValue(l);return c&&s.kind===c.kind&&s.pubkey===c.pubkey&&s.tags.some((u=>u[0]==="d"&&u[1]===c.identifier))}));if(a){const l=this.getCachedItem(a);(!l||s.created_at>l.created_at)&&(this.setCachedItem(a,s),this.resolveItem(a,s),o.add(a))}}))}}class wwe extends QC{constructor(e={}){const{simplePool:n,config:r}=e;super({pool:n,batchSize:r.BATCH_SIZE||Et.PROFILE_CONFIG.BATCH_SIZE,batchDelay:r.BATCH_DELAY||Et.PROFILE_CONFIG.BATCH_DELAY,relayUrls:r.RELAYS||Et.PROFILE_CONFIG.RELAYS,maxCacheAge:Et.BATCH_PROCESSOR_CONFIG.DEFAULT_MAX_CACHE_AGE}),this.config=r}async onBatchProcess(e){if(!this.config.RELAYS?.length)throw new Error("No relays configured for profile fetch");const n=e.filter((o=>{const a=this.getCachedItem(o);return!a||(this.resolveItem(o,a),!1)}));if(n.length===0)return;const r=[{kinds:[0],authors:n}],i=new Map,s=(o,a)=>{const l=i.get(o.pubkey);(!l||o.created_at>l.created_at)&&(i.set(o.pubkey,o),this.setCachedItem(o.pubkey,o)),a.add(o.pubkey)};try{await this._createSubscriptionPromise(n,this.config.RELAYS,r,s),n.forEach((o=>{const a=i.get(o);this.resolveItem(o,a||null)}))}catch(o){this.onBatchError(e,o)}}}var bu=Symbol("verified");function vwe(t){if(!(t instanceof Object)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var xwe=new TextEncoder;function mp(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}var Swe=class{value;next=null;prev=null;constructor(t){this.value=t}},kwe=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new Swe(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}};function U2(t){return mr(vd(xwe.encode((function(e){if(!vwe(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])})(t))))}var n0=new class{generateSecretKey(){return Lo.utils.randomPrivateKey()}getPublicKey(t){return mr(Lo.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=mr(Lo.getPublicKey(e)),n.id=U2(n),n.sig=mr(Lo.sign(U2(n),e)),n[bu]=!0,n}verifyEvent(t){if(typeof t[bu]=="boolean")return t[bu];const e=U2(t);if(e!==t.id)return t[bu]=!1,!1;try{const n=Lo.verify(t.sig,e,t.pubkey);return t[bu]=n,n}catch{return t[bu]=!1,!1}}},Ewe=(n0.generateSecretKey,n0.getPublicKey,n0.finalizeEvent,n0.verifyEvent);function Twe(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([i,s])=>i===n.slice(1)&&r.indexOf(s)!==-1)))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}async function Cwe(){return new Promise((t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()}))}var $$,_we=t=>(t[bu]=!0,!0),z$=class{url;_connected=!1;onclose=null;onnotice=t=>{};_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new kwe;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(t,e){this.url=mp(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new z$(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((t,e)=>{this.connectionTimeoutHandle=setTimeout((()=>{e("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){return void e(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Cwe();this.queueRunning=!1}handleNext(){const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=(function(n){let r=n.slice(0,22).indexOf('"EVENT"');if(r===-1)return null;let i=n.slice(r+7+1).indexOf('"');if(i===-1)return null;let s=r+7+1+i,o=n.slice(s+1,80).indexOf('"');if(o===-1)return null;let a=s+1+o;return n.slice(s+1,a)})(t);if(e){const n=this.openSubs.get(e);if(!n)return;const r=(function(s,o){let a=o.length+3,l=s.indexOf(`"${o}":`)+a,c=s.slice(l).indexOf('"')+l+1;return s.slice(c,c+64)})(t,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let n=JSON.parse(t);switch(n[0]){case"EVENT":{const r=this.openSubs.get(n[1]),i=n[2];return void(this.verifyEvent(i)&&(function(s,o){for(let a=0;a<s.length;a++)if(Twe(s[a],o))return!0;return!1})(r.filters,i)&&r.onevent(i))}case"COUNT":{const r=n[1],i=n[2],s=this.openCountRequests.get(r);return void(s&&(s.resolve(i.count),this.openCountRequests.delete(r)))}case"EOSE":{const r=this.openSubs.get(n[1]);return r?void r.receivedEose():void 0}case"OK":{const r=n[1],i=n[2],s=n[3],o=this.openEventPublishes.get(r);return void(o&&(i?o.resolve(s):o.reject(new Error(s)),this.openEventPublishes.delete(r)))}case"CLOSED":{const r=n[1],i=this.openSubs.get(r);return i?(i.closed=!0,void i.close(n[2])):void 0}case"NOTICE":return void this.onnotice(n[1]);case"AUTH":return this.challenge=n[1],void this._onauth?.(n[1])}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(t)}))}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const e=await t((function(r,i){return{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",i]],content:""}})(this.url,this.challenge)),n=new Promise(((r,i)=>{this.openEventPublishes.set(e.id,{resolve:r,reject:i})}));return this.send('["AUTH",'+JSON.stringify(e)+"]"),n}async publish(t){const e=new Promise(((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),setTimeout((()=>{const n=this.openEventPublishes.get(t.id);n&&(n.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))}),this.publishTimeout),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||"sub:"+this.serial,r=new Awe(this,n,t,e);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},Awe=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(t,e,n,r){this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(t="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(t)}},Pwe=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(t){this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=mp(t);let n=this.relays.get(t);return n||(n=new z$(t,{verifyEvent:this.trustedRelayURLs.has(t)?_we:this.verifyEvent,websocketImplementation:this._WebSocket}),e?.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(mp).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(t,e,n){return this.subscribeManyMap(Object.fromEntries(t.map((r=>[r,e]))),n)}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(d,f)=>{let h=this.seenOn.get(f);h||(h=new Set,this.seenOn.set(f,h)),h.add(d)});const n=new Set,r=[],i=Object.keys(t).length,s=[];let o=d=>{s[d]=!0,s.filter((f=>f)).length===i&&(e.oneose?.(),o=()=>{})};const a=[];let l=(d,f)=>{o(d),a[d]=f,a.filter((h=>h)).length===i&&(e.onclose?.(a),l=()=>{})};const c=d=>{if(e.alreadyHaveEvent?.(d))return!0;const f=n.has(d);return n.add(d),f},u=Promise.all(Object.entries(t).map((async(d,f,h)=>{if(h.indexOf(d)!==f)return void l(f,"duplicate url");let p,[m,g]=d;m=mp(m);try{p=await this.ensureRelay(m,{connectionTimeout:e.maxWait?Math.max(.8*e.maxWait,e.maxWait-1e3):void 0})}catch(b){return void l(f,b?.message||String(b))}let y=p.subscribe(g,{...e,oneose:()=>o(f),onclose:b=>l(f,b),alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)})));return{async close(){await u,r.forEach((d=>{d.close()}))}}}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(t,[e],{...n,onevent(s){i.push(s)},onclose(s){r(i)}})}))}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort(((i,s)=>s.created_at-i.created_at)),r[0]||null}publish(t,e){return t.map(mp).map((async(n,r,i)=>{if(i.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then((o=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return o}))}))}listConnectionStatus(){const t=new Map;return this.relays.forEach(((e,n)=>t.set(n,e.connected))),t}destroy(){this.relays.forEach((t=>t.close())),this.relays=new Map}};try{$$=WebSocket}catch{}var U$=class extends Pwe{constructor(){super({verifyEvent:Ewe,websocketImplementation:$$})}};class Wp{static instance=null;#e;#t;#n=!0;#r;constructor(){return Wp.instance?Wp.instance:(this.#i(),Wp.instance=this,this)}#i(){if(this.#e=Et.PROFILE_CONFIG,this.#t=new U$,!this.#t?.ensureRelay)throw new Error("Failed to initialize SimplePool");this.#r=new wwe({simplePool:this.#t,config:{...this.#e,RELAYS:this.#e.RELAYS||[]}})}get isInitialized(){return this.#n}async fetchProfiles(e){if(!Array.isArray(e)||e.length===0)return[];const n=Date.now(),r=new Array(e.length),i=e.reduce(((s,o,a)=>{const l=ht.getProfile(o);return this.#a(l,n)?r[a]=l:s.push({index:a,pubkey:o}),s}),[]);return i.length>0&&await this.#o(i,r,e),r}async processBatchProfiles(e){const n=this.#s(e);if(n.length!==0)try{await Promise.all([this.fetchProfiles(n),...n.map((r=>this.verifyNip05Async(r)))])}catch{}}async verifyNip05Async(e){const n=ht.getNip05(e);if(n!==void 0)return n;const r=ht.getNip05PendingFetch(e);if(r)return r;const i=this.#c(e);return ht.setNip05PendingFetch(e,i),i}getNip05(e){return ht.getNip05(e)}clearCache(){ht.clearAll(),this.#r.clearPendingFetches()}#a(e,n){return e&&e._lastUpdated&&n-e._lastUpdated<18e5}#s(e){return[...new Set(e?.map((n=>n?.pubkey))?.filter((n=>n&&typeof n=="string"&&n.length===64)))]}async#o(e,n,r){if(!e.length)return;const i=Date.now(),s=e.filter((({pubkey:a})=>a&&typeof a=="string"&&a.length===64));if(s.length===0)return;const o=await Promise.all(s.map((({pubkey:a})=>this.#l(a,i))));s.forEach((({index:a},l)=>{a>=0&&a<n.length&&(n[a]=o[l],r[a]&&ht.setProfile(r[a],o[l]))}))}async#l(e,n){if(!e||typeof e!="string"||e.length!==64)return this.#u();try{const r={kinds:[0],authors:[e],limit:1},i=await this.#r.getOrCreateFetchPromise(e,r);if(!i?.content)return this.#u();let s;try{s=JSON.parse(i.content)}catch{return this.#u()}return{...s,name:B$(s)||"nameless",_lastUpdated:n,_eventCreatedAt:i.created_at}}catch{return this.#u()}}async#c(e){try{const[n]=await this.fetchProfiles([e]);if(!n?.nip05)return ht.setNip05(e,null),null;const r=await Promise.race([fwe(n.nip05,e),new Promise(((s,o)=>setTimeout((()=>o(new Error("NIP-05 timeout"))),5e3)))]);if(!r)return ht.setNip05(e,null),null;const i=Pf(r.startsWith("_@")?r.slice(1):r);return ht.setNip05(e,i),i}catch{return ht.setNip05(e,null),null}finally{ht.deleteNip05PendingFetch(e)}}#u(){return{name:"anonymous",display_name:"anonymous"}}}const Em=new Wp;class Iwe{async loadAndUpdate(e,n){if(e)try{const r=n.querySelector(".sender-name"),i=n.querySelector(".zap-placeholder-name"),s=n.querySelector(".sender-icon"),o=s?.querySelector(".zap-placeholder-icon"),a=n.querySelector(".sender-pubkey");let l=ht.getProfile(e);const c=l?B$(l)||"nameless":"anonymous",u=l?.picture?(function(d){if(!d||typeof d!="string")return null;try{const f=new URL(d);return["http:","https:"].includes(f.protocol)?f.href:null}catch{return null}})(l.picture):null;this.#e(i,r,c),this.#n(o,s,u,c),this.#r(a,e)}catch{this.#i(n)}}#e(e,n,r){e?e.replaceWith(Object.assign(document.createElement("span"),{className:"sender-name",textContent:r})):n&&(n.textContent=r)}#t(e,n="anonymous user's icon"){const r=`https://robohash.org/${e}.png?set=set5&bgset=bg2&size=128x128`,i=ht.getImageCache(r),s=Object.assign(document.createElement("img"),{alt:n,loading:"lazy",className:"profile-icon"});if(i)return s.src=r,s;const o=new Image;return o.onerror=()=>{s.src=t4,ht.setImageCache(r,t4)},o.onload=()=>{ht.setImageCache(r,o)},o.src=r,s.src=r,s}#n(e,n,r,i){if(e&&n){const s=o=>{e.remove();const a=n.querySelector("img"),l=n.querySelector("a");a&&a.remove(),l&&l.remove();const c=o==="robohash"?this.#t(n.closest("[data-pubkey]")?.dataset.pubkey,`${Pf(i)}'s icon`):Object.assign(document.createElement("img"),{src:o,alt:`${Pf(i)}'s icon`,loading:"lazy",className:"profile-icon"}),u=n.closest("[data-pubkey]")?.dataset.pubkey;if(u){const d=(function(h,p=[]){try{return window.NostrTools.nip19.nprofileEncode({pubkey:h,relays:p})}catch{return null}})(u),f=Object.assign(document.createElement("a"),{href:`https://njump.me/${d}`,target:"_blank",rel:"noopener noreferrer"});f.appendChild(c),n.appendChild(f)}else n.appendChild(c)};if(r){const o=new Image;o.onload=()=>{ht.setImageCache(r,o),s(r)},o.onerror=()=>{s("robohash")},o.src=r}else s("robohash")}}#r(e,n){if(e&&!e.getAttribute("data-nip05-updated")){const r=Em.getNip05(n);r?(e.textContent=r,e.setAttribute("data-nip05-updated","true")):Em.verifyNip05Async(n).then((i=>{i&&(e.textContent=i,e.setAttribute("data-nip05-updated","true"))}))}}#i(e){const n=e.querySelector(".zap-placeholder-icon");if(n){const r=n.parentElement,i=e.closest("[data-pubkey]")?.dataset.pubkey;n.remove(),r.appendChild(this.#t(i))}}async updateProfileElement(e,n){if(!e||!n)return;const r=e.querySelector(".sender-icon img, .zap-placeholder-icon");if(r)if(n.picture){const s=document.createElement("img");s.alt=n.name||"Profile Picture",s.width=32,s.height=32,s.className="profile-icon",s.onerror=()=>{const o=e.getAttribute("data-pubkey");if(o){const a=this.#t(o,n.name||"anonymous user");s.parentElement&&s.parentElement.replaceChild(a,s)}},s.src=n.picture,r.parentElement&&r.parentElement.replaceChild(s,r)}else{const s=e.getAttribute("data-pubkey");if(s){const o=this.#t(s,n.name||"anonymous user");r.parentElement&&r.parentElement.replaceChild(o,r)}}const i=e.querySelector(".sender-name, .zap-placeholder-name");if(i&&(i.textContent=n.display_name||n.name||"anonymous",i.className="sender-name"),n.nip05){const s=e.getAttribute("data-pubkey");if(s){const o=e.querySelector('[data-nip05-target="true"]');o&&await this.updateNip05Display(s,o)}}}}class ji{static#e={1:"content",30023:"title",30030:"title",30009:"name",40:"content",42:"name",31990:"alt"};static#t={UI_COMPONENTS:"Failed to create UI components:",ZAP_ITEM:"Failed to create zap item HTML:",REFERENCE:"Reference component creation failed:"};static createUIComponents(e,n,r){try{const i=this.viewConfigs?.get(n),s=r||i?.identifier,o=oh(s)?null:this.#o(e);return{iconComponent:this.#n(),nameComponent:this.#c(e),pubkeyComponent:this.#u(e,s),referenceComponent:this.#d(o)}}catch{return this.#r()}}static#n(){return'<div class="zap-placeholder-icon skeleton"></div>'}static#r(){return{iconComponent:'<div class="zap-placeholder-icon skeleton"></div>',nameComponent:'<div class="zap-placeholder-name skeleton"></div>',pubkeyComponent:"",referenceComponent:""}}static createReferenceComponent(e){return this.#d(this.#o({reference:e}))}static addReferenceToElement(e,n){if(!this.#i(e,n))return;const r=e.querySelector(".zap-content");this.#a(r,n)}static#i(e,n){return e&&n&&e.querySelector(".zap-content")}static#a(e,n){e.querySelectorAll(".zap-reference").forEach((i=>i.remove()));const r=this.createReferenceComponent({reference:n});e.insertAdjacentHTML("beforeend",r)}static getDialogTemplate(){return`
      <dialog class="dialog">
        <h2 class="dialog-title"><a href="#" target="_blank"></a></h2>
        <button class="close-dialog-button">X</button>
        <div class="zap-stats"></div>
        <ul class="dialog-zap-list"></ul>
      </dialog>
    `}static createZapItemHTML(e,n,r,i){try{const s=this.createUIComponents(e,r,i);return this.#s(e,n,s)}catch{return""}}static createNoZapsMessageHTML(e){return`
      <div class="no-zaps-container">
        <div class="no-zaps-message">${e}</div>
      </div>
    `}static#s(e,n,r){const[i,s]=e.satsText.split(" "),o=(a=e.created_at,Math.floor(Date.now()/1e3)-a<86400);var a;return`
      <div class="zap-content">
        <div class="zap-sender${e.comment?" with-comment":""}" data-pubkey="${e.pubkey}">
          <div class="sender-icon${o?" is-new":""}">
            ${r.iconComponent}
          </div>
          <div class="sender-info">
            ${r.nameComponent}
            ${r.pubkeyComponent}
          </div>
          <div class="zap-amount ${n}"><span class="number">${i}</span> ${s}</div>
        </div>
        ${e.comment?`<div class="zap-details"><span class="zap-comment">${Pf(e.comment)}</span></div>`:""}
        ${r.referenceComponent}
      </div>
    `}static#o(e){if(!e)return null;if(this.#l(e))return e;if(e.reference&&typeof e.reference=="object"){if(e.reference.reference&&this.#l(e.reference.reference))return e.reference.reference;if(this.#l(e.reference))return e.reference}return null}static#l(e){return e&&typeof e=="object"&&"id"in e&&"tags"in e&&Array.isArray(e.tags)&&"content"in e&&"kind"in e}static#c({senderName:e}){return e?`<span class="sender-name">${Pf(e)}</span>`:'<div class="zap-placeholder-name skeleton"></div>'}static#u({pubkey:e,displayIdentifier:n,reference:r},i){const s=!oh(i),o=`class="sender-pubkey" data-pubkey="${e}"`;return r&&s?`<span ${o}>${n}</span>`:`<span ${o} data-nip05-target="true">${n}</span>`}static#d(e){if(!this.#l(e))return"";const n=e.id,r=ht.getReferenceComponent(n);if(r)return r;try{const i=this.#h(e),s=this.#g(e),o=this.#f(i,s);return ht.setReferenceComponent(n,o),o}catch{return""}}static#h(e){if(!e?.tags)return"";if(e.kind===31990)return this.#p(e)||"";const n=Array.isArray(e.tags)?e.tags.find((r=>Array.isArray(r)&&r[0]==="d")):null;return n?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.naddrEncode({kind:r,pubkey:i,identifier:s,relays:o})}catch{return null}})(e.kind,e.pubkey,n[1])}`:e.id?`https://njump.me/${(function(r,i,s,o=[]){try{return window.NostrTools.nip19.neventEncode({id:r,kind:i,pubkey:s,relays:o})}catch{return null}})(e.id,e.kind,e.pubkey)}`:""}static#p(e){const n=e.tags.filter((i=>i[0]==="r"));return(n.find((i=>!i.includes("source")))||n[0])?.[1]}static#g(e){if(!e)return"";const n=ji.#e[e.kind];if(n){const r=e.tags.find((i=>Array.isArray(i)&&i[0]===n));if(r&&r[1])return r[1]}if(e.kind===40)try{return JSON.parse(e.content).name||e.content}catch{}return e.content||""}static#f(e,n){return`
      <div class="zap-reference">
        <div class="reference-arrow">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aCBkPSJtNTYwLTEyMC01Ny01NyAxNDQtMTQzSDIwMHYtNDgwaDgwdjQwMGgzNjdMNTAzLTU0NGw1Ni01NyAyNDEgMjQxLTI0MCAyNDBaIiAvPg0KPC9zdmc+" alt="Reference" width="18" height="18" />
        </div>
        <div class="reference-text">${Pf(n)}</div>
        <a href="${e}" target="_blank" class="reference-link">
          <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAtOTYwIDk2MCA5NjAiIHdpZHRoPSIyNHB4IiBmaWxsPSIjODg4Ij4NCiAgICA8cGF0aA0KICAgICAgICBkPSJNNDQwLTI4MEgyODBxLTgzIDAtMTQxLjUtNTguNVQ4MC00ODBxMC04MyA1OC41LTE0MS41VDI4MC02ODBoMTYwdjgwSDI4MHEtNTAgMC04NSAzNXQtMzUgODVxMCA1MCAzNSA4NXQ4NSAzNWgxNjB2ODBaTTMyMC00NDB2LTgwaDMyMHY4MEgzMjBabTIwMCAxNjB2LTgwaDE2MHE1MCAwIDg1LTM1dDM1LTg1cTAtNTAtMzUtODV0LTg1LTM1SDUyMHYtODBoMTYwcTgzIDAgMTQxLjUgNTguNVQ4ODAtNDgwcTAgODMtNTguNSAxNDEuNVQ2ODAtMjgwSDUyMFoiIC8+DQo8L3N2Zz4=" alt="Quick Reference" width="16" height="16" />
        </a>
      </div>
    `}static ZapInfo=class{#m;constructor(e){this.#m=e}static async createFromEvent(e,n={}){return await new ji.ZapInfo(e).extractInfo(n)}static getAmountColorClass(e,n){return(n===void 0?Et.ZAP_AMOUNT_CONFIG.DEFAULT_COLOR_MODE:n)?this.#y(e):Et.ZAP_AMOUNT_CONFIG.DISABLED_CLASS}static#y(e){const{THRESHOLDS:n,DEFAULT_CLASS:r}=Et.ZAP_AMOUNT_CONFIG;return n.find((i=>e>=i.value))?.className||r}async extractInfo(e={}){const n=this.#m.id,r=ht.getZapInfo(n);if(r)return r.colorClass=ji.ZapInfo.getAmountColorClass(r.satsAmount,e.isColorModeEnabled),r;try{const{pubkey:s,content:o,satsText:a}=await pwe(this.#m),l=parseInt(a.replace(/,/g,"").split(" ")[0],10),c=typeof s=="string"?s:null,u=this.#m.reference||null,d={satsText:a,satsAmount:l,comment:o||"",pubkey:c||"",created_at:this.#m.created_at,displayIdentifier:c?F$(hwe(c)):"anonymous",senderName:null,senderIcon:null,reference:u,colorClass:ji.ZapInfo.getAmountColorClass(l,e?.isColorModeEnabled)};return ht.setZapInfo(n,d),d}catch{const o={satsText:"Amount: Unknown",satsAmount:0,comment:"",pubkey:"",created_at:this.#m.created_at,displayIdentifier:"anonymous",senderName:"anonymous",senderIcon:i,reference:null};return ht.setZapInfo(n,o),o}var i}static async batchExtractInfo(e,n=!0){const r=new Map;return await Promise.all(e.map((async i=>{const s=new ji.ZapInfo(i),o=await s.extractInfo({isColorModeEnabled:n});r.set(i.id,o)}))),r}};static viewConfigs=new Map}class Owe{constructor(e,n){this.viewId=e,this.config=n}async createListItem(e){const n=await ji.ZapInfo.createFromEvent(e,{isColorModeEnabled:this.config?.isColorModeEnabled}),r=document.createElement("li");return r.className=`zap-list-item ${n.colorClass}${n.comment?" with-comment":""}`,r.setAttribute("data-pubkey",n.pubkey),e?.id&&r.setAttribute("data-event-id",e.id),r.innerHTML=ji.createZapItemHTML(n,n.colorClass,this.viewId),r.setAttribute("data-timestamp",e.created_at.toString()),{li:r,zapInfo:n}}}class Mwe{constructor(e,n,r,i){if(!e)throw new Error("shadowRoot is required");if(!i)throw new Error("config is required");this.shadowRoot=e,this.profileUI=n,this.viewId=r,this.config=i,this.itemBuilder=new Owe(r,this.config),this.profileUpdateUnsubscribe=null,this.#h()}destroy(){this.profileUpdateUnsubscribe&&(this.profileUpdateUnsubscribe(),this.profileUpdateUnsubscribe=null);const e=this.#e(".dialog-zap-list");e&&(e.innerHTML="")}#e(e){return this.shadowRoot.querySelector(e)}getElementByEventId(e){return this.#e(`.zap-list-item[data-event-id="${e}"]`)}async#t(e){const n=this.#e(".dialog-zap-list");if(n)try{return this.#r(n),await e(n)}catch{n.children.length===0&&this.showNoZapsMessage()}}#n(e,n){const r=e.querySelector(".load-more-trigger");r&&r.remove(),Array.from(n.children).forEach((i=>{const s=i.getAttribute("data-event-id"),o=parseInt(i.getAttribute("data-timestamp"));let a=null;const l=Array.from(e.children);for(let c=0;c<l.length;c++)if(o>parseInt(l[c].getAttribute("data-timestamp"))){a=l[c];break}e.querySelector(`.zap-list-item[data-event-id="${s}"]`)||(a?e.insertBefore(i,a):e.appendChild(i))})),r&&e.appendChild(r)}#r(e){const n=e.querySelector(".no-zaps-message");n&&n.remove()}async#i(e,n){return this.#t((async r=>{const{li:i,zapInfo:s}=await this.itemBuilder.createListItem(e);return n(r,i),await this.#f(s.pubkey,i),{li:i,zapInfo:s}}))}async renderZapListFromCache(e){if(!e?.length)return ht.setNoZapsState(this.viewId,!1),this.showNoZapsMessage();await this.#t((async n=>{const{initialBatch:r,remainingBatch:i}=this.#a(e),{fragment:s,profileUpdates:o}=await this.#s(r);this.#n(n,s),i.length>0?this.#o(i,n,o):await this.#g(o)}))}#a(e){const n=this.#y(e),r=Et.DIALOG_CONFIG.ZAP_LIST.INITIAL_BATCH;return{initialBatch:n.slice(0,r),remainingBatch:n.slice(r)}}async#s(e){const n=document.createDocumentFragment(),r=[];for(const i of e){const{li:s,zapInfo:o}=await this.itemBuilder.createListItem(i);this.#w(i.id,s),n.appendChild(s),o.pubkey&&r.push({pubkey:o.pubkey,element:s})}return{fragment:n,profileUpdates:r}}#o(e,n,r){if(!e.length)return;const i=Et.DIALOG_CONFIG.ZAP_LIST.REMAINING_BATCH;let s=0;const o=async()=>{if(s>=e.length)return void await this.#g(r);const a=e.slice(s,s+i);await this.#l(a,n,r),s+=i,setTimeout((()=>o()),0)};requestIdleCallback((()=>o()))}async#l(e,n,r){const i=document.createDocumentFragment();await Promise.all(e.map((async o=>{const{li:a,zapInfo:l}=await this.itemBuilder.createListItem(o);this.#w(o.id,a),i.appendChild(a),l.pubkey&&r.push({pubkey:l.pubkey,element:a})})));const s=n.querySelector(".load-more-trigger");s&&s.remove(),n.appendChild(i),s&&n.appendChild(s),await new Promise((o=>requestAnimationFrame(o)))}async prependZap(e){return this.#i(e,((n,r)=>n.prepend(r)))}async appendZap(e){return this.#i(e,((n,r)=>{const i=this.#d(n,e.created_at);i?n.insertBefore(r,i):n.appendChild(r)}))}async replacePlaceholderWithZap(e,n){const r=this.#e(`[data-index="${n}"]`);if(this.#b(r))try{const{zapInfo:i}=await this.itemBuilder.createListItem(e);this.#v(r,i,e.id),await this.#f(i.pubkey,r)}catch{r.remove()}}async showNoZapsMessage(){const e=this.#e(".dialog-zap-list");if(e){if(ht.hasNoZaps(this.viewId))return void this.#u(e);await this.#c()||(this.#u(e),ht.setNoZapsState(this.viewId,!0))}}async#c(){const e=this.config.noZapsDelay||Et.DIALOG_CONFIG.DEFAULT_NO_ZAPS_DELAY;await new Promise((r=>setTimeout(r,e)));const n=ht.getZapEvents(this.viewId);return!!n?.length&&(await this.renderZapListFromCache(n),!0)}#u(e){const n=this.config.noZapsMessage||Et.DIALOG_CONFIG.NO_ZAPS_MESSAGE;e.innerHTML=ji.createNoZapsMessageHTML(n),e.style.minHeight=Et.DIALOG_CONFIG.ZAP_LIST.MIN_HEIGHT}async batchUpdate(e,n={}){const r=this.#e(".dialog-zap-list");if(r)try{const i=new Map(Array.from(r.querySelectorAll(".zap-list-item")).map((c=>[c.getAttribute("data-event-id"),c]))),s=this.#y(e),o=oh(this.config.identifier),a=s.filter((c=>{const u=i.get(c.id);return o?!u:!u||c.reference&&!u.querySelector(".zap-reference")}));if(a.length===0&&!n.isFullUpdate)return;const l=document.createDocumentFragment();for(const c of a){const{li:u,zapInfo:d}=await this.itemBuilder.createListItem(c);!o&&c.reference&&this.updateZapReference(c),l.appendChild(u),d.pubkey&&await this.#f(d.pubkey,u)}this.#n(r,l)}catch{}}#d(e,n){return Array.from(e.children).find((r=>{const i=parseInt(r.getAttribute("data-timestamp")||"0");return n>i}))}updateZapReference(e){if(e?.id&&e?.reference)try{const n=this.getElementByEventId(e.id);if(!n)return;ji.addReferenceToElement(n,e.reference),ht.setReference(e.id,e.reference)}catch{}}#h(){this.profileUpdateUnsubscribe=ht.subscribeToProfileUpdates(this.#p.bind(this))}async#p(e,n){const r=this.shadowRoot.querySelectorAll(`[data-pubkey="${e}"]`);await Promise.allSettled(Array.from(r).map((i=>this.profileUI.updateProfileElement(i,n))))}async#g(e){const n=Et.DIALOG_CONFIG.ZAP_LIST.PROFILE_BATCH;for(let r=0;r<e.length;r+=n){const i=e.slice(r,r+n);await Promise.all(i.map((({pubkey:s,element:o})=>this.#f(s,o)))),await new Promise((s=>requestAnimationFrame(s)))}}async#f(e,n){e&&await this.#m(e,n)}async#m(e,n){if(e&&n)try{await this.profileUI.loadAndUpdate(e,n)}catch{}}#y(e){return[...new Map(e.map((n=>[n.id,n]))).values()].sort(((n,r)=>r.created_at-n.created_at))}#w(e,n){if(oh(this.config.identifier))return;const r=ht.getReference(e);r&&ji.addReferenceToElement(n,r)}#b(e){return e&&e.classList.contains("placeholder")}#v(e,n,r){const i=this.itemBuilder.getAmountColorClass(n.satsAmount);e.className=`zap-list-item ${i}${n.comment?" with-comment":""}`,e.setAttribute("data-pubkey",n.pubkey),e.setAttribute("data-event-id",r),e.innerHTML=ji.createZapItemHTML(n,i,this.viewId),e.removeAttribute("data-index")}}var Nwe=ui(0),Rwe=ui.n(Nwe);const Tm=new class{#e=new Map;#t=new Map;constructor(){}async getZapStats(t,e){const n=await this.#n(e,t);if(n)return n;const r=await this.fetchStats(t);return r&&ht.updateStatsCache(e,t,r),r}async fetchStats(t){try{const e=await this._fetchFromApi(t);return this._formatStats(e)||this.createTimeoutError()}catch(e){return this.handleFetchError(e)}}createTimeoutError(){return{error:!0,timeout:!0}}handleFetchError(t){return{error:!0,timeout:t.message==="STATS_TIMEOUT"}}async _fetchFromApi(t){const e=r4(t);if(!e)return null;const n=`https://api.nostr.band/v0/stats/${e.type==="npub"||e.type==="nprofile"?"profile":"event"}/${t}`,r=new AbortController,i=setTimeout((()=>r.abort()),Et.REQUEST_CONFIG.REQUEST_TIMEOUT);try{return await(await fetch(n,{signal:r.signal})).json()}catch(s){throw s.name==="AbortError"?new Error("STATS_TIMEOUT"):s}finally{clearTimeout(i)}}_formatStats(t){if(!t?.stats)return null;const e=Object.values(t.stats)[0];return e?{count:parseInt(e.zaps_received?.count||e.zaps?.count||0,10),msats:parseInt(e.zaps_received?.msats||e.zaps?.msats||0,10),maxMsats:parseInt(e.zaps_received?.max_msats||e.zaps?.max_msats||0,10)}:null}async initializeStats(t,e,n=!1){if(n&&this.displayStats({skeleton:!0},e),this.#t.has(e))return this.#t.get(e);if(r4(t)?.type==="naddr"){const s=this.createTimeoutError();return this.displayStats(s,e),this.#e.set(e,s),s}const i=(async()=>{try{const s=await this.getZapStats(t,e);return s&&(this.displayStats(s,e),this.#e.set(e,s)),s}catch{return null}finally{this.#t.delete(e)}})();return this.#t.set(e,i),i}async#n(t,e){const n=ht.getCachedStats(t,e),r=Date.now();return n&&r-n.timestamp<Et.REQUEST_CONFIG.CACHE_DURATION?n.stats:null}getCurrentStats(t){return this.#e.get(t)}async handleZapEvent(t,e,n){if(t?.isRealTimeEvent)try{const r=t.tags.find((l=>l[0].toLowerCase()==="bolt11"))?.[1],i=this.extractAmountFromBolt11(r);if(i<=0)return;const s=ht.getViewStats(e),o={count:s?.count||0,msats:s?.msats||0,maxMsats:s?.maxMsats||0},a={count:o.count+1,msats:o.msats+i,maxMsats:Math.max(o.maxMsats,i)};ht.updateStatsCache(e,n,a),this.#e.set(e,a),await this.displayStats(a,e),t.isStatsCalculated=!0,t.amountMsats=i}catch{}}extractAmountFromBolt11(t){try{const e=window.decodeBolt11(t);return parseInt(e.sections.find((n=>n.name==="amount"))?.value??"0",10)}catch{return 0}}async displayStats(t,e){try{await Lwe(t,e)}catch{}}},Lu=new class{#e;#t;#n;#r;#i;#a;#s;constructor(){this.#e=new U$,this.#o(),this.#l()}#o(){this.#n=new Map,this.#r=new Map,this.#i=new Map,this.#t=!1}#l(){const t={pool:this.#e,batchSize:Et.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_SIZE,batchDelay:Et.BATCH_CONFIG.REFERENCE_PROCESSOR.BATCH_DELAY};this.#a=new ywe(t),this.#s=new bwe(t)}#c(t){this.#n.has(t)||this.#n.set(t,{zap:null}),this.#r.has(t)||this.#r.set(t,{isZapClosed:!1})}#u(t,e,n,r){this.#n.get(t).zap=this.#e.subscribeMany(e.relayUrls,[n.req],r)}#d(t){return t&&t.id&&Array.isArray(t.tags)}#h(t,e){return t&&this.#i.delete(t),null}async connectToRelays(t){this.#t||([this.#a,this.#s].forEach((e=>e.setRelayUrls(t))),this.#t=!0)}subscribeToZaps(t,e,n,r){try{this.#p(n),this.#c(t),this.#r.get(t).isZapClosed=!1,this.#u(t,e,n,this.#g(r))}catch(i){this.#f("Subscription error",i)}}#p(t){if(!t?.req?.kinds||!Array.isArray(t.req.kinds))throw new Error("Invalid subscription settings")}async fetchReference(t,e,n){try{if(!this.#d(e))return null;const r=e.tags.find((l=>Array.isArray(l)&&l[0]===n));if(!r)return null;const i=n==="e"?r[1]:`${r[1]}`,s=ht.getReference(i);if(s)return s;const o=this.#i.get(i);if(o)return o;const a=n==="e"?this.#a:this.#s;try{const l=await a.getOrCreateFetchPromise(i);return l&&ht.setReference(i,l),this.#i.delete(i),l}finally{this.#i.delete(i)}}catch(r){return this.#h(e?.id,r)}}#g(t){const e=Math.floor(Date.now()/1e3);return{...t,onevent:n=>{n.isRealTimeEvent=n.created_at>=e,t.onevent(n)},oneose:t.oneose}}#f(t,e){throw e}get zapPool(){return this.#e}},{zapPool:P2e}=Lu,Fo=new class{constructor(){this.viewConfigs=new Map,this.configStore=new Map,this.observers=new Map,this.#e=new Map,this.#t=new Map}#e;#t;setZapListUI(t){this.zapListUI=t}setViewConfig(t,e){this.viewConfigs.set(t,e),ji.viewConfigs.set(t,e),ht.initializeZapView(t)}getViewConfig(t){return this.viewConfigs.get(t)}async updateEventReference(t,e){try{const n=this.getViewConfig(e);if(!n?.relayUrls?.length||oh(n?.identifier||""))return!1;const r=await this._fetchEventReference(t,n);return!!r&&(t.reference=r,!0)}catch{return!1}}async _fetchEventReference(t,e){const n=async()=>{if(!t?.tags||!Array.isArray(t.tags))return null;try{if(t.tags.find((s=>Array.isArray(s)&&s[0]==="a"))?.[1])return await Lu.fetchReference(e.relayUrls,t,"a");const i=t.tags.find((s=>Array.isArray(s)&&s[0]==="e"));return i?.[1]&&/^[0-9a-f]{64}$/.test(i[1].toLowerCase())?await Lu.fetchReference(e.relayUrls,t,"e"):null}catch{return null}};try{return await ht.getOrFetchReference(t.id,n)}catch{return null}}async updateEventReferenceBatch(t,e){const n=this.getViewConfig(e);if(!n?.relayUrls?.length||oh(n?.identifier||""))return;const r=t.map((i=>this.updateEventReference(i,e)));await Promise.allSettled(r)}updateUIReferences(t){this.zapListUI&&t.forEach((e=>{e.reference&&this.zapListUI.updateZapReference(e)}))}async initializeSubscriptions(t,e){try{if(!this._isValidFilter(t))throw new Error("Invalid filter settings");const n=n4(t.identifier);if(!n)throw new Error(Et.ZAP_CONFIG.ERRORS.DECODE_FAILED);this._initializeLoadState(e),this._showInitialLoadingSpinner(e);const{batchEvents:r,lastEventTime:i}=await this._collectInitialEvents(e,t,n);r?.length>0&&this._processBatchEvents(r,e).catch(console.error),await this.finalizeInitialization(e,i)}catch(n){throw n}}_showInitialLoadingSpinner(t){const e=this._getListElement(t);if(e){const n=this._createLoadTrigger();e.appendChild(n)}}async finalizeInitialization(t,e){const n=ht.getZapEvents(t),r=this._getListElement(t),i=ht.updateLoadState(t,{isInitialFetchComplete:!0,lastEventTime:e});await Promise.all([i,n.length===0?this.zapListUI?.showNoZapsMessage():null,n.length>=Et.REQ_CONFIG.INITIAL_LOAD_COUNT?this.setupInfiniteScroll(t):null]),r?.querySelector(".load-more-trigger")?.remove()}_initializeLoadState(t){ht.updateLoadState(t,{isInitialFetchComplete:!1,lastEventTime:null,isLoading:!1})}_isValidFilter(t){return t&&t.relayUrls&&Array.isArray(t.relayUrls)&&t.relayUrls.length>0&&t.identifier}setupInfiniteScroll(t){try{this._cleanupInfiniteScroll(t);const e=this._getListElement(t);if(!e)return;const n=this._createLoadTrigger();e.appendChild(n),this._observeLoadTrigger(n,t,e)}catch{}}_createLoadTrigger(){const t=document.createElement("div");t.className="load-more-trigger";const e=document.createElement("div");return e.className="loading-spinner",t.appendChild(e),t}_observeLoadTrigger(t,e,n){const r=new IntersectionObserver((i=>this._handleIntersection(i[0],e)),{root:n,rootMargin:Et.INFINITE_SCROLL.ROOT_MARGIN,threshold:Et.INFINITE_SCROLL.THRESHOLD});r.observe(t),this.observers.set(e,r)}async _handleIntersection(t,e){t.isIntersecting&&(ht.getLoadState(e).isLoading?setTimeout((()=>{t.isIntersecting&&this._handleIntersection(t,e)}),Et.INFINITE_SCROLL.RETRY_DELAY):this.loadMoreZaps(e).then((n=>{n===0&&this._cleanupInfiniteScroll(e)})).catch((n=>{this._cleanupInfiniteScroll(e)})))}_cleanupInfiniteScroll(t){const e=this.observers.get(t);if(!e)return;e.disconnect(),this._getListElement(t)?.querySelector(".load-more-trigger")?.remove(),this.observers.delete(t)}_getListElement(t){return document.querySelector(`nzv-dialog[data-view-id="${t}"]`)?.shadowRoot?.querySelector(".dialog-zap-list")}async loadMoreZaps(t){const e=ht.getLoadState(t),n=this.getViewConfig(t);if(!this._canLoadMore(e,n))return 0;e.isLoading=!0;try{const r=await this._executeLoadMore(t,e,n);if(r>0){const i=ht.getZapEvents(t).slice(-r);await this.updateEventReferenceBatch(i,t),this.updateUIReferences(i)}return r}finally{e.isLoading=!1}}async _executeLoadMore(t,e,n){const r=n4(n.identifier,e.lastEventTime);if(!r)return 0;const i=[],s=setTimeout((()=>{i.length===0&&this._cleanupInfiniteScroll(t)}),Et.LOAD_TIMEOUT);try{return await this._collectEvents(t,n,r,i,Et.REQ_CONFIG.ADDITIONAL_LOAD_COUNT,e),i.length>0&&await this._processBatchEvents(i,t),i.length}catch{return 0}finally{clearTimeout(s)}}async _collectEvents(t,e,n,r,i,s){return new Promise(((o,a)=>{const l=setTimeout((()=>a(new Error("Load timeout"))),Et.LOAD_TIMEOUT);Lu.subscribeToZaps(t,e,n,{onevent:c=>{c.created_at<s.lastEventTime&&(r.push(c),s.lastEventTime=Math.min(s.lastEventTime,c.created_at),r.length>=i&&(clearTimeout(l),o()))},oneose:()=>{clearTimeout(l),o()}})}))}async _collectInitialEvents(t,e,n){const r=[];let i=null;return new Promise((s=>{const o=this._setupBufferInterval(r,t),a=Lu.subscribeToZaps(t,e,n,{onevent:l=>{const c=this._handleInitialEvent(l,r,i,t);c!==null&&(i=c)},oneose:()=>{clearInterval(o),s({batchEvents:[...r],lastEventTime:i})}});this.#e.set(t,{zap:a})}))}_handleInitialEvent(t,e,n,r){const i=Math.min(n||t.created_at,t.created_at);if(ht.addZapEvent(r,t)){if(e.push(t),this.updateEventReference(t,r).then((s=>{s&&this.zapListUI&&t.reference&&this.zapListUI.updateZapReference(t)})),t.isRealTimeEvent){const s=this.getViewConfig(r);Tm.handleZapEvent(t,r,s?.identifier),this.zapListUI&&this.zapListUI.prependZap(t).catch(console.error)}e.length>=Et.BATCH_SIZE&&this.zapListUI&&this.zapListUI.batchUpdate(ht.getZapEvents(r)).catch(console.error)}return i}async _processBatchEvents(t,e){if(t?.length){t.sort(((n,r)=>r.created_at-n.created_at)),t.forEach((n=>ht.addZapEvent(e,n)));try{await Promise.all([Em.processBatchProfiles(t)])}catch{}await this._updateUI(t,e)}}async _updateUI(t,e){this.zapListUI&&await this.zapListUI.batchUpdate(t,{isFullUpdate:!0})}_setupBufferInterval(t,e){let n=0;const r=Et.BUFFER_MIN_INTERVAL;return setInterval((()=>{const i=Date.now();t.length>0&&i-n>=r&&this.zapListUI&&(this.zapListUI.batchUpdate(ht.getZapEvents(e),{isBufferUpdate:!0}).catch(console.error),n=i)}),Et.BUFFER_INTERVAL)}_canLoadMore(t,e){return e&&!t.isLoading&&t.lastEventTime}unsubscribe(t){try{const e=this.#e.get(t);e?.zap&&(e.zap(),e.zap=null),this.#t.set(t,{isZapClosed:!0}),this._cleanupInfiniteScroll(t)}catch{}}};class Dwe extends HTMLElement{#e;#t;constructor(){super(),this.attachShadow({mode:"open"}),this.#e={isInitialized:!1,theme:Et.DEFAULT_OPTIONS.theme},this.popStateHandler=e=>{e.preventDefault(),this.#o(".dialog")?.open&&this.closeDialog()}}async connectedCallback(){if(this.viewId=this.getAttribute("data-view-id"),this.viewId){this.#t=this.#n();try{await this.#t,this.#e.isInitialized=!0;const e=Fo.getViewConfig(this.viewId);if(!e)throw new Error("Config is required for initialization");if(await this.#r(e),this.getAttribute("data-nzv-id")){const n=await Tm.getCurrentStats(this.viewId);n&&this.statsUI.displayStats(n)}this.#e.isInitialized=!0,this.dispatchEvent(new CustomEvent("dialog-initialized",{detail:{viewId:this.viewId}}))}catch{}}}async#n(){return new Promise((e=>{const n=document.createElement("template");n.innerHTML=ji.getDialogTemplate(),this.shadowRoot.appendChild(n.content.cloneNode(!0)),this.#i(),queueMicrotask((()=>e()))}))}async#r(e){const n=document.createElement("style");n.textContent=Rwe(),this.shadowRoot.appendChild(n),this.statsUI=new gwe(this.shadowRoot),this.profileUI=new Iwe,this.zapListUI=new Mwe(this.shadowRoot,this.profileUI,this.viewId,e),Fo.setZapListUI(this.zapListUI);const r=ht.getZapEvents(this.viewId);r?.length?await this.zapListUI.renderZapListFromCache(r):this.zapListUI.showNoZapsMessage();const i=this.getAttribute("data-nzv-id");if(i){const s=await ht.getCachedStats(this.viewId,i);if(s?.stats)this.statsUI.displayStats(s.stats);else{const o=await Tm.getCurrentStats(this.viewId);o&&this.statsUI.displayStats(o)}}}static get observedAttributes(){return["data-theme"]}#i(){const e=this.#o(".dialog");this.#o(".close-dialog-button").addEventListener("click",(()=>this.closeDialog())),e.addEventListener("click",(n=>{n.target===e&&this.closeDialog()})),e.addEventListener("cancel",(n=>{n.preventDefault(),this.closeDialog()})),document.addEventListener("keydown",(n=>{if(e?.open){if(n.key==="Escape")this.closeDialog();else if(n.key===" "){n.preventDefault();const r=this.#o(".dialog-zap-list");r&&(r.scrollTop+=.8*r.clientHeight)}}}))}attributeChangedCallback(e,n,r){n!==r&&e==="data-theme"&&this.#a(r)}#a(e){ht.updateThemeState(this.viewId,{theme:e}).isInitialized&&this.#s()}#s(){const e=ht.getThemeState(this.viewId).theme==="dark"?"dark-theme":"light-theme";this.shadowRoot.host.classList.add(e)}async showDialog(){await this.#t;const e=this.#o(".dialog");e&&!e.open&&this.#e.isInitialized&&(window.addEventListener("popstate",this.popStateHandler),e.showModal(),queueMicrotask((()=>{document.activeElement&&document.activeElement.blur()})),this.#l())}closeDialog(){const e=this.#o(".dialog");e?.open&&(this.zapListUI?.destroy(),Fo.unsubscribe(this.viewId),e.close(),this.remove(),window.removeEventListener("popstate",this.popStateHandler))}displayZapStats(e){this.statsUI.displayStats(e)}#o(e){return this.shadowRoot.querySelector(e)}#l(){const e=this.getAttribute("data-view-id"),n=document.querySelector(`button[data-zap-view-id="${e}"]`);if(!n)return;const r=this.#o(".dialog-title"),i=this.#o(".dialog-title a");if(!i||!r)return;const s=n.getAttribute("data-title"),o=n.getAttribute("data-nzv-id");i.href=o?`https://njump.me/${o}`:"#",s?.trim()?(i.textContent=s,r.classList.add("custom-title")):(i.textContent=Et.DIALOG_CONFIG.DEFAULT_TITLE+F$(o),r.classList.remove("custom-title"))}getOperations(){if(!this.#e.isInitialized)return null;const e={closeDialog:()=>this.closeDialog(),showDialog:()=>this.showDialog()};return this.#e.isInitialized&&Object.assign(e,{prependZap:n=>this.zapListUI?.prependZap(n),displayZapStats:n=>this.statsUI?.displayStats(n),showNoZapsMessage:()=>this.zapListUI?.showNoZapsMessage()}),e}async waitForInitialization(){return this.#t}}customElements.define("nzv-dialog",Dwe);const _b={create:async(t,e)=>{if(!t||!e)return Promise.reject(new Error("Invalid viewId or config"));Fo.setViewConfig(t,e);const n=document.querySelector(`nzv-dialog[data-view-id="${t}"]`);if(n)return n;const r=document.createElement("nzv-dialog");r.setAttribute("data-view-id",t),r.setAttribute("data-config",JSON.stringify(e));const i=document.querySelector(`button[data-zap-view-id="${t}"]`);return i?.getAttribute("data-nzv-id")&&r.setAttribute("data-nzv-id",i.getAttribute("data-nzv-id")),document.body.appendChild(r),await r.waitForInitialization(),r},get:t=>document.querySelector(`nzv-dialog[data-view-id="${t}"]`),execute:(t,e,...n)=>{const r=_b.get(t),i=r?.getOperations();return i?i[e]?.(...n)??null:null}},Lwe=(t,e)=>_b.execute(e,"displayZapStats",t);async function Bwe(t,e){try{const n=km.fromButton(t);if(!n)throw new Error("Failed to create config from button");if(Fo.setViewConfig(e,n),!await(async function(i){try{const s=Fo.getViewConfig(i);if(!s)throw new Error(`View configuration not found for viewId: ${i}`);return Fo.setViewConfig(i,s),await _b.create(i,s)}catch{return null}})(e))throw new Error(Et.ZAP_CONFIG.ERRORS.DIALOG_NOT_FOUND);await(async function(i){try{const s=_b.get(i);if(!s)throw new Error("Dialog not found");await s.waitForInitialization();const o=s.getOperations();if(!o?.showDialog)throw new Error("Basic dialog operations not available");o.showDialog()}catch{}})(e),setTimeout((async()=>{if(await(async function(i,s){const o=ht.getZapEvents(i);if(o.length>0){const l=[...new Set(o.map((c=>c.pubkey)))];Em.fetchProfiles(l)}const{hasEnoughCachedEvents:a}=await ht.processCachedData(i,s);return a&&Fo.setupInfiniteScroll(i),a})(e,n),!t.hasAttribute("data-initialized")){const i=t.getAttribute("data-nzv-id");await Promise.all([Lu.connectToRelays(n.relayUrls),Fo.initializeSubscriptions(n,e),i?Tm.initializeStats(i,e,!0):Promise.resolve()]),t.setAttribute("data-initialized","true")}}),0)}catch{}}function H$(){Object.entries(Et.LIBRARIES).forEach((([t,e])=>{window[t]=e})),document.querySelectorAll("button[data-nzv-id]").forEach(((t,e)=>{if(t.hasAttribute("data-zap-view-id"))return;const n=`nostr-zap-view-${e}`;t.setAttribute("data-zap-view-id",n),t.hasAttribute("data-zap-color-mode")||t.setAttribute("data-zap-color-mode",Et.ZAP_CONFIG.DEFAULT_COLOR_MODE),t.addEventListener("click",(()=>Bwe(t,n)))}))}function V$(t={}){Object.assign(Et,t),typeof window<"u"&&H$()}function Fwe(t={}){return V$(t)}typeof window<"u"&&document.addEventListener("DOMContentLoaded",H$);ua.vQ;ua.ZM;ua.yk;ua.h0;ua.n_;var $we=ua.Xz;ua.Uv;ua.fU;ua.Dw;var i4={},s4;function zwe(){if(s4)return i4;s4=1;var t=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof CA<"u"?CA:{};function e(v){return v&&v.__esModule?v.default:v}var n={},r={},i=t.parcelRequire1faa;i==null&&(i=function(v){if(v in n)return n[v].exports;if(v in r){var w=r[v];delete r[v];var A={id:v,exports:{}};return n[v]=A,w.call(A.exports,A,A.exports),A.exports}var L=new Error("Cannot find module '"+v+"'");throw L.code="MODULE_NOT_FOUND",L},i.register=function(w,A){r[w]=A},t.parcelRequire1faa=i),i.register("58QMB",function(v,w){(function(){function A(q,Q){var ae,pe=Object.keys(Q);for(ae=0;ae<pe.length;ae++)q=q.replace(new RegExp("\\{"+pe[ae]+"\\}","gi"),Q[pe[ae]]);return q}function L(q){var Q,ae,pe;if(!q)throw new Error("cannot create a random attribute name for an undefined object");Q="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",ae="";do for(ae="",pe=0;pe<12;pe++)ae+=Q[Math.floor(Math.random()*Q.length)];while(q[ae]);return ae}function $(q){var Q={left:"start",right:"end",center:"middle",start:"start",end:"end"};return Q[q]||Q.start}function U(q){var Q={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return Q[q]||Q.alphabetic}var G,j,ue,ye,de;de=(function(q,Q){var ae,pe,Se,_e={};for(q=q.split(","),Q=Q||10,ae=0;ae<q.length;ae+=2)pe="&"+q[ae+1]+";",Se=parseInt(q[ae],Q),_e[pe]="&#"+Se+";";return _e["\\xa0"]="&#160;",_e})("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),G={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},ue=function(q,Q){this.__root=q,this.__ctx=Q},ue.prototype.addColorStop=function(q,Q){var ae,pe,Se=this.__ctx.__createElement("stop");Se.setAttribute("offset",q),Q.indexOf("rgba")!==-1?(ae=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,pe=ae.exec(Q),Se.setAttribute("stop-color",A("rgb({r},{g},{b})",{r:pe[1],g:pe[2],b:pe[3]})),Se.setAttribute("stop-opacity",pe[4])):Se.setAttribute("stop-color",Q),this.__root.appendChild(Se)},ye=function(q,Q){this.__root=q,this.__ctx=Q},j=function(q){var Q,ae={width:500,height:500,enableMirroring:!1};if(arguments.length>1?(Q=ae,Q.width=arguments[0],Q.height=arguments[1]):Q=q||ae,!(this instanceof j))return new j(Q);this.width=Q.width||ae.width,this.height=Q.height||ae.height,this.enableMirroring=Q.enableMirroring!==void 0?Q.enableMirroring:ae.enableMirroring,this.canvas=this,this.__document=Q.document||document,Q.ctx?this.__ctx=Q.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)},j.prototype.__createElement=function(q,Q,ae){Q===void 0&&(Q={});var pe,Se,_e=this.__document.createElementNS("http://www.w3.org/2000/svg",q),Ze=Object.keys(Q);for(ae&&(_e.setAttribute("fill","none"),_e.setAttribute("stroke","none")),pe=0;pe<Ze.length;pe++)Se=Ze[pe],_e.setAttribute(Se,Q[Se]);return _e},j.prototype.__setDefaultStyles=function(){var q,Q,ae=Object.keys(G);for(q=0;q<ae.length;q++)Q=ae[q],this[Q]=G[Q].canvas},j.prototype.__applyStyleState=function(q){var Q,ae,pe=Object.keys(q);for(Q=0;Q<pe.length;Q++)ae=pe[Q],this[ae]=q[ae]},j.prototype.__getStyleState=function(){var q,Q,ae={},pe=Object.keys(G);for(q=0;q<pe.length;q++)Q=pe[q],ae[Q]=this[Q];return ae},j.prototype.__applyStyleToCurrentElement=function(q){var Q=this.__currentElement,ae=this.__currentElementsToStyle;ae&&(Q.setAttribute(q,""),Q=ae.element,ae.children.forEach(function(hn){hn.setAttribute(q,"")}));var pe,Se,_e,Ze,Ne,it,tt=Object.keys(G);for(pe=0;pe<tt.length;pe++)if(Se=G[tt[pe]],_e=this[tt[pe]],Se.apply){if(_e instanceof ye){if(_e.__ctx)for(;_e.__ctx.__defs.childNodes.length;)Ze=_e.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[Ze]=Ze,this.__defs.appendChild(_e.__ctx.__defs.childNodes[0]);Q.setAttribute(Se.apply,A("url(#{id})",{id:_e.__root.getAttribute("id")}))}else if(_e instanceof ue)Q.setAttribute(Se.apply,A("url(#{id})",{id:_e.__root.getAttribute("id")}));else if(Se.apply.indexOf(q)!==-1&&Se.svg!==_e)if(Se.svgAttr!=="stroke"&&Se.svgAttr!=="fill"||_e.indexOf("rgba")===-1){var et=Se.svgAttr;if(tt[pe]==="globalAlpha"&&(et=q+"-"+Se.svgAttr,Q.getAttribute(et)))continue;Q.setAttribute(et,_e)}else{Ne=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi,it=Ne.exec(_e),Q.setAttribute(Se.svgAttr,A("rgb({r},{g},{b})",{r:it[1],g:it[2],b:it[3]}));var st=it[4],ft=this.globalAlpha;ft!=null&&(st*=ft),Q.setAttribute(Se.svgAttr+"-opacity",st)}}},j.prototype.__closestGroupOrSvg=function(q){return q=q||this.__currentElement,q.nodeName==="g"||q.nodeName==="svg"?q:this.__closestGroupOrSvg(q.parentNode)},j.prototype.getSerializedSvg=function(q){var Q,ae,pe,Se,_e,Ze,Ne=new XMLSerializer().serializeToString(this.__root);if(Ze=/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi,Ze.test(Ne)&&(Ne=Ne.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),q)for(Q=Object.keys(de),ae=0;ae<Q.length;ae++)pe=Q[ae],Se=de[pe],_e=new RegExp(pe,"gi"),_e.test(Ne)&&(Ne=Ne.replace(_e,Se));return Ne},j.prototype.getSvg=function(){return this.__root},j.prototype.save=function(){var q=this.__createElement("g"),Q=this.__closestGroupOrSvg();this.__groupStack.push(Q),Q.appendChild(q),this.__currentElement=q,this.__stack.push(this.__getStyleState())},j.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var q=this.__stack.pop();this.__applyStyleState(q)},j.prototype.__addTransform=function(q){var Q=this.__closestGroupOrSvg();if(Q.childNodes.length>0){this.__currentElement.nodeName==="path"&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:Q,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var ae=this.__createElement("g");Q.appendChild(ae),this.__currentElement=ae}var pe=this.__currentElement.getAttribute("transform");pe?pe+=" ":pe="",pe+=q,this.__currentElement.setAttribute("transform",pe)},j.prototype.scale=function(q,Q){Q===void 0&&(Q=q),this.__addTransform(A("scale({x},{y})",{x:q,y:Q}))},j.prototype.rotate=function(q){var Q=180*q/Math.PI;this.__addTransform(A("rotate({angle},{cx},{cy})",{angle:Q,cx:0,cy:0}))},j.prototype.translate=function(q,Q){this.__addTransform(A("translate({x},{y})",{x:q,y:Q}))},j.prototype.transform=function(q,Q,ae,pe,Se,_e){this.__addTransform(A("matrix({a},{b},{c},{d},{e},{f})",{a:q,b:Q,c:ae,d:pe,e:Se,f:_e}))},j.prototype.beginPath=function(){var q,Q;this.__currentDefaultPath="",this.__currentPosition={},q=this.__createElement("path",{},!0),Q=this.__closestGroupOrSvg(),Q.appendChild(q),this.__currentElement=q},j.prototype.__applyCurrentDefaultPath=function(){var q=this.__currentElement;q.nodeName==="path"?q.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",q.nodeName)},j.prototype.__addPathCommand=function(q){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=q},j.prototype.moveTo=function(q,Q){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.__currentPosition={x:q,y:Q},this.__addPathCommand(A("M {x} {y}",{x:q,y:Q}))},j.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},j.prototype.lineTo=function(q,Q){this.__currentPosition={x:q,y:Q},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(A("L {x} {y}",{x:q,y:Q})):this.__addPathCommand(A("M {x} {y}",{x:q,y:Q}))},j.prototype.bezierCurveTo=function(q,Q,ae,pe,Se,_e){this.__currentPosition={x:Se,y:_e},this.__addPathCommand(A("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:q,cp1y:Q,cp2x:ae,cp2y:pe,x:Se,y:_e}))},j.prototype.quadraticCurveTo=function(q,Q,ae,pe){this.__currentPosition={x:ae,y:pe},this.__addPathCommand(A("Q {cpx} {cpy} {x} {y}",{cpx:q,cpy:Q,x:ae,y:pe}))};var ge=function(q){var Q=Math.sqrt(q[0]*q[0]+q[1]*q[1]);return[q[0]/Q,q[1]/Q]};j.prototype.arcTo=function(q,Q,ae,pe,Se){var _e=this.__currentPosition&&this.__currentPosition.x,Ze=this.__currentPosition&&this.__currentPosition.y;if(_e!==void 0&&Ze!==void 0){if(Se<0)throw new Error("IndexSizeError: The radius provided ("+Se+") is negative.");if(_e===q&&Ze===Q||q===ae&&Q===pe||Se===0)return void this.lineTo(q,Q);var Ne=ge([_e-q,Ze-Q]),it=ge([ae-q,pe-Q]);if(Ne[0]*it[1]==Ne[1]*it[0])return void this.lineTo(q,Q);var tt=Ne[0]*it[0]+Ne[1]*it[1],et=Math.acos(Math.abs(tt)),st=ge([Ne[0]+it[0],Ne[1]+it[1]]),ft=Se/Math.sin(et/2),hn=q+ft*st[0],re=Q+ft*st[1],se=[-Ne[1],Ne[0]],ee=[it[1],-it[0]],fe=function(Qe){var Ae=Qe[0];return Qe[1]>=0?Math.acos(Ae):-Math.acos(Ae)},be=fe(se),Me=fe(ee);this.lineTo(hn+se[0]*Se,re+se[1]*Se),this.arc(hn,re,Se,be,Me)}},j.prototype.stroke=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},j.prototype.fill=function(){this.__currentElement.nodeName==="path"&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},j.prototype.rect=function(q,Q,ae,pe){this.__currentElement.nodeName!=="path"&&this.beginPath(),this.moveTo(q,Q),this.lineTo(q+ae,Q),this.lineTo(q+ae,Q+pe),this.lineTo(q,Q+pe),this.lineTo(q,Q),this.closePath()},j.prototype.fillRect=function(q,Q,ae,pe){var Se,_e;Se=this.__createElement("rect",{x:q,y:Q,width:ae,height:pe,"shape-rendering":"crispEdges"},!0),_e=this.__closestGroupOrSvg(),_e.appendChild(Se),this.__currentElement=Se,this.__applyStyleToCurrentElement("fill")},j.prototype.strokeRect=function(q,Q,ae,pe){var Se,_e;Se=this.__createElement("rect",{x:q,y:Q,width:ae,height:pe},!0),_e=this.__closestGroupOrSvg(),_e.appendChild(Se),this.__currentElement=Se,this.__applyStyleToCurrentElement("stroke")},j.prototype.__clearCanvas=function(){for(var q=this.__closestGroupOrSvg(),Q=q.getAttribute("transform"),ae=this.__root.childNodes[1],pe=ae.childNodes,Se=pe.length-1;Se>=0;Se--)pe[Se]&&ae.removeChild(pe[Se]);this.__currentElement=ae,this.__groupStack=[],Q&&this.__addTransform(Q)},j.prototype.clearRect=function(q,Q,ae,pe){if(q===0&&Q===0&&ae===this.width&&pe===this.height)return void this.__clearCanvas();var Se,_e=this.__closestGroupOrSvg();Se=this.__createElement("rect",{x:q,y:Q,width:ae,height:pe,fill:"#FFFFFF"},!0),_e.appendChild(Se)},j.prototype.createLinearGradient=function(q,Q,ae,pe){var Se=this.__createElement("linearGradient",{id:L(this.__ids),x1:q+"px",x2:ae+"px",y1:Q+"px",y2:pe+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(Se),new ue(Se,this)},j.prototype.createRadialGradient=function(q,Q,ae,pe,Se,_e){var Ze=this.__createElement("radialGradient",{id:L(this.__ids),cx:pe+"px",cy:Se+"px",r:_e+"px",fx:q+"px",fy:Q+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(Ze),new ue(Ze,this)},j.prototype.__parseFont=function(){var q=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i,Q=q.exec(this.font),ae={style:Q[1]||"normal",size:Q[4]||"10px",family:Q[6]||"sans-serif",weight:Q[3]||"normal",decoration:Q[2]||"normal",href:null};return this.__fontUnderline==="underline"&&(ae.decoration="underline"),this.__fontHref&&(ae.href=this.__fontHref),ae},j.prototype.__wrapTextLink=function(q,Q){if(q.href){var ae=this.__createElement("a");return ae.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",q.href),ae.appendChild(Q),ae}return Q},j.prototype.__applyText=function(q,Q,ae,pe){var Se=this.__parseFont(),_e=this.__closestGroupOrSvg(),Ze=this.__createElement("text",{"font-family":Se.family,"font-size":Se.size,"font-style":Se.style,"font-weight":Se.weight,"text-decoration":Se.decoration,x:Q,y:ae,"text-anchor":$(this.textAlign),"dominant-baseline":U(this.textBaseline)},!0);Ze.appendChild(this.__document.createTextNode(q)),this.__currentElement=Ze,this.__applyStyleToCurrentElement(pe),_e.appendChild(this.__wrapTextLink(Se,Ze))},j.prototype.fillText=function(q,Q,ae){this.__applyText(q,Q,ae,"fill")},j.prototype.strokeText=function(q,Q,ae){this.__applyText(q,Q,ae,"stroke")},j.prototype.measureText=function(q){return this.__ctx.font=this.font,this.__ctx.measureText(q)},j.prototype.arc=function(q,Q,ae,pe,Se,_e){if(pe!==Se){pe%=2*Math.PI,Se%=2*Math.PI,pe===Se&&(Se=(Se+2*Math.PI-.001*(_e?-1:1))%(2*Math.PI));var Ze=q+ae*Math.cos(Se),Ne=Q+ae*Math.sin(Se),it=q+ae*Math.cos(pe),tt=Q+ae*Math.sin(pe),et=_e?0:1,st=0,ft=Se-pe;ft<0&&(ft+=2*Math.PI),st=_e?ft>Math.PI?0:1:ft>Math.PI?1:0,this.lineTo(it,tt),this.__addPathCommand(A("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:ae,ry:ae,xAxisRotation:0,largeArcFlag:st,sweepFlag:et,endX:Ze,endY:Ne})),this.__currentPosition={x:Ze,y:Ne}}},j.prototype.clip=function(){var q=this.__closestGroupOrSvg(),Q=this.__createElement("clipPath"),ae=L(this.__ids),pe=this.__createElement("g");this.__applyCurrentDefaultPath(),q.removeChild(this.__currentElement),Q.setAttribute("id",ae),Q.appendChild(this.__currentElement),this.__defs.appendChild(Q),q.setAttribute("clip-path",A("url(#{id})",{id:ae})),q.appendChild(pe),this.__currentElement=pe},j.prototype.drawImage=function(){var q,Q,ae,pe,Se,_e,Ze,Ne,it,tt,et,st,ft,hn,re=Array.prototype.slice.call(arguments),se=re[0],ee=0,fe=0;if(re.length===3)q=re[1],Q=re[2],Se=se.width,_e=se.height,ae=Se,pe=_e;else if(re.length===5)q=re[1],Q=re[2],ae=re[3],pe=re[4],Se=se.width,_e=se.height;else{if(re.length!==9)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);ee=re[1],fe=re[2],Se=re[3],_e=re[4],q=re[5],Q=re[6],ae=re[7],pe=re[8]}Ze=this.__closestGroupOrSvg(),this.__currentElement;var be="translate("+q+", "+Q+")";if(se instanceof j){if(Ne=se.getSvg().cloneNode(!0),Ne.childNodes&&Ne.childNodes.length>1){for(it=Ne.childNodes[0];it.childNodes.length;)hn=it.childNodes[0].getAttribute("id"),this.__ids[hn]=hn,this.__defs.appendChild(it.childNodes[0]);if(tt=Ne.childNodes[1]){var Me,Qe=tt.getAttribute("transform");Me=Qe?Qe+" "+be:be,tt.setAttribute("transform",Me),Ze.appendChild(tt)}}}else se.nodeName!=="CANVAS"&&se.nodeName!=="IMG"||(et=this.__createElement("image"),et.setAttribute("width",ae),et.setAttribute("height",pe),et.setAttribute("preserveAspectRatio","none"),et.setAttribute("opacity",this.globalAlpha),(ee||fe||Se!==se.width||_e!==se.height)&&(st=this.__document.createElement("canvas"),st.width=ae,st.height=pe,ft=st.getContext("2d"),ft.drawImage(se,ee,fe,Se,_e,0,0,ae,pe),se=st),et.setAttribute("transform",be),et.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",se.nodeName==="CANVAS"?se.toDataURL():se.originalSrc),Ze.appendChild(et))},j.prototype.createPattern=function(q,Q){var ae,pe=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),Se=L(this.__ids);return pe.setAttribute("id",Se),pe.setAttribute("width",q.width),pe.setAttribute("height",q.height),q.nodeName==="CANVAS"||q.nodeName==="IMG"?(ae=this.__document.createElementNS("http://www.w3.org/2000/svg","image"),ae.setAttribute("width",q.width),ae.setAttribute("height",q.height),ae.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",q.nodeName==="CANVAS"?q.toDataURL():q.getAttribute("src")),pe.appendChild(ae),this.__defs.appendChild(pe)):q instanceof j&&(pe.appendChild(q.__root.childNodes[1]),this.__defs.appendChild(pe)),new ye(pe,this)},j.prototype.setLineDash=function(q){q&&q.length>0?this.lineDash=q.join(","):this.lineDash=null},j.prototype.drawFocusRing=function(){},j.prototype.createImageData=function(){},j.prototype.getImageData=function(){},j.prototype.putImageData=function(){},j.prototype.globalCompositeOperation=function(){},j.prototype.setTransform=function(){},typeof window=="object"&&(window.C2S=j),typeof v.exports=="object"&&(v.exports=j)})(),(function(){function A(re,se,ee){this.mode=Ze.MODE_8BIT_BYTE,this.data=re,this.parsedData=[];for(var fe=0,be=this.data.length;fe<be;fe++){var Me=[],Qe=this.data.charCodeAt(fe);se?Me[0]=Qe:Qe>65536?(Me[0]=240|(1835008&Qe)>>>18,Me[1]=128|(258048&Qe)>>>12,Me[2]=128|(4032&Qe)>>>6,Me[3]=128|63&Qe):Qe>2048?(Me[0]=224|(61440&Qe)>>>12,Me[1]=128|(4032&Qe)>>>6,Me[2]=128|63&Qe):Qe>128?(Me[0]=192|(1984&Qe)>>>6,Me[1]=128|63&Qe):Me[0]=Qe,this.parsedData.push(Me)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),ee||this.parsedData.length==this.data.length||(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function L(re,se){this.typeNumber=re,this.errorCorrectLevel=se,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function $(re,se){if(re.length==de)throw new Error(re.length+"/"+se);for(var ee=0;ee<re.length&&re[ee]==0;)ee++;this.num=new Array(re.length-ee+se);for(var fe=0;fe<re.length-ee;fe++)this.num[fe]=re[fe+ee]}function U(re,se){this.totalCount=re,this.dataCount=se}function G(){this.buffer=[],this.length=0}function j(){var re=!1,se=navigator.userAgent;if(/android/i.test(se)){re=!0;var ee=se.toString().match(/android ([0-9]\.[0-9])/i);ee&&ee[1]&&(re=parseFloat(ee[1]))}return re}function ue(re,se){for(var ee=se.correctLevel,fe=1,be=ye(re),Me=0,Qe=ft.length;Me<Qe;Me++){var Ae=0;switch(ee){case Ne.L:Ae=ft[Me][0];break;case Ne.M:Ae=ft[Me][1];break;case Ne.Q:Ae=ft[Me][2];break;case Ne.H:Ae=ft[Me][3]}if(be<=Ae)break;fe++}if(fe>ft.length)throw new Error("Too long data. the CorrectLevel."+["M","L","H","Q"][ee]+" limit length is "+Ae);return se.version!=0&&(fe<=se.version?(fe=se.version,se.runVersion=fe):(console.warn("QR Code version "+se.version+" too small, run version use "+fe),se.runVersion=fe)),fe}function ye(re){var se=encodeURI(re).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return se.length+(se.length!=re.length?3:0)}var de,ge,q=typeof t=="object"&&t&&t.Object===Object&&t,Q=typeof self=="object"&&self&&self.Object===Object&&self,ae=q||Q||Function("return this")(),pe=w&&!w.nodeType&&w,Se=pe&&!0&&v&&!v.nodeType&&v,_e=ae.QRCode;A.prototype={getLength:function(re){return this.parsedData.length},write:function(re){for(var se=0,ee=this.parsedData.length;se<ee;se++)re.put(this.parsedData[se],8)}},L.prototype={addData:function(re,se,ee){var fe=new A(re,se,ee);this.dataList.push(fe),this.dataCache=null},isDark:function(re,se){if(re<0||this.moduleCount<=re||se<0||this.moduleCount<=se)throw new Error(re+","+se);return this.modules[re][se][0]},getEye:function(re,se){if(re<0||this.moduleCount<=re||se<0||this.moduleCount<=se)throw new Error(re+","+se);var ee=this.modules[re][se];if(ee[1]){var fe="P"+ee[1]+"_"+ee[2];return ee[2]=="A"&&(fe="A"+ee[1]),{isDark:ee[0],type:fe}}return null},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(re,se){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var ee=0;ee<this.moduleCount;ee++){this.modules[ee]=new Array(this.moduleCount);for(var fe=0;fe<this.moduleCount;fe++)this.modules[ee][fe]=[]}this.setupPositionProbePattern(0,0,"TL"),this.setupPositionProbePattern(this.moduleCount-7,0,"BL"),this.setupPositionProbePattern(0,this.moduleCount-7,"TR"),this.setupPositionAdjustPattern("A"),this.setupTimingPattern(),this.setupTypeInfo(re,se),this.typeNumber>=7&&this.setupTypeNumber(re),this.dataCache==null&&(this.dataCache=L.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,se)},setupPositionProbePattern:function(re,se,ee){for(var fe=-1;fe<=7;fe++)if(!(re+fe<=-1||this.moduleCount<=re+fe))for(var be=-1;be<=7;be++)se+be<=-1||this.moduleCount<=se+be||(0<=fe&&fe<=6&&(be==0||be==6)||0<=be&&be<=6&&(fe==0||fe==6)||2<=fe&&fe<=4&&2<=be&&be<=4?(this.modules[re+fe][se+be][0]=!0,this.modules[re+fe][se+be][2]=ee,this.modules[re+fe][se+be][1]=fe==-0||be==-0||fe==6||be==6?"O":"I"):this.modules[re+fe][se+be][0]=!1)},getBestMaskPattern:function(){for(var re=0,se=0,ee=0;ee<8;ee++){this.makeImpl(!0,ee);var fe=tt.getLostPoint(this);(ee==0||re>fe)&&(re=fe,se=ee)}return se},createMovieClip:function(re,se,ee){var fe=re.createEmptyMovieClip(se,ee);this.make();for(var be=0;be<this.modules.length;be++)for(var Me=1*be,Qe=0;Qe<this.modules[be].length;Qe++){var Ae=1*Qe,ce=this.modules[be][Qe][0];ce&&(fe.beginFill(0,100),fe.moveTo(Ae,Me),fe.lineTo(Ae+1,Me),fe.lineTo(Ae+1,Me+1),fe.lineTo(Ae,Me+1),fe.endFill())}return fe},setupTimingPattern:function(){for(var re=8;re<this.moduleCount-8;re++)this.modules[re][6][0]==null&&(this.modules[re][6][0]=re%2==0);for(var se=8;se<this.moduleCount-8;se++)this.modules[6][se][0]==null&&(this.modules[6][se][0]=se%2==0)},setupPositionAdjustPattern:function(re){for(var se=tt.getPatternPosition(this.typeNumber),ee=0;ee<se.length;ee++)for(var fe=0;fe<se.length;fe++){var be=se[ee],Me=se[fe];if(this.modules[be][Me][0]==null)for(var Qe=-2;Qe<=2;Qe++)for(var Ae=-2;Ae<=2;Ae++)Qe==-2||Qe==2||Ae==-2||Ae==2||Qe==0&&Ae==0?(this.modules[be+Qe][Me+Ae][0]=!0,this.modules[be+Qe][Me+Ae][2]=re,this.modules[be+Qe][Me+Ae][1]=Qe==-2||Ae==-2||Qe==2||Ae==2?"O":"I"):this.modules[be+Qe][Me+Ae][0]=!1}},setupTypeNumber:function(re){for(var se=tt.getBCHTypeNumber(this.typeNumber),ee=0;ee<18;ee++){var fe=!re&&(se>>ee&1)==1;this.modules[Math.floor(ee/3)][ee%3+this.moduleCount-8-3][0]=fe}for(var ee=0;ee<18;ee++){var fe=!re&&(se>>ee&1)==1;this.modules[ee%3+this.moduleCount-8-3][Math.floor(ee/3)][0]=fe}},setupTypeInfo:function(re,se){for(var ee=this.errorCorrectLevel<<3|se,fe=tt.getBCHTypeInfo(ee),be=0;be<15;be++){var Me=!re&&(fe>>be&1)==1;be<6?this.modules[be][8][0]=Me:be<8?this.modules[be+1][8][0]=Me:this.modules[this.moduleCount-15+be][8][0]=Me}for(var be=0;be<15;be++){var Me=!re&&(fe>>be&1)==1;be<8?this.modules[8][this.moduleCount-be-1][0]=Me:be<9?this.modules[8][15-be-1+1][0]=Me:this.modules[8][15-be-1][0]=Me}this.modules[this.moduleCount-8][8][0]=!re},mapData:function(re,se){for(var ee=-1,fe=this.moduleCount-1,be=7,Me=0,Qe=this.moduleCount-1;Qe>0;Qe-=2)for(Qe==6&&Qe--;;){for(var Ae=0;Ae<2;Ae++)if(this.modules[fe][Qe-Ae][0]==null){var ce=!1;Me<re.length&&(ce=(re[Me]>>>be&1)==1);var gn=tt.getMask(se,fe,Qe-Ae);gn&&(ce=!ce),this.modules[fe][Qe-Ae][0]=ce,be--,be==-1&&(Me++,be=7)}if((fe+=ee)<0||this.moduleCount<=fe){fe-=ee,ee=-ee;break}}}},L.PAD0=236,L.PAD1=17,L.createData=function(re,se,ee){for(var fe=U.getRSBlocks(re,se),be=new G,Me=0;Me<ee.length;Me++){var Qe=ee[Me];be.put(Qe.mode,4),be.put(Qe.getLength(),tt.getLengthInBits(Qe.mode,re)),Qe.write(be)}for(var Ae=0,Me=0;Me<fe.length;Me++)Ae+=fe[Me].dataCount;if(be.getLengthInBits()>8*Ae)throw new Error("code length overflow. ("+be.getLengthInBits()+">"+8*Ae+")");for(be.getLengthInBits()+4<=8*Ae&&be.put(0,4);be.getLengthInBits()%8!=0;)be.putBit(!1);for(;!(be.getLengthInBits()>=8*Ae||(be.put(L.PAD0,8),be.getLengthInBits()>=8*Ae));)be.put(L.PAD1,8);return L.createBytes(be,fe)},L.createBytes=function(re,se){for(var ee=0,fe=0,be=0,Me=new Array(se.length),Qe=new Array(se.length),Ae=0;Ae<se.length;Ae++){var ce=se[Ae].dataCount,gn=se[Ae].totalCount-ce;fe=Math.max(fe,ce),be=Math.max(be,gn),Me[Ae]=new Array(ce);for(var Pt=0;Pt<Me[Ae].length;Pt++)Me[Ae][Pt]=255&re.buffer[Pt+ee];ee+=ce;var tr=tt.getErrorCorrectPolynomial(gn),bt=new $(Me[Ae],tr.getLength()-1),$i=bt.mod(tr);Qe[Ae]=new Array(tr.getLength()-1);for(var Pt=0;Pt<Qe[Ae].length;Pt++){var ki=Pt+$i.getLength()-Qe[Ae].length;Qe[Ae][Pt]=ki>=0?$i.get(ki):0}}for(var ga=0,Pt=0;Pt<se.length;Pt++)ga+=se[Pt].totalCount;for(var ts=new Array(ga),Rr=0,Pt=0;Pt<fe;Pt++)for(var Ae=0;Ae<se.length;Ae++)Pt<Me[Ae].length&&(ts[Rr++]=Me[Ae][Pt]);for(var Pt=0;Pt<be;Pt++)for(var Ae=0;Ae<se.length;Ae++)Pt<Qe[Ae].length&&(ts[Rr++]=Qe[Ae][Pt]);return ts};for(var Ze={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Ne={L:1,M:0,Q:3,H:2},it={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},tt={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(re){for(var se=re<<10;tt.getBCHDigit(se)-tt.getBCHDigit(tt.G15)>=0;)se^=tt.G15<<tt.getBCHDigit(se)-tt.getBCHDigit(tt.G15);return(re<<10|se)^tt.G15_MASK},getBCHTypeNumber:function(re){for(var se=re<<12;tt.getBCHDigit(se)-tt.getBCHDigit(tt.G18)>=0;)se^=tt.G18<<tt.getBCHDigit(se)-tt.getBCHDigit(tt.G18);return re<<12|se},getBCHDigit:function(re){for(var se=0;re!=0;)se++,re>>>=1;return se},getPatternPosition:function(re){return tt.PATTERN_POSITION_TABLE[re-1]},getMask:function(re,se,ee){switch(re){case it.PATTERN000:return(se+ee)%2==0;case it.PATTERN001:return se%2==0;case it.PATTERN010:return ee%3==0;case it.PATTERN011:return(se+ee)%3==0;case it.PATTERN100:return(Math.floor(se/2)+Math.floor(ee/3))%2==0;case it.PATTERN101:return se*ee%2+se*ee%3==0;case it.PATTERN110:return(se*ee%2+se*ee%3)%2==0;case it.PATTERN111:return(se*ee%3+(se+ee)%2)%2==0;default:throw new Error("bad maskPattern:"+re)}},getErrorCorrectPolynomial:function(re){for(var se=new $([1],0),ee=0;ee<re;ee++)se=se.multiply(new $([1,et.gexp(ee)],0));return se},getLengthInBits:function(re,se){if(1<=se&&se<10)switch(re){case Ze.MODE_NUMBER:return 10;case Ze.MODE_ALPHA_NUM:return 9;case Ze.MODE_8BIT_BYTE:case Ze.MODE_KANJI:return 8;default:throw new Error("mode:"+re)}else if(se<27)switch(re){case Ze.MODE_NUMBER:return 12;case Ze.MODE_ALPHA_NUM:return 11;case Ze.MODE_8BIT_BYTE:return 16;case Ze.MODE_KANJI:return 10;default:throw new Error("mode:"+re)}else{if(!(se<41))throw new Error("type:"+se);switch(re){case Ze.MODE_NUMBER:return 14;case Ze.MODE_ALPHA_NUM:return 13;case Ze.MODE_8BIT_BYTE:return 16;case Ze.MODE_KANJI:return 12;default:throw new Error("mode:"+re)}}},getLostPoint:function(re){for(var se=re.getModuleCount(),ee=0,fe=0;fe<se;fe++)for(var be=0;be<se;be++){for(var Me=0,Qe=re.isDark(fe,be),Ae=-1;Ae<=1;Ae++)if(!(fe+Ae<0||se<=fe+Ae))for(var ce=-1;ce<=1;ce++)be+ce<0||se<=be+ce||Ae==0&&ce==0||Qe==re.isDark(fe+Ae,be+ce)&&Me++;Me>5&&(ee+=3+Me-5)}for(var fe=0;fe<se-1;fe++)for(var be=0;be<se-1;be++){var gn=0;re.isDark(fe,be)&&gn++,re.isDark(fe+1,be)&&gn++,re.isDark(fe,be+1)&&gn++,re.isDark(fe+1,be+1)&&gn++,gn!=0&&gn!=4||(ee+=3)}for(var fe=0;fe<se;fe++)for(var be=0;be<se-6;be++)re.isDark(fe,be)&&!re.isDark(fe,be+1)&&re.isDark(fe,be+2)&&re.isDark(fe,be+3)&&re.isDark(fe,be+4)&&!re.isDark(fe,be+5)&&re.isDark(fe,be+6)&&(ee+=40);for(var be=0;be<se;be++)for(var fe=0;fe<se-6;fe++)re.isDark(fe,be)&&!re.isDark(fe+1,be)&&re.isDark(fe+2,be)&&re.isDark(fe+3,be)&&re.isDark(fe+4,be)&&!re.isDark(fe+5,be)&&re.isDark(fe+6,be)&&(ee+=40);for(var Pt=0,be=0;be<se;be++)for(var fe=0;fe<se;fe++)re.isDark(fe,be)&&Pt++;return ee+=Math.abs(100*Pt/se/se-50)/5*10}},et={glog:function(re){if(re<1)throw new Error("glog("+re+")");return et.LOG_TABLE[re]},gexp:function(re){for(;re<0;)re+=255;for(;re>=256;)re-=255;return et.EXP_TABLE[re]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},st=0;st<8;st++)et.EXP_TABLE[st]=1<<st;for(var st=8;st<256;st++)et.EXP_TABLE[st]=et.EXP_TABLE[st-4]^et.EXP_TABLE[st-5]^et.EXP_TABLE[st-6]^et.EXP_TABLE[st-8];for(var st=0;st<255;st++)et.LOG_TABLE[et.EXP_TABLE[st]]=st;$.prototype={get:function(re){return this.num[re]},getLength:function(){return this.num.length},multiply:function(re){for(var se=new Array(this.getLength()+re.getLength()-1),ee=0;ee<this.getLength();ee++)for(var fe=0;fe<re.getLength();fe++)se[ee+fe]^=et.gexp(et.glog(this.get(ee))+et.glog(re.get(fe)));return new $(se,0)},mod:function(re){if(this.getLength()-re.getLength()<0)return this;for(var se=et.glog(this.get(0))-et.glog(re.get(0)),ee=new Array(this.getLength()),fe=0;fe<this.getLength();fe++)ee[fe]=this.get(fe);for(var fe=0;fe<re.getLength();fe++)ee[fe]^=et.gexp(et.glog(re.get(fe))+se);return new $(ee,0).mod(re)}},U.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],U.getRSBlocks=function(re,se){var ee=U.getRsBlockTable(re,se);if(ee==de)throw new Error("bad rs block @ typeNumber:"+re+"/errorCorrectLevel:"+se);for(var fe=ee.length/3,be=[],Me=0;Me<fe;Me++)for(var Qe=ee[3*Me+0],Ae=ee[3*Me+1],ce=ee[3*Me+2],gn=0;gn<Qe;gn++)be.push(new U(Ae,ce));return be},U.getRsBlockTable=function(re,se){switch(se){case Ne.L:return U.RS_BLOCK_TABLE[4*(re-1)+0];case Ne.M:return U.RS_BLOCK_TABLE[4*(re-1)+1];case Ne.Q:return U.RS_BLOCK_TABLE[4*(re-1)+2];case Ne.H:return U.RS_BLOCK_TABLE[4*(re-1)+3];default:return de}},G.prototype={get:function(re){var se=Math.floor(re/8);return(this.buffer[se]>>>7-re%8&1)==1},put:function(re,se){for(var ee=0;ee<se;ee++)this.putBit((re>>>se-ee-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(re){var se=Math.floor(this.length/8);this.buffer.length<=se&&this.buffer.push(0),re&&(this.buffer[se]|=128>>>this.length%8),this.length++}};var ft=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],hn=(function(){return typeof CanvasRenderingContext2D<"u"})()?(function(){function re(){if(this._htOption.drawer=="svg"){var Me=this._oContext.getSerializedSvg(!0);this.dataURL=Me,this._el.innerHTML=Me}else try{var Qe=this._elCanvas.toDataURL("image/png");this.dataURL=Qe}catch(Ae){console.error(Ae)}this._htOption.onRenderingEnd&&(this.dataURL||console.error("Can not get base64 data, please check: 1. Published the page and image to the server 2. The image request support CORS 3. Configured `crossOrigin:'anonymous'` option"),this._htOption.onRenderingEnd(this._htOption,this.dataURL))}function se(Me,Qe){var Ae=this;if(Ae._fFail=Qe,Ae._fSuccess=Me,Ae._bSupportDataURI===null){var ce=document.createElement("img"),gn=function(){Ae._bSupportDataURI=!1,Ae._fFail&&Ae._fFail.call(Ae)},Pt=function(){Ae._bSupportDataURI=!0,Ae._fSuccess&&Ae._fSuccess.call(Ae)};return ce.onabort=gn,ce.onerror=gn,ce.onload=Pt,void(ce.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}Ae._bSupportDataURI===!0&&Ae._fSuccess?Ae._fSuccess.call(Ae):Ae._bSupportDataURI===!1&&Ae._fFail&&Ae._fFail.call(Ae)}if(ae._android&&ae._android<=2.1){var ee=1/window.devicePixelRatio,fe=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(Me,Qe,Ae,ce,gn,Pt,tr,bt,$i){if("nodeName"in Me&&/img/i.test(Me.nodeName))for(var ki=arguments.length-1;ki>=1;ki--)arguments[ki]=arguments[ki]*ee;else bt===void 0&&(arguments[1]*=ee,arguments[2]*=ee,arguments[3]*=ee,arguments[4]*=ee);fe.apply(this,arguments)}}var be=function(Me,Qe){this._bIsPainted=!1,this._android=j(),this._el=Me,this._htOption=Qe,this._htOption.drawer=="svg"?(this._oContext={},this._elCanvas={}):(this._elCanvas=document.createElement("canvas"),this._el.appendChild(this._elCanvas),this._oContext=this._elCanvas.getContext("2d")),this._bSupportDataURI=null,this.dataURL=null};return be.prototype.draw=function(Me){function Qe(){ce.quietZone>0&&ce.quietZoneColor&&(bt.lineWidth=0,bt.fillStyle=ce.quietZoneColor,bt.fillRect(0,0,$i._elCanvas.width,ce.quietZone),bt.fillRect(0,ce.quietZone,ce.quietZone,$i._elCanvas.height-2*ce.quietZone),bt.fillRect($i._elCanvas.width-ce.quietZone,ce.quietZone,ce.quietZone,$i._elCanvas.height-2*ce.quietZone),bt.fillRect(0,$i._elCanvas.height-ce.quietZone,$i._elCanvas.width,ce.quietZone))}function Ae(ga){function ts(Gs){var Dr=Math.round(ce.width/3.5),Ui=Math.round(ce.height/3.5);Dr!==Ui&&(Dr=Ui),ce.logoMaxWidth?Dr=Math.round(ce.logoMaxWidth):ce.logoWidth&&(Dr=Math.round(ce.logoWidth)),ce.logoMaxHeight?Ui=Math.round(ce.logoMaxHeight):ce.logoHeight&&(Ui=Math.round(ce.logoHeight));var Bl,Fl;Gs.naturalWidth===void 0?(Bl=Gs.width,Fl=Gs.height):(Bl=Gs.naturalWidth,Fl=Gs.naturalHeight),(ce.logoMaxWidth||ce.logoMaxHeight)&&(ce.logoMaxWidth&&Bl<=Dr&&(Dr=Bl),ce.logoMaxHeight&&Fl<=Ui&&(Ui=Fl),Bl<=Dr&&Fl<=Ui&&(Dr=Bl,Ui=Fl));var Sv=(ce.width+2*ce.quietZone-Dr)/2,kv=(ce.height+ce.titleHeight+2*ce.quietZone-Ui)/2,B_=Math.min(Dr/Bl,Ui/Fl),Ev=Bl*B_,Tv=Fl*B_;(ce.logoMaxWidth||ce.logoMaxHeight)&&(Dr=Ev,Ui=Tv,Sv=(ce.width+2*ce.quietZone-Dr)/2,kv=(ce.height+ce.titleHeight+2*ce.quietZone-Ui)/2),ce.logoBackgroundTransparent||(bt.fillStyle=ce.logoBackgroundColor,bt.fillRect(Sv,kv,Dr,Ui));var f7=bt.imageSmoothingQuality,h7=bt.imageSmoothingEnabled;bt.imageSmoothingEnabled=!0,bt.imageSmoothingQuality="high",bt.drawImage(Gs,Sv+(Dr-Ev)/2,kv+(Ui-Tv)/2,Ev,Tv),bt.imageSmoothingEnabled=h7,bt.imageSmoothingQuality=f7,Qe(),_d._bIsPainted=!0,_d.makeImage()}ce.onRenderingStart&&ce.onRenderingStart(ce);for(var Rr=0;Rr<gn;Rr++)for(var zi=0;zi<gn;zi++){var Ll=zi*Pt+ce.quietZone,lu=Rr*tr+ce.quietZone,Oh=ga.isDark(Rr,zi),ei=ga.getEye(Rr,zi),qn=ce.dotScale;bt.lineWidth=0;var cr,ti;ei?(cr=ce[ei.type]||ce[ei.type.substring(0,2)]||ce.colorDark,ti=ce.colorLight):ce.backgroundImage?(ti="rgba(0,0,0,0)",Rr==6?ce.autoColor?(cr=ce.timing_H||ce.timing||ce.autoColorDark,ti=ce.autoColorLight):cr=ce.timing_H||ce.timing||ce.colorDark:zi==6?ce.autoColor?(cr=ce.timing_V||ce.timing||ce.autoColorDark,ti=ce.autoColorLight):cr=ce.timing_V||ce.timing||ce.colorDark:ce.autoColor?(cr=ce.autoColorDark,ti=ce.autoColorLight):cr=ce.colorDark):(cr=Rr==6?ce.timing_H||ce.timing||ce.colorDark:zi==6&&(ce.timing_V||ce.timing)||ce.colorDark,ti=ce.colorLight),bt.strokeStyle=Oh?cr:ti,bt.fillStyle=Oh?cr:ti,ei?(qn=ei.type=="AO"?ce.dotScaleAO:ei.type=="AI"?ce.dotScaleAI:1,ce.backgroundImage&&ce.autoColor?(cr=(ei.type=="AO"?ce.AI:ce.AO)||ce.autoColorDark,ti=ce.autoColorLight):cr=(ei.type=="AO"?ce.AI:ce.AO)||cr,Oh=ei.isDark,bt.fillRect(Ll+Pt*(1-qn)/2,ce.titleHeight+lu+tr*(1-qn)/2,Pt*qn,tr*qn)):Rr==6?(qn=ce.dotScaleTiming_H,bt.fillRect(Ll+Pt*(1-qn)/2,ce.titleHeight+lu+tr*(1-qn)/2,Pt*qn,tr*qn)):zi==6?(qn=ce.dotScaleTiming_V,bt.fillRect(Ll+Pt*(1-qn)/2,ce.titleHeight+lu+tr*(1-qn)/2,Pt*qn,tr*qn)):(ce.backgroundImage,bt.fillRect(Ll+Pt*(1-qn)/2,ce.titleHeight+lu+tr*(1-qn)/2,Pt*qn,tr*qn)),ce.dotScale==1||ei||(bt.strokeStyle=ce.colorLight)}if(ce.title&&(bt.fillStyle=ce.titleBackgroundColor,bt.fillRect(ce.quietZone,ce.quietZone,ce.width,ce.titleHeight),bt.font=ce.titleFont,bt.fillStyle=ce.titleColor,bt.textAlign="center",bt.fillText(ce.title,this._elCanvas.width/2,+ce.quietZone+ce.titleTop)),ce.subTitle&&(bt.font=ce.subTitleFont,bt.fillStyle=ce.subTitleColor,bt.fillText(ce.subTitle,this._elCanvas.width/2,+ce.quietZone+ce.subTitleTop)),ce.logo){var ya=new Image,_d=this;ya.onload=function(){ts(ya)},ya.onerror=function(Gs){console.error(Gs)},ce.crossOrigin!=null&&(ya.crossOrigin=ce.crossOrigin),ya.originalSrc=ce.logo,ya.src=ce.logo}else Qe(),this._bIsPainted=!0,this.makeImage()}var ce=this._htOption,gn=Me.getModuleCount(),Pt=Math.round(ce.width/gn),tr=Math.round((ce.height-ce.titleHeight)/gn);Pt<=1&&(Pt=1),tr<=1&&(tr=1),ce.width=Pt*gn,ce.height=tr*gn+ce.titleHeight,ce.quietZone=Math.round(ce.quietZone),this._elCanvas.width=ce.width+2*ce.quietZone,this._elCanvas.height=ce.height+2*ce.quietZone,this._htOption.drawer!="canvas"&&(this._oContext=new C2S(this._elCanvas.width,this._elCanvas.height)),this.clear();var bt=this._oContext;bt.lineWidth=0,bt.fillStyle=ce.colorLight,bt.fillRect(0,0,this._elCanvas.width,this._elCanvas.height),bt.clearRect(ce.quietZone,ce.quietZone,ce.width,ce.titleHeight);var $i=this;if(ce.backgroundImage){var ki=new Image;ki.onload=function(){bt.globalAlpha=1,bt.globalAlpha=ce.backgroundImageAlpha;var ga=bt.imageSmoothingQuality,ts=bt.imageSmoothingEnabled;bt.imageSmoothingEnabled=!0,bt.imageSmoothingQuality="high",bt.drawImage(ki,0,ce.titleHeight,ce.width+2*ce.quietZone,ce.height+2*ce.quietZone-ce.titleHeight),bt.imageSmoothingEnabled=ts,bt.imageSmoothingQuality=ga,bt.globalAlpha=1,Ae.call($i,Me)},ce.crossOrigin!=null&&(ki.crossOrigin=ce.crossOrigin),ki.originalSrc=ce.backgroundImage,ki.src=ce.backgroundImage}else Ae.call($i,Me)},be.prototype.makeImage=function(){this._bIsPainted&&se.call(this,re)},be.prototype.isPainted=function(){return this._bIsPainted},be.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},be.prototype.remove=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1,this._el.innerHTML=""},be.prototype.round=function(Me){return Me&&Math.floor(1e3*Me)/1e3},be})():(function(){var re=function(se,ee){this._el=se,this._htOption=ee};return re.prototype.draw=function(se){var ee=this._htOption,fe=this._el,be=se.getModuleCount(),Me=Math.round(ee.width/be),Qe=Math.round((ee.height-ee.titleHeight)/be);Me<=1&&(Me=1),Qe<=1&&(Qe=1),this._htOption.width=Me*be,this._htOption.height=Qe*be+ee.titleHeight,this._htOption.quietZone=Math.round(this._htOption.quietZone);var Ae=[],ce="",gn=Math.round(Me*ee.dotScale),Pt=Math.round(Qe*ee.dotScale);gn<4&&(gn=4,Pt=4);var tr=ee.colorDark,bt=ee.colorLight;if(ee.backgroundImage){ee.autoColor?(ee.colorDark="rgba(0, 0, 0, .6);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#99000000', EndColorStr='#99000000');",ee.colorLight="rgba(255, 255, 255, .7);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#B2FFFFFF', EndColorStr='#B2FFFFFF');"):ee.colorLight="rgba(0,0,0,0)";var $i='<div style="display:inline-block; z-index:-10;position:absolute;"><img src="'+ee.backgroundImage+'" widht="'+(ee.width+2*ee.quietZone)+'" height="'+(ee.height+2*ee.quietZone)+'" style="opacity:'+ee.backgroundImageAlpha+";filter:alpha(opacity="+100*ee.backgroundImageAlpha+'); "/></div>';Ae.push($i)}if(ee.quietZone&&(ce="display:inline-block; width:"+(ee.width+2*ee.quietZone)+"px; height:"+(ee.width+2*ee.quietZone)+"px;background:"+ee.quietZoneColor+"; text-align:center;"),Ae.push('<div style="font-size:0;'+ce+'">'),Ae.push('<table  style="font-size:0;border:0;border-collapse:collapse; margin-top:'+ee.quietZone+'px;" border="0" cellspacing="0" cellspadding="0" align="center" valign="middle">'),Ae.push('<tr height="'+ee.titleHeight+'" align="center"><td style="border:0;border-collapse:collapse;margin:0;padding:0" colspan="'+be+'">'),ee.title){var ki=ee.titleColor,ga=ee.titleFont;Ae.push('<div style="width:100%;margin-top:'+ee.titleTop+"px;color:"+ki+";font:"+ga+";background:"+ee.titleBackgroundColor+'">'+ee.title+"</div>")}ee.subTitle&&Ae.push('<div style="width:100%;margin-top:'+(ee.subTitleTop-ee.titleTop)+"px;color:"+ee.subTitleColor+"; font:"+ee.subTitleFont+'">'+ee.subTitle+"</div>"),Ae.push("</td></tr>");for(var ts=0;ts<be;ts++){Ae.push('<tr style="border:0; padding:0; margin:0;" height="7">');for(var Rr=0;Rr<be;Rr++){var zi=se.isDark(ts,Rr),Ll=se.getEye(ts,Rr);if(Ll){zi=Ll.isDark;var lu=Ll.type,Oh=ee[lu]||ee[lu.substring(0,2)]||tr;Ae.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Me+"px;height:"+Qe+'px;"><span style="width:'+Me+"px;height:"+Qe+"px;background-color:"+(zi?Oh:bt)+';display:inline-block"></span></td>')}else{var ei=ee.colorDark;ts==6?(ei=ee.timing_H||ee.timing||tr,Ae.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Me+"px;height:"+Qe+"px;background-color:"+(zi?ei:bt)+';"></td>')):Rr==6?(ei=ee.timing_V||ee.timing||tr,Ae.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Me+"px;height:"+Qe+"px;background-color:"+(zi?ei:bt)+';"></td>')):Ae.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Me+"px;height:"+Qe+'px;"><div style="display:inline-block;width:'+gn+"px;height:"+Pt+"px;background-color:"+(zi?ei:ee.colorLight)+';"></div></td>')}}Ae.push("</tr>")}if(Ae.push("</table>"),Ae.push("</div>"),ee.logo){var qn=new Image;ee.crossOrigin!=null&&(qn.crossOrigin=ee.crossOrigin),qn.src=ee.logo;var cr=ee.width/3.5,ti=ee.height/3.5;cr!=ti&&(cr=ti),ee.logoWidth&&(cr=ee.logoWidth),ee.logoHeight&&(ti=ee.logoHeight);var ya="position:relative; z-index:1;display:table-cell;top:-"+((ee.height-ee.titleHeight)/2+ti/2+ee.quietZone)+"px;text-align:center; width:"+cr+"px; height:"+ti+"px;line-height:"+cr+"px; vertical-align: middle;";ee.logoBackgroundTransparent||(ya+="background:"+ee.logoBackgroundColor),Ae.push('<div style="'+ya+'"><img  src="'+ee.logo+'"  style="max-width: '+cr+"px; max-height: "+ti+'px;" /> <div style=" display: none; width:1px;margin-left: -1px;"></div></div>')}ee.onRenderingStart&&ee.onRenderingStart(ee),fe.innerHTML=Ae.join("");var _d=fe.childNodes[0],Gs=(ee.width-_d.offsetWidth)/2,Dr=(ee.height-_d.offsetHeight)/2;Gs>0&&Dr>0&&(_d.style.margin=Dr+"px "+Gs+"px"),this._htOption.onRenderingEnd&&this._htOption.onRenderingEnd(this._htOption,null)},re.prototype.clear=function(){this._el.innerHTML=""},re})();ge=function(re,se){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:Ne.H,dotScale:1,dotScaleTiming:1,dotScaleTiming_H:de,dotScaleTiming_V:de,dotScaleA:1,dotScaleAO:de,dotScaleAI:de,quietZone:0,quietZoneColor:"rgba(0,0,0,0)",title:"",titleFont:"normal normal bold 16px Arial",titleColor:"#000000",titleBackgroundColor:"#ffffff",titleHeight:0,titleTop:30,subTitle:"",subTitleFont:"normal normal normal 14px Arial",subTitleColor:"#4F4F4F",subTitleTop:60,logo:de,logoWidth:de,logoHeight:de,logoMaxWidth:de,logoMaxHeight:de,logoBackgroundColor:"#ffffff",logoBackgroundTransparent:!1,PO:de,PI:de,PO_TL:de,PI_TL:de,PO_TR:de,PI_TR:de,PO_BL:de,PI_BL:de,AO:de,AI:de,timing:de,timing_H:de,timing_V:de,backgroundImage:de,backgroundImageAlpha:1,autoColor:!1,autoColorDark:"rgba(0, 0, 0, .6)",autoColorLight:"rgba(255, 255, 255, .7)",onRenderingStart:de,onRenderingEnd:de,version:0,tooltip:!1,binary:!1,drawer:"canvas",crossOrigin:null,utf8WithoutBOM:!0},typeof se=="string"&&(se={text:se}),se)for(var ee in se)this._htOption[ee]=se[ee];this._htOption.title||this._htOption.subTitle||(this._htOption.titleHeight=0),(this._htOption.version<0||this._htOption.version>40)&&(console.warn("QR Code version '"+this._htOption.version+"' is invalidate, reset to 0"),this._htOption.version=0),(this._htOption.dotScale<0||this._htOption.dotScale>1)&&(console.warn(this._htOption.dotScale+" , is invalidate, dotScale must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScale=1),(this._htOption.dotScaleTiming<0||this._htOption.dotScaleTiming>1)&&(console.warn(this._htOption.dotScaleTiming+" , is invalidate, dotScaleTiming must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming=1),this._htOption.dotScaleTiming_H?(this._htOption.dotScaleTiming_H<0||this._htOption.dotScaleTiming_H>1)&&(console.warn(this._htOption.dotScaleTiming_H+" , is invalidate, dotScaleTiming_H must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_H=1):this._htOption.dotScaleTiming_H=this._htOption.dotScaleTiming,this._htOption.dotScaleTiming_V?(this._htOption.dotScaleTiming_V<0||this._htOption.dotScaleTiming_V>1)&&(console.warn(this._htOption.dotScaleTiming_V+" , is invalidate, dotScaleTiming_V must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_V=1):this._htOption.dotScaleTiming_V=this._htOption.dotScaleTiming,(this._htOption.dotScaleA<0||this._htOption.dotScaleA>1)&&(console.warn(this._htOption.dotScaleA+" , is invalidate, dotScaleA must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleA=1),this._htOption.dotScaleAO?(this._htOption.dotScaleAO<0||this._htOption.dotScaleAO>1)&&(console.warn(this._htOption.dotScaleAO+" , is invalidate, dotScaleAO must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAO=1):this._htOption.dotScaleAO=this._htOption.dotScaleA,this._htOption.dotScaleAI?(this._htOption.dotScaleAI<0||this._htOption.dotScaleAI>1)&&(console.warn(this._htOption.dotScaleAI+" , is invalidate, dotScaleAI must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAI=1):this._htOption.dotScaleAI=this._htOption.dotScaleA,(this._htOption.backgroundImageAlpha<0||this._htOption.backgroundImageAlpha>1)&&(console.warn(this._htOption.backgroundImageAlpha+" , is invalidate, backgroundImageAlpha must between 0 and 1, now reset to 1. "),this._htOption.backgroundImageAlpha=1),this._htOption.height=this._htOption.height+this._htOption.titleHeight,typeof re=="string"&&(re=document.getElementById(re)),(!this._htOption.drawer||this._htOption.drawer!="svg"&&this._htOption.drawer!="canvas")&&(this._htOption.drawer="canvas"),this._android=j(),this._el=re,this._oQRCode=null,this._htOption._element=re;var fe={};for(var ee in this._htOption)fe[ee]=this._htOption[ee];this._oDrawing=new hn(this._el,fe),this._htOption.text&&this.makeCode(this._htOption.text)},ge.prototype.makeCode=function(re){this._oQRCode=new L(ue(re,this._htOption),this._htOption.correctLevel),this._oQRCode.addData(re,this._htOption.binary,this._htOption.utf8WithoutBOM),this._oQRCode.make(),this._htOption.tooltip&&(this._el.title=re),this._oDrawing.draw(this._oQRCode)},ge.prototype.makeImage=function(){typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},ge.prototype.clear=function(){this._oDrawing.remove()},ge.prototype.resize=function(re,se){this._oDrawing._htOption.width=re,this._oDrawing._htOption.height=se,this._oDrawing.draw(this._oQRCode)},ge.prototype.noConflict=function(){return ae.QRCode===this&&(ae.QRCode=_e),ge},ge.CorrectLevel=Ne,Se?((Se.exports=ge).QRCode=ge,pe.QRCode=ge):ae.QRCode=ge}).call(this)});var s=i("58QMB");var o={};const a=BigInt(0),l=BigInt(1),c=BigInt(2),u=BigInt(3),d=BigInt(8),f=Object.freeze({a,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),h=(v,w)=>(v+w/c)/w,p={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(v){const{n:w}=f,A=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),L=-l*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),$=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),U=A,G=BigInt("0x100000000000000000000000000000000"),j=h(U*v,w),ue=h(-L*v,w);let ye=he(v-j*A-ue*$,w),de=he(-j*L-ue*U,w);const ge=ye>G,q=de>G;if(ge&&(ye=w-ye),q&&(de=w-de),ye>G||de>G)throw new Error("splitScalarEndo: Endomorphism failed, k="+v);return{k1neg:ge,k1:ye,k2neg:q,k2:de}}},m=32,g=32,y=32,b=m+1,S=2*m+1;function C(v){const{a:w,b:A}=f,L=he(v*v),$=he(L*v);return he($+w*v+A)}const _=f.a===a;class x extends Error{constructor(w){super(w)}}function I(v){if(!(v instanceof k))throw new TypeError("JacobianPoint expected")}class k{constructor(w,A,L){this.x=w,this.y=A,this.z=L}static fromAffine(w){if(!(w instanceof O))throw new TypeError("JacobianPoint#fromAffine: expected Point");return w.equals(O.ZERO)?k.ZERO:new k(w.x,w.y,l)}static toAffineBatch(w){const A=Fe(w.map(L=>L.z));return w.map((L,$)=>L.toAffine(A[$]))}static normalizeZ(w){return k.toAffineBatch(w).map(k.fromAffine)}equals(w){I(w);const{x:A,y:L,z:$}=this,{x:U,y:G,z:j}=w,ue=he($*$),ye=he(j*j),de=he(A*ye),ge=he(U*ue),q=he(he(L*j)*ye),Q=he(he(G*$)*ue);return de===ge&&q===Q}negate(){return new k(this.x,he(-this.y),this.z)}double(){const{x:w,y:A,z:L}=this,$=he(w*w),U=he(A*A),G=he(U*U),j=w+U,ue=he(c*(he(j*j)-$-G)),ye=he(u*$),de=he(ye*ye),ge=he(de-c*ue),q=he(ye*(ue-ge)-d*G),Q=he(c*A*L);return new k(ge,q,Q)}add(w){I(w);const{x:A,y:L,z:$}=this,{x:U,y:G,z:j}=w;if(U===a||G===a)return this;if(A===a||L===a)return w;const ue=he($*$),ye=he(j*j),de=he(A*ye),ge=he(U*ue),q=he(he(L*j)*ye),Q=he(he(G*$)*ue),ae=he(ge-de),pe=he(Q-q);if(ae===a)return pe===a?this.double():k.ZERO;const Se=he(ae*ae),_e=he(ae*Se),Ze=he(de*Se),Ne=he(pe*pe-_e-c*Ze),it=he(pe*(Ze-Ne)-q*_e),tt=he($*j*ae);return new k(Ne,it,tt)}subtract(w){return this.add(w.negate())}multiplyUnsafe(w){const A=k.ZERO;if(typeof w=="bigint"&&w===a)return A;let L=Le(w);if(L===l)return this;if(!_){let ge=A,q=this;for(;L>a;)L&l&&(ge=ge.add(q)),q=q.double(),L>>=l;return ge}let{k1neg:$,k1:U,k2neg:G,k2:j}=p.splitScalar(L),ue=A,ye=A,de=this;for(;U>a||j>a;)U&l&&(ue=ue.add(de)),j&l&&(ye=ye.add(de)),de=de.double(),U>>=l,j>>=l;return $&&(ue=ue.negate()),G&&(ye=ye.negate()),ye=new k(he(ye.x*p.beta),ye.y,ye.z),ue.add(ye)}precomputeWindow(w){const A=_?128/w+1:256/w+1,L=[];let $=this,U=$;for(let G=0;G<A;G++){U=$,L.push(U);for(let j=1;j<2**(w-1);j++)U=U.add($),L.push(U);$=U.double()}return L}wNAF(w,A){!A&&this.equals(k.BASE)&&(A=O.BASE);const L=A&&A._WINDOW_SIZE||1;if(256%L)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let $=A&&P.get(A);$||($=this.precomputeWindow(L),A&&L!==1&&($=k.normalizeZ($),P.set(A,$)));let U=k.ZERO,G=k.BASE;const j=1+(_?128/L:256/L),ue=2**(L-1),ye=BigInt(2**L-1),de=2**L,ge=BigInt(L);for(let q=0;q<j;q++){const Q=q*ue;let ae=Number(w&ye);w>>=ge,ae>ue&&(ae-=de,w+=l);const pe=Q,Se=Q+Math.abs(ae)-1,_e=q%2!==0,Ze=ae<0;ae===0?G=G.add(T(_e,$[pe])):U=U.add(T(Ze,$[Se]))}return{p:U,f:G}}multiply(w,A){let L=Le(w),$,U;if(_){const{k1neg:G,k1:j,k2neg:ue,k2:ye}=p.splitScalar(L);let{p:de,f:ge}=this.wNAF(j,A),{p:q,f:Q}=this.wNAF(ye,A);de=T(G,de),q=T(ue,q),q=new k(he(q.x*p.beta),q.y,q.z),$=de.add(q),U=ge.add(Q)}else{const{p:G,f:j}=this.wNAF(L,A);$=G,U=j}return k.normalizeZ([$,U])[0]}toAffine(w){const{x:A,y:L,z:$}=this,U=this.equals(k.ZERO);w==null&&(w=U?d:je($));const G=w,j=he(G*G),ue=he(j*G),ye=he(A*j),de=he(L*ue),ge=he($*G);if(U)return O.ZERO;if(ge!==l)throw new Error("invZ was invalid");return new O(ye,de)}}k.BASE=new k(f.Gx,f.Gy,l),k.ZERO=new k(a,l,a);function T(v,w){const A=w.negate();return v?A:w}const P=new WeakMap;class O{constructor(w,A){this.x=w,this.y=A}_setWindowSize(w){this._WINDOW_SIZE=w,P.delete(this)}hasEvenY(){return this.y%c===a}static fromCompressedHex(w){const A=w.length===32,L=J(A?w:w.subarray(1));if(!ot(L))throw new Error("Point is not on curve");const $=C(L);let U=Be($);const G=(U&l)===l;A?G&&(U=he(-U)):(w[0]&1)===1!==G&&(U=he(-U));const j=new O(L,U);return j.assertValidity(),j}static fromUncompressedHex(w){const A=J(w.subarray(1,m+1)),L=J(w.subarray(m+1,m*2+1)),$=new O(A,L);return $.assertValidity(),$}static fromHex(w){const A=xe(w),L=A.length,$=A[0];if(L===m)return this.fromCompressedHex(A);if(L===b&&($===2||$===3))return this.fromCompressedHex(A);if(L===S&&$===4)return this.fromUncompressedHex(A);throw new Error(`Point.fromHex: received invalid point. Expected 32-${b} compressed bytes or ${S} uncompressed bytes, not ${L}`)}static fromPrivateKey(w){return O.BASE.multiply(pt(w))}static fromSignature(w,A,L){const{r:$,s:U}=Rt(A);if(![0,1,2,3].includes(L))throw new Error("Cannot recover: invalid recovery bit");const G=Ie(xe(w)),{n:j}=f,ue=L===2||L===3?$+j:$,ye=je(ue,j),de=he(-G*ye,j),ge=he(U*ye,j),q=L&1?"03":"02",Q=O.fromHex(q+V(ue)),ae=O.BASE.multiplyAndAddUnsafe(Q,de,ge);if(!ae)throw new Error("Cannot recover signature: point at infinify");return ae.assertValidity(),ae}toRawBytes(w=!1){return ne(this.toHex(w))}toHex(w=!1){const A=V(this.x);return w?`${this.hasEvenY()?"02":"03"}${A}`:`04${A}${V(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const w="Point is not on elliptic curve",{x:A,y:L}=this;if(!ot(A)||!ot(L))throw new Error(w);const $=he(L*L),U=C(A);if(he($-U)!==a)throw new Error(w)}equals(w){return this.x===w.x&&this.y===w.y}negate(){return new O(this.x,he(-this.y))}double(){return k.fromAffine(this).double().toAffine()}add(w){return k.fromAffine(this).add(k.fromAffine(w)).toAffine()}subtract(w){return this.add(w.negate())}multiply(w){return k.fromAffine(this).multiply(w,this).toAffine()}multiplyAndAddUnsafe(w,A,L){const $=k.fromAffine(this),U=A===a||A===l||this!==O.BASE?$.multiplyUnsafe(A):$.multiply(A),G=k.fromAffine(w).multiplyUnsafe(L),j=U.add(G);return j.equals(k.ZERO)?void 0:j.toAffine()}}O.BASE=new O(f.Gx,f.Gy),O.ZERO=new O(a,a);function D(v){return Number.parseInt(v[0],16)>=8?"00"+v:v}function F(v){if(v.length<2||v[0]!==2)throw new Error(`Invalid signature integer tag: ${H(v)}`);const w=v[1],A=v.subarray(2,w+2);if(!w||A.length!==w)throw new Error("Invalid signature integer: wrong length");if(A[0]===0&&A[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:J(A),left:v.subarray(w+2)}}function B(v){if(v.length<2||v[0]!=48)throw new Error(`Invalid signature tag: ${H(v)}`);if(v[1]!==v.length-2)throw new Error("Invalid signature: incorrect length");const{data:w,left:A}=F(v.subarray(2)),{data:L,left:$}=F(A);if($.length)throw new Error(`Invalid signature: left bytes after parsing: ${H($)}`);return{r:w,s:L}}class N{constructor(w,A){this.r=w,this.s=A,this.assertValidity()}static fromCompact(w){const A=w instanceof Uint8Array,L="Signature.fromCompact";if(typeof w!="string"&&!A)throw new TypeError(`${L}: Expected string or Uint8Array`);const $=A?H(w):w;if($.length!==128)throw new Error(`${L}: Expected 64-byte hex`);return new N(te($.slice(0,64)),te($.slice(64,128)))}static fromDER(w){const A=w instanceof Uint8Array;if(typeof w!="string"&&!A)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:L,s:$}=B(A?w:ne(w));return new N(L,$)}static fromHex(w){return this.fromDER(w)}assertValidity(){const{r:w,s:A}=this;if(!ze(w))throw new Error("Invalid Signature: r must be 0 < r < n");if(!ze(A))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const w=f.n>>l;return this.s>w}normalizeS(){return this.hasHighS()?new N(this.r,he(-this.s,f.n)):this}toDERRawBytes(){return ne(this.toDERHex())}toDERHex(){const w=D(Z(this.s)),A=D(Z(this.r)),L=w.length/2,$=A.length/2,U=Z(L),G=Z($);return`30${Z($+L+4)}02${G}${A}02${U}${w}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return ne(this.toCompactHex())}toCompactHex(){return V(this.r)+V(this.s)}}function M(...v){if(!v.every(L=>L instanceof Uint8Array))throw new Error("Uint8Array list expected");if(v.length===1)return v[0];const w=v.reduce((L,$)=>L+$.length,0),A=new Uint8Array(w);for(let L=0,$=0;L<v.length;L++){const U=v[L];A.set(U,$),$+=U.length}return A}const R=Array.from({length:256},(v,w)=>w.toString(16).padStart(2,"0"));function H(v){if(!(v instanceof Uint8Array))throw new Error("Expected Uint8Array");let w="";for(let A=0;A<v.length;A++)w+=R[v[A]];return w}const z=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function V(v){if(typeof v!="bigint")throw new Error("Expected bigint");if(!(a<=v&&v<z))throw new Error("Expected number 0 <= n < 2^256");return v.toString(16).padStart(64,"0")}function X(v){const w=ne(V(v));if(w.length!==32)throw new Error("Error: expected 32 bytes");return w}function Z(v){const w=v.toString(16);return w.length&1?`0${w}`:w}function te(v){if(typeof v!="string")throw new TypeError("hexToNumber: expected string, got "+typeof v);return BigInt(`0x${v}`)}function ne(v){if(typeof v!="string")throw new TypeError("hexToBytes: expected string, got "+typeof v);if(v.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+v.length);const w=new Uint8Array(v.length/2);for(let A=0;A<w.length;A++){const L=A*2,$=v.slice(L,L+2),U=Number.parseInt($,16);if(Number.isNaN(U)||U<0)throw new Error("Invalid byte sequence");w[A]=U}return w}function J(v){return te(H(v))}function xe(v){return v instanceof Uint8Array?Uint8Array.from(v):ne(v)}function Le(v){if(typeof v=="number"&&Number.isSafeInteger(v)&&v>0)return BigInt(v);if(typeof v=="bigint"&&ze(v))return v;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function he(v,w=f.P){const A=v%w;return A>=a?A:w+A}function ke(v,w){const{P:A}=f;let L=v;for(;w-- >a;)L*=L,L%=A;return L}function Be(v){const{P:w}=f,A=BigInt(6),L=BigInt(11),$=BigInt(22),U=BigInt(23),G=BigInt(44),j=BigInt(88),ue=v*v*v%w,ye=ue*ue*v%w,de=ke(ye,u)*ye%w,ge=ke(de,u)*ye%w,q=ke(ge,c)*ue%w,Q=ke(q,L)*q%w,ae=ke(Q,$)*Q%w,pe=ke(ae,G)*ae%w,Se=ke(pe,j)*pe%w,_e=ke(Se,G)*ae%w,Ze=ke(_e,u)*ye%w,Ne=ke(Ze,U)*Q%w,it=ke(Ne,A)*ue%w,tt=ke(it,c);if(tt*tt%w!==v)throw new Error("Cannot find square root");return tt}function je(v,w=f.P){if(v===a||w<=a)throw new Error(`invert: expected positive integers, got n=${v} mod=${w}`);let A=he(v,w),L=w,$=a,U=l;for(;A!==a;){const j=L/A,ue=L%A,ye=$-U*j;L=A,A=ue,$=U,U=ye}if(L!==l)throw new Error("invert: does not exist");return he($,w)}function Fe(v,w=f.P){const A=new Array(v.length),L=v.reduce((U,G,j)=>G===a?U:(A[j]=U,he(U*G,w)),l),$=je(L,w);return v.reduceRight((U,G,j)=>G===a?U:(A[j]=he(U*A[j],w),he(U*G,w)),$),A}function ve(v){const w=v.length*8-g*8,A=J(v);return w>0?A>>BigInt(w):A}function Ie(v,w=!1){const A=ve(v);if(w)return A;const{n:L}=f;return A>=L?A-L:A}let Oe,qe;class Te{constructor(w,A){if(this.hashLen=w,this.qByteLen=A,typeof w!="number"||w<2)throw new Error("hashLen must be a number");if(typeof A!="number"||A<2)throw new Error("qByteLen must be a number");this.v=new Uint8Array(w).fill(1),this.k=new Uint8Array(w).fill(0),this.counter=0}hmac(...w){return It.hmacSha256(this.k,...w)}hmacSync(...w){return qe(this.k,...w)}checkSync(){if(typeof qe!="function")throw new x("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(w=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),w),this.v=await this.hmac(this.v),w.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),w),this.v=await this.hmac(this.v))}reseedSync(w=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),w),this.v=this.hmacSync(this.v),w.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),w),this.v=this.hmacSync(this.v))}async generate(){this.incr();let w=0;const A=[];for(;w<this.qByteLen;){this.v=await this.hmac(this.v);const L=this.v.slice();A.push(L),w+=this.v.length}return M(...A)}generateSync(){this.checkSync(),this.incr();let w=0;const A=[];for(;w<this.qByteLen;){this.v=this.hmacSync(this.v);const L=this.v.slice();A.push(L),w+=this.v.length}return M(...A)}}function ze(v){return a<v&&v<f.n}function ot(v){return a<v&&v<f.P}function ct(v,w,A,L=!0){const{n:$}=f,U=Ie(v,!0);if(!ze(U))return;const G=je(U,$),j=O.BASE.multiply(U),ue=he(j.x,$);if(ue===a)return;const ye=he(G*he(w+A*ue,$),$);if(ye===a)return;let de=new N(ue,ye),ge=(j.x===de.r?0:2)|Number(j.y&l);return L&&de.hasHighS()&&(de=de.normalizeS(),ge^=1),{sig:de,recovery:ge}}function pt(v){let w;if(typeof v=="bigint")w=v;else if(typeof v=="number"&&Number.isSafeInteger(v)&&v>0)w=BigInt(v);else if(typeof v=="string"){if(v.length!==2*g)throw new Error("Expected 32 bytes of private key");w=te(v)}else if(v instanceof Uint8Array){if(v.length!==g)throw new Error("Expected 32 bytes of private key");w=J(v)}else throw new TypeError("Expected valid private key");if(!ze(w))throw new Error("Expected private key: 0 < key < n");return w}function $t(v){return v instanceof O?(v.assertValidity(),v):O.fromHex(v)}function Rt(v){if(v instanceof N)return v.assertValidity(),v;try{return N.fromDER(v)}catch{return N.fromCompact(v)}}function Tt(v,w=!1){return O.fromPrivateKey(v).toRawBytes(w)}function Ot(v){const w=v instanceof Uint8Array,A=typeof v=="string",L=(w||A)&&v.length;return w?L===b||L===S:A?L===b*2||L===S*2:v instanceof O}function He(v,w,A=!1){if(Ot(v))throw new TypeError("getSharedSecret: first arg must be private key");if(!Ot(w))throw new TypeError("getSharedSecret: second arg must be public key");const L=$t(w);return L.assertValidity(),L.multiply(pt(v)).toRawBytes(A)}function ut(v){const w=v.length>m?v.slice(0,m):v;return J(w)}function yt(v){const w=ut(v),A=he(w,f.n);return Kt(A<a?w:A)}function Kt(v){return X(v)}function Ht(v,w,A){if(v==null)throw new Error(`sign: expected valid message hash, not "${v}"`);const L=xe(v),$=pt(w),U=[Kt($),yt(L)];if(A!=null){A===!0&&(A=It.randomBytes(m));const ue=xe(A);if(ue.length!==m)throw new Error(`sign: Expected ${m} bytes of extra data`);U.push(ue)}const G=M(...U),j=ut(L);return{seed:G,m:j,d:$}}function zt(v,w){const{sig:A,recovery:L}=v,{der:$,recovered:U}=Object.assign({canonical:!0,der:!0},w),G=$?A.toDERRawBytes():A.toCompactRawBytes();return U?[G,L]:G}function tn(v,w,A={}){const{seed:L,m:$,d:U}=Ht(v,w,A.extraEntropy),G=new Te(y,g);G.reseedSync(L);let j;for(;!(j=ct(G.generateSync(),$,U,A.canonical));)G.reseedSync();return zt(j,A)}const Cn={strict:!0};function Nn(v,w,A,L=Cn){let $;try{$=Rt(v),w=xe(w)}catch{return!1}const{r:U,s:G}=$;if(L.strict&&$.hasHighS())return!1;const j=Ie(w);let ue;try{ue=$t(A)}catch{return!1}const{n:ye}=f,de=je(G,ye),ge=he(j*de,ye),q=he(U*de,ye),Q=O.BASE.multiplyAndAddUnsafe(ue,ge,q);return Q?he(Q.x,ye)===U:!1}function Yt(v){return he(J(v),f.n)}class Gt{constructor(w,A){this.r=w,this.s=A,this.assertValidity()}static fromHex(w){const A=xe(w);if(A.length!==64)throw new TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${A.length}`);const L=J(A.subarray(0,32)),$=J(A.subarray(32,64));return new Gt(L,$)}assertValidity(){const{r:w,s:A}=this;if(!ot(w)||!ze(A))throw new Error("Invalid signature")}toHex(){return V(this.r)+V(this.s)}toRawBytes(){return ne(this.toHex())}}function nn(v){return O.fromPrivateKey(v).toRawX()}class Jt{constructor(w,A,L=It.randomBytes()){if(w==null)throw new TypeError(`sign: Expected valid message, not "${w}"`);this.m=xe(w);const{x:$,scalar:U}=this.getScalar(pt(A));if(this.px=$,this.d=U,this.rand=xe(L),this.rand.length!==32)throw new TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(w){const A=O.fromPrivateKey(w),L=A.hasEvenY()?w:f.n-w;return{point:A,scalar:L,x:A.toRawX()}}initNonce(w,A){return X(w^J(A))}finalizeNonce(w){const A=he(J(w),f.n);if(A===a)throw new Error("sign: Creation of signature failed. k is zero");const{point:L,x:$,scalar:U}=this.getScalar(A);return{R:L,rx:$,k:U}}finalizeSig(w,A,L,$){return new Gt(w.x,he(A+L*$,f.n)).toRawBytes()}error(){throw new Error("sign: Invalid signature produced")}async calc(){const{m:w,d:A,px:L,rand:$}=this,U=It.taggedHash,G=this.initNonce(A,await U(er.aux,$)),{R:j,rx:ue,k:ye}=this.finalizeNonce(await U(er.nonce,G,L,w)),de=Yt(await U(er.challenge,ue,L,w)),ge=this.finalizeSig(j,ye,de,A);return await Fn(ge,w,L)||this.error(),ge}calcSync(){const{m:w,d:A,px:L,rand:$}=this,U=It.taggedHashSync,G=this.initNonce(A,U(er.aux,$)),{R:j,rx:ue,k:ye}=this.finalizeNonce(U(er.nonce,G,L,w)),de=Yt(U(er.challenge,ue,L,w)),ge=this.finalizeSig(j,ye,de,A);return ar(ge,w,L)||this.error(),ge}}async function zn(v,w,A){return new Jt(v,w,A).calc()}function gi(v,w,A){return new Jt(v,w,A).calcSync()}function ws(v,w,A){const L=v instanceof Gt,$=L?v:Gt.fromHex(v);return L&&$.assertValidity(),{...$,m:xe(w),P:$t(A)}}function Mt(v,w,A,L){const $=O.BASE.multiplyAndAddUnsafe(w,pt(A),he(-L,f.n));return!(!$||!$.hasEvenY()||$.x!==v)}async function Fn(v,w,A){try{const{r:L,s:$,m:U,P:G}=ws(v,w,A),j=Yt(await It.taggedHash(er.challenge,X(L),G.toRawX(),U));return Mt(L,G,$,j)}catch{return!1}}function ar(v,w,A){try{const{r:L,s:$,m:U,P:G}=ws(v,w,A),j=Yt(It.taggedHashSync(er.challenge,X(L),G.toRawX(),U));return Mt(L,G,$,j)}catch(L){if(L instanceof x)throw L;return!1}}const yi={Signature:Gt,getPublicKey:nn,sign:zn,verify:Fn,signSync:gi,verifySync:ar};O.BASE._setWindowSize(8);const lr={node:o,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},er={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},bi={},It={bytesToHex:H,hexToBytes:ne,concatBytes:M,mod:he,invert:je,isValidPrivateKey(v){try{return pt(v),!0}catch{return!1}},_bigintTo32Bytes:X,_normalizePrivateKey:pt,hashToPrivateKey:v=>{v=xe(v);const w=g+8;if(v.length<w||v.length>1024)throw new Error("Expected valid bytes of private key as per FIPS 186");const A=he(J(v),f.n-l)+l;return X(A)},randomBytes:(v=32)=>{if(lr.web)return lr.web.getRandomValues(new Uint8Array(v));if(lr.node){const{randomBytes:w}=lr.node;return Uint8Array.from(w(v))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>It.hashToPrivateKey(It.randomBytes(g+8)),precompute(v=8,w=O.BASE){const A=w===O.BASE?w:new O(w.x,w.y);return A._setWindowSize(v),A.multiply(u),A},sha256:async(...v)=>{if(lr.web){const w=await lr.web.subtle.digest("SHA-256",M(...v));return new Uint8Array(w)}else if(lr.node){const{createHash:w}=lr.node,A=w("sha256");return v.forEach(L=>A.update(L)),Uint8Array.from(A.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(v,...w)=>{if(lr.web){const A=await lr.web.subtle.importKey("raw",v,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),L=M(...w),$=await lr.web.subtle.sign("HMAC",A,L);return new Uint8Array($)}else if(lr.node){const{createHmac:A}=lr.node,L=A("sha256",v);return w.forEach($=>L.update($)),Uint8Array.from(L.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(v,...w)=>{let A=bi[v];if(A===void 0){const L=await It.sha256(Uint8Array.from(v,$=>$.charCodeAt(0)));A=M(L,L),bi[v]=A}return It.sha256(A,...w)},taggedHashSync:(v,...w)=>{if(typeof Oe!="function")throw new x("sha256Sync is undefined, you need to set it");let A=bi[v];if(A===void 0){const L=Oe(Uint8Array.from(v,$=>$.charCodeAt(0)));A=M(L,L),bi[v]=A}return Oe(A,...w)},_JacobianPoint:k};Object.defineProperties(It,{sha256Sync:{configurable:!1,get(){return Oe},set(v){Oe||(Oe=v)}},hmacSha256Sync:{configurable:!1,get(){return qe},set(v){qe||(qe=v)}}});var Nr={};Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.sha224=Nr.sha256=void 0;var da={};Object.defineProperty(da,"__esModule",{value:!0}),da.SHA2=void 0;var Zt={};Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.output=Zt.exists=Zt.hash=Zt.bytes=Zt.bool=Zt.number=void 0;function xd(v){if(!Number.isSafeInteger(v)||v<0)throw new Error(`Wrong positive integer: ${v}`)}Zt.number=xd;function ng(v){if(typeof v!="boolean")throw new Error(`Expected boolean, not ${v}`)}Zt.bool=ng;function kh(v,...w){if(!(v instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length>0&&!w.includes(v.length))throw new TypeError(`Expected Uint8Array of length ${w}, not of length=${v.length}`)}Zt.bytes=kh;function _l(v){if(typeof v!="function"||typeof v.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xd(v.outputLen),xd(v.blockLen)}Zt.hash=_l;function Eh(v,w=!0){if(v.destroyed)throw new Error("Hash instance has been destroyed");if(w&&v.finished)throw new Error("Hash#digest() has already been called")}Zt.exists=Eh;function rg(v,w){kh(v);const A=w.outputLen;if(v.length<A)throw new Error(`digestInto() expects output buffer of length at least ${A}`)}Zt.output=rg;const Xw={number:xd,bool:ng,bytes:kh,hash:_l,exists:Eh,output:rg};Zt.default=Xw;var Je={};Object.defineProperty(Je,"__esModule",{value:!0}),Je.randomBytes=Je.wrapConstructorWithOpts=Je.wrapConstructor=Je.checkOpts=Je.Hash=Je.concatBytes=Je.toBytes=Je.utf8ToBytes=Je.asyncLoop=Je.nextTick=Je.hexToBytes=Je.bytesToHex=Je.isLE=Je.rotr=Je.createView=Je.u32=Je.u8=void 0;var fa={};Object.defineProperty(fa,"__esModule",{value:!0}),fa.crypto=void 0,fa.crypto={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};const Qw=v=>new Uint8Array(v.buffer,v.byteOffset,v.byteLength);Je.u8=Qw;const Yw=v=>new Uint32Array(v.buffer,v.byteOffset,Math.floor(v.byteLength/4));Je.u32=Yw;const Dt=v=>new DataView(v.buffer,v.byteOffset,v.byteLength);Je.createView=Dt;const Sn=(v,w)=>v<<32-w|v>>>w;if(Je.rotr=Sn,Je.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!Je.isLE)throw new Error("Non little-endian hardware is not supported");const rn=Array.from({length:256},(v,w)=>w.toString(16).padStart(2,"0"));function In(v){if(!(v instanceof Uint8Array))throw new Error("Uint8Array expected");let w="";for(let A=0;A<v.length;A++)w+=rn[v[A]];return w}Je.bytesToHex=In;function mn(v){if(typeof v!="string")throw new TypeError("hexToBytes: expected string, got "+typeof v);if(v.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const w=new Uint8Array(v.length/2);for(let A=0;A<w.length;A++){const L=A*2,$=v.slice(L,L+2),U=Number.parseInt($,16);if(Number.isNaN(U)||U<0)throw new Error("Invalid byte sequence");w[A]=U}return w}Je.hexToBytes=mn;const On=async()=>{};Je.nextTick=On;async function _n(v,w,A){let L=Date.now();for(let $=0;$<v;$++){A($);const U=Date.now()-L;U>=0&&U<w||(await(0,Je.nextTick)(),L+=U)}}Je.asyncLoop=_n;function Un(v){if(typeof v!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof v}`);return new TextEncoder().encode(v)}Je.utf8ToBytes=Un;function Hn(v){if(typeof v=="string"&&(v=Un(v)),!(v instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof v})`);return v}Je.toBytes=Hn;function go(...v){if(!v.every(L=>L instanceof Uint8Array))throw new Error("Uint8Array list expected");if(v.length===1)return v[0];const w=v.reduce((L,$)=>L+$.length,0),A=new Uint8Array(w);for(let L=0,$=0;L<v.length;L++){const U=v[L];A.set(U,$),$+=U.length}return A}Je.concatBytes=go;class ha{clone(){return this._cloneInto()}}Je.Hash=ha;const pa=v=>Object.prototype.toString.call(v)==="[object Object]"&&v.constructor===Object;function Al(v,w){if(w!==void 0&&(typeof w!="object"||!pa(w)))throw new TypeError("Options should be object or undefined");return Object.assign(v,w)}Je.checkOpts=Al;function Pl(v){const w=L=>v().update(Hn(L)).digest(),A=v();return w.outputLen=A.outputLen,w.blockLen=A.blockLen,w.create=()=>v(),w}Je.wrapConstructor=Pl;function iu(v){const w=(L,$)=>v($).update(Hn(L)).digest(),A=v({});return w.outputLen=A.outputLen,w.blockLen=A.blockLen,w.create=L=>v(L),w}Je.wrapConstructorWithOpts=iu;function Di(v=32){if(fa.crypto.web)return fa.crypto.web.getRandomValues(new Uint8Array(v));if(fa.crypto.node)return new Uint8Array(fa.crypto.node.randomBytes(v).buffer);throw new Error("The environment doesn't have randomBytes function")}Je.randomBytes=Di;function js(v,w,A,L){if(typeof v.setBigUint64=="function")return v.setBigUint64(w,A,L);const $=BigInt(32),U=BigInt(4294967295),G=Number(A>>$&U),j=Number(A&U),ue=L?4:0,ye=L?0:4;v.setUint32(w+ue,G,L),v.setUint32(w+ye,j,L)}class Il extends Je.Hash{constructor(w,A,L,$){super(),this.blockLen=w,this.outputLen=A,this.padOffset=L,this.isLE=$,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(w),this.view=(0,Je.createView)(this.buffer)}update(w){Zt.default.exists(this);const{view:A,buffer:L,blockLen:$}=this;w=(0,Je.toBytes)(w);const U=w.length;for(let G=0;G<U;){const j=Math.min($-this.pos,U-G);if(j===$){const ue=(0,Je.createView)(w);for(;$<=U-G;G+=$)this.process(ue,G);continue}L.set(w.subarray(G,G+j),this.pos),this.pos+=j,G+=j,this.pos===$&&(this.process(A,0),this.pos=0)}return this.length+=w.length,this.roundClean(),this}digestInto(w){Zt.default.exists(this),Zt.default.output(w,this),this.finished=!0;const{buffer:A,view:L,blockLen:$,isLE:U}=this;let{pos:G}=this;A[G++]=128,this.buffer.subarray(G).fill(0),this.padOffset>$-G&&(this.process(L,0),G=0);for(let ge=G;ge<$;ge++)A[ge]=0;js(L,$-8,BigInt(this.length*8),U),this.process(L,0);const j=(0,Je.createView)(w),ue=this.outputLen;if(ue%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const ye=ue/4,de=this.get();if(ye>de.length)throw new Error("_sha2: outputLen bigger than state");for(let ge=0;ge<ye;ge++)j.setUint32(4*ge,de[ge],U)}digest(){const{buffer:w,outputLen:A}=this;this.digestInto(w);const L=w.slice(0,A);return this.destroy(),L}_cloneInto(w){w||(w=new this.constructor),w.set(...this.get());const{blockLen:A,buffer:L,length:$,finished:U,destroyed:G,pos:j}=this;return w.length=$,w.pos=j,w.finished=U,w.destroyed=G,$%A&&w.buffer.set(L),w}}da.SHA2=Il;const su=(v,w,A)=>v&w^~v&A,Ol=(v,w,A)=>v&w^v&A^w&A,Ml=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),wi=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),es=new Uint32Array(64);class Sd extends da.SHA2{constructor(){super(64,32,8,!1),this.A=wi[0]|0,this.B=wi[1]|0,this.C=wi[2]|0,this.D=wi[3]|0,this.E=wi[4]|0,this.F=wi[5]|0,this.G=wi[6]|0,this.H=wi[7]|0}get(){const{A:w,B:A,C:L,D:$,E:U,F:G,G:j,H:ue}=this;return[w,A,L,$,U,G,j,ue]}set(w,A,L,$,U,G,j,ue){this.A=w|0,this.B=A|0,this.C=L|0,this.D=$|0,this.E=U|0,this.F=G|0,this.G=j|0,this.H=ue|0}process(w,A){for(let ge=0;ge<16;ge++,A+=4)es[ge]=w.getUint32(A,!1);for(let ge=16;ge<64;ge++){const q=es[ge-15],Q=es[ge-2],ae=(0,Je.rotr)(q,7)^(0,Je.rotr)(q,18)^q>>>3,pe=(0,Je.rotr)(Q,17)^(0,Je.rotr)(Q,19)^Q>>>10;es[ge]=pe+es[ge-7]+ae+es[ge-16]|0}let{A:L,B:$,C:U,D:G,E:j,F:ue,G:ye,H:de}=this;for(let ge=0;ge<64;ge++){const q=(0,Je.rotr)(j,6)^(0,Je.rotr)(j,11)^(0,Je.rotr)(j,25),Q=de+q+su(j,ue,ye)+Ml[ge]+es[ge]|0,pe=((0,Je.rotr)(L,2)^(0,Je.rotr)(L,13)^(0,Je.rotr)(L,22))+Ol(L,$,U)|0;de=ye,ye=ue,ue=j,j=G+Q|0,G=U,U=$,$=L,L=Q+pe|0}L=L+this.A|0,$=$+this.B|0,U=U+this.C|0,G=G+this.D|0,j=j+this.E|0,ue=ue+this.F|0,ye=ye+this.G|0,de=de+this.H|0,this.set(L,$,U,G,j,ue,ye,de)}roundClean(){es.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Th extends Sd{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}Nr.sha256=(0,Je.wrapConstructor)(()=>new Sd),Nr.sha224=(0,Je.wrapConstructor)(()=>new Th);function qs(v){if(!Number.isSafeInteger(v))throw new Error(`Wrong integer: ${v}`)}function vi(...v){const w=($,U)=>G=>$(U(G)),A=Array.from(v).reverse().reduce(($,U)=>$?w($,U.encode):U.encode,void 0),L=v.reduce(($,U)=>$?w($,U.decode):U.decode,void 0);return{encode:A,decode:L}}function xi(v){return{encode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return w.map(A=>{if(qs(A),A<0||A>=v.length)throw new Error(`Digit index outside alphabet: ${A} (alphabet: ${v.length})`);return v[A]})},decode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="string")throw new Error("alphabet.decode input should be array of strings");return w.map(A=>{if(typeof A!="string")throw new Error(`alphabet.decode: not string element=${A}`);const L=v.indexOf(A);if(L===-1)throw new Error(`Unknown letter: "${A}". Allowed: ${v}`);return L})}}}function Li(v=""){if(typeof v!="string")throw new Error("join separator should be string");return{encode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="string")throw new Error("join.encode input should be array of strings");for(let A of w)if(typeof A!="string")throw new Error(`join.encode: non-string input=${A}`);return w.join(v)},decode:w=>{if(typeof w!="string")throw new Error("join.decode input should be string");return w.split(v)}}}function yo(v,w="="){if(qs(v),typeof w!="string")throw new Error("padding chr should be string");return{encode(A){if(!Array.isArray(A)||A.length&&typeof A[0]!="string")throw new Error("padding.encode input should be array of strings");for(let L of A)if(typeof L!="string")throw new Error(`padding.encode: non-string input=${L}`);for(;A.length*v%8;)A.push(w);return A},decode(A){if(!Array.isArray(A)||A.length&&typeof A[0]!="string")throw new Error("padding.encode input should be array of strings");for(let $ of A)if(typeof $!="string")throw new Error(`padding.decode: non-string input=${$}`);let L=A.length;if(L*v%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;L>0&&A[L-1]===w;L--)if(!((L-1)*v%8))throw new Error("Invalid padding: string has too much padding");return A.slice(0,L)}}}function ig(v){if(typeof v!="function")throw new Error("normalize fn should be function");return{encode:w=>w,decode:w=>v(w)}}function sg(v,w,A){if(w<2)throw new Error(`convertRadix: wrong from=${w}, base cannot be less than 2`);if(A<2)throw new Error(`convertRadix: wrong to=${A}, base cannot be less than 2`);if(!Array.isArray(v))throw new Error("convertRadix: data should be array");if(!v.length)return[];let L=0;const $=[],U=Array.from(v);for(U.forEach(G=>{if(qs(G),G<0||G>=w)throw new Error(`Wrong integer: ${G}`)});;){let G=0,j=!0;for(let ue=L;ue<U.length;ue++){const ye=U[ue],de=w*G+ye;if(!Number.isSafeInteger(de)||w*G/w!==G||de-ye!==w*G)throw new Error("convertRadix: carry overflow");if(G=de%A,U[ue]=Math.floor(de/A),!Number.isSafeInteger(U[ue])||U[ue]*A+G!==de)throw new Error("convertRadix: carry overflow");if(j)U[ue]?j=!1:L=ue;else continue}if($.push(G),j)break}for(let G=0;G<v.length-1&&v[G]===0;G++)$.push(0);return $.reverse()}const og=(v,w)=>w?og(w,v%w):v,kd=(v,w)=>v+(w-og(v,w));function Ch(v,w,A,L){if(!Array.isArray(v))throw new Error("convertRadix2: data should be array");if(w<=0||w>32)throw new Error(`convertRadix2: wrong from=${w}`);if(A<=0||A>32)throw new Error(`convertRadix2: wrong to=${A}`);if(kd(w,A)>32)throw new Error(`convertRadix2: carry overflow from=${w} to=${A} carryBits=${kd(w,A)}`);let $=0,U=0;const G=2**A-1,j=[];for(const ue of v){if(qs(ue),ue>=2**w)throw new Error(`convertRadix2: invalid data word=${ue} from=${w}`);if($=$<<w|ue,U+w>32)throw new Error(`convertRadix2: carry overflow pos=${U} from=${w}`);for(U+=w;U>=A;U-=A)j.push(($>>U-A&G)>>>0);$&=2**U-1}if($=$<<A-U&G,!L&&U>=w)throw new Error("Excess padding");if(!L&&$)throw new Error(`Non-zero padding: ${$}`);return L&&U>0&&j.push($>>>0),j}function ag(v){return qs(v),{encode:w=>{if(!(w instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return sg(Array.from(w),256,v)},decode:w=>{if(!Array.isArray(w)||w.length&&typeof w[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(sg(w,v,256))}}}function Ks(v,w=!1){if(qs(v),v<=0||v>32)throw new Error("radix2: bits should be in (0..32]");if(kd(8,v)>32||kd(v,8)>32)throw new Error("radix2: carry overflow");return{encode:A=>{if(!(A instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ch(Array.from(A),8,v,!w)},decode:A=>{if(!Array.isArray(A)||A.length&&typeof A[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ch(A,v,8,w))}}}function lg(v){if(typeof v!="function")throw new Error("unsafeWrapper fn should be function");return function(...w){try{return v.apply(null,w)}catch{}}}function cg(v,w){if(qs(v),typeof w!="function")throw new Error("checksum fn should be function");return{encode(A){if(!(A instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const L=w(A).slice(0,v),$=new Uint8Array(A.length+v);return $.set(A),$.set(L,A.length),$},decode(A){if(!(A instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const L=A.slice(0,-v),$=w(L).slice(0,v),U=A.slice(-v);for(let G=0;G<v;G++)if($[G]!==U[G])throw new Error("Invalid checksum");return L}}}const Ed={alphabet:xi,chain:vi,checksum:cg,radix:ag,radix2:Ks,join:Li,padding:yo},Jw=vi(Ks(4),xi("0123456789ABCDEF"),Li("")),ev=vi(Ks(5),xi("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),yo(5),Li(""));vi(Ks(5),xi("0123456789ABCDEFGHIJKLMNOPQRSTUV"),yo(5),Li("")),vi(Ks(5),xi("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Li(""),ig(v=>v.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const _h=vi(Ks(6),xi("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),yo(6),Li("")),X$=vi(Ks(6),xi("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),yo(6),Li("")),tv=v=>vi(ag(58),xi(v),Li("")),ug=tv("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");tv("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),tv("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const YC=[0,2,3,5,6,7,9,10,11],Q$={encode(v){let w="";for(let A=0;A<v.length;A+=8){const L=v.subarray(A,A+8);w+=ug.encode(L).padStart(YC[L.length],"1")}return w},decode(v){let w=[];for(let A=0;A<v.length;A+=11){const L=v.slice(A,A+11),$=YC.indexOf(L.length),U=ug.decode(L);for(let G=0;G<U.length-$;G++)if(U[G]!==0)throw new Error("base58xmr: wrong padding");w=w.concat(Array.from(U.slice(U.length-$)))}return Uint8Array.from(w)}},Y$=v=>vi(cg(4,w=>v(v(w))),ug),nv=vi(xi("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Li("")),JC=[996825010,642813549,513874426,1027748829,705979059];function Ah(v){const w=v>>25;let A=(v&33554431)<<5;for(let L=0;L<JC.length;L++)(w>>L&1)===1&&(A^=JC[L]);return A}function e_(v,w,A=1){const L=v.length;let $=1;for(let U=0;U<L;U++){const G=v.charCodeAt(U);if(G<33||G>126)throw new Error(`Invalid prefix (${v})`);$=Ah($)^G>>5}$=Ah($);for(let U=0;U<L;U++)$=Ah($)^v.charCodeAt(U)&31;for(let U of w)$=Ah($)^U;for(let U=0;U<6;U++)$=Ah($);return $^=A,nv.encode(Ch([$%2**30],30,5,!1))}function t_(v){const w=v==="bech32"?1:734539939,A=Ks(5),L=A.decode,$=A.encode,U=lg(L);function G(de,ge,q=90){if(typeof de!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof de}`);if(!Array.isArray(ge)||ge.length&&typeof ge[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof ge}`);const Q=de.length+7+ge.length;if(q!==!1&&Q>q)throw new TypeError(`Length ${Q} exceeds limit ${q}`);return de=de.toLowerCase(),`${de}1${nv.encode(ge)}${e_(de,ge,w)}`}function j(de,ge=90){if(typeof de!="string")throw new Error(`bech32.decode input should be string, not ${typeof de}`);if(de.length<8||ge!==!1&&de.length>ge)throw new TypeError(`Wrong string length: ${de.length} (${de}). Expected (8..${ge})`);const q=de.toLowerCase();if(de!==q&&de!==de.toUpperCase())throw new Error("String must be lowercase or uppercase");de=q;const Q=de.lastIndexOf("1");if(Q===0||Q===-1)throw new Error('Letter "1" must be present between prefix and data only');const ae=de.slice(0,Q),pe=de.slice(Q+1);if(pe.length<6)throw new Error("Data must be at least 6 characters long");const Se=nv.decode(pe).slice(0,-6),_e=e_(ae,Se,w);if(!pe.endsWith(_e))throw new Error(`Invalid checksum in ${de}: expected "${_e}"`);return{prefix:ae,words:Se}}const ue=lg(j);function ye(de){const{prefix:ge,words:q}=j(de,!1);return{prefix:ge,words:q,bytes:L(q)}}return{encode:G,decode:j,decodeToBytes:ye,decodeUnsafe:ue,fromWords:L,fromWordsUnsafe:U,toWords:$}}const Bi=t_("bech32");t_("bech32m");const J$={encode:v=>new TextDecoder().decode(v),decode:v=>new TextEncoder().encode(v)},ez=vi(Ks(4),xi("0123456789abcdef"),Li(""),ig(v=>{if(typeof v!="string"||v.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof v} with length ${v.length}`);return v.toLowerCase()}));`${Object.keys({utf8:J$,hex:ez,base16:Jw,base32:ev,base64:_h,base64url:X$,base58:ug,base58xmr:Q$}).join(", ")}`;var Ph={};Object.defineProperty(Ph,"__esModule",{value:!0}),Ph.wordlist=void 0,Ph.wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);var Jr={};Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.mnemonicToSeedSync=Jr.mnemonicToSeed=Jr.validateMnemonic=Jr.entropyToMnemonic=Jr.mnemonicToEntropy=Jr.generateMnemonic=void 0;var ou={};Object.defineProperty(ou,"__esModule",{value:!0}),ou.pbkdf2Async=ou.pbkdf2=void 0;var ma={};Object.defineProperty(ma,"__esModule",{value:!0}),ma.hmac=void 0;class n_ extends Je.Hash{constructor(w,A){super(),this.finished=!1,this.destroyed=!1,Zt.default.hash(w);const L=(0,Je.toBytes)(A);if(this.iHash=w.create(),typeof this.iHash.update!="function")throw new TypeError("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const $=this.blockLen,U=new Uint8Array($);U.set(L.length>$?w.create().update(L).digest():L);for(let G=0;G<U.length;G++)U[G]^=54;this.iHash.update(U),this.oHash=w.create();for(let G=0;G<U.length;G++)U[G]^=106;this.oHash.update(U),U.fill(0)}update(w){return Zt.default.exists(this),this.iHash.update(w),this}digestInto(w){Zt.default.exists(this),Zt.default.bytes(w,this.outputLen),this.finished=!0,this.iHash.digestInto(w),this.oHash.update(w),this.oHash.digestInto(w),this.destroy()}digest(){const w=new Uint8Array(this.oHash.outputLen);return this.digestInto(w),w}_cloneInto(w){w||(w=Object.create(Object.getPrototypeOf(this),{}));const{oHash:A,iHash:L,finished:$,destroyed:U,blockLen:G,outputLen:j}=this;return w.finished=$,w.destroyed=U,w.blockLen=G,w.outputLen=j,w.oHash=A._cloneInto(w.oHash),w.iHash=L._cloneInto(w.iHash),w}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const tz=(v,w,A)=>new n_(v,w).update(A).digest();ma.hmac=tz,ma.hmac.create=(v,w)=>new n_(v,w);function r_(v,w,A,L){Zt.default.hash(v);const $=(0,Je.checkOpts)({dkLen:32,asyncTick:10},L),{c:U,dkLen:G,asyncTick:j}=$;if(Zt.default.number(U),Zt.default.number(G),Zt.default.number(j),U<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const ue=(0,Je.toBytes)(w),ye=(0,Je.toBytes)(A),de=new Uint8Array(G),ge=ma.hmac.create(v,ue),q=ge._cloneInto().update(ye);return{c:U,dkLen:G,asyncTick:j,DK:de,PRF:ge,PRFSalt:q}}function i_(v,w,A,L,$){return v.destroy(),w.destroy(),L&&L.destroy(),$.fill(0),A}function nz(v,w,A,L){const{c:$,dkLen:U,DK:G,PRF:j,PRFSalt:ue}=r_(v,w,A,L);let ye;const de=new Uint8Array(4),ge=(0,Je.createView)(de),q=new Uint8Array(j.outputLen);for(let Q=1,ae=0;ae<U;Q++,ae+=j.outputLen){const pe=G.subarray(ae,ae+j.outputLen);ge.setInt32(0,Q,!1),(ye=ue._cloneInto(ye)).update(de).digestInto(q),pe.set(q.subarray(0,pe.length));for(let Se=1;Se<$;Se++){j._cloneInto(ye).update(q).digestInto(q);for(let _e=0;_e<pe.length;_e++)pe[_e]^=q[_e]}}return i_(j,ue,G,ye,q)}ou.pbkdf2=nz;async function rz(v,w,A,L){const{c:$,dkLen:U,asyncTick:G,DK:j,PRF:ue,PRFSalt:ye}=r_(v,w,A,L);let de;const ge=new Uint8Array(4),q=(0,Je.createView)(ge),Q=new Uint8Array(ue.outputLen);for(let ae=1,pe=0;pe<U;ae++,pe+=ue.outputLen){const Se=j.subarray(pe,pe+ue.outputLen);q.setInt32(0,ae,!1),(de=ye._cloneInto(de)).update(ge).digestInto(Q),Se.set(Q.subarray(0,Se.length)),await(0,Je.asyncLoop)($-1,G,_e=>{ue._cloneInto(de).update(Q).digestInto(Q);for(let Ze=0;Ze<Se.length;Ze++)Se[Ze]^=Q[Ze]})}return i_(ue,ye,j,de,Q)}ou.pbkdf2Async=rz;var Si={};Object.defineProperty(Si,"__esModule",{value:!0}),Si.sha384=Si.sha512_256=Si.sha512_224=Si.sha512=Si.SHA512=void 0;var xt={};Object.defineProperty(xt,"__esModule",{value:!0}),xt.add=xt.toBig=xt.split=xt.fromBig=void 0;const dg=BigInt(2**32-1),rv=BigInt(32);function iv(v,w=!1){return w?{h:Number(v&dg),l:Number(v>>rv&dg)}:{h:Number(v>>rv&dg)|0,l:Number(v&dg)|0}}xt.fromBig=iv;function s_(v,w=!1){let A=new Uint32Array(v.length),L=new Uint32Array(v.length);for(let $=0;$<v.length;$++){const{h:U,l:G}=iv(v[$],w);[A[$],L[$]]=[U,G]}return[A,L]}xt.split=s_;const iz=(v,w)=>BigInt(v>>>0)<<rv|BigInt(w>>>0);xt.toBig=iz;const sz=(v,w,A)=>v>>>A,oz=(v,w,A)=>v<<32-A|w>>>A,az=(v,w,A)=>v>>>A|w<<32-A,lz=(v,w,A)=>v<<32-A|w>>>A,cz=(v,w,A)=>v<<64-A|w>>>A-32,uz=(v,w,A)=>v>>>A-32|w<<64-A,dz=(v,w)=>w,fz=(v,w)=>v,hz=(v,w,A)=>v<<A|w>>>32-A,pz=(v,w,A)=>w<<A|v>>>32-A,mz=(v,w,A)=>w<<A-32|v>>>64-A,gz=(v,w,A)=>v<<A-32|w>>>64-A;function o_(v,w,A,L){const $=(w>>>0)+(L>>>0);return{h:v+A+($/2**32|0)|0,l:$|0}}xt.add=o_;const yz=(v,w,A)=>(v>>>0)+(w>>>0)+(A>>>0),bz=(v,w,A,L)=>w+A+L+(v/2**32|0)|0,wz=(v,w,A,L)=>(v>>>0)+(w>>>0)+(A>>>0)+(L>>>0),vz=(v,w,A,L,$)=>w+A+L+$+(v/2**32|0)|0,xz=(v,w,A,L,$)=>(v>>>0)+(w>>>0)+(A>>>0)+(L>>>0)+($>>>0),Sz=(v,w,A,L,$,U)=>w+A+L+$+U+(v/2**32|0)|0,kz={fromBig:iv,split:s_,toBig:xt.toBig,shrSH:sz,shrSL:oz,rotrSH:az,rotrSL:lz,rotrBH:cz,rotrBL:uz,rotr32H:dz,rotr32L:fz,rotlSH:hz,rotlSL:pz,rotlBH:mz,rotlBL:gz,add:o_,add3L:yz,add3H:bz,add4L:wz,add4H:vz,add5H:Sz,add5L:xz};xt.default=kz;const[Ez,Tz]=xt.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(v=>BigInt(v))),Nl=new Uint32Array(80),Rl=new Uint32Array(80);class Ih extends da.SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:w,Al:A,Bh:L,Bl:$,Ch:U,Cl:G,Dh:j,Dl:ue,Eh:ye,El:de,Fh:ge,Fl:q,Gh:Q,Gl:ae,Hh:pe,Hl:Se}=this;return[w,A,L,$,U,G,j,ue,ye,de,ge,q,Q,ae,pe,Se]}set(w,A,L,$,U,G,j,ue,ye,de,ge,q,Q,ae,pe,Se){this.Ah=w|0,this.Al=A|0,this.Bh=L|0,this.Bl=$|0,this.Ch=U|0,this.Cl=G|0,this.Dh=j|0,this.Dl=ue|0,this.Eh=ye|0,this.El=de|0,this.Fh=ge|0,this.Fl=q|0,this.Gh=Q|0,this.Gl=ae|0,this.Hh=pe|0,this.Hl=Se|0}process(w,A){for(let Ne=0;Ne<16;Ne++,A+=4)Nl[Ne]=w.getUint32(A),Rl[Ne]=w.getUint32(A+=4);for(let Ne=16;Ne<80;Ne++){const it=Nl[Ne-15]|0,tt=Rl[Ne-15]|0,et=xt.default.rotrSH(it,tt,1)^xt.default.rotrSH(it,tt,8)^xt.default.shrSH(it,tt,7),st=xt.default.rotrSL(it,tt,1)^xt.default.rotrSL(it,tt,8)^xt.default.shrSL(it,tt,7),ft=Nl[Ne-2]|0,hn=Rl[Ne-2]|0,re=xt.default.rotrSH(ft,hn,19)^xt.default.rotrBH(ft,hn,61)^xt.default.shrSH(ft,hn,6),se=xt.default.rotrSL(ft,hn,19)^xt.default.rotrBL(ft,hn,61)^xt.default.shrSL(ft,hn,6),ee=xt.default.add4L(st,se,Rl[Ne-7],Rl[Ne-16]),fe=xt.default.add4H(ee,et,re,Nl[Ne-7],Nl[Ne-16]);Nl[Ne]=fe|0,Rl[Ne]=ee|0}let{Ah:L,Al:$,Bh:U,Bl:G,Ch:j,Cl:ue,Dh:ye,Dl:de,Eh:ge,El:q,Fh:Q,Fl:ae,Gh:pe,Gl:Se,Hh:_e,Hl:Ze}=this;for(let Ne=0;Ne<80;Ne++){const it=xt.default.rotrSH(ge,q,14)^xt.default.rotrSH(ge,q,18)^xt.default.rotrBH(ge,q,41),tt=xt.default.rotrSL(ge,q,14)^xt.default.rotrSL(ge,q,18)^xt.default.rotrBL(ge,q,41),et=ge&Q^~ge&pe,st=q&ae^~q&Se,ft=xt.default.add5L(Ze,tt,st,Tz[Ne],Rl[Ne]),hn=xt.default.add5H(ft,_e,it,et,Ez[Ne],Nl[Ne]),re=ft|0,se=xt.default.rotrSH(L,$,28)^xt.default.rotrBH(L,$,34)^xt.default.rotrBH(L,$,39),ee=xt.default.rotrSL(L,$,28)^xt.default.rotrBL(L,$,34)^xt.default.rotrBL(L,$,39),fe=L&U^L&j^U&j,be=$&G^$&ue^G&ue;_e=pe|0,Ze=Se|0,pe=Q|0,Se=ae|0,Q=ge|0,ae=q|0,{h:ge,l:q}=xt.default.add(ye|0,de|0,hn|0,re|0),ye=j|0,de=ue|0,j=U|0,ue=G|0,U=L|0,G=$|0;const Me=xt.default.add3L(re,ee,be);L=xt.default.add3H(Me,hn,se,fe),$=Me|0}({h:L,l:$}=xt.default.add(this.Ah|0,this.Al|0,L|0,$|0)),{h:U,l:G}=xt.default.add(this.Bh|0,this.Bl|0,U|0,G|0),{h:j,l:ue}=xt.default.add(this.Ch|0,this.Cl|0,j|0,ue|0),{h:ye,l:de}=xt.default.add(this.Dh|0,this.Dl|0,ye|0,de|0),{h:ge,l:q}=xt.default.add(this.Eh|0,this.El|0,ge|0,q|0),{h:Q,l:ae}=xt.default.add(this.Fh|0,this.Fl|0,Q|0,ae|0),{h:pe,l:Se}=xt.default.add(this.Gh|0,this.Gl|0,pe|0,Se|0),{h:_e,l:Ze}=xt.default.add(this.Hh|0,this.Hl|0,_e|0,Ze|0),this.set(L,$,U,G,j,ue,ye,de,ge,q,Q,ae,pe,Se,_e,Ze)}roundClean(){Nl.fill(0),Rl.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}Si.SHA512=Ih;class Cz extends Ih{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class _z extends Ih{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class Az extends Ih{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}Si.sha512=(0,Je.wrapConstructor)(()=>new Ih),Si.sha512_224=(0,Je.wrapConstructor)(()=>new Cz),Si.sha512_256=(0,Je.wrapConstructor)(()=>new _z),Si.sha384=(0,Je.wrapConstructor)(()=>new Az);const Pz=v=>v[0]==="ãããããã";function a_(v){if(typeof v!="string")throw new TypeError(`Invalid mnemonic type: ${typeof v}`);return v.normalize("NFKD")}function sv(v){const w=a_(v),A=w.split(" ");if(![12,15,18,21,24].includes(A.length))throw new Error("Invalid mnemonic");return{nfkd:w,words:A}}function l_(v){Zt.default.bytes(v,16,20,24,28,32)}function Iz(v,w=128){if(Zt.default.number(w),w%32!==0||w>256)throw new TypeError("Invalid entropy");return d_((0,Je.randomBytes)(w/8),v)}Jr.generateMnemonic=Iz;const Oz=v=>{const w=8-v.length/4;return new Uint8Array([(0,Nr.sha256)(v)[0]>>w<<w])};function c_(v){if(!Array.isArray(v)||v.length!==2048||typeof v[0]!="string")throw new Error("Worlist: expected array of 2048 strings");return v.forEach(w=>{if(typeof w!="string")throw new Error(`Wordlist: non-string element: ${w}`)}),Ed.chain(Ed.checksum(1,Oz),Ed.radix2(11,!0),Ed.alphabet(v))}function u_(v,w){const{words:A}=sv(v),L=c_(w).decode(A);return l_(L),L}Jr.mnemonicToEntropy=u_;function d_(v,w){return l_(v),c_(w).encode(v).join(Pz(w)?"ã":" ")}Jr.entropyToMnemonic=d_;function Mz(v,w){try{u_(v,w)}catch{return!1}return!0}Jr.validateMnemonic=Mz;const f_=v=>a_(`mnemonic${v}`);function Nz(v,w=""){return(0,ou.pbkdf2Async)(Si.sha512,sv(v).nfkd,f_(w),{c:2048,dkLen:64})}Jr.mnemonicToSeed=Nz;function Rz(v,w=""){return(0,ou.pbkdf2)(Si.sha512,sv(v).nfkd,f_(w),{c:2048,dkLen:64})}Jr.mnemonicToSeedSync=Rz;var Td={};Object.defineProperty(Td,"__esModule",{value:!0}),Td.ripemd160=Td.RIPEMD160=void 0;const Dz=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),h_=Uint8Array.from({length:16},(v,w)=>w),Lz=h_.map(v=>(9*v+5)%16);let ov=[h_],av=[Lz];for(let v=0;v<4;v++)for(let w of[ov,av])w.push(w[v].map(A=>Dz[A]));const p_=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(v=>new Uint8Array(v)),Bz=ov.map((v,w)=>v.map(A=>p_[w][A])),Fz=av.map((v,w)=>v.map(A=>p_[w][A])),$z=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),zz=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),fg=(v,w)=>v<<w|v>>>32-w;function m_(v,w,A,L){return v===0?w^A^L:v===1?w&A|~w&L:v===2?(w|~A)^L:v===3?w&L|A&~L:w^(A|~L)}const hg=new Uint32Array(16);class g_ extends da.SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:w,h1:A,h2:L,h3:$,h4:U}=this;return[w,A,L,$,U]}set(w,A,L,$,U){this.h0=w|0,this.h1=A|0,this.h2=L|0,this.h3=$|0,this.h4=U|0}process(w,A){for(let Q=0;Q<16;Q++,A+=4)hg[Q]=w.getUint32(A,!0);let L=this.h0|0,$=L,U=this.h1|0,G=U,j=this.h2|0,ue=j,ye=this.h3|0,de=ye,ge=this.h4|0,q=ge;for(let Q=0;Q<5;Q++){const ae=4-Q,pe=$z[Q],Se=zz[Q],_e=ov[Q],Ze=av[Q],Ne=Bz[Q],it=Fz[Q];for(let tt=0;tt<16;tt++){const et=fg(L+m_(Q,U,j,ye)+hg[_e[tt]]+pe,Ne[tt])+ge|0;L=ge,ge=ye,ye=fg(j,10)|0,j=U,U=et}for(let tt=0;tt<16;tt++){const et=fg($+m_(ae,G,ue,de)+hg[Ze[tt]]+Se,it[tt])+q|0;$=q,q=de,de=fg(ue,10)|0,ue=G,G=et}}this.set(this.h1+j+de|0,this.h2+ye+q|0,this.h3+ge+$|0,this.h4+L+G|0,this.h0+U+ue|0)}roundClean(){hg.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}Td.RIPEMD160=g_,Td.ripemd160=(0,Je.wrapConstructor)(()=>new g_),It.hmacSha256Sync=(v,...w)=>(0,ma.hmac)(Nr.sha256,v,It.concatBytes(...w));const lv=Y$(Nr.sha256);function y_(v){return BigInt(`0x${(0,Je.bytesToHex)(v)}`)}function Uz(v){return(0,Je.hexToBytes)(v.toString(16).padStart(64,"0"))}const Hz=(0,Je.utf8ToBytes)("Bitcoin seed"),cv={private:76066276,public:76067358},uv=2147483648,Vz=v=>(0,Td.ripemd160)((0,Nr.sha256)(v)),Wz=v=>(0,Je.createView)(v).getUint32(0,!1),pg=v=>{if(!Number.isSafeInteger(v)||v<0||v>2**32-1)throw new Error(`Invalid number=${v}. Should be from 0 to 2 ** 32 - 1`);const w=new Uint8Array(4);return(0,Je.createView)(w).setUint32(0,v,!1),w};class au{constructor(w){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!w||typeof w!="object")throw new Error("HDKey.constructor must not be called directly");if(this.versions=w.versions||cv,this.depth=w.depth||0,this.chainCode=w.chainCode,this.index=w.index||0,this.parentFingerprint=w.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(w.publicKey&&w.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(w.privateKey){if(!It.isValidPrivateKey(w.privateKey))throw new Error("Invalid private key");this.privKey=typeof w.privateKey=="bigint"?w.privateKey:y_(w.privateKey),this.privKeyBytes=Uz(this.privKey),this.pubKey=Tt(w.privateKey,!0)}else if(w.publicKey)this.pubKey=O.fromHex(w.publicKey).toRawBytes(!0);else throw new Error("HDKey: no public or private key provided");this.pubHash=Vz(this.pubKey)}get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return Wz(this.pubHash)}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const w=this.privateKey;if(!w)throw new Error("No private key");return lv.encode(this.serialize(this.versions.private,(0,Je.concatBytes)(new Uint8Array([0]),w)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return lv.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(w,A=cv){if((0,Zt.bytes)(w),8*w.length<128||8*w.length>512)throw new Error(`HDKey: wrong seed length=${w.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const L=(0,ma.hmac)(Si.sha512,Hz,w);return new au({versions:A,chainCode:L.slice(32),privateKey:L.slice(0,32)})}static fromExtendedKey(w,A=cv){const L=lv.decode(w),$=(0,Je.createView)(L),U=$.getUint32(0,!1),G={versions:A,depth:L[4],parentFingerprint:$.getUint32(5,!1),index:$.getUint32(9,!1),chainCode:L.slice(13,45)},j=L.slice(45),ue=j[0]===0;if(U!==A[ue?"private":"public"])throw new Error("Version mismatch");return ue?new au({...G,privateKey:j.slice(1)}):new au({...G,publicKey:j})}static fromJSON(w){return au.fromExtendedKey(w.xpriv)}derive(w){if(!/^[mM]'?/.test(w))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(w))return this;const A=w.replace(/^[mM]'?\//,"").split("/");let L=this;for(const $ of A){const U=/^(\d+)('?)$/.exec($);if(!U||U.length!==3)throw new Error(`Invalid child index: ${$}`);let G=+U[1];if(!Number.isSafeInteger(G)||G>=uv)throw new Error("Invalid index");U[2]==="'"&&(G+=uv),L=L.deriveChild(G)}return L}deriveChild(w){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let A=pg(w);if(w>=uv){const j=this.privateKey;if(!j)throw new Error("Could not derive hardened child key");A=(0,Je.concatBytes)(new Uint8Array([0]),j,A)}else A=(0,Je.concatBytes)(this.pubKey,A);const L=(0,ma.hmac)(Si.sha512,this.chainCode,A),$=y_(L.slice(0,32)),U=L.slice(32);if(!It.isValidPrivateKey($))throw new Error("Tweak bigger than curve order");const G={versions:this.versions,chainCode:U,depth:this.depth+1,parentFingerprint:this.fingerprint,index:w};try{if(this.privateKey){const j=It.mod(this.privKey+$,f.n);if(!It.isValidPrivateKey(j))throw new Error("The tweak was out of range or the resulted private key is invalid");G.privateKey=j}else{const j=O.fromHex(this.pubKey).add(O.fromPrivateKey($));if(j.equals(O.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");G.publicKey=j.toRawBytes(!0)}return new au(G)}catch{return this.deriveChild(w+1)}}sign(w){if(!this.privateKey)throw new Error("No privateKey set!");return(0,Zt.bytes)(w,32),tn(w,this.privKey,{canonical:!0,der:!1})}verify(w,A){if((0,Zt.bytes)(w,32),(0,Zt.bytes)(A,64),!this.publicKey)throw new Error("No publicKey set!");let L;try{L=N.fromCompact(A)}catch{return!1}return Nn(L,w,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(w,A){if(!this.chainCode)throw new Error("No chainCode set");return(0,Zt.bytes)(A,33),(0,Je.concatBytes)(pg(w),new Uint8Array([this.depth]),pg(this.parentFingerprint),pg(this.index),this.chainCode,A)}}var jz=Object.defineProperty,Fi=(v,w)=>{for(var A in w)jz(v,A,{get:w[A],enumerable:!0})};function qz(){return It.bytesToHex(It.randomPrivateKey())}function b_(v){return It.bytesToHex(yi.getPublicKey(v))}var Kz={};Fi(Kz,{insertEventIntoAscendingList:()=>Zz,insertEventIntoDescendingList:()=>Gz,normalizeURL:()=>dv,utf8Decoder:()=>Dl,utf8Encoder:()=>bo});var Dl=new TextDecoder("utf-8"),bo=new TextEncoder;function dv(v){let w=new URL(v);return w.pathname=w.pathname.replace(/\/+/g,"/"),w.pathname.endsWith("/")&&(w.pathname=w.pathname.slice(0,-1)),(w.port==="80"&&w.protocol==="ws:"||w.port==="443"&&w.protocol==="wss:")&&(w.port=""),w.searchParams.sort(),w.hash="",w.toString()}function Gz(v,w){let A=0,L=v.length-1,$,U=A;if(L<0)U=0;else if(w.created_at<v[L].created_at)U=L+1;else if(w.created_at>=v[A].created_at)U=A;else for(;;){if(L<=A+1){U=L;break}if($=Math.floor(A+(L-A)/2),v[$].created_at>w.created_at)A=$;else if(v[$].created_at<w.created_at)L=$;else{U=$;break}}return v[U]?.id!==w.id?[...v.slice(0,U),w,...v.slice(U)]:v}function Zz(v,w){let A=0,L=v.length-1,$,U=A;if(L<0)U=0;else if(w.created_at>v[L].created_at)U=L+1;else if(w.created_at<=v[A].created_at)U=A;else for(;;){if(L<=A+1){U=L;break}if($=Math.floor(A+(L-A)/2),v[$].created_at<w.created_at)A=$;else if(v[$].created_at>w.created_at)L=$;else{U=$;break}}return v[U]?.id!==w.id?[...v.slice(0,U),w,...v.slice(U)]:v}function Xz(v,w){let A=v;return A.pubkey=b_(w),A.id=fv(A),A.sig=Jz(A,w),A}function Qz(v){if(!hv(v))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,v.pubkey,v.created_at,v.kind,v.tags,v.content])}function fv(v){let w=(0,Nr.sha256)(bo.encode(Qz(v)));return It.bytesToHex(w)}var Yz=v=>v instanceof Object;function hv(v){if(!Yz(v)||typeof v.kind!="number"||typeof v.content!="string"||typeof v.created_at!="number"||typeof v.pubkey!="string"||!v.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(v.tags))return!1;for(let w=0;w<v.tags.length;w++){let A=v.tags[w];if(!Array.isArray(A))return!1;for(let L=0;L<A.length;L++)if(typeof A[L]=="object")return!1}return!0}function w_(v){return yi.verifySync(v.sig,fv(v),v.pubkey)}function Jz(v,w){return It.bytesToHex(yi.signSync(fv(v),w))}function eU(v,w){if(v.ids&&v.ids.indexOf(w.id)===-1&&!v.ids.some(A=>w.id.startsWith(A))||v.kinds&&v.kinds.indexOf(w.kind)===-1||v.authors&&v.authors.indexOf(w.pubkey)===-1&&!v.authors.some(A=>w.pubkey.startsWith(A)))return!1;for(let A in v)if(A[0]==="#"){let L=A.slice(1),$=v[`#${L}`];if($&&!w.tags.find(([U,G])=>U===A.slice(1)&&$.indexOf(G)!==-1))return!1}return!(v.since&&w.created_at<v.since||v.until&&w.created_at>=v.until)}function tU(v,w){for(let A=0;A<v.length;A++)if(eU(v[A],w))return!0;return!1}var nU={};Fi(nU,{getHex64:()=>mg,getInt:()=>v_,getSubscriptionId:()=>x_,matchEventId:()=>rU,matchEventKind:()=>sU,matchEventPubkey:()=>iU});function mg(v,w){let A=w.length+3,L=v.indexOf(`"${w}":`)+A,$=v.slice(L).indexOf('"')+L+1;return v.slice($,$+64)}function v_(v,w){let A=w.length,L=v.indexOf(`"${w}":`)+A+3,$=v.slice(L),U=Math.min($.indexOf(","),$.indexOf("}"));return parseInt($.slice(0,U),10)}function x_(v){let w=v.slice(0,22).indexOf('"EVENT"');if(w===-1)return null;let A=v.slice(w+7+1).indexOf('"');if(A===-1)return null;let L=w+7+1+A,$=v.slice(L+1,80).indexOf('"');if($===-1)return null;let U=L+1+$;return v.slice(L+1,U)}function rU(v,w){return w===mg(v,"id")}function iU(v,w){return w===mg(v,"pubkey")}function sU(v,w){return w===v_(v,"kind")}var S_=()=>({connect:[],disconnect:[],error:[],notice:[],auth:[]});function oU(v,w={}){let{listTimeout:A=3e3,getTimeout:L=3e3,countTimeout:$=3e3}=w;var U,G={},j=S_(),ue={},ye={},de;async function ge(){return de||(de=new Promise((_e,Ze)=>{try{U=new WebSocket(v)}catch(et){Ze(et)}U.onopen=()=>{j.connect.forEach(et=>et()),_e()},U.onerror=()=>{de=void 0,j.error.forEach(et=>et()),Ze()},U.onclose=async()=>{de=void 0,j.disconnect.forEach(et=>et())};let Ne=[],it;U.onmessage=et=>{Ne.push(et.data),it||(it=setInterval(tt,0))};function tt(){if(Ne.length===0){clearInterval(it),it=null;return}var et=Ne.shift();if(!et)return;let st=x_(et);if(st){let ft=G[st];if(ft&&ft.alreadyHaveEvent&&ft.alreadyHaveEvent(mg(et,"id"),v))return}try{let ft=JSON.parse(et);switch(ft[0]){case"EVENT":{let ee=ft[1],fe=ft[2];hv(fe)&&G[ee]&&(G[ee].skipVerification||w_(fe))&&tU(G[ee].filters,fe)&&(G[ee],(ue[ee]?.event||[]).forEach(be=>be(fe)));return}case"COUNT":let hn=ft[1],re=ft[2];G[hn]&&(ue[hn]?.count||[]).forEach(ee=>ee(re));return;case"EOSE":{let ee=ft[1];ee in ue&&(ue[ee].eose.forEach(fe=>fe()),ue[ee].eose=[]);return}case"OK":{let ee=ft[1],fe=ft[2],be=ft[3]||"";ee in ye&&(fe?ye[ee].ok.forEach(Me=>Me()):ye[ee].failed.forEach(Me=>Me(be)),ye[ee].ok=[],ye[ee].failed=[]);return}case"NOTICE":let se=ft[1];j.notice.forEach(ee=>ee(se));return;case"AUTH":{let ee=ft[1];j.auth?.forEach(fe=>fe(ee));return}}}catch{return}}}),de)}function q(){return U?.readyState===1}async function Q(){q()||await ge()}async function ae(_e){let Ze=JSON.stringify(_e);if(!(!q()&&(await new Promise(Ne=>setTimeout(Ne,1e3)),!q())))try{U.send(Ze)}catch(Ne){console.log(Ne)}}const pe=(_e,{verb:Ze="REQ",skipVerification:Ne=!1,alreadyHaveEvent:it=null,id:tt=Math.random().toString().slice(2)}={})=>{let et=tt;return G[et]={id:et,filters:_e,skipVerification:Ne,alreadyHaveEvent:it},ae([Ze,et,..._e]),{sub:(st,ft={})=>pe(st||_e,{skipVerification:ft.skipVerification||Ne,alreadyHaveEvent:ft.alreadyHaveEvent||it,id:et}),unsub:()=>{delete G[et],delete ue[et],ae(["CLOSE",et])},on:(st,ft)=>{ue[et]=ue[et]||{event:[],count:[],eose:[]},ue[et][st].push(ft)},off:(st,ft)=>{let hn=ue[et],re=hn[st].indexOf(ft);re>=0&&hn[st].splice(re,1)}}};function Se(_e,Ze){if(!_e.id)throw new Error(`event ${_e} has no id`);let Ne=_e.id;return ae([Ze,_e]),{on:(it,tt)=>{ye[Ne]=ye[Ne]||{ok:[],failed:[]},ye[Ne][it].push(tt)},off:(it,tt)=>{let et=ye[Ne];if(!et)return;let st=et[it].indexOf(tt);st>=0&&et[it].splice(st,1)}}}return{url:v,sub:pe,on:(_e,Ze)=>{j[_e].push(Ze),_e==="connect"&&U?.readyState===1&&Ze()},off:(_e,Ze)=>{let Ne=j[_e].indexOf(Ze);Ne!==-1&&j[_e].splice(Ne,1)},list:(_e,Ze)=>new Promise(Ne=>{let it=pe(_e,Ze),tt=[],et=setTimeout(()=>{it.unsub(),Ne(tt)},A);it.on("eose",()=>{it.unsub(),clearTimeout(et),Ne(tt)}),it.on("event",st=>{tt.push(st)})}),get:(_e,Ze)=>new Promise(Ne=>{let it=pe([_e],Ze),tt=setTimeout(()=>{it.unsub(),Ne(null)},L);it.on("event",et=>{it.unsub(),clearTimeout(tt),Ne(et)})}),count:_e=>new Promise(Ze=>{let Ne=pe(_e,{...pe,verb:"COUNT"}),it=setTimeout(()=>{Ne.unsub(),Ze(null)},$);Ne.on("count",tt=>{Ne.unsub(),clearTimeout(it),Ze(tt)})}),publish(_e){return Se(_e,"EVENT")},auth(_e){return Se(_e,"AUTH")},connect:Q,close(){j=S_(),ue={},ye={},U.readyState===WebSocket.OPEN&&U?.close()},get status(){return U?.readyState??3}}}var k_=class{_conn;_seenOn={};eoseSubTimeout;getTimeout;constructor(v={}){this._conn={},this.eoseSubTimeout=v.eoseSubTimeout||3400,this.getTimeout=v.getTimeout||3400}close(v){v.forEach(w=>{let A=this._conn[dv(w)];A&&A.close()})}async ensureRelay(v){const w=dv(v);this._conn[w]||(this._conn[w]=oU(w,{getTimeout:this.getTimeout*.9,listTimeout:this.getTimeout*.9}));const A=this._conn[w];return await A.connect(),A}sub(v,w,A){let L=new Set,$={...A||{}};$.alreadyHaveEvent=(q,Q)=>{if(A?.alreadyHaveEvent?.(q,Q))return!0;let ae=this._seenOn[q]||new Set;return ae.add(Q),this._seenOn[q]=ae,L.has(q)};let U=[],G=new Set,j=new Set,ue=v.length,ye=!1,de=setTimeout(()=>{ye=!0;for(let q of j.values())q()},this.eoseSubTimeout);v.forEach(async q=>{let Q;try{Q=await this.ensureRelay(q)}catch{pe();return}if(!Q)return;let ae=Q.sub(w,$);ae.on("event",Se=>{L.add(Se.id);for(let _e of G.values())_e(Se)}),ae.on("eose",()=>{ye||pe()}),U.push(ae);function pe(){if(ue--,ue===0){clearTimeout(de);for(let Se of j.values())Se()}}});let ge={sub(q,Q){return U.forEach(ae=>ae.sub(q,Q)),ge},unsub(){U.forEach(q=>q.unsub())},on(q,Q){q==="event"?G.add(Q):q==="eose"&&j.add(Q)},off(q,Q){q==="event"?G.delete(Q):q==="eose"&&j.delete(Q)}};return ge}get(v,w,A){return new Promise(L=>{let $=this.sub(v,[w],A),U=setTimeout(()=>{$.unsub(),L(null)},this.getTimeout);$.on("event",G=>{L(G),clearTimeout(U),$.unsub()})})}list(v,w,A){return new Promise(L=>{let $=[],U=this.sub(v,w,A);U.on("event",G=>{$.push(G)}),U.on("eose",()=>{U.unsub(),L($)})})}publish(v,w){const A=v.map(async $=>{let U;try{return U=await this.ensureRelay($),U.publish(w)}catch{return{on(){},off(){}}}}),L=new Map;return{on($,U){v.forEach(async(G,j)=>{let ue=await A[j],ye=()=>U(G);L.set(U,ye),ue.on($,ye)})},off($,U){v.forEach(async(G,j)=>{let ue=L.get(U);ue&&(await A[j]).off($,ue)})}}}seenOn(v){return Array.from(this._seenOn[v]?.values?.()||[])}},pv={};Fi(pv,{decode:()=>gg,naddrEncode:()=>fU,neventEncode:()=>dU,noteEncode:()=>cU,nprofileEncode:()=>uU,npubEncode:()=>lU,nrelayEncode:()=>hU,nsecEncode:()=>aU});var Cd=5e3;function gg(v){let{prefix:w,words:A}=Bi.decode(v,Cd),L=new Uint8Array(Bi.fromWords(A));switch(w){case"nprofile":{let $=yg(L);if(!$[0]?.[0])throw new Error("missing TLV 0 for nprofile");if($[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:It.bytesToHex($[0][0]),relays:$[1]?$[1].map(U=>Dl.decode(U)):[]}}}case"nevent":{let $=yg(L);if(!$[0]?.[0])throw new Error("missing TLV 0 for nevent");if($[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if($[2]&&$[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");return{type:"nevent",data:{id:It.bytesToHex($[0][0]),relays:$[1]?$[1].map(U=>Dl.decode(U)):[],author:$[2]?.[0]?It.bytesToHex($[2][0]):void 0}}}case"naddr":{let $=yg(L);if(!$[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!$[2]?.[0])throw new Error("missing TLV 2 for naddr");if($[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!$[3]?.[0])throw new Error("missing TLV 3 for naddr");if($[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Dl.decode($[0][0]),pubkey:It.bytesToHex($[2][0]),kind:parseInt(It.bytesToHex($[3][0]),16),relays:$[1]?$[1].map(U=>Dl.decode(U)):[]}}}case"nrelay":{let $=yg(L);if(!$[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Dl.decode($[0][0])}}case"nsec":case"npub":case"note":return{type:w,data:It.bytesToHex(L)};default:throw new Error(`unknown prefix ${w}`)}}function yg(v){let w={},A=v;for(;A.length>0;){let L=A[0],$=A[1],U=A.slice(2,2+$);A=A.slice(2+$),!(U.length<$)&&(w[L]=w[L]||[],w[L].push(U))}return w}function aU(v){return mv("nsec",v)}function lU(v){return mv("npub",v)}function cU(v){return mv("note",v)}function mv(v,w){let A=It.hexToBytes(w),L=Bi.toWords(A);return Bi.encode(v,L,Cd)}function uU(v){let w=bg({0:[It.hexToBytes(v.pubkey)],1:(v.relays||[]).map(L=>bo.encode(L))}),A=Bi.toWords(w);return Bi.encode("nprofile",A,Cd)}function dU(v){let w=bg({0:[It.hexToBytes(v.id)],1:(v.relays||[]).map(L=>bo.encode(L)),2:v.author?[It.hexToBytes(v.author)]:[]}),A=Bi.toWords(w);return Bi.encode("nevent",A,Cd)}function fU(v){let w=new ArrayBuffer(4);new DataView(w).setUint32(0,v.kind,!1);let A=bg({0:[bo.encode(v.identifier)],1:(v.relays||[]).map($=>bo.encode($)),2:[It.hexToBytes(v.pubkey)],3:[new Uint8Array(w)]}),L=Bi.toWords(A);return Bi.encode("naddr",L,Cd)}function hU(v){let w=bg({0:[bo.encode(v)]}),A=Bi.toWords(w);return Bi.encode("nrelay",A,Cd)}function bg(v){let w=[];return Object.entries(v).forEach(([A,L])=>{L.forEach($=>{let U=new Uint8Array($.length+2);U.set([parseInt(A)],0),U.set([$.length],1),U.set($,2),w.push(U)})}),It.concatBytes(...w)}var pU={};Fi(pU,{decrypt:()=>gU,encrypt:()=>mU});async function mU(v,w,A){const L=He(v,"02"+w),$=E_(L);let U=Uint8Array.from((0,Je.randomBytes)(16)),G=bo.encode(A),j=await crypto.subtle.importKey("raw",$,{name:"AES-CBC"},!1,["encrypt"]),ue=await crypto.subtle.encrypt({name:"AES-CBC",iv:U},j,G),ye=_h.encode(new Uint8Array(ue)),de=_h.encode(new Uint8Array(U.buffer));return`${ye}?iv=${de}`}async function gU(v,w,A){let[L,$]=A.split("?iv="),U=He(v,"02"+w),G=E_(U),j=await crypto.subtle.importKey("raw",G,{name:"AES-CBC"},!1,["decrypt"]),ue=_h.decode(L),ye=_h.decode($),de=await crypto.subtle.decrypt({name:"AES-CBC",iv:ye},j,ue);return Dl.decode(de)}function E_(v){return v.slice(1,33)}var yU={};Fi(yU,{queryProfile:()=>vU,searchDomain:()=>wU,useFetchImplementation:()=>bU});var wg;try{wg=fetch}catch{}function bU(v){wg=v}async function wU(v,w=""){try{return(await(await wg(`https://${v}/.well-known/nostr.json?name=${w}`)).json()).names}catch{return{}}}async function vU(v){let[w,A]=v.split("@");if(A||(A=w,w="_"),!w.match(/^[A-Za-z0-9-_.]+$/)||!A.includes("."))return null;let L;try{L=await(await wg(`https://${A}/.well-known/nostr.json?name=${w}`)).json()}catch{return null}if(!L?.names?.[w])return null;let $=L.names[w],U=L.relays?.[$]||[];return{pubkey:$,relays:U}}var xU={};Fi(xU,{generateSeedWords:()=>kU,privateKeyFromSeedWords:()=>SU,validateWords:()=>EU});function SU(v,w){let L=au.fromMasterSeed((0,Jr.mnemonicToSeedSync)(v,w)).derive("m/44'/1237'/0'/0/0").privateKey;if(!L)throw new Error("could not derive private key");return It.bytesToHex(L)}function kU(){return(0,Jr.generateMnemonic)(Ph.wordlist)}function EU(v){return(0,Jr.validateMnemonic)(v,Ph.wordlist)}var TU={};Fi(TU,{parse:()=>CU});function CU(v){const w={reply:void 0,root:void 0,mentions:[],profiles:[]},A=[];for(const L of v.tags)L[0]==="e"&&L[1]&&A.push(L),L[0]==="p"&&L[1]&&w.profiles.push({pubkey:L[1],relays:L[2]?[L[2]]:[]});for(let L=0;L<A.length;L++){const $=A[L],[U,G,j,ue]=$,ye={id:G,relays:j?[j]:[]},de=L===0,ge=L===A.length-1;if(ue==="root"){w.root=ye;continue}if(ue==="reply"){w.reply=ye;continue}if(ue==="mention"){w.mentions.push(ye);continue}if(de){w.root=ye;continue}if(ge){w.reply=ye;continue}w.mentions.push(ye)}return w}var _U={};Fi(_U,{getPow:()=>AU});function AU(v){return PU(It.hexToBytes(v))}function PU(v){let w,A,L;for(A=0,w=0;A<v.length&&(L=IU(v[A]),w+=L,L===8);A++);return w}function IU(v){let w=0;if(v===0)return 8;for(;v>>=1;)w++;return 7-w}var OU={};Fi(OU,{BECH32_REGEX:()=>T_,NOSTR_URI_REGEX:()=>vg,parse:()=>NU,test:()=>MU});var T_=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/,vg=new RegExp(`nostr:(${T_.source})`);function MU(v){return typeof v=="string"&&new RegExp(`^${vg.source}$`).test(v)}function NU(v){const w=v.match(new RegExp(`^${vg.source}$`));if(!w)throw new Error(`Invalid Nostr URI: ${v}`);return{uri:w[0],value:w[1],decoded:gg(w[1])}}var RU={};Fi(RU,{createDelegation:()=>DU,getDelegator:()=>LU});function DU(v,w){let A=[];(w.kind||-1)>=0&&A.push(`kind=${w.kind}`),w.until&&A.push(`created_at<${w.until}`),w.since&&A.push(`created_at>${w.since}`);let L=A.join("&");if(L==="")throw new Error("refusing to create a delegation without any conditions");let $=(0,Nr.sha256)(bo.encode(`nostr:delegation:${w.pubkey}:${L}`)),U=It.bytesToHex(yi.signSync($,v));return{from:b_(v),to:w.pubkey,cond:L,sig:U}}function LU(v){let w=v.tags.find(j=>j[0]==="delegation"&&j.length>=4);if(!w)return null;let A=w[1],L=w[2],$=w[3],U=L.split("&");for(let j=0;j<U.length;j++){let[ue,ye,de]=U[j].split(/\b/);if(!(ue==="kind"&&ye==="="&&v.kind===parseInt(de))){if(ue==="created_at"&&ye==="<"&&v.created_at<parseInt(de))continue;if(ue==="created_at"&&ye===">"&&v.created_at>parseInt(de))continue;return null}}let G=(0,Nr.sha256)(bo.encode(`nostr:delegation:${v.pubkey}:${L}`));return yi.verifySync($,G,A)?A:null}var BU={};Fi(BU,{matchAll:()=>FU,regex:()=>gv,replaceAll:()=>$U});var gv=()=>new RegExp(`\\b${vg.source}\\b`,"g");function*FU(v){const w=v.matchAll(gv());for(const A of w){const[L,$]=A;yield{uri:L,value:$,decoded:gg($),start:A.index,end:A.index+L.length}}}function $U(v,w){return v.replaceAll(gv(),(A,L)=>w({uri:A,value:L,decoded:gg(L)}))}var zU={};Fi(zU,{useFetchImplementation:()=>UU,validateGithub:()=>HU});var yv;try{yv=fetch}catch{}function UU(v){yv=v}async function HU(v,w,A){try{return await(await yv(`https://gist.github.com/${w}/${A}/raw`)).text()===`Verifying that I control the following Nostr public key: ${v}`}catch{return!1}}var VU={};Fi(VU,{authenticate:()=>WU});var WU=async({challenge:v,relay:w,sign:A})=>{const L={kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",w.url],["challenge",v]],content:""},$=w.auth(await A(L));return new Promise((U,G)=>{$.on("ok",function j(){$.off("ok",j),U()}),$.on("failed",function j(ue){$.off("failed",j),G(ue)})})},bv={};Fi(bv,{getZapEndpoint:()=>qU,makeZapReceipt:()=>ZU,makeZapRequest:()=>KU,useFetchImplementation:()=>jU,validateZapRequest:()=>GU});var wv;try{wv=fetch}catch{}function jU(v){wv=v}async function qU(v){try{let w="",{lud06:A,lud16:L}=JSON.parse(v.content);if(A){let{words:G}=Bi.decode(A,1e3),j=Bi.fromWords(G);w=Dl.decode(j)}else if(L){let[G,j]=L.split("@");w=`https://${j}/.well-known/lnurlp/${G}`}else return null;let U=await(await wv(w)).json();if(U.allowsNostr&&U.nostrPubkey)return U.callback}catch{}return null}function KU({profile:v,event:w,amount:A,relays:L,comment:$=""}){if(!A)throw new Error("amount not given");if(!v)throw new Error("profile not given");let U={kind:9734,created_at:Math.round(Date.now()/1e3),content:$,tags:[["p",v],["amount",A.toString()],["relays",...L]]};return w&&U.tags.push(["e",w]),U}function GU(v){let w;try{w=JSON.parse(v)}catch{return"Invalid zap request JSON."}if(!hv(w))return"Zap request is not a valid Nostr event.";if(!w_(w))return"Invalid signature on zap request.";let A=w.tags.find(([U,G])=>U==="p"&&G);if(!A)return"Zap request doesn't have a 'p' tag.";if(!A[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let L=w.tags.find(([U,G])=>U==="e"&&G);return L&&!L[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":w.tags.find(([U,G])=>U==="relays"&&G)?null:"Zap request doesn't have a 'relays' tag."}function ZU({zapRequest:v,preimage:w,bolt11:A,paidAt:L}){let U=JSON.parse(v).tags.filter(([j])=>j==="e"||j==="p"||j==="a"),G={kind:9735,created_at:Math.round(L.getTime()/1e3),content:"",tags:[...U,["bolt11",A],["description",v]]};return w&&G.tags.push(["preimage",w]),G}It.hmacSha256Sync=(v,...w)=>(0,ma.hmac)(Nr.sha256,v,It.concatBytes(...w)),It.sha256Sync=(...v)=>(0,Nr.sha256)(It.concatBytes(...v));const XU=v=>pv.decode(v).data,C_=v=>pv.decode(v).data;let __={};const QU=async v=>{if(__[v])return __[v];const w=new k_,A=["wss://relay.nostr.band","wss://purplepag.es","wss://relay.damus.io","wss://nostr.wine"];try{return await w.get(A,{authors:[v],kinds:[0]})}catch{throw new Error("failed to fetch user profile :(")}finally{w.close(A)}},YU=v=>JSON.parse(v.content),JU=async v=>{const w=await bv.getZapEndpoint(v);if(!w)throw new Error("failed to retrieve zap endpoint :(");return w},e7=async(v,w)=>{if(A_()&&!w)try{return await window.nostr.signEvent(v)}catch{}return Xz(v,qz())},t7=async({profile:v,nip19Target:w,amount:A,relays:L,comment:$,anon:U})=>{const G=bv.makeZapRequest({profile:v,event:w&&w.startsWith("note")?C_(w):void 0,amount:A,relays:L,comment:$}),j=w&&w.startsWith("naddr")?C_(w):void 0;if(j){const ue=j.relays?j.relays.reduce((ye,de)=>`${de},${ye}`,""):"";G.tags.push(["a",`${j.kind}:${j.pubkey}:${j.identifier}`,ue])}return(!A_()||U)&&G.tags.push(["anon"]),e7(G,U)},n7=async({zapEndpoint:v,amount:w,comment:A,authorId:L,nip19Target:$,normalizedRelays:U,anon:G})=>{const j=await t7({profile:L,nip19Target:$,amount:w,relays:U,comment:A,anon:G});let ue=`${v}?amount=${w}&nostr=${encodeURIComponent(JSON.stringify(j))}`;A&&(ue=`${ue}&comment=${encodeURIComponent(A)}`);const ye=await fetch(ue),{pr:de,reason:ge,status:q}=await ye.json();if(de)return de;throw q==="ERROR"?new Error(ge??"Unable to fetch invoice"):new Error("Unable to fetch invoice")},A_=()=>window!==void 0&&window.nostr!==void 0,r7=({relays:v,invoice:w,onSuccess:A})=>{const L=new k_,$=Array.from(new Set([...v,"wss://relay.nostr.band"])),U=()=>{L&&L.close($)},G=Math.round(Date.now()/1e3),j=setInterval(()=>{L.sub($,[{kinds:[9735],since:G}]).on("event",ye=>{ye.tags.find(de=>de[0]==="bolt11"&&de[1]===w)&&(A(),U(),clearInterval(j))})},5e3);return()=>{U(),clearInterval(j)}},P_="nostrZap.",I_="lightningUri",O_=()=>typeof localStorage<"u",i7=v=>{if(O_())return localStorage.getItem(`${P_}${v}`)},s7=(v,w)=>{O_()&&localStorage.setItem(`${P_}${v}`,w)},o7=()=>i7(I_),a7=v=>s7(I_,v);let vv=null;const l7=v=>{v=v.replace(/^#/,""),v.length===3&&(v=v.split("").map(U=>U+U).join(""));const w=parseInt(v,16),A=w>>16&255,L=w>>8&255,$=w&255;return{r:A,g:L,b:$}},c7=({r:v,g:w,b:A})=>(v*299+w*587+A*114)/1e3,M_=v=>{const w=l7(v);return c7(w)<128?"#fff":"#000"},xv=v=>{const w=document.createElement("dialog");return w.classList.add("nostr-zap-dialog"),w.innerHTML=v,w.addEventListener("click",function({clientX:A,clientY:L}){const{left:$,right:U,top:G,bottom:j}=w.getBoundingClientRect();A===0&&L===0||(A<$||A>U||L<G||L>j)&&w.close()}),vv.appendChild(w),w},u7=({dialogHeader:v,invoice:w,relays:A,buttonColor:L})=>{const $=o7(),G=xv(`
        <button class="close-button">X</button>
        ${v}
        <div class="qrcode">
          <div class="overlay">copied invoice to clipboard</div>
        </div>
        <p>click QR code to copy invoice</p>
        <select name="lightning-wallet">
          ${[{label:"Default Wallet",value:"lightning:"},{label:"Strike",value:"strike:lightning:"},{label:"Cash App",value:"https://cash.app/launch/lightning/"},{label:"Muun",value:"muun:"},{label:"Blue Wallet",value:"bluewallet:lightning:"},{label:"Wallet of Satoshi",value:"walletofsatoshi:lightning:"},{label:"Zebedee",value:"zebedee:lightning:"},{label:"Zeus LN",value:"zeusln:lightning:"},{label:"Phoenix",value:"phoenix://"},{label:"Breez",value:"breez:"},{label:"Bitcoin Beach",value:"bitcoinbeach://"},{label:"Blixt",value:"blixtwallet:lightning:"},{label:"River",value:"river://"}].map(({label:q,value:Q})=>`<option value="${Q}" ${$===Q?"selected":""}>${q}</option>`).join("")}
        </select>
        <button class="cta-button"
          ${L?`style="background-color: ${L}; color: ${M_(L)}"`:""} 
        >Open Wallet</button>
      `),j=G.querySelector(".qrcode"),ue=G.querySelector('select[name="lightning-wallet"]'),ye=G.querySelector(".cta-button"),de=j.querySelector(".overlay"),ge=r7({relays:A,invoice:w,onSuccess:()=>{G.close()}});return new(e(s))(j,{text:w,quietZone:10}),j.addEventListener("click",function(){navigator.clipboard.writeText(w),de.classList.add("show"),setTimeout(()=>de.classList.remove("show"),2e3)}),ye.addEventListener("click",function(){a7(ue.value),window.location.href=`${ue.value}${w}`}),G.addEventListener("close",function(){ge(),G.remove()}),G.querySelector(".close-button").addEventListener("click",function(){G.close()}),G},d7=async({npub:v,nip19Target:w,relays:A,buttonColor:L,anon:$})=>{const U=st=>`${st.substring(0,12)}...${st.substring(st.length-12)}`,G=A?A.split(","):["wss://relay.nostr.band","wss://relay.damus.io","wss://nos.lol"],j=XU(v),ue=QU(j),ye="https://pbs.twimg.com/profile_images/1604195803748306944/LxHDoJ7P_400x400.jpg",de=async()=>{const{picture:st,display_name:ft,name:hn}=YU(await ue);return`
      <h2>${ft||hn}</h2>
        <img
          src="${st||ye}"
          width="80"
          height="80"
          alt="nostr user avatar"
        />
      <p>${U(w||v)}</p>
    `},ge=xv(`
      <button class="close-button">X</button>
      <div class="dialog-header-container">
        <h2 class="skeleton-placeholder"></h2>
          <img
            src="${ye}"
            width="80"
            height="80"
            alt="placeholder avatar"
          />
        <p class="skeleton-placeholder"></p>
      </div>
      <div class="preset-zap-options-container">
        <button data-value="21">21 â¡ï¸</button>
        <button data-value="69">69 â¡ï¸</button>
        <button data-value="420">420 â¡ï¸</button>
        <button data-value="1337">1337 â¡ï¸</button>
        <button data-value="5000">5k â¡ï¸</button>
        <button data-value="10000">10k â¡ï¸</button>
        <button data-value="21000">21k â¡ï¸</button>
        <button data-value="1000000">1M â¡ï¸</button>
      </div>
      <form>
        <input name="amount" type="number" placeholder="amount in sats" required />
        <input name="comment" placeholder="optional comment" />
        <button class="cta-button" 
          ${L?`style="background-color: ${L}; color: ${M_(L)}"`:""} 
          type="submit" disabled>Zap</button>
      </form>
    `),q=ge.querySelector(".preset-zap-options-container"),Q=ge.querySelector("form"),ae=ge.querySelector('input[name="amount"]'),pe=ge.querySelector('input[name="comment"]'),Se=ge.querySelector('button[type="submit"]'),_e=ge.querySelector(".dialog-header-container"),Ze=st=>{ge.close(),N_(st,v).showModal()};de().then(st=>{_e.innerHTML=st,Se.disabled=!1}).catch(Ze);const Ne=()=>{Se.disabled=!0,Se.innerHTML='<div class="spinner">Loading</div>'},it=()=>{Se.disabled=!1,Se.innerHTML="Zap"},tt=st=>{ae.value=st};ge.addEventListener("close",function(){it(),Q.reset()}),ge.querySelector(".close-button").addEventListener("click",function(){ge.close()}),q.addEventListener("click",function(st){st.target.matches("button")&&(tt(st.target.getAttribute("data-value")),ae.focus())});const et=ue.then(JU);return Q.addEventListener("submit",async function(st){st.preventDefault(),Ne();const ft=Number(ae.value)*1e3,hn=pe.value;try{const re=await n7({zapEndpoint:await et,amount:ft,comment:hn,authorId:j,nip19Target:w,normalizedRelays:G,anon:$}),se=async()=>{const ee=u7({dialogHeader:await de(),invoice:re,relays:G,buttonColor:L}),fe=ee.querySelector(".cta-button");ge.close(),ee.showModal(),fe.focus()};if(window.webln)try{await window.webln.enable(),await window.webln.sendPayment(re),ge.close()}catch{se()}else se()}catch(re){Ze(re)}}),ge},N_=(v,w)=>{const A=xv(`
    <button class="close-button">X</button>
    <p class="error-message">${v}</p>
    <a href="https://nosta.me/${w}" target="_blank">
      <button class="cta-button">View Nostr Profile</button>
    </a>
  `);return A.addEventListener("close",function(){A.remove()}),A.querySelector(".close-button").addEventListener("click",function(){A.close()}),A},R_=async({npub:v,noteId:w,naddr:A,relays:L,cachedAmountDialog:$,buttonColor:U,anon:G})=>{let j=$;try{return j||(j=await d7({npub:v,nip19Target:A||w,relays:L,buttonColor:U,anon:G})),j.showModal(),window.matchMedia("(max-height: 932px)").matches||j.querySelector('input[name="amount"]').focus(),j}catch(ue){j&&j.close(),N_(ue,v).showModal()}},D_=v=>{let w=null,A=null;v.addEventListener("click",async function(){const L=v.getAttribute("data-npub"),$=v.getAttribute("data-note-id"),U=v.getAttribute("data-naddr"),G=v.getAttribute("data-relays"),j=v.getAttribute("data-button-color"),ue=v.getAttribute("data-anon")==="true";A&&(A.npub!==L||A.noteId!==$||A.naddr!==U||A.relays!==G||A.buttonColor!==j||A.anon!==ue)&&(w=null),A={npub:L,noteId:$,naddr:U,relays:G,buttonColor:j,anon:ue},w=await R_({npub:L,noteId:$,naddr:U,relays:G,cachedAmountDialog:w,buttonColor:j,anon:ue})})},L_=v=>{document.querySelectorAll(v||"[data-npub]").forEach(D_)};return(()=>{const v=document.createElement("style");v.innerHTML=`
      .nostr-zap-dialog {
        width: 424px;
        min-width: 376px;
        margin: auto;
        box-sizing: content-box;
        border: none;
        border-radius: 10px;
        padding: 36px;
        text-align: center;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        background-color: white;
      }
      .nostr-zap-dialog[open],
      .nostr-zap-dialog form {
        display: block;
        max-width: fit-content;
      }
      .nostr-zap-dialog form {
        padding: 0;
        width: 100%;
      }
      .nostr-zap-dialog img {
        display: inline;
        border-radius: 50%;
      }
      .nostr-zap-dialog h2 {
        font-size: 1.5em;
        font-weight: bold;
        color: black;
      }
      .nostr-zap-dialog p {
        font-size: 1em;
        font-weight: normal;
        color: black;
      }
      .nostr-zap-dialog h2,
      .nostr-zap-dialog p,
      .nostr-zap-dialog .skeleton-placeholder {
        margin: 4px;
        word-wrap: break-word;
      }
      .nostr-zap-dialog button {
        background-color: inherit;
        padding: 12px 0;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        cursor: pointer;
        border: 1px solid rgb(226, 232, 240);
        width: 100px;
        max-width: 100px;
        max-height: 52px;
        white-space: nowrap;
        color: black;
        box-sizing: border-box;
      }
      .nostr-zap-dialog button:hover {
        background-color: #edf2f7;
      }
      .nostr-zap-dialog button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .nostr-zap-dialog .cta-button {
        background-color: #7f00ff;
        color: #fff;
        width: 100%;
        max-width: 100%;
        margin-top: 16px;
      }
      .nostr-zap-dialog .cta-button:hover {
        background-color: indigo;
      }
      .nostr-zap-dialog .close-button {
        background-color: inherit;
        color: black;
        border-radius: 50%;
        width: 42px;
        height: 42px;
        position: absolute;
        top: 8px;
        right: 8px;
        padding: 12px;
        border: none;
      }
      .nostr-zap-dialog .preset-zap-options-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        margin: 24px 0 8px 0;
        height: 120px;
      }
      .nostr-zap-dialog input {
        padding: 12px;
        border-radius: 5px;
        border: none;
        font-size: 16px;
        width: 100%;
        max-width: 100%;
        background-color: #f7fafc;
        color: #1a202c;
        box-shadow: none;
        box-sizing: border-box;
        margin-bottom: 16px;
        border: 1px solid lightgray;
      }
      .nostr-zap-dialog .spinner {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .nostr-zap-dialog .spinner:after {
        content: " ";
        display: block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 4px solid #fff;
        border-color: #fff transparent #fff transparent;
        animation: nostr-zap-dialog-spinner 1.2s linear infinite;
        margin-left: 8px;
      }
      .nostr-zap-dialog .error-message {
        text-align: left;
        color: red;
        margin-top: 8px;
      }
      .nostr-zap-dialog .qrcode {
        position: relative;
        display: inline-block;
        margin-top: 24px;
      }
      .nostr-zap-dialog .qrcode .overlay {
        position: absolute;
        color: white;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(127, 17, 224, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
      }
      .nostr-zap-dialog .qrcode .overlay.show {
        opacity: 1;
      }
      @keyframes nostr-zap-dialog-spinner {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @keyframes nostr-zap-dialog-skeleton-pulse {
        0% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.8;
        }
        100% {
          opacity: 0.6;
        }
      }
      .nostr-zap-dialog .skeleton-placeholder {
        animation-name: nostr-zap-dialog-skeleton-pulse;
        animation-duration: 1.5s;
        animation-iteration-count: infinite;
        animation-timing-function: ease-in-out;
        background-color: #e8e8e8;
        border-radius: 4px;
        margin: 4px auto;
      }
      .nostr-zap-dialog p.skeleton-placeholder {
        height: 20px;
        width: 200px;
      }
      .nostr-zap-dialog h2.skeleton-placeholder {
        height: 28px;
        width: 300px;
      }
      .nostr-zap-dialog select[name="lightning-wallet"] {
        appearance: none;
        background-color: white;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%232D3748" width="24" height="24" viewBox="0 0 24 24"><path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z" /></svg>');
        background-repeat: no-repeat;
        background-position: right 0.7rem center;
        background-size: 16px;
        border: 1px solid #CBD5E0;
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border-radius: 0.25rem;
        width: 100%;
        margin-top: 24px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        cursor: pointer;
      }
      .nostr-zap-dialog select[name="lightning-wallet"]:focus {
        outline: none;
        border-color: #4FD1C5;
        box-shadow: 0 0 0 2px #4FD1C5;
      }
      @media only screen and (max-width: 480px) {
        .nostr-zap-dialog {
          padding: 18px;
        }

        .nostr-zap-dialog button {
          width: 92px;
          max-width: 92px;
        }
      }
      @media only screen and (max-width: 413px) {
        .nostr-zap-dialog {
          min-width: 324px;
        }
        .nostr-zap-dialog button {
          width: 78px;
          max-width: 78px;
        }
      }
  `;const w=document.createElement("div");document.body.appendChild(w),vv=w.attachShadow({mode:"open"}),vv.appendChild(v)})(),L_(),window.nostrZap={init:R_,initTarget:D_,initTargets:L_},i4}zwe();var Uwe=Ce('<div class="info-icon svg-icon svelte-24l4z1"></div>'),Hwe=Ce('<div class="popover-body svelte-24l4z1"><div class="popover-children svelte-24l4z1"><!></div></div>'),Vwe=Ce("<!> <!>",1);function nk(t,e){let n=le(e,"side",3,"top"),r=le(e,"sideOffset",3,0),i=le(e,"ariaLabel",3,"æå ±ãè¡¨ç¤º");var s=Ue(),o=Ee(s);Nt(o,()=>CZ,(a,l)=>{l(a,{children:(c,u)=>{var d=Vwe(),f=Ee(d);Nt(f,()=>vZ,(p,m)=>{m(p,{class:"info-trigger",get"aria-label"(){return i()},children:(g,y)=>{var b=Uwe();Y(g,b)},$$slots:{default:!0}})});var h=we(f,2);Nt(h,()=>Tc,(p,m)=>{m(p,{children:(g,y)=>{var b=Ue(),S=Ee(b);Nt(S,()=>bZ,(C,_)=>{_(C,{get side(){return n()},get sideOffset(){return r()},class:"popover-content",trapFocus:!1,onCloseAutoFocus:x=>x.preventDefault(),children:(x,I)=>{var k=Hwe(),T=ie(k),P=ie(T);_t(P,()=>e.children??Ft),Y(x,k)},$$slots:{default:!0}})}),Y(g,b)},$$slots:{default:!0}})}),Y(c,d)},$$slots:{default:!0}})}),Y(t,s)}var Wwe=Ce('<div class="xmark-icon svg-icon svelte-1koizbb" aria-label="éãã"></div>'),jwe=Ce('<div class="help-icon svg-icon" aria-label="Help"></div>'),qwe=Ce('<div class="github-icon svg-icon svelte-1koizbb" aria-label="GitHub"></div>'),Kwe=Ce('<div class="rotate-right-icon svg-icon svelte-1koizbb"></div> <span class="btn-text"> </span>',1),Gwe=Ce('<div class="setting-section sw-update-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label sw-update-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><!></div></div></div>'),Zwe=Ce('<div class="lang-icon-btn svg-icon svelte-1koizbb"></div> <span class="btn-text"> </span>',1),Xwe=Ce('<table class="popover-table svelte-1koizbb"><thead class="svelte-1koizbb"><tr class="svelte-1koizbb"><th class="svelte-1koizbb"> </th><th class="svelte-1koizbb"> </th><th class="svelte-1koizbb"> </th></tr></thead><tbody class="svelte-1koizbb"><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr></tbody></table>'),Qwe=Ce('<div class="radio-pair svelte-1koizbb"></div>'),Ywe=Ce('<table class="popover-table svelte-1koizbb"><thead class="svelte-1koizbb"><tr class="svelte-1koizbb"><th class="svelte-1koizbb"> </th><th class="svelte-1koizbb"> </th></tr></thead><tbody class="svelte-1koizbb"><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr><tr class="svelte-1koizbb"><td class="svelte-1koizbb"> </td><td class="svelte-1koizbb"> </td></tr></tbody></table>'),Jwe=Ce('<div class="radio-pair svelte-1koizbb"></div>'),eve=Ce("<option> </option>"),tve=Ce('<div class="rotate-right-icon svg-icon svelte-1koizbb"></div> <span class="btn-text"> </span>',1),nve=Ce('<li class="svelte-1koizbb"> </li>'),rve=Ce('<ul class="svelte-1koizbb"></ul>'),ive=Ce('<span style="color: #888;"> </span>'),sve=Ce('<div class="relay-list svelte-1koizbb"><!></div>'),ove=Ce('<div class="settings-header svelte-1koizbb"><div class="first-row svelte-1koizbb"><div class="site-title svelte-1koizbb"><span class="site-name svelte-1koizbb">eHagaki</span> <span class="cache-version svelte-1koizbb"> </span></div> <div class="author-info svelte-1koizbb"><span> </span><a href="https://lokuyow.github.io/" target="_blank" class="svelte-1koizbb"> </a></div></div> <div class="second-row svelte-1koizbb"><!> <!> <div><div class="zap-view-btn-group svelte-1koizbb"><button class="zap-btn svelte-1koizbb" data-npub="npub1a3pvwe2p3v7mnjz6hle63r628wl9w567aw7u23fzqs062v5vqcqqu3sgh3" data-note-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-relays="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">Support</button> <span class="divider svelte-1koizbb"></span> <button class="view-btn svelte-1koizbb" data-title="Thanks for the Support!" data-nzv-id="naddr1qqxnzde4xsunzwpnxymrgwpsqgswcsk8v4qck0deepdtluag3a9rh0jh2d0wh0w9g53qg8a9x2xqvqqrqsqqql8kt67m30" data-zap-color-mode="true" data-relay-urls="wss://relay.nostr.band,wss://relay.damus.io,wss://nos.lol,wss://nostr.bitcoiner.social,wss://relay.nostr.wirednet.jp,wss://yabu.me">View</button></div></div></div></div> <div class="modal-body svelte-1koizbb"><!> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb">Language/è¨èª</span> <div class="setting-control svelte-1koizbb"><!></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><div class="setting-label-wrapper svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <!></div> <div class="setting-control radio-group svelte-1koizbb"></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><div class="setting-label-wrapper svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <!></div> <div class="setting-control radio-group svelte-1koizbb"></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><select class="svelte-1koizbb"></select></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><label class="toggle-switch svelte-1koizbb"><input type="checkbox" class="svelte-1koizbb"/> <span class="slider svelte-1koizbb"></span></label></div></div></div> <div class="setting-section svelte-1koizbb"><div class="setting-row svelte-1koizbb"><span class="setting-label svelte-1koizbb"> </span> <div class="setting-control svelte-1koizbb"><!></div></div> <div class="setting-info svelte-1koizbb"><button type="button" class="relay-toggle-label svelte-1koizbb" style="cursor:pointer; background:none; border:none; padding:0; font: inherit;"><span class="relay-toggle-icon svelte-1koizbb" aria-label="toggle"><!></span> </button> <!></div></div></div>',1);function ave(t,e){const n=sa();St(e,!0);const r=()=>Xn(or,"$_",o),i=()=>Xn(gs,"$locale",o),s=()=>Xn(ST,"$swNeedRefresh",o),[o,a]=hi();let l=le(e,"show",15,!1),c=le(e,"onRefreshRelaysAndProfile",3,()=>{}),u=le(e,"selectedCompression",3,"medium"),d=le(e,"onSelectedCompressionChange",3,void 0),f=le(e,"selectedEndpoint",3,""),h=le(e,"onSelectedEndpointChange",3,void 0),p=le(e,"onOpenWelcomeDialog",3,void 0);function m(){l(!1),e.onClose?.()}yh(()=>l(),m,!0);let g=oe(()=>Die(r())),y=oe(()=>Lie(r())),b=oe(()=>$I(E(g),2)),S=oe(()=>$I(E(y),2)),C=me(!0),_=me(""),x=me("medium"),I=me(""),k=me(!1);Ge(()=>{E(k)||(K(_,u()),K(I,f()))});let T=oe(()=>c5.value),P=oe(()=>Ip.value),O=oe(()=>V1.value),D=oe(()=>II.value);Ge(()=>{const M=u();M!==void 0&&M!==""&&K(_,M,!0)}),Ge(()=>{d()&&E(_)!==u()&&d()(E(_))}),Ge(()=>{const M=f();M!==void 0&&M!==""&&K(I,M,!0)}),Ge(()=>{h()&&E(I)!==f()&&h()(E(I))}),Ge(()=>{E(k)&&E(_)&&localStorage.setItem(Ci.IMAGE_COMPRESSION_LEVEL,E(_))}),Ge(()=>{E(k)&&E(x)&&localStorage.setItem(Ci.VIDEO_COMPRESSION_LEVEL,E(x))}),Ge(()=>{E(k)&&E(I)&&localStorage.setItem(Ci.UPLOAD_ENDPOINT,E(I))}),Ge(()=>{E(k)&&localStorage.setItem(Ci.CLIENT_TAG_ENABLED,E(C)?"true":"false")});function F(){Aoe(hse,M=>II.set(M),{timeout:Rie})}function B(){const M=_oe({selectedEndpoint:f(),selectedCompression:u()});K(I,M.endpoint,!0),K(C,M.clientTagEnabled,!0),K(_,M.compression,!0);const R=localStorage.getItem(Ci.VIDEO_COMPRESSION_LEVEL);R?R==="skip"?(K(x,"none"),localStorage.setItem(Ci.VIDEO_COMPRESSION_LEVEL,"none")):K(x,R,!0):(K(x,"medium"),localStorage.setItem(Ci.VIDEO_COMPRESSION_LEVEL,"medium")),K(k,!0)}bs(()=>{B(),pse(),Wr.value?.pubkey&&Wr.value?.isAuthenticated&&OI(Wr.value.pubkey)}),Ge(()=>{if(!l()){V1.set(!1);return}Wr.value?.pubkey&&Wr.value?.isAuthenticated&&OI(Wr.value.pubkey),(async()=>(await ul(),$we(),window.nostrZap?.initTargets()))()}),Ge(()=>{i()&&!localStorage.getItem(Ci.UPLOAD_ENDPOINT)&&K(I,wT(i()),!0)});function N(){gs.set(i()==="ja"?"en":"ja")}{const M=z=>{var V=Ue(),X=Ee(V);{const Z=(te,ne)=>{en(te,Qn(()=>ne?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(xe,Le)=>{var he=Wwe();Y(xe,he)},$$slots:{default:!0}}))};Nt(X,()=>dh,(te,ne)=>{ne(te,{child:Z,$$slots:{child:!0}})})}Y(z,V)};let R=oe(()=>r()("settings")||"è¨­å®"),H=oe(()=>r()("settingsDialog.image_quality_setting"));gh(t,{onOpenChange:z=>!z&&m(),get title(){return E(R)},get description(){return E(H)},contentClass:"settings-dialog",footerVariant:"close-button",get open(){return l()},set open(z){l(z)},footer:M,children:(z,V)=>{var X=ove(),Z=Ee(X),te=ie(Z),ne=ie(te),J=we(ie(ne),2),xe=ie(J),Le=we(ne,2),he=ie(Le),ke=ie(he),Be=we(he),je=ie(Be),Fe=we(te,2),ve=ie(Fe);en(ve,{shape:"circle",variant:"default",className:"help-btn",onClick:()=>{m(),p()?.()},ariaLabel:"Help",children:(Dt,Sn)=>{var rn=jwe();Y(Dt,rn)},$$slots:{default:!0}});var Ie=we(ve,2);en(Ie,{shape:"circle",variant:"default",className:"github-link-btn",onClick:()=>window.open("https://github.com/Lokuyow/ehagaki","_blank"),ariaLabel:"GitHub Repository",children:(Dt,Sn)=>{var rn=qwe();Y(Dt,rn)},$$slots:{default:!0}});var Oe=we(Z,2),qe=ie(Oe);{var Te=Dt=>{var Sn=Gwe(),rn=ie(Sn),In=ie(rn),mn=ie(In),On=we(In,2),_n=ie(On);{let Un=oe(()=>E(D)?"loading":""),Hn=oe(()=>r()("settingsDialog.update_app")||"ã¢ããªãæ´æ°");en(_n,{variant:"primary",shape:"rounded",get className(){return`sw-update-btn ${E(Un)??""}`},onClick:F,get disabled(){return E(D)},get ariaLabel(){return E(Hn)},children:(go,ha)=>{var pa=Ue(),Al=Ee(pa);{var Pl=Di=>{{let js=oe(()=>r()("settingsDialog.updating")||"æ´æ°ä¸­...");Nc(Di,{showLoader:!0,get text(){return E(js)}})}},iu=Di=>{var js=Kwe(),Il=Ee(js),su=we(Il,2),Ol=ie(su);Ke((Ml,wi)=>{wn(Il,"aria-label",Ml),Re(Ol,wi)},[()=>r()("settingsDialog.refresh")||"æ´æ°",()=>r()("settingsDialog.update_app")||"æ´æ°"]),Y(Di,js)};Ve(Al,Di=>{E(D)?Di(Pl):Di(iu,!1)})}Y(go,pa)},$$slots:{default:!0}})}Ke(Un=>Re(mn,Un),[()=>r()("settingsDialog.sw_update_available")||"ã¢ããªã®æ´æ°ãããã¾ã"]),Y(Dt,Sn)};Ve(qe,Dt=>{s()&&Dt(Te)})}var ze=we(qe,2),ot=ie(ze),ct=we(ie(ot),2),pt=ie(ct);en(pt,{variant:"default",shape:"rounded",className:"lang-btn",onClick:N,children:(Dt,Sn)=>{var rn=Zwe(),In=Ee(rn),mn=we(In,2),On=ie(mn);Ke((_n,Un)=>{wn(In,"aria-label",_n),Re(On,Un)},[()=>r()("settingsDialog.change")||"å¤æ´",()=>r()("settingsDialog.change")||"å¤æ´"]),Y(Dt,rn)},$$slots:{default:!0}});var $t=we(ze,2),Rt=ie($t),Tt=ie(Rt),Ot=ie(Tt),He=ie(Ot),ut=we(Ot,2);nk(ut,{side:"top",ariaLabel:"ç»åå§ç¸®è¨­å®ã®èª¬æ",children:(Dt,Sn)=>{var rn=Xwe(),In=ie(rn),mn=ie(In),On=ie(mn),_n=ie(On),Un=we(On),Hn=ie(Un),go=we(Un),ha=ie(go),pa=we(In),Al=ie(pa),Pl=ie(Al),iu=ie(Pl),Di=we(Pl),js=ie(Di),Il=we(Di),su=ie(Il),Ol=we(Al),Ml=ie(Ol),wi=ie(Ml),es=we(Ml),Sd=ie(es),Th=we(es),qs=ie(Th),vi=we(Ol),xi=ie(vi),Li=ie(xi),yo=we(xi),ig=ie(yo),sg=we(yo),og=ie(sg);Ke((kd,Ch,ag,Ks,lg,cg,Ed,Jw,ev)=>{Re(_n,kd),Re(Hn,Ch),Re(ha,ag),Re(iu,Ks),Re(js,`${yu.low.maxWidthOrHeight}px`),Re(su,`${lg??""}%`),Re(wi,cg),Re(Sd,`${yu.medium.maxWidthOrHeight}px`),Re(qs,`${Ed??""}%`),Re(Li,Jw),Re(ig,`${yu.high.maxWidthOrHeight}px`),Re(og,`${ev??""}%`)},[()=>r()("settingsDialog.info_header_setting"),()=>r()("settingsDialog.info_header_pixels"),()=>r()("settingsDialog.info_header_quality"),()=>r()("settingsDialog.quality_high"),()=>Math.round(yu.low.initialQuality*100),()=>r()("settingsDialog.quality_medium"),()=>Math.round(yu.medium.initialQuality*100),()=>r()("settingsDialog.quality_low"),()=>Math.round(yu.high.initialQuality*100)]),Y(Dt,rn)},$$slots:{default:!0}});var yt=we(Tt,2);Na(yt,21,()=>E(b),gu,(Dt,Sn)=>{var rn=Qwe();Na(rn,21,()=>E(Sn),gu,(In,mn)=>{{let On=oe(()=>E(_)===E(mn).value);RO(In,{get value(){return E(mn).value},name:"compression",get checked(){return E(On)},variant:"default",shape:"rounded",onChange:_n=>K(_,_n,!0),get ariaLabel(){return E(mn).label},children:(_n,Un)=>{var Hn=an();Ke(()=>Re(Hn,E(mn).label)),Y(_n,Hn)},$$slots:{default:!0}})}}),Y(Dt,rn)});var Kt=we($t,2),Ht=ie(Kt),zt=ie(Ht),tn=ie(zt),Cn=ie(tn),Nn=we(tn,2);nk(Nn,{side:"top",ariaLabel:"åç»å§ç¸®è¨­å®ã®èª¬æ",children:(Dt,Sn)=>{var rn=Ywe(),In=ie(rn),mn=ie(In),On=ie(mn),_n=ie(On),Un=we(On),Hn=ie(Un),go=we(In),ha=ie(go),pa=ie(ha),Al=ie(pa),Pl=we(pa),iu=ie(Pl),Di=we(ha),js=ie(Di),Il=ie(js),su=we(js),Ol=ie(su),Ml=we(Di),wi=ie(Ml),es=ie(wi),Sd=we(wi),Th=ie(Sd);Ke((qs,vi,xi,Li,yo)=>{Re(_n,qs),Re(Hn,vi),Re(Al,xi),Re(iu,`${p0.low.maxSize??""}px`),Re(Il,Li),Re(Ol,`${p0.medium.maxSize??""}px`),Re(es,yo),Re(Th,`${p0.high.maxSize??""}px`)},[()=>r()("settingsDialog.info_header_setting"),()=>r()("settingsDialog.info_header_pixels"),()=>r()("settingsDialog.quality_high"),()=>r()("settingsDialog.quality_medium"),()=>r()("settingsDialog.quality_low")]),Y(Dt,rn)},$$slots:{default:!0}});var Yt=we(zt,2);Na(Yt,21,()=>E(S),gu,(Dt,Sn)=>{var rn=Jwe();Na(rn,21,()=>E(Sn),gu,(In,mn)=>{{let On=oe(()=>E(x)===E(mn).value);RO(In,{get value(){return E(mn).value},name:"videoCompression",get checked(){return E(On)},variant:"default",shape:"rounded",onChange:_n=>K(x,_n,!0),get ariaLabel(){return E(mn).label},children:(_n,Un)=>{var Hn=an();Ke(()=>Re(Hn,E(mn).label)),Y(_n,Hn)},$$slots:{default:!0}})}}),Y(Dt,rn)});var Gt=we(Kt,2),nn=ie(Gt),Jt=ie(nn),zn=ie(Jt),gi=we(Jt,2),ws=ie(gi);Na(ws,21,()=>o5,gu,(Dt,Sn)=>{var rn=eve(),In=ie(rn),mn={};Ke(()=>{Re(In,E(Sn).label),mn!==(mn=E(Sn).url)&&(rn.value=(rn.__value=E(Sn).url)??"")}),Y(Dt,rn)});var Mt=we(Gt,2),Fn=ie(Mt),ar=ie(Fn),yi=ie(ar),lr=we(ar,2),er=ie(lr),bi=ie(er),It=we(Mt,2),Nr=ie(It),da=ie(Nr),Zt=ie(da),xd=we(da,2),ng=ie(xd);{let Dt=oe(()=>r()("settingsDialog.refresh_relays_and_profile")||"ååå¾");en(ng,{variant:"default",shape:"rounded",className:"refresh-relays-profile-btn",onClick:()=>c()&&c()(),get ariaLabel(){return E(Dt)},children:(Sn,rn)=>{var In=tve(),mn=Ee(In),On=we(mn,2),_n=ie(On);Ke((Un,Hn)=>{wn(mn,"aria-label",Un),Re(_n,Hn)},[()=>r()("settingsDialog.refresh")||"æ´æ°",()=>r()("settingsDialog.refresh")||"æ´æ°"]),Y(Sn,In)},$$slots:{default:!0}})}var kh=we(Nr,2),_l=ie(kh);_l.__click=()=>V1.set(!E(O));var Eh=ie(_l),rg=ie(Eh);{var Xw=Dt=>{var Sn=an("â¼");Y(Dt,Sn)},Je=Dt=>{var Sn=an("â¶");Y(Dt,Sn)};Ve(rg,Dt=>{E(O)?Dt(Xw):Dt(Je,!1)})}var fa=we(Eh),Qw=we(_l,2);{var Yw=Dt=>{var Sn=sve(),rn=ie(Sn);{var In=On=>{var _n=rve();Na(_n,21,()=>E(P),gu,(Un,Hn)=>{var go=nve(),ha=ie(go);Ke(()=>Re(ha,E(Hn))),Y(Un,go)}),Y(On,_n)},mn=On=>{var _n=ive(),Un=ie(_n);Ke(Hn=>Re(Un,Hn),[()=>r()("settingsDialog.no_relay_info")||"ãªã¬ã¼æå ±ãªã"]),Y(On,_n)};Ve(rn,On=>{E(P).length>0?On(In):On(mn,!1)})}Y(Dt,Sn)};Ve(Qw,Dt=>{E(O)&&Dt(Yw)})}Ke((Dt,Sn,rn,In,mn,On,_n,Un,Hn)=>{Re(xe,E(T)?`v${E(T)}`:""),Re(ke,Dt),Re(je,Sn),Re(He,rn),Re(Cn,In),Re(zn,mn),wn(ws,"id",`${n}-endpoint`),Re(yi,On),wn(er,"for",`${n}-client-tag`),wn(bi,"id",`${n}-client-tag`),Re(Zt,_n),wn(_l,"aria-pressed",E(O)),wn(_l,"aria-label",Un),Re(fa,` ${Hn??""}`)},[()=>r()("settingsDialog.author_info")||"å¶ä½ï¼",()=>r()("settingsDialog.author_name")||" Lokuyow",()=>r()("settingsDialog.image_quality_setting"),()=>r()("settingsDialog.video_quality_setting"),()=>r()("settingsDialog.upload_destination")||"ã¢ããã­ã¼ãå",()=>r()("settingsDialog.client_tag_label")||"æç¨¿è©³ç´°ã«ã¯ã©ã¤ã¢ã³ãåãã¤ããï¼Client tagï¼",()=>r()("settingsDialog.refresh_relays_and_profile")||"ãªã¬ã¼ãªã¹ãã»ãã­ãã£ã¼ã«ååå¾",()=>r()("settingsDialog.toggle_write_relays_list")||"æç¨¿åãªã¬ã¼ã®è¡¨ç¤ºåæ¿",()=>r()("settingsDialog.write_relays_list")||"æ¸ãè¾¼ã¿åãªã¬ã¼ãªã¹ã"]),F9(ws,()=>E(I),Dt=>K(I,Dt)),V9(bi,()=>E(C),Dt=>K(C,Dt)),Y(z,X)},$$slots:{footer:!0,default:!0}})}kt(),a()}Mi(["click"]);var lve=Ce('<div class="xmark-icon svg-icon svelte-1fu8q0k" aria-label="éãã"></div>'),cve=Ce('<img class="profile-image svelte-1fu8q0k"/>'),uve=Ce('<div class="profile-image-placeholder svg-icon svelte-1fu8q0k" aria-label="Profile image placeholder"></div>'),dve=Ce('<div class="profile-info-row svelte-1fu8q0k"><div class="profile-info-content svelte-1fu8q0k"><span class="profile-info-text svelte-1fu8q0k"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-1fu8q0k" aria-label="Copy npub"></div></button></div></div>'),fve=Ce('<div class="profile-info-row svelte-1fu8q0k"><div class="profile-info-content svelte-1fu8q0k"><span class="profile-info-text svelte-1fu8q0k"> </span> <button class="copy-button"><div class="copy-icon svg-icon svelte-1fu8q0k" aria-label="Copy nprofile"></div></button></div></div>'),hve=Ce('<div class="profile-info-label svelte-1fu8q0k"> </div> <span class="profile-info-text"><!></span>',1),pve=Ce('<div class="profile-container svelte-1fu8q0k"><div class="profile-summary svelte-1fu8q0k"><div class="profile-image-container svelte-1fu8q0k"><!></div> <div class="profile-name svelte-1fu8q0k"> </div></div> <div class="nostr-ids svelte-1fu8q0k"><div class="profile-info-label svelte-1fu8q0k"> </div> <div class="profile-info-container svelte-1fu8q0k"><!> <!></div></div> <div class="auth-controls svelte-1fu8q0k"><div class="auth-container svelte-1fu8q0k"><!></div> <!></div></div>'),mve=Ce('<div class="copy-success-message"> </div>'),gve=Ce("<!> <!>",1);function yve(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=le(e,"show",15,!1),o=le(e,"isLoggingOut",3,!1);function a(){s(!1),e.onClose?.()}yh(()=>s(),a,!0);let l=oe(()=>lc.value),c=oe(()=>Wr.value),u=me(Wt(lc.value)),d=me(!1),f=me(0),h=me(0);Ge(()=>{!o()&&E(l)&&K(u,E(l),!0)});function p(){e.onLogout?.()}async function m(S,C,_){try{await Ow(S,C,navigator,window);const x=Tf(_.clientX,_.clientY);K(f,x.x,!0),K(h,x.y,!0),K(d,!0),setTimeout(()=>{K(d,!1)},1800)}catch(x){console.warn("Copy failed:",x)}}var g=gve(),y=Ee(g);{const S=x=>{var I=Ue(),k=Ee(I);{const T=(P,O)=>{en(P,Qn(()=>O?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(F,B)=>{var N=lve();Y(F,N)},$$slots:{default:!0}}))};Nt(k,()=>dh,(P,O)=>{O(P,{child:T,$$slots:{child:!0}})})}Y(x,I)};let C=oe(()=>n()("profileDialog.title")),_=oe(()=>n()("profileDialog.npub"));gh(y,{onOpenChange:x=>!x&&a(),get title(){return E(C)},get description(){return E(_)},contentClass:"profile-dialog",footerVariant:"close-button",get open(){return s()},set open(x){s(x)},footer:S,children:(x,I)=>{var k=pve(),T=ie(k),P=ie(T),O=ie(P);{var D=ke=>{var Be=cve();Ke(()=>{wn(Be,"src",E(u).picture),wn(Be,"alt",E(u).name||"Profile")}),Y(ke,Be)},F=ke=>{var Be=uve();Y(ke,Be)};Ve(O,ke=>{E(u).picture?ke(D):ke(F,!1)})}var B=we(P,2),N=ie(B),M=we(T,2),R=ie(M),H=ie(R),z=we(R,2),V=ie(z);{var X=ke=>{var Be=dve(),je=ie(Be),Fe=ie(je),ve=ie(Fe),Ie=we(Fe,2);Ie.__click=Oe=>m(E(u).npub,"npub",Oe),Ke(Oe=>{Re(ve,E(u).npub),wn(Ie,"aria-label",Oe)},[()=>n()("profileDialog.copy_npub")]),Y(ke,Be)};Ve(V,ke=>{E(u).npub&&ke(X)})}var Z=we(V,2);{var te=ke=>{var Be=fve(),je=ie(Be),Fe=ie(je),ve=ie(Fe),Ie=we(Fe,2);Ie.__click=Oe=>m(E(u).nprofile,"nprofile",Oe),Ke(Oe=>{Re(ve,E(u).nprofile),wn(Ie,"aria-label",Oe)},[()=>n()("profileDialog.copy_nprofile")]),Y(ke,Be)};Ve(Z,ke=>{E(u).nprofile&&ke(te)})}var ne=we(M,2),J=ie(ne),xe=ie(J);{var Le=ke=>{var Be=hve(),je=Ee(Be),Fe=ie(je),ve=we(je,2),Ie=ie(ve);{var Oe=Te=>{var ze=an();Ke(ot=>Re(ze,ot),[()=>n()("profileDialog.login_method_nsec")]),Y(Te,ze)},qe=Te=>{var ze=Ue(),ot=Ee(ze);{var ct=pt=>{var $t=Ue(),Rt=Ee($t);{var Tt=He=>{var ut=an();Ke(yt=>Re(ut,yt),[()=>n()("profileDialog.login_method_nostr_login_connect")]),Y(He,ut)},Ot=He=>{var ut=Ue(),yt=Ee(ut);{var Kt=zt=>{var tn=an();Ke(Cn=>Re(tn,Cn),[()=>n()("profileDialog.login_method_nostr_login_extension")]),Y(zt,tn)},Ht=zt=>{var tn=Ue(),Cn=Ee(tn);{var Nn=Gt=>{var nn=an();Ke(Jt=>Re(nn,Jt),[()=>n()("profileDialog.login_method_nostr_login_local")]),Y(Gt,nn)},Yt=Gt=>{var nn=an();Ke(Jt=>Re(nn,Jt),[()=>n()("profileDialog.login_method_nostr_login_connect")]),Y(Gt,nn)};Ve(Cn,Gt=>{E(c)?.nostrLoginAuthMethod==="local"?Gt(Nn):Gt(Yt,!1)},!0)}Y(zt,tn)};Ve(yt,zt=>{E(c)?.nostrLoginAuthMethod==="extension"?zt(Kt):zt(Ht,!1)},!0)}Y(He,ut)};Ve(Rt,He=>{E(c)?.nostrLoginAuthMethod==="connect"?He(Tt):He(Ot,!1)})}Y(pt,$t)};Ve(ot,pt=>{E(c)?.type==="nostr-login"&&pt(ct)},!0)}Y(Te,ze)};Ve(Ie,Te=>{E(c)?.type==="nsec"?Te(Oe):Te(qe,!1)})}Ke(Te=>Re(Fe,Te),[()=>n()("profileDialog.login_method")]),Y(ke,Be)};Ve(xe,ke=>{(E(c)?.type==="nsec"||E(c)?.type==="nostr-login")&&ke(Le)})}var he=we(J,2);{let ke=oe(()=>o()?"loading":"");en(he,{onClick:p,get className(){return`logout-btn ${E(ke)??""}`},variant:"danger",shape:"square",get disabled(){return o()},children:(Be,je)=>{var Fe=Ue(),ve=Ee(Fe);{var Ie=qe=>{Nc(qe,{text:!0,showLoader:!0})},Oe=qe=>{var Te=an();Ke(ze=>Re(Te,ze),[()=>n()("logoutDialog.logout")]),Y(qe,Te)};Ve(ve,qe=>{o()?qe(Ie):qe(Oe,!1)})}Y(Be,Fe)},$$slots:{default:!0}})}Ke((ke,Be)=>{Re(N,ke),Re(H,Be)},[()=>E(u).name||n()("profileDialog.anonymous"),()=>n()("profileDialog.npub")]),Y(x,k)},$$slots:{footer:!0,default:!0}})}var b=we(y,2);gC(b,{get show(){return E(d)},get x(){return E(f)},get y(){return E(h)},onClose:()=>K(d,!1),children:(S,C)=>{var _=mve(),x=ie(_);Ke(I=>Re(x,I),[()=>n()("imageContextMenu.copySuccess")]),Y(S,_)},$$slots:{default:!0}}),Y(t,g),kt(),i()}Mi(["click"]);var bve=Ce('<div><span style="word-break:break-all"> </span></div>'),wve=Ce('<div><span style="word-break:break-all"> </span></div>'),vve=Ce('<div class="toast npub-toast svelte-1179qet"><!> <!></div>'),xve=Ce('<div class="xmark-icon svg-icon svelte-1179qet" aria-label="éãã"></div>'),Sve=Ce('<img src="./icons/nostr-login.svg" alt="nostr-login" class="nostr-login-icon svelte-1179qet"/> <span class="btn-text svelte-1179qet">Nostr Login</span>',1),kve=Ce('<!> <div class="divider svelte-1179qet"><span class="svelte-1179qet"> </span></div> <h3 class="svelte-1179qet"> </h3> <form class="svelte-1179qet"><input type="text" name="username" autocomplete="username" style="display: none;" aria-hidden="true"/> <input type="password" placeholder="nsec1â¦" class="secret-input svelte-1179qet" id="secretKey" name="secretKey" autocomplete="current-password" required minlength="63" maxlength="63"/> <div class="dialog-buttons svelte-1179qet"><!> <!></div></form>',1),Eve=Ce("<!> <!>",1);function Tve(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=le(e,"show",15,!1),o=le(e,"secretKey",15),a=le(e,"isLoadingNostrLogin",3,!1);function l(){s(!1),e.onClose?.()}yh(()=>s(),l,!0);const c=new I6;let u=me(null);Ge(()=>{o()!==void 0&&(c.setNsec(o()),E(u)&&(o()||E(u).setCustomValidity("")))});let d=me(!1),f=me(""),h=me("");Ge(()=>{c.isValid.subscribe(x=>K(d,x,!0))}),Ge(()=>{c.npub.subscribe(x=>K(f,x,!0))}),Ge(()=>{c.nprofile.subscribe(x=>K(h,x,!0))});function p(){if(E(u)){const x=E(u).validity,I=E(u).value??"";if(x.valueMissing){E(u).setCustomValidity(n()("loginDialog.secret_required")),E(u).reportValidity();return}if(!I.startsWith("nsec1")){E(u).setCustomValidity(n()("loginDialog.secret_must_start_nsec1")),E(u).reportValidity();return}if(I.length!==63){I.length<63?E(u).setCustomValidity(n()("loginDialog.secret_too_short")):E(u).setCustomValidity(n()("loginDialog.secret_too_long")),E(u).reportValidity();return}if(!E(d)){E(u).setCustomValidity(n()("loginDialog.invalid_secret")),E(u).reportValidity();return}E(u).setCustomValidity("")}e.onSave?.()}function m(){o(""),E(u)&&E(u).setCustomValidity("")}function g(){e.onNostrLogin?.()}function y(x){x.preventDefault(),p()}var b=Eve(),S=Ee(b);{var C=x=>{var I=vve(),k=ie(I);{var T=D=>{var F=bve(),B=ie(F),N=ie(B);Ke(()=>Re(N,E(f))),Y(D,F)};Ve(k,D=>{E(f)&&D(T)})}var P=we(k,2);{var O=D=>{var F=wve(),B=ie(F),N=ie(B);Ke(()=>Re(N,E(h))),Y(D,F)};Ve(P,D=>{E(h)&&D(O)})}Y(x,I)};Ve(S,x=>{(E(f)||E(h))&&x(C)})}var _=we(S,2);{const x=T=>{var P=Ue(),O=Ee(P);{const D=(F,B)=>{en(F,Qn(()=>B?.().props,{className:"modal-close",variant:"default",shape:"square",ariaLabel:"éãã",children:(M,R)=>{var H=xve();Y(M,H)},$$slots:{default:!0}}))};Nt(O,()=>dh,(F,B)=>{B(F,{child:D,$$slots:{child:!0}})})}Y(T,P)};let I=oe(()=>n()("loginDialog.input_secret")),k=oe(()=>n()("loginDialog.hint_input_secret"));gh(_,{onOpenChange:T=>!T&&l(),get title(){return E(I)},get description(){return E(k)},contentClass:"login-dialog",footerVariant:"close-button",get open(){return s()},set open(T){s(T)},footer:x,children:(T,P)=>{var O=kve(),D=Ee(O);{let te=oe(()=>a()?"loading":"");en(D,{variant:"default",shape:"rounded",get className(){return`nostr-login-button ${E(te)??""}`},onClick:g,get disabled(){return a()},children:(ne,J)=>{var xe=Ue(),Le=Ee(xe);{var he=Be=>{Nc(Be,{text:!0,showLoader:!0,customClass:"nostr-login-placeholder"})},ke=Be=>{var je=Sve();Y(Be,je)};Ve(Le,Be=>{a()?Be(he):Be(ke,!1)})}Y(ne,xe)},$$slots:{default:!0}})}var F=we(D,2),B=ie(F),N=ie(B),M=we(F,2),R=ie(M),H=we(M,2),z=we(ie(H),2);z.__keydown=te=>{te.key==="Enter"&&p()},z.__input=()=>{E(u)&&E(u).setCustomValidity("")},gr(z,te=>K(u,te),()=>E(u));var V=we(z,2),X=ie(V);en(X,{variant:"warning",shape:"square",type:"button",onClick:m,className:"clear-btn",children:(te,ne)=>{var J=an();Ke(xe=>Re(J,xe),[()=>n()("loginDialog.clear")]),Y(te,J)},$$slots:{default:!0}});var Z=we(X,2);en(Z,{variant:"primary",shape:"square",type:"submit",className:"save-btn",children:(te,ne)=>{var J=an();Ke(xe=>Re(J,xe),[()=>n()("loginDialog.save")]),Y(te,J)},$$slots:{default:!0}}),Ke((te,ne,J)=>{Re(N,te),Re(R,ne),wn(z,"title",J)},[()=>n()("loginDialog.or"),()=>n()("loginDialog.input_secret"),()=>n()("loginDialog.hint_input_secret")]),eo("submit",H,y),H9(z,o),Y(T,O)},$$slots:{footer:!0,default:!0}})}Y(t,b),kt(),i()}Mi(["keydown","input"]);var Cve=Ce('<div class="welcome-content svelte-1ghzzk4"><div class="title-section svelte-1ghzzk4"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-1ghzzk4"/> <h2 class="svelte-1ghzzk4"> </h2></div> <p class="svelte-1ghzzk4"> </p> <pre class="features svelte-1ghzzk4"> </pre></div>');function _ve(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=le(e,"show",15,!1);function o(){s(!1),e.onClose?.()}yh(()=>s(),o,!0);{const a=u=>{var d=Ue(),f=Ee(d);{const h=(p,m)=>{en(p,Qn(()=>m?.().props,{variant:"primary",shape:"square",className:"get-started-btn",children:(y,b)=>{var S=an();Ke(C=>Re(S,C),[()=>n()("welcomeDialog.get_started")]),Y(y,S)},$$slots:{default:!0}}))};Nt(f,()=>dh,(p,m)=>{m(p,{child:h,$$slots:{child:!0}})})}Y(u,d)};let l=oe(()=>n()("welcomeDialog.title")),c=oe(()=>n()("welcomeDialog.description"));gh(t,{onOpenChange:u=>!u&&o(),get title(){return E(l)},get description(){return E(c)},contentClass:"welcome-dialog",get open(){return s()},set open(u){s(u)},footer:a,children:(u,d)=>{var f=Cve(),h=ie(f),p=we(ie(h),2),m=ie(p),g=we(h,2),y=ie(g),b=we(g,2),S=ie(b);Ke((C,_,x)=>{Re(m,C),Re(y,_),Re(S,x)},[()=>n()("welcomeDialog.title"),()=>n()("welcomeDialog.description"),()=>n()("welcomeDialog.features")]),Y(u,f)},$$slots:{footer:!0,default:!0}})}kt(),i()}function Gw(){const t=localStorage.getItem(Ci.DRAFTS);if(!t)return[];try{return JSON.parse(t).sort((n,r)=>r.timestamp-n.timestamp)}catch{return[]}}function Zw(t){localStorage.setItem(Ci.DRAFTS,JSON.stringify(t))}function W$(t){const e=document.createElement("div");e.innerHTML=t;const n=e.querySelector("img")!==null,r=e.querySelector("video")!==null,o=(e.textContent||e.innerText||"").split(`
`).filter(h=>h.trim())[0]||"",a=oo(gs)||"en",l=oo(or);let c="[ç»å]",u="[åç»]";try{c=l("draft.media.image")||(a.startsWith("ja")?"[ç»å]":"[Image]"),u=l("draft.media.video")||(a.startsWith("ja")?"[åç»]":"[Video]")}catch{c=a.startsWith("ja")?"[ç»å]":"[Image]",u=a.startsWith("ja")?"[åç»]":"[Video]"}const d=[];n&&d.push(c),r&&d.push(u);const f=d.join("");if(o){if(f){const h=`${o} ${f}`;if(h.length>Lg){const p=Lg-f.length-2;return p>0?`${o.substring(0,p)}â¦ ${f}`:f}return h}return o.length>Lg?o.substring(0,Lg)+"â¦":o}if(f)return f;try{return l("draft.no_content")||(a.startsWith("ja")?"(åå®¹ãªã)":"(No content)")}catch{return a.startsWith("ja")?"(åå®¹ãªã)":"(No content)"}}function j$(){return`draft_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}function Ave(t){const e=Gw();if(e.length>=s5)return{success:!1,needsConfirmation:!0,drafts:e};const r=[{id:j$(),content:t,preview:W$(t),timestamp:Date.now()},...e];return Zw(r),{success:!0,needsConfirmation:!1,drafts:r}}function Pve(t){const n=Gw().slice(0,s5-1),i=[{id:j$(),content:t,preview:W$(t),timestamp:Date.now()},...n];return Zw(i),i}function Ive(t){const n=Gw().filter(r=>r.id!==t);return Zw(n),n}function Ove(){return Zw([]),[]}function Mve(t){const e=Date.now(),n=e-t,r=60*1e3,i=60*r,s=24*i,o=oo(gs)||"en",a=oo(or),l=new Intl.RelativeTimeFormat(o,{numeric:"auto"});if(n<r)try{return a("draft.time.now")}catch{return o.startsWith("ja")?"ä»":"Now"}else if(n<i){const c=Math.floor(n/r);return o.startsWith("en")?`${c}m ago`:l.format(-c,"minute")}else if(n<s){const c=Math.floor(n/i);return o.startsWith("en")?`${c}h ago`:l.format(-c,"hour")}else{const c=new Date(t),u=365*s;return e-t<u?new Intl.DateTimeFormat(o,{month:"numeric",day:"numeric"}).format(c):new Intl.DateTimeFormat(o,{year:"numeric",month:"numeric",day:"numeric"}).format(c)}}var Nve=Ce('<div class="xmark-icon svg-icon svelte-y19p5z"></div>'),Rve=Ce('<div class="trash-icon svg-icon svelte-y19p5z"></div> <span class="delete-all-label"> </span>',1),Dve=Ce('<div class="empty-message svelte-y19p5z"> </div>'),Lve=Ce('<div class="trash-icon svg-icon svelte-y19p5z"></div>'),Bve=Ce('<li class="draft-item svelte-y19p5z"><button type="button" class="draft-content svelte-y19p5z"><span class="draft-preview svelte-y19p5z"> </span> <span class="draft-timestamp svelte-y19p5z"> </span></button> <!></li>'),Fve=Ce('<ul class="draft-list svelte-y19p5z"></ul>'),$ve=Ce('<div class="dialog-heading-container svelte-y19p5z"><div class="dialog-heading-wrapper svelte-y19p5z"><h3 class="dialog-heading svelte-y19p5z"> </h3> <!></div> <!></div> <div class="draft-list-container svelte-y19p5z"><!></div>',1);function zve(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=le(e,"show",15,!1),o=me(Wt([]));function a(){s(!1),e.onClose?.()}yh(()=>s(),a,!0),Ge(()=>{s()&&K(o,Gw(),!0)});function l(d){e.onApplyDraft(d.content),a()}function c(d){K(o,Ive(d),!0)}function u(){K(o,Ove(),!0)}{const d=p=>{var m=Ue(),g=Ee(m);{const y=(b,S)=>{let C=()=>S?.().props;{let _=oe(()=>n()("global.close")||"éãã");en(b,Qn(C,{className:"modal-close",variant:"default",shape:"square",get ariaLabel(){return E(_)},children:(x,I)=>{var k=Nve();Ke(T=>wn(k,"aria-label",T),[()=>n()("global.close")||"éãã"]),Y(x,k)},$$slots:{default:!0}}))}};Nt(g,()=>dh,(b,S)=>{S(b,{child:y,$$slots:{child:!0}})})}Y(p,m)};let f=oe(()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§"),h=oe(()=>n()("draft.list_description")||"ä¿å­ããä¸æ¸ããé¸æãã¦å¾©å");gh(t,{onOpenChange:p=>!p&&a(),get title(){return E(f)},get description(){return E(h)},contentClass:"draft-list-dialog",footerVariant:"close-button",get open(){return s()},set open(p){s(p)},footer:d,children:(p,m)=>{var g=$ve(),y=Ee(g),b=ie(y),S=ie(b),C=ie(S),_=we(S,2);{let O=oe(()=>n()("draft.info")||"ä¸æ¸ãæå ±");nk(_,{side:"bottom",sideOffset:8,get ariaLabel(){return E(O)},children:(D,F)=>{var B=an();Ke(N=>Re(B,N),[()=>n()("draft.info")||"ä¸æ¸ãã¯ãã©ã¦ã¶ã«ä¿å­ããã¾ãããã©ã¦ã¶ã®ãã¼ã¿ãåé¤ããããã­ã°ã¢ã¦ãããã¨ä¸æ¸ãã¯åé¤ããã¾ãã"]),Y(D,B)},$$slots:{default:!0}})}var x=we(b,2);{let O=oe(()=>n()("draft.delete_all")||"å¨ã¦åé¤");en(x,{className:"delete-all-button",variant:"default",shape:"rounded",get ariaLabel(){return E(O)},onClick:u,children:(D,F)=>{var B=Rve(),N=we(Ee(B),2),M=ie(N);Ke(R=>Re(M,R),[()=>n()("draft.delete_all")||"å¨ã¦åé¤"]),Y(D,B)},$$slots:{default:!0}})}var I=we(y,2),k=ie(I);{var T=O=>{var D=Dve(),F=ie(D);Ke(B=>Re(F,B),[()=>n()("draft.no_drafts")||"ä¸æ¸ããããã¾ãã"]),Y(O,D)},P=O=>{var D=Fve();Na(D,21,()=>E(o),F=>F.id,(F,B)=>{var N=Bve(),M=ie(N);M.__click=()=>l(E(B));var R=ie(M),H=ie(R),z=we(R,2),V=ie(z),X=we(M,2);{let Z=oe(()=>n()("draft.delete")||"åé¤");en(X,{className:"delete-button",variant:"default",shape:"square",get ariaLabel(){return E(Z)},onClick:()=>c(E(B).id),children:(te,ne)=>{var J=Lve();Y(te,J)},$$slots:{default:!0}})}Ke(Z=>{Re(H,E(B).preview),Re(V,Z)},[()=>Mve(E(B).timestamp)]),Y(F,N)}),Y(O,D)};Ve(k,O=>{E(o).length===0?O(T):O(P,!1)})}Ke(O=>Re(C,O),[()=>n()("draft.title")||"ä¸æ¸ã"]),Y(p,g)},$$slots:{footer:!0,default:!0}})}kt(),i()}Mi(["click"]);class Ab{static createMergedOptions(e){return{theme:"default",noBanner:!0,methods:"connect, extension, local",perms:"get_public_key,sign_event:1,sign_event:27235",startScreen:"welcome",...e}}static processBunkers(e){return Array.isArray(e)?e.join(","):void 0}static async npubToPubkey(e){try{if(!e)return{success:!1,error:{type:"decode",message:"npub is empty or null"}};const n=hl.decode(e);return n.type==="npub"?{success:!0,pubkey:n.data}:{success:!1,error:{type:"decode",message:"Invalid npub format"}}}catch(n){return{success:!1,error:{type:"decode",message:"Failed to decode npub",originalError:n}}}}static getCurrentUserFromWindow(e){try{const n=e.nostrLogin;if(n&&n.pubkey)return{pubkey:n.pubkey,npub:n.npub}}catch{return null}return null}static getNostrLoginAuthMethod(e,n){try{const r=n.getItem("__nostrlogin_accounts");if(!r)return;const i=JSON.parse(r);if(!Array.isArray(i))return;const s=i.find(a=>a?.pubkey===e);if(!s||!s.authMethod)return;const o=s.authMethod;return o==="connect"||o==="extension"||o==="local"?o:void 0}catch{return}}}class Uve{constructor(e,n,r){this.console=e,this.getAuthHandler=n,this.isLoggingOut=r}async handleAuthCallback(e,n){const r=this.getAuthHandler();if(!(!r||this.isLoggingOut()))try{if(!e){r({type:"logout"});return}const i=await Ab.npubToPubkey(e);if(!i.success||!i.pubkey){this.console.warn("NostrLogin: Failed to get pubkey from npub",i.error);return}const s=n?.type||"login";r({type:s,pubkey:i.pubkey,npub:e,otpData:n?.otpData})}catch(i){this.console.error("NostrLogin auth callback error:",i)}}}class Hve{constructor(e,n,r){this.console=e,this.importNostrLogin=n,this.authHandler=r}async initialize(e){try{const r=(await this.importNostrLogin()).init;if(!r)throw new TypeError("nostr-login: init function is missing");const i=Ab.createMergedOptions(e),s=this.authHandler.handleAuthCallback.bind(this.authHandler),o=i.bunkers!==void 0?Ab.processBunkers(i.bunkers):void 0,a={...i,bunkers:o,startScreen:i.startScreen,onAuth:s};return await Promise.resolve(r(a)),this.console.log("nostr-loginåæåå®äº"),{success:!0}}catch(n){const r={type:"initialization",message:"Failed to initialize nostr-login",originalError:n};return this.console.error("nostr-loginåæåã¨ã©ã¼:",n),{success:!1,error:r}}}}class Vve{constructor(e){this.importNostrLogin=e}async launch(e){try{const{launch:n}=await this.importNostrLogin();return await n(e||"welcome"),{success:!0}}catch(n){return{success:!1,error:{type:"launch",message:"Failed to launch nostr-login",originalError:n}}}}}class Wve{constructor(e,n){this.document=e,this.setTimeout=n}logout(e){e(!0);try{const n=new Event("nlLogout");this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlLogout event:",n)}try{this.setTimeout(()=>{e(!1)},100)}catch(n){console.error("Failed to set logout flag timeout:",n),e(!1)}}setDarkMode(e){try{const n=new CustomEvent("nlDarkMode",{detail:e});this.document.dispatchEvent(n)}catch(n){console.error("Failed to dispatch nlDarkMode event:",n)}}}class jve{initialized=!1;authHandler=null;isLoggingOutFlag=!1;initPromise=null;resolvedPromise=null;initializer;launcher;eventEmitter;authCallbackHandler;windowObj;documentObj;consoleObj;setTimeoutFn;constructor(e={}){this.windowObj=e.window||(typeof window<"u"?window:{}),this.documentObj=e.document||(typeof window<"u"?window.document:{}),this.consoleObj=e.console||(typeof window<"u"?window.console:{}),this.setTimeoutFn=e.setTimeout||(typeof window<"u"&&window.setTimeout?window.setTimeout.bind(window):(()=>{}));const n=e.importNostrLogin||(()=>Hb(()=>import("./index.esm-ocKONXP9.js"),[]));this.authCallbackHandler=new Uve(this.consoleObj,()=>this.authHandler,()=>this.isLoggingOutFlag),this.initializer=new Hve(this.consoleObj,n,this.authCallbackHandler),this.launcher=new Vve(n),this.eventEmitter=new Wve(this.documentObj,this.setTimeoutFn)}init(e={}){return this.initPromise!==null?this.initPromise:this.initialized?this.resolvedPromise:(this.initPromise=new Promise((n,r)=>{this.initializer.initialize(e).then(i=>{if(i.success)this.initialized=!0,this.resolvedPromise=this.initPromise,n();else{this._resetInitializationState();const s=i.error?.message||"Initialization failed",o=i.error?.originalError;o instanceof Error?r(o):r(new Error(s))}}).catch(i=>{this._resetInitializationState(),r(i)})}),this.initPromise)}_resetInitializationState(){this.initialized=!1,this.initPromise=null,this.resolvedPromise=null}setAuthHandler(e){this.authHandler=e}async showLogin(e){if(!this._ensureInitialized())throw new Error("nostr-login is not initialized");const n=await this.launcher.launch(e);if(!n.success)throw n.error?.originalError instanceof Error?n.error.originalError:new Error(n.error?.message||"Failed to launch login")}logout(){try{if(!this._ensureInitialized())return;this.eventEmitter.logout(e=>{this.isLoggingOutFlag=e})}catch(e){this.consoleObj.error("NostrLogin logout error:",e)}}setDarkMode(e){this._ensureInitialized()&&this.eventEmitter.setDarkMode(e)}getCurrentUser(){return this.initialized?Ab.getCurrentUserFromWindow(this.windowObj):null}_ensureInitialized(){return this.initialized?!0:(this.consoleObj.warn("nostr-loginãåæåããã¦ãã¾ãã"),!1)}get isInitialized(){return this.initialized}getInitializer(){return this.initializer}getLauncher(){return this.launcher}getEventEmitter(){return this.eventEmitter}getAuthCallbackHandler(){return this.authCallbackHandler}}const o4=new jve;class Pb{static isValidSecretKey(e,n){return n.isValidNsec(e)}static hasRequiredPubkey(e){return e.type!=="logout"&&!!e.pubkey}static isLogoutAuth(e){return e.type==="logout"}}class qve{constructor(e,n,r){this.keyManager=e,this.setNsecAuth=n,this.console=r}async authenticate(e){if(!Pb.isValidSecretKey(e,this.keyManager))return{success:!1,error:"invalid_secret"};const{success:n}=this.keyManager.saveToStorage(e);if(!n)return{success:!1,error:"error_saving"};try{const r=this.keyManager.derivePublicKey(e);return r.hex?(this.setNsecAuth(r.hex,r.npub,r.nprofile),{success:!0,pubkeyHex:r.hex}):{success:!1,error:"derivation_failed"}}catch(r){return this.console.error("nsecèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",r),{success:!1,error:"authentication_error"}}}}class Kve{constructor(e,n){this.publicKeyState=e,this.console=n}async authenticate(e){if(Pb.isLogoutAuth(e))return{success:!0};if(!Pb.hasRequiredPubkey(e))return this.console.warn("NostrLoginAuth: pubkey is required for login/signup"),{success:!1,error:"missing_pubkey"};try{return this.publicKeyState.setNostrLoginAuth(e),{success:!0,pubkeyHex:e.pubkey}}catch(n){return this.console.error("nostr-loginèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",n),{success:!1,error:"nostr_login_error"}}}}class Gve{constructor(e){this.window=e}async waitForExternalAuth(e=5e3){const n=Date.now(),r=100;return new Promise(i=>{const s=()=>{if(this.isWindowNostrAvailable()){i(!0);return}if(Date.now()-n>=e){i(!1);return}setTimeout(s,r)};s()})}isWindowNostrAvailable(){return typeof this.window<"u"&&typeof this.window.nostr=="object"&&this.window.nostr!==null&&typeof this.window.nostr.getPublicKey=="function"}}class Zve{constructor(e,n){this.navigator=e,this.console=n}async clearProfileImageCache(){try{if(!this.hasServiceWorker())return;const e=new MessageChannel;return new Promise((n,r)=>{e.port1.onmessage=i=>{i.data.success?(this.console.log("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ãã¯ãªã¢ãã¾ãã"),n()):(this.console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢å¤±æ:",i.data.error),r(new Error(i.data.error)))},this.navigator.serviceWorker.controller?this.navigator.serviceWorker.controller.postMessage({action:"clearProfileCache"},[e.port2]):r(new Error("Service worker controller is null."))})}catch(e){this.console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}}hasServiceWorker(){return"serviceWorker"in this.navigator&&!!this.navigator.serviceWorker.controller}}class Xve{constructor(e){this.localStorage=e}getStoredNostrLoginData(){try{const e=this.localStorage.getItem("__nostrlogin_nip46");if(!e)return null;const n=JSON.parse(e);return n?.pubkey?{pubkey:n.pubkey,npub:n.npub}:null}catch{return null}}}class Qve{constructor(e,n,r,i,s,o,a){this.keyManager=e,this.publicKeyState=n,this.nostrLoginManager=r,this.externalAuthWaiter=i,this.storageManager=s,this.setNsecAuth=o,this.console=a}async initialize(e){try{const n=await this.checkNsecAuth();if(n.hasAuth)return n;await this.externalAuthWaiter.waitForExternalAuth(100);const r=await this.checkNostrLoginAuth(e);if(r.hasAuth)return r}catch(n){this.console.error("nostr-loginåæåå¤±æ:",n)}return{hasAuth:!1}}async checkNsecAuth(){const e=this.keyManager.loadFromStorage();if(!e)return{hasAuth:!1};this.publicKeyState.setNsec(e);try{const n=this.keyManager.derivePublicKey(e);return n.hex?(this.setNsecAuth(n.hex,n.npub,n.nprofile),{hasAuth:!0,pubkeyHex:n.hex,isNostrLogin:!1}):(this.keyManager.saveToStorage(""),{hasAuth:!1})}catch{return this.keyManager.saveToStorage(""),{hasAuth:!1}}}async checkNostrLoginAuth(e){await this.nostrLoginManager.init(e),await new Promise(i=>setTimeout(i,100));const n=this.nostrLoginManager.getCurrentUser();if(n?.pubkey)return this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:n.pubkey,npub:n.npub}),{hasAuth:!0,pubkeyHex:n.pubkey,isNostrLogin:!0};const r=this.storageManager.getStoredNostrLoginData();return r?.pubkey?(this.publicKeyState.setNostrLoginAuth({type:"login",pubkey:r.pubkey,npub:r.npub}),{hasAuth:!0,pubkeyHex:r.pubkey,isNostrLogin:!0}):{hasAuth:!1}}}class Yve{publicKeyState;nsecAuthenticator;nostrLoginAuthenticator;profileCacheCleaner;authInitializer;nostrLoginMgr;keyManager;nostrLoginOptions={theme:"default",noBanner:!0,methods:"connect, extension, local"};constructor(e={}){const n=e.localStorage||(typeof window<"u"?window.localStorage:{}),r=e.keyManager||new O6({secretKeyStore:e.secretKeyStore||ose,setNostrLoginAuthFn:e.setNostrLoginAuth||wI,clearAuthStateFn:e.clearAuthState||bI,localStorage:n}),i=e.window||(typeof window<"u"?window:{}),s=e.navigator||(typeof window<"u"?window.navigator:{}),o=e.console||(typeof window<"u"?window.console:{}),a=e.setNsecAuth||Qie;this.nostrLoginMgr=e.nostrLoginManager||o4,this.publicKeyState=new I6({setNostrLoginAuthFn:e.setNostrLoginAuth||wI,clearAuthStateFn:e.clearAuthState||bI,localStorage:n}),this.nsecAuthenticator=new qve(r,a,o),this.nostrLoginAuthenticator=new Kve(this.publicKeyState,o),this.profileCacheCleaner=new Zve(s,o);const l=new Gve(i),c=new Xve(n);this.authInitializer=new Qve(r,this.publicKeyState,this.nostrLoginMgr,l,c,a,o),this.keyManager=r}async authenticateWithNsec(e){return await this.nsecAuthenticator.authenticate(e)}async authenticateWithNostrLogin(e){return Pb.isLogoutAuth(e)?(this.logout(),{success:!0}):await this.nostrLoginAuthenticator.authenticate(e)}async showNostrLoginDialog(){const e=o4;if(!e.isInitialized)throw new Error("nostr-login is not initialized");try{await e.showLogin()}catch(n){if(!(n instanceof Error&&n.message==="Cancelled"))throw console.error("nostr-loginã§ã¨ã©ã¼:",n),n}}logout(){try{if(this.publicKeyState.currentIsNostrLogin&&this.nostrLoginMgr.isInitialized)try{this.nostrLoginMgr.logout()}catch(e){console.error("nostr-loginã­ã°ã¢ã¦ãä¸­ã«ã¨ã©ã¼:",e)}try{const e=localStorage.getItem("firstVisit");localStorage.clear(),e&&localStorage.setItem("firstVisit",e)}catch(e){console.error("ã­ã¼ã«ã«ã¹ãã¬ã¼ã¸ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}this.profileCacheCleaner.clearProfileImageCache().catch(e=>{console.error("ãã­ãã£ã¼ã«ç»åã­ã£ãã·ã¥ã¯ãªã¢ä¸­ã«ã¨ã©ã¼:",e)}),setTimeout(()=>{try{typeof window<"u"&&window.location&&typeof window.location.replace=="function"?window.location.replace(window.location.pathname):typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(e){console.error("ãã¼ã¸ãªã­ã¼ãä¸­ã«ã¨ã©ã¼:",e)}},500)}catch(e){console.error("ã­ã°ã¢ã¦ãå¦çä¸­ã«äºæããªãã¨ã©ã¼:",e),setTimeout(()=>{try{typeof window<"u"&&window.location&&(window.location.href=window.location.pathname)}catch(n){console.error("ãã¼ã¸ãªã­ã¼ãä¸­ã«ã¨ã©ã¼:",n)}},2e3)}}async initializeAuth(){return await this.authInitializer.initialize(this.nostrLoginOptions)}getPublicKeyState(){return this.publicKeyState}setNostrLoginHandler(e){this.nostrLoginMgr.setAuthHandler(e)}markAuthInitialized(){Yie()}getNsecAuthenticator(){return this.nsecAuthenticator}getNostrLoginAuthenticator(){return this.nostrLoginAuthenticator}getProfileCacheCleaner(){return this.profileCacheCleaner}getAuthInitializer(){return this.authInitializer}}const Jl=new Yve;var Jve=Ce('<div><div class="balloon-message svelte-kfz10i"> </div></div>');function e1e(t,e){let n=le(e,"type",3,"success"),r=le(e,"message",3,"");var i=Jve(),s=ie(i),o=ie(s);Ke(()=>{ao(i,1,`balloon-message-wrapper ${n()??""}`,"svelte-kfz10i"),Re(o,r())}),Y(t,i)}class q${constructor(e){this.$_=e}showTimeout=null;lastMessageTime=0;debounceDelay=500;getRandomInfoMessage(){const e=Fie,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getRandomSuccessMessage(){const e=$ie,n=Math.floor(Math.random()*e.length);return this.$_(e[n])??""}getErrorMessage(){return this.$_(zie)??""}createMessage(e,n,r=!1){const i=Date.now();if(!r&&i-this.lastMessageTime<this.debounceDelay)return{type:e,message:""};this.lastMessageTime=i;let s=n;if(!s)switch(e){case"info":s=this.getRandomInfoMessage();break;case"success":s=this.getRandomSuccessMessage();break;case"error":s=this.getErrorMessage();break;default:s=""}return{type:e,message:s}}scheduleHide(e,n=3e3){this.showTimeout&&clearTimeout(this.showTimeout),this.showTimeout=setTimeout(e,n)}cancelScheduledHide(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}createMessageImmediate(e,n){return this.createMessage(e,n,!0)}dispose(){this.cancelScheduledHide(),this.lastMessageTime=0}}var t1e=Ce('<div class="trash-icon svg-icon svelte-1dq5yfg"></div>'),n1e=Ce("<!> <!>",1),r1e=Ce('<div class="list-icon svg-icon svelte-1dq5yfg"></div>'),i1e=Ce("<!> <!>",1),s1e=Ce('<div class="floppy-disk-icon svg-icon svelte-1dq5yfg"></div>'),o1e=Ce("<!> <!>",1),a1e=Ce('<div class="copy-success-message"> </div>'),l1e=Ce('<div class="header-container svelte-1dq5yfg"><div class="header-left svelte-1dq5yfg"><a href="https://lokuyow.github.io/ehagaki/" class="site-icon-link svelte-1dq5yfg" aria-label="ehagaki"><img src="./ehagaki_icon.svg" alt="ehagaki icon" class="site-icon svelte-1dq5yfg"/></a> <!></div> <div class="post-actions svelte-1dq5yfg"><div class="buttons-container svelte-1dq5yfg"><!> <!> <!></div></div></div>  <label id="vibrateSwitch" style="display: none;" aria-hidden="true"><input type="checkbox" checked/></label> <!>',1);function c1e(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=le(e,"balloonMessage",3,null),o=me(!1),a=me(0),l=me(0);function c(V){if(e.onSaveDraft()){const te=V.currentTarget.getBoundingClientRect();K(a,te.left+te.width/2),K(l,te.bottom+8),K(o,!0),setTimeout(()=>{K(o,!1)},2e3)}}let u=null;Ge(()=>{n()&&!u&&(u=new q$(n()))});let d=oe(()=>Pn.postStatus),f=oe(()=>Pn.isUploading),h=oe(()=>Pn.canPost),p=me(null),m=me(!1);function g(){u&&!E(m)&&(K(p,u.createMessage("success"),!0),K(m,!0),u.scheduleHide(()=>{K(p,null),K(m,!1),Ca({...Pn.postStatus,success:!1,message:"",completed:!1})},3e3))}Ge(()=>{E(d).success&&E(d).completed&&!E(p)&&!E(m)&&g()}),Ge(()=>{(!E(d).success||!E(d).completed)&&(E(p)||E(m))&&(K(p,null),K(m,!1),u&&u.cancelScheduledHide())});let y=oe(()=>E(d).error&&u!==null?u.createMessage("error"):null),b=me(null);const S=typeof window<"u"&&(window.location.port==="4173"||window.location.hostname==="localhost");let C=me(null);Ge(()=>{if(typeof window<"u"&&u){const V=new URLSearchParams(window.location.search),X=V.get("error");if(X&&V.get("shared")==="true"){if(["processing-error","no-image","upload-failed","network-error","client-error"].includes(X)){setTimeout(()=>{const ne=new URL(window.location.href);ne.searchParams.delete("error"),ne.searchParams.delete("shared"),window.history.replaceState({},"",ne.toString())},1e3);return}let te="";switch(X){case"messaging-error":te="Service Workerã¨ã®éä¿¡ã§ã¨ã©ã¼ãçºçãã¾ããããã¼ã¸ãæ´æ°ãã¦ããä¸åº¦ãè©¦ããã ããã";break;case"window-error":te="æ°ããã¦ã£ã³ãã¦ã®ä½æã«å¤±æãã¾ãã";break;default:setTimeout(()=>{const ne=new URL(window.location.href);ne.searchParams.delete("error"),ne.searchParams.delete("shared"),window.history.replaceState({},"",ne.toString())},1e3);return}K(C,{type:"error",message:te},!0),setTimeout(()=>{const ne=new URL(window.location.href);ne.searchParams.delete("error"),ne.searchParams.delete("shared"),window.history.replaceState({},"",ne.toString()),setTimeout(()=>{K(C,null)},5e3)},1e3)}}}),S&&(window.showInfoBalloonDebug=V=>{K(b,{type:"info",message:V},!0)},window.hideInfoBalloonDebug=()=>{K(b,null)});let _=oe(()=>E(C)||(S?E(b)||s()||E(y)||E(p):s()||E(y)||E(p)));Ge(()=>()=>{u&&u.dispose()});let x=me(void 0);Ge(()=>{E(x)&&E(x).setAttribute("switch","")});var I=l1e(),k=Ee(I),T=ie(k),P=we(ie(T),2);{var O=V=>{e1e(V,{get type(){return E(_).type},get message(){return E(_).message}})};Ve(P,V=>{E(_)&&V(O)})}var D=we(T,2),F=ie(D),B=ie(F);Nt(B,()=>mf,(V,X)=>{X(V,{delayDuration:500,children:(Z,te)=>{var ne=n1e(),J=Ee(ne);{const Le=(he,ke)=>{let Be=()=>ke?.().props;const je=oe(()=>{const{onclick:Fe,...ve}=Be();return{tooltipOnclick:Fe,restProps:ve}});{let Fe=oe(()=>!E(h)||E(d).sending||E(f)),ve=oe(()=>n()("postComponent.clear_editor"));en(he,Qn({variant:"header",shape:"square",className:"clear-button",get disabled(){return E(Fe)},onClick:Ie=>{e.onResetPostContent(),typeof E(je).tooltipOnclick=="function"&&E(je).tooltipOnclick(Ie)},get ariaLabel(){return E(ve)}},()=>E(je).restProps,{children:(Ie,Oe)=>{var qe=t1e();Y(Ie,qe)},$$slots:{default:!0}}))}};Nt(J,()=>yf,(he,ke)=>{ke(he,{child:Le,$$slots:{child:!0}})})}var xe=we(J,2);Nt(xe,()=>Tc,(Le,he)=>{he(Le,{children:(ke,Be)=>{var je=Ue(),Fe=Ee(je);Nt(Fe,()=>gf,(ve,Ie)=>{Ie(ve,{sideOffset:8,class:"tooltip-content",children:(Oe,qe)=>{var Te=an();Ke(ze=>Re(Te,ze),[()=>n()("postComponent.clear_editor")]),Y(Oe,Te)},$$slots:{default:!0}})}),Y(ke,je)},$$slots:{default:!0}})}),Y(Z,ne)},$$slots:{default:!0}})});var N=we(B,2);Nt(N,()=>mf,(V,X)=>{X(V,{delayDuration:500,children:(Z,te)=>{var ne=i1e(),J=Ee(ne);{const Le=(he,ke)=>{let Be=()=>ke?.().props;const je=oe(()=>{const{onclick:Fe,...ve}=Be();return{tooltipOnclick:Fe,restProps:ve}});{let Fe=oe(()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§");en(he,Qn({variant:"header",shape:"square",className:"draft-list-button",onClick:ve=>{e.onShowDraftList(),typeof E(je).tooltipOnclick=="function"&&E(je).tooltipOnclick(ve)},get ariaLabel(){return E(Fe)}},()=>E(je).restProps,{children:(ve,Ie)=>{var Oe=r1e();Y(ve,Oe)},$$slots:{default:!0}}))}};Nt(J,()=>yf,(he,ke)=>{ke(he,{child:Le,$$slots:{child:!0}})})}var xe=we(J,2);Nt(xe,()=>Tc,(Le,he)=>{he(Le,{children:(ke,Be)=>{var je=Ue(),Fe=Ee(je);Nt(Fe,()=>gf,(ve,Ie)=>{Ie(ve,{sideOffset:8,class:"tooltip-content",children:(Oe,qe)=>{var Te=an();Ke(ze=>Re(Te,ze),[()=>n()("draft.list_title")||"ä¸æ¸ãä¸è¦§"]),Y(Oe,Te)},$$slots:{default:!0}})}),Y(ke,je)},$$slots:{default:!0}})}),Y(Z,ne)},$$slots:{default:!0}})});var M=we(N,2);Nt(M,()=>mf,(V,X)=>{X(V,{delayDuration:500,children:(Z,te)=>{var ne=o1e(),J=Ee(ne);{const Le=(he,ke)=>{let Be=()=>ke?.().props;const je=oe(()=>{const{onclick:Fe,...ve}=Be();return{tooltipOnclick:Fe,restProps:ve}});{let Fe=oe(()=>!E(h)||E(d).sending||E(f)),ve=oe(()=>n()("draft.save")||"ä¸æ¸ãä¿å­");en(he,Qn({variant:"header",shape:"square",className:"draft-save-button",get disabled(){return E(Fe)},onClick:Ie=>{c(Ie),typeof E(je).tooltipOnclick=="function"&&E(je).tooltipOnclick(Ie)},get ariaLabel(){return E(ve)}},()=>E(je).restProps,{children:(Ie,Oe)=>{var qe=s1e();Y(Ie,qe)},$$slots:{default:!0}}))}};Nt(J,()=>yf,(he,ke)=>{ke(he,{child:Le,$$slots:{child:!0}})})}var xe=we(J,2);Nt(xe,()=>Tc,(Le,he)=>{he(Le,{children:(ke,Be)=>{var je=Ue(),Fe=Ee(je);Nt(Fe,()=>gf,(ve,Ie)=>{Ie(ve,{sideOffset:8,class:"tooltip-content",children:(Oe,qe)=>{var Te=an();Ke(ze=>Re(Te,ze),[()=>n()("draft.save")||"ä¸æ¸ãä¿å­"]),Y(Oe,Te)},$$slots:{default:!0}})}),Y(ke,je)},$$slots:{default:!0}})}),Y(Z,ne)},$$slots:{default:!0}})});var R=we(k,2),H=ie(R);gr(H,V=>K(x,V),()=>E(x));var z=we(R,2);gC(z,{get show(){return E(o)},get x(){return E(a)},get y(){return E(l)},onClose:()=>K(o,!1),children:(V,X)=>{var Z=a1e(),te=ie(Z);Ke(ne=>Re(te,ne),[()=>n()("draft.saved")]),Y(V,Z)},$$slots:{default:!0}}),Y(t,I),kt(),i()}var u1e=Ce('<li class="svelte-1ldno5o"> </li>'),d1e=Ce('<button type="button" class="floating-dev-console-log svelte-1ldno5o" title="ã¿ããã§å¨ã³ãã¼" aria-label="éçºèã­ã°ãã³ãã¼"><ul class="svelte-1ldno5o"></ul></button>'),f1e=Ce('<div class="shared-image-error svelte-1ldno5o"><div class="error-text svelte-1ldno5o"> </div></div>'),h1e=Ce('<div class="stop-icon svg-icon"></div>'),p1e=Ce('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> </div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),m1e=Ce('<div class="stop-icon svg-icon"></div>'),g1e=Ce('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> </div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),y1e=Ce('<div class="stop-icon svg-icon"></div>'),b1e=Ce('<div class="compression-container svelte-1ldno5o"><!> <div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> <!> <!></div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div></div>'),w1e=Ce('<div class="upload-progress svelte-1ldno5o"><div class="progress-text svelte-1ldno5o"> <!> <!></div> <div class="progress-bar svelte-1ldno5o"><div class="progress-fill svelte-1ldno5o"></div></div></div>'),v1e=Ce(" <br/> <!>",1),x1e=Ce('<div class="image-size-info svelte-1ldno5o"><div class="size-label svelte-1ldno5o"> </div> <div class="size-details svelte-1ldno5o"><!></div></div>'),S1e=Ce('<!> <div class="footer-center svelte-1ldno5o"><!></div>',1);function k1e(t,e){St(e,!0);const n=()=>Xn(mC,"$devLog",i),r=()=>Xn(or,"$_",i),[i,s]=hi();let o=me(!1),a=me(null);Ge(()=>{if(typeof window<"u"){const V=new URLSearchParams(window.location.search),X=V.get("error");if(X&&V.get("shared")==="true"){const Z=()=>{const te=localStorage.getItem("sharedImageProcessed")==="1",xe=!new URLSearchParams(window.location.search).get("error");return te||xe};if(Z()){console.log("Shared image was processed successfully, ignoring error parameter");return}setTimeout(()=>{if(Z()){console.log("Shared image processing detected after delay, not showing error");return}let te="";switch(X){case"processing-error":te="å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼ãçºçãã¾ãã";break;case"no-image":te="å±æç»åãè¦ã¤ããã¾ããã§ãã";break;case"upload-failed":te="ç»åã®ã¢ããã­ã¼ãã«å¤±æãã¾ãã";break;case"network-error":te="ãããã¯ã¼ã¯ã¨ã©ã¼ãçºçãã¾ãã";break;case"client-error":te="ç»åå±æå¦çã§ã¨ã©ã¼ãçºçãã¾ãã";break;default:return}K(a,te,!0),setTimeout(()=>{const ne=new URL(window.location.href);ne.searchParams.delete("error"),ne.searchParams.delete("shared"),window.history.replaceState({},"",ne.toString()),setTimeout(()=>{K(a,null)},5e3)},1e3)},100)}}});async function l(V){try{V?.preventDefault()}catch{}try{const X=[...n()].reverse();await sge(X),(X?.length??0)>0&&(K(o,!0),setTimeout(()=>K(o,!1),1500))}catch(X){console.warn("dev log copy failed:",X)}}let c=le(e,"uploadProgress",31,()=>Wt({total:0,completed:0,failed:0,aborted:0,inProgress:!1})),u=oe(()=>Ap.value),d=oe(()=>Pp.value),f=me(null),h=me(0),p=null;Ge(()=>{E(u)>0&&E(u)<100?E(f)||(K(f,Date.now(),!0),P({imageSizeInfoOnly:!0}),p=window.setInterval(()=>{E(f)&&K(h,Math.floor((Date.now()-E(f))/1e3),!0)},1e3)):(p!==null&&(clearInterval(p),p=null),K(f,null),K(h,0))}),Ge(()=>{E(d)>0&&E(d)<100?E(f)||(K(f,Date.now(),!0),P({imageSizeInfoOnly:!0}),p=window.setInterval(()=>{E(f)&&K(h,Math.floor((Date.now()-E(f))/1e3),!0)},1e3)):(p!==null&&(clearInterval(p),p=null),K(f,null),K(h,0))});let m=oe(()=>of.value.info),g=oe(()=>of.value.visible),y=me(!1);Ge(()=>{c().inProgress&&!E(y)&&P({imageSizeInfoOnly:!0}),K(y,c().inProgress,!0)});function b(V){if(V<60)return`${V}s`;const X=Math.floor(V/60),Z=V%60;return`${X}m ${Z}s`}function S(){Ap.set(0),Pp.set(0),p!==null&&(clearInterval(p),p=null),K(f,null),K(h,0),c({total:0,completed:0,failed:0,aborted:0,inProgress:!1});const X=fC.value;X&&B6(X,!1),Xie()}function C(){S()}function _(){S()}function x(V){if(!V)return"";const X=V.match(/\.([a-zA-Z0-9]+)$/);if(!X)return"";const Z=X[1].toUpperCase();return Z==="JPEG"?"JPG":Z}function I(){return typeof window>"u"?"medium":localStorage.getItem("videoCompressionLevel")||"medium"}function k(V){switch(V){case"none":return r()("settingsDialog.quality_lossless");case"low":return r()("footerInfoDisplay.videoQualityLevel.high");case"medium":return r()("footerInfoDisplay.videoQualityLevel.medium");case"high":return r()("footerInfoDisplay.videoQualityLevel.low");default:return r()("footerInfoDisplay.videoQualityLevel.medium")}}function T(V){c(V),!V.inProgress&&V.total>0&&setTimeout(()=>{c({total:0,completed:0,failed:0,aborted:0,inProgress:!1})},1e3)}function P(V){if(V?.imageSizeInfoOnly){of.set({info:null,visible:!1});return}c({total:0,completed:0,failed:0,aborted:0,inProgress:!1}),Ap.set(0),Pp.set(0),p!==null&&(clearInterval(p),p=null),K(f,null),K(h,0),of.set({info:null,visible:!1}),K(a,null)}let O=oe(()=>E(a)!==null||E(d)>0&&E(d)<100||E(u)>0&&E(u)<100||c().inProgress||c().total>0||E(g)&&E(m)!==null);var D={updateProgress:T,reset:P},F=S1e(),B=Ee(F);{var N=V=>{var X=d1e();X.__click=l,X.__touchend=l;var Z=ie(X);Na(Z,5,()=>[...n()].reverse(),gu,(te,ne)=>{var J=u1e(),xe=ie(J);Ke(()=>Re(xe,E(ne))),Y(te,J)}),Y(V,X)};Ve(B,V=>{TB()&&n().length&&V(N)})}var M=we(B,2),R=ie(M);{var H=V=>{var X=Ue(),Z=Ee(X);{var te=J=>{var xe=f1e(),Le=ie(xe),he=ie(Le);Ke(()=>Re(he,E(a))),Y(J,xe)},ne=J=>{var xe=Ue(),Le=Ee(xe);{var he=Be=>{var je=p1e(),Fe=ie(je);en(Fe,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"å§ç¸®ä¸­æ­¢",onClick:_,children:(ze,ot)=>{var ct=h1e();Y(ze,ct)},$$slots:{default:!0}});var ve=we(Fe,2),Ie=ie(ve),Oe=ie(Ie),qe=we(Ie,2),Te=ie(qe);Ke((ze,ot)=>{Re(Oe,`${ze??""}: ${E(d)??""}%
                        (${ot??""})`),qa(Te,`width: ${E(d)??""}%`)},[()=>r()("imageCompression.compressing"),()=>b(E(h))]),Y(Be,je)},ke=Be=>{var je=Ue(),Fe=Ee(je);{var ve=Oe=>{var qe=g1e(),Te=ie(qe);en(Te,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"å§ç¸®ä¸­æ­¢",onClick:C,children:(Rt,Tt)=>{var Ot=m1e();Y(Rt,Ot)},$$slots:{default:!0}});var ze=we(Te,2),ot=ie(ze),ct=ie(ot),pt=we(ot,2),$t=ie(pt);Ke((Rt,Tt,Ot)=>{Re(ct,`${Rt??""}${Tt??""}: ${E(u)??""}%
                        (${Ot??""})`),qa($t,`width: ${E(u)??""}%`)},[()=>k(I()),()=>r()("videoQualityLabelSuffix"),()=>b(E(h))]),Y(Oe,qe)},Ie=Oe=>{var qe=Ue(),Te=Ee(qe);{var ze=ct=>{var pt=Ue(),$t=Ee(pt);{var Rt=Ot=>{var He=b1e(),ut=ie(He);en(ut,{variant:"danger",shape:"circle",className:"abort-button",ariaLabel:"ã¢ããã­ã¼ãä¸­æ­¢",onClick:_,children:(nn,Jt)=>{var zn=y1e();Y(nn,zn)},$$slots:{default:!0}});var yt=we(ut,2),Kt=ie(yt),Ht=ie(Kt),zt=we(Ht);{var tn=nn=>{var Jt=an();Ke(zn=>Re(Jt,`(${zn??""}: ${c().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),Y(nn,Jt)};Ve(zt,nn=>{c().failed>0&&nn(tn)})}var Cn=we(zt,2);{var Nn=nn=>{var Jt=an();Ke(zn=>Re(Jt,`(${zn??""}: ${c().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),Y(nn,Jt)};Ve(Cn,nn=>{c().aborted>0&&nn(Nn)})}var Yt=we(Kt,2),Gt=ie(Yt);Ke((nn,Jt)=>{Re(Ht,`${nn??""}: ${c().completed??""}/${c().total??""} `),qa(Gt,`width: ${Jt??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>c().total>0?Math.round(c().completed/c().total*100):0]),Y(Ot,He)},Tt=Ot=>{var He=w1e(),ut=ie(He),yt=ie(ut),Kt=we(yt);{var Ht=Yt=>{var Gt=an();Ke(nn=>Re(Gt,`(${nn??""}: ${c().failed??""})`),[()=>r()("footerInfoDisplay.failed")]),Y(Yt,Gt)};Ve(Kt,Yt=>{c().failed>0&&Yt(Ht)})}var zt=we(Kt,2);{var tn=Yt=>{var Gt=an();Ke(nn=>Re(Gt,`(${nn??""}: ${c().aborted??""})`),[()=>r()("footerInfoDisplay.aborted")]),Y(Yt,Gt)};Ve(zt,Yt=>{c().aborted>0&&Yt(tn)})}var Cn=we(ut,2),Nn=ie(Cn);Ke((Yt,Gt)=>{Re(yt,`${Yt??""}: ${c().completed??""}/${c().total??""} `),qa(Nn,`width: ${Gt??""}%`)},[()=>r()("footerInfoDisplay.uploading"),()=>c().total>0?Math.round(c().completed/c().total*100):0]),Y(Ot,He)};Ve($t,Ot=>{c().inProgress?Ot(Rt):Ot(Tt,!1)})}Y(ct,pt)},ot=ct=>{var pt=Ue(),$t=Ee(pt);{var Rt=Tt=>{var Ot=x1e(),He=ie(Ot),ut=ie(He),yt=we(He,2),Kt=ie(yt);{var Ht=zt=>{var tn=v1e(),Cn=Ee(tn),Nn=we(Cn,2),Yt=we(Nn);{var Gt=Jt=>{var zn=an();Ke(gi=>Re(zn,gi),[()=>r()("footerInfoDisplay.no_compression")||"å§ç¸®ãªã"]),Y(Jt,zn)},nn=Jt=>{var zn=Ue(),gi=Ee(zn);{var ws=Fn=>{var ar=an();Ke(()=>Re(ar,`${E(m).compressedSize??""}
                            (${E(m).compressionRatio??""}%)`)),Y(Fn,ar)},Mt=Fn=>{var ar=an();Ke(()=>Re(ar,`${E(m).compressedSize??""}
                            (${E(m).compressionRatio??""}%)`)),Y(Fn,ar)};Ve(gi,Fn=>{E(m).wasCompressed?Fn(ws):Fn(Mt,!1)},!0)}Y(Jt,zn)};Ve(Yt,Jt=>{E(m).wasSkipped?Jt(Gt):Jt(nn,!1)})}Ke((Jt,zn)=>{Re(Cn,`${Jt??""}
                        ${E(m).originalSize??""}`),Re(Nn,` â ${zn??""} `)},[()=>x(E(m).originalFilename),()=>x(E(m).compressedFilename)]),Y(zt,tn)};Ve(Kt,zt=>{E(m).originalFilename&&E(m).compressedFilename&&zt(Ht)})}Ke(zt=>Re(ut,`${zt??""}:`),[()=>r()("footerInfoDisplay.data_size")]),Y(Tt,Ot)};Ve($t,Tt=>{E(g)&&E(m)&&Tt(Rt)},!0)}Y(ct,pt)};Ve(Te,ct=>{c().inProgress||c().total>0?ct(ze):ct(ot,!1)},!0)}Y(Oe,qe)};Ve(Fe,Oe=>{E(u)>0&&E(u)<100?Oe(ve):Oe(Ie,!1)},!0)}Y(Be,je)};Ve(Le,Be=>{E(d)>0&&E(d)<100?Be(he):Be(ke,!1)},!0)}Y(J,xe)};Ve(Z,J=>{E(a)?J(te):J(ne,!1)})}Y(V,X)};Ve(R,V=>{E(O)&&V(H)})}Y(t,F);var z=kt(D);return s(),z}Mi(["click","touchend"]);var E1e=Ce("<img/>"),T1e=Ce('<div class="profile-picture default svg-icon svelte-whjdpq" aria-label="User"></div>'),C1e=Ce('<div class="update-indicator svelte-whjdpq"></div>'),_1e=Ce('<div class="settings-icon svg-icon svelte-whjdpq" aria-label="Settings"></div> <!>',1),A1e=Ce('<div class="footer-bar svelte-whjdpq"><!> <!> <!></div>');function P1e(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=oe(()=>lc.value),o=oe(()=>Qs.value),a=oe(()=>jd.value),l=me(void 0),c=me(!1);const u=()=>E(s)?.name?E(s).name:E(s)?.npub?E(s).npub:"User";function d(k){console.log("ãã­ãã£ã¼ã«ç»åã®èª­ã¿è¾¼ã¿ã«å¤±æãã¾ãã:",k),K(c,!0),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&console.log("Service Workerã«ããã­ã£ãã·ã¥å¦çã®å¯è½æ§ãããã¾ã")}function f(k){if(!k)return!1;try{return new URL(k,location.href).origin===location.origin}catch{return!1}}let h=me(!1);Ge(()=>{E(s)?.picture?(K(c,!1),"serviceWorker"in navigator&&navigator.serviceWorker.controller&&E(s).picture.includes("profile=true")&&console.log("Service Workerã§ãã­ãã£ã¼ã«ç»åãã­ã£ãã·ã¥å¦çäºå®:",E(s).picture),K(h,f(E(s).picture),!0)):K(h,!1)});function p(k){E(l)?.updateProgress(k)}function m(){E(l)?.reset()}var g={isSameOriginPictureUrl:f,updateProgress:p,reset:m},y=A1e(),b=ie(y);{var S=k=>{en(k,{shape:"circle",className:"profile-display loading",disabled:!0,children:(T,P)=>{Nc(T,{showLoader:!0})},$$slots:{default:!0}})},C=k=>{var T=Ue(),P=Ee(T);{var O=F=>{en(F,{shape:"circle",className:"profile-display loading",disabled:!0,children:(B,N)=>{Nc(B,{showLoader:!0})},$$slots:{default:!0}})},D=F=>{var B=Ue(),N=Ee(B);{var M=H=>{{let z=oe(()=>`profile-display${E(o)?" loading":""}`);en(H,{variant:"default",shape:"circle",get className(){return E(z)},get disabled(){return E(o)},onClick:()=>{E(o)||e.onOpenLogoutDialog()},children:(V,X)=>{var Z=Ue(),te=Ee(Z);{var ne=xe=>{Nc(xe,{showLoader:!0})},J=xe=>{var Le=Ue(),he=Ee(Le);{var ke=je=>{var Fe=E1e();kr(Fe,ve=>({src:E(s).picture,alt:ve,class:"profile-picture",loading:"lazy",...E(h)?{crossorigin:"anonymous",referrerpolicy:"no-referrer"}:{},onerror:d}),[u],void 0,void 0,"svelte-whjdpq"),Y(je,Fe)},Be=je=>{var Fe=T1e();Y(je,Fe)};Ve(he,je=>{E(s)?.picture&&!E(c)?je(ke):je(Be,!1)},!0)}Y(xe,Le)};Ve(te,xe=>{E(o)?xe(ne):xe(J,!1)})}Y(V,Z)},$$slots:{default:!0}})}},R=H=>{var z=Ue(),V=Ee(z);{var X=Z=>{en(Z,{className:"login-btn",variant:"primary",shape:"pill",get onClick(){return e.onShowLoginDialog},children:(te,ne)=>{var J=an();Ke(xe=>Re(J,xe),[()=>n()("app.login")]),Y(te,J)},$$slots:{default:!0}})};Ve(V,Z=>{!E(o)&&!e.isAuthenticated&&Z(X)},!0)}Y(H,z)};Ve(N,H=>{e.isAuthenticated&&(E(a)||E(o))?H(M):H(R,!1)},!0)}Y(F,B)};Ve(P,F=>{e.isAuthenticated&&E(o)?F(O):F(D,!1)},!0)}Y(k,T)};Ve(b,k=>{e.isAuthInitialized?k(C,!1):k(S)})}var _=we(b,2);gr(k1e(_,{}),k=>K(l,k,!0),()=>E(l));var x=we(_,2);{let k=oe(()=>e.swNeedRefresh?"has-update":"");en(x,{variant:"default",shape:"circle",get className(){return`settings-btn ${E(k)??""}`},get onClick(){return e.onOpenSettingsDialog},ariaLabel:"è¨­å®",children:(T,P)=>{var O=_1e(),D=we(Ee(O),2);{var F=B=>{var N=C1e();Y(B,N)};Ve(D,B=>{e.swNeedRefresh&&B(F)})}Y(T,O)},$$slots:{default:!0}})}Y(t,y);var I=kt(g);return i(),I}const K$=66,I1e=50,O1e=50,M1e=100;let a4=me(!1);const N1e={get value(){return E(a4)},set:t=>{K(a4,t,!0),typeof document<"u"&&document.documentElement.style.setProperty("--reason-input-height",t?`${O1e}px`:"0px")}};let G$=me(K$),l4=me(0);const Z$={get value(){return E(G$)}};function R1e(){if(typeof window>"u"||!window.visualViewport)return;let t=null;function e(){t&&cancelAnimationFrame(t),t=requestAnimationFrame(()=>{const n=window.visualViewport;if(!n)return;const r=n.height+(n.offsetTop||0),i=Math.max(0,window.innerHeight-r),s=i>M1e;K(G$,s?i:K$,!0),K(l4,s?i:0,!0);const o=document.documentElement;o.style.setProperty("--keyboard-height",`${E(l4)}px`),o.style.setProperty("--visible-viewport-height",`${n.height}px`)})}return e(),window.visualViewport.addEventListener("resize",e),window.visualViewport.addEventListener("scroll",e),()=>{window.visualViewport?.removeEventListener("resize",e),window.visualViewport?.removeEventListener("scroll",e),t&&cancelAnimationFrame(t),t=null}}var D1e=Ce('<div class="image-icon svg-icon svelte-hsi6z2"></div>'),L1e=Ce("<!> <!>",1),B1e=Ce('<div class="plane-icon svg-icon svelte-hsi6z2"></div>'),F1e=Ce("<!> <!>",1),$1e=Ce('<div class="content-warning-icon svg-icon svelte-hsi6z2"></div>'),z1e=Ce("<!> <!>",1),U1e=Ce('<div class="footer-button-bar svelte-hsi6z2"><div class="button-container svelte-hsi6z2"><!> <!> <!></div></div>');function H1e(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=me(!1);Ge(()=>Wr.subscribe(C=>{K(s,C&&C.isAuthenticated,!0)}));let o=oe(()=>Pn.postStatus),a=oe(()=>Pn.isUploading),l=oe(()=>Pn.canPost),c=me(!1);Ge(()=>{E(o).sending?K(c,!0):E(c)&&setTimeout(()=>{K(c,!1)},400)});let u=oe(()=>qu.value);function d(){qu.toggle(),qu.value||Af.reset()}let f=oe(()=>Z$.value);function h(S){S.preventDefault()}Ge(()=>R1e());var p=U1e(),m=ie(p);m.__mousedown=h,m.__touchstart=h;var g=ie(m);Nt(g,()=>mf,(S,C)=>{C(S,{delayDuration:500,children:(_,x)=>{var I=L1e(),k=Ee(I);{const P=(O,D)=>{let F=()=>D?.().props;const B=oe(()=>{const{onclick:N,...M}=F();return{tooltipOnclick:N,restProps:M}});{let N=oe(()=>!E(s)||E(o).sending||E(a)),M=oe(()=>n()("postComponent.upload_image"));en(O,Qn({variant:"footer",shape:"square",className:"image-button",get disabled(){return E(N)},onClick:R=>{e.onUploadImage?.(),typeof E(B).tooltipOnclick=="function"&&E(B).tooltipOnclick(R)},get ariaLabel(){return E(M)}},()=>E(B).restProps,{children:(R,H)=>{var z=D1e();Y(R,z)},$$slots:{default:!0}}))}};Nt(k,()=>yf,(O,D)=>{D(O,{child:P,$$slots:{child:!0}})})}var T=we(k,2);Nt(T,()=>Tc,(P,O)=>{O(P,{children:(D,F)=>{var B=Ue(),N=Ee(B);Nt(N,()=>gf,(M,R)=>{R(M,{sideOffset:8,class:"tooltip-content",children:(H,z)=>{var V=an();Ke(X=>Re(V,X),[()=>n()("keyboardButtonBar.upload_image_tooltip")]),Y(H,V)},$$slots:{default:!0}})}),Y(D,B)},$$slots:{default:!0}})}),Y(_,I)},$$slots:{default:!0}})});var y=we(g,2);Nt(y,()=>mf,(S,C)=>{C(S,{delayDuration:500,children:(_,x)=>{var I=F1e(),k=Ee(I);{const P=(O,D)=>{let F=()=>D?.().props;const B=oe(()=>{const{onclick:N,...M}=F();return{tooltipOnclick:N,restProps:M}});{let N=oe(()=>E(c)?"loading":""),M=oe(()=>!E(l)||E(o).sending||E(a)||!E(s)||E(o).completed),R=oe(()=>n()("postComponent.post"));en(O,Qn({variant:"primary",shape:"square",get className(){return`post-button ${E(N)??""}`},get disabled(){return E(M)},onClick:H=>{Sse(30),wme(),typeof E(B).tooltipOnclick=="function"&&E(B).tooltipOnclick(H)},get ariaLabel(){return E(R)}},()=>E(B).restProps,{children:(H,z)=>{var V=Ue(),X=Ee(V);{var Z=ne=>{Nc(ne,{showLoader:!0,text:!1,customClass:"post-button-loading"})},te=ne=>{var J=B1e();Y(ne,J)};Ve(X,ne=>{E(c)?ne(Z):ne(te,!1)})}Y(H,V)},$$slots:{default:!0}}))}};Nt(k,()=>yf,(O,D)=>{D(O,{child:P,$$slots:{child:!0}})})}var T=we(k,2);Nt(T,()=>Tc,(P,O)=>{O(P,{children:(D,F)=>{var B=Ue(),N=Ee(B);Nt(N,()=>gf,(M,R)=>{R(M,{sideOffset:8,class:"tooltip-content",children:(H,z)=>{var V=an();Ke(X=>Re(V,X),[()=>n()("keyboardButtonBar.post_tooltip")]),Y(H,V)},$$slots:{default:!0}})}),Y(D,B)},$$slots:{default:!0}})}),Y(_,I)},$$slots:{default:!0}})});var b=we(y,2);Nt(b,()=>mf,(S,C)=>{C(S,{delayDuration:500,children:(_,x)=>{var I=z1e(),k=Ee(I);{const P=(O,D)=>{let F=()=>D?.().props;const B=oe(()=>{const{onclick:N,...M}=F();return{tooltipOnclick:N,restProps:M}});{let N=oe(()=>n()("keyboardButtonBar.content_warning_toggle"));en(O,Qn({variant:"footer",shape:"square",get selected(){return E(u)},onClick:M=>{d(),typeof E(B).tooltipOnclick=="function"&&E(B).tooltipOnclick(M)},get ariaLabel(){return E(N)}},()=>E(B).restProps,{children:(M,R)=>{var H=$1e();Y(M,H)},$$slots:{default:!0}}))}};Nt(k,()=>yf,(O,D)=>{D(O,{child:P,$$slots:{child:!0}})})}var T=we(k,2);Nt(T,()=>Tc,(P,O)=>{O(P,{children:(D,F)=>{var B=Ue(),N=Ee(B);Nt(N,()=>gf,(M,R)=>{R(M,{sideOffset:8,class:"tooltip-content",children:(H,z)=>{var V=an();Ke(X=>Re(V,X),[()=>n()("keyboardButtonBar.content_warning_tooltip")]),Y(H,V)},$$slots:{default:!0}})}),Y(D,B)},$$slots:{default:!0}})}),Y(_,I)},$$slots:{default:!0}})}),Ke(()=>qa(p,`bottom: ${E(f)??""}px;`)),Y(t,p),kt(),i()}Mi(["mousedown","touchstart"]);var V1e=Ce('<div class="reason-input-container svelte-7w6hzc"><input id="content-warning-reason-input" type="text" class="reason-input svelte-7w6hzc"/></div>');function W1e(t,e){St(e,!0);const n=()=>Xn(or,"$_",r),[r,i]=hi();let s=oe(()=>qu.value),o=oe(()=>Af.value),a=oe(()=>E(s));Ge(()=>{N1e.set(E(a))});let l=oe(()=>Z$.value+I1e);function c(h){const p=h.target;Af.set(p.value)}var u=Ue(),d=Ee(u);{var f=h=>{var p=V1e(),m=ie(p);m.__change=c,m.__input=c,Ke((g,y)=>{qa(p,`bottom: ${E(l)??""}px;`),wn(m,"placeholder",g),uM(m,E(o)),wn(m,"aria-label",y)},[()=>n()("postComponent.content_warning_reason_placeholder"),()=>n()("postComponent.content_warning_reason_label")]),Y(h,p)};Ve(d,h=>{E(a)&&h(f)})}Y(t,u),kt(),i()}Mi(["change","input"]);class j1e{fileUploadManager;isProcessingSharedImage=!1;constructor(e){this.fileUploadManager=new CB(e),this.setupServiceWorkerListeners()}setupServiceWorkerListeners(){"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",this.handleServiceWorkerMessage.bind(this))}handleServiceWorkerMessage(e){const{data:n,type:r}=e.data||{};r==="SHARED_IMAGE"&&n?.image&&vI(n.image,n.metadata)}checkIfOpenedFromShareInternal(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).get("shared")==="true"}async checkForSharedImageOnLaunch(){if(this.isProcessingSharedImage)return{success:!1,error:"æ¢ã«å¦çä¸­ã§ã"};if(!this.checkIfOpenedFromShareInternal())return{success:!1,error:"å±æçµç±ã§ã®èµ·åã§ã¯ããã¾ãã"};this.isProcessingSharedImage=!0;try{const e=await this.fileUploadManager.processSharedImageOnLaunch();return e.success&&e.data&&vI(e.data.image,e.data.metadata),e}finally{this.isProcessingSharedImage=!1}}async getSharedImageFromServiceWorker(){return await this.fileUploadManager.getSharedImageFromServiceWorker()}checkIfOpenedFromShare(){return this.fileUploadManager.checkIfOpenedFromShare()}isProcessing(){return this.isProcessingSharedImage}getSharedImageFile(){return nse()}getSharedImageMetadata(){return rse()}clearSharedImage(){Jie()}}let H2=null;function q1e(){return H2||(H2=new j1e),H2}function c4(){return q1e().checkIfOpenedFromShare()}function K1e(){if(typeof window>"u"||!window.location)return null;const e=new URLSearchParams(window.location.search).get("content");if(!e)return null;try{const n=decodeURIComponent(e);return D6(n)}catch(n){return console.error("URLã¯ã¨ãªãã©ã¡ã¼ã¿ã®ãã³ã¼ãã«å¤±æ:",n),null}}function G1e(){if(typeof window>"u"||!window.location)return;const t=new URLSearchParams(window.location.search),e=[];let n=!1;if(t.has("content")){const i=t.get("content");(!i||i.trim()==="")&&(n=!0),t.delete("content"),n=!0}const r=[];if(t.forEach((i,s)=>{e.includes(s)||(r.push(s),n=!0)}),r.forEach(i=>t.delete(i)),n){const i=t.toString()?`${window.location.pathname}?${t.toString()}`:window.location.pathname;window.history.replaceState({},"",i)}}function Z1e(){return typeof window>"u"||!window.location?!1:new URLSearchParams(window.location.search).has("content")}var X1e=Ce('<main class="svelte-1n46o8q"><div class="main-content svelte-1n46o8q"><!> <!></div> <!> <!> <!> <!> <!> <!> <!> <!> <!></main>');function Q1e(t,e){St(e,!0);const n=()=>Xn(gs,"$locale",s),r=()=>Xn(or,"$_",s),i=()=>Xn(ST,"$swNeedRefresh",s),[s,o]=hi();let a=me(""),l=me("");const c=Jl.getPublicKeyState();Ge(()=>{c.setNsec(E(l))}),Ge(()=>{_p.value&&(K(l,""),K(a,""))});let u=oe(()=>Wr.value?.isAuthenticated??!1),d=oe(()=>Wr.value?.isInitialized??!1),f=!1,h="";if(!f){const Te=localStorage.getItem("nsec"),ze=localStorage.getItem("__nostrlogin_nip46");if(!Te){if(ze)try{const ot=JSON.parse(ze);ot?.pubkey&&(h=ot.pubkey)}catch{}}f=!0}let p=me(void 0),m,g=me(!1),y=me(void 0),b=me(void 0),S=me(!1);async function C(Te){K(p,kV({verifier:RW}),!0);const ze=new Voe(E(p)),ot=new jie(E(p),{relayListUpdatedStore:{value:sS.value,set:ct=>sS.set(ct)}});m=new Woe(E(p),ot,ze),ase(ot),await m.initializeRelays(Te)}async function _(Te){const ze=await Jl.authenticateWithNostrLogin(Te);if(!ze.success){console.error("nostr-loginèªè¨¼å¤±æ:",ze.error);return}if(ze.pubkeyHex){K(g,!0),Qs.set(!0),W1();try{await C();const ot=await m.initializeForLogin(ze.pubkeyHex);ot&&(lc.set(ot),jd.set(!0)),Qs.set(!1)}catch(ot){console.error("nostr-loginèªè¨¼å¦çä¸­ã«ã¨ã©ã¼:",ot),Qs.set(!1)}finally{K(g,!1)}}}async function x(){const Te=await Jl.authenticateWithNsec(E(l));if(!Te.success){K(a,Te.error||"authentication_error",!0);return}Qs.set(!0),W1(),K(a,"");try{if(Te.pubkeyHex){const ze=await m.initializeForLogin(Te.pubkeyHex);ze&&(lc.set(ze),jd.set(!0)),Qs.set(!1)}else Qs.set(!1)}catch{Qs.set(!1)}}function I(){K(S,!0),Jl.logout(),lc.set({name:"",picture:"",npub:"",nprofile:""}),jd.set(!1),E(y)?.resetPostContent&&E(y).resetPostContent(),u5(),K(l,""),K(a,"")}async function k(){K(g,!0);try{await Jl.showNostrLoginDialog()}catch(Te){Te instanceof Error&&Te.message==="Cancelled"||console.error("nostr-loginã§ã¨ã©ã¼:",Te)}finally{K(g,!1)}}Ge(()=>{n()&&localStorage.setItem("locale",n())}),Ge(()=>{const Te=Wr.value?.pubkey;Te&&Wr.value?.isAuthenticated&&m&&m.getRelayManager().loadRelayConfigForUI(Te)});let T=me(!1);const P=localStorage.getItem("sharedImageProcessed")==="1";bs(()=>((async()=>{const ze=localStorage.getItem("locale");if(ze&&ze!==n()&&gs.set(ze),await yq(),K(T,!0),Jl.setNostrLoginHandler(_),c4()){const ct=await Loe(),pt=await Boe();(!ct.isReady||!ct.hasController||!pt)&&console.warn("Service Worker not ready for shared image processing:",ct)}if((async()=>{try{const ct=await Jl.initializeAuth();if(ct.hasAuth&&ct.pubkeyHex){await C(ct.pubkeyHex);const pt=await m.initializeForLogin(ct.pubkeyHex);pt&&(lc.set(pt),jd.set(!0)),Qs.set(!1)}else await C(),Qs.set(!1)}catch(ct){console.error("èªè¨¼åæåä¸­ã«ã¨ã©ã¼:",ct),await C(),Qs.set(!1)}finally{Jl.markAuthInitialized()}})(),c4()&&!P)try{const ct=await Doe();if(ct?.image)Ur.file=ct.image,Ur.metadata=ct.metadata,Ur.received=!0,localStorage.setItem("sharedImageProcessed","1");else{console.warn("No shared image data received");const $t=new URLSearchParams(window.location.search).get("error");$t&&console.error("Shared image processing failed with error parameter:",{error:$t,location:window.location.href})}}catch(ct){console.error("å±æç»åã®å¦çä¸­ã«ã¨ã©ã¼:",ct)}if(localStorage.getItem("firstVisit")!=="1"?(qh.set(!0),localStorage.setItem("firstVisit","1")):setTimeout(()=>{E(y)?.focusEditor()},300),Z1e()){const ct=K1e();ct&&ese(ct)}G1e()})(),Le=document.visibilityState==="hidden",document.addEventListener("visibilitychange",ke),()=>{document.removeEventListener("visibilitychange",ke)})),Ge(()=>{Ur.received&&Ur.file&&E(y)&&(E(y).uploadFiles([Ur.file]),Ur.file=null,Ur.metadata=void 0,Ur.received=!1,localStorage.setItem("sharedImageProcessed","1"),setTimeout(()=>localStorage.removeItem("sharedImageProcessed"),500))}),Ge(()=>{zu.received&&zu.content&&E(y)&&(E(y).insertTextContent(zu.content),tse())});function O(Te){sse.set(Te)}function D(Te){E(b)&&E(b).updateProgress(Te)}function F(){E(b)?.reset&&E(b).reset(),localStorage.removeItem("sharedImageProcessed")}function B(){E(y)?.resetPostContent()}function N(){if(!E(y)?.getEditorHtml)return!1;const Te=E(y).getEditorHtml();if(!Te||Te==="<p></p>")return!1;const ze=Ave(Te);return ze.needsConfirmation?(Fg.set(Te),Dd.set(!0),!1):ze.success}function M(){const Te=Fg.value;Te&&Pve(Te),Fg.set(null),Dd.set(!1)}function R(){Fg.set(null),Dd.set(!1)}let H=me(!1);Ge(()=>{K(H,Dd.value,!0)}),Ge(()=>{!E(H)&&Dd.value&&Dd.set(!1)});function z(){Bg.set(!0)}function V(Te){E(y)?.loadDraftContent(Te)}let X=null;async function Z(){if(!E(u)||!Wr.value.pubkey)return;m||await C(Wr.value.pubkey);const Te=await m.refreshRelaysAndProfile(Wr.value.pubkey);Te&&(lc.set(Te),jd.set(!0))}let te=me(!1),ne=me(null),J=me(!1);Ge(()=>{r()&&!X&&(X=new q$(r()))}),Ge(()=>{E(T)&&X&&!E(te)&&!E(J)&&(xe(),K(J,!0))});function xe(){!X||E(te)||(K(ne,X.createMessage("info"),!0),K(te,!0),X.scheduleHide(()=>{K(te,!1),K(ne,null)},3e3))}let Le=!1,he=0;function ke(){const Te=Date.now();if(Te-he<1e3){Le=document.visibilityState==="hidden";return}document.visibilityState==="visible"&&Le&&E(T)&&X&&!E(te)&&(xe(),he=Te),Le=document.visibilityState==="hidden"}let Be=me(Wt(localStorage.getItem("imageCompressionLevel")||"medium"));function je(Te){K(Be,Te,!0)}let Fe=me(Wt(localStorage.getItem("uploadEndpoint")||wT(n())));function ve(Te){K(Fe,Te,!0)}Ge(()=>()=>{X&&X.dispose()});var Ie=Ue(),Oe=Ee(Ie);{var qe=Te=>{var ze=Ue(),ot=Ee(ze);Nt(ot,()=>IZ,(ct,pt)=>{pt(ct,{children:($t,Rt)=>{var Tt=X1e(),Ot=ie(Tt),He=ie(Ot);{let Mt=oe(()=>E(te)&&E(ne)?E(ne):null);c1e(He,{onResetPostContent:B,onSaveDraft:N,onShowDraftList:z,get balloonMessage(){return E(Mt)}})}var ut=we(He,2);gr(Hge(ut,{get rxNostr(){return E(p)},get hasStoredKey(){return E(u)},onPostSuccess:F,onUploadStatusChange:O,onUploadProgress:D}),Mt=>K(y,Mt,!0),()=>E(y));var yt=we(Ot,2);W1e(yt,{});var Kt=we(yt,2);H1e(Kt,{onUploadImage:()=>E(y)?.openFileDialog()});var Ht=we(Kt,2);gr(P1e(Ht,{get isAuthenticated(){return E(u)},get isAuthInitialized(){return E(d)},get swNeedRefresh(){return i()},get onShowLoginDialog(){return lse},get onOpenSettingsDialog(){return dse},get onOpenLogoutDialog(){return cse}}),Mt=>K(b,Mt,!0),()=>E(b));var zt=we(Ht,2);{var tn=Mt=>{Tve(Mt,{get show(){return _p.value},get onClose(){return W1},onSave:x,onNostrLogin:k,get isLoadingNostrLogin(){return E(g)},get secretKey(){return E(l)},set secretKey(Fn){K(l,Fn,!0)}})};Ve(zt,Mt=>{_p.value&&Mt(tn)})}var Cn=we(zt,2);{var Nn=Mt=>{yve(Mt,{get show(){return _y.value},get onClose(){return use},onLogout:I,get isLoggingOut(){return E(S)}})};Ve(Cn,Mt=>{_y.value&&Mt(Nn)})}var Yt=we(Cn,2);{var Gt=Mt=>{_ve(Mt,{get show(){return qh.value},onClose:()=>qh.set(!1)})};Ve(Yt,Mt=>{qh.value&&Mt(Gt)})}var nn=we(Yt,2);{var Jt=Mt=>{zve(Mt,{get show(){return Bg.value},onClose:()=>Bg.set(!1),onApplyDraft:V})};Ve(nn,Mt=>{Bg.value&&Mt(Jt)})}var zn=we(nn,2);{var gi=Mt=>{{let Fn=oe(()=>r()("common.confirm")),ar=oe(()=>r()("draft.limit_reached")),yi=oe(()=>r()("common.ok")),lr=oe(()=>r()("common.cancel"));AB(Mt,{get title(){return E(Fn)},get description(){return E(ar)},get confirmLabel(){return E(yi)},get cancelLabel(){return E(lr)},confirmVariant:"danger",onConfirm:M,onCancel:R,get open(){return E(H)},set open(er){K(H,er,!0)}})}};Ve(zn,Mt=>{E(H)&&Mt(gi)})}var ws=we(zn,2);ave(ws,{get show(){return xT.value},get onClose(){return fse},onRefreshRelaysAndProfile:Z,get selectedCompression(){return E(Be)},onSelectedCompressionChange:je,get selectedEndpoint(){return E(Fe)},onSelectedEndpointChange:ve,onOpenWelcomeDialog:()=>qh.set(!0)}),Y($t,Tt)},$$slots:{default:!0}})}),Y(Te,ze)};Ve(Oe,Te=>{n()&&E(T)&&Te(qe)})}Y(t,Ie),kt(),o()}gk(Q1e,{target:document.getElementById("app")});
